var Am=Object.defineProperty;var Im=(_,f,v)=>f in _?Am(_,f,{enumerable:!0,configurable:!0,writable:!0,value:v}):_[f]=v;var cl=(_,f,v)=>(Im(_,typeof f!="symbol"?f+"":f,v),v);(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const D of document.querySelectorAll('link[rel="modulepreload"]'))E(D);new MutationObserver(D=>{for(const S of D)if(S.type==="childList")for(const k of S.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&E(k)}).observe(document,{childList:!0,subtree:!0});function v(D){const S={};return D.integrity&&(S.integrity=D.integrity),D.referrerPolicy&&(S.referrerPolicy=D.referrerPolicy),D.crossOrigin==="use-credentials"?S.credentials="include":D.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function E(D){if(D.ep)return;D.ep=!0;const S=v(D);fetch(D.href,S)}})();function Vt(){}function Wu(_,f){for(const v in f)_[v]=f[v];return _}function sd(_){return _()}function zp(){return Object.create(null)}function Ur(_){_.forEach(sd)}function Ic(_){return typeof _=="function"}function ln(_,f){return _!=_?f==f:_!==f||_&&typeof _=="object"||typeof _=="function"}function Mm(_){return Object.keys(_).length===0}function od(_,...f){if(_==null){for(const E of f)E(void 0);return Vt}const v=_.subscribe(...f);return v.unsubscribe?()=>v.unsubscribe():v}function tr(_,f,v){_.$$.on_destroy.push(od(f,v))}function Dp(_,f,v,E){if(_){const D=ad(_,f,v,E);return _[0](D)}}function ad(_,f,v,E){return _[1]&&E?Wu(v.ctx.slice(),_[1](E(f))):v.ctx}function Lp(_,f,v,E){if(_[2]&&E){const D=_[2](E(v));if(f.dirty===void 0)return D;if(typeof D=="object"){const S=[],k=Math.max(f.dirty.length,D.length);for(let o=0;o<k;o+=1)S[o]=f.dirty[o]|D[o];return S}return f.dirty|D}return f.dirty}function Rp(_,f,v,E,D,S){if(D){const k=ad(f,v,E,S);_.p(k,D)}}function Bp(_){if(_.ctx.length>32){const f=[],v=_.ctx.length/32;for(let E=0;E<v;E++)f[E]=-1;return f}return-1}function Hu(_){return _&&Ic(_.destroy)?_.destroy:Vt}function Ae(_,f){_.appendChild(f)}function de(_,f,v){_.insertBefore(f,v||null)}function pe(_){_.parentNode&&_.parentNode.removeChild(_)}function ld(_,f){for(let v=0;v<_.length;v+=1)_[v]&&_[v].d(f)}function fe(_){return document.createElement(_)}function Gi(_){return document.createTextNode(_)}function Ve(){return Gi(" ")}function Mc(){return Gi("")}function Xt(_,f,v,E){return _.addEventListener(f,v,E),()=>_.removeEventListener(f,v,E)}function Oe(_,f,v){v==null?_.removeAttribute(f):_.getAttribute(f)!==v&&_.setAttribute(f,v)}function di(_){return _===""?null:+_}function Cm(_){return Array.from(_.childNodes)}function Xu(_,f){f=""+f,_.data!==f&&(_.data=f)}function Zt(_,f){_.value=f??""}function vc(_,f,v){for(let E=0;E<_.options.length;E+=1){const D=_.options[E];if(D.__value===f){D.selected=!0;return}}(!v||f!==void 0)&&(_.selectedIndex=-1)}function cd(_){const f=_.querySelector(":checked");return f&&f.__value}function Fp(_,f,v){_.classList.toggle(f,!!v)}function Pm(_,f,{bubbles:v=!1,cancelable:E=!1}={}){return new CustomEvent(_,{detail:f,bubbles:v,cancelable:E})}function bc(_,f){return new _(f)}let pl;function ul(_){pl=_}function Cc(){if(!pl)throw new Error("Function called outside component initialization");return pl}function dr(_){Cc().$$.on_mount.push(_)}function km(_){Cc().$$.after_update.push(_)}function zm(_){Cc().$$.on_destroy.push(_)}function Dm(){const _=Cc();return(f,v,{cancelable:E=!1}={})=>{const D=_.$$.callbacks[f];if(D){const S=Pm(f,v,{cancelable:E});return D.slice().forEach(k=>{k.call(_,S)}),!S.defaultPrevented}return!0}}function Op(_,f){const v=_.$$.callbacks[f.type];v&&v.slice().forEach(E=>E.call(this,f))}const ca=[],qn=[];let ha=[];const Up=[],ud=Promise.resolve();let Nu=!1;function hd(){Nu||(Nu=!0,ud.then(pd))}function Lm(){return hd(),ud}function dl(_){ha.push(_)}const Vu=new Set;let oa=0;function pd(){if(oa!==0)return;const _=pl;do{try{for(;oa<ca.length;){const f=ca[oa];oa++,ul(f),Rm(f.$$)}}catch(f){throw ca.length=0,oa=0,f}for(ul(null),ca.length=0,oa=0;qn.length;)qn.pop()();for(let f=0;f<ha.length;f+=1){const v=ha[f];Vu.has(v)||(Vu.add(v),v())}ha.length=0}while(ca.length);for(;Up.length;)Up.pop()();Nu=!1,Vu.clear(),ul(_)}function Rm(_){if(_.fragment!==null){_.update(),Ur(_.before_update);const f=_.dirty;_.dirty=[-1],_.fragment&&_.fragment.p(_.ctx,f),_.after_update.forEach(dl)}}function Bm(_){const f=[],v=[];ha.forEach(E=>_.indexOf(E)===-1?f.push(E):v.push(E)),v.forEach(E=>E()),ha=f}const yc=new Set;let ho;function Yu(){ho={r:0,c:[],p:ho}}function Ku(){ho.r||Ur(ho.c),ho=ho.p}function fi(_,f){_&&_.i&&(yc.delete(_),_.i(f))}function Ei(_,f,v,E){if(_&&_.o){if(yc.has(_))return;yc.add(_),ho.c.push(()=>{yc.delete(_),E&&(v&&_.d(1),E())}),_.o(f)}else E&&E()}function ju(_){return(_==null?void 0:_.length)!==void 0?_:Array.from(_)}function wc(_,f){const v={},E={},D={$$scope:1};let S=_.length;for(;S--;){const k=_[S],o=f[S];if(o){for(const O in k)O in o||(E[O]=1);for(const O in o)D[O]||(v[O]=o[O],D[O]=1);_[S]=o}else for(const O in k)D[O]=1}for(const k in E)k in v||(v[k]=void 0);return v}function Tc(_){return typeof _=="object"&&_!==null?_:{}}function en(_){_&&_.c()}function Wi(_,f,v){const{fragment:E,after_update:D}=_.$$;E&&E.m(f,v),dl(()=>{const S=_.$$.on_mount.map(sd).filter(Ic);_.$$.on_destroy?_.$$.on_destroy.push(...S):Ur(S),_.$$.on_mount=[]}),D.forEach(dl)}function Hi(_,f){const v=_.$$;v.fragment!==null&&(Bm(v.after_update),Ur(v.on_destroy),v.fragment&&v.fragment.d(f),v.on_destroy=v.fragment=null,v.ctx=[])}function Fm(_,f){_.$$.dirty[0]===-1&&(ca.push(_),hd(),_.$$.dirty.fill(0)),_.$$.dirty[f/31|0]|=1<<f%31}function gn(_,f,v,E,D,S,k,o=[-1]){const O=pl;ul(_);const z=_.$$={fragment:null,ctx:[],props:S,update:Vt,not_equal:D,bound:zp(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(f.context||(O?O.$$.context:[])),callbacks:zp(),dirty:o,skip_bound:!1,root:f.target||O.$$.root};k&&k(z.root);let ne=!1;if(z.ctx=v?v(_,f.props||{},(H,ce,...ge)=>{const xe=ge.length?ge[0]:ce;return z.ctx&&D(z.ctx[H],z.ctx[H]=xe)&&(!z.skip_bound&&z.bound[H]&&z.bound[H](xe),ne&&Fm(_,H)),ce}):[],z.update(),ne=!0,Ur(z.before_update),z.fragment=E?E(z.ctx):!1,f.target){if(f.hydrate){const H=Cm(f.target);z.fragment&&z.fragment.l(H),H.forEach(pe)}else z.fragment&&z.fragment.c();f.intro&&fi(_.$$.fragment),Wi(_,f.target,f.anchor),pd()}ul(O)}class _n{constructor(){cl(this,"$$");cl(this,"$$set")}$destroy(){Hi(this,1),this.$destroy=Vt}$on(f,v){if(!Ic(v))return Vt;const E=this.$$.callbacks[f]||(this.$$.callbacks[f]=[]);return E.push(v),()=>{const D=E.indexOf(v);D!==-1&&E.splice(D,1)}}$set(f){this.$$set&&!Mm(f)&&(this.$$.skip_bound=!0,this.$$set(f),this.$$.skip_bound=!1)}}const Om="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Om);const aa=[];function dd(_,f){return{subscribe:fd(_,f).subscribe}}function fd(_,f=Vt){let v;const E=new Set;function D(o){if(ln(_,o)&&(_=o,v)){const O=!aa.length;for(const z of E)z[1](),aa.push(z,_);if(O){for(let z=0;z<aa.length;z+=2)aa[z][0](aa[z+1]);aa.length=0}}}function S(o){D(o(_))}function k(o,O=Vt){const z=[o,O];return E.add(z),E.size===1&&(v=f(D,S)||Vt),o(_),()=>{E.delete(z),E.size===0&&v&&(v(),v=null)}}return{set:D,update:S,subscribe:k}}function md(_,f,v){const E=!Array.isArray(_),D=E?[_]:_;if(!D.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const S=f.length<2;return dd(v,(k,o)=>{let O=!1;const z=[];let ne=0,H=Vt;const ce=()=>{if(ne)return;H();const xe=f(E?z[0]:z,k,o);S?k(xe):H=Ic(xe)?xe:Vt},ge=D.map((xe,Ce)=>od(xe,Ne=>{z[Ce]=Ne,ne&=~(1<<Ce),O&&ce()},()=>{ne|=1<<Ce}));return O=!0,ce(),function(){Ur(ge),H(),O=!1}})}function Um(_,f){if(_ instanceof RegExp)return{keys:!1,pattern:_};var v,E,D,S,k=[],o="",O=_.split("/");for(O[0]||O.shift();D=O.shift();)v=D[0],v==="*"?(k.push("wild"),o+="/(.*)"):v===":"?(E=D.indexOf("?",1),S=D.indexOf(".",1),k.push(D.substring(1,~E?E:~S?S:D.length)),o+=~E&&!~S?"(?:/([^/]+?))?":"/([^/]+?)",~S&&(o+=(~E?"?":"")+"\\"+D.substring(S))):o+="/"+D;return{keys:k,pattern:new RegExp("^"+o+(f?"(?=$|/)":"/?$"),"i")}}function Vm(_){let f,v,E;const D=[_[2]];var S=_[0];function k(o,O){let z={};if(O!==void 0&&O&4)z=wc(D,[Tc(o[2])]);else for(let ne=0;ne<D.length;ne+=1)z=Wu(z,D[ne]);return{props:z}}return S&&(f=bc(S,k(_)),f.$on("routeEvent",_[7])),{c(){f&&en(f.$$.fragment),v=Mc()},m(o,O){f&&Wi(f,o,O),de(o,v,O),E=!0},p(o,O){if(O&1&&S!==(S=o[0])){if(f){Yu();const z=f;Ei(z.$$.fragment,1,0,()=>{Hi(z,1)}),Ku()}S?(f=bc(S,k(o,O)),f.$on("routeEvent",o[7]),en(f.$$.fragment),fi(f.$$.fragment,1),Wi(f,v.parentNode,v)):f=null}else if(S){const z=O&4?wc(D,[Tc(o[2])]):{};f.$set(z)}},i(o){E||(f&&fi(f.$$.fragment,o),E=!0)},o(o){f&&Ei(f.$$.fragment,o),E=!1},d(o){o&&pe(v),f&&Hi(f,o)}}}function $m(_){let f,v,E;const D=[{params:_[1]},_[2]];var S=_[0];function k(o,O){let z={};if(O!==void 0&&O&6)z=wc(D,[O&2&&{params:o[1]},O&4&&Tc(o[2])]);else for(let ne=0;ne<D.length;ne+=1)z=Wu(z,D[ne]);return{props:z}}return S&&(f=bc(S,k(_)),f.$on("routeEvent",_[6])),{c(){f&&en(f.$$.fragment),v=Mc()},m(o,O){f&&Wi(f,o,O),de(o,v,O),E=!0},p(o,O){if(O&1&&S!==(S=o[0])){if(f){Yu();const z=f;Ei(z.$$.fragment,1,0,()=>{Hi(z,1)}),Ku()}S?(f=bc(S,k(o,O)),f.$on("routeEvent",o[6]),en(f.$$.fragment),fi(f.$$.fragment,1),Wi(f,v.parentNode,v)):f=null}else if(S){const z=O&6?wc(D,[O&2&&{params:o[1]},O&4&&Tc(o[2])]):{};f.$set(z)}},i(o){E||(f&&fi(f.$$.fragment,o),E=!0)},o(o){f&&Ei(f.$$.fragment,o),E=!1},d(o){o&&pe(v),f&&Hi(f,o)}}}function Nm(_){let f,v,E,D;const S=[$m,Vm],k=[];function o(O,z){return O[1]?0:1}return f=o(_),v=k[f]=S[f](_),{c(){v.c(),E=Mc()},m(O,z){k[f].m(O,z),de(O,E,z),D=!0},p(O,[z]){let ne=f;f=o(O),f===ne?k[f].p(O,z):(Yu(),Ei(k[ne],1,1,()=>{k[ne]=null}),Ku(),v=k[f],v?v.p(O,z):(v=k[f]=S[f](O),v.c()),fi(v,1),v.m(E.parentNode,E))},i(O){D||(fi(v),D=!0)},o(O){Ei(v),D=!1},d(O){O&&pe(E),k[f].d(O)}}}function Vp(){const _=window.location.href.indexOf("#/");let f=_>-1?window.location.href.substr(_+1):"/";const v=f.indexOf("?");let E="";return v>-1&&(E=f.substr(v+1),f=f.substr(0,v)),{location:f,querystring:E}}const Ju=dd(null,function(f){f(Vp());const v=()=>{f(Vp())};return window.addEventListener("hashchange",v,!1),function(){window.removeEventListener("hashchange",v,!1)}}),ir=md(Ju,_=>_.location);md(Ju,_=>_.querystring);const $p=fd(void 0);function Qu(_,f){if(f=jp(f),!_||!_.tagName||_.tagName.toLowerCase()!="a")throw Error('Action "link" can only be used with <a> tags');return Np(_,f),{update(v){v=jp(v),Np(_,v)}}}function jm(_){_?window.scrollTo(_.__svelte_spa_router_scrollX,_.__svelte_spa_router_scrollY):window.scrollTo(0,0)}function Np(_,f){let v=f.href||_.getAttribute("href");if(v&&v.charAt(0)=="/")v="#"+v;else if(!v||v.length<2||v.slice(0,2)!="#/")throw Error('Invalid value for "href" attribute: '+v);_.setAttribute("href",v),_.addEventListener("click",E=>{E.preventDefault(),f.disabled||qm(E.currentTarget.getAttribute("href"))})}function jp(_){return _&&typeof _=="string"?{href:_}:_||{}}function qm(_){history.replaceState({...history.state,__svelte_spa_router_scrollX:window.scrollX,__svelte_spa_router_scrollY:window.scrollY},void 0),window.location.hash=_}function Zm(_,f,v){let{routes:E={}}=f,{prefix:D=""}=f,{restoreScrollState:S=!1}=f;class k{constructor(it,Le){if(!Le||typeof Le!="function"&&(typeof Le!="object"||Le._sveltesparouter!==!0))throw Error("Invalid component object");if(!it||typeof it=="string"&&(it.length<1||it.charAt(0)!="/"&&it.charAt(0)!="*")||typeof it=="object"&&!(it instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:Ke,keys:ft}=Um(it);this.path=it,typeof Le=="object"&&Le._sveltesparouter===!0?(this.component=Le.component,this.conditions=Le.conditions||[],this.userData=Le.userData,this.props=Le.props||{}):(this.component=()=>Promise.resolve(Le),this.conditions=[],this.props={}),this._pattern=Ke,this._keys=ft}match(it){if(D){if(typeof D=="string")if(it.startsWith(D))it=it.substr(D.length)||"/";else return null;else if(D instanceof RegExp){const vt=it.match(D);if(vt&&vt[0])it=it.substr(vt[0].length)||"/";else return null}}const Le=this._pattern.exec(it);if(Le===null)return null;if(this._keys===!1)return Le;const Ke={};let ft=0;for(;ft<this._keys.length;){try{Ke[this._keys[ft]]=decodeURIComponent(Le[ft+1]||"")||null}catch{Ke[this._keys[ft]]=null}ft++}return Ke}async checkConditions(it){for(let Le=0;Le<this.conditions.length;Le++)if(!await this.conditions[Le](it))return!1;return!0}}const o=[];E instanceof Map?E.forEach((je,it)=>{o.push(new k(it,je))}):Object.keys(E).forEach(je=>{o.push(new k(je,E[je]))});let O=null,z=null,ne={};const H=Dm();async function ce(je,it){await Lm(),H(je,it)}let ge=null,xe=null;S&&(xe=je=>{je.state&&(je.state.__svelte_spa_router_scrollY||je.state.__svelte_spa_router_scrollX)?ge=je.state:ge=null},window.addEventListener("popstate",xe),km(()=>{jm(ge)}));let Ce=null,Ne=null;const Pe=Ju.subscribe(async je=>{Ce=je;let it=0;for(;it<o.length;){const Le=o[it].match(je.location);if(!Le){it++;continue}const Ke={route:o[it].path,location:je.location,querystring:je.querystring,userData:o[it].userData,params:Le&&typeof Le=="object"&&Object.keys(Le).length?Le:null};if(!await o[it].checkConditions(Ke)){v(0,O=null),Ne=null,ce("conditionsFailed",Ke);return}ce("routeLoading",Object.assign({},Ke));const ft=o[it].component;if(Ne!=ft){ft.loading?(v(0,O=ft.loading),Ne=ft,v(1,z=ft.loadingParams),v(2,ne={}),ce("routeLoaded",Object.assign({},Ke,{component:O,name:O.name,params:z}))):(v(0,O=null),Ne=null);const vt=await ft();if(je!=Ce)return;v(0,O=vt&&vt.default||vt),Ne=ft}Le&&typeof Le=="object"&&Object.keys(Le).length?v(1,z=Le):v(1,z=null),v(2,ne=o[it].props),ce("routeLoaded",Object.assign({},Ke,{component:O,name:O.name,params:z})).then(()=>{$p.set(z)});return}v(0,O=null),Ne=null,$p.set(void 0)});zm(()=>{Pe(),xe&&window.removeEventListener("popstate",xe)});function rt(je){Op.call(this,_,je)}function De(je){Op.call(this,_,je)}return _.$$set=je=>{"routes"in je&&v(3,E=je.routes),"prefix"in je&&v(4,D=je.prefix),"restoreScrollState"in je&&v(5,S=je.restoreScrollState)},_.$$.update=()=>{_.$$.dirty&32&&(history.scrollRestoration=S?"manual":"auto")},[O,z,ne,E,D,S,rt,De]}class Gm extends _n{constructor(f){super(),gn(this,f,Zm,Nm,ln,{routes:3,prefix:4,restoreScrollState:5})}}const Wm=_=>({}),qp=_=>({});function Zp(_){let f,v,E,D,S,k,o;return{c(){f=fe("header"),v=fe("a"),v.textContent="Back to Menu",E=Ve(),D=fe("a"),S=Gi("Source"),Oe(v,"href","/"),Oe(v,"class","svelte-1jo4v3w"),Oe(D,"href",_[1].sourceUrl),Oe(D,"target","_blank"),Oe(D,"rel","noreferrer"),Oe(D,"class","svelte-1jo4v3w"),Oe(f,"class","p-5 lg:p-10 pb-2.5 lg:pb-5 flex justify-between gap-2.5 lg:gap-5 sticky top-0 bg-inherit svelte-1jo4v3w")},m(O,z){de(O,f,z),Ae(f,v),Ae(f,E),Ae(f,D),Ae(D,S),k||(o=Hu(Qu.call(null,v)),k=!0)},p:Vt,d(O){O&&pe(f),k=!1,o()}}}function Hm(_){let f,v,E,D,S,k,o,O=!_[0]&&Zp(_);const z=_[3].title,ne=Dp(z,_,_[2],qp),H=_[3].default,ce=Dp(H,_,_[2],null);return{c(){f=fe("aside"),v=fe("div"),O&&O.c(),E=Ve(),D=fe("article"),S=fe("h1"),ne&&ne.c(),k=Ve(),ce&&ce.c(),Oe(S,"class","break-all svelte-1jo4v3w"),Oe(D,"class","p-5 lg:p-10 flex flex-col gap-1.5 lg:gap-3 svelte-1jo4v3w"),Fp(D,"!pt-0",!_[0]),Oe(v,"class","h-full flex flex-col bg-inherit overflow-x-hidden overflow-y-auto svelte-1jo4v3w"),Oe(f,"class","basis-full lg:basis-1/3 overflow-hidden shadow-xl svelte-1jo4v3w")},m(ge,xe){de(ge,f,xe),Ae(f,v),O&&O.m(v,null),Ae(v,E),Ae(v,D),Ae(D,S),ne&&ne.m(S,null),Ae(D,k),ce&&ce.m(D,null),o=!0},p(ge,[xe]){ge[0]?O&&(O.d(1),O=null):O?O.p(ge,xe):(O=Zp(ge),O.c(),O.m(v,E)),ne&&ne.p&&(!o||xe&4)&&Rp(ne,z,ge,ge[2],o?Lp(z,ge[2],xe,Wm):Bp(ge[2]),qp),ce&&ce.p&&(!o||xe&4)&&Rp(ce,H,ge,ge[2],o?Lp(H,ge[2],xe,null):Bp(ge[2]),null),(!o||xe&1)&&Fp(D,"!pt-0",!ge[0])},i(ge){o||(fi(ne,ge),fi(ce,ge),o=!0)},o(ge){Ei(ne,ge),Ei(ce,ge),o=!1},d(ge){ge&&pe(f),O&&O.d(),ne&&ne.d(ge),ce&&ce.d(ge)}}}function Xm(_,f,v){let E;tr(_,ir,O=>v(4,E=O));let{$$slots:D={},$$scope:S}=f,{noHeader:k=!1}=f;const o=kn.find(O=>O.path===E);return _.$$set=O=>{"noHeader"in O&&v(0,k=O.noHeader),"$$scope"in O&&v(2,S=O.$$scope)},[k,o,S,D]}class nr extends _n{constructor(f){super(),gn(this,f,Xm,Hm,ln,{noHeader:0})}}var Ym=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Km(_){return _&&_.__esModule&&Object.prototype.hasOwnProperty.call(_,"default")?_.default:_}var gd={exports:{}};(function(_,f){(function(v,E){_.exports=E()})(Ym,function(){var v,E,D;function S(o,O){if(!v)v=O;else if(!E)E=O;else{var z="var sharedChunk = {}; ("+v+")(sharedChunk); ("+E+")(sharedChunk);",ne={};v(ne),D=O(ne),typeof window<"u"&&(D.workerUrl=window.URL.createObjectURL(new Blob([z],{type:"text/javascript"})))}}S(["exports"],function(o){function O(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var z=ne;function ne(i,e){this.x=i,this.y=e}ne.prototype={clone:function(){return new ne(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),n=Math.sin(i),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(i,e){var n=Math.cos(i),s=Math.sin(i),l=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ne.convert=function(i){return i instanceof ne?i:Array.isArray(i)?new ne(i[0],i[1]):i};var H=O(z),ce=ge;function ge(i,e,n,s){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=n,this.p2y=s}ge.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,s=0;s<8;s++){var l=this.sampleCurveX(n)-i;if(Math.abs(l)<e)return n;var h=this.sampleCurveDerivativeX(n);if(Math.abs(h)<1e-6)break;n-=l/h}var d=0,m=1;for(n=i,s=0;s<20&&(l=this.sampleCurveX(n),!(Math.abs(l-i)<e));s++)i>l?d=n:m=n,n=.5*(m-d)+d;return n},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var xe=O(ce);function Ce(i,e,n,s){const l=new xe(i,e,n,s);return function(h){return l.solve(h)}}const Ne=Ce(.25,.1,.25,1);function Pe(i,e,n){return Math.min(n,Math.max(e,i))}function rt(i,e,n){const s=n-e,l=((i-e)%s+s)%s+e;return l===e?n:l}function De(i,...e){for(const n of e)for(const s in n)i[s]=n[s];return i}let je=1;function it(i,e,n){const s={};for(const l in i)s[l]=e.call(n||this,i[l],l,i);return s}function Le(i,e,n){const s={};for(const l in i)e.call(n||this,i[l],l,i)&&(s[l]=i[l]);return s}function Ke(i){return Array.isArray(i)?i.map(Ke):typeof i=="object"&&i?it(i,Ke):i}const ft={};function vt(i){ft[i]||(typeof console<"u"&&console.warn(i),ft[i]=!0)}function Tt(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function Pi(i){let e=0;for(let n,s,l=0,h=i.length,d=h-1;l<h;d=l++)n=i[l],s=i[d],e+=(s.x-n.x)*(n.y+s.y);return e}function Gt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let oi=null;function Xi(i){if(oi==null){const e=i.navigator?i.navigator.userAgent:null;oi=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return oi}function mi(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Dt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Wt,ai;const li={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,n.drawImage(i,0,0,i.width,i.height),n},resolveURL:i=>(Wt||(Wt=document.createElement("a")),Wt.href=i,Wt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ai==null&&(ai=matchMedia("(prefers-reduced-motion: reduce)")),ai.matches)}},Ui={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Ft extends Error{constructor(e,n,s,l){super(`AJAXError: ${n} (${e}): ${s}`),this.status=e,this.statusText=n,this.url=s,this.body=l}}const yn=Gt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,cn=i=>Ui.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function Lt(i,e){const n=new AbortController,s=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:yn(),signal:n.signal});let l=!1,h=!1;return i.type==="json"&&s.headers.set("Accept","application/json"),h||fetch(s).then(d=>d.ok?(m=>{(i.type==="arrayBuffer"||i.type==="image"?m.arrayBuffer():i.type==="json"?m.json():m.text()).then(x=>{h||(l=!0,e(null,x,m.headers.get("Cache-Control"),m.headers.get("Expires")))}).catch(x=>{h||e(new Error(x.message))})})(d):d.blob().then(m=>e(new Ft(d.status,d.statusText,i.url,m)))).catch(d=>{d.code!==20&&e(new Error(d.message))}),{cancel:()=>{h=!0,l||n.abort()}}}const Zn=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Gt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!Gt())return(cn(i.url)||Lt)(i,e)}if(!(/^file:/.test(n=i.url)||/^file:/.test(yn())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Lt(i,e);if(Gt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var n;return function(s,l){const h=new XMLHttpRequest;h.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(h.responseType="arraybuffer");for(const d in s.headers)h.setRequestHeader(d,s.headers[d]);return s.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=s.credentials==="include",h.onerror=()=>{l(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let d=h.response;if(s.type==="json")try{d=JSON.parse(h.response)}catch(m){return l(m)}l(null,d,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else{const d=new Blob([h.response],{type:h.getResponseHeader("Content-Type")});l(new Ft(h.status,h.statusText,s.url,d))}},h.send(s.body),{cancel:()=>h.abort()}}(i,e)},Sr=function(i,e){return Zn(De(i,{type:"arrayBuffer"}),e)};function un(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function gr(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function Gn(i,e,n){if(n&&n[i]){const s=n[i].indexOf(e);s!==-1&&n[i].splice(s,1)}}class ci{constructor(e,n={}){De(this,n),this.type=e}}class hn extends ci{constructor(e,n={}){super("error",De({error:e},n))}}class Wn{on(e,n){return this._listeners=this._listeners||{},gr(e,n,this._listeners),this}off(e,n){return Gn(e,n,this._listeners),Gn(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},gr(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){typeof e=="string"&&(e=new ci(e,n||{}));const s=e.type;if(this.listens(s)){e.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const m of l)m.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const m of h)Gn(s,m,this._oneTimeListeners),m.call(this,e);const d=this._eventedParent;d&&(De(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(e))}else e instanceof hn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const zn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Er(i,e){const n={};for(const s in i)s!=="ref"&&(n[s]=i[s]);return zn.forEach(s=>{s in e&&(n[s]=e[s])}),n}function It(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!It(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!It(i[n],e[n]))return!1;return!0}return i===e}const Ct={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function rr(i,e,n){n.push({command:Ct.addSource,args:[i,e[i]]})}function pn(i,e,n){e.push({command:Ct.removeSource,args:[i]}),n[i]=!0}function Vr(i,e,n,s){pn(i,n,s),rr(i,e,n)}function Jr(i,e,n){let s;for(s in i[n])if(Object.prototype.hasOwnProperty.call(i[n],s)&&s!=="data"&&!It(i[n][s],e[n][s]))return!1;for(s in e[n])if(Object.prototype.hasOwnProperty.call(e[n],s)&&s!=="data"&&!It(i[n][s],e[n][s]))return!1;return!0}function Rt(i,e,n,s,l,h){let d;for(d in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,d)&&(It(i[d],e[d])||n.push({command:h,args:[s,d,e[d],l]}));for(d in e)Object.prototype.hasOwnProperty.call(e,d)&&!Object.prototype.hasOwnProperty.call(i,d)&&(It(i[d],e[d])||n.push({command:h,args:[s,d,e[d],l]}))}function _r(i){return i.id}function yr(i,e){return i[e.id]=e,i}class ze{constructor(e,n,s,l){this.message=(e?`${e}: `:"")+s,l&&(this.identifier=l),n!=null&&n.__line__&&(this.line=n.__line__)}}function ki(i,...e){for(const n of e)for(const s in n)i[s]=n[s];return i}class Yi extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class zi{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[s,l]of n)this.bindings[s]=l}concat(e){return new zi(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Dn={kind:"null"},Be={kind:"number"},dt={kind:"string"},gt={kind:"boolean"},Di={kind:"color"},Li={kind:"object"},at={kind:"value"},xn={kind:"collator"},Vi={kind:"formatted"},Ki={kind:"padding"},Ji={kind:"resolvedImage"},sr={kind:"variableAnchorOffsetCollection"};function gi(i,e){return{kind:"array",itemType:i,N:e}}function Ut(i){if(i.kind==="array"){const e=Ut(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Ln=[Dn,Be,dt,gt,Di,Vi,Li,gi(at),Ki,Ji,sr];function vn(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!vn(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of Ln)if(!vn(n,e))return null}}return`Expected ${Ut(i)} but found ${Ut(e)} instead.`}function G(i,e){return e.some(n=>n.kind===i.kind)}function P(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function R(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const V=.96422,X=.82521,$=4/29,J=6/29,te=3*J*J,ee=J*J*J,ae=Math.PI/180,we=180/Math.PI;function Se(i){return(i%=360)<0&&(i+=360),i}function Ee([i,e,n,s]){let l,h;const d=_t((.2225045*(i=lt(i))+.7168786*(e=lt(e))+.0606169*(n=lt(n)))/1);i===e&&e===n?l=h=d:(l=_t((.4360747*i+.3850649*e+.1430804*n)/V),h=_t((.0139322*i+.0971045*e+.7141733*n)/X));const m=116*d-16;return[m<0?0:m,500*(l-d),200*(d-h),s]}function lt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function _t(i){return i>ee?Math.pow(i,1/3):i/te+$}function Je([i,e,n,s]){let l=(i+16)/116,h=isNaN(e)?l:l+e/500,d=isNaN(n)?l:l-n/200;return l=1*mt(l),h=V*mt(h),d=X*mt(d),[st(3.1338561*h-1.6168667*l-.4906146*d),st(-.9787684*h+1.9161415*l+.033454*d),st(.0719453*h-.2289914*l+1.4052427*d),s]}function st(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function mt(i){return i>J?i*i*i:te*(i-$)}function kt(i){return parseInt(i.padEnd(2,i),16)/255}function jt(i,e){return St(e?i/100:i,0,1)}function St(i,e,n){return Math.min(Math.max(e,i),n)}function Pt(i){return!i.some(Number.isNaN)}const bn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class pt{constructor(e,n,s,l=1,h=!0){this.r=e,this.g=n,this.b=s,this.a=l,h||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[e,n,s,l]))}static parse(e){if(e instanceof pt)return e;if(typeof e!="string")return;const n=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=bn[s];if(l){const[d,m,x]=l;return[d/255,m/255,x/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const d=s.length<6?1:2;let m=1;return[kt(s.slice(m,m+=d)),kt(s.slice(m,m+=d)),kt(s.slice(m,m+=d)),kt(s.slice(m,m+d)||"ff")]}if(s.startsWith("rgb")){const d=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[m,x,w,I,C,L,F,U,Z,Y,Q,oe]=d,ie=[I||" ",F||" ",Y].join("");if(ie==="  "||ie==="  /"||ie===",,"||ie===",,,"){const le=[w,L,Z].join(""),he=le==="%%%"?100:le===""?255:0;if(he){const be=[St(+x/he,0,1),St(+C/he,0,1),St(+U/he,0,1),Q?jt(+Q,oe):1];if(Pt(be))return be}}return}}const h=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(h){const[d,m,x,w,I,C,L,F,U]=h,Z=[x||" ",I||" ",L].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const Y=[+m,St(+w,0,100),St(+C,0,100),F?jt(+F,U):1];if(Pt(Y))return function([Q,oe,ie,le]){function he(be){const Ge=(be+Q/30)%12,et=oe*Math.min(ie,1-ie);return ie-et*Math.max(-1,Math.min(Ge-3,9-Ge,1))}return Q=Se(Q),oe/=100,ie/=100,[he(0),he(8),he(4),le]}(Y)}}}(e);return n?new pt(...n,!1):void 0}get rgb(){const{r:e,g:n,b:s,a:l}=this,h=l||1/0;return this.overwriteGetter("rgb",[e/h,n/h,s/h,l])}get hcl(){return this.overwriteGetter("hcl",function(e){const[n,s,l,h]=Ee(e),d=Math.sqrt(s*s+l*l);return[Math.round(1e4*d)?Se(Math.atan2(l,s)*we):NaN,d,n,h]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ee(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,s,l]=this.rgb;return`rgba(${[e,n,s].map(h=>Math.round(255*h)).join(",")},${l})`}}pt.black=new pt(0,0,0,1),pt.white=new pt(1,1,1,1),pt.transparent=new pt(0,0,0,0),pt.red=new pt(1,0,0,1);class Ai{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Qi{constructor(e,n,s,l,h){this.text=e,this.image=n,this.scale=s,this.fontStack=l,this.textColor=h}}class _i{constructor(e){this.sections=e}static fromString(e){return new _i([new Qi(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof _i?e:_i.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Rn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Rn)return e;if(typeof e=="number")return new Rn([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Rn(e)}}toString(){return JSON.stringify(this.values)}}const kc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class tn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof tn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const s=e[n],l=e[n+1];if(typeof s!="string"||!kc.has(s)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new tn(e)}}toString(){return JSON.stringify(this.values)}}class Hn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Hn({name:e,available:!1}):null}}function gl(i,e,n,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,n,s]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fo(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof pt||i instanceof Ai||i instanceof _i||i instanceof Rn||i instanceof tn||i instanceof Hn)return!0;if(Array.isArray(i)){for(const e of i)if(!fo(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!fo(i[e]))return!1;return!0}return!1}function yi(i){if(i===null)return Dn;if(typeof i=="string")return dt;if(typeof i=="boolean")return gt;if(typeof i=="number")return Be;if(i instanceof pt)return Di;if(i instanceof Ai)return xn;if(i instanceof _i)return Vi;if(i instanceof Rn)return Ki;if(i instanceof tn)return sr;if(i instanceof Hn)return Ji;if(Array.isArray(i)){const e=i.length;let n;for(const s of i){const l=yi(s);if(n){if(n===l)continue;n=at;break}n=l}return gi(n||at,e)}return Li}function $r(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof pt||i instanceof _i||i instanceof Rn||i instanceof tn||i instanceof Hn?i.toString():JSON.stringify(i)}class Qr{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!fo(e[1]))return n.error("invalid value");const s=e[1];let l=yi(s);const h=n.expectedType;return l.kind!=="array"||l.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(l=h),new Qr(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class xi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const mo={string:dt,number:Be,boolean:gt,object:Li};class nn{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,l=1;const h=e[0];if(h==="array"){let m,x;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in mo)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);m=mo[w],l++}else m=at;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=e[2],l++}s=gi(m,x)}else{if(!mo[h])throw new Error(`Types doesn't contain name = ${h}`);s=mo[h]}const d=[];for(;l<e.length;l++){const m=n.parse(e[l],l,at);if(!m)return null;d.push(m)}return new nn(s,d)}evaluate(e){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(e);if(!vn(this.type,yi(s)))return s;if(n===this.args.length-1)throw new xi(`Expected value to be of type ${Ut(this.type)}, but found ${Ut(yi(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const go={"to-boolean":gt,"to-color":Di,"to-number":Be,"to-string":dt};class xr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[0];if(!go[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return n.error("Expected one argument.");const l=go[s],h=[];for(let d=1;d<e.length;d++){const m=n.parse(e[d],d,at);if(!m)return null;h.push(m)}return new xr(l,h)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,s;for(const l of this.args){if(n=l.evaluate(e),s=null,n instanceof pt)return n;if(typeof n=="string"){const h=e.parseColor(n);if(h)return h}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:gl(n[0],n[1],n[2],n[3]),!s))return new pt(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new xi(s||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const s of this.args){n=s.evaluate(e);const l=Rn.parse(n);if(l)return l}throw new xi(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const s of this.args){n=s.evaluate(e);const l=tn.parse(n);if(l)return l}throw new xi(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const s of this.args){if(n=s.evaluate(e),n===null)return 0;const l=Number(n);if(!isNaN(l))return l}throw new xi(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return _i.fromString($r(this.args[0].evaluate(e)));case"resolvedImage":return Hn.fromString($r(this.args[0].evaluate(e)));default:return $r(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ns=["Unknown","Point","LineString","Polygon"];class $t{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ns[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=pt.parse(e)),n}}class _o{constructor(e,n,s=[],l,h=new zi,d=[]){this.registry=e,this.path=s,this.key=s.map(m=>`[${m}]`).join(""),this.scope=h,this.errors=d,this.expectedType=l,this._isConstant=n}parse(e,n,s,l,h={}){return n?this.concat(n,s,l)._parse(e,h):this._parse(e,h)}_parse(e,n){function s(l,h,d){return d==="assert"?new nn(h,[l]):d==="coerce"?new xr(h,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[l];if(h){let d=h.parse(e,this);if(!d)return null;if(this.expectedType){const m=this.expectedType,x=d.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||x.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(m.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(m.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(m,x))return null}else d=s(d,m,n.typeAnnotation||"coerce");else d=s(d,m,n.typeAnnotation||"coerce");else d=s(d,m,n.typeAnnotation||"coerce");else d=s(d,m,n.typeAnnotation||"assert")}if(!(d instanceof Qr)&&d.type.kind!=="resolvedImage"&&this._isConstant(d)){const m=new $t;try{d=new Qr(d.type,d.evaluate(m))}catch(x){return this.error(x.message),null}}return d}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){const l=typeof e=="number"?this.path.concat(e):this.path,h=s?this.scope.concat(s):this.scope;return new _o(this.registry,this._isConstant,l,n||null,h,this.errors)}error(e,...n){const s=`${this.key}${n.map(l=>`[${l}]`).join("")}`;this.errors.push(new Yi(s,e))}checkSubtype(e,n){const s=vn(e,n);return s&&this.error(s),s}}class xs{constructor(e,n,s){this.type=xn,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return n.error("Collator options argument must be an object.");const l=n.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,gt);if(!l)return null;const h=n.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,gt);if(!h)return null;let d=null;return s.locale&&(d=n.parse(s.locale,1,dt),!d)?null:new xs(l,h,d)}evaluate(e){return new Ai(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Nr=8192;function yo(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function js(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function zc(i,e){const n=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(n*l*Nr),Math.round(s*l*Nr)]}function _l(i,e,n){const s=i[0]-e[0],l=i[1]-e[1],h=i[0]-n[0],d=i[1]-n[1];return s*d-h*l==0&&s*h<=0&&l*d<=0}function xo(i,e){let n=!1;for(let d=0,m=e.length;d<m;d++){const x=e[d];for(let w=0,I=x.length;w<I-1;w++){if(_l(i,x[w],x[w+1]))return!1;(l=x[w])[1]>(s=i)[1]!=(h=x[w+1])[1]>s[1]&&s[0]<(h[0]-l[0])*(s[1]-l[1])/(h[1]-l[1])+l[0]&&(n=!n)}}var s,l,h;return n}function Dc(i,e){for(let n=0;n<e.length;n++)if(xo(i,e[n]))return!0;return!1}function yl(i,e,n,s){const l=s[0]-n[0],h=s[1]-n[1],d=(i[0]-n[0])*h-l*(i[1]-n[1]),m=(e[0]-n[0])*h-l*(e[1]-n[1]);return d>0&&m<0||d<0&&m>0}function Lc(i,e,n){for(const w of n)for(let I=0;I<w.length-1;++I)if((m=[(d=w[I+1])[0]-(h=w[I])[0],d[1]-h[1]])[0]*(x=[(l=e)[0]-(s=i)[0],l[1]-s[1]])[1]-m[1]*x[0]!=0&&yl(s,l,h,d)&&yl(h,d,s,l))return!0;var s,l,h,d,m,x;return!1}function xl(i,e){for(let n=0;n<i.length;++n)if(!xo(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(Lc(i[n],i[n+1],e))return!1;return!0}function vl(i,e){for(let n=0;n<e.length;n++)if(xl(i,e[n]))return!0;return!1}function vo(i,e,n){const s=[];for(let l=0;l<i.length;l++){const h=[];for(let d=0;d<i[l].length;d++){const m=zc(i[l][d],n);yo(e,m),h.push(m)}s.push(h)}return s}function bl(i,e,n){const s=[];for(let l=0;l<i.length;l++){const h=vo(i[l],e,n);s.push(h)}return s}function wl(i,e,n,s){if(i[0]<n[0]||i[0]>n[2]){const l=.5*s;let h=i[0]-n[0]>l?-s:n[0]-i[0]>l?s:0;h===0&&(h=i[0]-n[2]>l?-s:n[2]-i[0]>l?s:0),i[0]+=h}yo(e,i)}function bo(i,e,n,s){const l=Math.pow(2,s.z)*Nr,h=[s.x*Nr,s.y*Nr],d=[];for(const m of i)for(const x of m){const w=[x.x+h[0],x.y+h[1]];wl(w,e,n,l),d.push(w)}return d}function Tl(i,e,n,s){const l=Math.pow(2,s.z)*Nr,h=[s.x*Nr,s.y*Nr],d=[];for(const x of i){const w=[];for(const I of x){const C=[I.x+h[0],I.y+h[1]];yo(e,C),w.push(C)}d.push(w)}if(e[2]-e[0]<=l/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const x of d)for(const w of x)wl(w,e,n,l)}var m;return d}class es{constructor(e,n){this.type=gt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(fo(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let l=0;l<s.features.length;++l){const h=s.features[l].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new es(s,s.features[l].geometry)}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new es(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new es(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,s){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],d=n.canonicalID();if(s.type==="Polygon"){const m=vo(s.coordinates,h,d),x=bo(n.geometry(),l,h,d);if(!js(l,h))return!1;for(const w of x)if(!xo(w,m))return!1}if(s.type==="MultiPolygon"){const m=bl(s.coordinates,h,d),x=bo(n.geometry(),l,h,d);if(!js(l,h))return!1;for(const w of x)if(!Dc(w,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,s){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],d=n.canonicalID();if(s.type==="Polygon"){const m=vo(s.coordinates,h,d),x=Tl(n.geometry(),l,h,d);if(!js(l,h))return!1;for(const w of x)if(!xl(w,m))return!1}if(s.type==="MultiPolygon"){const m=bl(s.coordinates,h,d),x=Tl(n.geometry(),l,h,d);if(!js(l,h))return!1;for(const w of x)if(!vl(w,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class wo{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const s=e[1];return n.scope.has(s)?new wo(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Bn{constructor(e,n,s,l){this.name=e,this.type=n,this._evaluate=s,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const s=e[0],l=Bn.definitions[s];if(!l)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(l)?l[0]:l.type,d=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,m=d.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let x=null;for(const[w,I]of m){x=new _o(n.registry,qs,n.path,null,n.scope);const C=[];let L=!1;for(let F=1;F<e.length;F++){const U=e[F],Z=Array.isArray(w)?w[F-1]:w.type,Y=x.parse(U,1+C.length,Z);if(!Y){L=!0;break}C.push(Y)}if(!L)if(Array.isArray(w)&&w.length!==C.length)x.error(`Expected ${w.length} arguments, but found ${C.length} instead.`);else{for(let F=0;F<C.length;F++){const U=Array.isArray(w)?w[F]:w.type,Z=C[F];x.concat(F+1).checkSubtype(U,Z.type)}if(x.errors.length===0)return new Bn(s,h,I,C)}}if(m.length===1)n.errors.push(...x.errors);else{const w=(m.length?m:d).map(([C])=>{return L=C,Array.isArray(L)?`(${L.map(Ut).join(", ")})`:`(${Ut(L.type)}...)`;var L}).join(" | "),I=[];for(let C=1;C<e.length;C++){const L=n.parse(e[C],1+I.length);if(!L)return null;I.push(Ut(L.type))}n.error(`Expected arguments of type ${w}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){Bn.definitions=n;for(const s in n)e[s]=Bn}}function qs(i){if(i instanceof wo)return qs(i.boundExpression);if(i instanceof Bn&&i.name==="error"||i instanceof xs||i instanceof es)return!1;const e=i instanceof xr||i instanceof nn;let n=!0;return i.eachChild(s=>{n=e?n&&qs(s):n&&s instanceof Qr}),!!n&&To(i)&&Gs(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function To(i){if(i instanceof Bn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof es)return!1;let e=!0;return i.eachChild(n=>{e&&!To(n)&&(e=!1)}),e}function Zs(i){if(i instanceof Bn&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!Zs(n)&&(e=!1)}),e}function Gs(i,e){if(i instanceof Bn&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(s=>{n&&!Gs(s,e)&&(n=!1)}),n}function Ws(i,e){const n=i.length-1;let s,l,h=0,d=n,m=0;for(;h<=d;)if(m=Math.floor((h+d)/2),s=i[m],l=i[m+1],s<=e){if(m===n||e<l)return m;h=m+1}else{if(!(s>e))throw new xi("Input is not a number.");d=m-1}return 0}class Hs{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[l,h]of s)this.labels.push(l),this.outputs.push(h)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(e[1],1,Be);if(!s)return null;const l=[];let h=null;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);for(let d=1;d<e.length;d+=2){const m=d===1?-1/0:e[d],x=e[d+1],w=d,I=d+1;if(typeof m!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(l.length&&l[l.length-1][0]>=m)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const C=n.parse(x,I,h);if(!C)return null;h=h||C.type,l.push([m,C])}return new Hs(h,s,l)}evaluate(e){const n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=n[0])return s[0].evaluate(e);const h=n.length;return l>=n[h-1]?s[h-1].evaluate(e):s[Ws(n,l)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ts(i,e,n){return i+n*(e-i)}function So(i,e,n){return i.map((s,l)=>ts(s,e[l],n))}const Fn={number:ts,color:function(i,e,n,s="rgb"){switch(s){case"rgb":{const[l,h,d,m]=So(i.rgb,e.rgb,n);return new pt(l,h,d,m,!1)}case"hcl":{const[l,h,d,m]=i.hcl,[x,w,I,C]=e.hcl;let L,F;if(isNaN(l)||isNaN(x))isNaN(l)?isNaN(x)?L=NaN:(L=x,d!==1&&d!==0||(F=w)):(L=l,I!==1&&I!==0||(F=h));else{let oe=x-l;x>l&&oe>180?oe-=360:x<l&&l-x>180&&(oe+=360),L=l+n*oe}const[U,Z,Y,Q]=function([oe,ie,le,he]){return oe=isNaN(oe)?0:oe*ae,Je([le,Math.cos(oe)*ie,Math.sin(oe)*ie,he])}([L,F??ts(h,w,n),ts(d,I,n),ts(m,C,n)]);return new pt(U,Z,Y,Q,!1)}case"lab":{const[l,h,d,m]=Je(So(i.lab,e.lab,n));return new pt(l,h,d,m,!1)}}},array:So,padding:function(i,e,n){return new Rn(So(i.values,e.values,n))},variableAnchorOffsetCollection:function(i,e,n){const s=i.values,l=e.values;if(s.length!==l.length)throw new xi(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const h=[];for(let d=0;d<s.length;d+=2){if(s[d]!==l[d])throw new xi(`Cannot interpolate values containing mismatched anchors. from[${d}]: ${s[d]}, to[${d}]: ${l[d]}`);h.push(s[d]);const[m,x]=s[d+1],[w,I]=l[d+1];h.push([ts(m,w,n),ts(x,I,n)])}return new tn(h)}};class On{constructor(e,n,s,l,h){this.type=e,this.operator=n,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[d,m]of h)this.labels.push(d),this.outputs.push(m)}static interpolationFactor(e,n,s,l){let h=0;if(e.name==="exponential")h=da(n,e.base,s,l);else if(e.name==="linear")h=da(n,1,s,l);else if(e.name==="cubic-bezier"){const d=e.controlPoints;h=new xe(d[0],d[1],d[2],d[3]).solve(da(n,1,s,l))}return h}static parse(e,n){let[s,l,h,...d]=e;if(!Array.isArray(l)||l.length===0)return n.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const w=l[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:w}}else{if(l[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const w=l.slice(1);if(w.length!==4||w.some(I=>typeof I!="number"||I<0||I>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(h=n.parse(h,2,Be),!h)return null;const m=[];let x=null;s==="interpolate-hcl"||s==="interpolate-lab"?x=Di:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let w=0;w<d.length;w+=2){const I=d[w],C=d[w+1],L=w+3,F=w+4;if(typeof I!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(m.length&&m[m.length-1][0]>=I)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const U=n.parse(C,F,x);if(!U)return null;x=x||U.type,m.push([I,U])}return R(x,Be)||R(x,Di)||R(x,Ki)||R(x,sr)||R(x,gi(Be))?new On(x,s,l,h,m):n.error(`Type ${Ut(x)} is not interpolatable.`)}evaluate(e){const n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=n[0])return s[0].evaluate(e);const h=n.length;if(l>=n[h-1])return s[h-1].evaluate(e);const d=Ws(n,l),m=On.interpolationFactor(this.interpolation,l,n[d],n[d+1]),x=s[d].evaluate(e),w=s[d+1].evaluate(e);switch(this.operator){case"interpolate":return Fn[this.type.kind](x,w,m);case"interpolate-hcl":return Fn.color(x,w,m,"hcl");case"interpolate-lab":return Fn.color(x,w,m,"lab")}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function da(i,e,n,s){const l=s-n,h=i-n;return l===0?0:e===1?h/l:(Math.pow(e,h)-1)/(Math.pow(e,l)-1)}class Eo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null;const l=n.expectedType;l&&l.kind!=="value"&&(s=l);const h=[];for(const m of e.slice(1)){const x=n.parse(m,1+h.length,s,void 0,{typeAnnotation:"omit"});if(!x)return null;s=s||x.type,h.push(x)}if(!s)throw new Error("No output type");const d=l&&h.some(m=>vn(l,m.type));return new Eo(d?at:s,h)}evaluate(e){let n,s=null,l=0;for(const h of this.args)if(l++,s=h.evaluate(e),s&&s instanceof Hn&&!s.available&&(n||(n=s.name),s=null,l===this.args.length&&(s=n)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class vs{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let h=1;h<e.length-1;h+=2){const d=e[h];if(typeof d!="string")return n.error(`Expected string, but found ${typeof d} instead.`,h);if(/[^a-zA-Z0-9_]/.test(d))return n.error("Variable names must contain only alphanumeric characters or '_'.",h);const m=n.parse(e[h+1],h+1);if(!m)return null;s.push([d,m])}const l=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return l?new vs(s,l):null}outputDefined(){return this.result.outputDefined()}}class bs{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Be),l=n.parse(e[2],2,gi(n.expectedType||at));return s&&l?new bs(l.type.itemType,s,l):null}evaluate(e){const n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new xi(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new xi(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new xi(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class zt{constructor(e,n){this.type=gt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,at),l=n.parse(e[2],2,at);return s&&l?G(s.type,[gt,dt,Be,Dn,at])?new zt(s,l):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ut(s.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!P(n,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${Ut(yi(n))} instead.`);if(!P(s,["string","array"]))throw new xi(`Expected second argument to be of type array or string, but found ${Ut(yi(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Ao{constructor(e,n,s){this.type=Be,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,at),l=n.parse(e[2],2,at);if(!s||!l)return null;if(!G(s.type,[gt,dt,Be,Dn,at]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ut(s.type)} instead`);if(e.length===4){const h=n.parse(e[3],3,Be);return h?new Ao(s,l,h):null}return new Ao(s,l)}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!P(n,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${Ut(yi(n))} instead.`);if(!P(s,["string","array"]))throw new xi(`Expected second argument to be of type array or string, but found ${Ut(yi(s))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return s.indexOf(n,l)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class fa{constructor(e,n,s,l,h,d){this.inputType=e,this.type=n,this.input=s,this.cases=l,this.outputs=h,this.otherwise=d}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const h={},d=[];for(let w=2;w<e.length-1;w+=2){let I=e[w];const C=e[w+1];Array.isArray(I)||(I=[I]);const L=n.concat(w);if(I.length===0)return L.error("Expected at least one branch label.");for(const U of I){if(typeof U!="number"&&typeof U!="string")return L.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return L.error("Numeric branch labels must be integer values.");if(s){if(L.checkSubtype(s,yi(U)))return null}else s=yi(U);if(h[String(U)]!==void 0)return L.error("Branch labels must be unique.");h[String(U)]=d.length}const F=n.parse(C,w,l);if(!F)return null;l=l||F.type,d.push(F)}const m=n.parse(e[1],1,at);if(!m)return null;const x=n.parse(e[e.length-1],e.length-1,l);return x?m.type.kind!=="value"&&n.concat(1).checkSubtype(s,m.type)?null:new fa(s,l,m,h,d,x):null}evaluate(e){const n=this.input.evaluate(e);return(yi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class ma{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&n.expectedType.kind!=="value"&&(s=n.expectedType);const l=[];for(let d=1;d<e.length-1;d+=2){const m=n.parse(e[d],d,gt);if(!m)return null;const x=n.parse(e[d+1],d+1,s);if(!x)return null;l.push([m,x]),s=s||x.type}const h=n.parse(e[e.length-1],e.length-1,s);if(!h)return null;if(!s)throw new Error("Can't infer output type");return new ma(s,l,h)}evaluate(e){for(const[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Io{constructor(e,n,s,l){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,at),l=n.parse(e[2],2,Be);if(!s||!l)return null;if(!G(s.type,[gi(at),dt,at]))return n.error(`Expected first argument to be of type array or string, but found ${Ut(s.type)} instead`);if(e.length===4){const h=n.parse(e[3],3,Be);return h?new Io(s.type,s,l,h):null}return new Io(s.type,s,l)}evaluate(e){const n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!P(n,["string","array"]))throw new xi(`Expected first argument to be of type array or string, but found ${Ut(yi(n))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return n.slice(s,l)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Sl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function El(i,e,n,s){return s.compare(e,n)===0}function ws(i,e,n){const s=i!=="=="&&i!=="!=";return class _d{constructor(h,d,m){this.type=gt,this.lhs=h,this.rhs=d,this.collator=m,this.hasUntypedArgument=h.type.kind==="value"||d.type.kind==="value"}static parse(h,d){if(h.length!==3&&h.length!==4)return d.error("Expected two or three arguments.");const m=h[0];let x=d.parse(h[1],1,at);if(!x)return null;if(!Sl(m,x.type))return d.concat(1).error(`"${m}" comparisons are not supported for type '${Ut(x.type)}'.`);let w=d.parse(h[2],2,at);if(!w)return null;if(!Sl(m,w.type))return d.concat(2).error(`"${m}" comparisons are not supported for type '${Ut(w.type)}'.`);if(x.type.kind!==w.type.kind&&x.type.kind!=="value"&&w.type.kind!=="value")return d.error(`Cannot compare types '${Ut(x.type)}' and '${Ut(w.type)}'.`);s&&(x.type.kind==="value"&&w.type.kind!=="value"?x=new nn(w.type,[x]):x.type.kind!=="value"&&w.type.kind==="value"&&(w=new nn(x.type,[w])));let I=null;if(h.length===4){if(x.type.kind!=="string"&&w.type.kind!=="string"&&x.type.kind!=="value"&&w.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(I=d.parse(h[3],3,xn),!I)return null}return new _d(x,w,I)}evaluate(h){const d=this.lhs.evaluate(h),m=this.rhs.evaluate(h);if(s&&this.hasUntypedArgument){const x=yi(d),w=yi(m);if(x.kind!==w.kind||x.kind!=="string"&&x.kind!=="number")throw new xi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${x.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const x=yi(d),w=yi(m);if(x.kind!=="string"||w.kind!=="string")return e(h,d,m)}return this.collator?n(h,d,m,this.collator.evaluate(h)):e(h,d,m)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}}}const Rc=ws("==",function(i,e,n){return e===n},El),Bc=ws("!=",function(i,e,n){return e!==n},function(i,e,n,s){return!El(0,e,n,s)}),Fc=ws("<",function(i,e,n){return e<n},function(i,e,n,s){return s.compare(e,n)<0}),Oc=ws(">",function(i,e,n){return e>n},function(i,e,n,s){return s.compare(e,n)>0}),Uc=ws("<=",function(i,e,n){return e<=n},function(i,e,n,s){return s.compare(e,n)<=0}),Vc=ws(">=",function(i,e,n){return e>=n},function(i,e,n,s){return s.compare(e,n)>=0});class ga{constructor(e,n,s,l,h){this.type=dt,this.number=e,this.locale=n,this.currency=s,this.minFractionDigits=l,this.maxFractionDigits=h}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const s=n.parse(e[1],1,Be);if(!s)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return n.error("NumberFormat options argument must be an object.");let h=null;if(l.locale&&(h=n.parse(l.locale,1,dt),!h))return null;let d=null;if(l.currency&&(d=n.parse(l.currency,1,dt),!d))return null;let m=null;if(l["min-fraction-digits"]&&(m=n.parse(l["min-fraction-digits"],1,Be),!m))return null;let x=null;return l["max-fraction-digits"]&&(x=n.parse(l["max-fraction-digits"],1,Be),!x)?null:new ga(s,h,d,m,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Mo{constructor(e){this.type=Vi,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return n.error("First argument must be an image or text section.");const l=[];let h=!1;for(let d=1;d<=e.length-1;++d){const m=e[d];if(h&&typeof m=="object"&&!Array.isArray(m)){h=!1;let x=null;if(m["font-scale"]&&(x=n.parse(m["font-scale"],1,Be),!x))return null;let w=null;if(m["text-font"]&&(w=n.parse(m["text-font"],1,gi(dt)),!w))return null;let I=null;if(m["text-color"]&&(I=n.parse(m["text-color"],1,Di),!I))return null;const C=l[l.length-1];C.scale=x,C.font=w,C.textColor=I}else{const x=n.parse(e[d],1,at);if(!x)return null;const w=x.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,l.push({content:x,scale:null,font:null,textColor:null})}}return new Mo(l)}evaluate(e){return new _i(this.sections.map(n=>{const s=n.content.evaluate(e);return yi(s)===Ji?new Qi("",s,null,null,null):new Qi($r(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}}class _a{constructor(e){this.type=Ji,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const s=n.parse(e[1],1,dt);return s?new _a(s):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),s=Hn.fromString(n);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(n)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class ya{constructor(e){this.type=Be,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=n.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Ut(s.type)} instead.`):new ya(s):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new xi(`Expected value to be of type string or array, but found ${Ut(yi(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ts={"==":Rc,"!=":Bc,">":Oc,"<":Fc,">=":Vc,"<=":Uc,array:nn,at:bs,boolean:nn,case:ma,coalesce:Eo,collator:xs,format:Mo,image:_a,in:zt,"index-of":Ao,interpolate:On,"interpolate-hcl":On,"interpolate-lab":On,length:ya,let:vs,literal:Qr,match:fa,number:nn,"number-format":ga,object:nn,slice:Io,step:Hs,string:nn,"to-boolean":xr,"to-color":xr,"to-number":xr,"to-string":xr,var:wo,within:es};function Al(i,[e,n,s,l]){e=e.evaluate(i),n=n.evaluate(i),s=s.evaluate(i);const h=l?l.evaluate(i):1,d=gl(e,n,s,h);if(d)throw new xi(d);return new pt(e/255,n/255,s/255,h,!1)}function Il(i,e){return i in e}function xa(i,e){const n=e[i];return n===void 0?null:n}function is(i){return{type:i}}function Ml(i){return{result:"success",value:i}}function Ss(i){return{result:"error",value:i}}function Es(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Cl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function va(i){return!!i.expression&&i.expression.interpolated}function Ot(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Co(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function $c(i){return i}function Pl(i,e){const n=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",l=s||!(s||i.property!==void 0),h=i.type||(va(e)?"exponential":"interval");if(n||e.type==="padding"){const I=n?pt.parse:Rn.parse;(i=ki({},i)).stops&&(i.stops=i.stops.map(C=>[C[0],I(C[1])])),i.default=I(i.default?i.default:e.default)}if(i.colorSpace&&(d=i.colorSpace)!=="rgb"&&d!=="hcl"&&d!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var d;let m,x,w;if(h==="exponential")m=kl;else if(h==="interval")m=jc;else if(h==="categorical"){m=Nc,x=Object.create(null);for(const I of i.stops)x[I[0]]=I[1];w=typeof i.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);m=qc}if(s){const I={},C=[];for(let U=0;U<i.stops.length;U++){const Z=i.stops[U],Y=Z[0].zoom;I[Y]===void 0&&(I[Y]={zoom:Y,type:i.type,property:i.property,default:i.default,stops:[]},C.push(Y)),I[Y].stops.push([Z[0].value,Z[1]])}const L=[];for(const U of C)L.push([I[U].zoom,Pl(I[U],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:On.interpolationFactor.bind(void 0,F),zoomStops:L.map(U=>U[0]),evaluate:({zoom:U},Z)=>kl({stops:L,base:i.base},e,U).evaluate(U,Z)}}if(l){const I=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:On.interpolationFactor.bind(void 0,I),zoomStops:i.stops.map(C=>C[0]),evaluate:({zoom:C})=>m(i,e,C,x,w)}}return{kind:"source",evaluate(I,C){const L=C&&C.properties?C.properties[i.property]:void 0;return L===void 0?ns(i.default,e.default):m(i,e,L,x,w)}}}function ns(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function Nc(i,e,n,s,l){return ns(typeof n===l?s[n]:void 0,i.default,e.default)}function jc(i,e,n){if(Ot(n)!=="number")return ns(i.default,e.default);const s=i.stops.length;if(s===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[s-1][0])return i.stops[s-1][1];const l=Ws(i.stops.map(h=>h[0]),n);return i.stops[l][1]}function kl(i,e,n){const s=i.base!==void 0?i.base:1;if(Ot(n)!=="number")return ns(i.default,e.default);const l=i.stops.length;if(l===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[l-1][0])return i.stops[l-1][1];const h=Ws(i.stops.map(I=>I[0]),n),d=function(I,C,L,F){const U=F-L,Z=I-L;return U===0?0:C===1?Z/U:(Math.pow(C,Z)-1)/(Math.pow(C,U)-1)}(n,s,i.stops[h][0],i.stops[h+1][0]),m=i.stops[h][1],x=i.stops[h+1][1],w=Fn[e.type]||$c;return typeof m.evaluate=="function"?{evaluate(...I){const C=m.evaluate.apply(void 0,I),L=x.evaluate.apply(void 0,I);if(C!==void 0&&L!==void 0)return w(C,L,d,i.colorSpace)}}:w(m,x,d,i.colorSpace)}function qc(i,e,n){switch(e.type){case"color":n=pt.parse(n);break;case"formatted":n=_i.fromString(n.toString());break;case"resolvedImage":n=Hn.fromString(n.toString());break;case"padding":n=Rn.parse(n);break;default:Ot(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return ns(n,i.default,e.default)}Bn.register(Ts,{error:[{kind:"error"},[dt],(i,[e])=>{throw new xi(e.evaluate(i))}],typeof:[dt,[at],(i,[e])=>Ut(yi(e.evaluate(i)))],"to-rgba":[gi(Be,4),[Di],(i,[e])=>{const[n,s,l,h]=e.evaluate(i).rgb;return[255*n,255*s,255*l,h]}],rgb:[Di,[Be,Be,Be],Al],rgba:[Di,[Be,Be,Be,Be],Al],has:{type:gt,overloads:[[[dt],(i,[e])=>Il(e.evaluate(i),i.properties())],[[dt,Li],(i,[e,n])=>Il(e.evaluate(i),n.evaluate(i))]]},get:{type:at,overloads:[[[dt],(i,[e])=>xa(e.evaluate(i),i.properties())],[[dt,Li],(i,[e,n])=>xa(e.evaluate(i),n.evaluate(i))]]},"feature-state":[at,[dt],(i,[e])=>xa(e.evaluate(i),i.featureState||{})],properties:[Li,[],i=>i.properties()],"geometry-type":[dt,[],i=>i.geometryType()],id:[at,[],i=>i.id()],zoom:[Be,[],i=>i.globals.zoom],"heatmap-density":[Be,[],i=>i.globals.heatmapDensity||0],"line-progress":[Be,[],i=>i.globals.lineProgress||0],accumulated:[at,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Be,is(Be),(i,e)=>{let n=0;for(const s of e)n+=s.evaluate(i);return n}],"*":[Be,is(Be),(i,e)=>{let n=1;for(const s of e)n*=s.evaluate(i);return n}],"-":{type:Be,overloads:[[[Be,Be],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[Be],(i,[e])=>-e.evaluate(i)]]},"/":[Be,[Be,Be],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[Be,[Be,Be],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[Be,[],()=>Math.LN2],pi:[Be,[],()=>Math.PI],e:[Be,[],()=>Math.E],"^":[Be,[Be,Be],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[Be,[Be],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Be,[Be],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Be,[Be],(i,[e])=>Math.log(e.evaluate(i))],log2:[Be,[Be],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Be,[Be],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Be,[Be],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Be,[Be],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Be,[Be],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Be,[Be],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Be,[Be],(i,[e])=>Math.atan(e.evaluate(i))],min:[Be,is(Be),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[Be,is(Be),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[Be,[Be],(i,[e])=>Math.abs(e.evaluate(i))],round:[Be,[Be],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Be,[Be],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Be,[Be],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[gt,[dt,at],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[gt,[at],(i,[e])=>i.id()===e.value],"filter-type-==":[gt,[dt],(i,[e])=>i.geometryType()===e.value],"filter-<":[gt,[dt,at],(i,[e,n])=>{const s=i.properties()[e.value],l=n.value;return typeof s==typeof l&&s<l}],"filter-id-<":[gt,[at],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[gt,[dt,at],(i,[e,n])=>{const s=i.properties()[e.value],l=n.value;return typeof s==typeof l&&s>l}],"filter-id->":[gt,[at],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[gt,[dt,at],(i,[e,n])=>{const s=i.properties()[e.value],l=n.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[gt,[at],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[gt,[dt,at],(i,[e,n])=>{const s=i.properties()[e.value],l=n.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[gt,[at],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[gt,[at],(i,[e])=>e.value in i.properties()],"filter-has-id":[gt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[gt,[gi(dt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[gt,[gi(at)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[gt,[dt,gi(at)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[gt,[dt,gi(at)],(i,[e,n])=>function(s,l,h,d){for(;h<=d;){const m=h+d>>1;if(l[m]===s)return!0;l[m]>s?d=m-1:h=m+1}return!1}(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:gt,overloads:[[[gt,gt],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[is(gt),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:gt,overloads:[[[gt,gt],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[is(gt),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[gt,[gt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[gt,[dt],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[dt,[dt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[dt,[dt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[dt,is(at),(i,e)=>e.map(n=>$r(n.evaluate(i))).join("")],"resolved-locale":[dt,[xn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class ii{constructor(e,n){var s;this.expression=e,this._warningHistory={},this._evaluator=new $t,this._defaultValue=n?(s=n).type==="color"&&Co(s.default)?new pt(0,0,0,0):s.type==="color"?pt.parse(s.default)||null:s.type==="padding"?Rn.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?tn.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,s,l,h,d){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=d,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,l,h,d){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=d||null;try{const m=this.expression.evaluate(this._evaluator);if(m==null||typeof m=="number"&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new xi(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function Po(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ts}function Et(i,e){const n=new _o(Ts,qs,[],e?function(l){const h={color:Di,string:dt,number:Be,enum:dt,boolean:gt,formatted:Vi,padding:Ki,resolvedImage:Ji,variableAnchorOffsetCollection:sr};return l.type==="array"?gi(h[l.value]||at,l.length):h[l.type]}(e):void 0),s=n.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?Ml(new ii(s,e)):Ss(n.errors)}class Xs{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Zs(n.expression)}evaluateWithoutErrorHandling(e,n,s,l,h,d){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,l,h,d)}evaluate(e,n,s,l,h,d){return this._styleExpression.evaluate(e,n,s,l,h,d)}}class Yt{constructor(e,n,s,l){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Zs(n.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,n,s,l,h,d){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,l,h,d)}evaluate(e,n,s,l,h,d){return this._styleExpression.evaluate(e,n,s,l,h,d)}interpolationFactor(e,n,s){return this.interpolationType?On.interpolationFactor(this.interpolationType,e,n,s):0}}function Kt(i,e){const n=Et(i,e);if(n.result==="error")return n;const s=n.value.expression,l=To(s);if(!l&&!Es(e))return Ss([new Yi("","data expressions not supported")]);const h=Gs(s,["zoom"]);if(!h&&!Cl(e))return Ss([new Yi("","zoom expressions not supported")]);const d=Ys(s);return d||h?d instanceof Yi?Ss([d]):d instanceof On&&!va(e)?Ss([new Yi("",'"interpolate" expressions cannot be used with this property')]):Ml(d?new Yt(l?"camera":"composite",n.value,d.labels,d instanceof On?d.interpolation:void 0):new Xs(l?"constant":"source",n.value)):Ss([new Yi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class rs{constructor(e,n){this._parameters=e,this._specification=n,ki(this,Pl(this._parameters,this._specification))}static deserialize(e){return new rs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ys(i){let e=null;if(i instanceof vs)e=Ys(i.result);else if(i instanceof Eo){for(const n of i.args)if(e=Ys(n),e)break}else(i instanceof Hs||i instanceof On)&&i.input instanceof Bn&&i.input.name==="zoom"&&(e=i);return e instanceof Yi||i.eachChild(n=>{const s=Ys(n);s instanceof Yi?e=s:!e&&s?e=new Yi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Yi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function ba(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ba(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Zc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function wa(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ba(i)||(i=Ks(i));const e=Et(i,Zc);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,s,l)=>e.value.evaluate(n,s,{},l),needGeometry:Ta(i)}}function Gc(i,e){return i<e?-1:i>e?1:0}function Ta(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Ta(i[e]))return!0;return!1}function Ks(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ko(i[1],i[2],"=="):e==="!="?Do(ko(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ko(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(Ks))):e==="all"?["all"].concat(i.slice(1).map(Ks)):e==="none"?["all"].concat(i.slice(1).map(Ks).map(Do)):e==="in"?Sa(i[1],i.slice(2)):e==="!in"?Do(Sa(i[1],i.slice(2))):e==="has"?zo(i[1]):e==="!has"?Do(zo(i[1])):e!=="within"||i;var n}function ko(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function Sa(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Gc)]]:["filter-in-small",i,["literal",e]]}}function zo(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Do(i){return["!",i]}function Ea(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let l="[";for(const h of i)l+=`${Ea(h)},`;return`${l}]`}const n=Object.keys(i).sort();let s="{";for(let l=0;l<n.length;l++)s+=`${JSON.stringify(n[l])}:${Ea(i[n[l]])},`;return`${s}}`}function Wc(i){let e="";for(const n of zn)e+=`/${Ea(i[n])}`;return e}function zl(i){const e=i.value;return e?[new ze(i.key,e,"constants have been deprecated as of v8")]:[]}function vi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function ss(i){if(Array.isArray(i))return i.map(ss);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=ss(i[n]);return e}return vi(i)}function Xn(i){const e=i.key,n=i.value,s=i.valueSpec||{},l=i.objectElementValidators||{},h=i.style,d=i.styleSpec,m=i.validateSpec;let x=[];const w=Ot(n);if(w!=="object")return[new ze(e,n,`object expected, ${w} found`)];for(const I in n){const C=I.split(".")[0],L=s[C]||s["*"];let F;if(l[C])F=l[C];else if(s[C])F=m;else if(l["*"])F=l["*"];else{if(!s["*"]){x.push(new ze(e,n[I],`unknown property "${I}"`));continue}F=m}x=x.concat(F({key:(e&&`${e}.`)+I,value:n[I],valueSpec:L,style:h,styleSpec:d,object:n,objectKey:I,validateSpec:m},n))}for(const I in s)l[I]||s[I].required&&s[I].default===void 0&&n[I]===void 0&&x.push(new ze(e,n,`missing required property "${I}"`));return x}function Aa(i){const e=i.value,n=i.valueSpec,s=i.style,l=i.styleSpec,h=i.key,d=i.arrayElementValidator||i.validateSpec;if(Ot(e)!=="array")return[new ze(h,e,`array expected, ${Ot(e)} found`)];if(n.length&&e.length!==n.length)return[new ze(h,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new ze(h,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let m={type:n.value,values:n.values};l.$version<7&&(m.function=n.function),Ot(n.value)==="object"&&(m=n.value);let x=[];for(let w=0;w<e.length;w++)x=x.concat(d({array:e,arrayIndex:w,value:e[w],valueSpec:m,validateSpec:i.validateSpec,style:s,styleSpec:l,key:`${h}[${w}]`}));return x}function Lo(i){const e=i.key,n=i.value,s=i.valueSpec;let l=Ot(n);return l==="number"&&n!=n&&(l="NaN"),l!=="number"?[new ze(e,n,`number expected, ${l} found`)]:"minimum"in s&&n<s.minimum?[new ze(e,n,`${n} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&n>s.maximum?[new ze(e,n,`${n} is greater than the maximum value ${s.maximum}`)]:[]}function Ia(i){const e=i.valueSpec,n=vi(i.value.type);let s,l,h,d={};const m=n!=="categorical"&&i.value.property===void 0,x=!m,w=Ot(i.value.stops)==="array"&&Ot(i.value.stops[0])==="array"&&Ot(i.value.stops[0][0])==="object",I=Xn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(n==="identity")return[new ze(F.key,F.value,'identity function may not have a "stops" property')];let U=[];const Z=F.value;return U=U.concat(Aa({key:F.key,value:Z,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:C})),Ot(Z)==="array"&&Z.length===0&&U.push(new ze(F.key,Z,"array must have at least one stop")),U},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return n==="identity"&&m&&I.push(new ze(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||I.push(new ze(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!va(i.valueSpec)&&I.push(new ze(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(x&&!Es(i.valueSpec)?I.push(new ze(i.key,i.value,"property functions not supported")):m&&!Cl(i.valueSpec)&&I.push(new ze(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!w||i.value.property!==void 0||I.push(new ze(i.key,i.value,'"property" property is required')),I;function C(F){let U=[];const Z=F.value,Y=F.key;if(Ot(Z)!=="array")return[new ze(Y,Z,`array expected, ${Ot(Z)} found`)];if(Z.length!==2)return[new ze(Y,Z,`array length 2 expected, length ${Z.length} found`)];if(w){if(Ot(Z[0])!=="object")return[new ze(Y,Z,`object expected, ${Ot(Z[0])} found`)];if(Z[0].zoom===void 0)return[new ze(Y,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new ze(Y,Z,"object stop key must have value")];if(h&&h>vi(Z[0].zoom))return[new ze(Y,Z[0].zoom,"stop zoom values must appear in ascending order")];vi(Z[0].zoom)!==h&&(h=vi(Z[0].zoom),l=void 0,d={}),U=U.concat(Xn({key:`${Y}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:Lo,value:L}}))}else U=U.concat(L({key:`${Y}[0]`,value:Z[0],valueSpec:{},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},Z));return Po(ss(Z[1]))?U.concat([new ze(`${Y}[1]`,Z[1],"expressions are not allowed in function stops.")]):U.concat(F.validateSpec({key:`${Y}[1]`,value:Z[1],valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function L(F,U){const Z=Ot(F.value),Y=vi(F.value),Q=F.value!==null?F.value:U;if(s){if(Z!==s)return[new ze(F.key,Q,`${Z} stop domain type must match previous stop domain type ${s}`)]}else s=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean")return[new ze(F.key,Q,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&n!=="categorical"){let oe=`number expected, ${Z} found`;return Es(e)&&n===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ze(F.key,Q,oe)]}return n!=="categorical"||Z!=="number"||isFinite(Y)&&Math.floor(Y)===Y?n!=="categorical"&&Z==="number"&&l!==void 0&&Y<l?[new ze(F.key,Q,"stop domain values must appear in ascending order")]:(l=Y,n==="categorical"&&Y in d?[new ze(F.key,Q,"stop domain values must be unique")]:(d[Y]=!0,[])):[new ze(F.key,Q,`integer expected, found ${Y}`)]}}function Ar(i){const e=(i.expressionContext==="property"?Kt:Et)(ss(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new ze(`${i.key}${s.key}`,i.value,s.message));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new ze(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Zs(n))return[new ze(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Zs(n))return[new ze(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Gs(n,["zoom","feature-state"]))return[new ze(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!To(n))return[new ze(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Js(i){const e=i.key,n=i.value,s=i.valueSpec,l=[];return Array.isArray(s.values)?s.values.indexOf(vi(n))===-1&&l.push(new ze(e,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(s.values).indexOf(vi(n))===-1&&l.push(new ze(e,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),l}function Ro(i){return ba(ss(i.value))?Ar(ki({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Dl(i)}function Dl(i){const e=i.value,n=i.key;if(Ot(e)!=="array")return[new ze(n,e,`array expected, ${Ot(e)} found`)];const s=i.styleSpec;let l,h=[];if(e.length<1)return[new ze(n,e,"filter array must have at least 1 element")];switch(h=h.concat(Js({key:`${n}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),vi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&vi(e[1])==="$type"&&h.push(new ze(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new ze(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=Ot(e[1]),l!=="string"&&h.push(new ze(`${n}[1]`,e[1],`string expected, ${l} found`)));for(let d=2;d<e.length;d++)l=Ot(e[d]),vi(e[1])==="$type"?h=h.concat(Js({key:`${n}[${d}]`,value:e[d],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&h.push(new ze(`${n}[${d}]`,e[d],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let d=1;d<e.length;d++)h=h.concat(Dl({key:`${n}[${d}]`,value:e[d],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=Ot(e[1]),e.length!==2?h.push(new ze(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&h.push(new ze(`${n}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=Ot(e[1]),e.length!==2?h.push(new ze(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&h.push(new ze(`${n}[1]`,e[1],`object expected, ${l} found`))}return h}function Bo(i,e){const n=i.key,s=i.validateSpec,l=i.style,h=i.styleSpec,d=i.value,m=i.objectKey,x=h[`${e}_${i.layerType}`];if(!x)return[];const w=m.match(/^(.*)-transition$/);if(e==="paint"&&w&&x[w[1]]&&x[w[1]].transition)return s({key:n,value:d,valueSpec:h.transition,style:l,styleSpec:h});const I=i.valueSpec||x[m];if(!I)return[new ze(n,d,`unknown property "${m}"`)];let C;if(Ot(d)==="string"&&Es(I)&&!I.tokens&&(C=/^{([^}]+)}$/.exec(d)))return[new ze(n,d,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const L=[];return i.layerType==="symbol"&&(m==="text-field"&&l&&!l.glyphs&&L.push(new ze(n,d,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&Co(ss(d))&&vi(d.type)==="identity"&&L.push(new ze(n,d,'"text-font" does not support identity functions'))),L.concat(s({key:i.key,value:d,valueSpec:I,style:l,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:m}))}function Qs(i){return Bo(i,"paint")}function Fo(i){return Bo(i,"layout")}function Oo(i){let e=[];const n=i.value,s=i.key,l=i.style,h=i.styleSpec;n.type||n.ref||e.push(new ze(s,n,'either "type" or "ref" is required'));let d=vi(n.type);const m=vi(n.ref);if(n.id){const x=vi(n.id);for(let w=0;w<i.arrayIndex;w++){const I=l.layers[w];vi(I.id)===x&&e.push(new ze(s,n.id,`duplicate layer id "${n.id}", previously used at line ${I.id.__line__}`))}}if("ref"in n){let x;["type","source","source-layer","filter","layout"].forEach(w=>{w in n&&e.push(new ze(s,n[w],`"${w}" is prohibited for ref layers`))}),l.layers.forEach(w=>{vi(w.id)===m&&(x=w)}),x?x.ref?e.push(new ze(s,n.ref,"ref cannot reference another ref layer")):d=vi(x.type):e.push(new ze(s,n.ref,`ref layer "${m}" not found`))}else if(d!=="background")if(n.source){const x=l.sources&&l.sources[n.source],w=x&&vi(x.type);x?w==="vector"&&d==="raster"?e.push(new ze(s,n.source,`layer "${n.id}" requires a raster source`)):w==="raster"&&d!=="raster"?e.push(new ze(s,n.source,`layer "${n.id}" requires a vector source`)):w!=="vector"||n["source-layer"]?w==="raster-dem"&&d!=="hillshade"?e.push(new ze(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):d!=="line"||!n.paint||!n.paint["line-gradient"]||w==="geojson"&&x.lineMetrics||e.push(new ze(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ze(s,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new ze(s,n.source,`source "${n.source}" not found`))}else e.push(new ze(s,n,'missing required property "source"'));return e=e.concat(Xn({key:s,value:n,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:n.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:Ro,layout:x=>Xn({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":w=>Fo(ki({layerType:d},w))}}),paint:x=>Xn({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":w=>Qs(ki({layerType:d},w))}})}})),e}function os(i){const e=i.value,n=i.key,s=Ot(e);return s!=="string"?[new ze(n,e,`string expected, ${s} found`)]:[]}const eo={promoteId:function({key:i,value:e}){if(Ot(e)==="string")return os({key:i,value:e});{const n=[];for(const s in e)n.push(...os({key:`${i}.${s}`,value:e[s]}));return n}}};function Ll(i){const e=i.value,n=i.key,s=i.styleSpec,l=i.style,h=i.validateSpec;if(!e.type)return[new ze(n,e,'"type" is required')];const d=vi(e.type);let m;switch(d){case"vector":case"raster":case"raster-dem":return m=Xn({key:n,value:e,valueSpec:s[`source_${d.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:eo,validateSpec:h}),m;case"geojson":if(m=Xn({key:n,value:e,valueSpec:s.source_geojson,style:l,styleSpec:s,validateSpec:h,objectElementValidators:eo}),e.cluster)for(const x in e.clusterProperties){const[w,I]=e.clusterProperties[x],C=typeof w=="string"?[w,["accumulated"],["get",x]]:w;m.push(...Ar({key:`${n}.${x}.map`,value:I,validateSpec:h,expressionContext:"cluster-map"})),m.push(...Ar({key:`${n}.${x}.reduce`,value:C,validateSpec:h,expressionContext:"cluster-reduce"}))}return m;case"video":return Xn({key:n,value:e,valueSpec:s.source_video,style:l,validateSpec:h,styleSpec:s});case"image":return Xn({key:n,value:e,valueSpec:s.source_image,style:l,validateSpec:h,styleSpec:s});case"canvas":return[new ze(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Js({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,validateSpec:h,styleSpec:s})}}function Rl(i){const e=i.value,n=i.styleSpec,s=n.light,l=i.style;let h=[];const d=Ot(e);if(e===void 0)return h;if(d!=="object")return h=h.concat([new ze("light",e,`object expected, ${d} found`)]),h;for(const m in e){const x=m.match(/^(.*)-transition$/);h=h.concat(x&&s[x[1]]&&s[x[1]].transition?i.validateSpec({key:m,value:e[m],valueSpec:n.transition,validateSpec:i.validateSpec,style:l,styleSpec:n}):s[m]?i.validateSpec({key:m,value:e[m],valueSpec:s[m],validateSpec:i.validateSpec,style:l,styleSpec:n}):[new ze(m,e[m],`unknown property "${m}"`)])}return h}function Bl(i){const e=i.value,n=i.styleSpec,s=n.terrain,l=i.style;let h=[];const d=Ot(e);if(e===void 0)return h;if(d!=="object")return h=h.concat([new ze("terrain",e,`object expected, ${d} found`)]),h;for(const m in e)h=h.concat(s[m]?i.validateSpec({key:m,value:e[m],valueSpec:s[m],validateSpec:i.validateSpec,style:l,styleSpec:n}):[new ze(m,e[m],`unknown property "${m}"`)]);return h}function Fl(i){let e=[];const n=i.value,s=i.key;if(Array.isArray(n)){const l=[],h=[];for(const d in n)n[d].id&&l.includes(n[d].id)&&e.push(new ze(s,n,`all the sprites' ids must be unique, but ${n[d].id} is duplicated`)),l.push(n[d].id),n[d].url&&h.includes(n[d].url)&&e.push(new ze(s,n,`all the sprites' URLs must be unique, but ${n[d].url} is duplicated`)),h.push(n[d].url),e=e.concat(Xn({key:`${s}[${d}]`,value:n[d],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return os({key:s,value:n})}const Ol={"*":()=>[],array:Aa,boolean:function(i){const e=i.value,n=i.key,s=Ot(e);return s!=="boolean"?[new ze(n,e,`boolean expected, ${s} found`)]:[]},number:Lo,color:function(i){const e=i.key,n=i.value,s=Ot(n);return s!=="string"?[new ze(e,n,`color expected, ${s} found`)]:pt.parse(String(n))?[]:[new ze(e,n,`color expected, "${n}" found`)]},constants:zl,enum:Js,filter:Ro,function:Ia,layer:Oo,object:Xn,source:Ll,light:Rl,terrain:Bl,string:os,formatted:function(i){return os(i).length===0?[]:Ar(i)},resolvedImage:function(i){return os(i).length===0?[]:Ar(i)},padding:function(i){const e=i.key,n=i.value;if(Ot(n)==="array"){if(n.length<1||n.length>4)return[new ze(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const s={type:"number"};let l=[];for(let h=0;h<n.length;h++)l=l.concat(i.validateSpec({key:`${e}[${h}]`,value:n[h],validateSpec:i.validateSpec,valueSpec:s}));return l}return Lo({key:e,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,n=i.value,s=Ot(n),l=i.styleSpec;if(s!=="array"||n.length<1||n.length%2!=0)return[new ze(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let h=[];for(let d=0;d<n.length;d+=2)h=h.concat(Js({key:`${e}[${d}]`,value:n[d],valueSpec:l.layout_symbol["text-anchor"]})),h=h.concat(Aa({key:`${e}[${d+1}]`,value:n[d+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:l}));return h},sprite:Fl};function jr(i){const e=i.value,n=i.valueSpec,s=i.styleSpec;return i.validateSpec=jr,n.expression&&Co(vi(e))?Ia(i):n.expression&&Po(ss(e))?Ar(i):n.type&&Ol[n.type]?Ol[n.type](i):Xn(ki({},i,{valueSpec:n.type?s[n.type]:n}))}function to(i){const e=i.value,n=i.key,s=os(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new ze(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new ze(n,e,'"glyphs" url must include a "{range}" token'))),s}function bi(i,e=ye){let n=[];return n=n.concat(jr({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:jr,objectElementValidators:{glyphs:to,"*":()=>[]}})),i.constants&&(n=n.concat(zl({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:jr}))),Ul(n)}function Yn(i){return function(e){return i({...e,validateSpec:jr})}}function Ul(i){return[].concat(i).sort((e,n)=>e.line-n.line)}function Ir(i){return function(...e){return Ul(i.apply(this,e))}}bi.source=Ir(Yn(Ll)),bi.sprite=Ir(Yn(Fl)),bi.glyphs=Ir(Yn(to)),bi.light=Ir(Yn(Rl)),bi.terrain=Ir(Yn(Bl)),bi.layer=Ir(Yn(Oo)),bi.filter=Ir(Yn(Ro)),bi.paintProperty=Ir(Yn(Qs)),bi.layoutProperty=Ir(Yn(Fo));const io=bi,no=io.light,Hc=io.paintProperty,Ma=io.layoutProperty;function Vl(i,e){let n=!1;if(e&&e.length)for(const s of e)i.fire(new hn(new Error(s.message))),n=!0;return n}class as{constructor(e,n,s){const l=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const d=new Int32Array(this.arrayBuffer);e=d[0],this.d=(n=d[1])+2*(s=d[2]);for(let x=0;x<this.d*this.d;x++){const w=d[3+x],I=d[3+x+1];l.push(w===I?null:d.subarray(w,I))}const m=d[3+l.length+1];this.keys=d.subarray(d[3+l.length],m),this.bboxes=d.subarray(m),this.insert=this._insertReadonly}else{this.d=n+2*s;for(let d=0;d<this.d*this.d;d++)l.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=s,this.scale=n/e,this.uid=0;const h=s/n*e;this.min=-h,this.max=e+h}insert(e,n,s,l,h){this._forEachCell(n,s,l,h,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(h)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,s,l,h,d){this.cells[h].push(d)}query(e,n,s,l,h){const d=this.min,m=this.max;if(e<=d&&n<=d&&m<=s&&m<=l&&!h)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(e,n,s,l,this._queryCell,x,{},h),x}}_queryCell(e,n,s,l,h,d,m,x){const w=this.cells[h];if(w!==null){const I=this.keys,C=this.bboxes;for(let L=0;L<w.length;L++){const F=w[L];if(m[F]===void 0){const U=4*F;(x?x(C[U+0],C[U+1],C[U+2],C[U+3]):e<=C[U+2]&&n<=C[U+3]&&s>=C[U+0]&&l>=C[U+1])?(m[F]=!0,d.push(I[F])):m[F]=!1}}}}_forEachCell(e,n,s,l,h,d,m,x){const w=this._convertToCellCoord(e),I=this._convertToCellCoord(n),C=this._convertToCellCoord(s),L=this._convertToCellCoord(l);for(let F=w;F<=C;F++)for(let U=I;U<=L;U++){const Z=this.d*U+F;if((!x||x(this._convertFromCellCoord(F),this._convertFromCellCoord(U),this._convertFromCellCoord(F+1),this._convertFromCellCoord(U+1)))&&h.call(this,e,n,s,l,Z,d,m,x))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let s=0;for(let d=0;d<this.cells.length;d++)s+=this.cells[d].length;const l=new Int32Array(n+s+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let h=n;for(let d=0;d<e.length;d++){const m=e[d];l[3+d]=h,l.set(m,h),h+=m.length}return l[3+e.length]=h,l.set(this.keys,h),h+=this.keys.length,l[3+e.length+1]=h,l.set(this.bboxes,h),h+=this.bboxes.length,l.buffer}static serialize(e,n){const s=e.toArrayBuffer();return n&&n.push(s),{buffer:s}}static deserialize(e){return new as(e.buffer)}}const qr={};function He(i,e,n={}){if(qr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),qr[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}He("Object",Object),He("TransferableGridIndex",as),He("Color",pt),He("Error",Error),He("AJAXError",Ft),He("ResolvedImage",Hn),He("StylePropertyFunction",rs),He("StyleExpression",ii,{omit:["_evaluator"]}),He("ZoomDependentExpression",Yt),He("ZoomConstantExpression",Xs),He("CompoundExpression",Bn,{omit:["_evaluate"]});for(const i in Ts)Ts[i]._classRegistryKey||He(`Expression_${i}`,Ts[i]);function $l(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function ls(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if($l(i)||mi(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return e&&e.push(n.buffer),n}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const s of i)n.push(ls(s,e));return n}if(typeof i=="object"){const n=i.constructor,s=n._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");if(!qr[s])throw new Error(`${s} is not registered.`);const l=n.serialize?n.serialize(i,e):{};if(n.serialize){if(e&&l===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const h in i){if(!i.hasOwnProperty(h)||qr[s].omit.indexOf(h)>=0)continue;const d=i[h];l[h]=qr[s].shallow.indexOf(h)>=0?d:ls(d,e)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof i)}function As(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||$l(i)||mi(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(As);if(typeof i=="object"){const e=i.$name||"Object";if(!qr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=qr[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const s=Object.create(n.prototype);for(const l of Object.keys(i)){if(l==="$name")continue;const h=i[l];s[l]=qr[e].shallow.indexOf(l)>=0?h:As(h)}return s}throw new Error("can't deserialize object of type "+typeof i)}class Uo{constructor(){this.first=!0}update(e,n){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const Ze={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Vo(i){for(const e of i)if(Is(e.charCodeAt(0)))return!0;return!1}function Xc(i){for(const e of i)if(!Ca(e.charCodeAt(0)))return!1;return!0}function Ca(i){return!(Ze.Arabic(i)||Ze["Arabic Supplement"](i)||Ze["Arabic Extended-A"](i)||Ze["Arabic Presentation Forms-A"](i)||Ze["Arabic Presentation Forms-B"](i))}function Is(i){return!(i!==746&&i!==747&&(i<4352||!(Ze["Bopomofo Extended"](i)||Ze.Bopomofo(i)||Ze["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ze["CJK Compatibility Ideographs"](i)||Ze["CJK Compatibility"](i)||Ze["CJK Radicals Supplement"](i)||Ze["CJK Strokes"](i)||!(!Ze["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ze["CJK Unified Ideographs Extension A"](i)||Ze["CJK Unified Ideographs"](i)||Ze["Enclosed CJK Letters and Months"](i)||Ze["Hangul Compatibility Jamo"](i)||Ze["Hangul Jamo Extended-A"](i)||Ze["Hangul Jamo Extended-B"](i)||Ze["Hangul Jamo"](i)||Ze["Hangul Syllables"](i)||Ze.Hiragana(i)||Ze["Ideographic Description Characters"](i)||Ze.Kanbun(i)||Ze["Kangxi Radicals"](i)||Ze["Katakana Phonetic Extensions"](i)||Ze.Katakana(i)&&i!==12540||!(!Ze["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ze["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ze["Unified Canadian Aboriginal Syllabics"](i)||Ze["Unified Canadian Aboriginal Syllabics Extended"](i)||Ze["Vertical Forms"](i)||Ze["Yijing Hexagram Symbols"](i)||Ze["Yi Syllables"](i)||Ze["Yi Radicals"](i))))}function Pa(i){return!(Is(i)||function(e){return!!(Ze["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ze["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ze["Letterlike Symbols"](e)||Ze["Number Forms"](e)||Ze["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ze["Control Pictures"](e)&&e!==9251||Ze["Optical Character Recognition"](e)||Ze["Enclosed Alphanumerics"](e)||Ze["Geometric Shapes"](e)||Ze["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ze["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ze["CJK Symbols and Punctuation"](e)||Ze.Katakana(e)||Ze["Private Use Area"](e)||Ze["CJK Compatibility Forms"](e)||Ze["Small Form Variants"](e)||Ze["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Nl(i){return i>=1424&&i<=2303||Ze["Arabic Presentation Forms-A"](i)||Ze["Arabic Presentation Forms-B"](i)}function jl(i,e){return!(!e&&Nl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ze.Khmer(i))}function Yc(i){for(const e of i)if(Nl(e.charCodeAt(0)))return!0;return!1}const ro="deferred",ka="loading",za="loaded";let Da=null,wn="unavailable",Mr=null;const ql=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(wn="error"),Da&&Da(i)};function La(){Ra.fire(new ci("pluginStateChange",{pluginStatus:wn,pluginURL:Mr}))}const Ra=new Wn,Ba=function(){return wn},Zl=function(){if(wn!==ro||!Mr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");wn=ka,La(),Mr&&Sr({url:Mr},i=>{i?ql(i):(wn=za,La())})},Kn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>wn===za||Kn.applyArabicShaping!=null,isLoading:()=>wn===ka,setState(i){if(!Gt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");wn=i.pluginStatus,Mr=i.pluginURL},isParsed(){if(!Gt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Kn.applyArabicShaping!=null&&Kn.processBidirectionalText!=null&&Kn.processStyledBidirectionalText!=null},getPluginURL(){if(!Gt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Mr}};class Qt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Uo,this.transition={})}isSupportedScript(e){return function(n,s){for(const l of n)if(!jl(l.charCodeAt(0),s))return!1;return!0}(e,Kn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*n}}}class cs{constructor(e,n){this.property=e,this.value=n,this.expression=function(s,l){if(Co(s))return new rs(s,l);if(Po(s)){const h=Kt(s,l);if(h.result==="error")throw new Error(h.value.map(d=>`${d.key}: ${d.message}`).join(", "));return h.value}{let h=s;return l.type==="color"&&typeof s=="string"?h=pt.parse(s):l.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(s)&&(h=tn.parse(s)):h=Rn.parse(s),{kind:"constant",evaluate:()=>h}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class Fa{constructor(e){this.property=e,this.value=new cs(e,void 0)}transitioned(e,n){return new Gl(this.property,this.value,n,De({},e.transition,this.transition),e.now)}untransitioned(){return new Gl(this.property,this.value,null,{},0)}}class $o{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ke(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Fa(this._values[e].property)),this._values[e].value=new cs(this._values[e].property,n===null?void 0:Ke(n))}getTransition(e){return Ke(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Fa(this._values[e].property)),this._values[e].transition=Ke(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);s!==void 0&&(e[n]=s);const l=this.getTransition(n);l!==void 0&&(e[`${n}-transition`]=l)}return e}transitioned(e,n){const s=new Wl(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(e,n._values[l]);return s}untransitioned(){const e=new Wl(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Gl{constructor(e,n,s,l,h){this.property=e,this.value=n,this.begin=h+l.delay||0,this.end=this.begin+l.duration||0,e.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){const l=e.now||0,h=this.value.possiblyEvaluate(e,n,s),d=this.prior;if(d){if(l>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(l<this.begin)return d.possiblyEvaluate(e,n,s);{const m=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,n,s),h,function(x){if(x<=0)return 0;if(x>=1)return 1;const w=x*x,I=w*x;return 4*(x<.5?I:3*(x-w)+I-.75)}(m))}}return h}}class Wl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){const l=new No(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,n,s);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Hl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Ke(this._values[e].value)}setValue(e,n){this._values[e]=new cs(this._values[e].property,n===null?void 0:Ke(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);s!==void 0&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){const l=new No(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,n,s);return l}}class or{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,s,l){return this.property.evaluate(this.value,this.parameters,e,n,s,l)}}class No{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class nt{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,s){const l=Fn[this.specification.type];return l?l(e,n,s):e}}class ct{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,l){return new or(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},s,l)}:e.expression,n)}interpolate(e,n,s){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new or(this,{kind:"constant",value:void 0},e.parameters);const l=Fn[this.specification.type];if(l){const h=l(e.value.value,n.value.value,s);return new or(this,{kind:"constant",value:h},e.parameters)}return e}evaluate(e,n,s,l,h,d){return e.kind==="constant"?e.value:e.evaluate(n,s,l,h,d)}}class jo extends ct{possiblyEvaluate(e,n,s,l){if(e.value===void 0)return new or(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const h=e.expression.evaluate(n,null,{},s,l),d=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,m=this._calculate(d,d,d,n);return new or(this,{kind:"constant",value:m},n)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new or(this,{kind:"constant",value:h},n)}return new or(this,e.expression,n)}evaluate(e,n,s,l,h,d){if(e.kind==="source"){const m=e.evaluate(n,s,l,h,d);return this._calculate(m,m,m,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},s,l),e.evaluate({zoom:Math.floor(n.zoom)},s,l),e.evaluate({zoom:Math.floor(n.zoom)+1},s,l),n):e.value}_calculate(e,n,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:s,to:n}}interpolate(e){return e}}class Oa{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(n,null,{},s,l);return this._calculate(h,h,h,n)}return this._calculate(e.expression.evaluate(new Qt(Math.floor(n.zoom-1),n)),e.expression.evaluate(new Qt(Math.floor(n.zoom),n)),e.expression.evaluate(new Qt(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:s,to:n}}interpolate(e){return e}}class Ua{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,l){return!!e.expression.evaluate(n,null,{},s,l)}interpolate(){return!1}}class Ri{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const s=e[n];s.specification.overridable&&this.overridableProperties.push(n);const l=this.defaultPropertyValues[n]=new cs(s,void 0),h=this.defaultTransitionablePropertyValues[n]=new Fa(s);this.defaultTransitioningPropertyValues[n]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=l.possiblyEvaluate({})}}}He("DataDrivenProperty",ct),He("DataConstantProperty",nt),He("CrossFadedDataDrivenProperty",jo),He("CrossFadedProperty",Oa),He("ColorRampProperty",Ua);const Xl="-transition";class vr extends Wn{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new Hl(n.layout)),n.paint)){this._transitionablePaint=new $o(n.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new No(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,s={}){n!=null&&this._validate(Ma,`layers.${this.id}.layout.${e}`,e,n,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(Xl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,s={}){if(n!=null&&this._validate(Hc,`layers.${this.id}.paint.${e}`,e,n,s))return!1;if(e.endsWith(Xl))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const l=this._transitionablePaint._values[e],h=l.property.specification["property-type"]==="cross-faded-data-driven",d=l.value.isDataDriven(),m=l.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||d||h||this._handleOverridablePaintPropertyUpdate(e,m,x)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Le(e,(n,s)=>!(n===void 0||s==="layout"&&!Object.keys(n).length||s==="paint"&&!Object.keys(n).length))}_validate(e,n,s,l,h={}){return(!h||h.validate!==!1)&&Vl(this,e.call(io,{key:n,layerType:this.type,objectKey:s,value:l,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof or&&Es(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const Kc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ms{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ni{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function wi(i,e=1){let n=0,s=0;return{members:i.map(l=>{const h=Kc[l.type].BYTES_PER_ELEMENT,d=n=Cr(n,Math.max(e,h)),m=l.components||1;return s=Math.max(s,h),n+=h*m,{name:l.name,type:l.type,components:m,offset:d}}),size:Cr(n,Math.max(s,e)),alignment:e}}function Cr(i,e){return Math.ceil(i/e)*e}class Cs extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const l=2*e;return this.int16[l+0]=n,this.int16[l+1]=s,e}}Cs.prototype.bytesPerElement=4,He("StructArrayLayout2i4",Cs);class Ps extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,s)}emplace(e,n,s,l){const h=3*e;return this.int16[h+0]=n,this.int16[h+1]=s,this.int16[h+2]=l,e}}Ps.prototype.bytesPerElement=6,He("StructArrayLayout3i6",Ps);class qo extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,l)}emplace(e,n,s,l,h){const d=4*e;return this.int16[d+0]=n,this.int16[d+1]=s,this.int16[d+2]=l,this.int16[d+3]=h,e}}qo.prototype.bytesPerElement=8,He("StructArrayLayout4i8",qo);class so extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,l,h,d)}emplace(e,n,s,l,h,d,m){const x=6*e;return this.int16[x+0]=n,this.int16[x+1]=s,this.int16[x+2]=l,this.int16[x+3]=h,this.int16[x+4]=d,this.int16[x+5]=m,e}}so.prototype.bytesPerElement=12,He("StructArrayLayout2i4i12",so);class Va extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,l,h,d)}emplace(e,n,s,l,h,d,m){const x=4*e,w=8*e;return this.int16[x+0]=n,this.int16[x+1]=s,this.uint8[w+4]=l,this.uint8[w+5]=h,this.uint8[w+6]=d,this.uint8[w+7]=m,e}}Va.prototype.bytesPerElement=8,He("StructArrayLayout2i4ub8",Va);class Zr extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const l=2*e;return this.float32[l+0]=n,this.float32[l+1]=s,e}}Zr.prototype.bytesPerElement=8,He("StructArrayLayout2f8",Zr);class us extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,d,m,x,w,I){const C=this.length;return this.resize(C+1),this.emplace(C,e,n,s,l,h,d,m,x,w,I)}emplace(e,n,s,l,h,d,m,x,w,I,C){const L=10*e;return this.uint16[L+0]=n,this.uint16[L+1]=s,this.uint16[L+2]=l,this.uint16[L+3]=h,this.uint16[L+4]=d,this.uint16[L+5]=m,this.uint16[L+6]=x,this.uint16[L+7]=w,this.uint16[L+8]=I,this.uint16[L+9]=C,e}}us.prototype.bytesPerElement=20,He("StructArrayLayout10ui20",us);class $a extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,d,m,x,w,I,C,L){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,s,l,h,d,m,x,w,I,C,L)}emplace(e,n,s,l,h,d,m,x,w,I,C,L,F){const U=12*e;return this.int16[U+0]=n,this.int16[U+1]=s,this.int16[U+2]=l,this.int16[U+3]=h,this.uint16[U+4]=d,this.uint16[U+5]=m,this.uint16[U+6]=x,this.uint16[U+7]=w,this.int16[U+8]=I,this.int16[U+9]=C,this.int16[U+10]=L,this.int16[U+11]=F,e}}$a.prototype.bytesPerElement=24,He("StructArrayLayout4i4ui4i24",$a);class Zo extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,s)}emplace(e,n,s,l){const h=3*e;return this.float32[h+0]=n,this.float32[h+1]=s,this.float32[h+2]=l,e}}Zo.prototype.bytesPerElement=12,He("StructArrayLayout3f12",Zo);class hs extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}hs.prototype.bytesPerElement=4,He("StructArrayLayout1ul4",hs);class Na extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,d,m,x,w){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,s,l,h,d,m,x,w)}emplace(e,n,s,l,h,d,m,x,w,I){const C=10*e,L=5*e;return this.int16[C+0]=n,this.int16[C+1]=s,this.int16[C+2]=l,this.int16[C+3]=h,this.int16[C+4]=d,this.int16[C+5]=m,this.uint32[L+3]=x,this.uint16[C+8]=w,this.uint16[C+9]=I,e}}Na.prototype.bytesPerElement=20,He("StructArrayLayout6i1ul2ui20",Na);class ja extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,l,h,d)}emplace(e,n,s,l,h,d,m){const x=6*e;return this.int16[x+0]=n,this.int16[x+1]=s,this.int16[x+2]=l,this.int16[x+3]=h,this.int16[x+4]=d,this.int16[x+5]=m,e}}ja.prototype.bytesPerElement=12,He("StructArrayLayout2i2i2i12",ja);class Go extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,s,l,h)}emplace(e,n,s,l,h,d){const m=4*e,x=8*e;return this.float32[m+0]=n,this.float32[m+1]=s,this.float32[m+2]=l,this.int16[x+6]=h,this.int16[x+7]=d,e}}Go.prototype.bytesPerElement=16,He("StructArrayLayout2f1f2i16",Go);class qa extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,l)}emplace(e,n,s,l,h){const d=12*e,m=3*e;return this.uint8[d+0]=n,this.uint8[d+1]=s,this.float32[m+1]=l,this.float32[m+2]=h,e}}qa.prototype.bytesPerElement=12,He("StructArrayLayout2ub2f12",qa);class Wo extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,s)}emplace(e,n,s,l){const h=3*e;return this.uint16[h+0]=n,this.uint16[h+1]=s,this.uint16[h+2]=l,e}}Wo.prototype.bytesPerElement=6,He("StructArrayLayout3ui6",Wo);class Bt extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,d,m,x,w,I,C,L,F,U,Z,Y,Q){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,n,s,l,h,d,m,x,w,I,C,L,F,U,Z,Y,Q)}emplace(e,n,s,l,h,d,m,x,w,I,C,L,F,U,Z,Y,Q,oe){const ie=24*e,le=12*e,he=48*e;return this.int16[ie+0]=n,this.int16[ie+1]=s,this.uint16[ie+2]=l,this.uint16[ie+3]=h,this.uint32[le+2]=d,this.uint32[le+3]=m,this.uint32[le+4]=x,this.uint16[ie+10]=w,this.uint16[ie+11]=I,this.uint16[ie+12]=C,this.float32[le+7]=L,this.float32[le+8]=F,this.uint8[he+36]=U,this.uint8[he+37]=Z,this.uint8[he+38]=Y,this.uint32[le+10]=Q,this.int16[ie+22]=oe,e}}Bt.prototype.bytesPerElement=48,He("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Bt);class u extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,d,m,x,w,I,C,L,F,U,Z,Y,Q,oe,ie,le,he,be,Ge,et,qe,$e,Re,Xe){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,e,n,s,l,h,d,m,x,w,I,C,L,F,U,Z,Y,Q,oe,ie,le,he,be,Ge,et,qe,$e,Re,Xe)}emplace(e,n,s,l,h,d,m,x,w,I,C,L,F,U,Z,Y,Q,oe,ie,le,he,be,Ge,et,qe,$e,Re,Xe,Fe){const Me=32*e,ot=16*e;return this.int16[Me+0]=n,this.int16[Me+1]=s,this.int16[Me+2]=l,this.int16[Me+3]=h,this.int16[Me+4]=d,this.int16[Me+5]=m,this.int16[Me+6]=x,this.int16[Me+7]=w,this.uint16[Me+8]=I,this.uint16[Me+9]=C,this.uint16[Me+10]=L,this.uint16[Me+11]=F,this.uint16[Me+12]=U,this.uint16[Me+13]=Z,this.uint16[Me+14]=Y,this.uint16[Me+15]=Q,this.uint16[Me+16]=oe,this.uint16[Me+17]=ie,this.uint16[Me+18]=le,this.uint16[Me+19]=he,this.uint16[Me+20]=be,this.uint16[Me+21]=Ge,this.uint16[Me+22]=et,this.uint32[ot+12]=qe,this.float32[ot+13]=$e,this.float32[ot+14]=Re,this.uint16[Me+30]=Xe,this.uint16[Me+31]=Fe,e}}u.prototype.bytesPerElement=64,He("StructArrayLayout8i15ui1ul2f2ui64",u);class t extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}t.prototype.bytesPerElement=4,He("StructArrayLayout1f4",t);class r extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,s)}emplace(e,n,s,l){const h=3*e;return this.uint16[6*e+0]=n,this.float32[h+1]=s,this.float32[h+2]=l,e}}r.prototype.bytesPerElement=12,He("StructArrayLayout1ui2f12",r);class a extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,s)}emplace(e,n,s,l){const h=4*e;return this.uint32[2*e+0]=n,this.uint16[h+2]=s,this.uint16[h+3]=l,e}}a.prototype.bytesPerElement=8,He("StructArrayLayout1ul2ui8",a);class c extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const l=2*e;return this.uint16[l+0]=n,this.uint16[l+1]=s,e}}c.prototype.bytesPerElement=4,He("StructArrayLayout2ui4",c);class p extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}p.prototype.bytesPerElement=2,He("StructArrayLayout1ui2",p);class g extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,l)}emplace(e,n,s,l,h){const d=4*e;return this.float32[d+0]=n,this.float32[d+1]=s,this.float32[d+2]=l,this.float32[d+3]=h,e}}g.prototype.bytesPerElement=16,He("StructArrayLayout4f16",g);class y extends Ms{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new H(this.anchorPointX,this.anchorPointY)}}y.prototype.size=20;class b extends Na{get(e){return new y(this,e)}}He("CollisionBoxArray",b);class T extends Ms{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}T.prototype.size=48;class A extends Bt{get(e){return new T(this,e)}}He("PlacedSymbolArray",A);class M extends Ms{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}M.prototype.size=64;class B extends u{get(e){return new M(this,e)}}He("SymbolInstanceArray",B);class q extends t{getoffsetX(e){return this.float32[1*e+0]}}He("GlyphOffsetArray",q);class j extends Ps{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}He("SymbolLineVertexArray",j);class W extends Ms{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}W.prototype.size=12;class N extends r{get(e){return new W(this,e)}}He("TextAnchorOffsetArray",N);class re extends Ms{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}re.prototype.size=8;class ue extends a{get(e){return new re(this,e)}}He("FeatureIndexArray",ue);class K extends Cs{}class se extends Cs{}class me extends Cs{}class _e extends so{}class ve extends Va{}class Ie extends Zr{}class Te extends us{}class ke extends $a{}class Qe extends Zo{}class At extends hs{}class Ue extends ja{}class ut extends qa{}class Ye extends Wo{}class Ht extends c{}const wt=wi([{name:"a_pos",components:2,type:"Int16"}],4),{members:yt}=wt;class ht{constructor(e=[]){this.segments=e}prepareSegment(e,n,s,l){let h=this.segments[this.segments.length-1];return e>ht.MAX_VERTEX_ARRAY_LENGTH&&vt(`Max vertices per segment is ${ht.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>ht.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==l)&&(h={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},l!==void 0&&(h.sortKey=l),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,l){return new ht([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function ui(i,e){return 256*(i=Pe(Math.floor(i),0,255))+Pe(Math.floor(e),0,255)}ht.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,He("SegmentVector",ht);const Nt=wi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var dn={exports:{}},$i={exports:{}};$i.exports=function(i,e){var n,s,l,h,d,m,x,w;for(s=i.length-(n=3&i.length),l=e,d=3432918353,m=461845907,w=0;w<s;)x=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24,++w,l=27492+(65535&(h=5*(65535&(l=(l^=x=(65535&(x=(x=(65535&x)*d+(((x>>>16)*d&65535)<<16)&4294967295)<<15|x>>>17))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&i.charCodeAt(w+2))<<16;case 2:x^=(255&i.charCodeAt(w+1))<<8;case 1:l^=x=(65535&(x=(x=(65535&(x^=255&i.charCodeAt(w)))*d+(((x>>>16)*d&65535)<<16)&4294967295)<<15|x>>>17))*m+(((x>>>16)*m&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var Ti=$i.exports,Tn={exports:{}};Tn.exports=function(i,e){for(var n,s=i.length,l=e^s,h=0;s>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(h)|(255&i.charCodeAt(++h))<<8|(255&i.charCodeAt(++h))<<16|(255&i.charCodeAt(++h))<<24))+((1540483477*(n>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++h;switch(s){case 3:l^=(255&i.charCodeAt(h+2))<<16;case 2:l^=(255&i.charCodeAt(h+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(h)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var ar=Ti,Pr=Tn.exports;dn.exports=ar,dn.exports.murmur3=ar,dn.exports.murmur2=Pr;var kr=O(dn.exports);class Gr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,s,l){this.ids.push(ps(e)),this.positions.push(n,s,l)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=ps(e);let s=0,l=this.ids.length-1;for(;s<l;){const d=s+l>>1;this.ids[d]>=n?l=d:s=d+1}const h=[];for(;this.ids[s]===n;)h.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return h}static serialize(e,n){const s=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Wr(s,l,0,s.length-1),n&&n.push(s.buffer,l.buffer),{ids:s,positions:l}}static deserialize(e){const n=new Gr;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function ps(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:kr(String(i))}function Wr(i,e,n,s){for(;n<s;){const l=i[n+s>>1];let h=n-1,d=s+1;for(;;){do h++;while(i[h]<l);do d--;while(i[d]>l);if(h>=d)break;Ni(i,h,d),Ni(e,3*h,3*d),Ni(e,3*h+1,3*d+1),Ni(e,3*h+2,3*d+2)}d-n<s-d?(Wr(i,e,n,d),n=d+1):(Wr(i,e,d+1,s),s=d)}}function Ni(i,e,n){const s=i[e];i[e]=i[n],i[n]=s}He("FeaturePositionMap",Gr);class hi{constructor(e,n){this.gl=e.gl,this.location=n}}class ji extends hi{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class ks extends hi{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ii extends hi{constructor(e,n){super(e,n),this.current=pt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const qi=new Float32Array(16);function Sn(i){return[ui(255*i.r,255*i.g),ui(255*i.b,255*i.a)]}class ri{constructor(e,n,s){this.value=e,this.uniformNames=n.map(l=>`u_${l}`),this.type=s}setUniform(e,n,s){e.set(s.constantOr(this.value))}getBinding(e,n,s){return this.type==="color"?new Ii(e,n):new ji(e,n)}}class zs{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setUniform(e,n,s,l){const h=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&e.set(h)}getBinding(e,n,s){return s.substr(0,9)==="u_pattern"?new ks(e,n):new ji(e,n)}}class zr{constructor(e,n,s,l){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(h=>({name:`a_${h}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,n,s,l,h){const d=this.paintVertexArray.length,m=this.expression.evaluate(new Qt(0),n,{},l,[],h);this.paintVertexArray.resize(e),this._setPaintValue(d,e,m)}updatePaintArray(e,n,s,l){const h=this.expression.evaluate({zoom:0},s,l);this._setPaintValue(e,n,h)}_setPaintValue(e,n,s){if(this.type==="color"){const l=Sn(s);for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,l[0],l[1])}else{for(let l=e;l<n;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class lr{constructor(e,n,s,l,h,d){this.expression=e,this.uniformNames=n.map(m=>`u_${m}_t`),this.type=s,this.useIntegerZoom=l,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,n,s,l,h){const d=this.expression.evaluate(new Qt(this.zoom),n,{},l,[],h),m=this.expression.evaluate(new Qt(this.zoom+1),n,{},l,[],h),x=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(x,e,d,m)}updatePaintArray(e,n,s,l){const h=this.expression.evaluate({zoom:this.zoom},s,l),d=this.expression.evaluate({zoom:this.zoom+1},s,l);this._setPaintValue(e,n,h,d)}_setPaintValue(e,n,s,l){if(this.type==="color"){const h=Sn(s),d=Sn(l);for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,h[0],h[1],d[0],d[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const s=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,l=Pe(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(l)}getBinding(e,n,s){return new ji(e,n)}}class Hr{constructor(e,n,s,l,h,d){this.expression=e,this.type=n,this.useIntegerZoom=s,this.zoom=l,this.layerId=d,this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(e,n,s){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,l,h){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],h)}_setPaintValues(e,n,s,l){if(!l||!s)return;const{min:h,mid:d,max:m}=s,x=l[h],w=l[d],I=l[m];if(x&&w&&I)for(let C=e;C<n;C++)this.zoomInPaintVertexArray.emplace(C,w.tl[0],w.tl[1],w.br[0],w.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],w.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,w.tl[0],w.tl[1],w.br[0],w.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],w.pixelRatio,I.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Nt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Nt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Yl{constructor(e,n,s){this.binders={},this._buffers=[];const l=[];for(const h in e.paint._values){if(!s(h))continue;const d=e.paint.get(h);if(!(d instanceof or&&Es(d.property.specification)))continue;const m=Ds(h,e.type),x=d.value,w=d.property.specification.type,I=d.property.useIntegerZoom,C=d.property.specification["property-type"],L=C==="cross-faded"||C==="cross-faded-data-driven";if(x.kind==="constant")this.binders[h]=L?new zs(x.value,m):new ri(x.value,m,w),l.push(`/u_${h}`);else if(x.kind==="source"||L){const F=Za(h,w,"source");this.binders[h]=L?new Hr(x,w,I,n,F,e.id):new zr(x,m,w,F),l.push(`/a_${h}`)}else{const F=Za(h,w,"composite");this.binders[h]=new lr(x,m,w,I,n,F),l.push(`/z_${h}`)}}this.cacheKey=l.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof zr||n instanceof lr?n.maxValue:0}populatePaintArrays(e,n,s,l,h){for(const d in this.binders){const m=this.binders[d];(m instanceof zr||m instanceof lr||m instanceof Hr)&&m.populatePaintArray(e,n,s,l,h)}}setConstantPatternPositions(e,n){for(const s in this.binders){const l=this.binders[s];l instanceof zs&&l.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,s,l,h){let d=!1;for(const m in e){const x=n.getPositions(m);for(const w of x){const I=s.feature(w.index);for(const C in this.binders){const L=this.binders[C];if((L instanceof zr||L instanceof lr||L instanceof Hr)&&L.expression.isStateDependent===!0){const F=l.paint.get(C);L.expression=F.value,L.updatePaintArray(w.start,w.end,I,e[m],h),d=!0}}}}return d}defines(){const e=[];for(const n in this.binders){const s=this.binders[n];(s instanceof ri||s instanceof zs)&&e.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof zr||s instanceof lr)for(let l=0;l<s.paintVertexAttributes.length;l++)e.push(s.paintVertexAttributes[l].name);else if(s instanceof Hr)for(let l=0;l<Nt.members.length;l++)e.push(Nt.members[l].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof ri||s instanceof zs||s instanceof lr)for(const l of s.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const s=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof ri||h instanceof zs||h instanceof lr){for(const d of h.uniformNames)if(n[d]){const m=h.getBinding(e,n[d],d);s.push({name:d,property:l,binding:m})}}}return s}setUniforms(e,n,s,l){for(const{name:h,property:d,binding:m}of n)this.binders[d].setUniform(m,l,s.get(d),h)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const s=this.binders[n];if(e&&s instanceof Hr){const l=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(s instanceof zr||s instanceof lr)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const n in this.binders){const s=this.binders[n];(s instanceof zr||s instanceof lr||s instanceof Hr)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof zr||n instanceof lr||n instanceof Hr)&&n.destroy()}}}class ds{constructor(e,n,s=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Yl(l,n,s);this.needsUpload=!1,this._featureMap=new Gr,this._bufferOffset=0}populatePaintArrays(e,n,s,l,h,d){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(e,n,l,h,d);n.id!==void 0&&this._featureMap.add(n.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,l){for(const h of s)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,n,h,l)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Ds(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Za(i,e,n){const s={color:{source:Zr,composite:g},number:{source:t,composite:Zr}},l=function(h){return{"line-pattern":{source:Te,composite:Te},"fill-pattern":{source:Te,composite:Te},"fill-extrusion-pattern":{source:Te,composite:Te}}[h]}(i);return l&&l[n]||s[e][n]}He("ConstantBinder",ri),He("CrossFadedConstantBinder",zs),He("SourceExpressionBinder",zr),He("CrossFadedCompositeBinder",Hr),He("CompositeExpressionBinder",lr),He("ProgramConfiguration",Yl,{omit:["_buffers"]}),He("ProgramConfigurationSet",ds);const si=8192,Ho=Math.pow(2,14)-1,Xo=-Ho-1;function Xr(i){const e=si/i.extent,n=i.loadGeometry();for(let s=0;s<n.length;s++){const l=n[s];for(let h=0;h<l.length;h++){const d=l[h],m=Math.round(d.x*e),x=Math.round(d.y*e);d.x=Pe(m,Xo,Ho),d.y=Pe(x,Xo,Ho),(m<d.x||m>d.x+1||x<d.y||x>d.y+1)&&vt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Dr(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Xr(i):[]}}function Kl(i,e,n,s,l){i.emplaceBack(2*e+(s+1)/2,2*n+(l+1)/2)}class Jc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new se,this.indexArray=new Ye,this.segments=new ht,this.programConfigurations=new ds(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){const l=this.layers[0],h=[];let d=null,m=!1;l.type==="circle"&&(d=l.layout.get("circle-sort-key"),m=!d.isConstant());for(const{feature:x,id:w,index:I,sourceLayerIndex:C}of e){const L=this.layers[0]._featureFilter.needGeometry,F=Dr(x,L);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),F,s))continue;const U=m?d.evaluate(F,{},s):void 0,Z={id:w,properties:x.properties,type:x.type,sourceLayerIndex:C,index:I,geometry:L?F.geometry:Xr(x),patterns:{},sortKey:U};h.push(Z)}m&&h.sort((x,w)=>x.sortKey-w.sortKey);for(const x of h){const{geometry:w,index:I,sourceLayerIndex:C}=x,L=e[I].feature;this.addFeature(x,w,I,s),n.featureIndex.insert(L,w,I,C,this.index)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,l){for(const h of n)for(const d of h){const m=d.x,x=d.y;if(m<0||m>=si||x<0||x>=si)continue;const w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),I=w.vertexLength;Kl(this.layoutVertexArray,m,x,-1,-1),Kl(this.layoutVertexArray,m,x,1,-1),Kl(this.layoutVertexArray,m,x,1,1),Kl(this.layoutVertexArray,m,x,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),w.vertexLength+=4,w.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},l)}}function th(i,e){for(let n=0;n<i.length;n++)if(Yo(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Yo(i,e[n]))return!0;return!!Qc(i,e)}function zd(i,e,n){return!!Yo(i,e)||!!eu(e,i,n)}function ih(i,e){if(i.length===1)return rh(e,i[0]);for(let n=0;n<e.length;n++){const s=e[n];for(let l=0;l<s.length;l++)if(Yo(i,s[l]))return!0}for(let n=0;n<i.length;n++)if(rh(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Qc(i,e[n]))return!0;return!1}function Dd(i,e,n){if(i.length>1){if(Qc(i,e))return!0;for(let s=0;s<e.length;s++)if(eu(e[s],i,n))return!0}for(let s=0;s<i.length;s++)if(eu(i[s],e,n))return!0;return!1}function Qc(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const s=i[n],l=i[n+1];for(let h=0;h<e.length-1;h++)if(Ld(s,l,e[h],e[h+1]))return!0}return!1}function Ld(i,e,n,s){return Tt(i,n,s)!==Tt(e,n,s)&&Tt(i,e,n)!==Tt(i,e,s)}function eu(i,e,n){const s=n*n;if(e.length===1)return i.distSqr(e[0])<s;for(let l=1;l<e.length;l++)if(nh(i,e[l-1],e[l])<s)return!0;return!1}function nh(i,e,n){const s=e.distSqr(n);if(s===0)return i.distSqr(e);const l=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/s;return i.distSqr(l<0?e:l>1?n:n.sub(e)._mult(l)._add(e))}function rh(i,e){let n,s,l,h=!1;for(let d=0;d<i.length;d++){n=i[d];for(let m=0,x=n.length-1;m<n.length;x=m++)s=n[m],l=n[x],s.y>e.y!=l.y>e.y&&e.x<(l.x-s.x)*(e.y-s.y)/(l.y-s.y)+s.x&&(h=!h)}return h}function Yo(i,e){let n=!1;for(let s=0,l=i.length-1;s<i.length;l=s++){const h=i[s],d=i[l];h.y>e.y!=d.y>e.y&&e.x<(d.x-h.x)*(e.y-h.y)/(d.y-h.y)+h.x&&(n=!n)}return n}function Rd(i,e,n){const s=n[0],l=n[2];if(i.x<s.x&&e.x<s.x||i.x>l.x&&e.x>l.x||i.y<s.y&&e.y<s.y||i.y>l.y&&e.y>l.y)return!1;const h=Tt(i,e,n[0]);return h!==Tt(i,e,n[1])||h!==Tt(i,e,n[2])||h!==Tt(i,e,n[3])}function Ga(i,e,n){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:n.programConfigurations.get(e.id).getMaxValue(i)}function Jl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Ql(i,e,n,s,l){if(!e[0]&&!e[1])return i;const h=H.convert(e)._mult(l);n==="viewport"&&h._rotate(-s);const d=[];for(let m=0;m<i.length;m++)d.push(i[m].sub(h));return d}let sh,oh;He("CircleBucket",Jc,{omit:["layers"]});var Bd={get paint(){return oh=oh||new Ri({"circle-radius":new ct(ye.paint_circle["circle-radius"]),"circle-color":new ct(ye.paint_circle["circle-color"]),"circle-blur":new ct(ye.paint_circle["circle-blur"]),"circle-opacity":new ct(ye.paint_circle["circle-opacity"]),"circle-translate":new nt(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new nt(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nt(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nt(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ct(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ct(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ct(ye.paint_circle["circle-stroke-opacity"])})},get layout(){return sh=sh||new Ri({"circle-sort-key":new ct(ye.layout_circle["circle-sort-key"])})}},En=1e-6,Ko=typeof Float32Array<"u"?Float32Array:Array;function tu(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ah(i,e,n){var s=e[0],l=e[1],h=e[2],d=e[3],m=e[4],x=e[5],w=e[6],I=e[7],C=e[8],L=e[9],F=e[10],U=e[11],Z=e[12],Y=e[13],Q=e[14],oe=e[15],ie=n[0],le=n[1],he=n[2],be=n[3];return i[0]=ie*s+le*m+he*C+be*Z,i[1]=ie*l+le*x+he*L+be*Y,i[2]=ie*h+le*w+he*F+be*Q,i[3]=ie*d+le*I+he*U+be*oe,i[4]=(ie=n[4])*s+(le=n[5])*m+(he=n[6])*C+(be=n[7])*Z,i[5]=ie*l+le*x+he*L+be*Y,i[6]=ie*h+le*w+he*F+be*Q,i[7]=ie*d+le*I+he*U+be*oe,i[8]=(ie=n[8])*s+(le=n[9])*m+(he=n[10])*C+(be=n[11])*Z,i[9]=ie*l+le*x+he*L+be*Y,i[10]=ie*h+le*w+he*F+be*Q,i[11]=ie*d+le*I+he*U+be*oe,i[12]=(ie=n[12])*s+(le=n[13])*m+(he=n[14])*C+(be=n[15])*Z,i[13]=ie*l+le*x+he*L+be*Y,i[14]=ie*h+le*w+he*F+be*Q,i[15]=ie*d+le*I+he*U+be*oe,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Wa,Fd=ah;function ec(i,e,n){var s=e[0],l=e[1],h=e[2],d=e[3];return i[0]=n[0]*s+n[4]*l+n[8]*h+n[12]*d,i[1]=n[1]*s+n[5]*l+n[9]*h+n[13]*d,i[2]=n[2]*s+n[6]*l+n[10]*h+n[14]*d,i[3]=n[3]*s+n[7]*l+n[11]*h+n[15]*d,i}Wa=new Ko(4),Ko!=Float32Array&&(Wa[0]=0,Wa[1]=0,Wa[2]=0,Wa[3]=0);class Od extends vr{constructor(e){super(e,Bd)}createBucket(e){return new Jc(e)}queryRadius(e){const n=e;return Ga("circle-radius",this,n)+Ga("circle-stroke-width",this,n)+Jl(this.paint.get("circle-translate"))}queryIntersectsFeature(e,n,s,l,h,d,m,x){const w=Ql(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,m),I=this.paint.get("circle-radius").evaluate(n,s)+this.paint.get("circle-stroke-width").evaluate(n,s),C=this.paint.get("circle-pitch-alignment")==="map",L=C?w:function(U,Z){return U.map(Y=>lh(Y,Z))}(w,x),F=C?I*m:I;for(const U of l)for(const Z of U){const Y=C?Z:lh(Z,x);let Q=F;const oe=ec([],[Z.x,Z.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Q*=oe[3]/d.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Q*=d.cameraToCenterDistance/oe[3]),zd(L,Y,Q))return!0}return!1}}function lh(i,e){const n=ec([],[i.x,i.y,0,1],e);return new H(n[0]/n[3],n[1]/n[3])}class ch extends Jc{}let uh;He("HeatmapBucket",ch,{omit:["layers"]});var Ud={get paint(){return uh=uh||new Ri({"heatmap-radius":new ct(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ct(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nt(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ua(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nt(ye.paint_heatmap["heatmap-opacity"])})}};function iu(i,{width:e,height:n},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*n*s)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${e*n*s}`)}else l=new Uint8Array(e*n*s);return i.width=e,i.height=n,i.data=l,i}function hh(i,{width:e,height:n},s){if(e===i.width&&n===i.height)return;const l=iu({},{width:e,height:n},s);nu(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},s),i.width=e,i.height=n,i.data=l.data}function nu(i,e,n,s,l,h){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||n.x>i.width-l.width||n.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||s.x>e.width-l.width||s.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const d=i.data,m=e.data;if(d===m)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<l.height;x++){const w=((n.y+x)*i.width+n.x)*h,I=((s.y+x)*e.width+s.x)*h;for(let C=0;C<l.width*h;C++)m[I+C]=d[w+C]}return e}class Ha{constructor(e,n){iu(this,e,1,n)}resize(e){hh(this,e,1)}clone(){return new Ha({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,l,h){nu(e,n,s,l,h,1)}}class cr{constructor(e,n){iu(this,e,4,n)}resize(e){hh(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new cr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,l,h){nu(e,n,s,l,h,4)}}function ph(i){const e={},n=i.resolution||256,s=i.clips?i.clips.length:1,l=i.image||new cr({width:n,height:s});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const h=(d,m,x)=>{e[i.evaluationKey]=x;const w=i.expression.evaluate(e);l.data[d+m+0]=Math.floor(255*w.r/w.a),l.data[d+m+1]=Math.floor(255*w.g/w.a),l.data[d+m+2]=Math.floor(255*w.b/w.a),l.data[d+m+3]=Math.floor(255*w.a)};if(i.clips)for(let d=0,m=0;d<s;++d,m+=4*n)for(let x=0,w=0;x<n;x++,w+=4){const I=x/(n-1),{start:C,end:L}=i.clips[d];h(m,w,C*(1-I)+L*I)}else for(let d=0,m=0;d<n;d++,m+=4)h(0,m,d/(n-1));return l}He("AlphaImage",Ha),He("RGBAImage",cr);class Vd extends vr{createBucket(e){return new ch(e)}constructor(e){super(e,Ud),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ph({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let dh;var $d={get paint(){return dh=dh||new Ri({"hillshade-illumination-direction":new nt(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new nt(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nt(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nt(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nt(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nt(ye.paint_hillshade["hillshade-accent-color"])})}};class Nd extends vr{constructor(e){super(e,$d)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const jd=wi([{name:"a_pos",components:2,type:"Int16"}],4),{members:qd}=jd;var ru={exports:{}};function tc(i,e,n){n=n||2;var s,l,h,d,m,x,w,I=e&&e.length,C=I?e[0]*n:i.length,L=fh(i,0,C,n,!0),F=[];if(!L||L.next===L.prev)return F;if(I&&(L=function(Z,Y,Q,oe){var ie,le,he,be=[];for(ie=0,le=Y.length;ie<le;ie++)(he=fh(Z,Y[ie]*oe,ie<le-1?Y[ie+1]*oe:Z.length,oe,!1))===he.next&&(he.steiner=!0),be.push(Jd(he));for(be.sort(Xd),ie=0;ie<be.length;ie++)Q=Yd(be[ie],Q);return Q}(i,e,L,n)),i.length>80*n){s=h=i[0],l=d=i[1];for(var U=n;U<C;U+=n)(m=i[U])<s&&(s=m),(x=i[U+1])<l&&(l=x),m>h&&(h=m),x>d&&(d=x);w=(w=Math.max(h-s,d-l))!==0?32767/w:0}return Xa(L,F,n,s,l,w,0),F}function fh(i,e,n,s,l){var h,d;if(l===au(i,e,n,s)>0)for(h=e;h<n;h+=s)d=_h(h,i[h],i[h+1],d);else for(h=n-s;h>=e;h-=s)d=_h(h,i[h],i[h+1],d);return d&&ic(d,d.next)&&(Ka(d),d=d.next),d}function oo(i,e){if(!i)return i;e||(e=i);var n,s=i;do if(n=!1,s.steiner||!ic(s,s.next)&&Si(s.prev,s,s.next)!==0)s=s.next;else{if(Ka(s),(s=e=s.prev)===s.next)break;n=!0}while(n||s!==e);return e}function Xa(i,e,n,s,l,h,d){if(i){!d&&h&&function(I,C,L,F){var U=I;do U.z===0&&(U.z=su(U.x,U.y,C,L,F)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==I);U.prevZ.nextZ=null,U.prevZ=null,function(Z){var Y,Q,oe,ie,le,he,be,Ge,et=1;do{for(Q=Z,Z=null,le=null,he=0;Q;){for(he++,oe=Q,be=0,Y=0;Y<et&&(be++,oe=oe.nextZ);Y++);for(Ge=et;be>0||Ge>0&&oe;)be!==0&&(Ge===0||!oe||Q.z<=oe.z)?(ie=Q,Q=Q.nextZ,be--):(ie=oe,oe=oe.nextZ,Ge--),le?le.nextZ=ie:Z=ie,ie.prevZ=le,le=ie;Q=oe}le.nextZ=null,et*=2}while(he>1)}(U)}(i,s,l,h);for(var m,x,w=i;i.prev!==i.next;)if(m=i.prev,x=i.next,h?Gd(i,s,l,h):Zd(i))e.push(m.i/n|0),e.push(i.i/n|0),e.push(x.i/n|0),Ka(i),i=x.next,w=x.next;else if((i=x)===w){d?d===1?Xa(i=Wd(oo(i),e,n),e,n,s,l,h,2):d===2&&Hd(i,e,n,s,l,h):Xa(oo(i),e,n,s,l,h,1);break}}}function Zd(i){var e=i.prev,n=i,s=i.next;if(Si(e,n,s)>=0)return!1;for(var l=e.x,h=n.x,d=s.x,m=e.y,x=n.y,w=s.y,I=l<h?l<d?l:d:h<d?h:d,C=m<x?m<w?m:w:x<w?x:w,L=l>h?l>d?l:d:h>d?h:d,F=m>x?m>w?m:w:x>w?x:w,U=s.next;U!==e;){if(U.x>=I&&U.x<=L&&U.y>=C&&U.y<=F&&Jo(l,m,h,x,d,w,U.x,U.y)&&Si(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function Gd(i,e,n,s){var l=i.prev,h=i,d=i.next;if(Si(l,h,d)>=0)return!1;for(var m=l.x,x=h.x,w=d.x,I=l.y,C=h.y,L=d.y,F=m<x?m<w?m:w:x<w?x:w,U=I<C?I<L?I:L:C<L?C:L,Z=m>x?m>w?m:w:x>w?x:w,Y=I>C?I>L?I:L:C>L?C:L,Q=su(F,U,e,n,s),oe=su(Z,Y,e,n,s),ie=i.prevZ,le=i.nextZ;ie&&ie.z>=Q&&le&&le.z<=oe;){if(ie.x>=F&&ie.x<=Z&&ie.y>=U&&ie.y<=Y&&ie!==l&&ie!==d&&Jo(m,I,x,C,w,L,ie.x,ie.y)&&Si(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,le.x>=F&&le.x<=Z&&le.y>=U&&le.y<=Y&&le!==l&&le!==d&&Jo(m,I,x,C,w,L,le.x,le.y)&&Si(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;ie&&ie.z>=Q;){if(ie.x>=F&&ie.x<=Z&&ie.y>=U&&ie.y<=Y&&ie!==l&&ie!==d&&Jo(m,I,x,C,w,L,ie.x,ie.y)&&Si(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;le&&le.z<=oe;){if(le.x>=F&&le.x<=Z&&le.y>=U&&le.y<=Y&&le!==l&&le!==d&&Jo(m,I,x,C,w,L,le.x,le.y)&&Si(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function Wd(i,e,n){var s=i;do{var l=s.prev,h=s.next.next;!ic(l,h)&&mh(l,s,s.next,h)&&Ya(l,h)&&Ya(h,l)&&(e.push(l.i/n|0),e.push(s.i/n|0),e.push(h.i/n|0),Ka(s),Ka(s.next),s=i=h),s=s.next}while(s!==i);return oo(s)}function Hd(i,e,n,s,l,h){var d=i;do{for(var m=d.next.next;m!==d.prev;){if(d.i!==m.i&&Qd(d,m)){var x=gh(d,m);return d=oo(d,d.next),x=oo(x,x.next),Xa(d,e,n,s,l,h,0),void Xa(x,e,n,s,l,h,0)}m=m.next}d=d.next}while(d!==i)}function Xd(i,e){return i.x-e.x}function Yd(i,e){var n=function(l,h){var d,m=h,x=l.x,w=l.y,I=-1/0;do{if(w<=m.y&&w>=m.next.y&&m.next.y!==m.y){var C=m.x+(w-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(C<=x&&C>I&&(I=C,d=m.x<m.next.x?m:m.next,C===x))return d}m=m.next}while(m!==h);if(!d)return null;var L,F=d,U=d.x,Z=d.y,Y=1/0;m=d;do x>=m.x&&m.x>=U&&x!==m.x&&Jo(w<Z?x:I,w,U,Z,w<Z?I:x,w,m.x,m.y)&&(L=Math.abs(w-m.y)/(x-m.x),Ya(m,l)&&(L<Y||L===Y&&(m.x>d.x||m.x===d.x&&Kd(d,m)))&&(d=m,Y=L)),m=m.next;while(m!==F);return d}(i,e);if(!n)return e;var s=gh(n,i);return oo(s,s.next),oo(n,n.next)}function Kd(i,e){return Si(i.prev,i,e.prev)<0&&Si(e.next,i,i.next)<0}function su(i,e,n,s,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Jd(i){var e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function Jo(i,e,n,s,l,h,d,m){return(l-d)*(e-m)>=(i-d)*(h-m)&&(i-d)*(s-m)>=(n-d)*(e-m)&&(n-d)*(h-m)>=(l-d)*(s-m)}function Qd(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(n,s){var l=n;do{if(l.i!==n.i&&l.next.i!==n.i&&l.i!==s.i&&l.next.i!==s.i&&mh(l,l.next,n,s))return!0;l=l.next}while(l!==n);return!1}(i,e)&&(Ya(i,e)&&Ya(e,i)&&function(n,s){var l=n,h=!1,d=(n.x+s.x)/2,m=(n.y+s.y)/2;do l.y>m!=l.next.y>m&&l.next.y!==l.y&&d<(l.next.x-l.x)*(m-l.y)/(l.next.y-l.y)+l.x&&(h=!h),l=l.next;while(l!==n);return h}(i,e)&&(Si(i.prev,i,e.prev)||Si(i,e.prev,e))||ic(i,e)&&Si(i.prev,i,i.next)>0&&Si(e.prev,e,e.next)>0)}function Si(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function ic(i,e){return i.x===e.x&&i.y===e.y}function mh(i,e,n,s){var l=rc(Si(i,e,n)),h=rc(Si(i,e,s)),d=rc(Si(n,s,i)),m=rc(Si(n,s,e));return l!==h&&d!==m||!(l!==0||!nc(i,n,e))||!(h!==0||!nc(i,s,e))||!(d!==0||!nc(n,i,s))||!(m!==0||!nc(n,e,s))}function nc(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function rc(i){return i>0?1:i<0?-1:0}function Ya(i,e){return Si(i.prev,i,i.next)<0?Si(i,e,i.next)>=0&&Si(i,i.prev,e)>=0:Si(i,e,i.prev)<0||Si(i,i.next,e)<0}function gh(i,e){var n=new ou(i.i,i.x,i.y),s=new ou(e.i,e.x,e.y),l=i.next,h=e.prev;return i.next=e,e.prev=i,n.next=l,l.prev=n,s.next=n,n.prev=s,h.next=s,s.prev=h,s}function _h(i,e,n,s){var l=new ou(i,e,n);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function Ka(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function ou(i,e,n){this.i=i,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function au(i,e,n,s){for(var l=0,h=e,d=n-s;h<n;h+=s)l+=(i[d]-i[h])*(i[h+1]+i[d+1]),d=h;return l}ru.exports=tc,ru.exports.default=tc,tc.deviation=function(i,e,n,s){var l=e&&e.length,h=Math.abs(au(i,0,l?e[0]*n:i.length,n));if(l)for(var d=0,m=e.length;d<m;d++)h-=Math.abs(au(i,e[d]*n,d<m-1?e[d+1]*n:i.length,n));var x=0;for(d=0;d<s.length;d+=3){var w=s[d]*n,I=s[d+1]*n,C=s[d+2]*n;x+=Math.abs((i[w]-i[C])*(i[I+1]-i[w+1])-(i[w]-i[I])*(i[C+1]-i[w+1]))}return h===0&&x===0?0:Math.abs((x-h)/h)},tc.flatten=function(i){for(var e=i[0][0].length,n={vertices:[],holes:[],dimensions:e},s=0,l=0;l<i.length;l++){for(var h=0;h<i[l].length;h++)for(var d=0;d<e;d++)n.vertices.push(i[l][h][d]);l>0&&n.holes.push(s+=i[l-1].length)}return n};var yh=O(ru.exports);function ef(i,e,n,s,l){xh(i,e,n||0,s||i.length-1,l||tf)}function xh(i,e,n,s,l){for(;s>n;){if(s-n>600){var h=s-n+1,d=e-n+1,m=Math.log(h),x=.5*Math.exp(2*m/3),w=.5*Math.sqrt(m*x*(h-x)/h)*(d-h/2<0?-1:1);xh(i,e,Math.max(n,Math.floor(e-d*x/h+w)),Math.min(s,Math.floor(e+(h-d)*x/h+w)),l)}var I=i[e],C=n,L=s;for(Ja(i,n,e),l(i[s],I)>0&&Ja(i,n,s);C<L;){for(Ja(i,C,L),C++,L--;l(i[C],I)<0;)C++;for(;l(i[L],I)>0;)L--}l(i[n],I)===0?Ja(i,n,L):Ja(i,++L,s),L<=e&&(n=L+1),e<=L&&(s=L-1)}}function Ja(i,e,n){var s=i[e];i[e]=i[n],i[n]=s}function tf(i,e){return i<e?-1:i>e?1:0}function lu(i,e){const n=i.length;if(n<=1)return[i];const s=[];let l,h;for(let d=0;d<n;d++){const m=Pi(i[d]);m!==0&&(i[d].area=Math.abs(m),h===void 0&&(h=m<0),h===m<0?(l&&s.push(l),l=[i[d]]):l.push(i[d]))}if(l&&s.push(l),e>1)for(let d=0;d<s.length;d++)s[d].length<=e||(ef(s[d],e,1,s[d].length-1,nf),s[d]=s[d].slice(0,e));return s}function nf(i,e){return e.area-i.area}function cu(i,e,n){const s=n.patternDependencies;let l=!1;for(const h of e){const d=h.paint.get(`${i}-pattern`);d.isConstant()||(l=!0);const m=d.constantOr(null);m&&(l=!0,s[m.to]=!0,s[m.from]=!0)}return l}function uu(i,e,n,s,l){const h=l.patternDependencies;for(const d of e){const m=d.paint.get(`${i}-pattern`).value;if(m.kind!=="constant"){let x=m.evaluate({zoom:s-1},n,{},l.availableImages),w=m.evaluate({zoom:s},n,{},l.availableImages),I=m.evaluate({zoom:s+1},n,{},l.availableImages);x=x&&x.name?x.name:x,w=w&&w.name?w.name:w,I=I&&I.name?I.name:I,h[x]=!0,h[w]=!0,h[I]=!0,n.patterns[d.id]={min:x,mid:w,max:I}}}return n}class hu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new me,this.indexArray=new Ye,this.indexArray2=new Ht,this.programConfigurations=new ds(e.layers,e.zoom),this.segments=new ht,this.segments2=new ht,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){this.hasPattern=cu("fill",this.layers,n);const l=this.layers[0].layout.get("fill-sort-key"),h=!l.isConstant(),d=[];for(const{feature:m,id:x,index:w,sourceLayerIndex:I}of e){const C=this.layers[0]._featureFilter.needGeometry,L=Dr(m,C);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),L,s))continue;const F=h?l.evaluate(L,{},s,n.availableImages):void 0,U={id:x,properties:m.properties,type:m.type,sourceLayerIndex:I,index:w,geometry:C?L.geometry:Xr(m),patterns:{},sortKey:F};d.push(U)}h&&d.sort((m,x)=>m.sortKey-x.sortKey);for(const m of d){const{geometry:x,index:w,sourceLayerIndex:I}=m;if(this.hasPattern){const C=uu("fill",this.layers,m,this.zoom,n);this.patternFeatures.push(C)}else this.addFeature(m,x,w,s,{});n.featureIndex.insert(e[w].feature,x,w,I,this.index)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}addFeatures(e,n,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,l,h){for(const d of lu(n,500)){let m=0;for(const F of d)m+=F.length;const x=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),w=x.vertexLength,I=[],C=[];for(const F of d){if(F.length===0)continue;F!==d[0]&&C.push(I.length/2);const U=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),Z=U.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(Z+F.length-1,Z),I.push(F[0].x),I.push(F[0].y);for(let Y=1;Y<F.length;Y++)this.layoutVertexArray.emplaceBack(F[Y].x,F[Y].y),this.indexArray2.emplaceBack(Z+Y-1,Z+Y),I.push(F[Y].x),I.push(F[Y].y);U.vertexLength+=F.length,U.primitiveLength+=F.length}const L=yh(I,C);for(let F=0;F<L.length;F+=3)this.indexArray.emplaceBack(w+L[F],w+L[F+1],w+L[F+2]);x.vertexLength+=m,x.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,l)}}let vh,bh;He("FillBucket",hu,{omit:["layers","patternFeatures"]});var rf={get paint(){return bh=bh||new Ri({"fill-antialias":new nt(ye.paint_fill["fill-antialias"]),"fill-opacity":new ct(ye.paint_fill["fill-opacity"]),"fill-color":new ct(ye.paint_fill["fill-color"]),"fill-outline-color":new ct(ye.paint_fill["fill-outline-color"]),"fill-translate":new nt(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new nt(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new jo(ye.paint_fill["fill-pattern"])})},get layout(){return vh=vh||new Ri({"fill-sort-key":new ct(ye.layout_fill["fill-sort-key"])})}};class sf extends vr{constructor(e){super(e,rf)}recalculate(e,n){super.recalculate(e,n);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new hu(e)}queryRadius(){return Jl(this.paint.get("fill-translate"))}queryIntersectsFeature(e,n,s,l,h,d,m){return ih(Ql(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,m),l)}isTileClipped(){return!0}}const of=wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),af=wi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:lf}=of;var Ls={},cf=z,wh=Qo;function Qo(i,e,n,s,l){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=l,i.readFields(uf,this,e)}function uf(i,e,n){i==1?e.id=n.readVarint():i==2?function(s,l){for(var h=s.readVarint()+s.pos;s.pos<h;){var d=l._keys[s.readVarint()],m=l._values[s.readVarint()];l.properties[d]=m}}(n,e):i==3?e.type=n.readVarint():i==4&&(e._geometry=n.pos)}function hf(i){for(var e,n,s=0,l=0,h=i.length,d=h-1;l<h;d=l++)s+=((n=i[d]).x-(e=i[l]).x)*(e.y+n.y);return s}Qo.types=["Unknown","Point","LineString","Polygon"],Qo.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,n=i.readVarint()+i.pos,s=1,l=0,h=0,d=0,m=[];i.pos<n;){if(l<=0){var x=i.readVarint();s=7&x,l=x>>3}if(l--,s===1||s===2)h+=i.readSVarint(),d+=i.readSVarint(),s===1&&(e&&m.push(e),e=[]),e.push(new cf(h,d));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&m.push(e),m},Qo.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,n=1,s=0,l=0,h=0,d=1/0,m=-1/0,x=1/0,w=-1/0;i.pos<e;){if(s<=0){var I=i.readVarint();n=7&I,s=I>>3}if(s--,n===1||n===2)(l+=i.readSVarint())<d&&(d=l),l>m&&(m=l),(h+=i.readSVarint())<x&&(x=h),h>w&&(w=h);else if(n!==7)throw new Error("unknown command "+n)}return[d,x,m,w]},Qo.prototype.toGeoJSON=function(i,e,n){var s,l,h=this.extent*Math.pow(2,n),d=this.extent*i,m=this.extent*e,x=this.loadGeometry(),w=Qo.types[this.type];function I(F){for(var U=0;U<F.length;U++){var Z=F[U];F[U]=[360*(Z.x+d)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(Z.y+m)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(s=0;s<x.length;s++)C[s]=x[s][0];I(x=C);break;case 2:for(s=0;s<x.length;s++)I(x[s]);break;case 3:for(x=function(F){var U=F.length;if(U<=1)return[F];for(var Z,Y,Q=[],oe=0;oe<U;oe++){var ie=hf(F[oe]);ie!==0&&(Y===void 0&&(Y=ie<0),Y===ie<0?(Z&&Q.push(Z),Z=[F[oe]]):Z.push(F[oe]))}return Z&&Q.push(Z),Q}(x),s=0;s<x.length;s++)for(l=0;l<x[s].length;l++)I(x[s][l])}x.length===1?x=x[0]:w="Multi"+w;var L={type:"Feature",geometry:{type:w,coordinates:x},properties:this.properties};return"id"in this&&(L.id=this.id),L};var pf=wh,Th=Sh;function Sh(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(df,this,e),this.length=this._features.length}function df(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push(function(s){for(var l=null,h=s.readVarint()+s.pos;s.pos<h;){var d=s.readVarint()>>3;l=d===1?s.readString():d===2?s.readFloat():d===3?s.readDouble():d===4?s.readVarint64():d===5?s.readVarint():d===6?s.readSVarint():d===7?s.readBoolean():null}return l}(n))}Sh.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new pf(this._pbf,e,this.extent,this._keys,this._values)};var ff=Th;function mf(i,e,n){if(i===3){var s=new ff(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}Ls.VectorTile=function(i,e){this.layers=i.readFields(mf,{},e)},Ls.VectorTileFeature=wh,Ls.VectorTileLayer=Th;const gf=Ls.VectorTileFeature.types,pu=Math.pow(2,13);function Qa(i,e,n,s,l,h,d,m){i.emplaceBack(e,n,2*Math.floor(s*pu)+d,l*pu*2,h*pu*2,Math.round(m))}class du{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new _e,this.centroidVertexArray=new K,this.indexArray=new Ye,this.programConfigurations=new ds(e.layers,e.zoom),this.segments=new ht,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){this.features=[],this.hasPattern=cu("fill-extrusion",this.layers,n);for(const{feature:l,id:h,index:d,sourceLayerIndex:m}of e){const x=this.layers[0]._featureFilter.needGeometry,w=Dr(l,x);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),w,s))continue;const I={id:h,sourceLayerIndex:m,index:d,geometry:x?w.geometry:Xr(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(uu("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,d,s,{}),n.featureIndex.insert(l,I.geometry,d,m,this.index,!0)}}addFeatures(e,n,s){for(const l of this.features){const{geometry:h}=l;this.addFeature(l,h,l.index,n,s)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lf),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,af.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,s,l,h){const d={x:0,y:0,vertexCount:0};for(const m of lu(n,500)){let x=0;for(const U of m)x+=U.length;let w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const U of m){if(U.length===0||yf(U))continue;let Z=0;for(let Y=0;Y<U.length;Y++){const Q=U[Y];if(Y>=1){const oe=U[Y-1];if(!_f(Q,oe)){w.vertexLength+4>ht.MAX_VERTEX_ARRAY_LENGTH&&(w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ie=Q.sub(oe)._perp()._unit(),le=oe.dist(Q);Z+le>32768&&(Z=0),Qa(this.layoutVertexArray,Q.x,Q.y,ie.x,ie.y,0,0,Z),Qa(this.layoutVertexArray,Q.x,Q.y,ie.x,ie.y,0,1,Z),d.x+=2*Q.x,d.y+=2*Q.y,d.vertexCount+=2,Z+=le,Qa(this.layoutVertexArray,oe.x,oe.y,ie.x,ie.y,0,0,Z),Qa(this.layoutVertexArray,oe.x,oe.y,ie.x,ie.y,0,1,Z),d.x+=2*oe.x,d.y+=2*oe.y,d.vertexCount+=2;const he=w.vertexLength;this.indexArray.emplaceBack(he,he+2,he+1),this.indexArray.emplaceBack(he+1,he+2,he+3),w.vertexLength+=4,w.primitiveLength+=2}}}}if(w.vertexLength+x>ht.MAX_VERTEX_ARRAY_LENGTH&&(w=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),gf[e.type]!=="Polygon")continue;const I=[],C=[],L=w.vertexLength;for(const U of m)if(U.length!==0){U!==m[0]&&C.push(I.length/2);for(let Z=0;Z<U.length;Z++){const Y=U[Z];Qa(this.layoutVertexArray,Y.x,Y.y,0,0,1,1,0),d.x+=Y.x,d.y+=Y.y,d.vertexCount+=1,I.push(Y.x),I.push(Y.y)}}const F=yh(I,C);for(let U=0;U<F.length;U+=3)this.indexArray.emplaceBack(L+F[U],L+F[U+2],L+F[U+1]);w.primitiveLength+=F.length/3,w.vertexLength+=x}for(let m=0;m<d.vertexCount;m++)this.centroidVertexArray.emplaceBack(Math.floor(d.x/d.vertexCount),Math.floor(d.y/d.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,l)}}function _f(i,e){return i.x===e.x&&(i.x<0||i.x>si)||i.y===e.y&&(i.y<0||i.y>si)}function yf(i){return i.every(e=>e.x<0)||i.every(e=>e.x>si)||i.every(e=>e.y<0)||i.every(e=>e.y>si)}let Eh;He("FillExtrusionBucket",du,{omit:["layers","features"]});var xf={get paint(){return Eh=Eh||new Ri({"fill-extrusion-opacity":new nt(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ct(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nt(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nt(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new jo(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ct(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ct(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new nt(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class vf extends vr{constructor(e){super(e,xf)}createBucket(e){return new du(e)}queryRadius(){return Jl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,n,s,l,h,d,m,x){const w=Ql(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,m),I=this.paint.get("fill-extrusion-height").evaluate(n,s),C=this.paint.get("fill-extrusion-base").evaluate(n,s),L=function(U,Z,Y,Q){const oe=[];for(const ie of U){const le=[ie.x,ie.y,0,1];ec(le,le,Z),oe.push(new H(le[0]/le[3],le[1]/le[3]))}return oe}(w,x),F=function(U,Z,Y,Q){const oe=[],ie=[],le=Q[8]*Z,he=Q[9]*Z,be=Q[10]*Z,Ge=Q[11]*Z,et=Q[8]*Y,qe=Q[9]*Y,$e=Q[10]*Y,Re=Q[11]*Y;for(const Xe of U){const Fe=[],Me=[];for(const ot of Xe){const tt=ot.x,bt=ot.y,Jt=Q[0]*tt+Q[4]*bt+Q[12],ei=Q[1]*tt+Q[5]*bt+Q[13],Fi=Q[2]*tt+Q[6]*bt+Q[14],Jn=Q[3]*tt+Q[7]*bt+Q[15],An=Fi+be,Mi=Jn+Ge,Zi=Jt+et,sn=ei+qe,Vn=Fi+$e,In=Jn+Re,Ci=new H((Jt+le)/Mi,(ei+he)/Mi);Ci.z=An/Mi,Fe.push(Ci);const Oi=new H(Zi/In,sn/In);Oi.z=Vn/In,Me.push(Oi)}oe.push(Fe),ie.push(Me)}return[oe,ie]}(l,C,I,x);return function(U,Z,Y){let Q=1/0;ih(Y,Z)&&(Q=Ah(Y,Z[0]));for(let oe=0;oe<Z.length;oe++){const ie=Z[oe],le=U[oe];for(let he=0;he<ie.length-1;he++){const be=ie[he],Ge=[be,ie[he+1],le[he+1],le[he],be];th(Y,Ge)&&(Q=Math.min(Q,Ah(Y,Ge)))}}return Q!==1/0&&Q}(F[0],F[1],L)}}function el(i,e){return i.x*e.x+i.y*e.y}function Ah(i,e){if(i.length===1){let n=0;const s=e[n++];let l;for(;!l||s.equals(l);)if(l=e[n++],!l)return 1/0;for(;n<e.length;n++){const h=e[n],d=i[0],m=l.sub(s),x=h.sub(s),w=d.sub(s),I=el(m,m),C=el(m,x),L=el(x,x),F=el(w,m),U=el(w,x),Z=I*L-C*C,Y=(L*F-C*U)/Z,Q=(I*U-C*F)/Z,oe=s.z*(1-Y-Q)+l.z*Y+h.z*Q;if(isFinite(oe))return oe}return 1/0}{let n=1/0;for(const s of e)n=Math.min(n,s.z);return n}}const bf=wi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:wf}=bf,Tf=wi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Sf}=Tf,Ef=Ls.VectorTileFeature.types,Af=Math.cos(Math.PI/180*37.5),Ih=Math.pow(2,14)/.5;class fu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new ve,this.layoutVertexArray2=new Ie,this.indexArray=new Ye,this.programConfigurations=new ds(e.layers,e.zoom),this.segments=new ht,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){this.hasPattern=cu("line",this.layers,n);const l=this.layers[0].layout.get("line-sort-key"),h=!l.isConstant(),d=[];for(const{feature:m,id:x,index:w,sourceLayerIndex:I}of e){const C=this.layers[0]._featureFilter.needGeometry,L=Dr(m,C);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),L,s))continue;const F=h?l.evaluate(L,{},s):void 0,U={id:x,properties:m.properties,type:m.type,sourceLayerIndex:I,index:w,geometry:C?L.geometry:Xr(m),patterns:{},sortKey:F};d.push(U)}h&&d.sort((m,x)=>m.sortKey-x.sortKey);for(const m of d){const{geometry:x,index:w,sourceLayerIndex:I}=m;if(this.hasPattern){const C=uu("line",this.layers,m,this.zoom,n);this.patternFeatures.push(C)}else this.addFeature(m,x,w,s,{});n.featureIndex.insert(e[w].feature,x,w,I,this.index)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}addFeatures(e,n,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Sf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,l,h){const d=this.layers[0].layout,m=d.get("line-join").evaluate(e,{}),x=d.get("line-cap"),w=d.get("line-miter-limit"),I=d.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const C of n)this.addLine(C,e,m,x,w,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,l)}addLine(e,n,s,l,h,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<e.length-1;Q++)this.totalDistance+=e[Q].dist(e[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=Ef[n.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let w=0;for(;w<x-1&&e[w].equals(e[w+1]);)w++;if(x<(m?3:2))return;s==="bevel"&&(h=1.05);const I=this.overscaling<=16?15*si/(512*this.overscaling):0,C=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let L,F,U,Z,Y;this.e1=this.e2=-1,m&&(L=e[x-2],Y=e[w].sub(L)._unit()._perp());for(let Q=w;Q<x;Q++){if(U=Q===x-1?m?e[w+1]:void 0:e[Q+1],U&&e[Q].equals(U))continue;Y&&(Z=Y),L&&(F=L),L=e[Q],Y=U?U.sub(L)._unit()._perp():Z,Z=Z||Y;let oe=Z.add(Y);oe.x===0&&oe.y===0||oe._unit();const ie=Z.x*Y.x+Z.y*Y.y,le=oe.x*Y.x+oe.y*Y.y,he=le!==0?1/le:1/0,be=2*Math.sqrt(2-2*le),Ge=le<Af&&F&&U,et=Z.x*Y.y-Z.y*Y.x>0;if(Ge&&Q>w){const Re=L.dist(F);if(Re>2*I){const Xe=L.sub(L.sub(F)._mult(I/Re)._round());this.updateDistance(F,Xe),this.addCurrentVertex(Xe,Z,0,0,C),F=Xe}}const qe=F&&U;let $e=qe?s:m?"butt":l;if(qe&&$e==="round"&&(he<d?$e="miter":he<=2&&($e="fakeround")),$e==="miter"&&he>h&&($e="bevel"),$e==="bevel"&&(he>2&&($e="flipbevel"),he<h&&($e="miter")),F&&this.updateDistance(F,L),$e==="miter")oe._mult(he),this.addCurrentVertex(L,oe,0,0,C);else if($e==="flipbevel"){if(he>100)oe=Y.mult(-1);else{const Re=he*Z.add(Y).mag()/Z.sub(Y).mag();oe._perp()._mult(Re*(et?-1:1))}this.addCurrentVertex(L,oe,0,0,C),this.addCurrentVertex(L,oe.mult(-1),0,0,C)}else if($e==="bevel"||$e==="fakeround"){const Re=-Math.sqrt(he*he-1),Xe=et?Re:0,Fe=et?0:Re;if(F&&this.addCurrentVertex(L,Z,Xe,Fe,C),$e==="fakeround"){const Me=Math.round(180*be/Math.PI/20);for(let ot=1;ot<Me;ot++){let tt=ot/Me;if(tt!==.5){const Jt=tt-.5;tt+=tt*Jt*(tt-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*Jt*Jt+(.848013+ie*(.215638*ie-1.06021)))}const bt=Y.sub(Z)._mult(tt)._add(Z)._unit()._mult(et?-1:1);this.addHalfVertex(L,bt.x,bt.y,!1,et,0,C)}}U&&this.addCurrentVertex(L,Y,-Xe,-Fe,C)}else if($e==="butt")this.addCurrentVertex(L,oe,0,0,C);else if($e==="square"){const Re=F?1:-1;this.addCurrentVertex(L,oe,Re,Re,C)}else $e==="round"&&(F&&(this.addCurrentVertex(L,Z,0,0,C),this.addCurrentVertex(L,Z,1,1,C,!0)),U&&(this.addCurrentVertex(L,Y,-1,-1,C,!0),this.addCurrentVertex(L,Y,0,0,C)));if(Ge&&Q<x-1){const Re=L.dist(U);if(Re>2*I){const Xe=L.add(U.sub(L)._mult(I/Re)._round());this.updateDistance(L,Xe),this.addCurrentVertex(Xe,Y,0,0,C),L=Xe}}}}addCurrentVertex(e,n,s,l,h,d=!1){const m=n.y*l-n.x,x=-n.y-n.x*l;this.addHalfVertex(e,n.x+n.y*s,n.y-n.x*s,d,!1,s,h),this.addHalfVertex(e,m,x,d,!0,-l,h),this.distance>Ih/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,s,l,h,d))}addHalfVertex({x:e,y:n},s,l,h,d,m,x){const w=.5*(this.lineClips?this.scaledDistance*(Ih-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(n<<1)+(d?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(m===0?0:m<0?-1:1)|(63&w)<<2,w>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),x.primitiveLength++),d?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}let Mh,Ch;He("LineBucket",fu,{omit:["layers","patternFeatures"]});var Ph={get paint(){return Ch=Ch||new Ri({"line-opacity":new ct(ye.paint_line["line-opacity"]),"line-color":new ct(ye.paint_line["line-color"]),"line-translate":new nt(ye.paint_line["line-translate"]),"line-translate-anchor":new nt(ye.paint_line["line-translate-anchor"]),"line-width":new ct(ye.paint_line["line-width"]),"line-gap-width":new ct(ye.paint_line["line-gap-width"]),"line-offset":new ct(ye.paint_line["line-offset"]),"line-blur":new ct(ye.paint_line["line-blur"]),"line-dasharray":new Oa(ye.paint_line["line-dasharray"]),"line-pattern":new jo(ye.paint_line["line-pattern"]),"line-gradient":new Ua(ye.paint_line["line-gradient"])})},get layout(){return Mh=Mh||new Ri({"line-cap":new nt(ye.layout_line["line-cap"]),"line-join":new ct(ye.layout_line["line-join"]),"line-miter-limit":new nt(ye.layout_line["line-miter-limit"]),"line-round-limit":new nt(ye.layout_line["line-round-limit"]),"line-sort-key":new ct(ye.layout_line["line-sort-key"])})}};class If extends ct{possiblyEvaluate(e,n){return n=new Qt(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,s,l){return n=De({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,s,l)}}let sc;class Mf extends vr{constructor(e){super(e,Ph),this.gradientVersion=0,sc||(sc=new If(Ph.paint.properties["line-width"].specification),sc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){e==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Hs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=sc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new fu(e)}queryRadius(e){const n=e,s=kh(Ga("line-width",this,n),Ga("line-gap-width",this,n)),l=Ga("line-offset",this,n);return s/2+Math.abs(l)+Jl(this.paint.get("line-translate"))}queryIntersectsFeature(e,n,s,l,h,d,m){const x=Ql(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,m),w=m/2*kh(this.paint.get("line-width").evaluate(n,s),this.paint.get("line-gap-width").evaluate(n,s)),I=this.paint.get("line-offset").evaluate(n,s);return I&&(l=function(C,L){const F=[];for(let U=0;U<C.length;U++){const Z=C[U],Y=[];for(let Q=0;Q<Z.length;Q++){const oe=Z[Q-1],ie=Z[Q],le=Z[Q+1],he=Q===0?new H(0,0):ie.sub(oe)._unit()._perp(),be=Q===Z.length-1?new H(0,0):le.sub(ie)._unit()._perp(),Ge=he._add(be)._unit(),et=Ge.x*be.x+Ge.y*be.y;et!==0&&Ge._mult(1/et),Y.push(Ge._mult(L)._add(ie))}F.push(Y)}return F}(l,I*m)),function(C,L,F){for(let U=0;U<L.length;U++){const Z=L[U];if(C.length>=3){for(let Y=0;Y<Z.length;Y++)if(Yo(C,Z[Y]))return!0}if(Dd(C,Z,F))return!0}return!1}(x,l,w)}isTileClipped(){return!0}}function kh(i,e){return e>0?e+2*i:i}const Cf=wi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Pf=wi([{name:"a_projected_pos",components:3,type:"Float32"}],4);wi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const kf=wi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);wi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zh=wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),zf=wi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Df(i,e,n){return i.sections.forEach(s=>{s.text=function(l,h,d){const m=h.layout.get("text-transform").evaluate(d,{});return m==="uppercase"?l=l.toLocaleUpperCase():m==="lowercase"&&(l=l.toLocaleLowerCase()),Kn.applyArabicShaping&&(l=Kn.applyArabicShaping(l)),l}(s.text,e,n)}),i}wi([{name:"triangle",components:3,type:"Uint16"}]),wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),wi([{type:"Float32",name:"offsetX"}]),wi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),wi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const tl={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Bi=24,Dh=qt,Lh=function(i,e,n,s,l){var h,d,m=8*l-s-1,x=(1<<m)-1,w=x>>1,I=-7,C=n?l-1:0,L=n?-1:1,F=i[e+C];for(C+=L,h=F&(1<<-I)-1,F>>=-I,I+=m;I>0;h=256*h+i[e+C],C+=L,I-=8);for(d=h&(1<<-I)-1,h>>=-I,I+=s;I>0;d=256*d+i[e+C],C+=L,I-=8);if(h===0)h=1-w;else{if(h===x)return d?NaN:1/0*(F?-1:1);d+=Math.pow(2,s),h-=w}return(F?-1:1)*d*Math.pow(2,h-s)},Rh=function(i,e,n,s,l,h){var d,m,x,w=8*h-l-1,I=(1<<w)-1,C=I>>1,L=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=s?0:h-1,U=s?1:-1,Z=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,d=I):(d=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-d))<1&&(d--,x*=2),(e+=d+C>=1?L/x:L*Math.pow(2,1-C))*x>=2&&(d++,x/=2),d+C>=I?(m=0,d=I):d+C>=1?(m=(e*x-1)*Math.pow(2,l),d+=C):(m=e*Math.pow(2,C-1)*Math.pow(2,l),d=0));l>=8;i[n+F]=255&m,F+=U,m/=256,l-=8);for(d=d<<l|m,w+=l;w>0;i[n+F]=255&d,F+=U,d/=256,w-=8);i[n+F-U]|=128*Z};function qt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}qt.Varint=0,qt.Fixed64=1,qt.Bytes=2,qt.Fixed32=5;var mu=4294967296,Bh=1/mu,Fh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function fs(i){return i.type===qt.Bytes?i.readVarint()+i.pos:i.pos+1}function ea(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Oh(i,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var l=n.pos-1;l>=i;l--)n.buf[l+s]=n.buf[l]}function Lf(i,e){for(var n=0;n<i.length;n++)e.writeVarint(i[n])}function Rf(i,e){for(var n=0;n<i.length;n++)e.writeSVarint(i[n])}function Bf(i,e){for(var n=0;n<i.length;n++)e.writeFloat(i[n])}function Ff(i,e){for(var n=0;n<i.length;n++)e.writeDouble(i[n])}function Of(i,e){for(var n=0;n<i.length;n++)e.writeBoolean(i[n])}function Uf(i,e){for(var n=0;n<i.length;n++)e.writeFixed32(i[n])}function Vf(i,e){for(var n=0;n<i.length;n++)e.writeSFixed32(i[n])}function $f(i,e){for(var n=0;n<i.length;n++)e.writeFixed64(i[n])}function Nf(i,e){for(var n=0;n<i.length;n++)e.writeSFixed64(i[n])}function oc(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function ta(i,e,n){i[n]=e,i[n+1]=e>>>8,i[n+2]=e>>>16,i[n+3]=e>>>24}function Uh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}qt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),l=s>>3,h=this.pos;this.type=7&s,i(l,e,this),this.pos===h&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=oc(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Uh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=oc(this.buf,this.pos)+oc(this.buf,this.pos+4)*mu;return this.pos+=8,i},readSFixed64:function(){var i=oc(this.buf,this.pos)+Uh(this.buf,this.pos+4)*mu;return this.pos+=8,i},readFloat:function(){var i=Lh(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Lh(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(l,h,d){var m,x,w=d.buf;if(m=(112&(x=w[d.pos++]))>>4,x<128||(m|=(127&(x=w[d.pos++]))<<3,x<128)||(m|=(127&(x=w[d.pos++]))<<10,x<128)||(m|=(127&(x=w[d.pos++]))<<17,x<128)||(m|=(127&(x=w[d.pos++]))<<24,x<128)||(m|=(1&(x=w[d.pos++]))<<31,x<128))return ea(l,m,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Fh?function(n,s,l){return Fh.decode(n.subarray(s,l))}(this.buf,e,i):function(n,s,l){for(var h="",d=s;d<l;){var m,x,w,I=n[d],C=null,L=I>239?4:I>223?3:I>191?2:1;if(d+L>l)break;L===1?I<128&&(C=I):L===2?(192&(m=n[d+1]))==128&&(C=(31&I)<<6|63&m)<=127&&(C=null):L===3?(x=n[d+2],(192&(m=n[d+1]))==128&&(192&x)==128&&((C=(15&I)<<12|(63&m)<<6|63&x)<=2047||C>=55296&&C<=57343)&&(C=null)):L===4&&(x=n[d+2],w=n[d+3],(192&(m=n[d+1]))==128&&(192&x)==128&&(192&w)==128&&((C=(15&I)<<18|(63&m)<<12|(63&x)<<6|63&w)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,L=1):C>65535&&(C-=65536,h+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),h+=String.fromCharCode(C),d+=L}return h}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==qt.Bytes)return i.push(this.readVarint(e));var n=fs(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==qt.Bytes)return i.push(this.readSVarint());var e=fs(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==qt.Bytes)return i.push(this.readBoolean());var e=fs(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==qt.Bytes)return i.push(this.readFloat());var e=fs(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==qt.Bytes)return i.push(this.readDouble());var e=fs(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==qt.Bytes)return i.push(this.readFixed32());var e=fs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==qt.Bytes)return i.push(this.readSFixed32());var e=fs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==qt.Bytes)return i.push(this.readFixed64());var e=fs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==qt.Bytes)return i.push(this.readSFixed64());var e=fs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===qt.Varint)for(;this.buf[this.pos++]>127;);else if(e===qt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===qt.Fixed32)this.pos+=4;else{if(e!==qt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),ta(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),ta(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),ta(this.buf,-1&i,this.pos),ta(this.buf,Math.floor(i*Bh),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),ta(this.buf,-1&i,this.pos),ta(this.buf,Math.floor(i*Bh),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,n){var s,l;if(e>=0?(s=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(h,d,m){m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,m.buf[m.pos]=127&(h>>>=7)}(s,0,n),function(h,d){var m=(7&h)<<4;d.buf[d.pos++]|=m|((h>>>=3)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h)))))}(l,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,l,h){for(var d,m,x=0;x<l.length;x++){if((d=l.charCodeAt(x))>55295&&d<57344){if(!m){d>56319||x+1===l.length?(s[h++]=239,s[h++]=191,s[h++]=189):m=d;continue}if(d<56320){s[h++]=239,s[h++]=191,s[h++]=189,m=d;continue}d=m-55296<<10|d-56320|65536,m=null}else m&&(s[h++]=239,s[h++]=191,s[h++]=189,m=null);d<128?s[h++]=d:(d<2048?s[h++]=d>>6|192:(d<65536?s[h++]=d>>12|224:(s[h++]=d>>18|240,s[h++]=d>>12&63|128),s[h++]=d>>6&63|128),s[h++]=63&d|128)}return h}(this.buf,i,this.pos);var n=this.pos-e;n>=128&&Oh(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),Rh(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Rh(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,e){this.pos++;var n=this.pos;i(e,this);var s=this.pos-n;s>=128&&Oh(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,n){this.writeTag(i,qt.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Lf,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Rf,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Of,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Bf,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Ff,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Uf,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Vf,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,$f,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Nf,e)},writeBytesField:function(i,e){this.writeTag(i,qt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,qt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,qt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,qt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,qt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,qt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,qt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,qt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,qt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,qt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var gu=O(Dh);const _u=3;function jf(i,e,n){i===1&&n.readMessage(qf,e)}function qf(i,e,n){if(i===3){const{id:s,bitmap:l,width:h,height:d,left:m,top:x,advance:w}=n.readMessage(Zf,{});e.push({id:s,bitmap:new Ha({width:h+2*_u,height:d+2*_u},l),metrics:{width:h,height:d,left:m,top:x,advance:w}})}}function Zf(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}const Vh=_u;function $h(i){let e=0,n=0;for(const d of i)e+=d.w*d.h,n=Math.max(n,d.w);i.sort((d,m)=>m.h-d.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let l=0,h=0;for(const d of i)for(let m=s.length-1;m>=0;m--){const x=s[m];if(!(d.w>x.w||d.h>x.h)){if(d.x=x.x,d.y=x.y,h=Math.max(h,d.y+d.h),l=Math.max(l,d.x+d.w),d.w===x.w&&d.h===x.h){const w=s.pop();m<s.length&&(s[m]=w)}else d.h===x.h?(x.x+=d.w,x.w-=d.w):d.w===x.w?(x.y+=d.h,x.h-=d.h):(s.push({x:x.x+d.w,y:x.y,w:x.w-d.w,h:d.h}),x.y+=d.h,x.h-=d.h);break}}return{w:l,h,fill:e/(l*h)||0}}const Un=1;class yu{constructor(e,{pixelRatio:n,version:s,stretchX:l,stretchY:h,content:d}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=l,this.stretchY=h,this.content=d,this.version=s}get tl(){return[this.paddedRect.x+Un,this.paddedRect.y+Un]}get br(){return[this.paddedRect.x+this.paddedRect.w-Un,this.paddedRect.y+this.paddedRect.h-Un]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Un)/this.pixelRatio,(this.paddedRect.h-2*Un)/this.pixelRatio]}}class Nh{constructor(e,n){const s={},l={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,s,h),this.addImages(n,l,h);const{w:d,h:m}=$h(h),x=new cr({width:d||1,height:m||1});for(const w in e){const I=e[w],C=s[w].paddedRect;cr.copy(I.data,x,{x:0,y:0},{x:C.x+Un,y:C.y+Un},I.data)}for(const w in n){const I=n[w],C=l[w].paddedRect,L=C.x+Un,F=C.y+Un,U=I.data.width,Z=I.data.height;cr.copy(I.data,x,{x:0,y:0},{x:L,y:F},I.data),cr.copy(I.data,x,{x:0,y:Z-1},{x:L,y:F-1},{width:U,height:1}),cr.copy(I.data,x,{x:0,y:0},{x:L,y:F+Z},{width:U,height:1}),cr.copy(I.data,x,{x:U-1,y:0},{x:L-1,y:F},{width:1,height:Z}),cr.copy(I.data,x,{x:0,y:0},{x:L+U,y:F},{width:1,height:Z})}this.image=x,this.iconPositions=s,this.patternPositions=l}addImages(e,n,s){for(const l in e){const h=e[l],d={x:0,y:0,w:h.data.width+2*Un,h:h.data.height+2*Un};s.push(d),n[l]=new yu(d,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;const[l,h]=e.tl;s.update(n.data,void 0,{x:l,y:h})}}var Rs;He("ImagePosition",yu),He("ImageAtlas",Nh),o.WritingMode=void 0,(Rs=o.WritingMode||(o.WritingMode={}))[Rs.none=0]="none",Rs[Rs.horizontal=1]="horizontal",Rs[Rs.vertical=2]="vertical",Rs[Rs.horizontalOnly=3]="horizontalOnly";const il=-17;class nl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const s=new nl;return s.scale=e||1,s.fontStack=n,s}static forImage(e){const n=new nl;return n.imageName=e,n}}class ia{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const s=new ia;for(let l=0;l<e.sections.length;l++){const h=e.sections[l];h.image?s.addImageSection(h):s.addTextSection(h,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let n="";for(let s=0;s<e.length;s++){const l=e.charCodeAt(s+1)||null,h=e.charCodeAt(s-1)||null;n+=l&&Pa(l)&&!tl[e[s+1]]||h&&Pa(h)&&!tl[e[s-1]]||!tl[e[s]]?e[s]:tl[e[s]]}return n}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&lc[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&lc[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const s=new ia;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(nl.forText(e.scale,e.fontStack||n));const s=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(s)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void vt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(nl.forImage(n)),this.sectionIndex.push(this.sections.length-1)):vt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ac(i,e,n,s,l,h,d,m,x,w,I,C,L,F,U,Z){const Y=ia.fromFeature(i,l);let Q;C===o.WritingMode.vertical&&Y.verticalizePunctuation();const{processBidirectionalText:oe,processStyledBidirectionalText:ie}=Kn;if(oe&&Y.sections.length===1){Q=[];const be=oe(Y.toString(),xu(Y,w,h,e,s,F,U));for(const Ge of be){const et=new ia;et.text=Ge,et.sections=Y.sections;for(let qe=0;qe<Ge.length;qe++)et.sectionIndex.push(0);Q.push(et)}}else if(ie){Q=[];const be=ie(Y.text,Y.sectionIndex,xu(Y,w,h,e,s,F,U));for(const Ge of be){const et=new ia;et.text=Ge[0],et.sectionIndex=Ge[1],et.sections=Y.sections,Q.push(et)}}else Q=function(be,Ge){const et=[],qe=be.text;let $e=0;for(const Re of Ge)et.push(be.substring($e,Re)),$e=Re;return $e<qe.length&&et.push(be.substring($e,qe.length)),et}(Y,xu(Y,w,h,e,s,F,U));const le=[],he={positionedLines:le,text:Y.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:C,iconsInText:!1,verticalizable:!1};return function(be,Ge,et,qe,$e,Re,Xe,Fe,Me,ot,tt,bt){let Jt=0,ei=il,Fi=0,Jn=0;const An=Fe==="right"?1:Fe==="left"?0:.5;let Mi=0;for(const Ci of $e){Ci.trim();const Oi=Ci.getMaxScale(),fn=(Oi-1)*Bi,Mn={positionedGlyphs:[],lineOffset:0};be.positionedLines[Mi]=Mn;const $n=Mn.positionedGlyphs;let Nn=0;if(!Ci.length()){ei+=Re,++Mi;continue}for(let on=0;on<Ci.length();on++){const Mt=Ci.getSection(on),Qn=Ci.getSectionIndex(on),an=Ci.getCharCode(on);let Cn=0,br=null,Lr=null,Rr=null,ms=Bi;const wr=!(Me===o.WritingMode.horizontal||!tt&&!Is(an)||tt&&(lc[an]||(Zi=an,Ze.Arabic(Zi)||Ze["Arabic Supplement"](Zi)||Ze["Arabic Extended-A"](Zi)||Ze["Arabic Presentation Forms-A"](Zi)||Ze["Arabic Presentation Forms-B"](Zi))));if(Mt.imageName){const hr=qe[Mt.imageName];if(!hr)continue;Rr=Mt.imageName,be.iconsInText=be.iconsInText||!0,Lr=hr.paddedRect;const jn=hr.displaySize;Mt.scale=Mt.scale*Bi/bt,br={width:jn[0],height:jn[1],left:Un,top:-Vh,advance:wr?jn[1]:jn[0]},Cn=fn+(Bi-jn[1]*Mt.scale),ms=br.advance;const gs=wr?jn[0]*Mt.scale-Bi*Oi:jn[1]*Mt.scale-Bi*Oi;gs>0&&gs>Nn&&(Nn=gs)}else{const hr=et[Mt.fontStack],jn=hr&&hr[an];if(jn&&jn.rect)Lr=jn.rect,br=jn.metrics;else{const gs=Ge[Mt.fontStack],ll=gs&&gs[an];if(!ll)continue;br=ll.metrics}Cn=(Oi-Mt.scale)*Bi}wr?(be.verticalizable=!0,$n.push({glyph:an,imageName:Rr,x:Jt,y:ei+Cn,vertical:wr,scale:Mt.scale,fontStack:Mt.fontStack,sectionIndex:Qn,metrics:br,rect:Lr}),Jt+=ms*Mt.scale+ot):($n.push({glyph:an,imageName:Rr,x:Jt,y:ei+Cn,vertical:wr,scale:Mt.scale,fontStack:Mt.fontStack,sectionIndex:Qn,metrics:br,rect:Lr}),Jt+=br.advance*Mt.scale+ot)}$n.length!==0&&(Fi=Math.max(Jt-ot,Fi),Hf($n,0,$n.length-1,An,Nn)),Jt=0;const pi=Re*Oi+Nn;Mn.lineOffset=Math.max(Nn,fn),ei+=pi,Jn=Math.max(pi,Jn),++Mi}var Zi;const sn=ei-il,{horizontalAlign:Vn,verticalAlign:In}=vu(Xe);(function(Ci,Oi,fn,Mn,$n,Nn,pi,on,Mt){const Qn=(Oi-fn)*$n;let an=0;an=Nn!==pi?-on*Mn-il:(-Mn*Mt+.5)*pi;for(const Cn of Ci)for(const br of Cn.positionedGlyphs)br.x+=Qn,br.y+=an})(be.positionedLines,An,Vn,In,Fi,Jn,Re,sn,$e.length),be.top+=-In*sn,be.bottom=be.top+sn,be.left+=-Vn*Fi,be.right=be.left+Fi}(he,e,n,s,Q,d,m,x,C,w,L,Z),!function(be){for(const Ge of be)if(Ge.positionedGlyphs.length!==0)return!1;return!0}(le)&&he}const lc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Gf={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function jh(i,e,n,s,l,h){if(e.imageName){const d=s[e.imageName];return d?d.displaySize[0]*e.scale*Bi/h+l:0}{const d=n[e.fontStack],m=d&&d[i];return m?m.metrics.advance*e.scale+l:0}}function qh(i,e,n,s){const l=Math.pow(i-e,2);return s?i<e?l/2:2*l:l+Math.abs(n)*n}function Wf(i,e,n){let s=0;return i===10&&(s-=1e4),n&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Zh(i,e,n,s,l,h){let d=null,m=qh(e,n,l,h);for(const x of s){const w=qh(e-x.x,n,l,h)+x.badness;w<=m&&(d=x,m=w)}return{index:i,x:e,priorBreak:d,badness:m}}function Gh(i){return i?Gh(i.priorBreak).concat(i.index):[]}function xu(i,e,n,s,l,h,d){if(h!=="point")return[];if(!i)return[];const m=[],x=function(L,F,U,Z,Y,Q){let oe=0;for(let ie=0;ie<L.length();ie++){const le=L.getSection(ie);oe+=jh(L.getCharCode(ie),le,Z,Y,F,Q)}return oe/Math.max(1,Math.ceil(oe/U))}(i,e,n,s,l,d),w=i.text.indexOf("​")>=0;let I=0;for(let L=0;L<i.length();L++){const F=i.getSection(L),U=i.getCharCode(L);if(lc[U]||(I+=jh(U,F,s,l,e,d)),L<i.length()-1){const Z=!((C=U)<11904||!(Ze["Bopomofo Extended"](C)||Ze.Bopomofo(C)||Ze["CJK Compatibility Forms"](C)||Ze["CJK Compatibility Ideographs"](C)||Ze["CJK Compatibility"](C)||Ze["CJK Radicals Supplement"](C)||Ze["CJK Strokes"](C)||Ze["CJK Symbols and Punctuation"](C)||Ze["CJK Unified Ideographs Extension A"](C)||Ze["CJK Unified Ideographs"](C)||Ze["Enclosed CJK Letters and Months"](C)||Ze["Halfwidth and Fullwidth Forms"](C)||Ze.Hiragana(C)||Ze["Ideographic Description Characters"](C)||Ze["Kangxi Radicals"](C)||Ze["Katakana Phonetic Extensions"](C)||Ze.Katakana(C)||Ze["Vertical Forms"](C)||Ze["Yi Radicals"](C)||Ze["Yi Syllables"](C)));(Gf[U]||Z||F.imageName)&&m.push(Zh(L+1,I,x,m,Wf(U,i.getCharCode(L+1),Z&&w),!1))}}var C;return Gh(Zh(i.length(),I,x,m,0,!0))}function vu(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Hf(i,e,n,s,l){if(!s&&!l)return;const h=i[n],d=(i[n].x+h.metrics.advance*h.scale)*s;for(let m=e;m<=n;m++)i[m].x-=d,i[m].y+=l}function Xf(i,e,n){const{horizontalAlign:s,verticalAlign:l}=vu(n),h=e[0]-i.displaySize[0]*s,d=e[1]-i.displaySize[1]*l;return{image:i,top:d,bottom:d+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function Wh(i,e,n,s,l,h){const d=i.image;let m;if(d.content){const Y=d.content,Q=d.pixelRatio||1;m=[Y[0]/Q,Y[1]/Q,d.displaySize[0]-Y[2]/Q,d.displaySize[1]-Y[3]/Q]}const x=e.left*h,w=e.right*h;let I,C,L,F;n==="width"||n==="both"?(F=l[0]+x-s[3],C=l[0]+w+s[1]):(F=l[0]+(x+w-d.displaySize[0])/2,C=F+d.displaySize[0]);const U=e.top*h,Z=e.bottom*h;return n==="height"||n==="both"?(I=l[1]+U-s[0],L=l[1]+Z+s[2]):(I=l[1]+(U+Z-d.displaySize[1])/2,L=I+d.displaySize[1]),{image:d,top:I,right:C,bottom:L,left:F,collisionPadding:m}}const rl=255,Yr=128,Bs=rl*Yr;function Hh(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Qt(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=n;let h=0;for(;h<s.length&&s[h]<=i;)h++;h=Math.max(0,h-1);let d=h;for(;d<s.length&&s[d]<i+1;)d++;d=Math.min(s.length-1,d);const m=s[h],x=s[d];return n.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:x,interpolationType:l}:{kind:"camera",minZoom:m,maxZoom:x,minSize:n.evaluate(new Qt(m)),maxSize:n.evaluate(new Qt(x)),interpolationType:l}}}function bu(i,e,n){let s="never";const l=i.get(e);return l?s=l:i.get(n)&&(s="always"),s}const Yf=Ls.VectorTileFeature.types,Kf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function cc(i,e,n,s,l,h,d,m,x,w,I,C,L){const F=m?Math.min(Bs,Math.round(m[0])):0,U=m?Math.min(Bs,Math.round(m[1])):0;i.emplaceBack(e,n,Math.round(32*s),Math.round(32*l),h,d,(F<<1)+(x?1:0),U,16*w,16*I,256*C,256*L)}function wu(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function Jf(i){for(const e of i.sections)if(Yc(e.text))return!0;return!1}class Tu{constructor(e){this.layoutVertexArray=new ke,this.indexArray=new Ye,this.programConfigurations=e,this.segments=new ht,this.dynamicLayoutVertexArray=new Qe,this.opacityVertexArray=new At,this.hasVisibleVertices=!1,this.placedSymbolArray=new A}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,s,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Pf.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Kf,!0),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}He("SymbolBuffers",Tu);class Su{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new ht,this.collisionVertexArray=new ut}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,kf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}He("CollisionBuffers",Su);class na{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=tu([]),this.placementViewportMatrix=tu([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Hh(this.zoom,n["text-size"]),this.iconSizeData=Hh(this.zoom,n["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),h=s.get("symbol-z-order");this.canOverlap=bu(s,"text-overlap","text-allow-overlap")!=="never"||bu(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(d=>o.WritingMode[d])),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID}createArrays(){this.text=new Tu(new ds(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Tu(new ds(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new q,this.lineVertexArray=new j,this.symbolInstances=new B,this.textAnchorOffsets=new N}calculateGlyphDependencies(e,n,s,l,h){for(let d=0;d<e.length;d++)if(n[e.charCodeAt(d)]=!0,(s||l)&&h){const m=tl[e.charAt(d)];m&&(n[m.charCodeAt(0)]=!0)}}populate(e,n,s){const l=this.layers[0],h=l.layout,d=h.get("text-font"),m=h.get("text-field"),x=h.get("icon-image"),w=(m.value.kind!=="constant"||m.value.value instanceof _i&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(d.value.kind!=="constant"||d.value.value.length>0),I=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,C=h.get("symbol-sort-key");if(this.features=[],!w&&!I)return;const L=n.iconDependencies,F=n.glyphDependencies,U=n.availableImages,Z=new Qt(this.zoom);for(const{feature:Y,id:Q,index:oe,sourceLayerIndex:ie}of e){const le=l._featureFilter.needGeometry,he=Dr(Y,le);if(!l._featureFilter.filter(Z,he,s))continue;let be,Ge;if(le||(he.geometry=Xr(Y)),w){const qe=l.getValueAndResolveTokens("text-field",he,s,U),$e=_i.factory(qe);Jf($e)&&(this.hasRTLText=!0),(!this.hasRTLText||Ba()==="unavailable"||this.hasRTLText&&Kn.isParsed())&&(be=Df($e,l,he))}if(I){const qe=l.getValueAndResolveTokens("icon-image",he,s,U);Ge=qe instanceof Hn?qe:Hn.fromString(qe)}if(!be&&!Ge)continue;const et=this.sortFeaturesByKey?C.evaluate(he,{},s):void 0;if(this.features.push({id:Q,text:be,icon:Ge,index:oe,sourceLayerIndex:ie,geometry:he.geometry,properties:Y.properties,type:Yf[Y.type],sortKey:et}),Ge&&(L[Ge.name]=!0),be){const qe=d.evaluate(he,{},s).join(","),$e=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.WritingMode.vertical)>=0;for(const Re of be.sections)if(Re.image)L[Re.image.name]=!0;else{const Xe=Vo(be.toString()),Fe=Re.fontStack||qe,Me=F[Fe]=F[Fe]||{};this.calculateGlyphDependencies(Re.text,Me,$e,this.allowVerticalPlacement,Xe)}}}h.get("symbol-placement")==="line"&&(this.features=function(Y){const Q={},oe={},ie=[];let le=0;function he(qe){ie.push(Y[qe]),le++}function be(qe,$e,Re){const Xe=oe[qe];return delete oe[qe],oe[$e]=Xe,ie[Xe].geometry[0].pop(),ie[Xe].geometry[0]=ie[Xe].geometry[0].concat(Re[0]),Xe}function Ge(qe,$e,Re){const Xe=Q[$e];return delete Q[$e],Q[qe]=Xe,ie[Xe].geometry[0].shift(),ie[Xe].geometry[0]=Re[0].concat(ie[Xe].geometry[0]),Xe}function et(qe,$e,Re){const Xe=Re?$e[0][$e[0].length-1]:$e[0][0];return`${qe}:${Xe.x}:${Xe.y}`}for(let qe=0;qe<Y.length;qe++){const $e=Y[qe],Re=$e.geometry,Xe=$e.text?$e.text.toString():null;if(!Xe){he(qe);continue}const Fe=et(Xe,Re),Me=et(Xe,Re,!0);if(Fe in oe&&Me in Q&&oe[Fe]!==Q[Me]){const ot=Ge(Fe,Me,Re),tt=be(Fe,Me,ie[ot].geometry);delete Q[Fe],delete oe[Me],oe[et(Xe,ie[tt].geometry,!0)]=tt,ie[ot].geometry=null}else Fe in oe?be(Fe,Me,Re):Me in Q?Ge(Fe,Me,Re):(he(qe),Q[Fe]=le-1,oe[Me]=le-1)}return ie.filter(qe=>qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Y,Q)=>Y.sortKey-Q.sortKey)}update(e,n,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const s=this.lineVertexArray.length;if(e.segment!==void 0){let l=e.dist(n[e.segment+1]),h=e.dist(n[e.segment]);const d={};for(let m=e.segment+1;m<n.length;m++)d[m]={x:n[m].x,y:n[m].y,tileUnitDistanceFromAnchor:l},m<n.length-1&&(l+=n[m+1].dist(n[m]));for(let m=e.segment||0;m>=0;m--)d[m]={x:n[m].x,y:n[m].y,tileUnitDistanceFromAnchor:h},m>0&&(h+=n[m-1].dist(n[m]));for(let m=0;m<n.length;m++){const x=d[m];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,l,h,d,m,x,w,I,C,L){const F=e.indexArray,U=e.layoutVertexArray,Z=e.segments.prepareSegment(4*n.length,U,F,this.canOverlap?d.sortKey:void 0),Y=this.glyphOffsetArray.length,Q=Z.vertexLength,oe=this.allowVerticalPlacement&&m===o.WritingMode.vertical?Math.PI/2:0,ie=d.text&&d.text.sections;for(let le=0;le<n.length;le++){const{tl:he,tr:be,bl:Ge,br:et,tex:qe,pixelOffsetTL:$e,pixelOffsetBR:Re,minFontScaleX:Xe,minFontScaleY:Fe,glyphOffset:Me,isSDF:ot,sectionIndex:tt}=n[le],bt=Z.vertexLength,Jt=Me[1];cc(U,x.x,x.y,he.x,Jt+he.y,qe.x,qe.y,s,ot,$e.x,$e.y,Xe,Fe),cc(U,x.x,x.y,be.x,Jt+be.y,qe.x+qe.w,qe.y,s,ot,Re.x,$e.y,Xe,Fe),cc(U,x.x,x.y,Ge.x,Jt+Ge.y,qe.x,qe.y+qe.h,s,ot,$e.x,Re.y,Xe,Fe),cc(U,x.x,x.y,et.x,Jt+et.y,qe.x+qe.w,qe.y+qe.h,s,ot,Re.x,Re.y,Xe,Fe),wu(e.dynamicLayoutVertexArray,x,oe),F.emplaceBack(bt,bt+1,bt+2),F.emplaceBack(bt+1,bt+2,bt+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Me[0]),le!==n.length-1&&tt===n[le+1].sectionIndex||e.programConfigurations.populatePaintArrays(U.length,d,d.index,{},L,ie&&ie[tt])}e.placedSymbolArray.emplaceBack(x.x,x.y,Y,this.glyphOffsetArray.length-Y,Q,w,I,x.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],m,0,!1,0,C)}_addCollisionDebugVertex(e,n,s,l,h,d){return n.emplaceBack(0,0),e.emplaceBack(s.x,s.y,l,h,Math.round(d.x),Math.round(d.y))}addCollisionDebugVertices(e,n,s,l,h,d,m){const x=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),w=x.vertexLength,I=h.layoutVertexArray,C=h.collisionVertexArray,L=m.anchorX,F=m.anchorY;this._addCollisionDebugVertex(I,C,d,L,F,new H(e,n)),this._addCollisionDebugVertex(I,C,d,L,F,new H(s,n)),this._addCollisionDebugVertex(I,C,d,L,F,new H(s,l)),this._addCollisionDebugVertex(I,C,d,L,F,new H(e,l)),x.vertexLength+=4;const U=h.indexArray;U.emplaceBack(w,w+1),U.emplaceBack(w+1,w+2),U.emplaceBack(w+2,w+3),U.emplaceBack(w+3,w),x.primitiveLength+=4}addDebugCollisionBoxes(e,n,s,l){for(let h=e;h<n;h++){const d=this.collisionBoxArray.get(h);this.addCollisionDebugVertices(d.x1,d.y1,d.x2,d.y2,l?this.textCollisionBox:this.iconCollisionBox,d.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Su(Ue,zh.members,Ht),this.iconCollisionBox=new Su(Ue,zh.members,Ht);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,s,l,h,d,m,x,w){const I={};for(let C=n;C<s;C++){const L=e.get(C);I.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.textFeatureIndex=L.featureIndex;break}for(let C=l;C<h;C++){const L=e.get(C);I.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalTextFeatureIndex=L.featureIndex;break}for(let C=d;C<m;C++){const L=e.get(C);I.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.iconFeatureIndex=L.featureIndex;break}for(let C=x;C<w;C++){const L=e.get(C);I.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalIconFeatureIndex=L.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const s=e.placedSymbolArray.get(n),l=s.vertexStartIndex+4*s.numGlyphs;for(let h=s.vertexStartIndex;h<l;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),s=Math.cos(e),l=[],h=[],d=[];for(let m=0;m<this.symbolInstances.length;++m){d.push(m);const x=this.symbolInstances.get(m);l.push(0|Math.round(n*x.anchorX+s*x.anchorY)),h.push(x.featureIndex)}return d.sort((m,x)=>l[m]-l[x]||h[x]-h[m]),d}addToSortKeyRanges(e,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((l,h,d)=>{l>=0&&d.indexOf(l)===h&&this.addIndicesForPlacedSymbol(this.text,l)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Xh,Yh;He("SymbolBucket",na,{omit:["layers","collisionBoxArray","features","compareText"]}),na.MAX_GLYPHS=65535,na.addDynamicAttributes=wu;var Eu={get paint(){return Yh=Yh||new Ri({"icon-opacity":new ct(ye.paint_symbol["icon-opacity"]),"icon-color":new ct(ye.paint_symbol["icon-color"]),"icon-halo-color":new ct(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new ct(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ct(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new nt(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new nt(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new ct(ye.paint_symbol["text-opacity"]),"text-color":new ct(ye.paint_symbol["text-color"],{runtimeType:Di,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ct(ye.paint_symbol["text-halo-color"]),"text-halo-width":new ct(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new ct(ye.paint_symbol["text-halo-blur"]),"text-translate":new nt(ye.paint_symbol["text-translate"]),"text-translate-anchor":new nt(ye.paint_symbol["text-translate-anchor"])})},get layout(){return Xh=Xh||new Ri({"symbol-placement":new nt(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new nt(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nt(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ct(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nt(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new nt(ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new nt(ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new nt(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new nt(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nt(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new ct(ye.layout_symbol["icon-size"]),"icon-text-fit":new nt(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new nt(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new ct(ye.layout_symbol["icon-image"]),"icon-rotate":new ct(ye.layout_symbol["icon-rotate"]),"icon-padding":new ct(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new nt(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new ct(ye.layout_symbol["icon-offset"]),"icon-anchor":new ct(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nt(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nt(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nt(ye.layout_symbol["text-rotation-alignment"]),"text-field":new ct(ye.layout_symbol["text-field"]),"text-font":new ct(ye.layout_symbol["text-font"]),"text-size":new ct(ye.layout_symbol["text-size"]),"text-max-width":new ct(ye.layout_symbol["text-max-width"]),"text-line-height":new nt(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new ct(ye.layout_symbol["text-letter-spacing"]),"text-justify":new ct(ye.layout_symbol["text-justify"]),"text-radial-offset":new ct(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nt(ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ct(ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ct(ye.layout_symbol["text-anchor"]),"text-max-angle":new nt(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new nt(ye.layout_symbol["text-writing-mode"]),"text-rotate":new ct(ye.layout_symbol["text-rotate"]),"text-padding":new nt(ye.layout_symbol["text-padding"]),"text-keep-upright":new nt(ye.layout_symbol["text-keep-upright"]),"text-transform":new ct(ye.layout_symbol["text-transform"]),"text-offset":new ct(ye.layout_symbol["text-offset"]),"text-allow-overlap":new nt(ye.layout_symbol["text-allow-overlap"]),"text-overlap":new nt(ye.layout_symbol["text-overlap"]),"text-ignore-placement":new nt(ye.layout_symbol["text-ignore-placement"]),"text-optional":new nt(ye.layout_symbol["text-optional"])})}};class Kh{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Dn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}He("FormatSectionOverride",Kh,{omit:["defaultValue"]});class uc extends vr{constructor(e){super(e,Eu)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const h of s)l.indexOf(h)<0&&l.push(h);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,s,l){const h=this.layout.get(e).evaluate(n,{},s,l),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||Po(d.value)||!h?h:function(m,x){return x.replace(/{([^{}]+)}/g,(w,I)=>I in m?String(m[I]):"")}(n.properties,h)}createBucket(e){return new na(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Eu.paint.overridableProperties){if(!uc.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),s=new Kh(n),l=new ii(s,n.property.specification);let h=null;h=n.value.kind==="constant"||n.value.kind==="source"?new Xs("source",l):new Yt("composite",l,n.value.zoomStops),this.paint._values[e]=new or(n.property,h,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&uc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const s=e.get("text-field"),l=Eu.paint.properties[n];let h=!1;const d=m=>{for(const x of m)if(l.overrides&&l.overrides.hasOverride(x))return void(h=!0)};if(s.value.kind==="constant"&&s.value.value instanceof _i)d(s.value.value.sections);else if(s.value.kind==="source"){const m=w=>{h||(w instanceof Qr&&yi(w.value)===Vi?d(w.value.sections):w instanceof Mo?d(w.sections):w.eachChild(m))},x=s.value;x._styleExpression&&m(x._styleExpression.expression)}return h}}let Jh;var Qf={get paint(){return Jh=Jh||new Ri({"background-color":new nt(ye.paint_background["background-color"]),"background-pattern":new Oa(ye.paint_background["background-pattern"]),"background-opacity":new nt(ye.paint_background["background-opacity"])})}};class em extends vr{constructor(e){super(e,Qf)}}let Qh;var tm={get paint(){return Qh=Qh||new Ri({"raster-opacity":new nt(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new nt(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nt(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nt(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new nt(ye.paint_raster["raster-saturation"]),"raster-contrast":new nt(ye.paint_raster["raster-contrast"]),"raster-resampling":new nt(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new nt(ye.paint_raster["raster-fade-duration"])})}};class im extends vr{constructor(e){super(e,tm)}}class nm extends vr{constructor(e){super(e,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class rm{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Au=63710088e-1;class Fs{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Fs(rt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,s=this.lat*n,l=e.lat*n,h=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((e.lng-this.lng)*n);return Au*Math.acos(Math.min(h,1))}static convert(e){if(e instanceof Fs)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Fs(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Fs(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ep=2*Math.PI*Au;function tp(i){return ep*Math.cos(i*Math.PI/180)}function ip(i){return(180+i)/360}function np(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function rp(i,e){return i/tp(e)}function Iu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class hc{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){const s=Fs.convert(e);return new hc(ip(s.lng),np(s.lat),rp(n,s.lat))}toLngLat(){return new Fs(360*this.x-180,Iu(this.y))}toAltitude(){return this.z*tp(Iu(this.y))}meterInMercatorCoordinateUnits(){return 1/ep*(e=Iu(this.y),1/Math.cos(e*Math.PI/180));var e}}function sp(i,e,n){var s=2*Math.PI*6378137/256/Math.pow(2,n);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Mu{constructor(e,n,s){if(e<0||e>25||s<0||s>=Math.pow(2,e)||n<0||n>=Math.pow(2,e))throw new Error(`x=${n}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=s,this.key=sl(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,s){const l=(d=this.y,m=this.z,x=sp(256*(h=this.x),256*(d=Math.pow(2,m)-d-1),m),w=sp(256*(h+1),256*(d+1),m),x[0]+","+x[1]+","+w[0]+","+w[1]);var h,d,m,x,w;const I=function(C,L,F){let U,Z="";for(let Y=C;Y>0;Y--)U=1<<Y-1,Z+=(L&U?1:0)+(F&U?2:0);return Z}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,l)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new H((e.x*n-this.x)*si,(e.y*n-this.y)*si)}toString(){return`${this.z}/${this.x}/${this.y}`}}class op{constructor(e,n){this.wrap=e,this.canonical=n,this.key=sl(e,n.z,n.z,n.x,n.y)}}class ur{constructor(e,n,s,l,h){if(e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=n,this.canonical=new Mu(s,+l,+h),this.key=sl(n,e,s,l,h)}clone(){return new ur(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new ur(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ur(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?sl(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):sl(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new ur(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new ur(n,this.wrap,n,s,l),new ur(n,this.wrap,n,s+1,l),new ur(n,this.wrap,n,s,l+1),new ur(n,this.wrap,n,s+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ur(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ur(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new op(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new hc(e.x-this.wrap,e.y))}}function sl(i,e,n,s,l){(i*=2)<0&&(i=-1*i-1);const h=1<<n;return(h*h*i+h*l+s).toString(36)+n.toString(36)+e.toString(36)}He("CanonicalTileID",Mu),He("OverscaledTileID",ur,{omit:["posMatrix"]});class ap{constructor(e,n,s){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void vt(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const l=this.dim=n.height-2;this.data=new Uint32Array(n.data.buffer),this.encoding=s||"mapbox";for(let h=0;h<l;h++)this.data[this._idx(-1,h)]=this.data[this._idx(0,h)],this.data[this._idx(l,h)]=this.data[this._idx(l-1,h)],this.data[this._idx(h,-1)]=this.data[this._idx(h,0)],this.data[this._idx(h,l)]=this.data[this._idx(h,l-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(l,-1)]=this.data[this._idx(l-1,0)],this.data[this._idx(-1,l)]=this.data[this._idx(0,l-1)],this.data[this._idx(l,l)]=this.data[this._idx(l-1,l-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let h=0;h<l;h++)for(let d=0;d<l;d++){const m=this.get(h,d);m>this.max&&(this.max=m),m<this.min&&(this.min=m)}}get(e,n){const s=new Uint8Array(this.data.buffer),l=4*this._idx(e,n);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[l],s[l+1],s[l+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,s){return(256*e*256+256*n+s)/10-1e4}_unpackTerrarium(e,n,s){return 256*e+n+s/256-32768}getPixels(){return new cr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=n*this.dim,h=n*this.dim+this.dim,d=s*this.dim,m=s*this.dim+this.dim;switch(n){case-1:l=h-1;break;case 1:h=l+1}switch(s){case-1:d=m-1;break;case 1:m=d+1}const x=-n*this.dim,w=-s*this.dim;for(let I=d;I<m;I++)for(let C=l;C<h;C++)this.data[this._idx(C,I)]=e.data[this._idx(C+x,I+w)]}}He("DEMData",ap);class lp{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class cp{constructor(e,n,s,l,h){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=s,e._y=l,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}class up{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new as(si,16,0),this.grid3D=new as(si,16,0),this.featureIndexArray=new ue,this.promoteId=n}insert(e,n,s,l,h,d){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,h);const x=d?this.grid3D:this.grid;for(let w=0;w<n.length;w++){const I=n[w],C=[1/0,1/0,-1/0,-1/0];for(let L=0;L<I.length;L++){const F=I[L];C[0]=Math.min(C[0],F.x),C[1]=Math.min(C[1],F.y),C[2]=Math.max(C[2],F.x),C[3]=Math.max(C[3],F.y)}C[0]<si&&C[1]<si&&C[2]>=0&&C[3]>=0&&x.insert(m,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ls.VectorTile(new gu(this.rawTileData)).layers,this.sourceLayerCoder=new lp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,n,s,l){this.loadVTLayers();const h=e.params||{},d=si/e.tileSize/e.scale,m=wa(h.filter),x=e.queryGeometry,w=e.queryPadding*d,I=pp(x),C=this.grid.query(I.minX-w,I.minY-w,I.maxX+w,I.maxY+w),L=pp(e.cameraQueryGeometry),F=this.grid3D.query(L.minX-w,L.minY-w,L.maxX+w,L.maxY+w,(Y,Q,oe,ie)=>function(le,he,be,Ge,et){for(const $e of le)if(he<=$e.x&&be<=$e.y&&Ge>=$e.x&&et>=$e.y)return!0;const qe=[new H(he,be),new H(he,et),new H(Ge,et),new H(Ge,be)];if(le.length>2){for(const $e of qe)if(Yo(le,$e))return!0}for(let $e=0;$e<le.length-1;$e++)if(Rd(le[$e],le[$e+1],qe))return!0;return!1}(e.cameraQueryGeometry,Y-w,Q-w,oe+w,ie+w));for(const Y of F)C.push(Y);C.sort(sm);const U={};let Z;for(let Y=0;Y<C.length;Y++){const Q=C[Y];if(Q===Z)continue;Z=Q;const oe=this.featureIndexArray.get(Q);let ie=null;this.loadMatchingFeature(U,oe.bucketIndex,oe.sourceLayerIndex,oe.featureIndex,m,h.layers,h.availableImages,n,s,l,(le,he,be)=>(ie||(ie=Xr(le)),he.queryIntersectsFeature(x,le,be,ie,this.z,e.transform,d,e.pixelPosMatrix)))}return U}loadMatchingFeature(e,n,s,l,h,d,m,x,w,I,C){const L=this.bucketLayerIDs[n];if(d&&!function(Y,Q){for(let oe=0;oe<Y.length;oe++)if(Q.indexOf(Y[oe])>=0)return!0;return!1}(d,L))return;const F=this.sourceLayerCoder.decode(s),U=this.vtLayers[F].feature(l);if(h.needGeometry){const Y=Dr(U,!0);if(!h.filter(new Qt(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!h.filter(new Qt(this.tileID.overscaledZ),U))return;const Z=this.getId(U,F);for(let Y=0;Y<L.length;Y++){const Q=L[Y];if(d&&d.indexOf(Q)<0)continue;const oe=x[Q];if(!oe)continue;let ie={};Z&&I&&(ie=I.getState(oe.sourceLayer||"_geojsonTileLayer",Z));const le=De({},w[Q]);le.paint=hp(le.paint,oe.paint,U,ie,m),le.layout=hp(le.layout,oe.layout,U,ie,m);const he=!C||C(U,oe,ie);if(!he)continue;const be=new cp(U,this.z,this.x,this.y,Z);be.layer=le;let Ge=e[Q];Ge===void 0&&(Ge=e[Q]=[]),Ge.push({featureIndex:l,feature:be,intersectionZ:he})}}lookupSymbolFeatures(e,n,s,l,h,d,m,x){const w={};this.loadVTLayers();const I=wa(h);for(const C of e)this.loadMatchingFeature(w,s,l,C,I,d,m,x,n);return w}hasLayer(e){for(const n of this.bucketLayerIDs)for(const s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof s=="boolean"&&(s=Number(s))),s}}function hp(i,e,n,s,l){return it(i,(h,d)=>{const m=e instanceof No?e.get(d):null;return m&&m.evaluate?m.evaluate(n,s,l):m})}function pp(i){let e=1/0,n=1/0,s=-1/0,l=-1/0;for(const h of i)e=Math.min(e,h.x),n=Math.min(n,h.y),s=Math.max(s,h.x),l=Math.max(l,h.y);return{minX:e,minY:n,maxX:s,maxY:l}}function sm(i,e){return e-i}function dp(i,e,n,s,l){const h=[];for(let d=0;d<i.length;d++){const m=i[d];let x;for(let w=0;w<m.length-1;w++){let I=m[w],C=m[w+1];I.x<e&&C.x<e||(I.x<e?I=new H(e,I.y+(e-I.x)/(C.x-I.x)*(C.y-I.y))._round():C.x<e&&(C=new H(e,I.y+(e-I.x)/(C.x-I.x)*(C.y-I.y))._round()),I.y<n&&C.y<n||(I.y<n?I=new H(I.x+(n-I.y)/(C.y-I.y)*(C.x-I.x),n)._round():C.y<n&&(C=new H(I.x+(n-I.y)/(C.y-I.y)*(C.x-I.x),n)._round()),I.x>=s&&C.x>=s||(I.x>=s?I=new H(s,I.y+(s-I.x)/(C.x-I.x)*(C.y-I.y))._round():C.x>=s&&(C=new H(s,I.y+(s-I.x)/(C.x-I.x)*(C.y-I.y))._round()),I.y>=l&&C.y>=l||(I.y>=l?I=new H(I.x+(l-I.y)/(C.y-I.y)*(C.x-I.x),l)._round():C.y>=l&&(C=new H(I.x+(l-I.y)/(C.y-I.y)*(C.x-I.x),l)._round()),x&&I.equals(x[x.length-1])||(x=[I],h.push(x)),x.push(C)))))}}return h}He("FeatureIndex",up,{omit:["rawTileData","sourceLayerCoder"]});class Os extends H{constructor(e,n,s,l){super(e,n),this.angle=s,l!==void 0&&(this.segment=l)}clone(){return new Os(this.x,this.y,this.angle,this.segment)}}function fp(i,e,n,s,l){if(e.segment===void 0||n===0)return!0;let h=e,d=e.segment+1,m=0;for(;m>-n/2;){if(d--,d<0)return!1;m-=i[d].dist(h),h=i[d]}m+=i[d].dist(i[d+1]),d++;const x=[];let w=0;for(;m<n/2;){const I=i[d],C=i[d+1];if(!C)return!1;let L=i[d-1].angleTo(I)-I.angleTo(C);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:m,angleDelta:L}),w+=L;m-x[0].distance>s;)w-=x.shift().angleDelta;if(w>l)return!1;d++,m+=I.dist(C)}return!0}function mp(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function gp(i,e,n){return i?.6*e*n:0}function _p(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function om(i,e,n,s,l,h){const d=gp(n,l,h),m=_p(n,s)*h;let x=0;const w=mp(i)/2;for(let I=0;I<i.length-1;I++){const C=i[I],L=i[I+1],F=C.dist(L);if(x+F>w){const U=(w-x)/F,Z=Fn.number(C.x,L.x,U),Y=Fn.number(C.y,L.y,U),Q=new Os(Z,Y,L.angleTo(C),I);return Q._round(),!d||fp(i,Q,m,d,e)?Q:void 0}x+=F}}function am(i,e,n,s,l,h,d,m,x){const w=gp(s,h,d),I=_p(s,l),C=I*d,L=i[0].x===0||i[0].x===x||i[0].y===0||i[0].y===x;return e-C<e/4&&(e=C+e/4),yp(i,L?e/2*m%e:(I/2+2*h)*d*m%e,e,w,n,C,L,!1,x)}function yp(i,e,n,s,l,h,d,m,x){const w=h/2,I=mp(i);let C=0,L=e-n,F=[];for(let U=0;U<i.length-1;U++){const Z=i[U],Y=i[U+1],Q=Z.dist(Y),oe=Y.angleTo(Z);for(;L+n<C+Q;){L+=n;const ie=(L-C)/Q,le=Fn.number(Z.x,Y.x,ie),he=Fn.number(Z.y,Y.y,ie);if(le>=0&&le<x&&he>=0&&he<x&&L-w>=0&&L+w<=I){const be=new Os(le,he,oe,U);be._round(),s&&!fp(i,be,h,s,l)||F.push(be)}}C+=Q}return m||F.length||d||(F=yp(i,C/2,n,s,l,h,d,!0,x)),F}He("Anchor",Os);const ra=Un;function xp(i,e,n,s){const l=[],h=i.image,d=h.pixelRatio,m=h.paddedRect.w-2*ra,x=h.paddedRect.h-2*ra,w=i.right-i.left,I=i.bottom-i.top,C=h.stretchX||[[0,m]],L=h.stretchY||[[0,x]],F=(Re,Xe)=>Re+Xe[1]-Xe[0],U=C.reduce(F,0),Z=L.reduce(F,0),Y=m-U,Q=x-Z;let oe=0,ie=U,le=0,he=Z,be=0,Ge=Y,et=0,qe=Q;if(h.content&&s){const Re=h.content;oe=pc(C,0,Re[0]),le=pc(L,0,Re[1]),ie=pc(C,Re[0],Re[2]),he=pc(L,Re[1],Re[3]),be=Re[0]-oe,et=Re[1]-le,Ge=Re[2]-Re[0]-ie,qe=Re[3]-Re[1]-he}const $e=(Re,Xe,Fe,Me)=>{const ot=dc(Re.stretch-oe,ie,w,i.left),tt=fc(Re.fixed-be,Ge,Re.stretch,U),bt=dc(Xe.stretch-le,he,I,i.top),Jt=fc(Xe.fixed-et,qe,Xe.stretch,Z),ei=dc(Fe.stretch-oe,ie,w,i.left),Fi=fc(Fe.fixed-be,Ge,Fe.stretch,U),Jn=dc(Me.stretch-le,he,I,i.top),An=fc(Me.fixed-et,qe,Me.stretch,Z),Mi=new H(ot,bt),Zi=new H(ei,bt),sn=new H(ei,Jn),Vn=new H(ot,Jn),In=new H(tt/d,Jt/d),Ci=new H(Fi/d,An/d),Oi=e*Math.PI/180;if(Oi){const $n=Math.sin(Oi),Nn=Math.cos(Oi),pi=[Nn,-$n,$n,Nn];Mi._matMult(pi),Zi._matMult(pi),Vn._matMult(pi),sn._matMult(pi)}const fn=Re.stretch+Re.fixed,Mn=Xe.stretch+Xe.fixed;return{tl:Mi,tr:Zi,bl:Vn,br:sn,tex:{x:h.paddedRect.x+ra+fn,y:h.paddedRect.y+ra+Mn,w:Fe.stretch+Fe.fixed-fn,h:Me.stretch+Me.fixed-Mn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:In,pixelOffsetBR:Ci,minFontScaleX:Ge/d/w,minFontScaleY:qe/d/I,isSDF:n}};if(s&&(h.stretchX||h.stretchY)){const Re=vp(C,Y,U),Xe=vp(L,Q,Z);for(let Fe=0;Fe<Re.length-1;Fe++){const Me=Re[Fe],ot=Re[Fe+1];for(let tt=0;tt<Xe.length-1;tt++)l.push($e(Me,Xe[tt],ot,Xe[tt+1]))}}else l.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:x+1}));return l}function pc(i,e,n){let s=0;for(const l of i)s+=Math.max(e,Math.min(n,l[1]))-Math.max(e,Math.min(n,l[0]));return s}function vp(i,e,n){const s=[{fixed:-ra,stretch:0}];for(const[l,h]of i){const d=s[s.length-1];s.push({fixed:l-d.stretch,stretch:d.stretch}),s.push({fixed:l-d.stretch,stretch:d.stretch+(h-l)})}return s.push({fixed:e+ra,stretch:n}),s}function dc(i,e,n,s){return i/e*n+s}function fc(i,e,n,s){return i-e*n/s}class mc{constructor(e,n,s,l,h,d,m,x,w,I){if(this.boxStartIndex=e.length,w){let C=d.top,L=d.bottom;const F=d.collisionPadding;F&&(C-=F[1],L+=F[3]);let U=L-C;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{let C=d.top*m-x[0],L=d.bottom*m+x[2],F=d.left*m-x[3],U=d.right*m+x[1];const Z=d.collisionPadding;if(Z&&(F-=Z[0]*m,C-=Z[1]*m,U+=Z[2]*m,L+=Z[3]*m),I){const Y=new H(F,C),Q=new H(U,C),oe=new H(F,L),ie=new H(U,L),le=I*Math.PI/180;Y._rotate(le),Q._rotate(le),oe._rotate(le),ie._rotate(le),F=Math.min(Y.x,Q.x,oe.x,ie.x),U=Math.max(Y.x,Q.x,oe.x,ie.x),C=Math.min(Y.y,Q.y,oe.y,ie.y),L=Math.max(Y.y,Q.y,oe.y,ie.y)}e.emplaceBack(n.x,n.y,F,C,U,L,s,l,h)}this.boxEndIndex=e.length}}class lm{constructor(e=[],n=cm){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:s}=this,l=n[e];for(;e>0;){const h=e-1>>1,d=n[h];if(s(l,d)>=0)break;n[e]=d,e=h}n[e]=l}_down(e){const{data:n,compare:s}=this,l=this.length>>1,h=n[e];for(;e<l;){let d=1+(e<<1),m=n[d];const x=d+1;if(x<this.length&&s(n[x],m)<0&&(d=x,m=n[x]),s(m,h)>=0)break;n[e]=m,e=d}n[e]=h}}function cm(i,e){return i<e?-1:i>e?1:0}function um(i,e=1,n=!1){let s=1/0,l=1/0,h=-1/0,d=-1/0;const m=i[0];for(let F=0;F<m.length;F++){const U=m[F];(!F||U.x<s)&&(s=U.x),(!F||U.y<l)&&(l=U.y),(!F||U.x>h)&&(h=U.x),(!F||U.y>d)&&(d=U.y)}const x=Math.min(h-s,d-l);let w=x/2;const I=new lm([],hm);if(x===0)return new H(s,l);for(let F=s;F<h;F+=x)for(let U=l;U<d;U+=x)I.push(new sa(F+w,U+w,w,i));let C=function(F){let U=0,Z=0,Y=0;const Q=F[0];for(let oe=0,ie=Q.length,le=ie-1;oe<ie;le=oe++){const he=Q[oe],be=Q[le],Ge=he.x*be.y-be.x*he.y;Z+=(he.x+be.x)*Ge,Y+=(he.y+be.y)*Ge,U+=3*Ge}return new sa(Z/U,Y/U,0,F)}(i),L=I.length;for(;I.length;){const F=I.pop();(F.d>C.d||!C.d)&&(C=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,L)),F.max-C.d<=e||(w=F.h/2,I.push(new sa(F.p.x-w,F.p.y-w,w,i)),I.push(new sa(F.p.x+w,F.p.y-w,w,i)),I.push(new sa(F.p.x-w,F.p.y+w,w,i)),I.push(new sa(F.p.x+w,F.p.y+w,w,i)),L+=4)}return n&&(console.log(`num probes: ${L}`),console.log(`best distance: ${C.d}`)),C.p}function hm(i,e){return e.max-i.max}function sa(i,e,n,s){this.p=new H(i,e),this.h=n,this.d=function(l,h){let d=!1,m=1/0;for(let x=0;x<h.length;x++){const w=h[x];for(let I=0,C=w.length,L=C-1;I<C;L=I++){const F=w[I],U=w[L];F.y>l.y!=U.y>l.y&&l.x<(U.x-F.x)*(l.y-F.y)/(U.y-F.y)+F.x&&(d=!d),m=Math.min(m,nh(l,F,U))}}return(d?1:-1)*Math.sqrt(m)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var rn;o.TextAnchorEnum=void 0,(rn=o.TextAnchorEnum||(o.TextAnchorEnum={}))[rn.center=1]="center",rn[rn.left=2]="left",rn[rn.right=3]="right",rn[rn.top=4]="top",rn[rn.bottom=5]="bottom",rn[rn["top-left"]=6]="top-left",rn[rn["top-right"]=7]="top-right",rn[rn["bottom-left"]=8]="bottom-left",rn[rn["bottom-right"]=9]="bottom-right";const Us=7,Cu=Number.POSITIVE_INFINITY;function bp(i,e){return e[1]!==Cu?function(n,s,l){let h=0,d=0;switch(s=Math.abs(s),l=Math.abs(l),n){case"top-right":case"top-left":case"top":d=l-Us;break;case"bottom-right":case"bottom-left":case"bottom":d=-l+Us}switch(n){case"top-right":case"bottom-right":case"right":h=-s;break;case"top-left":case"bottom-left":case"left":h=s}return[h,d]}(i,e[0],e[1]):function(n,s){let l=0,h=0;s<0&&(s=0);const d=s/Math.sqrt(2);switch(n){case"top-right":case"top-left":h=d-Us;break;case"bottom-right":case"bottom-left":h=-d+Us;break;case"bottom":h=-s+Us;break;case"top":h=s-Us}switch(n){case"top-right":case"bottom-right":l=-d;break;case"top-left":case"bottom-left":l=d;break;case"left":l=s;break;case"right":l=-s}return[l,h]}(i,e[0])}function wp(i,e,n){var s;const l=i.layout,h=(s=l.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(e,{},n);if(h){const m=h.values,x=[];for(let w=0;w<m.length;w+=2){const I=x[w]=m[w],C=m[w+1].map(L=>L*Bi);I.startsWith("top")?C[1]-=Us:I.startsWith("bottom")&&(C[1]+=Us),x[w+1]=C}return new tn(x)}const d=l.get("text-variable-anchor");if(d){let m;m=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(e,{},n)*Bi,Cu]:l.get("text-offset").evaluate(e,{},n).map(w=>w*Bi);const x=[];for(const w of d)x.push(w,bp(w,m));return new tn(x)}return null}function Pu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function pm(i,e,n,s,l,h,d,m,x,w,I){let C=h.textMaxSize.evaluate(e,{});C===void 0&&(C=d);const L=i.layers[0].layout,F=L.get("icon-offset").evaluate(e,{},I),U=Sp(n.horizontal),Z=d/24,Y=i.tilePixelRatio*Z,Q=i.tilePixelRatio*C/24,oe=i.tilePixelRatio*m,ie=i.tilePixelRatio*L.get("symbol-spacing"),le=L.get("text-padding")*i.tilePixelRatio,he=function(Me,ot,tt,bt=1){const Jt=Me.get("icon-padding").evaluate(ot,{},tt),ei=Jt&&Jt.values;return[ei[0]*bt,ei[1]*bt,ei[2]*bt,ei[3]*bt]}(L,e,I,i.tilePixelRatio),be=L.get("text-max-angle")/180*Math.PI,Ge=L.get("text-rotation-alignment")!=="viewport"&&L.get("symbol-placement")!=="point",et=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",qe=L.get("symbol-placement"),$e=ie/2,Re=L.get("icon-text-fit");let Xe;s&&Re!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Xe=Wh(s,n.vertical,Re,L.get("icon-text-fit-padding"),F,Z)),U&&(s=Wh(s,U,Re,L.get("icon-text-fit-padding"),F,Z)));const Fe=(Me,ot)=>{ot.x<0||ot.x>=si||ot.y<0||ot.y>=si||function(tt,bt,Jt,ei,Fi,Jn,An,Mi,Zi,sn,Vn,In,Ci,Oi,fn,Mn,$n,Nn,pi,on,Mt,Qn,an,Cn,br){const Lr=tt.addToLineVertexArray(bt,Jt);let Rr,ms,wr,hr,jn=0,gs=0,ll=0,Mp=0,Ou=-1,Uu=-1;const _s={};let Cp=kr("");if(tt.allowVerticalPlacement&&ei.vertical){const mn=Mi.layout.get("text-rotate").evaluate(Mt,{},Cn)+90;wr=new mc(Zi,bt,sn,Vn,In,ei.vertical,Ci,Oi,fn,mn),An&&(hr=new mc(Zi,bt,sn,Vn,In,An,$n,Nn,fn,mn))}if(Fi){const mn=Mi.layout.get("icon-rotate").evaluate(Mt,{}),pr=Mi.layout.get("icon-text-fit")!=="none",ao=xp(Fi,mn,an,pr),Fr=An?xp(An,mn,an,pr):void 0;ms=new mc(Zi,bt,sn,Vn,In,Fi,$n,Nn,!1,mn),jn=4*ao.length;const lo=tt.iconSizeData;let Kr=null;lo.kind==="source"?(Kr=[Yr*Mi.layout.get("icon-size").evaluate(Mt,{})],Kr[0]>Bs&&vt(`${tt.layerIds[0]}: Value for "icon-size" is >= ${rl}. Reduce your "icon-size".`)):lo.kind==="composite"&&(Kr=[Yr*Qn.compositeIconSizes[0].evaluate(Mt,{},Cn),Yr*Qn.compositeIconSizes[1].evaluate(Mt,{},Cn)],(Kr[0]>Bs||Kr[1]>Bs)&&vt(`${tt.layerIds[0]}: Value for "icon-size" is >= ${rl}. Reduce your "icon-size".`)),tt.addSymbols(tt.icon,ao,Kr,on,pi,Mt,o.WritingMode.none,bt,Lr.lineStartIndex,Lr.lineLength,-1,Cn),Ou=tt.icon.placedSymbolArray.length-1,Fr&&(gs=4*Fr.length,tt.addSymbols(tt.icon,Fr,Kr,on,pi,Mt,o.WritingMode.vertical,bt,Lr.lineStartIndex,Lr.lineLength,-1,Cn),Uu=tt.icon.placedSymbolArray.length-1)}const Pp=Object.keys(ei.horizontal);for(const mn of Pp){const pr=ei.horizontal[mn];if(!Rr){Cp=kr(pr.text);const Fr=Mi.layout.get("text-rotate").evaluate(Mt,{},Cn);Rr=new mc(Zi,bt,sn,Vn,In,pr,Ci,Oi,fn,Fr)}const ao=pr.positionedLines.length===1;if(ll+=Tp(tt,bt,pr,Jn,Mi,fn,Mt,Mn,Lr,ei.vertical?o.WritingMode.horizontal:o.WritingMode.horizontalOnly,ao?Pp:[mn],_s,Ou,Qn,Cn),ao)break}ei.vertical&&(Mp+=Tp(tt,bt,ei.vertical,Jn,Mi,fn,Mt,Mn,Lr,o.WritingMode.vertical,["vertical"],_s,Uu,Qn,Cn));const mm=Rr?Rr.boxStartIndex:tt.collisionBoxArray.length,gm=Rr?Rr.boxEndIndex:tt.collisionBoxArray.length,_m=wr?wr.boxStartIndex:tt.collisionBoxArray.length,ym=wr?wr.boxEndIndex:tt.collisionBoxArray.length,xm=ms?ms.boxStartIndex:tt.collisionBoxArray.length,vm=ms?ms.boxEndIndex:tt.collisionBoxArray.length,bm=hr?hr.boxStartIndex:tt.collisionBoxArray.length,wm=hr?hr.boxEndIndex:tt.collisionBoxArray.length;let Br=-1;const _c=(mn,pr)=>mn&&mn.circleDiameter?Math.max(mn.circleDiameter,pr):pr;Br=_c(Rr,Br),Br=_c(wr,Br),Br=_c(ms,Br),Br=_c(hr,Br);const kp=Br>-1?1:0;kp&&(Br*=br/Bi),tt.glyphOffsetArray.length>=na.MAX_GLYPHS&&vt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mt.sortKey!==void 0&&tt.addToSortKeyRanges(tt.symbolInstances.length,Mt.sortKey);const Tm=wp(Mi,Mt,Cn),[Sm,Em]=function(mn,pr){const ao=mn.length,Fr=pr==null?void 0:pr.values;if((Fr==null?void 0:Fr.length)>0)for(let lo=0;lo<Fr.length;lo+=2){const Kr=Fr[lo+1];mn.emplaceBack(o.TextAnchorEnum[Fr[lo]],Kr[0],Kr[1])}return[ao,mn.length]}(tt.textAnchorOffsets,Tm);tt.symbolInstances.emplaceBack(bt.x,bt.y,_s.right>=0?_s.right:-1,_s.center>=0?_s.center:-1,_s.left>=0?_s.left:-1,_s.vertical||-1,Ou,Uu,Cp,mm,gm,_m,ym,xm,vm,bm,wm,sn,ll,Mp,jn,gs,kp,0,Ci,Br,Sm,Em)}(i,ot,Me,n,s,l,Xe,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,Y,[le,le,le,le],Ge,x,oe,he,et,F,e,h,w,I,d)};if(qe==="line")for(const Me of dp(e.geometry,0,0,si,si)){const ot=am(Me,ie,be,n.vertical||U,s,24,Q,i.overscaling,si);for(const tt of ot)U&&dm(i,U.text,$e,tt)||Fe(Me,tt)}else if(qe==="line-center"){for(const Me of e.geometry)if(Me.length>1){const ot=om(Me,be,n.vertical||U,s,24,Q);ot&&Fe(Me,ot)}}else if(e.type==="Polygon")for(const Me of lu(e.geometry,0)){const ot=um(Me,16);Fe(Me[0],new Os(ot.x,ot.y,0))}else if(e.type==="LineString")for(const Me of e.geometry)Fe(Me,new Os(Me[0].x,Me[0].y,0));else if(e.type==="Point")for(const Me of e.geometry)for(const ot of Me)Fe([ot],new Os(ot.x,ot.y,0))}function Tp(i,e,n,s,l,h,d,m,x,w,I,C,L,F,U){const Z=function(oe,ie,le,he,be,Ge,et,qe){const $e=he.layout.get("text-rotate").evaluate(Ge,{})*Math.PI/180,Re=[];for(const Xe of ie.positionedLines)for(const Fe of Xe.positionedGlyphs){if(!Fe.rect)continue;const Me=Fe.rect||{};let ot=Vh+1,tt=!0,bt=1,Jt=0;const ei=(be||qe)&&Fe.vertical,Fi=Fe.metrics.advance*Fe.scale/2;if(qe&&ie.verticalizable&&(Jt=Xe.lineOffset/2-(Fe.imageName?-(Bi-Fe.metrics.width*Fe.scale)/2:(Fe.scale-1)*Bi)),Fe.imageName){const pi=et[Fe.imageName];tt=pi.sdf,bt=pi.pixelRatio,ot=Un/bt}const Jn=be?[Fe.x+Fi,Fe.y]:[0,0];let An=be?[0,0]:[Fe.x+Fi+le[0],Fe.y+le[1]-Jt],Mi=[0,0];ei&&(Mi=An,An=[0,0]);const Zi=(Fe.metrics.left-ot)*Fe.scale-Fi+An[0],sn=(-Fe.metrics.top-ot)*Fe.scale+An[1],Vn=Zi+Me.w*Fe.scale/bt,In=sn+Me.h*Fe.scale/bt,Ci=new H(Zi,sn),Oi=new H(Vn,sn),fn=new H(Zi,In),Mn=new H(Vn,In);if(ei){const pi=new H(-Fi,Fi-il),on=-Math.PI/2,Mt=Bi/2-Fi,Qn=new H(5-il-Mt,-(Fe.imageName?Mt:0)),an=new H(...Mi);Ci._rotateAround(on,pi)._add(Qn)._add(an),Oi._rotateAround(on,pi)._add(Qn)._add(an),fn._rotateAround(on,pi)._add(Qn)._add(an),Mn._rotateAround(on,pi)._add(Qn)._add(an)}if($e){const pi=Math.sin($e),on=Math.cos($e),Mt=[on,-pi,pi,on];Ci._matMult(Mt),Oi._matMult(Mt),fn._matMult(Mt),Mn._matMult(Mt)}const $n=new H(0,0),Nn=new H(0,0);Re.push({tl:Ci,tr:Oi,bl:fn,br:Mn,tex:Me,writingMode:ie.writingMode,glyphOffset:Jn,sectionIndex:Fe.sectionIndex,isSDF:tt,pixelOffsetTL:$n,pixelOffsetBR:Nn,minFontScaleX:0,minFontScaleY:0})}return Re}(0,n,m,l,h,d,s,i.allowVerticalPlacement),Y=i.textSizeData;let Q=null;Y.kind==="source"?(Q=[Yr*l.layout.get("text-size").evaluate(d,{})],Q[0]>Bs&&vt(`${i.layerIds[0]}: Value for "text-size" is >= ${rl}. Reduce your "text-size".`)):Y.kind==="composite"&&(Q=[Yr*F.compositeTextSizes[0].evaluate(d,{},U),Yr*F.compositeTextSizes[1].evaluate(d,{},U)],(Q[0]>Bs||Q[1]>Bs)&&vt(`${i.layerIds[0]}: Value for "text-size" is >= ${rl}. Reduce your "text-size".`)),i.addSymbols(i.text,Z,Q,m,h,d,w,e,x.lineStartIndex,x.lineLength,L,U);for(const oe of I)C[oe]=i.text.placedSymbolArray.length-1;return 4*Z.length}function Sp(i){for(const e in i)return i[e];return null}function dm(i,e,n,s){const l=i.compareText;if(e in l){const h=l[e];for(let d=h.length-1;d>=0;d--)if(s.dist(h[d])<n)return!0}else l[e]=[];return l[e].push(s),!1}const Ep=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ku{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,s]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const h=Ep[15&s];if(!h)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[m]=new Uint32Array(e,4,1);return new ku(m,d,h,e)}constructor(e,n=64,s=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const h=Ep.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,m=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-m%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+m+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=n,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return zu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:d,nodeSize:m}=this,x=[0,h.length-1,0],w=[];for(;x.length;){const I=x.pop()||0,C=x.pop()||0,L=x.pop()||0;if(C-L<=m){for(let Y=L;Y<=C;Y++){const Q=d[2*Y],oe=d[2*Y+1];Q>=e&&Q<=s&&oe>=n&&oe<=l&&w.push(h[Y])}continue}const F=L+C>>1,U=d[2*F],Z=d[2*F+1];U>=e&&U<=s&&Z>=n&&Z<=l&&w.push(h[F]),(I===0?e<=U:n<=Z)&&(x.push(L),x.push(F-1),x.push(1-I)),(I===0?s>=U:l>=Z)&&(x.push(F+1),x.push(C),x.push(1-I))}return w}within(e,n,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:h,nodeSize:d}=this,m=[0,l.length-1,0],x=[],w=s*s;for(;m.length;){const I=m.pop()||0,C=m.pop()||0,L=m.pop()||0;if(C-L<=d){for(let Y=L;Y<=C;Y++)Ip(h[2*Y],h[2*Y+1],e,n)<=w&&x.push(l[Y]);continue}const F=L+C>>1,U=h[2*F],Z=h[2*F+1];Ip(U,Z,e,n)<=w&&x.push(l[F]),(I===0?e-s<=U:n-s<=Z)&&(m.push(L),m.push(F-1),m.push(1-I)),(I===0?e+s>=U:n+s>=Z)&&(m.push(F+1),m.push(C),m.push(1-I))}return x}}function zu(i,e,n,s,l,h){if(l-s<=n)return;const d=s+l>>1;Ap(i,e,d,s,l,h),zu(i,e,n,s,d-1,1-h),zu(i,e,n,d+1,l,1-h)}function Ap(i,e,n,s,l,h){for(;l>s;){if(l-s>600){const w=l-s+1,I=n-s+1,C=Math.log(w),L=.5*Math.exp(2*C/3),F=.5*Math.sqrt(C*L*(w-L)/w)*(I-w/2<0?-1:1);Ap(i,e,n,Math.max(s,Math.floor(n-I*L/w+F)),Math.min(l,Math.floor(n+(w-I)*L/w+F)),h)}const d=e[2*n+h];let m=s,x=l;for(ol(i,e,s,n),e[2*l+h]>d&&ol(i,e,s,l);m<x;){for(ol(i,e,m,x),m++,x--;e[2*m+h]<d;)m++;for(;e[2*x+h]>d;)x--}e[2*s+h]===d?ol(i,e,s,x):(x++,ol(i,e,x,l)),x<=n&&(s=x+1),n<=x&&(l=x-1)}}function ol(i,e,n,s){Du(i,n,s),Du(e,2*n,2*s),Du(e,2*n+1,2*s+1)}function Du(i,e,n){const s=i[e];i[e]=i[n],i[n]=s}function Ip(i,e,n,s){const l=i-n,h=e-s;return l*l+h*h}var Lu;o.PerformanceMarkers=void 0,(Lu=o.PerformanceMarkers||(o.PerformanceMarkers={})).create="create",Lu.load="load",Lu.fullLoad="fullLoad";let gc=null,al=[];const Ru=1e3/60,Bu="loadTime",Fu="fullLoadTime",fm={mark(i){performance.mark(i)},frame(i){const e=i;gc!=null&&al.push(e-gc),gc=e},clearMetrics(){gc=null,al=[],performance.clearMeasures(Bu),performance.clearMeasures(Fu);for(const i in o.PerformanceMarkers)performance.clearMarks(o.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure(Bu,o.PerformanceMarkers.create,o.PerformanceMarkers.load),performance.measure(Fu,o.PerformanceMarkers.create,o.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName(Bu)[0].duration,e=performance.getEntriesByName(Fu)[0].duration,n=al.length,s=1/(al.reduce((h,d)=>h+d,0)/n/1e3),l=al.filter(h=>h>Ru).reduce((h,d)=>h+(d-Ru)/Ru,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:l/(n+l)*100,totalFrames:n}}};o.AJAXError=Ft,o.ARRAY_TYPE=Ko,o.Actor=class{constructor(i,e,n){this.receive=s=>{const l=s.data,h=l.id;if(h&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){delete this.tasks[h];const d=this.cancelCallbacks[h];delete this.cancelCallbacks[h],d&&d()}else Gt()||l.mustQueue?(this.tasks[h]=l,this.taskQueue.push(h),this.invoker.trigger()):this.processTask(h,l)},this.process=()=>{if(!this.taskQueue.length)return;const s=this.taskQueue.shift(),l=this.tasks[s];delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),l&&this.processTask(s,l)},this.target=i,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new rm(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Gt()?i:window}send(i,e,n,s,l=!1){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[h]=n);const d=Xi(this.globalScope)?void 0:[];return this.target.postMessage({id:h,type:i,hasCallback:!!n,targetMapId:s,mustQueue:l,sourceMapId:this.mapId,data:ls(e,d)},d),{cancel:()=>{n&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const n=this.callbacks[i];delete this.callbacks[i],n&&(e.error?n(As(e.error)):n(null,As(e.data)))}else{let n=!1;const s=Xi(this.globalScope)?void 0:[],l=e.hasCallback?(m,x)=>{n=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:m?ls(m):null,data:ls(x,s)},s)}:m=>{n=!0};let h=null;const d=As(e.data);if(this.parent[e.type])h=this.parent[e.type](e.sourceMapId,d,l);else if(this.parent.getWorkerSource){const m=e.type.split(".");h=this.parent.getWorkerSource(e.sourceMapId,m[0],d.source)[m[1]](d,l)}else l(new Error(`Could not find function ${e.type}`));!n&&h&&h.cancel&&(this.cancelCallbacks[i]=h.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.AlphaImage=Ha,o.CanonicalTileID=Mu,o.CollisionBoxArray=b,o.CollisionCircleLayoutArray=class extends Go{},o.Color=pt,o.DEMData=ap,o.DataConstantProperty=nt,o.DictionaryCoder=lp,o.EXTENT=si,o.ErrorEvent=hn,o.EvaluationParameters=Qt,o.Event=ci,o.Evented=Wn,o.FeatureIndex=up,o.FillBucket=hu,o.FillExtrusionBucket=du,o.GeoJSONFeature=cp,o.ImageAtlas=Nh,o.ImagePosition=yu,o.KDBush=ku,o.LineBucket=fu,o.LineStripIndexArray=class extends p{},o.LngLat=Fs,o.MercatorCoordinate=hc,o.ONE_EM=Bi,o.OverscaledTileID=ur,o.PerformanceUtils=fm,o.Point=H,o.Pos3dArray=class extends Ps{},o.PosArray=K,o.Properties=Ri,o.Protobuf=gu,o.QuadTriangleArray=class extends Wo{},o.RGBAImage=cr,o.RasterBoundsArray=class extends qo{},o.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},o.SegmentVector=ht,o.SymbolBucket=na,o.Transitionable=$o,o.TriangleIndexArray=Ye,o.Uniform1f=ji,o.Uniform1i=class extends hi{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends hi{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},o.Uniform3f=class extends hi{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},o.Uniform4f=ks,o.UniformColor=Ii,o.UniformMatrix4f=class extends hi{constructor(i,e){super(i,e),this.current=qi}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},o.UnwrappedTileID=op,o.ValidationError=ze,o.ZoomHistory=Uo,o.addDynamicAttributes=wu,o.arrayBufferToImage=function(i,e){const n=new Image;n.onload=()=>{e(null,n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame(()=>{n.src=Dt})},n.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const s=new Blob([new Uint8Array(i)],{type:"image/png"});n.src=i.byteLength?URL.createObjectURL(s):Dt},o.arrayBufferToImageBitmap=function(i,e){const n=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(n).then(s=>{e(null,s)}).catch(s=>{e(new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},o.asyncAll=function(i,e,n){if(!i.length)return n(null,[]);let s=i.length;const l=new Array(i.length);let h=null;i.forEach((d,m)=>{e(d,(x,w)=>{x&&(h=x),l[m]=w,--s==0&&n(h,l)})})},o.bezier=Ce,o.browser=li,o.clamp=Pe,o.clipLine=dp,o.clone=function(i){var e=new Ko(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},o.clone$1=Ke,o.collisionCircleLayout=zf,o.config=Ui,o.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},o.create=function(){var i=new Ko(16);return Ko!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o.createExpression=Et,o.createFilter=wa,o.createLayout=wi,o.createStyleLayer=function(i){if(i.type==="custom")return new nm(i);switch(i.type){case"background":return new em(i);case"circle":return new Od(i);case"fill":return new sf(i);case"fill-extrusion":return new vf(i);case"heatmap":return new Vd(i);case"hillshade":return new Nd(i);case"line":return new Mf(i);case"raster":return new im(i);case"symbol":return new uc(i)}},o.deepEqual=function i(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(!i(e[s],n[s]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const s in e)if(!i(e[s],n[s]))return!1;return!0}return e===n},o.defaultEasing=Ne,o.derefLayers=function(i){i=i.slice();const e=Object.create(null);for(let n=0;n<i.length;n++)e[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=Er(i[n],e[i[n].ref]));return i},o.diffStyles=function(i,e){if(!i)return[{command:Ct.setStyle,args:[e]}];let n=[];try{if(!It(i.version,e.version))return[{command:Ct.setStyle,args:[e]}];It(i.center,e.center)||n.push({command:Ct.setCenter,args:[e.center]}),It(i.zoom,e.zoom)||n.push({command:Ct.setZoom,args:[e.zoom]}),It(i.bearing,e.bearing)||n.push({command:Ct.setBearing,args:[e.bearing]}),It(i.pitch,e.pitch)||n.push({command:Ct.setPitch,args:[e.pitch]}),It(i.sprite,e.sprite)||n.push({command:Ct.setSprite,args:[e.sprite]}),It(i.glyphs,e.glyphs)||n.push({command:Ct.setGlyphs,args:[e.glyphs]}),It(i.transition,e.transition)||n.push({command:Ct.setTransition,args:[e.transition]}),It(i.light,e.light)||n.push({command:Ct.setLight,args:[e.light]});const s={},l=[];(function(d,m,x,w){let I;for(I in m=m||{},d=d||{})Object.prototype.hasOwnProperty.call(d,I)&&(Object.prototype.hasOwnProperty.call(m,I)||pn(I,x,w));for(I in m)Object.prototype.hasOwnProperty.call(m,I)&&(Object.prototype.hasOwnProperty.call(d,I)?It(d[I],m[I])||(d[I].type==="geojson"&&m[I].type==="geojson"&&Jr(d,m,I)?x.push({command:Ct.setGeoJSONSourceData,args:[I,m[I].data]}):Vr(I,m,x,w)):rr(I,m,x))})(i.sources,e.sources,l,s);const h=[];i.layers&&i.layers.forEach(d=>{s[d.source]?n.push({command:Ct.removeLayer,args:[d.id]}):h.push(d)}),n=n.concat(l),function(d,m,x){m=m||[];const w=(d=d||[]).map(_r),I=m.map(_r),C=d.reduce(yr,{}),L=m.reduce(yr,{}),F=w.slice(),U=Object.create(null);let Z,Y,Q,oe,ie,le,he;for(Z=0,Y=0;Z<w.length;Z++)Q=w[Z],Object.prototype.hasOwnProperty.call(L,Q)?Y++:(x.push({command:Ct.removeLayer,args:[Q]}),F.splice(F.indexOf(Q,Y),1));for(Z=0,Y=0;Z<I.length;Z++)Q=I[I.length-1-Z],F[F.length-1-Z]!==Q&&(Object.prototype.hasOwnProperty.call(C,Q)?(x.push({command:Ct.removeLayer,args:[Q]}),F.splice(F.lastIndexOf(Q,F.length-Y),1)):Y++,le=F[F.length-Z],x.push({command:Ct.addLayer,args:[L[Q],le]}),F.splice(F.length-Z,0,Q),U[Q]=!0);for(Z=0;Z<I.length;Z++)if(Q=I[Z],oe=C[Q],ie=L[Q],!U[Q]&&!It(oe,ie))if(It(oe.source,ie.source)&&It(oe["source-layer"],ie["source-layer"])&&It(oe.type,ie.type)){for(he in Rt(oe.layout,ie.layout,x,Q,null,Ct.setLayoutProperty),Rt(oe.paint,ie.paint,x,Q,null,Ct.setPaintProperty),It(oe.filter,ie.filter)||x.push({command:Ct.setFilter,args:[Q,ie.filter]}),It(oe.minzoom,ie.minzoom)&&It(oe.maxzoom,ie.maxzoom)||x.push({command:Ct.setLayerZoomRange,args:[Q,ie.minzoom,ie.maxzoom]}),oe)Object.prototype.hasOwnProperty.call(oe,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Rt(oe[he],ie[he],x,Q,he.slice(6),Ct.setPaintProperty):It(oe[he],ie[he])||x.push({command:Ct.setLayerProperty,args:[Q,he,ie[he]]}));for(he in ie)Object.prototype.hasOwnProperty.call(ie,he)&&!Object.prototype.hasOwnProperty.call(oe,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Rt(oe[he],ie[he],x,Q,he.slice(6),Ct.setPaintProperty):It(oe[he],ie[he])||x.push({command:Ct.setLayerProperty,args:[Q,he,ie[he]]}))}else x.push({command:Ct.removeLayer,args:[Q]}),le=F[F.lastIndexOf(Q)+1],x.push({command:Ct.addLayer,args:[ie,le]})}(h,e.layers,n)}catch(s){console.warn("Unable to compute style diff:",s),n=[{command:Ct.setStyle,args:[e]}]}return n},o.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},o.earthRadius=Au,o.emitValidationErrors=Vl,o.emptyStyle=function(){const i={},e=ye.$version;for(const n in ye.$root){const s=ye.$root[n];if(s.required){let l=null;l=n==="version"?e:s.type==="array"?[]:{},l!=null&&(i[n]=l)}}return i},o.equals=function(i,e){var n=i[0],s=i[1],l=i[2],h=i[3],d=i[4],m=i[5],x=i[6],w=i[7],I=i[8],C=i[9],L=i[10],F=i[11],U=i[12],Z=i[13],Y=i[14],Q=i[15],oe=e[0],ie=e[1],le=e[2],he=e[3],be=e[4],Ge=e[5],et=e[6],qe=e[7],$e=e[8],Re=e[9],Xe=e[10],Fe=e[11],Me=e[12],ot=e[13],tt=e[14],bt=e[15];return Math.abs(n-oe)<=En*Math.max(1,Math.abs(n),Math.abs(oe))&&Math.abs(s-ie)<=En*Math.max(1,Math.abs(s),Math.abs(ie))&&Math.abs(l-le)<=En*Math.max(1,Math.abs(l),Math.abs(le))&&Math.abs(h-he)<=En*Math.max(1,Math.abs(h),Math.abs(he))&&Math.abs(d-be)<=En*Math.max(1,Math.abs(d),Math.abs(be))&&Math.abs(m-Ge)<=En*Math.max(1,Math.abs(m),Math.abs(Ge))&&Math.abs(x-et)<=En*Math.max(1,Math.abs(x),Math.abs(et))&&Math.abs(w-qe)<=En*Math.max(1,Math.abs(w),Math.abs(qe))&&Math.abs(I-$e)<=En*Math.max(1,Math.abs(I),Math.abs($e))&&Math.abs(C-Re)<=En*Math.max(1,Math.abs(C),Math.abs(Re))&&Math.abs(L-Xe)<=En*Math.max(1,Math.abs(L),Math.abs(Xe))&&Math.abs(F-Fe)<=En*Math.max(1,Math.abs(F),Math.abs(Fe))&&Math.abs(U-Me)<=En*Math.max(1,Math.abs(U),Math.abs(Me))&&Math.abs(Z-ot)<=En*Math.max(1,Math.abs(Z),Math.abs(ot))&&Math.abs(Y-tt)<=En*Math.max(1,Math.abs(Y),Math.abs(tt))&&Math.abs(Q-bt)<=En*Math.max(1,Math.abs(Q),Math.abs(bt))},o.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:l}){return i.kind==="source"?s/Yr:i.kind==="composite"?Fn.number(s/Yr,l/Yr,n):e},o.evaluateSizeForZoom=function(i,e){let n=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:h,maxZoom:d}=i,m=l?Pe(On.interpolationFactor(l,e,h,d),0,1):0;i.kind==="camera"?s=Fn.number(i.minSize,i.maxSize,m):n=m}return{uSizeT:n,uSize:s}},o.evented=Ra,o.extend=De,o.filterObject=Le,o.findLineIntersection=function(i,e,n,s){const l=e.y-i.y,h=e.x-i.x,d=s.y-n.y,m=s.x-n.x,x=d*h-m*l;if(x===0)return null;const w=(m*(i.y-n.y)-d*(i.x-n.x))/x;return new H(i.x+w*h,i.y+w*l)},o.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.getAnchorAlignment=vu,o.getAnchorJustification=Pu,o.getArrayBuffer=Sr,o.getDefaultExportFromCjs=O,o.getJSON=function(i,e){return Zn(De(i,{type:"json"}),e)},o.getOverlapMode=bu,o.getProtocolAction=cn,o.getRTLTextPluginStatus=Ba,o.getReferrer=yn,o.getVideo=function(i,e){const n=window.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<i.length;s++){const l=window.document.createElement("source");un(i[s])||(n.crossOrigin="Anonymous"),l.src=i[s],n.appendChild(l)}return{cancel:()=>{}}},o.groupByLayout=function(i,e){const n={};for(let l=0;l<i.length;l++){const h=e&&e[i[l].id]||Wc(i[l]);e&&(e[i[l].id]=h);let d=n[h];d||(d=n[h]=[]),d.push(i[l])}const s=[];for(const l in n)s.push(n[l]);return s},o.identity=tu,o.interpolate=Fn,o.invert=function(i,e){var n=e[0],s=e[1],l=e[2],h=e[3],d=e[4],m=e[5],x=e[6],w=e[7],I=e[8],C=e[9],L=e[10],F=e[11],U=e[12],Z=e[13],Y=e[14],Q=e[15],oe=n*m-s*d,ie=n*x-l*d,le=n*w-h*d,he=s*x-l*m,be=s*w-h*m,Ge=l*w-h*x,et=I*Z-C*U,qe=I*Y-L*U,$e=I*Q-F*U,Re=C*Y-L*Z,Xe=C*Q-F*Z,Fe=L*Q-F*Y,Me=oe*Fe-ie*Xe+le*Re+he*$e-be*qe+Ge*et;return Me?(i[0]=(m*Fe-x*Xe+w*Re)*(Me=1/Me),i[1]=(l*Xe-s*Fe-h*Re)*Me,i[2]=(Z*Ge-Y*be+Q*he)*Me,i[3]=(L*be-C*Ge-F*he)*Me,i[4]=(x*$e-d*Fe-w*qe)*Me,i[5]=(n*Fe-l*$e+h*qe)*Me,i[6]=(Y*le-U*Ge-Q*ie)*Me,i[7]=(I*Ge-L*le+F*ie)*Me,i[8]=(d*Xe-m*$e+w*et)*Me,i[9]=(s*$e-n*Xe-h*et)*Me,i[10]=(U*be-Z*le+Q*oe)*Me,i[11]=(C*le-I*be-F*oe)*Me,i[12]=(m*qe-d*Re-x*et)*Me,i[13]=(n*Re-s*qe+l*et)*Me,i[14]=(Z*ie-U*he-Y*oe)*Me,i[15]=(I*he-C*ie+L*oe)*Me,i):null},o.isImageBitmap=mi,o.isSafari=Xi,o.isWorker=Gt,o.keysDifference=function(i,e){const n=[];for(const s in i)s in e||n.push(s);return n},o.lazyLoadRTLTextPlugin=function(){Kn.isLoading()||Kn.isLoaded()||Ba()!=="deferred"||Zl()},o.makeRequest=Zn,o.mapObject=it,o.mercatorXfromLng=ip,o.mercatorYfromLat=np,o.mercatorZfromAltitude=rp,o.mul=Fd,o.mul$1=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},o.multiply=ah,o.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},o.operations=Ct,o.ortho=function(i,e,n,s,l,h,d){var m=1/(e-n),x=1/(s-l),w=1/(h-d);return i[0]=-2*m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*w,i[11]=0,i[12]=(e+n)*m,i[13]=(l+s)*x,i[14]=(d+h)*w,i[15]=1,i},o.parseCacheControl=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,l,h)=>{const d=l||h;return e[s]=!d||d.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},o.parseGlyphPbf=function(i){return new gu(i).readFields(jf,[])},o.pbf=Dh,o.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=si/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],n=e.layout,s=e._unevaluatedLayout._values,l={layoutIconSize:s["icon-size"].possiblyEvaluate(new Qt(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new Qt(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new Qt(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:w,maxZoom:I}=i.bucket.textSizeData;l.compositeTextSizes=[s["text-size"].possiblyEvaluate(new Qt(w),i.canonical),s["text-size"].possiblyEvaluate(new Qt(I),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:w,maxZoom:I}=i.bucket.iconSizeData;l.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new Qt(w),i.canonical),s["icon-size"].possiblyEvaluate(new Qt(I),i.canonical)]}const h=n.get("text-line-height")*Bi,d=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",m=n.get("text-keep-upright"),x=n.get("text-size");for(const w of i.bucket.features){const I=n.get("text-font").evaluate(w,{},i.canonical).join(","),C=x.evaluate(w,{},i.canonical),L=l.layoutTextSize.evaluate(w,{},i.canonical),F=l.layoutIconSize.evaluate(w,{},i.canonical),U={horizontal:{},vertical:void 0},Z=w.text;let Y,Q=[0,0];if(Z){const le=Z.toString(),he=n.get("text-letter-spacing").evaluate(w,{},i.canonical)*Bi,be=Xc(le)?he:0,Ge=n.get("text-anchor").evaluate(w,{},i.canonical),et=wp(e,w,i.canonical);if(!et){const Fe=n.get("text-radial-offset").evaluate(w,{},i.canonical);Q=Fe?bp(Ge,[Fe*Bi,Cu]):n.get("text-offset").evaluate(w,{},i.canonical).map(Me=>Me*Bi)}let qe=d?"center":n.get("text-justify").evaluate(w,{},i.canonical);const $e=n.get("symbol-placement"),Re=$e==="point"?n.get("text-max-width").evaluate(w,{},i.canonical)*Bi:0,Xe=()=>{i.bucket.allowVerticalPlacement&&Vo(le)&&(U.vertical=ac(Z,i.glyphMap,i.glyphPositions,i.imagePositions,I,Re,h,Ge,"left",be,Q,o.WritingMode.vertical,!0,$e,L,C))};if(!d&&et){const Fe=new Set;if(qe==="auto")for(let ot=0;ot<et.values.length;ot+=2)Fe.add(Pu(et.values[ot]));else Fe.add(qe);let Me=!1;for(const ot of Fe)if(!U.horizontal[ot])if(Me)U.horizontal[ot]=U.horizontal[0];else{const tt=ac(Z,i.glyphMap,i.glyphPositions,i.imagePositions,I,Re,h,"center",ot,be,Q,o.WritingMode.horizontal,!1,$e,L,C);tt&&(U.horizontal[ot]=tt,Me=tt.positionedLines.length===1)}Xe()}else{qe==="auto"&&(qe=Pu(Ge));const Fe=ac(Z,i.glyphMap,i.glyphPositions,i.imagePositions,I,Re,h,Ge,qe,be,Q,o.WritingMode.horizontal,!1,$e,L,C);Fe&&(U.horizontal[qe]=Fe),Xe(),Vo(le)&&d&&m&&(U.vertical=ac(Z,i.glyphMap,i.glyphPositions,i.imagePositions,I,Re,h,Ge,qe,be,Q,o.WritingMode.vertical,!1,$e,L,C))}}let oe=!1;if(w.icon&&w.icon.name){const le=i.imageMap[w.icon.name];le&&(Y=Xf(i.imagePositions[w.icon.name],n.get("icon-offset").evaluate(w,{},i.canonical),n.get("icon-anchor").evaluate(w,{},i.canonical)),oe=!!le.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=oe:i.bucket.sdfIcons!==oe&&vt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(le.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ie=Sp(U.horizontal)||U.vertical;i.bucket.iconsInText=!!ie&&ie.iconsInText,(ie||Y)&&pm(i.bucket,w,U,Y,i.imageMap,l,L,F,Q,oe,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},o.perspective=function(i,e,n,s,l){var h,d=1/Math.tan(e/2);return i[0]=d/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+s)*(h=1/(s-l)),i[14]=2*l*s*h):(i[10]=-1,i[14]=-2*s),i},o.pick=function(i,e){const n={};for(let s=0;s<e.length;s++){const l=e[s];l in i&&(n[l]=i[l])}return n},o.plugin=Kn,o.pointGeometry=z,o.polygonIntersectsPolygon=th,o.potpack=$h,o.register=He,o.registerForPluginStateChange=function(i){return i({pluginStatus:wn,pluginURL:Mr}),Ra.on("pluginStateChange",i),i},o.renderColorRamp=ph,o.rotateX=function(i,e,n){var s=Math.sin(n),l=Math.cos(n),h=e[4],d=e[5],m=e[6],x=e[7],w=e[8],I=e[9],C=e[10],L=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=h*l+w*s,i[5]=d*l+I*s,i[6]=m*l+C*s,i[7]=x*l+L*s,i[8]=w*l-h*s,i[9]=I*l-d*s,i[10]=C*l-m*s,i[11]=L*l-x*s,i},o.rotateZ=function(i,e,n){var s=Math.sin(n),l=Math.cos(n),h=e[0],d=e[1],m=e[2],x=e[3],w=e[4],I=e[5],C=e[6],L=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*l+w*s,i[1]=d*l+I*s,i[2]=m*l+C*s,i[3]=x*l+L*s,i[4]=w*l-h*s,i[5]=I*l-d*s,i[6]=C*l-m*s,i[7]=L*l-x*s,i},o.sameOrigin=un,o.scale=function(i,e,n){var s=n[0],l=n[1],h=n[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*h,i[9]=e[9]*h,i[10]=e[10]*h,i[11]=e[11]*h,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},o.setRTLTextPlugin=function(i,e,n=!1){if(wn===ro||wn===ka||wn===za)throw new Error("setRTLTextPlugin cannot be called multiple times.");Mr=li.resolveURL(i),wn=ro,Da=e,La(),n||Zl()},o.sphericalToCartesian=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}},o.toEvaluationFeature=Dr,o.transformMat4=ec,o.translate=function(i,e,n){var s,l,h,d,m,x,w,I,C,L,F,U,Z=n[0],Y=n[1],Q=n[2];return e===i?(i[12]=e[0]*Z+e[4]*Y+e[8]*Q+e[12],i[13]=e[1]*Z+e[5]*Y+e[9]*Q+e[13],i[14]=e[2]*Z+e[6]*Y+e[10]*Q+e[14],i[15]=e[3]*Z+e[7]*Y+e[11]*Q+e[15]):(l=e[1],h=e[2],d=e[3],m=e[4],x=e[5],w=e[6],I=e[7],C=e[8],L=e[9],F=e[10],U=e[11],i[0]=s=e[0],i[1]=l,i[2]=h,i[3]=d,i[4]=m,i[5]=x,i[6]=w,i[7]=I,i[8]=C,i[9]=L,i[10]=F,i[11]=U,i[12]=s*Z+m*Y+C*Q+e[12],i[13]=l*Z+x*Y+L*Q+e[13],i[14]=h*Z+w*Y+F*Q+e[14],i[15]=d*Z+I*Y+U*Q+e[15]),i},o.triggerPluginCompletionEvent=ql,o.unicodeBlockLookup=Ze,o.uniqueId=function(){return je++},o.v8Spec=ye,o.validateCustomStyleLayer=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateLight=no,o.validateStyle=io,o.vectorTile=Ls,o.warnOnce=vt,o.wrap=rt}),S(["./shared"],function(o){class O{constructor(P){this.keyCache={},P&&this.replace(P)}replace(P){this._layerConfigs={},this._layers={},this.update(P,[])}update(P,R){for(const X of P){this._layerConfigs[X.id]=X;const $=this._layers[X.id]=o.createStyleLayer(X);$._featureFilter=o.createFilter($.filter),this.keyCache[X.id]&&delete this.keyCache[X.id]}for(const X of R)delete this.keyCache[X],delete this._layerConfigs[X],delete this._layers[X];this.familiesBySource={};const V=o.groupByLayout(Object.values(this._layerConfigs),this.keyCache);for(const X of V){const $=X.map(Se=>this._layers[Se.id]),J=$[0];if(J.visibility==="none")continue;const te=J.source||"";let ee=this.familiesBySource[te];ee||(ee=this.familiesBySource[te]={});const ae=J.sourceLayer||"_geojsonTileLayer";let we=ee[ae];we||(we=ee[ae]=[]),we.push($)}}}class z{constructor(P){const R={},V=[];for(const te in P){const ee=P[te],ae=R[te]={};for(const we in ee){const Se=ee[+we];if(!Se||Se.bitmap.width===0||Se.bitmap.height===0)continue;const Ee={x:0,y:0,w:Se.bitmap.width+2,h:Se.bitmap.height+2};V.push(Ee),ae[we]={rect:Ee,metrics:Se.metrics}}}const{w:X,h:$}=o.potpack(V),J=new o.AlphaImage({width:X||1,height:$||1});for(const te in P){const ee=P[te];for(const ae in ee){const we=ee[+ae];if(!we||we.bitmap.width===0||we.bitmap.height===0)continue;const Se=R[te][ae].rect;o.AlphaImage.copy(we.bitmap,J,{x:0,y:0},{x:Se.x+1,y:Se.y+1},we.bitmap)}}this.image=J,this.positions=R}}o.register("GlyphAtlas",z);class ne{constructor(P){this.tileID=new o.OverscaledTileID(P.tileID.overscaledZ,P.tileID.wrap,P.tileID.canonical.z,P.tileID.canonical.x,P.tileID.canonical.y),this.uid=P.uid,this.zoom=P.zoom,this.pixelRatio=P.pixelRatio,this.tileSize=P.tileSize,this.source=P.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=P.showCollisionBoxes,this.collectResourceTiming=!!P.collectResourceTiming,this.returnDependencies=!!P.returnDependencies,this.promoteId=P.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(P,R,V,X,$){this.status="parsing",this.data=P,this.collisionBoxArray=new o.CollisionBoxArray;const J=new o.DictionaryCoder(Object.keys(P.layers).sort()),te=new o.FeatureIndex(this.tileID,this.promoteId);te.bucketLayerIDs=[];const ee={},ae={featureIndex:te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:V},we=R.familiesBySource[this.source];for(const St in we){const Pt=P.layers[St];if(!Pt)continue;Pt.version===1&&o.warnOnce(`Vector tile source "${this.source}" layer "${St}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const bn=J.encode(St),pt=[];for(let Ai=0;Ai<Pt.length;Ai++){const Qi=Pt.feature(Ai),_i=te.getId(Qi,St);pt.push({feature:Qi,id:_i,index:Ai,sourceLayerIndex:bn})}for(const Ai of we[St]){const Qi=Ai[0];Qi.source!==this.source&&o.warnOnce(`layer.source = ${Qi.source} does not equal this.source = ${this.source}`),Qi.minzoom&&this.zoom<Math.floor(Qi.minzoom)||Qi.maxzoom&&this.zoom>=Qi.maxzoom||Qi.visibility!=="none"&&(H(Ai,this.zoom,V),(ee[Qi.id]=Qi.createBucket({index:te.bucketLayerIDs.length,layers:Ai,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:bn,sourceID:this.source})).populate(pt,ae,this.tileID.canonical),te.bucketLayerIDs.push(Ai.map(_i=>_i.id)))}}let Se,Ee,lt,_t;const Je=o.mapObject(ae.glyphDependencies,St=>Object.keys(St).map(Number));this.inFlightDependencies.forEach(St=>St==null?void 0:St.cancel()),this.inFlightDependencies=[];const st=++this.dependencySentinel;Object.keys(Je).length?this.inFlightDependencies.push(X.send("getGlyphs",{uid:this.uid,stacks:Je,source:this.source,tileID:this.tileID,type:"glyphs"},(St,Pt)=>{st===this.dependencySentinel&&(Se||(Se=St,Ee=Pt,jt.call(this)))})):Ee={};const mt=Object.keys(ae.iconDependencies);mt.length?this.inFlightDependencies.push(X.send("getImages",{icons:mt,source:this.source,tileID:this.tileID,type:"icons"},(St,Pt)=>{st===this.dependencySentinel&&(Se||(Se=St,lt=Pt,jt.call(this)))})):lt={};const kt=Object.keys(ae.patternDependencies);function jt(){if(Se)return $(Se);if(Ee&&lt&&_t){const St=new z(Ee),Pt=new o.ImageAtlas(lt,_t);for(const bn in ee){const pt=ee[bn];pt instanceof o.SymbolBucket?(H(pt.layers,this.zoom,V),o.performSymbolLayout({bucket:pt,glyphMap:Ee,glyphPositions:St.positions,imageMap:lt,imagePositions:Pt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):pt.hasPattern&&(pt instanceof o.LineBucket||pt instanceof o.FillBucket||pt instanceof o.FillExtrusionBucket)&&(H(pt.layers,this.zoom,V),pt.addFeatures(ae,this.tileID.canonical,Pt.patternPositions))}this.status="done",$(null,{buckets:Object.values(ee).filter(bn=>!bn.isEmpty()),featureIndex:te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:St.image,imageAtlas:Pt,glyphMap:this.returnDependencies?Ee:null,iconMap:this.returnDependencies?lt:null,glyphPositions:this.returnDependencies?St.positions:null})}}kt.length?this.inFlightDependencies.push(X.send("getImages",{icons:kt,source:this.source,tileID:this.tileID,type:"patterns"},(St,Pt)=>{st===this.dependencySentinel&&(Se||(Se=St,_t=Pt,jt.call(this)))})):_t={},jt.call(this)}}function H(G,P,R){const V=new o.EvaluationParameters(P);for(const X of G)X.recalculate(V,R)}function ce(G,P){const R=o.getArrayBuffer(G.request,(V,X,$,J)=>{V?P(V):X&&P(null,{vectorTile:new o.vectorTile.VectorTile(new o.Protobuf(X)),rawData:X,cacheControl:$,expires:J})});return()=>{R.cancel(),P()}}class ge{constructor(P,R,V,X){this.actor=P,this.layerIndex=R,this.availableImages=V,this.loadVectorData=X||ce,this.fetching={},this.loading={},this.loaded={}}loadTile(P,R){const V=P.uid;this.loading||(this.loading={});const X=!!(P&&P.request&&P.request.collectResourceTiming)&&new o.RequestPerformance(P.request),$=this.loading[V]=new ne(P);$.abort=this.loadVectorData(P,(J,te)=>{if(delete this.loading[V],J||!te)return $.status="done",this.loaded[V]=$,R(J);const ee=te.rawData,ae={};te.expires&&(ae.expires=te.expires),te.cacheControl&&(ae.cacheControl=te.cacheControl);const we={};if(X){const Se=X.finish();Se&&(we.resourceTiming=JSON.parse(JSON.stringify(Se)))}$.vectorTile=te.vectorTile,$.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,(Se,Ee)=>{if(delete this.fetching[V],Se||!Ee)return R(Se);R(null,o.extend({rawTileData:ee.slice(0)},Ee,ae,we))}),this.loaded=this.loaded||{},this.loaded[V]=$,this.fetching[V]={rawTileData:ee,cacheControl:ae,resourceTiming:we}})}reloadTile(P,R){const V=this.loaded,X=P.uid;if(V&&V[X]){const $=V[X];$.showCollisionBoxes=P.showCollisionBoxes,$.status==="parsing"?$.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,(J,te)=>{if(J||!te)return R(J,te);let ee;if(this.fetching[X]){const{rawTileData:ae,cacheControl:we,resourceTiming:Se}=this.fetching[X];delete this.fetching[X],ee=o.extend({rawTileData:ae.slice(0)},te,we,Se)}else ee=te;R(null,ee)}):$.status==="done"&&($.vectorTile?$.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,R):R())}}abortTile(P,R){const V=this.loading,X=P.uid;V&&V[X]&&V[X].abort&&(V[X].abort(),delete V[X]),R()}removeTile(P,R){const V=this.loaded,X=P.uid;V&&V[X]&&delete V[X],R()}}class xe{constructor(){this.loaded={}}loadTile(P,R){const{uid:V,encoding:X,rawImageData:$}=P,J=o.isImageBitmap($)?this.getImageData($):$,te=new o.DEMData(V,J,X);this.loaded=this.loaded||{},this.loaded[V]=te,R(null,te)}getImageData(P){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(P.width,P.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=P.width,this.offscreenCanvas.height=P.height,this.offscreenCanvasContext.drawImage(P,0,0,P.width,P.height);const R=this.offscreenCanvasContext.getImageData(-1,-1,P.width+2,P.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:R.width,height:R.height},R.data)}removeTile(P){const R=this.loaded,V=P.uid;R&&R[V]&&delete R[V]}}function Ce(G,P){if(G.length!==0){Ne(G[0],P);for(var R=1;R<G.length;R++)Ne(G[R],!P)}}function Ne(G,P){for(var R=0,V=0,X=0,$=G.length,J=$-1;X<$;J=X++){var te=(G[X][0]-G[J][0])*(G[J][1]+G[X][1]),ee=R+te;V+=Math.abs(R)>=Math.abs(te)?R-ee+te:te-ee+R,R=ee}R+V>=0!=!!P&&G.reverse()}var Pe=o.getDefaultExportFromCjs(function G(P,R){var V,X=P&&P.type;if(X==="FeatureCollection")for(V=0;V<P.features.length;V++)G(P.features[V],R);else if(X==="GeometryCollection")for(V=0;V<P.geometries.length;V++)G(P.geometries[V],R);else if(X==="Feature")G(P.geometry,R);else if(X==="Polygon")Ce(P.coordinates,R);else if(X==="MultiPolygon")for(V=0;V<P.coordinates.length;V++)Ce(P.coordinates[V],R);return P});const rt=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;var De={exports:{}},je=o.pointGeometry,it=o.vectorTile.VectorTileFeature,Le=Ke;function Ke(G,P){this.options=P||{},this.features=G,this.length=G.length}function ft(G,P){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=P||4096}Ke.prototype.feature=function(G){return new ft(this.features[G],this.options.extent)},ft.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var P=0;P<G.length;P++){for(var R=G[P],V=[],X=0;X<R.length;X++)V.push(new je(R[X][0],R[X][1]));this.geometry.push(V)}return this.geometry},ft.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,P=1/0,R=-1/0,V=1/0,X=-1/0,$=0;$<G.length;$++)for(var J=G[$],te=0;te<J.length;te++){var ee=J[te];P=Math.min(P,ee.x),R=Math.max(R,ee.x),V=Math.min(V,ee.y),X=Math.max(X,ee.y)}return[P,V,R,X]},ft.prototype.toGeoJSON=it.prototype.toGeoJSON;var vt=o.pbf,Tt=Le;function Pi(G){var P=new vt;return function(R,V){for(var X in R.layers)V.writeMessage(3,Gt,R.layers[X])}(G,P),P.finish()}function Gt(G,P){var R;P.writeVarintField(15,G.version||1),P.writeStringField(1,G.name||""),P.writeVarintField(5,G.extent||4096);var V={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<G.length;R++)V.feature=G.feature(R),P.writeMessage(2,oi,V);var X=V.keys;for(R=0;R<X.length;R++)P.writeStringField(3,X[R]);var $=V.values;for(R=0;R<$.length;R++)P.writeMessage(4,ai,$[R])}function oi(G,P){var R=G.feature;R.id!==void 0&&P.writeVarintField(1,R.id),P.writeMessage(2,Xi,G),P.writeVarintField(3,R.type),P.writeMessage(4,Wt,R)}function Xi(G,P){var R=G.feature,V=G.keys,X=G.values,$=G.keycache,J=G.valuecache;for(var te in R.properties){var ee=R.properties[te],ae=$[te];if(ee!==null){ae===void 0&&(V.push(te),$[te]=ae=V.length-1),P.writeVarint(ae);var we=typeof ee;we!=="string"&&we!=="boolean"&&we!=="number"&&(ee=JSON.stringify(ee));var Se=we+":"+ee,Ee=J[Se];Ee===void 0&&(X.push(ee),J[Se]=Ee=X.length-1),P.writeVarint(Ee)}}}function mi(G,P){return(P<<3)+(7&G)}function Dt(G){return G<<1^G>>31}function Wt(G,P){for(var R=G.loadGeometry(),V=G.type,X=0,$=0,J=R.length,te=0;te<J;te++){var ee=R[te],ae=1;V===1&&(ae=ee.length),P.writeVarint(mi(1,ae));for(var we=V===3?ee.length-1:ee.length,Se=0;Se<we;Se++){Se===1&&V!==1&&P.writeVarint(mi(2,we-1));var Ee=ee[Se].x-X,lt=ee[Se].y-$;P.writeVarint(Dt(Ee)),P.writeVarint(Dt(lt)),X+=Ee,$+=lt}V===3&&P.writeVarint(mi(7,1))}}function ai(G,P){var R=typeof G;R==="string"?P.writeStringField(1,G):R==="boolean"?P.writeBooleanField(7,G):R==="number"&&(G%1!=0?P.writeDoubleField(3,G):G<0?P.writeSVarintField(6,G):P.writeVarintField(5,G))}De.exports=Pi,De.exports.fromVectorTileJs=Pi,De.exports.fromGeojsonVt=function(G,P){P=P||{};var R={};for(var V in G)R[V]=new Tt(G[V].features,P),R[V].name=V,R[V].version=P.version,R[V].extent=P.extent;return Pi({layers:R})},De.exports.GeoJSONWrapper=Tt;var li=o.getDefaultExportFromCjs(De.exports);const Ui={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:G=>G},Ft=Math.fround||(yn=new Float32Array(1),G=>(yn[0]=+G,yn[0]));var yn;const cn=3,Lt=5,Zn=6;class Sr{constructor(P){this.options=Object.assign(Object.create(Ui),P),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(P){const{log:R,minZoom:V,maxZoom:X}=this.options;R&&console.time("total time");const $=`prepare ${P.length} points`;R&&console.time($),this.points=P;const J=[];for(let ee=0;ee<P.length;ee++){const ae=P[ee];if(!ae.geometry)continue;const[we,Se]=ae.geometry.coordinates,Ee=Ft(Gn(we)),lt=Ft(ci(Se));J.push(Ee,lt,1/0,ee,-1,1),this.options.reduce&&J.push(0)}let te=this.trees[X+1]=this._createTree(J);R&&console.timeEnd($);for(let ee=X;ee>=V;ee--){const ae=+Date.now();te=this.trees[ee]=this._createTree(this._cluster(te,ee)),R&&console.log("z%d: %d clusters in %dms",ee,te.numItems,+Date.now()-ae)}return R&&console.timeEnd("total time"),this}getClusters(P,R){let V=((P[0]+180)%360+360)%360-180;const X=Math.max(-90,Math.min(90,P[1]));let $=P[2]===180?180:((P[2]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,P[3]));if(P[2]-P[0]>=360)V=-180,$=180;else if(V>$){const Se=this.getClusters([V,X,180,J],R),Ee=this.getClusters([-180,X,$,J],R);return Se.concat(Ee)}const te=this.trees[this._limitZoom(R)],ee=te.range(Gn(V),ci(J),Gn($),ci(X)),ae=te.data,we=[];for(const Se of ee){const Ee=this.stride*Se;we.push(ae[Ee+Lt]>1?un(ae,Ee,this.clusterProps):this.points[ae[Ee+cn]])}return we}getChildren(P){const R=this._getOriginId(P),V=this._getOriginZoom(P),X="No cluster with the specified id.",$=this.trees[V];if(!$)throw new Error(X);const J=$.data;if(R*this.stride>=J.length)throw new Error(X);const te=this.options.radius/(this.options.extent*Math.pow(2,V-1)),ee=$.within(J[R*this.stride],J[R*this.stride+1],te),ae=[];for(const we of ee){const Se=we*this.stride;J[Se+4]===P&&ae.push(J[Se+Lt]>1?un(J,Se,this.clusterProps):this.points[J[Se+cn]])}if(ae.length===0)throw new Error(X);return ae}getLeaves(P,R,V){const X=[];return this._appendLeaves(X,P,R=R||10,V=V||0,0),X}getTile(P,R,V){const X=this.trees[this._limitZoom(P)],$=Math.pow(2,P),{extent:J,radius:te}=this.options,ee=te/J,ae=(V-ee)/$,we=(V+1+ee)/$,Se={features:[]};return this._addTileFeatures(X.range((R-ee)/$,ae,(R+1+ee)/$,we),X.data,R,V,$,Se),R===0&&this._addTileFeatures(X.range(1-ee/$,ae,1,we),X.data,$,V,$,Se),R===$-1&&this._addTileFeatures(X.range(0,ae,ee/$,we),X.data,-1,V,$,Se),Se.features.length?Se:null}getClusterExpansionZoom(P){let R=this._getOriginZoom(P)-1;for(;R<=this.options.maxZoom;){const V=this.getChildren(P);if(R++,V.length!==1)break;P=V[0].properties.cluster_id}return R}_appendLeaves(P,R,V,X,$){const J=this.getChildren(R);for(const te of J){const ee=te.properties;if(ee&&ee.cluster?$+ee.point_count<=X?$+=ee.point_count:$=this._appendLeaves(P,ee.cluster_id,V,X,$):$<X?$++:P.push(te),P.length===V)break}return $}_createTree(P){const R=new o.KDBush(P.length/this.stride|0,this.options.nodeSize,Float32Array);for(let V=0;V<P.length;V+=this.stride)R.add(P[V],P[V+1]);return R.finish(),R.data=P,R}_addTileFeatures(P,R,V,X,$,J){for(const te of P){const ee=te*this.stride,ae=R[ee+Lt]>1;let we,Se,Ee;if(ae)we=gr(R,ee,this.clusterProps),Se=R[ee],Ee=R[ee+1];else{const Je=this.points[R[ee+cn]];we=Je.properties;const[st,mt]=Je.geometry.coordinates;Se=Gn(st),Ee=ci(mt)}const lt={type:1,geometry:[[Math.round(this.options.extent*(Se*$-V)),Math.round(this.options.extent*(Ee*$-X))]],tags:we};let _t;_t=ae||this.options.generateId?R[ee+cn]:this.points[R[ee+cn]].id,_t!==void 0&&(lt.id=_t),J.features.push(lt)}}_limitZoom(P){return Math.max(this.options.minZoom,Math.min(Math.floor(+P),this.options.maxZoom+1))}_cluster(P,R){const{radius:V,extent:X,reduce:$,minPoints:J}=this.options,te=V/(X*Math.pow(2,R)),ee=P.data,ae=[],we=this.stride;for(let Se=0;Se<ee.length;Se+=we){if(ee[Se+2]<=R)continue;ee[Se+2]=R;const Ee=ee[Se],lt=ee[Se+1],_t=P.within(ee[Se],ee[Se+1],te),Je=ee[Se+Lt];let st=Je;for(const mt of _t){const kt=mt*we;ee[kt+2]>R&&(st+=ee[kt+Lt])}if(st>Je&&st>=J){let mt,kt=Ee*Je,jt=lt*Je,St=-1;const Pt=((Se/we|0)<<5)+(R+1)+this.points.length;for(const bn of _t){const pt=bn*we;if(ee[pt+2]<=R)continue;ee[pt+2]=R;const Ai=ee[pt+Lt];kt+=ee[pt]*Ai,jt+=ee[pt+1]*Ai,ee[pt+4]=Pt,$&&(mt||(mt=this._map(ee,Se,!0),St=this.clusterProps.length,this.clusterProps.push(mt)),$(mt,this._map(ee,pt)))}ee[Se+4]=Pt,ae.push(kt/st,jt/st,1/0,Pt,-1,st),$&&ae.push(St)}else{for(let mt=0;mt<we;mt++)ae.push(ee[Se+mt]);if(st>1)for(const mt of _t){const kt=mt*we;if(!(ee[kt+2]<=R)){ee[kt+2]=R;for(let jt=0;jt<we;jt++)ae.push(ee[kt+jt])}}}}return ae}_getOriginId(P){return P-this.points.length>>5}_getOriginZoom(P){return(P-this.points.length)%32}_map(P,R,V){if(P[R+Lt]>1){const J=this.clusterProps[P[R+Zn]];return V?Object.assign({},J):J}const X=this.points[P[R+cn]].properties,$=this.options.map(X);return V&&$===X?Object.assign({},$):$}}function un(G,P,R){return{type:"Feature",id:G[P+cn],properties:gr(G,P,R),geometry:{type:"Point",coordinates:[(V=G[P],360*(V-.5)),hn(G[P+1])]}};var V}function gr(G,P,R){const V=G[P+Lt],X=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V,$=G[P+Zn],J=$===-1?{}:Object.assign({},R[$]);return Object.assign(J,{cluster:!0,cluster_id:G[P+cn],point_count:V,point_count_abbreviated:X})}function Gn(G){return G/360+.5}function ci(G){const P=Math.sin(G*Math.PI/180),R=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return R<0?0:R>1?1:R}function hn(G){const P=(180-360*G)*Math.PI/180;return 360*Math.atan(Math.exp(P))/Math.PI-90}function Wn(G,P,R,V){for(var X,$=V,J=R-P>>1,te=R-P,ee=G[P],ae=G[P+1],we=G[R],Se=G[R+1],Ee=P+3;Ee<R;Ee+=3){var lt=ye(G[Ee],G[Ee+1],ee,ae,we,Se);if(lt>$)X=Ee,$=lt;else if(lt===$){var _t=Math.abs(Ee-J);_t<te&&(X=Ee,te=_t)}}$>V&&(X-P>3&&Wn(G,P,X,V),G[X+2]=$,R-X>3&&Wn(G,X,R,V))}function ye(G,P,R,V,X,$){var J=X-R,te=$-V;if(J!==0||te!==0){var ee=((G-R)*J+(P-V)*te)/(J*J+te*te);ee>1?(R=X,V=$):ee>0&&(R+=J*ee,V+=te*ee)}return(J=G-R)*J+(te=P-V)*te}function zn(G,P,R,V){var X={id:G===void 0?null:G,type:P,geometry:R,tags:V,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function($){var J=$.geometry,te=$.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")Er($,J);else if(te==="Polygon"||te==="MultiLineString")for(var ee=0;ee<J.length;ee++)Er($,J[ee]);else if(te==="MultiPolygon")for(ee=0;ee<J.length;ee++)for(var ae=0;ae<J[ee].length;ae++)Er($,J[ee][ae])}(X),X}function Er(G,P){for(var R=0;R<P.length;R+=3)G.minX=Math.min(G.minX,P[R]),G.minY=Math.min(G.minY,P[R+1]),G.maxX=Math.max(G.maxX,P[R]),G.maxY=Math.max(G.maxY,P[R+1])}function It(G,P,R,V){if(P.geometry){var X=P.geometry.coordinates,$=P.geometry.type,J=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2),te=[],ee=P.id;if(R.promoteId?ee=P.properties[R.promoteId]:R.generateId&&(ee=V||0),$==="Point")Ct(X,te);else if($==="MultiPoint")for(var ae=0;ae<X.length;ae++)Ct(X[ae],te);else if($==="LineString")rr(X,te,J,!1);else if($==="MultiLineString"){if(R.lineMetrics){for(ae=0;ae<X.length;ae++)rr(X[ae],te=[],J,!1),G.push(zn(ee,"LineString",te,P.properties));return}pn(X,te,J,!1)}else if($==="Polygon")pn(X,te,J,!0);else{if($!=="MultiPolygon"){if($==="GeometryCollection"){for(ae=0;ae<P.geometry.geometries.length;ae++)It(G,{id:ee,geometry:P.geometry.geometries[ae],properties:P.properties},R,V);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ae=0;ae<X.length;ae++){var we=[];pn(X[ae],we,J,!0),te.push(we)}}G.push(zn(ee,$,te,P.properties))}}function Ct(G,P){P.push(Vr(G[0])),P.push(Jr(G[1])),P.push(0)}function rr(G,P,R,V){for(var X,$,J=0,te=0;te<G.length;te++){var ee=Vr(G[te][0]),ae=Jr(G[te][1]);P.push(ee),P.push(ae),P.push(0),te>0&&(J+=V?(X*ae-ee*$)/2:Math.sqrt(Math.pow(ee-X,2)+Math.pow(ae-$,2))),X=ee,$=ae}var we=P.length-3;P[2]=1,Wn(P,0,we,R),P[we+2]=1,P.size=Math.abs(J),P.start=0,P.end=P.size}function pn(G,P,R,V){for(var X=0;X<G.length;X++){var $=[];rr(G[X],$,R,V),P.push($)}}function Vr(G){return G/360+.5}function Jr(G){var P=Math.sin(G*Math.PI/180),R=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return R<0?0:R>1?1:R}function Rt(G,P,R,V,X,$,J,te){if(V/=P,$>=(R/=P)&&J<V)return G;if(J<R||$>=V)return null;for(var ee=[],ae=0;ae<G.length;ae++){var we=G[ae],Se=we.geometry,Ee=we.type,lt=X===0?we.minX:we.minY,_t=X===0?we.maxX:we.maxY;if(lt>=R&&_t<V)ee.push(we);else if(!(_t<R||lt>=V)){var Je=[];if(Ee==="Point"||Ee==="MultiPoint")_r(Se,Je,R,V,X);else if(Ee==="LineString")yr(Se,Je,R,V,X,!1,te.lineMetrics);else if(Ee==="MultiLineString")ki(Se,Je,R,V,X,!1);else if(Ee==="Polygon")ki(Se,Je,R,V,X,!0);else if(Ee==="MultiPolygon")for(var st=0;st<Se.length;st++){var mt=[];ki(Se[st],mt,R,V,X,!0),mt.length&&Je.push(mt)}if(Je.length){if(te.lineMetrics&&Ee==="LineString"){for(st=0;st<Je.length;st++)ee.push(zn(we.id,Ee,Je[st],we.tags));continue}Ee!=="LineString"&&Ee!=="MultiLineString"||(Je.length===1?(Ee="LineString",Je=Je[0]):Ee="MultiLineString"),Ee!=="Point"&&Ee!=="MultiPoint"||(Ee=Je.length===3?"Point":"MultiPoint"),ee.push(zn(we.id,Ee,Je,we.tags))}}}return ee.length?ee:null}function _r(G,P,R,V,X){for(var $=0;$<G.length;$+=3){var J=G[$+X];J>=R&&J<=V&&(P.push(G[$]),P.push(G[$+1]),P.push(G[$+2]))}}function yr(G,P,R,V,X,$,J){for(var te,ee,ae=ze(G),we=X===0?zi:Dn,Se=G.start,Ee=0;Ee<G.length-3;Ee+=3){var lt=G[Ee],_t=G[Ee+1],Je=G[Ee+2],st=G[Ee+3],mt=G[Ee+4],kt=X===0?lt:_t,jt=X===0?st:mt,St=!1;J&&(te=Math.sqrt(Math.pow(lt-st,2)+Math.pow(_t-mt,2))),kt<R?jt>R&&(ee=we(ae,lt,_t,st,mt,R),J&&(ae.start=Se+te*ee)):kt>V?jt<V&&(ee=we(ae,lt,_t,st,mt,V),J&&(ae.start=Se+te*ee)):Yi(ae,lt,_t,Je),jt<R&&kt>=R&&(ee=we(ae,lt,_t,st,mt,R),St=!0),jt>V&&kt<=V&&(ee=we(ae,lt,_t,st,mt,V),St=!0),!$&&St&&(J&&(ae.end=Se+te*ee),P.push(ae),ae=ze(G)),J&&(Se+=te)}var Pt=G.length-3;lt=G[Pt],_t=G[Pt+1],Je=G[Pt+2],(kt=X===0?lt:_t)>=R&&kt<=V&&Yi(ae,lt,_t,Je),Pt=ae.length-3,$&&Pt>=3&&(ae[Pt]!==ae[0]||ae[Pt+1]!==ae[1])&&Yi(ae,ae[0],ae[1],ae[2]),ae.length&&P.push(ae)}function ze(G){var P=[];return P.size=G.size,P.start=G.start,P.end=G.end,P}function ki(G,P,R,V,X,$){for(var J=0;J<G.length;J++)yr(G[J],P,R,V,X,$,!1)}function Yi(G,P,R,V){G.push(P),G.push(R),G.push(V)}function zi(G,P,R,V,X,$){var J=($-P)/(V-P);return G.push($),G.push(R+(X-R)*J),G.push(1),J}function Dn(G,P,R,V,X,$){var J=($-R)/(X-R);return G.push(P+(V-P)*J),G.push($),G.push(1),J}function Be(G,P){for(var R=[],V=0;V<G.length;V++){var X,$=G[V],J=$.type;if(J==="Point"||J==="MultiPoint"||J==="LineString")X=dt($.geometry,P);else if(J==="MultiLineString"||J==="Polygon"){X=[];for(var te=0;te<$.geometry.length;te++)X.push(dt($.geometry[te],P))}else if(J==="MultiPolygon")for(X=[],te=0;te<$.geometry.length;te++){for(var ee=[],ae=0;ae<$.geometry[te].length;ae++)ee.push(dt($.geometry[te][ae],P));X.push(ee)}R.push(zn($.id,J,X,$.tags))}return R}function dt(G,P){var R=[];R.size=G.size,G.start!==void 0&&(R.start=G.start,R.end=G.end);for(var V=0;V<G.length;V+=3)R.push(G[V]+P,G[V+1],G[V+2]);return R}function gt(G,P){if(G.transformed)return G;var R,V,X,$=1<<G.z,J=G.x,te=G.y;for(R=0;R<G.features.length;R++){var ee=G.features[R],ae=ee.geometry,we=ee.type;if(ee.geometry=[],we===1)for(V=0;V<ae.length;V+=2)ee.geometry.push(Di(ae[V],ae[V+1],P,$,J,te));else for(V=0;V<ae.length;V++){var Se=[];for(X=0;X<ae[V].length;X+=2)Se.push(Di(ae[V][X],ae[V][X+1],P,$,J,te));ee.geometry.push(Se)}}return G.transformed=!0,G}function Di(G,P,R,V,X,$){return[Math.round(R*(G*V-X)),Math.round(R*(P*V-$))]}function Li(G,P,R,V,X){for(var $=P===X.maxZoom?0:X.tolerance/((1<<P)*X.extent),J={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:R,y:V,z:P,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},te=0;te<G.length;te++){J.numFeatures++,at(J,G[te],$,X);var ee=G[te].minX,ae=G[te].minY,we=G[te].maxX,Se=G[te].maxY;ee<J.minX&&(J.minX=ee),ae<J.minY&&(J.minY=ae),we>J.maxX&&(J.maxX=we),Se>J.maxY&&(J.maxY=Se)}return J}function at(G,P,R,V){var X=P.geometry,$=P.type,J=[];if($==="Point"||$==="MultiPoint")for(var te=0;te<X.length;te+=3)J.push(X[te]),J.push(X[te+1]),G.numPoints++,G.numSimplified++;else if($==="LineString")xn(J,X,G,R,!1,!1);else if($==="MultiLineString"||$==="Polygon")for(te=0;te<X.length;te++)xn(J,X[te],G,R,$==="Polygon",te===0);else if($==="MultiPolygon")for(var ee=0;ee<X.length;ee++){var ae=X[ee];for(te=0;te<ae.length;te++)xn(J,ae[te],G,R,!0,te===0)}if(J.length){var we=P.tags||null;if($==="LineString"&&V.lineMetrics){for(var Se in we={},P.tags)we[Se]=P.tags[Se];we.mapbox_clip_start=X.start/X.size,we.mapbox_clip_end=X.end/X.size}var Ee={geometry:J,type:$==="Polygon"||$==="MultiPolygon"?3:$==="LineString"||$==="MultiLineString"?2:1,tags:we};P.id!==null&&(Ee.id=P.id),G.features.push(Ee)}}function xn(G,P,R,V,X,$){var J=V*V;if(V>0&&P.size<(X?J:V))R.numPoints+=P.length/3;else{for(var te=[],ee=0;ee<P.length;ee+=3)(V===0||P[ee+2]>J)&&(R.numSimplified++,te.push(P[ee]),te.push(P[ee+1])),R.numPoints++;X&&function(ae,we){for(var Se=0,Ee=0,lt=ae.length,_t=lt-2;Ee<lt;_t=Ee,Ee+=2)Se+=(ae[Ee]-ae[_t])*(ae[Ee+1]+ae[_t+1]);if(Se>0===we)for(Ee=0,lt=ae.length;Ee<lt/2;Ee+=2){var Je=ae[Ee],st=ae[Ee+1];ae[Ee]=ae[lt-2-Ee],ae[Ee+1]=ae[lt-1-Ee],ae[lt-2-Ee]=Je,ae[lt-1-Ee]=st}}(te,$),G.push(te)}}function Vi(G,P){var R=(P=this.options=function(X,$){for(var J in $)X[J]=$[J];return X}(Object.create(this.options),P)).debug;if(R&&console.time("preprocess data"),P.maxZoom<0||P.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(P.promoteId&&P.generateId)throw new Error("promoteId and generateId cannot be used together.");var V=function(X,$){var J=[];if(X.type==="FeatureCollection")for(var te=0;te<X.features.length;te++)It(J,X.features[te],$,te);else It(J,X.type==="Feature"?X:{geometry:X},$);return J}(G,P);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",P.indexMaxZoom,P.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),V=function(X,$){var J=$.buffer/$.extent,te=X,ee=Rt(X,1,-1-J,J,0,-1,2,$),ae=Rt(X,1,1-J,2+J,0,-1,2,$);return(ee||ae)&&(te=Rt(X,1,-J,1+J,0,-1,2,$)||[],ee&&(te=Be(ee,1).concat(te)),ae&&(te=te.concat(Be(ae,-1)))),te}(V,P),V.length&&this.splitTile(V,0,0,0),R&&(V.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ki(G,P,R){return 32*((1<<G)*R+P)+G}function Ji(G,P){return P?G.properties[P]:G.id}function sr(G,P){if(G==null)return!0;if(G.type==="Feature")return Ji(G,P)!=null;if(G.type==="FeatureCollection"){const R=new Set;for(const V of G.features){const X=Ji(V,P);if(X==null||R.has(X))return!1;R.add(X)}return!0}return!1}function gi(G,P){const R=new Map;if(G!=null)if(G.type==="Feature")R.set(Ji(G,P),G);else for(const V of G.features)R.set(Ji(V,P),V);return R}function Ut(G,P){const R=G.tileID.canonical;if(!this._geoJSONIndex)return P(null,null);const V=this._geoJSONIndex.getTile(R.z,R.x,R.y);if(!V)return P(null,null);const X=new class{constructor(J){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=J.length,this._features=J}feature(J){return new class{constructor(te){this._feature=te,this.extent=o.EXTENT,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const ee of this._feature.geometry)te.push([new o.Point(ee[0],ee[1])]);return te}{const te=[];for(const ee of this._feature.geometry){const ae=[];for(const we of ee)ae.push(new o.Point(we[0],we[1]));te.push(ae)}return te}}toGeoJSON(te,ee,ae){return rt.call(this,te,ee,ae)}}(this._features[J])}}(V.features);let $=li(X);$.byteOffset===0&&$.byteLength===$.buffer.byteLength||($=new Uint8Array($)),P(null,{vectorTile:X,rawData:$.buffer})}Vi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Vi.prototype.splitTile=function(G,P,R,V,X,$,J){for(var te=[G,P,R,V],ee=this.options,ae=ee.debug;te.length;){V=te.pop(),R=te.pop(),P=te.pop(),G=te.pop();var we=1<<P,Se=Ki(P,R,V),Ee=this.tiles[Se];if(!Ee&&(ae>1&&console.time("creation"),Ee=this.tiles[Se]=Li(G,P,R,V,ee),this.tileCoords.push({z:P,x:R,y:V}),ae)){ae>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",P,R,V,Ee.numFeatures,Ee.numPoints,Ee.numSimplified),console.timeEnd("creation"));var lt="z"+P;this.stats[lt]=(this.stats[lt]||0)+1,this.total++}if(Ee.source=G,X){if(P===ee.maxZoom||P===X)continue;var _t=1<<X-P;if(R!==Math.floor($/_t)||V!==Math.floor(J/_t))continue}else if(P===ee.indexMaxZoom||Ee.numPoints<=ee.indexMaxPoints)continue;if(Ee.source=null,G.length!==0){ae>1&&console.time("clipping");var Je,st,mt,kt,jt,St,Pt=.5*ee.buffer/ee.extent,bn=.5-Pt,pt=.5+Pt,Ai=1+Pt;Je=st=mt=kt=null,jt=Rt(G,we,R-Pt,R+pt,0,Ee.minX,Ee.maxX,ee),St=Rt(G,we,R+bn,R+Ai,0,Ee.minX,Ee.maxX,ee),G=null,jt&&(Je=Rt(jt,we,V-Pt,V+pt,1,Ee.minY,Ee.maxY,ee),st=Rt(jt,we,V+bn,V+Ai,1,Ee.minY,Ee.maxY,ee),jt=null),St&&(mt=Rt(St,we,V-Pt,V+pt,1,Ee.minY,Ee.maxY,ee),kt=Rt(St,we,V+bn,V+Ai,1,Ee.minY,Ee.maxY,ee),St=null),ae>1&&console.timeEnd("clipping"),te.push(Je||[],P+1,2*R,2*V),te.push(st||[],P+1,2*R,2*V+1),te.push(mt||[],P+1,2*R+1,2*V),te.push(kt||[],P+1,2*R+1,2*V+1)}}},Vi.prototype.getTile=function(G,P,R){var V=this.options,X=V.extent,$=V.debug;if(G<0||G>24)return null;var J=1<<G,te=Ki(G,P=(P%J+J)%J,R);if(this.tiles[te])return gt(this.tiles[te],X);$>1&&console.log("drilling down to z%d-%d-%d",G,P,R);for(var ee,ae=G,we=P,Se=R;!ee&&ae>0;)ae--,we=Math.floor(we/2),Se=Math.floor(Se/2),ee=this.tiles[Ki(ae,we,Se)];return ee&&ee.source?($>1&&console.log("found parent tile z%d-%d-%d",ae,we,Se),$>1&&console.time("drilling down"),this.splitTile(ee.source,ae,we,Se,G,P,R),$>1&&console.timeEnd("drilling down"),this.tiles[te]?gt(this.tiles[te],X):null):null};class Ln extends ge{constructor(P,R,V,X){super(P,R,V,Ut),this._dataUpdateable=new Map,this.loadGeoJSON=($,J)=>{const{promoteId:te}=$;if($.request)return o.getJSON($.request,(ee,ae,we,Se)=>{this._dataUpdateable=sr(ae,te)?gi(ae,te):void 0,J(ee,ae,we,Se)});if(typeof $.data=="string")try{const ee=JSON.parse($.data);this._dataUpdateable=sr(ee,te)?gi(ee,te):void 0,J(null,ee)}catch{J(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}else $.dataDiff?this._dataUpdateable?(function(ee,ae,we){var Se,Ee,lt,_t;if(ae.removeAll&&ee.clear(),ae.remove)for(const Je of ae.remove)ee.delete(Je);if(ae.add)for(const Je of ae.add){const st=Ji(Je,we);st!=null&&ee.set(st,Je)}if(ae.update)for(const Je of ae.update){let st=ee.get(Je.id);if(st==null)continue;const mt=!Je.removeAllProperties&&(((Se=Je.removeProperties)===null||Se===void 0?void 0:Se.length)>0||((Ee=Je.addOrUpdateProperties)===null||Ee===void 0?void 0:Ee.length)>0);if((Je.newGeometry||Je.removeAllProperties||mt)&&(st={...st},ee.set(Je.id,st),mt&&(st.properties={...st.properties})),Je.newGeometry&&(st.geometry=Je.newGeometry),Je.removeAllProperties)st.properties={};else if(((lt=Je.removeProperties)===null||lt===void 0?void 0:lt.length)>0)for(const kt of Je.removeProperties)Object.prototype.hasOwnProperty.call(st.properties,kt)&&delete st.properties[kt];if(((_t=Je.addOrUpdateProperties)===null||_t===void 0?void 0:_t.length)>0)for(const{key:kt,value:jt}of Je.addOrUpdateProperties)st.properties[kt]=jt}}(this._dataUpdateable,$.dataDiff,te),J(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):J(new Error(`Cannot update existing geojson data in ${$.source}`)):J(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},X&&(this.loadGeoJSON=X)}loadData(P,R){var V;(V=this._pendingRequest)===null||V===void 0||V.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const X=!!(P&&P.request&&P.request.collectResourceTiming)&&new o.RequestPerformance(P.request);this._pendingCallback=R,this._pendingRequest=this.loadGeoJSON(P,($,J)=>{if(delete this._pendingCallback,delete this._pendingRequest,$||!J)return R($);if(typeof J!="object")return R(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`));{Pe(J,!0);try{if(P.filter){const ee=o.createExpression(P.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ee.result==="error")throw new Error(ee.value.map(we=>`${we.key}: ${we.message}`).join(", "));J={type:"FeatureCollection",features:J.features.filter(we=>ee.value.evaluate({zoom:0},we))}}this._geoJSONIndex=P.cluster?new Sr(function({superclusterOptions:ee,clusterProperties:ae}){if(!ae||!ee)return ee;const we={},Se={},Ee={accumulated:null,zoom:0},lt={properties:null},_t=Object.keys(ae);for(const Je of _t){const[st,mt]=ae[Je],kt=o.createExpression(mt),jt=o.createExpression(typeof st=="string"?[st,["accumulated"],["get",Je]]:st);we[Je]=kt.value,Se[Je]=jt.value}return ee.map=Je=>{lt.properties=Je;const st={};for(const mt of _t)st[mt]=we[mt].evaluate(Ee,lt);return st},ee.reduce=(Je,st)=>{lt.properties=st;for(const mt of _t)Ee.accumulated=Je[mt],Je[mt]=Se[mt].evaluate(Ee,lt)},ee}(P)).load(J.features):function(ee,ae){return new Vi(ee,ae)}(J,P.geojsonVtOptions)}catch(ee){return R(ee)}this.loaded={};const te={};if(X){const ee=X.finish();ee&&(te.resourceTiming={},te.resourceTiming[P.source]=JSON.parse(JSON.stringify(ee)))}R(null,te)}})}reloadTile(P,R){const V=this.loaded;return V&&V[P.uid]?super.reloadTile(P,R):this.loadTile(P,R)}removeSource(P,R){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),R()}getClusterExpansionZoom(P,R){try{R(null,this._geoJSONIndex.getClusterExpansionZoom(P.clusterId))}catch(V){R(V)}}getClusterChildren(P,R){try{R(null,this._geoJSONIndex.getChildren(P.clusterId))}catch(V){R(V)}}getClusterLeaves(P,R){try{R(null,this._geoJSONIndex.getLeaves(P.clusterId,P.limit,P.offset))}catch(V){R(V)}}}class vn{constructor(P){this.self=P,this.actor=new o.Actor(P,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ge,geojson:Ln},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(R,V)=>{if(this.workerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.workerSourceTypes[R]=V},this.self.registerRTLTextPlugin=R=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=R.applyArabicShaping,o.plugin.processBidirectionalText=R.processBidirectionalText,o.plugin.processStyledBidirectionalText=R.processStyledBidirectionalText}}setReferrer(P,R){this.referrer=R}setImages(P,R,V){this.availableImages[P]=R;for(const X in this.workerSources[P]){const $=this.workerSources[P][X];for(const J in $)$[J].availableImages=R}V()}setLayers(P,R,V){this.getLayerIndex(P).replace(R),V()}updateLayers(P,R,V){this.getLayerIndex(P).update(R.layers,R.removedIds),V()}loadTile(P,R,V){this.getWorkerSource(P,R.type,R.source).loadTile(R,V)}loadDEMTile(P,R,V){this.getDEMWorkerSource(P,R.source).loadTile(R,V)}reloadTile(P,R,V){this.getWorkerSource(P,R.type,R.source).reloadTile(R,V)}abortTile(P,R,V){this.getWorkerSource(P,R.type,R.source).abortTile(R,V)}removeTile(P,R,V){this.getWorkerSource(P,R.type,R.source).removeTile(R,V)}removeDEMTile(P,R){this.getDEMWorkerSource(P,R.source).removeTile(R)}removeSource(P,R,V){if(!this.workerSources[P]||!this.workerSources[P][R.type]||!this.workerSources[P][R.type][R.source])return;const X=this.workerSources[P][R.type][R.source];delete this.workerSources[P][R.type][R.source],X.removeSource!==void 0?X.removeSource(R,V):V()}loadWorkerSource(P,R,V){try{this.self.importScripts(R.url),V()}catch(X){V(X.toString())}}syncRTLPluginState(P,R,V){try{o.plugin.setState(R);const X=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&X!=null){this.self.importScripts(X);const $=o.plugin.isParsed();V($?void 0:new Error(`RTL Text Plugin failed to import scripts from ${X}`),$)}}catch(X){V(X.toString())}}getAvailableImages(P){let R=this.availableImages[P];return R||(R=[]),R}getLayerIndex(P){let R=this.layerIndexes[P];return R||(R=this.layerIndexes[P]=new O),R}getWorkerSource(P,R,V){if(this.workerSources[P]||(this.workerSources[P]={}),this.workerSources[P][R]||(this.workerSources[P][R]={}),!this.workerSources[P][R][V]){const X={send:($,J,te)=>{this.actor.send($,J,te,P)}};this.workerSources[P][R][V]=new this.workerSourceTypes[R](X,this.getLayerIndex(P),this.getAvailableImages(P))}return this.workerSources[P][R][V]}getDEMWorkerSource(P,R){return this.demWorkerSources[P]||(this.demWorkerSources[P]={}),this.demWorkerSources[P][R]||(this.demWorkerSources[P][R]=new xe),this.demWorkerSources[P][R]}}return o.isWorker()&&(self.worker=new vn(self)),vn}),S(["./shared"],function(o){var O="3.3.0";class z{static testProp(t){if(!z.docStyle)return t[0];for(let r=0;r<t.length;r++)if(t[r]in z.docStyle)return t[r];return t[0]}static create(t,r,a){const c=window.document.createElement(t);return r!==void 0&&(c.className=r),a&&a.appendChild(c),c}static createNS(t,r){return window.document.createElementNS(t,r)}static disableDrag(){z.docStyle&&z.selectProp&&(z.userSelect=z.docStyle[z.selectProp],z.docStyle[z.selectProp]="none")}static enableDrag(){z.docStyle&&z.selectProp&&(z.docStyle[z.selectProp]=z.userSelect)}static setTransform(t,r){t.style[z.transformProp]=r}static addEventListener(t,r,a,c={}){t.addEventListener(r,a,"passive"in c?c:c.capture)}static removeEventListener(t,r,a,c={}){t.removeEventListener(r,a,"passive"in c?c:c.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",z.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",z.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",z.suppressClickInternal,!0)},0)}static mousePos(t,r){const a=t.getBoundingClientRect();return new o.Point(r.clientX-a.left-t.clientLeft,r.clientY-a.top-t.clientTop)}static touchPos(t,r){const a=t.getBoundingClientRect(),c=[];for(let p=0;p<r.length;p++)c.push(new o.Point(r[p].clientX-a.left-t.clientLeft,r[p].clientY-a.top-t.clientTop));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}z.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,z.selectProp=z.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),z.transformProp=z.testProp(["transform","WebkitTransform"]);const ne={supported:!1,testSupport:function(u){!ge&&ce&&(xe?Ce(u):H=u)}};let H,ce,ge=!1,xe=!1;function Ce(u){const t=u.createTexture();u.bindTexture(u.TEXTURE_2D,t);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,ce),u.isContextLost())return;ne.supported=!0}catch{}u.deleteTexture(t),ge=!0}var Ne,Pe;typeof document<"u"&&(ce=document.createElement("img"),ce.onload=function(){H&&Ce(H),H=null,xe=!0},ce.onerror=function(){ge=!0,H=null},ce.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(u){let t,r,a,c;u.resetRequestQueue=()=>{t=[],r=0,a=0,c={}},u.addThrottleControl=T=>{const A=a++;return c[A]=T,A},u.removeThrottleControl=T=>{delete c[T],y()},u.getImage=(T,A,M=!0)=>{ne.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*");const B={requestParameters:T,supportImageRefresh:M,callback:A,cancelled:!1,completed:!1,cancel:()=>{B.completed||B.cancelled||(B.cancelled=!0,B.innerRequest&&(B.innerRequest.cancel(),r--),y())}};return t.push(B),y(),B};const p=T=>{const{requestParameters:A,supportImageRefresh:M,callback:B}=T;return o.extend(A,{type:"image"}),(M!==!1||o.isWorker()||o.getProtocolAction(A.url)||A.headers&&!Object.keys(A.headers).reduce((q,j)=>q&&j==="accept",!0)?o.makeRequest:b)(A,(q,j,W,N)=>{g(T,B,q,j,W,N)})},g=(T,A,M,B,q,j)=>{M?A(M):B instanceof HTMLImageElement||o.isImageBitmap(B)?A(null,B):B&&((W,N)=>{typeof createImageBitmap=="function"?o.arrayBufferToImageBitmap(W,N):o.arrayBufferToImage(W,N)})(B,(W,N)=>{W!=null?A(W):N!=null&&A(null,N,{cacheControl:q,expires:j})}),T.cancelled||(T.completed=!0,r--,y())},y=()=>{const T=(()=>{const A=Object.keys(c);let M=!1;if(A.length>0){for(const B of A)if(M=c[B](),M)break}return M})()?o.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=r;A<T&&t.length>0;A++){const M=t.shift();if(M.cancelled){A--;continue}const B=p(M);r++,M.innerRequest=B}},b=(T,A)=>{const M=new Image,B=T.url;let q=!1;const j=T.credentials;return j&&j==="include"?M.crossOrigin="use-credentials":(j&&j==="same-origin"||!o.sameOrigin(B))&&(M.crossOrigin="anonymous"),M.fetchPriority="high",M.onload=()=>{A(null,M),M.onerror=M.onload=null},M.onerror=()=>{q||A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),M.onerror=M.onload=null},M.src=B,{cancel:()=>{q=!0,M.src=""}}}}(Ne||(Ne={})),Ne.resetRequestQueue(),function(u){u.Glyphs="Glyphs",u.Image="Image",u.Source="Source",u.SpriteImage="SpriteImage",u.SpriteJSON="SpriteJSON",u.Style="Style",u.Tile="Tile",u.Unknown="Unknown"}(Pe||(Pe={}));class rt{constructor(t){this._transformRequestFn=t}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeSpriteURL(t,r,a){const c=function(p){const g=p.match(De);if(!g)throw new Error(`Unable to parse URL "${p}"`);return{protocol:g[1],authority:g[2],path:g[3]||"/",params:g[4]?g[4].split("&"):[]}}(t);return c.path+=`${r}${a}`,function(p){const g=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${g}`}(c)}setTransformRequest(t){this._transformRequestFn=t}}const De=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function je(u){var t=new o.ARRAY_TYPE(3);return t[0]=u[0],t[1]=u[1],t[2]=u[2],t}var it,Le=function(u,t,r){return u[0]=t[0]-r[0],u[1]=t[1]-r[1],u[2]=t[2]-r[2],u};it=new o.ARRAY_TYPE(3),o.ARRAY_TYPE!=Float32Array&&(it[0]=0,it[1]=0,it[2]=0);var Ke=function(u){var t=u[0],r=u[1];return t*t+r*r};function ft(u){const t=[];if(typeof u=="string")t.push({id:"default",url:u});else if(u&&u.length>0){const r=[];for(const{id:a,url:c}of u){const p=`${a}${c}`;r.indexOf(p)===-1&&(r.push(p),t.push({id:a,url:c}))}}return t}function vt(u,t,r,a,c){if(a)return void u(a);if(c!==Object.values(t).length||c!==Object.values(r).length)return;const p={};for(const g in t){p[g]={};const y=o.browser.getImageCanvasContext(r[g]),b=t[g];for(const T in b){const{width:A,height:M,x:B,y:q,sdf:j,pixelRatio:W,stretchX:N,stretchY:re,content:ue}=b[T];p[g][T]={data:null,pixelRatio:W,sdf:j,stretchX:N,stretchY:re,content:ue,spriteData:{width:A,height:M,x:B,y:q,context:y}}}}u(null,p)}(function(){var u=new o.ARRAY_TYPE(2);o.ARRAY_TYPE!=Float32Array&&(u[0]=0,u[1]=0)})();class Tt{constructor(t,r,a,c){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(r,c)}update(t,r,a){const{width:c,height:p}=t,g=!(this.size&&this.size[0]===c&&this.size[1]===p||a),{context:y}=this,{gl:b}=y;if(this.useMipmap=!!(r&&r.useMipmap),b.bindTexture(b.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!r||r.premultiply!==!1)),g)this.size=[c,p],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.isImageBitmap(t)?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,t):b.texImage2D(b.TEXTURE_2D,0,this.format,c,p,0,this.format,b.UNSIGNED_BYTE,t.data);else{const{x:T,y:A}=a||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.isImageBitmap(t)?b.texSubImage2D(b.TEXTURE_2D,0,T,A,b.RGBA,b.UNSIGNED_BYTE,t):b.texSubImage2D(b.TEXTURE_2D,0,T,A,c,p,b.RGBA,b.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&b.generateMipmap(b.TEXTURE_2D)}bind(t,r,a){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),a!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,a||t),this.filter=t),r!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Pi(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class Gt extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:r,callback:a}of this.requestors)this._notify(r,a);this.requestors=[]}}getImage(t){const r=this.images[t];if(r&&!r.data&&r.spriteData){const a=r.spriteData;r.data=new o.RGBAImage({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),r.spriteData=null}return r}addImage(t,r){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,r)&&(this.images[t]=r)}_validate(t,r){let a=!0;const c=r.data||r.spriteData;return this._validateStretch(r.stretchX,c&&c.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),a=!1),this._validateStretch(r.stretchY,c&&c.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),a=!1),this._validateContent(r.content,r)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),a=!1),a}_validateStretch(t,r){if(!t)return!0;let a=0;for(const c of t){if(c[0]<a||c[1]<c[0]||r<c[1])return!1;a=c[1]}return!0}_validateContent(t,r){if(!t)return!0;if(t.length!==4)return!1;const a=r.spriteData,c=a&&a.width||r.data.width,p=a&&a.height||r.data.height;return!(t[0]<0||c<t[0]||t[1]<0||p<t[1]||t[2]<0||c<t[2]||t[3]<0||p<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,r,a=!0){const c=this.getImage(t);if(a&&(c.data.width!==r.data.width||c.data.height!==r.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=c.version+1,this.images[t]=r,this.updatedImages[t]=!0}removeImage(t){const r=this.images[t];delete this.images[t],delete this.patterns[t],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,r){let a=!0;if(!this.isLoaded())for(const c of t)this.images[c]||(a=!1);this.isLoaded()||a?this._notify(t,r):this.requestors.push({ids:t,callback:r})}_notify(t,r){const a={};for(const c of t){let p=this.getImage(c);p||(this.fire(new o.Event("styleimagemissing",{id:c})),p=this.getImage(c)),p?a[c]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:o.warnOnce(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,a)}getPixelSize(){const{width:t,height:r}=this.atlasImage;return{width:t,height:r}}getPattern(t){const r=this.patterns[t],a=this.getImage(t);if(!a)return null;if(r&&r.position.version===a.version)return r.position;if(r)r.position.version=a.version;else{const c={w:a.data.width+2,h:a.data.height+2,x:0,y:0},p=new o.ImagePosition(c,a);this.patterns[t]={bin:c,position:p}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const r=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Tt(t,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const p in this.patterns)t.push(this.patterns[p].bin);const{w:r,h:a}=o.potpack(t),c=this.atlasImage;c.resize({width:r||1,height:a||1});for(const p in this.patterns){const{bin:g}=this.patterns[p],y=g.x+1,b=g.y+1,T=this.getImage(p).data,A=T.width,M=T.height;o.RGBAImage.copy(T,c,{x:0,y:0},{x:y,y:b},{width:A,height:M}),o.RGBAImage.copy(T,c,{x:0,y:M-1},{x:y,y:b-1},{width:A,height:1}),o.RGBAImage.copy(T,c,{x:0,y:0},{x:y,y:b+M},{width:A,height:1}),o.RGBAImage.copy(T,c,{x:A-1,y:0},{x:y-1,y:b},{width:1,height:M}),o.RGBAImage.copy(T,c,{x:0,y:0},{x:y+A,y:b},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const r of t){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const a=this.getImage(r);a||o.warnOnce(`Image with ID: "${r}" was not found`),Pi(a)&&this.updateImage(r,a)}}}const oi=1e20;function Xi(u,t,r,a,c,p,g,y,b){for(let T=t;T<t+a;T++)mi(u,r*p+T,p,c,g,y,b);for(let T=r;T<r+c;T++)mi(u,T*p+t,1,a,g,y,b)}function mi(u,t,r,a,c,p,g){p[0]=0,g[0]=-oi,g[1]=oi,c[0]=u[t];for(let y=1,b=0,T=0;y<a;y++){c[y]=u[t+y*r];const A=y*y;do{const M=p[b];T=(c[y]-c[M]+A-M*M)/(y-M)/2}while(T<=g[b]&&--b>-1);b++,p[b]=y,g[b]=T,g[b+1]=oi}for(let y=0,b=0;y<a;y++){for(;g[b+1]<y;)b++;const T=p[b],A=y-T;u[t+y*r]=c[T]+A*A}}class Dt{constructor(t,r){this.requestManager=t,this.localIdeographFontFamily=r,this.entries={}}setURL(t){this.url=t}getGlyphs(t,r){const a=[];for(const c in t)for(const p of t[c])a.push({stack:c,id:p});o.asyncAll(a,({stack:c,id:p},g)=>{let y=this.entries[c];y||(y=this.entries[c]={glyphs:{},requests:{},ranges:{}});let b=y.glyphs[p];if(b!==void 0)return void g(null,{stack:c,id:p,glyph:b});if(b=this._tinySDF(y,c,p),b)return y.glyphs[p]=b,void g(null,{stack:c,id:p,glyph:b});const T=Math.floor(p/256);if(256*T>65535)return void g(new Error("glyphs > 65535 not supported"));if(y.ranges[T])return void g(null,{stack:c,id:p,glyph:b});if(!this.url)return void g(new Error("glyphsUrl is not set"));let A=y.requests[T];A||(A=y.requests[T]=[],Dt.loadGlyphRange(c,T,this.url,this.requestManager,(M,B)=>{if(B){for(const q in B)this._doesCharSupportLocalGlyph(+q)||(y.glyphs[+q]=B[+q]);y.ranges[T]=!0}for(const q of A)q(M,B);delete y.requests[T]})),A.push((M,B)=>{M?g(M):B&&g(null,{stack:c,id:p,glyph:B[p]||null})})},(c,p)=>{if(c)r(c);else if(p){const g={};for(const{stack:y,id:b,glyph:T}of p)(g[y]||(g[y]={}))[b]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};r(null,g)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(o.unicodeBlockLookup["CJK Unified Ideographs"](t)||o.unicodeBlockLookup["Hangul Syllables"](t)||o.unicodeBlockLookup.Hiragana(t)||o.unicodeBlockLookup.Katakana(t))}_tinySDF(t,r,a){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let p=t.tinySDF;if(!p){let y="400";/bold/i.test(r)?y="900":/medium/i.test(r)?y="500":/light/i.test(r)&&(y="200"),p=t.tinySDF=new Dt.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:c,fontWeight:y})}const g=p.draw(String.fromCharCode(a));return{id:a,bitmap:new o.AlphaImage({width:g.width||30,height:g.height||30},g.data),metrics:{width:g.glyphWidth||24,height:g.glyphHeight||24,left:g.glyphLeft||0,top:g.glyphTop-27||-8,advance:g.glyphAdvance||24}}}}Dt.loadGlyphRange=function(u,t,r,a,c){const p=256*t,g=p+255,y=a.transformRequest(r.replace("{fontstack}",u).replace("{range}",`${p}-${g}`),Pe.Glyphs);o.getArrayBuffer(y,(b,T)=>{if(b)c(b);else if(T){const A={};for(const M of o.parseGlyphPbf(T))A[M.id]=M;c(null,A)}})},Dt.TinySDF=class{constructor({fontSize:u=24,buffer:t=3,radius:r=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:p="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=r;const y=this.size=u+4*t,b=this._createCanvas(y),T=this.ctx=b.getContext("2d",{willReadFrequently:!0});T.font=`${g} ${p} ${u}px ${c}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(u){const t=document.createElement("canvas");return t.width=t.height=u,t}draw(u){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:p}=this.ctx.measureText(u),g=Math.ceil(r),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-c))),b=Math.min(this.size-this.buffer,g+Math.ceil(a)),T=y+2*this.buffer,A=b+2*this.buffer,M=Math.max(T*A,0),B=new Uint8ClampedArray(M),q={data:B,width:T,height:A,glyphWidth:y,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(y===0||b===0)return q;const{ctx:j,buffer:W,gridInner:N,gridOuter:re}=this;j.clearRect(W,W,y,b),j.fillText(u,W,W+g);const ue=j.getImageData(W,W,y,b);re.fill(oi,0,M),N.fill(0,0,M);for(let K=0;K<b;K++)for(let se=0;se<y;se++){const me=ue.data[4*(K*y+se)+3]/255;if(me===0)continue;const _e=(K+W)*T+se+W;if(me===1)re[_e]=0,N[_e]=oi;else{const ve=.5-me;re[_e]=ve>0?ve*ve:0,N[_e]=ve<0?ve*ve:0}}Xi(re,0,0,T,A,T,this.f,this.v,this.z),Xi(N,W,W,y,b,T,this.f,this.v,this.z);for(let K=0;K<M;K++){const se=Math.sqrt(re[K])-Math.sqrt(N[K]);B[K]=Math.round(255-255*(se/this.radius+this.cutoff))}return q}};class Wt{constructor(){this.specification=o.v8Spec.light.position}possiblyEvaluate(t,r){return o.sphericalToCartesian(t.expression.evaluate(r))}interpolate(t,r,a){return{x:o.interpolate.number(t.x,r.x,a),y:o.interpolate.number(t.y,r.y,a),z:o.interpolate.number(t.z,r.z,a)}}}let ai,li;class Ui extends o.Evented{constructor(t){super(),ai=ai||new o.Properties({anchor:new o.DataConstantProperty(o.v8Spec.light.anchor),position:new Wt,color:new o.DataConstantProperty(o.v8Spec.light.color),intensity:new o.DataConstantProperty(o.v8Spec.light.intensity)}),this._transitionable=new o.Transitionable(ai),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r={}){if(!this._validate(o.validateLight,t,r))for(const a in t){const c=t[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),c):this._transitionable.setValue(a,c)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,a){return(!a||a.validate!==!1)&&o.emitValidationErrors(this,t.call(o.validateStyle,o.extend({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.v8Spec})))}}class Ft{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,r){const a=t.join(",")+String(r);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(t,r)),this.dashEntry[a]}getDashRanges(t,r,a){const c=[];let p=t.length%2==1?-t[t.length-1]*a:0,g=t[0]*a,y=!0;c.push({left:p,right:g,isDash:y,zeroLength:t[0]===0});let b=t[0];for(let T=1;T<t.length;T++){y=!y;const A=t[T];p=b*a,b+=A,g=b*a,c.push({left:p,right:g,isDash:y,zeroLength:A===0})}return c}addRoundDash(t,r,a){const c=r/2;for(let p=-a;p<=a;p++){const g=this.width*(this.nextRow+a+p);let y=0,b=t[y];for(let T=0;T<this.width;T++){T/b.right>1&&(b=t[++y]);const A=Math.abs(T-b.left),M=Math.abs(T-b.right),B=Math.min(A,M);let q;const j=p/a*(c+1);if(b.isDash){const W=c-Math.abs(j);q=Math.sqrt(B*B+W*W)}else q=c-Math.sqrt(B*B+j*j);this.data[g+T]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(t){for(let y=t.length-1;y>=0;--y){const b=t[y],T=t[y+1];b.zeroLength?t.splice(y,1):T&&T.isDash===b.isDash&&(T.left=b.left,t.splice(y,1))}const r=t[0],a=t[t.length-1];r.isDash===a.isDash&&(r.left=a.left-this.width,a.right=r.right+this.width);const c=this.width*this.nextRow;let p=0,g=t[p];for(let y=0;y<this.width;y++){y/g.right>1&&(g=t[++p]);const b=Math.abs(y-g.left),T=Math.abs(y-g.right),A=Math.min(b,T);this.data[c+y]=Math.max(0,Math.min(255,(g.isDash?A:-A)+128))}}addDash(t,r){const a=r?7:0,c=2*a+1;if(this.nextRow+c>this.height)return o.warnOnce("LineAtlas out of space"),null;let p=0;for(let y=0;y<t.length;y++)p+=t[y];if(p!==0){const y=this.width/p,b=this.getDashRanges(t,this.width,y);r?this.addRoundDash(b,y,a):this.addRegularDash(b)}const g={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:p};return this.nextRow+=c,this.dirty=!0,g}bind(t){const r=t.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}class yn{constructor(t,r,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const c=this.workerPool.acquire(a);for(let p=0;p<c.length;p++){const g=new yn.Actor(c[p],r,a);g.name=`Worker ${p}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,r,a){o.asyncAll(this.actors,(c,p)=>{c.send(t,r,p)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function cn(u,t,r){const a=function(c,p){if(c)return r(c);if(p){const g=o.pick(o.extend(p,u),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);p.vector_layers&&(g.vectorLayers=p.vector_layers,g.vectorLayerIds=g.vectorLayers.map(y=>y.id)),r(null,g)}};return u.url?o.getJSON(t.transformRequest(u.url,Pe.Source),a):o.browser.frame(()=>a(null,u))}yn.Actor=o.Actor;class Lt{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof o.LngLat?new o.LngLat(t.lng,t.lat):o.LngLat.convert(t),this}setSouthWest(t){return this._sw=t instanceof o.LngLat?new o.LngLat(t.lng,t.lat):o.LngLat.convert(t),this}extend(t){const r=this._sw,a=this._ne;let c,p;if(t instanceof o.LngLat)c=t,p=t;else{if(!(t instanceof Lt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Lt.convert(t)):this.extend(o.LngLat.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(o.LngLat.convert(t)):this;if(c=t._sw,p=t._ne,!c||!p)return this}return r||a?(r.lng=Math.min(c.lng,r.lng),r.lat=Math.min(c.lat,r.lat),a.lng=Math.max(p.lng,a.lng),a.lat=Math.max(p.lat,a.lat)):(this._sw=new o.LngLat(c.lng,c.lat),this._ne=new o.LngLat(p.lng,p.lat)),this}getCenter(){return new o.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new o.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:a}=o.LngLat.convert(t);let c=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(t){return t instanceof Lt?t:t&&new Lt(t)}static fromLngLat(t,r=0){const a=360*r/40075017,c=a/Math.cos(Math.PI/180*t.lat);return new Lt(new o.LngLat(t.lng-c,t.lat-a),new o.LngLat(t.lng+c,t.lat+a))}}class Zn{constructor(t,r,a){this.bounds=Lt.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=a||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),a=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*r),c=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*r),p=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*r),g=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*r);return t.x>=a&&t.x<p&&t.y>=c&&t.y<g}}class Sr extends o.Evented{constructor(t,r,a,c){if(super(),this.load=()=>{this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=cn(this._options,this.map._requestManager,(p,g)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),p?this.fire(new o.ErrorEvent(p)):g&&(o.extend(this,g),g.bounds&&(this.tileBounds=new Zn(g.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>o.extend({},this._options),this.id=t,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(r,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,r){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(a,Pe.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function p(g,y){return delete t.request,t.aborted?r(null):g&&g.status!==404?r(g):(y&&y.resourceTiming&&(t.resourceTiming=y.resourceTiming),this.map._refreshExpiredTiles&&y&&t.setExpiryData(y),t.loadVectorData(y,this.map.painter),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}c.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",c,p.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",c,p.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class un extends o.Evented{constructor(t,r,a,c){super(),this.id=t,this.dispatcher=a,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},r),o.extend(this,o.pick(r,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=cn(this._options,this.map._requestManager,(t,r)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new o.ErrorEvent(t)):r&&(o.extend(this,r),r.bounds&&(this.tileBounds=new Zn(r.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=Ne.getImage(this.map._requestManager.transformRequest(a,Pe.Tile),(c,p,g)=>{if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(c)t.state="errored",r(c);else if(p){this.map._refreshExpiredTiles&&g&&t.setExpiryData(g);const y=this.map.painter.context,b=y.gl;t.texture=this.map.painter.getTileTexture(p.width),t.texture?t.texture.update(p,{useMipmap:!0}):(t.texture=new Tt(y,p,b.RGBA,{useMipmap:!0}),t.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),y.extTextureFilterAnisotropic&&b.texParameterf(b.TEXTURE_2D,y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,y.extTextureFilterAnisotropicMax)),t.state="loaded",r(null)}},this.map._refreshExpiredTiles)}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r()}unloadTile(t,r){t.texture&&this.map.painter.saveTileTexture(t.texture),r()}hasTransition(){return!1}}class gr extends un{constructor(t,r,a,c){super(t,r,a,c),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(t,r){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function c(p,g){p&&(t.state="errored",r(p)),g&&(t.dem=g,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",r(null))}t.request=Ne.getImage(this.map._requestManager.transformRequest(a,Pe.Tile),(function(p,g){if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(p)t.state="errored",r(p);else if(g){this.map._refreshExpiredTiles&&t.setExpiryData(g),delete g.cacheControl,delete g.expires;const y=o.isImageBitmap(g)&&(li==null&&(li=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),li)?g:o.browser.getImageData(g,1),b={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:y,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",b,c.bind(this)))}}).bind(this),this.map._refreshExpiredTiles),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const r=t.canonical,a=Math.pow(2,r.z),c=(r.x-1+a)%a,p=r.x===0?t.wrap-1:t.wrap,g=(r.x+1+a)%a,y=r.x+1===a?t.wrap+1:t.wrap,b={};return b[new o.OverscaledTileID(t.overscaledZ,p,r.z,c,r.y).key]={backfilled:!1},b[new o.OverscaledTileID(t.overscaledZ,y,r.z,g,r.y).key]={backfilled:!1},r.y>0&&(b[new o.OverscaledTileID(t.overscaledZ,p,r.z,c,r.y-1).key]={backfilled:!1},b[new o.OverscaledTileID(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},b[new o.OverscaledTileID(t.overscaledZ,y,r.z,g,r.y-1).key]={backfilled:!1}),r.y+1<a&&(b[new o.OverscaledTileID(t.overscaledZ,p,r.z,c,r.y+1).key]={backfilled:!1},b[new o.OverscaledTileID(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},b[new o.OverscaledTileID(t.overscaledZ,y,r.z,g,r.y+1).key]={backfilled:!1}),b}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Gn extends o.Evented{constructor(t,r,a,c){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>o.extend({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(c),this._data=r.data,this._options=o.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const p=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*p,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*p,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.EXTENT,radius:(r.clusterRadius||50)*p,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},r),this}getClusterChildren(t,r){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},r),this}getClusterLeaves(t,r,a,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:r,offset:a},c),this}_updateWorkerData(t){const r=o.extend({},this.workerOptions);t?r.dataDiff=t:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(o.browser.resolveURL(this._data),Pe.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,r,(a,c)=>{if(this._pendingLoads--,this._removed||c&&c.abandoned)return void this.fire(new o.Event("dataabort",{dataType:"source"}));let p=null;if(c&&c.resourceTiming&&c.resourceTiming[this.id]&&(p=c.resourceTiming[this.id].slice(0)),a)return void this.fire(new o.ErrorEvent(a));const g={dataType:"source"};this._collectResourceTiming&&p&&p.length>0&&o.extend(g,{resourceTiming:p}),this.fire(new o.Event("data",{...g,sourceDataType:"metadata"})),this.fire(new o.Event("data",{...g,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(t,r){const a=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(a,c,(p,g)=>(delete t.request,t.unloadVectorData(),t.aborted?r(null):p?r(p):(t.loadVectorData(g,this.map.painter,a==="reloadTile"),r(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var ci=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class hn extends o.Evented{constructor(t,r,a,c){super(),this.load=(p,g)=>{this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Ne.getImage(this.map._requestManager.transformRequest(this.url,Pe.Image),(y,b)=>{this._request=null,this._loaded=!0,y?this.fire(new o.ErrorEvent(y)):b&&(this.image=b,p&&(this.coordinates=p),g&&g(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const p=this.map.painter.context,g=p.gl;this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,ci.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Tt(p,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE));let y=!1;for(const b in this.tiles){const T=this.tiles[b];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,y=!0)}y&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=a,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=r}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const r=t.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(c){let p=1/0,g=1/0,y=-1/0,b=-1/0;for(const B of c)p=Math.min(p,B.x),g=Math.min(g,B.y),y=Math.max(y,B.x),b=Math.max(b,B.y);const T=Math.max(y-p,b-g),A=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),M=Math.pow(2,A);return new o.CanonicalTileID(A,Math.floor((p+y)/2*M),Math.floor((g+b)/2*M))}(r),this.minzoom=this.maxzoom=this.tileID.z;const a=r.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new o.RasterBoundsArray,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(a[2].x,a[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,r){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},r(null)):(t.state="errored",r(null))}hasTransition(){return!1}}class Wn extends hn{constructor(t,r,a,c){super(t,r,a,c),this.load=()=>{this._loaded=!1;const p=this.options;this.urls=[];for(const g of p.urls)this.urls.push(this.map._requestManager.transformRequest(g,Pe.Source).url);o.getVideo(this.urls,(g,y)=>{this._loaded=!0,g?this.fire(new o.ErrorEvent(g)):y&&(this.video=y,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,g=p.gl;this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,ci.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new Tt(p,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE));let y=!1;for(const b in this.tiles){const T=this.tiles[b];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,y=!0)}y&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=r}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class ye extends hn{constructor(t,r,a,c){super(t,r,a,c),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const g=this.map.painter.context,y=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,ci.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Tt(g,this.canvas,y.RGBA,{premultiply:!0});let b=!1;for(const T in this.tiles){const A=this.tiles[T];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,b=!0)}b&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(g=>typeof g!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const zn={},Er=u=>{switch(u){case"geojson":return Gn;case"image":return hn;case"raster":return un;case"raster-dem":return gr;case"vector":return Sr;case"video":return Wn;case"canvas":return ye}return zn[u]};function It(u,t){const r=o.create();return o.translate(r,r,[1,1,0]),o.scale(r,r,[.5*u.width,.5*u.height,1]),o.multiply(r,r,u.calculatePosMatrix(t.toUnwrapped()))}function Ct(u,t,r,a,c,p){const g=function(M,B,q){if(M)for(const j of M){const W=B[j];if(W&&W.source===q&&W.type==="fill-extrusion")return!0}else for(const j in B){const W=B[j];if(W.source===q&&W.type==="fill-extrusion")return!0}return!1}(c&&c.layers,t,u.id),y=p.maxPitchScaleFactor(),b=u.tilesIn(a,y,g);b.sort(rr);const T=[];for(const M of b)T.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(t,r,u._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,c,p,y,It(u.transform,M.tileID))});const A=function(M){const B={},q={};for(const j of M){const W=j.queryResults,N=j.wrappedTileID,re=q[N]=q[N]||{};for(const ue in W){const K=W[ue],se=re[ue]=re[ue]||{},me=B[ue]=B[ue]||[];for(const _e of K)se[_e.featureIndex]||(se[_e.featureIndex]=!0,me.push(_e))}}return B}(T);for(const M in A)A[M].forEach(B=>{const q=B.feature,j=u.getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=j});return A}function rr(u,t){const r=u.tileID,a=t.tileID;return r.overscaledZ-a.overscaledZ||r.canonical.y-a.canonical.y||r.wrap-a.wrap||r.canonical.x-a.canonical.x}class pn{constructor(t,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=o.uniqueId(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const r=t+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,r,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,p){const g={};if(!p)return g;for(const y of c){const b=y.layerIds.map(T=>p.getLayer(T)).filter(Boolean);if(b.length!==0){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(T=>b.filter(A=>A.id===T)[0]));for(const T of b)g[T.id]=y}}return g}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const p=this.buckets[c];if(p instanceof o.SymbolBucket){if(this.hasSymbolBuckets=!0,!a)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const p=this.buckets[c];if(p instanceof o.SymbolBucket&&p.hasRTLText){this.hasRTLText=!0,o.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const c in this.buckets){const p=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(c).queryRadius(p))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new o.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const a in this.buckets){const c=this.buckets[a];c.uploadPending()&&c.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Tt(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Tt(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,r,a,c,p,g,y,b,T,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:p,scale:g,tileSize:this.tileSize,pixelPosMatrix:A,transform:b,params:y,queryPadding:this.queryPadding*T},t,r,a):{}}querySourceFeatures(t,r){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const c=a.loadVTLayers(),p=r&&r.sourceLayer?r.sourceLayer:"",g=c._geojsonTileLayer||c[p];if(!g)return;const y=o.createFilter(r&&r.filter),{z:b,x:T,y:A}=this.tileID.canonical,M={z:b,x:T,y:A};for(let B=0;B<g.length;B++){const q=g.feature(B);if(y.needGeometry){const N=o.toEvaluationFeature(q,!0);if(!y.filter(new o.EvaluationParameters(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!y.filter(new o.EvaluationParameters(this.tileID.overscaledZ),q))continue;const j=a.getId(q,p),W=new o.GeoJSONFeature(q,b,T,A,j);W.tile=M,t.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const a=o.parseCacheControl(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let c=!1;if(this.expirationTime>a)c=!1;else if(r)if(this.expirationTime<r)c=!0;else{const p=this.expirationTime-r;p?this.expirationTime=a+Math.max(p,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!r.style.hasLayer(c))continue;const p=this.buckets[c],g=p.layers[0].sourceLayer||"_geojsonTileLayer",y=a[g],b=t[g];if(!y||!b||Object.keys(b).length===0)continue;p.update(b,y,this.imageAtlas&&this.imageAtlas.patternPositions||{});const T=r&&r.style&&r.style.getLayer(c);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.browser.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.browser.now()+t}setDependencies(t,r){const a={};for(const c of r)a[c]=!0;this.dependencies[t]=a}hasDependency(t,r){for(const a of t){const c=this.dependencies[a];if(c){for(const p of r)if(c[p])return!0}}return!1}}class Vr{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,a){const c=t.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const p={value:r,timeout:void 0};if(a!==void 0&&(p.timeout=setTimeout(()=>{this.remove(t,p)},a)),this.data[c].push(p),this.order.push(c),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const a=t.wrapped().key,c=r===void 0?0:this.data[a].indexOf(r),p=this.data[a][c];return this.data[a].splice(c,1),p.timeout&&clearTimeout(p.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(p.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const a in this.data)for(const c of this.data[a])t(c.value)||r.push(c);for(const a of r)this.remove(a.value.tileID,a)}}class Jr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,a){const c=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},o.extend(this.stateChanges[t][c],a),this.deletedStates[t]===null){this.deletedStates[t]={};for(const p in this.state[t])p!==c&&(this.deletedStates[t][p]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(const p in this.state[t][c])a[p]||(this.deletedStates[t][c][p]=null)}else for(const p in a)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][p]===null&&delete this.deletedStates[t][c][p]}removeFeatureState(t,r,a){if(this.deletedStates[t]===null)return;const c=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&r!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][a]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(a in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][a]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,r){const a=String(r),c=o.extend({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const p=this.deletedStates[t][r];if(p===null)return{};for(const g in p)delete c[g]}return c}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const a={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const p={};for(const g in this.stateChanges[c])this.state[c][g]||(this.state[c][g]={}),o.extend(this.state[c][g],this.stateChanges[c][g]),p[g]=this.state[c][g];a[c]=p}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const p={};if(this.deletedStates[c]===null)for(const g in this.state[c])p[g]={},this.state[c][g]={};else for(const g in this.deletedStates[c]){if(this.deletedStates[c][g]===null)this.state[c][g]={};else for(const y of Object.keys(this.deletedStates[c][g]))delete this.state[c][g][y];p[g]=this.state[c][g]}a[c]=a[c]||{},o.extend(a[c],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const c in t)t[c].setFeatureState(a,r)}}class Rt extends o.Evented{constructor(t,r,a){super(),this.id=t,this.dispatcher=a,this.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,p,g,y)=>{const b=new(Er(p.type))(c,p,g,y);if(b.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${b.id}`);return b})(t,r,a,this),this._tiles={},this._cache=new Vr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Jr,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const r=this._tiles[t];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,r){return this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new o.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const a=this._tiles[r];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(_r).map(t=>t.key)}getRenderableIds(t){const r=[];for(const a in this._tiles)this._isIdRenderable(a,t)&&r.push(this._tiles[a]);return t?r.sort((a,c)=>{const p=a.tileID,g=c.tileID,y=new o.Point(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),b=new o.Point(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-g.overscaledZ||b.y-y.y||b.x-y.x}).map(a=>a.tileID.key):r.map(a=>a.tileID).sort(_r).map(a=>a.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,r){const a=this._tiles[t];a&&(a.state!=="loading"&&(a.state=r),this._loadTile(a,this._tileLoaded.bind(this,a,t,r)))}_tileLoaded(t,r,a,c){if(c)return t.state="errored",void(c.status!==404?this._source.fire(new o.ErrorEvent(c,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=o.browser.now(),a==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new o.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const r=this.getRenderableIds();for(let c=0;c<r.length;c++){const p=r[c];if(t.neighboringTiles&&t.neighboringTiles[p]){const g=this.getTileByID(p);a(t,g),a(g,t)}}function a(c,p){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let g=p.tileID.canonical.x-c.tileID.canonical.x;const y=p.tileID.canonical.y-c.tileID.canonical.y,b=Math.pow(2,c.tileID.canonical.z),T=p.tileID.key;g===0&&y===0||Math.abs(y)>1||(Math.abs(g)>1&&(Math.abs(g+b)===1?g+=b:Math.abs(g-b)===1&&(g-=b)),p.dem&&c.dem&&(c.dem.backfillBorder(p.dem,g,y),c.neighboringTiles&&c.neighboringTiles[T]&&(c.neighboringTiles[T].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,a,c){for(const p in this._tiles){let g=this._tiles[p];if(c[p]||!g.hasData()||g.tileID.overscaledZ<=r||g.tileID.overscaledZ>a)continue;let y=g.tileID;for(;g&&g.tileID.overscaledZ>r+1;){const T=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[T.key],g&&g.hasData()&&(y=T)}let b=y;for(;b.overscaledZ>r;)if(b=b.scaledTo(b.overscaledZ-1),t[b.key]){c[y.key]=y;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=t.overscaledZ-1;a>=r;a--){const c=t.scaledTo(a),p=this._getLoadedTile(c);if(p)return p}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const r=Math.ceil(t.width/this._source.tileSize)+1,a=Math.ceil(t.height/this._source.tileSize)+1,c=Math.floor(r*a*(this._maxTileCacheZoomLevels===null?o.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(p)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const a={};for(const c in this._tiles){const p=this._tiles[c];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+r),a[p.tileID.key]=p}this._tiles=a;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}update(t,r){if(this.transform=t,this.terrain=r,!this._sourceLoaded||this._paused)return;let a;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new o.OverscaledTileID(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(a=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r}),this._source.hasTile&&(a=a.filter(A=>this._source.hasTile(A)))):a=[];const c=t.coveringZoomLevel(this._source),p=Math.max(c-Rt.maxOverzooming,this._source.minzoom),g=Math.max(c+Rt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const M of a)if(M.canonical.z>this._source.minzoom){const B=M.scaledTo(M.canonical.z-1);A[B.key]=B;const q=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));A[q.key]=q}a=a.concat(Object.values(A))}const y=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,y&&this.fire(new o.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const b=this._updateRetainedTiles(a,c);if(yr(this._source.type)){const A={},M={},B=Object.keys(b),q=o.browser.now();for(const j of B){const W=b[j],N=this._tiles[j];if(!N||N.fadeEndTime!==0&&N.fadeEndTime<=q)continue;const re=this.findLoadedParent(W,p);re&&(this._addTile(re.tileID),A[re.tileID.key]=re.tileID),M[j]=W}this._retainLoadedChildren(M,c,g,b);for(const j in A)b[j]||(this._coveredTiles[j]=!0,b[j]=A[j]);if(r){const j={},W={};for(const N of a)this._tiles[N.key].hasData()?j[N.key]=N:W[N.key]=N;for(const N in W){const re=W[N].children(this._source.maxzoom);this._tiles[re[0].key]&&this._tiles[re[1].key]&&this._tiles[re[2].key]&&this._tiles[re[3].key]&&(j[re[0].key]=b[re[0].key]=re[0],j[re[1].key]=b[re[1].key]=re[1],j[re[2].key]=b[re[2].key]=re[2],j[re[3].key]=b[re[3].key]=re[3],delete W[N])}for(const N in W){const re=this.findLoadedParent(W[N],this._source.minzoom);if(re){j[re.tileID.key]=b[re.tileID.key]=re.tileID;for(const ue in j)j[ue].isChildOf(re.tileID)&&delete j[ue]}}for(const N in this._tiles)j[N]||(this._coveredTiles[N]=!0)}}for(const A in b)this._tiles[A].clearFadeHold();const T=o.keysDifference(this._tiles,b);for(const A of T){const M=this._tiles[A];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,r){const a={},c={},p=Math.max(r-Rt.maxOverzooming,this._source.minzoom),g=Math.max(r+Rt.maxUnderzooming,this._source.minzoom),y={};for(const b of t){const T=this._addTile(b);a[b.key]=b,T.hasData()||r<this._source.maxzoom&&(y[b.key]=b)}this._retainLoadedChildren(y,r,g,a);for(const b of t){let T=this._tiles[b.key];if(T.hasData())continue;if(r+1>this._source.maxzoom){const M=b.children(this._source.maxzoom)[0],B=this.getTile(M);if(B&&B.hasData()){a[M.key]=M;continue}}else{const M=b.children(this._source.maxzoom);if(a[M[0].key]&&a[M[1].key]&&a[M[2].key]&&a[M[3].key])continue}let A=T.wasRequested();for(let M=b.overscaledZ-1;M>=p;--M){const B=b.scaledTo(M);if(c[B.key])break;if(c[B.key]=!0,T=this.getTile(B),!T&&A&&(T=this._addTile(B)),T){const q=T.hasData();if((A||q)&&(a[B.key]=B),A=T.wasRequested(),q)break}}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let a,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){a=this._loadedParentTiles[c.key];break}r.push(c.key);const p=c.scaledTo(c.overscaledZ-1);if(a=this._getLoadedTile(p),a)break;c=p}for(const p of r)this._loadedParentTiles[p]=a}}_addTile(t){let r=this._tiles[t.key];if(r)return r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const a=r;return r||(r=new pn(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))),r.uses++,this._tiles[t.key]=r,a||this._source.fire(new o.Event("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const a=r.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,r,a){const c=[],p=this.transform;if(!p)return c;const g=a?p.getCameraQueryGeometry(t):t,y=t.map(j=>p.pointCoordinate(j,this.terrain)),b=g.map(j=>p.pointCoordinate(j,this.terrain)),T=this.getIds();let A=1/0,M=1/0,B=-1/0,q=-1/0;for(const j of b)A=Math.min(A,j.x),M=Math.min(M,j.y),B=Math.max(B,j.x),q=Math.max(q,j.y);for(let j=0;j<T.length;j++){const W=this._tiles[T[j]];if(W.holdingForFade())continue;const N=W.tileID,re=Math.pow(2,p.zoom-W.tileID.overscaledZ),ue=r*W.queryPadding*o.EXTENT/W.tileSize/re,K=[N.getTilePoint(new o.MercatorCoordinate(A,M)),N.getTilePoint(new o.MercatorCoordinate(B,q))];if(K[0].x-ue<o.EXTENT&&K[0].y-ue<o.EXTENT&&K[1].x+ue>=0&&K[1].y+ue>=0){const se=y.map(_e=>N.getTilePoint(_e)),me=b.map(_e=>N.getTilePoint(_e));c.push({tile:W,tileID:N,queryGeometry:se,cameraQueryGeometry:me,scale:re})}}return c}getVisibleCoordinates(t){const r=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);for(const a of r)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(yr(this._source.type)){const t=o.browser.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=t)return!0}return!1}setFeatureState(t,r,a){this._state.updateState(t=t||"_geojsonTileLayer",r,a)}removeFeatureState(t,r,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,a)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,a){const c=this._tiles[t];c&&c.setDependencies(r,a)}reloadTilesForDependencies(t,r){for(const a in this._tiles)this._tiles[a].hasDependency(t,r)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(t,r))}}function _r(u,t){const r=Math.abs(2*u.wrap)-+(u.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||a-r||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function yr(u){return u==="raster"||u==="image"||u==="video"}Rt.maxOverzooming=10,Rt.maxUnderzooming=3;const ze="mapboxgl_preloaded_worker_pool";class ki{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<ki.workerCount;)this.workers.push(new Worker(o.config.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ze]}numActive(){return Object.keys(this.active).length}}const Yi=Math.floor(o.browser.hardwareConcurrency/2);let zi;function Dn(){return zi||(zi=new ki),zi}ki.workerCount=o.isSafari(globalThis)?Math.max(Math.min(Yi,3),1):1;class Be{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.clamp(t,0,1);let r=1,a=this._distances[r];const c=t*this.paddedLength+this.padding;for(;a<c&&r<this._distances.length;)a=this._distances[++r];const p=r-1,g=this._distances[p],y=a-g,b=y>0?(c-g)/y:0;return this.points[p].mult(1-b).add(this.points[r].mult(b))}}function dt(u,t){let r=!0;return u==="always"||u!=="never"&&t!=="never"||(r=!1),r}class gt{constructor(t,r,a){const c=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(t/a),this.yCellCount=Math.ceil(r/a);for(let g=0;g<this.xCellCount*this.yCellCount;g++)c.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,a,c,p){this._forEachCell(r,a,c,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(p)}insertCircle(t,r,a,c){this._forEachCell(r-c,a-c,r+c,a+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(a),this.circles.push(c)}_insertBoxCell(t,r,a,c,p,g){this.boxCells[p].push(g)}_insertCircleCell(t,r,a,c,p,g){this.circleCells[p].push(g)}_query(t,r,a,c,p,g,y){if(a<0||t>this.width||c<0||r>this.height)return[];const b=[];if(t<=0&&r<=0&&this.width<=a&&this.height<=c){if(p)return[{key:null,x1:t,y1:r,x2:a,y2:c}];for(let T=0;T<this.boxKeys.length;T++)b.push({key:this.boxKeys[T],x1:this.bboxes[4*T],y1:this.bboxes[4*T+1],x2:this.bboxes[4*T+2],y2:this.bboxes[4*T+3]});for(let T=0;T<this.circleKeys.length;T++){const A=this.circles[3*T],M=this.circles[3*T+1],B=this.circles[3*T+2];b.push({key:this.circleKeys[T],x1:A-B,y1:M-B,x2:A+B,y2:M+B})}}else this._forEachCell(t,r,a,c,this._queryCell,b,{hitTest:p,overlapMode:g,seenUids:{box:{},circle:{}}},y);return b}query(t,r,a,c){return this._query(t,r,a,c,!1,null)}hitTest(t,r,a,c,p,g){return this._query(t,r,a,c,!0,p,g).length>0}hitTestCircle(t,r,a,c,p){const g=t-a,y=t+a,b=r-a,T=r+a;if(y<0||g>this.width||T<0||b>this.height)return!1;const A=[];return this._forEachCell(g,b,y,T,this._queryCellCircle,A,{hitTest:!0,overlapMode:c,circle:{x:t,y:r,radius:a},seenUids:{box:{},circle:{}}},p),A.length>0}_queryCell(t,r,a,c,p,g,y,b){const{seenUids:T,hitTest:A,overlapMode:M}=y,B=this.boxCells[p];if(B!==null){const j=this.bboxes;for(const W of B)if(!T.box[W]){T.box[W]=!0;const N=4*W,re=this.boxKeys[W];if(t<=j[N+2]&&r<=j[N+3]&&a>=j[N+0]&&c>=j[N+1]&&(!b||b(re))&&(!A||!dt(M,re.overlapMode))&&(g.push({key:re,x1:j[N],y1:j[N+1],x2:j[N+2],y2:j[N+3]}),A))return!0}}const q=this.circleCells[p];if(q!==null){const j=this.circles;for(const W of q)if(!T.circle[W]){T.circle[W]=!0;const N=3*W,re=this.circleKeys[W];if(this._circleAndRectCollide(j[N],j[N+1],j[N+2],t,r,a,c)&&(!b||b(re))&&(!A||!dt(M,re.overlapMode))){const ue=j[N],K=j[N+1],se=j[N+2];if(g.push({key:re,x1:ue-se,y1:K-se,x2:ue+se,y2:K+se}),A)return!0}}}return!1}_queryCellCircle(t,r,a,c,p,g,y,b){const{circle:T,seenUids:A,overlapMode:M}=y,B=this.boxCells[p];if(B!==null){const j=this.bboxes;for(const W of B)if(!A.box[W]){A.box[W]=!0;const N=4*W,re=this.boxKeys[W];if(this._circleAndRectCollide(T.x,T.y,T.radius,j[N+0],j[N+1],j[N+2],j[N+3])&&(!b||b(re))&&!dt(M,re.overlapMode))return g.push(!0),!0}}const q=this.circleCells[p];if(q!==null){const j=this.circles;for(const W of q)if(!A.circle[W]){A.circle[W]=!0;const N=3*W,re=this.circleKeys[W];if(this._circlesCollide(j[N],j[N+1],j[N+2],T.x,T.y,T.radius)&&(!b||b(re))&&!dt(M,re.overlapMode))return g.push(!0),!0}}}_forEachCell(t,r,a,c,p,g,y,b){const T=this._convertToXCellCoord(t),A=this._convertToYCellCoord(r),M=this._convertToXCellCoord(a),B=this._convertToYCellCoord(c);for(let q=T;q<=M;q++)for(let j=A;j<=B;j++)if(p.call(this,t,r,a,c,this.xCellCount*j+q,g,y,b))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,a,c,p,g){const y=c-t,b=p-r,T=a+g;return T*T>y*y+b*b}_circleAndRectCollide(t,r,a,c,p,g,y){const b=(g-c)/2,T=Math.abs(t-(c+b));if(T>b+a)return!1;const A=(y-p)/2,M=Math.abs(r-(p+A));if(M>A+a)return!1;if(T<=b||M<=A)return!0;const B=T-b,q=M-A;return B*B+q*q<=a*a}}function Di(u,t,r,a,c){const p=o.create();return t?(o.scale(p,p,[1/c,1/c,1]),r||o.rotateZ(p,p,a.angle)):o.multiply(p,a.labelPlaneMatrix,u),p}function Li(u,t,r,a,c){if(t){const p=o.clone(u);return o.scale(p,p,[c,c,1]),r||o.rotateZ(p,p,-a.angle),p}return a.glCoordMatrix}function at(u,t,r){let a;r?(a=[u.x,u.y,r(u.x,u.y),1],o.transformMat4(a,a,t)):(a=[u.x,u.y,0,1],X(a,a,t));const c=a[3];return{point:new o.Point(a[0]/c,a[1]/c),signedDistanceFromCamera:c}}function xn(u,t){return .5+u/t*.5}function Vi(u,t){const r=u[0]/u[3],a=u[1]/u[3];return r>=-t[0]&&r<=t[0]&&a>=-t[1]&&a<=t[1]}function Ki(u,t,r,a,c,p,g,y,b,T){const A=a?u.textSizeData:u.iconSizeData,M=o.evaluateSizeForZoom(A,r.transform.zoom),B=[256/r.width*2+1,256/r.height*2+1],q=a?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;q.clear();const j=u.lineVertexArray,W=a?u.text.placedSymbolArray:u.icon.placedSymbolArray,N=r.transform.width/r.transform.height;let re=!1;for(let ue=0;ue<W.length;ue++){const K=W.get(ue);if(K.hidden||K.writingMode===o.WritingMode.vertical&&!re){V(K.numGlyphs,q);continue}let se;if(re=!1,T?(se=[K.anchorX,K.anchorY,T(K.anchorX,K.anchorY),1],o.transformMat4(se,se,t)):(se=[K.anchorX,K.anchorY,0,1],X(se,se,t)),!Vi(se,B)){V(K.numGlyphs,q);continue}const me=xn(r.transform.cameraToCenterDistance,se[3]),_e=o.evaluateSizeForFeature(A,M,K),ve=g?_e/me:_e*me,Ie=new o.Point(K.anchorX,K.anchorY),Te=at(Ie,c,T).point,ke={projections:{},offsets:{}},Qe=gi(K,ve,!1,y,t,c,p,u.glyphOffsetArray,j,q,Te,Ie,ke,N,b,T);re=Qe.useVertical,(Qe.notEnoughRoom||re||Qe.needsFlipping&&gi(K,ve,!0,y,t,c,p,u.glyphOffsetArray,j,q,Te,Ie,ke,N,b,T).notEnoughRoom)&&V(K.numGlyphs,q)}a?u.text.dynamicLayoutVertexBuffer.updateData(q):u.icon.dynamicLayoutVertexBuffer.updateData(q)}function Ji(u,t,r,a,c,p,g,y,b,T,A,M,B){const q=y.glyphStartIndex+y.numGlyphs,j=y.lineStartIndex,W=y.lineStartIndex+y.lineLength,N=t.getoffsetX(y.glyphStartIndex),re=t.getoffsetX(q-1),ue=P(u*N,r,a,c,p,g,y.segment,j,W,b,T,A,M,B);if(!ue)return null;const K=P(u*re,r,a,c,p,g,y.segment,j,W,b,T,A,M,B);return K?{first:ue,last:K}:null}function sr(u,t,r,a){return u===o.WritingMode.horizontal&&Math.abs(r.y-t.y)>Math.abs(r.x-t.x)*a?{useVertical:!0}:(u===o.WritingMode.vertical?t.y<r.y:t.x>r.x)?{needsFlipping:!0}:null}function gi(u,t,r,a,c,p,g,y,b,T,A,M,B,q,j,W){const N=t/24,re=u.lineOffsetX*N,ue=u.lineOffsetY*N;let K;if(u.numGlyphs>1){const se=u.glyphStartIndex+u.numGlyphs,me=u.lineStartIndex,_e=u.lineStartIndex+u.lineLength,ve=Ji(N,y,re,ue,r,A,M,u,b,p,B,j,W);if(!ve)return{notEnoughRoom:!0};const Ie=at(ve.first.point,g,W).point,Te=at(ve.last.point,g,W).point;if(a&&!r){const ke=sr(u.writingMode,Ie,Te,q);if(ke)return ke}K=[ve.first];for(let ke=u.glyphStartIndex+1;ke<se-1;ke++)K.push(P(N*y.getoffsetX(ke),re,ue,r,A,M,u.segment,me,_e,b,p,B,j,W));K.push(ve.last)}else{if(a&&!r){const me=at(M,c,W).point,_e=u.lineStartIndex+u.segment+1,ve=new o.Point(b.getx(_e),b.gety(_e)),Ie=at(ve,c,W),Te=Ie.signedDistanceFromCamera>0?Ie.point:Ut(M,ve,me,1,c,W),ke=sr(u.writingMode,me,Te,q);if(ke)return ke}const se=P(N*y.getoffsetX(u.glyphStartIndex),re,ue,r,A,M,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,b,p,B,j,W);if(!se)return{notEnoughRoom:!0};K=[se]}for(const se of K)o.addDynamicAttributes(T,se.point,se.angle);return{}}function Ut(u,t,r,a,c,p){const g=at(u.add(u.sub(t)._unit()),c,p).point,y=r.sub(g);return r.add(y._mult(a/y.mag()))}function Ln(u,t){const{projectionCache:r,lineVertexArray:a,labelPlaneMatrix:c,tileAnchorPoint:p,distanceFromAnchor:g,getElevation:y,previousVertex:b,direction:T,absOffsetX:A}=t;if(r.projections[u])return r.projections[u];const M=new o.Point(a.getx(u),a.gety(u)),B=at(M,c,y);if(B.signedDistanceFromCamera>0)return r.projections[u]=B.point,B.point;const q=u-T;return Ut(g===0?p:new o.Point(a.getx(q),a.gety(q)),M,b,A-g+1,c,y)}function vn(u,t,r){return u._unit()._perp()._mult(t*r)}function G(u,t,r,a,c,p,g,y){const{projectionCache:b,direction:T}=y;if(b.offsets[u])return b.offsets[u];const A=r.add(t);if(u+T<a||u+T>=c)return b.offsets[u]=A,A;const M=Ln(u+T,y),B=vn(M.sub(r),g,T),q=r.add(B),j=M.add(B);return b.offsets[u]=o.findLineIntersection(p,A,q,j)||A,b.offsets[u]}function P(u,t,r,a,c,p,g,y,b,T,A,M,B,q){const j=a?u-t:u+t;let W=j>0?1:-1,N=0;a&&(W*=-1,N=Math.PI),W<0&&(N+=Math.PI);let re,ue,K=W>0?y+g:y+g+1,se=c,me=c,_e=0,ve=0;const Ie=Math.abs(j),Te=[];let ke;for(;_e+ve<=Ie;){if(K+=W,K<y||K>=b)return null;_e+=ve,me=se,ue=re;const Ue={projectionCache:M,lineVertexArray:T,labelPlaneMatrix:A,tileAnchorPoint:p,distanceFromAnchor:_e,getElevation:q,previousVertex:me,direction:W,absOffsetX:Ie};if(se=Ln(K,Ue),r===0)Te.push(me),ke=se.sub(me);else{let ut;const Ye=se.sub(me);ut=Ye.mag()===0?vn(Ln(K+W,Ue).sub(se),r,W):vn(Ye,r,W),ue||(ue=me.add(ut)),re=G(K,ut,se,y,b,ue,r,Ue),Te.push(ue),ke=re.sub(ue)}ve=ke.mag()}const Qe=ke._mult((Ie-_e)/ve)._add(ue||me),At=N+Math.atan2(se.y-me.y,se.x-me.x);return Te.push(Qe),{point:Qe,angle:B?At:0,path:Te}}const R=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function V(u,t){for(let r=0;r<u;r++){const a=t.length;t.resize(a+4),t.float32.set(R,3*a)}}function X(u,t,r){const a=t[0],c=t[1];return u[0]=r[0]*a+r[4]*c+r[12],u[1]=r[1]*a+r[5]*c+r[13],u[3]=r[3]*a+r[7]*c+r[15],u}const $=100;class J{constructor(t,r=new gt(t.width+200,t.height+200,25),a=new gt(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=a,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+$,this.screenBottomBoundary=t.height+$,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,r,a,c,p,g){const y=this.projectAndGetPerspectiveRatio(c,t.anchorPointX,t.anchorPointY,g),b=a*y.perspectiveRatio,T=t.x1*b+y.point.x,A=t.y1*b+y.point.y,M=t.x2*b+y.point.x,B=t.y2*b+y.point.y;return!this.isInsideGrid(T,A,M,B)||r!=="always"&&this.grid.hitTest(T,A,M,B,r,p)||y.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[T,A,M,B],offscreen:this.isOffscreen(T,A,M,B)}}placeCollisionCircles(t,r,a,c,p,g,y,b,T,A,M,B,q,j){const W=[],N=new o.Point(r.anchorX,r.anchorY),re=at(N,g,j),ue=xn(this.transform.cameraToCenterDistance,re.signedDistanceFromCamera),K=(A?p/ue:p*ue)/o.ONE_EM,se=at(N,y,j).point,me=Ji(K,c,r.lineOffsetX*K,r.lineOffsetY*K,!1,se,N,r,a,y,{projections:{},offsets:{}},!1,j);let _e=!1,ve=!1,Ie=!0;if(me){const Te=.5*B*ue+q,ke=new o.Point(-100,-100),Qe=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),At=new Be,Ue=me.first,ut=me.last;let Ye=[];for(let yt=Ue.path.length-1;yt>=1;yt--)Ye.push(Ue.path[yt]);for(let yt=1;yt<ut.path.length;yt++)Ye.push(ut.path[yt]);const Ht=2.5*Te;if(b){const yt=Ye.map(ht=>at(ht,b,j));Ye=yt.some(ht=>ht.signedDistanceFromCamera<=0)?[]:yt.map(ht=>ht.point)}let wt=[];if(Ye.length>0){const yt=Ye[0].clone(),ht=Ye[0].clone();for(let ui=1;ui<Ye.length;ui++)yt.x=Math.min(yt.x,Ye[ui].x),yt.y=Math.min(yt.y,Ye[ui].y),ht.x=Math.max(ht.x,Ye[ui].x),ht.y=Math.max(ht.y,Ye[ui].y);wt=yt.x>=ke.x&&ht.x<=Qe.x&&yt.y>=ke.y&&ht.y<=Qe.y?[Ye]:ht.x<ke.x||yt.x>Qe.x||ht.y<ke.y||yt.y>Qe.y?[]:o.clipLine([Ye],ke.x,ke.y,Qe.x,Qe.y)}for(const yt of wt){At.reset(yt,.25*Te);let ht=0;ht=At.length<=.5*Te?1:Math.ceil(At.paddedLength/Ht)+1;for(let ui=0;ui<ht;ui++){const Nt=ui/Math.max(ht-1,1),dn=At.lerp(Nt),$i=dn.x+$,Ti=dn.y+$;W.push($i,Ti,Te,0);const Tn=$i-Te,ar=Ti-Te,Pr=$i+Te,kr=Ti+Te;if(Ie=Ie&&this.isOffscreen(Tn,ar,Pr,kr),ve=ve||this.isInsideGrid(Tn,ar,Pr,kr),t!=="always"&&this.grid.hitTestCircle($i,Ti,Te,t,M)&&(_e=!0,!T))return{circles:[],offscreen:!1,collisionDetected:_e}}}}return{circles:!T&&_e||!ve||ue<this.perspectiveRatioCutoff?[]:W,offscreen:Ie,collisionDetected:_e}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let a=1/0,c=1/0,p=-1/0,g=-1/0;for(const A of t){const M=new o.Point(A.x+$,A.y+$);a=Math.min(a,M.x),c=Math.min(c,M.y),p=Math.max(p,M.x),g=Math.max(g,M.y),r.push(M)}const y=this.grid.query(a,c,p,g).concat(this.ignoredGrid.query(a,c,p,g)),b={},T={};for(const A of y){const M=A.key;if(b[M.bucketInstanceId]===void 0&&(b[M.bucketInstanceId]={}),b[M.bucketInstanceId][M.featureIndex])continue;const B=[new o.Point(A.x1,A.y1),new o.Point(A.x2,A.y1),new o.Point(A.x2,A.y2),new o.Point(A.x1,A.y2)];o.polygonIntersectsPolygon(r,B)&&(b[M.bucketInstanceId][M.featureIndex]=!0,T[M.bucketInstanceId]===void 0&&(T[M.bucketInstanceId]=[]),T[M.bucketInstanceId].push(M.featureIndex))}return T}insertCollisionBox(t,r,a,c,p,g){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:p,collisionGroupID:g,overlapMode:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,a,c,p,g){const y=a?this.ignoredGrid:this.grid,b={bucketInstanceId:c,featureIndex:p,collisionGroupID:g,overlapMode:r};for(let T=0;T<t.length;T+=4)y.insertCircle(b,t[T],t[T+1],t[T+2])}projectAndGetPerspectiveRatio(t,r,a,c){let p;return c?(p=[r,a,c(r,a),1],o.transformMat4(p,p,t)):(p=[r,a,0,1],X(p,p,t)),{point:new o.Point((p[0]/p[3]+1)/2*this.transform.width+$,(-p[1]/p[3]+1)/2*this.transform.height+$),perspectiveRatio:.5+this.transform.cameraToCenterDistance/p[3]*.5}}isOffscreen(t,r,a,c){return a<$||t>=this.screenRightBoundary||c<$||r>this.screenBottomBoundary}isInsideGrid(t,r,a,c){return a>=0&&t<this.gridRightBoundary&&c>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=o.identity([]);return o.translate(t,t,[-100,-100,0]),t}}function te(u,t,r){return t*(o.EXTENT/(u.tileSize*Math.pow(2,r-u.tileID.overscaledZ)))}class ee{constructor(t,r,a,c){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):c&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class ae{constructor(t,r,a,c,p){this.text=new ee(t?t.text:null,r,a,p),this.icon=new ee(t?t.icon:null,r,c,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class we{constructor(t,r,a){this.text=t,this.icon=r,this.skipFade=a}}class Se{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Ee{constructor(t,r,a,c,p){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=a,this.bucketIndex=c,this.tileID=p}}class lt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:a=>a.collisionGroupID===r}}return this.collisionGroups[t]}}function _t(u,t,r,a,c){const{horizontalAlign:p,verticalAlign:g}=o.getAnchorAlignment(u);return new o.Point(-(p-.5)*t+a[0]*c,-(g-.5)*r+a[1]*c)}function Je(u,t,r,a,c,p){const{x1:g,x2:y,y1:b,y2:T,anchorPointX:A,anchorPointY:M}=u,B=new o.Point(t,r);return a&&B._rotate(c?p:-p),{x1:g+B.x,y1:b+B.y,x2:y+B.x,y2:T+B.y,anchorPointX:A,anchorPointY:M}}class st{constructor(t,r,a,c,p){this.transform=t.clone(),this.terrain=r,this.collisionIndex=new J(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new lt(c),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,a,c){const p=a.getBucket(r),g=a.latestFeatureIndex;if(!p||!g||r.id!==p.layerIds[0])return;const y=a.collisionBoxArray,b=p.layers[0].layout,T=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),A=a.tileSize/o.EXTENT,M=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),B=b.get("text-pitch-alignment")==="map",q=b.get("text-rotation-alignment")==="map",j=te(a,1,this.transform.zoom),W=Di(M,B,q,this.transform,j);let N=null;if(B){const ue=Li(M,B,q,this.transform,j);N=o.multiply([],this.transform.labelPlaneMatrix,ue)}this.retainedQueryData[p.bucketInstanceId]=new Ee(p.bucketInstanceId,g,p.sourceLayerIndex,p.index,a.tileID);const re={bucket:p,layout:b,posMatrix:M,textLabelPlaneMatrix:W,labelToScreenMatrix:N,scale:T,textPixelRatio:A,holdingForFade:a.holdingForFade(),collisionBoxArray:y,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(c)for(const ue of p.sortKeyRanges){const{sortKey:K,symbolInstanceStart:se,symbolInstanceEnd:me}=ue;t.push({sortKey:K,symbolInstanceStart:se,symbolInstanceEnd:me,parameters:re})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:re})}attemptAnchorPlacement(t,r,a,c,p,g,y,b,T,A,M,B,q,j,W,N){const re=o.TextAnchorEnum[t.textAnchor],ue=[t.textOffset0,t.textOffset1],K=_t(re,a,c,ue,p),se=this.collisionIndex.placeCollisionBox(Je(r,K.x,K.y,g,y,this.transform.angle),M,b,T,A.predicate,N);if((!W||this.collisionIndex.placeCollisionBox(Je(W,K.x,K.y,g,y,this.transform.angle),M,b,T,A.predicate,N).box.length!==0)&&se.box.length>0){let me;if(this.prevPlacement&&this.prevPlacement.variableOffsets[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID].text&&(me=this.prevPlacement.variableOffsets[B.crossTileID].anchor),B.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[B.crossTileID]={textOffset:ue,width:a,height:c,anchor:re,textBoxScale:p,prevAnchor:me},this.markUsedJustification(q,re,B,j),q.allowVerticalPlacement&&(this.markUsedOrientation(q,j,B),this.placedOrientations[B.crossTileID]=j),{shift:K,placedGlyphBoxes:se}}}placeLayerBucketPart(t,r,a){const{bucket:c,layout:p,posMatrix:g,textLabelPlaneMatrix:y,labelToScreenMatrix:b,textPixelRatio:T,holdingForFade:A,collisionBoxArray:M,partiallyEvaluatedTextSize:B,collisionGroup:q}=t.parameters,j=p.get("text-optional"),W=p.get("icon-optional"),N=o.getOverlapMode(p,"text-overlap","text-allow-overlap"),re=N==="always",ue=o.getOverlapMode(p,"icon-overlap","icon-allow-overlap"),K=ue==="always",se=p.get("text-rotation-alignment")==="map",me=p.get("text-pitch-alignment")==="map",_e=p.get("icon-text-fit")!=="none",ve=p.get("symbol-z-order")==="viewport-y",Ie=re&&(K||!c.hasIconData()||W),Te=K&&(re||!c.hasTextData()||j);!c.collisionArrays&&M&&c.deserializeCollisionBoxes(M);const ke=this.retainedQueryData[c.bucketInstanceId].tileID,Qe=this.terrain?(Ue,ut)=>this.terrain.getElevation(ke,Ue,ut):null,At=(Ue,ut)=>{var Ye,Ht;if(r[Ue.crossTileID])return;if(A)return void(this.placements[Ue.crossTileID]=new we(!1,!1,!1));let wt=!1,yt=!1,ht=!0,ui=null,Nt={box:null,offscreen:null},dn={box:null,offscreen:null},$i=null,Ti=null,Tn=null,ar=0,Pr=0,kr=0;ut.textFeatureIndex?ar=ut.textFeatureIndex:Ue.useRuntimeCollisionCircles&&(ar=Ue.featureIndex),ut.verticalTextFeatureIndex&&(Pr=ut.verticalTextFeatureIndex);const Gr=ut.textBox;if(Gr){const Ni=Ii=>{let qi=o.WritingMode.horizontal;if(c.allowVerticalPlacement&&!Ii&&this.prevPlacement){const Sn=this.prevPlacement.placedOrientations[Ue.crossTileID];Sn&&(this.placedOrientations[Ue.crossTileID]=Sn,qi=Sn,this.markUsedOrientation(c,qi,Ue))}return qi},hi=(Ii,qi)=>{if(c.allowVerticalPlacement&&Ue.numVerticalGlyphVertices>0&&ut.verticalTextBox){for(const Sn of c.writingModes)if(Sn===o.WritingMode.vertical?(Nt=qi(),dn=Nt):Nt=Ii(),Nt&&Nt.box&&Nt.box.length)break}else Nt=Ii()},ji=Ue.textAnchorOffsetStartIndex,ks=Ue.textAnchorOffsetEndIndex;if(ks===ji){const Ii=(qi,Sn)=>{const ri=this.collisionIndex.placeCollisionBox(qi,N,T,g,q.predicate,Qe);return ri&&ri.box&&ri.box.length&&(this.markUsedOrientation(c,Sn,Ue),this.placedOrientations[Ue.crossTileID]=Sn),ri};hi(()=>Ii(Gr,o.WritingMode.horizontal),()=>{const qi=ut.verticalTextBox;return c.allowVerticalPlacement&&Ue.numVerticalGlyphVertices>0&&qi?Ii(qi,o.WritingMode.vertical):{box:null,offscreen:null}}),Ni(Nt&&Nt.box&&Nt.box.length)}else{let Ii=o.TextAnchorEnum[(Ht=(Ye=this.prevPlacement)===null||Ye===void 0?void 0:Ye.variableOffsets[Ue.crossTileID])===null||Ht===void 0?void 0:Ht.anchor];const qi=(ri,zs,zr)=>{const lr=ri.x2-ri.x1,Hr=ri.y2-ri.y1,Yl=Ue.textBoxScale,ds=_e&&ue==="never"?zs:null;let Ds={box:[],offscreen:!1},Za=N==="never"?1:2,si="never";Ii&&Za++;for(let Ho=0;Ho<Za;Ho++){for(let Xo=ji;Xo<ks;Xo++){const Xr=c.textAnchorOffsets.get(Xo);if(Ii&&Xr.textAnchor!==Ii)continue;const Dr=this.attemptAnchorPlacement(Xr,ri,lr,Hr,Yl,se,me,T,g,q,si,Ue,c,zr,ds,Qe);if(Dr&&(Ds=Dr.placedGlyphBoxes,Ds&&Ds.box&&Ds.box.length))return wt=!0,ui=Dr.shift,Ds}Ii?Ii=null:si=N}return Ds};hi(()=>qi(Gr,ut.iconBox,o.WritingMode.horizontal),()=>{const ri=ut.verticalTextBox;return c.allowVerticalPlacement&&!(Nt&&Nt.box&&Nt.box.length)&&Ue.numVerticalGlyphVertices>0&&ri?qi(ri,ut.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),Nt&&(wt=Nt.box,ht=Nt.offscreen);const Sn=Ni(Nt&&Nt.box);if(!wt&&this.prevPlacement){const ri=this.prevPlacement.variableOffsets[Ue.crossTileID];ri&&(this.variableOffsets[Ue.crossTileID]=ri,this.markUsedJustification(c,ri.anchor,Ue,Sn))}}}if($i=Nt,wt=$i&&$i.box&&$i.box.length>0,ht=$i&&$i.offscreen,Ue.useRuntimeCollisionCircles){const Ni=c.text.placedSymbolArray.get(Ue.centerJustifiedTextSymbolIndex),hi=o.evaluateSizeForFeature(c.textSizeData,B,Ni),ji=p.get("text-padding");Ti=this.collisionIndex.placeCollisionCircles(N,Ni,c.lineVertexArray,c.glyphOffsetArray,hi,g,y,b,a,me,q.predicate,Ue.collisionCircleDiameter,ji,Qe),Ti.circles.length&&Ti.collisionDetected&&!a&&o.warnOnce("Collisions detected, but collision boxes are not shown"),wt=re||Ti.circles.length>0&&!Ti.collisionDetected,ht=ht&&Ti.offscreen}if(ut.iconFeatureIndex&&(kr=ut.iconFeatureIndex),ut.iconBox){const Ni=hi=>{const ji=_e&&ui?Je(hi,ui.x,ui.y,se,me,this.transform.angle):hi;return this.collisionIndex.placeCollisionBox(ji,ue,T,g,q.predicate,Qe)};dn&&dn.box&&dn.box.length&&ut.verticalIconBox?(Tn=Ni(ut.verticalIconBox),yt=Tn.box.length>0):(Tn=Ni(ut.iconBox),yt=Tn.box.length>0),ht=ht&&Tn.offscreen}const ps=j||Ue.numHorizontalGlyphVertices===0&&Ue.numVerticalGlyphVertices===0,Wr=W||Ue.numIconVertices===0;if(ps||Wr?Wr?ps||(yt=yt&&wt):wt=yt&&wt:yt=wt=yt&&wt,wt&&$i&&$i.box&&this.collisionIndex.insertCollisionBox($i.box,N,p.get("text-ignore-placement"),c.bucketInstanceId,dn&&dn.box&&Pr?Pr:ar,q.ID),yt&&Tn&&this.collisionIndex.insertCollisionBox(Tn.box,ue,p.get("icon-ignore-placement"),c.bucketInstanceId,kr,q.ID),Ti&&(wt&&this.collisionIndex.insertCollisionCircles(Ti.circles,N,p.get("text-ignore-placement"),c.bucketInstanceId,ar,q.ID),a)){const Ni=c.bucketInstanceId;let hi=this.collisionCircleArrays[Ni];hi===void 0&&(hi=this.collisionCircleArrays[Ni]=new Se);for(let ji=0;ji<Ti.circles.length;ji+=4)hi.circles.push(Ti.circles[ji+0]),hi.circles.push(Ti.circles[ji+1]),hi.circles.push(Ti.circles[ji+2]),hi.circles.push(Ti.collisionDetected?1:0)}if(Ue.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ue.crossTileID]=new we(wt||Ie,yt||Te,ht||c.justReloaded),r[Ue.crossTileID]=!0};if(ve){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ue=c.getSortedSymbolIndexes(this.transform.angle);for(let ut=Ue.length-1;ut>=0;--ut){const Ye=Ue[ut];At(c.symbolInstances.get(Ye),c.collisionArrays[Ye])}}else for(let Ue=t.symbolInstanceStart;Ue<t.symbolInstanceEnd;Ue++)At(c.symbolInstances.get(Ue),c.collisionArrays[Ue]);if(a&&c.bucketInstanceId in this.collisionCircleArrays){const Ue=this.collisionCircleArrays[c.bucketInstanceId];o.invert(Ue.invProjMatrix,g),Ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}markUsedJustification(t,r,a,c){let p;p=c===o.WritingMode.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(r)];const g=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const y of g)y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=p>=0&&y!==p?0:a.crossTileID)}markUsedOrientation(t,r,a){const c=r===o.WritingMode.horizontal||r===o.WritingMode.horizontalOnly?r:0,p=r===o.WritingMode.vertical?r:0,g=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const y of g)t.text.placedSymbolArray.get(y).placedOrientation=c;a.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let a=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const c=r?r.symbolFadeChange(t):1,p=r?r.opacities:{},g=r?r.variableOffsets:{},y=r?r.placedOrientations:{};for(const b in this.placements){const T=this.placements[b],A=p[b];A?(this.opacities[b]=new ae(A,c,T.text,T.icon),a=a||T.text!==A.text.placed||T.icon!==A.icon.placed):(this.opacities[b]=new ae(null,c,T.text,T.icon,T.skipFade),a=a||T.text||T.icon)}for(const b in p){const T=p[b];if(!this.opacities[b]){const A=new ae(T,c,!1,!1);A.isHidden()||(this.opacities[b]=A,a=a||T.text.placed||T.icon.placed)}}for(const b in g)this.variableOffsets[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.variableOffsets[b]=g[b]);for(const b in y)this.placedOrientations[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.placedOrientations[b]=y[b]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r){const a={};for(const c of r){const p=c.getBucket(t);p&&c.latestFeatureIndex&&t.id===p.layerIds[0]&&this.updateBucketOpacities(p,a,c.collisionBoxArray)}}updateBucketOpacities(t,r,a){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0],p=c.layout,g=new ae(null,0,!1,!1,!0),y=p.get("text-allow-overlap"),b=p.get("icon-allow-overlap"),T=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),A=p.get("text-rotation-alignment")==="map",M=p.get("text-pitch-alignment")==="map",B=p.get("icon-text-fit")!=="none",q=new ae(null,0,y&&(b||!t.hasIconData()||p.get("icon-optional")),b&&(y||!t.hasTextData()||p.get("text-optional")),!0);!t.collisionArrays&&a&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(a);const j=(W,N,re)=>{for(let ue=0;ue<N/4;ue++)W.opacityVertexArray.emplaceBack(re);W.hasVisibleVertices=W.hasVisibleVertices||re!==_i};for(let W=0;W<t.symbolInstances.length;W++){const N=t.symbolInstances.get(W),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:ue,crossTileID:K}=N;let se=this.opacities[K];r[K]?se=g:se||(se=q,this.opacities[K]=se),r[K]=!0;const me=N.numIconVertices>0,_e=this.placedOrientations[N.crossTileID],ve=_e===o.WritingMode.vertical,Ie=_e===o.WritingMode.horizontal||_e===o.WritingMode.horizontalOnly;if(re>0||ue>0){const Te=Qi(se.text);j(t.text,re,ve?_i:Te),j(t.text,ue,Ie?_i:Te);const ke=se.text.isHidden();[N.rightJustifiedTextSymbolIndex,N.centerJustifiedTextSymbolIndex,N.leftJustifiedTextSymbolIndex].forEach(Ue=>{Ue>=0&&(t.text.placedSymbolArray.get(Ue).hidden=ke||ve?1:0)}),N.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(N.verticalPlacedTextSymbolIndex).hidden=ke||Ie?1:0);const Qe=this.variableOffsets[N.crossTileID];Qe&&this.markUsedJustification(t,Qe.anchor,N,_e);const At=this.placedOrientations[N.crossTileID];At&&(this.markUsedJustification(t,"left",N,At),this.markUsedOrientation(t,At,N))}if(me){const Te=Qi(se.icon),ke=!(B&&N.verticalPlacedIconSymbolIndex&&ve);N.placedIconSymbolIndex>=0&&(j(t.icon,N.numIconVertices,ke?Te:_i),t.icon.placedSymbolArray.get(N.placedIconSymbolIndex).hidden=se.icon.isHidden()),N.verticalPlacedIconSymbolIndex>=0&&(j(t.icon,N.numVerticalIconVertices,ke?_i:Te),t.icon.placedSymbolArray.get(N.verticalPlacedIconSymbolIndex).hidden=se.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Te=t.collisionArrays[W];if(Te){let ke=new o.Point(0,0);if(Te.textBox||Te.verticalTextBox){let At=!0;if(T){const Ue=this.variableOffsets[K];Ue?(ke=_t(Ue.anchor,Ue.width,Ue.height,Ue.textOffset,Ue.textBoxScale),A&&ke._rotate(M?this.transform.angle:-this.transform.angle)):At=!1}Te.textBox&&mt(t.textCollisionBox.collisionVertexArray,se.text.placed,!At||ve,ke.x,ke.y),Te.verticalTextBox&&mt(t.textCollisionBox.collisionVertexArray,se.text.placed,!At||Ie,ke.x,ke.y)}const Qe=!!(!Ie&&Te.verticalIconBox);Te.iconBox&&mt(t.iconCollisionBox.collisionVertexArray,se.icon.placed,Qe,B?ke.x:0,B?ke.y:0),Te.verticalIconBox&&mt(t.iconCollisionBox.collisionVertexArray,se.icon.placed,!Qe,B?ke.x:0,B?ke.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const W=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=W.invProjMatrix,t.placementViewportMatrix=W.viewportMatrix,t.collisionCircleArray=W.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const a=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*a>t}setStale(){this.stale=!0}}function mt(u,t,r,a,c){u.emplaceBack(t?1:0,r?1:0,a||0,c||0),u.emplaceBack(t?1:0,r?1:0,a||0,c||0),u.emplaceBack(t?1:0,r?1:0,a||0,c||0),u.emplaceBack(t?1:0,r?1:0,a||0,c||0)}const kt=Math.pow(2,25),jt=Math.pow(2,24),St=Math.pow(2,17),Pt=Math.pow(2,16),bn=Math.pow(2,9),pt=Math.pow(2,8),Ai=Math.pow(2,1);function Qi(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,r=Math.floor(127*u.opacity);return r*kt+t*jt+r*St+t*Pt+r*bn+t*pt+r*Ai+t}const _i=0;class Rn{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,r,a,c,p){const g=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(g,c,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,g.sort((y,b)=>y.sortKey-b.sortKey));this._currentPartIndex<g.length;)if(r.placeLayerBucketPart(g[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,p())return!0;return!1}}class kc{constructor(t,r,a,c,p,g,y,b){this.placement=new st(t,r,g,y,b),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,r,a){const c=o.browser.now(),p=()=>!this._forceFullPlacement&&o.browser.now()-c>2;for(;this._currentPlacementIndex>=0;){const g=r[t[this._currentPlacementIndex]],y=this.placement.collisionIndex.transform.zoom;if(g.type==="symbol"&&(!g.minzoom||g.minzoom<=y)&&(!g.maxzoom||g.maxzoom>y)){if(this._inProgressLayer||(this._inProgressLayer=new Rn(g)),this._inProgressLayer.continuePlacement(a[g.source],this.placement,this._showCollisionBoxes,g,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const tn=512/o.EXTENT/2;class Hn{constructor(t,r,a){this.tileID=t,this.bucketInstanceId=a,this._symbolsByKey={};const c=new Map;for(let p=0;p<r.length;p++){const g=r.get(p),y=g.key,b=c.get(y);b?b.push(g):c.set(y,[g])}for(const[p,g]of c){const y={positions:g.map(b=>({x:Math.floor(b.anchorX*tn),y:Math.floor(b.anchorY*tn)})),crossTileIDs:g.map(b=>b.crossTileID)};if(y.positions.length>128){const b=new o.KDBush(y.positions.length,16,Uint16Array);for(const{x:T,y:A}of y.positions)b.add(T,A);b.finish(),delete y.positions,y.index=b}this._symbolsByKey[p]=y}}getScaledCoordinates(t,r){const{x:a,y:c,z:p}=this.tileID.canonical,{x:g,y,z:b}=r.canonical,T=tn/Math.pow(2,b-p),A=(y*o.EXTENT+t.anchorY)*T,M=c*o.EXTENT*tn;return{x:Math.floor((g*o.EXTENT+t.anchorX)*T-a*o.EXTENT*tn),y:Math.floor(A-M)}}findMatches(t,r,a){const c=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let p=0;p<t.length;p++){const g=t.get(p);if(g.crossTileID)continue;const y=this._symbolsByKey[g.key];if(!y)continue;const b=this.getScaledCoordinates(g,r);if(y.index){const T=y.index.range(b.x-c,b.y-c,b.x+c,b.y+c).sort();for(const A of T){const M=y.crossTileIDs[A];if(!a[M]){a[M]=!0,g.crossTileID=M;break}}}else if(y.positions)for(let T=0;T<y.positions.length;T++){const A=y.positions[T],M=y.crossTileIDs[T];if(Math.abs(A.x-b.x)<=c&&Math.abs(A.y-b.y)<=c&&!a[M]){a[M]=!0,g.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class gl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class fo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const a in this.indexes){const c=this.indexes[a],p={};for(const g in c){const y=c[g];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+r),p[y.tileID.key]=y}this.indexes[a]=p}this.lng=t}addBucket(t,r,a){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let p=0;p<r.symbolInstances.length;p++)r.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const c=this.usedCrossTileIDs[t.overscaledZ];for(const p in this.indexes){const g=this.indexes[p];if(Number(p)>t.overscaledZ)for(const y in g){const b=g[y];b.tileID.isChildOf(t)&&b.findMatches(r.symbolInstances,t,c)}else{const y=g[t.scaledTo(Number(p)).key];y&&y.findMatches(r.symbolInstances,t,c)}}for(let p=0;p<r.symbolInstances.length;p++){const g=r.symbolInstances.get(p);g.crossTileID||(g.crossTileID=a.generate(),c[g.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Hn(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const a of r.getCrossTileIDsLists())for(const c of a)delete this.usedCrossTileIDs[t][c]}removeStaleBuckets(t){let r=!1;for(const a in this.indexes){const c=this.indexes[a];for(const p in c)t[c[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,c[p]),delete c[p],r=!0)}return r}}class yi{constructor(){this.layerIndexes={},this.crossTileIDs=new gl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,a){let c=this.layerIndexes[t.id];c===void 0&&(c=this.layerIndexes[t.id]=new fo);let p=!1;const g={};c.handleWrapJump(a);for(const y of r){const b=y.getBucket(t);b&&t.id===b.layerIds[0]&&(b.bucketInstanceId||(b.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(y.tileID,b,this.crossTileIDs)&&(p=!0),g[b.bucketInstanceId]=!0)}return c.removeStaleBuckets(g)&&(p=!0),p}pruneUnusedLayers(t){const r={};t.forEach(a=>{r[a]=!0});for(const a in this.layerIndexes)r[a]||delete this.layerIndexes[a]}}const $r=(u,t)=>o.emitValidationErrors(u,t&&t.filter(r=>r.identifier!=="source.canvas")),Qr=o.pick(o.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),xi=o.pick(o.operations,["setCenter","setZoom","setBearing","setPitch"]),mo=o.emptyStyle();class nn extends o.Evented{constructor(t,r={}){super(),this.map=t,this.dispatcher=new yn(Dn(),this,t._getMapId()),this.imageManager=new Gt,this.imageManager.setEventedParent(this),this.glyphManager=new Dt(t._requestManager,r.localIdeographFontFamily),this.lineAtlas=new Ft(256,512),this.crossTileSymbolIndex=new yi,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const a=this;this._rtlTextPluginCallback=nn.registerForPluginStateChange(c=>{a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:c.pluginStatus,pluginURL:c.pluginURL},(p,g)=>{if(o.triggerPluginCompletionEvent(p),g&&g.every(y=>y))for(const y in a.sourceCaches){const b=a.sourceCaches[y].getSource().type;b!=="vector"&&b!=="geojson"||a.sourceCaches[y].reload()}})}),this.on("data",c=>{if(c.dataType!=="source"||c.sourceDataType!=="metadata")return;const p=this.sourceCaches[c.sourceId];if(!p)return;const g=p.getSource();if(g&&g.vectorLayerIds)for(const y in this._layers){const b=this._layers[y];b.source===g.id&&this._validateLayer(b)}})}loadURL(t,r={},a){this.fire(new o.Event("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const c=this.map._requestManager.transformRequest(t,Pe.Style);this._request=o.getJSON(c,(p,g)=>{this._request=null,p?this.fire(new o.ErrorEvent(p)):g&&this._load(g,r,a)})}loadJSON(t,r={},a){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.browser.frame(()=>{this._request=null,r.validate=r.validate!==!1,this._load(t,r,a)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(mo,{validate:!1})}_load(t,r,a){const c=r.transformStyle?r.transformStyle(a,t):t;if(!r.validate||!$r(this,o.validateStyle(c))){this._loaded=!0,this.stylesheet=c;for(const p in c.sources)this.addSource(p,c.sources[p],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs),this._createLayers(),this.light=new Ui(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}}_createLayers(){const t=o.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of t){const a=o.createStyleLayer(r);a.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=a}}_loadSprite(t,r=!1,a=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(c,p,g,y){const b=ft(c),T=b.length,A=g>1?"@2x":"",M={},B={},q={};for(const{id:j,url:W}of b){const N=p.transformRequest(p.normalizeSpriteURL(W,A,".json"),Pe.SpriteJSON),re=`${j}_${N.url}`;M[re]=o.getJSON(N,(se,me)=>{delete M[re],B[j]=me,vt(y,B,q,se,T)});const ue=p.transformRequest(p.normalizeSpriteURL(W,A,".png"),Pe.SpriteImage),K=`${j}_${ue.url}`;M[K]=Ne.getImage(ue,(se,me)=>{delete M[K],q[j]=me,vt(y,B,q,se,T)})}return{cancel(){for(const j of Object.values(M))j.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(c,p)=>{if(this._spriteRequest=null,c)this.fire(new o.ErrorEvent(c));else if(p)for(const g in p){this._spritesImagesIds[g]=[];const y=this._spritesImagesIds[g]?this._spritesImagesIds[g].filter(b=>!(b in p)):[];for(const b of y)this.imageManager.removeImage(b),this._changedImages[b]=!0;for(const b in p[g]){const T=g==="default"?b:`${g}:${b}`;this._spritesImagesIds[g].push(T),T in this.imageManager.images?this.imageManager.updateImage(T,p[g][b],!1):this.imageManager.addImage(T,p[g][b]),r&&(this._changedImages[T]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"})),a&&a(c)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}_validateLayer(t){const r=this.sourceCaches[t.source];if(!r)return;const a=t.sourceLayer;if(!a)return;const c=r.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(a)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${a}" does not exist on source "${c.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const r=this._serializedAllLayers();if(!t||t.length===0)return Object.values(r);const a=[];for(const c of t)r[c]&&a.push(r[c]);return a}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const r=Object.keys(this._layers);for(const a of r){const c=this._layers[a];c.type!=="custom"&&(t[a]=c.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const r=this._changed;if(this._changed){const c=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(c.length||p.length)&&this._updateWorkerLayers(c,p);for(const g in this._updatedSources){const y=this._updatedSources[g];if(y==="reload")this._reloadSource(g);else{if(y!=="clear")throw new Error(`Invalid action ${y}`);this._clearSource(g)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const g in this._updatedPaintProps)this._layers[g].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const a={};for(const c in this.sourceCaches){const p=this.sourceCaches[c];a[c]=p.used,p.used=!1}for(const c of this._order){const p=this._layers[c];p.recalculate(t,this._availableImages),!p.isHidden(t.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const c in a){const p=this.sourceCaches[c];a[c]!==p.used&&p.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(t),this.z=t.zoom,r&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,r){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,r={}){this._checkLoaded();const a=this.serialize();if(t=r.transformStyle?r.transformStyle(a,t):t,$r(this,o.validateStyle(t)))return!1;(t=o.clone$1(t)).layers=o.derefLayers(t.layers);const c=o.diffStyles(a,t).filter(g=>!(g.command in xi));if(c.length===0)return!1;const p=c.filter(g=>!(g.command in Qr));if(p.length>0)throw new Error(`Unimplemented: ${p.map(g=>g.command).join(", ")}.`);for(const g of c)g.command!=="setTransition"&&this[g.command].apply(this,g.args);return this.stylesheet=t,!0}addImage(t,r){if(this.getImage(t))return this.fire(new o.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,r),this._afterImageUpdated(t)}updateImage(t,r){this.imageManager.updateImage(t,r)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new o.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,r,a={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(o.validateStyle.source,`sources.${t}`,r,null,a))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const c=this.sourceCaches[t]=new Rt(t,r,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:t})),c.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===t)return this.fire(new o.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${a}" is using it.`)));const r=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],r.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,r){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const a=this.sourceCaches[t].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(r),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,r,a={}){this._checkLoaded();const c=t.id;if(this.getLayer(c))return void this.fire(new o.ErrorEvent(new Error(`Layer "${c}" already exists on this map.`)));let p;if(t.type==="custom"){if($r(this,o.validateCustomStyleLayer(t)))return;p=o.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(c,t.source),t=o.clone$1(t),t=o.extend(t,{source:c})),this._validate(o.validateStyle.layer,`layers.${c}`,t,{arrayIndex:-1},a))return;p=o.createStyleLayer(t),this._validateLayer(p),p.setEventedParent(this,{layer:{id:c}})}const g=r?this._order.indexOf(r):this._order.length;if(r&&g===-1)this.fire(new o.ErrorEvent(new Error(`Cannot add layer "${c}" before non-existing layer "${r}".`)));else{if(this._order.splice(g,0,c),this._layerOrderChanged=!0,this._layers[c]=p,this._removedLayers[c]&&p.source&&p.type!=="custom"){const y=this._removedLayers[c];delete this._removedLayers[c],y.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(t,r){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===r)return;const a=this._order.indexOf(t);this._order.splice(a,1);const c=r?this._order.indexOf(r):this._order.length;r&&c===-1?this.fire(new o.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${r}".`))):(this._order.splice(c,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const r=this._layers[t];if(!r)return void this.fire(new o.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));r.setEventedParent(null);const a=this._order.indexOf(t);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=r,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],r.onRemove&&r.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,r,a){this._checkLoaded();const c=this.getLayer(t);c?c.minzoom===r&&c.maxzoom===a||(r!=null&&(c.minzoom=r),a!=null&&(c.maxzoom=a),this._updateLayer(c)):this.fire(new o.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,r,a={}){this._checkLoaded();const c=this.getLayer(t);if(c){if(!o.deepEqual(c.filter,r))return r==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(o.validateStyle.filter,`layers.${c.id}.filter`,r,null,a)||(c.filter=o.clone$1(r),this._updateLayer(c)))}else this.fire(new o.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return o.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,r,a,c={}){this._checkLoaded();const p=this.getLayer(t);p?o.deepEqual(p.getLayoutProperty(r),a)||(p.setLayoutProperty(r,a,c),this._updateLayer(p)):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,r){const a=this.getLayer(t);if(a)return a.getLayoutProperty(r);this.fire(new o.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,r,a,c={}){this._checkLoaded();const p=this.getLayer(t);p?o.deepEqual(p.getPaintProperty(r),a)||(p.setPaintProperty(r,a,c)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,r){return this.getLayer(t).getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const a=t.source,c=t.sourceLayer,p=this.sourceCaches[a];if(p===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const g=p.getSource().type;g==="geojson"&&c?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):g!=="vector"||c?(t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),p.setFeatureState(c,t.id,r)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,r){this._checkLoaded();const a=t.source,c=this.sourceCaches[a];if(c===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const p=c.getSource().type,g=p==="vector"?t.sourceLayer:void 0;p!=="vector"||g?r&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(g,t.id,r):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const r=t.source,a=t.sourceLayer,c=this.sourceCaches[r];if(c!==void 0)return c.getSource().type!=="vector"||a?(t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),c.getFeatureState(a,t.id)):void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=o.mapObject(this.sourceCaches,c=>c.serialize()),r=this._serializeByIds(this._order),a=this.stylesheet;return o.filterObject({version:a.version,name:a.name,metadata:a.metadata,light:a.light,center:a.center,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch,sprite:a.sprite,glyphs:a.glyphs,transition:a.transition,sources:t,layers:r},c=>c!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const r=g=>this._layers[g].type==="fill-extrusion",a={},c=[];for(let g=this._order.length-1;g>=0;g--){const y=this._order[g];if(r(y)){a[y]=g;for(const b of t){const T=b[y];if(T)for(const A of T)c.push(A)}}}c.sort((g,y)=>y.intersectionZ-g.intersectionZ);const p=[];for(let g=this._order.length-1;g>=0;g--){const y=this._order[g];if(r(y))for(let b=c.length-1;b>=0;b--){const T=c[b].feature;if(a[T.layer.id]<g)break;p.push(T),c.pop()}else for(const b of t){const T=b[y];if(T)for(const A of T)p.push(A.feature)}}return p}queryRenderedFeatures(t,r,a){r&&r.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",r.filter,null,r);const c={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const y of r.layers){const b=this._layers[y];if(!b)return this.fire(new o.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot be queried for features.`))),[];c[b.source]=!0}}const p=[];r.availableImages=this._availableImages;const g=this._serializedAllLayers();for(const y in this.sourceCaches)r.layers&&!c[y]||p.push(Ct(this.sourceCaches[y],this._layers,g,t,r,a));return this.placement&&p.push(function(y,b,T,A,M,B,q){const j={},W=B.queryRenderedSymbols(A),N=[];for(const re of Object.keys(W).map(Number))N.push(q[re]);N.sort(rr);for(const re of N){const ue=re.featureIndex.lookupSymbolFeatures(W[re.bucketInstanceId],b,re.bucketIndex,re.sourceLayerIndex,M.filter,M.layers,M.availableImages,y);for(const K in ue){const se=j[K]=j[K]||[],me=ue[K];me.sort((_e,ve)=>{const Ie=re.featureSortOrder;if(Ie){const Te=Ie.indexOf(_e.featureIndex);return Ie.indexOf(ve.featureIndex)-Te}return ve.featureIndex-_e.featureIndex});for(const _e of me)se.push(_e)}}for(const re in j)j[re].forEach(ue=>{const K=ue.feature,se=T[y[re].source].getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=se});return j}(this._layers,g,this.sourceCaches,t,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(t,r){r&&r.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",r.filter,null,r);const a=this.sourceCaches[t];return a?function(c,p){const g=c.getRenderableIds().map(T=>c.getTileByID(T)),y=[],b={};for(let T=0;T<g.length;T++){const A=g[T],M=A.tileID.canonical.key;b[M]||(b[M]=!0,A.querySourceFeatures(y,p))}return y}(a,r):[]}addSourceType(t,r,a){return Er(t)?a(new Error(`A source type called "${t}" already exists.`)):(((c,p)=>{zn[c]=p})(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},a):a(null,null))}getLight(){return this.light.getLight()}setLight(t,r={}){this._checkLoaded();const a=this.light.getLight();let c=!1;for(const g in t)if(!o.deepEqual(t[g],a[g])){c=!0;break}if(!c)return;const p={now:o.browser.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,r),this.light.updateTransitions(p)}_validate(t,r,a,c,p={}){return(!p||p.validate!==!1)&&$r(this,t.call(o.validateStyle,o.extend({key:r,style:this.serialize(),value:a,styleSpec:o.v8Spec},c)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const a=this.sourceCaches[r];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const r in this.sourceCaches)this.sourceCaches[r].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,r,a,c,p=!1){let g=!1,y=!1;const b={};for(const T of this._order){const A=this._layers[T];if(A.type!=="symbol")continue;if(!b[A.source]){const B=this.sourceCaches[A.source];b[A.source]=B.getRenderableIds(!0).map(q=>B.getTileByID(q)).sort((q,j)=>j.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(j.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(A,b[A.source],t.center.lng);g=g||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.browser.now(),t.zoom))&&(this.pauseablePlacement=new kc(t,this.map.terrain,this._order,p,r,a,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,b),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.browser.now()),y=!0),g&&this.pauseablePlacement.placement.setStale()),y||g)for(const T of this._order){const A=this._layers[T];A.type==="symbol"&&this.placement.updateLayerOpacities(A,b[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.browser.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,r,a){this.imageManager.getImages(r.icons,a),this._updateTilesForChangedImages();const c=this.sourceCaches[r.source];c&&c.setDependencies(r.tileID.key,r.type,r.icons)}getGlyphs(t,r,a){this.glyphManager.getGlyphs(r.stacks,a);const c=this.sourceCaches[r.source];c&&c.setDependencies(r.tileID.key,r.type,[""])}getResource(t,r,a){return o.makeRequest(r,a)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,r={}){this._checkLoaded(),t&&this._validate(o.validateStyle.glyphs,"glyphs",t,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,r,a={},c){this._checkLoaded();const p=[{id:t,url:r}],g=[...ft(this.stylesheet.sprite),...p];this._validate(o.validateStyle.sprite,"sprite",g,null,a)||(this.stylesheet.sprite=g,this._loadSprite(p,!0,c))}removeSprite(t){this._checkLoaded();const r=ft(this.stylesheet.sprite);if(r.find(a=>a.id===t)){if(this._spritesImagesIds[t])for(const a of this._spritesImagesIds[t])this.imageManager.removeImage(a),this._changedImages[a]=!0;r.splice(r.findIndex(a=>a.id===t),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}else this.fire(new o.ErrorEvent(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return ft(this.stylesheet.sprite)}setSprite(t,r={},a){this._checkLoaded(),t&&this._validate(o.validateStyle.sprite,"sprite",t,null,r)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,a):(this._unloadSprite(),a&&a(null)))}}nn.registerForPluginStateChange=o.registerForPluginStateChange;var go=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),xr="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ns={prelude:$t(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:$t(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:$t(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:$t(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:$t("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:$t(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:$t(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:$t("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:$t("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:$t("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:$t(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:$t(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:$t(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:$t(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:$t(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$t(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:$t(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:$t(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:$t(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:$t(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:$t(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:$t(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:$t(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:$t("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",xr),terrainDepth:$t("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",xr),terrainCoords:$t("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",xr)};function $t(u,t){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=t.match(/attribute ([\w]+) ([\w]+)/g),c=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=p?p.concat(c):c,y={};return{fragmentSource:u=u.replace(r,(b,T,A,M,B)=>(y[B]=!0,T==="define"?`
#ifndef HAS_UNIFORM_u_${B}
varying ${A} ${M} ${B};
#else
uniform ${A} ${M} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${A} ${M} ${B} = u_${B};
#endif
`)),vertexSource:t=t.replace(r,(b,T,A,M,B)=>{const q=M==="float"?"vec2":"vec4",j=B.match(/color/)?"color":q;return y[B]?T==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${A} ${q} a_${B};
varying ${A} ${M} ${B};
#else
uniform ${A} ${M} u_${B};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${A} ${M} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${j}(a_${B}, u_${B}_t);
#else
    ${A} ${M} ${B} = u_${B};
#endif
`:T==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${A} ${q} a_${B};
#else
uniform ${A} ${M} u_${B};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${A} ${M} ${B} = a_${B};
#else
    ${A} ${M} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${A} ${M} ${B} = unpack_mix_${j}(a_${B}, u_${B}_t);
#else
    ${A} ${M} ${B} = u_${B};
#endif
`}),staticAttributes:a,staticUniforms:g}}class _o{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,r,a,c,p,g,y,b,T){this.context=t;let A=this.boundPaintVertexBuffers.length!==c.length;for(let M=0;!A&&M<c.length;M++)this.boundPaintVertexBuffers[M]!==c[M]&&(A=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==a||A||this.boundIndexBuffer!==p||this.boundVertexOffset!==g||this.boundDynamicVertexBuffer!==y||this.boundDynamicVertexBuffer2!==b||this.boundDynamicVertexBuffer3!==T?this.freshBind(r,a,c,p,g,y,b,T):(t.bindVertexArray.set(this.vao),y&&y.bind(),p&&p.dynamicDraw&&p.bind(),b&&b.bind(),T&&T.bind())}freshBind(t,r,a,c,p,g,y,b){const T=t.numAttributes,A=this.context,M=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=c,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=g,this.boundDynamicVertexBuffer2=y,this.boundDynamicVertexBuffer3=b,r.enableAttributes(M,t);for(const B of a)B.enableAttributes(M,t);g&&g.enableAttributes(M,t),y&&y.enableAttributes(M,t),b&&b.enableAttributes(M,t),r.bind(),r.setVertexAttribPointers(M,t,p);for(const B of a)B.bind(),B.setVertexAttribPointers(M,t,p);g&&(g.bind(),g.setVertexAttribPointers(M,t,p)),c&&c.bind(),y&&(y.bind(),y.setVertexAttribPointers(M,t,p)),b&&(b.bind(),b.setVertexAttribPointers(M,t,p)),A.currentNumAttributes=T}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function xs(u){const t=[];for(let r=0;r<u.length;r++){if(u[r]===null)continue;const a=u[r].split(" ");t.push(a.pop())}return t}class Nr{constructor(t,r,a,c,p,g){const y=t.gl;this.program=y.createProgram();const b=xs(r.staticAttributes),T=a?a.getBinderAttributes():[],A=b.concat(T),M=Ns.prelude.staticUniforms?xs(Ns.prelude.staticUniforms):[],B=r.staticUniforms?xs(r.staticUniforms):[],q=a?a.getBinderUniforms():[],j=M.concat(B).concat(q),W=[];for(const _e of j)W.indexOf(_e)<0&&W.push(_e);const N=a?a.defines():[];p&&N.push("#define OVERDRAW_INSPECTOR;"),g&&N.push("#define TERRAIN3D;");const re=N.concat(Ns.prelude.fragmentSource,r.fragmentSource).join(`
`),ue=N.concat(Ns.prelude.vertexSource,r.vertexSource).join(`
`),K=y.createShader(y.FRAGMENT_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);y.shaderSource(K,re),y.compileShader(K),y.attachShader(this.program,K);const se=y.createShader(y.VERTEX_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);y.shaderSource(se,ue),y.compileShader(se),y.attachShader(this.program,se),this.attributes={};const me={};this.numAttributes=A.length;for(let _e=0;_e<this.numAttributes;_e++)A[_e]&&(y.bindAttribLocation(this.program,_e,A[_e]),this.attributes[A[_e]]=_e);y.linkProgram(this.program),y.deleteShader(se),y.deleteShader(K);for(let _e=0;_e<W.length;_e++){const ve=W[_e];if(ve&&!me[ve]){const Ie=y.getUniformLocation(this.program,ve);Ie&&(me[ve]=Ie)}}this.fixedUniforms=c(t,me),this.terrainUniforms=((_e,ve)=>({u_depth:new o.Uniform1i(_e,ve.u_depth),u_terrain:new o.Uniform1i(_e,ve.u_terrain),u_terrain_dim:new o.Uniform1f(_e,ve.u_terrain_dim),u_terrain_matrix:new o.UniformMatrix4f(_e,ve.u_terrain_matrix),u_terrain_unpack:new o.Uniform4f(_e,ve.u_terrain_unpack),u_terrain_exaggeration:new o.Uniform1f(_e,ve.u_terrain_exaggeration)}))(t,me),this.binderUniforms=a?a.getUniforms(t,me):[]}draw(t,r,a,c,p,g,y,b,T,A,M,B,q,j,W,N,re,ue){const K=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(a),t.setStencilMode(c),t.setColorMode(p),t.setCullFace(g),b){t.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,b.depthTexture),t.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,b.texture);for(const me in this.terrainUniforms)this.terrainUniforms[me].set(b[me])}for(const me in this.fixedUniforms)this.fixedUniforms[me].set(y[me]);W&&W.setUniforms(t,this.binderUniforms,q,{zoom:j});let se=0;switch(r){case K.LINES:se=2;break;case K.TRIANGLES:se=3;break;case K.LINE_STRIP:se=1}for(const me of B.get()){const _e=me.vaos||(me.vaos={});(_e[T]||(_e[T]=new _o)).bind(t,this,A,W?W.getPaintVertexBuffers():[],M,me.vertexOffset,N,re,ue),K.drawElements(r,me.primitiveLength*se,K.UNSIGNED_SHORT,me.primitiveOffset*se*2)}}}function yo(u,t,r){const a=1/te(r,1,t.transform.tileZoom),c=Math.pow(2,r.tileID.overscaledZ),p=r.tileSize*Math.pow(2,t.transform.tileZoom)/c,g=p*(r.tileID.canonical.x+r.tileID.wrap*c),y=p*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[a,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[g>>16,y>>16],u_pixel_coord_lower:[65535&g,65535&y]}}const js=(u,t,r,a)=>{const c=t.style.light,p=c.properties.get("position"),g=[p.x,p.y,p.z],y=function(){var T=new o.ARRAY_TYPE(9);return o.ARRAY_TYPE!=Float32Array&&(T[1]=0,T[2]=0,T[3]=0,T[5]=0,T[6]=0,T[7]=0),T[0]=1,T[4]=1,T[8]=1,T}();c.properties.get("anchor")==="viewport"&&function(T,A){var M=Math.sin(A),B=Math.cos(A);T[0]=B,T[1]=M,T[2]=0,T[3]=-M,T[4]=B,T[5]=0,T[6]=0,T[7]=0,T[8]=1}(y,-t.transform.angle),function(T,A,M){var B=A[0],q=A[1],j=A[2];T[0]=B*M[0]+q*M[3]+j*M[6],T[1]=B*M[1]+q*M[4]+j*M[7],T[2]=B*M[2]+q*M[5]+j*M[8]}(g,g,y);const b=c.properties.get("color");return{u_matrix:u,u_lightpos:g,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_vertical_gradient:+r,u_opacity:a}},zc=(u,t,r,a,c,p,g)=>o.extend(js(u,t,r,a),yo(p,t,g),{u_height_factor:-Math.pow(2,c.overscaledZ)/g.tileSize/8}),_l=u=>({u_matrix:u}),xo=(u,t,r,a)=>o.extend(_l(u),yo(r,t,a)),Dc=(u,t)=>({u_matrix:u,u_world:t}),yl=(u,t,r,a,c)=>o.extend(xo(u,t,r,a),{u_world:c}),Lc=(u,t,r,a)=>{const c=u.transform;let p,g;if(a.paint.get("circle-pitch-alignment")==="map"){const y=te(r,1,c.zoom);p=!0,g=[y,y]}else p=!1,g=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:u.translatePosMatrix(t.posMatrix,r,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:u.pixelRatio,u_extrude_scale:g}},xl=(u,t,r)=>{const a=te(r,1,t.zoom),c=Math.pow(2,t.zoom-r.tileID.overscaledZ),p=r.tileID.overscaleFactor();return{u_matrix:u,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:a,u_extrude_scale:[t.pixelsToGLUnits[0]/(a*c),t.pixelsToGLUnits[1]/(a*c)],u_overscale_factor:p}},vl=(u,t,r=1)=>({u_matrix:u,u_color:t,u_overlay:0,u_overlay_scale:r}),vo=u=>({u_matrix:u}),bl=(u,t,r,a)=>({u_matrix:u,u_extrude_scale:te(t,1,r),u_intensity:a});function wl(u,t){const r=Math.pow(2,t.canonical.z),a=t.canonical.y;return[new o.MercatorCoordinate(0,a/r).toLngLat().lat,new o.MercatorCoordinate(0,(a+1)/r).toLngLat().lat]}const bo=(u,t,r,a)=>{const c=u.transform;return{u_matrix:qs(u,t,r,a),u_ratio:1/te(t,1,c.zoom),u_device_pixel_ratio:u.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},Tl=(u,t,r,a,c)=>o.extend(bo(u,t,r,c),{u_image:0,u_image_height:a}),es=(u,t,r,a,c)=>{const p=u.transform,g=Bn(t,p);return{u_matrix:qs(u,t,r,c),u_texsize:t.imageAtlasTexture.size,u_ratio:1/te(t,1,p.zoom),u_device_pixel_ratio:u.pixelRatio,u_image:0,u_scale:[g,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},wo=(u,t,r,a,c,p)=>{const g=u.lineAtlas,y=Bn(t,u.transform),b=r.layout.get("line-cap")==="round",T=g.getDash(a.from,b),A=g.getDash(a.to,b),M=T.width*c.fromScale,B=A.width*c.toScale;return o.extend(bo(u,t,r,p),{u_patternscale_a:[y/M,-T.height/2],u_patternscale_b:[y/B,-A.height/2],u_sdfgamma:g.width/(256*Math.min(M,B)*u.pixelRatio)/2,u_image:0,u_tex_y_a:T.y,u_tex_y_b:A.y,u_mix:c.t})};function Bn(u,t){return 1/te(u,1,t.tileZoom)}function qs(u,t,r,a){return u.translatePosMatrix(a?a.posMatrix:t.tileID.posMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const To=(u,t,r,a,c)=>{return{u_matrix:u,u_tl_parent:t,u_scale_parent:r,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(g=c.paint.get("raster-saturation"),g>0?1-1/(1.001-g):-g),u_contrast_factor:(p=c.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:Zs(c.paint.get("raster-hue-rotate"))};var p,g};function Zs(u){u*=Math.PI/180;const t=Math.sin(u),r=Math.cos(u);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Gs=(u,t,r,a,c,p,g,y,b,T)=>{const A=c.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:A.cameraToCenterDistance,u_pitch:A.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:A.width/A.height,u_fade_change:c.options.fadeDuration?c.symbolFadeChange:1,u_matrix:p,u_label_plane_matrix:g,u_coord_matrix:y,u_is_text:+b,u_pitch_with_map:+a,u_texsize:T,u_texture:0}},Ws=(u,t,r,a,c,p,g,y,b,T,A)=>{const M=c.transform;return o.extend(Gs(u,t,r,a,c,p,g,y,b,T),{u_gamma_scale:a?Math.cos(M._pitch)*M.cameraToCenterDistance:1,u_device_pixel_ratio:c.pixelRatio,u_is_halo:+A})},Hs=(u,t,r,a,c,p,g,y,b,T)=>o.extend(Ws(u,t,r,a,c,p,g,y,!0,b,!0),{u_texsize_icon:T,u_texture_icon:1}),ts=(u,t,r)=>({u_matrix:u,u_opacity:t,u_color:r}),So=(u,t,r,a,c,p)=>o.extend(function(g,y,b,T){const A=b.imageManager.getPattern(g.from.toString()),M=b.imageManager.getPattern(g.to.toString()),{width:B,height:q}=b.imageManager.getPixelSize(),j=Math.pow(2,T.tileID.overscaledZ),W=T.tileSize*Math.pow(2,b.transform.tileZoom)/j,N=W*(T.tileID.canonical.x+T.tileID.wrap*j),re=W*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[B,q],u_mix:y.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/te(T,1,b.transform.tileZoom),u_pixel_coord_upper:[N>>16,re>>16],u_pixel_coord_lower:[65535&N,65535&re]}}(a,p,r,c),{u_matrix:u,u_opacity:t}),Fn={fillExtrusion:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_lightpos:new o.Uniform3f(u,t.u_lightpos),u_lightintensity:new o.Uniform1f(u,t.u_lightintensity),u_lightcolor:new o.Uniform3f(u,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(u,t.u_vertical_gradient),u_opacity:new o.Uniform1f(u,t.u_opacity)}),fillExtrusionPattern:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_lightpos:new o.Uniform3f(u,t.u_lightpos),u_lightintensity:new o.Uniform1f(u,t.u_lightintensity),u_lightcolor:new o.Uniform3f(u,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(u,t.u_vertical_gradient),u_height_factor:new o.Uniform1f(u,t.u_height_factor),u_image:new o.Uniform1i(u,t.u_image),u_texsize:new o.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(u,t.u_scale),u_fade:new o.Uniform1f(u,t.u_fade),u_opacity:new o.Uniform1f(u,t.u_opacity)}),fill:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix)}),fillPattern:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_image:new o.Uniform1i(u,t.u_image),u_texsize:new o.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(u,t.u_scale),u_fade:new o.Uniform1f(u,t.u_fade)}),fillOutline:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_world:new o.Uniform2f(u,t.u_world)}),fillOutlinePattern:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_world:new o.Uniform2f(u,t.u_world),u_image:new o.Uniform1i(u,t.u_image),u_texsize:new o.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(u,t.u_scale),u_fade:new o.Uniform1f(u,t.u_fade)}),circle:(u,t)=>({u_camera_to_center_distance:new o.Uniform1f(u,t.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(u,t.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(u,t.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(u,t.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(u,t.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(u,t.u_matrix)}),collisionBox:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_camera_to_center_distance:new o.Uniform1f(u,t.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(u,t.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(u,t.u_extrude_scale),u_overscale_factor:new o.Uniform1f(u,t.u_overscale_factor)}),collisionCircle:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_inv_matrix:new o.UniformMatrix4f(u,t.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(u,t.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(u,t.u_viewport_size)}),debug:(u,t)=>({u_color:new o.UniformColor(u,t.u_color),u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_overlay:new o.Uniform1i(u,t.u_overlay),u_overlay_scale:new o.Uniform1f(u,t.u_overlay_scale)}),clippingMask:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix)}),heatmap:(u,t)=>({u_extrude_scale:new o.Uniform1f(u,t.u_extrude_scale),u_intensity:new o.Uniform1f(u,t.u_intensity),u_matrix:new o.UniformMatrix4f(u,t.u_matrix)}),heatmapTexture:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_world:new o.Uniform2f(u,t.u_world),u_image:new o.Uniform1i(u,t.u_image),u_color_ramp:new o.Uniform1i(u,t.u_color_ramp),u_opacity:new o.Uniform1f(u,t.u_opacity)}),hillshade:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_image:new o.Uniform1i(u,t.u_image),u_latrange:new o.Uniform2f(u,t.u_latrange),u_light:new o.Uniform2f(u,t.u_light),u_shadow:new o.UniformColor(u,t.u_shadow),u_highlight:new o.UniformColor(u,t.u_highlight),u_accent:new o.UniformColor(u,t.u_accent)}),hillshadePrepare:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_image:new o.Uniform1i(u,t.u_image),u_dimension:new o.Uniform2f(u,t.u_dimension),u_zoom:new o.Uniform1f(u,t.u_zoom),u_unpack:new o.Uniform4f(u,t.u_unpack)}),line:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_ratio:new o.Uniform1f(u,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(u,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(u,t.u_units_to_pixels)}),lineGradient:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_ratio:new o.Uniform1f(u,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(u,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(u,t.u_units_to_pixels),u_image:new o.Uniform1i(u,t.u_image),u_image_height:new o.Uniform1f(u,t.u_image_height)}),linePattern:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_texsize:new o.Uniform2f(u,t.u_texsize),u_ratio:new o.Uniform1f(u,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(u,t.u_device_pixel_ratio),u_image:new o.Uniform1i(u,t.u_image),u_units_to_pixels:new o.Uniform2f(u,t.u_units_to_pixels),u_scale:new o.Uniform3f(u,t.u_scale),u_fade:new o.Uniform1f(u,t.u_fade)}),lineSDF:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_ratio:new o.Uniform1f(u,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(u,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(u,t.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(u,t.u_patternscale_a),u_patternscale_b:new o.Uniform2f(u,t.u_patternscale_b),u_sdfgamma:new o.Uniform1f(u,t.u_sdfgamma),u_image:new o.Uniform1i(u,t.u_image),u_tex_y_a:new o.Uniform1f(u,t.u_tex_y_a),u_tex_y_b:new o.Uniform1f(u,t.u_tex_y_b),u_mix:new o.Uniform1f(u,t.u_mix)}),raster:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_tl_parent:new o.Uniform2f(u,t.u_tl_parent),u_scale_parent:new o.Uniform1f(u,t.u_scale_parent),u_buffer_scale:new o.Uniform1f(u,t.u_buffer_scale),u_fade_t:new o.Uniform1f(u,t.u_fade_t),u_opacity:new o.Uniform1f(u,t.u_opacity),u_image0:new o.Uniform1i(u,t.u_image0),u_image1:new o.Uniform1i(u,t.u_image1),u_brightness_low:new o.Uniform1f(u,t.u_brightness_low),u_brightness_high:new o.Uniform1f(u,t.u_brightness_high),u_saturation_factor:new o.Uniform1f(u,t.u_saturation_factor),u_contrast_factor:new o.Uniform1f(u,t.u_contrast_factor),u_spin_weights:new o.Uniform3f(u,t.u_spin_weights)}),symbolIcon:(u,t)=>({u_is_size_zoom_constant:new o.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(u,t.u_size_t),u_size:new o.Uniform1f(u,t.u_size),u_camera_to_center_distance:new o.Uniform1f(u,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(u,t.u_pitch),u_rotate_symbol:new o.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(u,t.u_fade_change),u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new o.Uniform1i(u,t.u_is_text),u_pitch_with_map:new o.Uniform1i(u,t.u_pitch_with_map),u_texsize:new o.Uniform2f(u,t.u_texsize),u_texture:new o.Uniform1i(u,t.u_texture)}),symbolSDF:(u,t)=>({u_is_size_zoom_constant:new o.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(u,t.u_size_t),u_size:new o.Uniform1f(u,t.u_size),u_camera_to_center_distance:new o.Uniform1f(u,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(u,t.u_pitch),u_rotate_symbol:new o.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(u,t.u_fade_change),u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new o.Uniform1i(u,t.u_is_text),u_pitch_with_map:new o.Uniform1i(u,t.u_pitch_with_map),u_texsize:new o.Uniform2f(u,t.u_texsize),u_texture:new o.Uniform1i(u,t.u_texture),u_gamma_scale:new o.Uniform1f(u,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(u,t.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(u,t.u_is_halo)}),symbolTextAndIcon:(u,t)=>({u_is_size_zoom_constant:new o.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(u,t.u_size_t),u_size:new o.Uniform1f(u,t.u_size),u_camera_to_center_distance:new o.Uniform1f(u,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(u,t.u_pitch),u_rotate_symbol:new o.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(u,t.u_fade_change),u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new o.Uniform1i(u,t.u_is_text),u_pitch_with_map:new o.Uniform1i(u,t.u_pitch_with_map),u_texsize:new o.Uniform2f(u,t.u_texsize),u_texsize_icon:new o.Uniform2f(u,t.u_texsize_icon),u_texture:new o.Uniform1i(u,t.u_texture),u_texture_icon:new o.Uniform1i(u,t.u_texture_icon),u_gamma_scale:new o.Uniform1f(u,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(u,t.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(u,t.u_is_halo)}),background:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_opacity:new o.Uniform1f(u,t.u_opacity),u_color:new o.UniformColor(u,t.u_color)}),backgroundPattern:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_opacity:new o.Uniform1f(u,t.u_opacity),u_image:new o.Uniform1i(u,t.u_image),u_pattern_tl_a:new o.Uniform2f(u,t.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(u,t.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(u,t.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(u,t.u_pattern_br_b),u_texsize:new o.Uniform2f(u,t.u_texsize),u_mix:new o.Uniform1f(u,t.u_mix),u_pattern_size_a:new o.Uniform2f(u,t.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(u,t.u_pattern_size_b),u_scale_a:new o.Uniform1f(u,t.u_scale_a),u_scale_b:new o.Uniform1f(u,t.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(u,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(u,t.u_tile_units_to_pixels)}),terrain:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_texture:new o.Uniform1i(u,t.u_texture),u_ele_delta:new o.Uniform1f(u,t.u_ele_delta)}),terrainDepth:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_ele_delta:new o.Uniform1f(u,t.u_ele_delta)}),terrainCoords:(u,t)=>({u_matrix:new o.UniformMatrix4f(u,t.u_matrix),u_texture:new o.Uniform1i(u,t.u_texture),u_terrain_coords_id:new o.Uniform1f(u,t.u_terrain_coords_id),u_ele_delta:new o.Uniform1f(u,t.u_ele_delta)})};class On{constructor(t,r,a){this.context=t;const c=t.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const da={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Eo{constructor(t,r,a,c){this.length=r.length,this.attributes=a,this.itemSize=r.bytesPerElement,this.dynamicDraw=c,this.context=t;const p=t.gl;this.buffer=p.createBuffer(),t.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let a=0;a<this.attributes.length;a++){const c=r.attributes[this.attributes[a].name];c!==void 0&&t.enableVertexAttribArray(c)}}setVertexAttribPointers(t,r,a){for(let c=0;c<this.attributes.length;c++){const p=this.attributes[c],g=r.attributes[p.name];g!==void 0&&t.vertexAttribPointer(g,p.components,t[da[p.type]],!1,this.itemSize,p.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const vs=new WeakMap;function bs(u){if(vs.has(u))return vs.get(u);{const t=u.getParameter(u.VERSION).startsWith("WebGL 2.0");return vs.set(u,t),t}}class zt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ao extends zt{getDefault(){return o.Color.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class fa extends zt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class ma extends zt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Io extends zt{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Sl extends zt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class El extends zt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class ws extends zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Rc extends zt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Bc extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Fc extends zt{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Oc extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class Uc extends zt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Vc extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class ga extends zt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Mo extends zt{getDefault(){return o.Color.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class _a extends zt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class ya extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class Ts extends zt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Al extends zt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Il extends zt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class xa extends zt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class is extends zt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ml extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ss extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Es extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Cl extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class va extends zt{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ot extends zt{getDefault(){return null}set(t){var r;if(t===this.current&&!this.dirty)return;const a=this.gl;bs(a)?a.bindVertexArray(t):(r=a.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Co extends zt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class $c extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Pl extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ns extends zt{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class Nc extends ns{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class jc extends ns{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class kl extends ns{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class qc{constructor(t,r,a,c,p){this.context=t,this.width=r,this.height=a;const g=t.gl,y=this.framebuffer=g.createFramebuffer();if(this.colorAttachment=new Nc(t,y),c)this.depthAttachment=p?new kl(t,y):new jc(t,y);else if(p)throw new Error("Stencil cannot be setted without depth");if(g.checkFramebufferStatus(g.FRAMEBUFFER)!==g.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,r=this.colorAttachment.get();if(r&&t.deleteTexture(r),this.depthAttachment){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}t.deleteFramebuffer(this.framebuffer)}}class ii{constructor(t,r,a){this.blendFunction=t,this.blendColor=r,this.mask=a}}ii.Replace=[1,0],ii.disabled=new ii(ii.Replace,o.Color.transparent,[!1,!1,!1,!1]),ii.unblended=new ii(ii.Replace,o.Color.transparent,[!0,!0,!0,!0]),ii.alphaBlended=new ii([1,771],o.Color.transparent,[!0,!0,!0,!0]);class Po{constructor(t){var r,a;if(this.gl=t,this.clearColor=new Ao(this),this.clearDepth=new fa(this),this.clearStencil=new ma(this),this.colorMask=new Io(this),this.depthMask=new Sl(this),this.stencilMask=new El(this),this.stencilFunc=new ws(this),this.stencilOp=new Rc(this),this.stencilTest=new Bc(this),this.depthRange=new Fc(this),this.depthTest=new Oc(this),this.depthFunc=new Uc(this),this.blend=new Vc(this),this.blendFunc=new ga(this),this.blendColor=new Mo(this),this.blendEquation=new _a(this),this.cullFace=new ya(this),this.cullFaceSide=new Ts(this),this.frontFace=new Al(this),this.program=new Il(this),this.activeTexture=new xa(this),this.viewport=new is(this),this.bindFramebuffer=new Ml(this),this.bindRenderbuffer=new Ss(this),this.bindTexture=new Es(this),this.bindVertexBuffer=new Cl(this),this.bindElementBuffer=new va(this),this.bindVertexArray=new Ot(this),this.pixelStoreUnpack=new Co(this),this.pixelStoreUnpackPremultiplyAlpha=new $c(this),this.pixelStoreUnpackFlipY=new Pl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),bs(t)){this.HALF_FLOAT=t.HALF_FLOAT;const c=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=t.RGBA16F)!==null&&r!==void 0?r:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(a=t.RGB16F)!==null&&a!==void 0?a:c==null?void 0:c.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const c=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r){return new On(this,t,r)}createVertexBuffer(t,r,a){return new Eo(this,t,r,a)}createRenderbuffer(t,r,a){const c=this.gl,p=c.createRenderbuffer();return this.bindRenderbuffer.set(p),c.renderbufferStorage(c.RENDERBUFFER,t,r,a),this.bindRenderbuffer.set(null),p}createFramebuffer(t,r,a,c){return new qc(this,t,r,a,c)}clear({color:t,depth:r,stencil:a}){const c=this.gl;let p=0;t&&(p|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(p|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),a!==void 0&&(p|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),c.clear(p)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.deepEqual(t.blendFunction,ii.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return bs(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var r;return bs(this.gl)?this.gl.deleteVertexArray(t):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Et{constructor(t,r,a){this.func=t,this.mask=r,this.range=a}}Et.ReadOnly=!1,Et.ReadWrite=!0,Et.disabled=new Et(519,Et.ReadOnly,[0,1]);const Xs=7680;class Yt{constructor(t,r,a,c,p,g){this.test=t,this.ref=r,this.mask=a,this.fail=c,this.depthFail=p,this.pass=g}}Yt.disabled=new Yt({func:519,mask:0},0,0,Xs,Xs,Xs);class Kt{constructor(t,r,a){this.enable=t,this.mode=r,this.frontFace=a}}let rs;function Ys(u,t,r,a,c,p,g){const y=u.context,b=y.gl,T=u.useProgram("collisionBox"),A=[];let M=0,B=0;for(let K=0;K<a.length;K++){const se=a[K],me=t.getTile(se),_e=me.getBucket(r);if(!_e)continue;let ve=se.posMatrix;c[0]===0&&c[1]===0||(ve=u.translatePosMatrix(se.posMatrix,me,c,p));const Ie=g?_e.textCollisionBox:_e.iconCollisionBox,Te=_e.collisionCircleArray;if(Te.length>0){const ke=o.create(),Qe=ve;o.mul(ke,_e.placementInvProjMatrix,u.transform.glCoordMatrix),o.mul(ke,ke,_e.placementViewportMatrix),A.push({circleArray:Te,circleOffset:B,transform:Qe,invTransform:ke,coord:se}),M+=Te.length/4,B=M}Ie&&T.draw(y,b.LINES,Et.disabled,Yt.disabled,u.colorModeForRenderPass(),Kt.disabled,xl(ve,u.transform,me),u.style.map.terrain&&u.style.map.terrain.getTerrainData(se),r.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,null,u.transform.zoom,null,null,Ie.collisionVertexBuffer)}if(!g||!A.length)return;const q=u.useProgram("collisionCircle"),j=new o.CollisionCircleLayoutArray;j.resize(4*M),j._trim();let W=0;for(const K of A)for(let se=0;se<K.circleArray.length/4;se++){const me=4*se,_e=K.circleArray[me+0],ve=K.circleArray[me+1],Ie=K.circleArray[me+2],Te=K.circleArray[me+3];j.emplace(W++,_e,ve,Ie,Te,0),j.emplace(W++,_e,ve,Ie,Te,1),j.emplace(W++,_e,ve,Ie,Te,2),j.emplace(W++,_e,ve,Ie,Te,3)}(!rs||rs.length<2*M)&&(rs=function(K){const se=2*K,me=new o.QuadTriangleArray;me.resize(se),me._trim();for(let _e=0;_e<se;_e++){const ve=6*_e;me.uint16[ve+0]=4*_e+0,me.uint16[ve+1]=4*_e+1,me.uint16[ve+2]=4*_e+2,me.uint16[ve+3]=4*_e+2,me.uint16[ve+4]=4*_e+3,me.uint16[ve+5]=4*_e+0}return me}(M));const N=y.createIndexBuffer(rs,!0),re=y.createVertexBuffer(j,o.collisionCircleLayout.members,!0);for(const K of A){const se={u_matrix:K.transform,u_inv_matrix:K.invTransform,u_camera_to_center_distance:(ue=u.transform).cameraToCenterDistance,u_viewport_size:[ue.width,ue.height]};q.draw(y,b.TRIANGLES,Et.disabled,Yt.disabled,u.colorModeForRenderPass(),Kt.disabled,se,u.style.map.terrain&&u.style.map.terrain.getTerrainData(K.coord),r.id,re,N,o.SegmentVector.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,u.transform.zoom,null,null,null)}var ue;re.destroy(),N.destroy()}Kt.disabled=new Kt(!1,1029,2305),Kt.backCCW=new Kt(!0,1029,2305);const ba=o.identity(new Float32Array(16));function Zc(u,t,r,a,c,p){const{horizontalAlign:g,verticalAlign:y}=o.getAnchorAlignment(u);return new o.Point((-(g-.5)*t/c+a[0])*p,(-(y-.5)*r/c+a[1])*p)}function wa(u,t,r,a,c,p,g,y,b,T,A){const M=u.text.placedSymbolArray,B=u.text.dynamicLayoutVertexArray,q=u.icon.dynamicLayoutVertexArray,j={};B.clear();for(let W=0;W<M.length;W++){const N=M.get(W),re=N.hidden||!N.crossTileID||u.allowVerticalPlacement&&!N.placedOrientation?null:a[N.crossTileID];if(re){const ue=new o.Point(N.anchorX,N.anchorY),K=at(ue,r?g:p,A),se=xn(c.cameraToCenterDistance,K.signedDistanceFromCamera);let me=o.evaluateSizeForFeature(u.textSizeData,b,N)*se/o.ONE_EM;r&&(me*=u.tilePixelRatio/y);const{width:_e,height:ve,anchor:Ie,textOffset:Te,textBoxScale:ke}=re,Qe=Zc(Ie,_e,ve,Te,ke,me),At=r?at(ue.add(Qe),p,A).point:K.point.add(t?Qe.rotate(-c.angle):Qe),Ue=u.allowVerticalPlacement&&N.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let ut=0;ut<N.numGlyphs;ut++)o.addDynamicAttributes(B,At,Ue);T&&N.associatedIconIndex>=0&&(j[N.associatedIconIndex]={shiftedAnchor:At,angle:Ue})}else V(N.numGlyphs,B)}if(T){q.clear();const W=u.icon.placedSymbolArray;for(let N=0;N<W.length;N++){const re=W.get(N);if(re.hidden)V(re.numGlyphs,q);else{const ue=j[N];if(ue)for(let K=0;K<re.numGlyphs;K++)o.addDynamicAttributes(q,ue.shiftedAnchor,ue.angle);else V(re.numGlyphs,q)}}u.icon.dynamicLayoutVertexBuffer.updateData(q)}u.text.dynamicLayoutVertexBuffer.updateData(B)}function Gc(u,t,r){return r.iconsInText&&t?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function Ta(u,t,r,a,c,p,g,y,b,T,A,M){const B=u.context,q=B.gl,j=u.transform,W=y==="map",N=b==="map",re=y!=="viewport"&&r.layout.get("symbol-placement")!=="point",ue=W&&!N&&!re,K=!r.layout.get("symbol-sort-key").isConstant();let se=!1;const me=u.depthModeForSublayer(0,Et.ReadOnly),_e=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ve=[];for(const Ie of a){const Te=t.getTile(Ie),ke=Te.getBucket(r);if(!ke)continue;const Qe=c?ke.text:ke.icon;if(!Qe||!Qe.segments.get().length||!Qe.hasVisibleVertices)continue;const At=Qe.programConfigurations.get(r.id),Ue=c||ke.sdfIcons,ut=c?ke.textSizeData:ke.iconSizeData,Ye=N||j.pitch!==0,Ht=u.useProgram(Gc(Ue,c,ke),At),wt=o.evaluateSizeForZoom(ut,j.zoom),yt=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Ie);let ht,ui,Nt,dn,$i=[0,0],Ti=null;if(c)ui=Te.glyphAtlasTexture,Nt=q.LINEAR,ht=Te.glyphAtlasTexture.size,ke.iconsInText&&($i=Te.imageAtlasTexture.size,Ti=Te.imageAtlasTexture,dn=Ye||u.options.rotating||u.options.zooming||ut.kind==="composite"||ut.kind==="camera"?q.LINEAR:q.NEAREST);else{const Ii=r.layout.get("icon-size").constantOr(0)!==1||ke.iconsNeedLinear;ui=Te.imageAtlasTexture,Nt=Ue||u.options.rotating||u.options.zooming||Ii||Ye?q.LINEAR:q.NEAREST,ht=Te.imageAtlasTexture.size}const Tn=te(Te,1,u.transform.zoom),ar=Di(Ie.posMatrix,N,W,u.transform,Tn),Pr=Li(Ie.posMatrix,N,W,u.transform,Tn),kr=_e&&ke.hasTextData(),Gr=r.layout.get("icon-text-fit")!=="none"&&kr&&ke.hasIconData();if(re){const Ii=u.style.map.terrain?(Sn,ri)=>u.style.map.terrain.getElevation(Ie,Sn,ri):null,qi=r.layout.get("text-rotation-alignment")==="map";Ki(ke,Ie.posMatrix,u,c,ar,Pr,N,T,qi,Ii)}const ps=u.translatePosMatrix(Ie.posMatrix,Te,p,g),Wr=re||c&&_e||Gr?ba:ar,Ni=u.translatePosMatrix(Pr,Te,p,g,!0),hi=Ue&&r.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ji;ji=Ue?ke.iconsInText?Hs(ut.kind,wt,ue,N,u,ps,Wr,Ni,ht,$i):Ws(ut.kind,wt,ue,N,u,ps,Wr,Ni,c,ht,!0):Gs(ut.kind,wt,ue,N,u,ps,Wr,Ni,c,ht);const ks={program:Ht,buffers:Qe,uniformValues:ji,atlasTexture:ui,atlasTextureIcon:Ti,atlasInterpolation:Nt,atlasInterpolationIcon:dn,isSDF:Ue,hasHalo:hi};if(K&&ke.canOverlap){se=!0;const Ii=Qe.segments.get();for(const qi of Ii)ve.push({segments:new o.SegmentVector([qi]),sortKey:qi.sortKey,state:ks,terrainData:yt})}else ve.push({segments:Qe.segments,sortKey:0,state:ks,terrainData:yt})}se&&ve.sort((Ie,Te)=>Ie.sortKey-Te.sortKey);for(const Ie of ve){const Te=Ie.state;if(B.activeTexture.set(q.TEXTURE0),Te.atlasTexture.bind(Te.atlasInterpolation,q.CLAMP_TO_EDGE),Te.atlasTextureIcon&&(B.activeTexture.set(q.TEXTURE1),Te.atlasTextureIcon&&Te.atlasTextureIcon.bind(Te.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),Te.isSDF){const ke=Te.uniformValues;Te.hasHalo&&(ke.u_is_halo=1,Ks(Te.buffers,Ie.segments,r,u,Te.program,me,A,M,ke,Ie.terrainData)),ke.u_is_halo=0}Ks(Te.buffers,Ie.segments,r,u,Te.program,me,A,M,Te.uniformValues,Ie.terrainData)}}function Ks(u,t,r,a,c,p,g,y,b,T){const A=a.context;c.draw(A,A.gl.TRIANGLES,p,g,y,Kt.disabled,b,T,r.id,u.layoutVertexBuffer,u.indexBuffer,t,r.paint,a.transform.zoom,u.programConfigurations.get(r.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function ko(u,t,r,a,c){if(!r||!a||!a.imageAtlas)return;const p=a.imageAtlas.patternPositions;let g=p[r.to.toString()],y=p[r.from.toString()];if(!g||!y){const b=c.getPaintProperty(t);g=p[b],y=p[b]}g&&y&&u.setConstantPatternPositions(g,y)}function Sa(u,t,r,a,c,p,g){const y=u.context.gl,b="fill-pattern",T=r.paint.get(b),A=T&&T.constantOr(1),M=r.getCrossfadeParameters();let B,q,j,W,N;g?(q=A&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=y.LINES):(q=A?"fillPattern":"fill",B=y.TRIANGLES);const re=T.constantOr(null);for(const ue of a){const K=t.getTile(ue);if(A&&!K.patternsLoaded())continue;const se=K.getBucket(r);if(!se)continue;const me=se.programConfigurations.get(r.id),_e=u.useProgram(q,me),ve=u.style.map.terrain&&u.style.map.terrain.getTerrainData(ue);A&&(u.context.activeTexture.set(y.TEXTURE0),K.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),me.updatePaintBuffers(M)),ko(me,b,re,K,r);const Ie=ve?ue:null,Te=u.translatePosMatrix(Ie?Ie.posMatrix:ue.posMatrix,K,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(g){W=se.indexBuffer2,N=se.segments2;const ke=[y.drawingBufferWidth,y.drawingBufferHeight];j=q==="fillOutlinePattern"&&A?yl(Te,u,M,K,ke):Dc(Te,ke)}else W=se.indexBuffer,N=se.segments,j=A?xo(Te,u,M,K):_l(Te);_e.draw(u.context,B,c,u.stencilModeForClipping(ue),p,Kt.disabled,j,ve,r.id,se.layoutVertexBuffer,W,N,r.paint,u.transform.zoom,me)}}function zo(u,t,r,a,c,p,g){const y=u.context,b=y.gl,T="fill-extrusion-pattern",A=r.paint.get(T),M=A.constantOr(1),B=r.getCrossfadeParameters(),q=r.paint.get("fill-extrusion-opacity"),j=A.constantOr(null);for(const W of a){const N=t.getTile(W),re=N.getBucket(r);if(!re)continue;const ue=u.style.map.terrain&&u.style.map.terrain.getTerrainData(W),K=re.programConfigurations.get(r.id),se=u.useProgram(M?"fillExtrusionPattern":"fillExtrusion",K);M&&(u.context.activeTexture.set(b.TEXTURE0),N.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),K.updatePaintBuffers(B)),ko(K,T,j,N,r);const me=u.translatePosMatrix(W.posMatrix,N,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),_e=r.paint.get("fill-extrusion-vertical-gradient"),ve=M?zc(me,u,_e,q,W,B,N):js(me,u,_e,q);se.draw(y,y.gl.TRIANGLES,c,p,g,Kt.backCCW,ve,ue,r.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,r.paint,u.transform.zoom,K,u.style.map.terrain&&re.centroidVertexBuffer)}}function Do(u,t,r,a,c,p,g){const y=u.context,b=y.gl,T=r.fbo;if(!T)return;const A=u.useProgram("hillshade"),M=u.style.map.terrain&&u.style.map.terrain.getTerrainData(t);y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,T.colorAttachment.get()),A.draw(y,b.TRIANGLES,c,p,g,Kt.disabled,((B,q,j,W)=>{const N=j.paint.get("hillshade-shadow-color"),re=j.paint.get("hillshade-highlight-color"),ue=j.paint.get("hillshade-accent-color");let K=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(K-=B.transform.angle);const se=!B.options.moving;return{u_matrix:W?W.posMatrix:B.transform.calculatePosMatrix(q.tileID.toUnwrapped(),se),u_image:0,u_latrange:wl(0,q.tileID),u_light:[j.paint.get("hillshade-exaggeration"),K],u_shadow:N,u_highlight:re,u_accent:ue}})(u,r,a,M?t:null),M,a.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}function Ea(u,t,r,a,c,p){const g=u.context,y=g.gl,b=t.dem;if(b&&b.data){const T=b.dim,A=b.stride,M=b.getPixels();if(g.activeTexture.set(y.TEXTURE1),g.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(A),t.demTexture){const q=t.demTexture;q.update(M,{premultiply:!1}),q.bind(y.NEAREST,y.CLAMP_TO_EDGE)}else t.demTexture=new Tt(g,M,y.RGBA,{premultiply:!1}),t.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);g.activeTexture.set(y.TEXTURE0);let B=t.fbo;if(!B){const q=new Tt(g,{width:T,height:T,data:null},y.RGBA);q.bind(y.LINEAR,y.CLAMP_TO_EDGE),B=t.fbo=g.createFramebuffer(T,T,!0,!1),B.colorAttachment.set(q.texture)}g.bindFramebuffer.set(B.framebuffer),g.viewport.set([0,0,T,T]),u.useProgram("hillshadePrepare").draw(g,y.TRIANGLES,a,c,p,Kt.disabled,((q,j)=>{const W=j.stride,N=o.create();return o.ortho(N,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(N,N,[0,-o.EXTENT,0]),{u_matrix:N,u_image:1,u_dimension:[W,W],u_zoom:q.overscaledZ,u_unpack:j.getUnpackVector()}})(t.tileID,b),null,r.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Wc(u,t,r,a,c,p){const g=a.paint.get("raster-fade-duration");if(!p&&g>0){const y=o.browser.now(),b=(y-u.timeAdded)/g,T=t?(y-t.timeAdded)/g:-1,A=r.getSource(),M=c.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),B=!t||Math.abs(t.tileID.overscaledZ-M)>Math.abs(u.tileID.overscaledZ-M),q=B&&u.refreshedUponExpiration?1:o.clamp(B?b:1-T,0,1);return u.refreshedUponExpiration&&b>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}const zl=new o.Color(1,0,0,1),vi=new o.Color(0,1,0,1),ss=new o.Color(0,0,1,1),Xn=new o.Color(1,0,1,1),Aa=new o.Color(0,1,1,1);function Lo(u,t,r,a){Ar(u,0,t+r/2,u.transform.width,r,a)}function Ia(u,t,r,a){Ar(u,t-r/2,0,r,u.transform.height,a)}function Ar(u,t,r,a,c,p){const g=u.context,y=g.gl;y.enable(y.SCISSOR_TEST),y.scissor(t*u.pixelRatio,r*u.pixelRatio,a*u.pixelRatio,c*u.pixelRatio),g.clear({color:p}),y.disable(y.SCISSOR_TEST)}function Js(u,t,r){const a=u.context,c=a.gl,p=r.posMatrix,g=u.useProgram("debug"),y=Et.disabled,b=Yt.disabled,T=u.colorModeForRenderPass(),A="$debug",M=u.style.map.terrain&&u.style.map.terrain.getTerrainData(r);a.activeTexture.set(c.TEXTURE0);const B=t.getTileByID(r.key).latestRawTileData,q=Math.floor((B&&B.byteLength||0)/1024),j=t.getTile(r).tileSize,W=512/Math.min(j,512)*(r.overscaledZ/u.transform.zoom)*.5;let N=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(N+=` => ${r.overscaledZ}`),function(re,ue){re.initDebugOverlayCanvas();const K=re.debugOverlayCanvas,se=re.context.gl,me=re.debugOverlayCanvas.getContext("2d");me.clearRect(0,0,K.width,K.height),me.shadowColor="white",me.shadowBlur=2,me.lineWidth=1.5,me.strokeStyle="white",me.textBaseline="top",me.font="bold 36px Open Sans, sans-serif",me.fillText(ue,5,5),me.strokeText(ue,5,5),re.debugOverlayTexture.update(K),re.debugOverlayTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE)}(u,`${N} ${q}kB`),g.draw(a,c.TRIANGLES,y,b,ii.alphaBlended,Kt.disabled,vl(p,o.Color.transparent,W),null,A,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments),g.draw(a,c.LINE_STRIP,y,b,T,Kt.disabled,vl(p,o.Color.red),M,A,u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments)}function Ro(u,t,r){const a=u.context,c=a.gl,p=u.colorModeForRenderPass(),g=new Et(c.LEQUAL,Et.ReadWrite,u.depthRangeFor3D),y=u.useProgram("terrain"),b=t.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,u.width,u.height]);for(const T of r){const A=u.renderToTexture.getTexture(T),M=t.getTerrainData(T.tileID);a.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,A.texture);const B={u_matrix:u.transform.calculatePosMatrix(T.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(u.transform.zoom)};y.draw(a,c.TRIANGLES,g,Yt.disabled,p,Kt.backCCW,B,M,"terrain",b.vertexBuffer,b.indexBuffer,b.segments)}}class Dl{constructor(t,r){this.context=new Po(t),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.create(),renderTime:0},this.setup(),this.numSublayers=Rt.maxUnderzooming+Rt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new yi}resize(t,r,a){if(this.width=Math.floor(t*a),this.height=Math.floor(r*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const t=this.context,r=new o.PosArray;r.emplaceBack(0,0),r.emplaceBack(o.EXTENT,0),r.emplaceBack(0,o.EXTENT),r.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(r,go.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const a=new o.PosArray;a.emplaceBack(0,0),a.emplaceBack(o.EXTENT,0),a.emplaceBack(0,o.EXTENT),a.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=t.createVertexBuffer(a,go.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const c=new o.RasterBoundsArray;c.emplaceBack(0,0,0,0),c.emplaceBack(o.EXTENT,0,o.EXTENT,0),c.emplaceBack(0,o.EXTENT,0,o.EXTENT),c.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(c,ci.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const p=new o.PosArray;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,go.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const g=new o.LineStripIndexArray;g.emplaceBack(0),g.emplaceBack(1),g.emplaceBack(3),g.emplaceBack(2),g.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(g);const y=new o.TriangleIndexArray;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(y);const b=this.context.gl;this.stencilClearMode=new Yt({func:b.ALWAYS,mask:0},0,255,b.ZERO,b.ZERO,b.ZERO)}clearStencil(){const t=this.context,r=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=o.create();o.ortho(a,0,this.width,this.height,0,0,1),o.scale(a,a,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,r.TRIANGLES,Et.disabled,this.stencilClearMode,ii.disabled,Kt.disabled,vo(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,r){if(this.currentStencilSource===t.source||!t.isTileClipped()||!r||!r.length)return;this.currentStencilSource=t.source;const a=this.context,c=a.gl;this.nextStencilID+r.length>256&&this.clearStencil(),a.setColorMode(ii.disabled),a.setDepthMode(Et.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const g of r){const y=this._tileClippingMaskIDs[g.key]=this.nextStencilID++,b=this.style.map.terrain&&this.style.map.terrain.getTerrainData(g);p.draw(a,c.TRIANGLES,Et.disabled,new Yt({func:c.ALWAYS,mask:0},y,255,c.KEEP,c.KEEP,c.REPLACE),ii.disabled,Kt.disabled,vo(g.posMatrix),b,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new Yt({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){const r=this.context.gl;return new Yt({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,a=t.sort((g,y)=>y.overscaledZ-g.overscaledZ),c=a[a.length-1].overscaledZ,p=a[0].overscaledZ-c+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const g={};for(let y=0;y<p;y++)g[y+c]=new Yt({func:r.GEQUAL,mask:255},y+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=p,[g,a]}return[{[c]:Yt.disabled},a]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ii([t.CONSTANT_COLOR,t.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ii.unblended:ii.alphaBlended}depthModeForSublayer(t,r,a){if(!this.opaquePassEnabledForLayer())return Et.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Et(a||this.context.gl.LEQUAL,r,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){this.style=t,this.options=r,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.browser.now()),this.imageManager.beginFrame();const a=this.style._order,c=this.style.sourceCaches,p={},g={},y={};for(const b in c){const T=c[b];T.used&&T.prepare(this.context),p[b]=T.getVisibleCoordinates(),g[b]=p[b].slice().reverse(),y[b]=T.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let b=0;b<a.length;b++)if(this.style._layers[a[b]].is3D()){this.opaquePassCutoff=b;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const b=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||b.length)&&(o.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(T,A){const M=T.context,B=M.gl,q=ii.unblended,j=new Et(B.LEQUAL,Et.ReadWrite,[0,1]),W=A.getTerrainMesh(),N=A.sourceCache.getRenderableTiles(),re=T.useProgram("terrainDepth");M.bindFramebuffer.set(A.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),M.clear({color:o.Color.transparent,depth:1});for(const ue of N){const K=A.getTerrainData(ue.tileID),se={u_matrix:T.transform.calculatePosMatrix(ue.tileID.toUnwrapped()),u_ele_delta:A.getMeshFrameDelta(T.transform.zoom)};re.draw(M,B.TRIANGLES,j,Yt.disabled,q,Kt.backCCW,se,K,"terrain",W.vertexBuffer,W.indexBuffer,W.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,T.width,T.height])}(this,this.style.map.terrain),function(T,A){const M=T.context,B=M.gl,q=ii.unblended,j=new Et(B.LEQUAL,Et.ReadWrite,[0,1]),W=A.getTerrainMesh(),N=A.getCoordsTexture(),re=A.sourceCache.getRenderableTiles(),ue=T.useProgram("terrainCoords");M.bindFramebuffer.set(A.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),M.clear({color:o.Color.transparent,depth:1}),A.coordsIndex=[];for(const K of re){const se=A.getTerrainData(K.tileID);M.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,N.texture);const me={u_matrix:T.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_terrain_coords_id:(255-A.coordsIndex.length)/255,u_texture:0,u_ele_delta:A.getMeshFrameDelta(T.transform.zoom)};ue.draw(M,B.TRIANGLES,j,Yt.disabled,q,Kt.backCCW,me,se,"terrain",W.vertexBuffer,W.indexBuffer,W.segments),A.coordsIndex.push(K.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,T.width,T.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const b of a){const T=this.style._layers[b];if(!T.hasOffscreenPass()||T.isHidden(this.transform.zoom))continue;const A=g[T.source];(T.type==="custom"||A.length)&&this.renderLayer(this,c[T.source],T,A)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const b=this.style._layers[a[this.currentLayer]],T=c[b.source],A=p[b.source];this._renderTileClippingMasks(b,A),this.renderLayer(this,T,b,A)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const b=this.style._layers[a[this.currentLayer]],T=c[b.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(b))continue;const A=(b.type==="symbol"?y:g)[b.source];this._renderTileClippingMasks(b,p[b.source]),this.renderLayer(this,T,b,A)}if(this.options.showTileBoundaries){const b=function(T,A){let M=null;const B=Object.values(T._layers).flatMap(N=>N.source&&!N.isHidden(A)?[T.sourceCaches[N.source]]:[]),q=B.filter(N=>N.getSource().type==="vector"),j=B.filter(N=>N.getSource().type!=="vector"),W=N=>{(!M||M.getSource().maxzoom<N.getSource().maxzoom)&&(M=N)};return q.forEach(N=>W(N)),M||j.forEach(N=>W(N)),M}(this.style,this.transform.zoom);b&&function(T,A,M){for(let B=0;B<M.length;B++)Js(T,A,M[B])}(this,b,b.getVisibleCoordinates())}this.options.showPadding&&function(b){const T=b.transform.padding;Lo(b,b.transform.height-(T.top||0),3,zl),Lo(b,T.bottom||0,3,vi),Ia(b,T.left||0,3,ss),Ia(b,b.transform.width-(T.right||0),3,Xn);const A=b.transform.centerPoint;(function(M,B,q,j){Ar(M,B-1,q-10,2,20,j),Ar(M,B-10,q-1,20,2,j)})(b,A.x,b.transform.height-A.y,Aa)}(this),this.context.setDefault()}renderLayer(t,r,a,c){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(c||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(p,g,y,b,T){if(p.renderPass!=="translucent")return;const A=Yt.disabled,M=p.colorModeForRenderPass();(y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(B,q,j,W,N,re,ue){const K=q.transform,se=N==="map",me=re==="map";for(const _e of B){const ve=W.getTile(_e),Ie=ve.getBucket(j);if(!Ie||!Ie.text||!Ie.text.segments.get().length)continue;const Te=o.evaluateSizeForZoom(Ie.textSizeData,K.zoom),ke=te(ve,1,q.transform.zoom),Qe=Di(_e.posMatrix,me,se,q.transform,ke),At=j.layout.get("icon-text-fit")!=="none"&&Ie.hasIconData();if(Te){const Ue=Math.pow(2,K.zoom-ve.tileID.overscaledZ);wa(Ie,se,me,ue,K,Qe,_e.posMatrix,Ue,Te,At,q.style.map.terrain?(ut,Ye)=>q.style.map.terrain.getElevation(_e,ut,Ye):null)}}}(b,p,y,g,y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),T),y.paint.get("icon-opacity").constantOr(1)!==0&&Ta(p,g,y,b,!1,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),y.layout.get("icon-rotation-alignment"),y.layout.get("icon-pitch-alignment"),y.layout.get("icon-keep-upright"),A,M),y.paint.get("text-opacity").constantOr(1)!==0&&Ta(p,g,y,b,!0,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),y.layout.get("text-keep-upright"),A,M),g.map.showCollisionBoxes&&(Ys(p,g,y,b,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),!0),Ys(p,g,y,b,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),!1))})(t,r,a,c,this.style.placement.variableOffsets);break;case"circle":(function(p,g,y,b){if(p.renderPass!=="translucent")return;const T=y.paint.get("circle-opacity"),A=y.paint.get("circle-stroke-width"),M=y.paint.get("circle-stroke-opacity"),B=!y.layout.get("circle-sort-key").isConstant();if(T.constantOr(1)===0&&(A.constantOr(1)===0||M.constantOr(1)===0))return;const q=p.context,j=q.gl,W=p.depthModeForSublayer(0,Et.ReadOnly),N=Yt.disabled,re=p.colorModeForRenderPass(),ue=[];for(let K=0;K<b.length;K++){const se=b[K],me=g.getTile(se),_e=me.getBucket(y);if(!_e)continue;const ve=_e.programConfigurations.get(y.id),Ie=p.useProgram("circle",ve),Te=_e.layoutVertexBuffer,ke=_e.indexBuffer,Qe=p.style.map.terrain&&p.style.map.terrain.getTerrainData(se),At={programConfiguration:ve,program:Ie,layoutVertexBuffer:Te,indexBuffer:ke,uniformValues:Lc(p,se,me,y),terrainData:Qe};if(B){const Ue=_e.segments.get();for(const ut of Ue)ue.push({segments:new o.SegmentVector([ut]),sortKey:ut.sortKey,state:At})}else ue.push({segments:_e.segments,sortKey:0,state:At})}B&&ue.sort((K,se)=>K.sortKey-se.sortKey);for(const K of ue){const{programConfiguration:se,program:me,layoutVertexBuffer:_e,indexBuffer:ve,uniformValues:Ie,terrainData:Te}=K.state;me.draw(q,j.TRIANGLES,W,N,re,Kt.disabled,Ie,Te,y.id,_e,ve,K.segments,y.paint,p.transform.zoom,se)}})(t,r,a,c);break;case"heatmap":(function(p,g,y,b){if(y.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const T=p.context,A=T.gl,M=Yt.disabled,B=new ii([A.ONE,A.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(q,j,W){const N=q.gl;q.activeTexture.set(N.TEXTURE1),q.viewport.set([0,0,j.width/4,j.height/4]);let re=W.heatmapFbo;if(re)N.bindTexture(N.TEXTURE_2D,re.colorAttachment.get()),q.bindFramebuffer.set(re.framebuffer);else{const ue=N.createTexture();N.bindTexture(N.TEXTURE_2D,ue),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),re=W.heatmapFbo=q.createFramebuffer(j.width/4,j.height/4,!1,!1),function(K,se,me,_e){var ve,Ie;const Te=K.gl,ke=(ve=K.HALF_FLOAT)!==null&&ve!==void 0?ve:Te.UNSIGNED_BYTE,Qe=(Ie=K.RGBA16F)!==null&&Ie!==void 0?Ie:Te.RGBA;Te.texImage2D(Te.TEXTURE_2D,0,Qe,se.width/4,se.height/4,0,Te.RGBA,ke,null),_e.colorAttachment.set(me)}(q,j,ue,re)}})(T,p,y),T.clear({color:o.Color.transparent});for(let q=0;q<b.length;q++){const j=b[q];if(g.hasRenderableParent(j))continue;const W=g.getTile(j),N=W.getBucket(y);if(!N)continue;const re=N.programConfigurations.get(y.id),ue=p.useProgram("heatmap",re),{zoom:K}=p.transform;ue.draw(T,A.TRIANGLES,Et.disabled,M,B,Kt.disabled,bl(j.posMatrix,W,K,y.paint.get("heatmap-intensity")),null,y.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,y.paint,p.transform.zoom,re)}T.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(T,A){const M=T.context,B=M.gl,q=A.heatmapFbo;if(!q)return;M.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,q.colorAttachment.get()),M.activeTexture.set(B.TEXTURE1);let j=A.colorRampTexture;j||(j=A.colorRampTexture=new Tt(M,A.colorRamp,B.RGBA)),j.bind(B.LINEAR,B.CLAMP_TO_EDGE),T.useProgram("heatmapTexture").draw(M,B.TRIANGLES,Et.disabled,Yt.disabled,T.colorModeForRenderPass(),Kt.disabled,((W,N,re,ue)=>{const K=o.create();o.ortho(K,0,W.width,W.height,0,0,1);const se=W.context.gl;return{u_matrix:K,u_world:[se.drawingBufferWidth,se.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}})(T,A),null,A.id,T.viewportBuffer,T.quadTriangleIndexBuffer,T.viewportSegments,A.paint,T.transform.zoom)}(p,y))})(t,r,a,c);break;case"line":(function(p,g,y,b){if(p.renderPass!=="translucent")return;const T=y.paint.get("line-opacity"),A=y.paint.get("line-width");if(T.constantOr(1)===0||A.constantOr(1)===0)return;const M=p.depthModeForSublayer(0,Et.ReadOnly),B=p.colorModeForRenderPass(),q=y.paint.get("line-dasharray"),j=y.paint.get("line-pattern"),W=j.constantOr(1),N=y.paint.get("line-gradient"),re=y.getCrossfadeParameters(),ue=W?"linePattern":q?"lineSDF":N?"lineGradient":"line",K=p.context,se=K.gl;let me=!0;for(const _e of b){const ve=g.getTile(_e);if(W&&!ve.patternsLoaded())continue;const Ie=ve.getBucket(y);if(!Ie)continue;const Te=Ie.programConfigurations.get(y.id),ke=p.context.program.get(),Qe=p.useProgram(ue,Te),At=me||Qe.program!==ke,Ue=p.style.map.terrain&&p.style.map.terrain.getTerrainData(_e),ut=j.constantOr(null);if(ut&&ve.imageAtlas){const wt=ve.imageAtlas,yt=wt.patternPositions[ut.to.toString()],ht=wt.patternPositions[ut.from.toString()];yt&&ht&&Te.setConstantPatternPositions(yt,ht)}const Ye=Ue?_e:null,Ht=W?es(p,ve,y,re,Ye):q?wo(p,ve,y,q,re,Ye):N?Tl(p,ve,y,Ie.lineClipsArray.length,Ye):bo(p,ve,y,Ye);if(W)K.activeTexture.set(se.TEXTURE0),ve.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Te.updatePaintBuffers(re);else if(q&&(At||p.lineAtlas.dirty))K.activeTexture.set(se.TEXTURE0),p.lineAtlas.bind(K);else if(N){const wt=Ie.gradients[y.id];let yt=wt.texture;if(y.gradientVersion!==wt.version){let ht=256;if(y.stepInterpolant){const ui=g.getSource().maxzoom,Nt=_e.canonical.z===ui?Math.ceil(1<<p.transform.maxZoom-_e.canonical.z):1;ht=o.clamp(o.nextPowerOfTwo(Ie.maxLineLength/o.EXTENT*1024*Nt),256,K.maxTextureSize)}wt.gradient=o.renderColorRamp({expression:y.gradientExpression(),evaluationKey:"lineProgress",resolution:ht,image:wt.gradient||void 0,clips:Ie.lineClipsArray}),wt.texture?wt.texture.update(wt.gradient):wt.texture=new Tt(K,wt.gradient,se.RGBA),wt.version=y.gradientVersion,yt=wt.texture}K.activeTexture.set(se.TEXTURE0),yt.bind(y.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}Qe.draw(K,se.TRIANGLES,M,p.stencilModeForClipping(_e),B,Kt.disabled,Ht,Ue,y.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,y.paint,p.transform.zoom,Te,Ie.layoutVertexBuffer2),me=!1}})(t,r,a,c);break;case"fill":(function(p,g,y,b){const T=y.paint.get("fill-color"),A=y.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const M=p.colorModeForRenderPass(),B=y.paint.get("fill-pattern"),q=p.opaquePassEnabledForLayer()&&!B.constantOr(1)&&T.constantOr(o.Color.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===q){const j=p.depthModeForSublayer(1,p.renderPass==="opaque"?Et.ReadWrite:Et.ReadOnly);Sa(p,g,y,b,j,M,!1)}if(p.renderPass==="translucent"&&y.paint.get("fill-antialias")){const j=p.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,Et.ReadOnly);Sa(p,g,y,b,j,M,!0)}})(t,r,a,c);break;case"fill-extrusion":(function(p,g,y,b){const T=y.paint.get("fill-extrusion-opacity");if(T!==0&&p.renderPass==="translucent"){const A=new Et(p.context.gl.LEQUAL,Et.ReadWrite,p.depthRangeFor3D);if(T!==1||y.paint.get("fill-extrusion-pattern").constantOr(1))zo(p,g,y,b,A,Yt.disabled,ii.disabled),zo(p,g,y,b,A,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const M=p.colorModeForRenderPass();zo(p,g,y,b,A,Yt.disabled,M)}}})(t,r,a,c);break;case"hillshade":(function(p,g,y,b){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const T=p.context,A=p.depthModeForSublayer(0,Et.ReadOnly),M=p.colorModeForRenderPass(),[B,q]=p.renderPass==="translucent"?p.stencilConfigForOverlap(b):[{},b];for(const j of q){const W=g.getTile(j);W.needsHillshadePrepare!==void 0&&W.needsHillshadePrepare&&p.renderPass==="offscreen"?Ea(p,W,y,A,Yt.disabled,M):p.renderPass==="translucent"&&Do(p,j,W,y,A,B[j.overscaledZ],M)}T.viewport.set([0,0,p.width,p.height])})(t,r,a,c);break;case"raster":(function(p,g,y,b){if(p.renderPass!=="translucent"||y.paint.get("raster-opacity")===0||!b.length)return;const T=p.context,A=T.gl,M=g.getSource(),B=p.useProgram("raster"),q=p.colorModeForRenderPass(),[j,W]=M instanceof hn?[{},b]:p.stencilConfigForOverlap(b),N=W[W.length-1].overscaledZ,re=!p.options.moving;for(const ue of W){const K=p.depthModeForSublayer(ue.overscaledZ-N,y.paint.get("raster-opacity")===1?Et.ReadWrite:Et.ReadOnly,A.LESS),se=g.getTile(ue);se.registerFadeDuration(y.paint.get("raster-fade-duration"));const me=g.findLoadedParent(ue,0),_e=Wc(se,me,g,y,p.transform,p.style.map.terrain);let ve,Ie;const Te=y.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;T.activeTexture.set(A.TEXTURE0),se.texture.bind(Te,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),T.activeTexture.set(A.TEXTURE1),me?(me.texture.bind(Te,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),ve=Math.pow(2,me.tileID.overscaledZ-se.tileID.overscaledZ),Ie=[se.tileID.canonical.x*ve%1,se.tileID.canonical.y*ve%1]):se.texture.bind(Te,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);const ke=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ue),Qe=ke?ue:null,At=Qe?Qe.posMatrix:p.transform.calculatePosMatrix(ue.toUnwrapped(),re),Ue=To(At,Ie||[0,0],ve||1,_e,y);M instanceof hn?B.draw(T,A.TRIANGLES,K,Yt.disabled,q,Kt.disabled,Ue,ke,y.id,M.boundsBuffer,p.quadTriangleIndexBuffer,M.boundsSegments):B.draw(T,A.TRIANGLES,K,j[ue.overscaledZ],q,Kt.disabled,Ue,ke,y.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}})(t,r,a,c);break;case"background":(function(p,g,y,b){const T=y.paint.get("background-color"),A=y.paint.get("background-opacity");if(A===0)return;const M=p.context,B=M.gl,q=p.transform,j=q.tileSize,W=y.paint.get("background-pattern");if(p.isPatternMissing(W))return;const N=!W&&T.a===1&&A===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==N)return;const re=Yt.disabled,ue=p.depthModeForSublayer(0,N==="opaque"?Et.ReadWrite:Et.ReadOnly),K=p.colorModeForRenderPass(),se=p.useProgram(W?"backgroundPattern":"background"),me=b||q.coveringTiles({tileSize:j,terrain:p.style.map.terrain});W&&(M.activeTexture.set(B.TEXTURE0),p.imageManager.bind(p.context));const _e=y.getCrossfadeParameters();for(const ve of me){const Ie=b?ve.posMatrix:p.transform.calculatePosMatrix(ve.toUnwrapped()),Te=W?So(Ie,A,p,W,{tileID:ve,tileSize:j},_e):ts(Ie,A,T),ke=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ve);se.draw(M,B.TRIANGLES,ue,re,K,Kt.disabled,Te,ke,y.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}})(t,0,a,c);break;case"custom":(function(p,g,y){const b=p.context,T=y.implementation;if(p.renderPass==="offscreen"){const A=T.prerender;A&&(p.setCustomLayerDefaults(),b.setColorMode(p.colorModeForRenderPass()),A.call(T,b.gl,p.transform.customLayerMatrix()),b.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),b.setColorMode(p.colorModeForRenderPass()),b.setStencilMode(Yt.disabled);const A=T.renderingMode==="3d"?new Et(p.context.gl.LEQUAL,Et.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,Et.ReadOnly);b.setDepthMode(A),T.render(b.gl,p.transform.customLayerMatrix()),b.setDirty(),p.setBaseState(),b.bindFramebuffer.set(null)}})(t,0,a)}}translatePosMatrix(t,r,a,c,p){if(!a[0]&&!a[1])return t;const g=p?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(g){const T=Math.sin(g),A=Math.cos(g);a=[a[0]*A-a[1]*T,a[0]*T+a[1]*A]}const y=[p?a[0]:te(r,a[0],this.transform.zoom),p?a[1]:te(r,a[1],this.transform.zoom),0],b=new Float32Array(16);return o.translate(b,t,y),b}saveTileTexture(t){const r=this._tileTextures[t.size[0]];r?r.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const r=this.imageManager.getPattern(t.from.toString()),a=this.imageManager.getPattern(t.to.toString());return!r||!a}useProgram(t,r){this.cache=this.cache||{};const a=t+(r?r.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new Nr(this.context,Ns[t],r,Fn[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Tt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:r}=this.context.gl;return this.width!==t||this.height!==r}}class Bo{constructor(t,r){this.points=t,this.planes=r}static fromInvProjectionMatrix(t,r,a){const c=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{const b=1/(y=o.transformMat4([],y,t))[3]/r*c;return o.mul$1(y,y,[b,b,1/y[3],b])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{const b=function(B,q){var j=q[0],W=q[1],N=q[2],re=j*j+W*W+N*N;return re>0&&(re=1/Math.sqrt(re)),B[0]=q[0]*re,B[1]=q[1]*re,B[2]=q[2]*re,B}([],function(B,q,j){var W=q[0],N=q[1],re=q[2],ue=j[0],K=j[1],se=j[2];return B[0]=N*se-re*K,B[1]=re*ue-W*se,B[2]=W*K-N*ue,B}([],Le([],p[y[0]],p[y[1]]),Le([],p[y[2]],p[y[1]]))),T=-((A=b)[0]*(M=p[y[1]])[0]+A[1]*M[1]+A[2]*M[2]);var A,M;return b.concat(T)});return new Bo(p,g)}}class Qs{constructor(t,r){this.min=t,this.max=r,this.center=function(a,c,p){return a[0]=.5*c[0],a[1]=.5*c[1],a[2]=.5*c[2],a}([],function(a,c,p){return a[0]=c[0]+p[0],a[1]=c[1]+p[1],a[2]=c[2]+p[2],a}([],this.min,this.max))}quadrant(t){const r=[t%2==0,t<2],a=je(this.min),c=je(this.max);for(let p=0;p<r.length;p++)a[p]=r[p]?this.min[p]:this.center[p],c[p]=r[p]?this.center[p]:this.max[p];return c[2]=this.max[2],new Qs(a,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const r=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let c=0;c<t.planes.length;c++){const p=t.planes[c];let g=0;for(let y=0;y<r.length;y++)o.dot(p,r[y])>=0&&g++;if(g===0)return 0;g!==r.length&&(a=!1)}if(a)return 2;for(let c=0;c<3;c++){let p=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let y=0;y<t.points.length;y++){const b=t.points[y][c]-this.min[c];p=Math.min(p,b),g=Math.max(g,b)}if(g<0||p>this.max[c]-this.min[c])return 0}return 1}}class Fo{constructor(t=0,r=0,a=0,c=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(a)||a<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=a,this.right=c}interpolate(t,r,a){return r.top!=null&&t.top!=null&&(this.top=o.interpolate.number(t.top,r.top,a)),r.bottom!=null&&t.bottom!=null&&(this.bottom=o.interpolate.number(t.bottom,r.bottom,a)),r.left!=null&&t.left!=null&&(this.left=o.interpolate.number(t.left,r.left,a)),r.right!=null&&t.right!=null&&(this.right=o.interpolate.number(t.right,r.right,a)),this}getCenter(t,r){const a=o.clamp((this.left+t-this.right)/2,0,t),c=o.clamp((this.top+r-this.bottom)/2,0,r);return new o.Point(a,c)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Fo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Oo{constructor(t,r,a,c,p){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=p===void 0||!!p,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=a??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Fo,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new Oo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const r=-o.wrap(t,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=function(){var a=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,c,p){var g=c[0],y=c[1],b=c[2],T=c[3],A=Math.sin(p),M=Math.cos(p);a[0]=g*M+b*A,a[1]=y*M+T*A,a[2]=g*-A+b*M,a[3]=y*-A+T*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=o.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this.tileZoom=Math.max(0,Math.floor(r)),this.scale=this.zoomScale(r),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,a){this._unmodified=!1,this._edgeInsets.interpolate(t,r,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new o.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const a=this.pointCoordinate(new o.Point(0,0)),c=this.pointCoordinate(new o.Point(this.width,0)),p=this.pointCoordinate(new o.Point(this.width,this.height)),g=this.pointCoordinate(new o.Point(0,this.height)),y=Math.floor(Math.min(a.x,c.x,p.x,g.x)),b=Math.floor(Math.max(a.x,c.x,p.x,g.x)),T=1;for(let A=y-T;A<=b+T;A++)A!==0&&r.push(new o.UnwrappedTileID(A,t))}return r}coveringTiles(t){var r,a;let c=this.coveringZoomLevel(t);const p=c;if(t.minzoom!==void 0&&c<t.minzoom)return[];t.maxzoom!==void 0&&c>t.maxzoom&&(c=t.maxzoom);const g=this.pointCoordinate(this.getCameraPoint()),y=o.MercatorCoordinate.fromLngLat(this.center),b=Math.pow(2,c),T=[b*g.x,b*g.y,0],A=[b*y.x,b*y.y,0],M=Bo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c);let B=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(B=c);const q=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,j=K=>({aabb:new Qs([K*b,0,0],[(K+1)*b,b,0]),zoom:0,x:0,y:0,wrap:K,fullyVisible:!1}),W=[],N=[],re=c,ue=t.reparseOverscaled?p:c;if(this._renderWorldCopies)for(let K=1;K<=3;K++)W.push(j(-K)),W.push(j(K));for(W.push(j(0));W.length>0;){const K=W.pop(),se=K.x,me=K.y;let _e=K.fullyVisible;if(!_e){const Qe=K.aabb.intersects(M);if(Qe===0)continue;_e=Qe===2}const ve=t.terrain?T:A,Ie=K.aabb.distanceX(ve),Te=K.aabb.distanceY(ve),ke=Math.max(Math.abs(Ie),Math.abs(Te));if(K.zoom===re||ke>q+(1<<re-K.zoom)-2&&K.zoom>=B){const Qe=re-K.zoom,At=T[0]-.5-(se<<Qe),Ue=T[1]-.5-(me<<Qe);N.push({tileID:new o.OverscaledTileID(K.zoom===re?ue:K.zoom,K.wrap,K.zoom,se,me),distanceSq:Ke([A[0]-.5-se,A[1]-.5-me]),tileDistanceToCamera:Math.sqrt(At*At+Ue*Ue)})}else for(let Qe=0;Qe<4;Qe++){const At=(se<<1)+Qe%2,Ue=(me<<1)+(Qe>>1),ut=K.zoom+1;let Ye=K.aabb.quadrant(Qe);if(t.terrain){const Ht=new o.OverscaledTileID(ut,K.wrap,ut,At,Ue),wt=t.terrain.getMinMaxElevation(Ht),yt=(r=wt.minElevation)!==null&&r!==void 0?r:this.elevation,ht=(a=wt.maxElevation)!==null&&a!==void 0?a:this.elevation;Ye=new Qs([Ye.min[0],Ye.min[1],yt],[Ye.max[0],Ye.max[1],ht])}W.push({aabb:Ye,zoom:ut,x:At,y:Ue,wrap:K.wrap,fullyVisible:_e})}}return N.sort((K,se)=>K.distanceSq-se.distanceSq).map(K=>K.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=o.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.Point(o.mercatorXfromLng(t.lng)*this.worldSize,o.mercatorYfromLat(r)*this.worldSize)}unproject(t){return new o.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const r=this.pointLocation(this.centerPoint,t),a=t.getElevationForLngLatZoom(r,this.tileZoom);if(!(this.elevation-a))return;const c=this.getCameraPosition(),p=o.MercatorCoordinate.fromLngLat(c.lngLat,c.altitude),g=o.MercatorCoordinate.fromLngLat(r,a),y=p.x-g.x,b=p.y-g.y,T=p.z-g.z,A=Math.sqrt(y*y+b*b+T*T),M=this.scaleZoom(this.cameraToCenterDistance/A/this.tileSize);this._elevation=a,this._center=r,this.zoom=M}setLocationAtPoint(t,r){const a=this.pointCoordinate(r),c=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(t),g=new o.MercatorCoordinate(p.x-(a.x-c.x),p.y-(a.y-c.y));this.center=this.coordinateLocation(g),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,r){return r?this.coordinatePoint(this.locationCoordinate(t),r.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,r){return this.coordinateLocation(this.pointCoordinate(t,r))}locationCoordinate(t){return o.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,r){if(r){const B=r.pointCoordinate(t);if(B!=null)return B}const a=[t.x,t.y,0,1],c=[t.x,t.y,1,1];o.transformMat4(a,a,this.pixelMatrixInverse),o.transformMat4(c,c,this.pixelMatrixInverse);const p=a[3],g=c[3],y=a[1]/p,b=c[1]/g,T=a[2]/p,A=c[2]/g,M=T===A?0:(0-T)/(A-T);return new o.MercatorCoordinate(o.interpolate.number(a[0]/p,c[0]/g,M)/this.worldSize,o.interpolate.number(y,b,M)/this.worldSize)}coordinatePoint(t,r=0,a=this.pixelMatrix){const c=[t.x*this.worldSize,t.y*this.worldSize,r,1];return o.transformMat4(c,c,a),new o.Point(c[0]/c[3],c[1]/c[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Lt().extend(this.pointLocation(new o.Point(0,t))).extend(this.pointLocation(new o.Point(this.width,t))).extend(this.pointLocation(new o.Point(this.width,this.height))).extend(this.pointLocation(new o.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Lt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,r=!1){const a=t.key,c=r?this._alignedPosMatrixCache:this._posMatrixCache;if(c[a])return c[a];const p=t.canonical,g=this.worldSize/this.zoomScale(p.z),y=p.x+Math.pow(2,p.z)*t.wrap,b=o.identity(new Float64Array(16));return o.translate(b,b,[y*g,p.y*g,0]),o.scale(b,b,[g/o.EXTENT,g/o.EXTENT,1]),o.multiply(b,r?this.alignedProjMatrix:this.projMatrix,b),c[a]=new Float32Array(b),c[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,r,a,c,p=-90,g=90,y=-180,b=180;const T=this.size,A=this._unmodified;if(this.latRange){const q=this.latRange;p=o.mercatorYfromLat(q[1])*this.worldSize,g=o.mercatorYfromLat(q[0])*this.worldSize,t=g-p<T.y?T.y/(g-p):0}if(this.lngRange){const q=this.lngRange;y=o.wrap(o.mercatorXfromLng(q[0])*this.worldSize,0,this.worldSize),b=o.wrap(o.mercatorXfromLng(q[1])*this.worldSize,0,this.worldSize),b<y&&(b+=this.worldSize),r=b-y<T.x?T.x/(b-y):0}const M=this.point,B=Math.max(r||0,t||0);if(B)return this.center=this.unproject(new o.Point(r?(b+y)/2:M.x,t?(g+p)/2:M.y)),this.zoom+=this.scaleZoom(B),this._unmodified=A,void(this._constraining=!1);if(this.latRange){const q=M.y,j=T.y/2;q-j<p&&(c=p+j),q+j>g&&(c=g-j)}if(this.lngRange){const q=(y+b)/2,j=o.wrap(M.x,q-this.worldSize/2,q+this.worldSize/2),W=T.x/2;j-W<y&&(a=y+W),j+W>b&&(a=b-W)}a===void 0&&c===void 0||(this.center=this.unproject(new o.Point(a!==void 0?a:M.x,c!==void 0?c:M.y)).wrap()),this._unmodified=A,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let c=o.identity(new Float64Array(16));o.scale(c,c,[this.width/2,-this.height/2,1]),o.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=o.identity(new Float64Array(16)),o.scale(c,c,[1,-1,1]),o.translate(c,c,[-1,-1,0]),o.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const p=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),g=Math.min(this.elevation,this._minEleveationForCurrentTile),y=p-g*this._pixelPerMeter/Math.cos(this._pitch),b=g<0?y:p,T=Math.PI/2+this._pitch,A=this._fov*(.5+t.y/this.height),M=Math.sin(A)*b/Math.sin(o.clamp(Math.PI-T-A,.01,Math.PI-.01)),B=this.getHorizon(),q=2*Math.atan(B/this.cameraToCenterDistance)*(.5+t.y/(2*B)),j=Math.sin(q)*b/Math.sin(o.clamp(Math.PI-T-q,.01,Math.PI-.01)),W=Math.min(M,j),N=1.01*(Math.cos(Math.PI/2-this._pitch)*W+b),re=this.height/50;c=new Float64Array(16),o.perspective(c,this._fov,this.width/this.height,re,N),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,o.scale(c,c,[1,-1,1]),o.translate(c,c,[0,0,-this.cameraToCenterDistance]),o.rotateX(c,c,this._pitch),o.rotateZ(c,c,this.angle),o.translate(c,c,[-r,-a,0]),this.mercatorMatrix=o.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),o.scale(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,c),o.translate(c,c,[0,0,-this.elevation]),this.projMatrix=c,this.invProjMatrix=o.invert([],c),this.pixelMatrix3D=o.multiply(new Float64Array(16),this.labelPlaneMatrix,c);const ue=this.width%2/2,K=this.height%2/2,se=Math.cos(this.angle),me=Math.sin(this.angle),_e=r-Math.round(r)+se*ue+me*K,ve=a-Math.round(a)+se*K+me*ue,Ie=new Float64Array(c);if(o.translate(Ie,Ie,[_e>.5?_e-1:_e,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=Ie,c=o.invert(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new o.Point(0,0)),r=[t.x*this.worldSize,t.y*this.worldSize,0,1];return o.transformMat4(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,t))}getCameraQueryGeometry(t){const r=this.getCameraPoint();if(t.length===1)return[t[0],r];{let a=r.x,c=r.y,p=r.x,g=r.y;for(const y of t)a=Math.min(a,y.x),c=Math.min(c,y.y),p=Math.max(p,y.x),g=Math.max(g,y.y);return[new o.Point(a,c),new o.Point(p,c),new o.Point(p,g),new o.Point(a,g),new o.Point(a,c)]}}}class os{constructor(t){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let a;return r.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(a=c)}),(a&&a[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(r.length>=3&&!r.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:a,pitch:+(r[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,r)}catch{}},this._updateHash=function(r,a){let c=!1,p=null;const g=()=>{p=null,c&&(r(),p=setTimeout(g,300),c=!1)};return()=>(c=!0,p||g(),p)}(this._updateHashUnthrottled),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const r=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,c=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,c),g=Math.round(r.lng*p)/p,y=Math.round(r.lat*p)/p,b=this._map.getBearing(),T=this._map.getPitch();let A="";if(A+=t?`/${g}/${y}/${a}`:`${a}/${y}/${g}`,(b||T)&&(A+="/"+Math.round(10*b)/10),T&&(A+=`/${Math.round(T)}`),this._hashName){const M=this._hashName;let B=!1;const q=window.location.hash.slice(1).split("&").map(j=>{const W=j.split("=")[0];return W===M?(B=!0,`${W}=${A}`):j}).filter(j=>j);return B||q.push(`${M}=${A}`),`#${q.join("&")}`}return`#${A}`}}const eo={linearity:.3,easing:o.bezier(0,0,.3,1)},Ll=o.extend({deceleration:2500,maxSpeed:1400},eo),Rl=o.extend({deceleration:20,maxSpeed:1400},eo),Bl=o.extend({deceleration:1e3,maxSpeed:360},eo),Fl=o.extend({deceleration:1e3,maxSpeed:90},eo);class Ol{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.browser.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=o.browser.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)r.zoom+=p.zoomDelta||0,r.bearing+=p.bearingDelta||0,r.pitch+=p.pitchDelta||0,p.panDelta&&r.pan._add(p.panDelta),p.around&&(r.around=p.around),p.pinchAround&&(r.pinchAround=p.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(r.pan.mag()){const p=to(r.pan.mag(),a,o.extend({},Ll,t||{}));c.offset=r.pan.mult(p.amount/r.pan.mag()),c.center=this._map.transform.center,jr(c,p)}if(r.zoom){const p=to(r.zoom,a,Rl);c.zoom=this._map.transform.zoom+p.amount,jr(c,p)}if(r.bearing){const p=to(r.bearing,a,Bl);c.bearing=this._map.transform.bearing+o.clamp(p.amount,-179,179),jr(c,p)}if(r.pitch){const p=to(r.pitch,a,Fl);c.pitch=this._map.transform.pitch+p.amount,jr(c,p)}if(c.zoom||c.bearing){const p=r.pinchAround===void 0?r.around:r.pinchAround;c.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),o.extend(c,{noMoveStart:!0})}}function jr(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function to(u,t,r){const{maxSpeed:a,linearity:c,deceleration:p}=r,g=o.clamp(u*c/(t/1e3),-a,a),y=Math.abs(g)/(p*c);return{easing:r.easing,duration:1e3*y,amount:g*(y/2)}}class bi extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,a,c={}){const p=z.mousePos(r.getCanvasContainer(),a),g=r.unproject(p);super(t,o.extend({point:p,lngLat:g,originalEvent:a},c)),this._defaultPrevented=!1,this.target=r}}class Yn extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,a){const c=t==="touchend"?a.changedTouches:a.touches,p=z.touchPos(r.getCanvasContainer(),c),g=p.map(b=>r.unproject(b)),y=p.reduce((b,T,A,M)=>b.add(T.div(M.length)),new o.Point(0,0));super(t,{points:p,point:y,lngLats:g,lngLat:r.unproject(y),originalEvent:a}),this._defaultPrevented=!1}}class Ul extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,a){super(t,{originalEvent:a}),this._defaultPrevented=!1}}class Ir{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Ul(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new bi(t.type,this._map,t))}mouseup(t){this._map.fire(new bi(t.type,this._map,t))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new bi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new bi(t.type,this._map,t))}mouseover(t){this._map.fire(new bi(t.type,this._map,t))}mouseout(t){this._map.fire(new bi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Yn(t.type,this._map,t))}touchmove(t){this._map.fire(new Yn(t.type,this._map,t))}touchend(t){this._map.fire(new Yn(t.type,this._map,t))}touchcancel(t){this._map.fire(new Yn(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class io{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new bi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new bi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new bi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class no{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(o.Point.convert(t),this._map.terrain)}}class Hc{constructor(t,r){this._map=t,this._tr=new no(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(z.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const a=r;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=a,this._box||(this._box=z.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const p=Math.min(c.x,a.x),g=Math.max(c.x,a.x),y=Math.min(c.y,a.y),b=Math.max(c.y,a.y);z.setTransform(this._box,`translate(${p}px,${y}px)`),this._box.style.width=g-p+"px",this._box.style.height=b-y+"px"}mouseupWindow(t,r){if(!this._active||t.button!==0)return;const a=this._startPos,c=r;if(this.reset(),z.suppressClick(),a.x!==c.x||a.y!==c.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:p=>p.fitScreenCoordinates(a,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(z.remove(this._box),this._box=null),z.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new o.Event(t,{originalEvent:r}))}}function Ma(u,t){if(u.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${u.length}, points ${t.length}`);const r={};for(let a=0;a<u.length;a++)r[u[a].identifier]=t[a];return r}class Vl{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,r,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),a.length===this.numTouches&&(this.centroid=function(c){const p=new o.Point(0,0);for(const g of c)p._add(g);return p.div(c.length)}(r),this.touches=Ma(a,r)))}touchmove(t,r,a){if(this.aborted||!this.centroid)return;const c=Ma(a,r);for(const p in this.touches){const g=c[p];(!g||g.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(t,r,a){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class as{constructor(t){this.singleTap=new Vl(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,r,a){this.singleTap.touchstart(t,r,a)}touchmove(t,r,a){this.singleTap.touchmove(t,r,a)}touchend(t,r,a){const c=this.singleTap.touchend(t,r,a);if(c){const p=t.timeStamp-this.lastTime<500,g=!this.lastTap||this.lastTap.dist(c)<30;if(p&&g||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class qr{constructor(t){this._tr=new no(t),this._zoomIn=new as({numTouches:1,numTaps:2}),this._zoomOut=new as({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,a){this._zoomIn.touchstart(t,r,a),this._zoomOut.touchstart(t,r,a)}touchmove(t,r,a){this._zoomIn.touchmove(t,r,a),this._zoomOut.touchmove(t,r,a)}touchend(t,r,a){const c=this._zoomIn.touchend(t,r,a),p=this._zoomOut.touchend(t,r,a),g=this._tr;return c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:g.zoom+1,around:g.unproject(c)},{originalEvent:t})}):p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:g.zoom-1,around:g.unproject(p)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class He{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const r=this._moveFunction(...t);if(r.bearingDelta||r.pitchDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(t,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=r.length?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,r){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const c=r.length?r[0]:r;return!this._moved&&c.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(a,c))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&z.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const $l={0:1,2:2};class ls{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const r=z.mouseButton(t);this._eventButton=r}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(r,a){const c=$l[a];return r.buttons===void 0||(r.buttons&c)!==c}(t,this._eventButton)}isValidEndEvent(t){return z.mouseButton(t)===this._eventButton}}class As{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const Uo=u=>{u.mousedown=u.dragStart,u.mousemoveWindow=u.dragMove,u.mouseup=u.dragEnd,u.contextmenu=function(t){t.preventDefault()}},Ze=({enable:u,clickTolerance:t,bearingDegreesPerPixelMoved:r=.8})=>{const a=new ls({checkCorrectEvent:c=>z.mouseButton(c)===0&&c.ctrlKey||z.mouseButton(c)===2});return new He({clickTolerance:t,move:(c,p)=>({bearingDelta:(p.x-c.x)*r}),moveStateManager:a,enable:u,assignEvents:Uo})},Vo=({enable:u,clickTolerance:t,pitchDegreesPerPixelMoved:r=-.5})=>{const a=new ls({checkCorrectEvent:c=>z.mouseButton(c)===0&&c.ctrlKey||z.mouseButton(c)===2});return new He({clickTolerance:t,move:(c,p)=>({pitchDelta:(p.y-c.y)*r}),moveStateManager:a,enable:u,assignEvents:Uo})};class Xc{constructor(t,r){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.Point(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,r,a){return this._calculateTransform(t,r,a)}touchmove(t,r,a){if(this._map._cooperativeGestures&&(this._minTouches===2&&a.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,a.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(a.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,r,a)}touchend(t,r,a){this._calculateTransform(t,r,a),this._active&&a.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,a){a.length>0&&(this._active=!0);const c=Ma(a,r),p=new o.Point(0,0),g=new o.Point(0,0);let y=0;for(const T in c){const A=c[T],M=this._touches[T];M&&(p._add(A),g._add(A.sub(M)),y++,c[T]=A)}if(this._touches=c,y<this._minTouches||!g.mag())return;const b=g.div(y);return this._sum._add(b),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(y),panDelta:b}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ca{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,r,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,a){if(!this._firstTwoTouches)return;t.preventDefault();const[c,p]=this._firstTwoTouches,g=Is(a,r,c),y=Is(a,r,p);if(!g||!y)return;const b=this._aroundCenter?null:g.add(y).div(2);return this._move([g,y],b,t)}touchend(t,r,a){if(!this._firstTwoTouches)return;const[c,p]=this._firstTwoTouches,g=Is(a,r,c),y=Is(a,r,p);g&&y||(this._active&&z.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Is(u,t,r){for(let a=0;a<u.length;a++)if(u[a].identifier===r)return t[a]}function Pa(u,t){return Math.log(u/t)/Math.LN2}class Nl extends Ca{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const a=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Pa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Pa(this._distance,a),pinchAround:r}}}function jl(u,t){return 180*u.angleWith(t)/Math.PI}class Yc extends Ca{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const a=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:jl(this._vector,a),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,a=jl(t,this._startVector);return Math.abs(a)<r}}function ro(u){return Math.abs(u.y)>Math.abs(u.x)}class ka extends Ca{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,r,a){super.touchstart(t,r,a),this._currentTouchCount=a.length}_start(t){this._lastPoints=t,ro(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,a){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const c=t[0].sub(this._lastPoints[0]),p=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,p,a.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(c.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(t,r,a){if(this._valid!==void 0)return this._valid;const c=t.mag()>=2,p=r.mag()>=2;if(!c&&!p)return;if(!c||!p)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const g=t.y>0==r.y>0;return ro(t)&&ro(r)&&g}}const za={panStep:100,bearingStep:15,pitchStep:10};class Da{constructor(t){this._tr=new no(t);const r=za;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,a=0,c=0,p=0,g=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?a=-1:(t.preventDefault(),p=-1);break;case 39:t.shiftKey?a=1:(t.preventDefault(),p=1);break;case 38:t.shiftKey?c=1:(t.preventDefault(),g=-1);break;case 40:t.shiftKey?c=-1:(t.preventDefault(),g=1);break;default:return}return this._rotationDisabled&&(a=0,c=0),{cameraAnimation:y=>{const b=this._tr;y.easeTo({duration:300,easeId:"keyboardHandler",easing:wn,zoom:r?Math.round(b.zoom)+r*(t.shiftKey?2:1):b.zoom,bearing:b.bearing+a*this._bearingStep,pitch:b.pitch+c*this._pitchStep,offset:[-p*this._panStep,-g*this._panStep],center:b.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function wn(u){return u*(2-u)}const Mr=4.000244140625;class ql{constructor(t,r){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=t,this._tr=new no(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const a=o.browser.now(),c=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,r!==0&&r%Mr==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(c*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=z.mousePos(this._el,t),a=this._tr;this._around=o.LngLat.convert(this._aroundCenter?a.center:a.unproject(r)),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const y=this._type==="wheel"&&Math.abs(this._delta)>Mr?this._wheelZoomRate:this._defaultZoomRate;let b=2/(1+Math.exp(-Math.abs(this._delta*y)));this._delta<0&&b!==0&&(b=1/b);const T=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(T*b))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,a=this._startZoom,c=this._easing;let p,g=!1;if(this._type==="wheel"&&a&&c){const y=Math.min((o.browser.now()-this._lastWheelEventTime)/200,1),b=c(y);p=o.interpolate.number(a,r,b),y<1?this._frameId||(this._frameId=!0):g=!0}else p=r,g=!0;return this._active=!0,g&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!g,zoomDelta:p-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=o.defaultEasing;if(this._prevEase){const a=this._prevEase,c=(o.browser.now()-a.start)/a.duration,p=a.easing(c+.01)-a.easing(c),g=.27/Math.sqrt(p*p+1e-4)*.01,y=Math.sqrt(.0729-g*g);r=o.bezier(g,y,.25,1)}return this._prevEase={start:o.browser.now(),duration:t,easing:r},r}reset(){this._active=!1}}class La{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ra{constructor(t){this._tr=new no(t),this.reset()}reset(){this._active=!1}dblclick(t,r){return t.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ba{constructor(){this._tap=new as({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,r,a){if(!this._swipePoint)if(this._tapTime){const c=r[0],p=t.timeStamp-this._tapTime<500,g=this._tapPoint.dist(c)<30;p&&g?a.length>0&&(this._swipePoint=c,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(t,r,a)}touchmove(t,r,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const c=r[0],p=c.y-this._swipePoint.y;return this._swipePoint=c,t.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(t,r,a)}touchend(t,r,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const c=this._tap.touchend(t,r,a);c&&(this._tapTime=t.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zl{constructor(t,r,a){this._el=t,this._mousePan=r,this._touchPan=a}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Kn{constructor(t,r,a){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Qt{constructor(t,r,a,c){this._el=t,this._touchZoom=r,this._touchRotate=a,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const cs=u=>u.zoom||u.drag||u.pitch||u.rotate;class Fa extends o.Event{}function $o(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class Gl{constructor(t,r){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,p)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const g=c.type==="renderFrame"?void 0:c,y={needsRenderFrame:!1},b={},T={},A=c.touches,M=A?this._getMapTouches(A):void 0,B=M?z.touchPos(this._el,M):z.mousePos(this._el,c);for(const{handlerName:W,handler:N,allowed:re}of this._handlers){if(!N.isEnabled())continue;let ue;this._blockedByActive(T,re,W)?N.reset():N[p||c.type]&&(ue=N[p||c.type](c,B,M),this.mergeHandlerResult(y,b,ue,W,g),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()),(ue||N.isActive())&&(T[W]=N)}const q={};for(const W in this._previousActiveHandlers)T[W]||(q[W]=g);this._previousActiveHandlers=T,(Object.keys(q).length||$o(y))&&(this._changes.push([y,b,q]),this._triggerRenderFrame()),(Object.keys(T).length||$o(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=y;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ol(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,p,g]of this._listeners)z.addEventListener(c,p,c===document?this.handleWindowEvent:this.handleEvent,g)}destroy(){for(const[t,r,a]of this._listeners)z.removeEventListener(t,r,t===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(t){const r=this._map,a=r.getCanvasContainer();this._add("mapEvent",new Ir(r,t));const c=r.boxZoom=new Hc(r,t);this._add("boxZoom",c),t.interactive&&t.boxZoom&&c.enable();const p=new qr(r),g=new Ra(r);r.doubleClickZoom=new La(g,p),this._add("tapZoom",p),this._add("clickZoom",g),t.interactive&&t.doubleClickZoom&&r.doubleClickZoom.enable();const y=new Ba;this._add("tapDragZoom",y);const b=r.touchPitch=new ka(r);this._add("touchPitch",b),t.interactive&&t.touchPitch&&r.touchPitch.enable(t.touchPitch);const T=Ze(t),A=Vo(t);r.dragRotate=new Kn(t,T,A),this._add("mouseRotate",T,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]),t.interactive&&t.dragRotate&&r.dragRotate.enable();const M=(({enable:re,clickTolerance:ue})=>{const K=new ls({checkCorrectEvent:se=>z.mouseButton(se)===0&&!se.ctrlKey});return new He({clickTolerance:ue,move:(se,me)=>({around:me,panDelta:me.sub(se)}),activateOnStart:!0,moveStateManager:K,enable:re,assignEvents:Uo})})(t),B=new Xc(t,r);r.dragPan=new Zl(a,M,B),this._add("mousePan",M),this._add("touchPan",B,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&r.dragPan.enable(t.dragPan);const q=new Yc,j=new Nl;r.touchZoomRotate=new Qt(a,j,q,y),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&r.touchZoomRotate.enable(t.touchZoomRotate);const W=r.scrollZoom=new ql(r,()=>this._triggerRenderFrame());this._add("scrollZoom",W,["mousePan"]),t.interactive&&t.scrollZoom&&r.scrollZoom.enable(t.scrollZoom);const N=r.keyboard=new Da(r);this._add("keyboard",N),t.interactive&&t.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new io(r))}_add(t,r,a){this._handlers.push({handlerName:t,handler:r,allowed:a}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!cs(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,r,a){for(const c in t)if(c!==a&&(!r||r.indexOf(c)<0))return!0;return!1}_getMapTouches(t){const r=[];for(const a of t)this._el.contains(a.target)&&r.push(a);return r}mergeHandlerResult(t,r,a,c,p){if(!a)return;o.extend(t,a);const g={handlerName:c,originalEvent:a.originalEvent||p};a.zoomDelta!==void 0&&(r.zoom=g),a.panDelta!==void 0&&(r.drag=g),a.pitchDelta!==void 0&&(r.pitch=g),a.bearingDelta!==void 0&&(r.rotate=g)}_applyChanges(){const t={},r={},a={};for(const[c,p,g]of this._changes)c.panDelta&&(t.panDelta=(t.panDelta||new o.Point(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),o.extend(r,p),o.extend(a,g);this._updateMapTransform(t,r,a),this._changes=[]}_updateMapTransform(t,r,a){const c=this._map,p=c._getTransformForUpdate(),g=c.terrain;if(!($o(t)||g&&this._terrainMovement))return this._fireEvents(r,a,!0);let{panDelta:y,zoomDelta:b,bearingDelta:T,pitchDelta:A,around:M,pinchAround:B}=t;B!==void 0&&(M=B),c._stop(!0),M=M||c.transform.centerPoint;const q=p.pointLocation(y?M.sub(y):M);T&&(p.bearing+=T),A&&(p.pitch+=A),b&&(p.zoom+=b),g?this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?p.center=p.pointLocation(p.centerPoint.sub(y)):p.setLocationAtPoint(q,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,p.setLocationAtPoint(q,M),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,p.recalculateZoom(c.terrain)})):p.setLocationAtPoint(q,M),c._applyUpdatedTransform(p),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,a,!0)}_fireEvents(t,r,a){const c=cs(this._eventsInProgress),p=cs(t),g={};for(const A in t){const{originalEvent:M}=t[A];this._eventsInProgress[A]||(g[`${A}start`]=M),this._eventsInProgress[A]=t[A]}!c&&p&&this._fireEvent("movestart",p.originalEvent);for(const A in g)this._fireEvent(A,g[A]);p&&this._fireEvent("move",p.originalEvent);for(const A in t){const{originalEvent:M}=t[A];this._fireEvent(A,M)}const y={};let b;for(const A in this._eventsInProgress){const{handlerName:M,originalEvent:B}=this._eventsInProgress[A];this._handlersById[M].isActive()||(delete this._eventsInProgress[A],b=r[M]||B,y[`${A}end`]=b)}for(const A in y)this._fireEvent(A,y[A]);const T=cs(this._eventsInProgress);if(a&&(c||p)&&!T){this._updatingCamera=!0;const A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),M=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;A?(M(A.bearing||this._map.getBearing())&&(A.bearing=0),A.freezeElevation=!0,this._map.easeTo(A,{originalEvent:b})):(this._map.fire(new o.Event("moveend",{originalEvent:b})),M(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new o.Event(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Fa("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Wl extends o.Evented{constructor(t,r){super(),this._renderFrameCallback=()=>{const a=Math.min((o.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,a){return t=o.Point.convert(t).mult(-1),this.panTo(this.transform.center,o.extend({offset:t},r),a)}panTo(t,r,a){return this.easeTo(o.extend({center:t},r),a)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,a){return this.easeTo(o.extend({zoom:t},r),a)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,a){return this.easeTo(o.extend({bearing:t},r),a)}resetNorth(t,r){return this.rotateTo(0,o.extend({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=Lt.convert(t);const a=r&&r.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),a,r)}_cameraForBoxAndBearing(t,r,a,c){const p={top:0,bottom:0,right:0,left:0};if(typeof(c=o.extend({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const me=c.padding;c.padding={top:me,bottom:me,right:me,left:me}}c.padding=o.extend(p,c.padding);const g=this.transform,y=g.padding,b=g.project(o.LngLat.convert(t)),T=g.project(o.LngLat.convert(r)),A=b.rotate(-a*Math.PI/180),M=T.rotate(-a*Math.PI/180),B=new o.Point(Math.max(A.x,M.x),Math.max(A.y,M.y)),q=new o.Point(Math.min(A.x,M.x),Math.min(A.y,M.y)),j=B.sub(q),W=(g.width-(y.left+y.right+c.padding.left+c.padding.right))/j.x,N=(g.height-(y.top+y.bottom+c.padding.top+c.padding.bottom))/j.y;if(N<0||W<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const re=Math.min(g.scaleZoom(g.scale*Math.min(W,N)),c.maxZoom),ue=o.Point.convert(c.offset),K=new o.Point((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(a*Math.PI/180),se=ue.add(K).mult(g.scale/g.zoomScale(re));return{center:g.unproject(b.add(T).div(2).sub(se)),zoom:re,bearing:a}}fitBounds(t,r,a){return this._fitInternal(this.cameraForBounds(t,r),r,a)}fitScreenCoordinates(t,r,a,c,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.Point.convert(t)),this.transform.pointLocation(o.Point.convert(r)),a,c),c,p)}_fitInternal(t,r,a){return t?(delete(r=o.extend(t,r)).padding,r.linear?this.easeTo(r,a):this.flyTo(r,a)):this}jumpTo(t,r){this.stop();const a=this._getTransformForUpdate();let c=!1,p=!1,g=!1;return"zoom"in t&&a.zoom!==+t.zoom&&(c=!0,a.zoom=+t.zoom),t.center!==void 0&&(a.center=o.LngLat.convert(t.center)),"bearing"in t&&a.bearing!==+t.bearing&&(p=!0,a.bearing=+t.bearing),"pitch"in t&&a.pitch!==+t.pitch&&(g=!0,a.pitch=+t.pitch),t.padding==null||a.isPaddingEqual(t.padding)||(a.padding=t.padding),this._applyUpdatedTransform(a),this.fire(new o.Event("movestart",r)).fire(new o.Event("move",r)),c&&this.fire(new o.Event("zoomstart",r)).fire(new o.Event("zoom",r)).fire(new o.Event("zoomend",r)),p&&this.fire(new o.Event("rotatestart",r)).fire(new o.Event("rotate",r)).fire(new o.Event("rotateend",r)),g&&this.fire(new o.Event("pitchstart",r)).fire(new o.Event("pitch",r)).fire(new o.Event("pitchend",r)),this.fire(new o.Event("moveend",r))}calculateCameraOptionsFromTo(t,r,a,c=0){const p=o.MercatorCoordinate.fromLngLat(t,r),g=o.MercatorCoordinate.fromLngLat(a,c),y=g.x-p.x,b=g.y-p.y,T=g.z-p.z,A=Math.hypot(y,b,T);if(A===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(y,b),B=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),q=180*Math.atan2(y,-b)/Math.PI;let j=180*Math.acos(M/A)/Math.PI;return j=T<0?90-j:90+j,{center:g.toLngLat(),zoom:B,pitch:j,bearing:q}}easeTo(t,r){this._stop(!1,t.easeId),((t=o.extend({offset:[0,0],duration:500,easing:o.defaultEasing},t)).animate===!1||!t.essential&&o.browser.prefersReducedMotion)&&(t.duration=0);const a=this._getTransformForUpdate(),c=this.getZoom(),p=this.getBearing(),g=this.getPitch(),y=this.getPadding(),b="zoom"in t?+t.zoom:c,T="bearing"in t?this._normalizeBearing(t.bearing,p):p,A="pitch"in t?+t.pitch:g,M="padding"in t?t.padding:a.padding,B=o.Point.convert(t.offset);let q=a.centerPoint.add(B);const j=a.pointLocation(q),W=o.LngLat.convert(t.center||j);this._normalizeCenter(W);const N=a.project(j),re=a.project(W).sub(N),ue=a.zoomScale(b-c);let K,se;t.around&&(K=o.LngLat.convert(t.around),se=a.locationPoint(K));const me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||b!==c,this._rotating=this._rotating||p!==T,this._pitching=this._pitching||A!==g,this._padding=!a.isPaddingEqual(M),this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,me),this.terrain&&this._prepareElevation(W),this._ease(_e=>{if(this._zooming&&(a.zoom=o.interpolate.number(c,b,_e)),this._rotating&&(a.bearing=o.interpolate.number(p,T,_e)),this._pitching&&(a.pitch=o.interpolate.number(g,A,_e)),this._padding&&(a.interpolatePadding(y,M,_e),q=a.centerPoint.add(B)),this.terrain&&!t.freezeElevation&&this._updateElevation(_e),K)a.setLocationAtPoint(K,se);else{const ve=a.zoomScale(a.zoom-c),Ie=b>c?Math.min(2,ue):Math.max(.5,ue),Te=Math.pow(Ie,1-_e),ke=a.unproject(N.add(re.mult(_e*Te)).mult(ve));a.setLocationAtPoint(a.renderWorldCopies?ke.wrap():ke,q)}this._applyUpdatedTransform(a),this._fireMoveEvents(r)},_e=>{this.terrain&&this._finalizeElevation(),this._afterEase(r,_e)},t),this}_prepareEase(t,r,a={}){this._moving=!0,r||a.moving||this.fire(new o.Event("movestart",t)),this._zooming&&!a.zooming&&this.fire(new o.Event("zoomstart",t)),this._rotating&&!a.rotating&&this.fire(new o.Event("rotatestart",t)),this._pitching&&!a.pitching&&this.fire(new o.Event("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&r!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(a-(r-(a*t+this._elevationStart))/(1-t)),this._elevationTarget=r}this.transform.elevation=o.interpolate.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const r=t.clone(),{center:a,zoom:c,pitch:p,bearing:g,elevation:y}=this.transformCameraUpdate(r);a&&(r.center=a),c!==void 0&&(r.zoom=c),p!==void 0&&(r.pitch=p),g!==void 0&&(r.bearing=g),y!==void 0&&(r.elevation=y),this.transform.apply(r)}_fireMoveEvents(t){this.fire(new o.Event("move",t)),this._zooming&&this.fire(new o.Event("zoom",t)),this._rotating&&this.fire(new o.Event("rotate",t)),this._pitching&&this.fire(new o.Event("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const a=this._zooming,c=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new o.Event("zoomend",t)),c&&this.fire(new o.Event("rotateend",t)),p&&this.fire(new o.Event("pitchend",t)),this.fire(new o.Event("moveend",t))}flyTo(t,r){if(!t.essential&&o.browser.prefersReducedMotion){const Ye=o.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ye,r)}this.stop(),t=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.defaultEasing},t);const a=this._getTransformForUpdate(),c=this.getZoom(),p=this.getBearing(),g=this.getPitch(),y=this.getPadding(),b="zoom"in t?o.clamp(+t.zoom,a.minZoom,a.maxZoom):c,T="bearing"in t?this._normalizeBearing(t.bearing,p):p,A="pitch"in t?+t.pitch:g,M="padding"in t?t.padding:a.padding,B=a.zoomScale(b-c),q=o.Point.convert(t.offset);let j=a.centerPoint.add(q);const W=a.pointLocation(j),N=o.LngLat.convert(t.center||W);this._normalizeCenter(N);const re=a.project(W),ue=a.project(N).sub(re);let K=t.curve;const se=Math.max(a.width,a.height),me=se/B,_e=ue.mag();if("minZoom"in t){const Ye=o.clamp(Math.min(t.minZoom,c,b),a.minZoom,a.maxZoom),Ht=se/a.zoomScale(Ye-c);K=Math.sqrt(Ht/_e*2)}const ve=K*K;function Ie(Ye){const Ht=(me*me-se*se+(Ye?-1:1)*ve*ve*_e*_e)/(2*(Ye?me:se)*ve*_e);return Math.log(Math.sqrt(Ht*Ht+1)-Ht)}function Te(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function ke(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const Qe=Ie(!1);let At=function(Ye){return ke(Qe)/ke(Qe+K*Ye)},Ue=function(Ye){return se*((ke(Qe)*(Te(Ht=Qe+K*Ye)/ke(Ht))-Te(Qe))/ve)/_e;var Ht},ut=(Ie(!0)-Qe)/K;if(Math.abs(_e)<1e-6||!isFinite(ut)){if(Math.abs(se-me)<1e-6)return this.easeTo(t,r);const Ye=me<se?-1:1;ut=Math.abs(Math.log(me/se))/K,Ue=function(){return 0},At=function(Ht){return Math.exp(Ye*K*Ht)}}return t.duration="duration"in t?+t.duration:1e3*ut/("screenSpeed"in t?+t.screenSpeed/K:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=p!==T,this._pitching=A!==g,this._padding=!a.isPaddingEqual(M),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(N),this._ease(Ye=>{const Ht=Ye*ut,wt=1/At(Ht);a.zoom=Ye===1?b:c+a.scaleZoom(wt),this._rotating&&(a.bearing=o.interpolate.number(p,T,Ye)),this._pitching&&(a.pitch=o.interpolate.number(g,A,Ye)),this._padding&&(a.interpolatePadding(y,M,Ye),j=a.centerPoint.add(q)),this.terrain&&!t.freezeElevation&&this._updateElevation(Ye);const yt=Ye===1?N:a.unproject(re.add(ue.mult(Ue(Ht))).mult(wt));a.setLocationAtPoint(a.renderWorldCopies?yt.wrap():yt,j),this._applyUpdatedTransform(a),this._fireMoveEvents(r)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(r)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const a=this._onEaseEnd;delete this._onEaseEnd,a.call(this,r)}if(!t){const a=this.handlers;a&&a.stop(!1)}return this}_ease(t,r,a){a.animate===!1||a.duration===0?(t(1),r()):(this._easeStart=o.browser.now(),this._easeOptions=a,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,r){t=o.wrap(t,-180,180);const a=Math.abs(t-r);return Math.abs(t-360-r)<a&&(t-=360),Math.abs(t+360-r)<a&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(!r.renderWorldCopies||r.lngRange)return;const a=t.lng-r.center.lng;t.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(o.LngLat.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class Hl{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=z.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=z.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=z.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,r){const a=this._map._getUIString(`AttributionControl.${r}`);t.title=a,t.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const r=this._map.style.sourceCaches;for(const c in r){const p=r[c];if(p.used||p.usedForTerrain){const g=p.getSource();g.attribution&&t.indexOf(g.attribution)<0&&t.push(g.attribution)}}t=t.filter(c=>String(c).trim()),t.sort((c,p)=>c.length-p.length),t=t.filter((c,p)=>{for(let g=p+1;g<t.length;g++)if(t[g].indexOf(c)>=0)return!1;return!0});const a=t.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class or{constructor(t={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const a=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=z.create("div","maplibregl-ctrl");const r=z.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){z.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class No{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,a=r?this._queue.concat(r):this._queue;for(const c of a)if(c.id===t)return void(c.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const a of r)if(!a.cancelled&&(a.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const nt={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var ct=o.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class jo extends o.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,r){this.sourceCache.update(t,r),this._renderableTilesKeys=[];const a={};for(const c of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r}))a[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),o.ortho(c.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),this._tiles[c.key]=new pn(c,this.tileSize));for(const c in this._tiles)a[c]||delete this._tiles[c]}freeRtt(t){for(const r in this._tiles){const a=this._tiles[r];(!t||a.tileID.equals(t)||a.tileID.isChildOf(t)||t.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const r={};for(const a of this._renderableTilesKeys){const c=this._tiles[a].tileID;if(c.canonical.equals(t.canonical)){const p=t.clone();p.posMatrix=new Float64Array(16),o.ortho(p.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),r[a]=p}else if(c.canonical.isChildOf(t.canonical)){const p=t.clone();p.posMatrix=new Float64Array(16);const g=c.canonical.z-t.canonical.z,y=c.canonical.x-(c.canonical.x>>g<<g),b=c.canonical.y-(c.canonical.y>>g<<g),T=o.EXTENT>>g;o.ortho(p.posMatrix,0,T,0,T,0,1),o.translate(p.posMatrix,p.posMatrix,[-y*T,-b*T,0]),r[a]=p}else if(t.canonical.isChildOf(c.canonical)){const p=t.clone();p.posMatrix=new Float64Array(16);const g=t.canonical.z-c.canonical.z,y=t.canonical.x-(t.canonical.x>>g<<g),b=t.canonical.y-(t.canonical.y>>g<<g),T=o.EXTENT>>g;o.ortho(p.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),o.translate(p.posMatrix,p.posMatrix,[y*T,b*T,0]),o.scale(p.posMatrix,p.posMatrix,[1/2**g,1/2**g,0]),r[a]=p}}return r}getSourceTile(t,r){const a=this.sourceCache._source;let c=t.overscaledZ-this.deltaZoom;if(c>a.maxzoom&&(c=a.maxzoom),c<a.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(c).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!p||!p.dem)&&r)for(;c>=a.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(t.scaledTo(c--).key);return p}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(r=>r.timeAdded>=t)}}class Oa{constructor(t,r,a){this.painter=t,this.sourceCache=new jo(r),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,r,a,c=o.EXTENT){var p;if(!(r>=0&&r<c&&a>=0&&a<c))return 0;const g=this.getTerrainData(t),y=(p=g.tile)===null||p===void 0?void 0:p.dem;if(!y)return 0;const b=function(j,W,N){var re=W[0],ue=W[1];return j[0]=N[0]*re+N[4]*ue+N[12],j[1]=N[1]*re+N[5]*ue+N[13],j}([],[r/c*o.EXTENT,a/c*o.EXTENT],g.u_terrain_matrix),T=[b[0]*y.dim,b[1]*y.dim],A=Math.floor(T[0]),M=Math.floor(T[1]),B=T[0]-A,q=T[1]-M;return y.get(A,M)*(1-B)*(1-q)+y.get(A+1,M)*B*(1-q)+y.get(A,M+1)*(1-B)*q+y.get(A+1,M+1)*B*q}getElevationForLngLatZoom(t,r){const{tileID:a,mercatorX:c,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(t,r);return this.getElevation(a,c%o.EXTENT,p%o.EXTENT,o.EXTENT)}getElevation(t,r,a,c=o.EXTENT){return this.getDEMElevation(t,r,a,c)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const c=this.painter.context,p=new o.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Tt(c,p,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Tt(c,new o.RGBAImage({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.identity([])}const r=this.sourceCache.getSourceTile(t,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const c=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new Tt(c,r.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),r.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const a=r&&r+r.tileID.key+t.key;if(a&&!this._demMatrixCache[a]){const c=this.sourceCache.sourceCache._source.maxzoom;let p=t.canonical.z-r.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=c?p=t.canonical.z-c:o.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const g=t.canonical.x-(t.canonical.x>>p<<p),y=t.canonical.y-(t.canonical.y>>p<<p),b=o.fromScaling(new Float64Array(16),[1/(o.EXTENT<<p),1/(o.EXTENT<<p),0]);o.translate(b,b,[g*o.EXTENT,y*o.EXTENT,0]),this._demMatrixCache[t.key]={matrix:b,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(t){const r=this.painter,a=r.width/devicePixelRatio,c=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Tt(r.context,{width:a,height:c,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Tt(r.context,{width:a,height:c,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(a,c,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,a,c))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,g=0;p<this._coordsTextureSize;p++)for(let y=0;y<this._coordsTextureSize;y++,g+=4)r[g+0]=255&y,r[g+1]=255&p,r[g+2]=y>>8<<4|p>>8,r[g+3]=0;const a=new o.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),c=new Tt(t,a,t.gl.RGBA,{premultiply:!1});return c.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(t){const r=new Uint8Array(4),a=this.painter.context,c=a.gl;a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,r),a.bindFramebuffer.set(null);const p=r[0]+(r[2]>>4<<8),g=r[1]+((15&r[2])<<8),y=this.coordsIndex[255-r[3]],b=y&&this.sourceCache.getTileByID(y);if(!b)return null;const T=this._coordsTextureSize,A=(1<<b.tileID.canonical.z)*T;return new o.MercatorCoordinate((b.tileID.canonical.x*T+p)/A,(b.tileID.canonical.y*T+g)/A,this.getElevation(b.tileID,p,g,T))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,r=new o.Pos3dArray,a=new o.TriangleIndexArray,c=this.meshSize,p=o.EXTENT/c,g=c*c;for(let M=0;M<=c;M++)for(let B=0;B<=c;B++)r.emplaceBack(B*p,M*p,0);for(let M=0;M<g;M+=c+1)for(let B=0;B<c;B++)a.emplaceBack(B+M,c+B+M+1,c+B+M+2),a.emplaceBack(B+M,c+B+M+2,B+M+1);const y=r.length,b=y+2*(c+1);for(const M of[0,1])for(let B=0;B<=c;B++)for(const q of[0,1])r.emplaceBack(B*p,M*o.EXTENT,q);for(let M=0;M<2*c;M+=2)a.emplaceBack(b+M,b+M+1,b+M+3),a.emplaceBack(b+M,b+M+3,b+M+2),a.emplaceBack(y+M,y+M+3,y+M+1),a.emplaceBack(y+M,y+M+2,y+M+3);const T=r.length,A=T+2*(c+1);for(const M of[0,1])for(let B=0;B<=c;B++)for(const q of[0,1])r.emplaceBack(M*o.EXTENT,B*p,q);for(let M=0;M<2*c;M+=2)a.emplaceBack(T+M,T+M+1,T+M+3),a.emplaceBack(T+M,T+M+3,T+M+2),a.emplaceBack(A+M,A+M+3,A+M+1),a.emplaceBack(A+M,A+M+2,A+M+3);return this._mesh={indexBuffer:t.createIndexBuffer(a),vertexBuffer:t.createVertexBuffer(r,ct.members),segments:o.SegmentVector.simpleSegment(0,0,r.length,a.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*o.earthRadius/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,r){var a;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(t,r);return(a=this.getMinMaxElevation(c).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(t){const r=this.getTerrainData(t).tile,a={minElevation:null,maxElevation:null};return r&&r.dem&&(a.minElevation=r.dem.min*this.exaggeration,a.maxElevation=r.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(t,r){const a=o.MercatorCoordinate.fromLngLat(t.wrap()),c=(1<<r)*o.EXTENT,p=a.x*c,g=a.y*c,y=Math.floor(p/o.EXTENT),b=Math.floor(g/o.EXTENT);return{tileID:new o.OverscaledTileID(r,0,r,y,b),mercatorX:p,mercatorY:g}}}class Ua{constructor(t,r,a){this._context=t,this._size=r,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new Tt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(a.texture),{id:t,fbo:r,texture:a,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>t.id!==r),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Ri={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Xl{constructor(t,r){this.painter=t,this.terrain=r,this.pool=new Ua(t.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(a=>!t._layers[a].isHidden(r)),this._coordsDescendingInv={};for(const a in t.sourceCaches){this._coordsDescendingInv[a]={};const c=t.sourceCaches[a].getVisibleCoordinates();for(const p of c){const g=this.terrain.sourceCache.getTerrainCoords(p);for(const y in g)this._coordsDescendingInv[a][y]||(this._coordsDescendingInv[a][y]=[]),this._coordsDescendingInv[a][y].push(g[y])}}this._coordsDescendingInvStr={};for(const a of t._order){const c=t._layers[a],p=c.source;if(Ri[c.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const g in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][g]=this._coordsDescendingInv[p][g].map(y=>y.key).sort().join()}}for(const a of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[c][a.tileID.key];p&&p!==a.rttCoords[c]&&(a.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const r=t.type,a=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Ri[r]&&(this._prevType&&Ri[this._prevType]||this._stacks.push([]),this._prevType=r,this._stacks[this._stacks.length-1].push(t.id),!c))return!0;if(Ri[this._prevType]||Ri[r]&&c){this._prevType=r;const p=this._stacks.length-1,g=this._stacks[p]||[];for(const y of this._renderableTiles){if(this.pool.isFull()&&(Ro(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(y),y.rtt[p]){const T=this.pool.getObjectForId(y.rtt[p].id);if(T.stamp===y.rtt[p].stamp){this.pool.useObject(T);continue}}const b=this.pool.getOrCreateFreeObject();this.pool.useObject(b),this.pool.stampObject(b),y.rtt[p]={id:b.id,stamp:b.stamp},a.context.bindFramebuffer.set(b.fbo.framebuffer),a.context.clear({color:o.Color.transparent,stencil:0}),a.currentStencilSource=void 0;for(let T=0;T<g.length;T++){const A=a.style._layers[g[T]],M=A.source?this._coordsDescendingInv[A.source][y.tileID.key]:[y.tileID];a.context.viewport.set([0,0,b.fbo.width,b.fbo.height]),a._renderTileClippingMasks(A,M),a.renderLayer(a,a.style.sourceCaches[A.source],A,M),A.source&&(y.rttCoords[A.source]=this._coordsDescendingInvStr[A.source][y.tileID.key])}}return Ro(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ri[r]}return!1}}const vr=O,Kc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ms=u=>{u.touchstart=u.dragStart,u.touchmoveWindow=u.dragMove,u.touchend=u.dragEnd},ni={showCompass:!0,showZoom:!0,visualizePitch:!1};class wi{constructor(t,r,a=!1){this.mousedown=g=>{this.startMouse(o.extend({},g,{ctrlKey:!0,preventDefault:()=>g.preventDefault()}),z.mousePos(this.element,g)),z.addEventListener(window,"mousemove",this.mousemove),z.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.moveMouse(g,z.mousePos(this.element,g))},this.mouseup=g=>{this.mouseRotate.dragEnd(g),this.mousePitch&&this.mousePitch.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=z.touchPos(this.element,g.targetTouches)[0],this.startTouch(g,this._startPos),z.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=z.touchPos(this.element,g.targetTouches)[0],this.moveTouch(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=t.dragRotate._mouseRotate.getClickTolerance(),p=t.dragRotate._mousePitch.getClickTolerance();this.element=r,this.mouseRotate=Ze({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:g,clickTolerance:y,bearingDegreesPerPixelMoved:b=.8})=>{const T=new As;return new He({clickTolerance:y,move:(A,M)=>({bearingDelta:(M.x-A.x)*b}),moveStateManager:T,enable:g,assignEvents:Ms})})({clickTolerance:c,enable:!0}),this.map=t,a&&(this.mousePitch=Vo({clickTolerance:p,enable:!0}),this.touchPitch=(({enable:g,clickTolerance:y,pitchDegreesPerPixelMoved:b=-.5})=>{const T=new As;return new He({clickTolerance:y,move:(A,M)=>({pitchDelta:(M.y-A.y)*b}),moveStateManager:T,enable:g,assignEvents:Ms})})({clickTolerance:p,enable:!0})),z.addEventListener(r,"mousedown",this.mousedown),z.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),z.addEventListener(r,"touchcancel",this.reset)}startMouse(t,r){this.mouseRotate.dragStart(t,r),this.mousePitch&&this.mousePitch.dragStart(t,r),z.disableDrag()}startTouch(t,r){this.touchRotate.dragStart(t,r),this.touchPitch&&this.touchPitch.dragStart(t,r),z.disableDrag()}moveMouse(t,r){const a=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(t,r)||{};if(c&&a.setBearing(a.getBearing()+c),this.mousePitch){const{pitchDelta:p}=this.mousePitch.dragMove(t,r)||{};p&&a.setPitch(a.getPitch()+p)}}moveTouch(t,r){const a=this.map,{bearingDelta:c}=this.touchRotate.dragMove(t,r)||{};if(c&&a.setBearing(a.getBearing()+c),this.touchPitch){const{pitchDelta:p}=this.touchPitch.dragMove(t,r)||{};p&&a.setPitch(a.getPitch()+p)}}off(){const t=this.element;z.removeEventListener(t,"mousedown",this.mousedown),z.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.removeEventListener(window,"touchend",this.touchend),z.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){z.enableDrag(),z.removeEventListener(window,"mousemove",this.mousemove),z.removeEventListener(window,"mouseup",this.mouseup),z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.removeEventListener(window,"touchend",this.touchend)}}let Cr;function Cs(u,t,r){if(u=new o.LngLat(u.lng,u.lat),t){const a=new o.LngLat(u.lng-360,u.lat),c=new o.LngLat(u.lng+360,u.lat),p=r.locationPoint(u).distSqr(t);r.locationPoint(a).distSqr(t)<p?u=a:r.locationPoint(c).distSqr(t)<p&&(u=c)}for(;Math.abs(u.lng-r.center.lng)>180;){const a=r.locationPoint(u);if(a.x>=0&&a.y>=0&&a.x<=r.width&&a.y<=r.height)break;u.lng>r.center.lng?u.lng-=360:u.lng+=360}return u}const Ps={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function qo(u,t,r){const a=u.classList;for(const c in Ps)a.remove(`maplibregl-${r}-anchor-${c}`);a.add(`maplibregl-${r}-anchor-${t}`)}class so extends o.Evented{constructor(t){if(super(),this._onKeyPress=r=>{const a=r.code,c=r.charCode||r.keyCode;a!=="Space"&&a!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=r=>{const a=r.originalEvent.target,c=this._element;this._popup&&(a===c||c.contains(a))&&this.togglePopup()},this._update=r=>{if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Cs(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let a="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?a=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(a=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let c="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?c="rotateX(0deg)":this._pitchAlignment==="map"&&(c=`rotateX(${this._map.getPitch()}deg)`),r&&r.type!=="moveend"||(this._pos=this._pos.round()),z.setTransform(this._element,`${Ps[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${c} ${a}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const p=this._map.unproject(this._pos),g=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=p.distanceTo(this._lngLat)>20*g?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=r=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=o.Point.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=z.create("div"),this._element.setAttribute("aria-label","Map marker");const r=z.createNS("http://www.w3.org/2000/svg","svg"),a=41,c=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${a}px`),r.setAttributeNS(null,"width",`${c}px`),r.setAttributeNS(null,"viewBox",`0 0 ${c} ${a}`);const p=z.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const g=z.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"fill-rule","nonzero");const y=z.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(3.0, 29.0)"),y.setAttributeNS(null,"fill","#000000");const b=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of b){const ue=z.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",re.rx),ue.setAttributeNS(null,"ry",re.ry),y.appendChild(ue)}const T=z.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill",this._color);const A=z.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),T.appendChild(A);const M=z.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const B=z.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(B);const q=z.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");const j=z.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(8.0, 8.0)");const W=z.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#000000"),W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962");const N=z.createNS("http://www.w3.org/2000/svg","circle");N.setAttributeNS(null,"fill","#FFFFFF"),N.setAttributeNS(null,"cx","5.5"),N.setAttributeNS(null,"cy","5.5"),N.setAttributeNS(null,"r","5.4999962"),j.appendChild(W),j.appendChild(N),g.appendChild(y),g.appendChild(T),g.appendChild(M),g.appendChild(q),g.appendChild(j),r.appendChild(g),r.setAttributeNS(null,"height",a*this._scale+"px"),r.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(r),this._offset=o.Point.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),qo(this._element,this._anchor,"marker"),t&&t.className)for(const r of t.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),z.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const c=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=o.Point.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Va={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Zr=0,us=!1;const $a={maxWidth:100,unit:"metric"};function Zo(u,t,r){const a=r&&r.maxWidth||100,c=u._container.clientHeight/2,p=u.unproject([0,c]),g=u.unproject([a,c]),y=p.distanceTo(g);if(r&&r.unit==="imperial"){const b=3.2808*y;b>5280?hs(t,a,b/5280,u._getUIString("ScaleControl.Miles")):hs(t,a,b,u._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?hs(t,a,y/1852,u._getUIString("ScaleControl.NauticalMiles")):y>=1e3?hs(t,a,y/1e3,u._getUIString("ScaleControl.Kilometers")):hs(t,a,y,u._getUIString("ScaleControl.Meters"))}function hs(u,t,r,a){const c=function(p){const g=Math.pow(10,`${Math.floor(p)}`.length-1);let y=p/g;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:y>=1?1:function(b){const T=Math.pow(10,Math.ceil(-Math.log(b)/Math.LN10));return Math.round(b*T)/T}(y),g*y}(r);u.style.width=t*(c/r)+"px",u.innerHTML=`${c}&nbsp;${a}`}const Na={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ja=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Go(u){if(u){if(typeof u=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(u,2)));return{center:new o.Point(0,0),top:new o.Point(0,u),"top-left":new o.Point(t,t),"top-right":new o.Point(-t,t),bottom:new o.Point(0,-u),"bottom-left":new o.Point(t,-t),"bottom-right":new o.Point(-t,-t),left:new o.Point(u,0),right:new o.Point(-u,0)}}if(u instanceof o.Point||Array.isArray(u)){const t=o.Point.convert(u);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:o.Point.convert(u.center||[0,0]),top:o.Point.convert(u.top||[0,0]),"top-left":o.Point.convert(u["top-left"]||[0,0]),"top-right":o.Point.convert(u["top-right"]||[0,0]),bottom:o.Point.convert(u.bottom||[0,0]),"bottom-left":o.Point.convert(u["bottom-left"]||[0,0]),"bottom-right":o.Point.convert(u["bottom-right"]||[0,0]),left:o.Point.convert(u.left||[0,0]),right:o.Point.convert(u.right||[0,0])}}return Go(new o.Point(0,0))}const qa={extend:(u,...t)=>o.extend(u,...t),run(u){u()},logToElement(u,t=!1,r="log"){const a=window.document.getElementById(r);a&&(t&&(a.innerHTML=""),a.innerHTML+=`<br>${u}`)}},Wo=O;class Bt{static get version(){return Wo}static get workerCount(){return ki.workerCount}static set workerCount(t){ki.workerCount=t}static get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){o.config.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return o.config.WORKER_URL}static set workerUrl(t){o.config.WORKER_URL=t}static addProtocol(t,r){o.config.REGISTERED_PROTOCOLS[t]=r}static removeProtocol(t){delete o.config.REGISTERED_PROTOCOLS[t]}}return Bt.Map=class extends Wl{constructor(u){if(o.PerformanceUtils.mark(o.PerformanceMarkers.create),(u=o.extend({},Kc,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Oo(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),{bearingSnap:u.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._cooperativeGestures=u.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=u.collectResourceTiming,this._renderTaskQueue=new No,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},nt,u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this.transformCameraUpdate=u.transformCameraUpdate,this._imageQueueHandle=Ne.addThrottleControl(()=>this.isMoving()),this._requestManager=new rt(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;this._resizeObserver=new ResizeObserver(r=>{t?this._trackResize&&this.resize(r)._update():t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Gl(this,u),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=u.hash&&new os(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,o.extend({},u.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new Hl({customAttribution:u.customAttribution})),u.maplibreLogo&&this.addControl(new or,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new o.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new o.Event(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new o.Event("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=u.onAdd(this);this._controls.push(u);const a=this._controlPositions[t];return t.indexOf("bottom")!==-1?a.insertBefore(r,a.firstChild):a.appendChild(r),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}calculateCameraOptionsFromTo(u,t,r,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(u,t,r,a)}resize(u){var t;const r=this._containerDimensions(),a=r[0],c=r[1],p=this._getClampedPixelRatio(a,c);if(this._resizeCanvas(a,c,p),this.painter.resize(a,c,p),this.painter.overLimit()){const y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];const b=this._getClampedPixelRatio(a,c);this._resizeCanvas(a,c,b),this.painter.resize(a,c,b)}this.transform.resize(a,c),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,c);const g=!this._moving;return g&&(this.stop(),this.fire(new o.Event("movestart",u)).fire(new o.Event("move",u))),this.fire(new o.Event("resize",u)),g&&this.fire(new o.Event("moveend",u)),this}_getClampedPixelRatio(u,t){const{0:r,1:a}=this._maxCanvasSize,c=this.getPixelRatio(),p=u*c,g=t*c;return Math.min(p>r?r/p:1,g>a?a/g:1)*c}getPixelRatio(){var u;return(u=this._overridePixelRatio)!==null&&u!==void 0?u:devicePixelRatio}setPixelRatio(u){this._overridePixelRatio=u,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(u){return this.transform.setMaxBounds(Lt.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u&&this.setZoom(u),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u&&this.setZoom(u),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u&&this.setPitch(u),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u&&this.setPitch(u),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(u){return this._cooperativeGestures=u,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(u){return this.transform.locationPoint(o.LngLat.convert(u),this.style&&this.terrain)}unproject(u){return this.transform.pointLocation(o.Point.convert(u),this.terrain)}isMoving(){var u;return this._moving||((u=this.handlers)===null||u===void 0?void 0:u.isMoving())}isZooming(){var u;return this._zooming||((u=this.handlers)===null||u===void 0?void 0:u.isZooming())}isRotating(){var u;return this._rotating||((u=this.handlers)===null||u===void 0?void 0:u.isRotating())}_createDelegatedListener(u,t,r){if(u==="mouseenter"||u==="mouseover"){let a=!1;return{layer:t,listener:r,delegates:{mousemove:p=>{const g=this.getLayer(t)?this.queryRenderedFeatures(p.point,{layers:[t]}):[];g.length?a||(a=!0,r.call(this,new bi(u,this,p.originalEvent,{features:g}))):a=!1},mouseout:()=>{a=!1}}}}if(u==="mouseleave"||u==="mouseout"){let a=!1;return{layer:t,listener:r,delegates:{mousemove:g=>{(this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[]).length?a=!0:a&&(a=!1,r.call(this,new bi(u,this,g.originalEvent)))},mouseout:g=>{a&&(a=!1,r.call(this,new bi(u,this,g.originalEvent)))}}}}{const a=c=>{const p=this.getLayer(t)?this.queryRenderedFeatures(c.point,{layers:[t]}):[];p.length&&(c.features=p,r.call(this,c),delete c.features)};return{layer:t,listener:r,delegates:{[u]:a}}}}on(u,t,r){if(r===void 0)return super.on(u,t);const a=this._createDelegatedListener(u,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(a);for(const c in a.delegates)this.on(c,a.delegates[c]);return this}once(u,t,r){if(r===void 0)return super.once(u,t);const a=this._createDelegatedListener(u,t,r);for(const c in a.delegates)this.once(c,a.delegates[c]);return this}off(u,t,r){return r===void 0?super.off(u,t):(this._delegatedListeners&&this._delegatedListeners[u]&&(a=>{const c=this._delegatedListeners[u];for(let p=0;p<c.length;p++){const g=c[p];if(g.layer===t&&g.listener===r){for(const y in g.delegates)this.off(y,g.delegates[y]);return c.splice(p,1),this}}})(),this)}queryRenderedFeatures(u,t){if(!this.style)return[];let r;const a=u instanceof o.Point||Array.isArray(u),c=a?u:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(a?{}:u)||{},c instanceof o.Point||typeof c[0]=="number")r=[o.Point.convert(c)];else{const p=o.Point.convert(c[0]),g=o.Point.convert(c[1]);r=[p,new o.Point(g.x,p.y),g,new o.Point(p.x,g.y),p]}return this.style.queryRenderedFeatures(r,t,this.transform)}querySourceFeatures(u,t){return this.style.querySourceFeatures(u,t)}setStyle(u,t){return(t=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&u?(this._diffStyle(u,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(u,t))}setTransformRequest(u){return this._requestManager.setTransformRequest(u),this}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(u,t));const r=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!u)),u?(this.style=new nn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u,t,r):this.style.loadJSON(u,t,r),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new nn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,t){if(typeof u=="string"){const r=this._requestManager.transformRequest(u,Pe.Style);o.getJSON(r,(a,c)=>{a?this.fire(new o.ErrorEvent(a)):c&&this._updateDiff(c,t)})}else typeof u=="object"&&this._updateDiff(u,t)}_updateDiff(u,t){try{this.style.setState(u,t)&&this._update(!0)}catch(r){o.warnOnce(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(u,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(u,t){return this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)}isSourceLoaded(u){const t=this.style&&this.style.sourceCaches[u];if(t!==void 0)return t.loaded();this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${u}'`)))}setTerrain(u){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),u){const t=this.style.sourceCaches[u.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${u.source}`);for(const r in this.style._layers){const a=this.style._layers[r];a.type==="hillshade"&&a.source===u.source&&o.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Oa(this.painter,t,u),this.painter.renderToTexture=new Xl(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=r=>{r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==u.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.Event("terrain",{terrain:u})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){const u=this.style&&this.style.sourceCaches;for(const t in u){const r=u[t]._tiles;for(const a in r){const c=r[a];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}addSourceType(u,t,r){return this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,r)}removeSource(u){return this.style.removeSource(u),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,t,r={}){const{pixelRatio:a=1,sdf:c=!1,stretchX:p,stretchY:g,content:y}=r;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||o.isImageBitmap(t))){if(t.width===void 0||t.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:b,height:T,data:A}=t,M=t;return this.style.addImage(u,{data:new o.RGBAImage({width:b,height:T},new Uint8Array(A)),pixelRatio:a,stretchX:p,stretchY:g,content:y,sdf:c,version:0,userImage:M}),M.onAdd&&M.onAdd(this,u),this}}{const{width:b,height:T,data:A}=o.browser.getImageData(t);this.style.addImage(u,{data:new o.RGBAImage({width:b,height:T},A),pixelRatio:a,stretchX:p,stretchY:g,content:y,sdf:c,version:0})}}updateImage(u,t){const r=this.style.getImage(u);if(!r)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=t instanceof HTMLImageElement||o.isImageBitmap(t)?o.browser.getImageData(t):t,{width:c,height:p,data:g}=a;if(c===void 0||p===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==r.data.width||p!==r.data.height)return this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const y=!(t instanceof HTMLImageElement||o.isImageBitmap(t));return r.data.replace(g,y),this.style.updateImage(u,r),this}getImage(u){return this.style.getImage(u)}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,t){Ne.getImage(this._requestManager.transformRequest(u,Pe.Image),t)}listImages(){return this.style.listImages()}addLayer(u,t){return this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)}moveLayer(u,t){return this.style.moveLayer(u,t),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}setLayerZoomRange(u,t,r){return this.style.setLayerZoomRange(u,t,r),this._update(!0)}setFilter(u,t,r={}){return this.style.setFilter(u,t,r),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,t,r,a={}){return this.style.setPaintProperty(u,t,r,a),this._update(!0)}getPaintProperty(u,t){return this.style.getPaintProperty(u,t)}setLayoutProperty(u,t,r,a={}){return this.style.setLayoutProperty(u,t,r,a),this._update(!0)}getLayoutProperty(u,t){return this.style.getLayoutProperty(u,t)}setGlyphs(u,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(u,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(u,t,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(u,t,r,a=>{a||this._update(!0)}),this}removeSprite(u){return this._lazyInitEmptyStyle(),this.style.removeSprite(u),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(u,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(u,t,r=>{r||this._update(!0)}),this}setLight(u,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(u,t){return this.style.setFeatureState(u,t),this._update()}removeFeatureState(u,t){return this.style.removeFeatureState(u,t),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let u=0,t=0;return this._container&&(u=this._container.clientWidth||400,t=this._container.clientHeight||300),[u,t]}_setupContainer(){const u=this._container;u.classList.add("maplibregl-map");const t=this._canvasContainer=z.create("div","maplibregl-canvas-container",u);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=z.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),a=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],a);const c=this._controlContainer=z.create("div","maplibregl-control-container",u),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{p[g]=z.create("div",`maplibregl-ctrl-${g} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=z.create("div","maplibregl-cooperative-gesture-screen",this._container);let u=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(u=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${u}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){z.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(u,t,r){this._canvas.width=Math.floor(r*u),this._canvas.height=Math.floor(r*t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const u={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{t={requestedAttributes:u},a&&(t.statusMessage=a.statusMessage,t.type=a.type)},{once:!0});const r=this._canvas.getContext("webgl2",u)||this._canvas.getContext("webgl",u);if(!r){const a="Failed to initialize WebGL";throw t?(t.message=a,new Error(JSON.stringify(t))):new Error(a)}this.painter=new Dl(r,this.transform),ne.testSupport(r)}_onCooperativeGesture(u,t,r){return!t&&r<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_render(u){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._removed)return;let r=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,p=o.browser.now();this.style.zoomHistory.update(c,p);const g=new o.EvaluationParameters(c,{now:p,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),y=g.crossFadingFactor();y===1&&y===this._crossFadingFactor||(r=!0,this._crossFadingFactor=y),this.style.update(g)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.load),this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||r)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var u;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ne.removeThrottleControl(this._imageQueueHandle),(u=this._resizeObserver)===null||u===void 0||u.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),z.remove(this._canvasContainer),z.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),o.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.browser.frame(u=>{o.PerformanceUtils.frame(u),this._frame=null,this._render(u)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get version(){return vr}getCameraTargetElevation(){return this.transform.elevation}},Bt.NavigationControl=class{constructor(u){this._updateZoomButtons=()=>{const t=this._map.getZoom(),r=t===this._map.getMaxZoom(),a=t===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,r)=>{const a=this._map._getUIString(`NavigationControl.${r}`);t.title=a,t.setAttribute("aria-label",a)},this.options=o.extend({},ni,u),this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),z.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),z.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=z.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wi(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,t){const r=z.create("button",u,this._container);return r.type="button",r.addEventListener("click",t),r}},Bt.GeolocateControl=class extends o.Evented{constructor(u){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.Event("geolocate",t)),this._finish()}},this._updateCamera=t=>{const r=new o.LngLat(t.coords.longitude,t.coords.latitude),a=t.coords.accuracy,c=this._map.getBearing(),p=o.extend({bearing:c},this.options.fitBoundsOptions),g=Lt.fromLngLat(r,a);this._map.fitBounds(g,p,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const r=new o.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&us)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.Event("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=z.create("button","maplibregl-ctrl-geolocate",this._container),z.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new so({element:this._dotElement}),this._circleElement=z.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new so({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}},this.options=o.extend({},Va,u)}onAdd(u){return this._map=u,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,r=!1){Cr===void 0||r?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(a=>{Cr=a.state!=="denied",t(Cr)}).catch(()=>{Cr=!!window.navigator.geolocation,t(Cr)}):(Cr=!!window.navigator.geolocation,t(Cr)):t(Cr)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Zr=0,us=!1}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),r=u.coords;return t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const u=this._map.getBounds(),t=u.getSouthEast(),r=u.getNorthEast(),a=t.distanceTo(r),c=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Zr--,us=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Zr++,Zr>1?(u={maximumAge:6e5,timeout:0},us=!0):(u=this.options.positionOptions,us=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Bt.AttributionControl=Hl,Bt.LogoControl=or,Bt.ScaleControl=class{constructor(u){this._onMove=()=>{Zo(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Zo(this._map,this._container,this.options)},this.options=o.extend({},$a,u)}getDefaultPosition(){return"bottom-left"}onAdd(u){return this._map=u,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Bt.FullscreenControl=class extends o.Evented{constructor(u={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){z.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const u=this._fullscreenButton=z.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);z.create("span","maplibregl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.Event("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new o.Event("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Bt.TerrainControl=class{constructor(u){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=u}onAdd(u){return this._map=u,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=z.create("button","maplibregl-ctrl-terrain",this._container),z.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){z.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Bt.Popup=class extends o.Evented{constructor(u){super(),this.remove=()=>(this._content&&z.remove(this._content),this._container&&(z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=z.create("div","maplibregl-popup",this._map.getContainer()),this._tip=z.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const g of this.options.className.split(" "))this._container.classList.add(g);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Cs(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const r=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let a=this.options.anchor;const c=Go(this.options.offset);if(!a){const g=this._container.offsetWidth,y=this._container.offsetHeight;let b;b=r.y+c.bottom.y<y?["top"]:r.y>this._map.transform.height-y?["bottom"]:[],r.x<g/2?b.push("left"):r.x>this._map.transform.width-g/2&&b.push("right"),a=b.length===0?"bottom":b.join("-")}const p=r.add(c[a]).round();z.setTransform(this._container,`${Ps[a]} translate(${p.x}px,${p.y}px)`),qo(this._container,a,"popup")},this._onClose=()=>{this.remove()},this.options=o.extend(Object.create(Na),u)}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=o.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),r=document.createElement("body");let a;for(r.innerHTML=u;a=r.firstChild,a;)t.appendChild(a);return this.setDOMContent(t)}getMaxWidth(){var u;return(u=this._container)===null||u===void 0?void 0:u.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=z.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){this._container&&this._container.classList.add(u)}removeClassName(u){this._container&&this._container.classList.remove(u)}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){if(this._container)return this._container.classList.toggle(u)}_createCloseButton(){this.options.closeButton&&(this._closeButton=z.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(ja);u&&u.focus()}},Bt.Marker=so,Bt.Style=nn,Bt.LngLat=o.LngLat,Bt.LngLatBounds=Lt,Bt.Point=o.Point,Bt.MercatorCoordinate=o.MercatorCoordinate,Bt.Evented=o.Evented,Bt.AJAXError=o.AJAXError,Bt.config=o.config,Bt.CanvasSource=ye,Bt.GeoJSONSource=Gn,Bt.ImageSource=hn,Bt.RasterDEMTileSource=gr,Bt.RasterTileSource=un,Bt.VectorTileSource=Sr,Bt.VideoSource=Wn,Bt.setRTLTextPlugin=o.setRTLTextPlugin,Bt.getRTLTextPluginStatus=o.getRTLTextPluginStatus,Bt.prewarm=function(){Dn().acquire(ze)},Bt.clearPrewarmedResources=function(){const u=zi;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(ze),zi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},qa.extend(Bt,{isSafari:o.isSafari,getPerformanceMetrics:o.PerformanceUtils.getPerformanceMetrics}),Bt});var k=D;return k})})(gd);var yd=gd.exports;const fr=Km(yd);const mr="/maplibre-gl-directions/assets/style-7d708b4d.json";var Jm=Object.defineProperty,Qm=(_,f,v)=>f in _?Jm(_,f,{enumerable:!0,configurable:!0,writable:!0,value:v}):_[f]=v,xt=(_,f,v)=>(Qm(_,typeof f!="symbol"?f+"":f,v),v);class eg{constructor(f){xt(this,"map"),xt(this,"listeners",{}),xt(this,"oneTimeListeners",{}),this.map=f}fire(f){var v,E;f.target=this.map,(v=this.listeners[f.type])==null||v.forEach(D=>D(f)),(E=this.oneTimeListeners[f.type])==null||E.forEach(D=>{var S,k;D(f);const o=(S=this.oneTimeListeners[f.type])==null?void 0:S.indexOf(D);o&&~o&&((k=this.oneTimeListeners[f.type])==null||k.splice(o,1))})}on(f,v){(this.listeners[f]=this.listeners[f]??[]).push(v)}off(f,v){var E,D;const S=(E=this.listeners[f])==null?void 0:E.indexOf(v);~S&&((D=this.listeners[f])==null||D.splice(S,1))}once(f,v){(this.oneTimeListeners[f]=this.oneTimeListeners[f]??[]).push(v)}}class uo{constructor(f,v,E){xt(this,"type"),xt(this,"target"),xt(this,"originalEvent"),xt(this,"data"),this.type=f,this.originalEvent=v,this.data=E}}class Gp{constructor(f,v,E){xt(this,"type"),xt(this,"target"),xt(this,"originalEvent"),xt(this,"data"),this.type=f,this.originalEvent=v,this.data=E}}const tg={api:"https://router.project-osrm.org/route/v1",profile:"driving",requestOptions:{},requestTimeout:null,makePostRequest:!1,sourceName:"maplibre-gl-directions",pointsScalingFactor:1,linesScalingFactor:1,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint","maplibre-gl-directions-waypoint-casing"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint","maplibre-gl-directions-snappoint-casing"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline","maplibre-gl-directions-routeline-casing"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline","maplibre-gl-directions-alt-routeline-casing"],dragThreshold:10,refreshOnMove:!1,bearings:!1};function Pc(_=1,f=1,v="maplibre-gl-directions"){return[{id:`${v}-snapline`,type:"line",source:v,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":"#34343f","line-opacity":.65,"line-width":3},filter:["==",["get","type"],"SNAPLINE"]},{id:`${v}-alt-routeline-casing`,type:"line",source:v,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#9e91be","line-opacity":.55,"line-width":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],10*f,7*f],5,["case",["boolean",["get","highlight"],!1],10*f,7*f],18,["case",["boolean",["get","highlight"],!1],32*f,23*f]]},filter:["==",["get","route"],"ALT"]},{id:`${v}-alt-routeline`,type:"line",source:v,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#9e91be","line-opacity":.85,"line-width":["interpolate",["exponential",1.5],["zoom"],0,3*f,5,3*f,18,10*f]},filter:["==",["get","route"],"ALT"]},{id:`${v}-routeline-casing`,type:"line",source:v,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":["interpolate-hcl",["linear"],["get","congestion"],0,"#7b51f8",1,"#42c74c",100,"#d72359"],"line-opacity":.55,"line-width":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],10*f,7*f],5,["case",["boolean",["get","highlight"],!1],10*f,7*f],18,["case",["boolean",["get","highlight"],!1],32*f,23*f]]},filter:["==",["get","route"],"SELECTED"]},{id:`${v}-routeline`,type:"line",source:v,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":["interpolate-hcl",["linear"],["get","congestion"],0,"#7b51f8",1,"#42c74c",100,"#d72359"],"line-opacity":.85,"line-width":["interpolate",["exponential",1.5],["zoom"],0,3*f,5,3*f,18,10*f]},filter:["==",["get","route"],"SELECTED"]},{id:`${v}-hoverpoint-casing`,type:"circle",source:v,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,14*_,5,14*_,18,33*_],"circle-color":"#30a856","circle-opacity":.65},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${v}-hoverpoint`,type:"circle",source:v,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,9*_,5,9*_,18,21*_],"circle-color":"#30a856"},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${v}-snappoint-casing`,type:"circle",source:v,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],14*_,12*_],5,["case",["boolean",["get","highlight"],!1],14*_,12*_],18,["case",["boolean",["get","highlight"],!1],33*_,28*_]],"circle-color":["case",["boolean",["get","highlight"],!1],"#e50d3f","#cb3373"],"circle-opacity":.65},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${v}-snappoint`,type:"circle",source:v,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],9*_,7*_],5,["case",["boolean",["get","highlight"],!1],9*_,7*_],18,["case",["boolean",["get","highlight"],!1],21*_,16*_]],"circle-color":["case",["boolean",["get","highlight"],!1],"#e50d3f","#cb3373"]},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${v}-waypoint-casing`,type:"circle",source:v,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],14*_,12*_],5,["case",["boolean",["get","highlight"],!1],14*_,12*_],18,["case",["boolean",["get","highlight"],!1],33*_,28*_]],"circle-color":["case",["boolean",["get","highlight"],!1],"#6d26d7","#7b33e7"],"circle-opacity":.65},filter:["==",["get","type"],"WAYPOINT"]},{id:`${v}-waypoint`,type:"circle",source:v,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],9*_,7*_],5,["case",["boolean",["get","highlight"],!1],9*_,7*_],18,["case",["boolean",["get","highlight"],!1],21*_,16*_]],"circle-color":["case",["boolean",["get","highlight"],!1],"#6d26d7","#7b33e7"]},filter:["==",["get","type"],"WAYPOINT"]}]}let xd=(_=21)=>crypto.getRandomValues(new Uint8Array(_)).reduce((f,v)=>(v&=63,v<36?f+=v.toString(36):v<62?f+=(v-26).toString(36).toUpperCase():v>62?f+="-":f+="_",f),"");var vd={exports:{}};(function(_){var f={};function v(S){return Math.floor(Math.abs(S)+.5)*(S>=0?1:-1)}function E(S,k,o){S=v(S*o),k=v(k*o);var O=(S-k)*2;O<0&&(O=-O-1);for(var z="";O>=32;)z+=String.fromCharCode((32|O&31)+63),O/=32;return z+=String.fromCharCode((O|0)+63),z}f.decode=function(S,k){for(var o=0,O=0,z=0,ne=[],H=0,ce=0,ge=null,xe,Ce,Ne=Math.pow(10,Number.isInteger(k)?k:5);o<S.length;){ge=null,H=1,ce=0;do ge=S.charCodeAt(o++)-63,ce+=(ge&31)*H,H*=32;while(ge>=32);xe=ce&1?(-ce-1)/2:ce/2,H=1,ce=0;do ge=S.charCodeAt(o++)-63,ce+=(ge&31)*H,H*=32;while(ge>=32);Ce=ce&1?(-ce-1)/2:ce/2,O+=xe,z+=Ce,ne.push([O/Ne,z/Ne])}return ne},f.encode=function(S,k){if(!S.length)return"";for(var o=Math.pow(10,Number.isInteger(k)?k:5),O=E(S[0][0],0,o)+E(S[0][1],0,o),z=1;z<S.length;z++){var ne=S[z],H=S[z-1];O+=E(ne[0],H[0],o),O+=E(ne[1],H[1],o)}return O};function D(S){for(var k=[],o=0;o<S.length;o++){var O=S[o].slice();k.push([O[1],O[0]])}return k}f.fromGeoJSON=function(S,k){if(S&&S.type==="Feature"&&(S=S.geometry),!S||S.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return f.encode(D(S.coordinates),k)},f.toGeoJSON=function(S,k){var o=f.decode(S,k);return{type:"LineString",coordinates:D(o)}},_.exports&&(_.exports=f)})(vd);var Wp=vd.exports;function ig(_,f){return _.geometries==="geojson"?f.coordinates:_.geometries==="polyline6"?Wp.decode(f,6).map(v=>v.reverse()):Wp.decode(f,5).map(v=>v.reverse())}function ng(_,f,v){var E,D,S,k;if((E=_.annotations)!=null&&E.includes("congestion_numeric"))return((D=f==null?void 0:f.congestion_numeric)==null?void 0:D[v])??0;if((S=_.annotations)!=null&&S.includes("congestion"))switch(((k=f==null?void 0:f.congestion)==null?void 0:k[v])??""){case"unknown":return 0;case"low":return 1;case"moderate":return 34;case"heavy":return 77;case"severe":return 100;default:return 0}else return 0}function rg(_,f,v){return!_.geometries||_.geometries==="polyline"?Math.abs(f[0]-v[0])<=1e-5&&Math.abs(f[1]-v[1])<=1e-5:f[0]===v[0]&&f[1]===v[1]}function bd(_){const f=Pc(_==null?void 0:_.pointsScalingFactor,_==null?void 0:_.linesScalingFactor,_==null?void 0:_.sourceName);return Object.assign({},tg,{layers:f},_)}function wd(_,f,v){const E=_.makePostRequest?"post":"get";let D,S;if(E==="get")D=`${_.api}/${_.profile}/${f.join(";")}`,S=new URLSearchParams(_.requestOptions);else{D=`${_.api}/${_.profile}${_.requestOptions.access_token?`?access_token=${_.requestOptions.access_token}`:""}`;const k=new FormData;Object.entries(_.requestOptions).forEach(([o,O])=>{o!=="access_token"&&k.set(o,O)}),k.set("coordinates",f.join(";")),S=new URLSearchParams(k)}return _.bearings&&S.set("bearings",v.map(k=>k?`${k[0]},${k[1]}`:"").join(";")),{method:E,url:D,payload:S}}function Td(_,f,v){return{type:"Feature",geometry:{type:"Point",coordinates:_},properties:{type:f,id:xd(),...v??{}}}}function Sd(_,f,v,E,D=!1){if(_.length!==f.length)return[];const S=_.map((k,o)=>({type:"Feature",geometry:{type:"LineString",coordinates:[[k[0],k[1]],[f[o][0],f[o][1]]]},properties:{type:"SNAPLINE"}}));return~E&&v!==void 0&&D&&(S.push({type:"Feature",geometry:{type:"LineString",coordinates:[[v[0],v[1]],[f[E][0],f[E][1]]]},properties:{type:"SNAPLINE"}}),S.push({type:"Feature",geometry:{type:"LineString",coordinates:[[v[0],v[1]],[f[E+1][0],f[E+1][1]]]},properties:{type:"SNAPLINE"}})),S}function Ed(_,f,v,E){return f.map((D,S)=>{const k=ig(_,D.geometry),o=E.map(H=>H.geometry.coordinates).map(H=>k.findIndex(ce=>rg(_,ce,H))).slice(1);let O=0;const z=o.map(H=>k.slice(O,O=H+1)),ne=[];return z.forEach((H,ce)=>{const ge=xd();H.forEach((xe,Ce)=>{var Ne,Pe,rt;const De=ne[ne.length-1],je=ng(_,(Ne=D.legs[ce])==null?void 0:Ne.annotation,Ce);if(ce===((Pe=De==null?void 0:De.properties)==null?void 0:Pe.legIndex)&&((rt=De.properties)==null?void 0:rt.congestion)===je)De.geometry.coordinates.push(xe);else{const it=E[ce].properties??{},Le=E[ce+1].properties??{},Ke={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{id:ge,routeIndex:S,route:S===v?"SELECTED":"ALT",legIndex:ce,congestion:je,departSnappointProperties:it,arriveSnappointProperties:Le}};De&&Ke.geometry.coordinates.push(De.geometry.coordinates[De.geometry.coordinates.length-1]),Ke.geometry.coordinates.push(xe),ne.push(Ke)}})}),ne})}const sg=Object.freeze(Object.defineProperty({__proto__:null,buildConfiguration:bd,buildPoint:Td,buildRequest:wd,buildRoutelines:Ed,buildSnaplines:Sd},Symbol.toStringTag,{value:"Module"}));class er extends eg{constructor(f,v){super(f),xt(this,"configuration"),xt(this,"_interactive",!1),xt(this,"buildRequest",wd),xt(this,"buildPoint",Td),xt(this,"buildSnaplines",Sd),xt(this,"buildRoutelines",Ed),xt(this,"onMoveHandler"),xt(this,"onDragDownHandler"),xt(this,"onDragMoveHandler"),xt(this,"onDragUpHandler"),xt(this,"onClickHandler"),xt(this,"liveRefreshHandler"),xt(this,"_waypoints",[]),xt(this,"snappoints",[]),xt(this,"routelines",[]),xt(this,"selectedRouteIndex",0),xt(this,"hoverpoint"),xt(this,"highlightedWaypoints",[]),xt(this,"highlightedSnappoints",[]),xt(this,"dragDownPosition",{x:0,y:0}),xt(this,"waypointBeingDragged"),xt(this,"waypointBeingDraggedInitialCoordinates"),xt(this,"departSnappointIndex",-1),xt(this,"currentMousePosition",{x:0,y:0}),xt(this,"refreshOnMoveIsRefreshing",!1),xt(this,"noMouseMovementTimer"),xt(this,"lastRequestMousePosition",{x:0,y:0}),xt(this,"abortController"),this.map=f,this.configuration=bd(v),this.onMoveHandler=this.onMove.bind(this),this.onDragDownHandler=this.onDragDown.bind(this),this.onDragMoveHandler=this.onDragMove.bind(this),this.onDragUpHandler=this.onDragUp.bind(this),this.onClickHandler=this.onClick.bind(this),this.liveRefreshHandler=this.liveRefresh.bind(this),this.init()}get waypointsCoordinates(){return this._waypoints.map(f=>[f.geometry.coordinates[0],f.geometry.coordinates[1]])}get snappointsCoordinates(){return this.snappoints.map(f=>[f.geometry.coordinates[0],f.geometry.coordinates[1]])}get snaplines(){var f,v,E;return this.buildSnaplines(this.waypointsCoordinates,this.snappointsCoordinates,(f=this.hoverpoint)==null?void 0:f.geometry.coordinates,this.departSnappointIndex,(E=(v=this.hoverpoint)==null?void 0:v.properties)==null?void 0:E.showSnaplines)}init(){this.map.addSource(this.configuration.sourceName,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.configuration.layers.forEach(f=>{this.map.addLayer(f)})}async fetchDirections(f){var v,E;(v=this.abortController)==null||v.abort();const D=this.interactive;if(this._waypoints.length>=2){this.fire(new Gp("fetchroutesstart",f)),this.abortController=new AbortController;const S=this.abortController.signal;S.onabort=()=>{this.interactive=D},this.interactive=!1;let k;this.configuration.requestTimeout!==null&&(k=setTimeout(()=>{var H;return(H=this.abortController)==null?void 0:H.abort()},this.configuration.requestTimeout));const{method:o,url:O,payload:z}=this.buildRequest(this.configuration,this.waypointsCoordinates,this.configuration.bearings?this.waypointsBearings:void 0);let ne;try{if(o==="get"?ne=await(await fetch(`${O}?${z}`,{signal:this.abortController.signal})).json():ne=await(await fetch(`${O}`,{signal:this.abortController.signal,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:z})).json(),ne.code!=="Ok")throw new Error(ne.message??"An unexpected error occurred.")}finally{((E=this.abortController)==null?void 0:E.signal.reason)!=="DESTROY"&&(this.interactive=D),this.abortController=void 0,clearTimeout(k),this.fire(new Gp("fetchroutesend",f,ne))}this.snappoints=ne.waypoints.map((H,ce)=>{var ge;return this.buildPoint(H.location,"SNAPPOINT",{waypointProperties:((ge=this._waypoints[ce])==null?void 0:ge.properties)??{}})}),this.routelines=this.buildRoutelines(this.configuration.requestOptions,ne.routes,this.selectedRouteIndex,this.snappoints),ne.routes.length<=this.selectedRouteIndex&&(this.selectedRouteIndex=0)}else this.snappoints=[],this.routelines=[];this.draw(!1)}draw(f=!0){const v=[...this._waypoints,...this.snappoints,...this.snaplines,...this.routelines.reduce((D,S)=>f?D.concat(...S):D.concat(...S.map(k=>(k.properties&&(k.properties.route=k.properties.routeIndex===this.selectedRouteIndex?"SELECTED":"ALT"),k))),[])];this.hoverpoint&&v.push(this.hoverpoint);const E={type:"FeatureCollection",features:v};this.map.getSource(this.configuration.sourceName)&&this.map.getSource(this.configuration.sourceName).setData(E)}deHighlight(){this.highlightedWaypoints.forEach(f=>{f!=null&&f.properties&&(f.properties.highlight=!1)}),this.highlightedSnappoints.forEach(f=>{f!=null&&f.properties&&(f.properties.highlight=!1)}),this.routelines.forEach(f=>{f.forEach(v=>{v.properties&&(v.properties.highlight=!1)})})}onMove(f){var v,E,D,S;const k=this.map.queryRenderedFeatures(f.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveRoutelineLayers,...this.configuration.sensitiveAltRoutelineLayers]})[0];if(this.deHighlight(),this.configuration.sensitiveWaypointLayers.includes((k==null?void 0:k.layer.id)??"")){this.map.getCanvas().style.cursor="pointer",this.map.dragPan.disable();const o=this._waypoints.findIndex(O=>{var z,ne;return((z=O.properties)==null?void 0:z.id)===((ne=k==null?void 0:k.properties)==null?void 0:ne.id)});this.highlightedWaypoints=[this._waypoints[o]],this.highlightedSnappoints=[this.snappoints[o]],(v=this.highlightedWaypoints[0])!=null&&v.properties&&(this.highlightedWaypoints[0].properties.highlight=!0),(E=this.highlightedSnappoints[0])!=null&&E.properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else if(this.configuration.sensitiveSnappointLayers.includes((k==null?void 0:k.layer.id)??"")){this.map.getCanvas().style.cursor="pointer";const o=this.snappoints.findIndex(O=>{var z,ne;return((z=O.properties)==null?void 0:z.id)===((ne=k==null?void 0:k.properties)==null?void 0:ne.id)});this.highlightedSnappoints=[this.snappoints[o]],this.highlightedWaypoints=[this._waypoints[o]],this.highlightedSnappoints[0].properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.highlightedWaypoints[0].properties&&(this.highlightedWaypoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else this.configuration.sensitiveRoutelineLayers.includes((k==null?void 0:k.layer.id)??"")?(this.map.getCanvas().style.cursor="pointer",this.map.dragPan.disable(),this.hoverpoint?this.hoverpoint.geometry.coordinates=[f.lngLat.lng,f.lngLat.lat]:this.hoverpoint=this.buildPoint([f.lngLat.lng,f.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse(((D=k==null?void 0:k.properties)==null?void 0:D.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse(((S=k==null?void 0:k.properties)==null?void 0:S.arriveSnappointProperties)??"{}")}}),this.routelines.forEach(o=>{o.forEach(O=>{var z,ne;O.properties&&((z=O.properties)==null?void 0:z.id)===((ne=k==null?void 0:k.properties)==null?void 0:ne.id)&&(O.properties.highlight=!0)})})):this.configuration.sensitiveAltRoutelineLayers.includes((k==null?void 0:k.layer.id)??"")?(this.map.getCanvas().style.cursor="pointer",this.routelines.forEach(o=>{o.forEach(O=>{var z,ne;O.properties&&((z=O.properties)==null?void 0:z.id)===((ne=k==null?void 0:k.properties)==null?void 0:ne.id)&&(O.properties.highlight=!0)})}),this.hoverpoint&&(this.hoverpoint=void 0)):(this.map.dragPan.enable(),this.map.getCanvas().style.cursor="",this.hoverpoint=void 0);this.draw()}onDragDown(f){var v,E,D,S,k,o;if(f.type==="touchstart"&&f.originalEvent.touches.length!==1||f.type==="mousedown"&&f.originalEvent.which!==1)return;const O=this.map.queryRenderedFeatures(f.point);if(O.length&&O[0].source===this.configuration.sourceName){const z=O.filter(ne=>this.configuration.sensitiveWaypointLayers.includes((ne==null?void 0:ne.layer.id)??"")||this.configuration.sensitiveSnappointLayers.includes((ne==null?void 0:ne.layer.id)??"")||this.configuration.sensitiveRoutelineLayers.includes((ne==null?void 0:ne.layer.id)??""))[0];if(this.dragDownPosition=f.point,this.currentMousePosition=f.point,this.configuration.sensitiveWaypointLayers.includes((z==null?void 0:z.layer.id)??""))this.waypointBeingDragged=this._waypoints.find(ne=>{var H,ce;return((H=ne.properties)==null?void 0:H.id)===((ce=z==null?void 0:z.properties)==null?void 0:ce.id)}),this.waypointBeingDraggedInitialCoordinates=(v=this.waypointBeingDragged)==null?void 0:v.geometry.coordinates;else if(this.configuration.sensitiveRoutelineLayers.includes((z==null?void 0:z.layer.id)??"")){if(this.departSnappointIndex=JSON.parse((E=z==null?void 0:z.properties)==null?void 0:E.legIndex),this.hoverpoint)if(this.configuration.refreshOnMove){const ne=this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0;this._addWaypoint([f.lngLat.lng,f.lngLat.lat],ne,f),this.waypointBeingDragged=this._waypoints[ne],this.hoverpoint=void 0}else this.hoverpoint.geometry.coordinates=[f.lngLat.lng,f.lngLat.lat];else this.hoverpoint=this.buildPoint([f.lngLat.lng,f.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse(((D=z==null?void 0:z.properties)==null?void 0:D.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse(((S=z==null?void 0:z.properties)==null?void 0:S.arriveSnappointProperties)??"{}")}});(k=this.hoverpoint)!=null&&k.properties&&(this.hoverpoint.properties.showSnaplines=!0),~this.departSnappointIndex&&(o=this.snappoints[this.departSnappointIndex])!=null&&o.properties&&(this.snappoints[this.departSnappointIndex].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex]),this.snappoints[this.departSnappointIndex+1].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex+1]))}this.map.off("touchstart",this.onMoveHandler),this.map.off("mousemove",this.onMoveHandler),f.type==="touchstart"?(this.map.on("touchmove",this.onDragMoveHandler),this.map.on("touchend",this.onDragUpHandler)):f.type==="mousedown"&&(this.map.on("mousemove",this.onDragMoveHandler),this.map.on("mouseup",this.onDragUpHandler)),this.draw()}}onDragMove(f){if(this.configuration.refreshOnMove&&(clearTimeout(this.noMouseMovementTimer),this.noMouseMovementTimer=setTimeout(this.liveRefreshHandler,300,f)),f.type==="touchmove"&&f.originalEvent.touches.length!==1)return f.originalEvent.preventDefault();f.type==="mousemove"&&f.originalEvent.which!==1||(this.waypointBeingDragged?this.waypointBeingDragged.geometry.coordinates=[f.lngLat.lng,f.lngLat.lat]:this.hoverpoint&&(this.hoverpoint.geometry.coordinates=[f.lngLat.lng,f.lngLat.lat]),this.currentMousePosition=f.point,this.draw(),this.configuration.refreshOnMove&&!this.refreshOnMoveIsRefreshing&&this.liveRefreshHandler(f))}async onDragUp(f){var v,E,D;if(this.configuration.refreshOnMove&&clearTimeout(this.noMouseMovementTimer),!(f.type==="mouseup"&&f.originalEvent.which!==1)){if((v=this.hoverpoint)!=null&&v.properties&&(this.hoverpoint.properties.showSnaplines=!1),Math.abs(f.point.x-((E=this.dragDownPosition)==null?void 0:E.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(f.point.y-((D=this.dragDownPosition)==null?void 0:D.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0))if(this.waypointBeingDragged){this.waypointBeingDragged.geometry.coordinates=[f.lngLat.lng,f.lngLat.lat];const S=new uo("movewaypoint",f,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(S);try{await this.fetchDirections(S)}catch(k){k instanceof DOMException&&k.name=="AbortError"||this.waypointBeingDraggedInitialCoordinates&&(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates)}this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0}else this.hoverpoint&&(this._addWaypoint([f.lngLat.lng,f.lngLat.lat],this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0,f),this.hoverpoint=void 0);else this.waypointBeingDragged&&this.waypointBeingDraggedInitialCoordinates?(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates,this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0):this.hoverpoint&&(this.hoverpoint=void 0);this.deHighlight(),f.type==="touchend"?(this.map.off("touchmove",this.onDragMoveHandler),this.map.off("touchend",this.onDragUpHandler)):f.type==="mouseup"&&(this.map.off("mousemove",this.onDragMoveHandler),this.map.off("mouseup",this.onDragUpHandler)),this.map.on("touchstart",this.onMoveHandler),this.map.on("mousemove",this.onMoveHandler),this.map.dragPan.enable(),this.draw()}}async liveRefresh(f){var v,E,D,S;if(Math.abs(((v=this.lastRequestMousePosition)==null?void 0:v.x)-((E=this.currentMousePosition)==null?void 0:E.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(((D=this.lastRequestMousePosition)==null?void 0:D.y)-((S=this.currentMousePosition)==null?void 0:S.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)){if(this.refreshOnMoveIsRefreshing=!0,this.lastRequestMousePosition=this.currentMousePosition,this.waypointBeingDragged){const k=new uo("movewaypoint",f,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(k);try{await this.fetchDirections(k)}catch{}}this.refreshOnMoveIsRefreshing=!1}}onClick(f){const v=this.map.queryRenderedFeatures(f.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveAltRoutelineLayers,...this.configuration.sensitiveRoutelineLayers]})[0];if(this.configuration.sensitiveWaypointLayers.includes((v==null?void 0:v.layer.id)??"")){const E=this._waypoints.findIndex(D=>{var S,k;return((S=D.properties)==null?void 0:S.id)===((k=v==null?void 0:v.properties)==null?void 0:k.id)});~E&&this._removeWaypoint(E,f)}else if(this.configuration.sensitiveSnappointLayers.includes((v==null?void 0:v.layer.id)??"")){const E=this.snappoints.findIndex(D=>{var S,k;return((S=D.properties)==null?void 0:S.id)===((k=v==null?void 0:v.properties)==null?void 0:k.id)});~E&&this._removeWaypoint(E,f)}else this.configuration.sensitiveAltRoutelineLayers.includes((v==null?void 0:v.layer.id)??"")?this.selectedRouteIndex=this.routelines.findIndex(E=>!!E.find(D=>{var S,k;return((S=D.properties)==null?void 0:S.id)===((k=v==null?void 0:v.properties)==null?void 0:k.id)})):this.configuration.sensitiveRoutelineLayers.includes((v==null?void 0:v.layer.id)??"")||this._addWaypoint([f.lngLat.lng,f.lngLat.lat],void 0,f);this.draw(!1)}assignWaypointsCategories(){this._waypoints.forEach((f,v)=>{const E=v===0?"ORIGIN":v===this._waypoints.length-1?"DESTINATION":void 0;f.properties&&(f.properties.index=v,f.properties.category=E)})}async _addWaypoint(f,v,E){var D;(D=this.abortController)==null||D.abort(),v=v??this._waypoints.length,this._waypoints.splice(v,0,this.buildPoint(f,"WAYPOINT",this.configuration.bearings?{bearing:void 0}:void 0)),this.assignWaypointsCategories();const S=new uo("addwaypoint",E,{index:v});this.fire(S),this.draw();try{await this.fetchDirections(S)}catch{}}async _removeWaypoint(f,v){var E;(E=this.abortController)==null||E.abort(),this._waypoints.splice(f,1),this.snappoints.splice(f,1),this.assignWaypointsCategories();const D=new uo("removewaypoint",v,{index:f});this.fire(D),this.draw();try{await this.fetchDirections(D)}catch{}}get interactive(){return this._interactive}set interactive(f){this._interactive=f,f?(this.map.on("touchstart",this.onMoveHandler),this.map.on("touchstart",this.onDragDownHandler),this.map.on("mousemove",this.onMoveHandler),this.map.on("mousedown",this.onDragDownHandler),this.map.on("click",this.onClickHandler)):(this.map.off("touchstart",this.onMoveHandler),this.map.off("touchstart",this.onDragDownHandler),this.map.off("mousemove",this.onMoveHandler),this.map.off("mousedown",this.onDragDownHandler),this.map.off("click",this.onClickHandler))}get waypoints(){return this.waypointsCoordinates}set waypoints(f){this.setWaypoints(f)}get waypointsBearings(){return this.configuration.bearings?this._waypoints.map(f=>Array.isArray(f.properties.bearing)?[f.properties.bearing[0],f.properties.bearing[1]]:void 0):(console.warn("The `waypointsBearings` getter was referred to, but the `bearings` configuration option is not enabled!"),[])}set waypointsBearings(f){if(!this.configuration.bearings){console.warn("The `waypointsBearings` setter was referred to, but the `bearings` configuration option is not enabled!");return}this._waypoints.forEach((E,D)=>{E.properties.bearing=f[D]});const v=new uo("rotatewaypoints",void 0);this.fire(v),this.draw();try{this.fetchDirections(v)}catch{}}async setWaypoints(f){var v;(v=this.abortController)==null||v.abort(),this._waypoints=f.map((D,S)=>this.buildPoint(D,"WAYPOINT",this.configuration.bearings?{bearing:this.waypointsBearings[S]}:void 0)),this.assignWaypointsCategories();const E=new uo("setwaypoints",void 0);this.fire(E),this.draw();try{await this.fetchDirections(E)}catch{}}async addWaypoint(f,v){await this._addWaypoint(f,v)}async removeWaypoint(f){await this._removeWaypoint(f)}clear(){this.setWaypoints([]),this.routelines=[]}destroy(){var f;(f=this.abortController)==null||f.abort("DESTROY"),this.clear(),this.interactive=!1,this.configuration.layers.forEach(v=>{this.map.removeLayer(v.id)}),this.map.removeSource(this.configuration.sourceName)}}function po(){}function Ad(_){return _()}function Hp(){return Object.create(null)}function ml(_){_.forEach(Ad)}function Id(_){return typeof _=="function"}function Md(_,f){return _!=_?f==f:_!==f||_&&typeof _=="object"||typeof _=="function"}function og(_){return Object.keys(_).length===0}function ti(_,f){_.appendChild(f)}function $s(_,f,v){_.insertBefore(f,v||null)}function ys(_){_.parentNode&&_.parentNode.removeChild(_)}function ag(_,f){for(let v=0;v<_.length;v+=1)_[v]&&_[v].d(f)}function Tr(_){return document.createElement(_)}function Or(_){return document.createElementNS("http://www.w3.org/2000/svg",_)}function Sc(_){return document.createTextNode(_)}function Vs(){return Sc(" ")}function lg(){return Sc("")}function xc(_,f,v,E){return _.addEventListener(f,v,E),()=>_.removeEventListener(f,v,E)}function We(_,f,v){v==null?_.removeAttribute(f):_.getAttribute(f)!==v&&_.setAttribute(f,v)}function Ec(_){return _===""?null:+_}function cg(_){return Array.from(_.childNodes)}function ug(_,f){f=""+f,_.data!==f&&(_.data=f)}function Ac(_,f){_.value=f??""}function co(_,f,v,E){v==null?_.style.removeProperty(f):_.style.setProperty(f,v,E?"important":"")}let fl;function hl(_){fl=_}function hg(){if(!fl)throw new Error("Function called outside component initialization");return fl}function pg(_){hg().$$.on_destroy.push(_)}const ua=[],qu=[];let pa=[];const Xp=[],dg=Promise.resolve();let Zu=!1;function fg(){Zu||(Zu=!0,dg.then(Cd))}function Gu(_){pa.push(_)}const $u=new Set;let la=0;function Cd(){if(la!==0)return;const _=fl;do{try{for(;la<ua.length;){const f=ua[la];la++,hl(f),mg(f.$$)}}catch(f){throw ua.length=0,la=0,f}for(hl(null),ua.length=0,la=0;qu.length;)qu.pop()();for(let f=0;f<pa.length;f+=1){const v=pa[f];$u.has(v)||($u.add(v),v())}pa.length=0}while(ua.length);for(;Xp.length;)Xp.pop()();Zu=!1,$u.clear(),hl(_)}function mg(_){if(_.fragment!==null){_.update(),ml(_.before_update);const f=_.dirty;_.dirty=[-1],_.fragment&&_.fragment.p(_.ctx,f),_.after_update.forEach(Gu)}}function gg(_){const f=[],v=[];pa.forEach(E=>_.indexOf(E)===-1?f.push(E):v.push(E)),v.forEach(E=>E()),pa=f}const _g=new Set;function yg(_,f){_&&_.i&&(_g.delete(_),_.i(f))}function Yp(_){return(_==null?void 0:_.length)!==void 0?_:Array.from(_)}function xg(_,f,v){const{fragment:E,after_update:D}=_.$$;E&&E.m(f,v),Gu(()=>{const S=_.$$.on_mount.map(Ad).filter(Id);_.$$.on_destroy?_.$$.on_destroy.push(...S):ml(S),_.$$.on_mount=[]}),D.forEach(Gu)}function vg(_,f){const v=_.$$;v.fragment!==null&&(gg(v.after_update),ml(v.on_destroy),v.fragment&&v.fragment.d(f),v.on_destroy=v.fragment=null,v.ctx=[])}function bg(_,f){_.$$.dirty[0]===-1&&(ua.push(_),fg(),_.$$.dirty.fill(0)),_.$$.dirty[f/31|0]|=1<<f%31}function Pd(_,f,v,E,D,S,k,o=[-1]){const O=fl;hl(_);const z=_.$$={fragment:null,ctx:[],props:S,update:po,not_equal:D,bound:Hp(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(f.context||(O?O.$$.context:[])),callbacks:Hp(),dirty:o,skip_bound:!1,root:f.target||O.$$.root};k&&k(z.root);let ne=!1;if(z.ctx=v?v(_,f.props||{},(H,ce,...ge)=>{const xe=ge.length?ge[0]:ce;return z.ctx&&D(z.ctx[H],z.ctx[H]=xe)&&(!z.skip_bound&&z.bound[H]&&z.bound[H](xe),ne&&bg(_,H)),ce}):[],z.update(),ne=!0,ml(z.before_update),z.fragment=E?E(z.ctx):!1,f.target){if(f.hydrate){const H=cg(f.target);z.fragment&&z.fragment.l(H),H.forEach(ys)}else z.fragment&&z.fragment.c();f.intro&&yg(_.$$.fragment),xg(_,f.target,f.anchor),Cd()}hl(O)}class kd{constructor(){xt(this,"$$"),xt(this,"$$set")}$destroy(){vg(this,1),this.$destroy=po}$on(f,v){if(!Id(v))return po;const E=this.$$.callbacks[f]||(this.$$.callbacks[f]=[]);return E.push(v),()=>{const D=E.indexOf(v);D!==-1&&E.splice(D,1)}}$set(f){this.$$set&&!og(f)&&(this.$$.skip_bound=!0,this.$$set(f),this.$$.skip_bound=!1)}}const wg="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(wg);function Kp(_){let f,v,E,D,S,k,o,O,z,ne,H,ce,ge,xe,Ce,Ne;return{c(){f=Or("svg"),v=Or("circle"),D=Or("path"),k=Or("g"),o=Or("path"),z=Or("path"),H=Or("path"),ge=Or("animateTransform"),We(v,"cx","64.13"),We(v,"cy","64.13"),We(v,"r","27.63"),We(v,"fill",E=_[0].fill),We(D,"d","M64.13 18.5A45.63 45.63 0 1 1 18.5 64.13 45.63 45.63 0 0 1 64.13 18.5zm0 7.85a37.78 37.78 0 1 1-37.78 37.78 37.78 37.78 0 0 1 37.78-37.78z"),We(D,"fill-rule","evenodd"),We(D,"fill",S=_[0].fill),We(o,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),We(o,"fill",O=_[0].fill),We(z,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),We(z,"fill",ne=_[0].fill),We(z,"transform","rotate(120 64 64)"),We(H,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),We(H,"fill",ce=_[0].fill),We(H,"transform","rotate(240 64 64)"),We(ge,"attributeName","transform"),We(ge,"type","rotate"),We(ge,"from","0 64 64"),We(ge,"to","120 64 64"),We(ge,"dur","360ms"),We(ge,"repeatCount","indefinite"),We(f,"xmlns","http://www.w3.org/2000/svg"),We(f,"width",xe=_[0].size),We(f,"height",Ce=_[0].size),We(f,"viewBox","0 0 128 128"),We(f,"xml:space","preserve"),We(f,"class",Ne=_[0].class)},m(Pe,rt){$s(Pe,f,rt),ti(f,v),ti(f,D),ti(f,k),ti(k,o),ti(k,z),ti(k,H),ti(k,ge)},p(Pe,rt){rt&1&&E!==(E=Pe[0].fill)&&We(v,"fill",E),rt&1&&S!==(S=Pe[0].fill)&&We(D,"fill",S),rt&1&&O!==(O=Pe[0].fill)&&We(o,"fill",O),rt&1&&ne!==(ne=Pe[0].fill)&&We(z,"fill",ne),rt&1&&ce!==(ce=Pe[0].fill)&&We(H,"fill",ce),rt&1&&xe!==(xe=Pe[0].size)&&We(f,"width",xe),rt&1&&Ce!==(Ce=Pe[0].size)&&We(f,"height",Ce),rt&1&&Ne!==(Ne=Pe[0].class)&&We(f,"class",Ne)},d(Pe){Pe&&ys(f)}}}function Tg(_){let f,v=_[1]&&Kp(_);return{c(){v&&v.c(),f=lg()},m(E,D){v&&v.m(E,D),$s(E,f,D)},p(E,[D]){E[1]?v?v.p(E,D):(v=Kp(E),v.c(),v.m(f.parentNode,f)):v&&(v.d(1),v=null)},i:po,o:po,d(E){E&&ys(f),v&&v.d(E)}}}function Sg(_,f,v){let{directions:E}=f,{configuration:D}=f,S;return E.on("fetchroutesstart",()=>{v(1,S=!0)}),E.on("fetchroutesend",()=>{v(1,S=!1)}),_.$$set=k=>{"directions"in k&&v(2,E=k.directions),"configuration"in k&&v(0,D=k.configuration)},[D,S,E]}class Eg extends kd{constructor(f){super(),Pd(this,f,Sg,Tg,Md,{directions:2,configuration:0})}}const Ag={fill:"#6d26d7",size:"24px",class:""};class Ig{constructor(f,v){xt(this,"controlElement"),xt(this,"directions"),xt(this,"configuration"),this.directions=f,this.configuration=Object.assign({},Ag,v)}onAdd(){return this.controlElement=document.createElement("div"),new Eg({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}function Jp(_,f,v){const E=_.slice();return E[16]=f[v],E[17]=f,E[18]=v,E}function Mg(_){let f,v,E,D,S,k,o,O,z;function ne(){_[11].call(f,_[17],_[18])}return{c(){f=Tr("input"),k=Vs(),o=Tr("span"),o.textContent="°",We(f,"type","number"),f.disabled=v=!_[16].enabled,We(f,"min",E=_[0].degreesMin),We(f,"max",D=_[0].degreesMax),We(f,"step",S=_[0].degreesStep),We(f,"class","maplibre-gl-directions-bearings-control__input"),We(o,"class","maplibre-gl-directions-bearings-control__text")},m(H,ce){$s(H,f,ce),Ac(f,_[16].degrees),$s(H,k,ce),$s(H,o,ce),O||(z=xc(f,"input",ne),O=!0)},p(H,ce){_=H,ce&2&&v!==(v=!_[16].enabled)&&(f.disabled=v),ce&1&&E!==(E=_[0].degreesMin)&&We(f,"min",E),ce&1&&D!==(D=_[0].degreesMax)&&We(f,"max",D),ce&1&&S!==(S=_[0].degreesStep)&&We(f,"step",S),ce&2&&Ec(f.value)!==_[16].degrees&&Ac(f,_[16].degrees)},d(H){H&&(ys(f),ys(k),ys(o)),O=!1,z()}}}function Cg(_){let f,v=_[0].fixedDegrees+"",E,D;return{c(){f=Tr("span"),E=Sc(v),D=Sc("°"),We(f,"class","maplibre-gl-directions-bearings-control__text")},m(S,k){$s(S,f,k),ti(f,E),ti(f,D)},p(S,k){k&1&&v!==(v=S[0].fixedDegrees+"")&&ug(E,v)},d(S){S&&ys(f)}}}function Qp(_){let f,v,E,D,S,k,o,O,z,ne,H,ce=_[18],ge,xe,Ce,Ne,Pe,rt,De,je,it,Le,Ke,ft,vt,Tt,Pi;function Gt(){_[7].call(D,_[17],_[18])}const oi=()=>_[8](k,ce),Xi=()=>_[8](null,ce);function mi(...Ui){return _[9](_[18],...Ui)}function Dt(){_[10].call(xe,_[17],_[18])}function Wt(Ui,Ft){return Ui[0].fixedDegrees?Cg:Mg}let ai=Wt(_),li=ai(_);return{c(){f=Tr("div"),v=Tr("span"),v.textContent=`${_[18]+1}.`,E=Vs(),D=Tr("input"),S=Vs(),k=Tr("div"),o=Or("svg"),O=Or("circle"),H=Or("circle"),ge=Vs(),xe=Tr("input"),De=Vs(),je=Tr("span"),je.textContent="°",it=Vs(),Le=Tr("span"),Le.textContent="±",Ke=Vs(),li.c(),ft=Vs(),We(v,"class","maplibre-gl-directions-bearings-control__number text-slate-800"),We(D,"type","checkbox"),We(D,"class","maplibre-gl-directions-bearings-control__checkbox"),We(O,"r","5"),We(O,"cx","10"),We(O,"cy","10"),We(O,"fill","transparent"),We(O,"stroke","rgba(109, 38, 215, 0.65)"),We(O,"stroke-width","10"),We(O,"stroke-dasharray",z=_[16].degrees/3.6*31.42/100+" 31.42"),We(O,"transform",ne="rotate("+(-90-_[16].degrees/2+_[16].angle-_[3])+")"),co(O,"transform-origin","10px 10px"),We(H,"r","6"),We(H,"cx","10"),We(H,"cy","10"),We(H,"fill","rgb(109, 38, 215)"),We(o,"height","20"),We(o,"width","20"),We(o,"viewBox","0 0 20 20"),We(o,"class","maplibre-gl-directions-bearings-control__waypoint-image"),co(o,"width",_[0].imageSize+"px"),co(o,"height",_[0].imageSize+"px"),co(o,"opacity",_[16].enabled?1:.25),We(k,"role","spinbutton"),We(k,"tabindex","0"),We(xe,"type","number"),xe.disabled=Ce=!_[16].enabled,We(xe,"min",Ne=_[0].angleMin),We(xe,"max",Pe=_[0].angleMax),We(xe,"step",rt=_[0].angleStep),We(xe,"class","maplibre-gl-directions-bearings-control__input"),We(je,"class","maplibre-gl-directions-bearings-control__text"),We(Le,"class","maplibre-gl-directions-bearings-control__text"),We(f,"class",vt="maplibre-gl-directions-bearings-control__list-item "+(_[16].enabled?"maplibre-gl-directions-bearings-control__list-item--enabled":"maplibre-gl-directions-bearings-control__list-item--disabled")+" flex items-center gap-2 text-slate-800"+(_[16].enabled?"":"/50"))},m(Ui,Ft){$s(Ui,f,Ft),ti(f,v),ti(f,E),ti(f,D),D.checked=_[16].enabled,ti(f,S),ti(f,k),ti(k,o),ti(o,O),ti(o,H),oi(),ti(f,ge),ti(f,xe),Ac(xe,_[16].angle),ti(f,De),ti(f,je),ti(f,it),ti(f,Le),ti(f,Ke),li.m(f,null),ti(f,ft),Tt||(Pi=[xc(D,"change",Gt),xc(k,"mousedown",mi),xc(xe,"input",Dt)],Tt=!0)},p(Ui,Ft){_=Ui,Ft&2&&(D.checked=_[16].enabled),Ft&2&&z!==(z=_[16].degrees/3.6*31.42/100+" 31.42")&&We(O,"stroke-dasharray",z),Ft&10&&ne!==(ne="rotate("+(-90-_[16].degrees/2+_[16].angle-_[3])+")")&&We(O,"transform",ne),Ft&1&&co(o,"width",_[0].imageSize+"px"),Ft&1&&co(o,"height",_[0].imageSize+"px"),Ft&2&&co(o,"opacity",_[16].enabled?1:.25),ce!==_[18]&&(Xi(),ce=_[18],oi()),Ft&2&&Ce!==(Ce=!_[16].enabled)&&(xe.disabled=Ce),Ft&1&&Ne!==(Ne=_[0].angleMin)&&We(xe,"min",Ne),Ft&1&&Pe!==(Pe=_[0].angleMax)&&We(xe,"max",Pe),Ft&1&&rt!==(rt=_[0].angleStep)&&We(xe,"step",rt),Ft&2&&Ec(xe.value)!==_[16].angle&&Ac(xe,_[16].angle),ai===(ai=Wt(_))&&li?li.p(_,Ft):(li.d(1),li=ai(_),li&&(li.c(),li.m(f,ft))),Ft&2&&vt!==(vt="maplibre-gl-directions-bearings-control__list-item "+(_[16].enabled?"maplibre-gl-directions-bearings-control__list-item--enabled":"maplibre-gl-directions-bearings-control__list-item--disabled")+" flex items-center gap-2 text-slate-800"+(_[16].enabled?"":"/50"))&&We(f,"class",vt)},d(Ui){Ui&&ys(f),Xi(),li.d(),Tt=!1,ml(Pi)}}}function Pg(_){let f,v,E,D=Yp(_[1]),S=[];for(let k=0;k<D.length;k+=1)S[k]=Qp(Jp(_,D,k));return{c(){f=Tr("div"),v=Tr("div");for(let k=0;k<S.length;k+=1)S[k].c();We(v,"class","maplibre-gl-directions-bearings-control__list flex flex-col max-h-96 overflow-y-auto"),We(f,"class",E="maplibre-gl-directions-bearings-control maplibregl-ctrl maplibregl-ctrl-group p-4 "+(_[1].length?"block":"hidden")+" bg-white text-base rounded")},m(k,o){$s(k,f,o),ti(f,v);for(let O=0;O<S.length;O+=1)S[O]&&S[O].m(v,null)},p(k,[o]){if(o&31){D=Yp(k[1]);let O;for(O=0;O<D.length;O+=1){const z=Jp(k,D,O);S[O]?S[O].p(z,o):(S[O]=Qp(z),S[O].c(),S[O].m(v,null))}for(;O<S.length;O+=1)S[O].d(1);S.length=D.length}o&2&&E!==(E="maplibre-gl-directions-bearings-control maplibregl-ctrl maplibregl-ctrl-group p-4 "+(k[1].length?"block":"hidden")+" bg-white text-base rounded")&&We(f,"class",E)},i:po,o:po,d(k){k&&ys(f),ag(S,k)}}}function kg(_,f,v){let{directions:E}=f,{configuration:D}=f;E.configuration.bearings||console.warn("The Bearings Control is used, but the `bearings` configuration option is not enabled!");let S=[];E.on("addwaypoint",k),E.on("removewaypoint",k),E.on("movewaypoint",k),E.on("setwaypoints",k);function k(){v(1,S=E.waypointsBearings.map((De,je)=>S[je]?S[je]:{enabled:D.defaultEnabled||!!De,angle:De?De[0]:D.angleDefault,degrees:De?De[1]:D.fixedDegrees?D.fixedDegrees:D.degreesDefault}))}k();let o;const O=[];let z=-1;function ne(De,je){var it;(it=S[je])!=null&&it.enabled&&(z=je,document.addEventListener("mouseup",H),document.addEventListener("mousemove",ce))}function H(){z=-1,document.removeEventListener("mouseup",H),document.removeEventListener("mousemove",ce)}function ce(De){if(~z&&O[z]){const je=O[z],it=je.getBoundingClientRect().x+D.imageSize/2,Le=je.getBoundingClientRect().y+D.imageSize/2,Ke=De.pageX,ft=De.pageY,vt=Math.atan2(Ke-it,ft-Le)*(180/Math.PI)*-1+90;v(1,S[z].angle=90+vt+ge|0,S)}}pg(()=>{document.removeEventListener("mouseup",H),document.removeEventListener("mousemove",ce)});let ge=0;D.respectMapBearing&&E.map.on("rotate",()=>v(3,ge=E.map.getBearing()));function xe(De,je){De[je].enabled=this.checked,v(1,S)}function Ce(De,je){qu[De?"unshift":"push"](()=>{O[je]=De,v(2,O)})}const Ne=(De,je)=>ne(je,De);function Pe(De,je){De[je].angle=Ec(this.value),v(1,S)}function rt(De,je){De[je].degrees=Ec(this.value),v(1,S)}return _.$$set=De=>{"directions"in De&&v(5,E=De.directions),"configuration"in De&&v(0,D=De.configuration)},_.$$.update=()=>{_.$$.dirty&67&&(o&&clearTimeout(o),v(6,o=setTimeout(()=>{v(5,E.waypointsBearings=S.map(De=>De.enabled?[De.angle,De.degrees]:void 0),E)},D.debounceTimeout)))},[D,S,O,ge,ne,E,o,xe,Ce,Ne,Pe,rt]}let zg=class extends kd{constructor(_){super(),Pd(this,_,kg,Pg,Md,{directions:5,configuration:0})}};const Dg={defaultEnabled:!1,debounceTimeout:150,angleDefault:0,angleMin:0,angleMax:359,angleStep:1,fixedDegrees:0,degreesDefault:45,degreesMin:15,degreesMax:360,degreesStep:15,respectMapBearing:!1,imageSize:50};class Lg{constructor(f,v){xt(this,"controlElement"),xt(this,"directions"),xt(this,"configuration"),this.directions=f,this.configuration=Object.assign({},Dg,v)}onAdd(){return this.controlElement=document.createElement("div"),new zg({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}function ed(_){let f,v;return{c(){f=fe("p"),v=Gi(_[4]),Oe(f,"class","text-red-500")},m(E,D){de(E,f,D),Ae(f,v)},p(E,D){D&16&&Xu(v,E[4])},d(E){E&&pe(f)}}}function Rg(_){let f,v,E,D,S,k,o,O,z,ne,H,ce,ge,xe,Ce,Ne,Pe=_[4]&&ed(_);return{c(){Pe&&Pe.c(),f=Ve(),v=fe("label"),E=fe("input"),S=Ve(),k=fe("strong"),k.textContent="Interactivity enabled",o=Ve(),O=fe("label"),z=fe("input"),H=Ve(),ce=fe("strong"),ce.textContent="Update route while dragging",ge=Ve(),xe=fe("ul"),xe.innerHTML=`<li>Click somewhere on the map to add a waypoint</li> <li>Click a waypoint to remove it and its related snappoint</li> <li>Click a snappoint to remove it and its related waypoint</li> <li>Drag a waypoint somewhere to move it</li> <li>Drag a routeline somewhere to add a waypoint in-between the 2 nearest ones</li> <li>Click an alternative routeline to select it<br/> <small><strong>Note</strong>, there&#39;s usually no alternative routelines in the server response if there are more than
        2 waypoints</small></li>`,Oe(E,"type","checkbox"),E.disabled=D=!_[0],Oe(v,"class","flex items-center gap-3"),Oe(z,"type","checkbox"),z.disabled=ne=!_[0],Oe(O,"class","flex items-center gap-3")},m(rt,De){Pe&&Pe.m(rt,De),de(rt,f,De),de(rt,v,De),Ae(v,E),E.checked=_[1],Ae(v,S),Ae(v,k),de(rt,o,De),de(rt,O,De),Ae(O,z),z.checked=_[3],Ae(O,H),Ae(O,ce),de(rt,ge,De),de(rt,xe,De),Ce||(Ne=[Xt(E,"change",_[7]),Xt(z,"change",_[8]),Xt(z,"click",_[6])],Ce=!0)},p(rt,De){rt[4]?Pe?Pe.p(rt,De):(Pe=ed(rt),Pe.c(),Pe.m(f.parentNode,f)):Pe&&(Pe.d(1),Pe=null),De&1&&D!==(D=!rt[0])&&(E.disabled=D),De&2&&(E.checked=rt[1]),De&1&&ne!==(ne=!rt[0])&&(z.disabled=ne),De&8&&(z.checked=rt[3])},d(rt){rt&&(pe(f),pe(v),pe(o),pe(O),pe(ge),pe(xe)),Pe&&Pe.d(rt),Ce=!1,Ur(Ne)}}}function Bg(_){let f;return{c(){f=fe("span"),f.textContent=`${_[5].name}`,Oe(f,"slot","title")},m(v,E){de(v,f,E)},p:Vt,d(v){v&&pe(f)}}}function Fg(_){let f,v,E,D;return f=new nr({props:{$$slots:{title:[Bg],default:[Rg]},$$scope:{ctx:_}}}),{c(){en(f.$$.fragment),v=Ve(),E=fe("div"),Oe(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,k){Wi(f,S,k),de(S,v,k),de(S,E,k),_[9](E),D=!0},p(S,[k]){const o={};k&4123&&(o.$$scope={dirty:k,ctx:S}),f.$set(o)},i(S){D||(fi(f.$$.fragment,S),D=!0)},o(S){Ei(f.$$.fragment,S),D=!1},d(S){S&&(pe(v),pe(E)),Hi(f,S),_[9](null)}}}function Og(_,f,v){let E;tr(_,ir,Ce=>v(11,E=Ce));const D=kn.find(Ce=>Ce.path===E);let S,k,o,O=!0,z=!1;function ne(){o&&o.destroy(),v(0,o=new er(k,{requestOptions:{alternatives:"true"},refreshOnMove:!z}))}dr(()=>{k=new fr.Map({container:S,style:mr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"}),k.on("load",()=>{v(0,o=new er(k,{requestOptions:{alternatives:"true"}}))})});let H;function ce(){O=this.checked,v(1,O)}function ge(){z=this.checked,v(3,z)}function xe(Ce){qn[Ce?"unshift":"push"](()=>{S=Ce,v(2,S)})}return _.$$.update=()=>{_.$$.dirty&3&&o&&(v(0,o.interactive=O,o),o.on("fetchroutesend",Ce=>{Ce.data.code!=="Ok"?v(4,H=`${Ce.data.code}: ${Ce.data.message??"no details available."}`):v(4,H="")}))},[o,O,S,z,H,D,ne,ce,ge,xe]}class Ug extends _n{constructor(f){super(),gn(this,f,Og,Fg,ln,{})}}const Vg=Object.freeze(Object.defineProperty({__proto__:null,default:Ug},Symbol.toStringTag,{value:"Module"}));function $g(_){let f,v,E,D,S,k,o,O,z,ne,H,ce,ge,xe,Ce,Ne,Pe,rt,De,je,it,Le,Ke,ft,vt,Tt,Pi,Gt,oi,Xi,mi,Dt,Wt,ai,li,Ui,Ft,yn,cn,Lt,Zn,Sr,un,gr,Gn,ci,hn,Wn,ye,zn,Er,It,Ct,rr,pn,Vr,Jr,Rt,_r,yr,ze,ki,Yi,zi,Dn,Be,dt,gt,Di,Li,at,xn,Vi,Ki,Ji,sr,gi,Ut,Ln,vn,G,P,R,V,X;return{c(){f=fe("p"),f.innerHTML=`The <a href="http://project-osrm.org/docs/v5.24.0/api/#requests" target="_blank" rel="noreferrer">bearings</a> support
    allows to control in which direction the route would be continued from a given waypoint.`,v=Ve(),E=fe("p"),E.innerHTML=`In order to enable support for this API option on the plugin level, pass the <code>bearings: true</code> option to
    the plugin&#39;s configuration object. When this is done, each request would contain the <code>bearings</code> field. The
    problem with that is that the values for the waypoints&#39; bearings are not populated correctly since we need some way to
    assign these bearings values to our waypoints.`,D=Ve(),S=fe("p"),S.innerHTML="Luckily, that&#39;s possible to achieve using the built-in <strong>Bearings Control</strong>.",k=Ve(),o=fe("label"),O=fe("input"),ne=Ve(),H=fe("strong"),H.textContent="Default Enabled",ce=Ve(),ge=fe("label"),xe=fe("span"),xe.innerHTML="<strong>Debounce timeout</strong>",Ce=Ve(),Ne=fe("input"),rt=Ve(),De=fe("label"),je=fe("span"),je.innerHTML="<strong>Default angle</strong>",it=Ve(),Le=fe("input"),ft=Ve(),vt=fe("label"),Tt=fe("span"),Tt.innerHTML="<strong>Minimal allowed angle</strong>",Pi=Ve(),Gt=fe("input"),Xi=Ve(),mi=fe("label"),Dt=fe("span"),Dt.innerHTML="<strong>Maximal allowed angle</strong>",Wt=Ve(),ai=fe("input"),Ui=Ve(),Ft=fe("label"),yn=fe("span"),yn.innerHTML="<strong>Angle step</strong>",cn=Ve(),Lt=fe("input"),Sr=Ve(),un=fe("label"),gr=fe("span"),gr.innerHTML="<strong>Fixed degrees</strong>",Gn=Ve(),ci=fe("input"),Wn=Ve(),ye=fe("label"),zn=fe("span"),zn.innerHTML="<strong>Degrees default</strong>",Er=Ve(),It=fe("input"),rr=Ve(),pn=fe("label"),Vr=fe("span"),Vr.innerHTML="<strong>Minimal allowed degrees</strong>",Jr=Ve(),Rt=fe("input"),yr=Ve(),ze=fe("label"),ki=fe("span"),ki.innerHTML="<strong>Maximal allowed degrees</strong>",Yi=Ve(),zi=fe("input"),Be=Ve(),dt=fe("label"),gt=fe("span"),gt.innerHTML="<strong>Degrees step</strong>",Di=Ve(),Li=fe("input"),xn=Ve(),Vi=fe("label"),Ki=fe("input"),sr=Ve(),gi=fe("strong"),gi.textContent="Respect Map's Bearing",Ut=Ve(),Ln=fe("label"),vn=fe("span"),vn.innerHTML="<strong>Image size</strong>",G=Ve(),P=fe("input"),Oe(O,"type","checkbox"),O.disabled=z=!_[0],Oe(o,"class","flex items-center gap-3"),Oe(Ne,"type","number"),Ne.disabled=Pe=!_[0],Oe(ge,"class","flex flex-col gap-2"),Oe(Le,"type","number"),Le.disabled=Ke=!_[0],Oe(De,"class","flex flex-col gap-2"),Oe(Gt,"type","number"),Gt.disabled=oi=!_[0],Oe(vt,"class","flex flex-col gap-2"),Oe(ai,"type","number"),ai.disabled=li=!_[0],Oe(mi,"class","flex flex-col gap-2"),Oe(Lt,"type","number"),Lt.disabled=Zn=!_[0],Oe(Ft,"class","flex flex-col gap-2"),Oe(ci,"type","number"),ci.disabled=hn=!_[0],Oe(un,"class","flex flex-col gap-2"),Oe(It,"type","number"),It.disabled=Ct=!_[0]||!!_[1].fixedDegrees,Oe(ye,"class","flex flex-col gap-2"),Oe(Rt,"type","number"),Rt.disabled=_r=!_[0]||!!_[1].fixedDegrees,Oe(pn,"class","flex flex-col gap-2"),Oe(zi,"type","number"),zi.disabled=Dn=!_[0]||!!_[1].fixedDegrees,Oe(ze,"class","flex flex-col gap-2"),Oe(Li,"type","number"),Li.disabled=at=!_[0]||!!_[1].fixedDegrees,Oe(dt,"class","flex flex-col gap-2"),Oe(Ki,"type","checkbox"),Ki.disabled=Ji=!_[0],Oe(Vi,"class","flex items-center gap-3"),Oe(P,"type","number"),P.disabled=R=!_[0],Oe(Ln,"class","flex flex-col gap-2")},m($,J){de($,f,J),de($,v,J),de($,E,J),de($,D,J),de($,S,J),de($,k,J),de($,o,J),Ae(o,O),O.checked=_[1].defaultEnabled,Ae(o,ne),Ae(o,H),de($,ce,J),de($,ge,J),Ae(ge,xe),Ae(ge,Ce),Ae(ge,Ne),Zt(Ne,_[1].debounceTimeout),de($,rt,J),de($,De,J),Ae(De,je),Ae(De,it),Ae(De,Le),Zt(Le,_[1].angleDefault),de($,ft,J),de($,vt,J),Ae(vt,Tt),Ae(vt,Pi),Ae(vt,Gt),Zt(Gt,_[1].angleMin),de($,Xi,J),de($,mi,J),Ae(mi,Dt),Ae(mi,Wt),Ae(mi,ai),Zt(ai,_[1].angleMax),de($,Ui,J),de($,Ft,J),Ae(Ft,yn),Ae(Ft,cn),Ae(Ft,Lt),Zt(Lt,_[1].angleStep),de($,Sr,J),de($,un,J),Ae(un,gr),Ae(un,Gn),Ae(un,ci),Zt(ci,_[1].fixedDegrees),de($,Wn,J),de($,ye,J),Ae(ye,zn),Ae(ye,Er),Ae(ye,It),Zt(It,_[1].degreesDefault),de($,rr,J),de($,pn,J),Ae(pn,Vr),Ae(pn,Jr),Ae(pn,Rt),Zt(Rt,_[1].degreesMin),de($,yr,J),de($,ze,J),Ae(ze,ki),Ae(ze,Yi),Ae(ze,zi),Zt(zi,_[1].degreesMax),de($,Be,J),de($,dt,J),Ae(dt,gt),Ae(dt,Di),Ae(dt,Li),Zt(Li,_[1].degreesStep),de($,xn,J),de($,Vi,J),Ae(Vi,Ki),Ki.checked=_[1].respectMapBearing,Ae(Vi,sr),Ae(Vi,gi),de($,Ut,J),de($,Ln,J),Ae(Ln,vn),Ae(Ln,G),Ae(Ln,P),Zt(P,_[1].imageSize),V||(X=[Xt(O,"change",_[6]),Xt(Ne,"input",_[7]),Xt(Le,"input",_[8]),Xt(Gt,"input",_[9]),Xt(ai,"input",_[10]),Xt(Lt,"input",_[11]),Xt(ci,"input",_[12]),Xt(It,"input",_[13]),Xt(Rt,"input",_[14]),Xt(zi,"input",_[15]),Xt(Li,"input",_[16]),Xt(Ki,"change",_[17]),Xt(P,"input",_[18])],V=!0)},p($,J){J&1&&z!==(z=!$[0])&&(O.disabled=z),J&2&&(O.checked=$[1].defaultEnabled),J&1&&Pe!==(Pe=!$[0])&&(Ne.disabled=Pe),J&2&&di(Ne.value)!==$[1].debounceTimeout&&Zt(Ne,$[1].debounceTimeout),J&1&&Ke!==(Ke=!$[0])&&(Le.disabled=Ke),J&2&&di(Le.value)!==$[1].angleDefault&&Zt(Le,$[1].angleDefault),J&1&&oi!==(oi=!$[0])&&(Gt.disabled=oi),J&2&&di(Gt.value)!==$[1].angleMin&&Zt(Gt,$[1].angleMin),J&1&&li!==(li=!$[0])&&(ai.disabled=li),J&2&&di(ai.value)!==$[1].angleMax&&Zt(ai,$[1].angleMax),J&1&&Zn!==(Zn=!$[0])&&(Lt.disabled=Zn),J&2&&di(Lt.value)!==$[1].angleStep&&Zt(Lt,$[1].angleStep),J&1&&hn!==(hn=!$[0])&&(ci.disabled=hn),J&2&&di(ci.value)!==$[1].fixedDegrees&&Zt(ci,$[1].fixedDegrees),J&3&&Ct!==(Ct=!$[0]||!!$[1].fixedDegrees)&&(It.disabled=Ct),J&2&&di(It.value)!==$[1].degreesDefault&&Zt(It,$[1].degreesDefault),J&3&&_r!==(_r=!$[0]||!!$[1].fixedDegrees)&&(Rt.disabled=_r),J&2&&di(Rt.value)!==$[1].degreesMin&&Zt(Rt,$[1].degreesMin),J&3&&Dn!==(Dn=!$[0]||!!$[1].fixedDegrees)&&(zi.disabled=Dn),J&2&&di(zi.value)!==$[1].degreesMax&&Zt(zi,$[1].degreesMax),J&3&&at!==(at=!$[0]||!!$[1].fixedDegrees)&&(Li.disabled=at),J&2&&di(Li.value)!==$[1].degreesStep&&Zt(Li,$[1].degreesStep),J&1&&Ji!==(Ji=!$[0])&&(Ki.disabled=Ji),J&2&&(Ki.checked=$[1].respectMapBearing),J&1&&R!==(R=!$[0])&&(P.disabled=R),J&2&&di(P.value)!==$[1].imageSize&&Zt(P,$[1].imageSize)},d($){$&&(pe(f),pe(v),pe(E),pe(D),pe(S),pe(k),pe(o),pe(ce),pe(ge),pe(rt),pe(De),pe(ft),pe(vt),pe(Xi),pe(mi),pe(Ui),pe(Ft),pe(Sr),pe(un),pe(Wn),pe(ye),pe(rr),pe(pn),pe(yr),pe(ze),pe(Be),pe(dt),pe(xn),pe(Vi),pe(Ut),pe(Ln)),V=!1,Ur(X)}}}function Ng(_){let f;return{c(){f=fe("span"),f.textContent=`${_[3].name}`,Oe(f,"slot","title")},m(v,E){de(v,f,E)},p:Vt,d(v){v&&pe(f)}}}function jg(_){let f,v,E,D;return f=new nr({props:{$$slots:{title:[Ng],default:[$g]},$$scope:{ctx:_}}}),{c(){en(f.$$.fragment),v=Ve(),E=fe("div"),Oe(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,k){Wi(f,S,k),de(S,v,k),de(S,E,k),_[19](E),D=!0},p(S,[k]){const o={};k&2097155&&(o.$$scope={dirty:k,ctx:S}),f.$set(o)},i(S){D||(fi(f.$$.fragment,S),D=!0)},o(S){Ei(f.$$.fragment,S),D=!1},d(S){S&&(pe(v),pe(E)),Hi(f,S),_[19](null)}}}function qg(_,f,v){let E;tr(_,ir,ft=>v(20,E=ft));const D=kn.find(ft=>ft.path===E);let S,k,o;dr(()=>{v(4,k=new fr.Map({container:S,style:mr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"})),k.on("load",()=>{v(0,o=new er(k,{bearings:!0})),v(0,o.interactive=!0,o),k.addControl(new yd.NavigationControl({}))})});let O,z={defaultEnabled:!1,debounceTimeout:150,angleDefault:0,angleMin:0,angleMax:359,angleStep:1,fixedDegrees:0,degreesDefault:45,degreesMin:15,degreesMax:360,degreesStep:15,respectMapBearing:!1,imageSize:50};function ne(){z.defaultEnabled=this.checked,v(1,z)}function H(){z.debounceTimeout=di(this.value),v(1,z)}function ce(){z.angleDefault=di(this.value),v(1,z)}function ge(){z.angleMin=di(this.value),v(1,z)}function xe(){z.angleMax=di(this.value),v(1,z)}function Ce(){z.angleStep=di(this.value),v(1,z)}function Ne(){z.fixedDegrees=di(this.value),v(1,z)}function Pe(){z.degreesDefault=di(this.value),v(1,z)}function rt(){z.degreesMin=di(this.value),v(1,z)}function De(){z.degreesMax=di(this.value),v(1,z)}function je(){z.degreesStep=di(this.value),v(1,z)}function it(){z.respectMapBearing=this.checked,v(1,z)}function Le(){z.imageSize=di(this.value),v(1,z)}function Ke(ft){qn[ft?"unshift":"push"](()=>{S=ft,v(2,S)})}return _.$$.update=()=>{_.$$.dirty&51&&k&&o&&(O&&k.hasControl(O)&&k.removeControl(O),k.addControl(v(5,O=new Lg(o,z)),"top-left"))},[o,z,S,D,k,O,ne,H,ce,ge,xe,Ce,Ne,Pe,rt,De,je,it,Le,Ke]}class Zg extends _n{constructor(f){super(),gn(this,f,qg,jg,ln,{})}}const Gg=Object.freeze(Object.defineProperty({__proto__:null,default:Zg},Symbol.toStringTag,{value:"Module"})),Wg=[{id:"maplibre-gl-directions-snapline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[2,2],"line-color":"#ffffff","line-opacity":.65,"line-width":2},filter:["==",["get","type"],"SNAPLINE"]},{id:"maplibre-gl-directions-alt-routeline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-pattern":"routeline","line-width":12,"line-opacity":.5},filter:["==",["get","route"],"ALT"]},{id:"maplibre-gl-directions-routeline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-pattern":"routeline","line-width":12},filter:["==",["get","route"],"SELECTED"]},{id:"maplibre-gl-directions-hoverpoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-hoverpoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"HOVERPOINT"]},{id:"maplibre-gl-directions-snappoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-snappoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"SNAPPOINT"]},{id:"maplibre-gl-directions-waypoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-waypoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"WAYPOINT"]}],Hg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJpSURBVEiJlZRLSFQBFIa/c2dyGMXHNKUrq0WLgsxt214L20gG0gxGhIIktIk2IS3bRFG4ahFBYQPlY8pQNxkFUbSQigyEiBKLIk3vOODUPO5pMV4fM/fOnTmbuffc8//ff+5jBI8abF9qEb/0iHIU2LPW/obyzEDvnI5vnymlF7cLE20aSAQTNxXtBQyXsZwKt7cZDRc7hyRdNmCiTQNm0JwEDtu92maoa84fr8xDcn6L5Lnf19DmBPE7AZarE7dE8+Y1jXCgWwntLZj5DB/vCqu/ATiSy5k3gAueGwy2L7UYPnkPGMEdcKhfCdQ5xYB0QnhzFVJ/AMghVmt0JPxp80zRvRW/9Nj9/VF3c4CqemVfRO1Tn2J0F84UAyyOAQTqYOdBd3O7GluhqnZNqxz3BCDsAqhuAnF9xzaNG1DTtH662xuA+gGsjLe5XVZ2TQk+T4AgPwGS35XsX2/zbAqSP2wtvzwBCh/yqYS5KW/A3NSWbd95AkDG7aMvY8LijPuDWJzJz6yHU8Y8ARk14kAW8vd2egBmh2B1YWNmdQFmH8L0gGDlNqSk5WlRXKdksQ5zHPREYd8fzP9mU44LxaOjoQ7PDQBQvebUzqZczRHDuu7UdwRE46GXwCtnK6c8TEWGw6/LBuQTcaVcf8Mw+t0uugIiw6EXqD7yche4Fxmpf1sxAEAsvQQkS7gv+3yZy6U8SgIiT8LzSPF/vF1qaV/nUGPR17s1QxkVO2nGEI0UtO9HR0NnvbQlN7Drn2ofMLcp1VcrZbluVjHg3OOQKYaeATJAGsPq6poMr5SjragenFo6H+sweyvR/Ac3+sqU/+vBXgAAAABJRU5ErkJggg==",Xg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJwSURBVEiJlZTNSxRxGMc/v98KZmm67qJQ2At0Ksy/obeDXSy7ZBS5KEiCHaJLSMcuUSSeOmi7BkW16taKeDCjMIJOFRgUHSzMjExdc2O3fZmnwzrr6s7s7D6Xmeft+3me+c2MwsGWW9obVZnqRDgG7FsPf0V4LuiB2tDgTKF+ZZeQ5p7y1YroHYEuQNuUpVFyt0b/vaKCwUTRAGnuKY9URCeAI9lgwy5o2J25n5uHuR+5LS9qXNFmK0iZFWB1+1ofojLidV6k4ywc2L+56Mss6t4j+PUb4GgkXXkb6HHcYLmlvVG51HtA461Fei/DziqrOVCrUbjRB0srAGlDGU2ekaGPuTV5z1aVqU4zLudO2YoDSHUl0tZiui6N7thak394BseBjPDhg7biWWs6BFU71omccAYo9gBQ7wVl+5LlKGiorzO9vY4AMQ8+mXIWNy2VrXU5AhSyACDfFyD+z1k8Fof5BdP76QgA/QFApVIwNe0MmJrO2VbeOQIUMp69D0+iZj7bi898QoUnN3zRYUeAlnQIyIyUSkH/AATHYHFpo2hxCR6HUf2DkE6b0aRKxMfyB7awSKtvXOBkXqJiW+Yai1u1hdyj/lbHDQBEuGkVJxa3E8fQ3LKKWwLcIf8r4LWlkuVEasoz7H9TNCCTkevFymstvbYydgn3cOClCE+K0B+qHvG/LRkAIAZXgTXbAqVWki6uFdIoCPA888+h8v/xGwMY3XXBQN7Xu2mGQknTIqd9D0XRtiV83z3qv+jUW3AD00SkG/iWE5k1YgnbzUoGuJ8GIqLlApAEEoZW5z0TD/4U01uSLZ/xXYq0+rpK6fkPouPQTszwGH0AAAAASUVORK5CYII=",Yg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAKQSURBVEiJlZRLSFRRGMd/586rVHQySDMqXRRESJuQ1BTsiS1atK5NGpIgodQiIghqleWYbVr0wDZpG6nUICym0UZ0kQXZTlSMHDUczee87mkxXlPn3rl3vtU5//N9/9/5zj3nCkyi3F9fiKBaSk4C+WvymIQeu4w99Za2/EhWL4wWKrvrXItZNg9C1ACKQVpMIp4EszIbhg/fCVsGVHbXuRZ22N8LSYWmFWzLocCVC8BoKMDo6tTGkk+zWVmVehC7HmDRbW/WzHc7s7mWd55D2/duyvm5MkHL7zdMhoMAJ7Ln5x8CdaYdlPvrCyV8A5RdDjeN+Zdx29P19sFcdIkbY8+YjswDxFSVI1+Oe4Y35iSeraBa06/knjU0B3Db06nKOaNNbYpC1dacBICUnNKKj2YcMDTXoijjIJm2tHgt8rQpANgHkOfIRjG+ZP8NhMIe504ABGK/FYAdIELM1FyLiIxqQ5sVwCTA2OoUK6ru1d4Uy2qI8fCMNg1YAIjv8V3F6AwOmgI6ZweJqGsdCIbMAULt0obtMz6GFkcMzb8ujdD+p3d9LqV4awpwKpEOIArxLu7+auPFdA+B+IMCIBAO8nzqA/cm2ojK9W8VIeZ8l7BfvZ2V9dd3ITm3VU9TXED83HWMOnwlngumHQAgua8nL6shXfM1xAM9VRfQW+L5jJR9Bk568dFX0uS3DACQCrctmksp1FtGi4aAvuJmr4TXFuxb+4ofDaQMAFDs4jqwkCQlaHM4bib1SLboK2qaECLxH78eklpvUWPC67UMAPAVe1pBvNqqC+TL3lJPm1m9KQDAFlJrgfEN0mhIiRl3lirAW9E8p6hcAiJAWCAuDhx7/NdKbUpR1t9wtdzfUJNKzT8AkN+WDptOYQAAAABJRU5ErkJggg==",Kg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAACmAAAApgHdff84AAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAN9JREFUSIlj/P//PwMtARNNTWdgYGB0ic61oKUFLP8Z/h+nqQURFj9paT4Di4HsH9paULGam6YW0DwVjVpAELAwMDAwaKsqMthbGMEFn714zbBh9yGGSD83BkF+Xrj49gOQLOPpYAkXe//xM8PyTbsYAlztGKQkROHiB0+cY7h6+z7EAlZWFgYeLk64JAcHOwMDAwMDNycHijgLMzMDAwMDitivX7/hepDFWVlZGBgYGBgYnaNzaFraDf1IHvoWsDQFfqOtBY/e0dYTLHMOctDWAkYGRkvCysgHjEO+VQEA4IsuY5Zs3DIAAAAASUVORK5CYII=";function Jg(_){let f,v,E,D,S,k,o,O,z,ne;return{c(){f=fe("p"),v=Gi(`It's completely up to you how to style the Directions' features shown on the map. You can either use the default
    styles provided by the plugin (see other examples), easily modify the default features' dimensions (see the
    `),E=fe("a"),E.textContent="Touch-Friendly Features example",D=Gi(`) or
    `),S=fe("strong"),S.textContent="define your custom features' styles from scratch",k=Gi("."),o=Ve(),O=fe("p"),O.textContent="This example demonstrates the last option.",Oe(E,"href","/examples/touch-friendly-features")},m(H,ce){de(H,f,ce),Ae(f,v),Ae(f,E),Ae(f,D),Ae(f,S),Ae(f,k),de(H,o,ce),de(H,O,ce),z||(ne=Hu(Qu.call(null,E)),z=!0)},p:Vt,d(H){H&&(pe(f),pe(o),pe(O)),z=!1,ne()}}}function Qg(_){let f;return{c(){f=fe("span"),f.textContent=`${_[1].name}`,Oe(f,"slot","title")},m(v,E){de(v,f,E)},p:Vt,d(v){v&&pe(f)}}}function e_(_){let f,v,E,D;return f=new nr({props:{$$slots:{title:[Qg],default:[Jg]},$$scope:{ctx:_}}}),{c(){en(f.$$.fragment),v=Ve(),E=fe("div"),Oe(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,k){Wi(f,S,k),de(S,v,k),de(S,E,k),_[2](E),D=!0},p(S,[k]){const o={};k&32&&(o.$$scope={dirty:k,ctx:S}),f.$set(o)},i(S){D||(fi(f.$$.fragment,S),D=!0)},o(S){Ei(f.$$.fragment,S),D=!1},d(S){S&&(pe(v),pe(E)),Hi(f,S),_[2](null)}}}function t_(_,f,v){let E;tr(_,ir,O=>v(4,E=O));const D=kn.find(O=>O.path===E);let S,k;dr(()=>{const O=new fr.Map({container:S,style:mr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:`<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a> | Icons made by <a href="https://www.flaticon.com/authors/vectors-market" title="Vectors Market">Vectors Market</a> and by <a href="https://www.flaticon.com/authors/dinosoftlabs" title="DinosoftLabs">DinosoftLabs</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>`,fadeDuration:0});O.on("load",()=>{O.loadImage(Hg,(z,ne)=>{z||O.addImage("balloon-waypoint",ne)}),O.loadImage(Xg,(z,ne)=>{z||O.addImage("balloon-snappoint",ne)}),O.loadImage(Yg,(z,ne)=>{z||O.addImage("balloon-hoverpoint",ne)}),O.loadImage(Kg,(z,ne)=>{z||O.addImage("routeline",ne)}),k=new er(O,{requestOptions:{alternatives:"true"},layers:Wg,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline"]}),k.interactive=!0})});function o(O){qn[O?"unshift":"push"](()=>{S=O,v(0,S)})}return[S,D,o]}class i_ extends _n{constructor(f){super(),gn(this,f,t_,e_,ln,{})}}const n_=Object.freeze(Object.defineProperty({__proto__:null,default:i_},Symbol.toStringTag,{value:"Module"}));class r_ extends er{constructor(v,E){super(v,E);cl(this,"originalBuildRoutelines",sg.buildRoutelines);cl(this,"buildRoutelines",(v,E,D,S)=>{const k=this.originalBuildRoutelines(v,E,D,S);return k[0].forEach((o,O)=>{o.properties&&(o.properties.distance=E[0].legs[O].distance)}),k})}}const Pn="distance-measurement-maplibre-gl-directions",s_={sourceName:Pn,layers:[{id:`${Pn}-snapline`,type:"line",source:Pn,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":"#34343f","line-width":2},filter:["==",["get","type"],"SNAPLINE"]},{id:`${Pn}-routeline`,type:"line",source:Pn,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#212121","line-opacity":.85,"line-width":3},filter:["==",["get","route"],"SELECTED"]},{id:`${Pn}-routeline-distance`,type:"symbol",source:Pn,layout:{"symbol-placement":"line-center","text-field":"{distance}m","text-size":16,"text-ignore-placement":!0,"text-allow-overlap":!0,"text-overlap":"always"},paint:{"text-color":"#212121","text-halo-color":"#ffffff","text-halo-width":1},filter:["==",["get","route"],"SELECTED"]},{id:`${Pn}-hoverpoint`,type:"circle",source:Pn,paint:{"circle-radius":9,"circle-color":"#212121"},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${Pn}-snappoint`,type:"circle",source:Pn,paint:{"circle-radius":["case",["boolean",["get","highlight"],!1],9,7],"circle-color":["case",["boolean",["get","highlight"],!1],"#313131","#494949"]},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${Pn}-waypoint`,type:"circle",source:Pn,paint:{"circle-radius":["case",["boolean",["get","highlight"],!1],9,7],"circle-color":["case",["boolean",["get","highlight"],!1],"#212121","#2c2c2c"]},filter:["==",["get","type"],"WAYPOINT"]}],sensitiveSnappointLayers:[`${Pn}-snappoint`],sensitiveWaypointLayers:[`${Pn}-waypoint`],sensitiveRoutelineLayers:[`${Pn}-routeline`],sensitiveAltRoutelineLayers:[]};function o_(_){let f;return{c(){f=fe("em"),f.textContent="unknown"},m(v,E){de(v,f,E)},p:Vt,d(v){v&&pe(f)}}}function a_(_){let f,v,E;return{c(){f=fe("strong"),v=Gi(_[1]),E=Gi("m")},m(D,S){de(D,f,S),Ae(f,v),Ae(f,E)},p(D,S){S&2&&Xu(v,D[1])},d(D){D&&pe(f)}}}function l_(_){let f,v,E,D,S,k,o,O,z,ne;function H(xe,Ce){return xe[1]?a_:o_}let ce=H(_),ge=ce(_);return{c(){f=fe("p"),v=Gi(`Total Route Distance:
    `),ge.c(),E=Ve(),D=fe("small"),D.innerHTML="<strong>Note</strong> that you might want to zoom in and out the map to toggle the distance-annotations visibility",S=Ve(),k=fe("p"),k.textContent=`This is an example of how one could use the plugin's extensibility interfaces to create a distance measurement tool
    out of it.`,o=Ve(),O=fe("p"),O.innerHTML=`Here we create a subclass of the <code>MapLibreGlDirections</code> main super class and augment the original
    <code>buildRoutelines</code>
    method to write each route leg&#39;s distance into a respective feature&#39;s <code>properties</code> object. These saved distances
    are then used by an additional &quot;symbol&quot; layer that displays them along the respective route&#39;s lines on the map.`,z=Ve(),ne=fe("p"),ne.textContent=`The total distance comes from the response's specific field and is updated each time there's the "fetchroutesend" or
    the "removewaypoint" event fired.`},m(xe,Ce){de(xe,f,Ce),Ae(f,v),ge.m(f,null),de(xe,E,Ce),de(xe,D,Ce),de(xe,S,Ce),de(xe,k,Ce),de(xe,o,Ce),de(xe,O,Ce),de(xe,z,Ce),de(xe,ne,Ce)},p(xe,Ce){ce===(ce=H(xe))&&ge?ge.p(xe,Ce):(ge.d(1),ge=ce(xe),ge&&(ge.c(),ge.m(f,null)))},d(xe){xe&&(pe(f),pe(E),pe(D),pe(S),pe(k),pe(o),pe(O),pe(z),pe(ne)),ge.d()}}}function c_(_){let f;return{c(){f=fe("span"),f.textContent=`${_[2].name}`,Oe(f,"slot","title")},m(v,E){de(v,f,E)},p:Vt,d(v){v&&pe(f)}}}function u_(_){let f,v,E,D;return f=new nr({props:{$$slots:{title:[c_],default:[l_]},$$scope:{ctx:_}}}),{c(){en(f.$$.fragment),v=Ve(),E=fe("div"),Oe(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,k){Wi(f,S,k),de(S,v,k),de(S,E,k),_[3](E),D=!0},p(S,[k]){const o={};k&66&&(o.$$scope={dirty:k,ctx:S}),f.$set(o)},i(S){D||(fi(f.$$.fragment,S),D=!0)},o(S){Ei(f.$$.fragment,S),D=!1},d(S){S&&(pe(v),pe(E)),Hi(f,S),_[3](null)}}}function h_(_,f,v){let E;tr(_,ir,z=>v(5,E=z));const D=kn.find(z=>z.path===E);let S,k,o=0;dr(()=>{const z=new fr.Map({container:S,style:mr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});z.on("load",()=>{k=new r_(z,s_),k.on("fetchroutesend",ne=>{var H;v(1,o=(H=ne.data)==null?void 0:H.routes[0].distance)}),k.on("removewaypoint",()=>{k.waypoints.length<2&&v(1,o=0)}),k.interactive=!0})});function O(z){qn[z?"unshift":"push"](()=>{S=z,v(0,S)})}return[S,o,D,O]}class p_ extends _n{constructor(f){super(),gn(this,f,h_,u_,ln,{})}}const d_=Object.freeze(Object.defineProperty({__proto__:null,default:p_},Symbol.toStringTag,{value:"Module"}));class f_ extends er{constructor(f,v){super(f,v)}get waypointsFeatures(){return this._waypoints}setWaypointsFeatures(f){this._waypoints=f,this.assignWaypointsCategories();const v=new uo("setwaypoints",void 0);this.fire(v),this.draw()}get snappointsFeatures(){return this.snappoints}setSnappointsFeatures(f){this.snappoints=f,this.draw()}get routelinesFeatures(){return this.routelines}setRoutelinesFeatures(f){this.routelines=f,this.draw()}}function m_(_){let f,v,E,D,S,k,o,O,z,ne,H,ce,ge,xe,Ce,Ne,Pe,rt,De,je,it;return{c(){f=fe("button"),v=Gi("Load the saved Route"),D=Ve(),S=fe("button"),k=Gi("Save the Route"),O=Ve(),z=fe("button"),ne=Gi("Clear"),ce=Ve(),ge=fe("small"),ge.innerHTML=`This example uses the <code>localStorage</code> to save routes, but you are obviously not restricted to it. There might
    instead be a file or a serverside-database or whatever else`,xe=Ve(),Ce=fe("p"),Ce.textContent=`If you want to save/load the route, the obvious way to do so would be to save the list of waypoints whenever the
    route is updated and to make a new routing-request with the saved waypoints' coordinates whenever you need to load
    it.`,Ne=Ve(),Pe=fe("p"),Pe.textContent=`But what if the underlying roads networks changes for some reason? You'll get a different route for the same set of
    waypoints. Moreover, if there are some severe construction works going on, you run into a risk of not getting any
    routes whatsoever.`,rt=Ve(),De=fe("p"),De.textContent=`Sometimes it's actually a good idea to save the route as a list of GeoJSON Features and be able to load these saved
    features whenever there's a need. This example shows how that could be done.`,f.disabled=E=!_[1]||_[2],S.disabled=o=!_[1],z.disabled=H=!_[1]},m(Le,Ke){de(Le,f,Ke),Ae(f,v),de(Le,D,Ke),de(Le,S,Ke),Ae(S,k),de(Le,O,Ke),de(Le,z,Ke),Ae(z,ne),de(Le,ce,Ke),de(Le,ge,Ke),de(Le,xe,Ke),de(Le,Ce,Ke),de(Le,Ne,Ke),de(Le,Pe,Ke),de(Le,rt,Ke),de(Le,De,Ke),je||(it=[Xt(f,"click",_[4]),Xt(S,"click",_[5]),Xt(z,"click",_[6])],je=!0)},p(Le,Ke){Ke&6&&E!==(E=!Le[1]||Le[2])&&(f.disabled=E),Ke&2&&o!==(o=!Le[1])&&(S.disabled=o),Ke&2&&H!==(H=!Le[1])&&(z.disabled=H)},d(Le){Le&&(pe(f),pe(D),pe(S),pe(O),pe(z),pe(ce),pe(ge),pe(xe),pe(Ce),pe(Ne),pe(Pe),pe(rt),pe(De)),je=!1,Ur(it)}}}function g_(_){let f;return{c(){f=fe("span"),f.textContent=`${_[3].name}`,Oe(f,"slot","title")},m(v,E){de(v,f,E)},p:Vt,d(v){v&&pe(f)}}}function __(_){let f,v,E,D;return f=new nr({props:{$$slots:{title:[g_],default:[m_]},$$scope:{ctx:_}}}),{c(){en(f.$$.fragment),v=Ve(),E=fe("div"),Oe(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,k){Wi(f,S,k),de(S,v,k),de(S,E,k),_[7](E),D=!0},p(S,[k]){const o={};k&518&&(o.$$scope={dirty:k,ctx:S}),f.$set(o)},i(S){D||(fi(f.$$.fragment,S),D=!0)},o(S){Ei(f.$$.fragment,S),D=!1},d(S){S&&(pe(v),pe(E)),Hi(f,S),_[7](null)}}}function td(){return localStorage.getItem("saved-waypoints-features")&&localStorage.getItem("saved-snappoints-features")&&localStorage.getItem("saved-routelines-features")}function y_(_,f,v){let E;tr(_,ir,ce=>v(8,E=ce));const D=kn.find(ce=>ce.path===E);let S,k;dr(()=>{const ce=new fr.Map({container:S,style:mr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});ce.on("load",()=>{v(1,k=new f_(ce)),v(1,k.interactive=!0,k)})});let o=!td();function O(){k.setWaypointsFeatures(JSON.parse(localStorage.getItem("saved-waypoints-features"))),k.setSnappointsFeatures(JSON.parse(localStorage.getItem("saved-snappoints-features"))),k.setRoutelinesFeatures(JSON.parse(localStorage.getItem("saved-routelines-features")))}function z(){localStorage.setItem("saved-waypoints-features",JSON.stringify(k.waypointsFeatures)),localStorage.setItem("saved-snappoints-features",JSON.stringify(k.snappointsFeatures)),localStorage.setItem("saved-routelines-features",JSON.stringify(k.routelinesFeatures)),v(2,o=!td())}const ne=()=>k.clear();function H(ce){qn[ce?"unshift":"push"](()=>{S=ce,v(0,S)})}return[S,k,o,D,O,z,ne,H]}class x_ extends _n{constructor(f){super(),gn(this,f,y_,__,ln,{})}}const v_=Object.freeze(Object.defineProperty({__proto__:null,default:x_},Symbol.toStringTag,{value:"Module"}));function b_(_){let f,v,E,D,S,k,o,O,z,ne,H,ce,ge,xe,Ce,Ne,Pe,rt,De,je,it,Le,Ke,ft,vt,Tt,Pi,Gt,oi,Xi,mi;return{c(){f=fe("small"),f.innerHTML="<strong>Note</strong> that interactivity is disabled for this example",v=Ve(),E=fe("div"),D=fe("p"),D.textContent="Set waypoints to a predefined set",S=Ve(),k=fe("button"),o=Gi("Set Waypoints"),z=Ve(),ne=fe("div"),H=fe("p"),H.textContent="Add a random waypoint at some random index",ce=Ve(),ge=fe("button"),xe=Gi("Add Waypoint"),Ne=Ve(),Pe=fe("div"),rt=fe("p"),rt.textContent="Delete a random waypoint",De=Ve(),je=fe("button"),it=Gi("Delete Waypoint"),Ke=Ve(),ft=fe("div"),vt=fe("p"),vt.textContent="Clear the map from all the stuff added by the plugin",Tt=Ve(),Pi=fe("button"),Gt=Gi("Clear"),k.disabled=O=!_[1],Oe(k,"class","self-center"),Oe(E,"class","flex flex-col gap-2"),ge.disabled=Ce=!_[1],Oe(ge,"class","self-center"),Oe(ne,"class","flex flex-col gap-2"),je.disabled=Le=!_[1],Oe(je,"class","self-center"),Oe(Pe,"class","flex flex-col gap-2"),Pi.disabled=oi=!_[1],Oe(Pi,"class","self-center"),Oe(ft,"class","flex flex-col gap-2")},m(Dt,Wt){de(Dt,f,Wt),de(Dt,v,Wt),de(Dt,E,Wt),Ae(E,D),Ae(E,S),Ae(E,k),Ae(k,o),de(Dt,z,Wt),de(Dt,ne,Wt),Ae(ne,H),Ae(ne,ce),Ae(ne,ge),Ae(ge,xe),de(Dt,Ne,Wt),de(Dt,Pe,Wt),Ae(Pe,rt),Ae(Pe,De),Ae(Pe,je),Ae(je,it),de(Dt,Ke,Wt),de(Dt,ft,Wt),Ae(ft,vt),Ae(ft,Tt),Ae(ft,Pi),Ae(Pi,Gt),Xi||(mi=[Xt(k,"click",_[3]),Xt(ge,"click",_[4]),Xt(je,"click",_[5]),Xt(Pi,"click",_[6])],Xi=!0)},p(Dt,Wt){Wt&2&&O!==(O=!Dt[1])&&(k.disabled=O),Wt&2&&Ce!==(Ce=!Dt[1])&&(ge.disabled=Ce),Wt&2&&Le!==(Le=!Dt[1])&&(je.disabled=Le),Wt&2&&oi!==(oi=!Dt[1])&&(Pi.disabled=oi)},d(Dt){Dt&&(pe(f),pe(v),pe(E),pe(z),pe(ne),pe(Ne),pe(Pe),pe(Ke),pe(ft)),Xi=!1,Ur(mi)}}}function w_(_){let f;return{c(){f=fe("span"),f.textContent=`${_[2].name}`,Oe(f,"slot","title")},m(v,E){de(v,f,E)},p:Vt,d(v){v&&pe(f)}}}function T_(_){let f,v,E,D;return f=new nr({props:{$$slots:{title:[w_],default:[b_]},$$scope:{ctx:_}}}),{c(){en(f.$$.fragment),v=Ve(),E=fe("div"),Oe(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,k){Wi(f,S,k),de(S,v,k),de(S,E,k),_[7](E),D=!0},p(S,[k]){const o={};k&1026&&(o.$$scope={dirty:k,ctx:S}),f.$set(o)},i(S){D||(fi(f.$$.fragment,S),D=!0)},o(S){Ei(f.$$.fragment,S),D=!1},d(S){S&&(pe(v),pe(E)),Hi(f,S),_[7](null)}}}function S_(_,f,v){let E;tr(_,ir,ge=>v(9,E=ge));const D=kn.find(ge=>ge.path===E);let S,k,o;dr(()=>{const ge=new fr.Map({container:S,style:mr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});ge.on("load",()=>{k=ge,v(1,o=new er(k,{requestOptions:{alternatives:"true"}}))})});function O(){o==null||o.setWaypoints([[-74.21349031181673,40.704951524836275],[-74.19666749687558,40.738517300855904],[-74.16611177177786,40.76634583723629],[-74.07169801445302,40.719004374548206],[-73.99170381279369,40.725509319065594],[-73.98071748466812,40.762445342516145]])}function z(){const ge=k==null?void 0:k.getBounds(),xe=k==null?void 0:k.getCenter();if(ge&&xe){const Ce=ge.getEast()-ge.getWest(),Ne=ge.getSouth()-ge.getNorth();o==null||o.addWaypoint([xe.lng-Ce/2+Ce*Math.random(),xe.lat-Ne/2+Ne*Math.random()],(o==null?void 0:o.waypoints.length)*Math.random()|0)}}function ne(){o==null||o.removeWaypoint((o==null?void 0:o.waypoints.length)*Math.random()|0)}function H(){o==null||o.clear()}function ce(ge){qn[ge?"unshift":"push"](()=>{S=ge,v(0,S)})}return[S,o,D,O,z,ne,H,ce]}class E_ extends _n{constructor(f){super(),gn(this,f,S_,T_,ln,{})}}const A_=Object.freeze(Object.defineProperty({__proto__:null,default:E_},Symbol.toStringTag,{value:"Module"}));function I_(_){let f,v,E,D,S,k,o,O,z,ne,H,ce,ge,xe,Ce,Ne,Pe,rt,De,je,it;return{c(){f=fe("label"),v=fe("span"),v.innerHTML="<strong>Congestions</strong>",E=Ve(),D=fe("select"),S=fe("option"),S.textContent="Stringy",k=fe("option"),k.textContent="Numeric",O=Ve(),z=fe("p"),z.textContent="This example makes POST requests to the official Mapbox Directions API with the following options:",ne=Ve(),H=fe("ul"),ce=fe("li"),ge=fe("strong"),xe=Gi("annotations="),Ce=Gi(_[1]),Ne=Ve(),Pe=fe("li"),Pe.textContent="overview=full",rt=Ve(),De=fe("li"),De.textContent="alternatives=true",S.__value="congestion",Zt(S,S.__value),k.__value="congestion_numeric",Zt(k,k.__value),D.disabled=o=!_[0],_[1]===void 0&&dl(()=>_[5].call(D)),Oe(f,"class","flex flex-col gap-2")},m(Le,Ke){de(Le,f,Ke),Ae(f,v),Ae(f,E),Ae(f,D),Ae(D,S),Ae(D,k),vc(D,_[1],!0),de(Le,O,Ke),de(Le,z,Ke),de(Le,ne,Ke),de(Le,H,Ke),Ae(H,ce),Ae(ce,ge),Ae(ge,xe),Ae(ge,Ce),Ae(H,Ne),Ae(H,Pe),Ae(H,rt),Ae(H,De),je||(it=Xt(D,"change",_[5]),je=!0)},p(Le,Ke){Ke&1&&o!==(o=!Le[0])&&(D.disabled=o),Ke&2&&vc(D,Le[1]),Ke&2&&Xu(Ce,Le[1])},d(Le){Le&&(pe(f),pe(O),pe(z),pe(ne),pe(H)),je=!1,it()}}}function M_(_){let f;return{c(){f=fe("span"),f.textContent=`${_[3].name}`,Oe(f,"slot","title")},m(v,E){de(v,f,E)},p:Vt,d(v){v&&pe(f)}}}function C_(_){let f,v,E,D;return f=new nr({props:{$$slots:{title:[M_],default:[I_]},$$scope:{ctx:_}}}),{c(){en(f.$$.fragment),v=Ve(),E=fe("div"),Oe(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,k){Wi(f,S,k),de(S,v,k),de(S,E,k),_[6](E),D=!0},p(S,[k]){const o={};k&259&&(o.$$scope={dirty:k,ctx:S}),f.$set(o)},i(S){D||(fi(f.$$.fragment,S),D=!0)},o(S){Ei(f.$$.fragment,S),D=!1},d(S){S&&(pe(v),pe(E)),Hi(f,S),_[6](null)}}}function P_(_,f,v){let E;tr(_,ir,H=>v(7,E=H));const D=kn.find(H=>H.path===E);let S,k,o,O="congestion";dr(()=>{const H=new fr.Map({container:S,style:mr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='//docs.mapbox.com/help/getting-started/directions/' target='_blank'>&copy; Mapbox Directions</a>"});H.on("load",()=>{v(4,k=H)})});function z(){O=cd(this),v(1,O)}function ne(H){qn[H?"unshift":"push"](()=>{S=H,v(2,S)})}return _.$$.update=()=>{_.$$.dirty&19&&k&&(o&&o.destroy(),v(0,o=new er(k,{api:"https://api.mapbox.com/directions/v5",profile:"mapbox/driving-traffic",makePostRequest:!0,requestOptions:{access_token:"pk.eyJ1Ijoic21lbGx5c2hvdmVsIiwiYSI6ImNsMW80eXQ4aTEwN3czcG8zMXM2NzJ2ODIifQ.oWHUIUiEj2SS4_hue3qv2g",alternatives:"true",annotations:O,overview:"full"}})),v(0,o.interactive=!0,o))},[o,O,S,D,k,z,ne]}class k_ extends _n{constructor(f){super(),gn(this,f,P_,C_,ln,{})}}const z_=Object.freeze(Object.defineProperty({__proto__:null,default:k_},Symbol.toStringTag,{value:"Module"}));function D_(_){let f,v,E;return{c(){f=fe("p"),f.textContent=`In this example the default layers used by the plugin are augmented with an additional "symbol" layer which is only
    rendered for the ORIGIN and DESTINATION waypoints.`,v=Ve(),E=fe("p"),E.innerHTML=`<strong>Note</strong> how you don&#39;t need to re-define all the layers from scratch thanks to the exported
    <code>layersFactory</code> function that returns all the default layers allowing for their augmentation and modification`},m(D,S){de(D,f,S),de(D,v,S),de(D,E,S)},p:Vt,d(D){D&&(pe(f),pe(v),pe(E))}}}function L_(_){let f;return{c(){f=fe("span"),f.textContent=`${_[1].name}`,Oe(f,"slot","title")},m(v,E){de(v,f,E)},p:Vt,d(v){v&&pe(f)}}}function R_(_){let f,v,E,D;return f=new nr({props:{$$slots:{title:[L_],default:[D_]},$$scope:{ctx:_}}}),{c(){en(f.$$.fragment),v=Ve(),E=fe("div"),Oe(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,k){Wi(f,S,k),de(S,v,k),de(S,E,k),_[2](E),D=!0},p(S,[k]){const o={};k&32&&(o.$$scope={dirty:k,ctx:S}),f.$set(o)},i(S){D||(fi(f.$$.fragment,S),D=!0)},o(S){Ei(f.$$.fragment,S),D=!1},d(S){S&&(pe(v),pe(E)),Hi(f,S),_[2](null)}}}function B_(_,f,v){let E;tr(_,ir,O=>v(4,E=O));const D=kn.find(O=>O.path===E);let S,k;dr(()=>{const O=new fr.Map({container:S,style:mr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>",fadeDuration:0}),z=Pc();z.push({id:"maplibre-gl-directions-waypoint-label",type:"symbol",source:"maplibre-gl-directions",layout:{"text-field":["case",["==",["get","category"],"ORIGIN"],"A",["==",["get","category"],"DESTINATION"],"B",""]},paint:{"text-color":"#ffffff","text-opacity":.7},filter:["all",["==",["geometry-type"],"Point"],["==",["get","type"],"WAYPOINT"],["in",["get","category"],["literal",["ORIGIN","DESTINATION"]]]]}),O.on("load",()=>{k=new er(O,{requestOptions:{alternatives:"true"},layers:z}),k.interactive=!0})});function o(O){qn[O?"unshift":"push"](()=>{S=O,v(0,S)})}return[S,D,o]}class F_ extends _n{constructor(f){super(),gn(this,f,B_,R_,ln,{})}}const O_=Object.freeze(Object.defineProperty({__proto__:null,default:F_},Symbol.toStringTag,{value:"Module"})),U_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAKRJREFUOE+lkkEOAVEQRF9tJBwCZxhHEFYOIXMWNuIynIOFI7B3hpKeDBFh0ub/ddfrX10lCp8K9aQAtsexSNLtc2EWsANqYC7p8g7JAobAEZgBS0mnJyQFiGHbXyFpwC+IbE+BDTBIJhI/WQH3sBSACbDtCahKLCwkndMA2yPg0CbRiJtuZHy34oixAl7ifwB7YF1SpDh0VPnaq8pdNlM36AI8AK1AOkjqIJazAAAAAElFTkSuQmCC";function V_(_){let f,v,E,D,S;return{c(){f=fe("p"),f.textContent="Another example that demonstrates the ease of extending the original styles provided by the plugin.",v=Ve(),E=fe("p"),E.textContent='This time a "symbol" layer is added that shows the direction the selected route goes in.',D=Ve(),S=fe("small"),S.innerHTML=`<strong>Note</strong> that you have to manually load and add the images you intend to use for the custom layers you
    add`},m(k,o){de(k,f,o),de(k,v,o),de(k,E,o),de(k,D,o),de(k,S,o)},p:Vt,d(k){k&&(pe(f),pe(v),pe(E),pe(D),pe(S))}}}function $_(_){let f;return{c(){f=fe("span"),f.textContent=`${_[1].name}`,Oe(f,"slot","title")},m(v,E){de(v,f,E)},p:Vt,d(v){v&&pe(f)}}}function N_(_){let f,v,E,D;return f=new nr({props:{$$slots:{title:[$_],default:[V_]},$$scope:{ctx:_}}}),{c(){en(f.$$.fragment),v=Ve(),E=fe("div"),Oe(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,k){Wi(f,S,k),de(S,v,k),de(S,E,k),_[2](E),D=!0},p(S,[k]){const o={};k&32&&(o.$$scope={dirty:k,ctx:S}),f.$set(o)},i(S){D||(fi(f.$$.fragment,S),D=!0)},o(S){Ei(f.$$.fragment,S),D=!1},d(S){S&&(pe(v),pe(E)),Hi(f,S),_[2](null)}}}function j_(_,f,v){let E;tr(_,ir,O=>v(4,E=O));const D=kn.find(O=>O.path===E);let S,k;dr(()=>{const O=new fr.Map({container:S,style:mr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});O.loadImage(U_,(ne,H)=>{!ne&&H&&O.addImage("direction-arrow",H)});const z=Pc();z.push({id:"maplibre-gl-directions-routeline-direction-arrow",type:"symbol",source:"maplibre-gl-directions",layout:{"symbol-placement":"line-center","icon-image":"direction-arrow","icon-size":["interpolate",["exponential",1.5],["zoom"],12,.85,18,1.4]},paint:{"icon-opacity":.5},filter:["==",["get","route"],"SELECTED"]}),O.on("load",()=>{k=new er(O,{requestOptions:{alternatives:"true"},layers:z}),k.interactive=!0})});function o(O){qn[O?"unshift":"push"](()=>{S=O,v(0,S)})}return[S,D,o]}class q_ extends _n{constructor(f){super(),gn(this,f,j_,N_,ln,{})}}const Z_=Object.freeze(Object.defineProperty({__proto__:null,default:q_},Symbol.toStringTag,{value:"Module"}));function G_(_){let f,v,E,D,S,k,o,O,z,ne,H,ce,ge;return{c(){f=fe("label"),v=fe("input"),D=Ve(),S=fe("strong"),S.textContent="Simulate a Touch-Enabled Device",k=Ve(),o=fe("p"),o.textContent=`Sometimes it's pretty hard to aim exactly at the selected route line to add a waypoint by dragging it when using the
    plugin on a touch device.`,O=Ve(),z=fe("p"),z.innerHTML=`The example shows how one could use the <code>layersFactory</code>&#39;s input parameters to handle that case by
    increasing the points by 1.5 and the lines by 2 times when the map is used on a touch-enabled device.`,ne=Ve(),H=fe("small"),H.innerHTML=`<strong>Note</strong> that you can either load the page on a touch-enabled device or toggle the checkbox above: both
    options apply the same effect`,Oe(v,"type","checkbox"),v.disabled=E=!_[0],Oe(f,"class","flex items-center gap-3")},m(xe,Ce){de(xe,f,Ce),Ae(f,v),v.checked=_[1],Ae(f,D),Ae(f,S),de(xe,k,Ce),de(xe,o,Ce),de(xe,O,Ce),de(xe,z,Ce),de(xe,ne,Ce),de(xe,H,Ce),ce||(ge=Xt(v,"change",_[5]),ce=!0)},p(xe,Ce){Ce&1&&E!==(E=!xe[0])&&(v.disabled=E),Ce&2&&(v.checked=xe[1])},d(xe){xe&&(pe(f),pe(k),pe(o),pe(O),pe(z),pe(ne),pe(H)),ce=!1,ge()}}}function W_(_){let f;return{c(){f=fe("span"),f.textContent=`${_[3].name}`,Oe(f,"slot","title")},m(v,E){de(v,f,E)},p:Vt,d(v){v&&pe(f)}}}function H_(_){let f,v,E,D;return f=new nr({props:{$$slots:{title:[W_],default:[G_]},$$scope:{ctx:_}}}),{c(){en(f.$$.fragment),v=Ve(),E=fe("div"),Oe(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,k){Wi(f,S,k),de(S,v,k),de(S,E,k),_[6](E),D=!0},p(S,[k]){const o={};k&259&&(o.$$scope={dirty:k,ctx:S}),f.$set(o)},i(S){D||(fi(f.$$.fragment,S),D=!0)},o(S){Ei(f.$$.fragment,S),D=!1},d(S){S&&(pe(v),pe(E)),Hi(f,S),_[6](null)}}}function X_(_,f,v){let E;tr(_,ir,H=>v(7,E=H));const D=kn.find(H=>H.path===E);let S,k,o,O="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;dr(()=>{const H=new fr.Map({container:S,style:mr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});H.on("load",()=>{v(4,k=H)})});function z(){O=this.checked,v(1,O)}function ne(H){qn[H?"unshift":"push"](()=>{S=H,v(2,S)})}return _.$$.update=()=>{if(_.$$.dirty&19&&k){o&&o.destroy();const H=Pc(O?1.5:1,O?2:1);v(0,o=new er(k,{requestOptions:{alternatives:"true"},layers:H})),v(0,o.interactive=!0,o)}},[o,O,S,D,k,z,ne]}class Y_ extends _n{constructor(f){super(),gn(this,f,X_,H_,ln,{})}}const K_=Object.freeze(Object.defineProperty({__proto__:null,default:Y_},Symbol.toStringTag,{value:"Module"}));function id(_,f,v){const E=_.slice();return E[7]=f[v],E}function nd(_){let f,v=_[7]+"";return{c(){f=fe("li")},m(E,D){de(E,f,D),f.innerHTML=v},p(E,D){D&2&&v!==(v=E[7]+"")&&(f.innerHTML=v)},d(E){E&&pe(f)}}}function rd(_){let f,v,E;return{c(){f=fe("button"),f.textContent="Clear"},m(D,S){de(D,f,S),v||(E=Xt(f,"click",_[3]),v=!0)},p:Vt,d(D){D&&pe(f),v=!1,E()}}}function J_(_){let f,v,E,D,S,k=ju(_[1]),o=[];for(let z=0;z<k.length;z+=1)o[z]=nd(id(_,k,z));let O=_[1].length&&rd(_);return{c(){f=fe("p"),f.textContent=`This example listens for all the available events and logs them below. Interact with the map to see the emitted
    events.`,v=Ve(),E=fe("ol");for(let z=0;z<o.length;z+=1)o[z].c();D=Ve(),O&&O.c(),S=Mc()},m(z,ne){de(z,f,ne),de(z,v,ne),de(z,E,ne);for(let H=0;H<o.length;H+=1)o[H]&&o[H].m(E,null);de(z,D,ne),O&&O.m(z,ne),de(z,S,ne)},p(z,ne){if(ne&2){k=ju(z[1]);let H;for(H=0;H<k.length;H+=1){const ce=id(z,k,H);o[H]?o[H].p(ce,ne):(o[H]=nd(ce),o[H].c(),o[H].m(E,null))}for(;H<o.length;H+=1)o[H].d(1);o.length=k.length}z[1].length?O?O.p(z,ne):(O=rd(z),O.c(),O.m(S.parentNode,S)):O&&(O.d(1),O=null)},d(z){z&&(pe(f),pe(v),pe(E),pe(D),pe(S)),ld(o,z),O&&O.d(z)}}}function Q_(_){let f;return{c(){f=fe("span"),f.textContent=`${_[2].name}`,Oe(f,"slot","title")},m(v,E){de(v,f,E)},p:Vt,d(v){v&&pe(f)}}}function ey(_){let f,v,E,D;return f=new nr({props:{$$slots:{title:[Q_],default:[J_]},$$scope:{ctx:_}}}),{c(){en(f.$$.fragment),v=Ve(),E=fe("div"),Oe(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,k){Wi(f,S,k),de(S,v,k),de(S,E,k),_[4](E),D=!0},p(S,[k]){const o={};k&1026&&(o.$$scope={dirty:k,ctx:S}),f.$set(o)},i(S){D||(fi(f.$$.fragment,S),D=!0)},o(S){Ei(f.$$.fragment,S),D=!1},d(S){S&&(pe(v),pe(E)),Hi(f,S),_[4](null)}}}function ty(_,f,v){let E;tr(_,ir,ne=>v(6,E=ne));const D=kn.find(ne=>ne.path===E);let S,k,o=[];dr(()=>{const ne=new fr.Map({container:S,style:mr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});ne.on("load",()=>{k=new er(ne,{requestOptions:{alternatives:"true"}}),k.interactive=!0,k.on("addwaypoint",H=>{var ce,ge;o.push(`<strong>${H.type}</strong>: waypoint added at index <strong>${(ce=H.data)==null?void 0:ce.index}</strong>. Original event - <strong>${(ge=H.originalEvent)==null?void 0:ge.type}</strong>`),v(1,o)}),k.on("removewaypoint",H=>{var ce,ge;o.push(`<strong>${H.type}</strong>: waypoint removed at index <strong>${(ce=H.data)==null?void 0:ce.index}</strong>. Original event - <strong>${(ge=H.originalEvent)==null?void 0:ge.type}</strong>`),v(1,o)}),k.on("movewaypoint",H=>{var ce,ge,xe,Ce;o.push(`<strong>${H.type}</strong>: waypoint at index <strong>${(ce=H.data)==null?void 0:ce.index}</strong> moved from coordinates ${(xe=(ge=H.data)==null?void 0:ge.initialCoordinates)==null?void 0:xe.map(Ne=>Ne.toFixed(5)).join(", ")}. Original event - <strong>${(Ce=H.originalEvent)==null?void 0:Ce.type}</strong>`),v(1,o)}),k.on("fetchroutesstart",H=>{o.push(`<strong>${H.type}</strong>: routing request started. Original event - <strong>${H.originalEvent.type}</strong>`),v(1,o)}),k.on("fetchroutesend",H=>{var ce;o.push(`<strong>${H.type}</strong>: routing request finished with code <strong>${(ce=H.data)==null?void 0:ce.code}</strong>. Original event - <strong>${H.originalEvent.type}</strong>`),v(1,o)})})});const O=()=>v(1,o=[]);function z(ne){qn[ne?"unshift":"push"](()=>{S=ne,v(0,S)})}return[S,o,D,O,z]}class iy extends _n{constructor(f){super(),gn(this,f,ty,ey,ln,{})}}const ny=Object.freeze(Object.defineProperty({__proto__:null,default:iy},Symbol.toStringTag,{value:"Module"}));function ry(_){let f,v,E,D,S,k,o,O,z,ne,H,ce,ge,xe,Ce;return{c(){f=fe("button"),v=Gi("Abort Manually"),D=Ve(),S=fe("p"),S.innerHTML=`Instead of aborting routing-requests manually, you can set the <code>requestTimeout</code> configuration option to a
    number of ms that a routing-request is allowed to take before getting automatically aborted.`,k=Ve(),o=fe("label"),O=fe("span"),O.innerHTML="<strong>Request Timeout</strong>",z=Ve(),ne=fe("input"),ce=Ve(),ge=fe("small"),ge.innerHTML=`<strong>Note</strong> that you may need to manually
    <a href="https://www.browserstack.com/guide/how-to-perform-network-throttling-in-chrome" target="_blank" rel="noreferrer">enable network throttling</a> for the setting above to take effect`,f.disabled=E=!_[0],Oe(ne,"type","number"),ne.disabled=H=!_[0],Oe(o,"class","flex flex-col gap-2")},m(Ne,Pe){de(Ne,f,Pe),Ae(f,v),de(Ne,D,Pe),de(Ne,S,Pe),de(Ne,k,Pe),de(Ne,o,Pe),Ae(o,O),Ae(o,z),Ae(o,ne),Zt(ne,_[1]),de(Ne,ce,Pe),de(Ne,ge,Pe),xe||(Ce=[Xt(f,"click",_[4]),Xt(ne,"input",_[6])],xe=!0)},p(Ne,Pe){Pe&1&&E!==(E=!Ne[0])&&(f.disabled=E),Pe&1&&H!==(H=!Ne[0])&&(ne.disabled=H),Pe&2&&di(ne.value)!==Ne[1]&&Zt(ne,Ne[1])},d(Ne){Ne&&(pe(f),pe(D),pe(S),pe(k),pe(o),pe(ce),pe(ge)),xe=!1,Ur(Ce)}}}function sy(_){let f;return{c(){f=fe("span"),f.textContent=`${_[3].name}`,Oe(f,"slot","title")},m(v,E){de(v,f,E)},p:Vt,d(v){v&&pe(f)}}}function oy(_){let f,v,E,D;return f=new nr({props:{$$slots:{title:[sy],default:[ry]},$$scope:{ctx:_}}}),{c(){en(f.$$.fragment),v=Ve(),E=fe("div"),Oe(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,k){Wi(f,S,k),de(S,v,k),de(S,E,k),_[7](E),D=!0},p(S,[k]){const o={};k&515&&(o.$$scope={dirty:k,ctx:S}),f.$set(o)},i(S){D||(fi(f.$$.fragment,S),D=!0)},o(S){Ei(f.$$.fragment,S),D=!1},d(S){S&&(pe(v),pe(E)),Hi(f,S),_[7](null)}}}function ay(_,f,v){let E;tr(_,ir,ce=>v(8,E=ce));const D=kn.find(ce=>ce.path===E);let S,k,o,O=1e3;dr(()=>{const ce=new fr.Map({container:S,style:mr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank' rel='noreferrer'>&copy; OSRM</a>"});ce.on("load",()=>{v(5,k=ce)})});function z(){var ce;(ce=o==null?void 0:o.abortController)==null||ce.abort()}function ne(){O=di(this.value),v(1,O)}function H(ce){qn[ce?"unshift":"push"](()=>{S=ce,v(2,S)})}return _.$$.update=()=>{_.$$.dirty&35&&k&&(o&&o.destroy(),v(0,o=new er(k,{requestOptions:{alternatives:"true"},requestTimeout:O})),v(0,o.interactive=!0,o))},[o,O,S,D,z,k,ne,H]}class ly extends _n{constructor(f){super(),gn(this,f,ay,oy,ln,{})}}const cy=Object.freeze(Object.defineProperty({__proto__:null,default:ly},Symbol.toStringTag,{value:"Module"}));function uy(_){let f,v,E,D,S,k,o,O,z,ne,H,ce,ge;return{c(){f=fe("label"),v=fe("span"),v.innerHTML="<strong>Position</strong>",E=Ve(),D=fe("select"),S=fe("option"),S.textContent="Top-Left",k=fe("option"),k.textContent="Top-Right",o=fe("option"),o.textContent="Bottom-Left",O=fe("option"),O.textContent="Bottom-Right",ne=Ve(),H=fe("p"),H.innerHTML=`The <code>LoadingIndicatorControl</code> adds a simple spinning loader-icon which automatically appears whenever there&#39;s
    an ongoing routing-request.`,S.__value="top-left",Zt(S,S.__value),k.__value="top-right",Zt(k,k.__value),o.__value="bottom-left",Zt(o,o.__value),O.__value="bottom-right",Zt(O,O.__value),D.disabled=z=!_[0],_[1]===void 0&&dl(()=>_[6].call(D)),Oe(f,"class","flex flex-col gap-2")},m(xe,Ce){de(xe,f,Ce),Ae(f,v),Ae(f,E),Ae(f,D),Ae(D,S),Ae(D,k),Ae(D,o),Ae(D,O),vc(D,_[1],!0),de(xe,ne,Ce),de(xe,H,Ce),ce||(ge=Xt(D,"change",_[6]),ce=!0)},p(xe,Ce){Ce&1&&z!==(z=!xe[0])&&(D.disabled=z),Ce&2&&vc(D,xe[1])},d(xe){xe&&(pe(f),pe(ne),pe(H)),ce=!1,ge()}}}function hy(_){let f;return{c(){f=fe("span"),f.textContent=`${_[3].name}`,Oe(f,"slot","title")},m(v,E){de(v,f,E)},p:Vt,d(v){v&&pe(f)}}}function py(_){let f,v,E,D;return f=new nr({props:{$$slots:{title:[hy],default:[uy]},$$scope:{ctx:_}}}),{c(){en(f.$$.fragment),v=Ve(),E=fe("div"),Oe(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,k){Wi(f,S,k),de(S,v,k),de(S,E,k),_[7](E),D=!0},p(S,[k]){const o={};k&515&&(o.$$scope={dirty:k,ctx:S}),f.$set(o)},i(S){D||(fi(f.$$.fragment,S),D=!0)},o(S){Ei(f.$$.fragment,S),D=!1},d(S){S&&(pe(v),pe(E)),Hi(f,S),_[7](null)}}}function dy(_,f,v){let E;tr(_,ir,ce=>v(8,E=ce));const D=kn.find(ce=>ce.path===E);let S,k,o;dr(()=>{v(4,k=new fr.Map({container:S,style:mr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"})),k.on("load",()=>{v(0,o=new er(k,{requestOptions:{alternatives:"true"}})),v(0,o.interactive=!0,o)})});let O,z="top-right";function ne(){z=cd(this),v(1,z)}function H(ce){qn[ce?"unshift":"push"](()=>{S=ce,v(2,S)})}return _.$$.update=()=>{_.$$.dirty&51&&k&&o&&(O&&k.hasControl(O)&&k.removeControl(O),k.addControl(v(5,O=new Ig(o,{class:"m-2"})),z))},[o,z,S,D,k,O,ne,H]}class fy extends _n{constructor(f){super(),gn(this,f,dy,py,ln,{})}}const my=Object.freeze(Object.defineProperty({__proto__:null,default:fy},Symbol.toStringTag,{value:"Module"}));function gy(_,f,v){const E=_.slice();return E[0]=f[v],E}function _y(_){let f,v,E,D,S;return{c(){f=fe("li"),v=fe("a"),v.textContent=`${_[0].name}`,E=Ve(),Oe(v,"href",_[0].path),Oe(v,"class","svelte-1jo4v3w"),Oe(f,"class","svelte-1jo4v3w")},m(k,o){de(k,f,o),Ae(f,v),Ae(f,E),D||(S=Hu(Qu.call(null,v)),D=!0)},p:Vt,d(k){k&&pe(f),D=!1,S()}}}function yy(_){let f,v=ju(kn.sort(by)),E=[];for(let D=0;D<v.length;D+=1)E[D]=_y(gy(_,v,D));return{c(){f=fe("ul");for(let D=0;D<E.length;D+=1)E[D].c();Oe(f,"class","svelte-1jo4v3w")},m(D,S){de(D,f,S);for(let k=0;k<E.length;k+=1)E[k]&&E[k].m(f,null)},p:Vt,d(D){D&&pe(f),ld(E,D)}}}function xy(_){let f;return{c(){f=fe("span"),f.textContent="Examples",Oe(f,"slot","title"),Oe(f,"class","svelte-1jo4v3w")},m(v,E){de(v,f,E)},p:Vt,d(v){v&&pe(f)}}}function vy(_){let f,v,E,D;return f=new nr({props:{noHeader:!0,$$slots:{title:[xy],default:[yy]},$$scope:{ctx:_}}}),{c(){en(f.$$.fragment),v=Ve(),E=fe("div"),E.innerHTML='<div class="p-5 lg:p-10 h-full flex flex-col gap-5 lg:gap-10 justify-start lg:justify-center items-center flex-col bg-inherit overflow-x-hidden overflow-y-auto svelte-1jo4v3w"><h1 class="text-center max-w-3xl svelte-1jo4v3w">Please, choose an example at the sidebar on the left</h1> <span class="text-slate-500 svelte-1jo4v3w">or navigate to</span> <div class="flex flex-col gap-2.5 lg:gap-5 justify-center items-center svelte-1jo4v3w"><a href="https://github.com/maplibre/maplibre-gl-directions" target="_blank" rel="noreferrer" class="svelte-1jo4v3w">GitHub</a> <a href="/maplibre-gl-directions//api" target="_blank" rel="noreferrer" class="svelte-1jo4v3w">API</a></div></div>',Oe(E,"class","basis-full lg:basis-2/3 overflow-hidden rounded-3xl shadow-xl svelte-1jo4v3w")},m(S,k){Wi(f,S,k),de(S,v,k),de(S,E,k),D=!0},p(S,[k]){const o={};k&8&&(o.$$scope={dirty:k,ctx:S}),f.$set(o)},i(S){D||(fi(f.$$.fragment,S),D=!0)},o(S){Ei(f.$$.fragment,S),D=!1},d(S){S&&(pe(v),pe(E)),Hi(f,S)}}}const by=(_,f)=>_.index-f.index;class wy extends _n{constructor(f){super(),gn(this,f,null,vy,ln,{})}}const kn=Object.entries(Object.assign({"./examples/1 User Interaction.svelte":Vg,"./examples/10 Bearings Support and Control.svelte":Gg,"./examples/11 Restyling.svelte":n_,"./examples/12 Distance Measurement.svelte":d_,"./examples/13 Load and Save.svelte":v_,"./examples/2 Programmatical Control.svelte":A_,"./examples/3 Mapbox Directions API and Congestions.svelte":z_,"./examples/4 Origin and Destination.svelte":O_,"./examples/5 Show Routes' Directions.svelte":Z_,"./examples/6 Touch-Friendly Features.svelte":K_,"./examples/7 Events.svelte":ny,"./examples/8 Aborting Requests.svelte":cy,"./examples/9 Loading Indicator Control.svelte":my})).map(([_,f])=>{const v=_.match(/\/(\d+)\s([^/]+)\./),E=parseInt(v[1]),D=v[2];return{path:"/examples/"+D.toLowerCase().replaceAll(/\s/g,"-"),index:E,name:D,component:f,sourceUrl:`https://github.com/maplibre/maplibre-gl-directions/tree/main/demo/src/${_}`}}),eh={};kn.forEach(_=>{eh[_.path]=_.component.default});eh["*"]=wy;function Ty(_){let f,v,E;return v=new Gm({props:{routes:eh}}),{c(){f=fe("main"),en(v.$$.fragment),Oe(f,"class","p-5 lg:p-10 flex flex-col lg:flex-row landscape:flex-row w-full gap-5 lg:gap-10")},m(D,S){de(D,f,S),Wi(v,f,null),E=!0},p:Vt,i(D){E||(fi(v.$$.fragment,D),E=!0)},o(D){Ei(v.$$.fragment,D),E=!1},d(D){D&&pe(f),Hi(v)}}}class Sy extends _n{constructor(f){super(),gn(this,f,null,Ty,ln,{})}}new Sy({target:document.getElementById("app")});
