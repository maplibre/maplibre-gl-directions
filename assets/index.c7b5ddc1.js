var _f=Object.defineProperty;var yf=(v,f,y)=>f in v?_f(v,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):v[f]=y;var Wc=(v,f,y)=>(yf(v,typeof f!="symbol"?f+"":f,y),y);(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const D of document.querySelectorAll('link[rel="modulepreload"]'))z(D);new MutationObserver(D=>{for(const A of D)if(A.type==="childList")for(const P of A.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&z(P)}).observe(document,{childList:!0,subtree:!0});function y(D){const A={};return D.integrity&&(A.integrity=D.integrity),D.referrerpolicy&&(A.referrerPolicy=D.referrerpolicy),D.crossorigin==="use-credentials"?A.credentials="include":D.crossorigin==="anonymous"?A.credentials="omit":A.credentials="same-origin",A}function z(D){if(D.ep)return;D.ep=!0;const A=y(D);fetch(D.href,A)}})();function Ut(){}function eu(v,f){for(const y in f)v[y]=f[y];return v}function np(v){return v()}function kh(){return Object.create(null)}function sr(v){v.forEach(np)}function tu(v){return typeof v=="function"}function Bi(v,f){return v!=v?f==f:v!==f||v&&typeof v=="object"||typeof v=="function"}function xf(v){return Object.keys(v).length===0}function rp(v,...f){if(v==null)return Ut;const y=v.subscribe(...f);return y.unsubscribe?()=>y.unsubscribe():y}function wn(v,f,y){v.$$.on_destroy.push(rp(f,y))}function Ph(v,f,y,z){if(v){const D=sp(v,f,y,z);return v[0](D)}}function sp(v,f,y,z){return v[1]&&z?eu(y.ctx.slice(),v[1](z(f))):y.ctx}function Mh(v,f,y,z){if(v[2]&&z){const D=v[2](z(y));if(f.dirty===void 0)return D;if(typeof D=="object"){const A=[],P=Math.max(f.dirty.length,D.length);for(let o=0;o<P;o+=1)A[o]=f.dirty[o]|D[o];return A}return f.dirty|D}return f.dirty}function Dh(v,f,y,z,D,A){if(D){const P=sp(f,y,z,A);v.p(P,D)}}function Lh(v){if(v.ctx.length>32){const f=[],y=v.ctx.length/32;for(let z=0;z<y;z++)f[z]=-1;return f}return-1}function iu(v){return v&&tu(v.destroy)?v.destroy:Ut}function Ze(v,f){v.appendChild(f)}function be(v,f,y){v.insertBefore(f,y||null)}function xe(v){v.parentNode.removeChild(v)}function op(v,f){for(let y=0;y<v.length;y+=1)v[y]&&v[y].d(f)}function Ae(v){return document.createElement(v)}function yi(v){return document.createTextNode(v)}function et(){return yi(" ")}function Ol(){return yi("")}function ji(v,f,y,z){return v.addEventListener(f,y,z),()=>v.removeEventListener(f,y,z)}function Qe(v,f,y){y==null?v.removeAttribute(f):v.getAttribute(f)!==y&&v.setAttribute(f,y)}function ap(v){return v===""?null:+v}function vf(v){return Array.from(v.childNodes)}function lp(v,f){f=""+f,v.wholeText!==f&&(v.data=f)}function Rh(v,f){v.value=f==null?"":f}function Bl(v,f){for(let y=0;y<v.options.length;y+=1){const z=v.options[y];if(z.__value===f){z.selected=!0;return}}v.selectedIndex=-1}function cp(v){const f=v.querySelector(":checked")||v.options[0];return f&&f.__value}function Bh(v,f,y){v.classList[y?"add":"remove"](f)}function bf(v,f,{bubbles:y=!1,cancelable:z=!1}={}){const D=document.createEvent("CustomEvent");return D.initCustomEvent(v,y,z,f),D}let za;function Ea(v){za=v}function Ul(){if(!za)throw new Error("Function called outside component initialization");return za}function Fn(v){Ul().$$.on_mount.push(v)}function wf(v){Ul().$$.after_update.push(v)}function Sf(v){Ul().$$.on_destroy.push(v)}function Af(){const v=Ul();return(f,y,{cancelable:z=!1}={})=>{const D=v.$$.callbacks[f];if(D){const A=bf(f,y,{cancelable:z});return D.slice().forEach(P=>{P.call(v,A)}),!A.defaultPrevented}return!0}}function Fh(v,f){const y=v.$$.callbacks[f.type];y&&y.slice().forEach(z=>z.call(this,f))}const Ia=[],un=[],Dl=[],Oh=[],up=Promise.resolve();let Yc=!1;function hp(){Yc||(Yc=!0,up.then(pp))}function If(){return hp(),up}function ka(v){Dl.push(v)}const Hc=new Set;let Pl=0;function pp(){const v=za;do{for(;Pl<Ia.length;){const f=Ia[Pl];Pl++,Ea(f),Tf(f.$$)}for(Ea(null),Ia.length=0,Pl=0;un.length;)un.pop()();for(let f=0;f<Dl.length;f+=1){const y=Dl[f];Hc.has(y)||(Hc.add(y),y())}Dl.length=0}while(Ia.length);for(;Oh.length;)Oh.pop()();Yc=!1,Hc.clear(),Ea(v)}function Tf(v){if(v.fragment!==null){v.update(),sr(v.before_update);const f=v.dirty;v.dirty=[-1],v.fragment&&v.fragment.p(v.ctx,f),v.after_update.forEach(ka)}}const Ll=new Set;let Ps;function nu(){Ps={r:0,c:[],p:Ps}}function ru(){Ps.r||sr(Ps.c),Ps=Ps.p}function ii(v,f){v&&v.i&&(Ll.delete(v),v.i(f))}function ci(v,f,y,z){if(v&&v.o){if(Ll.has(v))return;Ll.add(v),Ps.c.push(()=>{Ll.delete(v),z&&(y&&v.d(1),z())}),v.o(f)}else z&&z()}function dp(v,f){const y={},z={},D={$$scope:1};let A=v.length;for(;A--;){const P=v[A],o=f[A];if(o){for(const V in P)V in o||(z[V]=1);for(const V in o)D[V]||(y[V]=o[V],D[V]=1);v[A]=o}else for(const V in P)D[V]=1}for(const P in z)P in y||(y[P]=void 0);return y}function fp(v){return typeof v=="object"&&v!==null?v:{}}function Ci(v){v&&v.c()}function wi(v,f,y,z){const{fragment:D,on_mount:A,on_destroy:P,after_update:o}=v.$$;D&&D.m(f,y),z||ka(()=>{const V=A.map(np).filter(tu);P?P.push(...V):sr(V),v.$$.on_mount=[]}),o.forEach(ka)}function Si(v,f){const y=v.$$;y.fragment!==null&&(sr(y.on_destroy),y.fragment&&y.fragment.d(f),y.on_destroy=y.fragment=null,y.ctx=[])}function Ef(v,f){v.$$.dirty[0]===-1&&(Ia.push(v),hp(),v.$$.dirty.fill(0)),v.$$.dirty[f/31|0]|=1<<f%31}function Gi(v,f,y,z,D,A,P,o=[-1]){const V=za;Ea(v);const G=v.$$={fragment:null,ctx:null,props:A,update:Ut,not_equal:D,bound:kh(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(f.context||(V?V.$$.context:[])),callbacks:kh(),dirty:o,skip_bound:!1,root:f.target||V.$$.root};P&&P(G.root);let se=!1;if(G.ctx=y?y(v,f.props||{},(K,j,...ae)=>{const le=ae.length?ae[0]:j;return G.ctx&&D(G.ctx[K],G.ctx[K]=le)&&(!G.skip_bound&&G.bound[K]&&G.bound[K](le),se&&Ef(v,K)),j}):[],G.update(),se=!0,sr(G.before_update),G.fragment=z?z(G.ctx):!1,f.target){if(f.hydrate){const K=vf(f.target);G.fragment&&G.fragment.l(K),K.forEach(xe)}else G.fragment&&G.fragment.c();f.intro&&ii(v.$$.fragment),wi(v,f.target,f.anchor,f.customElement),pp()}Ea(V)}class Zi{$destroy(){Si(this,1),this.$destroy=Ut}$on(f,y){const z=this.$$.callbacks[f]||(this.$$.callbacks[f]=[]);return z.push(y),()=>{const D=z.indexOf(y);D!==-1&&z.splice(D,1)}}$set(f){this.$$set&&!xf(f)&&(this.$$.skip_bound=!0,this.$$set(f),this.$$.skip_bound=!1)}}const wo=[];function mp(v,f){return{subscribe:gp(v,f).subscribe}}function gp(v,f=Ut){let y;const z=new Set;function D(o){if(Bi(v,o)&&(v=o,y)){const V=!wo.length;for(const G of z)G[1](),wo.push(G,v);if(V){for(let G=0;G<wo.length;G+=2)wo[G][0](wo[G+1]);wo.length=0}}}function A(o){D(o(v))}function P(o,V=Ut){const G=[o,V];return z.add(G),z.size===1&&(y=f(D)||Ut),o(v),()=>{z.delete(G),z.size===0&&(y(),y=null)}}return{set:D,update:A,subscribe:P}}function _p(v,f,y){const z=!Array.isArray(v),D=z?[v]:v,A=f.length<2;return mp(y,P=>{let o=!1;const V=[];let G=0,se=Ut;const K=()=>{if(G)return;se();const ae=f(z?V[0]:V,P);A?P(ae):se=tu(ae)?ae:Ut},j=D.map((ae,le)=>rp(ae,ze=>{V[le]=ze,G&=~(1<<le),o&&K()},()=>{G|=1<<le}));return o=!0,K(),function(){sr(j),se()}})}function Cf(v,f){if(v instanceof RegExp)return{keys:!1,pattern:v};var y,z,D,A,P=[],o="",V=v.split("/");for(V[0]||V.shift();D=V.shift();)y=D[0],y==="*"?(P.push("wild"),o+="/(.*)"):y===":"?(z=D.indexOf("?",1),A=D.indexOf(".",1),P.push(D.substring(1,~z?z:~A?A:D.length)),o+=!!~z&&!~A?"(?:/([^/]+?))?":"/([^/]+?)",~A&&(o+=(~z?"?":"")+"\\"+D.substring(A))):o+="/"+D;return{keys:P,pattern:new RegExp("^"+o+(f?"(?=$|/)":"/?$"),"i")}}function zf(v){let f,y,z;const D=[v[2]];var A=v[0];function P(o){let V={};for(let G=0;G<D.length;G+=1)V=eu(V,D[G]);return{props:V}}return A&&(f=new A(P()),f.$on("routeEvent",v[7])),{c(){f&&Ci(f.$$.fragment),y=Ol()},m(o,V){f&&wi(f,o,V),be(o,y,V),z=!0},p(o,V){const G=V&4?dp(D,[fp(o[2])]):{};if(A!==(A=o[0])){if(f){nu();const se=f;ci(se.$$.fragment,1,0,()=>{Si(se,1)}),ru()}A?(f=new A(P()),f.$on("routeEvent",o[7]),Ci(f.$$.fragment),ii(f.$$.fragment,1),wi(f,y.parentNode,y)):f=null}else A&&f.$set(G)},i(o){z||(f&&ii(f.$$.fragment,o),z=!0)},o(o){f&&ci(f.$$.fragment,o),z=!1},d(o){o&&xe(y),f&&Si(f,o)}}}function kf(v){let f,y,z;const D=[{params:v[1]},v[2]];var A=v[0];function P(o){let V={};for(let G=0;G<D.length;G+=1)V=eu(V,D[G]);return{props:V}}return A&&(f=new A(P()),f.$on("routeEvent",v[6])),{c(){f&&Ci(f.$$.fragment),y=Ol()},m(o,V){f&&wi(f,o,V),be(o,y,V),z=!0},p(o,V){const G=V&6?dp(D,[V&2&&{params:o[1]},V&4&&fp(o[2])]):{};if(A!==(A=o[0])){if(f){nu();const se=f;ci(se.$$.fragment,1,0,()=>{Si(se,1)}),ru()}A?(f=new A(P()),f.$on("routeEvent",o[6]),Ci(f.$$.fragment),ii(f.$$.fragment,1),wi(f,y.parentNode,y)):f=null}else A&&f.$set(G)},i(o){z||(f&&ii(f.$$.fragment,o),z=!0)},o(o){f&&ci(f.$$.fragment,o),z=!1},d(o){o&&xe(y),f&&Si(f,o)}}}function Pf(v){let f,y,z,D;const A=[kf,zf],P=[];function o(V,G){return V[1]?0:1}return f=o(v),y=P[f]=A[f](v),{c(){y.c(),z=Ol()},m(V,G){P[f].m(V,G),be(V,z,G),D=!0},p(V,[G]){let se=f;f=o(V),f===se?P[f].p(V,G):(nu(),ci(P[se],1,1,()=>{P[se]=null}),ru(),y=P[f],y?y.p(V,G):(y=P[f]=A[f](V),y.c()),ii(y,1),y.m(z.parentNode,z))},i(V){D||(ii(y),D=!0)},o(V){ci(y),D=!1},d(V){P[f].d(V),V&&xe(z)}}}function Uh(){const v=window.location.href.indexOf("#/");let f=v>-1?window.location.href.substr(v+1):"/";const y=f.indexOf("?");let z="";return y>-1&&(z=f.substr(y+1),f=f.substr(0,y)),{location:f,querystring:z}}const su=mp(null,function(f){f(Uh());const y=()=>{f(Uh())};return window.addEventListener("hashchange",y,!1),function(){window.removeEventListener("hashchange",y,!1)}}),Sn=_p(su,v=>v.location);_p(su,v=>v.querystring);const Vh=gp(void 0);function ou(v,f){if(f=Nh(f),!v||!v.tagName||v.tagName.toLowerCase()!="a")throw Error('Action "link" can only be used with <a> tags');return $h(v,f),{update(y){y=Nh(y),$h(v,y)}}}function Mf(v){v?window.scrollTo(v.__svelte_spa_router_scrollX,v.__svelte_spa_router_scrollY):window.scrollTo(0,0)}function $h(v,f){let y=f.href||v.getAttribute("href");if(y&&y.charAt(0)=="/")y="#"+y;else if(!y||y.length<2||y.slice(0,2)!="#/")throw Error('Invalid value for "href" attribute: '+y);v.setAttribute("href",y),v.addEventListener("click",z=>{z.preventDefault(),f.disabled||Df(z.currentTarget.getAttribute("href"))})}function Nh(v){return v&&typeof v=="string"?{href:v}:v||{}}function Df(v){history.replaceState({...history.state,__svelte_spa_router_scrollX:window.scrollX,__svelte_spa_router_scrollY:window.scrollY},void 0),window.location.hash=v}function Lf(v,f,y){let{routes:z={}}=f,{prefix:D=""}=f,{restoreScrollState:A=!1}=f;class P{constructor(Ye,Te){if(!Te||typeof Te!="function"&&(typeof Te!="object"||Te._sveltesparouter!==!0))throw Error("Invalid component object");if(!Ye||typeof Ye=="string"&&(Ye.length<1||Ye.charAt(0)!="/"&&Ye.charAt(0)!="*")||typeof Ye=="object"&&!(Ye instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:rt,keys:At}=Cf(Ye);this.path=Ye,typeof Te=="object"&&Te._sveltesparouter===!0?(this.component=Te.component,this.conditions=Te.conditions||[],this.userData=Te.userData,this.props=Te.props||{}):(this.component=()=>Promise.resolve(Te),this.conditions=[],this.props={}),this._pattern=rt,this._keys=At}match(Ye){if(D){if(typeof D=="string")if(Ye.startsWith(D))Ye=Ye.substr(D.length)||"/";else return null;else if(D instanceof RegExp){const Vt=Ye.match(D);if(Vt&&Vt[0])Ye=Ye.substr(Vt[0].length)||"/";else return null}}const Te=this._pattern.exec(Ye);if(Te===null)return null;if(this._keys===!1)return Te;const rt={};let At=0;for(;At<this._keys.length;){try{rt[this._keys[At]]=decodeURIComponent(Te[At+1]||"")||null}catch{rt[this._keys[At]]=null}At++}return rt}async checkConditions(Ye){for(let Te=0;Te<this.conditions.length;Te++)if(!await this.conditions[Te](Ye))return!1;return!0}}const o=[];z instanceof Map?z.forEach((st,Ye)=>{o.push(new P(Ye,st))}):Object.keys(z).forEach(st=>{o.push(new P(st,z[st]))});let V=null,G=null,se={};const K=Af();async function j(st,Ye){await If(),K(st,Ye)}let ae=null,le=null;A&&(le=st=>{st.state&&(st.state.__svelte_spa_router_scrollY||st.state.__svelte_spa_router_scrollX)?ae=st.state:ae=null},window.addEventListener("popstate",le),wf(()=>{Mf(ae)}));let ze=null,Ce=null;const We=su.subscribe(async st=>{ze=st;let Ye=0;for(;Ye<o.length;){const Te=o[Ye].match(st.location);if(!Te){Ye++;continue}const rt={route:o[Ye].path,location:st.location,querystring:st.querystring,userData:o[Ye].userData,params:Te&&typeof Te=="object"&&Object.keys(Te).length?Te:null};if(!await o[Ye].checkConditions(rt)){y(0,V=null),Ce=null,j("conditionsFailed",rt);return}j("routeLoading",Object.assign({},rt));const At=o[Ye].component;if(Ce!=At){At.loading?(y(0,V=At.loading),Ce=At,y(1,G=At.loadingParams),y(2,se={}),j("routeLoaded",Object.assign({},rt,{component:V,name:V.name,params:G}))):(y(0,V=null),Ce=null);const Vt=await At();if(st!=ze)return;y(0,V=Vt&&Vt.default||Vt),Ce=At}Te&&typeof Te=="object"&&Object.keys(Te).length?y(1,G=Te):y(1,G=null),y(2,se=o[Ye].props),j("routeLoaded",Object.assign({},rt,{component:V,name:V.name,params:G})).then(()=>{Vh.set(G)});return}y(0,V=null),Ce=null,Vh.set(void 0)});Sf(()=>{We(),le&&window.removeEventListener("popstate",le)});function kt(st){Fh.call(this,v,st)}function ft(st){Fh.call(this,v,st)}return v.$$set=st=>{"routes"in st&&y(3,z=st.routes),"prefix"in st&&y(4,D=st.prefix),"restoreScrollState"in st&&y(5,A=st.restoreScrollState)},v.$$.update=()=>{v.$$.dirty&32&&(history.scrollRestoration=A?"manual":"auto")},[V,G,se,z,D,A,kt,ft]}class Rf extends Zi{constructor(f){super(),Gi(this,f,Lf,Pf,Bi,{routes:3,prefix:4,restoreScrollState:5})}}const Bf=v=>({}),jh=v=>({});function qh(v){let f,y,z,D,A,P,o;return{c(){f=Ae("header"),y=Ae("a"),y.textContent="Back to Menu",z=et(),D=Ae("a"),A=yi("Source"),Qe(y,"href","/"),Qe(y,"class","svelte-1jo4v3w"),Qe(D,"href",v[1].sourceUrl),Qe(D,"target","_blank"),Qe(D,"class","svelte-1jo4v3w"),Qe(f,"class","p-5 lg:p-10 pb-2.5 lg:pb-5 flex justify-between gap-2.5 lg:gap-5 sticky top-0 bg-inherit svelte-1jo4v3w")},m(V,G){be(V,f,G),Ze(f,y),Ze(f,z),Ze(f,D),Ze(D,A),P||(o=iu(ou.call(null,y)),P=!0)},p:Ut,d(V){V&&xe(f),P=!1,o()}}}function Ff(v){let f,y,z,D,A,P,o,V=!v[0]&&qh(v);const G=v[3].title,se=Ph(G,v,v[2],jh),K=v[3].default,j=Ph(K,v,v[2],null);return{c(){f=Ae("aside"),y=Ae("div"),V&&V.c(),z=et(),D=Ae("article"),A=Ae("h1"),se&&se.c(),P=et(),j&&j.c(),Qe(A,"class","break-all svelte-1jo4v3w"),Qe(D,"class","p-5 lg:p-10 flex flex-col gap-1.5 lg:gap-3 svelte-1jo4v3w"),Bh(D,"!pt-0",!v[0]),Qe(y,"class","h-full flex flex-col bg-inherit overflow-x-hidden overflow-y-auto svelte-1jo4v3w"),Qe(f,"class","basis-full lg:basis-1/3 overflow-hidden shadow-xl svelte-1jo4v3w")},m(ae,le){be(ae,f,le),Ze(f,y),V&&V.m(y,null),Ze(y,z),Ze(y,D),Ze(D,A),se&&se.m(A,null),Ze(D,P),j&&j.m(D,null),o=!0},p(ae,[le]){ae[0]?V&&(V.d(1),V=null):V?V.p(ae,le):(V=qh(ae),V.c(),V.m(y,z)),se&&se.p&&(!o||le&4)&&Dh(se,G,ae,ae[2],o?Mh(G,ae[2],le,Bf):Lh(ae[2]),jh),j&&j.p&&(!o||le&4)&&Dh(j,K,ae,ae[2],o?Mh(K,ae[2],le,null):Lh(ae[2]),null),le&1&&Bh(D,"!pt-0",!ae[0])},i(ae){o||(ii(se,ae),ii(j,ae),o=!0)},o(ae){ci(se,ae),ci(j,ae),o=!1},d(ae){ae&&xe(f),V&&V.d(),se&&se.d(ae),j&&j.d(ae)}}}function Of(v,f,y){let z;wn(v,Sn,V=>y(4,z=V));let{$$slots:D={},$$scope:A}=f,{noHeader:P=!1}=f;const o=qi.find(V=>V.path===z);return v.$$set=V=>{"noHeader"in V&&y(0,P=V.noHeader),"$$scope"in V&&y(2,A=V.$$scope)},[P,o,A,D]}class An extends Zi{constructor(f){super(),Gi(this,f,Of,Ff,Bi,{noHeader:0})}}var Uf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},yp={exports:{}};(function(v,f){(function(y,z){v.exports=z()})(Uf,function(){var y,z,D;function A(o,V){if(!y)y=V;else if(!z)z=V;else{var G="var sharedChunk = {}; ("+y+")(sharedChunk); ("+z+")(sharedChunk);",se={};y(se),D=V(se),typeof window<"u"&&(D.workerUrl=window.URL.createObjectURL(new Blob([G],{type:"text/javascript"})))}}A(["exports"],function(o){var V=G;function G(i,e,n,s){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=n,this.p2y=s}function se(i,e,n,s){const l=new V(i,e,n,s);return function(h){return l.solve(h)}}G.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,s=0;s<8;s++){var l=this.sampleCurveX(n)-i;if(Math.abs(l)<e)return n;var h=this.sampleCurveDerivativeX(n);if(Math.abs(h)<1e-6)break;n-=l/h}var p=0,m=1;for(n=i,s=0;s<20&&(l=this.sampleCurveX(n),!(Math.abs(l-i)<e));s++)i>l?p=n:m=n,n=.5*(m-p)+p;return n},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};const K=se(.25,.1,.25,1);function j(i,e,n){return Math.min(n,Math.max(e,i))}function ae(i,e,n){const s=n-e,l=((i-e)%s+s)%s+e;return l===e?n:l}function le(i,...e){for(const n of e)for(const s in n)i[s]=n[s];return i}let ze=1;function Ce(i,e){i.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function We(i,e,n){const s={};for(const l in i)s[l]=e.call(n||this,i[l],l,i);return s}function kt(i,e,n){const s={};for(const l in i)e.call(n||this,i[l],l,i)&&(s[l]=i[l]);return s}function ft(i){return Array.isArray(i)?i.map(ft):typeof i=="object"&&i?We(i,ft):i}const st={};function Ye(i){st[i]||(typeof console<"u"&&console.warn(i),st[i]=!0)}function Te(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function rt(i){let e=0;for(let n,s,l=0,h=i.length,p=h-1;l<h;p=l++)n=i[l],s=i[p],e+=(s.x-n.x)*(n.y+s.y);return e}function At(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Vt(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,l,h)=>{const p=l||h;return e[s]=!p||p.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Vn,zi,hn=null;function In(i){if(hn==null){const e=i.navigator?i.navigator.userAgent:null;hn=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return hn}function Wi(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Tn={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const n=window.document.createElement("canvas"),s=n.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return n.width=i.width,n.height=i.height,s.drawImage(i,0,0,i.width,i.height),s.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(Vn||(Vn=document.createElement("a")),Vn.href=i,Vn.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(zi==null&&(zi=matchMedia("(prefers-reduced-motion: reduce)")),zi.matches)}};var Ve=Ht;function Ht(i,e){this.x=i,this.y=e}Ht.prototype={clone:function(){return new Ht(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),n=Math.sin(i),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(i,e){var n=Math.cos(i),s=Math.sin(i),l=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ht.convert=function(i){return i instanceof Ht?i:Array.isArray(i)?new Ht(i[0],i[1]):i};const Kn={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Jn="mapbox-tiles";let pn,or,ar=500,$n=50;function Qn(){typeof caches>"u"||pn||(pn=caches.open(Jn))}let lr=1/0;const dn={supported:!1,testSupport:function(i){!Dr&&jn&&(Ms?is(i):Nn=i)}};let Nn,jn,Dr=!1,Ms=!1;function is(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,jn),i.isContextLost())return;dn.supported=!0}catch{}i.deleteTexture(e),Dr=!0}typeof document<"u"&&(jn=document.createElement("img"),jn.onload=function(){Nn&&is(Nn),Nn=null,Ms=!0},jn.onerror=function(){Dr=!0,Nn=null},jn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ds={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ds);class fi extends Error{constructor(e,n,s,l){super(`AJAXError: ${n} (${e}): ${s}`),this.status=e,this.statusText=n,this.url=s,this.body=l}}const er=At()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function ns(i,e){const n=new AbortController,s=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:er(),signal:n.signal});let l=!1,h=!1;return i.type==="json"&&s.headers.set("Accept","application/json"),((p,m,_)=>{if(h)return;const w=Date.now();fetch(s).then(T=>T.ok?((C,M,R)=>{(i.type==="arrayBuffer"?C.arrayBuffer():i.type==="json"?C.json():C.text()).then(B=>{h||(M&&R&&function(H,X,re){if(Qn(),!pn)return;const ue={status:X.status,statusText:X.statusText,headers:new Headers};X.headers.forEach((ge,Se)=>ue.headers.set(Se,ge));const ce=Vt(X.headers.get("Cache-Control")||"");ce["no-store"]||(ce["max-age"]&&ue.headers.set("Expires",new Date(re+1e3*ce["max-age"]).toUTCString()),new Date(ue.headers.get("Expires")).getTime()-re<42e4||function(ge,Se){if(or===void 0)try{new Response(new ReadableStream),or=!0}catch{or=!1}or?Se(ge.body):ge.blob().then(Se)}(X,ge=>{const Se=new Response(ge,ue);Qn(),pn&&pn.then(ve=>ve.put(function(je){const Ke=je.indexOf("?");return Ke<0?je:je.slice(0,Ke)}(H.url),Se)).catch(ve=>Ye(ve.message))}))}(s,M,R),l=!0,e(null,B,C.headers.get("Cache-Control"),C.headers.get("Expires")))}).catch(B=>{h||e(new Error(B.message))})})(T,null,w):T.blob().then(C=>e(new fi(T.status,T.statusText,i.url,C)))).catch(T=>{T.code!==20&&e(new Error(T.message))})})(),{cancel:()=>{h=!0,l||n.abort()}}}const cr=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(At()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!At()){const s=i.url.substring(0,i.url.indexOf("://"));return(Kn.REGISTERED_PROTOCOLS[s]||ns)(i,e)}}if(!(/^file:/.test(n=i.url)||/^file:/.test(er())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ns(i,e);if(At()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var n;return function(s,l){const h=new XMLHttpRequest;h.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const p in s.headers)h.setRequestHeader(p,s.headers[p]);return s.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=s.credentials==="include",h.onerror=()=>{l(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let p=h.response;if(s.type==="json")try{p=JSON.parse(h.response)}catch(m){return l(m)}l(null,p,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else{const p=new Blob([h.response],{type:h.getResponseHeader("Content-Type")});l(new fi(h.status,h.statusText,s.url,p))}},h.send(s.body),{cancel:()=>h.abort()}}(i,e)},En=function(i,e){return cr(le(i,{type:"arrayBuffer"}),e)};function Ls(i){const e=window.document.createElement("a");return e.href=i,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const qn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Cn,zn;Cn=[],zn=0;const rs=function(i,e){if(dn.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),zn>=Kn.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Cn.push(h),h}zn++;let n=!1;const s=()=>{if(!n)for(n=!0,zn--;Cn.length&&zn<Kn.MAX_PARALLEL_IMAGE_REQUESTS;){const h=Cn.shift(),{requestParameters:p,callback:m,cancelled:_}=h;_||(h.cancel=rs(p,m).cancel)}},l=En(i,(h,p,m,_)=>{s(),h?e(h):p&&function(w,T){typeof createImageBitmap=="function"?function(C,M){const R=new Blob([new Uint8Array(C)],{type:"image/png"});createImageBitmap(R).then(B=>{M(null,B)}).catch(B=>{M(new Error(`Could not load image because of ${B.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(w,T):function(C,M){const R=new Image;R.onload=()=>{M(null,R),URL.revokeObjectURL(R.src),R.onload=null,window.requestAnimationFrame(()=>{R.src=qn})},R.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new Blob([new Uint8Array(C)],{type:"image/png"});R.src=C.byteLength?URL.createObjectURL(B):qn}(w,T)}(p,(w,T)=>{w!=null?e(w):T!=null&&e(null,T,{cacheControl:m,expires:_})})});return{cancel:()=>{l.cancel(),s()}}};function wt(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function ur(i,e,n){if(n&&n[i]){const s=n[i].indexOf(e);s!==-1&&n[i].splice(s,1)}}class tr{constructor(e,n={}){le(this,n),this.type=e}}class hr extends tr{constructor(e,n={}){super("error",le({error:e},n))}}class ss{on(e,n){return this._listeners=this._listeners||{},wt(e,n,this._listeners),this}off(e,n){return ur(e,n,this._listeners),ur(e,n,this._oneTimeListeners),this}once(e,n){return this._oneTimeListeners=this._oneTimeListeners||{},wt(e,n,this._oneTimeListeners),this}fire(e,n){typeof e=="string"&&(e=new tr(e,n||{}));const s=e.type;if(this.listens(s)){e.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const m of l)m.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const m of h)ur(s,m,this._oneTimeListeners),m.call(this,e);const p=this._eventedParent;p&&(le(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof hr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Le{constructor(e,n,s,l){this.message=(e?`${e}: `:"")+s,l&&(this.identifier=l),n!=null&&n.__line__&&(this.line=n.__line__)}}function pr(i){const e=i.value;return e?[new Le(i.key,e,"constants have been deprecated as of v8")]:[]}function Gn(i,...e){for(const n of e)for(const s in n)i[s]=n[s];return i}function Bt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function rn(i){if(Array.isArray(i))return i.map(rn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=rn(i[n]);return e}return Bt(i)}class ki extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class dr{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[s,l]of n)this.bindings[s]=l}concat(e){return new dr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const $t={kind:"null"},Me={kind:"number"},dt={kind:"string"},ut={kind:"boolean"},Pi={kind:"color"},fn={kind:"object"},ht={kind:"value"},fr={kind:"collator"},mn={kind:"formatted"},Zn={kind:"resolvedImage"};function ni(i,e){return{kind:"array",itemType:i,N:e}}function Ft(i){if(i.kind==="array"){const e=Ft(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const sn=[$t,Me,dt,ut,Pi,mn,fn,ni(ht),Zn];function mr(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!mr(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of sn)if(!mr(n,e))return null}}return`Expected ${Ft(i)} but found ${Ft(e)} instead.`}function ui(i,e){return e.some(n=>n.kind===i.kind)}function gn(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}var _n,os={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Lr(i){return(i=Math.round(i))<0?0:i>255?255:i}function Rr(i){return Lr(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function $(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function S(i,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?i+(e-i)*n*6:2*n<1?e:3*n<2?i+(e-i)*(2/3-n)*6:i}try{_n={}.parseCSSColor=function(i){var e,n=i.replace(/ /g,"").toLowerCase();if(n in os)return os[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=n.indexOf("("),l=n.indexOf(")");if(s!==-1&&l+1===n.length){var h=n.substr(0,s),p=n.substr(s+1,l-(s+1)).split(","),m=1;switch(h){case"rgba":if(p.length!==4)return null;m=$(p.pop());case"rgb":return p.length!==3?null:[Rr(p[0]),Rr(p[1]),Rr(p[2]),m];case"hsla":if(p.length!==4)return null;m=$(p.pop());case"hsl":if(p.length!==3)return null;var _=(parseFloat(p[0])%360+360)%360/360,w=$(p[1]),T=$(p[2]),C=T<=.5?T*(w+1):T+w-T*w,M=2*T-C;return[Lr(255*S(M,C,_+1/3)),Lr(255*S(M,C,_)),Lr(255*S(M,C,_-1/3)),m];default:return null}}return null}}catch{}class E{constructor(e,n,s,l=1){this.r=e,this.g=n,this.b=s,this.a=l}static parse(e){if(!e)return;if(e instanceof E)return e;if(typeof e!="string")return;const n=_n(e);return n?new E(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,s,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(s)},${l})`}toArray(){const{r:e,g:n,b:s,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*n/l,255*s/l,l]}}E.black=new E(0,0,0,1),E.white=new E(1,1,1,1),E.transparent=new E(0,0,0,0),E.red=new E(1,0,0,1);class F{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class N{constructor(e,n,s,l,h){this.text=e,this.image=n,this.scale=s,this.fontStack=l,this.textColor=h}}class q{constructor(e){this.sections=e}static fromString(e){return new q([new N(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof q?e:q.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(s)}return e}}class Q{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Q({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Y(i,e,n,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,n,s]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function J(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof E||i instanceof F||i instanceof q||i instanceof Q)return!0;if(Array.isArray(i)){for(const e of i)if(!J(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!J(i[e]))return!1;return!0}return!1}function ee(i){if(i===null)return $t;if(typeof i=="string")return dt;if(typeof i=="boolean")return ut;if(typeof i=="number")return Me;if(i instanceof E)return Pi;if(i instanceof F)return fr;if(i instanceof q)return mn;if(i instanceof Q)return Zn;if(Array.isArray(i)){const e=i.length;let n;for(const s of i){const l=ee(s);if(n){if(n===l)continue;n=ht;break}n=l}return ni(n||ht,e)}return fn}function de(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof E||i instanceof q||i instanceof Q?i.toString():JSON.stringify(i)}class we{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!J(e[1]))return n.error("invalid value");const s=e[1];let l=ee(s);const h=n.expectedType;return l.kind!=="array"||l.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(l=h),new we(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof E?["rgba"].concat(this.value.toArray()):this.value instanceof q?this.value.serialize():this.value}}class he{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ge={string:dt,number:Me,boolean:ut,object:fn};class Ue{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,l=1;const h=e[0];if(h==="array"){let m,_;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in Ge)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);m=Ge[w],l++}else m=ht;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);_=e[2],l++}s=ni(m,_)}else s=Ge[h];const p=[];for(;l<e.length;l++){const m=n.parse(e[l],l,ht);if(!m)return null;p.push(m)}return new Ue(s,p)}evaluate(e){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(e);if(!mr(this.type,ee(s)))return s;if(n===this.args.length-1)throw new he(`Expected value to be of type ${Ft(this.type)}, but found ${Ft(ee(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){n.push(s.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&n.push(l)}}return n.concat(this.args.map(s=>s.serialize()))}}class Xe{constructor(e){this.type=mn,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return n.error("First argument must be an image or text section.");const l=[];let h=!1;for(let p=1;p<=e.length-1;++p){const m=e[p];if(h&&typeof m=="object"&&!Array.isArray(m)){h=!1;let _=null;if(m["font-scale"]&&(_=n.parse(m["font-scale"],1,Me),!_))return null;let w=null;if(m["text-font"]&&(w=n.parse(m["text-font"],1,ni(dt)),!w))return null;let T=null;if(m["text-color"]&&(T=n.parse(m["text-color"],1,Pi),!T))return null;const C=l[l.length-1];C.scale=_,C.font=w,C.textColor=T}else{const _=n.parse(e[p],1,ht);if(!_)return null;const w=_.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,l.push({content:_,scale:null,font:null,textColor:null})}}return new Xe(l)}evaluate(e){return new q(this.sections.map(n=>{const s=n.content.evaluate(e);return ee(s)===Zn?new N("",s,null,null,null):new N(de(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),e.push(s)}return e}}class tt{constructor(e){this.type=Zn,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const s=n.parse(e[1],1,dt);return s?new tt(s):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),s=Q.fromString(n);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(n)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const It={"to-boolean":ut,"to-color":Pi,"to-number":Me,"to-string":dt};class xt{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[0];if((s==="to-boolean"||s==="to-string")&&e.length!==2)return n.error("Expected one argument.");const l=It[s],h=[];for(let p=1;p<e.length;p++){const m=n.parse(e[p],p,ht);if(!m)return null;h.push(m)}return new xt(l,h)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let n,s;for(const l of this.args){if(n=l.evaluate(e),s=null,n instanceof E)return n;if(typeof n=="string"){const h=e.parseColor(n);if(h)return h}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Y(n[0],n[1],n[2],n[3]),!s))return new E(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new he(s||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const s of this.args){if(n=s.evaluate(e),n===null)return 0;const l=Number(n);if(!isNaN(l))return l}throw new he(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?q.fromString(de(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Q.fromString(de(this.args[0].evaluate(e))):de(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Xe([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new tt(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}const mt=["Unknown","Point","LineString","Polygon"];class pt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?mt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=E.parse(e)),n}}class ct{constructor(e,n,s,l){this.name=e,this.type=n,this._evaluate=s,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const s=e[0],l=ct.definitions[s];if(!l)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,m=p.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let _=null;for(const[w,T]of m){_=new Fs(n.registry,n.path,null,n.scope);const C=[];let M=!1;for(let R=1;R<e.length;R++){const B=e[R],H=Array.isArray(w)?w[R-1]:w.type,X=_.parse(B,1+C.length,H);if(!X){M=!0;break}C.push(X)}if(!M)if(Array.isArray(w)&&w.length!==C.length)_.error(`Expected ${w.length} arguments, but found ${C.length} instead.`);else{for(let R=0;R<C.length;R++){const B=Array.isArray(w)?w[R]:w.type,H=C[R];_.concat(R+1).checkSubtype(B,H.type)}if(_.errors.length===0)return new ct(s,h,T,C)}}if(m.length===1)n.errors.push(..._.errors);else{const w=(m.length?m:p).map(([C])=>{return M=C,Array.isArray(M)?`(${M.map(Ft).join(", ")})`:`(${Ft(M.type)}...)`;var M}).join(" | "),T=[];for(let C=1;C<e.length;C++){const M=n.parse(e[C],1+T.length);if(!M)return null;T.push(Ft(M.type))}n.error(`Expected arguments of type ${w}, but found (${T.join(", ")}) instead.`)}return null}static register(e,n){ct.definitions=n;for(const s in n)e[s]=ct}}class ei{constructor(e,n,s){this.type=fr,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return n.error("Collator options argument must be an object.");const l=n.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,ut);if(!l)return null;const h=n.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,ut);if(!h)return null;let p=null;return s.locale&&(p=n.parse(s.locale,1,dt),!p)?null:new ei(l,h,p)}evaluate(e){return new F(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Kt=8192;function mi(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function xi(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Ao(i,e){const n=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(n*l*Kt),Math.round(s*l*Kt)]}function Io(i,e,n){const s=i[0]-e[0],l=i[1]-e[1],h=i[0]-n[0],p=i[1]-n[1];return s*p-h*l==0&&s*h<=0&&l*p<=0}function Ot(i,e){let n=!1;for(let p=0,m=e.length;p<m;p++){const _=e[p];for(let w=0,T=_.length;w<T-1;w++){if(Io(i,_[w],_[w+1]))return!1;(l=_[w])[1]>(s=i)[1]!=(h=_[w+1])[1]>s[1]&&s[0]<(h[0]-l[0])*(s[1]-l[1])/(h[1]-l[1])+l[0]&&(n=!n)}}var s,l,h;return n}function Nl(i,e){for(let n=0;n<e.length;n++)if(Ot(i,e[n]))return!0;return!1}function To(i,e,n,s){const l=s[0]-n[0],h=s[1]-n[1],p=(i[0]-n[0])*h-l*(i[1]-n[1]),m=(e[0]-n[0])*h-l*(e[1]-n[1]);return p>0&&m<0||p<0&&m>0}function jl(i,e,n){for(const w of n)for(let T=0;T<w.length-1;++T)if((m=[(p=w[T+1])[0]-(h=w[T])[0],p[1]-h[1]])[0]*(_=[(l=e)[0]-(s=i)[0],l[1]-s[1]])[1]-m[1]*_[0]!=0&&To(s,l,h,p)&&To(h,p,s,l))return!0;var s,l,h,p,m,_;return!1}function Eo(i,e){for(let n=0;n<i.length;++n)if(!Ot(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(jl(i[n],i[n+1],e))return!1;return!0}function Pa(i,e){for(let n=0;n<e.length;n++)if(Eo(i,e[n]))return!0;return!1}function Co(i,e,n){const s=[];for(let l=0;l<i.length;l++){const h=[];for(let p=0;p<i[l].length;p++){const m=Ao(i[l][p],n);mi(e,m),h.push(m)}s.push(h)}return s}function zo(i,e,n){const s=[];for(let l=0;l<i.length;l++){const h=Co(i[l],e,n);s.push(h)}return s}function ko(i,e,n,s){if(i[0]<n[0]||i[0]>n[2]){const l=.5*s;let h=i[0]-n[0]>l?-s:n[0]-i[0]>l?s:0;h===0&&(h=i[0]-n[2]>l?-s:n[2]-i[0]>l?s:0),i[0]+=h}mi(e,i)}function Ma(i,e,n,s){const l=Math.pow(2,s.z)*Kt,h=[s.x*Kt,s.y*Kt],p=[];for(const m of i)for(const _ of m){const w=[_.x+h[0],_.y+h[1]];ko(w,e,n,l),p.push(w)}return p}function Da(i,e,n,s){const l=Math.pow(2,s.z)*Kt,h=[s.x*Kt,s.y*Kt],p=[];for(const _ of i){const w=[];for(const T of _){const C=[T.x+h[0],T.y+h[1]];mi(e,C),w.push(C)}p.push(w)}if(e[2]-e[0]<=l/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const _ of p)for(const w of _)ko(w,e,n,l)}var m;return p}class gr{constructor(e,n){this.type=ut,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(J(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let l=0;l<s.features.length;++l){const h=s.features[l].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new gr(s,s.features[l].geometry)}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new gr(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new gr(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,s){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(s.type==="Polygon"){const m=Co(s.coordinates,h,p),_=Ma(n.geometry(),l,h,p);if(!xi(l,h))return!1;for(const w of _)if(!Ot(w,m))return!1}if(s.type==="MultiPolygon"){const m=zo(s.coordinates,h,p),_=Ma(n.geometry(),l,h,p);if(!xi(l,h))return!1;for(const w of _)if(!Nl(w,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,s){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(s.type==="Polygon"){const m=Co(s.coordinates,h,p),_=Da(n.geometry(),l,h,p);if(!xi(l,h))return!1;for(const w of _)if(!Eo(w,m))return!1}if(s.type==="MultiPolygon"){const m=zo(s.coordinates,h,p),_=Da(n.geometry(),l,h,p);if(!xi(l,h))return!1;for(const w of _)if(!Pa(w,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Rs(i){if(i instanceof ct&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof gr)return!1;let e=!0;return i.eachChild(n=>{e&&!Rs(n)&&(e=!1)}),e}function Br(i){if(i instanceof ct&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!Br(n)&&(e=!1)}),e}function as(i,e){if(i instanceof ct&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(s=>{n&&!as(s,e)&&(n=!1)}),n}class Bs{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const s=e[1];return n.scope.has(s)?new Bs(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Fs{constructor(e,n=[],s,l=new dr,h=[]){this.registry=e,this.path=n,this.key=n.map(p=>`[${p}]`).join(""),this.scope=l,this.errors=h,this.expectedType=s}parse(e,n,s,l,h={}){return n?this.concat(n,s,l)._parse(e,h):this._parse(e,h)}_parse(e,n){function s(l,h,p){return p==="assert"?new Ue(h,[l]):p==="coerce"?new xt(h,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[l];if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,_=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||_.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(m,_))return null}else p=s(p,m,n.typeAnnotation||"coerce");else p=s(p,m,n.typeAnnotation||"assert")}if(!(p instanceof we)&&p.type.kind!=="resolvedImage"&&ls(p)){const m=new pt;try{p=new we(p.type,p.evaluate(m))}catch(_){return this.error(_.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){const l=typeof e=="number"?this.path.concat(e):this.path,h=s?this.scope.concat(s):this.scope;return new Fs(this.registry,l,n||null,h,this.errors)}error(e,...n){const s=`${this.key}${n.map(l=>`[${l}]`).join("")}`;this.errors.push(new ki(s,e))}checkSubtype(e,n){const s=mr(e,n);return s&&this.error(s),s}}function ls(i){if(i instanceof Bs)return ls(i.boundExpression);if(i instanceof ct&&i.name==="error"||i instanceof ei||i instanceof gr)return!1;const e=i instanceof xt||i instanceof Ue;let n=!0;return i.eachChild(s=>{n=e?n&&ls(s):n&&s instanceof we}),!!n&&Rs(i)&&as(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Os(i,e){const n=i.length-1;let s,l,h=0,p=n,m=0;for(;h<=p;)if(m=Math.floor((h+p)/2),s=i[m],l=i[m+1],s<=e){if(m===n||e<l)return m;h=m+1}else{if(!(s>e))throw new he("Input is not a number.");p=m-1}return 0}class cs{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[l,h]of s)this.labels.push(l),this.outputs.push(h)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(e[1],1,Me);if(!s)return null;const l=[];let h=null;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);for(let p=1;p<e.length;p+=2){const m=p===1?-1/0:e[p],_=e[p+1],w=p,T=p+1;if(typeof m!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(l.length&&l[l.length-1][0]>=m)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const C=n.parse(_,T,h);if(!C)return null;h=h||C.type,l.push([m,C])}return new cs(h,s,l)}evaluate(e){const n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=n[0])return s[0].evaluate(e);const h=n.length;return l>=n[h-1]?s[h-1].evaluate(e):s[Os(n,l)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}function ri(i,e,n){return i*(1-n)+e*n}var us=Object.freeze({__proto__:null,number:ri,color:function(i,e,n){return new E(ri(i.r,e.r,n),ri(i.g,e.g,n),ri(i.b,e.b,n),ri(i.a,e.a,n))},array:function(i,e,n){return i.map((s,l)=>ri(s,e[l],n))}});const Po=.95047,La=1.08883,Ra=4/29,Us=6/29,Mo=3*Us*Us,ql=Math.PI/180,Gl=180/Math.PI;function Do(i){return i>.008856451679035631?Math.pow(i,1/3):i/Mo+Ra}function Lo(i){return i>Us?i*i*i:Mo*(i-Ra)}function Ro(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Bo(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ba(i){const e=Bo(i.r),n=Bo(i.g),s=Bo(i.b),l=Do((.4124564*e+.3575761*n+.1804375*s)/Po),h=Do((.2126729*e+.7151522*n+.072175*s)/1);return{l:116*h-16,a:500*(l-h),b:200*(h-Do((.0193339*e+.119192*n+.9503041*s)/La)),alpha:i.a}}function Ct(i){let e=(i.l+16)/116,n=isNaN(i.a)?e:e+i.a/500,s=isNaN(i.b)?e:e-i.b/200;return e=1*Lo(e),n=Po*Lo(n),s=La*Lo(s),new E(Ro(3.2404542*n-1.5371385*e-.4985314*s),Ro(-.969266*n+1.8760108*e+.041556*s),Ro(.0556434*n-.2040259*e+1.0572252*s),i.alpha)}function Zl(i,e,n){const s=e-i;return i+n*(s>180||s<-180?s-360*Math.round(s/360):s)}const hs={forward:Ba,reverse:Ct,interpolate:function(i,e,n){return{l:ri(i.l,e.l,n),a:ri(i.a,e.a,n),b:ri(i.b,e.b,n),alpha:ri(i.alpha,e.alpha,n)}}},ps={forward:function(i){const{l:e,a:n,b:s}=Ba(i),l=Math.atan2(s,n)*Gl;return{h:l<0?l+360:l,c:Math.sqrt(n*n+s*s),l:e,alpha:i.a}},reverse:function(i){const e=i.h*ql,n=i.c;return Ct({l:i.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:i.alpha})},interpolate:function(i,e,n){return{h:Zl(i.h,e.h,n),c:ri(i.c,e.c,n),l:ri(i.l,e.l,n),alpha:ri(i.alpha,e.alpha,n)}}};var Fa=Object.freeze({__proto__:null,lab:hs,hcl:ps});class Hi{constructor(e,n,s,l,h){this.type=e,this.operator=n,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[p,m]of h)this.labels.push(p),this.outputs.push(m)}static interpolationFactor(e,n,s,l){let h=0;if(e.name==="exponential")h=Fo(n,e.base,s,l);else if(e.name==="linear")h=Fo(n,1,s,l);else if(e.name==="cubic-bezier"){const p=e.controlPoints;h=new V(p[0],p[1],p[2],p[3]).solve(Fo(n,1,s,l))}return h}static parse(e,n){let[s,l,h,...p]=e;if(!Array.isArray(l)||l.length===0)return n.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const w=l[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:w}}else{if(l[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const w=l.slice(1);if(w.length!==4||w.some(T=>typeof T!="number"||T<0||T>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(h=n.parse(h,2,Me),!h)return null;const m=[];let _=null;s==="interpolate-hcl"||s==="interpolate-lab"?_=Pi:n.expectedType&&n.expectedType.kind!=="value"&&(_=n.expectedType);for(let w=0;w<p.length;w+=2){const T=p[w],C=p[w+1],M=w+3,R=w+4;if(typeof T!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(m.length&&m[m.length-1][0]>=T)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const B=n.parse(C,R,_);if(!B)return null;_=_||B.type,m.push([T,B])}return _.kind==="number"||_.kind==="color"||_.kind==="array"&&_.itemType.kind==="number"&&typeof _.N=="number"?new Hi(_,s,l,h,m):n.error(`Type ${Ft(_)} is not interpolatable.`)}evaluate(e){const n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=n[0])return s[0].evaluate(e);const h=n.length;if(l>=n[h-1])return s[h-1].evaluate(e);const p=Os(n,l),m=Hi.interpolationFactor(this.interpolation,l,n[p],n[p+1]),_=s[p].evaluate(e),w=s[p+1].evaluate(e);return this.operator==="interpolate"?us[this.type.kind.toLowerCase()](_,w,m):this.operator==="interpolate-hcl"?ps.reverse(ps.interpolate(ps.forward(_),ps.forward(w),m)):hs.reverse(hs.interpolate(hs.forward(_),hs.forward(w),m))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function Fo(i,e,n,s){const l=s-n,h=i-n;return l===0?0:e===1?h/l:(Math.pow(e,h)-1)/(Math.pow(e,l)-1)}class Vs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null;const l=n.expectedType;l&&l.kind!=="value"&&(s=l);const h=[];for(const m of e.slice(1)){const _=n.parse(m,1+h.length,s,void 0,{typeAnnotation:"omit"});if(!_)return null;s=s||_.type,h.push(_)}const p=l&&h.some(m=>mr(l,m.type));return new Vs(p?ht:s,h)}evaluate(e){let n,s=null,l=0;for(const h of this.args)if(l++,s=h.evaluate(e),s&&s instanceof Q&&!s.available&&(n||(n=s.name),s=null,l===this.args.length&&(s=n)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class $s{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let h=1;h<e.length-1;h+=2){const p=e[h];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",h);const m=n.parse(e[h+1],h+1);if(!m)return null;s.push([p,m])}const l=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return l?new $s(s,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,s]of this.bindings)e.push(n,s.serialize());return e.push(this.result.serialize()),e}}class Oo{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Me),l=n.parse(e[2],2,ni(n.expectedType||ht));return s&&l?new Oo(l.type.itemType,s,l):null}evaluate(e){const n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new he(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new he(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new he(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Uo{constructor(e,n){this.type=ut,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,ht),l=n.parse(e[2],2,ht);return s&&l?ui(s.type,[ut,dt,Me,$t,ht])?new Uo(s,l):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(s.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!gn(n,["boolean","string","number","null"]))throw new he(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(ee(n))} instead.`);if(!gn(s,["string","array"]))throw new he(`Expected second argument to be of type array or string, but found ${Ft(ee(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ns{constructor(e,n,s){this.type=Me,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,ht),l=n.parse(e[2],2,ht);if(!s||!l)return null;if(!ui(s.type,[ut,dt,Me,$t,ht]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(s.type)} instead`);if(e.length===4){const h=n.parse(e[3],3,Me);return h?new Ns(s,l,h):null}return new Ns(s,l)}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!gn(n,["boolean","string","number","null"]))throw new he(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(ee(n))} instead.`);if(!gn(s,["string","array"]))throw new he(`Expected second argument to be of type array or string, but found ${Ft(ee(s))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return s.indexOf(n,l)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Vo{constructor(e,n,s,l,h,p){this.inputType=e,this.type=n,this.input=s,this.cases=l,this.outputs=h,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const h={},p=[];for(let w=2;w<e.length-1;w+=2){let T=e[w];const C=e[w+1];Array.isArray(T)||(T=[T]);const M=n.concat(w);if(T.length===0)return M.error("Expected at least one branch label.");for(const B of T){if(typeof B!="number"&&typeof B!="string")return M.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return M.error("Numeric branch labels must be integer values.");if(s){if(M.checkSubtype(s,ee(B)))return null}else s=ee(B);if(h[String(B)]!==void 0)return M.error("Branch labels must be unique.");h[String(B)]=p.length}const R=n.parse(C,w,l);if(!R)return null;l=l||R.type,p.push(R)}const m=n.parse(e[1],1,ht);if(!m)return null;const _=n.parse(e[e.length-1],e.length-1,l);return _?m.type.kind!=="value"&&n.concat(1).checkSubtype(s,m.type)?null:new Vo(s,l,m,h,p,_):null}evaluate(e){const n=this.input.evaluate(e);return(ee(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],l={};for(const p of n){const m=l[this.cases[p]];m===void 0?(l[this.cases[p]]=s.length,s.push([this.cases[p],[p]])):s[m][1].push(p)}const h=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,m]of s)e.push(m.length===1?h(m[0]):m.map(h)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class $o{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&n.expectedType.kind!=="value"&&(s=n.expectedType);const l=[];for(let p=1;p<e.length-1;p+=2){const m=n.parse(e[p],p,ut);if(!m)return null;const _=n.parse(e[p+1],p+1,s);if(!_)return null;l.push([m,_]),s=s||_.type}const h=n.parse(e[e.length-1],e.length-1,s);return h?new $o(s,l,h):null}evaluate(e){for(const[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class js{constructor(e,n,s,l){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,ht),l=n.parse(e[2],2,Me);if(!s||!l)return null;if(!ui(s.type,[ni(ht),dt,ht]))return n.error(`Expected first argument to be of type array or string, but found ${Ft(s.type)} instead`);if(e.length===4){const h=n.parse(e[3],3,Me);return h?new js(s.type,s,l,h):null}return new js(s.type,s,l)}evaluate(e){const n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!gn(n,["string","array"]))throw new he(`Expected first argument to be of type array or string, but found ${Ft(ee(n))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return n.slice(s,l)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Oa(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ua(i,e,n,s){return s.compare(e,n)===0}function Fr(i,e,n){const s=i!=="=="&&i!=="!=";return class xp{constructor(h,p,m){this.type=ut,this.lhs=h,this.rhs=p,this.collator=m,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const m=h[0];let _=p.parse(h[1],1,ht);if(!_)return null;if(!Oa(m,_.type))return p.concat(1).error(`"${m}" comparisons are not supported for type '${Ft(_.type)}'.`);let w=p.parse(h[2],2,ht);if(!w)return null;if(!Oa(m,w.type))return p.concat(2).error(`"${m}" comparisons are not supported for type '${Ft(w.type)}'.`);if(_.type.kind!==w.type.kind&&_.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${Ft(_.type)}' and '${Ft(w.type)}'.`);s&&(_.type.kind==="value"&&w.type.kind!=="value"?_=new Ue(w.type,[_]):_.type.kind!=="value"&&w.type.kind==="value"&&(w=new Ue(_.type,[w])));let T=null;if(h.length===4){if(_.type.kind!=="string"&&w.type.kind!=="string"&&_.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(T=p.parse(h[3],3,fr),!T)return null}return new xp(_,w,T)}evaluate(h){const p=this.lhs.evaluate(h),m=this.rhs.evaluate(h);if(s&&this.hasUntypedArgument){const _=ee(p),w=ee(m);if(_.kind!==w.kind||_.kind!=="string"&&_.kind!=="number")throw new he(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${_.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const _=ee(p),w=ee(m);if(_.kind!=="string"||w.kind!=="string")return e(h,p,m)}return this.collator?n(h,p,m,this.collator.evaluate(h)):e(h,p,m)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[i];return this.eachChild(p=>{h.push(p.serialize())}),h}}}const Wl=Fr("==",function(i,e,n){return e===n},Ua),Hl=Fr("!=",function(i,e,n){return e!==n},function(i,e,n,s){return!Ua(0,e,n,s)}),Xl=Fr("<",function(i,e,n){return e<n},function(i,e,n,s){return s.compare(e,n)<0}),Yl=Fr(">",function(i,e,n){return e>n},function(i,e,n,s){return s.compare(e,n)>0}),Kl=Fr("<=",function(i,e,n){return e<=n},function(i,e,n,s){return s.compare(e,n)<=0}),Jl=Fr(">=",function(i,e,n){return e>=n},function(i,e,n,s){return s.compare(e,n)>=0});class No{constructor(e,n,s,l,h){this.type=dt,this.number=e,this.locale=n,this.currency=s,this.minFractionDigits=l,this.maxFractionDigits=h}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const s=n.parse(e[1],1,Me);if(!s)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return n.error("NumberFormat options argument must be an object.");let h=null;if(l.locale&&(h=n.parse(l.locale,1,dt),!h))return null;let p=null;if(l.currency&&(p=n.parse(l.currency,1,dt),!p))return null;let m=null;if(l["min-fraction-digits"]&&(m=n.parse(l["min-fraction-digits"],1,Me),!m))return null;let _=null;return l["max-fraction-digits"]&&(_=n.parse(l["max-fraction-digits"],1,Me),!_)?null:new No(s,h,p,m,_)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class jo{constructor(e){this.type=Me,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=n.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Ft(s.type)} instead.`):new jo(s):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new he(`Expected value to be of type string or array, but found ${Ft(ee(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Or={"==":Wl,"!=":Hl,">":Yl,"<":Xl,">=":Jl,"<=":Kl,array:Ue,at:Oo,boolean:Ue,case:$o,coalesce:Vs,collator:ei,format:Xe,image:tt,in:Uo,"index-of":Ns,interpolate:Hi,"interpolate-hcl":Hi,"interpolate-lab":Hi,length:jo,let:$s,literal:we,match:Vo,number:Ue,"number-format":No,object:Ue,slice:js,step:cs,string:Ue,"to-boolean":xt,"to-color":xt,"to-number":xt,"to-string":xt,var:Bs,within:gr};function Va(i,[e,n,s,l]){e=e.evaluate(i),n=n.evaluate(i),s=s.evaluate(i);const h=l?l.evaluate(i):1,p=Y(e,n,s,h);if(p)throw new he(p);return new E(e/255*h,n/255*h,s/255*h,h)}function $a(i,e){return i in e}function qo(i,e){const n=e[i];return n===void 0?null:n}function _r(i){return{type:i}}function Na(i){return{result:"success",value:i}}function yr(i){return{result:"error",value:i}}function Ur(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function ja(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Go(i){return!!i.expression&&i.expression.interpolated}function lt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function qs(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Dt(i){return i}function Gs(i,e){const n=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",l=s||!(s||i.property!==void 0),h=i.type||(Go(e)?"exponential":"interval");if(n&&((i=Gn({},i)).stops&&(i.stops=i.stops.map(w=>[w[0],E.parse(w[1])])),i.default=E.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Fa[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let p,m,_;if(h==="exponential")p=Zo;else if(h==="interval")p=Zs;else if(h==="categorical"){p=Jt,m=Object.create(null);for(const w of i.stops)m[w[0]]=w[1];_=typeof i.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);p=Ql}if(s){const w={},T=[];for(let R=0;R<i.stops.length;R++){const B=i.stops[R],H=B[0].zoom;w[H]===void 0&&(w[H]={zoom:H,type:i.type,property:i.property,default:i.default,stops:[]},T.push(H)),w[H].stops.push([B[0].value,B[1]])}const C=[];for(const R of T)C.push([w[R].zoom,Gs(w[R],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:Hi.interpolationFactor.bind(void 0,M),zoomStops:C.map(R=>R[0]),evaluate:({zoom:R},B)=>Zo({stops:C,base:i.base},e,R).evaluate(R,B)}}if(l){const w=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Hi.interpolationFactor.bind(void 0,w),zoomStops:i.stops.map(T=>T[0]),evaluate:({zoom:T})=>p(i,e,T,m,_)}}return{kind:"source",evaluate(w,T){const C=T&&T.properties?T.properties[i.property]:void 0;return C===void 0?jt(i.default,e.default):p(i,e,C,m,_)}}}function jt(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function Jt(i,e,n,s,l){return jt(typeof n===l?s[n]:void 0,i.default,e.default)}function Zs(i,e,n){if(lt(n)!=="number")return jt(i.default,e.default);const s=i.stops.length;if(s===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[s-1][0])return i.stops[s-1][1];const l=Os(i.stops.map(h=>h[0]),n);return i.stops[l][1]}function Zo(i,e,n){const s=i.base!==void 0?i.base:1;if(lt(n)!=="number")return jt(i.default,e.default);const l=i.stops.length;if(l===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[l-1][0])return i.stops[l-1][1];const h=Os(i.stops.map(T=>T[0]),n),p=function(T,C,M,R){const B=R-M,H=T-M;return B===0?0:C===1?H/B:(Math.pow(C,H)-1)/(Math.pow(C,B)-1)}(n,s,i.stops[h][0],i.stops[h+1][0]),m=i.stops[h][1],_=i.stops[h+1][1];let w=us[e.type]||Dt;if(i.colorSpace&&i.colorSpace!=="rgb"){const T=Fa[i.colorSpace];w=(C,M)=>T.reverse(T.interpolate(T.forward(C),T.forward(M),p))}return typeof m.evaluate=="function"?{evaluate(...T){const C=m.evaluate.apply(void 0,T),M=_.evaluate.apply(void 0,T);if(C!==void 0&&M!==void 0)return w(C,M,p)}}:w(m,_,p)}function Ql(i,e,n){return e.type==="color"?n=E.parse(n):e.type==="formatted"?n=q.fromString(n.toString()):e.type==="resolvedImage"?n=Q.fromString(n.toString()):lt(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),jt(n,i.default,e.default)}ct.register(Or,{error:[{kind:"error"},[dt],(i,[e])=>{throw new he(e.evaluate(i))}],typeof:[dt,[ht],(i,[e])=>Ft(ee(e.evaluate(i)))],"to-rgba":[ni(Me,4),[Pi],(i,[e])=>e.evaluate(i).toArray()],rgb:[Pi,[Me,Me,Me],Va],rgba:[Pi,[Me,Me,Me,Me],Va],has:{type:ut,overloads:[[[dt],(i,[e])=>$a(e.evaluate(i),i.properties())],[[dt,fn],(i,[e,n])=>$a(e.evaluate(i),n.evaluate(i))]]},get:{type:ht,overloads:[[[dt],(i,[e])=>qo(e.evaluate(i),i.properties())],[[dt,fn],(i,[e,n])=>qo(e.evaluate(i),n.evaluate(i))]]},"feature-state":[ht,[dt],(i,[e])=>qo(e.evaluate(i),i.featureState||{})],properties:[fn,[],i=>i.properties()],"geometry-type":[dt,[],i=>i.geometryType()],id:[ht,[],i=>i.id()],zoom:[Me,[],i=>i.globals.zoom],"heatmap-density":[Me,[],i=>i.globals.heatmapDensity||0],"line-progress":[Me,[],i=>i.globals.lineProgress||0],accumulated:[ht,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Me,_r(Me),(i,e)=>{let n=0;for(const s of e)n+=s.evaluate(i);return n}],"*":[Me,_r(Me),(i,e)=>{let n=1;for(const s of e)n*=s.evaluate(i);return n}],"-":{type:Me,overloads:[[[Me,Me],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[Me],(i,[e])=>-e.evaluate(i)]]},"/":[Me,[Me,Me],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[Me,[Me,Me],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[Me,[],()=>Math.LN2],pi:[Me,[],()=>Math.PI],e:[Me,[],()=>Math.E],"^":[Me,[Me,Me],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[Me,[Me],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Me,[Me],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Me,[Me],(i,[e])=>Math.log(e.evaluate(i))],log2:[Me,[Me],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Me,[Me],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Me,[Me],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Me,[Me],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Me,[Me],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Me,[Me],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Me,[Me],(i,[e])=>Math.atan(e.evaluate(i))],min:[Me,_r(Me),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[Me,_r(Me),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[Me,[Me],(i,[e])=>Math.abs(e.evaluate(i))],round:[Me,[Me],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Me,[Me],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Me,[Me],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ut,[dt,ht],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[ut,[ht],(i,[e])=>i.id()===e.value],"filter-type-==":[ut,[dt],(i,[e])=>i.geometryType()===e.value],"filter-<":[ut,[dt,ht],(i,[e,n])=>{const s=i.properties()[e.value],l=n.value;return typeof s==typeof l&&s<l}],"filter-id-<":[ut,[ht],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[ut,[dt,ht],(i,[e,n])=>{const s=i.properties()[e.value],l=n.value;return typeof s==typeof l&&s>l}],"filter-id->":[ut,[ht],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[ut,[dt,ht],(i,[e,n])=>{const s=i.properties()[e.value],l=n.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[ut,[ht],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[ut,[dt,ht],(i,[e,n])=>{const s=i.properties()[e.value],l=n.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[ut,[ht],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[ut,[ht],(i,[e])=>e.value in i.properties()],"filter-has-id":[ut,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ut,[ni(dt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ut,[ni(ht)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ut,[dt,ni(ht)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ut,[dt,ni(ht)],(i,[e,n])=>function(s,l,h,p){for(;h<=p;){const m=h+p>>1;if(l[m]===s)return!0;l[m]>s?p=m-1:h=m+1}return!1}(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:ut,overloads:[[[ut,ut],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[_r(ut),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:ut,overloads:[[[ut,ut],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[_r(ut),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[ut,[ut],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ut,[dt],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[dt,[dt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[dt,[dt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[dt,_r(ht),(i,e)=>e.map(n=>de(n.evaluate(i))).join("")],"resolved-locale":[dt,[fr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Wo{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new pt,this._defaultValue=n?function(s){return s.type==="color"&&qs(s.default)?new E(0,0,0,0):s.type==="color"?E.parse(s.default)||null:s.default===void 0?null:s.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,s,l,h,p){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,l,h,p){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null;try{const m=this.expression.evaluate(this._evaluator);if(m==null||typeof m=="number"&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new he(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function Ws(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Or}function Hs(i,e){const n=new Fs(Or,[],e?function(l){const h={color:Pi,string:dt,number:Me,enum:dt,boolean:ut,formatted:mn,resolvedImage:Zn};return l.type==="array"?ni(h[l.value]||ht,l.length):h[l.type]}(e):void 0),s=n.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?Na(new Wo(s,e)):yr(n.errors)}class Xs{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Br(n.expression)}evaluateWithoutErrorHandling(e,n,s,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,l,h,p)}evaluate(e,n,s,l,h,p){return this._styleExpression.evaluate(e,n,s,l,h,p)}}class Ys{constructor(e,n,s,l){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Br(n.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,n,s,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,l,h,p)}evaluate(e,n,s,l,h,p){return this._styleExpression.evaluate(e,n,s,l,h,p)}interpolationFactor(e,n,s){return this.interpolationType?Hi.interpolationFactor(this.interpolationType,e,n,s):0}}function Ho(i,e){const n=Hs(i,e);if(n.result==="error")return n;const s=n.value.expression,l=Rs(s);if(!l&&!Ur(e))return yr([new ki("","data expressions not supported")]);const h=as(s,["zoom"]);if(!h&&!ja(e))return yr([new ki("","zoom expressions not supported")]);const p=Ks(s);return p||h?p instanceof ki?yr([p]):p instanceof Hi&&!Go(e)?yr([new ki("",'"interpolate" expressions cannot be used with this property')]):Na(p?new Ys(l?"camera":"composite",n.value,p.labels,p instanceof Hi?p.interpolation:void 0):new Xs(l?"constant":"source",n.value)):yr([new ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Vr{constructor(e,n){this._parameters=e,this._specification=n,Gn(this,Gs(this._parameters,this._specification))}static deserialize(e){return new Vr(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ks(i){let e=null;if(i instanceof $s)e=Ks(i.result);else if(i instanceof Vs){for(const n of i.args)if(e=Ks(n),e)break}else(i instanceof cs||i instanceof Hi)&&i.input instanceof ct&&i.input.name==="zoom"&&(e=i);return e instanceof ki||i.eachChild(n=>{const s=Ks(n);s instanceof ki?e=s:!e&&s?e=new ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new ki("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function yn(i){const e=i.key,n=i.value,s=i.valueSpec||{},l=i.objectElementValidators||{},h=i.style,p=i.styleSpec;let m=[];const _=lt(n);if(_!=="object")return[new Le(e,n,`object expected, ${_} found`)];for(const w in n){const T=w.split(".")[0],C=s[T]||s["*"];let M;if(l[T])M=l[T];else if(s[T])M=Fi;else if(l["*"])M=l["*"];else{if(!s["*"]){m.push(new Le(e,n[w],`unknown property "${w}"`));continue}M=Fi}m=m.concat(M({key:(e&&`${e}.`)+w,value:n[w],valueSpec:C,style:h,styleSpec:p,object:n,objectKey:w},n))}for(const w in s)l[w]||s[w].required&&s[w].default===void 0&&n[w]===void 0&&m.push(new Le(e,n,`missing required property "${w}"`));return m}function qa(i){const e=i.value,n=i.valueSpec,s=i.style,l=i.styleSpec,h=i.key,p=i.arrayElementValidator||Fi;if(lt(e)!=="array")return[new Le(h,e,`array expected, ${lt(e)} found`)];if(n.length&&e.length!==n.length)return[new Le(h,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Le(h,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let m={type:n.value,values:n.values};l.$version<7&&(m.function=n.function),lt(n.value)==="object"&&(m=n.value);let _=[];for(let w=0;w<e.length;w++)_=_.concat(p({array:e,arrayIndex:w,value:e[w],valueSpec:m,style:s,styleSpec:l,key:`${h}[${w}]`}));return _}function Ga(i){const e=i.key,n=i.value,s=i.valueSpec;let l=lt(n);return l==="number"&&n!=n&&(l="NaN"),l!=="number"?[new Le(e,n,`number expected, ${l} found`)]:"minimum"in s&&n<s.minimum?[new Le(e,n,`${n} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&n>s.maximum?[new Le(e,n,`${n} is greater than the maximum value ${s.maximum}`)]:[]}function Za(i){const e=i.valueSpec,n=Bt(i.value.type);let s,l,h,p={};const m=n!=="categorical"&&i.value.property===void 0,_=!m,w=lt(i.value.stops)==="array"&&lt(i.value.stops[0])==="array"&&lt(i.value.stops[0][0])==="object",T=yn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(R){if(n==="identity")return[new Le(R.key,R.value,'identity function may not have a "stops" property')];let B=[];const H=R.value;return B=B.concat(qa({key:R.key,value:H,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:C})),lt(H)==="array"&&H.length===0&&B.push(new Le(R.key,H,"array must have at least one stop")),B},default:function(R){return Fi({key:R.key,value:R.value,valueSpec:e,style:R.style,styleSpec:R.styleSpec})}}});return n==="identity"&&m&&T.push(new Le(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||T.push(new Le(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!Go(i.valueSpec)&&T.push(new Le(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(_&&!Ur(i.valueSpec)?T.push(new Le(i.key,i.value,"property functions not supported")):m&&!ja(i.valueSpec)&&T.push(new Le(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!w||i.value.property!==void 0||T.push(new Le(i.key,i.value,'"property" property is required')),T;function C(R){let B=[];const H=R.value,X=R.key;if(lt(H)!=="array")return[new Le(X,H,`array expected, ${lt(H)} found`)];if(H.length!==2)return[new Le(X,H,`array length 2 expected, length ${H.length} found`)];if(w){if(lt(H[0])!=="object")return[new Le(X,H,`object expected, ${lt(H[0])} found`)];if(H[0].zoom===void 0)return[new Le(X,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new Le(X,H,"object stop key must have value")];if(h&&h>Bt(H[0].zoom))return[new Le(X,H[0].zoom,"stop zoom values must appear in ascending order")];Bt(H[0].zoom)!==h&&(h=Bt(H[0].zoom),l=void 0,p={}),B=B.concat(yn({key:`${X}[0]`,value:H[0],valueSpec:{zoom:{}},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:Ga,value:M}}))}else B=B.concat(M({key:`${X}[0]`,value:H[0],valueSpec:{},style:R.style,styleSpec:R.styleSpec},H));return Ws(rn(H[1]))?B.concat([new Le(`${X}[1]`,H[1],"expressions are not allowed in function stops.")]):B.concat(Fi({key:`${X}[1]`,value:H[1],valueSpec:e,style:R.style,styleSpec:R.styleSpec}))}function M(R,B){const H=lt(R.value),X=Bt(R.value),re=R.value!==null?R.value:B;if(s){if(H!==s)return[new Le(R.key,re,`${H} stop domain type must match previous stop domain type ${s}`)]}else s=H;if(H!=="number"&&H!=="string"&&H!=="boolean")return[new Le(R.key,re,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&n!=="categorical"){let ue=`number expected, ${H} found`;return Ur(e)&&n===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Le(R.key,re,ue)]}return n!=="categorical"||H!=="number"||isFinite(X)&&Math.floor(X)===X?n!=="categorical"&&H==="number"&&l!==void 0&&X<l?[new Le(R.key,re,"stop domain values must appear in ascending order")]:(l=X,n==="categorical"&&X in p?[new Le(R.key,re,"stop domain values must be unique")]:(p[X]=!0,[])):[new Le(R.key,re,`integer expected, found ${X}`)]}}function $r(i){const e=(i.expressionContext==="property"?Ho:Hs)(rn(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new Le(`${i.key}${s.key}`,i.value,s.message));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Le(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Br(n))return[new Le(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Br(n))return[new Le(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!as(n,["zoom","feature-state"]))return[new Le(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Rs(n))return[new Le(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Js(i){const e=i.key,n=i.value,s=i.valueSpec,l=[];return Array.isArray(s.values)?s.values.indexOf(Bt(n))===-1&&l.push(new Le(e,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(s.values).indexOf(Bt(n))===-1&&l.push(new Le(e,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),l}function Xo(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Xo(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Wa={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Qs(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Xo(i)||(i=ds(i));const e=Hs(i,Wa);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,s,l)=>e.value.evaluate(n,s,{},l),needGeometry:Ha(i)}}function eo(i,e){return i<e?-1:i>e?1:0}function Ha(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Ha(i[e]))return!0;return!1}function ds(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Yo(i[1],i[2],"=="):e==="!="?Nr(Yo(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Yo(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(ds))):e==="all"?["all"].concat(i.slice(1).map(ds)):e==="none"?["all"].concat(i.slice(1).map(ds).map(Nr)):e==="in"?to(i[1],i.slice(2)):e==="!in"?Nr(to(i[1],i.slice(2))):e==="has"?io(i[1]):e==="!has"?Nr(io(i[1])):e!=="within"||i;var n}function Yo(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function to(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",i,["literal",e.sort(eo)]]:["filter-in-small",i,["literal",e]]}}function io(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Nr(i){return["!",i]}function fs(i){return Xo(rn(i.value))?$r(Gn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Xa(i)}function Xa(i){const e=i.value,n=i.key;if(lt(e)!=="array")return[new Le(n,e,`array expected, ${lt(e)} found`)];const s=i.styleSpec;let l,h=[];if(e.length<1)return[new Le(n,e,"filter array must have at least 1 element")];switch(h=h.concat(Js({key:`${n}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),Bt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Bt(e[1])==="$type"&&h.push(new Le(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new Le(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=lt(e[1]),l!=="string"&&h.push(new Le(`${n}[1]`,e[1],`string expected, ${l} found`)));for(let p=2;p<e.length;p++)l=lt(e[p]),Bt(e[1])==="$type"?h=h.concat(Js({key:`${n}[${p}]`,value:e[p],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&h.push(new Le(`${n}[${p}]`,e[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)h=h.concat(Xa({key:`${n}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=lt(e[1]),e.length!==2?h.push(new Le(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&h.push(new Le(`${n}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=lt(e[1]),e.length!==2?h.push(new Le(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&h.push(new Le(`${n}[1]`,e[1],`object expected, ${l} found`))}return h}function ms(i,e){const n=i.key,s=i.style,l=i.styleSpec,h=i.value,p=i.objectKey,m=l[`${e}_${i.layerType}`];if(!m)return[];const _=p.match(/^(.*)-transition$/);if(e==="paint"&&_&&m[_[1]]&&m[_[1]].transition)return Fi({key:n,value:h,valueSpec:l.transition,style:s,styleSpec:l});const w=i.valueSpec||m[p];if(!w)return[new Le(n,h,`unknown property "${p}"`)];let T;if(lt(h)==="string"&&Ur(w)&&!w.tokens&&(T=/^{([^}]+)}$/.exec(h)))return[new Le(n,h,`"${p}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(T[1])} }\`.`)];const C=[];return i.layerType==="symbol"&&(p==="text-field"&&s&&!s.glyphs&&C.push(new Le(n,h,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&qs(rn(h))&&Bt(h.type)==="identity"&&C.push(new Le(n,h,'"text-font" does not support identity functions'))),C.concat(Fi({key:i.key,value:h,valueSpec:w,style:s,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:p}))}function Ya(i){return ms(i,"paint")}function Ka(i){return ms(i,"layout")}function Ja(i){let e=[];const n=i.value,s=i.key,l=i.style,h=i.styleSpec;n.type||n.ref||e.push(new Le(s,n,'either "type" or "ref" is required'));let p=Bt(n.type);const m=Bt(n.ref);if(n.id){const _=Bt(n.id);for(let w=0;w<i.arrayIndex;w++){const T=l.layers[w];Bt(T.id)===_&&e.push(new Le(s,n.id,`duplicate layer id "${n.id}", previously used at line ${T.id.__line__}`))}}if("ref"in n){let _;["type","source","source-layer","filter","layout"].forEach(w=>{w in n&&e.push(new Le(s,n[w],`"${w}" is prohibited for ref layers`))}),l.layers.forEach(w=>{Bt(w.id)===m&&(_=w)}),_?_.ref?e.push(new Le(s,n.ref,"ref cannot reference another ref layer")):p=Bt(_.type):e.push(new Le(s,n.ref,`ref layer "${m}" not found`))}else if(p!=="background")if(n.source){const _=l.sources&&l.sources[n.source],w=_&&Bt(_.type);_?w==="vector"&&p==="raster"?e.push(new Le(s,n.source,`layer "${n.id}" requires a raster source`)):w==="raster"&&p!=="raster"?e.push(new Le(s,n.source,`layer "${n.id}" requires a vector source`)):w!=="vector"||n["source-layer"]?w==="raster-dem"&&p!=="hillshade"?e.push(new Le(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!n.paint||!n.paint["line-gradient"]||w==="geojson"&&_.lineMetrics||e.push(new Le(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Le(s,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Le(s,n.source,`source "${n.source}" not found`))}else e.push(new Le(s,n,'missing required property "source"'));return e=e.concat(yn({key:s,value:n,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Fi({key:`${s}.type`,value:n.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,object:n,objectKey:"type"}),filter:fs,layout:_=>yn({layer:n,key:_.key,value:_.value,style:_.style,styleSpec:_.styleSpec,objectElementValidators:{"*":w=>Ka(Gn({layerType:p},w))}}),paint:_=>yn({layer:n,key:_.key,value:_.value,style:_.style,styleSpec:_.styleSpec,objectElementValidators:{"*":w=>Ya(Gn({layerType:p},w))}})}})),e}function jr(i){const e=i.value,n=i.key,s=lt(e);return s!=="string"?[new Le(n,e,`string expected, ${s} found`)]:[]}const Qa={promoteId:function({key:i,value:e}){if(lt(e)==="string")return jr({key:i,value:e});{const n=[];for(const s in e)n.push(...jr({key:`${i}.${s}`,value:e[s]}));return n}}};function gs(i){const e=i.value,n=i.key,s=i.styleSpec,l=i.style;if(!e.type)return[new Le(n,e,'"type" is required')];const h=Bt(e.type);let p;switch(h){case"vector":case"raster":case"raster-dem":return p=yn({key:n,value:e,valueSpec:s[`source_${h.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:Qa}),p;case"geojson":if(p=yn({key:n,value:e,valueSpec:s.source_geojson,style:l,styleSpec:s,objectElementValidators:Qa}),e.cluster)for(const m in e.clusterProperties){const[_,w]=e.clusterProperties[m],T=typeof _=="string"?[_,["accumulated"],["get",m]]:_;p.push(...$r({key:`${n}.${m}.map`,value:w,expressionContext:"cluster-map"})),p.push(...$r({key:`${n}.${m}.reduce`,value:T,expressionContext:"cluster-reduce"}))}return p;case"video":return yn({key:n,value:e,valueSpec:s.source_video,style:l,styleSpec:s});case"image":return yn({key:n,value:e,valueSpec:s.source_image,style:l,styleSpec:s});case"canvas":return[new Le(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Js({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,styleSpec:s})}}function _s(i){const e=i.value,n=i.styleSpec,s=n.light,l=i.style;let h=[];const p=lt(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Le("light",e,`object expected, ${p} found`)]),h;for(const m in e){const _=m.match(/^(.*)-transition$/);h=h.concat(_&&s[_[1]]&&s[_[1]].transition?Fi({key:m,value:e[m],valueSpec:n.transition,style:l,styleSpec:n}):s[m]?Fi({key:m,value:e[m],valueSpec:s[m],style:l,styleSpec:n}):[new Le(m,e[m],`unknown property "${m}"`)])}return h}const Xi={"*":()=>[],array:qa,boolean:function(i){const e=i.value,n=i.key,s=lt(e);return s!=="boolean"?[new Le(n,e,`boolean expected, ${s} found`)]:[]},number:Ga,color:function(i){const e=i.key,n=i.value,s=lt(n);return s!=="string"?[new Le(e,n,`color expected, ${s} found`)]:_n(n)===null?[new Le(e,n,`color expected, "${n}" found`)]:[]},constants:pr,enum:Js,filter:fs,function:Za,layer:Ja,object:yn,source:gs,light:_s,string:jr,formatted:function(i){return jr(i).length===0?[]:$r(i)},resolvedImage:function(i){return jr(i).length===0?[]:$r(i)}};function Fi(i){const e=i.value,n=i.valueSpec,s=i.styleSpec;return n.expression&&qs(Bt(e))?Za(i):n.expression&&Ws(rn(e))?$r(i):n.type&&Xi[n.type]?Xi[n.type](i):yn(Gn({},i,{valueSpec:n.type?s[n.type]:n}))}function ec(i){const e=i.value,n=i.key,s=jr(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new Le(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new Le(n,e,'"glyphs" url must include a "{range}" token'))),s}function xr(i,e=me){let n=[];return n=n.concat(Fi({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:ec,"*":()=>[]}})),i.constants&&(n=n.concat(pr({key:"constants",value:i.constants,style:i,styleSpec:e}))),el(n)}function el(i){return[].concat(i).sort((e,n)=>e.line-n.line)}function qr(i){return function(...e){return el(i.apply(this,e))}}xr.source=qr(gs),xr.light=qr(_s),xr.layer=qr(Ja),xr.filter=qr(fs),xr.paintProperty=qr(Ya),xr.layoutProperty=qr(Ka);const vr=xr,tc=vr.light,Ko=vr.paintProperty,ic=vr.layoutProperty;function tl(i,e){let n=!1;if(e&&e.length)for(const s of e)i.fire(new hr(new Error(s.message))),n=!0;return n}class br{constructor(e,n,s){const l=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(n=p[1])+2*(s=p[2]);for(let _=0;_<this.d*this.d;_++){const w=p[3+_],T=p[3+_+1];l.push(w===T?null:p.subarray(w,T))}const m=p[3+l.length+1];this.keys=p.subarray(p[3+l.length],m),this.bboxes=p.subarray(m),this.insert=this._insertReadonly}else{this.d=n+2*s;for(let p=0;p<this.d*this.d;p++)l.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=s,this.scale=n/e,this.uid=0;const h=s/n*e;this.min=-h,this.max=e+h}insert(e,n,s,l,h){this._forEachCell(n,s,l,h,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(h)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,s,l,h,p){this.cells[h].push(p)}query(e,n,s,l,h){const p=this.min,m=this.max;if(e<=p&&n<=p&&m<=s&&m<=l&&!h)return Array.prototype.slice.call(this.keys);{const _=[];return this._forEachCell(e,n,s,l,this._queryCell,_,{},h),_}}_queryCell(e,n,s,l,h,p,m,_){const w=this.cells[h];if(w!==null){const T=this.keys,C=this.bboxes;for(let M=0;M<w.length;M++){const R=w[M];if(m[R]===void 0){const B=4*R;(_?_(C[B+0],C[B+1],C[B+2],C[B+3]):e<=C[B+2]&&n<=C[B+3]&&s>=C[B+0]&&l>=C[B+1])?(m[R]=!0,p.push(T[R])):m[R]=!1}}}}_forEachCell(e,n,s,l,h,p,m,_){const w=this._convertToCellCoord(e),T=this._convertToCellCoord(n),C=this._convertToCellCoord(s),M=this._convertToCellCoord(l);for(let R=w;R<=C;R++)for(let B=T;B<=M;B++){const H=this.d*B+R;if((!_||_(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&h.call(this,e,n,s,l,H,p,m,_))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let s=0;for(let p=0;p<this.cells.length;p++)s+=this.cells[p].length;const l=new Int32Array(n+s+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let h=n;for(let p=0;p<e.length;p++){const m=e[p];l[3+p]=h,l.set(m,h),h+=m.length}return l[3+e.length]=h,l.set(this.keys,h),h+=this.keys.length,l[3+e.length+1]=h,l.set(this.bboxes,h),h+=this.bboxes.length,l.buffer}static serialize(e,n){const s=e.toArrayBuffer();return n&&n.push(s),{buffer:s}}static deserialize(e){return new br(e.buffer)}}const Gr={};function Ne(i,e,n={}){Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Gr[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}Ne("Object",Object),Ne("TransferableGridIndex",br),Ne("Color",E),Ne("Error",Error),Ne("AJAXError",fi),Ne("ResolvedImage",Q),Ne("StylePropertyFunction",Vr),Ne("StyleExpression",Wo,{omit:["_evaluator"]}),Ne("ZoomDependentExpression",Ys),Ne("ZoomConstantExpression",Xs),Ne("CompoundExpression",ct,{omit:["_evaluate"]});for(const i in Or)Or[i]._classRegistryKey||Ne(`Expression_${i}`,Or[i]);function Jo(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function ys(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Jo(i)||Wi(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return e&&e.push(n.buffer),n}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const s of i)n.push(ys(s,e));return n}if(typeof i=="object"){const n=i.constructor,s=n._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");const l=n.serialize?n.serialize(i,e):{};if(!n.serialize){for(const h in i){if(!i.hasOwnProperty(h)||Gr[s].omit.indexOf(h)>=0)continue;const p=i[h];l[h]=Gr[s].shallow.indexOf(h)>=0?p:ys(p,e)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof i)}function wr(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Jo(i)||Wi(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(wr);if(typeof i=="object"){const e=i.$name||"Object";if(!Gr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=Gr[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const s=Object.create(n.prototype);for(const l of Object.keys(i)){if(l==="$name")continue;const h=i[l];s[l]=Gr[e].shallow.indexOf(l)>=0?h:wr(h)}return s}throw new Error("can't deserialize object of type "+typeof i)}class xs{constructor(){this.first=!0}update(e,n){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const De={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Qo(i){for(const e of i)if(vs(e.charCodeAt(0)))return!0;return!1}function il(i){for(const e of i)if(!nc(e.charCodeAt(0)))return!1;return!0}function nc(i){return!(De.Arabic(i)||De["Arabic Supplement"](i)||De["Arabic Extended-A"](i)||De["Arabic Presentation Forms-A"](i)||De["Arabic Presentation Forms-B"](i))}function vs(i){return!(i!==746&&i!==747&&(i<4352||!(De["Bopomofo Extended"](i)||De.Bopomofo(i)||De["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||De["CJK Compatibility Ideographs"](i)||De["CJK Compatibility"](i)||De["CJK Radicals Supplement"](i)||De["CJK Strokes"](i)||!(!De["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||De["CJK Unified Ideographs Extension A"](i)||De["CJK Unified Ideographs"](i)||De["Enclosed CJK Letters and Months"](i)||De["Hangul Compatibility Jamo"](i)||De["Hangul Jamo Extended-A"](i)||De["Hangul Jamo Extended-B"](i)||De["Hangul Jamo"](i)||De["Hangul Syllables"](i)||De.Hiragana(i)||De["Ideographic Description Characters"](i)||De.Kanbun(i)||De["Kangxi Radicals"](i)||De["Katakana Phonetic Extensions"](i)||De.Katakana(i)&&i!==12540||!(!De["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!De["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||De["Unified Canadian Aboriginal Syllabics"](i)||De["Unified Canadian Aboriginal Syllabics Extended"](i)||De["Vertical Forms"](i)||De["Yijing Hexagram Symbols"](i)||De["Yi Syllables"](i)||De["Yi Radicals"](i))))}function nl(i){return!(vs(i)||function(e){return!!(De["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||De["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||De["Letterlike Symbols"](e)||De["Number Forms"](e)||De["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||De["Control Pictures"](e)&&e!==9251||De["Optical Character Recognition"](e)||De["Enclosed Alphanumerics"](e)||De["Geometric Shapes"](e)||De["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||De["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||De["CJK Symbols and Punctuation"](e)||De.Katakana(e)||De["Private Use Area"](e)||De["CJK Compatibility Forms"](e)||De["Small Form Variants"](e)||De["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function rl(i){return i>=1424&&i<=2303||De["Arabic Presentation Forms-A"](i)||De["Arabic Presentation Forms-B"](i)}function rc(i,e){return!(!e&&rl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||De.Khmer(i))}function sc(i){for(const e of i)if(rl(e.charCodeAt(0)))return!0;return!1}const no="deferred",ea="loading",ta="loaded";let ia=null,Oi="unavailable",ir=null;const sl=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Oi="error"),ia&&ia(i)};function na(){Zr.fire(new tr("pluginStateChange",{pluginStatus:Oi,pluginURL:ir}))}const Zr=new ss,ra=function(){return Oi},ro=function(){if(Oi!==no||!ir)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Oi=ea,na(),ir&&En({url:ir},i=>{i?sl(i):(Oi=ta,na())})},on={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Oi===ta||on.applyArabicShaping!=null,isLoading:()=>Oi===ea,setState(i){Oi=i.pluginStatus,ir=i.pluginURL},isParsed:()=>on.applyArabicShaping!=null&&on.processBidirectionalText!=null&&on.processStyledBidirectionalText!=null,getPluginURL:()=>ir};class qt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new xs,this.transition={})}isSupportedScript(e){return function(n,s){for(const l of n)if(!rc(l.charCodeAt(0),s))return!1;return!0}(e,on.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*n}}}class so{constructor(e,n){this.property=e,this.value=n,this.expression=function(s,l){if(qs(s))return new Vr(s,l);if(Ws(s)){const h=Ho(s,l);if(h.result==="error")throw new Error(h.value.map(p=>`${p.key}: ${p.message}`).join(", "));return h.value}{let h=s;return typeof s=="string"&&l.type==="color"&&(h=E.parse(s)),{kind:"constant",evaluate:()=>h}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class oo{constructor(e){this.property=e,this.value=new so(e,void 0)}transitioned(e,n){return new ol(this.property,this.value,n,le({},e.transition,this.transition),e.now)}untransitioned(){return new ol(this.property,this.value,null,{},0)}}class sa{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return ft(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new oo(this._values[e].property)),this._values[e].value=new so(this._values[e].property,n===null?void 0:ft(n))}getTransition(e){return ft(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new oo(this._values[e].property)),this._values[e].transition=ft(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);s!==void 0&&(e[n]=s);const l=this.getTransition(n);l!==void 0&&(e[`${n}-transition`]=l)}return e}transitioned(e,n){const s=new al(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(e,n._values[l]);return s}untransitioned(){const e=new al(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class ol{constructor(e,n,s,l,h){this.property=e,this.value=n,this.begin=h+l.delay||0,this.end=this.begin+l.duration||0,e.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){const l=e.now||0,h=this.value.possiblyEvaluate(e,n,s),p=this.prior;if(p){if(l>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(l<this.begin)return p.possiblyEvaluate(e,n,s);{const m=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,s),h,function(_){if(_<=0)return 0;if(_>=1)return 1;const w=_*_,T=w*_;return 4*(_<.5?T:3*(_-w)+T-.75)}(m))}}return h}}class al{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){const l=new ao(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,n,s);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class oc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return ft(this._values[e].value)}setValue(e,n){this._values[e]=new so(this._values[e].property,n===null?void 0:ft(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);s!==void 0&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){const l=new ao(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,n,s);return l}}class kn{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,s,l){return this.property.evaluate(this.value,this.parameters,e,n,s,l)}}class ao{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class He{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,s){const l=us[this.specification.type];return l?l(e,n,s):e}}class it{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,l){return new kn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},s,l)}:e.expression,n)}interpolate(e,n,s){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new kn(this,{kind:"constant",value:void 0},e.parameters);const l=us[this.specification.type];return l?new kn(this,{kind:"constant",value:l(e.value.value,n.value.value,s)},e.parameters):e}evaluate(e,n,s,l,h,p){return e.kind==="constant"?e.value:e.evaluate(n,s,l,h,p)}}class bs extends it{possiblyEvaluate(e,n,s,l){if(e.value===void 0)return new kn(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const h=e.expression.evaluate(n,null,{},s,l),p=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,m=this._calculate(p,p,p,n);return new kn(this,{kind:"constant",value:m},n)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new kn(this,{kind:"constant",value:h},n)}return new kn(this,e.expression,n)}evaluate(e,n,s,l,h,p){if(e.kind==="source"){const m=e.evaluate(n,s,l,h,p);return this._calculate(m,m,m,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},s,l),e.evaluate({zoom:Math.floor(n.zoom)},s,l),e.evaluate({zoom:Math.floor(n.zoom)+1},s,l),n):e.value}_calculate(e,n,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:s,to:n}}interpolate(e){return e}}class ws{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(n,null,{},s,l);return this._calculate(h,h,h,n)}return this._calculate(e.expression.evaluate(new qt(Math.floor(n.zoom-1),n)),e.expression.evaluate(new qt(Math.floor(n.zoom),n)),e.expression.evaluate(new qt(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:s,to:n}}interpolate(e){return e}}class oa{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,l){return!!e.expression.evaluate(n,null,{},s,l)}interpolate(){return!1}}class hi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const s=e[n];s.specification.overridable&&this.overridableProperties.push(n);const l=this.defaultPropertyValues[n]=new so(s,void 0),h=this.defaultTransitionablePropertyValues[n]=new oo(s);this.defaultTransitioningPropertyValues[n]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=l.possiblyEvaluate({})}}}Ne("DataDrivenProperty",it),Ne("DataConstantProperty",He),Ne("CrossFadedDataDrivenProperty",bs),Ne("CrossFadedProperty",ws),Ne("ColorRampProperty",oa);const Sr="-transition";class Ui extends ss{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new oc(n.layout)),n.paint)){this._transitionablePaint=new sa(n.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ao(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,s={}){n!=null&&this._validate(ic,`layers.${this.id}.layout.${e}`,e,n,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(Sr)?this._transitionablePaint.getTransition(e.slice(0,-Sr.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,s={}){if(n!=null&&this._validate(Ko,`layers.${this.id}.paint.${e}`,e,n,s))return!1;if(e.endsWith(Sr))return this._transitionablePaint.setTransition(e.slice(0,-Sr.length),n||void 0),!1;{const l=this._transitionablePaint._values[e],h=l.property.specification["property-type"]==="cross-faded-data-driven",p=l.value.isDataDriven(),m=l.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const _=this._transitionablePaint._values[e].value;return _.isDataDriven()||p||h||this._handleOverridablePaintPropertyUpdate(e,m,_)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),kt(e,(n,s)=>!(n===void 0||s==="layout"&&!Object.keys(n).length||s==="paint"&&!Object.keys(n).length))}_validate(e,n,s,l,h={}){return(!h||h.validate!==!1)&&tl(this,e.call(vr,{key:n,layerType:this.type,objectKey:s,value:l,styleSpec:me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof kn&&Ur(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const ac={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ss{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Nt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function pi(i,e=1){let n=0,s=0;return{members:i.map(l=>{const h=ac[l.type].BYTES_PER_ELEMENT,p=n=ll(n,Math.max(e,h)),m=l.components||1;return s=Math.max(s,h),n+=h*m,{name:l.name,type:l.type,components:m,offset:p}}),size:ll(n,Math.max(s,e)),alignment:e}}function ll(i,e){return Math.ceil(i/e)*e}class Wr extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const l=2*e;return this.int16[l+0]=n,this.int16[l+1]=s,e}}Wr.prototype.bytesPerElement=4,Ne("StructArrayLayout2i4",Wr);class As extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,l)}emplace(e,n,s,l,h){const p=4*e;return this.int16[p+0]=n,this.int16[p+1]=s,this.int16[p+2]=l,this.int16[p+3]=h,e}}As.prototype.bytesPerElement=8,Ne("StructArrayLayout4i8",As);class c extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,l,h,p)}emplace(e,n,s,l,h,p,m){const _=6*e;return this.int16[_+0]=n,this.int16[_+1]=s,this.int16[_+2]=l,this.int16[_+3]=h,this.int16[_+4]=p,this.int16[_+5]=m,e}}c.prototype.bytesPerElement=12,Ne("StructArrayLayout2i4i12",c);class t extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,l,h,p)}emplace(e,n,s,l,h,p,m){const _=4*e,w=8*e;return this.int16[_+0]=n,this.int16[_+1]=s,this.uint8[w+4]=l,this.uint8[w+5]=h,this.uint8[w+6]=p,this.uint8[w+7]=m,e}}t.prototype.bytesPerElement=8,Ne("StructArrayLayout2i4ub8",t);class r extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const l=2*e;return this.float32[l+0]=n,this.float32[l+1]=s,e}}r.prototype.bytesPerElement=8,Ne("StructArrayLayout2f8",r);class a extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,p,m,_,w,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,n,s,l,h,p,m,_,w,T)}emplace(e,n,s,l,h,p,m,_,w,T,C){const M=10*e;return this.uint16[M+0]=n,this.uint16[M+1]=s,this.uint16[M+2]=l,this.uint16[M+3]=h,this.uint16[M+4]=p,this.uint16[M+5]=m,this.uint16[M+6]=_,this.uint16[M+7]=w,this.uint16[M+8]=T,this.uint16[M+9]=C,e}}a.prototype.bytesPerElement=20,Ne("StructArrayLayout10ui20",a);class u extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,p,m,_,w,T,C,M){const R=this.length;return this.resize(R+1),this.emplace(R,e,n,s,l,h,p,m,_,w,T,C,M)}emplace(e,n,s,l,h,p,m,_,w,T,C,M,R){const B=12*e;return this.int16[B+0]=n,this.int16[B+1]=s,this.int16[B+2]=l,this.int16[B+3]=h,this.uint16[B+4]=p,this.uint16[B+5]=m,this.uint16[B+6]=_,this.uint16[B+7]=w,this.int16[B+8]=T,this.int16[B+9]=C,this.int16[B+10]=M,this.int16[B+11]=R,e}}u.prototype.bytesPerElement=24,Ne("StructArrayLayout4i4ui4i24",u);class d extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,s)}emplace(e,n,s,l){const h=3*e;return this.float32[h+0]=n,this.float32[h+1]=s,this.float32[h+2]=l,e}}d.prototype.bytesPerElement=12,Ne("StructArrayLayout3f12",d);class g extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}g.prototype.bytesPerElement=4,Ne("StructArrayLayout1ul4",g);class x extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,p,m,_,w){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,s,l,h,p,m,_,w)}emplace(e,n,s,l,h,p,m,_,w,T){const C=10*e,M=5*e;return this.int16[C+0]=n,this.int16[C+1]=s,this.int16[C+2]=l,this.int16[C+3]=h,this.int16[C+4]=p,this.int16[C+5]=m,this.uint32[M+3]=_,this.uint16[C+8]=w,this.uint16[C+9]=T,e}}x.prototype.bytesPerElement=20,Ne("StructArrayLayout6i1ul2ui20",x);class b extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,l,h,p)}emplace(e,n,s,l,h,p,m){const _=6*e;return this.int16[_+0]=n,this.int16[_+1]=s,this.int16[_+2]=l,this.int16[_+3]=h,this.int16[_+4]=p,this.int16[_+5]=m,e}}b.prototype.bytesPerElement=12,Ne("StructArrayLayout2i2i2i12",b);class I extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,s,l,h)}emplace(e,n,s,l,h,p){const m=4*e,_=8*e;return this.float32[m+0]=n,this.float32[m+1]=s,this.float32[m+2]=l,this.int16[_+6]=h,this.int16[_+7]=p,e}}I.prototype.bytesPerElement=16,Ne("StructArrayLayout2f1f2i16",I);class k extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,l)}emplace(e,n,s,l,h){const p=12*e,m=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=s,this.float32[m+1]=l,this.float32[m+2]=h,e}}k.prototype.bytesPerElement=12,Ne("StructArrayLayout2ub2f12",k);class L extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,s)}emplace(e,n,s,l){const h=3*e;return this.uint16[h+0]=n,this.uint16[h+1]=s,this.uint16[h+2]=l,e}}L.prototype.bytesPerElement=6,Ne("StructArrayLayout3ui6",L);class O extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,p,m,_,w,T,C,M,R,B,H,X,re){const ue=this.length;return this.resize(ue+1),this.emplace(ue,e,n,s,l,h,p,m,_,w,T,C,M,R,B,H,X,re)}emplace(e,n,s,l,h,p,m,_,w,T,C,M,R,B,H,X,re,ue){const ce=24*e,ge=12*e,Se=48*e;return this.int16[ce+0]=n,this.int16[ce+1]=s,this.uint16[ce+2]=l,this.uint16[ce+3]=h,this.uint32[ge+2]=p,this.uint32[ge+3]=m,this.uint32[ge+4]=_,this.uint16[ce+10]=w,this.uint16[ce+11]=T,this.uint16[ce+12]=C,this.float32[ge+7]=M,this.float32[ge+8]=R,this.uint8[Se+36]=B,this.uint8[Se+37]=H,this.uint8[Se+38]=X,this.uint32[ge+10]=re,this.int16[ce+22]=ue,e}}O.prototype.bytesPerElement=48,Ne("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",O);class W extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l,h,p,m,_,w,T,C,M,R,B,H,X,re,ue,ce,ge,Se,ve,je,Ke,Be,Fe,Pe,$e){const Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,e,n,s,l,h,p,m,_,w,T,C,M,R,B,H,X,re,ue,ce,ge,Se,ve,je,Ke,Be,Fe,Pe,$e)}emplace(e,n,s,l,h,p,m,_,w,T,C,M,R,B,H,X,re,ue,ce,ge,Se,ve,je,Ke,Be,Fe,Pe,$e,Oe){const Ee=34*e,nt=17*e;return this.int16[Ee+0]=n,this.int16[Ee+1]=s,this.int16[Ee+2]=l,this.int16[Ee+3]=h,this.int16[Ee+4]=p,this.int16[Ee+5]=m,this.int16[Ee+6]=_,this.int16[Ee+7]=w,this.uint16[Ee+8]=T,this.uint16[Ee+9]=C,this.uint16[Ee+10]=M,this.uint16[Ee+11]=R,this.uint16[Ee+12]=B,this.uint16[Ee+13]=H,this.uint16[Ee+14]=X,this.uint16[Ee+15]=re,this.uint16[Ee+16]=ue,this.uint16[Ee+17]=ce,this.uint16[Ee+18]=ge,this.uint16[Ee+19]=Se,this.uint16[Ee+20]=ve,this.uint16[Ee+21]=je,this.uint16[Ee+22]=Ke,this.uint32[nt+12]=Be,this.float32[nt+13]=Fe,this.float32[nt+14]=Pe,this.float32[nt+15]=$e,this.float32[nt+16]=Oe,e}}W.prototype.bytesPerElement=68,Ne("StructArrayLayout8i15ui1ul4f68",W);class U extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}U.prototype.bytesPerElement=4,Ne("StructArrayLayout1f4",U);class Z extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,s)}emplace(e,n,s,l){const h=3*e;return this.int16[h+0]=n,this.int16[h+1]=s,this.int16[h+2]=l,e}}Z.prototype.bytesPerElement=6,Ne("StructArrayLayout3i6",Z);class te extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,s)}emplace(e,n,s,l){const h=4*e;return this.uint32[2*e+0]=n,this.uint16[h+2]=s,this.uint16[h+3]=l,e}}te.prototype.bytesPerElement=8,Ne("StructArrayLayout1ul2ui8",te);class ie extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const l=2*e;return this.uint16[l+0]=n,this.uint16[l+1]=s,e}}ie.prototype.bytesPerElement=4,Ne("StructArrayLayout2ui4",ie);class oe extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}oe.prototype.bytesPerElement=2,Ne("StructArrayLayout1ui2",oe);class ne extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,l)}emplace(e,n,s,l,h){const p=4*e;return this.float32[p+0]=n,this.float32[p+1]=s,this.float32[p+2]=l,this.float32[p+3]=h,e}}ne.prototype.bytesPerElement=16,Ne("StructArrayLayout4f16",ne);class ye extends Ss{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Ve(this.anchorPointX,this.anchorPointY)}}ye.prototype.size=20;class pe extends x{get(e){return new ye(this,e)}}Ne("CollisionBoxArray",pe);class fe extends Ss{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}fe.prototype.size=48;class Ie extends O{get(e){return new fe(this,e)}}Ne("PlacedSymbolArray",Ie);class ke extends Ss{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}ke.prototype.size=68;class _e extends W{get(e){return new ke(this,e)}}Ne("SymbolInstanceArray",_e);class qe extends U{getoffsetX(e){return this.float32[1*e+0]}}Ne("GlyphOffsetArray",qe);class Re extends Z{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ne("SymbolLineVertexArray",Re);class ot extends Ss{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ot.prototype.size=8;class St extends te{get(e){return new ot(this,e)}}Ne("FeatureIndexArray",St);class gt extends Wr{}class vt extends Wr{}class Yt extends c{}class at extends t{}class Tt extends r{}class Lt extends a{}class vi extends u{}class Yi extends d{}class an extends g{}class ln extends b{}class nr extends k{}class Vi extends L{}class Pn extends ie{}const Ar=pi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ki}=Ar;class Et{constructor(e=[]){this.segments=e}prepareSegment(e,n,s,l){let h=this.segments[this.segments.length-1];return e>Et.MAX_VERTEX_ARRAY_LENGTH&&Ye(`Max vertices per segment is ${Et.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>Et.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==l)&&(h={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},l!==void 0&&(h.sortKey=l),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,l){return new Et([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function Pt(i,e){return 256*(i=j(Math.floor(i),0,255))+j(Math.floor(e),0,255)}Et.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ne("SegmentVector",Et);const si=pi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Mi={exports:{}},Gt={exports:{}};Gt.exports=function(i,e){var n,s,l,h,p,m,_,w;for(s=i.length-(n=3&i.length),l=e,p=3432918353,m=461845907,w=0;w<s;)_=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24,++w,l=27492+(65535&(h=5*(65535&(l=(l^=_=(65535&(_=(_=(65535&_)*p+(((_>>>16)*p&65535)<<16)&4294967295)<<15|_>>>17))*m+(((_>>>16)*m&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(_=0,n){case 3:_^=(255&i.charCodeAt(w+2))<<16;case 2:_^=(255&i.charCodeAt(w+1))<<8;case 1:l^=_=(65535&(_=(_=(65535&(_^=255&i.charCodeAt(w)))*p+(((_>>>16)*p&65535)<<16)&4294967295)<<15|_>>>17))*m+(((_>>>16)*m&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var Ir={exports:{}};Ir.exports=function(i,e){for(var n,s=i.length,l=e^s,h=0;s>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(h)|(255&i.charCodeAt(++h))<<8|(255&i.charCodeAt(++h))<<16|(255&i.charCodeAt(++h))<<24))+((1540483477*(n>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++h;switch(s){case 3:l^=(255&i.charCodeAt(h+2))<<16;case 2:l^=(255&i.charCodeAt(h+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(h)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var Mn=Gt.exports,lo=Ir.exports;Mi.exports=Mn,Mi.exports.murmur3=Mn,Mi.exports.murmur2=lo;var aa=Mi.exports;class co{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,s,l){this.ids.push(cl(e)),this.positions.push(n,s,l)}getPositions(e){const n=cl(e);let s=0,l=this.ids.length-1;for(;s<l;){const p=s+l>>1;this.ids[p]>=n?l=p:s=p+1}const h=[];for(;this.ids[s]===n;)h.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return h}static serialize(e,n){const s=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Tr(s,l,0,s.length-1),n&&n.push(s.buffer,l.buffer),{ids:s,positions:l}}static deserialize(e){const n=new co;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function cl(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:aa(String(i))}function Tr(i,e,n,s){for(;n<s;){const l=i[n+s>>1];let h=n-1,p=s+1;for(;;){do h++;while(i[h]<l);do p--;while(i[p]>l);if(h>=p)break;uo(i,h,p),uo(e,3*h,3*p),uo(e,3*h+1,3*p+1),uo(e,3*h+2,3*p+2)}p-n<s-p?(Tr(i,e,n,p),n=p+1):(Tr(i,e,p+1,s),s=p)}}function uo(i,e,n){const s=i[e];i[e]=i[n],i[n]=s}Ne("FeaturePositionMap",co);class Dn{constructor(e,n){this.gl=e.gl,this.location=n}}class Hr extends Dn{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class uu extends Dn{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class hu extends Dn{constructor(e,n){super(e,n),this.current=E.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const zp=new Float32Array(16);function lc(i){return[Pt(255*i.r,255*i.g),Pt(255*i.b,255*i.a)]}class la{constructor(e,n,s){this.value=e,this.uniformNames=n.map(l=>`u_${l}`),this.type=s}setUniform(e,n,s){e.set(s.constantOr(this.value))}getBinding(e,n,s){return this.type==="color"?new hu(e,n):new Hr(e,n)}}class ho{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setUniform(e,n,s,l){const h=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&e.set(h)}getBinding(e,n,s){return s.substr(0,9)==="u_pattern"?new uu(e,n):new Hr(e,n)}}class Er{constructor(e,n,s,l){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(h=>({name:`a_${h}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,n,s,l,h){const p=this.paintVertexArray.length,m=this.expression.evaluate(new qt(0),n,{},l,[],h);this.paintVertexArray.resize(e),this._setPaintValue(p,e,m)}updatePaintArray(e,n,s,l){const h=this.expression.evaluate({zoom:0},s,l);this._setPaintValue(e,n,h)}_setPaintValue(e,n,s){if(this.type==="color"){const l=lc(s);for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,l[0],l[1])}else{for(let l=e;l<n;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Wn{constructor(e,n,s,l,h,p){this.expression=e,this.uniformNames=n.map(m=>`u_${m}_t`),this.type=s,this.useIntegerZoom=l,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,s,l,h){const p=this.expression.evaluate(new qt(this.zoom),n,{},l,[],h),m=this.expression.evaluate(new qt(this.zoom+1),n,{},l,[],h),_=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(_,e,p,m)}updatePaintArray(e,n,s,l){const h=this.expression.evaluate({zoom:this.zoom},s,l),p=this.expression.evaluate({zoom:this.zoom+1},s,l);this._setPaintValue(e,n,h,p)}_setPaintValue(e,n,s,l){if(this.type==="color"){const h=lc(s),p=lc(l);for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,h[0],h[1],p[0],p[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const s=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,l=j(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(l)}getBinding(e,n,s){return new Hr(e,n)}}class Xr{constructor(e,n,s,l,h,p){this.expression=e,this.type=n,this.useIntegerZoom=s,this.zoom=l,this.layerId=p,this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(e,n,s){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,l,h){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],h)}_setPaintValues(e,n,s,l){if(!l||!s)return;const{min:h,mid:p,max:m}=s,_=l[h],w=l[p],T=l[m];if(_&&w&&T)for(let C=e;C<n;C++)this.zoomInPaintVertexArray.emplace(C,w.tl[0],w.tl[1],w.br[0],w.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],w.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,w.tl[0],w.tl[1],w.br[0],w.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],w.pixelRatio,T.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,si.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,si.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class pu{constructor(e,n,s){this.binders={},this._buffers=[];const l=[];for(const h in e.paint._values){if(!s(h))continue;const p=e.paint.get(h);if(!(p instanceof kn&&Ur(p.property.specification)))continue;const m=kp(h,e.type),_=p.value,w=p.property.specification.type,T=p.property.useIntegerZoom,C=p.property.specification["property-type"],M=C==="cross-faded"||C==="cross-faded-data-driven";if(_.kind==="constant")this.binders[h]=M?new ho(_.value,m):new la(_.value,m,w),l.push(`/u_${h}`);else if(_.kind==="source"||M){const R=du(h,w,"source");this.binders[h]=M?new Xr(_,w,T,n,R,e.id):new Er(_,m,w,R),l.push(`/a_${h}`)}else{const R=du(h,w,"composite");this.binders[h]=new Wn(_,m,w,T,n,R),l.push(`/z_${h}`)}}this.cacheKey=l.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Er||n instanceof Wn?n.maxValue:0}populatePaintArrays(e,n,s,l,h){for(const p in this.binders){const m=this.binders[p];(m instanceof Er||m instanceof Wn||m instanceof Xr)&&m.populatePaintArray(e,n,s,l,h)}}setConstantPatternPositions(e,n){for(const s in this.binders){const l=this.binders[s];l instanceof ho&&l.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,s,l,h){let p=!1;for(const m in e){const _=n.getPositions(m);for(const w of _){const T=s.feature(w.index);for(const C in this.binders){const M=this.binders[C];if((M instanceof Er||M instanceof Wn||M instanceof Xr)&&M.expression.isStateDependent===!0){const R=l.paint.get(C);M.expression=R.value,M.updatePaintArray(w.start,w.end,T,e[m],h),p=!0}}}}return p}defines(){const e=[];for(const n in this.binders){const s=this.binders[n];(s instanceof la||s instanceof ho)&&e.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof Er||s instanceof Wn)for(let l=0;l<s.paintVertexAttributes.length;l++)e.push(s.paintVertexAttributes[l].name);else if(s instanceof Xr)for(let l=0;l<si.members.length;l++)e.push(si.members[l].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof la||s instanceof ho||s instanceof Wn)for(const l of s.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const s=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof la||h instanceof ho||h instanceof Wn){for(const p of h.uniformNames)if(n[p]){const m=h.getBinding(e,n[p],p);s.push({name:p,property:l,binding:m})}}}return s}setUniforms(e,n,s,l){for(const{name:h,property:p,binding:m}of n)this.binders[p].setUniform(m,l,s.get(p),h)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const s=this.binders[n];if(e&&s instanceof Xr){const l=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(s instanceof Er||s instanceof Wn)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const n in this.binders){const s=this.binders[n];(s instanceof Er||s instanceof Wn||s instanceof Xr)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Er||n instanceof Wn||n instanceof Xr)&&n.destroy()}}}class Is{constructor(e,n,s=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new pu(l,n,s);this.needsUpload=!1,this._featureMap=new co,this._bufferOffset=0}populatePaintArrays(e,n,s,l,h,p){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(e,n,l,h,p);n.id!==void 0&&this._featureMap.add(n.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,l){for(const h of s)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,n,h,l)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function kp(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function du(i,e,n){const s={color:{source:r,composite:ne},number:{source:U,composite:r}},l=function(h){return{"line-pattern":{source:Lt,composite:Lt},"fill-pattern":{source:Lt,composite:Lt},"fill-extrusion-pattern":{source:Lt,composite:Lt}}[h]}(i);return l&&l[n]||s[e][n]}Ne("ConstantBinder",la),Ne("CrossFadedConstantBinder",ho),Ne("SourceExpressionBinder",Er),Ne("CrossFadedCompositeBinder",Xr),Ne("CompositeExpressionBinder",Wn),Ne("ProgramConfiguration",pu,{omit:["_buffers"]}),Ne("ProgramConfigurationSet",Is);var di=8192;const cc=Math.pow(2,14)-1,fu=-cc-1;function Ts(i){const e=di/i.extent,n=i.loadGeometry();for(let s=0;s<n.length;s++){const l=n[s];for(let h=0;h<l.length;h++){const p=l[h],m=Math.round(p.x*e),_=Math.round(p.y*e);p.x=j(m,fu,cc),p.y=j(_,fu,cc),(m<p.x||m>p.x+1||_<p.y||_>p.y+1)&&Ye("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Es(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Ts(i):[]}}function ul(i,e,n,s,l){i.emplaceBack(2*e+(s+1)/2,2*n+(l+1)/2)}class uc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new gt,this.indexArray=new Vi,this.segments=new Et,this.programConfigurations=new Is(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){const l=this.layers[0],h=[];let p=null,m=!1;l.type==="circle"&&(p=l.layout.get("circle-sort-key"),m=!p.isConstant());for(const{feature:_,id:w,index:T,sourceLayerIndex:C}of e){const M=this.layers[0]._featureFilter.needGeometry,R=Es(_,M);if(!this.layers[0]._featureFilter.filter(new qt(this.zoom),R,s))continue;const B=m?p.evaluate(R,{},s):void 0,H={id:w,properties:_.properties,type:_.type,sourceLayerIndex:C,index:T,geometry:M?R.geometry:Ts(_),patterns:{},sortKey:B};h.push(H)}m&&h.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of h){const{geometry:w,index:T,sourceLayerIndex:C}=_,M=e[T].feature;this.addFeature(_,w,T,s),n.featureIndex.insert(M,w,T,C,this.index)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ki),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,l){for(const h of n)for(const p of h){const m=p.x,_=p.y;if(m<0||m>=di||_<0||_>=di)continue;const w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),T=w.vertexLength;ul(this.layoutVertexArray,m,_,-1,-1),ul(this.layoutVertexArray,m,_,1,-1),ul(this.layoutVertexArray,m,_,1,1),ul(this.layoutVertexArray,m,_,-1,1),this.indexArray.emplaceBack(T,T+1,T+2),this.indexArray.emplaceBack(T,T+3,T+2),w.vertexLength+=4,w.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},l)}}function mu(i,e){for(let n=0;n<i.length;n++)if(po(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(po(i,e[n]))return!0;return!!hc(i,e)}function Pp(i,e,n){return!!po(i,e)||!!pc(e,i,n)}function gu(i,e){if(i.length===1)return yu(e,i[0]);for(let n=0;n<e.length;n++){const s=e[n];for(let l=0;l<s.length;l++)if(po(i,s[l]))return!0}for(let n=0;n<i.length;n++)if(yu(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(hc(i,e[n]))return!0;return!1}function Mp(i,e,n){if(i.length>1){if(hc(i,e))return!0;for(let s=0;s<e.length;s++)if(pc(e[s],i,n))return!0}for(let s=0;s<i.length;s++)if(pc(i[s],e,n))return!0;return!1}function hc(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const s=i[n],l=i[n+1];for(let h=0;h<e.length-1;h++)if(Dp(s,l,e[h],e[h+1]))return!0}return!1}function Dp(i,e,n,s){return Te(i,n,s)!==Te(e,n,s)&&Te(i,e,n)!==Te(i,e,s)}function pc(i,e,n){const s=n*n;if(e.length===1)return i.distSqr(e[0])<s;for(let l=1;l<e.length;l++)if(_u(i,e[l-1],e[l])<s)return!0;return!1}function _u(i,e,n){const s=e.distSqr(n);if(s===0)return i.distSqr(e);const l=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/s;return i.distSqr(l<0?e:l>1?n:n.sub(e)._mult(l)._add(e))}function yu(i,e){let n,s,l,h=!1;for(let p=0;p<i.length;p++){n=i[p];for(let m=0,_=n.length-1;m<n.length;_=m++)s=n[m],l=n[_],s.y>e.y!=l.y>e.y&&e.x<(l.x-s.x)*(e.y-s.y)/(l.y-s.y)+s.x&&(h=!h)}return h}function po(i,e){let n=!1;for(let s=0,l=i.length-1;s<i.length;l=s++){const h=i[s],p=i[l];h.y>e.y!=p.y>e.y&&e.x<(p.x-h.x)*(e.y-h.y)/(p.y-h.y)+h.x&&(n=!n)}return n}function Lp(i,e,n){const s=n[0],l=n[2];if(i.x<s.x&&e.x<s.x||i.x>l.x&&e.x>l.x||i.y<s.y&&e.y<s.y||i.y>l.y&&e.y>l.y)return!1;const h=Te(i,e,n[0]);return h!==Te(i,e,n[1])||h!==Te(i,e,n[2])||h!==Te(i,e,n[3])}function ca(i,e,n){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:n.programConfigurations.get(e.id).getMaxValue(i)}function hl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function pl(i,e,n,s,l){if(!e[0]&&!e[1])return i;const h=Ve.convert(e)._mult(l);n==="viewport"&&h._rotate(-s);const p=[];for(let m=0;m<i.length;m++)p.push(i[m].sub(h));return p}Ne("CircleBucket",uc,{omit:["layers"]});const Rp=new hi({"circle-sort-key":new it(me.layout_circle["circle-sort-key"])});var Bp={paint:new hi({"circle-radius":new it(me.paint_circle["circle-radius"]),"circle-color":new it(me.paint_circle["circle-color"]),"circle-blur":new it(me.paint_circle["circle-blur"]),"circle-opacity":new it(me.paint_circle["circle-opacity"]),"circle-translate":new He(me.paint_circle["circle-translate"]),"circle-translate-anchor":new He(me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new He(me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new He(me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new it(me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new it(me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new it(me.paint_circle["circle-stroke-opacity"])}),layout:Rp},fo=typeof Float32Array<"u"?Float32Array:Array;function dc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function xu(i,e,n){var s=e[0],l=e[1],h=e[2],p=e[3],m=e[4],_=e[5],w=e[6],T=e[7],C=e[8],M=e[9],R=e[10],B=e[11],H=e[12],X=e[13],re=e[14],ue=e[15],ce=n[0],ge=n[1],Se=n[2],ve=n[3];return i[0]=ce*s+ge*m+Se*C+ve*H,i[1]=ce*l+ge*_+Se*M+ve*X,i[2]=ce*h+ge*w+Se*R+ve*re,i[3]=ce*p+ge*T+Se*B+ve*ue,i[4]=(ce=n[4])*s+(ge=n[5])*m+(Se=n[6])*C+(ve=n[7])*H,i[5]=ce*l+ge*_+Se*M+ve*X,i[6]=ce*h+ge*w+Se*R+ve*re,i[7]=ce*p+ge*T+Se*B+ve*ue,i[8]=(ce=n[8])*s+(ge=n[9])*m+(Se=n[10])*C+(ve=n[11])*H,i[9]=ce*l+ge*_+Se*M+ve*X,i[10]=ce*h+ge*w+Se*R+ve*re,i[11]=ce*p+ge*T+Se*B+ve*ue,i[12]=(ce=n[12])*s+(ge=n[13])*m+(Se=n[14])*C+(ve=n[15])*H,i[13]=ce*l+ge*_+Se*M+ve*X,i[14]=ce*h+ge*w+Se*R+ve*re,i[15]=ce*p+ge*T+Se*B+ve*ue,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var ua,Fp=xu;function dl(i,e,n){var s=e[0],l=e[1],h=e[2],p=e[3];return i[0]=n[0]*s+n[4]*l+n[8]*h+n[12]*p,i[1]=n[1]*s+n[5]*l+n[9]*h+n[13]*p,i[2]=n[2]*s+n[6]*l+n[10]*h+n[14]*p,i[3]=n[3]*s+n[7]*l+n[11]*h+n[15]*p,i}function vu(i,e){const n=dl([],[i.x,i.y,0,1],e);return new Ve(n[0]/n[3],n[1]/n[3])}ua=new fo(4),fo!=Float32Array&&(ua[0]=0,ua[1]=0,ua[2]=0,ua[3]=0);class bu extends uc{}Ne("HeatmapBucket",bu,{omit:["layers"]});var Op={paint:new hi({"heatmap-radius":new it(me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new it(me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new He(me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new oa(me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new He(me.paint_heatmap["heatmap-opacity"])})};function fc(i,{width:e,height:n},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*n*s)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${e*n*s}`)}else l=new Uint8Array(e*n*s);return i.width=e,i.height=n,i.data=l,i}function wu(i,{width:e,height:n},s){if(e===i.width&&n===i.height)return;const l=fc({},{width:e,height:n},s);mc(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},s),i.width=e,i.height=n,i.data=l.data}function mc(i,e,n,s,l,h){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||n.x>i.width-l.width||n.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||s.x>e.width-l.width||s.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,m=e.data;for(let _=0;_<l.height;_++){const w=((n.y+_)*i.width+n.x)*h,T=((s.y+_)*e.width+s.x)*h;for(let C=0;C<l.width*h;C++)m[T+C]=p[w+C]}return e}class ha{constructor(e,n){fc(this,e,1,n)}resize(e){wu(this,e,1)}clone(){return new ha({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,l,h){mc(e,n,s,l,h,1)}}class xn{constructor(e,n){fc(this,e,4,n)}resize(e){wu(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new xn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,l,h){mc(e,n,s,l,h,4)}}function Su(i){const e={},n=i.resolution||256,s=i.clips?i.clips.length:1,l=i.image||new xn({width:n,height:s}),h=(p,m,_)=>{e[i.evaluationKey]=_;const w=i.expression.evaluate(e);l.data[p+m+0]=Math.floor(255*w.r/w.a),l.data[p+m+1]=Math.floor(255*w.g/w.a),l.data[p+m+2]=Math.floor(255*w.b/w.a),l.data[p+m+3]=Math.floor(255*w.a)};if(i.clips)for(let p=0,m=0;p<s;++p,m+=4*n)for(let _=0,w=0;_<n;_++,w+=4){const T=_/(n-1),{start:C,end:M}=i.clips[p];h(m,w,C*(1-T)+M*T)}else for(let p=0,m=0;p<n;p++,m+=4)h(0,m,p/(n-1));return l}Ne("AlphaImage",ha),Ne("RGBAImage",xn);var Up={paint:new hi({"hillshade-illumination-direction":new He(me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new He(me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new He(me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new He(me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new He(me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new He(me.paint_hillshade["hillshade-accent-color"])})};const Vp=pi([{name:"a_pos",components:2,type:"Int16"}],4),{members:$p}=Vp;var gc={exports:{}};function fl(i,e,n){n=n||2;var s,l,h,p,m,_,w,T=e&&e.length,C=T?e[0]*n:i.length,M=Au(i,0,C,n,!0),R=[];if(!M||M.next===M.prev)return R;if(T&&(M=function(H,X,re,ue){var ce,ge,Se,ve=[];for(ce=0,ge=X.length;ce<ge;ce++)(Se=Au(H,X[ce]*ue,ce<ge-1?X[ce+1]*ue:H.length,ue,!1))===Se.next&&(Se.steiner=!0),ve.push(Xp(Se));for(ve.sort(Zp),ce=0;ce<ve.length;ce++)re=Yr(re=Wp(ve[ce],re),re.next);return re}(i,e,M,n)),i.length>80*n){s=h=i[0],l=p=i[1];for(var B=n;B<C;B+=n)(m=i[B])<s&&(s=m),(_=i[B+1])<l&&(l=_),m>h&&(h=m),_>p&&(p=_);w=(w=Math.max(h-s,p-l))!==0?1/w:0}return pa(M,R,n,s,l,w),R}function Au(i,e,n,s,l){var h,p;if(l===xc(i,e,n,s)>0)for(h=e;h<n;h+=s)p=Eu(h,i[h],i[h+1],p);else for(h=n-s;h>=e;h-=s)p=Eu(h,i[h],i[h+1],p);return p&&ml(p,p.next)&&(fa(p),p=p.next),p}function Yr(i,e){if(!i)return i;e||(e=i);var n,s=i;do if(n=!1,s.steiner||!ml(s,s.next)&&ti(s.prev,s,s.next)!==0)s=s.next;else{if(fa(s),(s=e=s.prev)===s.next)break;n=!0}while(n||s!==e);return e}function pa(i,e,n,s,l,h,p){if(i){!p&&h&&function(T,C,M,R){var B=T;do B.z===null&&(B.z=_c(B.x,B.y,C,M,R)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==T);B.prevZ.nextZ=null,B.prevZ=null,function(H){var X,re,ue,ce,ge,Se,ve,je,Ke=1;do{for(re=H,H=null,ge=null,Se=0;re;){for(Se++,ue=re,ve=0,X=0;X<Ke&&(ve++,ue=ue.nextZ);X++);for(je=Ke;ve>0||je>0&&ue;)ve!==0&&(je===0||!ue||re.z<=ue.z)?(ce=re,re=re.nextZ,ve--):(ce=ue,ue=ue.nextZ,je--),ge?ge.nextZ=ce:H=ce,ce.prevZ=ge,ge=ce;re=ue}ge.nextZ=null,Ke*=2}while(Se>1)}(B)}(i,s,l,h);for(var m,_,w=i;i.prev!==i.next;)if(m=i.prev,_=i.next,h?jp(i,s,l,h):Np(i))e.push(m.i/n),e.push(i.i/n),e.push(_.i/n),fa(i),i=_.next,w=_.next;else if((i=_)===w){p?p===1?pa(i=qp(Yr(i),e,n),e,n,s,l,h,2):p===2&&Gp(i,e,n,s,l,h):pa(Yr(i),e,n,s,l,h,1);break}}}function Np(i){var e=i.prev,n=i,s=i.next;if(ti(e,n,s)>=0)return!1;for(var l=i.next.next;l!==i.prev;){if(mo(e.x,e.y,n.x,n.y,s.x,s.y,l.x,l.y)&&ti(l.prev,l,l.next)>=0)return!1;l=l.next}return!0}function jp(i,e,n,s){var l=i.prev,h=i,p=i.next;if(ti(l,h,p)>=0)return!1;for(var m=l.x>h.x?l.x>p.x?l.x:p.x:h.x>p.x?h.x:p.x,_=l.y>h.y?l.y>p.y?l.y:p.y:h.y>p.y?h.y:p.y,w=_c(l.x<h.x?l.x<p.x?l.x:p.x:h.x<p.x?h.x:p.x,l.y<h.y?l.y<p.y?l.y:p.y:h.y<p.y?h.y:p.y,e,n,s),T=_c(m,_,e,n,s),C=i.prevZ,M=i.nextZ;C&&C.z>=w&&M&&M.z<=T;){if(C!==i.prev&&C!==i.next&&mo(l.x,l.y,h.x,h.y,p.x,p.y,C.x,C.y)&&ti(C.prev,C,C.next)>=0||(C=C.prevZ,M!==i.prev&&M!==i.next&&mo(l.x,l.y,h.x,h.y,p.x,p.y,M.x,M.y)&&ti(M.prev,M,M.next)>=0))return!1;M=M.nextZ}for(;C&&C.z>=w;){if(C!==i.prev&&C!==i.next&&mo(l.x,l.y,h.x,h.y,p.x,p.y,C.x,C.y)&&ti(C.prev,C,C.next)>=0)return!1;C=C.prevZ}for(;M&&M.z<=T;){if(M!==i.prev&&M!==i.next&&mo(l.x,l.y,h.x,h.y,p.x,p.y,M.x,M.y)&&ti(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function qp(i,e,n){var s=i;do{var l=s.prev,h=s.next.next;!ml(l,h)&&Iu(l,s,s.next,h)&&da(l,h)&&da(h,l)&&(e.push(l.i/n),e.push(s.i/n),e.push(h.i/n),fa(s),fa(s.next),s=i=h),s=s.next}while(s!==i);return Yr(s)}function Gp(i,e,n,s,l,h){var p=i;do{for(var m=p.next.next;m!==p.prev;){if(p.i!==m.i&&Yp(p,m)){var _=Tu(p,m);return p=Yr(p,p.next),_=Yr(_,_.next),pa(p,e,n,s,l,h),void pa(_,e,n,s,l,h)}m=m.next}p=p.next}while(p!==i)}function Zp(i,e){return i.x-e.x}function Wp(i,e){var n=function(h,p){var m,_=p,w=h.x,T=h.y,C=-1/0;do{if(T<=_.y&&T>=_.next.y&&_.next.y!==_.y){var M=_.x+(T-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(M<=w&&M>C){if(C=M,M===w){if(T===_.y)return _;if(T===_.next.y)return _.next}m=_.x<_.next.x?_:_.next}}_=_.next}while(_!==p);if(!m)return null;if(w===C)return m;var R,B=m,H=m.x,X=m.y,re=1/0;_=m;do w>=_.x&&_.x>=H&&w!==_.x&&mo(T<X?w:C,T,H,X,T<X?C:w,T,_.x,_.y)&&(R=Math.abs(T-_.y)/(w-_.x),da(_,h)&&(R<re||R===re&&(_.x>m.x||_.x===m.x&&Hp(m,_)))&&(m=_,re=R)),_=_.next;while(_!==B);return m}(i,e);if(!n)return e;var s=Tu(n,i),l=Yr(n,n.next);return Yr(s,s.next),e===n?l:e}function Hp(i,e){return ti(i.prev,i,e.prev)<0&&ti(e.next,i,i.next)<0}function _c(i,e,n,s,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-n)*l)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*l)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Xp(i){var e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function mo(i,e,n,s,l,h,p,m){return(l-p)*(e-m)-(i-p)*(h-m)>=0&&(i-p)*(s-m)-(n-p)*(e-m)>=0&&(n-p)*(h-m)-(l-p)*(s-m)>=0}function Yp(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(n,s){var l=n;do{if(l.i!==n.i&&l.next.i!==n.i&&l.i!==s.i&&l.next.i!==s.i&&Iu(l,l.next,n,s))return!0;l=l.next}while(l!==n);return!1}(i,e)&&(da(i,e)&&da(e,i)&&function(n,s){var l=n,h=!1,p=(n.x+s.x)/2,m=(n.y+s.y)/2;do l.y>m!=l.next.y>m&&l.next.y!==l.y&&p<(l.next.x-l.x)*(m-l.y)/(l.next.y-l.y)+l.x&&(h=!h),l=l.next;while(l!==n);return h}(i,e)&&(ti(i.prev,i,e.prev)||ti(i,e.prev,e))||ml(i,e)&&ti(i.prev,i,i.next)>0&&ti(e.prev,e,e.next)>0)}function ti(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function ml(i,e){return i.x===e.x&&i.y===e.y}function Iu(i,e,n,s){var l=_l(ti(i,e,n)),h=_l(ti(i,e,s)),p=_l(ti(n,s,i)),m=_l(ti(n,s,e));return l!==h&&p!==m||!(l!==0||!gl(i,n,e))||!(h!==0||!gl(i,s,e))||!(p!==0||!gl(n,i,s))||!(m!==0||!gl(n,e,s))}function gl(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function _l(i){return i>0?1:i<0?-1:0}function da(i,e){return ti(i.prev,i,i.next)<0?ti(i,e,i.next)>=0&&ti(i,i.prev,e)>=0:ti(i,e,i.prev)<0||ti(i,i.next,e)<0}function Tu(i,e){var n=new yc(i.i,i.x,i.y),s=new yc(e.i,e.x,e.y),l=i.next,h=e.prev;return i.next=e,e.prev=i,n.next=l,l.prev=n,s.next=n,n.prev=s,h.next=s,s.prev=h,s}function Eu(i,e,n,s){var l=new yc(i,e,n);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function fa(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function yc(i,e,n){this.i=i,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xc(i,e,n,s){for(var l=0,h=e,p=n-s;h<n;h+=s)l+=(i[p]-i[h])*(i[h+1]+i[p+1]),p=h;return l}gc.exports=fl,gc.exports.default=fl,fl.deviation=function(i,e,n,s){var l=e&&e.length,h=Math.abs(xc(i,0,l?e[0]*n:i.length,n));if(l)for(var p=0,m=e.length;p<m;p++)h-=Math.abs(xc(i,e[p]*n,p<m-1?e[p+1]*n:i.length,n));var _=0;for(p=0;p<s.length;p+=3){var w=s[p]*n,T=s[p+1]*n,C=s[p+2]*n;_+=Math.abs((i[w]-i[C])*(i[T+1]-i[w+1])-(i[w]-i[T])*(i[C+1]-i[w+1]))}return h===0&&_===0?0:Math.abs((_-h)/h)},fl.flatten=function(i){for(var e=i[0][0].length,n={vertices:[],holes:[],dimensions:e},s=0,l=0;l<i.length;l++){for(var h=0;h<i[l].length;h++)for(var p=0;p<e;p++)n.vertices.push(i[l][h][p]);l>0&&n.holes.push(s+=i[l-1].length)}return n};var Cu=gc.exports;function Kp(i,e,n,s,l){zu(i,e,n||0,s||i.length-1,l||Jp)}function zu(i,e,n,s,l){for(;s>n;){if(s-n>600){var h=s-n+1,p=e-n+1,m=Math.log(h),_=.5*Math.exp(2*m/3),w=.5*Math.sqrt(m*_*(h-_)/h)*(p-h/2<0?-1:1);zu(i,e,Math.max(n,Math.floor(e-p*_/h+w)),Math.min(s,Math.floor(e+(h-p)*_/h+w)),l)}var T=i[e],C=n,M=s;for(ma(i,n,e),l(i[s],T)>0&&ma(i,n,s);C<M;){for(ma(i,C,M),C++,M--;l(i[C],T)<0;)C++;for(;l(i[M],T)>0;)M--}l(i[n],T)===0?ma(i,n,M):ma(i,++M,s),M<=e&&(n=M+1),e<=M&&(s=M-1)}}function ma(i,e,n){var s=i[e];i[e]=i[n],i[n]=s}function Jp(i,e){return i<e?-1:i>e?1:0}function vc(i,e){const n=i.length;if(n<=1)return[i];const s=[];let l,h;for(let p=0;p<n;p++){const m=rt(i[p]);m!==0&&(i[p].area=Math.abs(m),h===void 0&&(h=m<0),h===m<0?(l&&s.push(l),l=[i[p]]):l.push(i[p]))}if(l&&s.push(l),e>1)for(let p=0;p<s.length;p++)s[p].length<=e||(Kp(s[p],e,1,s[p].length-1,Qp),s[p]=s[p].slice(0,e));return s}function Qp(i,e){return e.area-i.area}function bc(i,e,n){const s=n.patternDependencies;let l=!1;for(const h of e){const p=h.paint.get(`${i}-pattern`);p.isConstant()||(l=!0);const m=p.constantOr(null);m&&(l=!0,s[m.to]=!0,s[m.from]=!0)}return l}function wc(i,e,n,s,l){const h=l.patternDependencies;for(const p of e){const m=p.paint.get(`${i}-pattern`).value;if(m.kind!=="constant"){let _=m.evaluate({zoom:s-1},n,{},l.availableImages),w=m.evaluate({zoom:s},n,{},l.availableImages),T=m.evaluate({zoom:s+1},n,{},l.availableImages);_=_&&_.name?_.name:_,w=w&&w.name?w.name:w,T=T&&T.name?T.name:T,h[_]=!0,h[w]=!0,h[T]=!0,n.patterns[p.id]={min:_,mid:w,max:T}}}return n}class Sc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new vt,this.indexArray=new Vi,this.indexArray2=new Pn,this.programConfigurations=new Is(e.layers,e.zoom),this.segments=new Et,this.segments2=new Et,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){this.hasPattern=bc("fill",this.layers,n);const l=this.layers[0].layout.get("fill-sort-key"),h=!l.isConstant(),p=[];for(const{feature:m,id:_,index:w,sourceLayerIndex:T}of e){const C=this.layers[0]._featureFilter.needGeometry,M=Es(m,C);if(!this.layers[0]._featureFilter.filter(new qt(this.zoom),M,s))continue;const R=h?l.evaluate(M,{},s,n.availableImages):void 0,B={id:_,properties:m.properties,type:m.type,sourceLayerIndex:T,index:w,geometry:C?M.geometry:Ts(m),patterns:{},sortKey:R};p.push(B)}h&&p.sort((m,_)=>m.sortKey-_.sortKey);for(const m of p){const{geometry:_,index:w,sourceLayerIndex:T}=m;if(this.hasPattern){const C=wc("fill",this.layers,m,this.zoom,n);this.patternFeatures.push(C)}else this.addFeature(m,_,w,s,{});n.featureIndex.insert(e[w].feature,_,w,T,this.index)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}addFeatures(e,n,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$p),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,l,h){for(const p of vc(n,500)){let m=0;for(const R of p)m+=R.length;const _=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),w=_.vertexLength,T=[],C=[];for(const R of p){if(R.length===0)continue;R!==p[0]&&C.push(T.length/2);const B=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),H=B.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(H+R.length-1,H),T.push(R[0].x),T.push(R[0].y);for(let X=1;X<R.length;X++)this.layoutVertexArray.emplaceBack(R[X].x,R[X].y),this.indexArray2.emplaceBack(H+X-1,H+X),T.push(R[X].x),T.push(R[X].y);B.vertexLength+=R.length,B.primitiveLength+=R.length}const M=Cu(T,C);for(let R=0;R<M.length;R+=3)this.indexArray.emplaceBack(w+M[R],w+M[R+1],w+M[R+2]);_.vertexLength+=m,_.primitiveLength+=M.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,l)}}Ne("FillBucket",Sc,{omit:["layers","patternFeatures"]});const ed=new hi({"fill-sort-key":new it(me.layout_fill["fill-sort-key"])});var td={paint:new hi({"fill-antialias":new He(me.paint_fill["fill-antialias"]),"fill-opacity":new it(me.paint_fill["fill-opacity"]),"fill-color":new it(me.paint_fill["fill-color"]),"fill-outline-color":new it(me.paint_fill["fill-outline-color"]),"fill-translate":new He(me.paint_fill["fill-translate"]),"fill-translate-anchor":new He(me.paint_fill["fill-translate-anchor"]),"fill-pattern":new bs(me.paint_fill["fill-pattern"])}),layout:ed};const id=pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),{members:nd}=id;var Kr={},rd=Ve,ku=go;function go(i,e,n,s,l){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=l,i.readFields(sd,this,e)}function sd(i,e,n){i==1?e.id=n.readVarint():i==2?function(s,l){for(var h=s.readVarint()+s.pos;s.pos<h;){var p=l._keys[s.readVarint()],m=l._values[s.readVarint()];l.properties[p]=m}}(n,e):i==3?e.type=n.readVarint():i==4&&(e._geometry=n.pos)}function od(i){for(var e,n,s=0,l=0,h=i.length,p=h-1;l<h;p=l++)s+=((n=i[p]).x-(e=i[l]).x)*(e.y+n.y);return s}go.types=["Unknown","Point","LineString","Polygon"],go.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,n=i.readVarint()+i.pos,s=1,l=0,h=0,p=0,m=[];i.pos<n;){if(l<=0){var _=i.readVarint();s=7&_,l=_>>3}if(l--,s===1||s===2)h+=i.readSVarint(),p+=i.readSVarint(),s===1&&(e&&m.push(e),e=[]),e.push(new rd(h,p));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&m.push(e),m},go.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,n=1,s=0,l=0,h=0,p=1/0,m=-1/0,_=1/0,w=-1/0;i.pos<e;){if(s<=0){var T=i.readVarint();n=7&T,s=T>>3}if(s--,n===1||n===2)(l+=i.readSVarint())<p&&(p=l),l>m&&(m=l),(h+=i.readSVarint())<_&&(_=h),h>w&&(w=h);else if(n!==7)throw new Error("unknown command "+n)}return[p,_,m,w]},go.prototype.toGeoJSON=function(i,e,n){var s,l,h=this.extent*Math.pow(2,n),p=this.extent*i,m=this.extent*e,_=this.loadGeometry(),w=go.types[this.type];function T(R){for(var B=0;B<R.length;B++){var H=R[B];R[B]=[360*(H.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+m)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(s=0;s<_.length;s++)C[s]=_[s][0];T(_=C);break;case 2:for(s=0;s<_.length;s++)T(_[s]);break;case 3:for(_=function(R){var B=R.length;if(B<=1)return[R];for(var H,X,re=[],ue=0;ue<B;ue++){var ce=od(R[ue]);ce!==0&&(X===void 0&&(X=ce<0),X===ce<0?(H&&re.push(H),H=[R[ue]]):H.push(R[ue]))}return H&&re.push(H),re}(_),s=0;s<_.length;s++)for(l=0;l<_[s].length;l++)T(_[s][l])}_.length===1?_=_[0]:w="Multi"+w;var M={type:"Feature",geometry:{type:w,coordinates:_},properties:this.properties};return"id"in this&&(M.id=this.id),M};var ad=ku,Pu=Mu;function Mu(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(ld,this,e),this.length=this._features.length}function ld(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push(function(s){for(var l=null,h=s.readVarint()+s.pos;s.pos<h;){var p=s.readVarint()>>3;l=p===1?s.readString():p===2?s.readFloat():p===3?s.readDouble():p===4?s.readVarint64():p===5?s.readVarint():p===6?s.readSVarint():p===7?s.readBoolean():null}return l}(n))}Mu.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new ad(this._pbf,e,this.extent,this._keys,this._values)};var cd=Pu;function ud(i,e,n){if(i===3){var s=new cd(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}Kr.VectorTile=function(i,e){this.layers=i.readFields(ud,{},e)},Kr.VectorTileFeature=ku,Kr.VectorTileLayer=Pu;const hd=Kr.VectorTileFeature.types,Ac=Math.pow(2,13);function ga(i,e,n,s,l,h,p,m){i.emplaceBack(e,n,2*Math.floor(s*Ac)+p,l*Ac*2,h*Ac*2,Math.round(m))}class Ic{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Yt,this.indexArray=new Vi,this.programConfigurations=new Is(e.layers,e.zoom),this.segments=new Et,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){this.features=[],this.hasPattern=bc("fill-extrusion",this.layers,n);for(const{feature:l,id:h,index:p,sourceLayerIndex:m}of e){const _=this.layers[0]._featureFilter.needGeometry,w=Es(l,_);if(!this.layers[0]._featureFilter.filter(new qt(this.zoom),w,s))continue;const T={id:h,sourceLayerIndex:m,index:p,geometry:_?w.geometry:Ts(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(wc("fill-extrusion",this.layers,T,this.zoom,n)):this.addFeature(T,T.geometry,p,s,{}),n.featureIndex.insert(l,T.geometry,p,m,this.index,!0)}}addFeatures(e,n,s){for(const l of this.features){const{geometry:h}=l;this.addFeature(l,h,l.index,n,s)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nd),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,l,h){for(const p of vc(n,500)){let m=0;for(const R of p)m+=R.length;let _=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const R of p){if(R.length===0||dd(R))continue;let B=0;for(let H=0;H<R.length;H++){const X=R[H];if(H>=1){const re=R[H-1];if(!pd(X,re)){_.vertexLength+4>Et.MAX_VERTEX_ARRAY_LENGTH&&(_=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ue=X.sub(re)._perp()._unit(),ce=re.dist(X);B+ce>32768&&(B=0),ga(this.layoutVertexArray,X.x,X.y,ue.x,ue.y,0,0,B),ga(this.layoutVertexArray,X.x,X.y,ue.x,ue.y,0,1,B),B+=ce,ga(this.layoutVertexArray,re.x,re.y,ue.x,ue.y,0,0,B),ga(this.layoutVertexArray,re.x,re.y,ue.x,ue.y,0,1,B);const ge=_.vertexLength;this.indexArray.emplaceBack(ge,ge+2,ge+1),this.indexArray.emplaceBack(ge+1,ge+2,ge+3),_.vertexLength+=4,_.primitiveLength+=2}}}}if(_.vertexLength+m>Et.MAX_VERTEX_ARRAY_LENGTH&&(_=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray)),hd[e.type]!=="Polygon")continue;const w=[],T=[],C=_.vertexLength;for(const R of p)if(R.length!==0){R!==p[0]&&T.push(w.length/2);for(let B=0;B<R.length;B++){const H=R[B];ga(this.layoutVertexArray,H.x,H.y,0,0,1,1,0),w.push(H.x),w.push(H.y)}}const M=Cu(w,T);for(let R=0;R<M.length;R+=3)this.indexArray.emplaceBack(C+M[R],C+M[R+2],C+M[R+1]);_.primitiveLength+=M.length/3,_.vertexLength+=m}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,l)}}function pd(i,e){return i.x===e.x&&(i.x<0||i.x>di)||i.y===e.y&&(i.y<0||i.y>di)}function dd(i){return i.every(e=>e.x<0)||i.every(e=>e.x>di)||i.every(e=>e.y<0)||i.every(e=>e.y>di)}Ne("FillExtrusionBucket",Ic,{omit:["layers","features"]});var fd={paint:new hi({"fill-extrusion-opacity":new He(me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new it(me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new He(me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new He(me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new bs(me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new it(me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new it(me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new He(me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function _a(i,e){return i.x*e.x+i.y*e.y}function Du(i,e){if(i.length===1){let n=0;const s=e[n++];let l;for(;!l||s.equals(l);)if(l=e[n++],!l)return 1/0;for(;n<e.length;n++){const h=e[n],p=i[0],m=l.sub(s),_=h.sub(s),w=p.sub(s),T=_a(m,m),C=_a(m,_),M=_a(_,_),R=_a(w,m),B=_a(w,_),H=T*M-C*C,X=(M*R-C*B)/H,re=(T*B-C*R)/H,ue=s.z*(1-X-re)+l.z*X+h.z*re;if(isFinite(ue))return ue}return 1/0}{let n=1/0;for(const s of e)n=Math.min(n,s.z);return n}}const md=pi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:gd}=md,_d=pi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:yd}=_d,xd=Kr.VectorTileFeature.types,vd=Math.cos(Math.PI/180*37.5),Lu=Math.pow(2,14)/.5;class Tc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new at,this.layoutVertexArray2=new Tt,this.indexArray=new Vi,this.programConfigurations=new Is(e.layers,e.zoom),this.segments=new Et,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){this.hasPattern=bc("line",this.layers,n);const l=this.layers[0].layout.get("line-sort-key"),h=!l.isConstant(),p=[];for(const{feature:m,id:_,index:w,sourceLayerIndex:T}of e){const C=this.layers[0]._featureFilter.needGeometry,M=Es(m,C);if(!this.layers[0]._featureFilter.filter(new qt(this.zoom),M,s))continue;const R=h?l.evaluate(M,{},s):void 0,B={id:_,properties:m.properties,type:m.type,sourceLayerIndex:T,index:w,geometry:C?M.geometry:Ts(m),patterns:{},sortKey:R};p.push(B)}h&&p.sort((m,_)=>m.sortKey-_.sortKey);for(const m of p){const{geometry:_,index:w,sourceLayerIndex:T}=m;if(this.hasPattern){const C=wc("line",this.layers,m,this.zoom,n);this.patternFeatures.push(C)}else this.addFeature(m,_,w,s,{});n.featureIndex.insert(e[w].feature,_,w,T,this.index)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}addFeatures(e,n,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,yd)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gd),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,l,h){const p=this.layers[0].layout,m=p.get("line-join").evaluate(e,{}),_=p.get("line-cap"),w=p.get("line-miter-limit"),T=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const C of n)this.addLine(C,e,m,_,w,T);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,l)}addLine(e,n,s,l,h,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<e.length-1;re++)this.totalDistance+=e[re].dist(e[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=xd[n.type]==="Polygon";let _=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let w=0;for(;w<_-1&&e[w].equals(e[w+1]);)w++;if(_<(m?3:2))return;s==="bevel"&&(h=1.05);const T=this.overscaling<=16?122880/(512*this.overscaling):0,C=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray);let M,R,B,H,X;this.e1=this.e2=-1,m&&(M=e[_-2],X=e[w].sub(M)._unit()._perp());for(let re=w;re<_;re++){if(B=re===_-1?m?e[w+1]:void 0:e[re+1],B&&e[re].equals(B))continue;X&&(H=X),M&&(R=M),M=e[re],X=B?B.sub(M)._unit()._perp():H,H=H||X;let ue=H.add(X);ue.x===0&&ue.y===0||ue._unit();const ce=H.x*X.x+H.y*X.y,ge=ue.x*X.x+ue.y*X.y,Se=ge!==0?1/ge:1/0,ve=2*Math.sqrt(2-2*ge),je=ge<vd&&R&&B,Ke=H.x*X.y-H.y*X.x>0;if(je&&re>w){const Pe=M.dist(R);if(Pe>2*T){const $e=M.sub(M.sub(R)._mult(T/Pe)._round());this.updateDistance(R,$e),this.addCurrentVertex($e,H,0,0,C),R=$e}}const Be=R&&B;let Fe=Be?s:m?"butt":l;if(Be&&Fe==="round"&&(Se<p?Fe="miter":Se<=2&&(Fe="fakeround")),Fe==="miter"&&Se>h&&(Fe="bevel"),Fe==="bevel"&&(Se>2&&(Fe="flipbevel"),Se<h&&(Fe="miter")),R&&this.updateDistance(R,M),Fe==="miter")ue._mult(Se),this.addCurrentVertex(M,ue,0,0,C);else if(Fe==="flipbevel"){if(Se>100)ue=X.mult(-1);else{const Pe=Se*H.add(X).mag()/H.sub(X).mag();ue._perp()._mult(Pe*(Ke?-1:1))}this.addCurrentVertex(M,ue,0,0,C),this.addCurrentVertex(M,ue.mult(-1),0,0,C)}else if(Fe==="bevel"||Fe==="fakeround"){const Pe=-Math.sqrt(Se*Se-1),$e=Ke?Pe:0,Oe=Ke?0:Pe;if(R&&this.addCurrentVertex(M,H,$e,Oe,C),Fe==="fakeround"){const Ee=Math.round(180*ve/Math.PI/20);for(let nt=1;nt<Ee;nt++){let Je=nt/Ee;if(Je!==.5){const Mt=Je-.5;Je+=Je*Mt*(Je-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*Mt*Mt+(.848013+ce*(.215638*ce-1.06021)))}const bt=X.sub(H)._mult(Je)._add(H)._unit()._mult(Ke?-1:1);this.addHalfVertex(M,bt.x,bt.y,!1,Ke,0,C)}}B&&this.addCurrentVertex(M,X,-$e,-Oe,C)}else if(Fe==="butt")this.addCurrentVertex(M,ue,0,0,C);else if(Fe==="square"){const Pe=R?1:-1;this.addCurrentVertex(M,ue,Pe,Pe,C)}else Fe==="round"&&(R&&(this.addCurrentVertex(M,H,0,0,C),this.addCurrentVertex(M,H,1,1,C,!0)),B&&(this.addCurrentVertex(M,X,-1,-1,C,!0),this.addCurrentVertex(M,X,0,0,C)));if(je&&re<_-1){const Pe=M.dist(B);if(Pe>2*T){const $e=M.add(B.sub(M)._mult(T/Pe)._round());this.updateDistance(M,$e),this.addCurrentVertex($e,X,0,0,C),M=$e}}}}addCurrentVertex(e,n,s,l,h,p=!1){const m=n.y*l-n.x,_=-n.y-n.x*l;this.addHalfVertex(e,n.x+n.y*s,n.y-n.x*s,p,!1,s,h),this.addHalfVertex(e,m,_,p,!0,-l,h),this.distance>Lu/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,n,s,l,h,p))}addHalfVertex({x:e,y:n},s,l,h,p,m,_){const w=.5*(this.lineClips?this.scaledDistance*(Lu-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(n<<1)+(p?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(m===0?0:m<0?-1:1)|(63&w)<<2,w>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const T=_.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),_.primitiveLength++),p?this.e2=T:this.e1=T}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}Ne("LineBucket",Tc,{omit:["layers","patternFeatures"]});const bd=new hi({"line-cap":new He(me.layout_line["line-cap"]),"line-join":new it(me.layout_line["line-join"]),"line-miter-limit":new He(me.layout_line["line-miter-limit"]),"line-round-limit":new He(me.layout_line["line-round-limit"]),"line-sort-key":new it(me.layout_line["line-sort-key"])});var Ru={paint:new hi({"line-opacity":new it(me.paint_line["line-opacity"]),"line-color":new it(me.paint_line["line-color"]),"line-translate":new He(me.paint_line["line-translate"]),"line-translate-anchor":new He(me.paint_line["line-translate-anchor"]),"line-width":new it(me.paint_line["line-width"]),"line-gap-width":new it(me.paint_line["line-gap-width"]),"line-offset":new it(me.paint_line["line-offset"]),"line-blur":new it(me.paint_line["line-blur"]),"line-dasharray":new ws(me.paint_line["line-dasharray"]),"line-pattern":new bs(me.paint_line["line-pattern"]),"line-gradient":new oa(me.paint_line["line-gradient"])}),layout:bd};const Bu=new class extends it{possiblyEvaluate(i,e){return e=new qt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,n,s){return e=le({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,n,s)}}(Ru.paint.properties["line-width"].specification);function Fu(i,e){return e>0?e+2*i:i}Bu.useIntegerZoom=!0;const wd=pi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Sd=pi([{name:"a_projected_pos",components:3,type:"Float32"}],4);pi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ad=pi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);pi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ou=pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Id=pi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Td(i,e,n){return i.sections.forEach(s=>{s.text=function(l,h,p){const m=h.layout.get("text-transform").evaluate(p,{});return m==="uppercase"?l=l.toLocaleUpperCase():m==="lowercase"&&(l=l.toLocaleLowerCase()),on.applyArabicShaping&&(l=on.applyArabicShaping(l)),l}(s.text,e,n)}),i}pi([{name:"triangle",components:3,type:"Uint16"}]),pi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),pi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),pi([{type:"Float32",name:"offsetX"}]),pi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ya={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var bi=24,Ec=Rt,Uu=function(i,e,n,s,l){var h,p,m=8*l-s-1,_=(1<<m)-1,w=_>>1,T=-7,C=n?l-1:0,M=n?-1:1,R=i[e+C];for(C+=M,h=R&(1<<-T)-1,R>>=-T,T+=m;T>0;h=256*h+i[e+C],C+=M,T-=8);for(p=h&(1<<-T)-1,h>>=-T,T+=s;T>0;p=256*p+i[e+C],C+=M,T-=8);if(h===0)h=1-w;else{if(h===_)return p?NaN:1/0*(R?-1:1);p+=Math.pow(2,s),h-=w}return(R?-1:1)*p*Math.pow(2,h-s)},Vu=function(i,e,n,s,l,h){var p,m,_,w=8*h-l-1,T=(1<<w)-1,C=T>>1,M=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=s?0:h-1,B=s?1:-1,H=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,p=T):(p=Math.floor(Math.log(e)/Math.LN2),e*(_=Math.pow(2,-p))<1&&(p--,_*=2),(e+=p+C>=1?M/_:M*Math.pow(2,1-C))*_>=2&&(p++,_/=2),p+C>=T?(m=0,p=T):p+C>=1?(m=(e*_-1)*Math.pow(2,l),p+=C):(m=e*Math.pow(2,C-1)*Math.pow(2,l),p=0));l>=8;i[n+R]=255&m,R+=B,m/=256,l-=8);for(p=p<<l|m,w+=l;w>0;i[n+R]=255&p,R+=B,p/=256,w-=8);i[n+R-B]|=128*H};function Rt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Rt.Varint=0,Rt.Fixed64=1,Rt.Bytes=2,Rt.Fixed32=5;var Jr,Cc=4294967296,$u=1/Cc,Nu=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Cr(i){return i.type===Rt.Bytes?i.readVarint()+i.pos:i.pos+1}function _o(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function ju(i,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var l=n.pos-1;l>=i;l--)n.buf[l+s]=n.buf[l]}function Ed(i,e){for(var n=0;n<i.length;n++)e.writeVarint(i[n])}function Cd(i,e){for(var n=0;n<i.length;n++)e.writeSVarint(i[n])}function zd(i,e){for(var n=0;n<i.length;n++)e.writeFloat(i[n])}function kd(i,e){for(var n=0;n<i.length;n++)e.writeDouble(i[n])}function Pd(i,e){for(var n=0;n<i.length;n++)e.writeBoolean(i[n])}function Md(i,e){for(var n=0;n<i.length;n++)e.writeFixed32(i[n])}function Dd(i,e){for(var n=0;n<i.length;n++)e.writeSFixed32(i[n])}function Ld(i,e){for(var n=0;n<i.length;n++)e.writeFixed64(i[n])}function Rd(i,e){for(var n=0;n<i.length;n++)e.writeSFixed64(i[n])}function yl(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function yo(i,e,n){i[n]=e,i[n+1]=e>>>8,i[n+2]=e>>>16,i[n+3]=e>>>24}function qu(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Bd(i,e,n){i===1&&n.readMessage(Fd,e)}function Fd(i,e,n){if(i===3){const{id:s,bitmap:l,width:h,height:p,left:m,top:_,advance:w}=n.readMessage(Od,{});e.push({id:s,bitmap:new ha({width:h+6,height:p+6},l),metrics:{width:h,height:p,left:m,top:_,advance:w}})}}function Od(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}function Gu(i){let e=0,n=0;for(const p of i)e+=p.w*p.h,n=Math.max(n,p.w);i.sort((p,m)=>m.h-p.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let l=0,h=0;for(const p of i)for(let m=s.length-1;m>=0;m--){const _=s[m];if(!(p.w>_.w||p.h>_.h)){if(p.x=_.x,p.y=_.y,h=Math.max(h,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===_.w&&p.h===_.h){const w=s.pop();m<s.length&&(s[m]=w)}else p.h===_.h?(_.x+=p.w,_.w-=p.w):p.w===_.w?(_.y+=p.h,_.h-=p.h):(s.push({x:_.x+p.w,y:_.y,w:_.w-p.w,h:p.h}),_.y+=p.h,_.h-=p.h);break}}return{w:l,h,fill:e/(l*h)||0}}Rt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),l=s>>3,h=this.pos;this.type=7&s,i(l,e,this),this.pos===h&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=yl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=qu(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=yl(this.buf,this.pos)+yl(this.buf,this.pos+4)*Cc;return this.pos+=8,i},readSFixed64:function(){var i=yl(this.buf,this.pos)+qu(this.buf,this.pos+4)*Cc;return this.pos+=8,i},readFloat:function(){var i=Uu(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Uu(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(l,h,p){var m,_,w=p.buf;if(m=(112&(_=w[p.pos++]))>>4,_<128||(m|=(127&(_=w[p.pos++]))<<3,_<128)||(m|=(127&(_=w[p.pos++]))<<10,_<128)||(m|=(127&(_=w[p.pos++]))<<17,_<128)||(m|=(127&(_=w[p.pos++]))<<24,_<128)||(m|=(1&(_=w[p.pos++]))<<31,_<128))return _o(l,m,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Nu?function(n,s,l){return Nu.decode(n.subarray(s,l))}(this.buf,e,i):function(n,s,l){for(var h="",p=s;p<l;){var m,_,w,T=n[p],C=null,M=T>239?4:T>223?3:T>191?2:1;if(p+M>l)break;M===1?T<128&&(C=T):M===2?(192&(m=n[p+1]))==128&&(C=(31&T)<<6|63&m)<=127&&(C=null):M===3?(_=n[p+2],(192&(m=n[p+1]))==128&&(192&_)==128&&((C=(15&T)<<12|(63&m)<<6|63&_)<=2047||C>=55296&&C<=57343)&&(C=null)):M===4&&(_=n[p+2],w=n[p+3],(192&(m=n[p+1]))==128&&(192&_)==128&&(192&w)==128&&((C=(15&T)<<18|(63&m)<<12|(63&_)<<6|63&w)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,M=1):C>65535&&(C-=65536,h+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),h+=String.fromCharCode(C),p+=M}return h}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Rt.Bytes)return i.push(this.readVarint(e));var n=Cr(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Rt.Bytes)return i.push(this.readSVarint());var e=Cr(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Rt.Bytes)return i.push(this.readBoolean());var e=Cr(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Rt.Bytes)return i.push(this.readFloat());var e=Cr(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Rt.Bytes)return i.push(this.readDouble());var e=Cr(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Rt.Bytes)return i.push(this.readFixed32());var e=Cr(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Rt.Bytes)return i.push(this.readSFixed32());var e=Cr(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Rt.Bytes)return i.push(this.readFixed64());var e=Cr(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Rt.Bytes)return i.push(this.readSFixed64());var e=Cr(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Rt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Rt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Rt.Fixed32)this.pos+=4;else{if(e!==Rt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),yo(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),yo(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),yo(this.buf,-1&i,this.pos),yo(this.buf,Math.floor(i*$u),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),yo(this.buf,-1&i,this.pos),yo(this.buf,Math.floor(i*$u),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,n){var s,l;if(e>=0?(s=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(h,p,m){m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,m.buf[m.pos]=127&(h>>>=7)}(s,0,n),function(h,p){var m=(7&h)<<4;p.buf[p.pos++]|=m|((h>>>=3)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h)))))}(l,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,l,h){for(var p,m,_=0;_<l.length;_++){if((p=l.charCodeAt(_))>55295&&p<57344){if(!m){p>56319||_+1===l.length?(s[h++]=239,s[h++]=191,s[h++]=189):m=p;continue}if(p<56320){s[h++]=239,s[h++]=191,s[h++]=189,m=p;continue}p=m-55296<<10|p-56320|65536,m=null}else m&&(s[h++]=239,s[h++]=191,s[h++]=189,m=null);p<128?s[h++]=p:(p<2048?s[h++]=p>>6|192:(p<65536?s[h++]=p>>12|224:(s[h++]=p>>18|240,s[h++]=p>>12&63|128),s[h++]=p>>6&63|128),s[h++]=63&p|128)}return h}(this.buf,i,this.pos);var n=this.pos-e;n>=128&&ju(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),Vu(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Vu(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,e){this.pos++;var n=this.pos;i(e,this);var s=this.pos-n;s>=128&&ju(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,n){this.writeTag(i,Rt.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Ed,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Cd,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Pd,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,zd,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,kd,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Md,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Dd,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Ld,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Rd,e)},writeBytesField:function(i,e){this.writeTag(i,Rt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Rt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Rt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Rt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Rt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Rt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Rt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Rt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Rt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Rt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class zc{constructor(e,{pixelRatio:n,version:s,stretchX:l,stretchY:h,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=l,this.stretchY=h,this.content=p,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Zu{constructor(e,n){const s={},l={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,s,h),this.addImages(n,l,h);const{w:p,h:m}=Gu(h),_=new xn({width:p||1,height:m||1});for(const w in e){const T=e[w],C=s[w].paddedRect;xn.copy(T.data,_,{x:0,y:0},{x:C.x+1,y:C.y+1},T.data)}for(const w in n){const T=n[w],C=l[w].paddedRect,M=C.x+1,R=C.y+1,B=T.data.width,H=T.data.height;xn.copy(T.data,_,{x:0,y:0},{x:M,y:R},T.data),xn.copy(T.data,_,{x:0,y:H-1},{x:M,y:R-1},{width:B,height:1}),xn.copy(T.data,_,{x:0,y:0},{x:M,y:R+H},{width:B,height:1}),xn.copy(T.data,_,{x:B-1,y:0},{x:M-1,y:R},{width:1,height:H}),xn.copy(T.data,_,{x:0,y:0},{x:M+B,y:R},{width:1,height:H})}this.image=_,this.iconPositions=s,this.patternPositions=l}addImages(e,n,s){for(const l in e){const h=e[l],p={x:0,y:0,w:h.data.width+2,h:h.data.height+2};s.push(p),n[l]=new zc(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;const[l,h]=e.tl;s.update(n.data,void 0,{x:l,y:h})}}Ne("ImagePosition",zc),Ne("ImageAtlas",Zu),o.WritingMode=void 0,(Jr=o.WritingMode||(o.WritingMode={}))[Jr.none=0]="none",Jr[Jr.horizontal=1]="horizontal",Jr[Jr.vertical=2]="vertical",Jr[Jr.horizontalOnly=3]="horizontalOnly";const xl=-17;class xa{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const s=new xa;return s.scale=e||1,s.fontStack=n,s}static forImage(e){const n=new xa;return n.imageName=e,n}}class xo{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const s=new xo;for(let l=0;l<e.sections.length;l++){const h=e.sections[l];h.image?s.addImageSection(h):s.addTextSection(h,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let n="";for(let s=0;s<e.length;s++){const l=e.charCodeAt(s+1)||null,h=e.charCodeAt(s-1)||null;n+=l&&nl(l)&&!ya[e[s+1]]||h&&nl(h)&&!ya[e[s-1]]||!ya[e[s]]?e[s]:ya[e[s]]}return n}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&bl[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&bl[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const s=new xo;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(xa.forText(e.scale,e.fontStack||n));const s=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(s)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Ye("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(xa.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Ye("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vl(i,e,n,s,l,h,p,m,_,w,T,C,M,R,B,H){const X=xo.fromFeature(i,l);let re;C===o.WritingMode.vertical&&X.verticalizePunctuation();const{processBidirectionalText:ue,processStyledBidirectionalText:ce}=on;if(ue&&X.sections.length===1){re=[];const ve=ue(X.toString(),kc(X,w,h,e,s,R,B));for(const je of ve){const Ke=new xo;Ke.text=je,Ke.sections=X.sections;for(let Be=0;Be<je.length;Be++)Ke.sectionIndex.push(0);re.push(Ke)}}else if(ce){re=[];const ve=ce(X.text,X.sectionIndex,kc(X,w,h,e,s,R,B));for(const je of ve){const Ke=new xo;Ke.text=je[0],Ke.sectionIndex=je[1],Ke.sections=X.sections,re.push(Ke)}}else re=function(ve,je){const Ke=[],Be=ve.text;let Fe=0;for(const Pe of je)Ke.push(ve.substring(Fe,Pe)),Fe=Pe;return Fe<Be.length&&Ke.push(ve.substring(Fe,Be.length)),Ke}(X,kc(X,w,h,e,s,R,B));const ge=[],Se={positionedLines:ge,text:X.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:C,iconsInText:!1,verticalizable:!1};return function(ve,je,Ke,Be,Fe,Pe,$e,Oe,Ee,nt,Je,bt){let Mt=0,Zt=xl,Wt=0,Ai=0;const oi=Oe==="right"?1:Oe==="left"?0:.5;let ai=0;for(const li of Fe){li.trim();const Ti=li.getMaxScale(),Li=(Ti-1)*bi,$i={positionedGlyphs:[],lineOffset:0};ve.positionedLines[ai]=$i;const Qi=$i.positionedGlyphs;let en=0;if(!li.length()){Zt+=Pe,++ai;continue}for(let _i=0;_i<li.length();_i++){const _t=li.getSection(_i),cn=li.getSectionIndex(_i),Ei=li.getCharCode(_i);let Ri=0,Rn=null,Hn=null,Xn=null,kr=bi;const Bn=!(Ee===o.WritingMode.horizontal||!Je&&!vs(Ei)||Je&&(bl[Ei]||(gi=Ei,De.Arabic(gi)||De["Arabic Supplement"](gi)||De["Arabic Extended-A"](gi)||De["Arabic Presentation Forms-A"](gi)||De["Arabic Presentation Forms-B"](gi))));if(_t.imageName){const vn=Be[_t.imageName];if(!vn)continue;Xn=_t.imageName,ve.iconsInText=ve.iconsInText||!0,Hn=vn.paddedRect;const tn=vn.displaySize;_t.scale=_t.scale*bi/bt,Rn={width:tn[0],height:tn[1],left:1,top:-3,advance:Bn?tn[1]:tn[0]},Ri=Li+(bi-tn[1]*_t.scale),kr=Rn.advance;const Pr=Bn?tn[0]*_t.scale-bi*Ti:tn[1]*_t.scale-bi*Ti;Pr>0&&Pr>en&&(en=Pr)}else{const vn=Ke[_t.fontStack],tn=vn&&vn[Ei];if(tn&&tn.rect)Hn=tn.rect,Rn=tn.metrics;else{const Pr=je[_t.fontStack],wa=Pr&&Pr[Ei];if(!wa)continue;Rn=wa.metrics}Ri=(Ti-_t.scale)*bi}Bn?(ve.verticalizable=!0,Qi.push({glyph:Ei,imageName:Xn,x:Mt,y:Zt+Ri,vertical:Bn,scale:_t.scale,fontStack:_t.fontStack,sectionIndex:cn,metrics:Rn,rect:Hn}),Mt+=kr*_t.scale+nt):(Qi.push({glyph:Ei,imageName:Xn,x:Mt,y:Zt+Ri,vertical:Bn,scale:_t.scale,fontStack:_t.fontStack,sectionIndex:cn,metrics:Rn,rect:Hn}),Mt+=Rn.advance*_t.scale+nt)}Qi.length!==0&&(Wt=Math.max(Mt-nt,Wt),$d(Qi,0,Qi.length-1,oi,en)),Mt=0;const Xt=Pe*Ti+en;$i.lineOffset=Math.max(en,Li),Zt+=Xt,Ai=Math.max(Xt,Ai),++ai}var gi;const Ii=Zt-xl,{horizontalAlign:Di,verticalAlign:Ji}=Pc($e);(function(li,Ti,Li,$i,Qi,en,Xt,_i,_t){const cn=(Ti-Li)*Qi;let Ei=0;Ei=en!==Xt?-_i*$i-xl:(-$i*_t+.5)*Xt;for(const Ri of li)for(const Rn of Ri.positionedGlyphs)Rn.x+=cn,Rn.y+=Ei})(ve.positionedLines,oi,Di,Ji,Wt,Ai,Pe,Ii,Fe.length),ve.top+=-Ji*Ii,ve.bottom=ve.top+Ii,ve.left+=-Di*Wt,ve.right=ve.left+Wt}(Se,e,n,s,re,p,m,_,C,w,M,H),!function(ve){for(const je of ve)if(je.positionedGlyphs.length!==0)return!1;return!0}(ge)&&Se}const bl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ud={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Wu(i,e,n,s,l,h){if(e.imageName){const p=s[e.imageName];return p?p.displaySize[0]*e.scale*bi/h+l:0}{const p=n[e.fontStack],m=p&&p[i];return m?m.metrics.advance*e.scale+l:0}}function Hu(i,e,n,s){const l=Math.pow(i-e,2);return s?i<e?l/2:2*l:l+Math.abs(n)*n}function Vd(i,e,n){let s=0;return i===10&&(s-=1e4),n&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Xu(i,e,n,s,l,h){let p=null,m=Hu(e,n,l,h);for(const _ of s){const w=Hu(e-_.x,n,l,h)+_.badness;w<=m&&(p=_,m=w)}return{index:i,x:e,priorBreak:p,badness:m}}function Yu(i){return i?Yu(i.priorBreak).concat(i.index):[]}function kc(i,e,n,s,l,h,p){if(h!=="point")return[];if(!i)return[];const m=[],_=function(M,R,B,H,X,re){let ue=0;for(let ce=0;ce<M.length();ce++){const ge=M.getSection(ce);ue+=Wu(M.getCharCode(ce),ge,H,X,R,re)}return ue/Math.max(1,Math.ceil(ue/B))}(i,e,n,s,l,p),w=i.text.indexOf("\u200B")>=0;let T=0;for(let M=0;M<i.length();M++){const R=i.getSection(M),B=i.getCharCode(M);if(bl[B]||(T+=Wu(B,R,s,l,e,p)),M<i.length()-1){const H=!((C=B)<11904||!(De["Bopomofo Extended"](C)||De.Bopomofo(C)||De["CJK Compatibility Forms"](C)||De["CJK Compatibility Ideographs"](C)||De["CJK Compatibility"](C)||De["CJK Radicals Supplement"](C)||De["CJK Strokes"](C)||De["CJK Symbols and Punctuation"](C)||De["CJK Unified Ideographs Extension A"](C)||De["CJK Unified Ideographs"](C)||De["Enclosed CJK Letters and Months"](C)||De["Halfwidth and Fullwidth Forms"](C)||De.Hiragana(C)||De["Ideographic Description Characters"](C)||De["Kangxi Radicals"](C)||De["Katakana Phonetic Extensions"](C)||De.Katakana(C)||De["Vertical Forms"](C)||De["Yi Radicals"](C)||De["Yi Syllables"](C)));(Ud[B]||H||R.imageName)&&m.push(Xu(M+1,T,_,m,Vd(B,i.getCharCode(M+1),H&&w),!1))}}var C;return Yu(Xu(i.length(),T,_,m,0,!0))}function Pc(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function $d(i,e,n,s,l){if(!s&&!l)return;const h=i[n],p=(i[n].x+h.metrics.advance*h.scale)*s;for(let m=e;m<=n;m++)i[m].x-=p,i[m].y+=l}function Nd(i,e,n){const{horizontalAlign:s,verticalAlign:l}=Pc(n),h=e[0]-i.displaySize[0]*s,p=e[1]-i.displaySize[1]*l;return{image:i,top:p,bottom:p+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function Ku(i,e,n,s,l,h){const p=i.image;let m;if(p.content){const X=p.content,re=p.pixelRatio||1;m=[X[0]/re,X[1]/re,p.displaySize[0]-X[2]/re,p.displaySize[1]-X[3]/re]}const _=e.left*h,w=e.right*h;let T,C,M,R;n==="width"||n==="both"?(R=l[0]+_-s[3],C=l[0]+w+s[1]):(R=l[0]+(_+w-p.displaySize[0])/2,C=R+p.displaySize[0]);const B=e.top*h,H=e.bottom*h;return n==="height"||n==="both"?(T=l[1]+B-s[0],M=l[1]+H+s[2]):(T=l[1]+(B+H-p.displaySize[1])/2,M=T+p.displaySize[1]),{image:p,top:T,right:C,bottom:M,left:R,collisionPadding:m}}const zr=128;function Ju(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new qt(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=n;let h=0;for(;h<s.length&&s[h]<=i;)h++;h=Math.max(0,h-1);let p=h;for(;p<s.length&&s[p]<i+1;)p++;p=Math.min(s.length-1,p);const m=s[h],_=s[p];return n.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:_,interpolationType:l}:{kind:"camera",minZoom:m,maxZoom:_,minSize:n.evaluate(new qt(m)),maxSize:n.evaluate(new qt(_)),interpolationType:l}}}class Qr extends Ve{constructor(e,n,s,l){super(e,n),this.angle=s,l!==void 0&&(this.segment=l)}clone(){return new Qr(this.x,this.y,this.angle,this.segment)}}function Qu(i,e,n,s,l){if(e.segment===void 0)return!0;let h=e,p=e.segment+1,m=0;for(;m>-n/2;){if(p--,p<0)return!1;m-=i[p].dist(h),h=i[p]}m+=i[p].dist(i[p+1]),p++;const _=[];let w=0;for(;m<n/2;){const T=i[p],C=i[p+1];if(!C)return!1;let M=i[p-1].angleTo(T)-T.angleTo(C);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),_.push({distance:m,angleDelta:M}),w+=M;m-_[0].distance>s;)w-=_.shift().angleDelta;if(w>l)return!1;p++,m+=T.dist(C)}return!0}function eh(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function th(i,e,n){return i?.6*e*n:0}function ih(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function jd(i,e,n,s,l,h){const p=th(n,l,h),m=ih(n,s)*h;let _=0;const w=eh(i)/2;for(let T=0;T<i.length-1;T++){const C=i[T],M=i[T+1],R=C.dist(M);if(_+R>w){const B=(w-_)/R,H=ri(C.x,M.x,B),X=ri(C.y,M.y,B),re=new Qr(H,X,M.angleTo(C),T);return re._round(),!p||Qu(i,re,m,p,e)?re:void 0}_+=R}}function qd(i,e,n,s,l,h,p,m,_){const w=th(s,h,p),T=ih(s,l),C=T*p,M=i[0].x===0||i[0].x===_||i[0].y===0||i[0].y===_;return e-C<e/4&&(e=C+e/4),nh(i,M?e/2*m%e:(T/2+2*h)*p*m%e,e,w,n,C,M,!1,_)}function nh(i,e,n,s,l,h,p,m,_){const w=h/2,T=eh(i);let C=0,M=e-n,R=[];for(let B=0;B<i.length-1;B++){const H=i[B],X=i[B+1],re=H.dist(X),ue=X.angleTo(H);for(;M+n<C+re;){M+=n;const ce=(M-C)/re,ge=ri(H.x,X.x,ce),Se=ri(H.y,X.y,ce);if(ge>=0&&ge<_&&Se>=0&&Se<_&&M-w>=0&&M+w<=T){const ve=new Qr(ge,Se,ue,B);ve._round(),s&&!Qu(i,ve,h,s,l)||R.push(ve)}}C+=re}return m||R.length||p||(R=nh(i,C/2,n,s,l,h,p,!0,_)),R}function rh(i,e,n,s,l){const h=[];for(let p=0;p<i.length;p++){const m=i[p];let _;for(let w=0;w<m.length-1;w++){let T=m[w],C=m[w+1];T.x<e&&C.x<e||(T.x<e?T=new Ve(e,T.y+(e-T.x)/(C.x-T.x)*(C.y-T.y))._round():C.x<e&&(C=new Ve(e,T.y+(e-T.x)/(C.x-T.x)*(C.y-T.y))._round()),T.y<n&&C.y<n||(T.y<n?T=new Ve(T.x+(n-T.y)/(C.y-T.y)*(C.x-T.x),n)._round():C.y<n&&(C=new Ve(T.x+(n-T.y)/(C.y-T.y)*(C.x-T.x),n)._round()),T.x>=s&&C.x>=s||(T.x>=s?T=new Ve(s,T.y+(s-T.x)/(C.x-T.x)*(C.y-T.y))._round():C.x>=s&&(C=new Ve(s,T.y+(s-T.x)/(C.x-T.x)*(C.y-T.y))._round()),T.y>=l&&C.y>=l||(T.y>=l?T=new Ve(T.x+(l-T.y)/(C.y-T.y)*(C.x-T.x),l)._round():C.y>=l&&(C=new Ve(T.x+(l-T.y)/(C.y-T.y)*(C.x-T.x),l)._round()),_&&T.equals(_[_.length-1])||(_=[T],h.push(_)),_.push(C)))))}}return h}function sh(i,e,n,s){const l=[],h=i.image,p=h.pixelRatio,m=h.paddedRect.w-2,_=h.paddedRect.h-2,w=i.right-i.left,T=i.bottom-i.top,C=h.stretchX||[[0,m]],M=h.stretchY||[[0,_]],R=(Pe,$e)=>Pe+$e[1]-$e[0],B=C.reduce(R,0),H=M.reduce(R,0),X=m-B,re=_-H;let ue=0,ce=B,ge=0,Se=H,ve=0,je=X,Ke=0,Be=re;if(h.content&&s){const Pe=h.content;ue=wl(C,0,Pe[0]),ge=wl(M,0,Pe[1]),ce=wl(C,Pe[0],Pe[2]),Se=wl(M,Pe[1],Pe[3]),ve=Pe[0]-ue,Ke=Pe[1]-ge,je=Pe[2]-Pe[0]-ce,Be=Pe[3]-Pe[1]-Se}const Fe=(Pe,$e,Oe,Ee)=>{const nt=Sl(Pe.stretch-ue,ce,w,i.left),Je=Al(Pe.fixed-ve,je,Pe.stretch,B),bt=Sl($e.stretch-ge,Se,T,i.top),Mt=Al($e.fixed-Ke,Be,$e.stretch,H),Zt=Sl(Oe.stretch-ue,ce,w,i.left),Wt=Al(Oe.fixed-ve,je,Oe.stretch,B),Ai=Sl(Ee.stretch-ge,Se,T,i.top),oi=Al(Ee.fixed-Ke,Be,Ee.stretch,H),ai=new Ve(nt,bt),gi=new Ve(Zt,bt),Ii=new Ve(Zt,Ai),Di=new Ve(nt,Ai),Ji=new Ve(Je/p,Mt/p),li=new Ve(Wt/p,oi/p),Ti=e*Math.PI/180;if(Ti){const Qi=Math.sin(Ti),en=Math.cos(Ti),Xt=[en,-Qi,Qi,en];ai._matMult(Xt),gi._matMult(Xt),Di._matMult(Xt),Ii._matMult(Xt)}const Li=Pe.stretch+Pe.fixed,$i=$e.stretch+$e.fixed;return{tl:ai,tr:gi,bl:Di,br:Ii,tex:{x:h.paddedRect.x+1+Li,y:h.paddedRect.y+1+$i,w:Oe.stretch+Oe.fixed-Li,h:Ee.stretch+Ee.fixed-$i},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ji,pixelOffsetBR:li,minFontScaleX:je/p/w,minFontScaleY:Be/p/T,isSDF:n}};if(s&&(h.stretchX||h.stretchY)){const Pe=oh(C,X,B),$e=oh(M,re,H);for(let Oe=0;Oe<Pe.length-1;Oe++){const Ee=Pe[Oe],nt=Pe[Oe+1];for(let Je=0;Je<$e.length-1;Je++)l.push(Fe(Ee,$e[Je],nt,$e[Je+1]))}}else l.push(Fe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:_+1}));return l}function wl(i,e,n){let s=0;for(const l of i)s+=Math.max(e,Math.min(n,l[1]))-Math.max(e,Math.min(n,l[0]));return s}function oh(i,e,n){const s=[{fixed:-1,stretch:0}];for(const[l,h]of i){const p=s[s.length-1];s.push({fixed:l-p.stretch,stretch:p.stretch}),s.push({fixed:l-p.stretch,stretch:p.stretch+(h-l)})}return s.push({fixed:e+1,stretch:n}),s}function Sl(i,e,n,s){return i/e*n+s}function Al(i,e,n,s){return i-e*n/s}Ne("Anchor",Qr);class Il{constructor(e,n,s,l,h,p,m,_,w,T){if(this.boxStartIndex=e.length,w){let C=p.top,M=p.bottom;const R=p.collisionPadding;R&&(C-=R[1],M+=R[3]);let B=M-C;B>0&&(B=Math.max(10,B),this.circleDiameter=B)}else{let C=p.top*m-_,M=p.bottom*m+_,R=p.left*m-_,B=p.right*m+_;const H=p.collisionPadding;if(H&&(R-=H[0]*m,C-=H[1]*m,B+=H[2]*m,M+=H[3]*m),T){const X=new Ve(R,C),re=new Ve(B,C),ue=new Ve(R,M),ce=new Ve(B,M),ge=T*Math.PI/180;X._rotate(ge),re._rotate(ge),ue._rotate(ge),ce._rotate(ge),R=Math.min(X.x,re.x,ue.x,ce.x),B=Math.max(X.x,re.x,ue.x,ce.x),C=Math.min(X.y,re.y,ue.y,ce.y),M=Math.max(X.y,re.y,ue.y,ce.y)}e.emplaceBack(n.x,n.y,R,C,B,M,s,l,h)}this.boxEndIndex=e.length}}class Gd{constructor(e=[],n=Zd){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:s}=this,l=n[e];for(;e>0;){const h=e-1>>1,p=n[h];if(s(l,p)>=0)break;n[e]=p,e=h}n[e]=l}_down(e){const{data:n,compare:s}=this,l=this.length>>1,h=n[e];for(;e<l;){let p=1+(e<<1),m=n[p];const _=p+1;if(_<this.length&&s(n[_],m)<0&&(p=_,m=n[_]),s(m,h)>=0)break;n[e]=m,e=p}n[e]=h}}function Zd(i,e){return i<e?-1:i>e?1:0}function Wd(i,e=1,n=!1){let s=1/0,l=1/0,h=-1/0,p=-1/0;const m=i[0];for(let R=0;R<m.length;R++){const B=m[R];(!R||B.x<s)&&(s=B.x),(!R||B.y<l)&&(l=B.y),(!R||B.x>h)&&(h=B.x),(!R||B.y>p)&&(p=B.y)}const _=Math.min(h-s,p-l);let w=_/2;const T=new Gd([],Hd);if(_===0)return new Ve(s,l);for(let R=s;R<h;R+=_)for(let B=l;B<p;B+=_)T.push(new vo(R+w,B+w,w,i));let C=function(R){let B=0,H=0,X=0;const re=R[0];for(let ue=0,ce=re.length,ge=ce-1;ue<ce;ge=ue++){const Se=re[ue],ve=re[ge],je=Se.x*ve.y-ve.x*Se.y;H+=(Se.x+ve.x)*je,X+=(Se.y+ve.y)*je,B+=3*je}return new vo(H/B,X/B,0,R)}(i),M=T.length;for(;T.length;){const R=T.pop();(R.d>C.d||!C.d)&&(C=R,n&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,M)),R.max-C.d<=e||(w=R.h/2,T.push(new vo(R.p.x-w,R.p.y-w,w,i)),T.push(new vo(R.p.x+w,R.p.y-w,w,i)),T.push(new vo(R.p.x-w,R.p.y+w,w,i)),T.push(new vo(R.p.x+w,R.p.y+w,w,i)),M+=4)}return n&&(console.log(`num probes: ${M}`),console.log(`best distance: ${C.d}`)),C.p}function Hd(i,e){return e.max-i.max}function vo(i,e,n,s){this.p=new Ve(i,e),this.h=n,this.d=function(l,h){let p=!1,m=1/0;for(let _=0;_<h.length;_++){const w=h[_];for(let T=0,C=w.length,M=C-1;T<C;M=T++){const R=w[T],B=w[M];R.y>l.y!=B.y>l.y&&l.x<(B.x-R.x)*(l.y-R.y)/(B.y-R.y)+R.x&&(p=!p),m=Math.min(m,_u(l,R,B))}}return(p?1:-1)*Math.sqrt(m)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Mc=Number.POSITIVE_INFINITY;function ah(i,e){return e[1]!==Mc?function(n,s,l){let h=0,p=0;switch(s=Math.abs(s),l=Math.abs(l),n){case"top-right":case"top-left":case"top":p=l-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-l}switch(n){case"top-right":case"bottom-right":case"right":h=-s;break;case"top-left":case"bottom-left":case"left":h=s}return[h,p]}(i,e[0],e[1]):function(n,s){let l=0,h=0;s<0&&(s=0);const p=s/Math.sqrt(2);switch(n){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-s;break;case"top":h=s-7}switch(n){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=s;break;case"right":l=-s}return[l,h]}(i,e[0])}function Dc(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Xd(i,e,n,s,l,h,p,m,_,w,T){let C=h.textMaxSize.evaluate(e,{});C===void 0&&(C=p);const M=i.layers[0].layout,R=M.get("icon-offset").evaluate(e,{},T),B=ch(n.horizontal),H=p/24,X=i.tilePixelRatio*H,re=i.tilePixelRatio*C/24,ue=i.tilePixelRatio*m,ce=i.tilePixelRatio*M.get("symbol-spacing"),ge=M.get("text-padding")*i.tilePixelRatio,Se=M.get("icon-padding")*i.tilePixelRatio,ve=M.get("text-max-angle")/180*Math.PI,je=M.get("text-rotation-alignment")!=="viewport"&&M.get("symbol-placement")!=="point",Ke=M.get("icon-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",Be=M.get("symbol-placement"),Fe=ce/2,Pe=M.get("icon-text-fit");let $e;s&&Pe!=="none"&&(i.allowVerticalPlacement&&n.vertical&&($e=Ku(s,n.vertical,Pe,M.get("icon-text-fit-padding"),R,H)),B&&(s=Ku(s,B,Pe,M.get("icon-text-fit-padding"),R,H)));const Oe=(Ee,nt)=>{nt.x<0||nt.x>=di||nt.y<0||nt.y>=di||function(Je,bt,Mt,Zt,Wt,Ai,oi,ai,gi,Ii,Di,Ji,li,Ti,Li,$i,Qi,en,Xt,_i,_t,cn,Ei,Ri,Rn){const Hn=Je.addToLineVertexArray(bt,Mt);let Xn,kr,Bn,vn,tn=0,Pr=0,wa=0,Ih=0,jc=-1,qc=-1;const Mr={};let Th=aa(""),Gc=0,Zc=0;if(ai._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Gc,Zc]=ai.layout.get("text-offset").evaluate(_t,{},Ri).map(nn=>nn*bi):(Gc=ai.layout.get("text-radial-offset").evaluate(_t,{},Ri)*bi,Zc=Mc),Je.allowVerticalPlacement&&Zt.vertical){const nn=ai.layout.get("text-rotate").evaluate(_t,{},Ri)+90;Bn=new Il(gi,bt,Ii,Di,Ji,Zt.vertical,li,Ti,Li,nn),oi&&(vn=new Il(gi,bt,Ii,Di,Ji,oi,Qi,en,Li,nn))}if(Wt){const nn=ai.layout.get("icon-rotate").evaluate(_t,{}),rr=ai.layout.get("icon-text-fit")!=="none",Sa=sh(Wt,nn,Ei,rr),Aa=oi?sh(oi,nn,Ei,rr):void 0;kr=new Il(gi,bt,Ii,Di,Ji,Wt,Qi,en,!1,nn),tn=4*Sa.length;const zh=Je.iconSizeData;let zs=null;zh.kind==="source"?(zs=[zr*ai.layout.get("icon-size").evaluate(_t,{})],zs[0]>es&&Ye(`${Je.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):zh.kind==="composite"&&(zs=[zr*cn.compositeIconSizes[0].evaluate(_t,{},Ri),zr*cn.compositeIconSizes[1].evaluate(_t,{},Ri)],(zs[0]>es||zs[1]>es)&&Ye(`${Je.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Je.addSymbols(Je.icon,Sa,zs,_i,Xt,_t,o.WritingMode.none,bt,Hn.lineStartIndex,Hn.lineLength,-1,Ri),jc=Je.icon.placedSymbolArray.length-1,Aa&&(Pr=4*Aa.length,Je.addSymbols(Je.icon,Aa,zs,_i,Xt,_t,o.WritingMode.vertical,bt,Hn.lineStartIndex,Hn.lineLength,-1,Ri),qc=Je.icon.placedSymbolArray.length-1)}const Eh=Object.keys(Zt.horizontal);for(const nn of Eh){const rr=Zt.horizontal[nn];if(!Xn){Th=aa(rr.text);const Aa=ai.layout.get("text-rotate").evaluate(_t,{},Ri);Xn=new Il(gi,bt,Ii,Di,Ji,rr,li,Ti,Li,Aa)}const Sa=rr.positionedLines.length===1;if(wa+=lh(Je,bt,rr,Ai,ai,Li,_t,$i,Hn,Zt.vertical?o.WritingMode.horizontal:o.WritingMode.horizontalOnly,Sa?Eh:[nn],Mr,jc,cn,Ri),Sa)break}Zt.vertical&&(Ih+=lh(Je,bt,Zt.vertical,Ai,ai,Li,_t,$i,Hn,o.WritingMode.vertical,["vertical"],Mr,qc,cn,Ri));const cf=Xn?Xn.boxStartIndex:Je.collisionBoxArray.length,uf=Xn?Xn.boxEndIndex:Je.collisionBoxArray.length,hf=Bn?Bn.boxStartIndex:Je.collisionBoxArray.length,pf=Bn?Bn.boxEndIndex:Je.collisionBoxArray.length,df=kr?kr.boxStartIndex:Je.collisionBoxArray.length,ff=kr?kr.boxEndIndex:Je.collisionBoxArray.length,mf=vn?vn.boxStartIndex:Je.collisionBoxArray.length,gf=vn?vn.boxEndIndex:Je.collisionBoxArray.length;let Yn=-1;const kl=(nn,rr)=>nn&&nn.circleDiameter?Math.max(nn.circleDiameter,rr):rr;Yn=kl(Xn,Yn),Yn=kl(Bn,Yn),Yn=kl(kr,Yn),Yn=kl(vn,Yn);const Ch=Yn>-1?1:0;Ch&&(Yn*=Rn/bi),Je.glyphOffsetArray.length>=bo.MAX_GLYPHS&&Ye("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),_t.sortKey!==void 0&&Je.addToSortKeyRanges(Je.symbolInstances.length,_t.sortKey),Je.symbolInstances.emplaceBack(bt.x,bt.y,Mr.right>=0?Mr.right:-1,Mr.center>=0?Mr.center:-1,Mr.left>=0?Mr.left:-1,Mr.vertical||-1,jc,qc,Th,cf,uf,hf,pf,df,ff,mf,gf,Ii,wa,Ih,tn,Pr,Ch,0,li,Gc,Zc,Yn)}(i,nt,Ee,n,s,l,$e,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,X,ge,je,_,ue,Se,Ke,R,e,h,w,T,p)};if(Be==="line")for(const Ee of rh(e.geometry,0,0,di,di)){const nt=qd(Ee,ce,ve,n.vertical||B,s,24,re,i.overscaling,di);for(const Je of nt){const bt=B;bt&&Yd(i,bt.text,Fe,Je)||Oe(Ee,Je)}}else if(Be==="line-center"){for(const Ee of e.geometry)if(Ee.length>1){const nt=jd(Ee,ve,n.vertical||B,s,24,re);nt&&Oe(Ee,nt)}}else if(e.type==="Polygon")for(const Ee of vc(e.geometry,0)){const nt=Wd(Ee,16);Oe(Ee[0],new Qr(nt.x,nt.y,0))}else if(e.type==="LineString")for(const Ee of e.geometry)Oe(Ee,new Qr(Ee[0].x,Ee[0].y,0));else if(e.type==="Point")for(const Ee of e.geometry)for(const nt of Ee)Oe([nt],new Qr(nt.x,nt.y,0))}const es=32640;function lh(i,e,n,s,l,h,p,m,_,w,T,C,M,R,B){const H=function(ue,ce,ge,Se,ve,je,Ke,Be){const Fe=Se.layout.get("text-rotate").evaluate(je,{})*Math.PI/180,Pe=[];for(const $e of ce.positionedLines)for(const Oe of $e.positionedGlyphs){if(!Oe.rect)continue;const Ee=Oe.rect||{};let nt=4,Je=!0,bt=1,Mt=0;const Zt=(ve||Be)&&Oe.vertical,Wt=Oe.metrics.advance*Oe.scale/2;if(Be&&ce.verticalizable){const Xt=(Oe.scale-1)*bi,_i=(bi-Oe.metrics.width*Oe.scale)/2;Mt=$e.lineOffset/2-(Oe.imageName?-_i:Xt)}if(Oe.imageName){const Xt=Ke[Oe.imageName];Je=Xt.sdf,bt=Xt.pixelRatio,nt=1/bt}const Ai=ve?[Oe.x+Wt,Oe.y]:[0,0];let oi=ve?[0,0]:[Oe.x+Wt+ge[0],Oe.y+ge[1]-Mt],ai=[0,0];Zt&&(ai=oi,oi=[0,0]);const gi=(Oe.metrics.left-nt)*Oe.scale-Wt+oi[0],Ii=(-Oe.metrics.top-nt)*Oe.scale+oi[1],Di=gi+Ee.w*Oe.scale/bt,Ji=Ii+Ee.h*Oe.scale/bt,li=new Ve(gi,Ii),Ti=new Ve(Di,Ii),Li=new Ve(gi,Ji),$i=new Ve(Di,Ji);if(Zt){const Xt=new Ve(-Wt,Wt-xl),_i=-Math.PI/2,_t=12-Wt,cn=new Ve(22-_t,-(Oe.imageName?_t:0)),Ei=new Ve(...ai);li._rotateAround(_i,Xt)._add(cn)._add(Ei),Ti._rotateAround(_i,Xt)._add(cn)._add(Ei),Li._rotateAround(_i,Xt)._add(cn)._add(Ei),$i._rotateAround(_i,Xt)._add(cn)._add(Ei)}if(Fe){const Xt=Math.sin(Fe),_i=Math.cos(Fe),_t=[_i,-Xt,Xt,_i];li._matMult(_t),Ti._matMult(_t),Li._matMult(_t),$i._matMult(_t)}const Qi=new Ve(0,0),en=new Ve(0,0);Pe.push({tl:li,tr:Ti,bl:Li,br:$i,tex:Ee,writingMode:ce.writingMode,glyphOffset:Ai,sectionIndex:Oe.sectionIndex,isSDF:Je,pixelOffsetTL:Qi,pixelOffsetBR:en,minFontScaleX:0,minFontScaleY:0})}return Pe}(0,n,m,l,h,p,s,i.allowVerticalPlacement),X=i.textSizeData;let re=null;X.kind==="source"?(re=[zr*l.layout.get("text-size").evaluate(p,{})],re[0]>es&&Ye(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):X.kind==="composite"&&(re=[zr*R.compositeTextSizes[0].evaluate(p,{},B),zr*R.compositeTextSizes[1].evaluate(p,{},B)],(re[0]>es||re[1]>es)&&Ye(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,H,re,m,h,p,w,e,_.lineStartIndex,_.lineLength,M,B);for(const ue of T)C[ue]=i.text.placedSymbolArray.length-1;return 4*H.length}function ch(i){for(const e in i)return i[e];return null}function Yd(i,e,n,s){const l=i.compareText;if(e in l){const h=l[e];for(let p=h.length-1;p>=0;p--)if(s.dist(h[p])<n)return!0}else l[e]=[];return l[e].push(s),!1}const Kd=Kr.VectorTileFeature.types,Jd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Tl(i,e,n,s,l,h,p,m,_,w,T,C,M){const R=m?Math.min(es,Math.round(m[0])):0,B=m?Math.min(es,Math.round(m[1])):0;i.emplaceBack(e,n,Math.round(32*s),Math.round(32*l),h,p,(R<<1)+(_?1:0),B,16*w,16*T,256*C,256*M)}function Lc(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function Qd(i){for(const e of i.sections)if(sc(e.text))return!0;return!1}class Rc{constructor(e){this.layoutVertexArray=new vi,this.indexArray=new Vi,this.programConfigurations=e,this.segments=new Et,this.dynamicLayoutVertexArray=new Yi,this.opacityVertexArray=new an,this.placedSymbolArray=new Ie}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,s,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wd.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Sd.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Jd,!0),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ne("SymbolBuffers",Rc);class Bc{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new Et,this.collisionVertexArray=new nr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Ad.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ne("CollisionBuffers",Bc);class bo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=dc([]),this.placementViewportMatrix=dc([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ju(this.zoom,n["text-size"]),this.iconSizeData=Ju(this.zoom,n["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),h=s.get("symbol-z-order");this.canOverlap=Oc(s,"text-overlap","text-allow-overlap")!=="never"||Oc(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(p=>o.WritingMode[p])),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID}createArrays(){this.text=new Rc(new Is(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Rc(new Is(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new qe,this.lineVertexArray=new Re,this.symbolInstances=new _e}calculateGlyphDependencies(e,n,s,l,h){for(let p=0;p<e.length;p++)if(n[e.charCodeAt(p)]=!0,(s||l)&&h){const m=ya[e.charAt(p)];m&&(n[m.charCodeAt(0)]=!0)}}populate(e,n,s){const l=this.layers[0],h=l.layout,p=h.get("text-font"),m=h.get("text-field"),_=h.get("icon-image"),w=(m.value.kind!=="constant"||m.value.value instanceof q&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),T=_.value.kind!=="constant"||!!_.value.value||Object.keys(_.parameters).length>0,C=h.get("symbol-sort-key");if(this.features=[],!w&&!T)return;const M=n.iconDependencies,R=n.glyphDependencies,B=n.availableImages,H=new qt(this.zoom);for(const{feature:X,id:re,index:ue,sourceLayerIndex:ce}of e){const ge=l._featureFilter.needGeometry,Se=Es(X,ge);if(!l._featureFilter.filter(H,Se,s))continue;let ve,je;if(ge||(Se.geometry=Ts(X)),w){const Be=l.getValueAndResolveTokens("text-field",Se,s,B),Fe=q.factory(Be);Qd(Fe)&&(this.hasRTLText=!0),(!this.hasRTLText||ra()==="unavailable"||this.hasRTLText&&on.isParsed())&&(ve=Td(Fe,l,Se))}if(T){const Be=l.getValueAndResolveTokens("icon-image",Se,s,B);je=Be instanceof Q?Be:Q.fromString(Be)}if(!ve&&!je)continue;const Ke=this.sortFeaturesByKey?C.evaluate(Se,{},s):void 0;if(this.features.push({id:re,text:ve,icon:je,index:ue,sourceLayerIndex:ce,geometry:Se.geometry,properties:X.properties,type:Kd[X.type],sortKey:Ke}),je&&(M[je.name]=!0),ve){const Be=p.evaluate(Se,{},s).join(","),Fe=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.WritingMode.vertical)>=0;for(const Pe of ve.sections)if(Pe.image)M[Pe.image.name]=!0;else{const $e=Qo(ve.toString()),Oe=Pe.fontStack||Be,Ee=R[Oe]=R[Oe]||{};this.calculateGlyphDependencies(Pe.text,Ee,Fe,this.allowVerticalPlacement,$e)}}}h.get("symbol-placement")==="line"&&(this.features=function(X){const re={},ue={},ce=[];let ge=0;function Se(Be){ce.push(X[Be]),ge++}function ve(Be,Fe,Pe){const $e=ue[Be];return delete ue[Be],ue[Fe]=$e,ce[$e].geometry[0].pop(),ce[$e].geometry[0]=ce[$e].geometry[0].concat(Pe[0]),$e}function je(Be,Fe,Pe){const $e=re[Fe];return delete re[Fe],re[Be]=$e,ce[$e].geometry[0].shift(),ce[$e].geometry[0]=Pe[0].concat(ce[$e].geometry[0]),$e}function Ke(Be,Fe,Pe){const $e=Pe?Fe[0][Fe[0].length-1]:Fe[0][0];return`${Be}:${$e.x}:${$e.y}`}for(let Be=0;Be<X.length;Be++){const Fe=X[Be],Pe=Fe.geometry,$e=Fe.text?Fe.text.toString():null;if(!$e){Se(Be);continue}const Oe=Ke($e,Pe),Ee=Ke($e,Pe,!0);if(Oe in ue&&Ee in re&&ue[Oe]!==re[Ee]){const nt=je(Oe,Ee,Pe),Je=ve(Oe,Ee,ce[nt].geometry);delete re[Oe],delete ue[Ee],ue[Ke($e,ce[Je].geometry,!0)]=Je,ce[nt].geometry=null}else Oe in ue?ve(Oe,Ee,Pe):Ee in re?je(Oe,Ee,Pe):(Se(Be),re[Oe]=ge-1,ue[Ee]=ge-1)}return ce.filter(Be=>Be.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,re)=>X.sortKey-re.sortKey)}update(e,n,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const s=this.lineVertexArray.length;if(e.segment!==void 0){let l=e.dist(n[e.segment+1]),h=e.dist(n[e.segment]);const p={};for(let m=e.segment+1;m<n.length;m++)p[m]={x:n[m].x,y:n[m].y,tileUnitDistanceFromAnchor:l},m<n.length-1&&(l+=n[m+1].dist(n[m]));for(let m=e.segment||0;m>=0;m--)p[m]={x:n[m].x,y:n[m].y,tileUnitDistanceFromAnchor:h},m>0&&(h+=n[m-1].dist(n[m]));for(let m=0;m<n.length;m++){const _=p[m];this.lineVertexArray.emplaceBack(_.x,_.y,_.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,l,h,p,m,_,w,T,C,M){const R=e.indexArray,B=e.layoutVertexArray,H=e.segments.prepareSegment(4*n.length,B,R,this.canOverlap?p.sortKey:void 0),X=this.glyphOffsetArray.length,re=H.vertexLength,ue=this.allowVerticalPlacement&&m===o.WritingMode.vertical?Math.PI/2:0,ce=p.text&&p.text.sections;for(let ge=0;ge<n.length;ge++){const{tl:Se,tr:ve,bl:je,br:Ke,tex:Be,pixelOffsetTL:Fe,pixelOffsetBR:Pe,minFontScaleX:$e,minFontScaleY:Oe,glyphOffset:Ee,isSDF:nt,sectionIndex:Je}=n[ge],bt=H.vertexLength,Mt=Ee[1];Tl(B,_.x,_.y,Se.x,Mt+Se.y,Be.x,Be.y,s,nt,Fe.x,Fe.y,$e,Oe),Tl(B,_.x,_.y,ve.x,Mt+ve.y,Be.x+Be.w,Be.y,s,nt,Pe.x,Fe.y,$e,Oe),Tl(B,_.x,_.y,je.x,Mt+je.y,Be.x,Be.y+Be.h,s,nt,Fe.x,Pe.y,$e,Oe),Tl(B,_.x,_.y,Ke.x,Mt+Ke.y,Be.x+Be.w,Be.y+Be.h,s,nt,Pe.x,Pe.y,$e,Oe),Lc(e.dynamicLayoutVertexArray,_,ue),R.emplaceBack(bt,bt+1,bt+2),R.emplaceBack(bt+1,bt+2,bt+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ee[0]),ge!==n.length-1&&Je===n[ge+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,p,p.index,{},M,ce&&ce[Je])}e.placedSymbolArray.emplaceBack(_.x,_.y,X,this.glyphOffsetArray.length-X,re,w,T,_.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],m,0,!1,0,C)}_addCollisionDebugVertex(e,n,s,l,h,p){return n.emplaceBack(0,0),e.emplaceBack(s.x,s.y,l,h,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,n,s,l,h,p,m){const _=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),w=_.vertexLength,T=h.layoutVertexArray,C=h.collisionVertexArray,M=m.anchorX,R=m.anchorY;this._addCollisionDebugVertex(T,C,p,M,R,new Ve(e,n)),this._addCollisionDebugVertex(T,C,p,M,R,new Ve(s,n)),this._addCollisionDebugVertex(T,C,p,M,R,new Ve(s,l)),this._addCollisionDebugVertex(T,C,p,M,R,new Ve(e,l)),_.vertexLength+=4;const B=h.indexArray;B.emplaceBack(w,w+1),B.emplaceBack(w+1,w+2),B.emplaceBack(w+2,w+3),B.emplaceBack(w+3,w),_.primitiveLength+=4}addDebugCollisionBoxes(e,n,s,l){for(let h=e;h<n;h++){const p=this.collisionBoxArray.get(h);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,l?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bc(ln,Ou.members,Pn),this.iconCollisionBox=new Bc(ln,Ou.members,Pn);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,s,l,h,p,m,_,w){const T={};for(let C=n;C<s;C++){const M=e.get(C);T.textBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},T.textFeatureIndex=M.featureIndex;break}for(let C=l;C<h;C++){const M=e.get(C);T.verticalTextBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},T.verticalTextFeatureIndex=M.featureIndex;break}for(let C=p;C<m;C++){const M=e.get(C);T.iconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},T.iconFeatureIndex=M.featureIndex;break}for(let C=_;C<w;C++){const M=e.get(C);T.verticalIconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},T.verticalIconFeatureIndex=M.featureIndex;break}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const s=e.placedSymbolArray.get(n),l=s.vertexStartIndex+4*s.numGlyphs;for(let h=s.vertexStartIndex;h<l;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),s=Math.cos(e),l=[],h=[],p=[];for(let m=0;m<this.symbolInstances.length;++m){p.push(m);const _=this.symbolInstances.get(m);l.push(0|Math.round(n*_.anchorX+s*_.anchorY)),h.push(_.featureIndex)}return p.sort((m,_)=>l[m]-l[_]||h[_]-h[m]),p}addToSortKeyRanges(e,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((l,h,p)=>{l>=0&&p.indexOf(l)===h&&this.addIndicesForPlacedSymbol(this.text,l)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ne("SymbolBucket",bo,{omit:["layers","collisionBoxArray","features","compareText"]}),bo.MAX_GLYPHS=65535,bo.addDynamicAttributes=Lc;const ef=new hi({"symbol-placement":new He(me.layout_symbol["symbol-placement"]),"symbol-spacing":new He(me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new He(me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new it(me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new He(me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new He(me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new He(me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new He(me.layout_symbol["icon-ignore-placement"]),"icon-optional":new He(me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new He(me.layout_symbol["icon-rotation-alignment"]),"icon-size":new it(me.layout_symbol["icon-size"]),"icon-text-fit":new He(me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new He(me.layout_symbol["icon-text-fit-padding"]),"icon-image":new it(me.layout_symbol["icon-image"]),"icon-rotate":new it(me.layout_symbol["icon-rotate"]),"icon-padding":new He(me.layout_symbol["icon-padding"]),"icon-keep-upright":new He(me.layout_symbol["icon-keep-upright"]),"icon-offset":new it(me.layout_symbol["icon-offset"]),"icon-anchor":new it(me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new He(me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new He(me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new He(me.layout_symbol["text-rotation-alignment"]),"text-field":new it(me.layout_symbol["text-field"]),"text-font":new it(me.layout_symbol["text-font"]),"text-size":new it(me.layout_symbol["text-size"]),"text-max-width":new it(me.layout_symbol["text-max-width"]),"text-line-height":new He(me.layout_symbol["text-line-height"]),"text-letter-spacing":new it(me.layout_symbol["text-letter-spacing"]),"text-justify":new it(me.layout_symbol["text-justify"]),"text-radial-offset":new it(me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new He(me.layout_symbol["text-variable-anchor"]),"text-anchor":new it(me.layout_symbol["text-anchor"]),"text-max-angle":new He(me.layout_symbol["text-max-angle"]),"text-writing-mode":new He(me.layout_symbol["text-writing-mode"]),"text-rotate":new it(me.layout_symbol["text-rotate"]),"text-padding":new He(me.layout_symbol["text-padding"]),"text-keep-upright":new He(me.layout_symbol["text-keep-upright"]),"text-transform":new it(me.layout_symbol["text-transform"]),"text-offset":new it(me.layout_symbol["text-offset"]),"text-allow-overlap":new He(me.layout_symbol["text-allow-overlap"]),"text-overlap":new He(me.layout_symbol["text-overlap"]),"text-ignore-placement":new He(me.layout_symbol["text-ignore-placement"]),"text-optional":new He(me.layout_symbol["text-optional"])});var Fc={paint:new hi({"icon-opacity":new it(me.paint_symbol["icon-opacity"]),"icon-color":new it(me.paint_symbol["icon-color"]),"icon-halo-color":new it(me.paint_symbol["icon-halo-color"]),"icon-halo-width":new it(me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new it(me.paint_symbol["icon-halo-blur"]),"icon-translate":new He(me.paint_symbol["icon-translate"]),"icon-translate-anchor":new He(me.paint_symbol["icon-translate-anchor"]),"text-opacity":new it(me.paint_symbol["text-opacity"]),"text-color":new it(me.paint_symbol["text-color"],{runtimeType:Pi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new it(me.paint_symbol["text-halo-color"]),"text-halo-width":new it(me.paint_symbol["text-halo-width"]),"text-halo-blur":new it(me.paint_symbol["text-halo-blur"]),"text-translate":new He(me.paint_symbol["text-translate"]),"text-translate-anchor":new He(me.paint_symbol["text-translate-anchor"])}),layout:ef};class uh{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:$t,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ne("FormatSectionOverride",uh,{omit:["defaultValue"]});class El extends Ui{constructor(e){super(e,Fc)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const h of s)l.indexOf(h)<0&&l.push(h);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,s,l){const h=this.layout.get(e).evaluate(n,{},s,l),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Ws(p.value)||!h?h:function(m,_){return _.replace(/{([^{}]+)}/g,(w,T)=>T in m?String(m[T]):"")}(n.properties,h)}createBucket(e){return new bo(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Fc.paint.overridableProperties){if(!El.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),s=new uh(n),l=new Wo(s,n.property.specification);let h=null;h=n.value.kind==="constant"||n.value.kind==="source"?new Xs("source",l):new Ys("composite",l,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new kn(n.property,h,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&El.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const s=e.get("text-field"),l=Fc.paint.properties[n];let h=!1;const p=m=>{for(const _ of m)if(l.overrides&&l.overrides.hasOverride(_))return void(h=!0)};if(s.value.kind==="constant"&&s.value.value instanceof q)p(s.value.value.sections);else if(s.value.kind==="source"){const m=w=>{h||(w instanceof we&&ee(w.value)===mn?p(w.value.sections):w instanceof Xe?p(w.sections):w.eachChild(m))},_=s.value;_._styleExpression&&m(_._styleExpression.expression)}return h}}function Oc(i,e,n){let s="never";const l=i.get(e);return l?s=l:i.get(n)&&(s="always"),s}var tf={paint:new hi({"background-color":new He(me.paint_background["background-color"]),"background-pattern":new ws(me.paint_background["background-pattern"]),"background-opacity":new He(me.paint_background["background-opacity"])})},nf={paint:new hi({"raster-opacity":new He(me.paint_raster["raster-opacity"]),"raster-hue-rotate":new He(me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new He(me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new He(me.paint_raster["raster-brightness-max"]),"raster-saturation":new He(me.paint_raster["raster-saturation"]),"raster-contrast":new He(me.paint_raster["raster-contrast"]),"raster-resampling":new He(me.paint_raster["raster-resampling"]),"raster-fade-duration":new He(me.paint_raster["raster-fade-duration"])})};class rf extends Ui{constructor(e){super(e,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}}const sf={circle:class extends Ui{constructor(i){super(i,Bp)}createBucket(i){return new uc(i)}queryRadius(i){const e=i;return ca("circle-radius",this,e)+ca("circle-stroke-width",this,e)+hl(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,n,s,l,h,p,m){const _=pl(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,p),w=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n),T=this.paint.get("circle-pitch-alignment")==="map",C=T?_:function(R,B){return R.map(H=>vu(H,B))}(_,m),M=T?w*p:w;for(const R of s)for(const B of R){const H=T?B:vu(B,m);let X=M;const re=dl([],[B.x,B.y,0,1],m);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?X*=re[3]/h.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(X*=h.cameraToCenterDistance/re[3]),Pp(C,H,X))return!0}return!1}},heatmap:class extends Ui{constructor(i){super(i,Op),this._updateColorRamp()}createBucket(i){return new bu(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Su({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Ui{constructor(i){super(i,Up)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Ui{constructor(i){super(i,td)}recalculate(i,e){super.recalculate(i,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Sc(i)}queryRadius(){return hl(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,n,s,l,h,p){return gu(pl(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,p),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Ui{constructor(i){super(i,fd)}createBucket(i){return new Ic(i)}queryRadius(){return hl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,e,n,s,l,h,p,m){const _=pl(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,p),w=this.paint.get("fill-extrusion-height").evaluate(e,n),T=this.paint.get("fill-extrusion-base").evaluate(e,n),C=function(R,B,H,X){const re=[];for(const ue of R){const ce=[ue.x,ue.y,0,1];dl(ce,ce,B),re.push(new Ve(ce[0]/ce[3],ce[1]/ce[3]))}return re}(_,m),M=function(R,B,H,X){const re=[],ue=[],ce=X[8]*B,ge=X[9]*B,Se=X[10]*B,ve=X[11]*B,je=X[8]*H,Ke=X[9]*H,Be=X[10]*H,Fe=X[11]*H;for(const Pe of R){const $e=[],Oe=[];for(const Ee of Pe){const nt=Ee.x,Je=Ee.y,bt=X[0]*nt+X[4]*Je+X[12],Mt=X[1]*nt+X[5]*Je+X[13],Zt=X[2]*nt+X[6]*Je+X[14],Wt=X[3]*nt+X[7]*Je+X[15],Ai=Zt+Se,oi=Wt+ve,ai=bt+je,gi=Mt+Ke,Ii=Zt+Be,Di=Wt+Fe,Ji=new Ve((bt+ce)/oi,(Mt+ge)/oi);Ji.z=Ai/oi,$e.push(Ji);const li=new Ve(ai/Di,gi/Di);li.z=Ii/Di,Oe.push(li)}re.push($e),ue.push(Oe)}return[re,ue]}(s,T,w,m);return function(R,B,H){let X=1/0;gu(H,B)&&(X=Du(H,B[0]));for(let re=0;re<B.length;re++){const ue=B[re],ce=R[re];for(let ge=0;ge<ue.length-1;ge++){const Se=ue[ge],ve=[Se,ue[ge+1],ce[ge+1],ce[ge],Se];mu(H,ve)&&(X=Math.min(X,Du(H,ve)))}}return X!==1/0&&X}(M[0],M[1],C)}},line:class extends Ui{constructor(i){super(i,Ru),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof cs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Bu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Tc(i)}queryRadius(i){const e=i,n=Fu(ca("line-width",this,e),ca("line-gap-width",this,e)),s=ca("line-offset",this,e);return n/2+Math.abs(s)+hl(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,n,s,l,h,p){const m=pl(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,p),_=p/2*Fu(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),w=this.paint.get("line-offset").evaluate(e,n);return w&&(s=function(T,C){const M=[];for(let R=0;R<T.length;R++){const B=T[R],H=[];for(let X=0;X<B.length;X++){const re=B[X-1],ue=B[X],ce=B[X+1],ge=X===0?new Ve(0,0):ue.sub(re)._unit()._perp(),Se=X===B.length-1?new Ve(0,0):ce.sub(ue)._unit()._perp(),ve=ge._add(Se)._unit(),je=ve.x*Se.x+ve.y*Se.y;je!==0&&ve._mult(1/je),H.push(ve._mult(C)._add(ue))}M.push(H)}return M}(s,w*p)),function(T,C,M){for(let R=0;R<C.length;R++){const B=C[R];if(T.length>=3){for(let H=0;H<B.length;H++)if(po(T,B[H]))return!0}if(Mp(T,B,M))return!0}return!1}(m,s,_)}isTileClipped(){return!0}},symbol:El,background:class extends Ui{constructor(i){super(i,tf)}},raster:class extends Ui{constructor(i){super(i,nf)}}};class of{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const hh=63710088e-1;class Qt{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Qt(ae(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,s=this.lat*n,l=e.lat*n,h=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((e.lng-this.lng)*n);return hh*Math.acos(Math.min(h,1))}toBounds(e=0){const n=360*e/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new Cs(new Qt(this.lng-s,this.lat-n),new Qt(this.lng+s,this.lat+n))}static convert(e){if(e instanceof Qt)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Qt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Qt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Cs{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Qt?new Qt(e.lng,e.lat):Qt.convert(e),this}setSouthWest(e){return this._sw=e instanceof Qt?new Qt(e.lng,e.lat):Qt.convert(e),this}extend(e){const n=this._sw,s=this._ne;let l,h;if(e instanceof Qt)l=e,h=e;else{if(!(e instanceof Cs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Cs.convert(e)):this.extend(Qt.convert(e)):this;if(l=e._sw,h=e._ne,!l||!h)return this}return n||s?(n.lng=Math.min(l.lng,n.lng),n.lat=Math.min(l.lat,n.lat),s.lng=Math.max(h.lng,s.lng),s.lat=Math.max(h.lat,s.lat)):(this._sw=new Qt(l.lng,l.lat),this._ne=new Qt(h.lng,h.lat)),this}getCenter(){return new Qt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Qt(this.getWest(),this.getNorth())}getSouthEast(){return new Qt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:s}=Qt.convert(e);let l=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&l}static convert(e){return e instanceof Cs?e:e&&new Cs(e)}}const ph=2*Math.PI*hh;function dh(i){return ph*Math.cos(i*Math.PI/180)}function fh(i){return(180+i)/360}function mh(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function gh(i,e){return i/dh(e)}function Uc(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Cl{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){const s=Qt.convert(e);return new Cl(fh(s.lng),mh(s.lat),gh(n,s.lat))}toLngLat(){return new Qt(360*this.x-180,Uc(this.y))}toAltitude(){return this.z*dh(Uc(this.y))}meterInMercatorCoordinateUnits(){return 1/ph*(e=Uc(this.y),1/Math.cos(e*Math.PI/180));var e}}function _h(i,e,n){var s=2*Math.PI*6378137/256/Math.pow(2,n);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Vc{constructor(e,n,s){this.z=e,this.x=n,this.y=s,this.key=va(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,s){const l=(p=this.y,m=this.z,_=_h(256*(h=this.x),256*(p=Math.pow(2,m)-p-1),m),w=_h(256*(h+1),256*(p+1),m),_[0]+","+_[1]+","+w[0]+","+w[1]);var h,p,m,_,w;const T=function(C,M,R){let B,H="";for(let X=C;X>0;X--)B=1<<X-1,H+=(M&B?1:0)+(R&B?2:0);return H}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,T).replace(/{bbox-epsg-3857}/g,l)}getTilePoint(e){const n=Math.pow(2,this.z);return new Ve((e.x*n-this.x)*di,(e.y*n-this.y)*di)}toString(){return`${this.z}/${this.x}/${this.y}`}}class yh{constructor(e,n){this.wrap=e,this.canonical=n,this.key=va(e,n.z,n.z,n.x,n.y)}}class Ln{constructor(e,n,s,l,h){this.overscaledZ=e,this.wrap=n,this.canonical=new Vc(s,+l,+h),this.key=va(n,e,s,l,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new Ln(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ln(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n){const s=this.canonical.z-e;return e>this.canonical.z?va(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):va(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Ln(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new Ln(n,this.wrap,n,s,l),new Ln(n,this.wrap,n,s+1,l),new Ln(n,this.wrap,n,s,l+1),new Ln(n,this.wrap,n,s+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ln(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ln(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new yh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Cl(e.x-this.wrap,e.y))}}function va(i,e,n,s,l){(i*=2)<0&&(i=-1*i-1);const h=1<<n;return(h*h*i+h*l+s).toString(36)+n.toString(36)+e.toString(36)}Ne("CanonicalTileID",Vc),Ne("OverscaledTileID",Ln,{omit:["posMatrix"]});class xh{constructor(e,n,s){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void Ye(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const l=this.dim=n.height-2;this.data=new Uint32Array(n.data.buffer),this.encoding=s||"mapbox";for(let h=0;h<l;h++)this.data[this._idx(-1,h)]=this.data[this._idx(0,h)],this.data[this._idx(l,h)]=this.data[this._idx(l-1,h)],this.data[this._idx(h,-1)]=this.data[this._idx(h,0)],this.data[this._idx(h,l)]=this.data[this._idx(h,l-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(l,-1)]=this.data[this._idx(l-1,0)],this.data[this._idx(-1,l)]=this.data[this._idx(0,l-1)],this.data[this._idx(l,l)]=this.data[this._idx(l-1,l-1)]}get(e,n){const s=new Uint8Array(this.data.buffer),l=4*this._idx(e,n);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[l],s[l+1],s[l+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,s){return(256*e*256+256*n+s)/10-1e4}_unpackTerrarium(e,n,s){return 256*e+n+s/256-32768}getPixels(){return new xn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=n*this.dim,h=n*this.dim+this.dim,p=s*this.dim,m=s*this.dim+this.dim;switch(n){case-1:l=h-1;break;case 1:h=l+1}switch(s){case-1:p=m-1;break;case 1:m=p+1}const _=-n*this.dim,w=-s*this.dim;for(let T=p;T<m;T++)for(let C=l;C<h;C++)this.data[this._idx(C,T)]=e.data[this._idx(C+_,T+w)]}}Ne("DEMData",xh);class vh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class bh{constructor(e,n,s,l,h){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=s,e._y=l,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}class wh{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new br(di,16,0),this.grid3D=new br(di,16,0),this.featureIndexArray=new St,this.promoteId=n}insert(e,n,s,l,h,p){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,h);const _=p?this.grid3D:this.grid;for(let w=0;w<n.length;w++){const T=n[w],C=[1/0,1/0,-1/0,-1/0];for(let M=0;M<T.length;M++){const R=T[M];C[0]=Math.min(C[0],R.x),C[1]=Math.min(C[1],R.y),C[2]=Math.max(C[2],R.x),C[3]=Math.max(C[3],R.y)}C[0]<di&&C[1]<di&&C[2]>=0&&C[3]>=0&&_.insert(m,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Kr.VectorTile(new Ec(this.rawTileData)).layers,this.sourceLayerCoder=new vh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,n,s,l){this.loadVTLayers();const h=e.params||{},p=di/e.tileSize/e.scale,m=Qs(h.filter),_=e.queryGeometry,w=e.queryPadding*p,T=Ah(_),C=this.grid.query(T.minX-w,T.minY-w,T.maxX+w,T.maxY+w),M=Ah(e.cameraQueryGeometry),R=this.grid3D.query(M.minX-w,M.minY-w,M.maxX+w,M.maxY+w,(X,re,ue,ce)=>function(ge,Se,ve,je,Ke){for(const Fe of ge)if(Se<=Fe.x&&ve<=Fe.y&&je>=Fe.x&&Ke>=Fe.y)return!0;const Be=[new Ve(Se,ve),new Ve(Se,Ke),new Ve(je,Ke),new Ve(je,ve)];if(ge.length>2){for(const Fe of Be)if(po(ge,Fe))return!0}for(let Fe=0;Fe<ge.length-1;Fe++)if(Lp(ge[Fe],ge[Fe+1],Be))return!0;return!1}(e.cameraQueryGeometry,X-w,re-w,ue+w,ce+w));for(const X of R)C.push(X);C.sort(af);const B={};let H;for(let X=0;X<C.length;X++){const re=C[X];if(re===H)continue;H=re;const ue=this.featureIndexArray.get(re);let ce=null;this.loadMatchingFeature(B,ue.bucketIndex,ue.sourceLayerIndex,ue.featureIndex,m,h.layers,h.availableImages,n,s,l,(ge,Se,ve)=>(ce||(ce=Ts(ge)),Se.queryIntersectsFeature(_,ge,ve,ce,this.z,e.transform,p,e.pixelPosMatrix)))}return B}loadMatchingFeature(e,n,s,l,h,p,m,_,w,T,C){const M=this.bucketLayerIDs[n];if(p&&!function(X,re){for(let ue=0;ue<X.length;ue++)if(re.indexOf(X[ue])>=0)return!0;return!1}(p,M))return;const R=this.sourceLayerCoder.decode(s),B=this.vtLayers[R].feature(l);if(h.needGeometry){const X=Es(B,!0);if(!h.filter(new qt(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!h.filter(new qt(this.tileID.overscaledZ),B))return;const H=this.getId(B,R);for(let X=0;X<M.length;X++){const re=M[X];if(p&&p.indexOf(re)<0)continue;const ue=_[re];if(!ue)continue;let ce={};H&&T&&(ce=T.getState(ue.sourceLayer||"_geojsonTileLayer",H));const ge=le({},w[re]);ge.paint=Sh(ge.paint,ue.paint,B,ce,m),ge.layout=Sh(ge.layout,ue.layout,B,ce,m);const Se=!C||C(B,ue,ce);if(!Se)continue;const ve=new bh(B,this.z,this.x,this.y,H);ve.layer=ge;let je=e[re];je===void 0&&(je=e[re]=[]),je.push({featureIndex:l,feature:ve,intersectionZ:Se})}}lookupSymbolFeatures(e,n,s,l,h,p,m,_){const w={};this.loadVTLayers();const T=Qs(h);for(const C of e)this.loadMatchingFeature(w,s,l,C,T,p,m,_,n);return w}hasLayer(e){for(const n of this.bucketLayerIDs)for(const s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof s=="boolean"&&(s=Number(s))),s}}function Sh(i,e,n,s,l){return We(i,(h,p)=>{const m=e instanceof ao?e.get(p):null;return m&&m.evaluate?m.evaluate(n,s,l):m})}function Ah(i){let e=1/0,n=1/0,s=-1/0,l=-1/0;for(const h of i)e=Math.min(e,h.x),n=Math.min(n,h.y),s=Math.max(s,h.x),l=Math.max(l,h.y);return{minX:e,minY:n,maxX:s,maxY:l}}function af(i,e){return e-i}var $c;Ne("FeatureIndex",wh,{omit:["rawTileData","sourceLayerCoder"]}),o.PerformanceMarkers=void 0,($c=o.PerformanceMarkers||(o.PerformanceMarkers={})).create="create",$c.load="load",$c.fullLoad="fullLoad";let zl=null,ba=[];const Nc=1e3/30,lf={mark(i){performance.mark(i)},frame(i){const e=i;zl!=null&&ba.push(e-zl),zl=e},clearMetrics(){zl=null,ba=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in o.PerformanceMarkers)performance.clearMarks(o.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.load),performance.measure("fullLoadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,n=ba.length,s=1/(ba.reduce((h,p)=>h+p,0)/n/1e3),l=ba.filter(h=>h>Nc).reduce((h,p)=>h+(p-Nc)/Nc,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:l/(n+l)*100}}};o.AJAXError=fi,o.ARRAY_TYPE=fo,o.Actor=class{constructor(i,e,n){this.target=i,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ce(["receive","process"],this),this.invoker=new of(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=At()?i:window}send(i,e,n,s,l=!1){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[h]=n);const p=In(this.globalScope)?void 0:[];return this.target.postMessage({id:h,type:i,hasCallback:!!n,targetMapId:s,mustQueue:l,sourceMapId:this.mapId,data:ys(e,p)},p),{cancel:()=>{n&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(i){const e=i.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[n];const s=this.cancelCallbacks[n];delete this.cancelCallbacks[n],s&&s()}else At()||e.mustQueue?(this.tasks[n]=e,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,e)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){if(e.type==="<response>"){const n=this.callbacks[i];delete this.callbacks[i],n&&(e.error?n(wr(e.error)):n(null,wr(e.data)))}else{let n=!1;const s=In(this.globalScope)?void 0:[],l=e.hasCallback?(m,_)=>{n=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:m?ys(m):null,data:ys(_,s)},s)}:m=>{n=!0};let h=null;const p=wr(e.data);if(this.parent[e.type])h=this.parent[e.type](e.sourceMapId,p,l);else if(this.parent.getWorkerSource){const m=e.type.split(".");h=this.parent.getWorkerSource(e.sourceMapId,m[0],p.source)[m[1]](p,l)}else l(new Error(`Could not find function ${e.type}`));!n&&h&&h.cancel&&(this.cancelCallbacks[i]=h.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.AlphaImage=ha,o.CanonicalTileID=Vc,o.CollisionBoxArray=pe,o.CollisionCircleLayoutArray=class extends I{},o.Color=E,o.DEMData=xh,o.DataConstantProperty=He,o.DictionaryCoder=vh,o.EXTENT=di,o.ErrorEvent=hr,o.EvaluationParameters=qt,o.Event=tr,o.Evented=ss,o.FeatureIndex=wh,o.FillBucket=Sc,o.FillExtrusionBucket=Ic,o.GeoJSONFeature=bh,o.ImageAtlas=Zu,o.ImagePosition=zc,o.LineBucket=Tc,o.LineStripIndexArray=class extends oe{},o.LngLat=Qt,o.LngLatBounds=Cs,o.MercatorCoordinate=Cl,o.ONE_EM=bi,o.OverscaledTileID=Ln,o.PerformanceUtils=lf,o.PosArray=class extends Wr{},o.Properties=hi,o.QuadTriangleArray=class extends L{},o.RGBAImage=xn,o.RasterBoundsArray=class extends As{},o.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},o.ResourceType=Ds,o.SegmentVector=Et,o.SymbolBucket=bo,o.Transitionable=sa,o.TriangleIndexArray=Vi,o.Uniform1f=Hr,o.Uniform1i=class extends Dn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends Dn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},o.Uniform3f=class extends Dn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},o.Uniform4f=uu,o.UniformColor=hu,o.UniformMatrix4f=class extends Dn{constructor(i,e){super(i,e),this.current=zp}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},o.UnwrappedTileID=yh,o.ValidationError=Le,o.ZoomHistory=xs,o.addDynamicAttributes=Lc,o.asyncAll=function(i,e,n){if(!i.length)return n(null,[]);let s=i.length;const l=new Array(i.length);let h=null;i.forEach((p,m)=>{e(p,(_,w)=>{_&&(h=_),l[m]=w,--s==0&&n(h,l)})})},o.bezier=se,o.bindAll=Ce,o.cacheEntryPossiblyAdded=function(i){lr++,lr>$n&&(i.getActor().send("enforceCacheSizeLimit",ar),lr=0)},o.clamp=j,o.clearTileCache=function(i){const e=caches.delete(Jn);i&&e.catch(i).then(()=>i())},o.clipLine=rh,o.clone=function(i){var e=new fo(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},o.clone$1=ft,o.collisionCircleLayout=Id,o.config=Kn,o.create=function(){var i=new fo(16);return fo!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o.createExpression=Hs,o.createFilter=Qs,o.createLayout=pi,o.createStyleLayer=function(i){return i.type==="custom"?new rf(i):new sf[i.type](i)},o.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},o.ease=K,o.emitValidationErrors=tl,o.enforceCacheSizeLimit=function(i){Qn(),pn&&pn.then(e=>{e.keys().then(n=>{for(let s=0;s<n.length-i;s++)e.delete(n[s])})})},o.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:l}){return i.kind==="source"?s/zr:i.kind==="composite"?ri(s/zr,l/zr,n):e},o.evaluateSizeForZoom=function(i,e){let n=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:h,maxZoom:p}=i,m=l?j(Hi.interpolationFactor(l,e,h,p),0,1):0;i.kind==="camera"?s=ri(i.minSize,i.maxSize,m):n=m}return{uSizeT:n,uSize:s}},o.evaluateVariableOffset=ah,o.evented=Zr,o.exported=Tn,o.exported$1=dn,o.extend=le,o.filterObject=kt,o.getAnchorAlignment=Pc,o.getAnchorJustification=Dc,o.getArrayBuffer=En,o.getImage=rs,o.getJSON=function(i,e){return cr(le(i,{type:"json"}),e)},o.getOverlapMode=Oc,o.getRTLTextPluginStatus=ra,o.getReferrer=er,o.getVideo=function(i,e){const n=window.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<i.length;s++){const l=window.document.createElement("source");Ls(i[s])||(n.crossOrigin="Anonymous"),l.src=i[s],n.appendChild(l)}return{cancel:()=>{}}},o.identity=dc,o.invert=function(i,e){var n=e[0],s=e[1],l=e[2],h=e[3],p=e[4],m=e[5],_=e[6],w=e[7],T=e[8],C=e[9],M=e[10],R=e[11],B=e[12],H=e[13],X=e[14],re=e[15],ue=n*m-s*p,ce=n*_-l*p,ge=n*w-h*p,Se=s*_-l*m,ve=s*w-h*m,je=l*w-h*_,Ke=T*H-C*B,Be=T*X-M*B,Fe=T*re-R*B,Pe=C*X-M*H,$e=C*re-R*H,Oe=M*re-R*X,Ee=ue*Oe-ce*$e+ge*Pe+Se*Fe-ve*Be+je*Ke;return Ee?(i[0]=(m*Oe-_*$e+w*Pe)*(Ee=1/Ee),i[1]=(l*$e-s*Oe-h*Pe)*Ee,i[2]=(H*je-X*ve+re*Se)*Ee,i[3]=(M*ve-C*je-R*Se)*Ee,i[4]=(_*Fe-p*Oe-w*Be)*Ee,i[5]=(n*Oe-l*Fe+h*Be)*Ee,i[6]=(X*ge-B*je-re*ce)*Ee,i[7]=(T*je-M*ge+R*ce)*Ee,i[8]=(p*$e-m*Fe+w*Ke)*Ee,i[9]=(s*Fe-n*$e-h*Ke)*Ee,i[10]=(B*ve-H*ge+re*ue)*Ee,i[11]=(C*ge-T*ve-R*ue)*Ee,i[12]=(m*Be-p*Pe-_*Ke)*Ee,i[13]=(n*Pe-s*Be+l*Ke)*Ee,i[14]=(H*ce-B*Se-X*ue)*Ee,i[15]=(T*Se-C*ce+M*ue)*Ee,i):null},o.isImageBitmap=Wi,o.isSafari=In,o.keysDifference=function(i,e){const n=[];for(const s in i)s in e||n.push(s);return n},o.lazyLoadRTLTextPlugin=function(){on.isLoading()||on.isLoaded()||ra()!=="deferred"||ro()},o.makeRequest=cr,o.mapObject=We,o.mercatorXfromLng=fh,o.mercatorYfromLat=mh,o.mercatorZfromAltitude=gh,o.mul=Fp,o.multiply=xu,o.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},o.number=ri,o.ortho=function(i,e,n,s,l,h,p){var m=1/(e-n),_=1/(s-l),w=1/(h-p);return i[0]=-2*m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*w,i[11]=0,i[12]=(e+n)*m,i[13]=(l+s)*_,i[14]=(p+h)*w,i[15]=1,i},o.parseCacheControl=Vt,o.parseGlyphPBF=function(i){return new Ec(i).readFields(Bd,[])},o.pbf=Ec,o.performSymbolLayout=function(i,e,n,s,l,h,p){i.createArrays(),i.tilePixelRatio=di/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const m=i.layers[0].layout,_=i.layers[0]._unevaluatedLayout._values,w={layoutIconSize:_["icon-size"].possiblyEvaluate(new qt(i.zoom+1),p),layoutTextSize:_["text-size"].possiblyEvaluate(new qt(i.zoom+1),p),textMaxSize:_["text-size"].possiblyEvaluate(new qt(18))};if(i.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:H}=i.textSizeData;w.compositeTextSizes=[_["text-size"].possiblyEvaluate(new qt(B),p),_["text-size"].possiblyEvaluate(new qt(H),p)]}if(i.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:H}=i.iconSizeData;w.compositeIconSizes=[_["icon-size"].possiblyEvaluate(new qt(B),p),_["icon-size"].possiblyEvaluate(new qt(H),p)]}const T=m.get("text-line-height")*bi,C=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point",M=m.get("text-keep-upright"),R=m.get("text-size");for(const B of i.features){const H=m.get("text-font").evaluate(B,{},p).join(","),X=R.evaluate(B,{},p),re=w.layoutTextSize.evaluate(B,{},p),ue=w.layoutIconSize.evaluate(B,{},p),ce={horizontal:{},vertical:void 0},ge=B.text;let Se,ve=[0,0];if(ge){const Be=ge.toString(),Fe=m.get("text-letter-spacing").evaluate(B,{},p)*bi,Pe=il(Be)?Fe:0,$e=m.get("text-anchor").evaluate(B,{},p),Oe=m.get("text-variable-anchor");if(!Oe){const Mt=m.get("text-radial-offset").evaluate(B,{},p);ve=Mt?ah($e,[Mt*bi,Mc]):m.get("text-offset").evaluate(B,{},p).map(Zt=>Zt*bi)}let Ee=C?"center":m.get("text-justify").evaluate(B,{},p);const nt=m.get("symbol-placement"),Je=nt==="point"?m.get("text-max-width").evaluate(B,{},p)*bi:0,bt=()=>{i.allowVerticalPlacement&&Qo(Be)&&(ce.vertical=vl(ge,e,n,l,H,Je,T,$e,"left",Pe,ve,o.WritingMode.vertical,!0,nt,re,X))};if(!C&&Oe){const Mt=Ee==="auto"?Oe.map(Wt=>Dc(Wt)):[Ee];let Zt=!1;for(let Wt=0;Wt<Mt.length;Wt++){const Ai=Mt[Wt];if(!ce.horizontal[Ai])if(Zt)ce.horizontal[Ai]=ce.horizontal[0];else{const oi=vl(ge,e,n,l,H,Je,T,"center",Ai,Pe,ve,o.WritingMode.horizontal,!1,nt,re,X);oi&&(ce.horizontal[Ai]=oi,Zt=oi.positionedLines.length===1)}}bt()}else{Ee==="auto"&&(Ee=Dc($e));const Mt=vl(ge,e,n,l,H,Je,T,$e,Ee,Pe,ve,o.WritingMode.horizontal,!1,nt,re,X);Mt&&(ce.horizontal[Ee]=Mt),bt(),Qo(Be)&&C&&M&&(ce.vertical=vl(ge,e,n,l,H,Je,T,$e,Ee,Pe,ve,o.WritingMode.vertical,!1,nt,re,X))}}let je=!1;if(B.icon&&B.icon.name){const Be=s[B.icon.name];Be&&(Se=Nd(l[B.icon.name],m.get("icon-offset").evaluate(B,{},p),m.get("icon-anchor").evaluate(B,{},p)),je=!!Be.sdf,i.sdfIcons===void 0?i.sdfIcons=je:i.sdfIcons!==je&&Ye("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Be.pixelRatio!==i.pixelRatio||m.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Ke=ch(ce.horizontal)||ce.vertical;i.iconsInText=!!Ke&&Ke.iconsInText,(Ke||Se)&&Xd(i,B,ce,Se,s,w,re,ue,ve,je,p)}h&&i.generateCollisionDebugBuffers()},o.perspective=function(i,e,n,s,l){var h,p=1/Math.tan(e/2);return i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+s)*(h=1/(s-l)),i[14]=2*l*s*h):(i[10]=-1,i[14]=-2*s),i},o.pick=function(i,e){const n={};for(let s=0;s<e.length;s++){const l=e[s];l in i&&(n[l]=i[l])}return n},o.plugin=on,o.pointGeometry=Ve,o.polygonIntersectsPolygon=mu,o.potpack=Gu,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.register=Ne,o.registerForPluginStateChange=function(i){return i({pluginStatus:Oi,pluginURL:ir}),Zr.on("pluginStateChange",i),i},o.renderColorRamp=Su,o.rotateX=function(i,e,n){var s=Math.sin(n),l=Math.cos(n),h=e[4],p=e[5],m=e[6],_=e[7],w=e[8],T=e[9],C=e[10],M=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=h*l+w*s,i[5]=p*l+T*s,i[6]=m*l+C*s,i[7]=_*l+M*s,i[8]=w*l-h*s,i[9]=T*l-p*s,i[10]=C*l-m*s,i[11]=M*l-_*s,i},o.rotateZ=function(i,e,n){var s=Math.sin(n),l=Math.cos(n),h=e[0],p=e[1],m=e[2],_=e[3],w=e[4],T=e[5],C=e[6],M=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*l+w*s,i[1]=p*l+T*s,i[2]=m*l+C*s,i[3]=_*l+M*s,i[4]=w*l-h*s,i[5]=T*l-p*s,i[6]=C*l-m*s,i[7]=M*l-_*s,i},o.scale=function(i,e,n){var s=n[0],l=n[1],h=n[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*h,i[9]=e[9]*h,i[10]=e[10]*h,i[11]=e[11]*h,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},o.scale$1=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},o.setCacheLimits=function(i,e){ar=i,$n=e},o.setRTLTextPlugin=function(i,e,n=!1){if(Oi===no||Oi===ea||Oi===ta)throw new Error("setRTLTextPlugin cannot be called multiple times.");ir=Tn.resolveURL(i),Oi=no,ia=e,na(),n||ro()},o.spec=me,o.sphericalToCartesian=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}},o.toEvaluationFeature=Es,o.transformMat4=dl,o.translate=function(i,e,n){var s,l,h,p,m,_,w,T,C,M,R,B,H=n[0],X=n[1],re=n[2];return e===i?(i[12]=e[0]*H+e[4]*X+e[8]*re+e[12],i[13]=e[1]*H+e[5]*X+e[9]*re+e[13],i[14]=e[2]*H+e[6]*X+e[10]*re+e[14],i[15]=e[3]*H+e[7]*X+e[11]*re+e[15]):(l=e[1],h=e[2],p=e[3],m=e[4],_=e[5],w=e[6],T=e[7],C=e[8],M=e[9],R=e[10],B=e[11],i[0]=s=e[0],i[1]=l,i[2]=h,i[3]=p,i[4]=m,i[5]=_,i[6]=w,i[7]=T,i[8]=C,i[9]=M,i[10]=R,i[11]=B,i[12]=s*H+m*X+C*re+e[12],i[13]=l*H+_*X+M*re+e[13],i[14]=h*H+w*X+R*re+e[14],i[15]=p*H+T*X+B*re+e[15]),i},o.triggerPluginCompletionEvent=sl,o.unicodeBlockLookup=De,o.uniqueId=function(){return ze++},o.validateCustomStyleLayer=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateLight=tc,o.validateStyle=vr,o.vectorTile=Kr,o.warnOnce=Ye,o.wrap=ae}),A(["./shared"],function(o){function V($){const S=typeof $;if(S==="number"||S==="boolean"||S==="string"||$==null)return JSON.stringify($);if(Array.isArray($)){let N="[";for(const q of $)N+=`${V(q)},`;return`${N}]`}const E=Object.keys($).sort();let F="{";for(let N=0;N<E.length;N++)F+=`${JSON.stringify(E[N])}:${V($[E[N]])},`;return`${F}}`}function G($){let S="";for(const E of o.refProperties)S+=`/${V($[E])}`;return S}class se{constructor(S){this.keyCache={},S&&this.replace(S)}replace(S){this._layerConfigs={},this._layers={},this.update(S,[])}update(S,E){for(const N of S){this._layerConfigs[N.id]=N;const q=this._layers[N.id]=o.createStyleLayer(N);q._featureFilter=o.createFilter(q.filter),this.keyCache[N.id]&&delete this.keyCache[N.id]}for(const N of E)delete this.keyCache[N],delete this._layerConfigs[N],delete this._layers[N];this.familiesBySource={};const F=function(N,q){const Q={};for(let J=0;J<N.length;J++){const ee=q&&q[N[J].id]||G(N[J]);q&&(q[N[J].id]=ee);let de=Q[ee];de||(de=Q[ee]=[]),de.push(N[J])}const Y=[];for(const J in Q)Y.push(Q[J]);return Y}(Object.values(this._layerConfigs),this.keyCache);for(const N of F){const q=N.map(we=>this._layers[we.id]),Q=q[0];if(Q.visibility==="none")continue;const Y=Q.source||"";let J=this.familiesBySource[Y];J||(J=this.familiesBySource[Y]={});const ee=Q.sourceLayer||"_geojsonTileLayer";let de=J[ee];de||(de=J[ee]=[]),de.push(q)}}}class K{constructor(S){const E={},F=[];for(const Y in S){const J=S[Y],ee=E[Y]={};for(const de in J){const we=J[+de];if(!we||we.bitmap.width===0||we.bitmap.height===0)continue;const he={x:0,y:0,w:we.bitmap.width+2,h:we.bitmap.height+2};F.push(he),ee[de]={rect:he,metrics:we.metrics}}}const{w:N,h:q}=o.potpack(F),Q=new o.AlphaImage({width:N||1,height:q||1});for(const Y in S){const J=S[Y];for(const ee in J){const de=J[+ee];if(!de||de.bitmap.width===0||de.bitmap.height===0)continue;const we=E[Y][ee].rect;o.AlphaImage.copy(de.bitmap,Q,{x:0,y:0},{x:we.x+1,y:we.y+1},de.bitmap)}}this.image=Q,this.positions=E}}o.register("GlyphAtlas",K);class j{constructor(S){this.tileID=new o.OverscaledTileID(S.tileID.overscaledZ,S.tileID.wrap,S.tileID.canonical.z,S.tileID.canonical.x,S.tileID.canonical.y),this.uid=S.uid,this.zoom=S.zoom,this.pixelRatio=S.pixelRatio,this.tileSize=S.tileSize,this.source=S.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=S.showCollisionBoxes,this.collectResourceTiming=!!S.collectResourceTiming,this.returnDependencies=!!S.returnDependencies,this.promoteId=S.promoteId}parse(S,E,F,N,q){this.status="parsing",this.data=S,this.collisionBoxArray=new o.CollisionBoxArray;const Q=new o.DictionaryCoder(Object.keys(S.layers).sort()),Y=new o.FeatureIndex(this.tileID,this.promoteId);Y.bucketLayerIDs=[];const J={},ee={featureIndex:Y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:F},de=E.familiesBySource[this.source];for(const mt in de){const pt=S.layers[mt];if(!pt)continue;pt.version===1&&o.warnOnce(`Vector tile source "${this.source}" layer "${mt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ct=Q.encode(mt),ei=[];for(let Kt=0;Kt<pt.length;Kt++){const mi=pt.feature(Kt),xi=Y.getId(mi,mt);ei.push({feature:mi,id:xi,index:Kt,sourceLayerIndex:ct})}for(const Kt of de[mt]){const mi=Kt[0];mi.minzoom&&this.zoom<Math.floor(mi.minzoom)||mi.maxzoom&&this.zoom>=mi.maxzoom||mi.visibility!=="none"&&(ae(Kt,this.zoom,F),(J[mi.id]=mi.createBucket({index:Y.bucketLayerIDs.length,layers:Kt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ct,sourceID:this.source})).populate(ei,ee,this.tileID.canonical),Y.bucketLayerIDs.push(Kt.map(xi=>xi.id)))}}let we,he,Ge,Ue;const Xe=o.mapObject(ee.glyphDependencies,mt=>Object.keys(mt).map(Number));Object.keys(Xe).length?N.send("getGlyphs",{uid:this.uid,stacks:Xe},(mt,pt)=>{we||(we=mt,he=pt,xt.call(this))}):he={};const tt=Object.keys(ee.iconDependencies);tt.length?N.send("getImages",{icons:tt,source:this.source,tileID:this.tileID,type:"icons"},(mt,pt)=>{we||(we=mt,Ge=pt,xt.call(this))}):Ge={};const It=Object.keys(ee.patternDependencies);function xt(){if(we)return q(we);if(he&&Ge&&Ue){const mt=new K(he),pt=new o.ImageAtlas(Ge,Ue);for(const ct in J){const ei=J[ct];ei instanceof o.SymbolBucket?(ae(ei.layers,this.zoom,F),o.performSymbolLayout(ei,he,mt.positions,Ge,pt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ei.hasPattern&&(ei instanceof o.LineBucket||ei instanceof o.FillBucket||ei instanceof o.FillExtrusionBucket)&&(ae(ei.layers,this.zoom,F),ei.addFeatures(ee,this.tileID.canonical,pt.patternPositions))}this.status="done",q(null,{buckets:Object.values(J).filter(ct=>!ct.isEmpty()),featureIndex:Y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:mt.image,imageAtlas:pt,glyphMap:this.returnDependencies?he:null,iconMap:this.returnDependencies?Ge:null,glyphPositions:this.returnDependencies?mt.positions:null})}}It.length?N.send("getImages",{icons:It,source:this.source,tileID:this.tileID,type:"patterns"},(mt,pt)=>{we||(we=mt,Ue=pt,xt.call(this))}):Ue={},xt.call(this)}}function ae($,S,E){const F=new o.EvaluationParameters(S);for(const N of $)N.recalculate(F,E)}function le($,S){const E=o.getArrayBuffer($.request,(F,N,q,Q)=>{F?S(F):N&&S(null,{vectorTile:new o.vectorTile.VectorTile(new o.pbf(N)),rawData:N,cacheControl:q,expires:Q})});return()=>{E.cancel(),S()}}class ze{constructor(S,E,F,N){this.actor=S,this.layerIndex=E,this.availableImages=F,this.loadVectorData=N||le,this.loading={},this.loaded={}}loadTile(S,E){const F=S.uid;this.loading||(this.loading={});const N=!!(S&&S.request&&S.request.collectResourceTiming)&&new o.RequestPerformance(S.request),q=this.loading[F]=new j(S);q.abort=this.loadVectorData(S,(Q,Y)=>{if(delete this.loading[F],Q||!Y)return q.status="done",this.loaded[F]=q,E(Q);const J=Y.rawData,ee={};Y.expires&&(ee.expires=Y.expires),Y.cacheControl&&(ee.cacheControl=Y.cacheControl);const de={};if(N){const we=N.finish();we&&(de.resourceTiming=JSON.parse(JSON.stringify(we)))}q.vectorTile=Y.vectorTile,q.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,(we,he)=>{if(we||!he)return E(we);E(null,o.extend({rawTileData:J.slice(0)},he,ee,de))}),this.loaded=this.loaded||{},this.loaded[F]=q})}reloadTile(S,E){const F=this.loaded,N=S.uid,q=this;if(F&&F[N]){const Q=F[N];Q.showCollisionBoxes=S.showCollisionBoxes;const Y=(J,ee)=>{const de=Q.reloadCallback;de&&(delete Q.reloadCallback,Q.parse(Q.vectorTile,q.layerIndex,this.availableImages,q.actor,de)),E(J,ee)};Q.status==="parsing"?Q.reloadCallback=Y:Q.status==="done"&&(Q.vectorTile?Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,Y):Y())}}abortTile(S,E){const F=this.loading,N=S.uid;F&&F[N]&&F[N].abort&&(F[N].abort(),delete F[N]),E()}removeTile(S,E){const F=this.loaded,N=S.uid;F&&F[N]&&delete F[N],E()}}class Ce{constructor(){this.loaded={}}loadTile(S,E){const{uid:F,encoding:N,rawImageData:q}=S,Q=o.isImageBitmap(q)?this.getImageData(q):q,Y=new o.DEMData(F,Q,N);this.loaded=this.loaded||{},this.loaded[F]=Y,E(null,Y)}getImageData(S){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(S.width,S.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=S.width,this.offscreenCanvas.height=S.height,this.offscreenCanvasContext.drawImage(S,0,0,S.width,S.height);const E=this.offscreenCanvasContext.getImageData(-1,-1,S.width+2,S.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:E.width,height:E.height},E.data)}removeTile(S){const E=this.loaded,F=S.uid;E&&E[F]&&delete E[F]}}var We=function $(S,E){var F,N=S&&S.type;if(N==="FeatureCollection")for(F=0;F<S.features.length;F++)$(S.features[F],E);else if(N==="GeometryCollection")for(F=0;F<S.geometries.length;F++)$(S.geometries[F],E);else if(N==="Feature")$(S.geometry,E);else if(N==="Polygon")kt(S.coordinates,E);else if(N==="MultiPolygon")for(F=0;F<S.coordinates.length;F++)kt(S.coordinates[F],E);return S};function kt($,S){if($.length!==0){ft($[0],S);for(var E=1;E<$.length;E++)ft($[E],!S)}}function ft($,S){for(var E=0,F=0,N=0,q=$.length,Q=q-1;N<q;Q=N++){var Y=($[N][0]-$[Q][0])*($[Q][1]+$[N][1]),J=E+Y;F+=Math.abs(E)>=Math.abs(Y)?E-J+Y:Y-J+E,E=J}E+F>=0!=!!S&&$.reverse()}const st=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ye{constructor(S){this._feature=S,this.extent=o.EXTENT,this.type=S.type,this.properties=S.tags,"id"in S&&!isNaN(S.id)&&(this.id=parseInt(S.id,10))}loadGeometry(){if(this._feature.type===1){const S=[];for(const E of this._feature.geometry)S.push([new o.pointGeometry(E[0],E[1])]);return S}{const S=[];for(const E of this._feature.geometry){const F=[];for(const N of E)F.push(new o.pointGeometry(N[0],N[1]));S.push(F)}return S}}toGeoJSON(S,E,F){return st.call(this,S,E,F)}}class Te{constructor(S){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=S.length,this._features=S}feature(S){return new Ye(this._features[S])}}var rt={exports:{}},At=o.pointGeometry,Vt=o.vectorTile.VectorTileFeature,Vn=zi;function zi($,S){this.options=S||{},this.features=$,this.length=$.length}function hn($,S){this.id=typeof $.id=="number"?$.id:void 0,this.type=$.type,this.rawGeometry=$.type===1?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=S||4096}zi.prototype.feature=function($){return new hn(this.features[$],this.options.extent)},hn.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var S=0;S<$.length;S++){for(var E=$[S],F=[],N=0;N<E.length;N++)F.push(new At(E[N][0],E[N][1]));this.geometry.push(F)}return this.geometry},hn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,S=1/0,E=-1/0,F=1/0,N=-1/0,q=0;q<$.length;q++)for(var Q=$[q],Y=0;Y<Q.length;Y++){var J=Q[Y];S=Math.min(S,J.x),E=Math.max(E,J.x),F=Math.min(F,J.y),N=Math.max(N,J.y)}return[S,F,E,N]},hn.prototype.toGeoJSON=Vt.prototype.toGeoJSON;var In=o.pbf,Wi=Vn;function Tn($){var S=new In;return function(E,F){for(var N in E.layers)F.writeMessage(3,Ve,E.layers[N])}($,S),S.finish()}function Ve($,S){var E;S.writeVarintField(15,$.version||1),S.writeStringField(1,$.name||""),S.writeVarintField(5,$.extent||4096);var F={keys:[],values:[],keycache:{},valuecache:{}};for(E=0;E<$.length;E++)F.feature=$.feature(E),S.writeMessage(2,Ht,F);var N=F.keys;for(E=0;E<N.length;E++)S.writeStringField(3,N[E]);var q=F.values;for(E=0;E<q.length;E++)S.writeMessage(4,ar,q[E])}function Ht($,S){var E=$.feature;E.id!==void 0&&S.writeVarintField(1,E.id),S.writeMessage(2,Kn,$),S.writeVarintField(3,E.type),S.writeMessage(4,or,E)}function Kn($,S){var E=$.feature,F=$.keys,N=$.values,q=$.keycache,Q=$.valuecache;for(var Y in E.properties){var J=E.properties[Y],ee=q[Y];if(J!==null){ee===void 0&&(F.push(Y),q[Y]=ee=F.length-1),S.writeVarint(ee);var de=typeof J;de!=="string"&&de!=="boolean"&&de!=="number"&&(J=JSON.stringify(J));var we=de+":"+J,he=Q[we];he===void 0&&(N.push(J),Q[we]=he=N.length-1),S.writeVarint(he)}}}function Jn($,S){return(S<<3)+(7&$)}function pn($){return $<<1^$>>31}function or($,S){for(var E=$.loadGeometry(),F=$.type,N=0,q=0,Q=E.length,Y=0;Y<Q;Y++){var J=E[Y],ee=1;F===1&&(ee=J.length),S.writeVarint(Jn(1,ee));for(var de=F===3?J.length-1:J.length,we=0;we<de;we++){we===1&&F!==1&&S.writeVarint(Jn(2,de-1));var he=J[we].x-N,Ge=J[we].y-q;S.writeVarint(pn(he)),S.writeVarint(pn(Ge)),N+=he,q+=Ge}F===3&&S.writeVarint(Jn(7,1))}}function ar($,S){var E=typeof $;E==="string"?S.writeStringField(1,$):E==="boolean"?S.writeBooleanField(7,$):E==="number"&&($%1!=0?S.writeDoubleField(3,$):$<0?S.writeSVarintField(6,$):S.writeVarintField(5,$))}rt.exports=Tn,rt.exports.fromVectorTileJs=Tn,rt.exports.fromGeojsonVt=function($,S){S=S||{};var E={};for(var F in $)E[F]=new Wi($[F].features,S),E[F].name=F,E[F].version=S.version,E[F].extent=S.extent;return Tn({layers:E})},rt.exports.GeoJSONWrapper=Wi;var $n=rt.exports;function Qn($,S,E,F,N,q){if(N-F<=E)return;const Q=F+N>>1;lr($,S,Q,F,N,q%2),Qn($,S,E,F,Q-1,q+1),Qn($,S,E,Q+1,N,q+1)}function lr($,S,E,F,N,q){for(;N>F;){if(N-F>600){const ee=N-F+1,de=E-F+1,we=Math.log(ee),he=.5*Math.exp(2*we/3),Ge=.5*Math.sqrt(we*he*(ee-he)/ee)*(de-ee/2<0?-1:1);lr($,S,E,Math.max(F,Math.floor(E-de*he/ee+Ge)),Math.min(N,Math.floor(E+(ee-de)*he/ee+Ge)),q)}const Q=S[2*E+q];let Y=F,J=N;for(dn($,S,F,E),S[2*N+q]>Q&&dn($,S,F,N);Y<J;){for(dn($,S,Y,J),Y++,J--;S[2*Y+q]<Q;)Y++;for(;S[2*J+q]>Q;)J--}S[2*F+q]===Q?dn($,S,F,J):(J++,dn($,S,J,N)),J<=E&&(F=J+1),E<=J&&(N=J-1)}}function dn($,S,E,F){Nn($,E,F),Nn(S,2*E,2*F),Nn(S,2*E+1,2*F+1)}function Nn($,S,E){const F=$[S];$[S]=$[E],$[E]=F}function jn($,S,E,F){const N=$-E,q=S-F;return N*N+q*q}const Dr=$=>$[0],Ms=$=>$[1];class is{constructor(S,E=Dr,F=Ms,N=64,q=Float64Array){this.nodeSize=N,this.points=S;const Q=S.length<65536?Uint16Array:Uint32Array,Y=this.ids=new Q(S.length),J=this.coords=new q(2*S.length);for(let ee=0;ee<S.length;ee++)Y[ee]=ee,J[2*ee]=E(S[ee]),J[2*ee+1]=F(S[ee]);Qn(Y,J,N,0,Y.length-1,0)}range(S,E,F,N){return function(q,Q,Y,J,ee,de,we){const he=[0,q.length-1,0],Ge=[];let Ue,Xe;for(;he.length;){const tt=he.pop(),It=he.pop(),xt=he.pop();if(It-xt<=we){for(let ct=xt;ct<=It;ct++)Ue=Q[2*ct],Xe=Q[2*ct+1],Ue>=Y&&Ue<=ee&&Xe>=J&&Xe<=de&&Ge.push(q[ct]);continue}const mt=Math.floor((xt+It)/2);Ue=Q[2*mt],Xe=Q[2*mt+1],Ue>=Y&&Ue<=ee&&Xe>=J&&Xe<=de&&Ge.push(q[mt]);const pt=(tt+1)%2;(tt===0?Y<=Ue:J<=Xe)&&(he.push(xt),he.push(mt-1),he.push(pt)),(tt===0?ee>=Ue:de>=Xe)&&(he.push(mt+1),he.push(It),he.push(pt))}return Ge}(this.ids,this.coords,S,E,F,N,this.nodeSize)}within(S,E,F){return function(N,q,Q,Y,J,ee){const de=[0,N.length-1,0],we=[],he=J*J;for(;de.length;){const Ge=de.pop(),Ue=de.pop(),Xe=de.pop();if(Ue-Xe<=ee){for(let pt=Xe;pt<=Ue;pt++)jn(q[2*pt],q[2*pt+1],Q,Y)<=he&&we.push(N[pt]);continue}const tt=Math.floor((Xe+Ue)/2),It=q[2*tt],xt=q[2*tt+1];jn(It,xt,Q,Y)<=he&&we.push(N[tt]);const mt=(Ge+1)%2;(Ge===0?Q-J<=It:Y-J<=xt)&&(de.push(Xe),de.push(tt-1),de.push(mt)),(Ge===0?Q+J>=It:Y+J>=xt)&&(de.push(tt+1),de.push(Ue),de.push(mt))}return we}(this.ids,this.coords,S,E,F,this.nodeSize)}}const Ds={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:$=>$},fi=Math.fround||(er=new Float32Array(1),$=>(er[0]=+$,er[0]));var er;class ns{constructor(S){this.options=wt(Object.create(Ds),S),this.trees=new Array(this.options.maxZoom+1)}load(S){const{log:E,minZoom:F,maxZoom:N,nodeSize:q}=this.options;E&&console.time("total time");const Q=`prepare ${S.length} points`;E&&console.time(Q),this.points=S;let Y=[];for(let J=0;J<S.length;J++)S[J].geometry&&Y.push(En(S[J],J));this.trees[N+1]=new is(Y,ur,tr,q,Float32Array),E&&console.timeEnd(Q);for(let J=N;J>=F;J--){const ee=+Date.now();Y=this._cluster(Y,J),this.trees[J]=new is(Y,ur,tr,q,Float32Array),E&&console.log("z%d: %d clusters in %dms",J,Y.length,+Date.now()-ee)}return E&&console.timeEnd("total time"),this}getClusters(S,E){let F=((S[0]+180)%360+360)%360-180;const N=Math.max(-90,Math.min(90,S[1]));let q=S[2]===180?180:((S[2]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,S[3]));if(S[2]-S[0]>=360)F=-180,q=180;else if(F>q){const de=this.getClusters([F,N,180,Q],E),we=this.getClusters([-180,N,q,Q],E);return de.concat(we)}const Y=this.trees[this._limitZoom(E)],J=Y.range(Cn(F),zn(Q),Cn(q),zn(N)),ee=[];for(const de of J){const we=Y.points[de];ee.push(we.numPoints?Ls(we):this.points[we.index])}return ee}getChildren(S){const E=this._getOriginId(S),F=this._getOriginZoom(S),N="No cluster with the specified id.",q=this.trees[F];if(!q)throw new Error(N);const Q=q.points[E];if(!Q)throw new Error(N);const Y=this.options.radius/(this.options.extent*Math.pow(2,F-1)),J=q.within(Q.x,Q.y,Y),ee=[];for(const de of J){const we=q.points[de];we.parentId===S&&ee.push(we.numPoints?Ls(we):this.points[we.index])}if(ee.length===0)throw new Error(N);return ee}getLeaves(S,E,F){const N=[];return this._appendLeaves(N,S,E=E||10,F=F||0,0),N}getTile(S,E,F){const N=this.trees[this._limitZoom(S)],q=Math.pow(2,S),{extent:Q,radius:Y}=this.options,J=Y/Q,ee=(F-J)/q,de=(F+1+J)/q,we={features:[]};return this._addTileFeatures(N.range((E-J)/q,ee,(E+1+J)/q,de),N.points,E,F,q,we),E===0&&this._addTileFeatures(N.range(1-J/q,ee,1,de),N.points,q,F,q,we),E===q-1&&this._addTileFeatures(N.range(0,ee,J/q,de),N.points,-1,F,q,we),we.features.length?we:null}getClusterExpansionZoom(S){let E=this._getOriginZoom(S)-1;for(;E<=this.options.maxZoom;){const F=this.getChildren(S);if(E++,F.length!==1)break;S=F[0].properties.cluster_id}return E}_appendLeaves(S,E,F,N,q){const Q=this.getChildren(E);for(const Y of Q){const J=Y.properties;if(J&&J.cluster?q+J.point_count<=N?q+=J.point_count:q=this._appendLeaves(S,J.cluster_id,F,N,q):q<N?q++:S.push(Y),S.length===F)break}return q}_addTileFeatures(S,E,F,N,q,Q){for(const Y of S){const J=E[Y],ee=J.numPoints;let de,we,he;if(ee)de=qn(J),we=J.x,he=J.y;else{const Xe=this.points[J.index];de=Xe.properties,we=Cn(Xe.geometry.coordinates[0]),he=zn(Xe.geometry.coordinates[1])}const Ge={type:1,geometry:[[Math.round(this.options.extent*(we*q-F)),Math.round(this.options.extent*(he*q-N))]],tags:de};let Ue;ee?Ue=J.id:this.options.generateId?Ue=J.index:this.points[J.index].id&&(Ue=this.points[J.index].id),Ue!==void 0&&(Ge.id=Ue),Q.features.push(Ge)}}_limitZoom(S){return Math.max(this.options.minZoom,Math.min(+S,this.options.maxZoom+1))}_cluster(S,E){const F=[],{radius:N,extent:q,reduce:Q,minPoints:Y}=this.options,J=N/(q*Math.pow(2,E));for(let ee=0;ee<S.length;ee++){const de=S[ee];if(de.zoom<=E)continue;de.zoom=E;const we=this.trees[E+1],he=we.within(de.x,de.y,J),Ge=de.numPoints||1;let Ue=Ge;for(const Xe of he){const tt=we.points[Xe];tt.zoom>E&&(Ue+=tt.numPoints||1)}if(Ue>Ge&&Ue>=Y){let Xe=de.x*Ge,tt=de.y*Ge,It=Q&&Ge>1?this._map(de,!0):null;const xt=(ee<<5)+(E+1)+this.points.length;for(const mt of he){const pt=we.points[mt];if(pt.zoom<=E)continue;pt.zoom=E;const ct=pt.numPoints||1;Xe+=pt.x*ct,tt+=pt.y*ct,pt.parentId=xt,Q&&(It||(It=this._map(de,!0)),Q(It,this._map(pt)))}de.parentId=xt,F.push(cr(Xe/Ue,tt/Ue,xt,Ue,It))}else if(F.push(de),Ue>1)for(const Xe of he){const tt=we.points[Xe];tt.zoom<=E||(tt.zoom=E,F.push(tt))}}return F}_getOriginId(S){return S-this.points.length>>5}_getOriginZoom(S){return(S-this.points.length)%32}_map(S,E){if(S.numPoints)return E?wt({},S.properties):S.properties;const F=this.points[S.index].properties,N=this.options.map(F);return E&&N===F?wt({},N):N}}function cr($,S,E,F,N){return{x:fi($),y:fi(S),zoom:1/0,id:E,parentId:-1,numPoints:F,properties:N}}function En($,S){const[E,F]=$.geometry.coordinates;return{x:fi(Cn(E)),y:fi(zn(F)),zoom:1/0,index:S,parentId:-1}}function Ls($){return{type:"Feature",id:$.id,properties:qn($),geometry:{type:"Point",coordinates:[(S=$.x,360*(S-.5)),rs($.y)]}};var S}function qn($){const S=$.numPoints,E=S>=1e4?`${Math.round(S/1e3)}k`:S>=1e3?Math.round(S/100)/10+"k":S;return wt(wt({},$.properties),{cluster:!0,cluster_id:$.id,point_count:S,point_count_abbreviated:E})}function Cn($){return $/360+.5}function zn($){const S=Math.sin($*Math.PI/180),E=.5-.25*Math.log((1+S)/(1-S))/Math.PI;return E<0?0:E>1?1:E}function rs($){const S=(180-360*$)*Math.PI/180;return 360*Math.atan(Math.exp(S))/Math.PI-90}function wt($,S){for(const E in S)$[E]=S[E];return $}function ur($){return $.x}function tr($){return $.y}function hr($,S,E,F){for(var N,q=F,Q=E-S>>1,Y=E-S,J=$[S],ee=$[S+1],de=$[E],we=$[E+1],he=S+3;he<E;he+=3){var Ge=ss($[he],$[he+1],J,ee,de,we);if(Ge>q)N=he,q=Ge;else if(Ge===q){var Ue=Math.abs(he-Q);Ue<Y&&(N=he,Y=Ue)}}q>F&&(N-S>3&&hr($,S,N,F),$[N+2]=q,E-N>3&&hr($,N,E,F))}function ss($,S,E,F,N,q){var Q=N-E,Y=q-F;if(Q!==0||Y!==0){var J=(($-E)*Q+(S-F)*Y)/(Q*Q+Y*Y);J>1?(E=N,F=q):J>0&&(E+=Q*J,F+=Y*J)}return(Q=$-E)*Q+(Y=S-F)*Y}function me($,S,E,F){var N={id:$===void 0?null:$,type:S,geometry:E,tags:F,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(q){var Q=q.geometry,Y=q.type;if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")Le(q,Q);else if(Y==="Polygon"||Y==="MultiLineString")for(var J=0;J<Q.length;J++)Le(q,Q[J]);else if(Y==="MultiPolygon")for(J=0;J<Q.length;J++)for(var ee=0;ee<Q[J].length;ee++)Le(q,Q[J][ee])}(N),N}function Le($,S){for(var E=0;E<S.length;E+=3)$.minX=Math.min($.minX,S[E]),$.minY=Math.min($.minY,S[E+1]),$.maxX=Math.max($.maxX,S[E]),$.maxY=Math.max($.maxY,S[E+1])}function pr($,S,E,F){if(S.geometry){var N=S.geometry.coordinates,q=S.geometry.type,Q=Math.pow(E.tolerance/((1<<E.maxZoom)*E.extent),2),Y=[],J=S.id;if(E.promoteId?J=S.properties[E.promoteId]:E.generateId&&(J=F||0),q==="Point")Gn(N,Y);else if(q==="MultiPoint")for(var ee=0;ee<N.length;ee++)Gn(N[ee],Y);else if(q==="LineString")Bt(N,Y,Q,!1);else if(q==="MultiLineString"){if(E.lineMetrics){for(ee=0;ee<N.length;ee++)Bt(N[ee],Y=[],Q,!1),$.push(me(J,"LineString",Y,S.properties));return}rn(N,Y,Q,!1)}else if(q==="Polygon")rn(N,Y,Q,!0);else{if(q!=="MultiPolygon"){if(q==="GeometryCollection"){for(ee=0;ee<S.geometry.geometries.length;ee++)pr($,{id:J,geometry:S.geometry.geometries[ee],properties:S.properties},E,F);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ee=0;ee<N.length;ee++){var de=[];rn(N[ee],de,Q,!0),Y.push(de)}}$.push(me(J,q,Y,S.properties))}}function Gn($,S){S.push(ki($[0])),S.push(dr($[1])),S.push(0)}function Bt($,S,E,F){for(var N,q,Q=0,Y=0;Y<$.length;Y++){var J=ki($[Y][0]),ee=dr($[Y][1]);S.push(J),S.push(ee),S.push(0),Y>0&&(Q+=F?(N*ee-J*q)/2:Math.sqrt(Math.pow(J-N,2)+Math.pow(ee-q,2))),N=J,q=ee}var de=S.length-3;S[2]=1,hr(S,0,de,E),S[de+2]=1,S.size=Math.abs(Q),S.start=0,S.end=S.size}function rn($,S,E,F){for(var N=0;N<$.length;N++){var q=[];Bt($[N],q,E,F),S.push(q)}}function ki($){return $/360+.5}function dr($){var S=Math.sin($*Math.PI/180),E=.5-.25*Math.log((1+S)/(1-S))/Math.PI;return E<0?0:E>1?1:E}function $t($,S,E,F,N,q,Q,Y){if(F/=S,q>=(E/=S)&&Q<F)return $;if(Q<E||q>=F)return null;for(var J=[],ee=0;ee<$.length;ee++){var de=$[ee],we=de.geometry,he=de.type,Ge=N===0?de.minX:de.minY,Ue=N===0?de.maxX:de.maxY;if(Ge>=E&&Ue<F)J.push(de);else if(!(Ue<E||Ge>=F)){var Xe=[];if(he==="Point"||he==="MultiPoint")Me(we,Xe,E,F,N);else if(he==="LineString")dt(we,Xe,E,F,N,!1,Y.lineMetrics);else if(he==="MultiLineString")Pi(we,Xe,E,F,N,!1);else if(he==="Polygon")Pi(we,Xe,E,F,N,!0);else if(he==="MultiPolygon")for(var tt=0;tt<we.length;tt++){var It=[];Pi(we[tt],It,E,F,N,!0),It.length&&Xe.push(It)}if(Xe.length){if(Y.lineMetrics&&he==="LineString"){for(tt=0;tt<Xe.length;tt++)J.push(me(de.id,he,Xe[tt],de.tags));continue}he!=="LineString"&&he!=="MultiLineString"||(Xe.length===1?(he="LineString",Xe=Xe[0]):he="MultiLineString"),he!=="Point"&&he!=="MultiPoint"||(he=Xe.length===3?"Point":"MultiPoint"),J.push(me(de.id,he,Xe,de.tags))}}}return J.length?J:null}function Me($,S,E,F,N){for(var q=0;q<$.length;q+=3){var Q=$[q+N];Q>=E&&Q<=F&&(S.push($[q]),S.push($[q+1]),S.push($[q+2]))}}function dt($,S,E,F,N,q,Q){for(var Y,J,ee=ut($),de=N===0?ht:fr,we=$.start,he=0;he<$.length-3;he+=3){var Ge=$[he],Ue=$[he+1],Xe=$[he+2],tt=$[he+3],It=$[he+4],xt=N===0?Ge:Ue,mt=N===0?tt:It,pt=!1;Q&&(Y=Math.sqrt(Math.pow(Ge-tt,2)+Math.pow(Ue-It,2))),xt<E?mt>E&&(J=de(ee,Ge,Ue,tt,It,E),Q&&(ee.start=we+Y*J)):xt>F?mt<F&&(J=de(ee,Ge,Ue,tt,It,F),Q&&(ee.start=we+Y*J)):fn(ee,Ge,Ue,Xe),mt<E&&xt>=E&&(J=de(ee,Ge,Ue,tt,It,E),pt=!0),mt>F&&xt<=F&&(J=de(ee,Ge,Ue,tt,It,F),pt=!0),!q&&pt&&(Q&&(ee.end=we+Y*J),S.push(ee),ee=ut($)),Q&&(we+=Y)}var ct=$.length-3;Ge=$[ct],Ue=$[ct+1],Xe=$[ct+2],(xt=N===0?Ge:Ue)>=E&&xt<=F&&fn(ee,Ge,Ue,Xe),ct=ee.length-3,q&&ct>=3&&(ee[ct]!==ee[0]||ee[ct+1]!==ee[1])&&fn(ee,ee[0],ee[1],ee[2]),ee.length&&S.push(ee)}function ut($){var S=[];return S.size=$.size,S.start=$.start,S.end=$.end,S}function Pi($,S,E,F,N,q){for(var Q=0;Q<$.length;Q++)dt($[Q],S,E,F,N,q,!1)}function fn($,S,E,F){$.push(S),$.push(E),$.push(F)}function ht($,S,E,F,N,q){var Q=(q-S)/(F-S);return $.push(q),$.push(E+(N-E)*Q),$.push(1),Q}function fr($,S,E,F,N,q){var Q=(q-E)/(N-E);return $.push(S+(F-S)*Q),$.push(q),$.push(1),Q}function mn($,S){for(var E=[],F=0;F<$.length;F++){var N,q=$[F],Q=q.type;if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")N=Zn(q.geometry,S);else if(Q==="MultiLineString"||Q==="Polygon"){N=[];for(var Y=0;Y<q.geometry.length;Y++)N.push(Zn(q.geometry[Y],S))}else if(Q==="MultiPolygon")for(N=[],Y=0;Y<q.geometry.length;Y++){for(var J=[],ee=0;ee<q.geometry[Y].length;ee++)J.push(Zn(q.geometry[Y][ee],S));N.push(J)}E.push(me(q.id,Q,N,q.tags))}return E}function Zn($,S){var E=[];E.size=$.size,$.start!==void 0&&(E.start=$.start,E.end=$.end);for(var F=0;F<$.length;F+=3)E.push($[F]+S,$[F+1],$[F+2]);return E}function ni($,S){if($.transformed)return $;var E,F,N,q=1<<$.z,Q=$.x,Y=$.y;for(E=0;E<$.features.length;E++){var J=$.features[E],ee=J.geometry,de=J.type;if(J.geometry=[],de===1)for(F=0;F<ee.length;F+=2)J.geometry.push(Ft(ee[F],ee[F+1],S,q,Q,Y));else for(F=0;F<ee.length;F++){var we=[];for(N=0;N<ee[F].length;N+=2)we.push(Ft(ee[F][N],ee[F][N+1],S,q,Q,Y));J.geometry.push(we)}}return $.transformed=!0,$}function Ft($,S,E,F,N,q){return[Math.round(E*($*F-N)),Math.round(E*(S*F-q))]}function sn($,S,E,F,N){for(var q=S===N.maxZoom?0:N.tolerance/((1<<S)*N.extent),Q={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:E,y:F,z:S,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Y=0;Y<$.length;Y++){Q.numFeatures++,mr(Q,$[Y],q,N);var J=$[Y].minX,ee=$[Y].minY,de=$[Y].maxX,we=$[Y].maxY;J<Q.minX&&(Q.minX=J),ee<Q.minY&&(Q.minY=ee),de>Q.maxX&&(Q.maxX=de),we>Q.maxY&&(Q.maxY=we)}return Q}function mr($,S,E,F){var N=S.geometry,q=S.type,Q=[];if(q==="Point"||q==="MultiPoint")for(var Y=0;Y<N.length;Y+=3)Q.push(N[Y]),Q.push(N[Y+1]),$.numPoints++,$.numSimplified++;else if(q==="LineString")ui(Q,N,$,E,!1,!1);else if(q==="MultiLineString"||q==="Polygon")for(Y=0;Y<N.length;Y++)ui(Q,N[Y],$,E,q==="Polygon",Y===0);else if(q==="MultiPolygon")for(var J=0;J<N.length;J++){var ee=N[J];for(Y=0;Y<ee.length;Y++)ui(Q,ee[Y],$,E,!0,Y===0)}if(Q.length){var de=S.tags||null;if(q==="LineString"&&F.lineMetrics){for(var we in de={},S.tags)de[we]=S.tags[we];de.mapbox_clip_start=N.start/N.size,de.mapbox_clip_end=N.end/N.size}var he={geometry:Q,type:q==="Polygon"||q==="MultiPolygon"?3:q==="LineString"||q==="MultiLineString"?2:1,tags:de};S.id!==null&&(he.id=S.id),$.features.push(he)}}function ui($,S,E,F,N,q){var Q=F*F;if(F>0&&S.size<(N?Q:F))E.numPoints+=S.length/3;else{for(var Y=[],J=0;J<S.length;J+=3)(F===0||S[J+2]>Q)&&(E.numSimplified++,Y.push(S[J]),Y.push(S[J+1])),E.numPoints++;N&&function(ee,de){for(var we=0,he=0,Ge=ee.length,Ue=Ge-2;he<Ge;Ue=he,he+=2)we+=(ee[he]-ee[Ue])*(ee[he+1]+ee[Ue+1]);if(we>0===de)for(he=0,Ge=ee.length;he<Ge/2;he+=2){var Xe=ee[he],tt=ee[he+1];ee[he]=ee[Ge-2-he],ee[he+1]=ee[Ge-1-he],ee[Ge-2-he]=Xe,ee[Ge-1-he]=tt}}(Y,q),$.push(Y)}}function gn($,S){var E=(S=this.options=function(N,q){for(var Q in q)N[Q]=q[Q];return N}(Object.create(this.options),S)).debug;if(E&&console.time("preprocess data"),S.maxZoom<0||S.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(S.promoteId&&S.generateId)throw new Error("promoteId and generateId cannot be used together.");var F=function(N,q){var Q=[];if(N.type==="FeatureCollection")for(var Y=0;Y<N.features.length;Y++)pr(Q,N.features[Y],q,Y);else pr(Q,N.type==="Feature"?N:{geometry:N},q);return Q}($,S);this.tiles={},this.tileCoords=[],E&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",S.indexMaxZoom,S.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),F=function(N,q){var Q=q.buffer/q.extent,Y=N,J=$t(N,1,-1-Q,Q,0,-1,2,q),ee=$t(N,1,1-Q,2+Q,0,-1,2,q);return(J||ee)&&(Y=$t(N,1,-Q,1+Q,0,-1,2,q)||[],J&&(Y=mn(J,1).concat(Y)),ee&&(Y=Y.concat(mn(ee,-1)))),Y}(F,S),F.length&&this.splitTile(F,0,0,0),E&&(F.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function _n($,S,E){return 32*((1<<$)*E+S)+$}function os($,S){const E=$.tileID.canonical;if(!this._geoJSONIndex)return S(null,null);const F=this._geoJSONIndex.getTile(E.z,E.x,E.y);if(!F)return S(null,null);const N=new Te(F.features);let q=$n(N);q.byteOffset===0&&q.byteLength===q.buffer.byteLength||(q=new Uint8Array(q)),S(null,{vectorTile:N,rawData:q.buffer})}gn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gn.prototype.splitTile=function($,S,E,F,N,q,Q){for(var Y=[$,S,E,F],J=this.options,ee=J.debug;Y.length;){F=Y.pop(),E=Y.pop(),S=Y.pop(),$=Y.pop();var de=1<<S,we=_n(S,E,F),he=this.tiles[we];if(!he&&(ee>1&&console.time("creation"),he=this.tiles[we]=sn($,S,E,F,J),this.tileCoords.push({z:S,x:E,y:F}),ee)){ee>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",S,E,F,he.numFeatures,he.numPoints,he.numSimplified),console.timeEnd("creation"));var Ge="z"+S;this.stats[Ge]=(this.stats[Ge]||0)+1,this.total++}if(he.source=$,N){if(S===J.maxZoom||S===N)continue;var Ue=1<<N-S;if(E!==Math.floor(q/Ue)||F!==Math.floor(Q/Ue))continue}else if(S===J.indexMaxZoom||he.numPoints<=J.indexMaxPoints)continue;if(he.source=null,$.length!==0){ee>1&&console.time("clipping");var Xe,tt,It,xt,mt,pt,ct=.5*J.buffer/J.extent,ei=.5-ct,Kt=.5+ct,mi=1+ct;Xe=tt=It=xt=null,mt=$t($,de,E-ct,E+Kt,0,he.minX,he.maxX,J),pt=$t($,de,E+ei,E+mi,0,he.minX,he.maxX,J),$=null,mt&&(Xe=$t(mt,de,F-ct,F+Kt,1,he.minY,he.maxY,J),tt=$t(mt,de,F+ei,F+mi,1,he.minY,he.maxY,J),mt=null),pt&&(It=$t(pt,de,F-ct,F+Kt,1,he.minY,he.maxY,J),xt=$t(pt,de,F+ei,F+mi,1,he.minY,he.maxY,J),pt=null),ee>1&&console.timeEnd("clipping"),Y.push(Xe||[],S+1,2*E,2*F),Y.push(tt||[],S+1,2*E,2*F+1),Y.push(It||[],S+1,2*E+1,2*F),Y.push(xt||[],S+1,2*E+1,2*F+1)}}},gn.prototype.getTile=function($,S,E){var F=this.options,N=F.extent,q=F.debug;if($<0||$>24)return null;var Q=1<<$,Y=_n($,S=(S%Q+Q)%Q,E);if(this.tiles[Y])return ni(this.tiles[Y],N);q>1&&console.log("drilling down to z%d-%d-%d",$,S,E);for(var J,ee=$,de=S,we=E;!J&&ee>0;)ee--,de=Math.floor(de/2),we=Math.floor(we/2),J=this.tiles[_n(ee,de,we)];return J&&J.source?(q>1&&console.log("found parent tile z%d-%d-%d",ee,de,we),q>1&&console.time("drilling down"),this.splitTile(J.source,ee,de,we,$,S,E),q>1&&console.timeEnd("drilling down"),this.tiles[Y]?ni(this.tiles[Y],N):null):null};class Lr extends ze{constructor(S,E,F,N){super(S,E,F,os),N&&(this.loadGeoJSON=N)}loadData(S,E){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=E,this._pendingLoadDataParams=S,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const S=this._pendingCallback,E=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const F=!!(E&&E.request&&E.request.collectResourceTiming)&&new o.RequestPerformance(E.request);this.loadGeoJSON(E,(N,q)=>{if(N||!q)return S(N);if(typeof q!="object")return S(new Error(`Input data given to '${E.source}' is not a valid GeoJSON object.`));{We(q,!0);try{if(E.filter){const Y=o.createExpression(E.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Y.result==="error")throw new Error(Y.value.map(ee=>`${ee.key}: ${ee.message}`).join(", "));const J=q.features.filter(ee=>Y.value.evaluate({zoom:0},ee));q={type:"FeatureCollection",features:J}}this._geoJSONIndex=E.cluster?new ns(function({superclusterOptions:Y,clusterProperties:J}){if(!J||!Y)return Y;const ee={},de={},we={accumulated:null,zoom:0},he={properties:null},Ge=Object.keys(J);for(const Ue of Ge){const[Xe,tt]=J[Ue],It=o.createExpression(tt),xt=o.createExpression(typeof Xe=="string"?[Xe,["accumulated"],["get",Ue]]:Xe);ee[Ue]=It.value,de[Ue]=xt.value}return Y.map=Ue=>{he.properties=Ue;const Xe={};for(const tt of Ge)Xe[tt]=ee[tt].evaluate(we,he);return Xe},Y.reduce=(Ue,Xe)=>{he.properties=Xe;for(const tt of Ge)we.accumulated=Ue[tt],Ue[tt]=de[tt].evaluate(we,he)},Y}(E)).load(q.features):function(Y,J){return new gn(Y,J)}(q,E.geojsonVtOptions)}catch(Y){return S(Y)}this.loaded={};const Q={};if(F){const Y=F.finish();Y&&(Q.resourceTiming={},Q.resourceTiming[E.source]=JSON.parse(JSON.stringify(Y)))}S(null,Q)}})}coalesce(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())}reloadTile(S,E){const F=this.loaded;return F&&F[S.uid]?super.reloadTile(S,E):this.loadTile(S,E)}loadGeoJSON(S,E){if(S.request)o.getJSON(S.request,E);else{if(typeof S.data!="string")return E(new Error(`Input data given to '${S.source}' is not a valid GeoJSON object.`));try{return E(null,JSON.parse(S.data))}catch{return E(new Error(`Input data given to '${S.source}' is not a valid GeoJSON object.`))}}}removeSource(S,E){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),E()}getClusterExpansionZoom(S,E){try{E(null,this._geoJSONIndex.getClusterExpansionZoom(S.clusterId))}catch(F){E(F)}}getClusterChildren(S,E){try{E(null,this._geoJSONIndex.getChildren(S.clusterId))}catch(F){E(F)}}getClusterLeaves(S,E){try{E(null,this._geoJSONIndex.getLeaves(S.clusterId,S.limit,S.offset))}catch(F){E(F)}}}class Rr{constructor(S){this.self=S,this.actor=new o.Actor(S,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ze,geojson:Lr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(E,F)=>{if(this.workerSourceTypes[E])throw new Error(`Worker source with name "${E}" already registered.`);this.workerSourceTypes[E]=F},this.self.registerRTLTextPlugin=E=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=E.applyArabicShaping,o.plugin.processBidirectionalText=E.processBidirectionalText,o.plugin.processStyledBidirectionalText=E.processStyledBidirectionalText}}setReferrer(S,E){this.referrer=E}setImages(S,E,F){this.availableImages[S]=E;for(const N in this.workerSources[S]){const q=this.workerSources[S][N];for(const Q in q)q[Q].availableImages=E}F()}setLayers(S,E,F){this.getLayerIndex(S).replace(E),F()}updateLayers(S,E,F){this.getLayerIndex(S).update(E.layers,E.removedIds),F()}loadTile(S,E,F){this.getWorkerSource(S,E.type,E.source).loadTile(E,F)}loadDEMTile(S,E,F){this.getDEMWorkerSource(S,E.source).loadTile(E,F)}reloadTile(S,E,F){this.getWorkerSource(S,E.type,E.source).reloadTile(E,F)}abortTile(S,E,F){this.getWorkerSource(S,E.type,E.source).abortTile(E,F)}removeTile(S,E,F){this.getWorkerSource(S,E.type,E.source).removeTile(E,F)}removeDEMTile(S,E){this.getDEMWorkerSource(S,E.source).removeTile(E)}removeSource(S,E,F){if(!this.workerSources[S]||!this.workerSources[S][E.type]||!this.workerSources[S][E.type][E.source])return;const N=this.workerSources[S][E.type][E.source];delete this.workerSources[S][E.type][E.source],N.removeSource!==void 0?N.removeSource(E,F):F()}loadWorkerSource(S,E,F){try{this.self.importScripts(E.url),F()}catch(N){F(N.toString())}}syncRTLPluginState(S,E,F){try{o.plugin.setState(E);const N=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&N!=null){this.self.importScripts(N);const q=o.plugin.isParsed();F(q?void 0:new Error(`RTL Text Plugin failed to import scripts from ${N}`),q)}}catch(N){F(N.toString())}}getAvailableImages(S){let E=this.availableImages[S];return E||(E=[]),E}getLayerIndex(S){let E=this.layerIndexes[S];return E||(E=this.layerIndexes[S]=new se),E}getWorkerSource(S,E,F){if(this.workerSources[S]||(this.workerSources[S]={}),this.workerSources[S][E]||(this.workerSources[S][E]={}),!this.workerSources[S][E][F]){const N={send:(q,Q,Y)=>{this.actor.send(q,Q,Y,S)}};this.workerSources[S][E][F]=new this.workerSourceTypes[E](N,this.getLayerIndex(S),this.getAvailableImages(S))}return this.workerSources[S][E][F]}getDEMWorkerSource(S,E){return this.demWorkerSources[S]||(this.demWorkerSources[S]={}),this.demWorkerSources[S][E]||(this.demWorkerSources[S][E]=new Ce),this.demWorkerSources[S][E]}enforceCacheSizeLimit(S,E){o.enforceCacheSizeLimit(E)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Rr(self)),Rr}),A(["./shared"],function(o){var V=G;function G(c){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var a,u,d=new Blob([""],{type:"text/javascript"}),g=URL.createObjectURL(d);try{u=new Worker(g),a=!0}catch{a=!1}return u&&u.terminate(),URL.revokeObjectURL(g),a}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var a=document.createElement("canvas");a.width=a.height=1;var u=a.getContext("2d");if(!u)return!1;var d=u.getImageData(0,0,1,1);return d&&d.width===a.width}()?(se[r=t&&t.failIfMajorPerformanceCaveat]===void 0&&(se[r]=function(a){var u,d=function(g){var x=document.createElement("canvas"),b=Object.create(G.webGLContextAttributes);return b.failIfMajorPerformanceCaveat=g,x.getContext("webgl",b)||x.getContext("experimental-webgl",b)}(a);if(!d)return!1;try{u=d.createShader(d.VERTEX_SHADER)}catch{return!1}return!(!u||d.isContextLost())&&(d.shaderSource(u,"void main() {}"),d.compileShader(u),d.getShaderParameter(u,d.COMPILE_STATUS)===!0)}(r)),se[r]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var r}(c)}var se={};function K(c,t){if(Array.isArray(c)){if(!Array.isArray(t)||c.length!==t.length)return!1;for(let r=0;r<c.length;r++)if(!K(c[r],t[r]))return!1;return!0}if(typeof c=="object"&&c!==null&&t!==null){if(typeof t!="object"||Object.keys(c).length!==Object.keys(t).length)return!1;for(const r in c)if(!K(c[r],t[r]))return!1;return!0}return c===t}G.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class j{static testProp(t){if(!j.docStyle)return t[0];for(let r=0;r<t.length;r++)if(t[r]in j.docStyle)return t[r];return t[0]}static create(t,r,a){const u=window.document.createElement(t);return r!==void 0&&(u.className=r),a&&a.appendChild(u),u}static createNS(t,r){return window.document.createElementNS(t,r)}static disableDrag(){j.docStyle&&j.selectProp&&(j.userSelect=j.docStyle[j.selectProp],j.docStyle[j.selectProp]="none")}static enableDrag(){j.docStyle&&j.selectProp&&(j.docStyle[j.selectProp]=j.userSelect)}static setTransform(t,r){t.style[j.transformProp]=r}static addEventListener(t,r,a,u={}){t.addEventListener(r,a,"passive"in u?u:u.capture)}static removeEventListener(t,r,a,u={}){t.removeEventListener(r,a,"passive"in u?u:u.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",j.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",j.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",j.suppressClickInternal,!0)},0)}static mousePos(t,r){const a=t.getBoundingClientRect();return new o.pointGeometry(r.clientX-a.left-t.clientLeft,r.clientY-a.top-t.clientTop)}static touchPos(t,r){const a=t.getBoundingClientRect(),u=[];for(let d=0;d<r.length;d++)u.push(new o.pointGeometry(r[d].clientX-a.left-t.clientLeft,r[d].clientY-a.top-t.clientTop));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}j.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,j.selectProp=j.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),j.transformProp=j.testProp(["transform","WebkitTransform"]);class ae{constructor(t){this._transformRequestFn=t}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeSpriteURL(t,r,a){const u=function(d){const g=d.match(le);if(!g)throw new Error(`Unable to parse URL "${d}"`);return{protocol:g[1],authority:g[2],path:g[3]||"/",params:g[4]?g[4].split("&"):[]}}(t);return u.path+=`${r}${a}`,function(d){const g=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${g}`}(u)}setTransformRequest(t){this._transformRequestFn=t}}const le=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ze(c){var t=new o.ARRAY_TYPE(3);return t[0]=c[0],t[1]=c[1],t[2]=c[2],t}var Ce,We=function(c,t,r){return c[0]=t[0]-r[0],c[1]=t[1]-r[1],c[2]=t[2]-r[2],c};Ce=new o.ARRAY_TYPE(3),o.ARRAY_TYPE!=Float32Array&&(Ce[0]=0,Ce[1]=0,Ce[2]=0);var kt=function(c){var t=c[0],r=c[1];return t*t+r*r};(function(){var c=new o.ARRAY_TYPE(2);o.ARRAY_TYPE!=Float32Array&&(c[0]=0,c[1]=0)})();class ft{constructor(t,r,a,u){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(r,u)}update(t,r,a){const{width:u,height:d}=t,g=!(this.size&&this.size[0]===u&&this.size[1]===d||a),{context:x}=this,{gl:b}=x;if(this.useMipmap=Boolean(r&&r.useMipmap),b.bindTexture(b.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!r||r.premultiply!==!1)),g)this.size=[u,d],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.isImageBitmap(t)?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,t):b.texImage2D(b.TEXTURE_2D,0,this.format,u,d,0,this.format,b.UNSIGNED_BYTE,t.data);else{const{x:I,y:k}=a||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.isImageBitmap(t)?b.texSubImage2D(b.TEXTURE_2D,0,I,k,b.RGBA,b.UNSIGNED_BYTE,t):b.texSubImage2D(b.TEXTURE_2D,0,I,k,u,d,b.RGBA,b.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&b.generateMipmap(b.TEXTURE_2D)}bind(t,r,a){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),a!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=d.LINEAR),t!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a||t),this.filter=t),r!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function st(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ye extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:r,callback:a}of this.requestors)this._notify(r,a);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,r){this._validate(t,r)&&(this.images[t]=r)}_validate(t,r){let a=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),a=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),a=!1),this._validateContent(r.content,r)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),a=!1),a}_validateStretch(t,r){if(!t)return!0;let a=0;for(const u of t){if(u[0]<a||u[1]<u[0]||r<u[1])return!1;a=u[1]}return!0}_validateContent(t,r){return!(t&&(t.length!==4||t[0]<0||r.data.width<t[0]||t[1]<0||r.data.height<t[1]||t[2]<0||r.data.width<t[2]||t[3]<0||r.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,r){r.version=this.images[t].version+1,this.images[t]=r,this.updatedImages[t]=!0}removeImage(t){const r=this.images[t];delete this.images[t],delete this.patterns[t],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,r){let a=!0;if(!this.isLoaded())for(const u of t)this.images[u]||(a=!1);this.isLoaded()||a?this._notify(t,r):this.requestors.push({ids:t,callback:r})}_notify(t,r){const a={};for(const u of t){this.images[u]||this.fire(new o.Event("styleimagemissing",{id:u}));const d=this.images[u];d?a[u]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:Boolean(d.userImage&&d.userImage.render)}:o.warnOnce(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,a)}getPixelSize(){const{width:t,height:r}=this.atlasImage;return{width:t,height:r}}getPattern(t){const r=this.patterns[t],a=this.getImage(t);if(!a)return null;if(r&&r.position.version===a.version)return r.position;if(r)r.position.version=a.version;else{const u={w:a.data.width+2,h:a.data.height+2,x:0,y:0},d=new o.ImagePosition(u,a);this.patterns[t]={bin:u,position:d}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const r=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ft(t,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const d in this.patterns)t.push(this.patterns[d].bin);const{w:r,h:a}=o.potpack(t),u=this.atlasImage;u.resize({width:r||1,height:a||1});for(const d in this.patterns){const{bin:g}=this.patterns[d],x=g.x+1,b=g.y+1,I=this.images[d].data,k=I.width,L=I.height;o.RGBAImage.copy(I,u,{x:0,y:0},{x,y:b},{width:k,height:L}),o.RGBAImage.copy(I,u,{x:0,y:L-1},{x,y:b-1},{width:k,height:1}),o.RGBAImage.copy(I,u,{x:0,y:0},{x,y:b+L},{width:k,height:1}),o.RGBAImage.copy(I,u,{x:k-1,y:0},{x:x-1,y:b},{width:1,height:L}),o.RGBAImage.copy(I,u,{x:0,y:0},{x:x+k,y:b},{width:1,height:L})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const r of t){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const a=this.images[r];st(a)&&this.updateImage(r,a)}}}const Te=1e20;function rt(c,t,r,a,u,d,g,x,b){for(let I=t;I<t+a;I++)At(c,r*d+I,d,u,g,x,b);for(let I=r;I<r+u;I++)At(c,I*d+t,1,a,g,x,b)}function At(c,t,r,a,u,d,g){d[0]=0,g[0]=-Te,g[1]=Te,u[0]=c[t];for(let x=1,b=0,I=0;x<a;x++){u[x]=c[t+x*r];const k=x*x;do{const L=d[b];I=(u[x]-u[L]+k-L*L)/(x-L)/2}while(I<=g[b]&&--b>-1);b++,d[b]=x,g[b]=I,g[b+1]=Te}for(let x=0,b=0;x<a;x++){for(;g[b+1]<x;)b++;const I=d[b],k=x-I;c[t+x*r]=u[I]+k*k}}class Vt{constructor(t,r){this.requestManager=t,this.localIdeographFontFamily=r,this.entries={}}setURL(t){this.url=t}getGlyphs(t,r){const a=[];for(const u in t)for(const d of t[u])a.push({stack:u,id:d});o.asyncAll(a,({stack:u,id:d},g)=>{let x=this.entries[u];x||(x=this.entries[u]={glyphs:{},requests:{},ranges:{}});let b=x.glyphs[d];if(b!==void 0)return void g(null,{stack:u,id:d,glyph:b});if(b=this._tinySDF(x,u,d),b)return x.glyphs[d]=b,void g(null,{stack:u,id:d,glyph:b});const I=Math.floor(d/256);if(256*I>65535)return void g(new Error("glyphs > 65535 not supported"));if(x.ranges[I])return void g(null,{stack:u,id:d,glyph:b});let k=x.requests[I];k||(k=x.requests[I]=[],Vt.loadGlyphRange(u,I,this.url,this.requestManager,(L,O)=>{if(O){for(const W in O)this._doesCharSupportLocalGlyph(+W)||(x.glyphs[+W]=O[+W]);x.ranges[I]=!0}for(const W of k)W(L,O);delete x.requests[I]})),k.push((L,O)=>{L?g(L):O&&g(null,{stack:u,id:d,glyph:O[d]||null})})},(u,d)=>{if(u)r(u);else if(d){const g={};for(const{stack:x,id:b,glyph:I}of d)(g[x]||(g[x]={}))[b]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};r(null,g)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(o.unicodeBlockLookup["CJK Unified Ideographs"](t)||o.unicodeBlockLookup["Hangul Syllables"](t)||o.unicodeBlockLookup.Hiragana(t)||o.unicodeBlockLookup.Katakana(t))}_tinySDF(t,r,a){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let d=t.tinySDF;if(!d){let x="400";/bold/i.test(r)?x="900":/medium/i.test(r)?x="500":/light/i.test(r)&&(x="200"),d=t.tinySDF=new Vt.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:u,fontWeight:x})}const g=d.draw(String.fromCharCode(a));return{id:a,bitmap:new o.AlphaImage({width:g.width||30,height:g.height||30},g.data),metrics:{width:g.glyphWidth||24,height:g.glyphHeight||24,left:g.glyphLeft||0,top:g.glyphTop-27||-8,advance:g.glyphAdvance||24}}}}Vt.loadGlyphRange=function(c,t,r,a,u){const d=256*t,g=d+255,x=a.transformRequest(r.replace("{fontstack}",c).replace("{range}",`${d}-${g}`),o.ResourceType.Glyphs);o.getArrayBuffer(x,(b,I)=>{if(b)u(b);else if(I){const k={};for(const L of o.parseGlyphPBF(I))k[L.id]=L;u(null,k)}})},Vt.TinySDF=class{constructor({fontSize:c=24,buffer:t=3,radius:r=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:d="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=r;const x=this.size=c+4*t,b=this._createCanvas(x),I=this.ctx=b.getContext("2d",{willReadFrequently:!0});I.font=`${g} ${d} ${c}px ${u}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(c){const t=document.createElement("canvas");return t.width=t.height=c,t}draw(c){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:d}=this.ctx.measureText(c),g=Math.ceil(r),x=Math.min(this.size-this.buffer,Math.ceil(d-u)),b=Math.min(this.size-this.buffer,g+Math.ceil(a)),I=x+2*this.buffer,k=b+2*this.buffer,L=Math.max(I*k,0),O=new Uint8ClampedArray(L),W={data:O,width:I,height:k,glyphWidth:x,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(x===0||b===0)return W;const{ctx:U,buffer:Z,gridInner:te,gridOuter:ie}=this;U.clearRect(Z,Z,x,b),U.fillText(c,Z,Z+g);const oe=U.getImageData(Z,Z,x,b);ie.fill(Te,0,L),te.fill(0,0,L);for(let ne=0;ne<b;ne++)for(let ye=0;ye<x;ye++){const pe=oe.data[4*(ne*x+ye)+3]/255;if(pe===0)continue;const fe=(ne+Z)*I+ye+Z;if(pe===1)ie[fe]=0,te[fe]=Te;else{const Ie=.5-pe;ie[fe]=Ie>0?Ie*Ie:0,te[fe]=Ie<0?Ie*Ie:0}}rt(ie,0,0,I,k,I,this.f,this.v,this.z),rt(te,Z,Z,x,b,I,this.f,this.v,this.z);for(let ne=0;ne<L;ne++){const ye=Math.sqrt(ie[ne])-Math.sqrt(te[ne]);O[ne]=Math.round(255-255*(ye/this.radius+this.cutoff))}return W}};const Vn=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(c,t){return o.sphericalToCartesian(c.expression.evaluate(t))}interpolate(c,t,r){return{x:o.number(c.x,t.x,r),y:o.number(c.y,t.y,r),z:o.number(c.z,t.z,r)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),zi="-transition";class hn extends o.Evented{constructor(t){super(),this._transitionable=new o.Transitionable(Vn),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r={}){if(!this._validate(o.validateLight,t,r))for(const a in t){const u=t[a];a.endsWith(zi)?this._transitionable.setTransition(a.slice(0,-zi.length),u):this._transitionable.setValue(a,u)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,a){return(!a||a.validate!==!1)&&o.emitValidationErrors(this,t.call(o.validateStyle,o.extend({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class In{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,r){const a=t.join(",")+String(r);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(t,r)),this.dashEntry[a]}getDashRanges(t,r,a){const u=[];let d=t.length%2==1?-t[t.length-1]*a:0,g=t[0]*a,x=!0;u.push({left:d,right:g,isDash:x,zeroLength:t[0]===0});let b=t[0];for(let I=1;I<t.length;I++){x=!x;const k=t[I];d=b*a,b+=k,g=b*a,u.push({left:d,right:g,isDash:x,zeroLength:k===0})}return u}addRoundDash(t,r,a){const u=r/2;for(let d=-a;d<=a;d++){const g=this.width*(this.nextRow+a+d);let x=0,b=t[x];for(let I=0;I<this.width;I++){I/b.right>1&&(b=t[++x]);const k=Math.abs(I-b.left),L=Math.abs(I-b.right),O=Math.min(k,L);let W;const U=d/a*(u+1);if(b.isDash){const Z=u-Math.abs(U);W=Math.sqrt(O*O+Z*Z)}else W=u-Math.sqrt(O*O+U*U);this.data[g+I]=Math.max(0,Math.min(255,W+128))}}}addRegularDash(t){for(let x=t.length-1;x>=0;--x){const b=t[x],I=t[x+1];b.zeroLength?t.splice(x,1):I&&I.isDash===b.isDash&&(I.left=b.left,t.splice(x,1))}const r=t[0],a=t[t.length-1];r.isDash===a.isDash&&(r.left=a.left-this.width,a.right=r.right+this.width);const u=this.width*this.nextRow;let d=0,g=t[d];for(let x=0;x<this.width;x++){x/g.right>1&&(g=t[++d]);const b=Math.abs(x-g.left),I=Math.abs(x-g.right),k=Math.min(b,I);this.data[u+x]=Math.max(0,Math.min(255,(g.isDash?k:-k)+128))}}addDash(t,r){const a=r?7:0,u=2*a+1;if(this.nextRow+u>this.height)return o.warnOnce("LineAtlas out of space"),null;let d=0;for(let x=0;x<t.length;x++)d+=t[x];if(d!==0){const x=this.width/d,b=this.getDashRanges(t,this.width,x);r?this.addRoundDash(b,x,a):this.addRegularDash(b)}const g={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:d};return this.nextRow+=u,this.dirty=!0,g}bind(t){const r=t.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}class Wi{constructor(t,r){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const a=this.workerPool.acquire(this.id);for(let u=0;u<a.length;u++){const d=new Wi.Actor(a[u],r,this.id);d.name=`Worker ${u}`,this.actors.push(d)}}broadcast(t,r,a){o.asyncAll(this.actors,(u,d)=>{u.send(t,r,d)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Tn(c,t,r){const a=function(u,d){if(u)return r(u);if(d){const g=o.pick(o.extend(d,c),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(g.vectorLayers=d.vector_layers,g.vectorLayerIds=g.vectorLayers.map(x=>x.id)),r(null,g)}};return c.url?o.getJSON(t.transformRequest(c.url,o.ResourceType.Source),a):o.exported.frame(()=>a(null,c))}Wi.Actor=o.Actor;class Ve{constructor(t,r,a){this.bounds=o.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=a||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),a=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*r),u=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*r),d=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*r),g=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*r);return t.x>=a&&t.x<d&&t.y>=u&&t.y<g}}class Ht extends o.Evented{constructor(t,r,a,u){if(super(),this.id=t,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(r,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Tn(this._options,this.map._requestManager,(t,r)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new o.ErrorEvent(t)):r&&(o.extend(this,r),r.bounds&&(this.tileBounds=new Ve(r.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(t,r){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(a,o.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function d(g,x){return delete t.request,t.aborted?r(null):g&&g.status!==404?r(g):(x&&x.resourceTiming&&(t.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&x&&t.setExpiryData(x),t.loadVectorData(x,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}u.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",u,d.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",u,d.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Kn extends o.Evented{constructor(t,r,a,u){super(),this.id=t,this.dispatcher=a,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},r),o.extend(this,o.pick(r,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Tn(this._options,this.map._requestManager,(t,r)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new o.ErrorEvent(t)):r&&(o.extend(this,r),r.bounds&&(this.tileBounds=new Ve(r.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=o.getImage(this.map._requestManager.transformRequest(a,o.ResourceType.Tile),(u,d,g)=>{if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(u)t.state="errored",r(u);else if(d){this.map._refreshExpiredTiles&&t.setExpiryData(g);const x=this.map.painter.context,b=x.gl;t.texture=this.map.painter.getTileTexture(d.width),t.texture?t.texture.update(d,{useMipmap:!0}):(t.texture=new ft(x,d,b.RGBA,{useMipmap:!0}),t.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),x.extTextureFilterAnisotropic&&b.texParameterf(b.TEXTURE_2D,x.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,x.extTextureFilterAnisotropicMax)),t.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),r(null)}})}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r()}unloadTile(t,r){t.texture&&this.map.painter.saveTileTexture(t.texture),r()}hasTransition(){return!1}}let Jn;class pn extends Kn{constructor(t,r,a,u){super(t,r,a,u),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,r){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function u(d,g){d&&(t.state="errored",r(d)),g&&(t.dem=g,t.needsHillshadePrepare=!0,t.state="loaded",r(null))}t.request=o.getImage(this.map._requestManager.transformRequest(a,o.ResourceType.Tile),function(d,g){if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(d)t.state="errored",r(d);else if(g){this.map._refreshExpiredTiles&&t.setExpiryData(g),delete g.cacheControl,delete g.expires;const x=o.isImageBitmap(g)&&(Jn==null&&(Jn=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Jn)?g:o.exported.getImageData(g,1),b={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:x,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",b,u.bind(this)))}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const r=t.canonical,a=Math.pow(2,r.z),u=(r.x-1+a)%a,d=r.x===0?t.wrap-1:t.wrap,g=(r.x+1+a)%a,x=r.x+1===a?t.wrap+1:t.wrap,b={};return b[new o.OverscaledTileID(t.overscaledZ,d,r.z,u,r.y).key]={backfilled:!1},b[new o.OverscaledTileID(t.overscaledZ,x,r.z,g,r.y).key]={backfilled:!1},r.y>0&&(b[new o.OverscaledTileID(t.overscaledZ,d,r.z,u,r.y-1).key]={backfilled:!1},b[new o.OverscaledTileID(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},b[new o.OverscaledTileID(t.overscaledZ,x,r.z,g,r.y-1).key]={backfilled:!1}),r.y+1<a&&(b[new o.OverscaledTileID(t.overscaledZ,d,r.z,u,r.y+1).key]={backfilled:!1},b[new o.OverscaledTileID(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},b[new o.OverscaledTileID(t.overscaledZ,x,r.z,g,r.y+1).key]={backfilled:!1}),b}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class or extends o.Evented{constructor(t,r,a,u){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(u),this._data=r.data,this._options=o.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const d=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*d,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*d,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.EXTENT,radius:(r.clusterRadius||50)*d,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},r),this}getClusterChildren(t,r){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},r),this}getClusterLeaves(t,r,a,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:r,offset:a},u),this}_updateWorkerData(t){const r=o.extend({},this.workerOptions),a=this._data;typeof a=="string"?(r.request=this.map._requestManager.transformRequest(o.exported.resolveURL(a),o.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(a),this._pendingLoads++,this.fire(new o.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,r,(u,d)=>{if(this._pendingLoads--,this._removed||d&&d.abandoned)return;let g=null;if(d&&d.resourceTiming&&d.resourceTiming[this.id]&&(g=d.resourceTiming[this.id].slice(0)),this.actor.send(`${this.type}.coalesce`,{source:r.source},null),u)return void this.fire(new o.ErrorEvent(u));const x={dataType:"source",sourceDataType:t};this._collectResourceTiming&&g&&g.length>0&&o.extend(x,{resourceTiming:g}),this.fire(new o.Event("data",x))})}loaded(){return this._pendingLoads===0}loadTile(t,r){const a=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(a,u,(d,g)=>(delete t.request,t.unloadVectorData(),t.aborted?r(null):d?r(d):(t.loadVectorData(g,this.map.painter,a==="reloadTile"),r(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ar=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class $n extends o.Evented{constructor(t,r,a,u){super(),this.id=t,this.dispatcher=a,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=r}load(t,r){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(a,u)=>{this._loaded=!0,a?this.fire(new o.ErrorEvent(a)):u&&(this.image=u,t&&(this.coordinates=t),r&&r(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const r=t.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(u){let d=1/0,g=1/0,x=-1/0,b=-1/0;for(const O of u)d=Math.min(d,O.x),g=Math.min(g,O.y),x=Math.max(x,O.x),b=Math.max(b,O.y);const I=Math.max(x-d,b-g),k=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),L=Math.pow(2,k);return new o.CanonicalTileID(k,Math.floor((d+x)/2*L),Math.floor((g+b)/2*L))}(r),this.minzoom=this.maxzoom=this.tileID.z;const a=r.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new o.RasterBoundsArray,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(a[2].x,a[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,r=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,ar.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ft(t,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));for(const a in this.tiles){const u=this.tiles[a];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture)}}loadTile(t,r){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},r(null)):(t.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Qn extends $n{constructor(t,r,a,u){super(t,r,a,u),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const r of t.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.ResourceType.Source).url);o.getVideo(this.urls,(r,a)=>{this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):a&&(this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,r=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,ar.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new ft(t,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));for(const a in this.tiles){const u=this.tiles[a];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class lr extends $n{constructor(t,r,a,u){super(t,r,a,u),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(g=>typeof g!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,a=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,ar.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ft(r,this.canvas,a.RGBA,{premultiply:!0});for(const u in this.tiles){const d=this.tiles[u];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const dn={vector:Ht,raster:Kn,"raster-dem":pn,geojson:or,video:Qn,image:$n,canvas:lr};function Nn(c,t){const r=o.create();return o.translate(r,r,[1,1,0]),o.scale(r,r,[.5*c.width,.5*c.height,1]),o.multiply(r,r,c.calculatePosMatrix(t.toUnwrapped()))}function jn(c,t,r,a,u,d){const g=function(L,O,W){if(L)for(const U of L){const Z=O[U];if(Z&&Z.source===W&&Z.type==="fill-extrusion")return!0}else for(const U in O){const Z=O[U];if(Z.source===W&&Z.type==="fill-extrusion")return!0}return!1}(u&&u.layers,t,c.id),x=d.maxPitchScaleFactor(),b=c.tilesIn(a,x,g);b.sort(Dr);const I=[];for(const L of b)I.push({wrappedTileID:L.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(t,r,c._state,L.queryGeometry,L.cameraQueryGeometry,L.scale,u,d,x,Nn(c.transform,L.tileID))});const k=function(L){const O={},W={};for(const U of L){const Z=U.queryResults,te=U.wrappedTileID,ie=W[te]=W[te]||{};for(const oe in Z){const ne=Z[oe],ye=ie[oe]=ie[oe]||{},pe=O[oe]=O[oe]||[];for(const fe of ne)ye[fe.featureIndex]||(ye[fe.featureIndex]=!0,pe.push(fe))}}return O}(I);for(const L in k)k[L].forEach(O=>{const W=O.feature,U=c.getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=U});return k}function Dr(c,t){const r=c.tileID,a=t.tileID;return r.overscaledZ-a.overscaledZ||r.canonical.y-a.canonical.y||r.wrap-a.wrap||r.canonical.x-a.canonical.x}class Ms{constructor(t,r){this.tileID=t,this.uid=o.uniqueId(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const r=t+this.timeAdded;r<o.exported.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}loadVectorData(t,r,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(u,d){const g={};if(!d)return g;for(const x of u){const b=x.layerIds.map(I=>d.getLayer(I)).filter(Boolean);if(b.length!==0){x.layers=b,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(I=>b.filter(k=>k.id===I)[0]));for(const I of b)g[I.id]=x}}return g}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const d=this.buckets[u];if(d instanceof o.SymbolBucket){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const d=this.buckets[u];if(d instanceof o.SymbolBucket&&d.hasRTLText){this.hasRTLText=!0,o.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const u in this.buckets){const d=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(u).queryRadius(d))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new o.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const a in this.buckets){const u=this.buckets[a];u.uploadPending()&&u.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ft(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ft(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,r,a,u,d,g,x,b,I,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:d,scale:g,tileSize:this.tileSize,pixelPosMatrix:k,transform:b,params:x,queryPadding:this.queryPadding*I},t,r,a):{}}querySourceFeatures(t,r){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),d=r?r.sourceLayer:"",g=u._geojsonTileLayer||u[d];if(!g)return;const x=o.createFilter(r&&r.filter),{z:b,x:I,y:k}=this.tileID.canonical,L={z:b,x:I,y:k};for(let O=0;O<g.length;O++){const W=g.feature(O);if(x.needGeometry){const te=o.toEvaluationFeature(W,!0);if(!x.filter(new o.EvaluationParameters(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!x.filter(new o.EvaluationParameters(this.tileID.overscaledZ),W))continue;const U=a.getId(W,d),Z=new o.GeoJSONFeature(W,b,I,k,U);Z.tile=L,t.push(Z)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const a=o.parseCacheControl(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(r)if(this.expirationTime<r)u=!0;else{const d=this.expirationTime-r;d?this.expirationTime=a+Math.max(d,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!r.style.hasLayer(u))continue;const d=this.buckets[u],g=d.layers[0].sourceLayer||"_geojsonTileLayer",x=a[g],b=t[g];if(!x||!b||Object.keys(b).length===0)continue;d.update(b,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});const I=r&&r.style&&r.style.getLayer(u);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.exported.now()+t}setDependencies(t,r){const a={};for(const u of r)a[u]=!0;this.dependencies[t]=a}hasDependency(t,r){for(const a of t){const u=this.dependencies[a];if(u){for(const d of r)if(u[d])return!0}}return!1}}class is{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,a){const u=t.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const d={value:r,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(t,d)},a)),this.data[u].push(d),this.order.push(u),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const a=t.wrapped().key,u=r===void 0?0:this.data[a].indexOf(r),d=this.data[a][u];return this.data[a].splice(u,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const a in this.data)for(const u of this.data[a])t(u.value)||r.push(u);for(const a of r)this.remove(a.value.tileID,a)}}class Ds{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,a){const u=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][u]=this.stateChanges[t][u]||{},o.extend(this.stateChanges[t][u],a),this.deletedStates[t]===null){this.deletedStates[t]={};for(const d in this.state[t])d!==u&&(this.deletedStates[t][d]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][u]===null){this.deletedStates[t][u]={};for(const d in this.state[t][u])a[d]||(this.deletedStates[t][u][d]=null)}else for(const d in a)this.deletedStates[t]&&this.deletedStates[t][u]&&this.deletedStates[t][u][d]===null&&delete this.deletedStates[t][u][d]}removeFeatureState(t,r,a){if(this.deletedStates[t]===null)return;const u=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&r!==void 0)this.deletedStates[t][u]!==null&&(this.deletedStates[t][u]=this.deletedStates[t][u]||{},this.deletedStates[t][u][a]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][u])for(a in this.deletedStates[t][u]={},this.stateChanges[t][u])this.deletedStates[t][u][a]=null;else this.deletedStates[t][u]=null;else this.deletedStates[t]=null}getState(t,r){const a=String(r),u=o.extend({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const d=this.deletedStates[t][r];if(d===null)return{};for(const g in d)delete u[g]}return u}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const d={};for(const g in this.stateChanges[u])this.state[u][g]||(this.state[u][g]={}),o.extend(this.state[u][g],this.stateChanges[u][g]),d[g]=this.state[u][g];a[u]=d}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const d={};if(this.deletedStates[u]===null)for(const g in this.state[u])d[g]={},this.state[u][g]={};else for(const g in this.deletedStates[u]){if(this.deletedStates[u][g]===null)this.state[u][g]={};else for(const x of Object.keys(this.deletedStates[u][g]))delete this.state[u][g][x];d[g]=this.state[u][g]}a[u]=a[u]||{},o.extend(a[u],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const u in t)t[u].setFeatureState(a,r)}}class fi extends o.Evented{constructor(t,r,a){super(),this.id=t,this.dispatcher=a,this.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(u,d,g,x){const b=new dn[d.type](u,d,g,x);if(b.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${b.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],b),b}(t,r,a,this),this._tiles={},this._cache=new is(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ds}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const r=this._tiles[t];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new o.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const a=this._tiles[r];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(er).map(t=>t.key)}getRenderableIds(t){const r=[];for(const a in this._tiles)this._isIdRenderable(a,t)&&r.push(this._tiles[a]);return t?r.sort((a,u)=>{const d=a.tileID,g=u.tileID,x=new o.pointGeometry(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),b=new o.pointGeometry(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-g.overscaledZ||b.y-x.y||b.x-x.x}).map(a=>a.tileID.key):r.map(a=>a.tileID).sort(er).map(a=>a.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,r){const a=this._tiles[t];a&&(a.state!=="loading"&&(a.state=r),this._loadTile(a,this._tileLoaded.bind(this,a,t,r)))}_tileLoaded(t,r,a,u){if(u)return t.state="errored",void(u.status!==404?this._source.fire(new o.ErrorEvent(u,{tile:t})):this.update(this.transform));t.timeAdded=o.exported.now(),a==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new o.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const r=this.getRenderableIds();for(let u=0;u<r.length;u++){const d=r[u];if(t.neighboringTiles&&t.neighboringTiles[d]){const g=this.getTileByID(d);a(t,g),a(g,t)}}function a(u,d){u.needsHillshadePrepare=!0;let g=d.tileID.canonical.x-u.tileID.canonical.x;const x=d.tileID.canonical.y-u.tileID.canonical.y,b=Math.pow(2,u.tileID.canonical.z),I=d.tileID.key;g===0&&x===0||Math.abs(x)>1||(Math.abs(g)>1&&(Math.abs(g+b)===1?g+=b:Math.abs(g-b)===1&&(g-=b)),d.dem&&u.dem&&(u.dem.backfillBorder(d.dem,g,x),u.neighboringTiles&&u.neighboringTiles[I]&&(u.neighboringTiles[I].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,a,u){for(const d in this._tiles){let g=this._tiles[d];if(u[d]||!g.hasData()||g.tileID.overscaledZ<=r||g.tileID.overscaledZ>a)continue;let x=g.tileID;for(;g&&g.tileID.overscaledZ>r+1;){const I=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[I.key],g&&g.hasData()&&(x=I)}let b=x;for(;b.overscaledZ>r;)if(b=b.scaledTo(b.overscaledZ-1),t[b.key]){u[x.key]=x;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=t.overscaledZ-1;a>=r;a--){const u=t.scaledTo(a),d=this._getLoadedTile(u);if(d)return d}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const r=Math.ceil(t.width/this._source.tileSize)+1,a=Math.ceil(t.height/this._source.tileSize)+1,u=Math.floor(r*a*5),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(d)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const a={};for(const u in this._tiles){const d=this._tiles[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+r),a[d.tileID.key]=d}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}update(t){if(this.transform=t,!this._sourceLoaded||this._paused)return;let r;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?r=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new o.OverscaledTileID(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(r=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(r=r.filter(b=>this._source.hasTile(b)))):r=[];const a=t.coveringZoomLevel(this._source),u=Math.max(a-fi.maxOverzooming,this._source.minzoom),d=Math.max(a+fi.maxUnderzooming,this._source.minzoom),g=this._updateRetainedTiles(r,a);if(ns(this._source.type)){const b={},I={},k=Object.keys(g);for(const L of k){const O=g[L],W=this._tiles[L];if(!W||W.fadeEndTime&&W.fadeEndTime<=o.exported.now())continue;const U=this.findLoadedParent(O,u);U&&(this._addTile(U.tileID),b[U.tileID.key]=U.tileID),I[L]=O}this._retainLoadedChildren(I,a,d,g);for(const L in b)g[L]||(this._coveredTiles[L]=!0,g[L]=b[L])}for(const b in g)this._tiles[b].clearFadeHold();const x=o.keysDifference(this._tiles,g);for(const b of x){const I=this._tiles[b];I.hasSymbolBuckets&&!I.holdingForFade()?I.setHoldDuration(this.map._fadeDuration):I.hasSymbolBuckets&&!I.symbolFadeFinished()||this._removeTile(b)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,r){const a={},u={},d=Math.max(r-fi.maxOverzooming,this._source.minzoom),g=Math.max(r+fi.maxUnderzooming,this._source.minzoom),x={};for(const b of t){const I=this._addTile(b);a[b.key]=b,I.hasData()||r<this._source.maxzoom&&(x[b.key]=b)}this._retainLoadedChildren(x,r,g,a);for(const b of t){let I=this._tiles[b.key];if(I.hasData())continue;if(r+1>this._source.maxzoom){const L=b.children(this._source.maxzoom)[0],O=this.getTile(L);if(O&&O.hasData()){a[L.key]=L;continue}}else{const L=b.children(this._source.maxzoom);if(a[L[0].key]&&a[L[1].key]&&a[L[2].key]&&a[L[3].key])continue}let k=I.wasRequested();for(let L=b.overscaledZ-1;L>=d;--L){const O=b.scaledTo(L);if(u[O.key]||(u[O.key]=!0,I=this.getTile(O),!I&&k&&(I=this._addTile(O)),I&&(a[O.key]=O,k=I.wasRequested(),I.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let a,u=this._tiles[t].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}r.push(u.key);const d=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;u=d}for(const d of r)this._loadedParentTiles[d]=a}}_addTile(t){let r=this._tiles[t.key];if(r)return r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const a=r;return r||(r=new Ms(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))),r.uses++,this._tiles[t.key]=r,a||this._source.fire(new o.Event("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const a=r.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,r,a){const u=[],d=this.transform;if(!d)return u;const g=a?d.getCameraQueryGeometry(t):t,x=t.map(U=>d.pointCoordinate(U)),b=g.map(U=>d.pointCoordinate(U)),I=this.getIds();let k=1/0,L=1/0,O=-1/0,W=-1/0;for(const U of b)k=Math.min(k,U.x),L=Math.min(L,U.y),O=Math.max(O,U.x),W=Math.max(W,U.y);for(let U=0;U<I.length;U++){const Z=this._tiles[I[U]];if(Z.holdingForFade())continue;const te=Z.tileID,ie=Math.pow(2,d.zoom-Z.tileID.overscaledZ),oe=r*Z.queryPadding*o.EXTENT/Z.tileSize/ie,ne=[te.getTilePoint(new o.MercatorCoordinate(k,L)),te.getTilePoint(new o.MercatorCoordinate(O,W))];if(ne[0].x-oe<o.EXTENT&&ne[0].y-oe<o.EXTENT&&ne[1].x+oe>=0&&ne[1].y+oe>=0){const ye=x.map(fe=>te.getTilePoint(fe)),pe=b.map(fe=>te.getTilePoint(fe));u.push({tile:Z,tileID:te,queryGeometry:ye,cameraQueryGeometry:pe,scale:ie})}}return u}getVisibleCoordinates(t){const r=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);for(const a of r)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(ns(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=o.exported.now())return!0}return!1}setFeatureState(t,r,a){this._state.updateState(t=t||"_geojsonTileLayer",r,a)}removeFeatureState(t,r,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,a)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,a){const u=this._tiles[t];u&&u.setDependencies(r,a)}reloadTilesForDependencies(t,r){for(const a in this._tiles)this._tiles[a].hasDependency(t,r)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(t,r))}}function er(c,t){const r=Math.abs(2*c.wrap)-+(c.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return c.overscaledZ-t.overscaledZ||a-r||t.canonical.y-c.canonical.y||t.canonical.x-c.canonical.x}function ns(c){return c==="raster"||c==="image"||c==="video"}fi.maxOverzooming=10,fi.maxUnderzooming=3;const cr="mapboxgl_preloaded_worker_pool";class En{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<En.workerCount;)this.workers.push(new Worker(As.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[cr]}numActive(){return Object.keys(this.active).length}}const Ls=Math.floor(o.exported.hardwareConcurrency/2);let qn;function Cn(){return qn||(qn=new En),qn}function zn(c,t){const r={};for(const a in c)a!=="ref"&&(r[a]=c[a]);return o.refProperties.forEach(a=>{a in t&&(r[a]=t[a])}),r}function rs(c){c=c.slice();const t=Object.create(null);for(let r=0;r<c.length;r++)t[c[r].id]=c[r];for(let r=0;r<c.length;r++)"ref"in c[r]&&(c[r]=zn(c[r],t[c[r].ref]));return c}En.workerCount=Math.max(Math.min(Ls,6),1);const wt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ur(c,t,r){r.push({command:wt.addSource,args:[c,t[c]]})}function tr(c,t,r){t.push({command:wt.removeSource,args:[c]}),r[c]=!0}function hr(c,t,r,a){tr(c,r,a),ur(c,t,r)}function ss(c,t,r){let a;for(a in c[r])if(Object.prototype.hasOwnProperty.call(c[r],a)&&a!=="data"&&!K(c[r][a],t[r][a]))return!1;for(a in t[r])if(Object.prototype.hasOwnProperty.call(t[r],a)&&a!=="data"&&!K(c[r][a],t[r][a]))return!1;return!0}function me(c,t,r,a,u,d){let g;for(g in t=t||{},c=c||{})Object.prototype.hasOwnProperty.call(c,g)&&(K(c[g],t[g])||r.push({command:d,args:[a,g,t[g],u]}));for(g in t)Object.prototype.hasOwnProperty.call(t,g)&&!Object.prototype.hasOwnProperty.call(c,g)&&(K(c[g],t[g])||r.push({command:d,args:[a,g,t[g],u]}))}function Le(c){return c.id}function pr(c,t){return c[t.id]=t,c}class Gn{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.clamp(t,0,1);let r=1,a=this._distances[r];const u=t*this.paddedLength+this.padding;for(;a<u&&r<this._distances.length;)a=this._distances[++r];const d=r-1,g=this._distances[d],x=a-g,b=x>0?(u-g)/x:0;return this.points[d].mult(1-b).add(this.points[r].mult(b))}}function Bt(c,t){let r=!0;return c==="always"||c!=="never"&&t!=="never"||(r=!1),r}class rn{constructor(t,r,a){const u=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(t/a),this.yCellCount=Math.ceil(r/a);for(let g=0;g<this.xCellCount*this.yCellCount;g++)u.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,a,u,d){this._forEachCell(r,a,u,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(d)}insertCircle(t,r,a,u){this._forEachCell(r-u,a-u,r+u,a+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(a),this.circles.push(u)}_insertBoxCell(t,r,a,u,d,g){this.boxCells[d].push(g)}_insertCircleCell(t,r,a,u,d,g){this.circleCells[d].push(g)}_query(t,r,a,u,d,g,x){if(a<0||t>this.width||u<0||r>this.height)return[];const b=[];if(t<=0&&r<=0&&this.width<=a&&this.height<=u){if(d)return[{key:null,x1:t,y1:r,x2:a,y2:u}];for(let I=0;I<this.boxKeys.length;I++)b.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const k=this.circles[3*I],L=this.circles[3*I+1],O=this.circles[3*I+2];b.push({key:this.circleKeys[I],x1:k-O,y1:L-O,x2:k+O,y2:L+O})}}else this._forEachCell(t,r,a,u,this._queryCell,b,{hitTest:d,overlapMode:g,seenUids:{box:{},circle:{}}},x);return b}query(t,r,a,u){return this._query(t,r,a,u,!1,null)}hitTest(t,r,a,u,d,g){return this._query(t,r,a,u,!0,d,g).length>0}hitTestCircle(t,r,a,u,d){const g=t-a,x=t+a,b=r-a,I=r+a;if(x<0||g>this.width||I<0||b>this.height)return!1;const k=[];return this._forEachCell(g,b,x,I,this._queryCellCircle,k,{hitTest:!0,overlapMode:u,circle:{x:t,y:r,radius:a},seenUids:{box:{},circle:{}}},d),k.length>0}_queryCell(t,r,a,u,d,g,x,b){const{seenUids:I,hitTest:k,overlapMode:L}=x,O=this.boxCells[d];if(O!==null){const U=this.bboxes;for(const Z of O)if(!I.box[Z]){I.box[Z]=!0;const te=4*Z,ie=this.boxKeys[Z];if(t<=U[te+2]&&r<=U[te+3]&&a>=U[te+0]&&u>=U[te+1]&&(!b||b(ie))&&(!k||!Bt(L,ie.overlapMode))&&(g.push({key:ie,x1:U[te],y1:U[te+1],x2:U[te+2],y2:U[te+3]}),k))return!0}}const W=this.circleCells[d];if(W!==null){const U=this.circles;for(const Z of W)if(!I.circle[Z]){I.circle[Z]=!0;const te=3*Z,ie=this.circleKeys[Z];if(this._circleAndRectCollide(U[te],U[te+1],U[te+2],t,r,a,u)&&(!b||b(ie))&&(!k||!Bt(L,ie.overlapMode))){const oe=U[te],ne=U[te+1],ye=U[te+2];if(g.push({key:ie,x1:oe-ye,y1:ne-ye,x2:oe+ye,y2:ne+ye}),k)return!0}}}return!1}_queryCellCircle(t,r,a,u,d,g,x,b){const{circle:I,seenUids:k,overlapMode:L}=x,O=this.boxCells[d];if(O!==null){const U=this.bboxes;for(const Z of O)if(!k.box[Z]){k.box[Z]=!0;const te=4*Z,ie=this.boxKeys[Z];if(this._circleAndRectCollide(I.x,I.y,I.radius,U[te+0],U[te+1],U[te+2],U[te+3])&&(!b||b(ie))&&!Bt(L,ie.overlapMode))return g.push(!0),!0}}const W=this.circleCells[d];if(W!==null){const U=this.circles;for(const Z of W)if(!k.circle[Z]){k.circle[Z]=!0;const te=3*Z,ie=this.circleKeys[Z];if(this._circlesCollide(U[te],U[te+1],U[te+2],I.x,I.y,I.radius)&&(!b||b(ie))&&!Bt(L,ie.overlapMode))return g.push(!0),!0}}}_forEachCell(t,r,a,u,d,g,x,b){const I=this._convertToXCellCoord(t),k=this._convertToYCellCoord(r),L=this._convertToXCellCoord(a),O=this._convertToYCellCoord(u);for(let W=I;W<=L;W++)for(let U=k;U<=O;U++)if(d.call(this,t,r,a,u,this.xCellCount*U+W,g,x,b))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,a,u,d,g){const x=u-t,b=d-r,I=a+g;return I*I>x*x+b*b}_circleAndRectCollide(t,r,a,u,d,g,x){const b=(g-u)/2,I=Math.abs(t-(u+b));if(I>b+a)return!1;const k=(x-d)/2,L=Math.abs(r-(d+k));if(L>k+a)return!1;if(I<=b||L<=k)return!0;const O=I-b,W=L-k;return O*O+W*W<=a*a}}function ki(c,t,r,a,u){const d=o.create();return t?(o.scale(d,d,[1/u,1/u,1]),r||o.rotateZ(d,d,a.angle)):o.multiply(d,a.labelPlaneMatrix,c),d}function dr(c,t,r,a,u){if(t){const d=o.clone(c);return o.scale(d,d,[u,u,1]),r||o.rotateZ(d,d,-a.angle),d}return a.glCoordMatrix}function $t(c,t){const r=[c.x,c.y,0,1];Ft(r,r,t);const a=r[3];return{point:new o.pointGeometry(r[0]/a,r[1]/a),signedDistanceFromCamera:a}}function Me(c,t){return .5+c/t*.5}function dt(c,t){const r=c[0]/c[3],a=c[1]/c[3];return r>=-t[0]&&r<=t[0]&&a>=-t[1]&&a<=t[1]}function ut(c,t,r,a,u,d,g,x,b){const I=a?c.textSizeData:c.iconSizeData,k=o.evaluateSizeForZoom(I,r.transform.zoom),L=[256/r.width*2+1,256/r.height*2+1],O=a?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;O.clear();const W=c.lineVertexArray,U=a?c.text.placedSymbolArray:c.icon.placedSymbolArray,Z=r.transform.width/r.transform.height;let te=!1;for(let ie=0;ie<U.length;ie++){const oe=U.get(ie);if(oe.hidden||oe.writingMode===o.WritingMode.vertical&&!te){ni(oe.numGlyphs,O);continue}te=!1;const ne=[oe.anchorX,oe.anchorY,0,1];if(o.transformMat4(ne,ne,t),!dt(ne,L)){ni(oe.numGlyphs,O);continue}const ye=Me(r.transform.cameraToCenterDistance,ne[3]),pe=o.evaluateSizeForFeature(I,k,oe),fe=g?pe/ye:pe*ye,Ie=new o.pointGeometry(oe.anchorX,oe.anchorY),ke=$t(Ie,u).point,_e={},qe=ht(oe,fe,!1,x,t,u,d,c.glyphOffsetArray,W,O,ke,Ie,_e,Z,b);te=qe.useVertical,(qe.notEnoughRoom||te||qe.needsFlipping&&ht(oe,fe,!0,x,t,u,d,c.glyphOffsetArray,W,O,ke,Ie,_e,Z,b).notEnoughRoom)&&ni(oe.numGlyphs,O)}a?c.text.dynamicLayoutVertexBuffer.updateData(O):c.icon.dynamicLayoutVertexBuffer.updateData(O)}function Pi(c,t,r,a,u,d,g,x,b,I,k,L){const O=x.glyphStartIndex+x.numGlyphs,W=x.lineStartIndex,U=x.lineStartIndex+x.lineLength,Z=t.getoffsetX(x.glyphStartIndex),te=t.getoffsetX(O-1),ie=mn(c*Z,r,a,u,d,g,x.segment,W,U,b,I,k,L);if(!ie)return null;const oe=mn(c*te,r,a,u,d,g,x.segment,W,U,b,I,k,L);return oe?{first:ie,last:oe}:null}function fn(c,t,r,a){return c===o.WritingMode.horizontal&&Math.abs(r.y-t.y)>Math.abs(r.x-t.x)*a?{useVertical:!0}:(c===o.WritingMode.vertical?t.y<r.y:t.x>r.x)?{needsFlipping:!0}:null}function ht(c,t,r,a,u,d,g,x,b,I,k,L,O,W,U){const Z=t/24,te=c.lineOffsetX*Z,ie=c.lineOffsetY*Z;let oe;if(c.numGlyphs>1){const ne=c.glyphStartIndex+c.numGlyphs,ye=c.lineStartIndex,pe=c.lineStartIndex+c.lineLength,fe=Pi(Z,x,te,ie,r,k,L,c,b,d,O,U);if(!fe)return{notEnoughRoom:!0};const Ie=$t(fe.first.point,g).point,ke=$t(fe.last.point,g).point;if(a&&!r){const _e=fn(c.writingMode,Ie,ke,W);if(_e)return _e}oe=[fe.first];for(let _e=c.glyphStartIndex+1;_e<ne-1;_e++)oe.push(mn(Z*x.getoffsetX(_e),te,ie,r,k,L,c.segment,ye,pe,b,d,O,U));oe.push(fe.last)}else{if(a&&!r){const ye=$t(L,u).point,pe=c.lineStartIndex+c.segment+1,fe=new o.pointGeometry(b.getx(pe),b.gety(pe)),Ie=$t(fe,u),ke=Ie.signedDistanceFromCamera>0?Ie.point:fr(L,fe,ye,1,u),_e=fn(c.writingMode,ye,ke,W);if(_e)return _e}const ne=mn(Z*x.getoffsetX(c.glyphStartIndex),te,ie,r,k,L,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,b,d,O,U);if(!ne)return{notEnoughRoom:!0};oe=[ne]}for(const ne of oe)o.addDynamicAttributes(I,ne.point,ne.angle);return{}}function fr(c,t,r,a,u){const d=$t(c.add(c.sub(t)._unit()),u).point,g=r.sub(d);return r.add(g._mult(a/g.mag()))}function mn(c,t,r,a,u,d,g,x,b,I,k,L,O){const W=a?c-t:c+t;let U=W>0?1:-1,Z=0;a&&(U*=-1,Z=Math.PI),U<0&&(Z+=Math.PI);let te=U>0?x+g:x+g+1,ie=u,oe=u,ne=0,ye=0;const pe=Math.abs(W),fe=[];for(;ne+ye<=pe;){if(te+=U,te<x||te>=b)return null;if(oe=ie,fe.push(ie),ie=L[te],ie===void 0){const Re=new o.pointGeometry(I.getx(te),I.gety(te)),ot=$t(Re,k);if(ot.signedDistanceFromCamera>0)ie=L[te]=ot.point;else{const St=te-U;ie=fr(ne===0?d:new o.pointGeometry(I.getx(St),I.gety(St)),Re,oe,pe-ne+1,k)}}ne+=ye,ye=oe.dist(ie)}const Ie=(pe-ne)/ye,ke=ie.sub(oe),_e=ke.mult(Ie)._add(oe);_e._add(ke._unit()._perp()._mult(r*U));const qe=Z+Math.atan2(ie.y-oe.y,ie.x-oe.x);return fe.push(_e),{point:_e,angle:O?qe:0,path:fe}}const Zn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ni(c,t){for(let r=0;r<c;r++){const a=t.length;t.resize(a+4),t.float32.set(Zn,3*a)}}function Ft(c,t,r){const a=t[0],u=t[1];return c[0]=r[0]*a+r[4]*u+r[12],c[1]=r[1]*a+r[5]*u+r[13],c[3]=r[3]*a+r[7]*u+r[15],c}const sn=100;class mr{constructor(t,r=new rn(t.width+200,t.height+200,25),a=new rn(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=a,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+sn,this.screenBottomBoundary=t.height+sn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200}placeCollisionBox(t,r,a,u,d){const g=this.projectAndGetPerspectiveRatio(u,t.anchorPointX,t.anchorPointY),x=a*g.perspectiveRatio,b=t.x1*x+g.point.x,I=t.y1*x+g.point.y,k=t.x2*x+g.point.x,L=t.y2*x+g.point.y;return!this.isInsideGrid(b,I,k,L)||r!=="always"&&this.grid.hitTest(b,I,k,L,r,d)?{box:[],offscreen:!1}:{box:[b,I,k,L],offscreen:this.isOffscreen(b,I,k,L)}}placeCollisionCircles(t,r,a,u,d,g,x,b,I,k,L,O,W){const U=[],Z=new o.pointGeometry(r.anchorX,r.anchorY),te=$t(Z,g),ie=Me(this.transform.cameraToCenterDistance,te.signedDistanceFromCamera),oe=(k?d/ie:d*ie)/o.ONE_EM,ne=$t(Z,x).point,ye=Pi(oe,u,r.lineOffsetX*oe,r.lineOffsetY*oe,!1,ne,Z,r,a,x,{},!1);let pe=!1,fe=!1,Ie=!0;if(ye){const ke=.5*O*ie+W,_e=new o.pointGeometry(-100,-100),qe=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Re=new Gn,ot=ye.first,St=ye.last;let gt=[];for(let at=ot.path.length-1;at>=1;at--)gt.push(ot.path[at]);for(let at=1;at<St.path.length;at++)gt.push(St.path[at]);const vt=2.5*ke;if(b){const at=gt.map(Tt=>$t(Tt,b));gt=at.some(Tt=>Tt.signedDistanceFromCamera<=0)?[]:at.map(Tt=>Tt.point)}let Yt=[];if(gt.length>0){const at=gt[0].clone(),Tt=gt[0].clone();for(let Lt=1;Lt<gt.length;Lt++)at.x=Math.min(at.x,gt[Lt].x),at.y=Math.min(at.y,gt[Lt].y),Tt.x=Math.max(Tt.x,gt[Lt].x),Tt.y=Math.max(Tt.y,gt[Lt].y);Yt=at.x>=_e.x&&Tt.x<=qe.x&&at.y>=_e.y&&Tt.y<=qe.y?[gt]:Tt.x<_e.x||at.x>qe.x||Tt.y<_e.y||at.y>qe.y?[]:o.clipLine([gt],_e.x,_e.y,qe.x,qe.y)}for(const at of Yt){Re.reset(at,.25*ke);let Tt=0;Tt=Re.length<=.5*ke?1:Math.ceil(Re.paddedLength/vt)+1;for(let Lt=0;Lt<Tt;Lt++){const vi=Lt/Math.max(Tt-1,1),Yi=Re.lerp(vi),an=Yi.x+sn,ln=Yi.y+sn;U.push(an,ln,ke,0);const nr=an-ke,Vi=ln-ke,Pn=an+ke,Ar=ln+ke;if(Ie=Ie&&this.isOffscreen(nr,Vi,Pn,Ar),fe=fe||this.isInsideGrid(nr,Vi,Pn,Ar),t!=="always"&&this.grid.hitTestCircle(an,ln,ke,t,L)&&(pe=!0,!I))return{circles:[],offscreen:!1,collisionDetected:pe}}}}return{circles:!I&&pe||!fe?[]:U,offscreen:Ie,collisionDetected:pe}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let a=1/0,u=1/0,d=-1/0,g=-1/0;for(const k of t){const L=new o.pointGeometry(k.x+sn,k.y+sn);a=Math.min(a,L.x),u=Math.min(u,L.y),d=Math.max(d,L.x),g=Math.max(g,L.y),r.push(L)}const x=this.grid.query(a,u,d,g).concat(this.ignoredGrid.query(a,u,d,g)),b={},I={};for(const k of x){const L=k.key;if(b[L.bucketInstanceId]===void 0&&(b[L.bucketInstanceId]={}),b[L.bucketInstanceId][L.featureIndex])continue;const O=[new o.pointGeometry(k.x1,k.y1),new o.pointGeometry(k.x2,k.y1),new o.pointGeometry(k.x2,k.y2),new o.pointGeometry(k.x1,k.y2)];o.polygonIntersectsPolygon(r,O)&&(b[L.bucketInstanceId][L.featureIndex]=!0,I[L.bucketInstanceId]===void 0&&(I[L.bucketInstanceId]=[]),I[L.bucketInstanceId].push(L.featureIndex))}return I}insertCollisionBox(t,r,a,u,d,g){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:d,collisionGroupID:g,overlapMode:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,a,u,d,g){const x=a?this.ignoredGrid:this.grid,b={bucketInstanceId:u,featureIndex:d,collisionGroupID:g,overlapMode:r};for(let I=0;I<t.length;I+=4)x.insertCircle(b,t[I],t[I+1],t[I+2])}projectAndGetPerspectiveRatio(t,r,a){const u=[r,a,0,1];return Ft(u,u,t),{point:new o.pointGeometry((u[0]/u[3]+1)/2*this.transform.width+sn,(-u[1]/u[3]+1)/2*this.transform.height+sn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/u[3]*.5}}isOffscreen(t,r,a,u){return a<sn||t>=this.screenRightBoundary||u<sn||r>this.screenBottomBoundary}isInsideGrid(t,r,a,u){return a>=0&&t<this.gridRightBoundary&&u>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=o.identity([]);return o.translate(t,t,[-100,-100,0]),t}}function ui(c,t,r){return t*(o.EXTENT/(c.tileSize*Math.pow(2,r-c.tileID.overscaledZ)))}class gn{constructor(t,r,a,u){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):u&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class _n{constructor(t,r,a,u,d){this.text=new gn(t?t.text:null,r,a,d),this.icon=new gn(t?t.icon:null,r,u,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class os{constructor(t,r,a){this.text=t,this.icon=r,this.skipFade=a}}class Lr{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Rr{constructor(t,r,a,u,d){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=a,this.bucketIndex=u,this.tileID=d}}class ${constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:a=>a.collisionGroupID===r}}return this.collisionGroups[t]}}function S(c,t,r,a,u){const{horizontalAlign:d,verticalAlign:g}=o.getAnchorAlignment(c),x=-(d-.5)*t,b=-(g-.5)*r,I=o.evaluateVariableOffset(c,a);return new o.pointGeometry(x+I[0]*u,b+I[1]*u)}function E(c,t,r,a,u,d){const{x1:g,x2:x,y1:b,y2:I,anchorPointX:k,anchorPointY:L}=c,O=new o.pointGeometry(t,r);return a&&O._rotate(u?d:-d),{x1:g+O.x,y1:b+O.y,x2:x+O.x,y2:I+O.y,anchorPointX:k,anchorPointY:L}}class F{constructor(t,r,a,u){this.transform=t.clone(),this.collisionIndex=new mr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new $(a),this.collisionCircleArrays={},this.prevPlacement=u,u&&(u.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,a,u){const d=a.getBucket(r),g=a.latestFeatureIndex;if(!d||!g||r.id!==d.layerIds[0])return;const x=a.collisionBoxArray,b=d.layers[0].layout,I=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),k=a.tileSize/o.EXTENT,L=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),O=b.get("text-pitch-alignment")==="map",W=b.get("text-rotation-alignment")==="map",U=ui(a,1,this.transform.zoom),Z=ki(L,O,W,this.transform,U);let te=null;if(O){const oe=dr(L,O,W,this.transform,U);te=o.multiply([],this.transform.labelPlaneMatrix,oe)}this.retainedQueryData[d.bucketInstanceId]=new Rr(d.bucketInstanceId,g,d.sourceLayerIndex,d.index,a.tileID);const ie={bucket:d,layout:b,posMatrix:L,textLabelPlaneMatrix:Z,labelToScreenMatrix:te,scale:I,textPixelRatio:k,holdingForFade:a.holdingForFade(),collisionBoxArray:x,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(u)for(const oe of d.sortKeyRanges){const{sortKey:ne,symbolInstanceStart:ye,symbolInstanceEnd:pe}=oe;t.push({sortKey:ne,symbolInstanceStart:ye,symbolInstanceEnd:pe,parameters:ie})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(t,r,a,u,d,g,x,b,I,k,L,O,W,U,Z){const te=[O.textOffset0,O.textOffset1],ie=S(t,a,u,te,d),oe=this.collisionIndex.placeCollisionBox(E(r,ie.x,ie.y,g,x,this.transform.angle),L,b,I,k.predicate);if((!Z||this.collisionIndex.placeCollisionBox(E(Z,ie.x,ie.y,g,x,this.transform.angle),L,b,I,k.predicate).box.length!==0)&&oe.box.length>0){let ne;return this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(ne=this.prevPlacement.variableOffsets[O.crossTileID].anchor),this.variableOffsets[O.crossTileID]={textOffset:te,width:a,height:u,anchor:t,textBoxScale:d,prevAnchor:ne},this.markUsedJustification(W,t,O,U),W.allowVerticalPlacement&&(this.markUsedOrientation(W,U,O),this.placedOrientations[O.crossTileID]=U),{shift:ie,placedGlyphBoxes:oe}}}placeLayerBucketPart(t,r,a){const{bucket:u,layout:d,posMatrix:g,textLabelPlaneMatrix:x,labelToScreenMatrix:b,textPixelRatio:I,holdingForFade:k,collisionBoxArray:L,partiallyEvaluatedTextSize:O,collisionGroup:W}=t.parameters,U=d.get("text-optional"),Z=d.get("icon-optional"),te=o.getOverlapMode(d,"text-overlap","text-allow-overlap"),ie=te==="always",oe=o.getOverlapMode(d,"icon-overlap","icon-allow-overlap"),ne=oe==="always",ye=d.get("text-rotation-alignment")==="map",pe=d.get("text-pitch-alignment")==="map",fe=d.get("icon-text-fit")!=="none",Ie=d.get("symbol-z-order")==="viewport-y",ke=ie&&(ne||!u.hasIconData()||Z),_e=ne&&(ie||!u.hasTextData()||U);!u.collisionArrays&&L&&u.deserializeCollisionBoxes(L);const qe=(Re,ot)=>{if(r[Re.crossTileID])return;if(k)return void(this.placements[Re.crossTileID]=new os(!1,!1,!1));let St=!1,gt=!1,vt=!0,Yt=null,at={box:null,offscreen:null},Tt={box:null,offscreen:null},Lt=null,vi=null,Yi=null,an=0,ln=0,nr=0;ot.textFeatureIndex?an=ot.textFeatureIndex:Re.useRuntimeCollisionCircles&&(an=Re.featureIndex),ot.verticalTextFeatureIndex&&(ln=ot.verticalTextFeatureIndex);const Vi=ot.textBox;if(Vi){const Ki=Pt=>{let si=o.WritingMode.horizontal;if(u.allowVerticalPlacement&&!Pt&&this.prevPlacement){const Mi=this.prevPlacement.placedOrientations[Re.crossTileID];Mi&&(this.placedOrientations[Re.crossTileID]=Mi,si=Mi,this.markUsedOrientation(u,si,Re))}return si},Et=(Pt,si)=>{if(u.allowVerticalPlacement&&Re.numVerticalGlyphVertices>0&&ot.verticalTextBox){for(const Mi of u.writingModes)if(Mi===o.WritingMode.vertical?(at=si(),Tt=at):at=Pt(),at&&at.box&&at.box.length)break}else at=Pt()};if(d.get("text-variable-anchor")){let Pt=d.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Re.crossTileID]){const Gt=this.prevPlacement.variableOffsets[Re.crossTileID];Pt.indexOf(Gt.anchor)>0&&(Pt=Pt.filter(Ir=>Ir!==Gt.anchor),Pt.unshift(Gt.anchor))}const si=(Gt,Ir,Mn)=>{const lo=Gt.x2-Gt.x1,aa=Gt.y2-Gt.y1,co=Re.textBoxScale,cl=fe&&oe==="never"?Ir:null;let Tr={box:[],offscreen:!1};const uo=te!=="never"?2*Pt.length:Pt.length;for(let Dn=0;Dn<uo;++Dn){const Hr=this.attemptAnchorPlacement(Pt[Dn%Pt.length],Gt,lo,aa,co,ye,pe,I,g,W,Dn>=Pt.length?te:"never",Re,u,Mn,cl);if(Hr&&(Tr=Hr.placedGlyphBoxes,Tr&&Tr.box&&Tr.box.length)){St=!0,Yt=Hr.shift;break}}return Tr};Et(()=>si(Vi,ot.iconBox,o.WritingMode.horizontal),()=>{const Gt=ot.verticalTextBox;return u.allowVerticalPlacement&&!(at&&at.box&&at.box.length)&&Re.numVerticalGlyphVertices>0&&Gt?si(Gt,ot.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),at&&(St=at.box,vt=at.offscreen);const Mi=Ki(at&&at.box);if(!St&&this.prevPlacement){const Gt=this.prevPlacement.variableOffsets[Re.crossTileID];Gt&&(this.variableOffsets[Re.crossTileID]=Gt,this.markUsedJustification(u,Gt.anchor,Re,Mi))}}else{const Pt=(si,Mi)=>{const Gt=this.collisionIndex.placeCollisionBox(si,te,I,g,W.predicate);return Gt&&Gt.box&&Gt.box.length&&(this.markUsedOrientation(u,Mi,Re),this.placedOrientations[Re.crossTileID]=Mi),Gt};Et(()=>Pt(Vi,o.WritingMode.horizontal),()=>{const si=ot.verticalTextBox;return u.allowVerticalPlacement&&Re.numVerticalGlyphVertices>0&&si?Pt(si,o.WritingMode.vertical):{box:null,offscreen:null}}),Ki(at&&at.box&&at.box.length)}}if(Lt=at,St=Lt&&Lt.box&&Lt.box.length>0,vt=Lt&&Lt.offscreen,Re.useRuntimeCollisionCircles){const Ki=u.text.placedSymbolArray.get(Re.centerJustifiedTextSymbolIndex),Et=o.evaluateSizeForFeature(u.textSizeData,O,Ki),Pt=d.get("text-padding");vi=this.collisionIndex.placeCollisionCircles(te,Ki,u.lineVertexArray,u.glyphOffsetArray,Et,g,x,b,a,pe,W.predicate,Re.collisionCircleDiameter,Pt),St=ie||vi.circles.length>0&&!vi.collisionDetected,vt=vt&&vi.offscreen}if(ot.iconFeatureIndex&&(nr=ot.iconFeatureIndex),ot.iconBox){const Ki=Et=>{const Pt=fe&&Yt?E(Et,Yt.x,Yt.y,ye,pe,this.transform.angle):Et;return this.collisionIndex.placeCollisionBox(Pt,oe,I,g,W.predicate)};Tt&&Tt.box&&Tt.box.length&&ot.verticalIconBox?(Yi=Ki(ot.verticalIconBox),gt=Yi.box.length>0):(Yi=Ki(ot.iconBox),gt=Yi.box.length>0),vt=vt&&Yi.offscreen}const Pn=U||Re.numHorizontalGlyphVertices===0&&Re.numVerticalGlyphVertices===0,Ar=Z||Re.numIconVertices===0;if(Pn||Ar?Ar?Pn||(gt=gt&&St):St=gt&&St:gt=St=gt&&St,St&&Lt&&Lt.box&&this.collisionIndex.insertCollisionBox(Lt.box,te,d.get("text-ignore-placement"),u.bucketInstanceId,Tt&&Tt.box&&ln?ln:an,W.ID),gt&&Yi&&this.collisionIndex.insertCollisionBox(Yi.box,oe,d.get("icon-ignore-placement"),u.bucketInstanceId,nr,W.ID),vi&&(St&&this.collisionIndex.insertCollisionCircles(vi.circles,te,d.get("text-ignore-placement"),u.bucketInstanceId,an,W.ID),a)){const Ki=u.bucketInstanceId;let Et=this.collisionCircleArrays[Ki];Et===void 0&&(Et=this.collisionCircleArrays[Ki]=new Lr);for(let Pt=0;Pt<vi.circles.length;Pt+=4)Et.circles.push(vi.circles[Pt+0]),Et.circles.push(vi.circles[Pt+1]),Et.circles.push(vi.circles[Pt+2]),Et.circles.push(vi.collisionDetected?1:0)}this.placements[Re.crossTileID]=new os(St||ke,gt||_e,vt||u.justReloaded),r[Re.crossTileID]=!0};if(Ie){const Re=u.getSortedSymbolIndexes(this.transform.angle);for(let ot=Re.length-1;ot>=0;--ot){const St=Re[ot];qe(u.symbolInstances.get(St),u.collisionArrays[St])}}else for(let Re=t.symbolInstanceStart;Re<t.symbolInstanceEnd;Re++)qe(u.symbolInstances.get(Re),u.collisionArrays[Re]);if(a&&u.bucketInstanceId in this.collisionCircleArrays){const Re=this.collisionCircleArrays[u.bucketInstanceId];o.invert(Re.invProjMatrix,g),Re.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}markUsedJustification(t,r,a,u){let d;d=u===o.WritingMode.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(r)];const g=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const x of g)x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=d>=0&&x!==d?0:a.crossTileID)}markUsedOrientation(t,r,a){const u=r===o.WritingMode.horizontal||r===o.WritingMode.horizontalOnly?r:0,d=r===o.WritingMode.vertical?r:0,g=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const x of g)t.text.placedSymbolArray.get(x).placedOrientation=u;a.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let a=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const u=r?r.symbolFadeChange(t):1,d=r?r.opacities:{},g=r?r.variableOffsets:{},x=r?r.placedOrientations:{};for(const b in this.placements){const I=this.placements[b],k=d[b];k?(this.opacities[b]=new _n(k,u,I.text,I.icon),a=a||I.text!==k.text.placed||I.icon!==k.icon.placed):(this.opacities[b]=new _n(null,u,I.text,I.icon,I.skipFade),a=a||I.text||I.icon)}for(const b in d){const I=d[b];if(!this.opacities[b]){const k=new _n(I,u,!1,!1);k.isHidden()||(this.opacities[b]=k,a=a||I.text.placed||I.icon.placed)}}for(const b in g)this.variableOffsets[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.variableOffsets[b]=g[b]);for(const b in x)this.placedOrientations[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.placedOrientations[b]=x[b]);a?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r){const a={};for(const u of r){const d=u.getBucket(t);d&&u.latestFeatureIndex&&t.id===d.layerIds[0]&&this.updateBucketOpacities(d,a,u.collisionBoxArray)}}updateBucketOpacities(t,r,a){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const u=t.layers[0].layout,d=new _n(null,0,!1,!1,!0),g=u.get("text-allow-overlap"),x=u.get("icon-allow-overlap"),b=u.get("text-variable-anchor"),I=u.get("text-rotation-alignment")==="map",k=u.get("text-pitch-alignment")==="map",L=u.get("icon-text-fit")!=="none",O=new _n(null,0,g&&(x||!t.hasIconData()||u.get("icon-optional")),x&&(g||!t.hasTextData()||u.get("text-optional")),!0);!t.collisionArrays&&a&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(a);const W=(U,Z,te)=>{for(let ie=0;ie<Z/4;ie++)U.opacityVertexArray.emplaceBack(te)};for(let U=0;U<t.symbolInstances.length;U++){const Z=t.symbolInstances.get(U),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:ie,crossTileID:oe}=Z;let ne=this.opacities[oe];r[oe]?ne=d:ne||(ne=O,this.opacities[oe]=ne),r[oe]=!0;const ye=Z.numIconVertices>0,pe=this.placedOrientations[Z.crossTileID],fe=pe===o.WritingMode.vertical,Ie=pe===o.WritingMode.horizontal||pe===o.WritingMode.horizontalOnly;if(te>0||ie>0){const ke=he(ne.text);W(t.text,te,fe?Ge:ke),W(t.text,ie,Ie?Ge:ke);const _e=ne.text.isHidden();[Z.rightJustifiedTextSymbolIndex,Z.centerJustifiedTextSymbolIndex,Z.leftJustifiedTextSymbolIndex].forEach(ot=>{ot>=0&&(t.text.placedSymbolArray.get(ot).hidden=_e||fe?1:0)}),Z.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Z.verticalPlacedTextSymbolIndex).hidden=_e||Ie?1:0);const qe=this.variableOffsets[Z.crossTileID];qe&&this.markUsedJustification(t,qe.anchor,Z,pe);const Re=this.placedOrientations[Z.crossTileID];Re&&(this.markUsedJustification(t,"left",Z,Re),this.markUsedOrientation(t,Re,Z))}if(ye){const ke=he(ne.icon),_e=!(L&&Z.verticalPlacedIconSymbolIndex&&fe);Z.placedIconSymbolIndex>=0&&(W(t.icon,Z.numIconVertices,_e?ke:Ge),t.icon.placedSymbolArray.get(Z.placedIconSymbolIndex).hidden=ne.icon.isHidden()),Z.verticalPlacedIconSymbolIndex>=0&&(W(t.icon,Z.numVerticalIconVertices,_e?Ge:ke),t.icon.placedSymbolArray.get(Z.verticalPlacedIconSymbolIndex).hidden=ne.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ke=t.collisionArrays[U];if(ke){let _e=new o.pointGeometry(0,0);if(ke.textBox||ke.verticalTextBox){let Re=!0;if(b){const ot=this.variableOffsets[oe];ot?(_e=S(ot.anchor,ot.width,ot.height,ot.textOffset,ot.textBoxScale),I&&_e._rotate(k?this.transform.angle:-this.transform.angle)):Re=!1}ke.textBox&&N(t.textCollisionBox.collisionVertexArray,ne.text.placed,!Re||fe,_e.x,_e.y),ke.verticalTextBox&&N(t.textCollisionBox.collisionVertexArray,ne.text.placed,!Re||Ie,_e.x,_e.y)}const qe=Boolean(!Ie&&ke.verticalIconBox);ke.iconBox&&N(t.iconCollisionBox.collisionVertexArray,ne.icon.placed,qe,L?_e.x:0,L?_e.y:0),ke.verticalIconBox&&N(t.iconCollisionBox.collisionVertexArray,ne.icon.placed,!qe,L?_e.x:0,L?_e.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const U=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=U.invProjMatrix,t.placementViewportMatrix=U.viewportMatrix,t.collisionCircleArray=U.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const a=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*a>t}setStale(){this.stale=!0}}function N(c,t,r,a,u){c.emplaceBack(t?1:0,r?1:0,a||0,u||0),c.emplaceBack(t?1:0,r?1:0,a||0,u||0),c.emplaceBack(t?1:0,r?1:0,a||0,u||0),c.emplaceBack(t?1:0,r?1:0,a||0,u||0)}const q=Math.pow(2,25),Q=Math.pow(2,24),Y=Math.pow(2,17),J=Math.pow(2,16),ee=Math.pow(2,9),de=Math.pow(2,8),we=Math.pow(2,1);function he(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,r=Math.floor(127*c.opacity);return r*q+t*Q+r*Y+t*J+r*ee+t*de+r*we+t}const Ge=0;class Ue{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,r,a,u,d){const g=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(g,u,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,g.sort((x,b)=>x.sortKey-b.sortKey));this._currentPartIndex<g.length;)if(r.placeLayerBucketPart(g[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,d())return!0;return!1}}class Xe{constructor(t,r,a,u,d,g,x){this.placement=new F(t,d,g,x),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=a,this._showCollisionBoxes=u,this._done=!1}isDone(){return this._done}continuePlacement(t,r,a){const u=o.exported.now(),d=()=>{const g=o.exported.now()-u;return!this._forceFullPlacement&&g>2};for(;this._currentPlacementIndex>=0;){const g=r[t[this._currentPlacementIndex]],x=this.placement.collisionIndex.transform.zoom;if(g.type==="symbol"&&(!g.minzoom||g.minzoom<=x)&&(!g.maxzoom||g.maxzoom>x)){if(this._inProgressLayer||(this._inProgressLayer=new Ue(g)),this._inProgressLayer.continuePlacement(a[g.source],this.placement,this._showCollisionBoxes,g,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const tt=512/o.EXTENT/2;class It{constructor(t,r,a){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=a;for(let u=0;u<r.length;u++){const d=r.get(u),g=d.key;this.indexedSymbolInstances[g]||(this.indexedSymbolInstances[g]=[]),this.indexedSymbolInstances[g].push({crossTileID:d.crossTileID,coord:this.getScaledCoordinates(d,t)})}}getScaledCoordinates(t,r){const a=tt/Math.pow(2,r.canonical.z-this.tileID.canonical.z);return{x:Math.floor((r.canonical.x*o.EXTENT+t.anchorX)*a),y:Math.floor((r.canonical.y*o.EXTENT+t.anchorY)*a)}}findMatches(t,r,a){const u=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let d=0;d<t.length;d++){const g=t.get(d);if(g.crossTileID)continue;const x=this.indexedSymbolInstances[g.key];if(!x)continue;const b=this.getScaledCoordinates(g,r);for(const I of x)if(Math.abs(I.coord.x-b.x)<=u&&Math.abs(I.coord.y-b.y)<=u&&!a[I.crossTileID]){a[I.crossTileID]=!0,g.crossTileID=I.crossTileID;break}}}}class xt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class mt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const a in this.indexes){const u=this.indexes[a],d={};for(const g in u){const x=u[g];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+r),d[x.tileID.key]=x}this.indexes[a]=d}this.lng=t}addBucket(t,r,a){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let d=0;d<r.symbolInstances.length;d++)r.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const u=this.usedCrossTileIDs[t.overscaledZ];for(const d in this.indexes){const g=this.indexes[d];if(Number(d)>t.overscaledZ)for(const x in g){const b=g[x];b.tileID.isChildOf(t)&&b.findMatches(r.symbolInstances,t,u)}else{const x=g[t.scaledTo(Number(d)).key];x&&x.findMatches(r.symbolInstances,t,u)}}for(let d=0;d<r.symbolInstances.length;d++){const g=r.symbolInstances.get(d);g.crossTileID||(g.crossTileID=a.generate(),u[g.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new It(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const a in r.indexedSymbolInstances)for(const u of r.indexedSymbolInstances[a])delete this.usedCrossTileIDs[t][u.crossTileID]}removeStaleBuckets(t){let r=!1;for(const a in this.indexes){const u=this.indexes[a];for(const d in u)t[u[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,u[d]),delete u[d],r=!0)}return r}}class pt{constructor(){this.layerIndexes={},this.crossTileIDs=new xt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,a){let u=this.layerIndexes[t.id];u===void 0&&(u=this.layerIndexes[t.id]=new mt);let d=!1;const g={};u.handleWrapJump(a);for(const x of r){const b=x.getBucket(t);b&&t.id===b.layerIds[0]&&(b.bucketInstanceId||(b.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(x.tileID,b,this.crossTileIDs)&&(d=!0),g[b.bucketInstanceId]=!0)}return u.removeStaleBuckets(g)&&(d=!0),d}pruneUnusedLayers(t){const r={};t.forEach(a=>{r[a]=!0});for(const a in this.layerIndexes)r[a]||delete this.layerIndexes[a]}}const ct=(c,t)=>o.emitValidationErrors(c,t&&t.filter(r=>r.identifier!=="source.canvas")),ei=o.pick(wt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Kt=o.pick(wt,["setCenter","setZoom","setBearing","setPitch"]),mi=function(){const c={},t=o.spec.$version;for(const r in o.spec.$root){const a=o.spec.$root[r];if(a.required){let u=null;u=r==="version"?t:a.type==="array"?[]:{},u!=null&&(c[r]=u)}}return c}();class xi extends o.Evented{constructor(t,r={}){super(),this.map=t,this.dispatcher=new Wi(Cn(),this),this.imageManager=new Ye,this.imageManager.setEventedParent(this),this.glyphManager=new Vt(t._requestManager,r.localIdeographFontFamily),this.lineAtlas=new In(256,512),this.crossTileSymbolIndex=new pt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const a=this;this._rtlTextPluginCallback=xi.registerForPluginStateChange(u=>{a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:u.pluginStatus,pluginURL:u.pluginURL},(d,g)=>{if(o.triggerPluginCompletionEvent(d),g&&g.every(x=>x))for(const x in a.sourceCaches)a.sourceCaches[x].reload()})}),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const d=this.sourceCaches[u.sourceId];if(!d)return;const g=d.getSource();if(g&&g.vectorLayerIds)for(const x in this._layers){const b=this._layers[x];b.source===g.id&&this._validateLayer(b)}})}loadURL(t,r={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const a=typeof r.validate!="boolean"||r.validate,u=this.map._requestManager.transformRequest(t,o.ResourceType.Style);this._request=o.getJSON(u,(d,g)=>{this._request=null,d?this.fire(new o.ErrorEvent(d)):g&&this._load(g,a)})}loadJSON(t,r={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(t,r.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(mi,!1)}_load(t,r){if(r&&ct(this,o.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const u in t.sources)this.addSource(u,t.sources[u],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const a=rs(this.stylesheet.layers);this._order=a.map(u=>u.id),this._layers={},this._serializedLayers={};for(let u of a)u=o.createStyleLayer(u),u.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=u,this._serializedLayers[u.id]=u.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new hn(this.stylesheet.light),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(r,a,u,d){let g,x,b;const I=u>1?"@2x":"";let k=o.getJSON(a.transformRequest(a.normalizeSpriteURL(r,I,".json"),o.ResourceType.SpriteJSON),(W,U)=>{k=null,b||(b=W,g=U,O())}),L=o.getImage(a.transformRequest(a.normalizeSpriteURL(r,I,".png"),o.ResourceType.SpriteImage),(W,U)=>{L=null,b||(b=W,x=U,O())});function O(){if(b)d(b);else if(g&&x){const W=o.exported.getImageData(x),U={};for(const Z in g){const{width:te,height:ie,x:oe,y:ne,sdf:ye,pixelRatio:pe,stretchX:fe,stretchY:Ie,content:ke}=g[Z],_e=new o.RGBAImage({width:te,height:ie});o.RGBAImage.copy(W,_e,{x:oe,y:ne},{x:0,y:0},{width:te,height:ie}),U[Z]={data:_e,pixelRatio:pe,sdf:ye,stretchX:fe,stretchY:Ie,content:ke}}d(null,U)}}return{cancel(){k&&(k.cancel(),k=null),L&&(L.cancel(),L=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(r,a)=>{if(this._spriteRequest=null,r)this.fire(new o.ErrorEvent(r));else if(a)for(const u in a)this.imageManager.addImage(u,a[u]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(t){const r=this.sourceCaches[t.source];if(!r)return;const a=t.sourceLayer;if(!a)return;const u=r.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(a)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${a}" does not exist on source "${u.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const r=[];for(const a of t){const u=this._layers[a];u.type!=="custom"&&r.push(u.serialize())}return r}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const r=this._changed;if(this._changed){const u=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(u.length||d.length)&&this._updateWorkerLayers(u,d);for(const g in this._updatedSources){const x=this._updatedSources[g];x==="reload"?this._reloadSource(g):x==="clear"&&this._clearSource(g)}this._updateTilesForChangedImages();for(const g in this._updatedPaintProps)this._layers[g].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const a={};for(const u in this.sourceCaches){const d=this.sourceCaches[u];a[u]=d.used,d.used=!1}for(const u of this._order){const d=this._layers[u];d.recalculate(t,this._availableImages),!d.isHidden(t.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const u in a){const d=this.sourceCaches[u];a[u]!==d.used&&d.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(t),this.z=t.zoom,r&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,r){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),ct(this,o.validateStyle(t)))return!1;(t=o.clone$1(t)).layers=rs(t.layers);const r=function(u,d){if(!u)return[{command:wt.setStyle,args:[d]}];let g=[];try{if(!K(u.version,d.version))return[{command:wt.setStyle,args:[d]}];K(u.center,d.center)||g.push({command:wt.setCenter,args:[d.center]}),K(u.zoom,d.zoom)||g.push({command:wt.setZoom,args:[d.zoom]}),K(u.bearing,d.bearing)||g.push({command:wt.setBearing,args:[d.bearing]}),K(u.pitch,d.pitch)||g.push({command:wt.setPitch,args:[d.pitch]}),K(u.sprite,d.sprite)||g.push({command:wt.setSprite,args:[d.sprite]}),K(u.glyphs,d.glyphs)||g.push({command:wt.setGlyphs,args:[d.glyphs]}),K(u.transition,d.transition)||g.push({command:wt.setTransition,args:[d.transition]}),K(u.light,d.light)||g.push({command:wt.setLight,args:[d.light]});const x={},b=[];(function(k,L,O,W){let U;for(U in L=L||{},k=k||{})Object.prototype.hasOwnProperty.call(k,U)&&(Object.prototype.hasOwnProperty.call(L,U)||tr(U,O,W));for(U in L)Object.prototype.hasOwnProperty.call(L,U)&&(Object.prototype.hasOwnProperty.call(k,U)?K(k[U],L[U])||(k[U].type==="geojson"&&L[U].type==="geojson"&&ss(k,L,U)?O.push({command:wt.setGeoJSONSourceData,args:[U,L[U].data]}):hr(U,L,O,W)):ur(U,L,O))})(u.sources,d.sources,b,x);const I=[];u.layers&&u.layers.forEach(k=>{x[k.source]?g.push({command:wt.removeLayer,args:[k.id]}):I.push(k)}),g=g.concat(b),function(k,L,O){L=L||[];const W=(k=k||[]).map(Le),U=L.map(Le),Z=k.reduce(pr,{}),te=L.reduce(pr,{}),ie=W.slice(),oe=Object.create(null);let ne,ye,pe,fe,Ie,ke,_e;for(ne=0,ye=0;ne<W.length;ne++)pe=W[ne],Object.prototype.hasOwnProperty.call(te,pe)?ye++:(O.push({command:wt.removeLayer,args:[pe]}),ie.splice(ie.indexOf(pe,ye),1));for(ne=0,ye=0;ne<U.length;ne++)pe=U[U.length-1-ne],ie[ie.length-1-ne]!==pe&&(Object.prototype.hasOwnProperty.call(Z,pe)?(O.push({command:wt.removeLayer,args:[pe]}),ie.splice(ie.lastIndexOf(pe,ie.length-ye),1)):ye++,ke=ie[ie.length-ne],O.push({command:wt.addLayer,args:[te[pe],ke]}),ie.splice(ie.length-ne,0,pe),oe[pe]=!0);for(ne=0;ne<U.length;ne++)if(pe=U[ne],fe=Z[pe],Ie=te[pe],!oe[pe]&&!K(fe,Ie))if(K(fe.source,Ie.source)&&K(fe["source-layer"],Ie["source-layer"])&&K(fe.type,Ie.type)){for(_e in me(fe.layout,Ie.layout,O,pe,null,wt.setLayoutProperty),me(fe.paint,Ie.paint,O,pe,null,wt.setPaintProperty),K(fe.filter,Ie.filter)||O.push({command:wt.setFilter,args:[pe,Ie.filter]}),K(fe.minzoom,Ie.minzoom)&&K(fe.maxzoom,Ie.maxzoom)||O.push({command:wt.setLayerZoomRange,args:[pe,Ie.minzoom,Ie.maxzoom]}),fe)Object.prototype.hasOwnProperty.call(fe,_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&(_e.indexOf("paint.")===0?me(fe[_e],Ie[_e],O,pe,_e.slice(6),wt.setPaintProperty):K(fe[_e],Ie[_e])||O.push({command:wt.setLayerProperty,args:[pe,_e,Ie[_e]]}));for(_e in Ie)Object.prototype.hasOwnProperty.call(Ie,_e)&&!Object.prototype.hasOwnProperty.call(fe,_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&(_e.indexOf("paint.")===0?me(fe[_e],Ie[_e],O,pe,_e.slice(6),wt.setPaintProperty):K(fe[_e],Ie[_e])||O.push({command:wt.setLayerProperty,args:[pe,_e,Ie[_e]]}))}else O.push({command:wt.removeLayer,args:[pe]}),ke=ie[ie.lastIndexOf(pe)+1],O.push({command:wt.addLayer,args:[Ie,ke]})}(I,d.layers,g)}catch(x){console.warn("Unable to compute style diff:",x),g=[{command:wt.setStyle,args:[d]}]}return g}(this.serialize(),t).filter(u=>!(u.command in Kt));if(r.length===0)return!1;const a=r.filter(u=>!(u.command in ei));if(a.length>0)throw new Error(`Unimplemented: ${a.map(u=>u.command).join(", ")}.`);return r.forEach(u=>{u.command!=="setTransition"&&this[u.command].apply(this,u.args)}),this.stylesheet=t,!0}addImage(t,r){if(this.getImage(t))return this.fire(new o.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,r),this._afterImageUpdated(t)}updateImage(t,r){this.imageManager.updateImage(t,r)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new o.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,r,a={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(o.validateStyle.source,`sources.${t}`,r,null,a))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const u=this.sourceCaches[t]=new fi(t,r,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:u.serialize(),sourceId:t})),u.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===t)return this.fire(new o.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${a}" is using it.`)));const r=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],r.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,r){this._checkLoaded(),this.sourceCaches[t].getSource().setData(r),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,r,a={}){this._checkLoaded();const u=t.id;if(this.getLayer(u))return void this.fire(new o.ErrorEvent(new Error(`Layer "${u}" already exists on this map.`)));let d;if(t.type==="custom"){if(ct(this,o.validateCustomStyleLayer(t)))return;d=o.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(u,t.source),t=o.clone$1(t),t=o.extend(t,{source:u})),this._validate(o.validateStyle.layer,`layers.${u}`,t,{arrayIndex:-1},a))return;d=o.createStyleLayer(t),this._validateLayer(d),d.setEventedParent(this,{layer:{id:u}}),this._serializedLayers[d.id]=d.serialize()}const g=r?this._order.indexOf(r):this._order.length;if(r&&g===-1)this.fire(new o.ErrorEvent(new Error(`Cannot add layer "${u}" before non-existing layer "${r}".`)));else{if(this._order.splice(g,0,u),this._layerOrderChanged=!0,this._layers[u]=d,this._removedLayers[u]&&d.source&&d.type!=="custom"){const x=this._removedLayers[u];delete this._removedLayers[u],x.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(t,r){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===r)return;const a=this._order.indexOf(t);this._order.splice(a,1);const u=r?this._order.indexOf(r):this._order.length;r&&u===-1?this.fire(new o.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${r}".`))):(this._order.splice(u,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const r=this._layers[t];if(!r)return void this.fire(new o.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));r.setEventedParent(null);const a=this._order.indexOf(t);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=r,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],r.onRemove&&r.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,r,a){this._checkLoaded();const u=this.getLayer(t);u?u.minzoom===r&&u.maxzoom===a||(r!=null&&(u.minzoom=r),a!=null&&(u.maxzoom=a),this._updateLayer(u)):this.fire(new o.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,r,a={}){this._checkLoaded();const u=this.getLayer(t);if(u){if(!K(u.filter,r))return r==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(o.validateStyle.filter,`layers.${u.id}.filter`,r,null,a)||(u.filter=o.clone$1(r),this._updateLayer(u)))}else this.fire(new o.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return o.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,r,a,u={}){this._checkLoaded();const d=this.getLayer(t);d?K(d.getLayoutProperty(r),a)||(d.setLayoutProperty(r,a,u),this._updateLayer(d)):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,r){const a=this.getLayer(t);if(a)return a.getLayoutProperty(r);this.fire(new o.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,r,a,u={}){this._checkLoaded();const d=this.getLayer(t);d?K(d.getPaintProperty(r),a)||(d.setPaintProperty(r,a,u)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,r){return this.getLayer(t).getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const a=t.source,u=t.sourceLayer,d=this.sourceCaches[a];if(d===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const g=d.getSource().type;g==="geojson"&&u?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):g!=="vector"||u?(t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),d.setFeatureState(u,t.id,r)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,r){this._checkLoaded();const a=t.source,u=this.sourceCaches[a];if(u===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const d=u.getSource().type,g=d==="vector"?t.sourceLayer:void 0;d!=="vector"||g?r&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(g,t.id,r):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const r=t.source,a=t.sourceLayer,u=this.sourceCaches[r];if(u!==void 0)return u.getSource().type!=="vector"||a?(t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),u.getFeatureState(a,t.id)):void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const r=g=>this._layers[g].type==="fill-extrusion",a={},u=[];for(let g=this._order.length-1;g>=0;g--){const x=this._order[g];if(r(x)){a[x]=g;for(const b of t){const I=b[x];if(I)for(const k of I)u.push(k)}}}u.sort((g,x)=>x.intersectionZ-g.intersectionZ);const d=[];for(let g=this._order.length-1;g>=0;g--){const x=this._order[g];if(r(x))for(let b=u.length-1;b>=0;b--){const I=u[b].feature;if(a[I.layer.id]<g)break;d.push(I),u.pop()}else for(const b of t){const I=b[x];if(I)for(const k of I)d.push(k.feature)}}return d}queryRenderedFeatures(t,r,a){r&&r.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",r.filter,null,r);const u={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const g of r.layers){const x=this._layers[g];if(!x)return this.fire(new o.ErrorEvent(new Error(`The layer '${g}' does not exist in the map's style and cannot be queried for features.`))),[];u[x.source]=!0}}const d=[];r.availableImages=this._availableImages;for(const g in this.sourceCaches)r.layers&&!u[g]||d.push(jn(this.sourceCaches[g],this._layers,this._serializedLayers,t,r,a));return this.placement&&d.push(function(g,x,b,I,k,L,O){const W={},U=L.queryRenderedSymbols(I),Z=[];for(const te of Object.keys(U).map(Number))Z.push(O[te]);Z.sort(Dr);for(const te of Z){const ie=te.featureIndex.lookupSymbolFeatures(U[te.bucketInstanceId],x,te.bucketIndex,te.sourceLayerIndex,k.filter,k.layers,k.availableImages,g);for(const oe in ie){const ne=W[oe]=W[oe]||[],ye=ie[oe];ye.sort((pe,fe)=>{const Ie=te.featureSortOrder;if(Ie){const ke=Ie.indexOf(pe.featureIndex);return Ie.indexOf(fe.featureIndex)-ke}return fe.featureIndex-pe.featureIndex});for(const pe of ye)ne.push(pe)}}for(const te in W)W[te].forEach(ie=>{const oe=ie.feature,ne=b[g[te].source].getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=ne});return W}(this._layers,this._serializedLayers,this.sourceCaches,t,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(t,r){r&&r.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",r.filter,null,r);const a=this.sourceCaches[t];return a?function(u,d){const g=u.getRenderableIds().map(I=>u.getTileByID(I)),x=[],b={};for(let I=0;I<g.length;I++){const k=g[I],L=k.tileID.canonical.key;b[L]||(b[L]=!0,k.querySourceFeatures(x,d))}return x}(a,r):[]}addSourceType(t,r,a){return xi.getSourceType(t)?a(new Error(`A source type called "${t}" already exists.`)):(xi.setSourceType(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},a):a(null,null))}getLight(){return this.light.getLight()}setLight(t,r={}){this._checkLoaded();const a=this.light.getLight();let u=!1;for(const g in t)if(!K(t[g],a[g])){u=!0;break}if(!u)return;const d={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,r),this.light.updateTransitions(d)}_validate(t,r,a,u,d={}){return(!d||d.validate!==!1)&&ct(this,t.call(o.validateStyle,o.extend({key:r,style:this.serialize(),value:a,styleSpec:o.spec},u)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const r=this.sourceCaches[t];r.setEventedParent(null),r.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const r in this.sourceCaches)this.sourceCaches[r].update(t)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,r,a,u,d=!1){let g=!1,x=!1;const b={};for(const I of this._order){const k=this._layers[I];if(k.type!=="symbol")continue;if(!b[k.source]){const O=this.sourceCaches[k.source];b[k.source]=O.getRenderableIds(!0).map(W=>O.getTileByID(W)).sort((W,U)=>U.tileID.overscaledZ-W.tileID.overscaledZ||(W.tileID.isLessThan(U.tileID)?-1:1))}const L=this.crossTileSymbolIndex.addLayer(k,b[k.source],t.center.lng);g=g||L}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),t.zoom))&&(this.pauseablePlacement=new Xe(t,this._order,d,r,a,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,b),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),x=!0),g&&this.pauseablePlacement.placement.setStale()),x||g)for(const I of this._order){const k=this._layers[I];k.type==="symbol"&&this.placement.updateLayerOpacities(k,b[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,r,a){this.imageManager.getImages(r.icons,a),this._updateTilesForChangedImages();const u=this.sourceCaches[r.source];u&&u.setDependencies(r.tileID.key,r.type,r.icons)}getGlyphs(t,r,a){this.glyphManager.getGlyphs(r.stacks,a)}getResource(t,r,a){return o.makeRequest(r,a)}}xi.getSourceType=function(c){return dn[c]},xi.setSourceType=function(c,t){dn[c]=t},xi.registerForPluginStateChange=o.registerForPluginStateChange;var Ao=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),Io={prelude:Ot(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),background:Ot(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ot(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ot(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ot("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ot(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ot(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ot("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ot("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ot("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),fill:Ot(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ot(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ot(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ot(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ot(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ot(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ot(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),lineGradient:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),linePattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ot(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ot(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),symbolSDF:Ot(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ot(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`)};function Ot(c,t){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=t.match(/attribute ([\w]+) ([\w]+)/g),u=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=d?d.concat(u):u,x={};return{fragmentSource:c=c.replace(r,(b,I,k,L,O)=>(x[O]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
varying ${k} ${L} ${O};
#else
uniform ${k} ${L} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${k} ${L} ${O} = u_${O};
#endif
`)),vertexSource:t=t.replace(r,(b,I,k,L,O)=>{const W=L==="float"?"vec2":"vec4",U=O.match(/color/)?"color":W;return x[O]?I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${k} ${W} a_${O};
varying ${k} ${L} ${O};
#else
uniform ${k} ${L} u_${O};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${k} ${L} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${U}(a_${O}, u_${O}_t);
#else
    ${k} ${L} ${O} = u_${O};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${k} ${W} a_${O};
#else
uniform ${k} ${L} u_${O};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${k} ${L} ${O} = a_${O};
#else
    ${k} ${L} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${k} ${L} ${O} = unpack_mix_${U}(a_${O}, u_${O}_t);
#else
    ${k} ${L} ${O} = u_${O};
#endif
`}),staticAttributes:a,staticUniforms:g}}class Nl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,r,a,u,d,g,x,b){this.context=t;let I=this.boundPaintVertexBuffers.length!==u.length;for(let k=0;!I&&k<u.length;k++)this.boundPaintVertexBuffers[k]!==u[k]&&(I=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===r&&this.boundLayoutVertexBuffer===a&&!I&&this.boundIndexBuffer===d&&this.boundVertexOffset===g&&this.boundDynamicVertexBuffer===x&&this.boundDynamicVertexBuffer2===b?(t.bindVertexArrayOES.set(this.vao),x&&x.bind(),d&&d.dynamicDraw&&d.bind(),b&&b.bind()):this.freshBind(r,a,u,d,g,x,b)}freshBind(t,r,a,u,d,g,x){let b;const I=t.numAttributes,k=this.context,L=k.gl;if(k.extVertexArrayObject)this.vao&&this.destroy(),this.vao=k.extVertexArrayObject.createVertexArrayOES(),k.bindVertexArrayOES.set(this.vao),b=0,this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=u,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=g,this.boundDynamicVertexBuffer2=x;else{b=k.currentNumAttributes||0;for(let O=I;O<b;O++)L.disableVertexAttribArray(O)}r.enableAttributes(L,t);for(const O of a)O.enableAttributes(L,t);g&&g.enableAttributes(L,t),x&&x.enableAttributes(L,t),r.bind(),r.setVertexAttribPointers(L,t,d);for(const O of a)O.bind(),O.setVertexAttribPointers(L,t,d);g&&(g.bind(),g.setVertexAttribPointers(L,t,d)),u&&u.bind(),x&&(x.bind(),x.setVertexAttribPointers(L,t,d)),k.currentNumAttributes=I}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function To(c){const t=[];for(let r=0;r<c.length;r++){if(c[r]===null)continue;const a=c[r].split(" ");t.push(a.pop())}return t}class jl{constructor(t,r,a,u,d,g){const x=t.gl;this.program=x.createProgram();const b=To(a.staticAttributes),I=u?u.getBinderAttributes():[],k=b.concat(I),L=a.staticUniforms?To(a.staticUniforms):[],O=u?u.getBinderUniforms():[],W=L.concat(O),U=[];for(const pe of W)U.indexOf(pe)<0&&U.push(pe);const Z=u?u.defines():[];g&&Z.push("#define OVERDRAW_INSPECTOR;");const te=Z.concat(Io.prelude.fragmentSource,a.fragmentSource).join(`
`),ie=Z.concat(Io.prelude.vertexSource,a.vertexSource).join(`
`),oe=x.createShader(x.FRAGMENT_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);x.shaderSource(oe,te),x.compileShader(oe),x.attachShader(this.program,oe);const ne=x.createShader(x.VERTEX_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);x.shaderSource(ne,ie),x.compileShader(ne),x.attachShader(this.program,ne),this.attributes={};const ye={};this.numAttributes=k.length;for(let pe=0;pe<this.numAttributes;pe++)k[pe]&&(x.bindAttribLocation(this.program,pe,k[pe]),this.attributes[k[pe]]=pe);x.linkProgram(this.program),x.deleteShader(ne),x.deleteShader(oe);for(let pe=0;pe<U.length;pe++){const fe=U[pe];if(fe&&!ye[fe]){const Ie=x.getUniformLocation(this.program,fe);Ie&&(ye[fe]=Ie)}}this.fixedUniforms=d(t,ye),this.binderUniforms=u?u.getUniforms(t,ye):[]}draw(t,r,a,u,d,g,x,b,I,k,L,O,W,U,Z,te){const ie=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(a),t.setStencilMode(u),t.setColorMode(d),t.setCullFace(g);for(const ne in this.fixedUniforms)this.fixedUniforms[ne].set(x[ne]);U&&U.setUniforms(t,this.binderUniforms,O,{zoom:W});const oe={[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[r];for(const ne of L.get()){const ye=ne.vaos||(ne.vaos={});(ye[b]||(ye[b]=new Nl)).bind(t,this,I,U?U.getPaintVertexBuffers():[],k,ne.vertexOffset,Z,te),ie.drawElements(r,ne.primitiveLength*oe,ie.UNSIGNED_SHORT,ne.primitiveOffset*oe*2)}}}function Eo(c,t,r){const a=1/ui(r,1,t.transform.tileZoom),u=Math.pow(2,r.tileID.overscaledZ),d=r.tileSize*Math.pow(2,t.transform.tileZoom)/u,g=d*(r.tileID.canonical.x+r.tileID.wrap*u),x=d*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[a,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[g>>16,x>>16],u_pixel_coord_lower:[65535&g,65535&x]}}const Pa=(c,t,r,a)=>{const u=t.style.light,d=u.properties.get("position"),g=[d.x,d.y,d.z],x=function(){var I=new o.ARRAY_TYPE(9);return o.ARRAY_TYPE!=Float32Array&&(I[1]=0,I[2]=0,I[3]=0,I[5]=0,I[6]=0,I[7]=0),I[0]=1,I[4]=1,I[8]=1,I}();u.properties.get("anchor")==="viewport"&&function(I,k){var L=Math.sin(k),O=Math.cos(k);I[0]=O,I[1]=L,I[2]=0,I[3]=-L,I[4]=O,I[5]=0,I[6]=0,I[7]=0,I[8]=1}(x,-t.transform.angle),function(I,k,L){var O=k[0],W=k[1],U=k[2];I[0]=O*L[0]+W*L[3]+U*L[6],I[1]=O*L[1]+W*L[4]+U*L[7],I[2]=O*L[2]+W*L[5]+U*L[8]}(g,g,x);const b=u.properties.get("color");return{u_matrix:c,u_lightpos:g,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_vertical_gradient:+r,u_opacity:a}},Co=(c,t,r,a,u,d,g)=>o.extend(Pa(c,t,r,a),Eo(d,t,g),{u_height_factor:-Math.pow(2,u.overscaledZ)/g.tileSize/8}),zo=c=>({u_matrix:c}),ko=(c,t,r,a)=>o.extend(zo(c),Eo(r,t,a)),Ma=(c,t)=>({u_matrix:c,u_world:t}),Da=(c,t,r,a,u)=>o.extend(ko(c,t,r,a),{u_world:u}),gr=(c,t,r,a)=>{const u=c.transform;let d,g;if(a.paint.get("circle-pitch-alignment")==="map"){const x=ui(r,1,u.zoom);d=!0,g=[x,x]}else d=!1,g=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(t.posMatrix,r,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:c.pixelRatio,u_extrude_scale:g}},Rs=(c,t,r)=>{const a=ui(r,1,t.zoom),u=Math.pow(2,t.zoom-r.tileID.overscaledZ),d=r.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:a,u_extrude_scale:[t.pixelsToGLUnits[0]/(a*u),t.pixelsToGLUnits[1]/(a*u)],u_overscale_factor:d}},Br=(c,t,r=1)=>({u_matrix:c,u_color:t,u_overlay:0,u_overlay_scale:r}),as=c=>({u_matrix:c}),Bs=(c,t,r,a)=>({u_matrix:c,u_extrude_scale:ui(t,1,r),u_intensity:a});function Fs(c,t){const r=Math.pow(2,t.canonical.z),a=t.canonical.y;return[new o.MercatorCoordinate(0,a/r).toLngLat().lat,new o.MercatorCoordinate(0,(a+1)/r).toLngLat().lat]}const ls=(c,t,r)=>{const a=c.transform;return{u_matrix:Po(c,t,r),u_ratio:1/ui(t,1,a.zoom),u_device_pixel_ratio:c.pixelRatio,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},Os=(c,t,r,a)=>o.extend(ls(c,t,r),{u_image:0,u_image_height:a}),cs=(c,t,r,a)=>{const u=c.transform,d=us(t,u);return{u_matrix:Po(c,t,r),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ui(t,1,u.zoom),u_device_pixel_ratio:c.pixelRatio,u_image:0,u_scale:[d,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},ri=(c,t,r,a,u)=>{const d=c.lineAtlas,g=us(t,c.transform),x=r.layout.get("line-cap")==="round",b=d.getDash(a.from,x),I=d.getDash(a.to,x),k=b.width*u.fromScale,L=I.width*u.toScale;return o.extend(ls(c,t,r),{u_patternscale_a:[g/k,-b.height/2],u_patternscale_b:[g/L,-I.height/2],u_sdfgamma:d.width/(256*Math.min(k,L)*c.pixelRatio)/2,u_image:0,u_tex_y_a:b.y,u_tex_y_b:I.y,u_mix:u.t})};function us(c,t){return 1/ui(c,1,t.tileZoom)}function Po(c,t,r){return c.translatePosMatrix(t.tileID.posMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const La=(c,t,r,a,u)=>{return{u_matrix:c,u_tl_parent:t,u_scale_parent:r,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(g=u.paint.get("raster-saturation"),g>0?1-1/(1.001-g):-g),u_contrast_factor:(d=u.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:Ra(u.paint.get("raster-hue-rotate"))};var d,g};function Ra(c){c*=Math.PI/180;const t=Math.sin(c),r=Math.cos(c);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Us=(c,t,r,a,u,d,g,x,b,I)=>{const k=u.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:k.cameraToCenterDistance,u_pitch:k.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:k.width/k.height,u_fade_change:u.options.fadeDuration?u.symbolFadeChange:1,u_matrix:d,u_label_plane_matrix:g,u_coord_matrix:x,u_is_text:+b,u_pitch_with_map:+a,u_texsize:I,u_texture:0}},Mo=(c,t,r,a,u,d,g,x,b,I,k)=>{const L=u.transform;return o.extend(Us(c,t,r,a,u,d,g,x,b,I),{u_gamma_scale:a?Math.cos(L._pitch)*L.cameraToCenterDistance:1,u_device_pixel_ratio:u.pixelRatio,u_is_halo:+k})},ql=(c,t,r,a,u,d,g,x,b,I)=>o.extend(Mo(c,t,r,a,u,d,g,x,!0,b,!0),{u_texsize_icon:I,u_texture_icon:1}),Gl=(c,t,r)=>({u_matrix:c,u_opacity:t,u_color:r}),Do=(c,t,r,a,u,d)=>o.extend(function(g,x,b,I){const k=b.imageManager.getPattern(g.from.toString()),L=b.imageManager.getPattern(g.to.toString()),{width:O,height:W}=b.imageManager.getPixelSize(),U=Math.pow(2,I.tileID.overscaledZ),Z=I.tileSize*Math.pow(2,b.transform.tileZoom)/U,te=Z*(I.tileID.canonical.x+I.tileID.wrap*U),ie=Z*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:L.tl,u_pattern_br_b:L.br,u_texsize:[O,W],u_mix:x.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:L.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/ui(I,1,b.transform.tileZoom),u_pixel_coord_upper:[te>>16,ie>>16],u_pixel_coord_lower:[65535&te,65535&ie]}}(a,d,r,u),{u_matrix:c,u_opacity:t}),Lo={fillExtrusion:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_lightpos:new o.Uniform3f(c,t.u_lightpos),u_lightintensity:new o.Uniform1f(c,t.u_lightintensity),u_lightcolor:new o.Uniform3f(c,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(c,t.u_vertical_gradient),u_opacity:new o.Uniform1f(c,t.u_opacity)}),fillExtrusionPattern:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_lightpos:new o.Uniform3f(c,t.u_lightpos),u_lightintensity:new o.Uniform1f(c,t.u_lightintensity),u_lightcolor:new o.Uniform3f(c,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(c,t.u_vertical_gradient),u_height_factor:new o.Uniform1f(c,t.u_height_factor),u_image:new o.Uniform1i(c,t.u_image),u_texsize:new o.Uniform2f(c,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(c,t.u_scale),u_fade:new o.Uniform1f(c,t.u_fade),u_opacity:new o.Uniform1f(c,t.u_opacity)}),fill:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix)}),fillPattern:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_image:new o.Uniform1i(c,t.u_image),u_texsize:new o.Uniform2f(c,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(c,t.u_scale),u_fade:new o.Uniform1f(c,t.u_fade)}),fillOutline:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_world:new o.Uniform2f(c,t.u_world)}),fillOutlinePattern:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_world:new o.Uniform2f(c,t.u_world),u_image:new o.Uniform1i(c,t.u_image),u_texsize:new o.Uniform2f(c,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(c,t.u_scale),u_fade:new o.Uniform1f(c,t.u_fade)}),circle:(c,t)=>({u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(c,t.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(c,t.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(c,t.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(c,t.u_matrix)}),collisionBox:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(c,t.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(c,t.u_extrude_scale),u_overscale_factor:new o.Uniform1f(c,t.u_overscale_factor)}),collisionCircle:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_inv_matrix:new o.UniformMatrix4f(c,t.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(c,t.u_viewport_size)}),debug:(c,t)=>({u_color:new o.UniformColor(c,t.u_color),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_overlay:new o.Uniform1i(c,t.u_overlay),u_overlay_scale:new o.Uniform1f(c,t.u_overlay_scale)}),clippingMask:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix)}),heatmap:(c,t)=>({u_extrude_scale:new o.Uniform1f(c,t.u_extrude_scale),u_intensity:new o.Uniform1f(c,t.u_intensity),u_matrix:new o.UniformMatrix4f(c,t.u_matrix)}),heatmapTexture:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_world:new o.Uniform2f(c,t.u_world),u_image:new o.Uniform1i(c,t.u_image),u_color_ramp:new o.Uniform1i(c,t.u_color_ramp),u_opacity:new o.Uniform1f(c,t.u_opacity)}),hillshade:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_image:new o.Uniform1i(c,t.u_image),u_latrange:new o.Uniform2f(c,t.u_latrange),u_light:new o.Uniform2f(c,t.u_light),u_shadow:new o.UniformColor(c,t.u_shadow),u_highlight:new o.UniformColor(c,t.u_highlight),u_accent:new o.UniformColor(c,t.u_accent)}),hillshadePrepare:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_image:new o.Uniform1i(c,t.u_image),u_dimension:new o.Uniform2f(c,t.u_dimension),u_zoom:new o.Uniform1f(c,t.u_zoom),u_unpack:new o.Uniform4f(c,t.u_unpack)}),line:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_ratio:new o.Uniform1f(c,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(c,t.u_units_to_pixels)}),lineGradient:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_ratio:new o.Uniform1f(c,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(c,t.u_units_to_pixels),u_image:new o.Uniform1i(c,t.u_image),u_image_height:new o.Uniform1f(c,t.u_image_height)}),linePattern:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_texsize:new o.Uniform2f(c,t.u_texsize),u_ratio:new o.Uniform1f(c,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_image:new o.Uniform1i(c,t.u_image),u_units_to_pixels:new o.Uniform2f(c,t.u_units_to_pixels),u_scale:new o.Uniform3f(c,t.u_scale),u_fade:new o.Uniform1f(c,t.u_fade)}),lineSDF:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_ratio:new o.Uniform1f(c,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(c,t.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(c,t.u_patternscale_a),u_patternscale_b:new o.Uniform2f(c,t.u_patternscale_b),u_sdfgamma:new o.Uniform1f(c,t.u_sdfgamma),u_image:new o.Uniform1i(c,t.u_image),u_tex_y_a:new o.Uniform1f(c,t.u_tex_y_a),u_tex_y_b:new o.Uniform1f(c,t.u_tex_y_b),u_mix:new o.Uniform1f(c,t.u_mix)}),raster:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_tl_parent:new o.Uniform2f(c,t.u_tl_parent),u_scale_parent:new o.Uniform1f(c,t.u_scale_parent),u_buffer_scale:new o.Uniform1f(c,t.u_buffer_scale),u_fade_t:new o.Uniform1f(c,t.u_fade_t),u_opacity:new o.Uniform1f(c,t.u_opacity),u_image0:new o.Uniform1i(c,t.u_image0),u_image1:new o.Uniform1i(c,t.u_image1),u_brightness_low:new o.Uniform1f(c,t.u_brightness_low),u_brightness_high:new o.Uniform1f(c,t.u_brightness_high),u_saturation_factor:new o.Uniform1f(c,t.u_saturation_factor),u_contrast_factor:new o.Uniform1f(c,t.u_contrast_factor),u_spin_weights:new o.Uniform3f(c,t.u_spin_weights)}),symbolIcon:(c,t)=>({u_is_size_zoom_constant:new o.Uniform1i(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(c,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(c,t.u_size_t),u_size:new o.Uniform1f(c,t.u_size),u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(c,t.u_pitch),u_rotate_symbol:new o.Uniform1i(c,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(c,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(c,t.u_fade_change),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(c,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(c,t.u_coord_matrix),u_is_text:new o.Uniform1i(c,t.u_is_text),u_pitch_with_map:new o.Uniform1i(c,t.u_pitch_with_map),u_texsize:new o.Uniform2f(c,t.u_texsize),u_texture:new o.Uniform1i(c,t.u_texture)}),symbolSDF:(c,t)=>({u_is_size_zoom_constant:new o.Uniform1i(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(c,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(c,t.u_size_t),u_size:new o.Uniform1f(c,t.u_size),u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(c,t.u_pitch),u_rotate_symbol:new o.Uniform1i(c,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(c,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(c,t.u_fade_change),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(c,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(c,t.u_coord_matrix),u_is_text:new o.Uniform1i(c,t.u_is_text),u_pitch_with_map:new o.Uniform1i(c,t.u_pitch_with_map),u_texsize:new o.Uniform2f(c,t.u_texsize),u_texture:new o.Uniform1i(c,t.u_texture),u_gamma_scale:new o.Uniform1f(c,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(c,t.u_is_halo)}),symbolTextAndIcon:(c,t)=>({u_is_size_zoom_constant:new o.Uniform1i(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(c,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(c,t.u_size_t),u_size:new o.Uniform1f(c,t.u_size),u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(c,t.u_pitch),u_rotate_symbol:new o.Uniform1i(c,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(c,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(c,t.u_fade_change),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(c,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(c,t.u_coord_matrix),u_is_text:new o.Uniform1i(c,t.u_is_text),u_pitch_with_map:new o.Uniform1i(c,t.u_pitch_with_map),u_texsize:new o.Uniform2f(c,t.u_texsize),u_texsize_icon:new o.Uniform2f(c,t.u_texsize_icon),u_texture:new o.Uniform1i(c,t.u_texture),u_texture_icon:new o.Uniform1i(c,t.u_texture_icon),u_gamma_scale:new o.Uniform1f(c,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(c,t.u_is_halo)}),background:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_opacity:new o.Uniform1f(c,t.u_opacity),u_color:new o.UniformColor(c,t.u_color)}),backgroundPattern:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_opacity:new o.Uniform1f(c,t.u_opacity),u_image:new o.Uniform1i(c,t.u_image),u_pattern_tl_a:new o.Uniform2f(c,t.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(c,t.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(c,t.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(c,t.u_pattern_br_b),u_texsize:new o.Uniform2f(c,t.u_texsize),u_mix:new o.Uniform1f(c,t.u_mix),u_pattern_size_a:new o.Uniform2f(c,t.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(c,t.u_pattern_size_b),u_scale_a:new o.Uniform1f(c,t.u_scale_a),u_scale_b:new o.Uniform1f(c,t.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(c,t.u_tile_units_to_pixels)})};class Ro{constructor(t,r,a){this.context=t;const u=t.gl;this.buffer=u.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Bo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ba{constructor(t,r,a,u){this.length=r.length,this.attributes=a,this.itemSize=r.bytesPerElement,this.dynamicDraw=u,this.context=t;const d=t.gl;this.buffer=d.createBuffer(),t.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let a=0;a<this.attributes.length;a++){const u=r.attributes[this.attributes[a].name];u!==void 0&&t.enableVertexAttribArray(u)}}setVertexAttribPointers(t,r,a){for(let u=0;u<this.attributes.length;u++){const d=this.attributes[u],g=r.attributes[d.name];g!==void 0&&t.vertexAttribPointer(g,d.components,t[Bo[d.type]],!1,this.itemSize,d.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ct{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Zl extends Ct{getDefault(){return o.Color.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class hs extends Ct{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class ps extends Ct{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Fa extends Ct{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Hi extends Ct{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Fo extends Ct{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Vs extends Ct{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class $s extends Ct{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Oo extends Ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Uo extends Ct{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ns extends Ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class Vo extends Ct{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class $o extends Ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class js extends Ct{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Oa extends Ct{getDefault(){return o.Color.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ua extends Ct{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Fr extends Ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class Wl extends Ct{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Hl extends Ct{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Xl extends Ct{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Yl extends Ct{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Kl extends Ct{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Jl extends Ct{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class No extends Ct{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class jo extends Ct{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Or extends Ct{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Va extends Ct{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class $a extends Ct{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class qo extends Ct{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class _r extends Ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Na extends Ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class yr extends Ct{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class Ur extends yr{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ja extends yr{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Go{constructor(t,r,a,u){this.context=t,this.width=r,this.height=a;const d=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new Ur(t,d),u&&(this.depthAttachment=new ja(t,d))}destroy(){const t=this.context.gl,r=this.colorAttachment.get();if(r&&t.deleteTexture(r),this.depthAttachment){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}t.deleteFramebuffer(this.framebuffer)}}class lt{constructor(t,r,a){this.blendFunction=t,this.blendColor=r,this.mask=a}}lt.Replace=[1,0],lt.disabled=new lt(lt.Replace,o.Color.transparent,[!1,!1,!1,!1]),lt.unblended=new lt(lt.Replace,o.Color.transparent,[!0,!0,!0,!0]),lt.alphaBlended=new lt([1,771],o.Color.transparent,[!0,!0,!0,!0]);class qs{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Zl(this),this.clearDepth=new hs(this),this.clearStencil=new ps(this),this.colorMask=new Fa(this),this.depthMask=new Hi(this),this.stencilMask=new Fo(this),this.stencilFunc=new Vs(this),this.stencilOp=new $s(this),this.stencilTest=new Oo(this),this.depthRange=new Uo(this),this.depthTest=new Ns(this),this.depthFunc=new Vo(this),this.blend=new $o(this),this.blendFunc=new js(this),this.blendColor=new Oa(this),this.blendEquation=new Ua(this),this.cullFace=new Fr(this),this.cullFaceSide=new Wl(this),this.frontFace=new Hl(this),this.program=new Xl(this),this.activeTexture=new Yl(this),this.viewport=new Kl(this),this.bindFramebuffer=new Jl(this),this.bindRenderbuffer=new No(this),this.bindTexture=new jo(this),this.bindVertexBuffer=new Or(this),this.bindElementBuffer=new Va(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new $a(this),this.pixelStoreUnpack=new qo(this),this.pixelStoreUnpackPremultiplyAlpha=new _r(this),this.pixelStoreUnpackFlipY=new Na(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r){return new Ro(this,t,r)}createVertexBuffer(t,r,a){return new Ba(this,t,r,a)}createRenderbuffer(t,r,a){const u=this.gl,d=u.createRenderbuffer();return this.bindRenderbuffer.set(d),u.renderbufferStorage(u.RENDERBUFFER,t,r,a),this.bindRenderbuffer.set(null),d}createFramebuffer(t,r,a){return new Go(this,t,r,a)}clear({color:t,depth:r}){const a=this.gl;let u=0;t&&(u|=a.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(u|=a.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),a.clear(u)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){K(t.blendFunction,lt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Dt{constructor(t,r,a){this.func=t,this.mask=r,this.range=a}}Dt.ReadOnly=!1,Dt.ReadWrite=!0,Dt.disabled=new Dt(519,Dt.ReadOnly,[0,1]);const Gs=7680;class jt{constructor(t,r,a,u,d,g){this.test=t,this.ref=r,this.mask=a,this.fail=u,this.depthFail=d,this.pass=g}}jt.disabled=new jt({func:519,mask:0},0,0,Gs,Gs,Gs);class Jt{constructor(t,r,a){this.enable=t,this.mode=r,this.frontFace=a}}let Zs;function Zo(c,t,r,a,u,d,g){const x=c.context,b=x.gl,I=c.useProgram("collisionBox"),k=[];let L=0,O=0;for(let ne=0;ne<a.length;ne++){const ye=a[ne],pe=t.getTile(ye),fe=pe.getBucket(r);if(!fe)continue;let Ie=ye.posMatrix;u[0]===0&&u[1]===0||(Ie=c.translatePosMatrix(ye.posMatrix,pe,u,d));const ke=g?fe.textCollisionBox:fe.iconCollisionBox,_e=fe.collisionCircleArray;if(_e.length>0){const qe=o.create(),Re=Ie;o.mul(qe,fe.placementInvProjMatrix,c.transform.glCoordMatrix),o.mul(qe,qe,fe.placementViewportMatrix),k.push({circleArray:_e,circleOffset:O,transform:Re,invTransform:qe}),L+=_e.length/4,O=L}ke&&I.draw(x,b.LINES,Dt.disabled,jt.disabled,c.colorModeForRenderPass(),Jt.disabled,Rs(Ie,c.transform,pe),r.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,null,c.transform.zoom,null,null,ke.collisionVertexBuffer)}if(!g||!k.length)return;const W=c.useProgram("collisionCircle"),U=new o.CollisionCircleLayoutArray;U.resize(4*L),U._trim();let Z=0;for(const ne of k)for(let ye=0;ye<ne.circleArray.length/4;ye++){const pe=4*ye,fe=ne.circleArray[pe+0],Ie=ne.circleArray[pe+1],ke=ne.circleArray[pe+2],_e=ne.circleArray[pe+3];U.emplace(Z++,fe,Ie,ke,_e,0),U.emplace(Z++,fe,Ie,ke,_e,1),U.emplace(Z++,fe,Ie,ke,_e,2),U.emplace(Z++,fe,Ie,ke,_e,3)}(!Zs||Zs.length<2*L)&&(Zs=function(ne){const ye=2*ne,pe=new o.QuadTriangleArray;pe.resize(ye),pe._trim();for(let fe=0;fe<ye;fe++){const Ie=6*fe;pe.uint16[Ie+0]=4*fe+0,pe.uint16[Ie+1]=4*fe+1,pe.uint16[Ie+2]=4*fe+2,pe.uint16[Ie+3]=4*fe+2,pe.uint16[Ie+4]=4*fe+3,pe.uint16[Ie+5]=4*fe+0}return pe}(L));const te=x.createIndexBuffer(Zs,!0),ie=x.createVertexBuffer(U,o.collisionCircleLayout.members,!0);for(const ne of k){const ye={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(oe=c.transform).cameraToCenterDistance,u_viewport_size:[oe.width,oe.height]};W.draw(x,b.TRIANGLES,Dt.disabled,jt.disabled,c.colorModeForRenderPass(),Jt.disabled,ye,r.id,ie,te,o.SegmentVector.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,c.transform.zoom,null,null,null)}var oe;ie.destroy(),te.destroy()}Jt.disabled=new Jt(!1,1029,2305),Jt.backCCW=new Jt(!0,1029,2305);const Ql=o.identity(new Float32Array(16));function Wo(c,t,r,a,u,d){const{horizontalAlign:g,verticalAlign:x}=o.getAnchorAlignment(c),b=-(g-.5)*t,I=-(x-.5)*r,k=o.evaluateVariableOffset(c,a);return new o.pointGeometry((b/u+k[0])*d,(I/u+k[1])*d)}function Ws(c,t,r,a,u,d,g,x,b,I){const k=c.text.placedSymbolArray,L=c.text.dynamicLayoutVertexArray,O=c.icon.dynamicLayoutVertexArray,W={};L.clear();for(let U=0;U<k.length;U++){const Z=k.get(U),te=c.allowVerticalPlacement&&!Z.placedOrientation,ie=Z.hidden||!Z.crossTileID||te?null:a[Z.crossTileID];if(ie){const oe=new o.pointGeometry(Z.anchorX,Z.anchorY),ne=$t(oe,r?g:d),ye=Me(u.cameraToCenterDistance,ne.signedDistanceFromCamera);let pe=o.evaluateSizeForFeature(c.textSizeData,b,Z)*ye/o.ONE_EM;r&&(pe*=c.tilePixelRatio/x);const{width:fe,height:Ie,anchor:ke,textOffset:_e,textBoxScale:qe}=ie,Re=Wo(ke,fe,Ie,_e,qe,pe),ot=r?$t(oe.add(Re),d).point:ne.point.add(t?Re.rotate(-u.angle):Re),St=c.allowVerticalPlacement&&Z.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let gt=0;gt<Z.numGlyphs;gt++)o.addDynamicAttributes(L,ot,St);I&&Z.associatedIconIndex>=0&&(W[Z.associatedIconIndex]={shiftedAnchor:ot,angle:St})}else ni(Z.numGlyphs,L)}if(I){O.clear();const U=c.icon.placedSymbolArray;for(let Z=0;Z<U.length;Z++){const te=U.get(Z);if(te.hidden)ni(te.numGlyphs,O);else{const ie=W[Z];if(ie)for(let oe=0;oe<te.numGlyphs;oe++)o.addDynamicAttributes(O,ie.shiftedAnchor,ie.angle);else ni(te.numGlyphs,O)}}c.icon.dynamicLayoutVertexBuffer.updateData(O)}c.text.dynamicLayoutVertexBuffer.updateData(L)}function Hs(c,t,r){return r.iconsInText&&t?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function Xs(c,t,r,a,u,d,g,x,b,I,k,L){const O=c.context,W=O.gl,U=c.transform,Z=x==="map",te=b==="map",ie=x!=="viewport"&&r.layout.get("symbol-placement")!=="point",oe=Z&&!te&&!ie,ne=!r.layout.get("symbol-sort-key").isConstant();let ye=!1;const pe=c.depthModeForSublayer(0,Dt.ReadOnly),fe=r.layout.get("text-variable-anchor"),Ie=[];for(const ke of a){const _e=t.getTile(ke),qe=_e.getBucket(r);if(!qe)continue;const Re=u?qe.text:qe.icon;if(!Re||!Re.segments.get().length)continue;const ot=Re.programConfigurations.get(r.id),St=u||qe.sdfIcons,gt=u?qe.textSizeData:qe.iconSizeData,vt=te||U.pitch!==0,Yt=c.useProgram(Hs(St,u,qe),ot),at=o.evaluateSizeForZoom(gt,U.zoom);let Tt,Lt,vi,Yi,an=[0,0],ln=null;if(u){if(Lt=_e.glyphAtlasTexture,vi=W.LINEAR,Tt=_e.glyphAtlasTexture.size,qe.iconsInText){an=_e.imageAtlasTexture.size,ln=_e.imageAtlasTexture;const Mn=gt.kind==="composite"||gt.kind==="camera";Yi=vt||c.options.rotating||c.options.zooming||Mn?W.LINEAR:W.NEAREST}}else{const Mn=r.layout.get("icon-size").constantOr(0)!==1||qe.iconsNeedLinear;Lt=_e.imageAtlasTexture,vi=St||c.options.rotating||c.options.zooming||Mn||vt?W.LINEAR:W.NEAREST,Tt=_e.imageAtlasTexture.size}const nr=ui(_e,1,c.transform.zoom),Vi=ki(ke.posMatrix,te,Z,c.transform,nr),Pn=dr(ke.posMatrix,te,Z,c.transform,nr),Ar=fe&&qe.hasTextData(),Ki=r.layout.get("icon-text-fit")!=="none"&&Ar&&qe.hasIconData();if(ie){const Mn=r.layout.get("text-rotation-alignment")==="map";ut(qe,ke.posMatrix,c,u,Vi,Pn,te,I,Mn)}const Et=c.translatePosMatrix(ke.posMatrix,_e,d,g),Pt=ie||u&&fe||Ki?Ql:Vi,si=c.translatePosMatrix(Pn,_e,d,g,!0),Mi=St&&r.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Gt;Gt=St?qe.iconsInText?ql(gt.kind,at,oe,te,c,Et,Pt,si,Tt,an):Mo(gt.kind,at,oe,te,c,Et,Pt,si,u,Tt,!0):Us(gt.kind,at,oe,te,c,Et,Pt,si,u,Tt);const Ir={program:Yt,buffers:Re,uniformValues:Gt,atlasTexture:Lt,atlasTextureIcon:ln,atlasInterpolation:vi,atlasInterpolationIcon:Yi,isSDF:St,hasHalo:Mi};if(ne&&qe.canOverlap){ye=!0;const Mn=Re.segments.get();for(const lo of Mn)Ie.push({segments:new o.SegmentVector([lo]),sortKey:lo.sortKey,state:Ir})}else Ie.push({segments:Re.segments,sortKey:0,state:Ir})}ye&&Ie.sort((ke,_e)=>ke.sortKey-_e.sortKey);for(const ke of Ie){const _e=ke.state;if(O.activeTexture.set(W.TEXTURE0),_e.atlasTexture.bind(_e.atlasInterpolation,W.CLAMP_TO_EDGE),_e.atlasTextureIcon&&(O.activeTexture.set(W.TEXTURE1),_e.atlasTextureIcon&&_e.atlasTextureIcon.bind(_e.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),_e.isSDF){const qe=_e.uniformValues;_e.hasHalo&&(qe.u_is_halo=1,Ys(_e.buffers,ke.segments,r,c,_e.program,pe,k,L,qe)),qe.u_is_halo=0}Ys(_e.buffers,ke.segments,r,c,_e.program,pe,k,L,_e.uniformValues)}}function Ys(c,t,r,a,u,d,g,x,b){const I=a.context;u.draw(I,I.gl.TRIANGLES,d,g,x,Jt.disabled,b,r.id,c.layoutVertexBuffer,c.indexBuffer,t,r.paint,a.transform.zoom,c.programConfigurations.get(r.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function Ho(c,t,r,a,u,d,g){const x=c.context.gl,b=r.paint.get("fill-pattern"),I=b&&b.constantOr(1),k=r.getCrossfadeParameters();let L,O,W,U,Z;g?(O=I&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=x.LINES):(O=I?"fillPattern":"fill",L=x.TRIANGLES);for(const te of a){const ie=t.getTile(te);if(I&&!ie.patternsLoaded())continue;const oe=ie.getBucket(r);if(!oe)continue;const ne=oe.programConfigurations.get(r.id),ye=c.useProgram(O,ne);I&&(c.context.activeTexture.set(x.TEXTURE0),ie.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),ne.updatePaintBuffers(k));const pe=b.constantOr(null);if(pe&&ie.imageAtlas){const Ie=ie.imageAtlas,ke=Ie.patternPositions[pe.to.toString()],_e=Ie.patternPositions[pe.from.toString()];ke&&_e&&ne.setConstantPatternPositions(ke,_e)}const fe=c.translatePosMatrix(te.posMatrix,ie,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(g){U=oe.indexBuffer2,Z=oe.segments2;const Ie=[x.drawingBufferWidth,x.drawingBufferHeight];W=O==="fillOutlinePattern"&&I?Da(fe,c,k,ie,Ie):Ma(fe,Ie)}else U=oe.indexBuffer,Z=oe.segments,W=I?ko(fe,c,k,ie):zo(fe);ye.draw(c.context,L,u,c.stencilModeForClipping(te),d,Jt.disabled,W,r.id,oe.layoutVertexBuffer,U,Z,r.paint,c.transform.zoom,ne)}}function Vr(c,t,r,a,u,d,g){const x=c.context,b=x.gl,I=r.paint.get("fill-extrusion-pattern"),k=I.constantOr(1),L=r.getCrossfadeParameters(),O=r.paint.get("fill-extrusion-opacity");for(const W of a){const U=t.getTile(W),Z=U.getBucket(r);if(!Z)continue;const te=Z.programConfigurations.get(r.id),ie=c.useProgram(k?"fillExtrusionPattern":"fillExtrusion",te);k&&(c.context.activeTexture.set(b.TEXTURE0),U.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),te.updatePaintBuffers(L));const oe=I.constantOr(null);if(oe&&U.imageAtlas){const fe=U.imageAtlas,Ie=fe.patternPositions[oe.to.toString()],ke=fe.patternPositions[oe.from.toString()];Ie&&ke&&te.setConstantPatternPositions(Ie,ke)}const ne=c.translatePosMatrix(W.posMatrix,U,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),ye=r.paint.get("fill-extrusion-vertical-gradient"),pe=k?Co(ne,c,ye,O,W,L,U):Pa(ne,c,ye,O);ie.draw(x,x.gl.TRIANGLES,u,d,g,Jt.backCCW,pe,r.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,r.paint,c.transform.zoom,te)}}function Ks(c,t,r,a,u,d){const g=c.context,x=g.gl,b=t.fbo;if(!b)return;const I=c.useProgram("hillshade");g.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,b.colorAttachment.get());const k=((L,O,W)=>{const U=W.paint.get("hillshade-shadow-color"),Z=W.paint.get("hillshade-highlight-color"),te=W.paint.get("hillshade-accent-color");let ie=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(ie-=L.transform.angle);const oe=!L.options.moving;return{u_matrix:L.transform.calculatePosMatrix(O.tileID.toUnwrapped(),oe),u_image:0,u_latrange:Fs(0,O.tileID),u_light:[W.paint.get("hillshade-exaggeration"),ie],u_shadow:U,u_highlight:Z,u_accent:te}})(c,t,r);I.draw(g,x.TRIANGLES,a,u,d,Jt.disabled,k,r.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}function yn(c,t,r,a,u,d){const g=c.context,x=g.gl,b=t.dem;if(b&&b.data){const I=b.dim,k=b.stride,L=b.getPixels();if(g.activeTexture.set(x.TEXTURE1),g.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(k),t.demTexture){const W=t.demTexture;W.update(L,{premultiply:!1}),W.bind(x.NEAREST,x.CLAMP_TO_EDGE)}else t.demTexture=new ft(g,L,x.RGBA,{premultiply:!1}),t.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);g.activeTexture.set(x.TEXTURE0);let O=t.fbo;if(!O){const W=new ft(g,{width:I,height:I,data:null},x.RGBA);W.bind(x.LINEAR,x.CLAMP_TO_EDGE),O=t.fbo=g.createFramebuffer(I,I,!0),O.colorAttachment.set(W.texture)}g.bindFramebuffer.set(O.framebuffer),g.viewport.set([0,0,I,I]),c.useProgram("hillshadePrepare").draw(g,x.TRIANGLES,a,u,d,Jt.disabled,((W,U)=>{const Z=U.stride,te=o.create();return o.ortho(te,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(te,te,[0,-o.EXTENT,0]),{u_matrix:te,u_image:1,u_dimension:[Z,Z],u_zoom:W.overscaledZ,u_unpack:U.getUnpackVector()}})(t.tileID,b),r.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function qa(c,t,r,a,u){const d=a.paint.get("raster-fade-duration");if(d>0){const g=o.exported.now(),x=(g-c.timeAdded)/d,b=t?(g-t.timeAdded)/d:-1,I=r.getSource(),k=u.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),L=!t||Math.abs(t.tileID.overscaledZ-k)>Math.abs(c.tileID.overscaledZ-k),O=L&&c.refreshedUponExpiration?1:o.clamp(L?x:1-b,0,1);return c.refreshedUponExpiration&&x>=1&&(c.refreshedUponExpiration=!1),t?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}const Ga=new o.Color(1,0,0,1),Za=new o.Color(0,1,0,1),$r=new o.Color(0,0,1,1),Js=new o.Color(1,0,1,1),Xo=new o.Color(0,1,1,1);function Wa(c,t,r,a){eo(c,0,t+r/2,c.transform.width,r,a)}function Qs(c,t,r,a){eo(c,t-r/2,0,r,c.transform.height,a)}function eo(c,t,r,a,u,d){const g=c.context,x=g.gl;x.enable(x.SCISSOR_TEST),x.scissor(t*c.pixelRatio,r*c.pixelRatio,a*c.pixelRatio,u*c.pixelRatio),g.clear({color:d}),x.disable(x.SCISSOR_TEST)}function Ha(c,t,r){const a=c.context,u=a.gl,d=r.posMatrix,g=c.useProgram("debug"),x=Dt.disabled,b=jt.disabled,I=c.colorModeForRenderPass(),k="$debug";a.activeTexture.set(u.TEXTURE0),c.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),g.draw(a,u.LINE_STRIP,x,b,I,Jt.disabled,Br(d,o.Color.red),k,c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments);const L=t.getTileByID(r.key).latestRawTileData,O=Math.floor((L&&L.byteLength||0)/1024),W=t.getTile(r).tileSize,U=512/Math.min(W,512)*(r.overscaledZ/c.transform.zoom)*.5;let Z=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(Z+=` => ${r.overscaledZ}`),function(te,ie){te.initDebugOverlayCanvas();const oe=te.debugOverlayCanvas,ne=te.context.gl,ye=te.debugOverlayCanvas.getContext("2d");ye.clearRect(0,0,oe.width,oe.height),ye.shadowColor="white",ye.shadowBlur=2,ye.lineWidth=1.5,ye.strokeStyle="white",ye.textBaseline="top",ye.font="bold 36px Open Sans, sans-serif",ye.fillText(ie,5,5),ye.strokeText(ie,5,5),te.debugOverlayTexture.update(oe),te.debugOverlayTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE)}(c,`${Z} ${O}kb`),g.draw(a,u.TRIANGLES,x,b,lt.alphaBlended,Jt.disabled,Br(d,o.Color.transparent,U),k,c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}const ds={symbol:function(c,t,r,a,u){if(c.renderPass!=="translucent")return;const d=jt.disabled,g=c.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(x,b,I,k,L,O,W){const U=b.transform,Z=L==="map",te=O==="map";for(const ie of x){const oe=k.getTile(ie),ne=oe.getBucket(I);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const ye=o.evaluateSizeForZoom(ne.textSizeData,U.zoom),pe=ui(oe,1,b.transform.zoom),fe=ki(ie.posMatrix,te,Z,b.transform,pe),Ie=I.layout.get("icon-text-fit")!=="none"&&ne.hasIconData();if(ye){const ke=Math.pow(2,U.zoom-oe.tileID.overscaledZ);Ws(ne,Z,te,W,U,fe,ie.posMatrix,ke,ye,Ie)}}}(a,c,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),u),r.paint.get("icon-opacity").constantOr(1)!==0&&Xs(c,t,r,a,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),d,g),r.paint.get("text-opacity").constantOr(1)!==0&&Xs(c,t,r,a,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),d,g),t.map.showCollisionBoxes&&(Zo(c,t,r,a,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Zo(c,t,r,a,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(c,t,r,a){if(c.renderPass!=="translucent")return;const u=r.paint.get("circle-opacity"),d=r.paint.get("circle-stroke-width"),g=r.paint.get("circle-stroke-opacity"),x=!r.layout.get("circle-sort-key").isConstant();if(u.constantOr(1)===0&&(d.constantOr(1)===0||g.constantOr(1)===0))return;const b=c.context,I=b.gl,k=c.depthModeForSublayer(0,Dt.ReadOnly),L=jt.disabled,O=c.colorModeForRenderPass(),W=[];for(let U=0;U<a.length;U++){const Z=a[U],te=t.getTile(Z),ie=te.getBucket(r);if(!ie)continue;const oe=ie.programConfigurations.get(r.id),ne={programConfiguration:oe,program:c.useProgram("circle",oe),layoutVertexBuffer:ie.layoutVertexBuffer,indexBuffer:ie.indexBuffer,uniformValues:gr(c,Z,te,r)};if(x){const ye=ie.segments.get();for(const pe of ye)W.push({segments:new o.SegmentVector([pe]),sortKey:pe.sortKey,state:ne})}else W.push({segments:ie.segments,sortKey:0,state:ne})}x&&W.sort((U,Z)=>U.sortKey-Z.sortKey);for(const U of W){const{programConfiguration:Z,program:te,layoutVertexBuffer:ie,indexBuffer:oe,uniformValues:ne}=U.state;te.draw(b,I.TRIANGLES,k,L,O,Jt.disabled,ne,r.id,ie,oe,U.segments,r.paint,c.transform.zoom,Z)}},heatmap:function(c,t,r,a){if(r.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const u=c.context,d=u.gl,g=jt.disabled,x=new lt([d.ONE,d.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(b,I,k){const L=b.gl;b.activeTexture.set(L.TEXTURE1),b.viewport.set([0,0,I.width/4,I.height/4]);let O=k.heatmapFbo;if(O)L.bindTexture(L.TEXTURE_2D,O.colorAttachment.get()),b.bindFramebuffer.set(O.framebuffer);else{const W=L.createTexture();L.bindTexture(L.TEXTURE_2D,W),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,L.LINEAR),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,L.LINEAR),O=k.heatmapFbo=b.createFramebuffer(I.width/4,I.height/4,!1),function(U,Z,te,ie){const oe=U.gl;oe.texImage2D(oe.TEXTURE_2D,0,oe.RGBA,Z.width/4,Z.height/4,0,oe.RGBA,U.extRenderToTextureHalfFloat?U.extTextureHalfFloat.HALF_FLOAT_OES:oe.UNSIGNED_BYTE,null),ie.colorAttachment.set(te)}(b,I,W,O)}})(u,c,r),u.clear({color:o.Color.transparent});for(let b=0;b<a.length;b++){const I=a[b];if(t.hasRenderableParent(I))continue;const k=t.getTile(I),L=k.getBucket(r);if(!L)continue;const O=L.programConfigurations.get(r.id),W=c.useProgram("heatmap",O),{zoom:U}=c.transform;W.draw(u,d.TRIANGLES,Dt.disabled,g,x,Jt.disabled,Bs(I.posMatrix,k,U,r.paint.get("heatmap-intensity")),r.id,L.layoutVertexBuffer,L.indexBuffer,L.segments,r.paint,c.transform.zoom,O)}u.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(u,d){const g=u.context,x=g.gl,b=d.heatmapFbo;if(!b)return;g.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,b.colorAttachment.get()),g.activeTexture.set(x.TEXTURE1);let I=d.colorRampTexture;I||(I=d.colorRampTexture=new ft(g,d.colorRamp,x.RGBA)),I.bind(x.LINEAR,x.CLAMP_TO_EDGE),u.useProgram("heatmapTexture").draw(g,x.TRIANGLES,Dt.disabled,jt.disabled,u.colorModeForRenderPass(),Jt.disabled,((k,L,O,W)=>{const U=o.create();o.ortho(U,0,k.width,k.height,0,0,1);const Z=k.context.gl;return{u_matrix:U,u_world:[Z.drawingBufferWidth,Z.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:L.paint.get("heatmap-opacity")}})(u,d),d.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments,d.paint,u.transform.zoom)}(c,r))},line:function(c,t,r,a){if(c.renderPass!=="translucent")return;const u=r.paint.get("line-opacity"),d=r.paint.get("line-width");if(u.constantOr(1)===0||d.constantOr(1)===0)return;const g=c.depthModeForSublayer(0,Dt.ReadOnly),x=c.colorModeForRenderPass(),b=r.paint.get("line-dasharray"),I=r.paint.get("line-pattern"),k=I.constantOr(1),L=r.paint.get("line-gradient"),O=r.getCrossfadeParameters(),W=k?"linePattern":b?"lineSDF":L?"lineGradient":"line",U=c.context,Z=U.gl;let te=!0;for(const ie of a){const oe=t.getTile(ie);if(k&&!oe.patternsLoaded())continue;const ne=oe.getBucket(r);if(!ne)continue;const ye=ne.programConfigurations.get(r.id),pe=c.context.program.get(),fe=c.useProgram(W,ye),Ie=te||fe.program!==pe,ke=I.constantOr(null);if(ke&&oe.imageAtlas){const qe=oe.imageAtlas,Re=qe.patternPositions[ke.to.toString()],ot=qe.patternPositions[ke.from.toString()];Re&&ot&&ye.setConstantPatternPositions(Re,ot)}const _e=k?cs(c,oe,r,O):b?ri(c,oe,r,b,O):L?Os(c,oe,r,ne.lineClipsArray.length):ls(c,oe,r);if(k)U.activeTexture.set(Z.TEXTURE0),oe.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),ye.updatePaintBuffers(O);else if(b&&(Ie||c.lineAtlas.dirty))U.activeTexture.set(Z.TEXTURE0),c.lineAtlas.bind(U);else if(L){const qe=ne.gradients[r.id];let Re=qe.texture;if(r.gradientVersion!==qe.version){let ot=256;if(r.stepInterpolant){const St=t.getSource().maxzoom,gt=ie.canonical.z===St?Math.ceil(1<<c.transform.maxZoom-ie.canonical.z):1;ot=o.clamp(o.nextPowerOfTwo(ne.maxLineLength/o.EXTENT*1024*gt),256,U.maxTextureSize)}qe.gradient=o.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:ot,image:qe.gradient||void 0,clips:ne.lineClipsArray}),qe.texture?qe.texture.update(qe.gradient):qe.texture=new ft(U,qe.gradient,Z.RGBA),qe.version=r.gradientVersion,Re=qe.texture}U.activeTexture.set(Z.TEXTURE0),Re.bind(r.stepInterpolant?Z.NEAREST:Z.LINEAR,Z.CLAMP_TO_EDGE)}fe.draw(U,Z.TRIANGLES,g,c.stencilModeForClipping(ie),x,Jt.disabled,_e,r.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,r.paint,c.transform.zoom,ye,ne.layoutVertexBuffer2),te=!1}},fill:function(c,t,r,a){const u=r.paint.get("fill-color"),d=r.paint.get("fill-opacity");if(d.constantOr(1)===0)return;const g=c.colorModeForRenderPass(),x=r.paint.get("fill-pattern"),b=c.opaquePassEnabledForLayer()&&!x.constantOr(1)&&u.constantOr(o.Color.transparent).a===1&&d.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===b){const I=c.depthModeForSublayer(1,c.renderPass==="opaque"?Dt.ReadWrite:Dt.ReadOnly);Ho(c,t,r,a,I,g,!1)}if(c.renderPass==="translucent"&&r.paint.get("fill-antialias")){const I=c.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Dt.ReadOnly);Ho(c,t,r,a,I,g,!0)}},"fill-extrusion":function(c,t,r,a){const u=r.paint.get("fill-extrusion-opacity");if(u!==0&&c.renderPass==="translucent"){const d=new Dt(c.context.gl.LEQUAL,Dt.ReadWrite,c.depthRangeFor3D);if(u!==1||r.paint.get("fill-extrusion-pattern").constantOr(1))Vr(c,t,r,a,d,jt.disabled,lt.disabled),Vr(c,t,r,a,d,c.stencilModeFor3D(),c.colorModeForRenderPass());else{const g=c.colorModeForRenderPass();Vr(c,t,r,a,d,jt.disabled,g)}}},hillshade:function(c,t,r,a){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const u=c.context,d=c.depthModeForSublayer(0,Dt.ReadOnly),g=c.colorModeForRenderPass(),[x,b]=c.renderPass==="translucent"?c.stencilConfigForOverlap(a):[{},a];for(const I of b){const k=t.getTile(I);k.needsHillshadePrepare&&c.renderPass==="offscreen"?yn(c,k,r,d,jt.disabled,g):c.renderPass==="translucent"&&Ks(c,k,r,d,x[I.overscaledZ],g)}u.viewport.set([0,0,c.width,c.height])},raster:function(c,t,r,a){if(c.renderPass!=="translucent"||r.paint.get("raster-opacity")===0||!a.length)return;const u=c.context,d=u.gl,g=t.getSource(),x=c.useProgram("raster"),b=c.colorModeForRenderPass(),[I,k]=g instanceof $n?[{},a]:c.stencilConfigForOverlap(a),L=k[k.length-1].overscaledZ,O=!c.options.moving;for(const W of k){const U=c.depthModeForSublayer(W.overscaledZ-L,r.paint.get("raster-opacity")===1?Dt.ReadWrite:Dt.ReadOnly,d.LESS),Z=t.getTile(W),te=c.transform.calculatePosMatrix(W.toUnwrapped(),O);Z.registerFadeDuration(r.paint.get("raster-fade-duration"));const ie=t.findLoadedParent(W,0),oe=qa(Z,ie,t,r,c.transform);let ne,ye;const pe=r.paint.get("raster-resampling")==="nearest"?d.NEAREST:d.LINEAR;u.activeTexture.set(d.TEXTURE0),Z.texture.bind(pe,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),u.activeTexture.set(d.TEXTURE1),ie?(ie.texture.bind(pe,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),ne=Math.pow(2,ie.tileID.overscaledZ-Z.tileID.overscaledZ),ye=[Z.tileID.canonical.x*ne%1,Z.tileID.canonical.y*ne%1]):Z.texture.bind(pe,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST);const fe=La(te,ye||[0,0],ne||1,oe,r);g instanceof $n?x.draw(u,d.TRIANGLES,U,jt.disabled,b,Jt.disabled,fe,r.id,g.boundsBuffer,c.quadTriangleIndexBuffer,g.boundsSegments):x.draw(u,d.TRIANGLES,U,I[W.overscaledZ],b,Jt.disabled,fe,r.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}},background:function(c,t,r){const a=r.paint.get("background-color"),u=r.paint.get("background-opacity");if(u===0)return;const d=c.context,g=d.gl,x=c.transform,b=x.tileSize,I=r.paint.get("background-pattern");if(c.isPatternMissing(I))return;const k=!I&&a.a===1&&u===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==k)return;const L=jt.disabled,O=c.depthModeForSublayer(0,k==="opaque"?Dt.ReadWrite:Dt.ReadOnly),W=c.colorModeForRenderPass(),U=c.useProgram(I?"backgroundPattern":"background"),Z=x.coveringTiles({tileSize:b});I&&(d.activeTexture.set(g.TEXTURE0),c.imageManager.bind(c.context));const te=r.getCrossfadeParameters();for(const ie of Z){const oe=c.transform.calculatePosMatrix(ie.toUnwrapped()),ne=I?Do(oe,u,c,I,{tileID:ie,tileSize:b},te):Gl(oe,u,a);U.draw(d,g.TRIANGLES,O,L,W,Jt.disabled,ne,r.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}},debug:function(c,t,r){for(let a=0;a<r.length;a++)Ha(c,t,r[a])},custom:function(c,t,r){const a=c.context,u=r.implementation;if(c.renderPass==="offscreen"){const d=u.prerender;d&&(c.setCustomLayerDefaults(),a.setColorMode(c.colorModeForRenderPass()),d.call(u,a.gl,c.transform.customLayerMatrix()),a.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),a.setColorMode(c.colorModeForRenderPass()),a.setStencilMode(jt.disabled);const d=u.renderingMode==="3d"?new Dt(c.context.gl.LEQUAL,Dt.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,Dt.ReadOnly);a.setDepthMode(d),u.render(a.gl,c.transform.customLayerMatrix()),a.setDirty(),c.setBaseState(),a.bindFramebuffer.set(null)}}};class Yo{constructor(t,r){this.context=new qs(t),this.transform=r,this._tileTextures={},this.setup(),this.numSublayers=fi.maxUnderzooming+fi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new pt,this.gpuTimers={}}resize(t,r,a){if(this.width=t*a,this.height=r*a,this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const t=this.context,r=new o.PosArray;r.emplaceBack(0,0),r.emplaceBack(o.EXTENT,0),r.emplaceBack(0,o.EXTENT),r.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(r,Ao.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const a=new o.PosArray;a.emplaceBack(0,0),a.emplaceBack(o.EXTENT,0),a.emplaceBack(0,o.EXTENT),a.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=t.createVertexBuffer(a,Ao.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const u=new o.RasterBoundsArray;u.emplaceBack(0,0,0,0),u.emplaceBack(o.EXTENT,0,o.EXTENT,0),u.emplaceBack(0,o.EXTENT,0,o.EXTENT),u.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(u,ar.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const d=new o.PosArray;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(d,Ao.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const g=new o.LineStripIndexArray;g.emplaceBack(0),g.emplaceBack(1),g.emplaceBack(3),g.emplaceBack(2),g.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(g);const x=new o.TriangleIndexArray;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x),this.emptyTexture=new ft(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const b=this.context.gl;this.stencilClearMode=new jt({func:b.ALWAYS,mask:0},0,255,b.ZERO,b.ZERO,b.ZERO)}clearStencil(){const t=this.context,r=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=o.create();o.ortho(a,0,this.width,this.height,0,0,1),o.scale(a,a,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,r.TRIANGLES,Dt.disabled,this.stencilClearMode,lt.disabled,Jt.disabled,as(a),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,r){if(this.currentStencilSource===t.source||!t.isTileClipped()||!r||!r.length)return;this.currentStencilSource=t.source;const a=this.context,u=a.gl;this.nextStencilID+r.length>256&&this.clearStencil(),a.setColorMode(lt.disabled),a.setDepthMode(Dt.disabled);const d=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const g of r){const x=this._tileClippingMaskIDs[g.key]=this.nextStencilID++;d.draw(a,u.TRIANGLES,Dt.disabled,new jt({func:u.ALWAYS,mask:0},x,255,u.KEEP,u.KEEP,u.REPLACE),lt.disabled,Jt.disabled,as(g.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new jt({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){const r=this.context.gl;return new jt({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,a=t.sort((g,x)=>x.overscaledZ-g.overscaledZ),u=a[a.length-1].overscaledZ,d=a[0].overscaledZ-u+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const g={};for(let x=0;x<d;x++)g[x+u]=new jt({func:r.GEQUAL,mask:255},x+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=d,[g,a]}return[{[u]:jt.disabled},a]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new lt([t.CONSTANT_COLOR,t.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?lt.unblended:lt.alphaBlended}depthModeForSublayer(t,r,a){if(!this.opaquePassEnabledForLayer())return Dt.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Dt(a||this.context.gl.LEQUAL,r,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){this.style=t,this.options=r,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const a=this.style._order,u=this.style.sourceCaches;for(const b in u){const I=u[b];I.used&&I.prepare(this.context)}const d={},g={},x={};for(const b in u){const I=u[b];d[b]=I.getVisibleCoordinates(),g[b]=d[b].slice().reverse(),x[b]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let b=0;b<a.length;b++)if(this.style._layers[a[b]].is3D()){this.opaquePassCutoff=b;break}this.renderPass="offscreen";for(const b of a){const I=this.style._layers[b];if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const k=g[I.source];(I.type==="custom"||k.length)&&this.renderLayer(this,u[I.source],I,k)}for(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const b=this.style._layers[a[this.currentLayer]],I=u[b.source],k=d[b.source];this._renderTileClippingMasks(b,k),this.renderLayer(this,I,b,k)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const b=this.style._layers[a[this.currentLayer]],I=u[b.source],k=(b.type==="symbol"?x:g)[b.source];this._renderTileClippingMasks(b,d[b.source]),this.renderLayer(this,I,b,k)}if(this.options.showTileBoundaries){let b,I;Object.values(this.style._layers).forEach(k=>{k.source&&!k.isHidden(this.transform.zoom)&&(k.source!==(I&&I.id)&&(I=this.style.sourceCaches[k.source]),(!b||b.getSource().maxzoom<I.getSource().maxzoom)&&(b=I))}),b&&ds.debug(this,b,b.getVisibleCoordinates())}this.options.showPadding&&function(b){const I=b.transform.padding;Wa(b,b.transform.height-(I.top||0),3,Ga),Wa(b,I.bottom||0,3,Za),Qs(b,I.left||0,3,$r),Qs(b,b.transform.width-(I.right||0),3,Js);const k=b.transform.centerPoint;(function(L,O,W,U){eo(L,O-1,W-10,2,20,U),eo(L,O-10,W-1,20,2,U)})(b,k.x,b.transform.height-k.y,Xo)}(this),this.context.setDefault()}renderLayer(t,r,a,u){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||u.length)&&(this.id=a.id,this.gpuTimingStart(a),ds[a.type](t,r,a,u,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;let a=this.gpuTimers[t.id];a||(a=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:r.createQueryEXT()}),a.calls++,r.beginQueryEXT(r.TIME_ELAPSED_EXT,a.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const r={};for(const a in t){const u=t[a],d=this.context.extTimerQuery,g=d.getQueryObjectEXT(u.query,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(u.query),r[a]=g}return r}translatePosMatrix(t,r,a,u,d){if(!a[0]&&!a[1])return t;const g=d?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(g){const I=Math.sin(g),k=Math.cos(g);a=[a[0]*k-a[1]*I,a[0]*I+a[1]*k]}const x=[d?a[0]:ui(r,a[0],this.transform.zoom),d?a[1]:ui(r,a[1],this.transform.zoom),0],b=new Float32Array(16);return o.translate(b,t,x),b}saveTileTexture(t){const r=this._tileTextures[t.size[0]];r?r.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const r=this.imageManager.getPattern(t.from.toString()),a=this.imageManager.getPattern(t.to.toString());return!r||!a}useProgram(t,r){this.cache=this.cache||{};const a=`${t}${r?r.cacheKey:""}${this._showOverdrawInspector?"/overdraw":""}`;return this.cache[a]||(this.cache[a]=new jl(this.context,t,Io[t],r,Lo[t],this._showOverdrawInspector)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ft(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class to{constructor(t,r){this.points=t,this.planes=r}static fromInvProjectionMatrix(t,r,a){const u=Math.pow(2,a),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>o.transformMat4([],x,t)).map(x=>o.scale$1([],x,1/x[3]/r*u)),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const b=function(O,W){var U=W[0],Z=W[1],te=W[2],ie=U*U+Z*Z+te*te;return ie>0&&(ie=1/Math.sqrt(ie)),O[0]=W[0]*ie,O[1]=W[1]*ie,O[2]=W[2]*ie,O}([],function(O,W,U){var Z=W[0],te=W[1],ie=W[2],oe=U[0],ne=U[1],ye=U[2];return O[0]=te*ye-ie*ne,O[1]=ie*oe-Z*ye,O[2]=Z*ne-te*oe,O}([],We([],d[x[0]],d[x[1]]),We([],d[x[2]],d[x[1]]))),I=-((k=b)[0]*(L=d[x[1]])[0]+k[1]*L[1]+k[2]*L[2]);var k,L;return b.concat(I)});return new to(d,g)}}class io{constructor(t,r){this.min=t,this.max=r,this.center=function(a,u,d){return a[0]=.5*u[0],a[1]=.5*u[1],a[2]=.5*u[2],a}([],function(a,u,d){return a[0]=u[0]+d[0],a[1]=u[1]+d[1],a[2]=u[2]+d[2],a}([],this.min,this.max))}quadrant(t){const r=[t%2==0,t<2],a=ze(this.min),u=ze(this.max);for(let d=0;d<r.length;d++)a[d]=r[d]?this.min[d]:this.center[d],u[d]=r[d]?this.center[d]:this.max[d];return u[2]=this.max[2],new io(a,u)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const r=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]];let a=!0;for(let u=0;u<t.planes.length;u++){const d=t.planes[u];let g=0;for(let x=0;x<r.length;x++)o.dot(d,r[x])>=0&&g++;if(g===0)return 0;g!==r.length&&(a=!1)}if(a)return 2;for(let u=0;u<3;u++){let d=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let x=0;x<t.points.length;x++){const b=t.points[x][u]-this.min[u];d=Math.min(d,b),g=Math.max(g,b)}if(g<0||d>this.max[u]-this.min[u])return 0}return 1}}class Nr{constructor(t=0,r=0,a=0,u=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(a)||a<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=a,this.right=u}interpolate(t,r,a){return r.top!=null&&t.top!=null&&(this.top=o.number(t.top,r.top,a)),r.bottom!=null&&t.bottom!=null&&(this.bottom=o.number(t.bottom,r.bottom,a)),r.left!=null&&t.left!=null&&(this.left=o.number(t.left,r.left,a)),r.right!=null&&t.right!=null&&(this.right=o.number(t.right,r.right,a)),this}getCenter(t,r){const a=o.clamp((this.left+t-this.right)/2,0,t),u=o.clamp((this.top+r-this.bottom)/2,0,r);return new o.pointGeometry(a,u)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Nr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class fs{constructor(t,r,a,u,d){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=d===void 0||!!d,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=a==null?0:a,this._maxPitch=u==null?60:u,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Nr,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new fs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const r=-o.wrap(t,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=function(){var a=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,u,d){var g=u[0],x=u[1],b=u[2],I=u[3],k=Math.sin(d),L=Math.cos(d);a[0]=g*L+b*k,a[1]=x*L+I*k,a[2]=g*-k+b*L,a[3]=x*-k+I*L}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=o.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,a){this._unmodified=!1,this._edgeInsets.interpolate(t,r,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new o.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const a=this.pointCoordinate(new o.pointGeometry(0,0)),u=this.pointCoordinate(new o.pointGeometry(this.width,0)),d=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),g=this.pointCoordinate(new o.pointGeometry(0,this.height)),x=Math.floor(Math.min(a.x,u.x,d.x,g.x)),b=Math.floor(Math.max(a.x,u.x,d.x,g.x)),I=1;for(let k=x-I;k<=b+I;k++)k!==0&&r.push(new o.UnwrappedTileID(k,t))}return r}coveringTiles(t){let r=this.coveringZoomLevel(t);const a=r;if(t.minzoom!==void 0&&r<t.minzoom)return[];t.maxzoom!==void 0&&r>t.maxzoom&&(r=t.maxzoom);const u=o.MercatorCoordinate.fromLngLat(this.center),d=Math.pow(2,r),g=[d*u.x,d*u.y,0],x=to.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r);let b=t.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(b=r);const I=U=>({aabb:new io([U*d,0,0],[(U+1)*d,d,0]),zoom:0,x:0,y:0,wrap:U,fullyVisible:!1}),k=[],L=[],O=r,W=t.reparseOverscaled?a:r;if(this._renderWorldCopies)for(let U=1;U<=3;U++)k.push(I(-U)),k.push(I(U));for(k.push(I(0));k.length>0;){const U=k.pop(),Z=U.x,te=U.y;let ie=U.fullyVisible;if(!ie){const fe=U.aabb.intersects(x);if(fe===0)continue;ie=fe===2}const oe=U.aabb.distanceX(g),ne=U.aabb.distanceY(g),ye=Math.max(Math.abs(oe),Math.abs(ne)),pe=3+(1<<O-U.zoom)-2;if(U.zoom===O||ye>pe&&U.zoom>=b)L.push({tileID:new o.OverscaledTileID(U.zoom===O?W:U.zoom,U.wrap,U.zoom,Z,te),distanceSq:kt([g[0]-.5-Z,g[1]-.5-te])});else for(let fe=0;fe<4;fe++){const Ie=(Z<<1)+fe%2,ke=(te<<1)+(fe>>1);k.push({aabb:U.aabb.quadrant(fe),zoom:U.zoom+1,x:Ie,y:ke,wrap:U.wrap,fullyVisible:ie})}}return L.sort((U,Z)=>U.distanceSq-Z.distanceSq).map(U=>U.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=o.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.pointGeometry(o.mercatorXfromLng(t.lng)*this.worldSize,o.mercatorYfromLat(r)*this.worldSize)}unproject(t){return new o.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(t,r){const a=this.pointCoordinate(r),u=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(t),g=new o.MercatorCoordinate(d.x-(a.x-u.x),d.y-(a.y-u.y));this.center=this.coordinateLocation(g),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}locationCoordinate(t){return o.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t.toLngLat()}pointCoordinate(t){const r=[t.x,t.y,0,1],a=[t.x,t.y,1,1];o.transformMat4(r,r,this.pixelMatrixInverse),o.transformMat4(a,a,this.pixelMatrixInverse);const u=r[3],d=a[3],g=r[1]/u,x=a[1]/d,b=r[2]/u,I=a[2]/d,k=b===I?0:(0-b)/(I-b);return new o.MercatorCoordinate(o.number(r[0]/u,a[0]/d,k)/this.worldSize,o.number(g,x,k)/this.worldSize)}coordinatePoint(t){const r=[t.x*this.worldSize,t.y*this.worldSize,0,1];return o.transformMat4(r,r,this.pixelMatrix),new o.pointGeometry(r[0]/r[3],r[1]/r[3])}getBounds(){return new o.LngLatBounds().extend(this.pointLocation(new o.pointGeometry(0,0))).extend(this.pointLocation(new o.pointGeometry(this.width,0))).extend(this.pointLocation(new o.pointGeometry(this.width,this.height))).extend(this.pointLocation(new o.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new o.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,r=!1){const a=t.key,u=r?this._alignedPosMatrixCache:this._posMatrixCache;if(u[a])return u[a];const d=t.canonical,g=this.worldSize/this.zoomScale(d.z),x=d.x+Math.pow(2,d.z)*t.wrap,b=o.identity(new Float64Array(16));return o.translate(b,b,[x*g,d.y*g,0]),o.scale(b,b,[g/o.EXTENT,g/o.EXTENT,1]),o.multiply(b,r?this.alignedProjMatrix:this.projMatrix,b),u[a]=new Float32Array(b),u[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,r,a,u,d=-90,g=90,x=-180,b=180;const I=this.size,k=this._unmodified;if(this.latRange){const W=this.latRange;d=o.mercatorYfromLat(W[1])*this.worldSize,g=o.mercatorYfromLat(W[0])*this.worldSize,t=g-d<I.y?I.y/(g-d):0}if(this.lngRange){const W=this.lngRange;x=o.mercatorXfromLng(W[0])*this.worldSize,b=o.mercatorXfromLng(W[1])*this.worldSize,r=b-x<I.x?I.x/(b-x):0}const L=this.point,O=Math.max(r||0,t||0);if(O)return this.center=this.unproject(new o.pointGeometry(r?(b+x)/2:L.x,t?(g+d)/2:L.y)),this.zoom+=this.scaleZoom(O),this._unmodified=k,void(this._constraining=!1);if(this.latRange){const W=L.y,U=I.y/2;W-U<d&&(u=d+U),W+U>g&&(u=g-U)}if(this.lngRange){const W=L.x,U=I.x/2;W-U<x&&(a=x+U),W+U>b&&(a=b-U)}a===void 0&&u===void 0||(this.center=this.unproject(new o.pointGeometry(a!==void 0?a:L.x,u!==void 0?u:L.y))),this._unmodified=k,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const r=Math.PI/2+this._pitch,a=this._fov*(.5+t.y/this.height),u=Math.sin(a)*this.cameraToCenterDistance/Math.sin(o.clamp(Math.PI-r-a,.01,Math.PI-.01)),d=this.point,g=d.x,x=d.y,b=1.01*(Math.cos(Math.PI/2-this._pitch)*u+this.cameraToCenterDistance),I=this.height/50;let k=new Float64Array(16);o.perspective(k,this._fov,this.width/this.height,I,b),k[8]=2*-t.x/this.width,k[9]=2*t.y/this.height,o.scale(k,k,[1,-1,1]),o.translate(k,k,[0,0,-this.cameraToCenterDistance]),o.rotateX(k,k,this._pitch),o.rotateZ(k,k,this.angle),o.translate(k,k,[-g,-x,0]),this.mercatorMatrix=o.scale([],k,[this.worldSize,this.worldSize,this.worldSize]),o.scale(k,k,[1,1,o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize]),this.projMatrix=k,this.invProjMatrix=o.invert([],this.projMatrix);const L=this.width%2/2,O=this.height%2/2,W=Math.cos(this.angle),U=Math.sin(this.angle),Z=g-Math.round(g)+W*L+U*O,te=x-Math.round(x)+W*O+U*L,ie=new Float64Array(k);if(o.translate(ie,ie,[Z>.5?Z-1:Z,te>.5?te-1:te,0]),this.alignedProjMatrix=ie,k=o.create(),o.scale(k,k,[this.width/2,-this.height/2,1]),o.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=o.create(),o.scale(k,k,[1,-1,1]),o.translate(k,k,[-1,-1,0]),o.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),k=o.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");this.pixelMatrixInverse=k,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new o.pointGeometry(0,0)),r=[t.x*this.worldSize,t.y*this.worldSize,0,1];return o.transformMat4(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,t))}getCameraQueryGeometry(t){const r=this.getCameraPoint();if(t.length===1)return[t[0],r];{let a=r.x,u=r.y,d=r.x,g=r.y;for(const x of t)a=Math.min(a,x.x),u=Math.min(u,x.y),d=Math.max(d,x.x),g=Math.max(g,x.y);return[new o.pointGeometry(a,u),new o.pointGeometry(d,u),new o.pointGeometry(d,g),new o.pointGeometry(a,g),new o.pointGeometry(a,u)]}}}class Xa{constructor(t){this._hashName=t&&encodeURIComponent(t),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(r,a){let u=!1,d=null;const g=()=>{d=null,u&&(r(),d=setTimeout(g,300),u=!1)};return()=>(u=!0,d||g(),d)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const r=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,u=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,u),g=Math.round(r.lng*d)/d,x=Math.round(r.lat*d)/d,b=this._map.getBearing(),I=this._map.getPitch();let k="";if(k+=t?`/${g}/${x}/${a}`:`${a}/${x}/${g}`,(b||I)&&(k+="/"+Math.round(10*b)/10),I&&(k+=`/${Math.round(I)}`),this._hashName){const L=this._hashName;let O=!1;const W=window.location.hash.slice(1).split("&").map(U=>{const Z=U.split("=")[0];return Z===L?(O=!0,`${Z}=${k}`):U}).filter(U=>U);return O||W.push(`${L}=${k}`),`#${W.join("&")}`}return`#${k}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let r;return t.split("&").map(a=>a.split("=")).forEach(a=>{a[0]===this._hashName&&(r=a)}),(r&&r[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(r=>isNaN(r))){const r=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:r,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const ms={linearity:.3,easing:o.bezier(0,0,.3,1)},Ya=o.extend({deceleration:2500,maxSpeed:1400},ms),Ka=o.extend({deceleration:20,maxSpeed:1400},ms),Ja=o.extend({deceleration:1e3,maxSpeed:360},ms),jr=o.extend({deceleration:1e3,maxSpeed:90},ms);class Qa{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=o.exported.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)r.zoom+=d.zoomDelta||0,r.bearing+=d.bearingDelta||0,r.pitch+=d.pitchDelta||0,d.panDelta&&r.pan._add(d.panDelta),d.around&&(r.around=d.around),d.pinchAround&&(r.pinchAround=d.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(r.pan.mag()){const d=_s(r.pan.mag(),a,o.extend({},Ya,t||{}));u.offset=r.pan.mult(d.amount/r.pan.mag()),u.center=this._map.transform.center,gs(u,d)}if(r.zoom){const d=_s(r.zoom,a,Ka);u.zoom=this._map.transform.zoom+d.amount,gs(u,d)}if(r.bearing){const d=_s(r.bearing,a,Ja);u.bearing=this._map.transform.bearing+o.clamp(d.amount,-179,179),gs(u,d)}if(r.pitch){const d=_s(r.pitch,a,jr);u.pitch=this._map.transform.pitch+d.amount,gs(u,d)}if(u.zoom||u.bearing){const d=r.pinchAround===void 0?r.around:r.pinchAround;u.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),o.extend(u,{noMoveStart:!0})}}function gs(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function _s(c,t,r){const{maxSpeed:a,linearity:u,deceleration:d}=r,g=o.clamp(c*u/(t/1e3),-a,a),x=Math.abs(g)/(d*u);return{easing:r.easing,duration:1e3*x,amount:g*(x/2)}}class Xi extends o.Event{constructor(t,r,a,u={}){const d=j.mousePos(r.getCanvasContainer(),a),g=r.unproject(d);super(t,o.extend({point:d,lngLat:g,originalEvent:a},u)),this._defaultPrevented=!1,this.target=r}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Fi extends o.Event{constructor(t,r,a){const u=t==="touchend"?a.changedTouches:a.touches,d=j.touchPos(r.getCanvasContainer(),u),g=d.map(b=>r.unproject(b)),x=d.reduce((b,I,k,L)=>b.add(I.div(L.length)),new o.pointGeometry(0,0));super(t,{points:d,point:x,lngLats:g,lngLat:r.unproject(x),originalEvent:a}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ec extends o.Event{constructor(t,r,a){super(t,{originalEvent:a}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class xr{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new ec(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new Xi(t.type,this._map,t))}mouseup(t){this._map.fire(new Xi(t.type,this._map,t))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new Xi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Xi(t.type,this._map,t))}mouseover(t){this._map.fire(new Xi(t.type,this._map,t))}mouseout(t){this._map.fire(new Xi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Fi(t.type,this._map,t))}touchmove(t){this._map.fire(new Fi(t.type,this._map,t))}touchend(t){this._map.fire(new Fi(t.type,this._map,t))}touchcancel(t){this._map.fire(new Fi(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class el{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Xi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Xi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qr{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(j.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const a=r;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=a,this._box||(this._box=j.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const d=Math.min(u.x,a.x),g=Math.max(u.x,a.x),x=Math.min(u.y,a.y),b=Math.max(u.y,a.y);j.setTransform(this._box,`translate(${d}px,${x}px)`),this._box.style.width=g-d+"px",this._box.style.height=b-x+"px"}mouseupWindow(t,r){if(!this._active||t.button!==0)return;const a=this._startPos,u=r;if(this.reset(),j.suppressClick(),a.x!==u.x||a.y!==u.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:d=>d.fitScreenCoordinates(a,u,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(j.remove(this._box),this._box=null),j.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new o.Event(t,{originalEvent:r}))}}function vr(c,t){const r={};for(let a=0;a<c.length;a++)r[c[a].identifier]=t[a];return r}class tc{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,r,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),a.length===this.numTouches&&(this.centroid=function(u){const d=new o.pointGeometry(0,0);for(const g of u)d._add(g);return d.div(u.length)}(r),this.touches=vr(a,r)))}touchmove(t,r,a){if(this.aborted||!this.centroid)return;const u=vr(a,r);for(const d in this.touches){const g=this.touches[d],x=u[d];(!x||x.dist(g)>30)&&(this.aborted=!0)}}touchend(t,r,a){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Ko{constructor(t){this.singleTap=new tc(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,r,a){this.singleTap.touchstart(t,r,a)}touchmove(t,r,a){this.singleTap.touchmove(t,r,a)}touchend(t,r,a){const u=this.singleTap.touchend(t,r,a);if(u){const d=t.timeStamp-this.lastTime<500,g=!this.lastTap||this.lastTap.dist(u)<30;if(d&&g||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class ic{constructor(){this._zoomIn=new Ko({numTouches:1,numTaps:2}),this._zoomOut=new Ko({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,a){this._zoomIn.touchstart(t,r,a),this._zoomOut.touchstart(t,r,a)}touchmove(t,r,a){this._zoomIn.touchmove(t,r,a),this._zoomOut.touchmove(t,r,a)}touchend(t,r,a){const u=this._zoomIn.touchend(t,r,a),d=this._zoomOut.touchend(t,r,a);return u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:g.getZoom()+1,around:g.unproject(u)},{originalEvent:t})}):d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:g.getZoom()-1,around:g.unproject(d)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const tl={0:1,2:2};class br{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,r){return!1}_move(t,r){return{}}mousedown(t,r){if(this._lastPoint)return;const a=j.mouseButton(t);this._correctButton(t,a)&&(this._lastPoint=r,this._eventButton=a)}mousemoveWindow(t,r){const a=this._lastPoint;if(a){if(t.preventDefault(),function(u,d){const g=tl[d];return u.buttons===void 0||(u.buttons&g)!==g}(t,this._eventButton))this.reset();else if(this._moved||!(r.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(a,r)}}mouseupWindow(t){this._lastPoint&&j.mouseButton(t)===this._eventButton&&(this._moved&&j.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gr extends br{mousedown(t,r){super.mousedown(t,r),this._lastPoint&&(this._active=!0)}_correctButton(t,r){return r===0&&!t.ctrlKey}_move(t,r){return{around:r,panDelta:r.sub(t)}}}class Ne extends br{_correctButton(t,r){return r===0&&t.ctrlKey||r===2}_move(t,r){const a=.8*(r.x-t.x);if(a)return this._active=!0,{bearingDelta:a}}contextmenu(t){t.preventDefault()}}class Jo extends br{_correctButton(t,r){return r===0&&t.ctrlKey||r===2}_move(t,r){const a=-.5*(r.y-t.y);if(a)return this._active=!0,{pitchDelta:a}}contextmenu(t){t.preventDefault()}}class ys{constructor(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(t,r,a){return this._calculateTransform(t,r,a)}touchmove(t,r,a){if(this._active&&!(a.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,r,a)}touchend(t,r,a){this._calculateTransform(t,r,a),this._active&&a.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,a){a.length>0&&(this._active=!0);const u=vr(a,r),d=new o.pointGeometry(0,0),g=new o.pointGeometry(0,0);let x=0;for(const I in u){const k=u[I],L=this._touches[I];L&&(d._add(k),g._add(k.sub(L)),x++,u[I]=k)}if(this._touches=u,x<this._minTouches||!g.mag())return;const b=g.div(x);return this._sum._add(b),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(x),panDelta:b}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,r,a){return{}}touchstart(t,r,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,a){if(!this._firstTwoTouches)return;t.preventDefault();const[u,d]=this._firstTwoTouches,g=xs(a,r,u),x=xs(a,r,d);if(!g||!x)return;const b=this._aroundCenter?null:g.add(x).div(2);return this._move([g,x],b,t)}touchend(t,r,a){if(!this._firstTwoTouches)return;const[u,d]=this._firstTwoTouches,g=xs(a,r,u),x=xs(a,r,d);g&&x||(this._active&&j.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function xs(c,t,r){for(let a=0;a<c.length;a++)if(c[a].identifier===r)return t[a]}function De(c,t){return Math.log(c/t)/Math.LN2}class Qo extends wr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const a=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(De(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:De(this._distance,a),pinchAround:r}}}function il(c,t){return 180*c.angleWith(t)/Math.PI}class nc extends wr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const a=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:il(this._vector,a),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,a=il(t,this._startVector);return Math.abs(a)<r}}function vs(c){return Math.abs(c.y)>Math.abs(c.x)}class nl extends wr{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(t){this._lastPoints=t,vs(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,a){const u=t[0].sub(this._lastPoints[0]),d=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(u,d,a.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(u.y+d.y)/2*-.5}}gestureBeginsVertically(t,r,a){if(this._valid!==void 0)return this._valid;const u=t.mag()>=2,d=r.mag()>=2;if(!u&&!d)return;if(!u||!d)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const g=t.y>0==r.y>0;return vs(t)&&vs(r)&&g}}const rl={panStep:100,bearingStep:15,pitchStep:10};class rc{constructor(){const t=rl;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,a=0,u=0,d=0,g=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?a=-1:(t.preventDefault(),d=-1);break;case 39:t.shiftKey?a=1:(t.preventDefault(),d=1);break;case 38:t.shiftKey?u=1:(t.preventDefault(),g=-1);break;case 40:t.shiftKey?u=-1:(t.preventDefault(),g=1);break;default:return}return this._rotationDisabled&&(a=0,u=0),{cameraAnimation:x=>{const b=x.getZoom();x.easeTo({duration:300,easeId:"keyboardHandler",easing:sc,zoom:r?Math.round(b)+r*(t.shiftKey?2:1):b,bearing:x.getBearing()+a*this._bearingStep,pitch:x.getPitch()+u*this._pitchStep,offset:[-d*this._panStep,-g*this._panStep],center:x.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function sc(c){return c*(2-c)}const no=4.000244140625;class ea{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const a=o.exported.now(),u=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,r!==0&&r%no==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(u*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=j.mousePos(this._el,t);this._around=o.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(r)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const x=this._type==="wheel"&&Math.abs(this._delta)>no?this._wheelZoomRate:this._defaultZoomRate;let b=2/(1+Math.exp(-Math.abs(this._delta*x)));this._delta<0&&b!==0&&(b=1/b);const I=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(I*b))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,a=this._startZoom,u=this._easing;let d,g=!1;if(this._type==="wheel"&&a&&u){const x=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),b=u(x);d=o.number(a,r,b),x<1?this._frameId||(this._frameId=!0):g=!0}else d=r,g=!0;return this._active=!0,g&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!g,zoomDelta:d-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=o.ease;if(this._prevEase){const a=this._prevEase,u=(o.exported.now()-a.start)/a.duration,d=a.easing(u+.01)-a.easing(u),g=.27/Math.sqrt(d*d+1e-4)*.01,x=Math.sqrt(.0729-g*g);r=o.bezier(g,x,.25,1)}return this._prevEase={start:o.exported.now(),duration:t,easing:r},r}reset(){this._active=!1}}class ta{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ia{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,r){return t.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:a.getZoom()+(t.shiftKey?-1:1),around:a.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oi{constructor(){this._tap=new Ko({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,r,a){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=r[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(t,r,a))}touchmove(t,r,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const u=r[0],d=u.y-this._swipePoint.y;return this._swipePoint=u,t.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(t,r,a)}touchend(t,r,a){this._tapTime?this._swipePoint&&a.length===0&&this.reset():this._tap.touchend(t,r,a)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ir{constructor(t,r,a){this._el=t,this._mousePan=r,this._touchPan=a}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class sl{constructor(t,r,a){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class na{constructor(t,r,a,u){this._el=t,this._touchZoom=r,this._touchRotate=a,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Zr=c=>c.zoom||c.drag||c.pitch||c.rotate;class ra extends o.Event{}function ro(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class on{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qa(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r),o.bindAll(["handleEvent","handleWindowEvent"],this);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,d,g]of this._listeners)j.addEventListener(u,d,u===document?this.handleWindowEvent:this.handleEvent,g)}destroy(){for(const[t,r,a]of this._listeners)j.removeEventListener(t,r,t===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(t){const r=this._map,a=r.getCanvasContainer();this._add("mapEvent",new xr(r,t));const u=r.boxZoom=new qr(r,t);this._add("boxZoom",u);const d=new ic,g=new ia;r.doubleClickZoom=new ta(g,d),this._add("tapZoom",d),this._add("clickZoom",g);const x=new Oi;this._add("tapDragZoom",x);const b=r.touchPitch=new nl;this._add("touchPitch",b);const I=new Ne(t),k=new Jo(t);r.dragRotate=new sl(t,I,k),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const L=new Gr(t),O=new ys(t);r.dragPan=new ir(a,L,O),this._add("mousePan",L),this._add("touchPan",O,["touchZoom","touchRotate"]);const W=new nc,U=new Qo;r.touchZoomRotate=new na(a,U,W,x),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",U,["touchPan","touchRotate"]);const Z=r.scrollZoom=new ea(r,this);this._add("scrollZoom",Z,["mousePan"]);const te=r.keyboard=new rc;this._add("keyboard",te),this._add("blockableMapEvent",new el(r));for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ie]&&r[ie].enable(t[ie])}_add(t,r,a){this._handlers.push({handlerName:t,handler:r,allowed:a}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Zr(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,r,a){for(const u in t)if(u!==a&&(!r||r.indexOf(u)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const r=[];for(const a of t)this._el.contains(a.target)&&r.push(a);return r}handleEvent(t,r){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const a=t.type==="renderFrame"?void 0:t,u={needsRenderFrame:!1},d={},g={},x=t.touches,b=x?this._getMapTouches(x):void 0,I=b?j.touchPos(this._el,b):j.mousePos(this._el,t);for(const{handlerName:O,handler:W,allowed:U}of this._handlers){if(!W.isEnabled())continue;let Z;this._blockedByActive(g,U,O)?W.reset():W[r||t.type]&&(Z=W[r||t.type](t,I,b),this.mergeHandlerResult(u,d,Z,O,a),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||W.isActive())&&(g[O]=W)}const k={};for(const O in this._previousActiveHandlers)g[O]||(k[O]=a);this._previousActiveHandlers=g,(Object.keys(k).length||ro(u))&&(this._changes.push([u,d,k]),this._triggerRenderFrame()),(Object.keys(g).length||ro(u))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:L}=u;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))}mergeHandlerResult(t,r,a,u,d){if(!a)return;o.extend(t,a);const g={handlerName:u,originalEvent:a.originalEvent||d};a.zoomDelta!==void 0&&(r.zoom=g),a.panDelta!==void 0&&(r.drag=g),a.pitchDelta!==void 0&&(r.pitch=g),a.bearingDelta!==void 0&&(r.rotate=g)}_applyChanges(){const t={},r={},a={};for(const[u,d,g]of this._changes)u.panDelta&&(t.panDelta=(t.panDelta||new o.pointGeometry(0,0))._add(u.panDelta)),u.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(t.around=u.around),u.pinchAround!==void 0&&(t.pinchAround=u.pinchAround),u.noInertia&&(t.noInertia=u.noInertia),o.extend(r,d),o.extend(a,g);this._updateMapTransform(t,r,a),this._changes=[]}_updateMapTransform(t,r,a){const u=this._map,d=u.transform;if(!ro(t))return this._fireEvents(r,a,!0);let{panDelta:g,zoomDelta:x,bearingDelta:b,pitchDelta:I,around:k,pinchAround:L}=t;L!==void 0&&(k=L),u._stop(!0),k=k||u.transform.centerPoint;const O=d.pointLocation(g?k.sub(g):k);b&&(d.bearing+=b),I&&(d.pitch+=I),x&&(d.zoom+=x),d.setLocationAtPoint(O,k),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,a,!0)}_fireEvents(t,r,a){const u=Zr(this._eventsInProgress),d=Zr(t),g={};for(const k in t){const{originalEvent:L}=t[k];this._eventsInProgress[k]||(g[`${k}start`]=L),this._eventsInProgress[k]=t[k]}!u&&d&&this._fireEvent("movestart",d.originalEvent);for(const k in g)this._fireEvent(k,g[k]);d&&this._fireEvent("move",d.originalEvent);for(const k in t){const{originalEvent:L}=t[k];this._fireEvent(k,L)}const x={};let b;for(const k in this._eventsInProgress){const{handlerName:L,originalEvent:O}=this._eventsInProgress[k];this._handlersById[L].isActive()||(delete this._eventsInProgress[k],b=r[L]||O,x[`${k}end`]=b)}for(const k in x)this._fireEvent(k,x[k]);const I=Zr(this._eventsInProgress);if(a&&(u||d)&&!I){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;k?(L(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:b})):(this._map.fire(new o.Event("moveend",{originalEvent:b})),L(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new o.Event(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new ra("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const qt={extend:(c,...t)=>o.extend(c,...t),run(c){c()},logToElement(c,t=!1,r="log"){const a=window.document.getElementById(r);a&&(t&&(a.innerHTML=""),a.innerHTML+=`<br>${c}`)}};class so extends o.Evented{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,a){return t=o.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,o.extend({offset:t},r),a)}panTo(t,r,a){return this.easeTo(o.extend({center:t},r),a)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,a){return this.easeTo(o.extend({zoom:t},r),a)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,a){return this.easeTo(o.extend({bearing:t},r),a)}resetNorth(t,r){return this.rotateTo(0,o.extend({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=o.LngLatBounds.convert(t);const a=r&&r.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),a,r)}_cameraForBoxAndBearing(t,r,a,u){const d={top:0,bottom:0,right:0,left:0};if(typeof(u=o.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const pe=u.padding;u.padding={top:pe,bottom:pe,right:pe,left:pe}}u.padding=o.extend(d,u.padding);const g=this.transform,x=g.padding,b=g.project(o.LngLat.convert(t)),I=g.project(o.LngLat.convert(r)),k=b.rotate(-a*Math.PI/180),L=I.rotate(-a*Math.PI/180),O=new o.pointGeometry(Math.max(k.x,L.x),Math.max(k.y,L.y)),W=new o.pointGeometry(Math.min(k.x,L.x),Math.min(k.y,L.y)),U=O.sub(W),Z=(g.width-(x.left+x.right+u.padding.left+u.padding.right))/U.x,te=(g.height-(x.top+x.bottom+u.padding.top+u.padding.bottom))/U.y;if(te<0||Z<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ie=Math.min(g.scaleZoom(g.scale*Math.min(Z,te)),u.maxZoom),oe=o.pointGeometry.convert(u.offset),ne=new o.pointGeometry((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(a*Math.PI/180),ye=oe.add(ne).mult(g.scale/g.zoomScale(ie));return{center:g.unproject(b.add(I).div(2).sub(ye)),zoom:ie,bearing:a}}fitBounds(t,r,a){return this._fitInternal(this.cameraForBounds(t,r),r,a)}fitScreenCoordinates(t,r,a,u,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(t)),this.transform.pointLocation(o.pointGeometry.convert(r)),a,u),u,d)}_fitInternal(t,r,a){return t?(delete(r=o.extend(t,r)).padding,r.linear?this.easeTo(r,a):this.flyTo(r,a)):this}jumpTo(t,r){this.stop();const a=this.transform;let u=!1,d=!1,g=!1;return"zoom"in t&&a.zoom!==+t.zoom&&(u=!0,a.zoom=+t.zoom),t.center!==void 0&&(a.center=o.LngLat.convert(t.center)),"bearing"in t&&a.bearing!==+t.bearing&&(d=!0,a.bearing=+t.bearing),"pitch"in t&&a.pitch!==+t.pitch&&(g=!0,a.pitch=+t.pitch),t.padding==null||a.isPaddingEqual(t.padding)||(a.padding=t.padding),this.fire(new o.Event("movestart",r)).fire(new o.Event("move",r)),u&&this.fire(new o.Event("zoomstart",r)).fire(new o.Event("zoom",r)).fire(new o.Event("zoomend",r)),d&&this.fire(new o.Event("rotatestart",r)).fire(new o.Event("rotate",r)).fire(new o.Event("rotateend",r)),g&&this.fire(new o.Event("pitchstart",r)).fire(new o.Event("pitch",r)).fire(new o.Event("pitchend",r)),this.fire(new o.Event("moveend",r))}easeTo(t,r){this._stop(!1,t.easeId),((t=o.extend({offset:[0,0],duration:500,easing:o.ease},t)).animate===!1||!t.essential&&o.exported.prefersReducedMotion)&&(t.duration=0);const a=this.transform,u=this.getZoom(),d=this.getBearing(),g=this.getPitch(),x=this.getPadding(),b="zoom"in t?+t.zoom:u,I="bearing"in t?this._normalizeBearing(t.bearing,d):d,k="pitch"in t?+t.pitch:g,L="padding"in t?t.padding:a.padding,O=o.pointGeometry.convert(t.offset);let W=a.centerPoint.add(O);const U=a.pointLocation(W),Z=o.LngLat.convert(t.center||U);this._normalizeCenter(Z);const te=a.project(U),ie=a.project(Z).sub(te),oe=a.zoomScale(b-u);let ne,ye;t.around&&(ne=o.LngLat.convert(t.around),ye=a.locationPoint(ne));const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||b!==u,this._rotating=this._rotating||d!==I,this._pitching=this._pitching||k!==g,this._padding=!a.isPaddingEqual(L),this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,pe),this._ease(fe=>{if(this._zooming&&(a.zoom=o.number(u,b,fe)),this._rotating&&(a.bearing=o.number(d,I,fe)),this._pitching&&(a.pitch=o.number(g,k,fe)),this._padding&&(a.interpolatePadding(x,L,fe),W=a.centerPoint.add(O)),ne)a.setLocationAtPoint(ne,ye);else{const Ie=a.zoomScale(a.zoom-u),ke=b>u?Math.min(2,oe):Math.max(.5,oe),_e=Math.pow(ke,1-fe),qe=a.unproject(te.add(ie.mult(fe*_e)).mult(Ie));a.setLocationAtPoint(a.renderWorldCopies?qe.wrap():qe,W)}this._fireMoveEvents(r)},fe=>{this._afterEase(r,fe)},t),this}_prepareEase(t,r,a={}){this._moving=!0,r||a.moving||this.fire(new o.Event("movestart",t)),this._zooming&&!a.zooming&&this.fire(new o.Event("zoomstart",t)),this._rotating&&!a.rotating&&this.fire(new o.Event("rotatestart",t)),this._pitching&&!a.pitching&&this.fire(new o.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new o.Event("move",t)),this._zooming&&this.fire(new o.Event("zoom",t)),this._rotating&&this.fire(new o.Event("rotate",t)),this._pitching&&this.fire(new o.Event("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const a=this._zooming,u=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new o.Event("zoomend",t)),u&&this.fire(new o.Event("rotateend",t)),d&&this.fire(new o.Event("pitchend",t)),this.fire(new o.Event("moveend",t))}flyTo(t,r){if(!t.essential&&o.exported.prefersReducedMotion){const vt=o.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(vt,r)}this.stop(),t=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},t);const a=this.transform,u=this.getZoom(),d=this.getBearing(),g=this.getPitch(),x=this.getPadding(),b="zoom"in t?o.clamp(+t.zoom,a.minZoom,a.maxZoom):u,I="bearing"in t?this._normalizeBearing(t.bearing,d):d,k="pitch"in t?+t.pitch:g,L="padding"in t?t.padding:a.padding,O=a.zoomScale(b-u),W=o.pointGeometry.convert(t.offset);let U=a.centerPoint.add(W);const Z=a.pointLocation(U),te=o.LngLat.convert(t.center||Z);this._normalizeCenter(te);const ie=a.project(Z),oe=a.project(te).sub(ie);let ne=t.curve;const ye=Math.max(a.width,a.height),pe=ye/O,fe=oe.mag();if("minZoom"in t){const vt=o.clamp(Math.min(t.minZoom,u,b),a.minZoom,a.maxZoom),Yt=ye/a.zoomScale(vt-u);ne=Math.sqrt(Yt/fe*2)}const Ie=ne*ne;function ke(vt){const Yt=(pe*pe-ye*ye+(vt?-1:1)*Ie*Ie*fe*fe)/(2*(vt?pe:ye)*Ie*fe);return Math.log(Math.sqrt(Yt*Yt+1)-Yt)}function _e(vt){return(Math.exp(vt)-Math.exp(-vt))/2}function qe(vt){return(Math.exp(vt)+Math.exp(-vt))/2}const Re=ke(0);let ot=function(vt){return qe(Re)/qe(Re+ne*vt)},St=function(vt){return ye*((qe(Re)*(_e(Yt=Re+ne*vt)/qe(Yt))-_e(Re))/Ie)/fe;var Yt},gt=(ke(1)-Re)/ne;if(Math.abs(fe)<1e-6||!isFinite(gt)){if(Math.abs(ye-pe)<1e-6)return this.easeTo(t,r);const vt=pe<ye?-1:1;gt=Math.abs(Math.log(pe/ye))/ne,St=function(){return 0},ot=function(Yt){return Math.exp(vt*ne*Yt)}}return t.duration="duration"in t?+t.duration:1e3*gt/("screenSpeed"in t?+t.screenSpeed/ne:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=d!==I,this._pitching=k!==g,this._padding=!a.isPaddingEqual(L),this._prepareEase(r,!1),this._ease(vt=>{const Yt=vt*gt,at=1/ot(Yt);a.zoom=vt===1?b:u+a.scaleZoom(at),this._rotating&&(a.bearing=o.number(d,I,vt)),this._pitching&&(a.pitch=o.number(g,k,vt)),this._padding&&(a.interpolatePadding(x,L,vt),U=a.centerPoint.add(W));const Tt=vt===1?te:a.unproject(ie.add(oe.mult(St(Yt))).mult(at));a.setLocationAtPoint(a.renderWorldCopies?Tt.wrap():Tt,U),this._fireMoveEvents(r)},()=>this._afterEase(r),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const a=this._onEaseEnd;delete this._onEaseEnd,a.call(this,r)}if(!t){const a=this.handlers;a&&a.stop(!1)}return this}_ease(t,r,a){a.animate===!1||a.duration===0?(t(1),r()):(this._easeStart=o.exported.now(),this._easeOptions=a,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=o.wrap(t,-180,180);const a=Math.abs(t-r);return Math.abs(t-360-r)<a&&(t-=360),Math.abs(t+360-r)<a&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(!r.renderWorldCopies||r.lngRange)return;const a=t.lng-r.center.lng;t.lng+=a>180?-360:a<-180?360:0}}class oo{constructor(t={}){this.options=t,o.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=j.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=j.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=j.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){j.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,r){const a=this._map._getUIString(`AttributionControl.${r}`);t.title=a,t.setAttribute("aria-label",a)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const r=this._map.style.sourceCaches;for(const u in r){const d=r[u];if(d.used){const g=d.getSource();g.attribution&&t.indexOf(g.attribution)<0&&t.push(g.attribution)}}t=t.filter(u=>String(u).trim()),t.sort((u,d)=>u.length-d.length),t=t.filter((u,d)=>{for(let g=d+1;g<t.length;g++)if(t[g].indexOf(u)>=0)return!1;return!0});const a=t.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class sa{constructor(t={}){this.options=t,o.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=j.create("div","maplibregl-ctrl mapboxgl-ctrl");const r=j.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){j.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const r=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&r.classList.add("maplibregl-compact","mapboxgl-compact"):r.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class ol{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,a=r?this._queue.concat(r):this._queue;for(const u of a)if(u.id===t)return void(u.cancelled=!0)}run(t=0){const r=this._currentlyRunning=this._queue;this._queue=[];for(const a of r)if(!a.cancelled&&(a.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const al={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},oc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},kn={showCompass:!0,showZoom:!0,visualizePitch:!1};class ao{constructor(t,r,a=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new Ne({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,a&&(this.mousePitch=new Jo({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),j.addEventListener(r,"mousedown",this.mousedown),j.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),j.addEventListener(r,"touchmove",this.touchmove),j.addEventListener(r,"touchend",this.touchend),j.addEventListener(r,"touchcancel",this.reset)}down(t,r){this.mouseRotate.mousedown(t,r),this.mousePitch&&this.mousePitch.mousedown(t,r),j.disableDrag()}move(t,r){const a=this.map,u=this.mouseRotate.mousemoveWindow(t,r);if(u&&u.bearingDelta&&a.setBearing(a.getBearing()+u.bearingDelta),this.mousePitch){const d=this.mousePitch.mousemoveWindow(t,r);d&&d.pitchDelta&&a.setPitch(a.getPitch()+d.pitchDelta)}}off(){const t=this.element;j.removeEventListener(t,"mousedown",this.mousedown),j.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),j.removeEventListener(t,"touchmove",this.touchmove),j.removeEventListener(t,"touchend",this.touchend),j.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){j.enableDrag(),j.removeEventListener(window,"mousemove",this.mousemove),j.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(o.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),j.mousePos(this.element,t)),j.addEventListener(window,"mousemove",this.mousemove),j.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,j.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=j.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=j.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function He(c,t,r){if(c=new o.LngLat(c.lng,c.lat),t){const a=new o.LngLat(c.lng-360,c.lat),u=new o.LngLat(c.lng+360,c.lat),d=r.locationPoint(c).distSqr(t);r.locationPoint(a).distSqr(t)<d?c=a:r.locationPoint(u).distSqr(t)<d&&(c=u)}for(;Math.abs(c.lng-r.center.lng)>180;){const a=r.locationPoint(c);if(a.x>=0&&a.y>=0&&a.x<=r.width&&a.y<=r.height)break;c.lng>r.center.lng?c.lng-=360:c.lng+=360}return c}const it={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bs(c,t,r){const a=c.classList;for(const u in it)a.remove(`maplibregl-${r}-anchor-${u}`,`mapboxgl-${r}-anchor-${u}`);a.add(`maplibregl-${r}-anchor-${t}`,`mapboxgl-${r}-anchor-${t}`)}class ws extends o.Evented{constructor(t,r){if(super(),(t instanceof HTMLElement||r)&&(t=o.extend({element:t},r)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=o.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=j.create("div"),this._element.setAttribute("aria-label","Map marker");const a=j.createNS("http://www.w3.org/2000/svg","svg"),u=41,d=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${u}px`),a.setAttributeNS(null,"width",`${d}px`),a.setAttributeNS(null,"viewBox",`0 0 ${d} ${u}`);const g=j.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const x=j.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const b=j.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const oe of I){const ne=j.createNS("http://www.w3.org/2000/svg","ellipse");ne.setAttributeNS(null,"opacity","0.04"),ne.setAttributeNS(null,"cx","10.5"),ne.setAttributeNS(null,"cy","5.80029008"),ne.setAttributeNS(null,"rx",oe.rx),ne.setAttributeNS(null,"ry",oe.ry),b.appendChild(ne)}const k=j.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);const L=j.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(L);const O=j.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const W=j.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(W);const U=j.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(6.0, 7.0)"),U.setAttributeNS(null,"fill","#FFFFFF");const Z=j.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const te=j.createNS("http://www.w3.org/2000/svg","circle");te.setAttributeNS(null,"fill","#000000"),te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"cx","5.5"),te.setAttributeNS(null,"cy","5.5"),te.setAttributeNS(null,"r","5.4999962");const ie=j.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#FFFFFF"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962"),Z.appendChild(te),Z.appendChild(ie),x.appendChild(b),x.appendChild(k),x.appendChild(O),x.appendChild(U),x.appendChild(Z),a.appendChild(x),a.setAttributeNS(null,"height",u*this._scale+"px"),a.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(a),this._offset=o.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),bs(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),j.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const u=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const r=t.code,a=t.charCode||t.keyCode;r!=="Space"&&r!=="Enter"&&a!==32&&a!==13||this.togglePopup()}_onMapClick(t){const r=t.originalEvent.target,a=this._element;this._popup&&(r===a||a.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=He(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let r="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?r=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(r=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let a="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?a="rotateX(0deg)":this._pitchAlignment==="map"&&(a=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),j.setTransform(this._element,`${it[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${a} ${r}`)}getOffset(){return this._offset}setOffset(t){return this._offset=o.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const r=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=r}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const oa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let hi,Sr=0,Ui=!1;const ac={maxWidth:100,unit:"metric"};function Ss(c,t,r){const a=r&&r.maxWidth||100,u=c._container.clientHeight/2,d=c.unproject([0,u]),g=c.unproject([a,u]),x=d.distanceTo(g);if(r&&r.unit==="imperial"){const b=3.2808*x;b>5280?Nt(t,a,b/5280,c._getUIString("ScaleControl.Miles")):Nt(t,a,b,c._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?Nt(t,a,x/1852,c._getUIString("ScaleControl.NauticalMiles")):x>=1e3?Nt(t,a,x/1e3,c._getUIString("ScaleControl.Kilometers")):Nt(t,a,x,c._getUIString("ScaleControl.Meters"))}function Nt(c,t,r,a){const u=function(d){const g=Math.pow(10,`${Math.floor(d)}`.length-1);let x=d/g;return x=x>=10?10:x>=5?5:x>=3?3:x>=2?2:x>=1?1:function(b){const I=Math.pow(10,Math.ceil(-Math.log(b)/Math.LN10));return Math.round(b*I)/I}(x),g*x}(r);c.style.width=t*(u/r)+"px",c.innerHTML=`${u}&nbsp;${a}`}const pi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ll=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Wr(c){if(c){if(typeof c=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(c,2)));return{center:new o.pointGeometry(0,0),top:new o.pointGeometry(0,c),"top-left":new o.pointGeometry(t,t),"top-right":new o.pointGeometry(-t,t),bottom:new o.pointGeometry(0,-c),"bottom-left":new o.pointGeometry(t,-t),"bottom-right":new o.pointGeometry(-t,-t),left:new o.pointGeometry(c,0),right:new o.pointGeometry(-c,0)}}if(c instanceof o.pointGeometry||Array.isArray(c)){const t=o.pointGeometry.convert(c);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:o.pointGeometry.convert(c.center||[0,0]),top:o.pointGeometry.convert(c.top||[0,0]),"top-left":o.pointGeometry.convert(c["top-left"]||[0,0]),"top-right":o.pointGeometry.convert(c["top-right"]||[0,0]),bottom:o.pointGeometry.convert(c.bottom||[0,0]),"bottom-left":o.pointGeometry.convert(c["bottom-left"]||[0,0]),"bottom-right":o.pointGeometry.convert(c["bottom-right"]||[0,0]),left:o.pointGeometry.convert(c.left||[0,0]),right:o.pointGeometry.convert(c.right||[0,0])}}return Wr(new o.pointGeometry(0,0))}const As={supported:V,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends so{constructor(c){var t;if(o.PerformanceUtils.mark(o.PerformanceMarkers.create),(c=o.extend({},oc,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new fs(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),{bearingSnap:c.bearingSnap}),this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._renderTaskQueue=new ol,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},al,c.locale),this._clickTolerance=c.clickTolerance,this._pixelRatio=(t=c.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new ae(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new on(this,c),this._hash=c.hash&&new Xa(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,o.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new oo({customAttribution:c.customAttribution})),c.maplibreLogo&&this.addControl(new sa,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new o.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new o.Event(`${r.dataType}dataloading`,r))}),this.on("dataabort",r=>{this.fire(new o.Event("sourcedataabort",r))})}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=c.onAdd(this);this._controls.push(c);const a=this._controlPositions[t];return t.indexOf("bottom")!==-1?a.insertBefore(r,a.firstChild):a.appendChild(r),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}resize(c){const t=this._containerDimensions(),r=t[0],a=t[1];this._resizeCanvas(r,a,this.getPixelRatio()),this.transform.resize(r,a),this.painter.resize(r,a,this.getPixelRatio());const u=!this._moving;return u&&(this.stop(),this.fire(new o.Event("movestart",c)).fire(new o.Event("move",c))),this.fire(new o.Event("resize",c)),u&&this.fire(new o.Event("moveend",c)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(c){const[t,r]=this._containerDimensions();this._pixelRatio=c,this._resizeCanvas(t,r,c),this.painter.resize(t,r,c)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(c){return this.transform.setMaxBounds(o.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c==null?-2:c)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c&&this.setZoom(c),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c==null?22:c)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c&&this.setZoom(c),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c==null?0:c)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c&&this.setPitch(c),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c==null?60:c)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c&&this.setPitch(c),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}project(c){return this.transform.locationPoint(o.LngLat.convert(c))}unproject(c){return this.transform.pointLocation(o.pointGeometry.convert(c))}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(c,t,r){if(c==="mouseenter"||c==="mouseover"){let a=!1;return{layer:t,listener:r,delegates:{mousemove:d=>{const g=this.getLayer(t)?this.queryRenderedFeatures(d.point,{layers:[t]}):[];g.length?a||(a=!0,r.call(this,new Xi(c,this,d.originalEvent,{features:g}))):a=!1},mouseout:()=>{a=!1}}}}if(c==="mouseleave"||c==="mouseout"){let a=!1;return{layer:t,listener:r,delegates:{mousemove:g=>{(this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[]).length?a=!0:a&&(a=!1,r.call(this,new Xi(c,this,g.originalEvent)))},mouseout:g=>{a&&(a=!1,r.call(this,new Xi(c,this,g.originalEvent)))}}}}{const a=u=>{const d=this.getLayer(t)?this.queryRenderedFeatures(u.point,{layers:[t]}):[];d.length&&(u.features=d,r.call(this,u),delete u.features)};return{layer:t,listener:r,delegates:{[c]:a}}}}on(c,t,r){if(r===void 0)return super.on(c,t);const a=this._createDelegatedListener(c,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(a);for(const u in a.delegates)this.on(u,a.delegates[u]);return this}once(c,t,r){if(r===void 0)return super.once(c,t);const a=this._createDelegatedListener(c,t,r);for(const u in a.delegates)this.once(u,a.delegates[u]);return this}off(c,t,r){return r===void 0?super.off(c,t):(this._delegatedListeners&&this._delegatedListeners[c]&&(a=>{const u=this._delegatedListeners[c];for(let d=0;d<u.length;d++){const g=u[d];if(g.layer===t&&g.listener===r){for(const x in g.delegates)this.off(x,g.delegates[x]);return u.splice(d,1),this}}})(),this)}queryRenderedFeatures(c,t){if(!this.style)return[];let r;if(t!==void 0||c===void 0||c instanceof o.pointGeometry||Array.isArray(c)||(t=c,c=void 0),t=t||{},(c=c||[[0,0],[this.transform.width,this.transform.height]])instanceof o.pointGeometry||typeof c[0]=="number")r=[o.pointGeometry.convert(c)];else{const a=o.pointGeometry.convert(c[0]),u=o.pointGeometry.convert(c[1]);r=[a,new o.pointGeometry(u.x,a.y),u,new o.pointGeometry(a.x,u.y),a]}return this.style.queryRenderedFeatures(r,t,this.transform)}querySourceFeatures(c,t){return this.style.querySourceFeatures(c,t)}setStyle(c,t){return(t=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&c?(this._diffStyle(c,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(c,t))}setTransformRequest(c){return this._requestManager.setTransformRequest(c),this}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),c?(this.style=new xi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,t){if(typeof c=="string"){const r=this._requestManager.transformRequest(c,o.ResourceType.Style);o.getJSON(r,(a,u)=>{a?this.fire(new o.ErrorEvent(a)):u&&this._updateDiff(u,t)})}else typeof c=="object"&&this._updateDiff(c,t)}_updateDiff(c,t){try{this.style.setState(c)&&this._update(!0)}catch(r){o.warnOnce(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(c,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(c,t){return this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)}isSourceLoaded(c){const t=this.style&&this.style.sourceCaches[c];if(t!==void 0)return t.loaded();this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${c}'`)))}areTilesLoaded(){const c=this.style&&this.style.sourceCaches;for(const t in c){const r=c[t]._tiles;for(const a in r){const u=r[a];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}addSourceType(c,t,r){return this._lazyInitEmptyStyle(),this.style.addSourceType(c,t,r)}removeSource(c){return this.style.removeSource(c),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,t,{pixelRatio:r=1,sdf:a=!1,stretchX:u,stretchY:d,content:g}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||o.isImageBitmap(t)){const{width:x,height:b,data:I}=o.exported.getImageData(t);this.style.addImage(c,{data:new o.RGBAImage({width:x,height:b},I),pixelRatio:r,stretchX:u,stretchY:d,content:g,sdf:a,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:x,height:b,data:I}=t,k=t;this.style.addImage(c,{data:new o.RGBAImage({width:x,height:b},new Uint8Array(I)),pixelRatio:r,stretchX:u,stretchY:d,content:g,sdf:a,version:0,userImage:k}),k.onAdd&&k.onAdd(this,c)}}}updateImage(c,t){const r=this.style.getImage(c);if(!r)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=t instanceof HTMLImageElement||o.isImageBitmap(t)?o.exported.getImageData(t):t,{width:u,height:d,data:g}=a;if(u===void 0||d===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==r.data.width||d!==r.data.height)return this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const x=!(t instanceof HTMLImageElement||o.isImageBitmap(t));r.data.replace(g,x),this.style.updateImage(c,r)}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,t){o.getImage(this._requestManager.transformRequest(c,o.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(c,t){return this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)}moveLayer(c,t){return this.style.moveLayer(c,t),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,t,r){return this.style.setLayerZoomRange(c,t,r),this._update(!0)}setFilter(c,t,r={}){return this.style.setFilter(c,t,r),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,t,r,a={}){return this.style.setPaintProperty(c,t,r,a),this._update(!0)}getPaintProperty(c,t){return this.style.getPaintProperty(c,t)}setLayoutProperty(c,t,r,a={}){return this.style.setLayoutProperty(c,t,r,a),this._update(!0)}getLayoutProperty(c,t){return this.style.getLayoutProperty(c,t)}setLight(c,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(c,t){return this.style.setFeatureState(c,t),this._update()}removeFeatureState(c,t){return this.style.removeFeatureState(c,t),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let c=0,t=0;return this._container&&(c=this._container.clientWidth||400,t=this._container.clientHeight||300),[c,t]}_setupContainer(){const c=this._container;c.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=j.create("div","maplibregl-canvas-container mapboxgl-canvas-container",c);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=j.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const r=this._containerDimensions();this._resizeCanvas(r[0],r[1],this.getPixelRatio());const a=this._controlContainer=j.create("div","maplibregl-control-container mapboxgl-control-container",c),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(d=>{u[d]=j.create("div",`maplibregl-ctrl-${d} mapboxgl-ctrl-${d}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t,r){this._canvas.width=r*c,this._canvas.height=r*t,this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const c=o.extend({},V.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);t?(this.painter=new Yo(t,this.transform),o.exported$1.testSupport(t)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_render(c){let t,r=0;const a=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,t),r=o.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,x=o.exported.now();this.style.zoomHistory.update(g,x);const b=new o.EvaluationParameters(g,{now:x,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),I=b.crossFadingFactor();I===1&&I===this._crossFadingFactor||(u=!0,this._crossFadingFactor=I),this.style.update(b)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.load),this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const g=o.exported.now()-r;a.endQueryEXT(a.TIME_ELAPSED_EXT,t),setTimeout(()=>{const x=a.getQueryObjectEXT(t,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(t),this.fire(new o.Event("gpu-timing-frame",{cpuTime:g,gpuTime:x}))},50)}if(this.listens("gpu-timing-layer")){const g=this.painter.collectGpuTimers();setTimeout(()=>{const x=this.painter.queryGpuTimers(g);this.fire(new o.Event("gpu-timing-layer",{layerTimes:x}))},50)}const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),j.remove(this._canvasContainer),j.remove(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),o.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.exported.frame(c=>{o.PerformanceUtils.frame(c),this._frame=null,this._render(c)}))}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}_setCacheLimits(c,t){o.setCacheLimits(c,t)}},NavigationControl:class{constructor(c){this.options=o.extend({},kn,c),this._container=j.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),j.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),j.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=j.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map.getZoom(),t=c===this._map.getMaxZoom(),r=c===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=c}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ao(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){j.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(c,t){const r=j.create("button",c,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(c,t){const r=this._map._getUIString(`NavigationControl.${t}`);c.title=r,c.setAttribute("aria-label",r)}},GeolocateControl:class extends o.Evented{constructor(c){super(),this.options=o.extend({},oa,c),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(c){var t;return this._map=c,this._container=j.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,hi!==void 0?t(hi):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(r=>{hi=r.state!=="denied",t(hi)}):(hi=!!window.navigator.geolocation,t(hi)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),j.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Sr=0,Ui=!1}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),r=c.coords;return t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",c)),this._finish()}}_updateCamera(c){const t=new o.LngLat(c.coords.longitude,c.coords.latitude),r=c.coords.accuracy,a=this._map.getBearing(),u=o.extend({bearing:a},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),u,{geolocateSource:!0})}_updateMarker(c){if(c){const t=new o.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map._container.clientHeight/2,t=this._map.unproject([0,c]),r=this._map.unproject([1,c]),a=t.distanceTo(r),u=Math.ceil(2*this._accuracy/a);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Ui)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=j.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),j.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=j.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new ws(this._dotElement),this._circleElement=j.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ws({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Sr--,Ui=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Sr++,Sr>1?(c={maximumAge:6e5,timeout:0},Ui=!0):(c=this.options.positionOptions,Ui=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:oo,LogoControl:sa,ScaleControl:class{constructor(c){this.options=o.extend({},ac,c),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Ss(this._map,this._container,this.options)}onAdd(c){return this._map=c,this._container=j.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){j.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(c){this.options.unit=c,Ss(this._map,this._container,this.options)}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=j.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){j.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=j.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);j.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(c){super(),this.options=o.extend(Object.create(pi),c),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&j.remove(this._content),this._container&&(j.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=o.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const t=document.createDocumentFragment(),r=document.createElement("body");let a;for(r.innerHTML=c;a=r.firstChild,a;)t.appendChild(a);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=j.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(c){this._container&&this._container.classList.add(c)}removeClassName(c){this._container&&this._container.classList.remove(c)}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){if(this._container)return this._container.classList.toggle(c)}_createCloseButton(){this.options.closeButton&&(this._closeButton=j.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(c){this._update(c.point)}_onMouseMove(c){this._update(c.point)}_onDrag(c){this._update(c.point)}_update(c){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=j.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=j.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(d=>this._container.classList.add(d)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=He(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!c))return;const t=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat);let r=this.options.anchor;const a=Wr(this.options.offset);if(!r){const d=this._container.offsetWidth,g=this._container.offsetHeight;let x;x=t.y+a.bottom.y<g?["top"]:t.y>this._map.transform.height-g?["bottom"]:[],t.x<d/2?x.push("left"):t.x>this._map.transform.width-d/2&&x.push("right"),r=x.length===0?"bottom":x.join("-")}const u=t.add(a[r]).round();j.setTransform(this._container,`${it[r]} translate(${u.x}px,${u.y}px)`),bs(this._container,r,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(ll);c&&c.focus()}_onClose(){this.remove()}},Marker:ws,Style:xi,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,Evented:o.Evented,AJAXError:o.AJAXError,config:o.config,CanvasSource:lr,GeoJSONSource:or,ImageSource:$n,RasterDEMTileSource:pn,RasterTileSource:Kn,VectorTileSource:Ht,VideoSource:Qn,prewarm:function(){Cn().acquire(cr)},clearPrewarmedResources:function(){const c=qn;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(cr),qn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get workerCount(){return En.workerCount},set workerCount(c){En.workerCount=c},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){o.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){o.clearTileCache(c)},workerUrl:"",addProtocol(c,t){o.config.REGISTERED_PROTOCOLS[c]=t},removeProtocol(c){delete o.config.REGISTERED_PROTOCOLS[c]}};return qt.extend(As,{isSafari:o.isSafari,getPerformanceMetrics:o.PerformanceUtils.getPerformanceMetrics}),As});var P=D;return P})})(yp);const On=yp.exports;const Un="/maplibre-gl-directions/assets/style.7d708b4d.json";var Vf=Object.defineProperty,$f=(v,f,y)=>f in v?Vf(v,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):v[f]=y,yt=(v,f,y)=>($f(v,typeof f!="symbol"?f+"":f,y),y);class Nf{constructor(f){yt(this,"map"),yt(this,"listeners",{}),yt(this,"oneTimeListeners",{}),this.map=f}fire(f){var y,z;f.target=this.map,(y=this.listeners[f.type])==null||y.forEach(D=>D(f)),(z=this.oneTimeListeners[f.type])==null||z.forEach(D=>{var A,P;D(f);const o=(A=this.oneTimeListeners[f.type])==null?void 0:A.indexOf(D);o&&~o&&((P=this.oneTimeListeners[f.type])==null||P.splice(o,1))})}on(f,y){var z;(this.listeners[f]=(z=this.listeners[f])!=null?z:[]).push(y)}off(f,y){var z,D;const A=(z=this.listeners[f])==null?void 0:z.indexOf(y);~A&&((D=this.listeners[f])==null||D.splice(A,1))}once(f,y){var z;(this.oneTimeListeners[f]=(z=this.oneTimeListeners[f])!=null?z:[]).push(y)}}class So{constructor(f,y,z){yt(this,"type"),yt(this,"target"),yt(this,"originalEvent"),yt(this,"data"),this.type=f,this.originalEvent=y,this.data=z}}class Gh{constructor(f,y,z){yt(this,"type"),yt(this,"target"),yt(this,"originalEvent"),yt(this,"data"),this.type=f,this.originalEvent=y,this.data=z}}const jf={api:"https://router.project-osrm.org/route/v1",profile:"driving",requestOptions:{},requestTimeout:null,makePostRequest:!1,sourceName:"maplibre-gl-directions",pointsScalingFactor:1,linesScalingFactor:1,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint","maplibre-gl-directions-waypoint-casing"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint","maplibre-gl-directions-snappoint-casing"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline","maplibre-gl-directions-routeline-casing"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline","maplibre-gl-directions-alt-routeline-casing"],dragThreshold:10,refreshOnMove:!1};function Vl(v=1,f=1,y="maplibre-gl-directions"){return[{id:`${y}-snapline`,type:"line",source:y,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":"#34343f","line-opacity":.65,"line-width":3},filter:["==",["get","type"],"SNAPLINE"]},{id:`${y}-alt-routeline-casing`,type:"line",source:y,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#9e91be","line-opacity":.55,"line-width":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],10*f,7*f],5,["case",["boolean",["get","highlight"],!1],10*f,7*f],18,["case",["boolean",["get","highlight"],!1],32*f,23*f]]},filter:["==",["get","route"],"ALT"]},{id:`${y}-alt-routeline`,type:"line",source:y,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#9e91be","line-opacity":.85,"line-width":["interpolate",["exponential",1.5],["zoom"],0,3*f,5,3*f,18,10*f]},filter:["==",["get","route"],"ALT"]},{id:`${y}-routeline-casing`,type:"line",source:y,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":["interpolate-hcl",["linear"],["get","congestion"],0,"#7b51f8",1,"#42c74c",100,"#d72359"],"line-opacity":.55,"line-width":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],10*f,7*f],5,["case",["boolean",["get","highlight"],!1],10*f,7*f],18,["case",["boolean",["get","highlight"],!1],32*f,23*f]]},filter:["==",["get","route"],"SELECTED"]},{id:`${y}-routeline`,type:"line",source:y,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":["interpolate-hcl",["linear"],["get","congestion"],0,"#7b51f8",1,"#42c74c",100,"#d72359"],"line-opacity":.85,"line-width":["interpolate",["exponential",1.5],["zoom"],0,3*f,5,3*f,18,10*f]},filter:["==",["get","route"],"SELECTED"]},{id:`${y}-hoverpoint-casing`,type:"circle",source:y,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,14*v,5,14*v,18,33*v],"circle-color":"#30a856","circle-opacity":.65},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${y}-hoverpoint`,type:"circle",source:y,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,9*v,5,9*v,18,21*v],"circle-color":"#30a856"},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${y}-snappoint-casing`,type:"circle",source:y,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],14*v,12*v],5,["case",["boolean",["get","highlight"],!1],14*v,12*v],18,["case",["boolean",["get","highlight"],!1],33*v,28*v]],"circle-color":["case",["boolean",["get","highlight"],!1],"#e50d3f","#cb3373"],"circle-opacity":.65},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${y}-snappoint`,type:"circle",source:y,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],9*v,7*v],5,["case",["boolean",["get","highlight"],!1],9*v,7*v],18,["case",["boolean",["get","highlight"],!1],21*v,16*v]],"circle-color":["case",["boolean",["get","highlight"],!1],"#e50d3f","#cb3373"]},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${y}-waypoint-casing`,type:"circle",source:y,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],14*v,12*v],5,["case",["boolean",["get","highlight"],!1],14*v,12*v],18,["case",["boolean",["get","highlight"],!1],33*v,28*v]],"circle-color":["case",["boolean",["get","highlight"],!1],"#6d26d7","#7b33e7"],"circle-opacity":.65},filter:["==",["get","type"],"WAYPOINT"]},{id:`${y}-waypoint`,type:"circle",source:y,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],9*v,7*v],5,["case",["boolean",["get","highlight"],!1],9*v,7*v],18,["case",["boolean",["get","highlight"],!1],21*v,16*v]],"circle-color":["case",["boolean",["get","highlight"],!1],"#6d26d7","#7b33e7"]},filter:["==",["get","type"],"WAYPOINT"]}]}let vp=(v=21)=>crypto.getRandomValues(new Uint8Array(v)).reduce((f,y)=>(y&=63,y<36?f+=y.toString(36):y<62?f+=(y-26).toString(36).toUpperCase():y>62?f+="-":f+="_",f),"");var Kc={exports:{}};(function(v){var f={};function y(A){return Math.floor(Math.abs(A)+.5)*(A>=0?1:-1)}function z(A,P,o){A=y(A*o),P=y(P*o);var V=A-P;V<<=1,A-P<0&&(V=~V);for(var G="";V>=32;)G+=String.fromCharCode((32|V&31)+63),V>>=5;return G+=String.fromCharCode(V+63),G}f.decode=function(A,P){for(var o=0,V=0,G=0,se=[],K=0,j=0,ae=null,le,ze,Ce=Math.pow(10,Number.isInteger(P)?P:5);o<A.length;){ae=null,K=0,j=0;do ae=A.charCodeAt(o++)-63,j|=(ae&31)<<K,K+=5;while(ae>=32);le=j&1?~(j>>1):j>>1,K=j=0;do ae=A.charCodeAt(o++)-63,j|=(ae&31)<<K,K+=5;while(ae>=32);ze=j&1?~(j>>1):j>>1,V+=le,G+=ze,se.push([V/Ce,G/Ce])}return se},f.encode=function(A,P){if(!A.length)return"";for(var o=Math.pow(10,Number.isInteger(P)?P:5),V=z(A[0][0],0,o)+z(A[0][1],0,o),G=1;G<A.length;G++){var se=A[G],K=A[G-1];V+=z(se[0],K[0],o),V+=z(se[1],K[1],o)}return V};function D(A){for(var P=[],o=0;o<A.length;o++){var V=A[o].slice();P.push([V[1],V[0]])}return P}f.fromGeoJSON=function(A,P){if(A&&A.type==="Feature"&&(A=A.geometry),!A||A.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return f.encode(D(A.coordinates),P)},f.toGeoJSON=function(A,P){var o=f.decode(A,P);return{type:"LineString",coordinates:D(o)}},v.exports&&(v.exports=f)})(Kc);function qf(v,f){return v.geometries==="geojson"?f.coordinates:v.geometries==="polyline6"?Kc.exports.decode(f,6).map(y=>y.reverse()):Kc.exports.decode(f,5).map(y=>y.reverse())}function Gf(v,f,y){var z,D,A,P,o,V;if((z=v.annotations)!=null&&z.includes("congestion_numeric"))return(A=(D=f==null?void 0:f.congestion_numeric)==null?void 0:D[y])!=null?A:0;if((P=v.annotations)!=null&&P.includes("congestion"))switch((V=(o=f==null?void 0:f.congestion)==null?void 0:o[y])!=null?V:""){case"unknown":return 0;case"low":return 1;case"moderate":return 34;case"heavy":return 77;case"severe":return 100;default:return 0}else return 0}function Zf(v,f,y){return!v.geometries||v.geometries==="polyline"?Math.abs(f[0]-y[0])<=1e-5&&Math.abs(f[1]-y[1])<=1e-5:f[0]===y[0]&&f[1]===y[1]}function bp(v){const f=Vl(v==null?void 0:v.pointsScalingFactor,v==null?void 0:v.linesScalingFactor,v==null?void 0:v.sourceName);return Object.assign({},jf,{layers:f},v)}function wp(v,f){const y=v.makePostRequest?"post":"get";let z,D;if(y==="get")z=`${v.api}/${v.profile}/${f.join(";")}`,D=new URLSearchParams(v.requestOptions);else{z=`${v.api}/${v.profile}${v.requestOptions.access_token?`?access_token=${v.requestOptions.access_token}`:""}`;const A=new FormData;Object.entries(v.requestOptions).forEach(([P,o])=>{P!=="access_token"&&A.set(P,o)}),A.set("coordinates",f.join(";")),D=new URLSearchParams(A)}return{method:y,url:z,payload:D}}function Sp(v,f,y){return{type:"Feature",geometry:{type:"Point",coordinates:v},properties:{type:f,id:vp(),...y!=null?y:{}}}}function Ap(v,f,y,z,D=!1){if(v.length!==f.length)return[];const A=v.map((P,o)=>({type:"Feature",geometry:{type:"LineString",coordinates:[[P[0],P[1]],[f[o][0],f[o][1]]]},properties:{type:"SNAPLINE"}}));return~z&&y!==void 0&&D&&(A.push({type:"Feature",geometry:{type:"LineString",coordinates:[[y[0],y[1]],[f[z][0],f[z][1]]]},properties:{type:"SNAPLINE"}}),A.push({type:"Feature",geometry:{type:"LineString",coordinates:[[y[0],y[1]],[f[z+1][0],f[z+1][1]]]},properties:{type:"SNAPLINE"}})),A}function Ip(v,f,y,z){return f.map((D,A)=>{const P=qf(v,D.geometry),o=z.map(K=>K.geometry.coordinates).map(K=>P.findIndex(j=>Zf(v,j,K))).slice(1);let V=0;const G=o.map(K=>P.slice(V,V=K+1)),se=[];return G.forEach((K,j)=>{const ae=vp();K.forEach((le,ze)=>{var Ce,We,kt,ft,st;const Ye=se[se.length-1],Te=Gf(v,(Ce=D.legs[j])==null?void 0:Ce.annotation,ze);if(j===((We=Ye==null?void 0:Ye.properties)==null?void 0:We.legIndex)&&((kt=Ye.properties)==null?void 0:kt.congestion)===Te)Ye.geometry.coordinates.push(le);else{const rt=(ft=z[j].properties)!=null?ft:{},At=(st=z[j+1].properties)!=null?st:{},Vt={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{id:ae,routeIndex:A,route:A===y?"SELECTED":"ALT",legIndex:j,congestion:Te,departSnappointProperties:rt,arriveSnappointProperties:At}};Ye&&Vt.geometry.coordinates.push(Ye.geometry.coordinates[Ye.geometry.coordinates.length-1]),Vt.geometry.coordinates.push(le),se.push(Vt)}})}),se})}const Wf=Object.freeze(Object.defineProperty({__proto__:null,buildConfiguration:bp,buildRequest:wp,buildPoint:Sp,buildSnaplines:Ap,buildRoutelines:Ip},Symbol.toStringTag,{value:"Module"}));class bn extends Nf{constructor(f,y){super(f),yt(this,"configuration"),yt(this,"_interactive",!1),yt(this,"buildRequest",wp),yt(this,"buildPoint",Sp),yt(this,"buildSnaplines",Ap),yt(this,"buildRoutelines",Ip),yt(this,"onMoveHandler"),yt(this,"onDragDownHandler"),yt(this,"onDragMoveHandler"),yt(this,"onDragUpHandler"),yt(this,"onClickHandler"),yt(this,"liveRefreshHandler"),yt(this,"_waypoints",[]),yt(this,"snappoints",[]),yt(this,"routelines",[]),yt(this,"selectedRouteIndex",0),yt(this,"hoverpoint"),yt(this,"highlightedWaypoints",[]),yt(this,"highlightedSnappoints",[]),yt(this,"dragDownPosition",{x:0,y:0}),yt(this,"waypointBeingDragged"),yt(this,"waypointBeingDraggedInitialCoordinates"),yt(this,"departSnappointIndex",-1),yt(this,"currentMousePosition",{x:0,y:0}),yt(this,"refreshOnMoveIsRefreshing",!1),yt(this,"noMouseMovementTimer"),yt(this,"lastRequestMousePosition",{x:0,y:0}),yt(this,"abortController"),this.map=f,this.configuration=bp(y),this.onMoveHandler=this.onMove.bind(this),this.onDragDownHandler=this.onDragDown.bind(this),this.onDragMoveHandler=this.onDragMove.bind(this),this.onDragUpHandler=this.onDragUp.bind(this),this.onClickHandler=this.onClick.bind(this),this.liveRefreshHandler=this.liveRefresh.bind(this),this.init()}get waypointsCoordinates(){return this._waypoints.map(f=>[f.geometry.coordinates[0],f.geometry.coordinates[1]])}get snappointsCoordinates(){return this.snappoints.map(f=>[f.geometry.coordinates[0],f.geometry.coordinates[1]])}get snaplines(){var f,y,z;return this.buildSnaplines(this.waypointsCoordinates,this.snappointsCoordinates,(f=this.hoverpoint)==null?void 0:f.geometry.coordinates,this.departSnappointIndex,(z=(y=this.hoverpoint)==null?void 0:y.properties)==null?void 0:z.showSnaplines)}init(){this.map.addSource(this.configuration.sourceName,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.configuration.layers.forEach(f=>{this.map.addLayer(f)})}async fetchDirections(f){var y,z;(y=this.abortController)==null||y.abort();const D=this.interactive;if(this._waypoints.length>=2){this.fire(new Gh("fetchroutesstart",f)),this.abortController=new AbortController;const A=this.abortController.signal;A.onabort=()=>{this.interactive=D},this.interactive=!1;let P;this.configuration.requestTimeout!==null&&(P=setTimeout(()=>{var K;return(K=this.abortController)==null?void 0:K.abort()},this.configuration.requestTimeout));const{method:o,url:V,payload:G}=this.buildRequest(this.configuration,this.waypointsCoordinates);let se;try{if(o==="get"?se=await(await fetch(`${V}?${G}`,{signal:this.abortController.signal})).json():se=await(await fetch(`${V}`,{signal:this.abortController.signal,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:G})).json(),se.code!=="Ok")throw new Error((z=se.message)!=null?z:"An unexpected error occurred.")}finally{this.interactive=D,this.abortController=void 0,clearTimeout(P),this.fire(new Gh("fetchroutesend",f,se))}this.snappoints=se.waypoints.map((K,j)=>{var ae;return this.buildPoint(K.location,"SNAPPOINT",{waypointProperties:(ae=this._waypoints[j].properties)!=null?ae:{}})}),this.routelines=this.buildRoutelines(this.configuration.requestOptions,se.routes,this.selectedRouteIndex,this.snappoints),se.routes.length<=this.selectedRouteIndex&&(this.selectedRouteIndex=0)}else this.snappoints=[],this.routelines=[];this.draw(!1)}draw(f=!0){const y=[...this._waypoints,...this.snappoints,...this.snaplines,...this.routelines.reduce((D,A)=>f?D.concat(...A):D.concat(...A.map(P=>(P.properties&&(P.properties.route=P.properties.routeIndex===this.selectedRouteIndex?"SELECTED":"ALT"),P))),[])];this.hoverpoint&&y.push(this.hoverpoint);const z={type:"FeatureCollection",features:y};this.map.getSource(this.configuration.sourceName)&&this.map.getSource(this.configuration.sourceName).setData(z)}deHighlight(){this.highlightedWaypoints.forEach(f=>{f!=null&&f.properties&&(f.properties.highlight=!1)}),this.highlightedSnappoints.forEach(f=>{f!=null&&f.properties&&(f.properties.highlight=!1)}),this.routelines.forEach(f=>{f.forEach(y=>{y.properties&&(y.properties.highlight=!1)})})}onMove(f){var y,z,D,A,P,o,V,G,se,K;const j=this.map.queryRenderedFeatures(f.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveRoutelineLayers,...this.configuration.sensitiveAltRoutelineLayers]})[0];if(this.deHighlight(),this.configuration.sensitiveWaypointLayers.includes((y=j==null?void 0:j.layer.id)!=null?y:"")){this.map.getCanvas().style.cursor="pointer",this.map.dragPan.disable();const ae=this._waypoints.findIndex(le=>{var ze,Ce;return((ze=le.properties)==null?void 0:ze.id)===((Ce=j==null?void 0:j.properties)==null?void 0:Ce.id)});this.highlightedWaypoints=[this._waypoints[ae]],this.highlightedSnappoints=[this.snappoints[ae]],(z=this.highlightedWaypoints[0])!=null&&z.properties&&(this.highlightedWaypoints[0].properties.highlight=!0),(D=this.highlightedSnappoints[0])!=null&&D.properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else if(this.configuration.sensitiveSnappointLayers.includes((A=j==null?void 0:j.layer.id)!=null?A:"")){this.map.getCanvas().style.cursor="pointer";const ae=this.snappoints.findIndex(le=>{var ze,Ce;return((ze=le.properties)==null?void 0:ze.id)===((Ce=j==null?void 0:j.properties)==null?void 0:Ce.id)});this.highlightedSnappoints=[this.snappoints[ae]],this.highlightedWaypoints=[this._waypoints[ae]],this.highlightedSnappoints[0].properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.highlightedWaypoints[0].properties&&(this.highlightedWaypoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else this.configuration.sensitiveRoutelineLayers.includes((P=j==null?void 0:j.layer.id)!=null?P:"")?(this.map.getCanvas().style.cursor="pointer",this.map.dragPan.disable(),this.hoverpoint?this.hoverpoint.geometry.coordinates=[f.lngLat.lng,f.lngLat.lat]:this.hoverpoint=this.buildPoint([f.lngLat.lng,f.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse((V=(o=j==null?void 0:j.properties)==null?void 0:o.departSnappointProperties)!=null?V:"{}")},arriveSnappointProperties:{...JSON.parse((se=(G=j==null?void 0:j.properties)==null?void 0:G.arriveSnappointProperties)!=null?se:"{}")}}),this.routelines.forEach(ae=>{ae.forEach(le=>{var ze,Ce;le.properties&&((ze=le.properties)==null?void 0:ze.id)===((Ce=j==null?void 0:j.properties)==null?void 0:Ce.id)&&(le.properties.highlight=!0)})})):this.configuration.sensitiveAltRoutelineLayers.includes((K=j==null?void 0:j.layer.id)!=null?K:"")?(this.map.getCanvas().style.cursor="pointer",this.routelines.forEach(ae=>{ae.forEach(le=>{var ze,Ce;le.properties&&((ze=le.properties)==null?void 0:ze.id)===((Ce=j==null?void 0:j.properties)==null?void 0:Ce.id)&&(le.properties.highlight=!0)})}),this.hoverpoint&&(this.hoverpoint=void 0)):(this.map.dragPan.enable(),this.map.getCanvas().style.cursor="",this.hoverpoint=void 0);this.draw()}onDragDown(f){var y,z,D,A,P,o,V,G,se,K;if(f.type==="touchstart"&&f.originalEvent.touches.length!==1||f.type==="mousedown"&&f.originalEvent.which!==1)return;const j=this.map.queryRenderedFeatures(f.point);if(j[0].source===this.configuration.sourceName){const ae=j.filter(le=>{var ze,Ce,We;return this.configuration.sensitiveWaypointLayers.includes((ze=le==null?void 0:le.layer.id)!=null?ze:"")||this.configuration.sensitiveSnappointLayers.includes((Ce=le==null?void 0:le.layer.id)!=null?Ce:"")||this.configuration.sensitiveRoutelineLayers.includes((We=le==null?void 0:le.layer.id)!=null?We:"")})[0];if(this.dragDownPosition=f.point,this.currentMousePosition=f.point,this.configuration.sensitiveWaypointLayers.includes((y=ae==null?void 0:ae.layer.id)!=null?y:""))this.waypointBeingDragged=this._waypoints.find(le=>{var ze,Ce;return((ze=le.properties)==null?void 0:ze.id)===((Ce=ae==null?void 0:ae.properties)==null?void 0:Ce.id)}),this.waypointBeingDraggedInitialCoordinates=(z=this.waypointBeingDragged)==null?void 0:z.geometry.coordinates;else if(this.configuration.sensitiveRoutelineLayers.includes((D=ae==null?void 0:ae.layer.id)!=null?D:"")){if(this.departSnappointIndex=JSON.parse((A=ae==null?void 0:ae.properties)==null?void 0:A.legIndex),this.hoverpoint)if(this.configuration.refreshOnMove){const le=this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0;this._addWaypoint([f.lngLat.lng,f.lngLat.lat],le,f),this.waypointBeingDragged=this._waypoints[le],this.hoverpoint=void 0}else this.hoverpoint.geometry.coordinates=[f.lngLat.lng,f.lngLat.lat];else this.hoverpoint=this.buildPoint([f.lngLat.lng,f.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse((o=(P=ae==null?void 0:ae.properties)==null?void 0:P.departSnappointProperties)!=null?o:"{}")},arriveSnappointProperties:{...JSON.parse((G=(V=ae==null?void 0:ae.properties)==null?void 0:V.arriveSnappointProperties)!=null?G:"{}")}});(se=this.hoverpoint)!=null&&se.properties&&(this.hoverpoint.properties.showSnaplines=!0),~this.departSnappointIndex&&((K=this.snappoints[this.departSnappointIndex])==null?void 0:K.properties)&&(this.snappoints[this.departSnappointIndex].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex]),this.snappoints[this.departSnappointIndex+1].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex+1]))}this.map.off("touchstart",this.onMoveHandler),this.map.off("mousemove",this.onMoveHandler),f.type==="touchstart"?(this.map.on("touchmove",this.onDragMoveHandler),this.map.on("touchend",this.onDragUpHandler)):f.type==="mousedown"&&(this.map.on("mousemove",this.onDragMoveHandler),this.map.on("mouseup",this.onDragUpHandler)),this.draw()}}onDragMove(f){if(this.configuration.refreshOnMove&&(clearTimeout(this.noMouseMovementTimer),this.noMouseMovementTimer=setTimeout(this.liveRefreshHandler,300,f)),f.type==="touchmove"&&f.originalEvent.touches.length!==1)return f.originalEvent.preventDefault();f.type==="mousemove"&&f.originalEvent.which!==1||(this.waypointBeingDragged?this.waypointBeingDragged.geometry.coordinates=[f.lngLat.lng,f.lngLat.lat]:this.hoverpoint&&(this.hoverpoint.geometry.coordinates=[f.lngLat.lng,f.lngLat.lat]),this.currentMousePosition=f.point,this.draw(),this.configuration.refreshOnMove&&!this.refreshOnMoveIsRefreshing&&this.liveRefreshHandler(f))}async onDragUp(f){var y,z,D;if(this.configuration.refreshOnMove&&clearTimeout(this.noMouseMovementTimer),!(f.type==="mouseup"&&f.originalEvent.which!==1)){if((y=this.hoverpoint)!=null&&y.properties&&(this.hoverpoint.properties.showSnaplines=!1),Math.abs(f.point.x-((z=this.dragDownPosition)==null?void 0:z.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(f.point.y-((D=this.dragDownPosition)==null?void 0:D.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0))if(this.waypointBeingDragged){this.waypointBeingDragged.geometry.coordinates=[f.lngLat.lng,f.lngLat.lat];const A=new So("movewaypoint",f,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(A);try{await this.fetchDirections(A)}catch(P){P instanceof DOMException&&P.name=="AbortError"||this.waypointBeingDraggedInitialCoordinates&&(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates)}this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0}else this.hoverpoint&&(this._addWaypoint([f.lngLat.lng,f.lngLat.lat],this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0,f),this.hoverpoint=void 0);else this.waypointBeingDragged&&this.waypointBeingDraggedInitialCoordinates?(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates,this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0):this.hoverpoint&&(this.hoverpoint=void 0);this.deHighlight(),f.type==="touchend"?(this.map.off("touchmove",this.onDragMoveHandler),this.map.off("touchend",this.onDragUpHandler)):f.type==="mouseup"&&(this.map.off("mousemove",this.onDragMoveHandler),this.map.off("mouseup",this.onDragUpHandler)),this.map.on("touchstart",this.onMoveHandler),this.map.on("mousemove",this.onMoveHandler),this.draw()}}async liveRefresh(f){var y,z,D,A;if(Math.abs(((y=this.lastRequestMousePosition)==null?void 0:y.x)-((z=this.currentMousePosition)==null?void 0:z.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(((D=this.lastRequestMousePosition)==null?void 0:D.y)-((A=this.currentMousePosition)==null?void 0:A.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)){if(this.refreshOnMoveIsRefreshing=!0,this.lastRequestMousePosition=this.currentMousePosition,this.waypointBeingDragged){const P=new So("movewaypoint",f,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(P);try{await this.fetchDirections(P)}catch{}}this.refreshOnMoveIsRefreshing=!1}}onClick(f){var y,z,D,A;const P=this.map.queryRenderedFeatures(f.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveAltRoutelineLayers,...this.configuration.sensitiveRoutelineLayers]})[0];if(this.configuration.sensitiveWaypointLayers.includes((y=P==null?void 0:P.layer.id)!=null?y:"")){const o=this._waypoints.findIndex(V=>{var G,se;return((G=V.properties)==null?void 0:G.id)===((se=P==null?void 0:P.properties)==null?void 0:se.id)});~o&&this._removeWaypoint(o,f)}else if(this.configuration.sensitiveSnappointLayers.includes((z=P==null?void 0:P.layer.id)!=null?z:"")){const o=this.snappoints.findIndex(V=>{var G,se;return((G=V.properties)==null?void 0:G.id)===((se=P==null?void 0:P.properties)==null?void 0:se.id)});~o&&this._removeWaypoint(o,f)}else this.configuration.sensitiveAltRoutelineLayers.includes((D=P==null?void 0:P.layer.id)!=null?D:"")?this.selectedRouteIndex=this.routelines.findIndex(o=>!!o.find(V=>{var G,se;return((G=V.properties)==null?void 0:G.id)===((se=P==null?void 0:P.properties)==null?void 0:se.id)})):this.configuration.sensitiveRoutelineLayers.includes((A=P==null?void 0:P.layer.id)!=null?A:"")||this._addWaypoint([f.lngLat.lng,f.lngLat.lat],void 0,f);this.draw(!1)}assignWaypointsCategories(){this._waypoints.forEach((f,y)=>{const z=y===0?"ORIGIN":y===this._waypoints.length-1?"DESTINATION":void 0;f.properties&&(f.properties.category=z)})}async _addWaypoint(f,y,z){var D;(D=this.abortController)==null||D.abort(),y=y!=null?y:this._waypoints.length,this._waypoints.splice(y,0,this.buildPoint(f,"WAYPOINT")),this.assignWaypointsCategories();const A=new So("addwaypoint",z,{index:y});this.fire(A),this.draw(),await this.fetchDirections(A)}async _removeWaypoint(f,y){var z;(z=this.abortController)==null||z.abort(),this._waypoints.splice(f,1),this.snappoints.splice(f,1),this.assignWaypointsCategories();const D=new So("removewaypoint",y,{index:f});this.fire(D),this.draw(),await this.fetchDirections(D)}get interactive(){return this._interactive}set interactive(f){this._interactive=f,f?(this.map.on("touchstart",this.onMoveHandler),this.map.on("touchstart",this.onDragDownHandler),this.map.on("mousemove",this.onMoveHandler),this.map.on("mousedown",this.onDragDownHandler),this.map.on("click",this.onClickHandler)):(this.map.off("touchstart",this.onMoveHandler),this.map.off("touchstart",this.onDragDownHandler),this.map.off("mousemove",this.onMoveHandler),this.map.off("mousedown",this.onDragDownHandler),this.map.off("click",this.onClickHandler))}get waypoints(){return this.waypointsCoordinates}set waypoints(f){this.setWaypoints(f)}async setWaypoints(f){var y;(y=this.abortController)==null||y.abort(),this._waypoints=f.map(D=>this.buildPoint(D,"WAYPOINT")),this.assignWaypointsCategories();const z=new So("setwaypoints",void 0);this.fire(z),this.draw(),await this.fetchDirections(z)}async addWaypoint(f,y){await this._addWaypoint(f,y)}async removeWaypoint(f){await this._removeWaypoint(f)}clear(){this.setWaypoints([]),this.routelines=[]}destroy(){this.interactive=!1,this.clear(),this.configuration.layers.forEach(f=>{this.map.removeLayer(f.id)}),this.map.removeSource(this.configuration.sourceName)}}function Fl(){}function Tp(v){return v()}function Zh(){return Object.create(null)}function $l(v){v.forEach(Tp)}function Hf(v){return typeof v=="function"}function Xf(v,f){return v!=v?f==f:v!==f||v&&typeof v=="object"||typeof v=="function"}function Yf(v){return Object.keys(v).length===0}function ks(v,f){v.appendChild(f)}function Ep(v,f,y){v.insertBefore(f,y||null)}function au(v){v.parentNode.removeChild(v)}function ts(v){return document.createElementNS("http://www.w3.org/2000/svg",v)}function Kf(v){return document.createTextNode(v)}function Jf(){return Kf("")}function zt(v,f,y){y==null?v.removeAttribute(f):v.getAttribute(f)!==y&&v.setAttribute(f,y)}function Qf(v){return Array.from(v.childNodes)}let lu;function Ca(v){lu=v}const Ta=[],Wh=[],Rl=[],Hh=[],em=Promise.resolve();let Jc=!1;function tm(){Jc||(Jc=!0,em.then(Cp))}function Qc(v){Rl.push(v)}const Xc=new Set;let Ml=0;function Cp(){const v=lu;do{for(;Ml<Ta.length;){const f=Ta[Ml];Ml++,Ca(f),im(f.$$)}for(Ca(null),Ta.length=0,Ml=0;Wh.length;)Wh.pop()();for(let f=0;f<Rl.length;f+=1){const y=Rl[f];Xc.has(y)||(Xc.add(y),y())}Rl.length=0}while(Ta.length);for(;Hh.length;)Hh.pop()();Jc=!1,Xc.clear(),Ca(v)}function im(v){if(v.fragment!==null){v.update(),$l(v.before_update);const f=v.dirty;v.dirty=[-1],v.fragment&&v.fragment.p(v.ctx,f),v.after_update.forEach(Qc)}}const nm=new Set;function rm(v,f){v&&v.i&&(nm.delete(v),v.i(f))}function sm(v,f,y,z){const{fragment:D,on_mount:A,on_destroy:P,after_update:o}=v.$$;D&&D.m(f,y),z||Qc(()=>{const V=A.map(Tp).filter(Hf);P?P.push(...V):$l(V),v.$$.on_mount=[]}),o.forEach(Qc)}function om(v,f){const y=v.$$;y.fragment!==null&&($l(y.on_destroy),y.fragment&&y.fragment.d(f),y.on_destroy=y.fragment=null,y.ctx=[])}function am(v,f){v.$$.dirty[0]===-1&&(Ta.push(v),tm(),v.$$.dirty.fill(0)),v.$$.dirty[f/31|0]|=1<<f%31}function lm(v,f,y,z,D,A,P,o=[-1]){const V=lu;Ca(v);const G=v.$$={fragment:null,ctx:null,props:A,update:Fl,not_equal:D,bound:Zh(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(f.context||(V?V.$$.context:[])),callbacks:Zh(),dirty:o,skip_bound:!1,root:f.target||V.$$.root};P&&P(G.root);let se=!1;if(G.ctx=y?y(v,f.props||{},(K,j,...ae)=>{const le=ae.length?ae[0]:j;return G.ctx&&D(G.ctx[K],G.ctx[K]=le)&&(!G.skip_bound&&G.bound[K]&&G.bound[K](le),se&&am(v,K)),j}):[],G.update(),se=!0,$l(G.before_update),G.fragment=z?z(G.ctx):!1,f.target){if(f.hydrate){const K=Qf(f.target);G.fragment&&G.fragment.l(K),K.forEach(au)}else G.fragment&&G.fragment.c();f.intro&&rm(v.$$.fragment),sm(v,f.target,f.anchor,f.customElement),Cp()}Ca(V)}class cm{$destroy(){om(this,1),this.$destroy=Fl}$on(f,y){const z=this.$$.callbacks[f]||(this.$$.callbacks[f]=[]);return z.push(y),()=>{const D=z.indexOf(y);D!==-1&&z.splice(D,1)}}$set(f){this.$$set&&!Yf(f)&&(this.$$.skip_bound=!0,this.$$set(f),this.$$.skip_bound=!1)}}function Xh(v){let f,y,z,D,A,P,o,V,G,se,K,j,ae,le,ze,Ce;return{c(){f=ts("svg"),y=ts("circle"),D=ts("path"),P=ts("g"),o=ts("path"),G=ts("path"),K=ts("path"),ae=ts("animateTransform"),zt(y,"cx","64.13"),zt(y,"cy","64.13"),zt(y,"r","27.63"),zt(y,"fill",z=v[0].fill),zt(D,"d","M64.13 18.5A45.63 45.63 0 1 1 18.5 64.13 45.63 45.63 0 0 1 64.13 18.5zm0 7.85a37.78 37.78 0 1 1-37.78 37.78 37.78 37.78 0 0 1 37.78-37.78z"),zt(D,"fill-rule","evenodd"),zt(D,"fill",A=v[0].fill),zt(o,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),zt(o,"fill",V=v[0].fill),zt(G,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),zt(G,"fill",se=v[0].fill),zt(G,"transform","rotate(120 64 64)"),zt(K,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),zt(K,"fill",j=v[0].fill),zt(K,"transform","rotate(240 64 64)"),zt(ae,"attributeName","transform"),zt(ae,"type","rotate"),zt(ae,"from","0 64 64"),zt(ae,"to","120 64 64"),zt(ae,"dur","360ms"),zt(ae,"repeatCount","indefinite"),zt(f,"xmlns","http://www.w3.org/2000/svg"),zt(f,"width",le=v[0].size),zt(f,"height",ze=v[0].size),zt(f,"viewBox","0 0 128 128"),zt(f,"xml:space","preserve"),zt(f,"class",Ce=v[0].class)},m(We,kt){Ep(We,f,kt),ks(f,y),ks(f,D),ks(f,P),ks(P,o),ks(P,G),ks(P,K),ks(P,ae)},p(We,kt){kt&1&&z!==(z=We[0].fill)&&zt(y,"fill",z),kt&1&&A!==(A=We[0].fill)&&zt(D,"fill",A),kt&1&&V!==(V=We[0].fill)&&zt(o,"fill",V),kt&1&&se!==(se=We[0].fill)&&zt(G,"fill",se),kt&1&&j!==(j=We[0].fill)&&zt(K,"fill",j),kt&1&&le!==(le=We[0].size)&&zt(f,"width",le),kt&1&&ze!==(ze=We[0].size)&&zt(f,"height",ze),kt&1&&Ce!==(Ce=We[0].class)&&zt(f,"class",Ce)},d(We){We&&au(f)}}}function um(v){let f,y=v[1]&&Xh(v);return{c(){y&&y.c(),f=Jf()},m(z,D){y&&y.m(z,D),Ep(z,f,D)},p(z,[D]){z[1]?y?y.p(z,D):(y=Xh(z),y.c(),y.m(f.parentNode,f)):y&&(y.d(1),y=null)},i:Fl,o:Fl,d(z){y&&y.d(z),z&&au(f)}}}function hm(v,f,y){let{directions:z}=f,{configuration:D}=f,A;return z.on("fetchroutesstart",()=>{y(1,A=!0)}),z.on("fetchroutesend",()=>{y(1,A=!1)}),v.$$set=P=>{"directions"in P&&y(2,z=P.directions),"configuration"in P&&y(0,D=P.configuration)},[D,A,z]}class pm extends cm{constructor(f){super(),lm(this,f,hm,um,Xf,{directions:2,configuration:0})}}const dm={fill:"#6d26d7",size:"24px",class:""};class fm{constructor(f,y){yt(this,"controlElement"),yt(this,"directions"),yt(this,"configuration"),this.directions=f,this.configuration=Object.assign({},dm,y)}onAdd(){return this.controlElement=document.createElement("div"),new pm({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}function mm(v){let f,y,z,D,A,P,o,V,G,se,K,j,ae,le,ze;return{c(){f=Ae("label"),y=Ae("input"),D=et(),A=Ae("strong"),A.textContent="Interactivity enabled",P=et(),o=Ae("label"),V=Ae("input"),se=et(),K=Ae("strong"),K.textContent="Update route while dragging",j=et(),ae=Ae("ul"),ae.innerHTML=`<li>Click somewhere on the map to add a waypoint</li> 
    <li>Click a waypoint to remove it and its related snappoint</li> 
    <li>Click a snappoint to remove it and its related waypoint</li> 
    <li>Drag a waypoint somewhere to move it</li> 
    <li>Drag a routeline somewhere to add a waypoint in-between the 2 nearest ones</li> 
    <li>Click an alternative routeline to select it<br/> 
      <small><strong>Note</strong>, there&#39;s usually no alternative routelines in the server response if there are more than
        2 waypoints</small></li>`,Qe(y,"type","checkbox"),y.disabled=z=!v[0],Qe(f,"class","flex items-center gap-3"),Qe(V,"type","checkbox"),V.disabled=G=!v[0],Qe(o,"class","flex items-center gap-3")},m(Ce,We){be(Ce,f,We),Ze(f,y),y.checked=v[1],Ze(f,D),Ze(f,A),be(Ce,P,We),be(Ce,o,We),Ze(o,V),V.checked=v[3],Ze(o,se),Ze(o,K),be(Ce,j,We),be(Ce,ae,We),le||(ze=[ji(y,"change",v[6]),ji(V,"change",v[7]),ji(V,"click",v[5])],le=!0)},p(Ce,We){We&1&&z!==(z=!Ce[0])&&(y.disabled=z),We&2&&(y.checked=Ce[1]),We&1&&G!==(G=!Ce[0])&&(V.disabled=G),We&8&&(V.checked=Ce[3])},d(Ce){Ce&&xe(f),Ce&&xe(P),Ce&&xe(o),Ce&&xe(j),Ce&&xe(ae),le=!1,sr(ze)}}}function gm(v){let f;return{c(){f=Ae("span"),f.textContent=`${v[4].name}`,Qe(f,"slot","title")},m(y,z){be(y,f,z)},p:Ut,d(y){y&&xe(f)}}}function _m(v){let f,y,z,D;return f=new An({props:{$$slots:{title:[gm],default:[mm]},$$scope:{ctx:v}}}),{c(){Ci(f.$$.fragment),y=et(),z=Ae("div"),Qe(z,"class","basis-full lg:basis-2/3 shadow-xl")},m(A,P){wi(f,A,P),be(A,y,P),be(A,z,P),v[8](z),D=!0},p(A,[P]){const o={};P&2059&&(o.$$scope={dirty:P,ctx:A}),f.$set(o)},i(A){D||(ii(f.$$.fragment,A),D=!0)},o(A){ci(f.$$.fragment,A),D=!1},d(A){Si(f,A),A&&xe(y),A&&xe(z),v[8](null)}}}function ym(v,f,y){let z;wn(v,Sn,le=>y(10,z=le));const D=qi.find(le=>le.path===z);let A,P,o,V=!0,G=!1;function se(){o&&o.destroy(),y(0,o=new bn(P,{requestOptions:{alternatives:"true"},refreshOnMove:!G}))}Fn(()=>{P=new On.Map({container:A,style:Un,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"}),P.on("load",()=>{y(0,o=new bn(P,{requestOptions:{alternatives:"true"}}))})});function K(){V=this.checked,y(1,V)}function j(){G=this.checked,y(3,G)}function ae(le){un[le?"unshift":"push"](()=>{A=le,y(2,A)})}return v.$$.update=()=>{v.$$.dirty&3&&o&&y(0,o.interactive=V,o)},[o,V,A,G,D,se,K,j,ae]}class xm extends Zi{constructor(f){super(),Gi(this,f,ym,_m,Bi,{})}}const vm=Object.freeze(Object.defineProperty({__proto__:null,default:xm},Symbol.toStringTag,{value:"Module"})),bm=[{id:"maplibre-gl-directions-snapline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[2,2],"line-color":"#ffffff","line-opacity":.65,"line-width":2},filter:["==",["get","type"],"SNAPLINE"]},{id:"maplibre-gl-directions-alt-routeline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-pattern":"routeline","line-width":12,"line-opacity":.5},filter:["==",["get","route"],"ALT"]},{id:"maplibre-gl-directions-routeline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-pattern":"routeline","line-width":12},filter:["==",["get","route"],"SELECTED"]},{id:"maplibre-gl-directions-hoverpoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-hoverpoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"HOVERPOINT"]},{id:"maplibre-gl-directions-snappoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-snappoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"SNAPPOINT"]},{id:"maplibre-gl-directions-waypoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-waypoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"WAYPOINT"]}],wm="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJpSURBVEiJlZRLSFQBFIa/c2dyGMXHNKUrq0WLgsxt214L20gG0gxGhIIktIk2IS3bRFG4ahFBYQPlY8pQNxkFUbSQigyEiBKLIk3vOODUPO5pMV4fM/fOnTmbuffc8//ff+5jBI8abF9qEb/0iHIU2LPW/obyzEDvnI5vnymlF7cLE20aSAQTNxXtBQyXsZwKt7cZDRc7hyRdNmCiTQNm0JwEDtu92maoa84fr8xDcn6L5Lnf19DmBPE7AZarE7dE8+Y1jXCgWwntLZj5DB/vCqu/ATiSy5k3gAueGwy2L7UYPnkPGMEdcKhfCdQ5xYB0QnhzFVJ/AMghVmt0JPxp80zRvRW/9Nj9/VF3c4CqemVfRO1Tn2J0F84UAyyOAQTqYOdBd3O7GluhqnZNqxz3BCDsAqhuAnF9xzaNG1DTtH662xuA+gGsjLe5XVZ2TQk+T4AgPwGS35XsX2/zbAqSP2wtvzwBCh/yqYS5KW/A3NSWbd95AkDG7aMvY8LijPuDWJzJz6yHU8Y8ARk14kAW8vd2egBmh2B1YWNmdQFmH8L0gGDlNqSk5WlRXKdksQ5zHPREYd8fzP9mU44LxaOjoQ7PDQBQvebUzqZczRHDuu7UdwRE46GXwCtnK6c8TEWGw6/LBuQTcaVcf8Mw+t0uugIiw6EXqD7yche4Fxmpf1sxAEAsvQQkS7gv+3yZy6U8SgIiT8LzSPF/vF1qaV/nUGPR17s1QxkVO2nGEI0UtO9HR0NnvbQlN7Drn2ofMLcp1VcrZbluVjHg3OOQKYaeATJAGsPq6poMr5SjragenFo6H+sweyvR/Ac3+sqU/+vBXgAAAABJRU5ErkJggg==",Sm="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJwSURBVEiJlZTNSxRxGMc/v98KZmm67qJQ2At0Ksy/obeDXSy7ZBS5KEiCHaJLSMcuUSSeOmi7BkW16taKeDCjMIJOFRgUHSzMjExdc2O3fZmnwzrr6s7s7D6Xmeft+3me+c2MwsGWW9obVZnqRDgG7FsPf0V4LuiB2tDgTKF+ZZeQ5p7y1YroHYEuQNuUpVFyt0b/vaKCwUTRAGnuKY9URCeAI9lgwy5o2J25n5uHuR+5LS9qXNFmK0iZFWB1+1ofojLidV6k4ywc2L+56Mss6t4j+PUb4GgkXXkb6HHcYLmlvVG51HtA461Fei/DziqrOVCrUbjRB0srAGlDGU2ekaGPuTV5z1aVqU4zLudO2YoDSHUl0tZiui6N7thak394BseBjPDhg7biWWs6BFU71omccAYo9gBQ7wVl+5LlKGiorzO9vY4AMQ8+mXIWNy2VrXU5AhSyACDfFyD+z1k8Fof5BdP76QgA/QFApVIwNe0MmJrO2VbeOQIUMp69D0+iZj7bi898QoUnN3zRYUeAlnQIyIyUSkH/AATHYHFpo2hxCR6HUf2DkE6b0aRKxMfyB7awSKtvXOBkXqJiW+Yai1u1hdyj/lbHDQBEuGkVJxa3E8fQ3LKKWwLcIf8r4LWlkuVEasoz7H9TNCCTkevFymstvbYydgn3cOClCE+K0B+qHvG/LRkAIAZXgTXbAqVWki6uFdIoCPA888+h8v/xGwMY3XXBQN7Xu2mGQknTIqd9D0XRtiV83z3qv+jUW3AD00SkG/iWE5k1YgnbzUoGuJ8GIqLlApAEEoZW5z0TD/4U01uSLZ/xXYq0+rpK6fkPouPQTszwGH0AAAAASUVORK5CYII=",Am="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAKQSURBVEiJlZRLSFRRGMd/586rVHQySDMqXRRESJuQ1BTsiS1atK5NGpIgodQiIghqleWYbVr0wDZpG6nUICym0UZ0kQXZTlSMHDUczee87mkxXlPn3rl3vtU5//N9/9/5zj3nCkyi3F9fiKBaSk4C+WvymIQeu4w99Za2/EhWL4wWKrvrXItZNg9C1ACKQVpMIp4EszIbhg/fCVsGVHbXuRZ22N8LSYWmFWzLocCVC8BoKMDo6tTGkk+zWVmVehC7HmDRbW/WzHc7s7mWd55D2/duyvm5MkHL7zdMhoMAJ7Ln5x8CdaYdlPvrCyV8A5RdDjeN+Zdx29P19sFcdIkbY8+YjswDxFSVI1+Oe4Y35iSeraBa06/knjU0B3Db06nKOaNNbYpC1dacBICUnNKKj2YcMDTXoijjIJm2tHgt8rQpANgHkOfIRjG+ZP8NhMIe504ABGK/FYAdIELM1FyLiIxqQ5sVwCTA2OoUK6ru1d4Uy2qI8fCMNg1YAIjv8V3F6AwOmgI6ZweJqGsdCIbMAULt0obtMz6GFkcMzb8ujdD+p3d9LqV4awpwKpEOIArxLu7+auPFdA+B+IMCIBAO8nzqA/cm2ojK9W8VIeZ8l7BfvZ2V9dd3ITm3VU9TXED83HWMOnwlngumHQAgua8nL6shXfM1xAM9VRfQW+L5jJR9Bk568dFX0uS3DACQCrctmksp1FtGi4aAvuJmr4TXFuxb+4ofDaQMAFDs4jqwkCQlaHM4bib1SLboK2qaECLxH78eklpvUWPC67UMAPAVe1pBvNqqC+TL3lJPm1m9KQDAFlJrgfEN0mhIiRl3lirAW9E8p6hcAiJAWCAuDhx7/NdKbUpR1t9wtdzfUJNKzT8AkN+WDptOYQAAAABJRU5ErkJggg==",Im="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAACmAAAApgHdff84AAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAN9JREFUSIlj/P//PwMtARNNTWdgYGB0ic61oKUFLP8Z/h+nqQURFj9paT4Di4HsH9paULGam6YW0DwVjVpAELAwMDAwaKsqMthbGMEFn714zbBh9yGGSD83BkF+Xrj49gOQLOPpYAkXe//xM8PyTbsYAlztGKQkROHiB0+cY7h6+z7EAlZWFgYeLk64JAcHOwMDAwMDNycHijgLMzMDAwMDitivX7/hepDFWVlZGBgYGBgYnaNzaFraDf1IHvoWsDQFfqOtBY/e0dYTLHMOctDWAkYGRkvCysgHjEO+VQEA4IsuY5Zs3DIAAAAASUVORK5CYII=";function Tm(v){let f,y,z,D,A,P,o,V,G,se;return{c(){f=Ae("p"),y=yi(`It's completely up to you how to style the Directions' features shown on the map. You can either use the default
    styles provided by the plugin (see other examples), easily modify the default features' dimensions (see the
    `),z=Ae("a"),z.textContent="Touch-Friendly Features example",D=yi(`) or
    `),A=Ae("strong"),A.textContent="define your custom features' styles from scratch",P=yi("."),o=et(),V=Ae("p"),V.textContent="This example demonstrates the last option.",Qe(z,"href","/examples/touch-friendly-features")},m(K,j){be(K,f,j),Ze(f,y),Ze(f,z),Ze(f,D),Ze(f,A),Ze(f,P),be(K,o,j),be(K,V,j),G||(se=iu(ou.call(null,z)),G=!0)},p:Ut,d(K){K&&xe(f),K&&xe(o),K&&xe(V),G=!1,se()}}}function Em(v){let f;return{c(){f=Ae("span"),f.textContent=`${v[1].name}`,Qe(f,"slot","title")},m(y,z){be(y,f,z)},p:Ut,d(y){y&&xe(f)}}}function Cm(v){let f,y,z,D;return f=new An({props:{$$slots:{title:[Em],default:[Tm]},$$scope:{ctx:v}}}),{c(){Ci(f.$$.fragment),y=et(),z=Ae("div"),Qe(z,"class","basis-full lg:basis-2/3 shadow-xl")},m(A,P){wi(f,A,P),be(A,y,P),be(A,z,P),v[2](z),D=!0},p(A,[P]){const o={};P&32&&(o.$$scope={dirty:P,ctx:A}),f.$set(o)},i(A){D||(ii(f.$$.fragment,A),D=!0)},o(A){ci(f.$$.fragment,A),D=!1},d(A){Si(f,A),A&&xe(y),A&&xe(z),v[2](null)}}}function zm(v,f,y){let z;wn(v,Sn,V=>y(4,z=V));const D=qi.find(V=>V.path===z);let A,P;Fn(()=>{const V=new On.Map({container:A,style:Un,center:[-74.1197632,40.6974034],zoom:11,customAttribution:`<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a> | Icons made by <a href="https://www.flaticon.com/authors/vectors-market" title="Vectors Market">Vectors Market</a> and by <a href="https://www.flaticon.com/authors/dinosoftlabs" title="DinosoftLabs">DinosoftLabs</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>`,fadeDuration:0});V.on("load",()=>{V.loadImage(wm,(G,se)=>{G||V.addImage("balloon-waypoint",se)}),V.loadImage(Sm,(G,se)=>{G||V.addImage("balloon-snappoint",se)}),V.loadImage(Am,(G,se)=>{G||V.addImage("balloon-hoverpoint",se)}),V.loadImage(Im,(G,se)=>{G||V.addImage("routeline",se)}),P=new bn(V,{requestOptions:{alternatives:"true"},layers:bm,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline"]}),P.interactive=!0})});function o(V){un[V?"unshift":"push"](()=>{A=V,y(0,A)})}return[A,D,o]}class km extends Zi{constructor(f){super(),Gi(this,f,zm,Cm,Bi,{})}}const Pm=Object.freeze(Object.defineProperty({__proto__:null,default:km},Symbol.toStringTag,{value:"Module"}));class Mm extends bn{constructor(y,z){super(y,z);Wc(this,"originalBuildRoutelines",Wf.buildRoutelines);Wc(this,"buildRoutelines",(y,z,D,A)=>{const P=this.originalBuildRoutelines(y,z,D,A);return P[0].forEach((o,V)=>{o.properties&&(o.properties.distance=z[0].legs[V].distance)}),P})}}const Ni="distance-measurement-maplibre-gl-directions",Dm={sourceName:Ni,layers:[{id:`${Ni}-snapline`,type:"line",source:Ni,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":"#34343f","line-width":2},filter:["==",["get","type"],"SNAPLINE"]},{id:`${Ni}-routeline`,type:"line",source:Ni,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#212121","line-opacity":.85,"line-width":3},filter:["==",["get","route"],"SELECTED"]},{id:`${Ni}-routeline-distance`,type:"symbol",source:Ni,layout:{"symbol-placement":"line-center","text-field":"{distance}m","text-size":16,"text-ignore-placement":!0,"text-allow-overlap":!0,"text-overlap":"always"},paint:{"text-color":"#212121","text-halo-color":"#ffffff","text-halo-width":1},filter:["==",["get","route"],"SELECTED"]},{id:`${Ni}-hoverpoint`,type:"circle",source:Ni,paint:{"circle-radius":9,"circle-color":"#212121"},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${Ni}-snappoint`,type:"circle",source:Ni,paint:{"circle-radius":["case",["boolean",["get","highlight"],!1],9,7],"circle-color":["case",["boolean",["get","highlight"],!1],"#313131","#494949"]},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${Ni}-waypoint`,type:"circle",source:Ni,paint:{"circle-radius":["case",["boolean",["get","highlight"],!1],9,7],"circle-color":["case",["boolean",["get","highlight"],!1],"#212121","#2c2c2c"]},filter:["==",["get","type"],"WAYPOINT"]}],sensitiveSnappointLayers:[`${Ni}-snappoint`],sensitiveWaypointLayers:[`${Ni}-waypoint`],sensitiveRoutelineLayers:[`${Ni}-routeline`],sensitiveAltRoutelineLayers:[]};function Lm(v){let f;return{c(){f=Ae("em"),f.textContent="unknown"},m(y,z){be(y,f,z)},p:Ut,d(y){y&&xe(f)}}}function Rm(v){let f,y,z;return{c(){f=Ae("strong"),y=yi(v[1]),z=yi("m")},m(D,A){be(D,f,A),Ze(f,y),Ze(f,z)},p(D,A){A&2&&lp(y,D[1])},d(D){D&&xe(f)}}}function Bm(v){let f,y,z,D,A,P,o,V,G,se;function K(le,ze){return le[1]?Rm:Lm}let j=K(v),ae=j(v);return{c(){f=Ae("p"),y=yi(`Total Route Distance:
    `),ae.c(),z=et(),D=Ae("small"),D.innerHTML="<strong>Note</strong> that you might want to zoom in and out the map to toggle the distance-annotations visibility",A=et(),P=Ae("p"),P.textContent=`This is an example of how one could use the plugin's extensibility interfaces to create a distance measurement tool
    out of it.`,o=et(),V=Ae("p"),V.innerHTML=`Here we create a subclass of the <code>MapLibreGlDirections</code> main super class and augment the original
    <code>buildRoutelines</code>
    method to write each route leg&#39;s distance into a respective feature&#39;s <code>properties</code> object. These saved distances
    are then used by an additional &quot;symbol&quot; layer that displays them along the respective route&#39;s lines on the map.`,G=et(),se=Ae("p"),se.textContent=`The total distance comes from the response's specific field and is updated each time there's the "fetchroutesend" or
    the "removewaypoint" event fired.`},m(le,ze){be(le,f,ze),Ze(f,y),ae.m(f,null),be(le,z,ze),be(le,D,ze),be(le,A,ze),be(le,P,ze),be(le,o,ze),be(le,V,ze),be(le,G,ze),be(le,se,ze)},p(le,ze){j===(j=K(le))&&ae?ae.p(le,ze):(ae.d(1),ae=j(le),ae&&(ae.c(),ae.m(f,null)))},d(le){le&&xe(f),ae.d(),le&&xe(z),le&&xe(D),le&&xe(A),le&&xe(P),le&&xe(o),le&&xe(V),le&&xe(G),le&&xe(se)}}}function Fm(v){let f;return{c(){f=Ae("span"),f.textContent=`${v[2].name}`,Qe(f,"slot","title")},m(y,z){be(y,f,z)},p:Ut,d(y){y&&xe(f)}}}function Om(v){let f,y,z,D;return f=new An({props:{$$slots:{title:[Fm],default:[Bm]},$$scope:{ctx:v}}}),{c(){Ci(f.$$.fragment),y=et(),z=Ae("div"),Qe(z,"class","basis-full lg:basis-2/3 shadow-xl")},m(A,P){wi(f,A,P),be(A,y,P),be(A,z,P),v[3](z),D=!0},p(A,[P]){const o={};P&66&&(o.$$scope={dirty:P,ctx:A}),f.$set(o)},i(A){D||(ii(f.$$.fragment,A),D=!0)},o(A){ci(f.$$.fragment,A),D=!1},d(A){Si(f,A),A&&xe(y),A&&xe(z),v[3](null)}}}function Um(v,f,y){let z;wn(v,Sn,G=>y(5,z=G));const D=qi.find(G=>G.path===z);let A,P,o=0;Fn(()=>{const G=new On.Map({container:A,style:Un,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});G.on("load",()=>{P=new Mm(G,Dm),P.on("fetchroutesend",se=>{var K;y(1,o=(K=se.data)==null?void 0:K.routes[0].distance)}),P.on("removewaypoint",()=>{P.waypoints.length<2&&y(1,o=0)}),P.interactive=!0})});function V(G){un[G?"unshift":"push"](()=>{A=G,y(0,A)})}return[A,o,D,V]}class Vm extends Zi{constructor(f){super(),Gi(this,f,Um,Om,Bi,{})}}const $m=Object.freeze(Object.defineProperty({__proto__:null,default:Vm},Symbol.toStringTag,{value:"Module"}));class Nm extends bn{constructor(f,y){super(f,y)}get waypointsFeatures(){return this._waypoints}setWaypointsFeatures(f){this._waypoints=f,this.assignWaypointsCategories();const y=new So("setwaypoints",void 0);this.fire(y),this.draw()}get snappointsFeatures(){return this.snappoints}setSnappointsFeatures(f){this.snappoints=f,this.draw()}get routelinesFeatures(){return this.routelines}setRoutelinesFeatures(f){this.routelines=f,this.draw()}}function jm(v){let f,y,z,D,A,P,o,V,G,se,K,j,ae,le,ze,Ce,We,kt,ft,st,Ye;return{c(){f=Ae("button"),y=yi("Load the saved Route"),D=et(),A=Ae("button"),P=yi("Save the Route"),V=et(),G=Ae("button"),se=yi("Clear"),j=et(),ae=Ae("small"),ae.innerHTML=`This example uses the <code>localStorage</code> to save routes, but you are obviously not restricted to it. There might
    instead be a file or a serverside-database or whatever else`,le=et(),ze=Ae("p"),ze.textContent=`If you want to save/load the route, the obvious way to do so would be to save the list of waypoints whenever the
    route is updated and to make a new routing-request with the saved waypoints' coordinates whenever you need to load
    it.`,Ce=et(),We=Ae("p"),We.textContent=`But what if the underlying roads networks changes for some reason? You'll get a different route for the same set of
    waypoints. Moreover, if there are some severe construction works going on, you run into a risk of not getting any
    routes whatsoever.`,kt=et(),ft=Ae("p"),ft.textContent=`Sometimes it's actually a good idea to save the route as a list of GeoJSON Features and be able to load these saved
    features whenever there's a need. This example shows how that could be done.`,f.disabled=z=!v[1]||v[2],A.disabled=o=!v[1],G.disabled=K=!v[1]},m(Te,rt){be(Te,f,rt),Ze(f,y),be(Te,D,rt),be(Te,A,rt),Ze(A,P),be(Te,V,rt),be(Te,G,rt),Ze(G,se),be(Te,j,rt),be(Te,ae,rt),be(Te,le,rt),be(Te,ze,rt),be(Te,Ce,rt),be(Te,We,rt),be(Te,kt,rt),be(Te,ft,rt),st||(Ye=[ji(f,"click",v[4]),ji(A,"click",v[5]),ji(G,"click",v[6])],st=!0)},p(Te,rt){rt&6&&z!==(z=!Te[1]||Te[2])&&(f.disabled=z),rt&2&&o!==(o=!Te[1])&&(A.disabled=o),rt&2&&K!==(K=!Te[1])&&(G.disabled=K)},d(Te){Te&&xe(f),Te&&xe(D),Te&&xe(A),Te&&xe(V),Te&&xe(G),Te&&xe(j),Te&&xe(ae),Te&&xe(le),Te&&xe(ze),Te&&xe(Ce),Te&&xe(We),Te&&xe(kt),Te&&xe(ft),st=!1,sr(Ye)}}}function qm(v){let f;return{c(){f=Ae("span"),f.textContent=`${v[3].name}`,Qe(f,"slot","title")},m(y,z){be(y,f,z)},p:Ut,d(y){y&&xe(f)}}}function Gm(v){let f,y,z,D;return f=new An({props:{$$slots:{title:[qm],default:[jm]},$$scope:{ctx:v}}}),{c(){Ci(f.$$.fragment),y=et(),z=Ae("div"),Qe(z,"class","basis-full lg:basis-2/3 shadow-xl")},m(A,P){wi(f,A,P),be(A,y,P),be(A,z,P),v[7](z),D=!0},p(A,[P]){const o={};P&518&&(o.$$scope={dirty:P,ctx:A}),f.$set(o)},i(A){D||(ii(f.$$.fragment,A),D=!0)},o(A){ci(f.$$.fragment,A),D=!1},d(A){Si(f,A),A&&xe(y),A&&xe(z),v[7](null)}}}function Yh(){return localStorage.getItem("saved-waypoints-features")&&localStorage.getItem("saved-snappoints-features")&&localStorage.getItem("saved-routelines-features")}function Zm(v,f,y){let z;wn(v,Sn,j=>y(8,z=j));const D=qi.find(j=>j.path===z);let A,P;Fn(()=>{const j=new On.Map({container:A,style:Un,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});j.on("load",()=>{y(1,P=new Nm(j)),y(1,P.interactive=!0,P)})});let o=!Yh();function V(){P.setWaypointsFeatures(JSON.parse(localStorage.getItem("saved-waypoints-features"))),P.setSnappointsFeatures(JSON.parse(localStorage.getItem("saved-snappoints-features"))),P.setRoutelinesFeatures(JSON.parse(localStorage.getItem("saved-routelines-features")))}function G(){localStorage.setItem("saved-waypoints-features",JSON.stringify(P.waypointsFeatures)),localStorage.setItem("saved-snappoints-features",JSON.stringify(P.snappointsFeatures)),localStorage.setItem("saved-routelines-features",JSON.stringify(P.routelinesFeatures)),y(2,o=!Yh())}const se=()=>P.clear();function K(j){un[j?"unshift":"push"](()=>{A=j,y(0,A)})}return[A,P,o,D,V,G,se,K]}class Wm extends Zi{constructor(f){super(),Gi(this,f,Zm,Gm,Bi,{})}}const Hm=Object.freeze(Object.defineProperty({__proto__:null,default:Wm},Symbol.toStringTag,{value:"Module"}));function Xm(v){let f,y,z,D,A,P,o,V,G,se,K,j,ae,le,ze,Ce,We,kt,ft,st,Ye,Te,rt,At,Vt,Vn,zi,hn,In,Wi,Tn;return{c(){f=Ae("small"),f.innerHTML="<strong>Note</strong> that interactivity is disabled for this example",y=et(),z=Ae("div"),D=Ae("p"),D.textContent="Set waypoints to a predefined set",A=et(),P=Ae("button"),o=yi("Set Waypoints"),G=et(),se=Ae("div"),K=Ae("p"),K.textContent="Add a random waypoint at some random index",j=et(),ae=Ae("button"),le=yi("Add Waypoint"),Ce=et(),We=Ae("div"),kt=Ae("p"),kt.textContent="Delete a random waypoint",ft=et(),st=Ae("button"),Ye=yi("Delete Waypoint"),rt=et(),At=Ae("div"),Vt=Ae("p"),Vt.textContent="Clear the map from all the stuff added by the plugin",Vn=et(),zi=Ae("button"),hn=yi("Clear"),P.disabled=V=!v[1],Qe(P,"class","self-center"),Qe(z,"class","flex flex-col gap-2"),ae.disabled=ze=!v[1],Qe(ae,"class","self-center"),Qe(se,"class","flex flex-col gap-2"),st.disabled=Te=!v[1],Qe(st,"class","self-center"),Qe(We,"class","flex flex-col gap-2"),zi.disabled=In=!v[1],Qe(zi,"class","self-center"),Qe(At,"class","flex flex-col gap-2")},m(Ve,Ht){be(Ve,f,Ht),be(Ve,y,Ht),be(Ve,z,Ht),Ze(z,D),Ze(z,A),Ze(z,P),Ze(P,o),be(Ve,G,Ht),be(Ve,se,Ht),Ze(se,K),Ze(se,j),Ze(se,ae),Ze(ae,le),be(Ve,Ce,Ht),be(Ve,We,Ht),Ze(We,kt),Ze(We,ft),Ze(We,st),Ze(st,Ye),be(Ve,rt,Ht),be(Ve,At,Ht),Ze(At,Vt),Ze(At,Vn),Ze(At,zi),Ze(zi,hn),Wi||(Tn=[ji(P,"click",v[3]),ji(ae,"click",v[4]),ji(st,"click",v[5]),ji(zi,"click",v[6])],Wi=!0)},p(Ve,Ht){Ht&2&&V!==(V=!Ve[1])&&(P.disabled=V),Ht&2&&ze!==(ze=!Ve[1])&&(ae.disabled=ze),Ht&2&&Te!==(Te=!Ve[1])&&(st.disabled=Te),Ht&2&&In!==(In=!Ve[1])&&(zi.disabled=In)},d(Ve){Ve&&xe(f),Ve&&xe(y),Ve&&xe(z),Ve&&xe(G),Ve&&xe(se),Ve&&xe(Ce),Ve&&xe(We),Ve&&xe(rt),Ve&&xe(At),Wi=!1,sr(Tn)}}}function Ym(v){let f;return{c(){f=Ae("span"),f.textContent=`${v[2].name}`,Qe(f,"slot","title")},m(y,z){be(y,f,z)},p:Ut,d(y){y&&xe(f)}}}function Km(v){let f,y,z,D;return f=new An({props:{$$slots:{title:[Ym],default:[Xm]},$$scope:{ctx:v}}}),{c(){Ci(f.$$.fragment),y=et(),z=Ae("div"),Qe(z,"class","basis-full lg:basis-2/3 shadow-xl")},m(A,P){wi(f,A,P),be(A,y,P),be(A,z,P),v[7](z),D=!0},p(A,[P]){const o={};P&1026&&(o.$$scope={dirty:P,ctx:A}),f.$set(o)},i(A){D||(ii(f.$$.fragment,A),D=!0)},o(A){ci(f.$$.fragment,A),D=!1},d(A){Si(f,A),A&&xe(y),A&&xe(z),v[7](null)}}}function Jm(v,f,y){let z;wn(v,Sn,ae=>y(9,z=ae));const D=qi.find(ae=>ae.path===z);let A,P,o;Fn(()=>{const ae=new On.Map({container:A,style:Un,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});ae.on("load",()=>{P=ae,y(1,o=new bn(P,{requestOptions:{alternatives:"true"}}))})});function V(){o==null||o.setWaypoints([[-74.21349031181673,40.704951524836275],[-74.19666749687558,40.738517300855904],[-74.16611177177786,40.76634583723629],[-74.07169801445302,40.719004374548206],[-73.99170381279369,40.725509319065594],[-73.98071748466812,40.762445342516145]])}function G(){const ae=P==null?void 0:P.getBounds(),le=P==null?void 0:P.getCenter();if(ae&&le){const ze=ae.getEast()-ae.getWest(),Ce=ae.getSouth()-ae.getNorth();o==null||o.addWaypoint([le.lng-ze/2+ze*Math.random(),le.lat-Ce/2+Ce*Math.random()],(o==null?void 0:o.waypoints.length)*Math.random()|0)}}function se(){o==null||o.removeWaypoint((o==null?void 0:o.waypoints.length)*Math.random()|0)}function K(){o==null||o.clear()}function j(ae){un[ae?"unshift":"push"](()=>{A=ae,y(0,A)})}return[A,o,D,V,G,se,K,j]}class Qm extends Zi{constructor(f){super(),Gi(this,f,Jm,Km,Bi,{})}}const eg=Object.freeze(Object.defineProperty({__proto__:null,default:Qm},Symbol.toStringTag,{value:"Module"}));function tg(v){let f,y,z,D,A,P,o,V,G,se,K,j,ae,le,ze,Ce,We,kt,ft,st,Ye;return{c(){f=Ae("label"),y=Ae("span"),y.innerHTML="<strong>Congestions</strong>",z=et(),D=Ae("select"),A=Ae("option"),A.textContent="Stringy",P=Ae("option"),P.textContent="Numeric",V=et(),G=Ae("p"),G.textContent="This example makes POST requests to the official Mapbox Directions API with the following options:",se=et(),K=Ae("ul"),j=Ae("li"),ae=Ae("strong"),le=yi("annotations="),ze=yi(v[1]),Ce=et(),We=Ae("li"),We.textContent="overview=full",kt=et(),ft=Ae("li"),ft.textContent="alternatives=true",A.__value="congestion",A.value=A.__value,P.__value="congestion_numeric",P.value=P.__value,D.disabled=o=!v[0],v[1]===void 0&&ka(()=>v[5].call(D)),Qe(f,"class","flex flex-col gap-2")},m(Te,rt){be(Te,f,rt),Ze(f,y),Ze(f,z),Ze(f,D),Ze(D,A),Ze(D,P),Bl(D,v[1]),be(Te,V,rt),be(Te,G,rt),be(Te,se,rt),be(Te,K,rt),Ze(K,j),Ze(j,ae),Ze(ae,le),Ze(ae,ze),Ze(K,Ce),Ze(K,We),Ze(K,kt),Ze(K,ft),st||(Ye=ji(D,"change",v[5]),st=!0)},p(Te,rt){rt&1&&o!==(o=!Te[0])&&(D.disabled=o),rt&2&&Bl(D,Te[1]),rt&2&&lp(ze,Te[1])},d(Te){Te&&xe(f),Te&&xe(V),Te&&xe(G),Te&&xe(se),Te&&xe(K),st=!1,Ye()}}}function ig(v){let f;return{c(){f=Ae("span"),f.textContent=`${v[3].name}`,Qe(f,"slot","title")},m(y,z){be(y,f,z)},p:Ut,d(y){y&&xe(f)}}}function ng(v){let f,y,z,D;return f=new An({props:{$$slots:{title:[ig],default:[tg]},$$scope:{ctx:v}}}),{c(){Ci(f.$$.fragment),y=et(),z=Ae("div"),Qe(z,"class","basis-full lg:basis-2/3 shadow-xl")},m(A,P){wi(f,A,P),be(A,y,P),be(A,z,P),v[6](z),D=!0},p(A,[P]){const o={};P&259&&(o.$$scope={dirty:P,ctx:A}),f.$set(o)},i(A){D||(ii(f.$$.fragment,A),D=!0)},o(A){ci(f.$$.fragment,A),D=!1},d(A){Si(f,A),A&&xe(y),A&&xe(z),v[6](null)}}}function rg(v,f,y){let z;wn(v,Sn,K=>y(7,z=K));const D=qi.find(K=>K.path===z);let A,P,o,V="congestion";Fn(()=>{const K=new On.Map({container:A,style:Un,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='//docs.mapbox.com/help/getting-started/directions/' target='_blank'>&copy; Mapbox Directions</a>"});K.on("load",()=>{y(4,P=K)})});function G(){V=cp(this),y(1,V)}function se(K){un[K?"unshift":"push"](()=>{A=K,y(2,A)})}return v.$$.update=()=>{v.$$.dirty&19&&P&&(o&&o.destroy(),y(0,o=new bn(P,{api:"https://api.mapbox.com/directions/v5",profile:"mapbox/driving-traffic",makePostRequest:!0,requestOptions:{access_token:"pk.eyJ1Ijoic21lbGx5c2hvdmVsIiwiYSI6ImNsMW80eXQ4aTEwN3czcG8zMXM2NzJ2ODIifQ.oWHUIUiEj2SS4_hue3qv2g",alternatives:"true",annotations:V,overview:"full"}})),y(0,o.interactive=!0,o))},[o,V,A,D,P,G,se]}class sg extends Zi{constructor(f){super(),Gi(this,f,rg,ng,Bi,{})}}const og=Object.freeze(Object.defineProperty({__proto__:null,default:sg},Symbol.toStringTag,{value:"Module"}));function ag(v){let f,y,z;return{c(){f=Ae("p"),f.textContent=`In this example the default layers used by the plugin are augmented with an additional "symbol" layer which is only
    rendered for the ORIGIN and DESTINATION waypoints.`,y=et(),z=Ae("p"),z.innerHTML=`<strong>Note</strong> how you don&#39;t need to re-define all the layers from scratch thanks to the exported
    <code>layersFactory</code> function that returns all the default layers allowing for their augmentation and modification`},m(D,A){be(D,f,A),be(D,y,A),be(D,z,A)},p:Ut,d(D){D&&xe(f),D&&xe(y),D&&xe(z)}}}function lg(v){let f;return{c(){f=Ae("span"),f.textContent=`${v[1].name}`,Qe(f,"slot","title")},m(y,z){be(y,f,z)},p:Ut,d(y){y&&xe(f)}}}function cg(v){let f,y,z,D;return f=new An({props:{$$slots:{title:[lg],default:[ag]},$$scope:{ctx:v}}}),{c(){Ci(f.$$.fragment),y=et(),z=Ae("div"),Qe(z,"class","basis-full lg:basis-2/3 shadow-xl")},m(A,P){wi(f,A,P),be(A,y,P),be(A,z,P),v[2](z),D=!0},p(A,[P]){const o={};P&32&&(o.$$scope={dirty:P,ctx:A}),f.$set(o)},i(A){D||(ii(f.$$.fragment,A),D=!0)},o(A){ci(f.$$.fragment,A),D=!1},d(A){Si(f,A),A&&xe(y),A&&xe(z),v[2](null)}}}function ug(v,f,y){let z;wn(v,Sn,V=>y(4,z=V));const D=qi.find(V=>V.path===z);let A,P;Fn(()=>{const V=new On.Map({container:A,style:Un,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>",fadeDuration:0}),G=Vl();G.push({id:"maplibre-gl-directions-waypoint-label",type:"symbol",source:"maplibre-gl-directions",layout:{"text-field":["case",["==",["get","category"],"ORIGIN"],"A",["==",["get","category"],"DESTINATION"],"B",""]},paint:{"text-color":"#ffffff","text-opacity":.7},filter:["all",["==",["geometry-type"],"Point"],["==",["get","type"],"WAYPOINT"],["in",["get","category"],["literal",["ORIGIN","DESTINATION"]]]]}),V.on("load",()=>{P=new bn(V,{requestOptions:{alternatives:"true"},layers:G}),P.interactive=!0})});function o(V){un[V?"unshift":"push"](()=>{A=V,y(0,A)})}return[A,D,o]}class hg extends Zi{constructor(f){super(),Gi(this,f,ug,cg,Bi,{})}}const pg=Object.freeze(Object.defineProperty({__proto__:null,default:hg},Symbol.toStringTag,{value:"Module"})),dg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAKRJREFUOE+lkkEOAVEQRF9tJBwCZxhHEFYOIXMWNuIynIOFI7B3hpKeDBFh0ub/ddfrX10lCp8K9aQAtsexSNLtc2EWsANqYC7p8g7JAobAEZgBS0mnJyQFiGHbXyFpwC+IbE+BDTBIJhI/WQH3sBSACbDtCahKLCwkndMA2yPg0CbRiJtuZHy34oixAl7ifwB7YF1SpDh0VPnaq8pdNlM36AI8AK1AOkjqIJazAAAAAElFTkSuQmCC";function fg(v){let f,y,z,D,A;return{c(){f=Ae("p"),f.textContent="Another example that demonstrates the ease of extending the original styles provided by the plugin.",y=et(),z=Ae("p"),z.textContent='This time a "symbol" layer is added that shows the direction the selected route goes in.',D=et(),A=Ae("small"),A.innerHTML=`<strong>Note</strong> that you have to manually load and add the images you intend to use for the custom layers you
    add`},m(P,o){be(P,f,o),be(P,y,o),be(P,z,o),be(P,D,o),be(P,A,o)},p:Ut,d(P){P&&xe(f),P&&xe(y),P&&xe(z),P&&xe(D),P&&xe(A)}}}function mg(v){let f;return{c(){f=Ae("span"),f.textContent=`${v[1].name}`,Qe(f,"slot","title")},m(y,z){be(y,f,z)},p:Ut,d(y){y&&xe(f)}}}function gg(v){let f,y,z,D;return f=new An({props:{$$slots:{title:[mg],default:[fg]},$$scope:{ctx:v}}}),{c(){Ci(f.$$.fragment),y=et(),z=Ae("div"),Qe(z,"class","basis-full lg:basis-2/3 shadow-xl")},m(A,P){wi(f,A,P),be(A,y,P),be(A,z,P),v[2](z),D=!0},p(A,[P]){const o={};P&32&&(o.$$scope={dirty:P,ctx:A}),f.$set(o)},i(A){D||(ii(f.$$.fragment,A),D=!0)},o(A){ci(f.$$.fragment,A),D=!1},d(A){Si(f,A),A&&xe(y),A&&xe(z),v[2](null)}}}function _g(v,f,y){let z;wn(v,Sn,V=>y(4,z=V));const D=qi.find(V=>V.path===z);let A,P;Fn(()=>{const V=new On.Map({container:A,style:Un,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});V.loadImage(dg,(se,K)=>{!se&&K&&V.addImage("direction-arrow",K)});const G=Vl();G.push({id:"maplibre-gl-directions-routeline-direction-arrow",type:"symbol",source:"maplibre-gl-directions",layout:{"symbol-placement":"line-center","icon-image":"direction-arrow","icon-size":["interpolate",["exponential",1.5],["zoom"],12,.85,18,1.4]},paint:{"icon-opacity":.5},filter:["==",["get","route"],"SELECTED"]}),V.on("load",()=>{P=new bn(V,{requestOptions:{alternatives:"true"},layers:G}),P.interactive=!0})});function o(V){un[V?"unshift":"push"](()=>{A=V,y(0,A)})}return[A,D,o]}class yg extends Zi{constructor(f){super(),Gi(this,f,_g,gg,Bi,{})}}const xg=Object.freeze(Object.defineProperty({__proto__:null,default:yg},Symbol.toStringTag,{value:"Module"}));function vg(v){let f,y,z,D,A,P,o,V,G,se,K,j,ae;return{c(){f=Ae("label"),y=Ae("input"),D=et(),A=Ae("strong"),A.textContent="Simulate a Touch-Enabled Device",P=et(),o=Ae("p"),o.textContent=`Sometimes it's pretty hard to aim exactly at the selected route line to add a waypoint by dragging it when using the
    plugin on a touch device.`,V=et(),G=Ae("p"),G.innerHTML=`The example shows how one could use the <code>layersFactory</code>&#39;s input parameters to handle that case by
    increasing the points by 1.5 and the lines by 2 times when the map is used on a touch-enabled device.`,se=et(),K=Ae("small"),K.innerHTML=`<strong>Note</strong> that you can either load the page on a touch-enabled device or toggle the checkbox above: both
    options apply the same effect`,Qe(y,"type","checkbox"),y.disabled=z=!v[0],Qe(f,"class","flex items-center gap-3")},m(le,ze){be(le,f,ze),Ze(f,y),y.checked=v[1],Ze(f,D),Ze(f,A),be(le,P,ze),be(le,o,ze),be(le,V,ze),be(le,G,ze),be(le,se,ze),be(le,K,ze),j||(ae=ji(y,"change",v[5]),j=!0)},p(le,ze){ze&1&&z!==(z=!le[0])&&(y.disabled=z),ze&2&&(y.checked=le[1])},d(le){le&&xe(f),le&&xe(P),le&&xe(o),le&&xe(V),le&&xe(G),le&&xe(se),le&&xe(K),j=!1,ae()}}}function bg(v){let f;return{c(){f=Ae("span"),f.textContent=`${v[3].name}`,Qe(f,"slot","title")},m(y,z){be(y,f,z)},p:Ut,d(y){y&&xe(f)}}}function wg(v){let f,y,z,D;return f=new An({props:{$$slots:{title:[bg],default:[vg]},$$scope:{ctx:v}}}),{c(){Ci(f.$$.fragment),y=et(),z=Ae("div"),Qe(z,"class","basis-full lg:basis-2/3 shadow-xl")},m(A,P){wi(f,A,P),be(A,y,P),be(A,z,P),v[6](z),D=!0},p(A,[P]){const o={};P&259&&(o.$$scope={dirty:P,ctx:A}),f.$set(o)},i(A){D||(ii(f.$$.fragment,A),D=!0)},o(A){ci(f.$$.fragment,A),D=!1},d(A){Si(f,A),A&&xe(y),A&&xe(z),v[6](null)}}}function Sg(v,f,y){let z;wn(v,Sn,K=>y(7,z=K));const D=qi.find(K=>K.path===z);let A,P,o,V="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;Fn(()=>{const K=new On.Map({container:A,style:Un,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});K.on("load",()=>{y(4,P=K)})});function G(){V=this.checked,y(1,V)}function se(K){un[K?"unshift":"push"](()=>{A=K,y(2,A)})}return v.$$.update=()=>{if(v.$$.dirty&19&&P){o&&o.destroy();const K=Vl(V?1.5:1,V?2:1);y(0,o=new bn(P,{requestOptions:{alternatives:"true"},layers:K})),y(0,o.interactive=!0,o)}},[o,V,A,D,P,G,se]}class Ag extends Zi{constructor(f){super(),Gi(this,f,Sg,wg,Bi,{})}}const Ig=Object.freeze(Object.defineProperty({__proto__:null,default:Ag},Symbol.toStringTag,{value:"Module"}));function Kh(v,f,y){const z=v.slice();return z[7]=f[y],z}function Jh(v){let f,y=v[7]+"";return{c(){f=Ae("li")},m(z,D){be(z,f,D),f.innerHTML=y},p(z,D){D&2&&y!==(y=z[7]+"")&&(f.innerHTML=y)},d(z){z&&xe(f)}}}function Qh(v){let f,y,z;return{c(){f=Ae("button"),f.textContent="Clear"},m(D,A){be(D,f,A),y||(z=ji(f,"click",v[3]),y=!0)},p:Ut,d(D){D&&xe(f),y=!1,z()}}}function Tg(v){let f,y,z,D,A,P=v[1],o=[];for(let G=0;G<P.length;G+=1)o[G]=Jh(Kh(v,P,G));let V=v[1].length&&Qh(v);return{c(){f=Ae("p"),f.textContent=`This example listens for all the available events and logs them below. Interact with the map to see the emitted
    events.`,y=et(),z=Ae("ol");for(let G=0;G<o.length;G+=1)o[G].c();D=et(),V&&V.c(),A=Ol()},m(G,se){be(G,f,se),be(G,y,se),be(G,z,se);for(let K=0;K<o.length;K+=1)o[K].m(z,null);be(G,D,se),V&&V.m(G,se),be(G,A,se)},p(G,se){if(se&2){P=G[1];let K;for(K=0;K<P.length;K+=1){const j=Kh(G,P,K);o[K]?o[K].p(j,se):(o[K]=Jh(j),o[K].c(),o[K].m(z,null))}for(;K<o.length;K+=1)o[K].d(1);o.length=P.length}G[1].length?V?V.p(G,se):(V=Qh(G),V.c(),V.m(A.parentNode,A)):V&&(V.d(1),V=null)},d(G){G&&xe(f),G&&xe(y),G&&xe(z),op(o,G),G&&xe(D),V&&V.d(G),G&&xe(A)}}}function Eg(v){let f;return{c(){f=Ae("span"),f.textContent=`${v[2].name}`,Qe(f,"slot","title")},m(y,z){be(y,f,z)},p:Ut,d(y){y&&xe(f)}}}function Cg(v){let f,y,z,D;return f=new An({props:{$$slots:{title:[Eg],default:[Tg]},$$scope:{ctx:v}}}),{c(){Ci(f.$$.fragment),y=et(),z=Ae("div"),Qe(z,"class","basis-full lg:basis-2/3 shadow-xl")},m(A,P){wi(f,A,P),be(A,y,P),be(A,z,P),v[4](z),D=!0},p(A,[P]){const o={};P&1026&&(o.$$scope={dirty:P,ctx:A}),f.$set(o)},i(A){D||(ii(f.$$.fragment,A),D=!0)},o(A){ci(f.$$.fragment,A),D=!1},d(A){Si(f,A),A&&xe(y),A&&xe(z),v[4](null)}}}function zg(v,f,y){let z;wn(v,Sn,se=>y(6,z=se));const D=qi.find(se=>se.path===z);let A,P,o=[];Fn(()=>{const se=new On.Map({container:A,style:Un,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});se.on("load",()=>{P=new bn(se,{requestOptions:{alternatives:"true"}}),P.interactive=!0,P.on("addwaypoint",K=>{var j,ae;o.push(`<strong>${K.type}</strong>: waypoint added at index <strong>${(j=K.data)==null?void 0:j.index}</strong>. Original event - <strong>${(ae=K.originalEvent)==null?void 0:ae.type}</strong>`),y(1,o)}),P.on("removewaypoint",K=>{var j,ae;o.push(`<strong>${K.type}</strong>: waypoint removed at index <strong>${(j=K.data)==null?void 0:j.index}</strong>. Original event - <strong>${(ae=K.originalEvent)==null?void 0:ae.type}</strong>`),y(1,o)}),P.on("movewaypoint",K=>{var j,ae,le,ze;o.push(`<strong>${K.type}</strong>: waypoint at index <strong>${(j=K.data)==null?void 0:j.index}</strong> moved from coordinates ${(le=(ae=K.data)==null?void 0:ae.initialCoordinates)==null?void 0:le.map(Ce=>Ce.toFixed(5)).join(", ")}. Original event - <strong>${(ze=K.originalEvent)==null?void 0:ze.type}</strong>`),y(1,o)}),P.on("fetchroutesstart",K=>{o.push(`<strong>${K.type}</strong>: routing request started. Original event - <strong>${K.originalEvent.type}</strong>`),y(1,o)}),P.on("fetchroutesend",K=>{var j;o.push(`<strong>${K.type}</strong>: routing request finished with code <strong>${(j=K.data)==null?void 0:j.code}</strong>. Original event - <strong>${K.originalEvent.type}</strong>`),y(1,o)})})});const V=()=>y(1,o=[]);function G(se){un[se?"unshift":"push"](()=>{A=se,y(0,A)})}return[A,o,D,V,G]}class kg extends Zi{constructor(f){super(),Gi(this,f,zg,Cg,Bi,{})}}const Pg=Object.freeze(Object.defineProperty({__proto__:null,default:kg},Symbol.toStringTag,{value:"Module"}));function Mg(v){let f,y,z,D,A,P,o,V,G,se,K,j,ae,le,ze;return{c(){f=Ae("button"),y=yi("Abort Manually"),D=et(),A=Ae("p"),A.innerHTML=`Instead of aborting routing-requests manually, you can set the <code>requestTimeout</code> configuration option to a
    number of ms that a routing-request is allowed to take before getting automatically aborted.`,P=et(),o=Ae("label"),V=Ae("span"),V.innerHTML="<strong>Request Timeout</strong>",G=et(),se=Ae("input"),j=et(),ae=Ae("small"),ae.innerHTML=`<strong>Note</strong> that you may need to manually
    <a href="https://www.browserstack.com/guide/how-to-perform-network-throttling-in-chrome" target="_blank">enable network throttling</a> for the setting above to take effect`,f.disabled=z=!v[0],Qe(se,"type","number"),se.disabled=K=!v[0],Qe(o,"class","flex flex-col gap-2")},m(Ce,We){be(Ce,f,We),Ze(f,y),be(Ce,D,We),be(Ce,A,We),be(Ce,P,We),be(Ce,o,We),Ze(o,V),Ze(o,G),Ze(o,se),Rh(se,v[1]),be(Ce,j,We),be(Ce,ae,We),le||(ze=[ji(f,"click",v[4]),ji(se,"input",v[6])],le=!0)},p(Ce,We){We&1&&z!==(z=!Ce[0])&&(f.disabled=z),We&1&&K!==(K=!Ce[0])&&(se.disabled=K),We&2&&ap(se.value)!==Ce[1]&&Rh(se,Ce[1])},d(Ce){Ce&&xe(f),Ce&&xe(D),Ce&&xe(A),Ce&&xe(P),Ce&&xe(o),Ce&&xe(j),Ce&&xe(ae),le=!1,sr(ze)}}}function Dg(v){let f;return{c(){f=Ae("span"),f.textContent=`${v[3].name}`,Qe(f,"slot","title")},m(y,z){be(y,f,z)},p:Ut,d(y){y&&xe(f)}}}function Lg(v){let f,y,z,D;return f=new An({props:{$$slots:{title:[Dg],default:[Mg]},$$scope:{ctx:v}}}),{c(){Ci(f.$$.fragment),y=et(),z=Ae("div"),Qe(z,"class","basis-full lg:basis-2/3 shadow-xl")},m(A,P){wi(f,A,P),be(A,y,P),be(A,z,P),v[7](z),D=!0},p(A,[P]){const o={};P&515&&(o.$$scope={dirty:P,ctx:A}),f.$set(o)},i(A){D||(ii(f.$$.fragment,A),D=!0)},o(A){ci(f.$$.fragment,A),D=!1},d(A){Si(f,A),A&&xe(y),A&&xe(z),v[7](null)}}}function Rg(v,f,y){let z;wn(v,Sn,j=>y(8,z=j));const D=qi.find(j=>j.path===z);let A,P,o,V=1e3;Fn(()=>{const j=new On.Map({container:A,style:Un,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});j.on("load",()=>{y(5,P=j)})});function G(){var j;(j=o==null?void 0:o.abortController)==null||j.abort()}function se(){V=ap(this.value),y(1,V)}function K(j){un[j?"unshift":"push"](()=>{A=j,y(2,A)})}return v.$$.update=()=>{v.$$.dirty&35&&P&&(o&&o.destroy(),y(0,o=new bn(P,{requestOptions:{alternatives:"true"},requestTimeout:V})),y(0,o.interactive=!0,o))},[o,V,A,D,G,P,se,K]}class Bg extends Zi{constructor(f){super(),Gi(this,f,Rg,Lg,Bi,{})}}const Fg=Object.freeze(Object.defineProperty({__proto__:null,default:Bg},Symbol.toStringTag,{value:"Module"}));function Og(v){let f,y,z,D,A,P,o,V,G,se,K,j,ae;return{c(){f=Ae("label"),y=Ae("span"),y.innerHTML="<strong>Position</strong>",z=et(),D=Ae("select"),A=Ae("option"),A.textContent="Top-Left",P=Ae("option"),P.textContent="Top-Right",o=Ae("option"),o.textContent="Bottom-Left",V=Ae("option"),V.textContent="Bottom-Right",se=et(),K=Ae("p"),K.innerHTML=`The <code>LoadingIndicatorControl</code> adds a simple spinning loader-icon which automatically appears whenever there&#39;s
    an ongoing routing-request.`,A.__value="top-left",A.value=A.__value,P.__value="top-right",P.value=P.__value,o.__value="bottom-left",o.value=o.__value,V.__value="bottom-right",V.value=V.__value,D.disabled=G=!v[0],v[1]===void 0&&ka(()=>v[6].call(D)),Qe(f,"class","flex flex-col gap-2")},m(le,ze){be(le,f,ze),Ze(f,y),Ze(f,z),Ze(f,D),Ze(D,A),Ze(D,P),Ze(D,o),Ze(D,V),Bl(D,v[1]),be(le,se,ze),be(le,K,ze),j||(ae=ji(D,"change",v[6]),j=!0)},p(le,ze){ze&1&&G!==(G=!le[0])&&(D.disabled=G),ze&2&&Bl(D,le[1])},d(le){le&&xe(f),le&&xe(se),le&&xe(K),j=!1,ae()}}}function Ug(v){let f;return{c(){f=Ae("span"),f.textContent=`${v[3].name}`,Qe(f,"slot","title")},m(y,z){be(y,f,z)},p:Ut,d(y){y&&xe(f)}}}function Vg(v){let f,y,z,D;return f=new An({props:{$$slots:{title:[Ug],default:[Og]},$$scope:{ctx:v}}}),{c(){Ci(f.$$.fragment),y=et(),z=Ae("div"),Qe(z,"class","basis-full lg:basis-2/3 shadow-xl")},m(A,P){wi(f,A,P),be(A,y,P),be(A,z,P),v[7](z),D=!0},p(A,[P]){const o={};P&515&&(o.$$scope={dirty:P,ctx:A}),f.$set(o)},i(A){D||(ii(f.$$.fragment,A),D=!0)},o(A){ci(f.$$.fragment,A),D=!1},d(A){Si(f,A),A&&xe(y),A&&xe(z),v[7](null)}}}function $g(v,f,y){let z;wn(v,Sn,j=>y(8,z=j));const D=qi.find(j=>j.path===z);let A,P,o;Fn(()=>{y(4,P=new On.Map({container:A,style:Un,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"})),P.on("load",()=>{y(0,o=new bn(P,{requestOptions:{alternatives:"true"}})),y(0,o.interactive=!0,o)})});let V,G="top-right";function se(){G=cp(this),y(1,G)}function K(j){un[j?"unshift":"push"](()=>{A=j,y(2,A)})}return v.$$.update=()=>{v.$$.dirty&51&&P&&o&&(V&&P.hasControl(V)&&P.removeControl(V),P.addControl(y(5,V=new fm(o,{class:"m-2"})),G))},[o,G,A,D,P,V,se,K]}class Ng extends Zi{constructor(f){super(),Gi(this,f,$g,Vg,Bi,{})}}const jg=Object.freeze(Object.defineProperty({__proto__:null,default:Ng},Symbol.toStringTag,{value:"Module"}));function ep(v,f,y){const z=v.slice();return z[0]=f[y],z}function tp(v){let f,y,z=v[0].name+"",D,A,P,o;return{c(){f=Ae("li"),y=Ae("a"),D=yi(z),A=et(),Qe(y,"href",v[0].path),Qe(y,"class","svelte-1jo4v3w"),Qe(f,"class","svelte-1jo4v3w")},m(V,G){be(V,f,G),Ze(f,y),Ze(y,D),Ze(f,A),P||(o=iu(ou.call(null,y)),P=!0)},p:Ut,d(V){V&&xe(f),P=!1,o()}}}function qg(v){let f,y=qi.sort(ip),z=[];for(let D=0;D<y.length;D+=1)z[D]=tp(ep(v,y,D));return{c(){f=Ae("ul");for(let D=0;D<z.length;D+=1)z[D].c();Qe(f,"class","svelte-1jo4v3w")},m(D,A){be(D,f,A);for(let P=0;P<z.length;P+=1)z[P].m(f,null)},p(D,A){if(A&0){y=qi.sort(ip);let P;for(P=0;P<y.length;P+=1){const o=ep(D,y,P);z[P]?z[P].p(o,A):(z[P]=tp(o),z[P].c(),z[P].m(f,null))}for(;P<z.length;P+=1)z[P].d(1);z.length=y.length}},d(D){D&&xe(f),op(z,D)}}}function Gg(v){let f;return{c(){f=Ae("span"),f.textContent="Examples",Qe(f,"slot","title"),Qe(f,"class","svelte-1jo4v3w")},m(y,z){be(y,f,z)},p:Ut,d(y){y&&xe(f)}}}function Zg(v){let f,y,z,D;return f=new An({props:{noHeader:!0,$$slots:{title:[Gg],default:[qg]},$$scope:{ctx:v}}}),{c(){Ci(f.$$.fragment),y=et(),z=Ae("div"),z.innerHTML=`<div class="p-5 lg:p-10 h-full flex flex-col gap-5 lg:gap-10 justify-start lg:justify-center items-center flex-col bg-inherit overflow-x-hidden overflow-y-auto svelte-1jo4v3w"><h1 class="text-center max-w-3xl svelte-1jo4v3w">Please, choose an example at the sidebar on the left</h1> 

    <span class="text-slate-500 svelte-1jo4v3w">or navigate to</span> 

    <div class="flex flex-col gap-2.5 lg:gap-5 justify-center items-center svelte-1jo4v3w"><a href="https://github.com/maplibre/maplibre-gl-directions" target="_blank" class="svelte-1jo4v3w">GitHub</a> 
      <a href="/maplibre-gl-directions//api" target="_blank" class="svelte-1jo4v3w">API</a></div></div>`,Qe(z,"class","basis-full lg:basis-2/3 overflow-hidden rounded-3xl shadow-xl svelte-1jo4v3w")},m(A,P){wi(f,A,P),be(A,y,P),be(A,z,P),D=!0},p(A,[P]){const o={};P&8&&(o.$$scope={dirty:P,ctx:A}),f.$set(o)},i(A){D||(ii(f.$$.fragment,A),D=!0)},o(A){ci(f.$$.fragment,A),D=!1},d(A){Si(f,A),A&&xe(y),A&&xe(z)}}}const ip=(v,f)=>v.index-f.index;class Wg extends Zi{constructor(f){super(),Gi(this,f,null,Zg,Bi,{})}}const qi=Object.entries(Object.assign({"./examples/1 User Interaction.svelte":vm,"./examples/10 Restyling.svelte":Pm,"./examples/11 Distance Measurement.svelte":$m,"./examples/12 Load and Save.svelte":Hm,"./examples/2 Programmatical Control.svelte":eg,"./examples/3 Mapbox Directions API and Congestions.svelte":og,"./examples/4 Origin and Destination.svelte":pg,"./examples/5 Show Routes' Directions.svelte":xg,"./examples/6 Touch-Friendly Features.svelte":Ig,"./examples/7 Events.svelte":Pg,"./examples/8 Aborting Requests.svelte":Fg,"./examples/9 Loading Indicator Control.svelte":jg})).map(([v,f])=>{const y=v.match(/\/(\d+)\s([^/]+)\./),z=parseInt(y[1]),D=y[2];return{path:"/examples/"+D.toLowerCase().replaceAll(/\s/g,"-"),index:z,name:D,component:f,sourceUrl:`https://github.com/maplibre/maplibre-gl-directions/tree/main/demo/src/${v}`}}),cu={};qi.forEach(v=>{cu[v.path]=v.component.default});cu["*"]=Wg;function Hg(v){let f,y,z;return y=new Rf({props:{routes:cu}}),{c(){f=Ae("main"),Ci(y.$$.fragment),Qe(f,"class","p-5 lg:p-10 flex flex-col lg:flex-row landscape:flex-row w-full gap-5 lg:gap-10")},m(D,A){be(D,f,A),wi(y,f,null),z=!0},p:Ut,i(D){z||(ii(y.$$.fragment,D),z=!0)},o(D){ci(y.$$.fragment,D),z=!1},d(D){D&&xe(f),Si(y)}}}class Xg extends Zi{constructor(f){super(),Gi(this,f,null,Hg,Bi,{})}}new Xg({target:document.getElementById("app")});
