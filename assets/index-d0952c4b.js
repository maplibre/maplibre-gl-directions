var q_=Object.defineProperty;var G_=(b,g,_)=>g in b?q_(b,g,{enumerable:!0,configurable:!0,writable:!0,value:_}):b[g]=_;var ap=(b,g,_)=>(G_(b,typeof g!="symbol"?g+"":g,_),_);(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const R of document.querySelectorAll('link[rel="modulepreload"]'))C(R);new MutationObserver(R=>{for(const M of R)if(M.type==="childList")for(const L of M.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&C(L)}).observe(document,{childList:!0,subtree:!0});function _(R){const M={};return R.integrity&&(M.integrity=R.integrity),R.referrerPolicy&&(M.referrerPolicy=R.referrerPolicy),R.crossOrigin==="use-credentials"?M.credentials="include":R.crossOrigin==="anonymous"?M.credentials="omit":M.credentials="same-origin",M}function C(R){if(R.ep)return;R.ep=!0;const M=_(R);fetch(R.href,M)}})();function Di(){}function rm(b,g){for(const _ in g)b[_]=g[_];return b}function Qm(b){return b()}function _m(){return Object.create(null)}function bo(b){b.forEach(Qm)}function $d(b){return typeof b=="function"}function Er(b,g){return b!=b?g==g:b!==g||b&&typeof b=="object"||typeof b=="function"}function Z_(b){return Object.keys(b).length===0}function eg(b,...g){if(b==null){for(const C of g)C(void 0);return Di}const _=b.subscribe(...g);return _.unsubscribe?()=>_.unsubscribe():_}function ks(b,g,_){b.$$.on_destroy.push(eg(g,_))}function ym(b,g,_,C){if(b){const R=tg(b,g,_,C);return b[0](R)}}function tg(b,g,_,C){return b[1]&&C?rm(_.ctx.slice(),b[1](C(g))):_.ctx}function vm(b,g,_,C){if(b[2]&&C){const R=b[2](C(_));if(g.dirty===void 0)return R;if(typeof R=="object"){const M=[],L=Math.max(g.dirty.length,R.length);for(let a=0;a<L;a+=1)M[a]=g.dirty[a]|R[a];return M}return g.dirty|R}return g.dirty}function xm(b,g,_,C,R,M){if(R){const L=tg(g,_,C,M);b.p(L,R)}}function bm(b){if(b.ctx.length>32){const g=[],_=b.ctx.length/32;for(let C=0;C<_;C++)g[C]=-1;return g}return-1}function Vd(b){return b&&$d(b.destroy)?b.destroy:Di}function Le(b,g){b.appendChild(g)}function Se(b,g,_){b.insertBefore(g,_||null)}function Te(b){b.parentNode&&b.parentNode.removeChild(b)}function sm(b,g){for(let _=0;_<b.length;_+=1)b[_]&&b[_].d(g)}function we(b){return document.createElement(b)}function dn(b){return document.createTextNode(b)}function it(){return dn(" ")}function qd(){return dn("")}function Bi(b,g,_,C){return b.addEventListener(g,_,C),()=>b.removeEventListener(g,_,C)}function Ye(b,g,_){_==null?b.removeAttribute(g):b.getAttribute(g)!==_&&b.setAttribute(g,_)}function kn(b){return b===""?null:+b}function j_(b){return Array.from(b.childNodes)}function om(b,g){g=""+g,b.data!==g&&(b.data=g)}function Wi(b,g){b.value=g??""}function wm(b,g,_,C){_==null?b.style.removeProperty(g):b.style.setProperty(g,_,C?"important":"")}function Dd(b,g,_){for(let C=0;C<b.options.length;C+=1){const R=b.options[C];if(R.__value===g){R.selected=!0;return}}(!_||g!==void 0)&&(b.selectedIndex=-1)}function ig(b){const g=b.querySelector(":checked");return g&&g.__value}function Tm(b,g,_){b.classList.toggle(g,!!_)}function W_(b,g,{bubbles:_=!1,cancelable:C=!1}={}){return new CustomEvent(b,{detail:g,bubbles:_,cancelable:C})}function Ld(b,g){return new b(g)}let up;function lp(b){up=b}function Gd(){if(!up)throw new Error("Function called outside component initialization");return up}function $s(b){Gd().$$.on_mount.push(b)}function H_(b){Gd().$$.after_update.push(b)}function X_(b){Gd().$$.on_destroy.push(b)}function K_(){const b=Gd();return(g,_,{cancelable:C=!1}={})=>{const R=b.$$.callbacks[g];if(R){const M=W_(g,_,{cancelable:C});return R.slice().forEach(L=>{L.call(b,M)}),!M.defaultPrevented}return!0}}function Sm(b,g){const _=b.$$.callbacks[g.type];_&&_.slice().forEach(C=>C.call(this,g))}const Wu=[],_s=[];let Ku=[];const Em=[],ng=Promise.resolve();let em=!1;function rg(){em||(em=!0,ng.then(sg))}function Y_(){return rg(),ng}function hp(b){Ku.push(b)}const Yf=new Set;let Gu=0;function sg(){if(Gu!==0)return;const b=up;do{try{for(;Gu<Wu.length;){const g=Wu[Gu];Gu++,lp(g),J_(g.$$)}}catch(g){throw Wu.length=0,Gu=0,g}for(lp(null),Wu.length=0,Gu=0;_s.length;)_s.pop()();for(let g=0;g<Ku.length;g+=1){const _=Ku[g];Yf.has(_)||(Yf.add(_),_())}Ku.length=0}while(Wu.length);for(;Em.length;)Em.pop()();em=!1,Yf.clear(),lp(b)}function J_(b){if(b.fragment!==null){b.update(),bo(b.before_update);const g=b.dirty;b.dirty=[-1],b.fragment&&b.fragment.p(b.ctx,g),b.after_update.forEach(hp)}}function Q_(b){const g=[],_=[];Ku.forEach(C=>b.indexOf(C)===-1?g.push(C):_.push(C)),_.forEach(C=>C()),Ku=g}const kd=new Set;let Wc;function am(){Wc={r:0,c:[],p:Wc}}function lm(){Wc.r||bo(Wc.c),Wc=Wc.p}function Sn(b,g){b&&b.i&&(kd.delete(b),b.i(g))}function zn(b,g,_,C){if(b&&b.o){if(kd.has(b))return;kd.add(b),Wc.c.push(()=>{kd.delete(b),C&&(_&&b.d(1),C())}),b.o(g)}else C&&C()}function pp(b){return(b==null?void 0:b.length)!==void 0?b:Array.from(b)}function Rd(b,g){const _={},C={},R={$$scope:1};let M=b.length;for(;M--;){const L=b[M],a=g[M];if(a){for(const V in L)V in a||(C[V]=1);for(const V in a)R[V]||(_[V]=a[V],R[V]=1);b[M]=a}else for(const V in L)R[V]=1}for(const L in C)L in _||(_[L]=void 0);return _}function Bd(b){return typeof b=="object"&&b!==null?b:{}}function ur(b){b&&b.c()}function Qn(b,g,_){const{fragment:C,after_update:R}=b.$$;C&&C.m(g,_),hp(()=>{const M=b.$$.on_mount.map(Qm).filter($d);b.$$.on_destroy?b.$$.on_destroy.push(...M):bo(M),b.$$.on_mount=[]}),R.forEach(hp)}function er(b,g){const _=b.$$;_.fragment!==null&&(Q_(_.after_update),bo(_.on_destroy),_.fragment&&_.fragment.d(g),_.on_destroy=_.fragment=null,_.ctx=[])}function ey(b,g){b.$$.dirty[0]===-1&&(Wu.push(b),rg(),b.$$.dirty.fill(0)),b.$$.dirty[g/31|0]|=1<<g%31}function Nr(b,g,_,C,R,M,L,a=[-1]){const V=up;lp(b);const F=b.$$={fragment:null,ctx:[],props:M,update:Di,not_equal:R,bound:_m(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(g.context||(V?V.$$.context:[])),callbacks:_m(),dirty:a,skip_bound:!1,root:g.target||V.$$.root};L&&L(F.root);let ce=!1;if(F.ctx=_?_(b,g.props||{},(ee,ve,..._e)=>{const Ae=_e.length?_e[0]:ve;return F.ctx&&R(F.ctx[ee],F.ctx[ee]=Ae)&&(!F.skip_bound&&F.bound[ee]&&F.bound[ee](Ae),ce&&ey(b,ee)),ve}):[],F.update(),ce=!0,bo(F.before_update),F.fragment=C?C(F.ctx):!1,g.target){if(g.hydrate){const ee=j_(g.target);F.fragment&&F.fragment.l(ee),ee.forEach(Te)}else F.fragment&&F.fragment.c();g.intro&&Sn(b.$$.fragment),Qn(b,g.target,g.anchor),sg()}lp(V)}class $r{constructor(){ap(this,"$$");ap(this,"$$set")}$destroy(){er(this,1),this.$destroy=Di}$on(g,_){if(!$d(_))return Di;const C=this.$$.callbacks[g]||(this.$$.callbacks[g]=[]);return C.push(_),()=>{const R=C.indexOf(_);R!==-1&&C.splice(R,1)}}$set(g){this.$$set&&!Z_(g)&&(this.$$.skip_bound=!0,this.$$set(g),this.$$.skip_bound=!1)}}const ty="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ty);const Zu=[];function og(b,g){return{subscribe:ag(b,g).subscribe}}function ag(b,g=Di){let _;const C=new Set;function R(a){if(Er(b,a)&&(b=a,_)){const V=!Zu.length;for(const F of C)F[1](),Zu.push(F,b);if(V){for(let F=0;F<Zu.length;F+=2)Zu[F][0](Zu[F+1]);Zu.length=0}}}function M(a){R(a(b))}function L(a,V=Di){const F=[a,V];return C.add(F),C.size===1&&(_=g(R,M)||Di),a(b),()=>{C.delete(F),C.size===0&&_&&(_(),_=null)}}return{set:R,update:M,subscribe:L}}function lg(b,g,_){const C=!Array.isArray(b),R=C?[b]:b;if(!R.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const M=g.length<2;return og(_,(L,a)=>{let V=!1;const F=[];let ce=0,ee=Di;const ve=()=>{if(ce)return;ee();const Ae=g(C?F[0]:F,L,a);M?L(Ae):ee=$d(Ae)?Ae:Di},_e=R.map((Ae,$e)=>eg(Ae,De=>{F[$e]=De,ce&=~(1<<$e),V&&ve()},()=>{ce|=1<<$e}));return V=!0,ve(),function(){bo(_e),ee(),V=!1}})}function iy(b,g){if(b instanceof RegExp)return{keys:!1,pattern:b};var _,C,R,M,L=[],a="",V=b.split("/");for(V[0]||V.shift();R=V.shift();)_=R[0],_==="*"?(L.push("wild"),a+="/(.*)"):_===":"?(C=R.indexOf("?",1),M=R.indexOf(".",1),L.push(R.substring(1,~C?C:~M?M:R.length)),a+=~C&&!~M?"(?:/([^/]+?))?":"/([^/]+?)",~M&&(a+=(~C?"?":"")+"\\"+R.substring(M))):a+="/"+R;return{keys:L,pattern:new RegExp("^"+a+(g?"(?=$|/)":"/?$"),"i")}}function ny(b){let g,_,C;const R=[b[2]];var M=b[0];function L(a,V){let F={};if(V!==void 0&&V&4)F=Rd(R,[Bd(a[2])]);else for(let ce=0;ce<R.length;ce+=1)F=rm(F,R[ce]);return{props:F}}return M&&(g=Ld(M,L(b)),g.$on("routeEvent",b[7])),{c(){g&&ur(g.$$.fragment),_=qd()},m(a,V){g&&Qn(g,a,V),Se(a,_,V),C=!0},p(a,V){if(V&1&&M!==(M=a[0])){if(g){am();const F=g;zn(F.$$.fragment,1,0,()=>{er(F,1)}),lm()}M?(g=Ld(M,L(a,V)),g.$on("routeEvent",a[7]),ur(g.$$.fragment),Sn(g.$$.fragment,1),Qn(g,_.parentNode,_)):g=null}else if(M){const F=V&4?Rd(R,[Bd(a[2])]):{};g.$set(F)}},i(a){C||(g&&Sn(g.$$.fragment,a),C=!0)},o(a){g&&zn(g.$$.fragment,a),C=!1},d(a){a&&Te(_),g&&er(g,a)}}}function ry(b){let g,_,C;const R=[{params:b[1]},b[2]];var M=b[0];function L(a,V){let F={};if(V!==void 0&&V&6)F=Rd(R,[V&2&&{params:a[1]},V&4&&Bd(a[2])]);else for(let ce=0;ce<R.length;ce+=1)F=rm(F,R[ce]);return{props:F}}return M&&(g=Ld(M,L(b)),g.$on("routeEvent",b[6])),{c(){g&&ur(g.$$.fragment),_=qd()},m(a,V){g&&Qn(g,a,V),Se(a,_,V),C=!0},p(a,V){if(V&1&&M!==(M=a[0])){if(g){am();const F=g;zn(F.$$.fragment,1,0,()=>{er(F,1)}),lm()}M?(g=Ld(M,L(a,V)),g.$on("routeEvent",a[6]),ur(g.$$.fragment),Sn(g.$$.fragment,1),Qn(g,_.parentNode,_)):g=null}else if(M){const F=V&6?Rd(R,[V&2&&{params:a[1]},V&4&&Bd(a[2])]):{};g.$set(F)}},i(a){C||(g&&Sn(g.$$.fragment,a),C=!0)},o(a){g&&zn(g.$$.fragment,a),C=!1},d(a){a&&Te(_),g&&er(g,a)}}}function sy(b){let g,_,C,R;const M=[ry,ny],L=[];function a(V,F){return V[1]?0:1}return g=a(b),_=L[g]=M[g](b),{c(){_.c(),C=qd()},m(V,F){L[g].m(V,F),Se(V,C,F),R=!0},p(V,[F]){let ce=g;g=a(V),g===ce?L[g].p(V,F):(am(),zn(L[ce],1,1,()=>{L[ce]=null}),lm(),_=L[g],_?_.p(V,F):(_=L[g]=M[g](V),_.c()),Sn(_,1),_.m(C.parentNode,C))},i(V){R||(Sn(_),R=!0)},o(V){zn(_),R=!1},d(V){V&&Te(C),L[g].d(V)}}}function Am(){const b=window.location.href.indexOf("#/");let g=b>-1?window.location.href.substr(b+1):"/";const _=g.indexOf("?");let C="";return _>-1&&(C=g.substr(_+1),g=g.substr(0,_)),{location:g,querystring:C}}const cm=og(null,function(g){g(Am());const _=()=>{g(Am())};return window.addEventListener("hashchange",_,!1),function(){window.removeEventListener("hashchange",_,!1)}}),zs=lg(cm,b=>b.location);lg(cm,b=>b.querystring);const Im=ag(void 0);function Zd(b,g){if(g=Mm(g),!b||!b.tagName||b.tagName.toLowerCase()!="a")throw Error('Action "link" can only be used with <a> tags');return Cm(b,g),{update(_){_=Mm(_),Cm(b,_)}}}function oy(b){b?window.scrollTo(b.__svelte_spa_router_scrollX,b.__svelte_spa_router_scrollY):window.scrollTo(0,0)}function Cm(b,g){let _=g.href||b.getAttribute("href");if(_&&_.charAt(0)=="/")_="#"+_;else if(!_||_.length<2||_.slice(0,2)!="#/")throw Error('Invalid value for "href" attribute: '+_);b.setAttribute("href",_),b.addEventListener("click",C=>{C.preventDefault(),g.disabled||ay(C.currentTarget.getAttribute("href"))})}function Mm(b){return b&&typeof b=="string"?{href:b}:b||{}}function ay(b){history.replaceState({...history.state,__svelte_spa_router_scrollX:window.scrollX,__svelte_spa_router_scrollY:window.scrollY},void 0),window.location.hash=b}function ly(b,g,_){let{routes:C={}}=g,{prefix:R=""}=g,{restoreScrollState:M=!1}=g;class L{constructor(et,je){if(!je||typeof je!="function"&&(typeof je!="object"||je._sveltesparouter!==!0))throw Error("Invalid component object");if(!et||typeof et=="string"&&(et.length<1||et.charAt(0)!="/"&&et.charAt(0)!="*")||typeof et=="object"&&!(et instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:ut,keys:wt}=iy(et);this.path=et,typeof je=="object"&&je._sveltesparouter===!0?(this.component=je.component,this.conditions=je.conditions||[],this.userData=je.userData,this.props=je.props||{}):(this.component=()=>Promise.resolve(je),this.conditions=[],this.props={}),this._pattern=ut,this._keys=wt}match(et){if(R){if(typeof R=="string")if(et.startsWith(R))et=et.substr(R.length)||"/";else return null;else if(R instanceof RegExp){const Dt=et.match(R);if(Dt&&Dt[0])et=et.substr(Dt[0].length)||"/";else return null}}const je=this._pattern.exec(et);if(je===null)return null;if(this._keys===!1)return je;const ut={};let wt=0;for(;wt<this._keys.length;){try{ut[this._keys[wt]]=decodeURIComponent(je[wt+1]||"")||null}catch{ut[this._keys[wt]]=null}wt++}return ut}async checkConditions(et){for(let je=0;je<this.conditions.length;je++)if(!await this.conditions[je](et))return!1;return!0}}const a=[];C instanceof Map?C.forEach((Ke,et)=>{a.push(new L(et,Ke))}):Object.keys(C).forEach(Ke=>{a.push(new L(Ke,C[Ke]))});let V=null,F=null,ce={};const ee=K_();async function ve(Ke,et){await Y_(),ee(Ke,et)}let _e=null,Ae=null;M&&(Ae=Ke=>{Ke.state&&(Ke.state.__svelte_spa_router_scrollY||Ke.state.__svelte_spa_router_scrollX)?_e=Ke.state:_e=null},window.addEventListener("popstate",Ae),H_(()=>{oy(_e)}));let $e=null,De=null;const Ze=cm.subscribe(async Ke=>{$e=Ke;let et=0;for(;et<a.length;){const je=a[et].match(Ke.location);if(!je){et++;continue}const ut={route:a[et].path,location:Ke.location,querystring:Ke.querystring,userData:a[et].userData,params:je&&typeof je=="object"&&Object.keys(je).length?je:null};if(!await a[et].checkConditions(ut)){_(0,V=null),De=null,ve("conditionsFailed",ut);return}ve("routeLoading",Object.assign({},ut));const wt=a[et].component;if(De!=wt){wt.loading?(_(0,V=wt.loading),De=wt,_(1,F=wt.loadingParams),_(2,ce={}),ve("routeLoaded",Object.assign({},ut,{component:V,name:V.name,params:F}))):(_(0,V=null),De=null);const Dt=await wt();if(Ke!=$e)return;_(0,V=Dt&&Dt.default||Dt),De=wt}je&&typeof je=="object"&&Object.keys(je).length?_(1,F=je):_(1,F=null),_(2,ce=a[et].props),ve("routeLoaded",Object.assign({},ut,{component:V,name:V.name,params:F})).then(()=>{Im.set(F)});return}_(0,V=null),De=null,Im.set(void 0)});X_(()=>{Ze(),Ae&&window.removeEventListener("popstate",Ae)});function Ct(Ke){Sm.call(this,b,Ke)}function Ve(Ke){Sm.call(this,b,Ke)}return b.$$set=Ke=>{"routes"in Ke&&_(3,C=Ke.routes),"prefix"in Ke&&_(4,R=Ke.prefix),"restoreScrollState"in Ke&&_(5,M=Ke.restoreScrollState)},b.$$.update=()=>{b.$$.dirty&32&&(history.scrollRestoration=M?"manual":"auto")},[V,F,ce,C,R,M,Ct,Ve]}class cy extends $r{constructor(g){super(),Nr(this,g,ly,sy,Er,{routes:3,prefix:4,restoreScrollState:5})}}const uy=b=>({}),Pm=b=>({});function km(b){let g,_,C,R,M,L,a;return{c(){g=we("header"),_=we("a"),_.textContent="Back to Menu",C=it(),R=we("a"),M=dn("Source"),Ye(_,"href","/"),Ye(_,"class","svelte-1jo4v3w"),Ye(R,"href",b[1].sourceUrl),Ye(R,"target","_blank"),Ye(R,"rel","noreferrer"),Ye(R,"class","svelte-1jo4v3w"),Ye(g,"class","p-5 lg:p-10 pb-2.5 lg:pb-5 flex justify-between gap-2.5 lg:gap-5 sticky top-0 bg-inherit svelte-1jo4v3w")},m(V,F){Se(V,g,F),Le(g,_),Le(g,C),Le(g,R),Le(R,M),L||(a=Vd(Zd.call(null,_)),L=!0)},p:Di,d(V){V&&Te(g),L=!1,a()}}}function hy(b){let g,_,C,R,M,L,a,V=!b[0]&&km(b);const F=b[3].title,ce=ym(F,b,b[2],Pm),ee=b[3].default,ve=ym(ee,b,b[2],null);return{c(){g=we("aside"),_=we("div"),V&&V.c(),C=it(),R=we("article"),M=we("h1"),ce&&ce.c(),L=it(),ve&&ve.c(),Ye(M,"class","break-all svelte-1jo4v3w"),Ye(R,"class","p-5 lg:p-10 flex flex-col gap-1.5 lg:gap-3 svelte-1jo4v3w"),Tm(R,"!pt-0",!b[0]),Ye(_,"class","h-full flex flex-col bg-inherit overflow-x-hidden overflow-y-auto svelte-1jo4v3w"),Ye(g,"class","basis-full lg:basis-1/3 overflow-hidden shadow-xl svelte-1jo4v3w")},m(_e,Ae){Se(_e,g,Ae),Le(g,_),V&&V.m(_,null),Le(_,C),Le(_,R),Le(R,M),ce&&ce.m(M,null),Le(R,L),ve&&ve.m(R,null),a=!0},p(_e,[Ae]){_e[0]?V&&(V.d(1),V=null):V?V.p(_e,Ae):(V=km(_e),V.c(),V.m(_,C)),ce&&ce.p&&(!a||Ae&4)&&xm(ce,F,_e,_e[2],a?vm(F,_e[2],Ae,uy):bm(_e[2]),Pm),ve&&ve.p&&(!a||Ae&4)&&xm(ve,ee,_e,_e[2],a?vm(ee,_e[2],Ae,null):bm(_e[2]),null),(!a||Ae&1)&&Tm(R,"!pt-0",!_e[0])},i(_e){a||(Sn(ce,_e),Sn(ve,_e),a=!0)},o(_e){zn(ce,_e),zn(ve,_e),a=!1},d(_e){_e&&Te(g),V&&V.d(),ce&&ce.d(_e),ve&&ve.d(_e)}}}function py(b,g,_){let C;ks(b,zs,V=>_(4,C=V));let{$$slots:R={},$$scope:M}=g,{noHeader:L=!1}=g;const a=rs.find(V=>V.path===C);return b.$$set=V=>{"noHeader"in V&&_(0,L=V.noHeader),"$$scope"in V&&_(2,M=V.$$scope)},[L,a,M,R]}class Ds extends $r{constructor(g){super(),Nr(this,g,py,hy,Er,{noHeader:0})}}var Hu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dy(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}var cg={exports:{}};(function(b,g){(function(_,C){b.exports=C()})(Hu,function(){var _,C,R;function M(a,V){if(!_)_=V;else if(!C)C=V;else{var F="var sharedChunk = {}; ("+_+")(sharedChunk); ("+C+")(sharedChunk);",ce={};_(ce),R=V(ce),typeof window<"u"&&(R.workerUrl=window.URL.createObjectURL(new Blob([F],{type:"text/javascript"})))}}M(["exports"],function(a){function V(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var F=ce;function ce(i,e){this.x=i,this.y=e}ce.prototype={clone:function(){return new ce(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),n=Math.sin(i),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround:function(i,e){var n=Math.cos(i),o=Math.sin(i),c=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ce.convert=function(i){return i instanceof ce?i:Array.isArray(i)?new ce(i[0],i[1]):i};var ee=V(F),ve=_e;function _e(i,e,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=n,this.p2y=o}_e.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,o=0;o<8;o++){var c=this.sampleCurveX(n)-i;if(Math.abs(c)<e)return n;var d=this.sampleCurveDerivativeX(n);if(Math.abs(d)<1e-6)break;n-=c/d}var m=0,v=1;for(n=i,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-i)<e));o++)i>c?m=n:v=n,n=.5*(v-m)+m;return n},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var Ae=V(ve);function $e(i,e,n,o){const c=new Ae(i,e,n,o);return function(d){return c.solve(d)}}const De=$e(.25,.1,.25,1);function Ze(i,e,n){return Math.min(n,Math.max(e,i))}function Ct(i,e,n){const o=n-e,c=((i-e)%o+o)%o+e;return c===e?n:c}function Ve(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}let Ke=1;function et(i,e,n){const o={};for(const c in i)o[c]=e.call(n||this,i[c],c,i);return o}function je(i,e,n){const o={};for(const c in i)e.call(n||this,i[c],c,i)&&(o[c]=i[c]);return o}function ut(i){return Array.isArray(i)?i.map(ut):typeof i=="object"&&i?et(i,ut):i}const wt={};function Dt(i){wt[i]||(typeof console<"u"&&console.warn(i),wt[i]=!0)}function Nt(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function ai(i){let e=0;for(let n,o,c=0,d=i.length,m=d-1;c<d;m=c++)n=i[c],o=i[m],e+=(o.x-n.x)*(n.y+o.y);return e}function kt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let $t=null;function Tt(i){if($t==null){const e=i.navigator?i.navigator.userAgent:null;$t=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return $t}function jt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const yi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let vi,Li;const sn={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,n.drawImage(i,0,0,i.width,i.height),n},resolveURL:i=>(vi||(vi=document.createElement("a")),vi.href=i,vi.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Li==null&&(Li=matchMedia("(prefers-reduced-motion: reduce)")),Li.matches)}},fn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class ei extends Error{constructor(e,n,o,c){super(`AJAXError: ${n} (${e}): ${o}`),this.status=e,this.statusText=n,this.url=o,this.body=c}}const Ar=kt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,hr=i=>fn.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function xi(i,e){const n=new AbortController,o=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:Ar(),signal:n.signal});let c=!1,d=!1;return i.type==="json"&&o.headers.set("Accept","application/json"),d||fetch(o).then(m=>m.ok?(v=>{(i.type==="arrayBuffer"||i.type==="image"?v.arrayBuffer():i.type==="json"?v.json():v.text()).then(T=>{d||(c=!0,e(null,T,v.headers.get("Cache-Control"),v.headers.get("Expires")))}).catch(T=>{d||e(new Error(T.message))})})(m):m.blob().then(v=>e(new ei(m.status,m.statusText,i.url,v)))).catch(m=>{m.code!==20&&e(new Error(m.message))}),{cancel:()=>{d=!0,c||n.abort()}}}const Vn=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(kt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!kt())return(hr(i.url)||xi)(i,e)}if(!(/^file:/.test(n=i.url)||/^file:/.test(Ar())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return xi(i,e);if(kt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var n;return function(o,c){const d=new XMLHttpRequest;d.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(d.responseType="arraybuffer");for(const m in o.headers)d.setRequestHeader(m,o.headers[m]);return o.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=o.credentials==="include",d.onerror=()=>{c(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let m=d.response;if(o.type==="json")try{m=JSON.parse(d.response)}catch(v){return c(v)}c(null,m,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else{const m=new Blob([d.response],{type:d.getResponseHeader("Content-Type")});c(new ei(d.status,d.statusText,o.url,m))}},d.send(o.body),{cancel:()=>d.abort()}}(i,e)},ss=function(i,e){return Vn(Ve(i,{type:"arrayBuffer"}),e)};function pr(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function Ir(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function tr(i,e,n){if(n&&n[i]){const o=n[i].indexOf(e);o!==-1&&n[i].splice(o,1)}}class on{constructor(e,n={}){Ve(this,n),this.type=e}}class On extends on{constructor(e,n={}){super("error",Ve({error:e},n))}}class dr{on(e,n){return this._listeners=this._listeners||{},Ir(e,n,this._listeners),this}off(e,n){return tr(e,n,this._listeners),tr(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Ir(e,n,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,n){typeof e=="string"&&(e=new on(e,n||{}));const o=e.type;if(this.listens(o)){e.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const v of c)v.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const v of d)tr(o,v,this._oneTimeListeners),v.call(this,e);const m=this._eventedParent;m&&(Ve(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof On&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ke={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const en=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Vr(i,e){const n={};for(const o in i)o!=="ref"&&(n[o]=i[o]);return en.forEach(o=>{o in e&&(n[o]=e[o])}),n}function li(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!li(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!li(i[n],e[n]))return!1;return!0}return i===e}const Kt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function os(i,e,n){n.push({command:Kt.addSource,args:[i,e[i]]})}function fr(i,e,n){e.push({command:Kt.removeSource,args:[i]}),n[i]=!0}function as(i,e,n,o){fr(i,n,o),os(i,e,n)}function qn(i,e,n){let o;for(o in i[n])if(Object.prototype.hasOwnProperty.call(i[n],o)&&o!=="data"&&!li(i[n][o],e[n][o]))return!1;for(o in e[n])if(Object.prototype.hasOwnProperty.call(e[n],o)&&o!=="data"&&!li(i[n][o],e[n][o]))return!1;return!0}function hi(i,e,n,o,c,d){let m;for(m in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,m)&&(li(i[m],e[m])||n.push({command:d,args:[o,m,e[m],c]}));for(m in e)Object.prototype.hasOwnProperty.call(e,m)&&!Object.prototype.hasOwnProperty.call(i,m)&&(li(i[m],e[m])||n.push({command:d,args:[o,m,e[m],c]}))}function qr(i){return i.id}function Ls(i,e){return i[e.id]=e,i}class Je{constructor(e,n,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function Dn(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}class mn extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Hi{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,c]of n)this.bindings[o]=c}concat(e){return new Hi(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const mr={kind:"null"},nt={kind:"number"},Lt={kind:"string"},Vt={kind:"boolean"},gn={kind:"color"},_n={kind:"object"},St={kind:"value"},ir={kind:"collator"},En={kind:"formatted"},Gn={kind:"padding"},Zn={kind:"resolvedImage"},ys={kind:"variableAnchorOffsetCollection"};function an(i,e){return{kind:"array",itemType:i,N:e}}function Si(i){if(i.kind==="array"){const e=Si(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Gr=[mr,nt,Lt,Vt,gn,En,_n,an(St),Gn,Zn,ys];function Cr(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Cr(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of Gr)if(!Cr(n,e))return null}}return`Expected ${Si(i)} but found ${Si(e)} instead.`}function te(i,e){return e.some(n=>n.kind===i.kind)}function B(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function N(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const j=.96422,ie=.82521,W=4/29,se=6/29,ue=3*se*se,le=se*se*se,ge=Math.PI/180,Fe=180/Math.PI;function Ue(i){return(i%=360)<0&&(i+=360),i}function Ne([i,e,n,o]){let c,d;const m=Zt((.2225045*(i=Mt(i))+.7168786*(e=Mt(e))+.0606169*(n=Mt(n)))/1);i===e&&e===n?c=d=m:(c=Zt((.4360747*i+.3850649*e+.1430804*n)/j),d=Zt((.0139322*i+.0971045*e+.7141733*n)/ie));const v=116*m-16;return[v<0?0:v,500*(c-m),200*(m-d),o]}function Mt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Zt(i){return i>le?Math.pow(i,1/3):i/ue+W}function yt([i,e,n,o]){let c=(i+16)/116,d=isNaN(e)?c:c+e/500,m=isNaN(n)?c:c-n/200;return c=1*qt(c),d=j*qt(d),m=ie*qt(m),[Et(3.1338561*d-1.6168667*c-.4906146*m),Et(-.9787684*d+1.9161415*c+.033454*m),Et(.0719453*d-.2289914*c+1.4052427*m),o]}function Et(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function qt(i){return i>se?i*i*i:ue*(i-W)}function fi(i){return parseInt(i.padEnd(2,i),16)/255}function Ri(i,e){return si(e?i/100:i,0,1)}function si(i,e,n){return Math.min(Math.max(e,i),n)}function pi(i){return!i.some(Number.isNaN)}const Mr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Bt{constructor(e,n,o,c=1,d=!0){this.r=e,this.g=n,this.b=o,this.a=c,d||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[e,n,o,c]))}static parse(e){if(e instanceof Bt)return e;if(typeof e!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=Mr[o];if(c){const[m,v,T]=c;return[m/255,v/255,T/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const m=o.length<6?1:2;let v=1;return[fi(o.slice(v,v+=m)),fi(o.slice(v,v+=m)),fi(o.slice(v,v+=m)),fi(o.slice(v,v+m)||"ff")]}if(o.startsWith("rgb")){const m=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[v,T,E,P,D,U,q,G,J,ne,oe,me]=m,he=[P||" ",q||" ",ne].join("");if(he==="  "||he==="  /"||he===",,"||he===",,,"){const be=[E,U,J].join(""),Ie=be==="%%%"?100:be===""?255:0;if(Ie){const Be=[si(+T/Ie,0,1),si(+D/Ie,0,1),si(+G/Ie,0,1),oe?Ri(+oe,me):1];if(pi(Be))return Be}}return}}const d=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[m,v,T,E,P,D,U,q,G]=d,J=[T||" ",P||" ",U].join("");if(J==="  "||J==="  /"||J===",,"||J===",,,"){const ne=[+v,si(+E,0,100),si(+D,0,100),q?Ri(+q,G):1];if(pi(ne))return function([oe,me,he,be]){function Ie(Be){const pt=(Be+oe/30)%12,ot=me*Math.min(he,1-he);return he-ot*Math.max(-1,Math.min(pt-3,9-pt,1))}return oe=Ue(oe),me/=100,he/=100,[Ie(0),Ie(8),Ie(4),be]}(ne)}}}(e);return n?new Bt(...n,!1):void 0}get rgb(){const{r:e,g:n,b:o,a:c}=this,d=c||1/0;return this.overwriteGetter("rgb",[e/d,n/d,o/d,c])}get hcl(){return this.overwriteGetter("hcl",function(e){const[n,o,c,d]=Ne(e),m=Math.sqrt(o*o+c*c);return[Math.round(1e4*m)?Ue(Math.atan2(c,o)*Fe):NaN,m,n,d]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ne(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,o,c]=this.rgb;return`rgba(${[e,n,o].map(d=>Math.round(255*d)).join(",")},${c})`}}Bt.black=new Bt(0,0,0,1),Bt.white=new Bt(1,1,1,1),Bt.transparent=new Bt(0,0,0,0),Bt.red=new Bt(1,0,0,1);class tn{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class jn{constructor(e,n,o,c,d){this.text=e,this.image=n,this.scale=o,this.fontStack=c,this.textColor=d}}class Xi{constructor(e){this.sections=e}static fromString(e){return new Xi([new jn(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Xi?e:Xi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Zr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Zr)return e;if(typeof e=="number")return new Zr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Zr(e)}}toString(){return JSON.stringify(this.values)}}const Ju=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class nr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof nr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const o=e[n],c=e[n+1];if(typeof o!="string"||!Ju.has(o)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new nr(e)}}toString(){return JSON.stringify(this.values)}}class jr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new jr({name:e,available:!1}):null}}function ec(i,e,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,n,o]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ia(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Bt||i instanceof tn||i instanceof Xi||i instanceof Zr||i instanceof nr||i instanceof jr)return!0;if(Array.isArray(i)){for(const e of i)if(!Ia(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Ia(i[e]))return!1;return!0}return!1}function yn(i){if(i===null)return mr;if(typeof i=="string")return Lt;if(typeof i=="boolean")return Vt;if(typeof i=="number")return nt;if(i instanceof Bt)return gn;if(i instanceof tn)return ir;if(i instanceof Xi)return En;if(i instanceof Zr)return Gn;if(i instanceof nr)return ys;if(i instanceof jr)return Zn;if(Array.isArray(i)){const e=i.length;let n;for(const o of i){const c=yn(o);if(n){if(n===c)continue;n=St;break}n=c}return an(n||St,e)}return _n}function oo(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Bt||i instanceof Xi||i instanceof Zr||i instanceof nr||i instanceof jr?i.toString():JSON.stringify(i)}class wo{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ia(e[1]))return n.error("invalid value");const o=e[1];let c=yn(o);const d=n.expectedType;return c.kind!=="array"||c.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(c=d),new wo(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class vn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ca={string:Lt,number:nt,boolean:Vt,object:_n};class Wn{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,c=1;const d=e[0];if(d==="array"){let v,T;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in Ca)||E==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=Ca[E],c++}else v=St;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=e[2],c++}o=an(v,T)}else{if(!Ca[d])throw new Error(`Types doesn't contain name = ${d}`);o=Ca[d]}const m=[];for(;c<e.length;c++){const v=n.parse(e[c],c,St);if(!v)return null;m.push(v)}return new Wn(o,m)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(!Cr(this.type,yn(o)))return o;if(n===this.args.length-1)throw new vn(`Expected value to be of type ${Si(this.type)}, but found ${Si(yn(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ma={"to-boolean":Vt,"to-color":gn,"to-number":nt,"to-string":Lt};class ls{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0];if(!Ma[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");const c=Ma[o],d=[];for(let m=1;m<e.length;m++){const v=n.parse(e[m],m,St);if(!v)return null;d.push(v)}return new ls(c,d)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,o;for(const c of this.args){if(n=c.evaluate(e),o=null,n instanceof Bt)return n;if(typeof n=="string"){const d=e.parseColor(n);if(d)return d}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:ec(n[0],n[1],n[2],n[3]),!o))return new Bt(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new vn(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(e);const c=Zr.parse(n);if(c)return c}throw new vn(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(e);const c=nr.parse(n);if(c)return c}throw new vn(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new vn(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Xi.fromString(oo(this.args[0].evaluate(e)));case"resolvedImage":return jr.fromString(oo(this.args[0].evaluate(e)));default:return oo(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Pa=["Unknown","Point","LineString","Polygon"];class Ii{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Pa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Bt.parse(e)),n}}class To{constructor(e,n,o=[],c,d=new Hi,m=[]){this.registry=e,this.path=o,this.key=o.map(v=>`[${v}]`).join(""),this.scope=d,this.errors=m,this.expectedType=c,this._isConstant=n}parse(e,n,o,c,d={}){return n?this.concat(n,o,c)._parse(e,d):this._parse(e,d)}_parse(e,n){function o(c,d,m){return m==="assert"?new Wn(d,[c]):m==="coerce"?new ls(d,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[c];if(d){let m=d.parse(e,this);if(!m)return null;if(this.expectedType){const v=this.expectedType,T=m.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||T.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string")if(v.kind!=="padding"||T.kind!=="value"&&T.kind!=="number"&&T.kind!=="array")if(v.kind!=="variableAnchorOffsetCollection"||T.kind!=="value"&&T.kind!=="array"){if(this.checkSubtype(v,T))return null}else m=o(m,v,n.typeAnnotation||"coerce");else m=o(m,v,n.typeAnnotation||"coerce");else m=o(m,v,n.typeAnnotation||"coerce");else m=o(m,v,n.typeAnnotation||"assert")}if(!(m instanceof wo)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const v=new Ii;try{m=new wo(m.type,m.evaluate(v))}catch(T){return this.error(T.message),null}}return m}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){const c=typeof e=="number"?this.path.concat(e):this.path,d=o?this.scope.concat(o):this.scope;return new To(this.registry,this._isConstant,c,n||null,d,this.errors)}error(e,...n){const o=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new mn(o,e))}checkSubtype(e,n){const o=Cr(e,n);return o&&this.error(o),o}}class So{constructor(e,n,o){this.type=ir,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Vt);if(!c)return null;const d=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Vt);if(!d)return null;let m=null;return o.locale&&(m=n.parse(o.locale,1,Lt),!m)?null:new So(c,d,m)}evaluate(e){return new tn(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const ao=8192;function ka(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Qo(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function tc(i,e){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*ao),Math.round(o*c*ao)]}function Xc(i,e,n){const o=i[0]-e[0],c=i[1]-e[1],d=i[0]-n[0],m=i[1]-n[1];return o*m-d*c==0&&o*d<=0&&c*m<=0}function za(i,e){let n=!1;for(let m=0,v=e.length;m<v;m++){const T=e[m];for(let E=0,P=T.length;E<P-1;E++){if(Xc(i,T[E],T[E+1]))return!1;(c=T[E])[1]>(o=i)[1]!=(d=T[E+1])[1]>o[1]&&o[0]<(d[0]-c[0])*(o[1]-c[1])/(d[1]-c[1])+c[0]&&(n=!n)}}var o,c,d;return n}function ic(i,e){for(let n=0;n<e.length;n++)if(za(i,e[n]))return!0;return!1}function al(i,e,n,o){const c=o[0]-n[0],d=o[1]-n[1],m=(i[0]-n[0])*d-c*(i[1]-n[1]),v=(e[0]-n[0])*d-c*(e[1]-n[1]);return m>0&&v<0||m<0&&v>0}function ea(i,e,n){for(const E of n)for(let P=0;P<E.length-1;++P)if((v=[(m=E[P+1])[0]-(d=E[P])[0],m[1]-d[1]])[0]*(T=[(c=e)[0]-(o=i)[0],c[1]-o[1]])[1]-v[1]*T[0]!=0&&al(o,c,d,m)&&al(d,m,o,c))return!0;var o,c,d,m,v,T;return!1}function nc(i,e){for(let n=0;n<i.length;++n)if(!za(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(ea(i[n],i[n+1],e))return!1;return!0}function rc(i,e){for(let n=0;n<e.length;n++)if(nc(i,e[n]))return!0;return!1}function ll(i,e,n){const o=[];for(let c=0;c<i.length;c++){const d=[];for(let m=0;m<i[c].length;m++){const v=tc(i[c][m],n);ka(e,v),d.push(v)}o.push(d)}return o}function sc(i,e,n){const o=[];for(let c=0;c<i.length;c++){const d=ll(i[c],e,n);o.push(d)}return o}function oc(i,e,n,o){if(i[0]<n[0]||i[0]>n[2]){const c=.5*o;let d=i[0]-n[0]>c?-o:n[0]-i[0]>c?o:0;d===0&&(d=i[0]-n[2]>c?-o:n[2]-i[0]>c?o:0),i[0]+=d}ka(e,i)}function Da(i,e,n,o){const c=Math.pow(2,o.z)*ao,d=[o.x*ao,o.y*ao],m=[];for(const v of i)for(const T of v){const E=[T.x+d[0],T.y+d[1]];oc(E,e,n,c),m.push(E)}return m}function ac(i,e,n,o){const c=Math.pow(2,o.z)*ao,d=[o.x*ao,o.y*ao],m=[];for(const T of i){const E=[];for(const P of T){const D=[P.x+d[0],P.y+d[1]];ka(e,D),E.push(D)}m.push(E)}if(e[2]-e[0]<=c/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const T of m)for(const E of T)oc(E,e,n,c)}var v;return m}class Eo{constructor(e,n){this.type=Vt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ia(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let c=0;c<o.features.length;++c){const d=o.features[c].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Eo(o,o.features[c].geometry)}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Eo(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Eo(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(o.type==="Polygon"){const v=ll(o.coordinates,d,m),T=Da(n.geometry(),c,d,m);if(!Qo(c,d))return!1;for(const E of T)if(!za(E,v))return!1}if(o.type==="MultiPolygon"){const v=sc(o.coordinates,d,m),T=Da(n.geometry(),c,d,m);if(!Qo(c,d))return!1;for(const E of T)if(!ic(E,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(o.type==="Polygon"){const v=ll(o.coordinates,d,m),T=ac(n.geometry(),c,d,m);if(!Qo(c,d))return!1;for(const E of T)if(!nc(E,v))return!1}if(o.type==="MultiPolygon"){const v=sc(o.coordinates,d,m),T=ac(n.geometry(),c,d,m);if(!Qo(c,d))return!1;for(const E of T)if(!rc(E,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class cl{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new cl(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Wr{constructor(e,n,o,c){this.name=e,this.type=n,this._evaluate=o,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const o=e[0],c=Wr.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(c)?c[0]:c.type,m=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,v=m.filter(([E])=>!Array.isArray(E)||E.length===e.length-1);let T=null;for(const[E,P]of v){T=new To(n.registry,ta,n.path,null,n.scope);const D=[];let U=!1;for(let q=1;q<e.length;q++){const G=e[q],J=Array.isArray(E)?E[q-1]:E.type,ne=T.parse(G,1+D.length,J);if(!ne){U=!0;break}D.push(ne)}if(!U)if(Array.isArray(E)&&E.length!==D.length)T.error(`Expected ${E.length} arguments, but found ${D.length} instead.`);else{for(let q=0;q<D.length;q++){const G=Array.isArray(E)?E[q]:E.type,J=D[q];T.concat(q+1).checkSubtype(G,J.type)}if(T.errors.length===0)return new Wr(o,d,P,D)}}if(v.length===1)n.errors.push(...T.errors);else{const E=(v.length?v:m).map(([D])=>{return U=D,Array.isArray(U)?`(${U.map(Si).join(", ")})`:`(${Si(U.type)}...)`;var U}).join(" | "),P=[];for(let D=1;D<e.length;D++){const U=n.parse(e[D],1+P.length);if(!U)return null;P.push(Si(U.type))}n.error(`Expected arguments of type ${E}, but found (${P.join(", ")}) instead.`)}return null}static register(e,n){Wr.definitions=n;for(const o in n)e[o]=Wr}}function ta(i){if(i instanceof cl)return ta(i.boundExpression);if(i instanceof Wr&&i.name==="error"||i instanceof So||i instanceof Eo)return!1;const e=i instanceof ls||i instanceof Wn;let n=!0;return i.eachChild(o=>{n=e?n&&ta(o):n&&o instanceof wo}),!!n&&ul(i)&&Ra(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ul(i){if(i instanceof Wr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Eo)return!1;let e=!0;return i.eachChild(n=>{e&&!ul(n)&&(e=!1)}),e}function La(i){if(i instanceof Wr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!La(n)&&(e=!1)}),e}function Ra(i,e){if(i instanceof Wr&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(o=>{n&&!Ra(o,e)&&(n=!1)}),n}function Ba(i,e){const n=i.length-1;let o,c,d=0,m=n,v=0;for(;d<=m;)if(v=Math.floor((d+m)/2),o=i[v],c=i[v+1],o<=e){if(v===n||e<c)return v;d=v+1}else{if(!(o>e))throw new vn("Input is not a number.");m=v-1}return 0}class Ao{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[c,d]of o)this.labels.push(c),this.outputs.push(d)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,nt);if(!o)return null;const c=[];let d=null;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);for(let m=1;m<e.length;m+=2){const v=m===1?-1/0:e[m],T=e[m+1],E=m,P=m+1;if(typeof v!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(c.length&&c[c.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const D=n.parse(T,P,d);if(!D)return null;d=d||D.type,c.push([v,D])}return new Ao(d,o,c)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const d=n.length;return c>=n[d-1]?o[d-1].evaluate(e):o[Ba(n,c)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Io(i,e,n){return i+n*(e-i)}function hl(i,e,n){return i.map((o,c)=>Io(o,e[c],n))}const Hr={number:Io,color:function(i,e,n,o="rgb"){switch(o){case"rgb":{const[c,d,m,v]=hl(i.rgb,e.rgb,n);return new Bt(c,d,m,v,!1)}case"hcl":{const[c,d,m,v]=i.hcl,[T,E,P,D]=e.hcl;let U,q;if(isNaN(c)||isNaN(T))isNaN(c)?isNaN(T)?U=NaN:(U=T,m!==1&&m!==0||(q=E)):(U=c,P!==1&&P!==0||(q=d));else{let me=T-c;T>c&&me>180?me-=360:T<c&&c-T>180&&(me+=360),U=c+n*me}const[G,J,ne,oe]=function([me,he,be,Ie]){return me=isNaN(me)?0:me*ge,yt([be,Math.cos(me)*he,Math.sin(me)*he,Ie])}([U,q??Io(d,E,n),Io(m,P,n),Io(v,D,n)]);return new Bt(G,J,ne,oe,!1)}case"lab":{const[c,d,m,v]=yt(hl(i.lab,e.lab,n));return new Bt(c,d,m,v,!1)}}},array:hl,padding:function(i,e,n){return new Zr(hl(i.values,e.values,n))},variableAnchorOffsetCollection:function(i,e,n){const o=i.values,c=e.values;if(o.length!==c.length)throw new vn(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const d=[];for(let m=0;m<o.length;m+=2){if(o[m]!==c[m])throw new vn(`Cannot interpolate values containing mismatched anchors. from[${m}]: ${o[m]}, to[${m}]: ${c[m]}`);d.push(o[m]);const[v,T]=o[m+1],[E,P]=c[m+1];d.push([Io(v,E,n),Io(T,P,n)])}return new nr(d)}};class Xr{constructor(e,n,o,c,d){this.type=e,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[m,v]of d)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(e,n,o,c){let d=0;if(e.name==="exponential")d=lc(n,e.base,o,c);else if(e.name==="linear")d=lc(n,1,o,c);else if(e.name==="cubic-bezier"){const m=e.controlPoints;d=new Ae(m[0],m[1],m[2],m[3]).solve(lc(n,1,o,c))}return d}static parse(e,n){let[o,c,d,...m]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const E=c[1];if(typeof E!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:E}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const E=c.slice(1);if(E.length!==4||E.some(P=>typeof P!="number"||P<0||P>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(d=n.parse(d,2,nt),!d)return null;const v=[];let T=null;o==="interpolate-hcl"||o==="interpolate-lab"?T=gn:n.expectedType&&n.expectedType.kind!=="value"&&(T=n.expectedType);for(let E=0;E<m.length;E+=2){const P=m[E],D=m[E+1],U=E+3,q=E+4;if(typeof P!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(v.length&&v[v.length-1][0]>=P)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const G=n.parse(D,q,T);if(!G)return null;T=T||G.type,v.push([P,G])}return N(T,nt)||N(T,gn)||N(T,Gn)||N(T,ys)||N(T,an(nt))?new Xr(T,o,c,d,v):n.error(`Type ${Si(T)} is not interpolatable.`)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const d=n.length;if(c>=n[d-1])return o[d-1].evaluate(e);const m=Ba(n,c),v=Xr.interpolationFactor(this.interpolation,c,n[m],n[m+1]),T=o[m].evaluate(e),E=o[m+1].evaluate(e);switch(this.operator){case"interpolate":return Hr[this.type.kind](T,E,v);case"interpolate-hcl":return Hr.color(T,E,v,"hcl");case"interpolate-lab":return Hr.color(T,E,v,"lab")}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function lc(i,e,n,o){const c=o-n,d=i-n;return c===0?0:e===1?d/c:(Math.pow(e,d)-1)/(Math.pow(e,c)-1)}class Fi{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null;const c=n.expectedType;c&&c.kind!=="value"&&(o=c);const d=[];for(const v of e.slice(1)){const T=n.parse(v,1+d.length,o,void 0,{typeAnnotation:"omit"});if(!T)return null;o=o||T.type,d.push(T)}if(!o)throw new Error("No output type");const m=c&&d.some(v=>Cr(c,v.type));return new Fi(m?St:o,d)}evaluate(e){let n,o=null,c=0;for(const d of this.args)if(c++,o=d.evaluate(e),o&&o instanceof jr&&!o.available&&(n||(n=o.name),o=null,c===this.args.length&&(o=n)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Ci{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let d=1;d<e.length-1;d+=2){const m=e[d];if(typeof m!="string")return n.error(`Expected string, but found ${typeof m} instead.`,d);if(/[^a-zA-Z0-9_]/.test(m))return n.error("Variable names must contain only alphanumeric characters or '_'.",d);const v=n.parse(e[d+1],d+1);if(!v)return null;o.push([m,v])}const c=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return c?new Ci(o,c):null}outputDefined(){return this.result.outputDefined()}}class ia{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,nt),c=n.parse(e[2],2,an(n.expectedType||St));return o&&c?new ia(c.type.itemType,o,c):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new vn(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new vn(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new vn(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class gi{constructor(e,n){this.type=Vt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,St),c=n.parse(e[2],2,St);return o&&c?te(o.type,[Vt,Lt,nt,mr,St])?new gi(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Si(o.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!B(n,["boolean","string","number","null"]))throw new vn(`Expected first argument to be of type boolean, string, number or null, but found ${Si(yn(n))} instead.`);if(!B(o,["string","array"]))throw new vn(`Expected second argument to be of type array or string, but found ${Si(yn(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class pl{constructor(e,n,o){this.type=nt,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,St),c=n.parse(e[2],2,St);if(!o||!c)return null;if(!te(o.type,[Vt,Lt,nt,mr,St]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Si(o.type)} instead`);if(e.length===4){const d=n.parse(e[3],3,nt);return d?new pl(o,c,d):null}return new pl(o,c)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!B(n,["boolean","string","number","null"]))throw new vn(`Expected first argument to be of type boolean, string, number or null, but found ${Si(yn(n))} instead.`);if(!B(o,["string","array"]))throw new vn(`Expected second argument to be of type array or string, but found ${Si(yn(o))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return o.indexOf(n,c)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class cc{constructor(e,n,o,c,d,m){this.inputType=e,this.type=n,this.input=o,this.cases=c,this.outputs=d,this.otherwise=m}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const d={},m=[];for(let E=2;E<e.length-1;E+=2){let P=e[E];const D=e[E+1];Array.isArray(P)||(P=[P]);const U=n.concat(E);if(P.length===0)return U.error("Expected at least one branch label.");for(const G of P){if(typeof G!="number"&&typeof G!="string")return U.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return U.error("Numeric branch labels must be integer values.");if(o){if(U.checkSubtype(o,yn(G)))return null}else o=yn(G);if(d[String(G)]!==void 0)return U.error("Branch labels must be unique.");d[String(G)]=m.length}const q=n.parse(D,E,c);if(!q)return null;c=c||q.type,m.push(q)}const v=n.parse(e[1],1,St);if(!v)return null;const T=n.parse(e[e.length-1],e.length-1,c);return T?v.type.kind!=="value"&&n.concat(1).checkSubtype(o,v.type)?null:new cc(o,c,v,d,m,T):null}evaluate(e){const n=this.input.evaluate(e);return(yn(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class uc{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const c=[];for(let m=1;m<e.length-1;m+=2){const v=n.parse(e[m],m,Vt);if(!v)return null;const T=n.parse(e[m+1],m+1,o);if(!T)return null;c.push([v,T]),o=o||T.type}const d=n.parse(e[e.length-1],e.length-1,o);if(!d)return null;if(!o)throw new Error("Can't infer output type");return new uc(o,c,d)}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class dl{constructor(e,n,o,c){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,St),c=n.parse(e[2],2,nt);if(!o||!c)return null;if(!te(o.type,[an(St),Lt,St]))return n.error(`Expected first argument to be of type array or string, but found ${Si(o.type)} instead`);if(e.length===4){const d=n.parse(e[3],3,nt);return d?new dl(o.type,o,c,d):null}return new dl(o.type,o,c)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!B(n,["string","array"]))throw new vn(`Expected first argument to be of type array or string, but found ${Si(yn(n))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return n.slice(o,c)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function hc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Kc(i,e,n,o){return o.compare(e,n)===0}function ln(i,e,n){const o=i!=="=="&&i!=="!=";return class ug{constructor(d,m,v){this.type=Vt,this.lhs=d,this.rhs=m,this.collator=v,this.hasUntypedArgument=d.type.kind==="value"||m.type.kind==="value"}static parse(d,m){if(d.length!==3&&d.length!==4)return m.error("Expected two or three arguments.");const v=d[0];let T=m.parse(d[1],1,St);if(!T)return null;if(!hc(v,T.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${Si(T.type)}'.`);let E=m.parse(d[2],2,St);if(!E)return null;if(!hc(v,E.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${Si(E.type)}'.`);if(T.type.kind!==E.type.kind&&T.type.kind!=="value"&&E.type.kind!=="value")return m.error(`Cannot compare types '${Si(T.type)}' and '${Si(E.type)}'.`);o&&(T.type.kind==="value"&&E.type.kind!=="value"?T=new Wn(E.type,[T]):T.type.kind!=="value"&&E.type.kind==="value"&&(E=new Wn(T.type,[E])));let P=null;if(d.length===4){if(T.type.kind!=="string"&&E.type.kind!=="string"&&T.type.kind!=="value"&&E.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(P=m.parse(d[3],3,ir),!P)return null}return new ug(T,E,P)}evaluate(d){const m=this.lhs.evaluate(d),v=this.rhs.evaluate(d);if(o&&this.hasUntypedArgument){const T=yn(m),E=yn(v);if(T.kind!==E.kind||T.kind!=="string"&&T.kind!=="number")throw new vn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${T.kind}, ${E.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const T=yn(m),E=yn(v);if(T.kind!=="string"||E.kind!=="string")return e(d,m,v)}return this.collator?n(d,m,v,this.collator.evaluate(d)):e(d,m,v)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const pc=ln("==",function(i,e,n){return e===n},Kc),Co=ln("!=",function(i,e,n){return e!==n},function(i,e,n,o){return!Kc(0,e,n,o)}),Yc=ln("<",function(i,e,n){return e<n},function(i,e,n,o){return o.compare(e,n)<0}),dc=ln(">",function(i,e,n){return e>n},function(i,e,n,o){return o.compare(e,n)>0}),cs=ln("<=",function(i,e,n){return e<=n},function(i,e,n,o){return o.compare(e,n)<=0}),Jc=ln(">=",function(i,e,n){return e>=n},function(i,e,n,o){return o.compare(e,n)>=0});class fl{constructor(e,n,o,c,d){this.type=Lt,this.number=e,this.locale=n,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=d}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,nt);if(!o)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=n.parse(c.locale,1,Lt),!d))return null;let m=null;if(c.currency&&(m=n.parse(c.currency,1,Lt),!m))return null;let v=null;if(c["min-fraction-digits"]&&(v=n.parse(c["min-fraction-digits"],1,nt),!v))return null;let T=null;return c["max-fraction-digits"]&&(T=n.parse(c["max-fraction-digits"],1,nt),!T)?null:new fl(o,d,m,v,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Fa{constructor(e){this.type=En,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const c=[];let d=!1;for(let m=1;m<=e.length-1;++m){const v=e[m];if(d&&typeof v=="object"&&!Array.isArray(v)){d=!1;let T=null;if(v["font-scale"]&&(T=n.parse(v["font-scale"],1,nt),!T))return null;let E=null;if(v["text-font"]&&(E=n.parse(v["text-font"],1,an(Lt)),!E))return null;let P=null;if(v["text-color"]&&(P=n.parse(v["text-color"],1,gn),!P))return null;const D=c[c.length-1];D.scale=T,D.font=E,D.textColor=P}else{const T=n.parse(e[m],1,St);if(!T)return null;const E=T.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:T,scale:null,font:null,textColor:null})}}return new Fa(c)}evaluate(e){return new Xi(this.sections.map(n=>{const o=n.content.evaluate(e);return yn(o)===Zn?new jn("",o,null,null,null):new jn(oo(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}}class ml{constructor(e){this.type=Zn,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Lt);return o?new ml(o):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),o=jr.fromString(n);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(n)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class gl{constructor(e){this.type=nt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Si(o.type)} instead.`):new gl(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new vn(`Expected value to be of type string or array, but found ${Si(yn(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Mo={"==":pc,"!=":Co,">":dc,"<":Yc,">=":Jc,"<=":cs,array:Wn,at:ia,boolean:Wn,case:uc,coalesce:Fi,collator:So,format:Fa,image:ml,in:gi,"index-of":pl,interpolate:Xr,"interpolate-hcl":Xr,"interpolate-lab":Xr,length:gl,let:Ci,literal:wo,match:cc,number:Wn,"number-format":fl,object:Wn,slice:dl,step:Ao,string:Wn,"to-boolean":ls,"to-color":ls,"to-number":ls,"to-string":ls,var:cl,within:Eo};function Pr(i,[e,n,o,c]){e=e.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const d=c?c.evaluate(i):1,m=ec(e,n,o,d);if(m)throw new vn(m);return new Bt(e/255,n/255,o/255,d,!1)}function Qc(i,e){return i in e}function kr(i,e){const n=e[i];return n===void 0?null:n}function Po(i){return{type:i}}function fc(i){return{result:"success",value:i}}function Kr(i){return{result:"error",value:i}}function Gs(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function _l(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function ji(i){return!!i.expression&&i.expression.interpolated}function ci(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function na(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Qu(i){return i}function yl(i,e){const n=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",c=o||!(o||i.property!==void 0),d=i.type||(ji(e)?"exponential":"interval");if(n||e.type==="padding"){const P=n?Bt.parse:Zr.parse;(i=Dn({},i)).stops&&(i.stops=i.stops.map(D=>[D[0],P(D[1])])),i.default=P(i.default?i.default:e.default)}if(i.colorSpace&&(m=i.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var m;let v,T,E;if(d==="exponential")v=mc;else if(d==="interval")v=th;else if(d==="categorical"){v=eh,T=Object.create(null);for(const P of i.stops)T[P[0]]=P[1];E=typeof i.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);v=vl}if(o){const P={},D=[];for(let G=0;G<i.stops.length;G++){const J=i.stops[G],ne=J[0].zoom;P[ne]===void 0&&(P[ne]={zoom:ne,type:i.type,property:i.property,default:i.default,stops:[]},D.push(ne)),P[ne].stops.push([J[0].value,J[1]])}const U=[];for(const G of D)U.push([P[G].zoom,yl(P[G],e)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:Xr.interpolationFactor.bind(void 0,q),zoomStops:U.map(G=>G[0]),evaluate:({zoom:G},J)=>mc({stops:U,base:i.base},e,G).evaluate(G,J)}}if(c){const P=d==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:Xr.interpolationFactor.bind(void 0,P),zoomStops:i.stops.map(D=>D[0]),evaluate:({zoom:D})=>v(i,e,D,T,E)}}return{kind:"source",evaluate(P,D){const U=D&&D.properties?D.properties[i.property]:void 0;return U===void 0?ko(i.default,e.default):v(i,e,U,T,E)}}}function ko(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function eh(i,e,n,o,c){return ko(typeof n===c?o[n]:void 0,i.default,e.default)}function th(i,e,n){if(ci(n)!=="number")return ko(i.default,e.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const c=Ba(i.stops.map(d=>d[0]),n);return i.stops[c][1]}function mc(i,e,n){const o=i.base!==void 0?i.base:1;if(ci(n)!=="number")return ko(i.default,e.default);const c=i.stops.length;if(c===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[c-1][0])return i.stops[c-1][1];const d=Ba(i.stops.map(P=>P[0]),n),m=function(P,D,U,q){const G=q-U,J=P-U;return G===0?0:D===1?J/G:(Math.pow(D,J)-1)/(Math.pow(D,G)-1)}(n,o,i.stops[d][0],i.stops[d+1][0]),v=i.stops[d][1],T=i.stops[d+1][1],E=Hr[e.type]||Qu;return typeof v.evaluate=="function"?{evaluate(...P){const D=v.evaluate.apply(void 0,P),U=T.evaluate.apply(void 0,P);if(D!==void 0&&U!==void 0)return E(D,U,m,i.colorSpace)}}:E(v,T,m,i.colorSpace)}function vl(i,e,n){switch(e.type){case"color":n=Bt.parse(n);break;case"formatted":n=Xi.fromString(n.toString());break;case"resolvedImage":n=jr.fromString(n.toString());break;case"padding":n=Zr.parse(n);break;default:ci(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return ko(n,i.default,e.default)}Wr.register(Mo,{error:[{kind:"error"},[Lt],(i,[e])=>{throw new vn(e.evaluate(i))}],typeof:[Lt,[St],(i,[e])=>Si(yn(e.evaluate(i)))],"to-rgba":[an(nt,4),[gn],(i,[e])=>{const[n,o,c,d]=e.evaluate(i).rgb;return[255*n,255*o,255*c,d]}],rgb:[gn,[nt,nt,nt],Pr],rgba:[gn,[nt,nt,nt,nt],Pr],has:{type:Vt,overloads:[[[Lt],(i,[e])=>Qc(e.evaluate(i),i.properties())],[[Lt,_n],(i,[e,n])=>Qc(e.evaluate(i),n.evaluate(i))]]},get:{type:St,overloads:[[[Lt],(i,[e])=>kr(e.evaluate(i),i.properties())],[[Lt,_n],(i,[e,n])=>kr(e.evaluate(i),n.evaluate(i))]]},"feature-state":[St,[Lt],(i,[e])=>kr(e.evaluate(i),i.featureState||{})],properties:[_n,[],i=>i.properties()],"geometry-type":[Lt,[],i=>i.geometryType()],id:[St,[],i=>i.id()],zoom:[nt,[],i=>i.globals.zoom],"heatmap-density":[nt,[],i=>i.globals.heatmapDensity||0],"line-progress":[nt,[],i=>i.globals.lineProgress||0],accumulated:[St,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[nt,Po(nt),(i,e)=>{let n=0;for(const o of e)n+=o.evaluate(i);return n}],"*":[nt,Po(nt),(i,e)=>{let n=1;for(const o of e)n*=o.evaluate(i);return n}],"-":{type:nt,overloads:[[[nt,nt],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[nt],(i,[e])=>-e.evaluate(i)]]},"/":[nt,[nt,nt],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[nt,[nt,nt],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[nt,[],()=>Math.LN2],pi:[nt,[],()=>Math.PI],e:[nt,[],()=>Math.E],"^":[nt,[nt,nt],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[nt,[nt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[nt,[nt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[nt,[nt],(i,[e])=>Math.log(e.evaluate(i))],log2:[nt,[nt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[nt,[nt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[nt,[nt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[nt,[nt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[nt,[nt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[nt,[nt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[nt,[nt],(i,[e])=>Math.atan(e.evaluate(i))],min:[nt,Po(nt),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[nt,Po(nt),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[nt,[nt],(i,[e])=>Math.abs(e.evaluate(i))],round:[nt,[nt],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[nt,[nt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[nt,[nt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Vt,[Lt,St],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[Vt,[St],(i,[e])=>i.id()===e.value],"filter-type-==":[Vt,[Lt],(i,[e])=>i.geometryType()===e.value],"filter-<":[Vt,[Lt,St],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[Vt,[St],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[Vt,[Lt,St],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[Vt,[St],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[Vt,[Lt,St],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[Vt,[St],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[Vt,[Lt,St],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[Vt,[St],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[Vt,[St],(i,[e])=>e.value in i.properties()],"filter-has-id":[Vt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Vt,[an(Lt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Vt,[an(St)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Vt,[Lt,an(St)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Vt,[Lt,an(St)],(i,[e,n])=>function(o,c,d,m){for(;d<=m;){const v=d+m>>1;if(c[v]===o)return!0;c[v]>o?m=v-1:d=v+1}return!1}(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Vt,overloads:[[[Vt,Vt],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[Po(Vt),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:Vt,overloads:[[[Vt,Vt],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[Po(Vt),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[Vt,[Vt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Vt,[Lt],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[Lt,[Lt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Lt,[Lt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Lt,Po(St),(i,e)=>e.map(n=>oo(n.evaluate(i))).join("")],"resolved-locale":[Lt,[ir],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Oi{constructor(e,n){var o;this.expression=e,this._warningHistory={},this._evaluator=new Ii,this._defaultValue=n?(o=n).type==="color"&&na(o.default)?new Bt(0,0,0,0):o.type==="color"?Bt.parse(o.default)||null:o.type==="padding"?Zr.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?nr.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,c,d,m){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,c,d,m){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new vn(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function xl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Mo}function ti(i,e){const n=new To(Mo,ta,[],e?function(c){const d={color:gn,string:Lt,number:nt,enum:Lt,boolean:Vt,formatted:En,padding:Gn,resolvedImage:Zn,variableAnchorOffsetCollection:ys};return c.type==="array"?an(d[c.value]||St,c.length):d[c.type]}(e):void 0),o=n.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?fc(new Oi(o,e)):Kr(n.errors)}class ra{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!La(n.expression)}evaluateWithoutErrorHandling(e,n,o,c,d,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,d,m)}evaluate(e,n,o,c,d,m){return this._styleExpression.evaluate(e,n,o,c,d,m)}}class Ui{constructor(e,n,o,c){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!La(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,o,c,d,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,d,m)}evaluate(e,n,o,c,d,m){return this._styleExpression.evaluate(e,n,o,c,d,m)}interpolationFactor(e,n,o){return this.interpolationType?Xr.interpolationFactor(this.interpolationType,e,n,o):0}}function Ni(i,e){const n=ti(i,e);if(n.result==="error")return n;const o=n.value.expression,c=ul(o);if(!c&&!Gs(e))return Kr([new mn("","data expressions not supported")]);const d=Ra(o,["zoom"]);if(!d&&!_l(e))return Kr([new mn("","zoom expressions not supported")]);const m=Oa(o);return m||d?m instanceof mn?Kr([m]):m instanceof Xr&&!ji(e)?Kr([new mn("",'"interpolate" expressions cannot be used with this property')]):fc(m?new Ui(c?"camera":"composite",n.value,m.labels,m instanceof Xr?m.interpolation:void 0):new ra(c?"constant":"source",n.value)):Kr([new mn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class lo{constructor(e,n){this._parameters=e,this._specification=n,Dn(this,yl(this._parameters,this._specification))}static deserialize(e){return new lo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Oa(i){let e=null;if(i instanceof Ci)e=Oa(i.result);else if(i instanceof Fi){for(const n of i.args)if(e=Oa(n),e)break}else(i instanceof Ao||i instanceof Xr)&&i.input instanceof Wr&&i.input.name==="zoom"&&(e=i);return e instanceof mn||i.eachChild(n=>{const o=Oa(n);o instanceof mn?e=o:!e&&o?e=new mn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new mn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Ua(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Ua(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const gc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function _c(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Ua(i)||(i=zo(i));const e=ti(i,gc);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,c)=>e.value.evaluate(n,o,{},c),needGeometry:gr(i)}}function eu(i,e){return i<e?-1:i>e?1:0}function gr(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(gr(i[e]))return!0;return!1}function zo(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?co(i[1],i[2],"=="):e==="!="?wl(co(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?co(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(zo))):e==="all"?["all"].concat(i.slice(1).map(zo)):e==="none"?["all"].concat(i.slice(1).map(zo).map(wl)):e==="in"?bl(i[1],i.slice(2)):e==="!in"?wl(bl(i[1],i.slice(2))):e==="has"?Na(i[1]):e==="!has"?wl(Na(i[1])):e!=="within"||i;var n}function co(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function bl(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",i,["literal",e.sort(eu)]]:["filter-in-small",i,["literal",e]]}}function Na(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function wl(i){return["!",i]}function yc(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let c="[";for(const d of i)c+=`${yc(d)},`;return`${c}]`}const n=Object.keys(i).sort();let o="{";for(let c=0;c<n.length;c++)o+=`${JSON.stringify(n[c])}:${yc(i[n[c]])},`;return`${o}}`}function ih(i){let e="";for(const n of en)e+=`/${yc(i[n])}`;return e}function tu(i){const e=i.value;return e?[new Je(i.key,e,"constants have been deprecated as of v8")]:[]}function xn(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function us(i){if(Array.isArray(i))return i.map(us);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=us(i[n]);return e}return xn(i)}function hs(i){const e=i.key,n=i.value,o=i.valueSpec||{},c=i.objectElementValidators||{},d=i.style,m=i.styleSpec,v=i.validateSpec;let T=[];const E=ci(n);if(E!=="object")return[new Je(e,n,`object expected, ${E} found`)];for(const P in n){const D=P.split(".")[0],U=o[D]||o["*"];let q;if(c[D])q=c[D];else if(o[D])q=v;else if(c["*"])q=c["*"];else{if(!o["*"]){T.push(new Je(e,n[P],`unknown property "${P}"`));continue}q=v}T=T.concat(q({key:(e&&`${e}.`)+P,value:n[P],valueSpec:U,style:d,styleSpec:m,object:n,objectKey:P,validateSpec:v},n))}for(const P in o)c[P]||o[P].required&&o[P].default===void 0&&n[P]===void 0&&T.push(new Je(e,n,`missing required property "${P}"`));return T}function vc(i){const e=i.value,n=i.valueSpec,o=i.style,c=i.styleSpec,d=i.key,m=i.arrayElementValidator||i.validateSpec;if(ci(e)!=="array")return[new Je(d,e,`array expected, ${ci(e)} found`)];if(n.length&&e.length!==n.length)return[new Je(d,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Je(d,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let v={type:n.value,values:n.values};c.$version<7&&(v.function=n.function),ci(n.value)==="object"&&(v=n.value);let T=[];for(let E=0;E<e.length;E++)T=T.concat(m({array:e,arrayIndex:E,value:e[E],valueSpec:v,validateSpec:i.validateSpec,style:o,styleSpec:c,key:`${d}[${E}]`}));return T}function sa(i){const e=i.key,n=i.value,o=i.valueSpec;let c=ci(n);return c==="number"&&n!=n&&(c="NaN"),c!=="number"?[new Je(e,n,`number expected, ${c} found`)]:"minimum"in o&&n<o.minimum?[new Je(e,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Je(e,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function Tl(i){const e=i.valueSpec,n=xn(i.value.type);let o,c,d,m={};const v=n!=="categorical"&&i.value.property===void 0,T=!v,E=ci(i.value.stops)==="array"&&ci(i.value.stops[0])==="array"&&ci(i.value.stops[0][0])==="object",P=hs({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(q){if(n==="identity")return[new Je(q.key,q.value,'identity function may not have a "stops" property')];let G=[];const J=q.value;return G=G.concat(vc({key:q.key,value:J,valueSpec:q.valueSpec,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:D})),ci(J)==="array"&&J.length===0&&G.push(new Je(q.key,J,"array must have at least one stop")),G},default:function(q){return q.validateSpec({key:q.key,value:q.value,valueSpec:e,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec})}}});return n==="identity"&&v&&P.push(new Je(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||P.push(new Je(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!ji(i.valueSpec)&&P.push(new Je(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(T&&!Gs(i.valueSpec)?P.push(new Je(i.key,i.value,"property functions not supported")):v&&!_l(i.valueSpec)&&P.push(new Je(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!E||i.value.property!==void 0||P.push(new Je(i.key,i.value,'"property" property is required')),P;function D(q){let G=[];const J=q.value,ne=q.key;if(ci(J)!=="array")return[new Je(ne,J,`array expected, ${ci(J)} found`)];if(J.length!==2)return[new Je(ne,J,`array length 2 expected, length ${J.length} found`)];if(E){if(ci(J[0])!=="object")return[new Je(ne,J,`object expected, ${ci(J[0])} found`)];if(J[0].zoom===void 0)return[new Je(ne,J,"object stop key must have zoom")];if(J[0].value===void 0)return[new Je(ne,J,"object stop key must have value")];if(d&&d>xn(J[0].zoom))return[new Je(ne,J[0].zoom,"stop zoom values must appear in ascending order")];xn(J[0].zoom)!==d&&(d=xn(J[0].zoom),c=void 0,m={}),G=G.concat(hs({key:`${ne}[0]`,value:J[0],valueSpec:{zoom:{}},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:sa,value:U}}))}else G=G.concat(U({key:`${ne}[0]`,value:J[0],valueSpec:{},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec},J));return xl(us(J[1]))?G.concat([new Je(`${ne}[1]`,J[1],"expressions are not allowed in function stops.")]):G.concat(q.validateSpec({key:`${ne}[1]`,value:J[1],valueSpec:e,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec}))}function U(q,G){const J=ci(q.value),ne=xn(q.value),oe=q.value!==null?q.value:G;if(o){if(J!==o)return[new Je(q.key,oe,`${J} stop domain type must match previous stop domain type ${o}`)]}else o=J;if(J!=="number"&&J!=="string"&&J!=="boolean")return[new Je(q.key,oe,"stop domain value must be a number, string, or boolean")];if(J!=="number"&&n!=="categorical"){let me=`number expected, ${J} found`;return Gs(e)&&n===void 0&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Je(q.key,oe,me)]}return n!=="categorical"||J!=="number"||isFinite(ne)&&Math.floor(ne)===ne?n!=="categorical"&&J==="number"&&c!==void 0&&ne<c?[new Je(q.key,oe,"stop domain values must appear in ascending order")]:(c=ne,n==="categorical"&&ne in m?[new Je(q.key,oe,"stop domain values must be unique")]:(m[ne]=!0,[])):[new Je(q.key,oe,`integer expected, found ${ne}`)]}}function rr(i){const e=(i.expressionContext==="property"?Ni:ti)(us(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new Je(`${i.key}${o.key}`,i.value,o.message));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Je(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!La(n))return[new Je(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!La(n))return[new Je(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ra(n,["zoom","feature-state"]))return[new Je(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ul(n))return[new Je(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function uo(i){const e=i.key,n=i.value,o=i.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(xn(n))===-1&&c.push(new Je(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(xn(n))===-1&&c.push(new Je(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function Sl(i){return Ua(us(i.value))?rr(Dn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):iu(i)}function iu(i){const e=i.value,n=i.key;if(ci(e)!=="array")return[new Je(n,e,`array expected, ${ci(e)} found`)];const o=i.styleSpec;let c,d=[];if(e.length<1)return[new Je(n,e,"filter array must have at least 1 element")];switch(d=d.concat(uo({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),xn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&xn(e[1])==="$type"&&d.push(new Je(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new Je(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=ci(e[1]),c!=="string"&&d.push(new Je(`${n}[1]`,e[1],`string expected, ${c} found`)));for(let m=2;m<e.length;m++)c=ci(e[m]),xn(e[1])==="$type"?d=d.concat(uo({key:`${n}[${m}]`,value:e[m],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&d.push(new Je(`${n}[${m}]`,e[m],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)d=d.concat(iu({key:`${n}[${m}]`,value:e[m],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=ci(e[1]),e.length!==2?d.push(new Je(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&d.push(new Je(`${n}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=ci(e[1]),e.length!==2?d.push(new Je(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&d.push(new Je(`${n}[1]`,e[1],`object expected, ${c} found`))}return d}function El(i,e){const n=i.key,o=i.validateSpec,c=i.style,d=i.styleSpec,m=i.value,v=i.objectKey,T=d[`${e}_${i.layerType}`];if(!T)return[];const E=v.match(/^(.*)-transition$/);if(e==="paint"&&E&&T[E[1]]&&T[E[1]].transition)return o({key:n,value:m,valueSpec:d.transition,style:c,styleSpec:d});const P=i.valueSpec||T[v];if(!P)return[new Je(n,m,`unknown property "${v}"`)];let D;if(ci(m)==="string"&&Gs(P)&&!P.tokens&&(D=/^{([^}]+)}$/.exec(m)))return[new Je(n,m,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(D[1])} }\`.`)];const U=[];return i.layerType==="symbol"&&(v==="text-field"&&c&&!c.glyphs&&U.push(new Je(n,m,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&na(us(m))&&xn(m.type)==="identity"&&U.push(new Je(n,m,'"text-font" does not support identity functions'))),U.concat(o({key:i.key,value:m,valueSpec:P,style:c,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:v}))}function Rs(i){return El(i,"paint")}function zr(i){return El(i,"layout")}function $a(i){let e=[];const n=i.value,o=i.key,c=i.style,d=i.styleSpec;n.type||n.ref||e.push(new Je(o,n,'either "type" or "ref" is required'));let m=xn(n.type);const v=xn(n.ref);if(n.id){const T=xn(n.id);for(let E=0;E<i.arrayIndex;E++){const P=c.layers[E];xn(P.id)===T&&e.push(new Je(o,n.id,`duplicate layer id "${n.id}", previously used at line ${P.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach(E=>{E in n&&e.push(new Je(o,n[E],`"${E}" is prohibited for ref layers`))}),c.layers.forEach(E=>{xn(E.id)===v&&(T=E)}),T?T.ref?e.push(new Je(o,n.ref,"ref cannot reference another ref layer")):m=xn(T.type):e.push(new Je(o,n.ref,`ref layer "${v}" not found`))}else if(m!=="background")if(n.source){const T=c.sources&&c.sources[n.source],E=T&&xn(T.type);T?E==="vector"&&m==="raster"?e.push(new Je(o,n.source,`layer "${n.id}" requires a raster source`)):E==="raster"&&m!=="raster"?e.push(new Je(o,n.source,`layer "${n.id}" requires a vector source`)):E!=="vector"||n["source-layer"]?E==="raster-dem"&&m!=="hillshade"?e.push(new Je(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!n.paint||!n.paint["line-gradient"]||E==="geojson"&&T.lineMetrics||e.push(new Je(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Je(o,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Je(o,n.source,`source "${n.source}" not found`))}else e.push(new Je(o,n,'missing required property "source"'));return e=e.concat(hs({key:o,value:n,valueSpec:d.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:n.type,valueSpec:d.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:Sl,layout:T=>hs({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":E=>zr(Dn({layerType:m},E))}}),paint:T=>hs({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":E=>Rs(Dn({layerType:m},E))}})}})),e}function Do(i){const e=i.value,n=i.key,o=ci(e);return o!=="string"?[new Je(n,e,`string expected, ${o} found`)]:[]}const Va={promoteId:function({key:i,value:e}){if(ci(e)==="string")return Do({key:i,value:e});{const n=[];for(const o in e)n.push(...Do({key:`${i}.${o}`,value:e[o]}));return n}}};function nu(i){const e=i.value,n=i.key,o=i.styleSpec,c=i.style,d=i.validateSpec;if(!e.type)return[new Je(n,e,'"type" is required')];const m=xn(e.type);let v;switch(m){case"vector":case"raster":case"raster-dem":return v=hs({key:n,value:e,valueSpec:o[`source_${m.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:Va,validateSpec:d}),v;case"geojson":if(v=hs({key:n,value:e,valueSpec:o.source_geojson,style:c,styleSpec:o,validateSpec:d,objectElementValidators:Va}),e.cluster)for(const T in e.clusterProperties){const[E,P]=e.clusterProperties[T],D=typeof E=="string"?[E,["accumulated"],["get",T]]:E;v.push(...rr({key:`${n}.${T}.map`,value:P,validateSpec:d,expressionContext:"cluster-map"})),v.push(...rr({key:`${n}.${T}.reduce`,value:D,validateSpec:d,expressionContext:"cluster-reduce"}))}return v;case"video":return hs({key:n,value:e,valueSpec:o.source_video,style:c,validateSpec:d,styleSpec:o});case"image":return hs({key:n,value:e,valueSpec:o.source_image,style:c,validateSpec:d,styleSpec:o});case"canvas":return[new Je(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return uo({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,validateSpec:d,styleSpec:o})}}function ru(i){const e=i.value,n=i.styleSpec,o=n.light,c=i.style;let d=[];const m=ci(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new Je("light",e,`object expected, ${m} found`)]),d;for(const v in e){const T=v.match(/^(.*)-transition$/);d=d.concat(T&&o[T[1]]&&o[T[1]].transition?i.validateSpec({key:v,value:e[v],valueSpec:n.transition,validateSpec:i.validateSpec,style:c,styleSpec:n}):o[v]?i.validateSpec({key:v,value:e[v],valueSpec:o[v],validateSpec:i.validateSpec,style:c,styleSpec:n}):[new Je(v,e[v],`unknown property "${v}"`)])}return d}function su(i){const e=i.value,n=i.styleSpec,o=n.terrain,c=i.style;let d=[];const m=ci(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new Je("terrain",e,`object expected, ${m} found`)]),d;for(const v in e)d=d.concat(o[v]?i.validateSpec({key:v,value:e[v],valueSpec:o[v],validateSpec:i.validateSpec,style:c,styleSpec:n}):[new Je(v,e[v],`unknown property "${v}"`)]);return d}function Lo(i){let e=[];const n=i.value,o=i.key;if(Array.isArray(n)){const c=[],d=[];for(const m in n)n[m].id&&c.includes(n[m].id)&&e.push(new Je(o,n,`all the sprites' ids must be unique, but ${n[m].id} is duplicated`)),c.push(n[m].id),n[m].url&&d.includes(n[m].url)&&e.push(new Je(o,n,`all the sprites' URLs must be unique, but ${n[m].url} is duplicated`)),d.push(n[m].url),e=e.concat(hs({key:`${o}[${m}]`,value:n[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return Do({key:o,value:n})}const ye={"*":()=>[],array:vc,boolean:function(i){const e=i.value,n=i.key,o=ci(e);return o!=="boolean"?[new Je(n,e,`boolean expected, ${o} found`)]:[]},number:sa,color:function(i){const e=i.key,n=i.value,o=ci(n);return o!=="string"?[new Je(e,n,`color expected, ${o} found`)]:Bt.parse(String(n))?[]:[new Je(e,n,`color expected, "${n}" found`)]},constants:tu,enum:uo,filter:Sl,function:Tl,layer:$a,object:hs,source:nu,light:ru,terrain:su,string:Do,formatted:function(i){return Do(i).length===0?[]:rr(i)},resolvedImage:function(i){return Do(i).length===0?[]:rr(i)},padding:function(i){const e=i.key,n=i.value;if(ci(n)==="array"){if(n.length<1||n.length>4)return[new Je(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let c=[];for(let d=0;d<n.length;d++)c=c.concat(i.validateSpec({key:`${e}[${d}]`,value:n[d],validateSpec:i.validateSpec,valueSpec:o}));return c}return sa({key:e,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,n=i.value,o=ci(n),c=i.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new Je(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let m=0;m<n.length;m+=2)d=d.concat(uo({key:`${e}[${m}]`,value:n[m],valueSpec:c.layout_symbol["text-anchor"]})),d=d.concat(vc({key:`${e}[${m+1}]`,value:n[m+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:c}));return d},sprite:Lo};function ze(i){const e=i.value,n=i.valueSpec,o=i.styleSpec;return i.validateSpec=ze,n.expression&&na(xn(e))?Tl(i):n.expression&&xl(us(e))?rr(i):n.type&&ye[n.type]?ye[n.type](i):hs(Dn({},i,{valueSpec:n.type?o[n.type]:n}))}function Pe(i){const e=i.value,n=i.key,o=Do(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Je(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Je(n,e,'"glyphs" url must include a "{range}" token'))),o}function ct(i,e=ke){let n=[];return n=n.concat(ze({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:ze,objectElementValidators:{glyphs:Pe,"*":()=>[]}})),i.constants&&(n=n.concat(tu({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:ze}))),Ei(n)}function Ft(i){return function(e){return i({...e,validateSpec:ze})}}function Ei(i){return[].concat(i).sort((e,n)=>e.line-n.line)}function qi(i){return function(...e){return Ei(i.apply(this,e))}}ct.source=qi(Ft(nu)),ct.sprite=qi(Ft(Lo)),ct.glyphs=qi(Ft(Pe)),ct.light=qi(Ft(ru)),ct.terrain=qi(Ft(su)),ct.layer=qi(Ft($a)),ct.filter=qi(Ft(Sl)),ct.paintProperty=qi(Ft(Rs)),ct.layoutProperty=qi(Ft(zr));const Mi=ct,Ro=Mi.light,nh=Mi.paintProperty,Dr=Mi.layoutProperty;function qa(i,e){let n=!1;if(e&&e.length)for(const o of e)i.fire(new On(new Error(o.message))),n=!0;return n}class Bo{constructor(e,n,o){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const m=new Int32Array(this.arrayBuffer);e=m[0],this.d=(n=m[1])+2*(o=m[2]);for(let T=0;T<this.d*this.d;T++){const E=m[3+T],P=m[3+T+1];c.push(E===P?null:m.subarray(E,P))}const v=m[3+c.length+1];this.keys=m.subarray(m[3+c.length],v),this.bboxes=m.subarray(v),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let m=0;m<this.d*this.d;m++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=o,this.scale=n/e,this.uid=0;const d=o/n*e;this.min=-d,this.max=e+d}insert(e,n,o,c,d){this._forEachCell(n,o,c,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,o,c,d,m){this.cells[d].push(m)}query(e,n,o,c,d){const m=this.min,v=this.max;if(e<=m&&n<=m&&v<=o&&v<=c&&!d)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(e,n,o,c,this._queryCell,T,{},d),T}}_queryCell(e,n,o,c,d,m,v,T){const E=this.cells[d];if(E!==null){const P=this.keys,D=this.bboxes;for(let U=0;U<E.length;U++){const q=E[U];if(v[q]===void 0){const G=4*q;(T?T(D[G+0],D[G+1],D[G+2],D[G+3]):e<=D[G+2]&&n<=D[G+3]&&o>=D[G+0]&&c>=D[G+1])?(v[q]=!0,m.push(P[q])):v[q]=!1}}}}_forEachCell(e,n,o,c,d,m,v,T){const E=this._convertToCellCoord(e),P=this._convertToCellCoord(n),D=this._convertToCellCoord(o),U=this._convertToCellCoord(c);for(let q=E;q<=D;q++)for(let G=P;G<=U;G++){const J=this.d*G+q;if((!T||T(this._convertFromCellCoord(q),this._convertFromCellCoord(G),this._convertFromCellCoord(q+1),this._convertFromCellCoord(G+1)))&&d.call(this,e,n,o,c,J,m,v,T))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let o=0;for(let m=0;m<this.cells.length;m++)o+=this.cells[m].length;const c=new Int32Array(n+o+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let d=n;for(let m=0;m<e.length;m++){const v=e[m];c[3+m]=d,c.set(v,d),d+=v.length}return c[3+e.length]=d,c.set(this.keys,d),d+=this.keys.length,c[3+e.length+1]=d,c.set(this.bboxes,d),d+=this.bboxes.length,c.buffer}static serialize(e,n){const o=e.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(e){return new Bo(e.buffer)}}const Yr={};function dt(i,e,n={}){if(Yr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Yr[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}dt("Object",Object),dt("TransferableGridIndex",Bo),dt("Color",Bt),dt("Error",Error),dt("AJAXError",ei),dt("ResolvedImage",jr),dt("StylePropertyFunction",lo),dt("StyleExpression",Oi,{omit:["_evaluator"]}),dt("ZoomDependentExpression",Ui),dt("ZoomConstantExpression",ra),dt("CompoundExpression",Wr,{omit:["_evaluate"]});for(const i in Mo)Mo[i]._classRegistryKey||dt(`Expression_${i}`,Mo[i]);function Ga(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function mi(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Ga(i)||jt(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return e&&e.push(n.buffer),n}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const o of i)n.push(mi(o,e));return n}if(typeof i=="object"){const n=i.constructor,o=n._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");if(!Yr[o])throw new Error(`${o} is not registered.`);const c=n.serialize?n.serialize(i,e):{};if(n.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in i){if(!i.hasOwnProperty(d)||Yr[o].omit.indexOf(d)>=0)continue;const m=i[d];c[d]=Yr[o].shallow.indexOf(d)>=0?m:mi(m,e)}i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof i)}function oa(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Ga(i)||jt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(oa);if(typeof i=="object"){const e=i.$name||"Object";if(!Yr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=Yr[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const c of Object.keys(i)){if(c==="$name")continue;const d=i[c];o[c]=Yr[e].shallow.indexOf(c)>=0?d:oa(d)}return o}throw new Error("can't deserialize object of type "+typeof i)}class Za{constructor(){this.first=!0}update(e,n){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const ht={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Al(i){for(const e of i)if(Zs(e.charCodeAt(0)))return!0;return!1}function rh(i){for(const e of i)if(!xc(e.charCodeAt(0)))return!1;return!0}function xc(i){return!(ht.Arabic(i)||ht["Arabic Supplement"](i)||ht["Arabic Extended-A"](i)||ht["Arabic Presentation Forms-A"](i)||ht["Arabic Presentation Forms-B"](i))}function Zs(i){return!(i!==746&&i!==747&&(i<4352||!(ht["Bopomofo Extended"](i)||ht.Bopomofo(i)||ht["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||ht["CJK Compatibility Ideographs"](i)||ht["CJK Compatibility"](i)||ht["CJK Radicals Supplement"](i)||ht["CJK Strokes"](i)||!(!ht["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||ht["CJK Unified Ideographs Extension A"](i)||ht["CJK Unified Ideographs"](i)||ht["Enclosed CJK Letters and Months"](i)||ht["Hangul Compatibility Jamo"](i)||ht["Hangul Jamo Extended-A"](i)||ht["Hangul Jamo Extended-B"](i)||ht["Hangul Jamo"](i)||ht["Hangul Syllables"](i)||ht.Hiragana(i)||ht["Ideographic Description Characters"](i)||ht.Kanbun(i)||ht["Kangxi Radicals"](i)||ht["Katakana Phonetic Extensions"](i)||ht.Katakana(i)&&i!==12540||!(!ht["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!ht["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||ht["Unified Canadian Aboriginal Syllabics"](i)||ht["Unified Canadian Aboriginal Syllabics Extended"](i)||ht["Vertical Forms"](i)||ht["Yijing Hexagram Symbols"](i)||ht["Yi Syllables"](i)||ht["Yi Radicals"](i))))}function Bs(i){return!(Zs(i)||function(e){return!!(ht["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ht["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ht["Letterlike Symbols"](e)||ht["Number Forms"](e)||ht["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ht["Control Pictures"](e)&&e!==9251||ht["Optical Character Recognition"](e)||ht["Enclosed Alphanumerics"](e)||ht["Geometric Shapes"](e)||ht["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ht["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ht["CJK Symbols and Punctuation"](e)||ht.Katakana(e)||ht["Private Use Area"](e)||ht["CJK Compatibility Forms"](e)||ht["Small Form Variants"](e)||ht["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function ja(i){return i>=1424&&i<=2303||ht["Arabic Presentation Forms-A"](i)||ht["Arabic Presentation Forms-B"](i)}function bc(i,e){return!(!e&&ja(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||ht.Khmer(i))}function Il(i){for(const e of i)if(ja(e.charCodeAt(0)))return!0;return!1}const aa="deferred",Cl="loading",la="loaded";let Ml=null,Un="unavailable",_r=null;const Wa=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Un="error"),Ml&&Ml(i)};function wc(){Tc.fire(new on("pluginStateChange",{pluginStatus:Un,pluginURL:_r}))}const Tc=new dr,Sc=function(){return Un},Ha=function(){if(Un!==aa||!_r)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Un=Cl,wc(),_r&&ss({url:_r},i=>{i?Wa(i):(Un=la,wc())})},yr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Un===la||yr.applyArabicShaping!=null,isLoading:()=>Un===Cl,setState(i){if(!kt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Un=i.pluginStatus,_r=i.pluginURL},isParsed(){if(!kt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return yr.applyArabicShaping!=null&&yr.processBidirectionalText!=null&&yr.processStyledBidirectionalText!=null},getPluginURL(){if(!kt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return _r}};class Gi{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Za,this.transition={})}isSupportedScript(e){return function(n,o){for(const c of n)if(!bc(c.charCodeAt(0),o))return!1;return!0}(e,yr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class Fo{constructor(e,n){this.property=e,this.value=n,this.expression=function(o,c){if(na(o))return new lo(o,c);if(xl(o)){const d=Ni(o,c);if(d.result==="error")throw new Error(d.value.map(m=>`${m.key}: ${m.message}`).join(", "));return d.value}{let d=o;return c.type==="color"&&typeof o=="string"?d=Bt.parse(o):c.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(d=nr.parse(o)):d=Zr.parse(o),{kind:"constant",evaluate:()=>d}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class Pl{constructor(e){this.property=e,this.value=new Fo(e,void 0)}transitioned(e,n){return new ou(this.property,this.value,n,Ve({},e.transition,this.transition),e.now)}untransitioned(){return new ou(this.property,this.value,null,{},0)}}class kl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return ut(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Pl(this._values[e].property)),this._values[e].value=new Fo(this._values[e].property,n===null?void 0:ut(n))}getTransition(e){return ut(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Pl(this._values[e].property)),this._values[e].transition=ut(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o);const c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){const o=new An(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,n._values[c]);return o}untransitioned(){const e=new An(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class ou{constructor(e,n,o,c,d){this.property=e,this.value=n,this.begin=d+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){const c=e.now||0,d=this.value.possiblyEvaluate(e,n,o),m=this.prior;if(m){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return m.possiblyEvaluate(e,n,o);{const v=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,n,o),d,function(T){if(T<=0)return 0;if(T>=1)return 1;const E=T*T,P=E*T;return 4*(T<.5?P:3*(T-E)+P-.75)}(v))}}return d}}class An{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){const c=new zl(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,n,o);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Hn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return ut(this._values[e].value)}setValue(e,n){this._values[e]=new Fo(this._values[e].property,n===null?void 0:ut(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){const c=new zl(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,n,o);return c}}class vs{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,c){return this.property.evaluate(this.value,this.parameters,e,n,o,c)}}class zl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class bt{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,o){const c=Hr[this.specification.type];return c?c(e,n,o):e}}class zt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,c){return new vs(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,c)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new vs(this,{kind:"constant",value:void 0},e.parameters);const c=Hr[this.specification.type];if(c){const d=c(e.value.value,n.value.value,o);return new vs(this,{kind:"constant",value:d},e.parameters)}return e}evaluate(e,n,o,c,d,m){return e.kind==="constant"?e.value:e.evaluate(n,o,c,d,m)}}class ca extends zt{possiblyEvaluate(e,n,o,c){if(e.value===void 0)return new vs(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const d=e.expression.evaluate(n,null,{},o,c),m=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,v=this._calculate(m,m,m,n);return new vs(this,{kind:"constant",value:v},n)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new vs(this,{kind:"constant",value:d},n)}return new vs(this,e.expression,n)}evaluate(e,n,o,c,d,m){if(e.kind==="source"){const v=e.evaluate(n,o,c,d,m);return this._calculate(v,v,v,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},o,c),e.evaluate({zoom:Math.floor(n.zoom)},o,c),e.evaluate({zoom:Math.floor(n.zoom)+1},o,c),n):e.value}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class Oo{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(n,null,{},o,c);return this._calculate(d,d,d,n)}return this._calculate(e.expression.evaluate(new Gi(Math.floor(n.zoom-1),n)),e.expression.evaluate(new Gi(Math.floor(n.zoom),n)),e.expression.evaluate(new Gi(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class Xa{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){return!!e.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class Ki{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const o=e[n];o.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new Fo(o,void 0),d=this.defaultTransitionablePropertyValues[n]=new Pl(o);this.defaultTransitioningPropertyValues[n]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}dt("DataDrivenProperty",zt),dt("DataConstantProperty",bt),dt("CrossFadedDataDrivenProperty",ca),dt("CrossFadedProperty",Oo),dt("ColorRampProperty",Xa);const ua="-transition";class Lr extends dr{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new Hn(n.layout)),n.paint)){this._transitionablePaint=new kl(n.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new zl(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,o={}){n!=null&&this._validate(Dr,`layers.${this.id}.layout.${e}`,e,n,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(ua)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,o={}){if(n!=null&&this._validate(nh,`layers.${this.id}.paint.${e}`,e,n,o))return!1;if(e.endsWith(ua))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const c=this._transitionablePaint._values[e],d=c.property.specification["property-type"]==="cross-faded-data-driven",m=c.value.isDataDriven(),v=c.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||m||d||this._handleOverridablePaintPropertyUpdate(e,v,T)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),je(e,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(e,n,o,c,d={}){return(!d||d.validate!==!1)&&qa(this,e.call(Mi,{key:n,layerType:this.type,objectKey:o,value:c,styleSpec:ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof vs&&Gs(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const Dl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class xs{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class nn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function bn(i,e=1){let n=0,o=0;return{members:i.map(c=>{const d=Dl[c.type].BYTES_PER_ELEMENT,m=n=js(n,Math.max(e,d)),v=c.components||1;return o=Math.max(o,d),n+=d*v,{name:c.name,type:c.type,components:v,offset:m}}),size:js(n,Math.max(o,e)),alignment:e}}function js(i,e){return Math.ceil(i/e)*e}class ha extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.int16[c+0]=n,this.int16[c+1]=o,e}}ha.prototype.bytesPerElement=4,dt("StructArrayLayout2i4",ha);class pa extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const d=3*e;return this.int16[d+0]=n,this.int16[d+1]=o,this.int16[d+2]=c,e}}pa.prototype.bytesPerElement=6,dt("StructArrayLayout3i6",pa);class Uo extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,c)}emplace(e,n,o,c,d){const m=4*e;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=c,this.int16[m+3]=d,e}}Uo.prototype.bytesPerElement=8,dt("StructArrayLayout4i8",Uo);class Ws extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,o,c,d,m)}emplace(e,n,o,c,d,m,v){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=c,this.int16[T+3]=d,this.int16[T+4]=m,this.int16[T+5]=v,e}}Ws.prototype.bytesPerElement=12,dt("StructArrayLayout2i4i12",Ws);class Ll extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,o,c,d,m)}emplace(e,n,o,c,d,m,v){const T=4*e,E=8*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.uint8[E+4]=c,this.uint8[E+5]=d,this.uint8[E+6]=m,this.uint8[E+7]=v,e}}Ll.prototype.bytesPerElement=8,dt("StructArrayLayout2i4ub8",Ll);class Z extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.float32[c+0]=n,this.float32[c+1]=o,e}}Z.prototype.bytesPerElement=8,dt("StructArrayLayout2f8",Z);class ps extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,m,v,T,E,P){const D=this.length;return this.resize(D+1),this.emplace(D,e,n,o,c,d,m,v,T,E,P)}emplace(e,n,o,c,d,m,v,T,E,P,D){const U=10*e;return this.uint16[U+0]=n,this.uint16[U+1]=o,this.uint16[U+2]=c,this.uint16[U+3]=d,this.uint16[U+4]=m,this.uint16[U+5]=v,this.uint16[U+6]=T,this.uint16[U+7]=E,this.uint16[U+8]=P,this.uint16[U+9]=D,e}}ps.prototype.bytesPerElement=20,dt("StructArrayLayout10ui20",ps);class da extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,m,v,T,E,P,D,U){const q=this.length;return this.resize(q+1),this.emplace(q,e,n,o,c,d,m,v,T,E,P,D,U)}emplace(e,n,o,c,d,m,v,T,E,P,D,U,q){const G=12*e;return this.int16[G+0]=n,this.int16[G+1]=o,this.int16[G+2]=c,this.int16[G+3]=d,this.uint16[G+4]=m,this.uint16[G+5]=v,this.uint16[G+6]=T,this.uint16[G+7]=E,this.int16[G+8]=P,this.int16[G+9]=D,this.int16[G+10]=U,this.int16[G+11]=q,e}}da.prototype.bytesPerElement=24,dt("StructArrayLayout4i4ui4i24",da);class vr extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const d=3*e;return this.float32[d+0]=n,this.float32[d+1]=o,this.float32[d+2]=c,e}}vr.prototype.bytesPerElement=12,dt("StructArrayLayout3f12",vr);class Jt extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Jt.prototype.bytesPerElement=4,dt("StructArrayLayout1ul4",Jt);class Ec extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,m,v,T,E){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,o,c,d,m,v,T,E)}emplace(e,n,o,c,d,m,v,T,E,P){const D=10*e,U=5*e;return this.int16[D+0]=n,this.int16[D+1]=o,this.int16[D+2]=c,this.int16[D+3]=d,this.int16[D+4]=m,this.int16[D+5]=v,this.uint32[U+3]=T,this.uint16[D+8]=E,this.uint16[D+9]=P,e}}Ec.prototype.bytesPerElement=20,dt("StructArrayLayout6i1ul2ui20",Ec);class Ac extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,o,c,d,m)}emplace(e,n,o,c,d,m,v){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=c,this.int16[T+3]=d,this.int16[T+4]=m,this.int16[T+5]=v,e}}Ac.prototype.bytesPerElement=12,dt("StructArrayLayout2i2i2i12",Ac);class Rl extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,o,c,d)}emplace(e,n,o,c,d,m){const v=4*e,T=8*e;return this.float32[v+0]=n,this.float32[v+1]=o,this.float32[v+2]=c,this.int16[T+6]=d,this.int16[T+7]=m,e}}Rl.prototype.bytesPerElement=16,dt("StructArrayLayout2f1f2i16",Rl);class Hs extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,c)}emplace(e,n,o,c,d){const m=12*e,v=3*e;return this.uint8[m+0]=n,this.uint8[m+1]=o,this.float32[v+1]=c,this.float32[v+2]=d,e}}Hs.prototype.bytesPerElement=12,dt("StructArrayLayout2ub2f12",Hs);class Bl extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const d=3*e;return this.uint16[d+0]=n,this.uint16[d+1]=o,this.uint16[d+2]=c,e}}Bl.prototype.bytesPerElement=6,dt("StructArrayLayout3ui6",Bl);class bi extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,m,v,T,E,P,D,U,q,G,J,ne,oe){const me=this.length;return this.resize(me+1),this.emplace(me,e,n,o,c,d,m,v,T,E,P,D,U,q,G,J,ne,oe)}emplace(e,n,o,c,d,m,v,T,E,P,D,U,q,G,J,ne,oe,me){const he=24*e,be=12*e,Ie=48*e;return this.int16[he+0]=n,this.int16[he+1]=o,this.uint16[he+2]=c,this.uint16[he+3]=d,this.uint32[be+2]=m,this.uint32[be+3]=v,this.uint32[be+4]=T,this.uint16[he+10]=E,this.uint16[he+11]=P,this.uint16[he+12]=D,this.float32[be+7]=U,this.float32[be+8]=q,this.uint8[Ie+36]=G,this.uint8[Ie+37]=J,this.uint8[Ie+38]=ne,this.uint32[be+10]=oe,this.int16[he+22]=me,e}}bi.prototype.bytesPerElement=48,dt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",bi);class p extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,m,v,T,E,P,D,U,q,G,J,ne,oe,me,he,be,Ie,Be,pt,ot,Xe,lt,st,mt){const at=this.length;return this.resize(at+1),this.emplace(at,e,n,o,c,d,m,v,T,E,P,D,U,q,G,J,ne,oe,me,he,be,Ie,Be,pt,ot,Xe,lt,st,mt)}emplace(e,n,o,c,d,m,v,T,E,P,D,U,q,G,J,ne,oe,me,he,be,Ie,Be,pt,ot,Xe,lt,st,mt,at){const He=32*e,At=16*e;return this.int16[He+0]=n,this.int16[He+1]=o,this.int16[He+2]=c,this.int16[He+3]=d,this.int16[He+4]=m,this.int16[He+5]=v,this.int16[He+6]=T,this.int16[He+7]=E,this.uint16[He+8]=P,this.uint16[He+9]=D,this.uint16[He+10]=U,this.uint16[He+11]=q,this.uint16[He+12]=G,this.uint16[He+13]=J,this.uint16[He+14]=ne,this.uint16[He+15]=oe,this.uint16[He+16]=me,this.uint16[He+17]=he,this.uint16[He+18]=be,this.uint16[He+19]=Ie,this.uint16[He+20]=Be,this.uint16[He+21]=pt,this.uint16[He+22]=ot,this.uint32[At+12]=Xe,this.float32[At+13]=lt,this.float32[At+14]=st,this.uint16[He+30]=mt,this.uint16[He+31]=at,e}}p.prototype.bytesPerElement=64,dt("StructArrayLayout8i15ui1ul2f2ui64",p);class t extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}t.prototype.bytesPerElement=4,dt("StructArrayLayout1f4",t);class r extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const d=3*e;return this.uint16[6*e+0]=n,this.float32[d+1]=o,this.float32[d+2]=c,e}}r.prototype.bytesPerElement=12,dt("StructArrayLayout1ui2f12",r);class l extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const d=4*e;return this.uint32[2*e+0]=n,this.uint16[d+2]=o,this.uint16[d+3]=c,e}}l.prototype.bytesPerElement=8,dt("StructArrayLayout1ul2ui8",l);class h extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=o,e}}h.prototype.bytesPerElement=4,dt("StructArrayLayout2ui4",h);class f extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}f.prototype.bytesPerElement=2,dt("StructArrayLayout1ui2",f);class x extends nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,c)}emplace(e,n,o,c,d){const m=4*e;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,this.float32[m+3]=d,e}}x.prototype.bytesPerElement=16,dt("StructArrayLayout4f16",x);class w extends xs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ee(this.anchorPointX,this.anchorPointY)}}w.prototype.size=20;class S extends Ec{get(e){return new w(this,e)}}dt("CollisionBoxArray",S);class A extends xs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}A.prototype.size=48;class k extends bi{get(e){return new A(this,e)}}dt("PlacedSymbolArray",k);class z extends xs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}z.prototype.size=64;class $ extends p{get(e){return new z(this,e)}}dt("SymbolInstanceArray",$);class Y extends t{getoffsetX(e){return this.float32[1*e+0]}}dt("GlyphOffsetArray",Y);class K extends pa{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}dt("SymbolLineVertexArray",K);class Q extends xs{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Q.prototype.size=12;class X extends r{get(e){return new Q(this,e)}}dt("TextAnchorOffsetArray",X);class pe extends xs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}pe.prototype.size=8;class xe extends l{get(e){return new pe(this,e)}}dt("FeatureIndexArray",xe);class re extends ha{}class fe extends ha{}class Ce extends ha{}class Me extends Ws{}class Re extends Ll{}class We extends Z{}class Oe extends ps{}class tt extends da{}class vt extends vr{}class Qt extends Jt{}class rt extends Ac{}class It extends Hs{}class gt extends Bl{}class $i extends h{}const ii=bn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ot}=ii;class Pt{constructor(e=[]){this.segments=e}prepareSegment(e,n,o,c){let d=this.segments[this.segments.length-1];return e>Pt.MAX_VERTEX_ARRAY_LENGTH&&Dt(`Max vertices per segment is ${Pt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>Pt.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c)&&(d={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(d.sortKey=c),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,c){return new Pt([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function Vi(i,e){return 256*(i=Ze(Math.floor(i),0,255))+Ze(Math.floor(e),0,255)}Pt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,dt("SegmentVector",Pt);const ni=bn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var xr={exports:{}},Ln={exports:{}};Ln.exports=function(i,e){var n,o,c,d,m,v,T,E;for(o=i.length-(n=3&i.length),c=e,m=3432918353,v=461845907,E=0;E<o;)T=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,c=27492+(65535&(d=5*(65535&(c=(c^=T=(65535&(T=(T=(65535&T)*m+(((T>>>16)*m&65535)<<16)&4294967295)<<15|T>>>17))*v+(((T>>>16)*v&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(T=0,n){case 3:T^=(255&i.charCodeAt(E+2))<<16;case 2:T^=(255&i.charCodeAt(E+1))<<8;case 1:c^=T=(65535&(T=(T=(65535&(T^=255&i.charCodeAt(E)))*m+(((T>>>16)*m&65535)<<16)&4294967295)<<15|T>>>17))*v+(((T>>>16)*v&65535)<<16)&4294967295}return c^=i.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var cn=Ln.exports,Nn={exports:{}};Nn.exports=function(i,e){for(var n,o=i.length,c=e^o,d=0;o>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(d)|(255&i.charCodeAt(++d))<<8|(255&i.charCodeAt(++d))<<16|(255&i.charCodeAt(++d))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++d;switch(o){case 3:c^=(255&i.charCodeAt(d+2))<<16;case 2:c^=(255&i.charCodeAt(d+1))<<8;case 1:c=1540483477*(65535&(c^=255&i.charCodeAt(d)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var $n=cn,Fs=Nn.exports;xr.exports=$n,xr.exports.murmur3=$n,xr.exports.murmur2=Fs;var Xs=V(xr.exports);class bs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,o,c){this.ids.push(No(e)),this.positions.push(n,o,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=No(e);let o=0,c=this.ids.length-1;for(;o<c;){const m=o+c>>1;this.ids[m]>=n?c=m:o=m+1}const d=[];for(;this.ids[o]===n;)d.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return d}static serialize(e,n){const o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Ks(o,c,0,o.length-1),n&&n.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(e){const n=new bs;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function No(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Xs(String(i))}function Ks(i,e,n,o){for(;n<o;){const c=i[n+o>>1];let d=n-1,m=o+1;for(;;){do d++;while(i[d]<c);do m--;while(i[m]>c);if(d>=m)break;_i(i,d,m),_i(e,3*d,3*m),_i(e,3*d+1,3*m+1),_i(e,3*d+2,3*m+2)}m-n<o-m?(Ks(i,e,n,m),n=m+1):(Ks(i,e,m+1,o),o=m)}}function _i(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}dt("FeaturePositionMap",bs);class Yi{constructor(e,n){this.gl=e.gl,this.location=n}}class Rn extends Yi{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class br extends Yi{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class un extends Yi{constructor(e,n){super(e,n),this.current=Bt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const wn=new Float32Array(16);function In(i){return[Vi(255*i.r,255*i.g),Vi(255*i.b,255*i.a)]}class Ji{constructor(e,n,o){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=o}setUniform(e,n,o){e.set(o.constantOr(this.value))}getBinding(e,n,o){return this.type==="color"?new un(e,n):new Rn(e,n)}}class Cn{constructor(e,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setUniform(e,n,o,c){const d=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&e.set(d)}getBinding(e,n,o){return o.substr(0,9)==="u_pattern"?new br(e,n):new Rn(e,n)}}class ws{constructor(e,n,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(d=>({name:`a_${d}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,o,c,d){const m=this.paintVertexArray.length,v=this.expression.evaluate(new Gi(0),n,{},c,[],d);this.paintVertexArray.resize(e),this._setPaintValue(m,e,v)}updatePaintArray(e,n,o,c){const d=this.expression.evaluate({zoom:0},o,c);this._setPaintValue(e,n,d)}_setPaintValue(e,n,o){if(this.type==="color"){const c=In(o);for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ts{constructor(e,n,o,c,d,m){this.expression=e,this.uniformNames=n.map(v=>`u_${v}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,n,o,c,d){const m=this.expression.evaluate(new Gi(this.zoom),n,{},c,[],d),v=this.expression.evaluate(new Gi(this.zoom+1),n,{},c,[],d),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,m,v)}updatePaintArray(e,n,o,c){const d=this.expression.evaluate({zoom:this.zoom},o,c),m=this.expression.evaluate({zoom:this.zoom+1},o,c);this._setPaintValue(e,n,d,m)}_setPaintValue(e,n,o,c){if(this.type==="color"){const d=In(o),m=In(c);for(let v=e;v<n;v++)this.paintVertexArray.emplace(v,d[0],d[1],m[0],m[1])}else{for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=Ze(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,n,o){return new Rn(e,n)}}class ho{constructor(e,n,o,c,d,m){this.expression=e,this.type=n,this.useIntegerZoom=o,this.zoom=c,this.layerId=m,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(e,n,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,c,d){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],d)}_setPaintValues(e,n,o,c){if(!c||!o)return;const{min:d,mid:m,max:v}=o,T=c[d],E=c[m],P=c[v];if(T&&E&&P)for(let D=e;D<n;D++)this.zoomInPaintVertexArray.emplace(D,E.tl[0],E.tl[1],E.br[0],E.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],E.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(D,E.tl[0],E.tl[1],E.br[0],E.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],E.pixelRatio,P.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,ni.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,ni.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class au{constructor(e,n,o){this.binders={},this._buffers=[];const c=[];for(const d in e.paint._values){if(!o(d))continue;const m=e.paint.get(d);if(!(m instanceof vs&&Gs(m.property.specification)))continue;const v=fa(d,e.type),T=m.value,E=m.property.specification.type,P=m.property.useIntegerZoom,D=m.property.specification["property-type"],U=D==="cross-faded"||D==="cross-faded-data-driven";if(T.kind==="constant")this.binders[d]=U?new Cn(T.value,v):new Ji(T.value,v,E),c.push(`/u_${d}`);else if(T.kind==="source"||U){const q=$o(d,E,"source");this.binders[d]=U?new ho(T,E,P,n,q,e.id):new ws(T,v,E,q),c.push(`/a_${d}`)}else{const q=$o(d,E,"composite");this.binders[d]=new Ts(T,v,E,P,n,q),c.push(`/z_${d}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof ws||n instanceof Ts?n.maxValue:0}populatePaintArrays(e,n,o,c,d){for(const m in this.binders){const v=this.binders[m];(v instanceof ws||v instanceof Ts||v instanceof ho)&&v.populatePaintArray(e,n,o,c,d)}}setConstantPatternPositions(e,n){for(const o in this.binders){const c=this.binders[o];c instanceof Cn&&c.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,o,c,d){let m=!1;for(const v in e){const T=n.getPositions(v);for(const E of T){const P=o.feature(E.index);for(const D in this.binders){const U=this.binders[D];if((U instanceof ws||U instanceof Ts||U instanceof ho)&&U.expression.isStateDependent===!0){const q=c.paint.get(D);U.expression=q.value,U.updatePaintArray(E.start,E.end,P,e[v],d),m=!0}}}}return m}defines(){const e=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Ji||o instanceof Cn)&&e.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof ws||o instanceof Ts)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name);else if(o instanceof ho)for(let c=0;c<ni.members.length;c++)e.push(ni.members[c].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Ji||o instanceof Cn||o instanceof Ts)for(const c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const o=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof Ji||d instanceof Cn||d instanceof Ts){for(const m of d.uniformNames)if(n[m]){const v=d.getBinding(e,n[m],m);o.push({name:m,property:c,binding:v})}}}return o}setUniforms(e,n,o,c){for(const{name:d,property:m,binding:v}of n)this.binders[m].setUniform(v,c,o.get(m),d)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(e&&o instanceof ho){const c=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof ws||o instanceof Ts)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const n in this.binders){const o=this.binders[n];(o instanceof ws||o instanceof Ts||o instanceof ho)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof ws||n instanceof Ts||n instanceof ho)&&n.destroy()}}}class Ys{constructor(e,n,o=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new au(c,n,o);this.needsUpload=!1,this._featureMap=new bs,this._bufferOffset=0}populatePaintArrays(e,n,o,c,d,m){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,n,c,d,m);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,c){for(const d of o)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,n,d,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function fa(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function $o(i,e,n){const o={color:{source:Z,composite:x},number:{source:t,composite:Z}},c=function(d){return{"line-pattern":{source:Oe,composite:Oe},"fill-pattern":{source:Oe,composite:Oe},"fill-extrusion-pattern":{source:Oe,composite:Oe}}[d]}(i);return c&&c[n]||o[e][n]}dt("ConstantBinder",Ji),dt("CrossFadedConstantBinder",Cn),dt("SourceExpressionBinder",ws),dt("CrossFadedCompositeBinder",ho),dt("CompositeExpressionBinder",Ts),dt("ProgramConfiguration",au,{omit:["_buffers"]}),dt("ProgramConfigurationSet",Ys);const Qi=8192,Fl=Math.pow(2,14)-1,Ol=-Fl-1;function ds(i){const e=Qi/i.extent,n=i.loadGeometry();for(let o=0;o<n.length;o++){const c=n[o];for(let d=0;d<c.length;d++){const m=c[d],v=Math.round(m.x*e),T=Math.round(m.y*e);m.x=Ze(v,Ol,Fl),m.y=Ze(T,Ol,Fl),(v<m.x||v>m.x+1||T<m.y||T>m.y+1)&&Dt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Js(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?ds(i):[]}}function lu(i,e,n,o,c){i.emplaceBack(2*e+(o+1)/2,2*n+(c+1)/2)}class Ic{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new fe,this.indexArray=new gt,this.segments=new Pt,this.programConfigurations=new Ys(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){const c=this.layers[0],d=[];let m=null,v=!1;c.type==="circle"&&(m=c.layout.get("circle-sort-key"),v=!m.isConstant());for(const{feature:T,id:E,index:P,sourceLayerIndex:D}of e){const U=this.layers[0]._featureFilter.needGeometry,q=Js(T,U);if(!this.layers[0]._featureFilter.filter(new Gi(this.zoom),q,o))continue;const G=v?m.evaluate(q,{},o):void 0,J={id:E,properties:T.properties,type:T.type,sourceLayerIndex:D,index:P,geometry:U?q.geometry:ds(T),patterns:{},sortKey:G};d.push(J)}v&&d.sort((T,E)=>T.sortKey-E.sortKey);for(const T of d){const{geometry:E,index:P,sourceLayerIndex:D}=T,U=e[P].feature;this.addFeature(T,E,P,o),n.featureIndex.insert(U,E,P,D,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ot),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,c){for(const d of n)for(const m of d){const v=m.x,T=m.y;if(v<0||v>=Qi||T<0||T>=Qi)continue;const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=E.vertexLength;lu(this.layoutVertexArray,v,T,-1,-1),lu(this.layoutVertexArray,v,T,1,-1),lu(this.layoutVertexArray,v,T,1,1),lu(this.layoutVertexArray,v,T,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c)}}function sh(i,e){for(let n=0;n<i.length;n++)if(Ka(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Ka(i,e[n]))return!0;return!!cu(i,e)}function Wd(i,e,n){return!!Ka(i,e)||!!ah(e,i,n)}function mp(i,e){if(i.length===1)return lh(e,i[0]);for(let n=0;n<e.length;n++){const o=e[n];for(let c=0;c<o.length;c++)if(Ka(i,o[c]))return!0}for(let n=0;n<i.length;n++)if(lh(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(cu(i,e[n]))return!0;return!1}function Hd(i,e,n){if(i.length>1){if(cu(i,e))return!0;for(let o=0;o<e.length;o++)if(ah(e[o],i,n))return!0}for(let o=0;o<i.length;o++)if(ah(i[o],e,n))return!0;return!1}function cu(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],c=i[n+1];for(let d=0;d<e.length-1;d++)if(oh(o,c,e[d],e[d+1]))return!0}return!1}function oh(i,e,n,o){return Nt(i,n,o)!==Nt(e,n,o)&&Nt(i,e,n)!==Nt(i,e,o)}function ah(i,e,n){const o=n*n;if(e.length===1)return i.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(uu(i,e[c-1],e[c])<o)return!0;return!1}function uu(i,e,n){const o=e.distSqr(n);if(o===0)return i.distSqr(e);const c=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/o;return i.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function lh(i,e){let n,o,c,d=!1;for(let m=0;m<i.length;m++){n=i[m];for(let v=0,T=n.length-1;v<n.length;T=v++)o=n[v],c=n[T],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(d=!d)}return d}function Ka(i,e){let n=!1;for(let o=0,c=i.length-1;o<i.length;c=o++){const d=i[o],m=i[c];d.y>e.y!=m.y>e.y&&e.x<(m.x-d.x)*(e.y-d.y)/(m.y-d.y)+d.x&&(n=!n)}return n}function gp(i,e,n){const o=n[0],c=n[2];if(i.x<o.x&&e.x<o.x||i.x>c.x&&e.x>c.x||i.y<o.y&&e.y<o.y||i.y>c.y&&e.y>c.y)return!1;const d=Nt(i,e,n[0]);return d!==Nt(i,e,n[1])||d!==Nt(i,e,n[2])||d!==Nt(i,e,n[3])}function ma(i,e,n){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(i)}function hu(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Cc(i,e,n,o,c){if(!e[0]&&!e[1])return i;const d=ee.convert(e)._mult(c);n==="viewport"&&d._rotate(-o);const m=[];for(let v=0;v<i.length;v++)m.push(i[v].sub(d));return m}let ch,_p;dt("CircleBucket",Ic,{omit:["layers"]});var yp={get paint(){return _p=_p||new Ki({"circle-radius":new zt(ke.paint_circle["circle-radius"]),"circle-color":new zt(ke.paint_circle["circle-color"]),"circle-blur":new zt(ke.paint_circle["circle-blur"]),"circle-opacity":new zt(ke.paint_circle["circle-opacity"]),"circle-translate":new bt(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zt(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zt(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zt(ke.paint_circle["circle-stroke-opacity"])})},get layout(){return ch=ch||new Ki({"circle-sort-key":new zt(ke.layout_circle["circle-sort-key"])})}},Rr=1e-6,ga=typeof Float32Array<"u"?Float32Array:Array;function pu(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function du(i,e,n){var o=e[0],c=e[1],d=e[2],m=e[3],v=e[4],T=e[5],E=e[6],P=e[7],D=e[8],U=e[9],q=e[10],G=e[11],J=e[12],ne=e[13],oe=e[14],me=e[15],he=n[0],be=n[1],Ie=n[2],Be=n[3];return i[0]=he*o+be*v+Ie*D+Be*J,i[1]=he*c+be*T+Ie*U+Be*ne,i[2]=he*d+be*E+Ie*q+Be*oe,i[3]=he*m+be*P+Ie*G+Be*me,i[4]=(he=n[4])*o+(be=n[5])*v+(Ie=n[6])*D+(Be=n[7])*J,i[5]=he*c+be*T+Ie*U+Be*ne,i[6]=he*d+be*E+Ie*q+Be*oe,i[7]=he*m+be*P+Ie*G+Be*me,i[8]=(he=n[8])*o+(be=n[9])*v+(Ie=n[10])*D+(Be=n[11])*J,i[9]=he*c+be*T+Ie*U+Be*ne,i[10]=he*d+be*E+Ie*q+Be*oe,i[11]=he*m+be*P+Ie*G+Be*me,i[12]=(he=n[12])*o+(be=n[13])*v+(Ie=n[14])*D+(Be=n[15])*J,i[13]=he*c+be*T+Ie*U+Be*ne,i[14]=he*d+be*E+Ie*q+Be*oe,i[15]=he*m+be*P+Ie*G+Be*me,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Mc,uh=du;function oi(i,e,n){var o=e[0],c=e[1],d=e[2],m=e[3];return i[0]=n[0]*o+n[4]*c+n[8]*d+n[12]*m,i[1]=n[1]*o+n[5]*c+n[9]*d+n[13]*m,i[2]=n[2]*o+n[6]*c+n[10]*d+n[14]*m,i[3]=n[3]*o+n[7]*c+n[11]*d+n[15]*m,i}Mc=new ga(4),ga!=Float32Array&&(Mc[0]=0,Mc[1]=0,Mc[2]=0,Mc[3]=0);class Xd extends Lr{constructor(e){super(e,yp)}createBucket(e){return new Ic(e)}queryRadius(e){const n=e;return ma("circle-radius",this,n)+ma("circle-stroke-width",this,n)+hu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,n,o,c,d,m,v,T){const E=Cc(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,v),P=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),D=this.paint.get("circle-pitch-alignment")==="map",U=D?E:function(G,J){return G.map(ne=>vp(ne,J))}(E,T),q=D?P*v:P;for(const G of c)for(const J of G){const ne=D?J:vp(J,T);let oe=q;const me=oi([],[J.x,J.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?oe*=me[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(oe*=m.cameraToCenterDistance/me[3]),Wd(U,ne,oe))return!0}return!1}}function vp(i,e){const n=oi([],[i.x,i.y,0,1],e);return new ee(n[0]/n[3],n[1]/n[3])}class Ul extends Ic{}let hh;dt("HeatmapBucket",Ul,{omit:["layers"]});var Kd={get paint(){return hh=hh||new Ki({"heatmap-radius":new zt(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zt(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Xa(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(ke.paint_heatmap["heatmap-opacity"])})}};function ph(i,{width:e,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*o)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*n*o}`)}else c=new Uint8Array(e*n*o);return i.width=e,i.height=n,i.data=c,i}function Ss(i,{width:e,height:n},o){if(e===i.width&&n===i.height)return;const c=ph({},{width:e,height:n},o);dh(i,c,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},o),i.width=e,i.height=n,i.data=c.data}function dh(i,e,n,o,c,d){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||n.x>i.width-c.width||n.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const m=i.data,v=e.data;if(m===v)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<c.height;T++){const E=((n.y+T)*i.width+n.x)*d,P=((o.y+T)*e.width+o.x)*d;for(let D=0;D<c.width*d;D++)v[P+D]=m[E+D]}return e}class _a{constructor(e,n){ph(this,e,1,n)}resize(e){Ss(this,e,1)}clone(){return new _a({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,d){dh(e,n,o,c,d,1)}}class Jr{constructor(e,n){ph(this,e,4,n)}resize(e){Ss(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Jr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,d){dh(e,n,o,c,d,4)}}function fh(i){const e={},n=i.resolution||256,o=i.clips?i.clips.length:1,c=i.image||new Jr({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const d=(m,v,T)=>{e[i.evaluationKey]=T;const E=i.expression.evaluate(e);c.data[m+v+0]=Math.floor(255*E.r/E.a),c.data[m+v+1]=Math.floor(255*E.g/E.a),c.data[m+v+2]=Math.floor(255*E.b/E.a),c.data[m+v+3]=Math.floor(255*E.a)};if(i.clips)for(let m=0,v=0;m<o;++m,v+=4*n)for(let T=0,E=0;T<n;T++,E+=4){const P=T/(n-1),{start:D,end:U}=i.clips[m];d(v,E,D*(1-P)+U*P)}else for(let m=0,v=0;m<n;m++,v+=4)d(0,v,m/(n-1));return c}dt("AlphaImage",_a),dt("RGBAImage",Jr);class xp extends Lr{createBucket(e){return new Ul(e)}constructor(e){super(e,Kd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=fh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let fs;var ya={get paint(){return fs=fs||new Ki({"hillshade-illumination-direction":new bt(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(ke.paint_hillshade["hillshade-accent-color"])})}};class mh extends Lr{constructor(e){super(e,ya)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const bp=bn([{name:"a_pos",components:2,type:"Int16"}],4),{members:fu}=bp;var mu={exports:{}};function Nl(i,e,n){n=n||2;var o,c,d,m,v,T,E,P=e&&e.length,D=P?e[0]*n:i.length,U=gh(i,0,D,n,!0),q=[];if(!U||U.next===U.prev)return q;if(P&&(U=function(J,ne,oe,me){var he,be,Ie,Be=[];for(he=0,be=ne.length;he<be;he++)(Ie=gh(J,ne[he]*me,he<be-1?ne[he+1]*me:J.length,me,!1))===Ie.next&&(Ie.steiner=!0),Be.push(Qd(Ie));for(Be.sort(Tp),he=0;he<Be.length;he++)oe=_h(Be[he],oe);return oe}(i,e,U,n)),i.length>80*n){o=d=i[0],c=m=i[1];for(var G=n;G<D;G+=n)(v=i[G])<o&&(o=v),(T=i[G+1])<c&&(c=T),v>d&&(d=v),T>m&&(m=T);E=(E=Math.max(d-o,m-c))!==0?32767/E:0}return Ya(U,q,n,o,c,E,0),q}function gh(i,e,n,o,c){var d,m;if(c===_u(i,e,n,o)>0)for(d=e;d<n;d+=o)m=zc(d,i[d],i[d+1],m);else for(d=n-o;d>=e;d-=o)m=zc(d,i[d],i[d+1],m);return m&&Pc(m,m.next)&&(po(m),m=m.next),m}function Vo(i,e){if(!i)return i;e||(e=i);var n,o=i;do if(n=!1,o.steiner||!Pc(o,o.next)&&Tn(o.prev,o,o.next)!==0)o=o.next;else{if(po(o),(o=e=o.prev)===o.next)break;n=!0}while(n||o!==e);return e}function Ya(i,e,n,o,c,d,m){if(i){!m&&d&&function(P,D,U,q){var G=P;do G.z===0&&(G.z=yh(G.x,G.y,D,U,q)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==P);G.prevZ.nextZ=null,G.prevZ=null,function(J){var ne,oe,me,he,be,Ie,Be,pt,ot=1;do{for(oe=J,J=null,be=null,Ie=0;oe;){for(Ie++,me=oe,Be=0,ne=0;ne<ot&&(Be++,me=me.nextZ);ne++);for(pt=ot;Be>0||pt>0&&me;)Be!==0&&(pt===0||!me||oe.z<=me.z)?(he=oe,oe=oe.nextZ,Be--):(he=me,me=me.nextZ,pt--),be?be.nextZ=he:J=he,he.prevZ=be,be=he;oe=me}be.nextZ=null,ot*=2}while(Ie>1)}(G)}(i,o,c,d);for(var v,T,E=i;i.prev!==i.next;)if(v=i.prev,T=i.next,d?Yd(i,o,c,d):va(i))e.push(v.i/n|0),e.push(i.i/n|0),e.push(T.i/n|0),po(i),i=T.next,E=T.next;else if((i=T)===E){m?m===1?Ya(i=xa(Vo(i),e,n),e,n,o,c,d,2):m===2&&wp(i,e,n,o,c,d):Ya(Vo(i),e,n,o,c,d,1);break}}}function va(i){var e=i.prev,n=i,o=i.next;if(Tn(e,n,o)>=0)return!1;for(var c=e.x,d=n.x,m=o.x,v=e.y,T=n.y,E=o.y,P=c<d?c<m?c:m:d<m?d:m,D=v<T?v<E?v:E:T<E?T:E,U=c>d?c>m?c:m:d>m?d:m,q=v>T?v>E?v:E:T>E?T:E,G=o.next;G!==e;){if(G.x>=P&&G.x<=U&&G.y>=D&&G.y<=q&&Ja(c,v,d,T,m,E,G.x,G.y)&&Tn(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function Yd(i,e,n,o){var c=i.prev,d=i,m=i.next;if(Tn(c,d,m)>=0)return!1;for(var v=c.x,T=d.x,E=m.x,P=c.y,D=d.y,U=m.y,q=v<T?v<E?v:E:T<E?T:E,G=P<D?P<U?P:U:D<U?D:U,J=v>T?v>E?v:E:T>E?T:E,ne=P>D?P>U?P:U:D>U?D:U,oe=yh(q,G,e,n,o),me=yh(J,ne,e,n,o),he=i.prevZ,be=i.nextZ;he&&he.z>=oe&&be&&be.z<=me;){if(he.x>=q&&he.x<=J&&he.y>=G&&he.y<=ne&&he!==c&&he!==m&&Ja(v,P,T,D,E,U,he.x,he.y)&&Tn(he.prev,he,he.next)>=0||(he=he.prevZ,be.x>=q&&be.x<=J&&be.y>=G&&be.y<=ne&&be!==c&&be!==m&&Ja(v,P,T,D,E,U,be.x,be.y)&&Tn(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;he&&he.z>=oe;){if(he.x>=q&&he.x<=J&&he.y>=G&&he.y<=ne&&he!==c&&he!==m&&Ja(v,P,T,D,E,U,he.x,he.y)&&Tn(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;be&&be.z<=me;){if(be.x>=q&&be.x<=J&&be.y>=G&&be.y<=ne&&be!==c&&be!==m&&Ja(v,P,T,D,E,U,be.x,be.y)&&Tn(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function xa(i,e,n){var o=i;do{var c=o.prev,d=o.next.next;!Pc(c,d)&&vh(c,o,o.next,d)&&kc(c,d)&&kc(d,c)&&(e.push(c.i/n|0),e.push(o.i/n|0),e.push(d.i/n|0),po(o),po(o.next),o=i=d),o=o.next}while(o!==i);return Vo(o)}function wp(i,e,n,o,c,d){var m=i;do{for(var v=m.next.next;v!==m.prev;){if(m.i!==v.i&&Sp(m,v)){var T=Ep(m,v);return m=Vo(m,m.next),T=Vo(T,T.next),Ya(m,e,n,o,c,d,0),void Ya(T,e,n,o,c,d,0)}v=v.next}m=m.next}while(m!==i)}function Tp(i,e){return i.x-e.x}function _h(i,e){var n=function(c,d){var m,v=d,T=c.x,E=c.y,P=-1/0;do{if(E<=v.y&&E>=v.next.y&&v.next.y!==v.y){var D=v.x+(E-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(D<=T&&D>P&&(P=D,m=v.x<v.next.x?v:v.next,D===T))return m}v=v.next}while(v!==d);if(!m)return null;var U,q=m,G=m.x,J=m.y,ne=1/0;v=m;do T>=v.x&&v.x>=G&&T!==v.x&&Ja(E<J?T:P,E,G,J,E<J?P:T,E,v.x,v.y)&&(U=Math.abs(E-v.y)/(T-v.x),kc(v,c)&&(U<ne||U===ne&&(v.x>m.x||v.x===m.x&&Jd(m,v)))&&(m=v,ne=U)),v=v.next;while(v!==q);return m}(i,e);if(!n)return e;var o=Ep(n,i);return Vo(o,o.next),Vo(n,n.next)}function Jd(i,e){return Tn(i.prev,i,e.prev)<0&&Tn(e.next,i,i.next)<0}function yh(i,e,n,o,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*c|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Qd(i){var e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function Ja(i,e,n,o,c,d,m,v){return(c-m)*(e-v)>=(i-m)*(d-v)&&(i-m)*(o-v)>=(n-m)*(e-v)&&(n-m)*(d-v)>=(c-m)*(o-v)}function Sp(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(n,o){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&vh(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1}(i,e)&&(kc(i,e)&&kc(e,i)&&function(n,o){var c=n,d=!1,m=(n.x+o.x)/2,v=(n.y+o.y)/2;do c.y>v!=c.next.y>v&&c.next.y!==c.y&&m<(c.next.x-c.x)*(v-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==n);return d}(i,e)&&(Tn(i.prev,i,e.prev)||Tn(i,e.prev,e))||Pc(i,e)&&Tn(i.prev,i,i.next)>0&&Tn(e.prev,e,e.next)>0)}function Tn(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function Pc(i,e){return i.x===e.x&&i.y===e.y}function vh(i,e,n,o){var c=Es(Tn(i,e,n)),d=Es(Tn(i,e,o)),m=Es(Tn(n,o,i)),v=Es(Tn(n,o,e));return c!==d&&m!==v||!(c!==0||!wr(i,n,e))||!(d!==0||!wr(i,o,e))||!(m!==0||!wr(n,i,o))||!(v!==0||!wr(n,e,o))}function wr(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function Es(i){return i>0?1:i<0?-1:0}function kc(i,e){return Tn(i.prev,i,i.next)<0?Tn(i,e,i.next)>=0&&Tn(i,i.prev,e)>=0:Tn(i,e,i.prev)<0||Tn(i,i.next,e)<0}function Ep(i,e){var n=new gu(i.i,i.x,i.y),o=new gu(e.i,e.x,e.y),c=i.next,d=e.prev;return i.next=e,e.prev=i,n.next=c,c.prev=n,o.next=n,n.prev=o,d.next=o,o.prev=d,o}function zc(i,e,n,o){var c=new gu(i,e,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function po(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function gu(i,e,n){this.i=i,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _u(i,e,n,o){for(var c=0,d=e,m=n-o;d<n;d+=o)c+=(i[m]-i[d])*(i[d+1]+i[m+1]),m=d;return c}mu.exports=Nl,mu.exports.default=Nl,Nl.deviation=function(i,e,n,o){var c=e&&e.length,d=Math.abs(_u(i,0,c?e[0]*n:i.length,n));if(c)for(var m=0,v=e.length;m<v;m++)d-=Math.abs(_u(i,e[m]*n,m<v-1?e[m+1]*n:i.length,n));var T=0;for(m=0;m<o.length;m+=3){var E=o[m]*n,P=o[m+1]*n,D=o[m+2]*n;T+=Math.abs((i[E]-i[D])*(i[P+1]-i[E+1])-(i[E]-i[P])*(i[D+1]-i[E+1]))}return d===0&&T===0?0:Math.abs((T-d)/d)},Nl.flatten=function(i){for(var e=i[0][0].length,n={vertices:[],holes:[],dimensions:e},o=0,c=0;c<i.length;c++){for(var d=0;d<i[c].length;d++)for(var m=0;m<e;m++)n.vertices.push(i[c][d][m]);c>0&&n.holes.push(o+=i[c-1].length)}return n};var Ap=V(mu.exports);function Ip(i,e,n,o,c){Qa(i,e,n||0,o||i.length-1,c||ef)}function Qa(i,e,n,o,c){for(;o>n;){if(o-n>600){var d=o-n+1,m=e-n+1,v=Math.log(d),T=.5*Math.exp(2*v/3),E=.5*Math.sqrt(v*T*(d-T)/d)*(m-d/2<0?-1:1);Qa(i,e,Math.max(n,Math.floor(e-m*T/d+E)),Math.min(o,Math.floor(e+(d-m)*T/d+E)),c)}var P=i[e],D=n,U=o;for(qo(i,n,e),c(i[o],P)>0&&qo(i,n,o);D<U;){for(qo(i,D,U),D++,U--;c(i[D],P)<0;)D++;for(;c(i[U],P)>0;)U--}c(i[n],P)===0?qo(i,n,U):qo(i,++U,o),U<=e&&(n=U+1),e<=U&&(o=U-1)}}function qo(i,e,n){var o=i[e];i[e]=i[n],i[n]=o}function ef(i,e){return i<e?-1:i>e?1:0}function yu(i,e){const n=i.length;if(n<=1)return[i];const o=[];let c,d;for(let m=0;m<n;m++){const v=ai(i[m]);v!==0&&(i[m].area=Math.abs(v),d===void 0&&(d=v<0),d===v<0?(c&&o.push(c),c=[i[m]]):c.push(i[m]))}if(c&&o.push(c),e>1)for(let m=0;m<o.length;m++)o[m].length<=e||(Ip(o[m],e,1,o[m].length-1,Cp),o[m]=o[m].slice(0,e));return o}function Cp(i,e){return e.area-i.area}function $l(i,e,n){const o=n.patternDependencies;let c=!1;for(const d of e){const m=d.paint.get(`${i}-pattern`);m.isConstant()||(c=!0);const v=m.constantOr(null);v&&(c=!0,o[v.to]=!0,o[v.from]=!0)}return c}function vu(i,e,n,o,c){const d=c.patternDependencies;for(const m of e){const v=m.paint.get(`${i}-pattern`).value;if(v.kind!=="constant"){let T=v.evaluate({zoom:o-1},n,{},c.availableImages),E=v.evaluate({zoom:o},n,{},c.availableImages),P=v.evaluate({zoom:o+1},n,{},c.availableImages);T=T&&T.name?T.name:T,E=E&&E.name?E.name:E,P=P&&P.name?P.name:P,d[T]=!0,d[E]=!0,d[P]=!0,n.patterns[m.id]={min:T,mid:E,max:P}}}return n}class Vl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ce,this.indexArray=new gt,this.indexArray2=new $i,this.programConfigurations=new Ys(e.layers,e.zoom),this.segments=new Pt,this.segments2=new Pt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.hasPattern=$l("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),d=!c.isConstant(),m=[];for(const{feature:v,id:T,index:E,sourceLayerIndex:P}of e){const D=this.layers[0]._featureFilter.needGeometry,U=Js(v,D);if(!this.layers[0]._featureFilter.filter(new Gi(this.zoom),U,o))continue;const q=d?c.evaluate(U,{},o,n.availableImages):void 0,G={id:T,properties:v.properties,type:v.type,sourceLayerIndex:P,index:E,geometry:D?U.geometry:ds(v),patterns:{},sortKey:q};m.push(G)}d&&m.sort((v,T)=>v.sortKey-T.sortKey);for(const v of m){const{geometry:T,index:E,sourceLayerIndex:P}=v;if(this.hasPattern){const D=vu("fill",this.layers,v,this.zoom,n);this.patternFeatures.push(D)}else this.addFeature(v,T,E,o,{});n.featureIndex.insert(e[E].feature,T,E,P,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}addFeatures(e,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fu),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,c,d){for(const m of yu(n,500)){let v=0;for(const q of m)v+=q.length;const T=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),E=T.vertexLength,P=[],D=[];for(const q of m){if(q.length===0)continue;q!==m[0]&&D.push(P.length/2);const G=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),J=G.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(J+q.length-1,J),P.push(q[0].x),P.push(q[0].y);for(let ne=1;ne<q.length;ne++)this.layoutVertexArray.emplaceBack(q[ne].x,q[ne].y),this.indexArray2.emplaceBack(J+ne-1,J+ne),P.push(q[ne].x),P.push(q[ne].y);G.vertexLength+=q.length,G.primitiveLength+=q.length}const U=Ap(P,D);for(let q=0;q<U.length;q+=3)this.indexArray.emplaceBack(E+U[q],E+U[q+1],E+U[q+2]);T.vertexLength+=v,T.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,c)}}let xu,Dc;dt("FillBucket",Vl,{omit:["layers","patternFeatures"]});var tf={get paint(){return Dc=Dc||new Ki({"fill-antialias":new bt(ke.paint_fill["fill-antialias"]),"fill-opacity":new zt(ke.paint_fill["fill-opacity"]),"fill-color":new zt(ke.paint_fill["fill-color"]),"fill-outline-color":new zt(ke.paint_fill["fill-outline-color"]),"fill-translate":new bt(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new ca(ke.paint_fill["fill-pattern"])})},get layout(){return xu=xu||new Ki({"fill-sort-key":new zt(ke.layout_fill["fill-sort-key"])})}};class Mp extends Lr{constructor(e){super(e,tf)}recalculate(e,n){super.recalculate(e,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Vl(e)}queryRadius(){return hu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,n,o,c,d,m,v){return mp(Cc(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,v),c)}isTileClipped(){return!0}}const bu=bn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Pp=bn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:xh}=bu;var ba={},kp=F,fo=el;function el(i,e,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=c,i.readFields(zp,this,e)}function zp(i,e,n){i==1?e.id=n.readVarint():i==2?function(o,c){for(var d=o.readVarint()+o.pos;o.pos<d;){var m=c._keys[o.readVarint()],v=c._values[o.readVarint()];c.properties[m]=v}}(n,e):i==3?e.type=n.readVarint():i==4&&(e._geometry=n.pos)}function nf(i){for(var e,n,o=0,c=0,d=i.length,m=d-1;c<d;m=c++)o+=((n=i[m]).x-(e=i[c]).x)*(e.y+n.y);return o}el.types=["Unknown","Point","LineString","Polygon"],el.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,n=i.readVarint()+i.pos,o=1,c=0,d=0,m=0,v=[];i.pos<n;){if(c<=0){var T=i.readVarint();o=7&T,c=T>>3}if(c--,o===1||o===2)d+=i.readSVarint(),m+=i.readSVarint(),o===1&&(e&&v.push(e),e=[]),e.push(new kp(d,m));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&v.push(e),v},el.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,n=1,o=0,c=0,d=0,m=1/0,v=-1/0,T=1/0,E=-1/0;i.pos<e;){if(o<=0){var P=i.readVarint();n=7&P,o=P>>3}if(o--,n===1||n===2)(c+=i.readSVarint())<m&&(m=c),c>v&&(v=c),(d+=i.readSVarint())<T&&(T=d),d>E&&(E=d);else if(n!==7)throw new Error("unknown command "+n)}return[m,T,v,E]},el.prototype.toGeoJSON=function(i,e,n){var o,c,d=this.extent*Math.pow(2,n),m=this.extent*i,v=this.extent*e,T=this.loadGeometry(),E=el.types[this.type];function P(q){for(var G=0;G<q.length;G++){var J=q[G];q[G]=[360*(J.x+m)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(J.y+v)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(o=0;o<T.length;o++)D[o]=T[o][0];P(T=D);break;case 2:for(o=0;o<T.length;o++)P(T[o]);break;case 3:for(T=function(q){var G=q.length;if(G<=1)return[q];for(var J,ne,oe=[],me=0;me<G;me++){var he=nf(q[me]);he!==0&&(ne===void 0&&(ne=he<0),ne===he<0?(J&&oe.push(J),J=[q[me]]):J.push(q[me]))}return J&&oe.push(J),oe}(T),o=0;o<T.length;o++)for(c=0;c<T[o].length;c++)P(T[o][c])}T.length===1?T=T[0]:E="Multi"+E;var U={type:"Feature",geometry:{type:E,coordinates:T},properties:this.properties};return"id"in this&&(U.id=this.id),U};var Dp=fo,Lp=Rp;function Rp(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Go,this,e),this.length=this._features.length}function Go(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push(function(o){for(var c=null,d=o.readVarint()+o.pos;o.pos<d;){var m=o.readVarint()>>3;c=m===1?o.readString():m===2?o.readFloat():m===3?o.readDouble():m===4?o.readVarint64():m===5?o.readVarint():m===6?o.readSVarint():m===7?o.readBoolean():null}return c}(n))}Rp.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Dp(this._pbf,e,this.extent,this._keys,this._values)};var bh=Lp;function wh(i,e,n){if(i===3){var o=new bh(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}ba.VectorTile=function(i,e){this.layers=i.readFields(wh,{},e)},ba.VectorTileFeature=fo,ba.VectorTileLayer=Lp;const Th=ba.VectorTileFeature.types,ql=Math.pow(2,13);function mo(i,e,n,o,c,d,m,v){i.emplaceBack(e,n,2*Math.floor(o*ql)+m,c*ql*2,d*ql*2,Math.round(v))}class Gt{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Me,this.centroidVertexArray=new re,this.indexArray=new gt,this.programConfigurations=new Ys(e.layers,e.zoom),this.segments=new Pt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.features=[],this.hasPattern=$l("fill-extrusion",this.layers,n);for(const{feature:c,id:d,index:m,sourceLayerIndex:v}of e){const T=this.layers[0]._featureFilter.needGeometry,E=Js(c,T);if(!this.layers[0]._featureFilter.filter(new Gi(this.zoom),E,o))continue;const P={id:d,sourceLayerIndex:v,index:m,geometry:T?E.geometry:ds(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(vu("fill-extrusion",this.layers,P,this.zoom,n)):this.addFeature(P,P.geometry,m,o,{}),n.featureIndex.insert(c,P.geometry,m,v,this.index,!0)}}addFeatures(e,n,o){for(const c of this.features){const{geometry:d}=c;this.addFeature(c,d,c.index,n,o)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xh),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Pp.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,o,c,d){const m={x:0,y:0,vertexCount:0};for(const v of yu(n,500)){let T=0;for(const G of v)T+=G.length;let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const G of v){if(G.length===0||Sh(G))continue;let J=0;for(let ne=0;ne<G.length;ne++){const oe=G[ne];if(ne>=1){const me=G[ne-1];if(!wu(oe,me)){E.vertexLength+4>Pt.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const he=oe.sub(me)._perp()._unit(),be=me.dist(oe);J+be>32768&&(J=0),mo(this.layoutVertexArray,oe.x,oe.y,he.x,he.y,0,0,J),mo(this.layoutVertexArray,oe.x,oe.y,he.x,he.y,0,1,J),m.x+=2*oe.x,m.y+=2*oe.y,m.vertexCount+=2,J+=be,mo(this.layoutVertexArray,me.x,me.y,he.x,he.y,0,0,J),mo(this.layoutVertexArray,me.x,me.y,he.x,he.y,0,1,J),m.x+=2*me.x,m.y+=2*me.y,m.vertexCount+=2;const Ie=E.vertexLength;this.indexArray.emplaceBack(Ie,Ie+2,Ie+1),this.indexArray.emplaceBack(Ie+1,Ie+2,Ie+3),E.vertexLength+=4,E.primitiveLength+=2}}}}if(E.vertexLength+T>Pt.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),Th[e.type]!=="Polygon")continue;const P=[],D=[],U=E.vertexLength;for(const G of v)if(G.length!==0){G!==v[0]&&D.push(P.length/2);for(let J=0;J<G.length;J++){const ne=G[J];mo(this.layoutVertexArray,ne.x,ne.y,0,0,1,1,0),m.x+=ne.x,m.y+=ne.y,m.vertexCount+=1,P.push(ne.x),P.push(ne.y)}}const q=Ap(P,D);for(let G=0;G<q.length;G+=3)this.indexArray.emplaceBack(U+q[G],U+q[G+2],U+q[G+1]);E.primitiveLength+=q.length/3,E.vertexLength+=T}for(let v=0;v<m.vertexCount;v++)this.centroidVertexArray.emplaceBack(Math.floor(m.x/m.vertexCount),Math.floor(m.y/m.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,c)}}function wu(i,e){return i.x===e.x&&(i.x<0||i.x>Qi)||i.y===e.y&&(i.y<0||i.y>Qi)}function Sh(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Qi)||i.every(e=>e.y<0)||i.every(e=>e.y>Qi)}let wa;dt("FillExtrusionBucket",Gt,{omit:["layers","features"]});var rf={get paint(){return wa=wa||new Ki({"fill-extrusion-opacity":new bt(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zt(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ca(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new zt(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zt(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new bt(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Eh extends Lr{constructor(e){super(e,rf)}createBucket(e){return new Gt(e)}queryRadius(){return hu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,n,o,c,d,m,v,T){const E=Cc(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,v),P=this.paint.get("fill-extrusion-height").evaluate(n,o),D=this.paint.get("fill-extrusion-base").evaluate(n,o),U=function(G,J,ne,oe){const me=[];for(const he of G){const be=[he.x,he.y,0,1];oi(be,be,J),me.push(new ee(be[0]/be[3],be[1]/be[3]))}return me}(E,T),q=function(G,J,ne,oe){const me=[],he=[],be=oe[8]*J,Ie=oe[9]*J,Be=oe[10]*J,pt=oe[11]*J,ot=oe[8]*ne,Xe=oe[9]*ne,lt=oe[10]*ne,st=oe[11]*ne;for(const mt of G){const at=[],He=[];for(const At of mt){const xt=At.x,Yt=At.y,zi=oe[0]*xt+oe[4]*Yt+oe[12],Zi=oe[1]*xt+oe[5]*Yt+oe[13],Bn=oe[2]*xt+oe[6]*Yt+oe[14],es=oe[3]*xt+oe[7]*Yt+oe[15],Kn=Bn+Be,Ai=es+pt,rn=zi+ot,sr=Zi+Xe,ts=Bn+lt,Fr=es+st,Pn=new ee((zi+be)/Ai,(Zi+Ie)/Ai);Pn.z=Kn/Ai,at.push(Pn);const Fn=new ee(rn/Fr,sr/Fr);Fn.z=ts/Fr,He.push(Fn)}me.push(at),he.push(He)}return[me,he]}(c,D,P,T);return function(G,J,ne){let oe=1/0;mp(ne,J)&&(oe=Tr(ne,J[0]));for(let me=0;me<J.length;me++){const he=J[me],be=G[me];for(let Ie=0;Ie<he.length-1;Ie++){const Be=he[Ie],pt=[Be,he[Ie+1],be[Ie+1],be[Ie],Be];sh(ne,pt)&&(oe=Math.min(oe,Tr(ne,pt)))}}return oe!==1/0&&oe}(q[0],q[1],U)}}function Gl(i,e){return i.x*e.x+i.y*e.y}function Tr(i,e){if(i.length===1){let n=0;const o=e[n++];let c;for(;!c||o.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){const d=e[n],m=i[0],v=c.sub(o),T=d.sub(o),E=m.sub(o),P=Gl(v,v),D=Gl(v,T),U=Gl(T,T),q=Gl(E,v),G=Gl(E,T),J=P*U-D*D,ne=(U*q-D*G)/J,oe=(P*G-D*q)/J,me=o.z*(1-ne-oe)+c.z*ne+d.z*oe;if(isFinite(me))return me}return 1/0}{let n=1/0;for(const o of e)n=Math.min(n,o.z);return n}}const sf=bn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:of}=sf,Bp=bn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:af}=Bp,Fp=ba.VectorTileFeature.types,lf=Math.cos(Math.PI/180*37.5),Op=Math.pow(2,14)/.5;class Ah{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Re,this.layoutVertexArray2=new We,this.indexArray=new gt,this.programConfigurations=new Ys(e.layers,e.zoom),this.segments=new Pt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.hasPattern=$l("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),d=!c.isConstant(),m=[];for(const{feature:v,id:T,index:E,sourceLayerIndex:P}of e){const D=this.layers[0]._featureFilter.needGeometry,U=Js(v,D);if(!this.layers[0]._featureFilter.filter(new Gi(this.zoom),U,o))continue;const q=d?c.evaluate(U,{},o):void 0,G={id:T,properties:v.properties,type:v.type,sourceLayerIndex:P,index:E,geometry:D?U.geometry:ds(v),patterns:{},sortKey:q};m.push(G)}d&&m.sort((v,T)=>v.sortKey-T.sortKey);for(const v of m){const{geometry:T,index:E,sourceLayerIndex:P}=v;if(this.hasPattern){const D=vu("line",this.layers,v,this.zoom,n);this.patternFeatures.push(D)}else this.addFeature(v,T,E,o,{});n.featureIndex.insert(e[E].feature,T,E,P,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}addFeatures(e,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,af)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,of),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,c,d){const m=this.layers[0].layout,v=m.get("line-join").evaluate(e,{}),T=m.get("line-cap"),E=m.get("line-miter-limit"),P=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const D of n)this.addLine(D,e,v,T,E,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,c)}addLine(e,n,o,c,d,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let oe=0;oe<e.length-1;oe++)this.totalDistance+=e[oe].dist(e[oe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=Fp[n.type]==="Polygon";let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let E=0;for(;E<T-1&&e[E].equals(e[E+1]);)E++;if(T<(v?3:2))return;o==="bevel"&&(d=1.05);const P=this.overscaling<=16?15*Qi/(512*this.overscaling):0,D=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let U,q,G,J,ne;this.e1=this.e2=-1,v&&(U=e[T-2],ne=e[E].sub(U)._unit()._perp());for(let oe=E;oe<T;oe++){if(G=oe===T-1?v?e[E+1]:void 0:e[oe+1],G&&e[oe].equals(G))continue;ne&&(J=ne),U&&(q=U),U=e[oe],ne=G?G.sub(U)._unit()._perp():J,J=J||ne;let me=J.add(ne);me.x===0&&me.y===0||me._unit();const he=J.x*ne.x+J.y*ne.y,be=me.x*ne.x+me.y*ne.y,Ie=be!==0?1/be:1/0,Be=2*Math.sqrt(2-2*be),pt=be<lf&&q&&G,ot=J.x*ne.y-J.y*ne.x>0;if(pt&&oe>E){const st=U.dist(q);if(st>2*P){const mt=U.sub(U.sub(q)._mult(P/st)._round());this.updateDistance(q,mt),this.addCurrentVertex(mt,J,0,0,D),q=mt}}const Xe=q&&G;let lt=Xe?o:v?"butt":c;if(Xe&&lt==="round"&&(Ie<m?lt="miter":Ie<=2&&(lt="fakeround")),lt==="miter"&&Ie>d&&(lt="bevel"),lt==="bevel"&&(Ie>2&&(lt="flipbevel"),Ie<d&&(lt="miter")),q&&this.updateDistance(q,U),lt==="miter")me._mult(Ie),this.addCurrentVertex(U,me,0,0,D);else if(lt==="flipbevel"){if(Ie>100)me=ne.mult(-1);else{const st=Ie*J.add(ne).mag()/J.sub(ne).mag();me._perp()._mult(st*(ot?-1:1))}this.addCurrentVertex(U,me,0,0,D),this.addCurrentVertex(U,me.mult(-1),0,0,D)}else if(lt==="bevel"||lt==="fakeround"){const st=-Math.sqrt(Ie*Ie-1),mt=ot?st:0,at=ot?0:st;if(q&&this.addCurrentVertex(U,J,mt,at,D),lt==="fakeround"){const He=Math.round(180*Be/Math.PI/20);for(let At=1;At<He;At++){let xt=At/He;if(xt!==.5){const zi=xt-.5;xt+=xt*zi*(xt-1)*((1.0904+he*(he*(3.55645-1.43519*he)-3.2452))*zi*zi+(.848013+he*(.215638*he-1.06021)))}const Yt=ne.sub(J)._mult(xt)._add(J)._unit()._mult(ot?-1:1);this.addHalfVertex(U,Yt.x,Yt.y,!1,ot,0,D)}}G&&this.addCurrentVertex(U,ne,-mt,-at,D)}else if(lt==="butt")this.addCurrentVertex(U,me,0,0,D);else if(lt==="square"){const st=q?1:-1;this.addCurrentVertex(U,me,st,st,D)}else lt==="round"&&(q&&(this.addCurrentVertex(U,J,0,0,D),this.addCurrentVertex(U,J,1,1,D,!0)),G&&(this.addCurrentVertex(U,ne,-1,-1,D,!0),this.addCurrentVertex(U,ne,0,0,D)));if(pt&&oe<T-1){const st=U.dist(G);if(st>2*P){const mt=U.add(G.sub(U)._mult(P/st)._round());this.updateDistance(U,mt),this.addCurrentVertex(mt,ne,0,0,D),U=mt}}}}addCurrentVertex(e,n,o,c,d,m=!1){const v=n.y*c-n.x,T=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,m,!1,o,d),this.addHalfVertex(e,v,T,m,!0,-c,d),this.distance>Op/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,o,c,d,m))}addHalfVertex({x:e,y:n},o,c,d,m,v,T){const E=.5*(this.lineClips?this.scaledDistance*(Op-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(n<<1)+(m?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(v===0?0:v<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const P=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),T.primitiveLength++),m?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}let go,Br;dt("LineBucket",Ah,{omit:["layers","patternFeatures"]});var Tu={get paint(){return Br=Br||new Ki({"line-opacity":new zt(ke.paint_line["line-opacity"]),"line-color":new zt(ke.paint_line["line-color"]),"line-translate":new bt(ke.paint_line["line-translate"]),"line-translate-anchor":new bt(ke.paint_line["line-translate-anchor"]),"line-width":new zt(ke.paint_line["line-width"]),"line-gap-width":new zt(ke.paint_line["line-gap-width"]),"line-offset":new zt(ke.paint_line["line-offset"]),"line-blur":new zt(ke.paint_line["line-blur"]),"line-dasharray":new Oo(ke.paint_line["line-dasharray"]),"line-pattern":new ca(ke.paint_line["line-pattern"]),"line-gradient":new Xa(ke.paint_line["line-gradient"])})},get layout(){return go=go||new Ki({"line-cap":new bt(ke.layout_line["line-cap"]),"line-join":new zt(ke.layout_line["line-join"]),"line-miter-limit":new bt(ke.layout_line["line-miter-limit"]),"line-round-limit":new bt(ke.layout_line["line-round-limit"]),"line-sort-key":new zt(ke.layout_line["line-sort-key"])})}};class cf extends zt{possiblyEvaluate(e,n){return n=new Gi(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,o,c){return n=Ve({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,o,c)}}let Zl;class uf extends Lr{constructor(e){super(e,Tu),this.gradientVersion=0,Zl||(Zl=new cf(Tu.paint.properties["line-width"].specification),Zl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){e==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ao,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=Zl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Ah(e)}queryRadius(e){const n=e,o=Up(ma("line-width",this,n),ma("line-gap-width",this,n)),c=ma("line-offset",this,n);return o/2+Math.abs(c)+hu(this.paint.get("line-translate"))}queryIntersectsFeature(e,n,o,c,d,m,v){const T=Cc(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,v),E=v/2*Up(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),P=this.paint.get("line-offset").evaluate(n,o);return P&&(c=function(D,U){const q=[];for(let G=0;G<D.length;G++){const J=D[G],ne=[];for(let oe=0;oe<J.length;oe++){const me=J[oe-1],he=J[oe],be=J[oe+1],Ie=oe===0?new ee(0,0):he.sub(me)._unit()._perp(),Be=oe===J.length-1?new ee(0,0):be.sub(he)._unit()._perp(),pt=Ie._add(Be)._unit(),ot=pt.x*Be.x+pt.y*Be.y;ot!==0&&pt._mult(1/ot),ne.push(pt._mult(U)._add(he))}q.push(ne)}return q}(c,P*v)),function(D,U,q){for(let G=0;G<U.length;G++){const J=U[G];if(D.length>=3){for(let ne=0;ne<J.length;ne++)if(Ka(D,J[ne]))return!0}if(Hd(D,J,q))return!0}return!1}(T,c,E)}isTileClipped(){return!0}}function Up(i,e){return e>0?e+2*i:i}const Lc=bn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Np=bn([{name:"a_projected_pos",components:3,type:"Float32"}],4);bn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const $p=bn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);bn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Vp=bn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),hf=bn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function pf(i,e,n){return i.sections.forEach(o=>{o.text=function(c,d,m){const v=d.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?c=c.toLocaleUpperCase():v==="lowercase"&&(c=c.toLocaleLowerCase()),yr.applyArabicShaping&&(c=yr.applyArabicShaping(c)),c}(o.text,e,n)}),i}bn([{name:"triangle",components:3,type:"Uint16"}]),bn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),bn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),bn([{type:"Float32",name:"offsetX"}]),bn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),bn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Rc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Mn=24,Ih=ki,qp=function(i,e,n,o,c){var d,m,v=8*c-o-1,T=(1<<v)-1,E=T>>1,P=-7,D=n?c-1:0,U=n?-1:1,q=i[e+D];for(D+=U,d=q&(1<<-P)-1,q>>=-P,P+=v;P>0;d=256*d+i[e+D],D+=U,P-=8);for(m=d&(1<<-P)-1,d>>=-P,P+=o;P>0;m=256*m+i[e+D],D+=U,P-=8);if(d===0)d=1-E;else{if(d===T)return m?NaN:1/0*(q?-1:1);m+=Math.pow(2,o),d-=E}return(q?-1:1)*m*Math.pow(2,d-o)},Su=function(i,e,n,o,c,d){var m,v,T,E=8*d-c-1,P=(1<<E)-1,D=P>>1,U=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,q=o?0:d-1,G=o?1:-1,J=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,m=P):(m=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-m))<1&&(m--,T*=2),(e+=m+D>=1?U/T:U*Math.pow(2,1-D))*T>=2&&(m++,T/=2),m+D>=P?(v=0,m=P):m+D>=1?(v=(e*T-1)*Math.pow(2,c),m+=D):(v=e*Math.pow(2,D-1)*Math.pow(2,c),m=0));c>=8;i[n+q]=255&v,q+=G,v/=256,c-=8);for(m=m<<c|v,E+=c;E>0;i[n+q]=255&m,q+=G,m/=256,E-=8);i[n+q-G]|=128*J};function ki(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}ki.Varint=0,ki.Fixed64=1,ki.Bytes=2,ki.Fixed32=5;var tl=4294967296,Eu=1/tl,Ch=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function _o(i){return i.type===ki.Bytes?i.readVarint()+i.pos:i.pos+1}function Zo(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Mh(i,e,n){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=i;c--)n.buf[c+o]=n.buf[c]}function yo(i,e){for(var n=0;n<i.length;n++)e.writeVarint(i[n])}function il(i,e){for(var n=0;n<i.length;n++)e.writeSVarint(i[n])}function df(i,e){for(var n=0;n<i.length;n++)e.writeFloat(i[n])}function Gp(i,e){for(var n=0;n<i.length;n++)e.writeDouble(i[n])}function ff(i,e){for(var n=0;n<i.length;n++)e.writeBoolean(i[n])}function mf(i,e){for(var n=0;n<i.length;n++)e.writeFixed32(i[n])}function gf(i,e){for(var n=0;n<i.length;n++)e.writeSFixed32(i[n])}function _f(i,e){for(var n=0;n<i.length;n++)e.writeFixed64(i[n])}function yf(i,e){for(var n=0;n<i.length;n++)e.writeSFixed64(i[n])}function Au(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function jl(i,e,n){i[n]=e,i[n+1]=e>>>8,i[n+2]=e>>>16,i[n+3]=e>>>24}function Zp(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}ki.prototype={destroy:function(){this.buf=null},readFields:function(i,e,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,d=this.pos;this.type=7&o,i(c,e,this),this.pos===d&&this.skip(o)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Au(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Zp(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Au(this.buf,this.pos)+Au(this.buf,this.pos+4)*tl;return this.pos+=8,i},readSFixed64:function(){var i=Au(this.buf,this.pos)+Zp(this.buf,this.pos+4)*tl;return this.pos+=8,i},readFloat:function(){var i=qp(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=qp(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,n,o=this.buf;return e=127&(n=o[this.pos++]),n<128?e:(e|=(127&(n=o[this.pos++]))<<7,n<128?e:(e|=(127&(n=o[this.pos++]))<<14,n<128?e:(e|=(127&(n=o[this.pos++]))<<21,n<128?e:function(c,d,m){var v,T,E=m.buf;if(v=(112&(T=E[m.pos++]))>>4,T<128||(v|=(127&(T=E[m.pos++]))<<3,T<128)||(v|=(127&(T=E[m.pos++]))<<10,T<128)||(v|=(127&(T=E[m.pos++]))<<17,T<128)||(v|=(127&(T=E[m.pos++]))<<24,T<128)||(v|=(1&(T=E[m.pos++]))<<31,T<128))return Zo(c,v,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Ch?function(n,o,c){return Ch.decode(n.subarray(o,c))}(this.buf,e,i):function(n,o,c){for(var d="",m=o;m<c;){var v,T,E,P=n[m],D=null,U=P>239?4:P>223?3:P>191?2:1;if(m+U>c)break;U===1?P<128&&(D=P):U===2?(192&(v=n[m+1]))==128&&(D=(31&P)<<6|63&v)<=127&&(D=null):U===3?(T=n[m+2],(192&(v=n[m+1]))==128&&(192&T)==128&&((D=(15&P)<<12|(63&v)<<6|63&T)<=2047||D>=55296&&D<=57343)&&(D=null)):U===4&&(T=n[m+2],E=n[m+3],(192&(v=n[m+1]))==128&&(192&T)==128&&(192&E)==128&&((D=(15&P)<<18|(63&v)<<12|(63&T)<<6|63&E)<=65535||D>=1114112)&&(D=null)),D===null?(D=65533,U=1):D>65535&&(D-=65536,d+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),d+=String.fromCharCode(D),m+=U}return d}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==ki.Bytes)return i.push(this.readVarint(e));var n=_o(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==ki.Bytes)return i.push(this.readSVarint());var e=_o(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==ki.Bytes)return i.push(this.readBoolean());var e=_o(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==ki.Bytes)return i.push(this.readFloat());var e=_o(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==ki.Bytes)return i.push(this.readDouble());var e=_o(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==ki.Bytes)return i.push(this.readFixed32());var e=_o(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==ki.Bytes)return i.push(this.readSFixed32());var e=_o(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==ki.Bytes)return i.push(this.readFixed64());var e=_o(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==ki.Bytes)return i.push(this.readSFixed64());var e=_o(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===ki.Varint)for(;this.buf[this.pos++]>127;);else if(e===ki.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ki.Fixed32)this.pos+=4;else{if(e!==ki.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),jl(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),jl(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),jl(this.buf,-1&i,this.pos),jl(this.buf,Math.floor(i*Eu),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),jl(this.buf,-1&i,this.pos),jl(this.buf,Math.floor(i*Eu),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,n){var o,c;if(e>=0?(o=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(d,m,v){v.buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos++]=127&d|128,v.buf[v.pos]=127&(d>>>=7)}(o,0,n),function(d,m){var v=(7&d)<<4;m.buf[m.pos++]|=v|((d>>>=3)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d)))))}(c,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(o,c,d){for(var m,v,T=0;T<c.length;T++){if((m=c.charCodeAt(T))>55295&&m<57344){if(!v){m>56319||T+1===c.length?(o[d++]=239,o[d++]=191,o[d++]=189):v=m;continue}if(m<56320){o[d++]=239,o[d++]=191,o[d++]=189,v=m;continue}m=v-55296<<10|m-56320|65536,v=null}else v&&(o[d++]=239,o[d++]=191,o[d++]=189,v=null);m<128?o[d++]=m:(m<2048?o[d++]=m>>6|192:(m<65536?o[d++]=m>>12|224:(o[d++]=m>>18|240,o[d++]=m>>12&63|128),o[d++]=m>>6&63|128),o[d++]=63&m|128)}return d}(this.buf,i,this.pos);var n=this.pos-e;n>=128&&Mh(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),Su(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Su(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,e){this.pos++;var n=this.pos;i(e,this);var o=this.pos-n;o>=128&&Mh(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,e,n){this.writeTag(i,ki.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,yo,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,il,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,ff,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,df,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Gp,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,mf,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,gf,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,_f,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,yf,e)},writeBytesField:function(i,e){this.writeTag(i,ki.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,ki.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,ki.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,ki.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,ki.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,ki.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,ki.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,ki.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,ki.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,ki.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var Ph=V(Ih);const kh=3;function vf(i,e,n){i===1&&n.readMessage(jp,e)}function jp(i,e,n){if(i===3){const{id:o,bitmap:c,width:d,height:m,left:v,top:T,advance:E}=n.readMessage(Wp,{});e.push({id:o,bitmap:new _a({width:d+2*kh,height:m+2*kh},c),metrics:{width:d,height:m,left:v,top:T,advance:E}})}}function Wp(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}const zh=kh;function Hp(i){let e=0,n=0;for(const m of i)e+=m.w*m.h,n=Math.max(n,m.w);i.sort((m,v)=>v.h-m.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let c=0,d=0;for(const m of i)for(let v=o.length-1;v>=0;v--){const T=o[v];if(!(m.w>T.w||m.h>T.h)){if(m.x=T.x,m.y=T.y,d=Math.max(d,m.y+m.h),c=Math.max(c,m.x+m.w),m.w===T.w&&m.h===T.h){const E=o.pop();v<o.length&&(o[v]=E)}else m.h===T.h?(T.x+=m.w,T.w-=m.w):m.w===T.w?(T.y+=m.h,T.h-=m.h):(o.push({x:T.x+m.w,y:T.y,w:T.w-m.w,h:m.h}),T.y+=m.h,T.h-=m.h);break}}return{w:c,h:d,fill:e/(c*d)||0}}const Qr=1;class Dh{constructor(e,{pixelRatio:n,version:o,stretchX:c,stretchY:d,content:m}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=d,this.content=m,this.version=o}get tl(){return[this.paddedRect.x+Qr,this.paddedRect.y+Qr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Qr,this.paddedRect.y+this.paddedRect.h-Qr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Qr)/this.pixelRatio,(this.paddedRect.h-2*Qr)/this.pixelRatio]}}class Lh{constructor(e,n){const o={},c={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,o,d),this.addImages(n,c,d);const{w:m,h:v}=Hp(d),T=new Jr({width:m||1,height:v||1});for(const E in e){const P=e[E],D=o[E].paddedRect;Jr.copy(P.data,T,{x:0,y:0},{x:D.x+Qr,y:D.y+Qr},P.data)}for(const E in n){const P=n[E],D=c[E].paddedRect,U=D.x+Qr,q=D.y+Qr,G=P.data.width,J=P.data.height;Jr.copy(P.data,T,{x:0,y:0},{x:U,y:q},P.data),Jr.copy(P.data,T,{x:0,y:J-1},{x:U,y:q-1},{width:G,height:1}),Jr.copy(P.data,T,{x:0,y:0},{x:U,y:q+J},{width:G,height:1}),Jr.copy(P.data,T,{x:G-1,y:0},{x:U-1,y:q},{width:1,height:J}),Jr.copy(P.data,T,{x:0,y:0},{x:U+G,y:q},{width:1,height:J})}this.image=T,this.iconPositions=o,this.patternPositions=c}addImages(e,n,o){for(const c in e){const d=e[c],m={x:0,y:0,w:d.data.width+2*Qr,h:d.data.height+2*Qr};o.push(m),n[c]=new Dh(m,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;const[c,d]=e.tl;o.update(n.data,void 0,{x:c,y:d})}}var Ta;dt("ImagePosition",Dh),dt("ImageAtlas",Lh),a.WritingMode=void 0,(Ta=a.WritingMode||(a.WritingMode={}))[Ta.none=0]="none",Ta[Ta.horizontal=1]="horizontal",Ta[Ta.vertical=2]="vertical",Ta[Ta.horizontalOnly=3]="horizontalOnly";const Bc=-17;class Fc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const o=new Fc;return o.scale=e||1,o.fontStack=n,o}static forImage(e){const n=new Fc;return n.imageName=e,n}}class Wl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const o=new Wl;for(let c=0;c<e.sections.length;c++){const d=e.sections[c];d.image?o.addImageSection(d):o.addTextSection(d,n)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let n="";for(let o=0;o<e.length;o++){const c=e.charCodeAt(o+1)||null,d=e.charCodeAt(o-1)||null;n+=c&&Bs(c)&&!Rc[e[o+1]]||d&&Bs(d)&&!Rc[e[o-1]]||!Rc[e[o]]?e[o]:Rc[e[o]]}return n}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&Cu[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Cu[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const o=new Wl;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Fc.forText(e.scale,e.fontStack||n));const o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Dt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Fc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Dt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Iu(i,e,n,o,c,d,m,v,T,E,P,D,U,q,G,J){const ne=Wl.fromFeature(i,c);let oe;D===a.WritingMode.vertical&&ne.verticalizePunctuation();const{processBidirectionalText:me,processStyledBidirectionalText:he}=yr;if(me&&ne.sections.length===1){oe=[];const Be=me(ne.toString(),Bh(ne,E,d,e,o,q,G));for(const pt of Be){const ot=new Wl;ot.text=pt,ot.sections=ne.sections;for(let Xe=0;Xe<pt.length;Xe++)ot.sectionIndex.push(0);oe.push(ot)}}else if(he){oe=[];const Be=he(ne.text,ne.sectionIndex,Bh(ne,E,d,e,o,q,G));for(const pt of Be){const ot=new Wl;ot.text=pt[0],ot.sectionIndex=pt[1],ot.sections=ne.sections,oe.push(ot)}}else oe=function(Be,pt){const ot=[],Xe=Be.text;let lt=0;for(const st of pt)ot.push(Be.substring(lt,st)),lt=st;return lt<Xe.length&&ot.push(Be.substring(lt,Xe.length)),ot}(ne,Bh(ne,E,d,e,o,q,G));const be=[],Ie={positionedLines:be,text:ne.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:D,iconsInText:!1,verticalizable:!1};return function(Be,pt,ot,Xe,lt,st,mt,at,He,At,xt,Yt){let zi=0,Zi=Bc,Bn=0,es=0;const Kn=at==="right"?1:at==="left"?0:.5;let Ai=0;for(const Pn of lt){Pn.trim();const Fn=Pn.getMaxScale(),or=(Fn-1)*Mn,hn={positionedGlyphs:[],lineOffset:0};Be.positionedLines[Ai]=hn;const Ut=hn.positionedGlyphs;let Or=0;if(!Pn.length()){Zi+=st,++Ai;continue}for(let Yn=0;Yn<Pn.length();Yn++){const ui=Pn.getSection(Yn),ri=Pn.getSectionIndex(Yn),ar=Pn.getCharCode(Yn);let Sr=0,is=null,Qs=null,eo=null,Ho=Mn;const Us=!(He===a.WritingMode.horizontal||!xt&&!Zs(ar)||xt&&(Cu[ar]||(rn=ar,ht.Arabic(rn)||ht["Arabic Supplement"](rn)||ht["Arabic Extended-A"](rn)||ht["Arabic Presentation Forms-A"](rn)||ht["Arabic Presentation Forms-B"](rn))));if(ui.imageName){const Is=Xe[ui.imageName];if(!Is)continue;eo=ui.imageName,Be.iconsInText=Be.iconsInText||!0,Qs=Is.paddedRect;const ns=Is.displaySize;ui.scale=ui.scale*Mn/Yt,is={width:ns[0],height:ns[1],left:Qr,top:-zh,advance:Us?ns[1]:ns[0]},Sr=or+(Mn-ns[1]*ui.scale),Ho=is.advance;const Xo=Us?ns[0]*ui.scale-Mn*Fn:ns[1]*ui.scale-Mn*Fn;Xo>0&&Xo>Or&&(Or=Xo)}else{const Is=ot[ui.fontStack],ns=Is&&Is[ar];if(ns&&ns.rect)Qs=ns.rect,is=ns.metrics;else{const Xo=pt[ui.fontStack],Gc=Xo&&Xo[ar];if(!Gc)continue;is=Gc.metrics}Sr=(Fn-ui.scale)*Mn}Us?(Be.verticalizable=!0,Ut.push({glyph:ar,imageName:eo,x:zi,y:Zi+Sr,vertical:Us,scale:ui.scale,fontStack:ui.fontStack,sectionIndex:ri,metrics:is,rect:Qs}),zi+=Ho*ui.scale+At):(Ut.push({glyph:ar,imageName:eo,x:zi,y:Zi+Sr,vertical:Us,scale:ui.scale,fontStack:ui.fontStack,sectionIndex:ri,metrics:is,rect:Qs}),zi+=is.advance*ui.scale+At)}Ut.length!==0&&(Bn=Math.max(zi-At,Bn),bf(Ut,0,Ut.length-1,Kn,Or)),zi=0;const wi=st*Fn+Or;hn.lineOffset=Math.max(Or,or),Zi+=wi,es=Math.max(wi,es),++Ai}var rn;const sr=Zi-Bc,{horizontalAlign:ts,verticalAlign:Fr}=Fh(mt);(function(Pn,Fn,or,hn,Ut,Or,wi,Yn,ui){const ri=(Fn-or)*Ut;let ar=0;ar=Or!==wi?-Yn*hn-Bc:(-hn*ui+.5)*wi;for(const Sr of Pn)for(const is of Sr.positionedGlyphs)is.x+=ri,is.y+=ar})(Be.positionedLines,Kn,ts,Fr,Bn,es,st,sr,lt.length),Be.top+=-Fr*sr,Be.bottom=Be.top+sr,Be.left+=-ts*Bn,Be.right=Be.left+Bn}(Ie,e,n,o,oe,m,v,T,D,E,U,J),!function(Be){for(const pt of Be)if(pt.positionedGlyphs.length!==0)return!1;return!0}(be)&&Ie}const Cu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Os={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Xp(i,e,n,o,c,d){if(e.imageName){const m=o[e.imageName];return m?m.displaySize[0]*e.scale*Mn/d+c:0}{const m=n[e.fontStack],v=m&&m[i];return v?v.metrics.advance*e.scale+c:0}}function Kp(i,e,n,o){const c=Math.pow(i-e,2);return o?i<e?c/2:2*c:c+Math.abs(n)*n}function xf(i,e,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Rh(i,e,n,o,c,d){let m=null,v=Kp(e,n,c,d);for(const T of o){const E=Kp(e-T.x,n,c,d)+T.badness;E<=v&&(m=T,v=E)}return{index:i,x:e,priorBreak:m,badness:v}}function Yp(i){return i?Yp(i.priorBreak).concat(i.index):[]}function Bh(i,e,n,o,c,d,m){if(d!=="point")return[];if(!i)return[];const v=[],T=function(U,q,G,J,ne,oe){let me=0;for(let he=0;he<U.length();he++){const be=U.getSection(he);me+=Xp(U.getCharCode(he),be,J,ne,q,oe)}return me/Math.max(1,Math.ceil(me/G))}(i,e,n,o,c,m),E=i.text.indexOf("​")>=0;let P=0;for(let U=0;U<i.length();U++){const q=i.getSection(U),G=i.getCharCode(U);if(Cu[G]||(P+=Xp(G,q,o,c,e,m)),U<i.length()-1){const J=!((D=G)<11904||!(ht["Bopomofo Extended"](D)||ht.Bopomofo(D)||ht["CJK Compatibility Forms"](D)||ht["CJK Compatibility Ideographs"](D)||ht["CJK Compatibility"](D)||ht["CJK Radicals Supplement"](D)||ht["CJK Strokes"](D)||ht["CJK Symbols and Punctuation"](D)||ht["CJK Unified Ideographs Extension A"](D)||ht["CJK Unified Ideographs"](D)||ht["Enclosed CJK Letters and Months"](D)||ht["Halfwidth and Fullwidth Forms"](D)||ht.Hiragana(D)||ht["Ideographic Description Characters"](D)||ht["Kangxi Radicals"](D)||ht["Katakana Phonetic Extensions"](D)||ht.Katakana(D)||ht["Vertical Forms"](D)||ht["Yi Radicals"](D)||ht["Yi Syllables"](D)));(Os[G]||J||q.imageName)&&v.push(Rh(U+1,P,T,v,xf(G,i.getCharCode(U+1),J&&E),!1))}}var D;return Yp(Rh(i.length(),P,T,v,0,!0))}function Fh(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function bf(i,e,n,o,c){if(!o&&!c)return;const d=i[n],m=(i[n].x+d.metrics.advance*d.scale)*o;for(let v=e;v<=n;v++)i[v].x-=m,i[v].y+=c}function Oh(i,e,n){const{horizontalAlign:o,verticalAlign:c}=Fh(n),d=e[0]-i.displaySize[0]*o,m=e[1]-i.displaySize[1]*c;return{image:i,top:m,bottom:m+i.displaySize[1],left:d,right:d+i.displaySize[0]}}function Jp(i,e,n,o,c,d){const m=i.image;let v;if(m.content){const ne=m.content,oe=m.pixelRatio||1;v=[ne[0]/oe,ne[1]/oe,m.displaySize[0]-ne[2]/oe,m.displaySize[1]-ne[3]/oe]}const T=e.left*d,E=e.right*d;let P,D,U,q;n==="width"||n==="both"?(q=c[0]+T-o[3],D=c[0]+E+o[1]):(q=c[0]+(T+E-m.displaySize[0])/2,D=q+m.displaySize[0]);const G=e.top*d,J=e.bottom*d;return n==="height"||n==="both"?(P=c[1]+G-o[0],U=c[1]+J+o[2]):(P=c[1]+(G+J-m.displaySize[1])/2,U=P+m.displaySize[1]),{image:m,top:P,right:D,bottom:U,left:q,collisionPadding:v}}const Oc=255,vo=128,Sa=Oc*vo;function Qp(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Gi(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=n;let d=0;for(;d<o.length&&o[d]<=i;)d++;d=Math.max(0,d-1);let m=d;for(;m<o.length&&o[m]<i+1;)m++;m=Math.min(o.length-1,m);const v=o[d],T=o[m];return n.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:T,interpolationType:c}:{kind:"camera",minZoom:v,maxZoom:T,minSize:n.evaluate(new Gi(v)),maxSize:n.evaluate(new Gi(T)),interpolationType:c}}}function Uh(i,e,n){let o="never";const c=i.get(e);return c?o=c:i.get(n)&&(o="always"),o}const wf=ba.VectorTileFeature.types,Tf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Mu(i,e,n,o,c,d,m,v,T,E,P,D,U){const q=v?Math.min(Sa,Math.round(v[0])):0,G=v?Math.min(Sa,Math.round(v[1])):0;i.emplaceBack(e,n,Math.round(32*o),Math.round(32*c),d,m,(q<<1)+(T?1:0),G,16*E,16*P,256*D,256*U)}function Nh(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function Sf(i){for(const e of i.sections)if(Il(e.text))return!0;return!1}class $h{constructor(e){this.layoutVertexArray=new tt,this.indexArray=new gt,this.programConfigurations=e,this.segments=new Pt,this.dynamicLayoutVertexArray=new vt,this.opacityVertexArray=new Qt,this.hasVisibleVertices=!1,this.placedSymbolArray=new k}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lc.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Np.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Tf,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}dt("SymbolBuffers",$h);class Vh{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Pt,this.collisionVertexArray=new It}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,$p.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}dt("CollisionBuffers",Vh);class Hl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=pu([]),this.placementViewportMatrix=pu([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qp(this.zoom,n["text-size"]),this.iconSizeData=Qp(this.zoom,n["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),d=o.get("symbol-z-order");this.canOverlap=Uh(o,"text-overlap","text-allow-overlap")!=="never"||Uh(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(m=>a.WritingMode[m])),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID}createArrays(){this.text=new $h(new Ys(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new $h(new Ys(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Y,this.lineVertexArray=new K,this.symbolInstances=new $,this.textAnchorOffsets=new X}calculateGlyphDependencies(e,n,o,c,d){for(let m=0;m<e.length;m++)if(n[e.charCodeAt(m)]=!0,(o||c)&&d){const v=Rc[e.charAt(m)];v&&(n[v.charCodeAt(0)]=!0)}}populate(e,n,o){const c=this.layers[0],d=c.layout,m=d.get("text-font"),v=d.get("text-field"),T=d.get("icon-image"),E=(v.value.kind!=="constant"||v.value.value instanceof Xi&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),P=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,D=d.get("symbol-sort-key");if(this.features=[],!E&&!P)return;const U=n.iconDependencies,q=n.glyphDependencies,G=n.availableImages,J=new Gi(this.zoom);for(const{feature:ne,id:oe,index:me,sourceLayerIndex:he}of e){const be=c._featureFilter.needGeometry,Ie=Js(ne,be);if(!c._featureFilter.filter(J,Ie,o))continue;let Be,pt;if(be||(Ie.geometry=ds(ne)),E){const Xe=c.getValueAndResolveTokens("text-field",Ie,o,G),lt=Xi.factory(Xe);Sf(lt)&&(this.hasRTLText=!0),(!this.hasRTLText||Sc()==="unavailable"||this.hasRTLText&&yr.isParsed())&&(Be=pf(lt,c,Ie))}if(P){const Xe=c.getValueAndResolveTokens("icon-image",Ie,o,G);pt=Xe instanceof jr?Xe:jr.fromString(Xe)}if(!Be&&!pt)continue;const ot=this.sortFeaturesByKey?D.evaluate(Ie,{},o):void 0;if(this.features.push({id:oe,text:Be,icon:pt,index:me,sourceLayerIndex:he,geometry:Ie.geometry,properties:ne.properties,type:wf[ne.type],sortKey:ot}),pt&&(U[pt.name]=!0),Be){const Xe=m.evaluate(Ie,{},o).join(","),lt=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.WritingMode.vertical)>=0;for(const st of Be.sections)if(st.image)U[st.image.name]=!0;else{const mt=Al(Be.toString()),at=st.fontStack||Xe,He=q[at]=q[at]||{};this.calculateGlyphDependencies(st.text,He,lt,this.allowVerticalPlacement,mt)}}}d.get("symbol-placement")==="line"&&(this.features=function(ne){const oe={},me={},he=[];let be=0;function Ie(Xe){he.push(ne[Xe]),be++}function Be(Xe,lt,st){const mt=me[Xe];return delete me[Xe],me[lt]=mt,he[mt].geometry[0].pop(),he[mt].geometry[0]=he[mt].geometry[0].concat(st[0]),mt}function pt(Xe,lt,st){const mt=oe[lt];return delete oe[lt],oe[Xe]=mt,he[mt].geometry[0].shift(),he[mt].geometry[0]=st[0].concat(he[mt].geometry[0]),mt}function ot(Xe,lt,st){const mt=st?lt[0][lt[0].length-1]:lt[0][0];return`${Xe}:${mt.x}:${mt.y}`}for(let Xe=0;Xe<ne.length;Xe++){const lt=ne[Xe],st=lt.geometry,mt=lt.text?lt.text.toString():null;if(!mt){Ie(Xe);continue}const at=ot(mt,st),He=ot(mt,st,!0);if(at in me&&He in oe&&me[at]!==oe[He]){const At=pt(at,He,st),xt=Be(at,He,he[At].geometry);delete oe[at],delete me[He],me[ot(mt,he[xt].geometry,!0)]=xt,he[At].geometry=null}else at in me?Be(at,He,st):He in oe?pt(at,He,st):(Ie(Xe),oe[at]=be-1,me[He]=be-1)}return he.filter(Xe=>Xe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,oe)=>ne.sortKey-oe.sortKey)}update(e,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const o=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(n[e.segment+1]),d=e.dist(n[e.segment]);const m={};for(let v=e.segment+1;v<n.length;v++)m[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:c},v<n.length-1&&(c+=n[v+1].dist(n[v]));for(let v=e.segment||0;v>=0;v--)m[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:d},v>0&&(d+=n[v-1].dist(n[v]));for(let v=0;v<n.length;v++){const T=m[v];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,c,d,m,v,T,E,P,D,U){const q=e.indexArray,G=e.layoutVertexArray,J=e.segments.prepareSegment(4*n.length,G,q,this.canOverlap?m.sortKey:void 0),ne=this.glyphOffsetArray.length,oe=J.vertexLength,me=this.allowVerticalPlacement&&v===a.WritingMode.vertical?Math.PI/2:0,he=m.text&&m.text.sections;for(let be=0;be<n.length;be++){const{tl:Ie,tr:Be,bl:pt,br:ot,tex:Xe,pixelOffsetTL:lt,pixelOffsetBR:st,minFontScaleX:mt,minFontScaleY:at,glyphOffset:He,isSDF:At,sectionIndex:xt}=n[be],Yt=J.vertexLength,zi=He[1];Mu(G,T.x,T.y,Ie.x,zi+Ie.y,Xe.x,Xe.y,o,At,lt.x,lt.y,mt,at),Mu(G,T.x,T.y,Be.x,zi+Be.y,Xe.x+Xe.w,Xe.y,o,At,st.x,lt.y,mt,at),Mu(G,T.x,T.y,pt.x,zi+pt.y,Xe.x,Xe.y+Xe.h,o,At,lt.x,st.y,mt,at),Mu(G,T.x,T.y,ot.x,zi+ot.y,Xe.x+Xe.w,Xe.y+Xe.h,o,At,st.x,st.y,mt,at),Nh(e.dynamicLayoutVertexArray,T,me),q.emplaceBack(Yt,Yt+1,Yt+2),q.emplaceBack(Yt+1,Yt+2,Yt+3),J.vertexLength+=4,J.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(He[0]),be!==n.length-1&&xt===n[be+1].sectionIndex||e.programConfigurations.populatePaintArrays(G.length,m,m.index,{},U,he&&he[xt])}e.placedSymbolArray.emplaceBack(T.x,T.y,ne,this.glyphOffsetArray.length-ne,oe,E,P,T.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],v,0,!1,0,D)}_addCollisionDebugVertex(e,n,o,c,d,m){return n.emplaceBack(0,0),e.emplaceBack(o.x,o.y,c,d,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(e,n,o,c,d,m,v){const T=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),E=T.vertexLength,P=d.layoutVertexArray,D=d.collisionVertexArray,U=v.anchorX,q=v.anchorY;this._addCollisionDebugVertex(P,D,m,U,q,new ee(e,n)),this._addCollisionDebugVertex(P,D,m,U,q,new ee(o,n)),this._addCollisionDebugVertex(P,D,m,U,q,new ee(o,c)),this._addCollisionDebugVertex(P,D,m,U,q,new ee(e,c)),T.vertexLength+=4;const G=d.indexArray;G.emplaceBack(E,E+1),G.emplaceBack(E+1,E+2),G.emplaceBack(E+2,E+3),G.emplaceBack(E+3,E),T.primitiveLength+=4}addDebugCollisionBoxes(e,n,o,c){for(let d=e;d<n;d++){const m=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,c?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vh(rt,Vp.members,$i),this.iconCollisionBox=new Vh(rt,Vp.members,$i);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,o,c,d,m,v,T,E){const P={};for(let D=n;D<o;D++){const U=e.get(D);P.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},P.textFeatureIndex=U.featureIndex;break}for(let D=c;D<d;D++){const U=e.get(D);P.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},P.verticalTextFeatureIndex=U.featureIndex;break}for(let D=m;D<v;D++){const U=e.get(D);P.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},P.iconFeatureIndex=U.featureIndex;break}for(let D=T;D<E;D++){const U=e.get(D);P.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},P.verticalIconFeatureIndex=U.featureIndex;break}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const o=e.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let d=o.vertexStartIndex;d<c;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),o=Math.cos(e),c=[],d=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const T=this.symbolInstances.get(v);c.push(0|Math.round(n*T.anchorX+o*T.anchorY)),d.push(T.featureIndex)}return m.sort((v,T)=>c[v]-c[T]||d[T]-d[v]),m}addToSortKeyRanges(e,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((c,d,m)=>{c>=0&&m.indexOf(c)===d&&this.addIndicesForPlacedSymbol(this.text,c)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ed,td;dt("SymbolBucket",Hl,{omit:["layers","collisionBoxArray","features","compareText"]}),Hl.MAX_GLYPHS=65535,Hl.addDynamicAttributes=Nh;var qh={get paint(){return td=td||new Ki({"icon-opacity":new zt(ke.paint_symbol["icon-opacity"]),"icon-color":new zt(ke.paint_symbol["icon-color"]),"icon-halo-color":new zt(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new zt(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zt(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new zt(ke.paint_symbol["text-opacity"]),"text-color":new zt(ke.paint_symbol["text-color"],{runtimeType:gn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new zt(ke.paint_symbol["text-halo-color"]),"text-halo-width":new zt(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new zt(ke.paint_symbol["text-halo-blur"]),"text-translate":new bt(ke.paint_symbol["text-translate"]),"text-translate-anchor":new bt(ke.paint_symbol["text-translate-anchor"])})},get layout(){return ed=ed||new Ki({"symbol-placement":new bt(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zt(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new bt(ke.layout_symbol["icon-allow-overlap"]),"icon-overlap":new bt(ke.layout_symbol["icon-overlap"]),"icon-ignore-placement":new bt(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new zt(ke.layout_symbol["icon-size"]),"icon-text-fit":new bt(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new bt(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new zt(ke.layout_symbol["icon-image"]),"icon-rotate":new zt(ke.layout_symbol["icon-rotate"]),"icon-padding":new zt(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new zt(ke.layout_symbol["icon-offset"]),"icon-anchor":new zt(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(ke.layout_symbol["text-rotation-alignment"]),"text-field":new zt(ke.layout_symbol["text-field"]),"text-font":new zt(ke.layout_symbol["text-font"]),"text-size":new zt(ke.layout_symbol["text-size"]),"text-max-width":new zt(ke.layout_symbol["text-max-width"]),"text-line-height":new bt(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new zt(ke.layout_symbol["text-letter-spacing"]),"text-justify":new zt(ke.layout_symbol["text-justify"]),"text-radial-offset":new zt(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(ke.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new zt(ke.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new zt(ke.layout_symbol["text-anchor"]),"text-max-angle":new bt(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(ke.layout_symbol["text-writing-mode"]),"text-rotate":new zt(ke.layout_symbol["text-rotate"]),"text-padding":new bt(ke.layout_symbol["text-padding"]),"text-keep-upright":new bt(ke.layout_symbol["text-keep-upright"]),"text-transform":new zt(ke.layout_symbol["text-transform"]),"text-offset":new zt(ke.layout_symbol["text-offset"]),"text-allow-overlap":new bt(ke.layout_symbol["text-allow-overlap"]),"text-overlap":new bt(ke.layout_symbol["text-overlap"]),"text-ignore-placement":new bt(ke.layout_symbol["text-ignore-placement"]),"text-optional":new bt(ke.layout_symbol["text-optional"])})}};class id{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:mr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}dt("FormatSectionOverride",id,{omit:["defaultValue"]});class Pu extends Lr{constructor(e){super(e,qh)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const d of o)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,c){const d=this.layout.get(e).evaluate(n,{},o,c),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||xl(m.value)||!d?d:function(v,T){return T.replace(/{([^{}]+)}/g,(E,P)=>P in v?String(v[P]):"")}(n.properties,d)}createBucket(e){return new Hl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of qh.paint.overridableProperties){if(!Pu.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),o=new id(n),c=new Oi(o,n.property.specification);let d=null;d=n.value.kind==="constant"||n.value.kind==="source"?new ra("source",c):new Ui("composite",c,n.value.zoomStops),this.paint._values[e]=new vs(n.property,d,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Pu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const o=e.get("text-field"),c=qh.paint.properties[n];let d=!1;const m=v=>{for(const T of v)if(c.overrides&&c.overrides.hasOverride(T))return void(d=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Xi)m(o.value.value.sections);else if(o.value.kind==="source"){const v=E=>{d||(E instanceof wo&&yn(E.value)===En?m(E.value.sections):E instanceof Fa?m(E.sections):E.eachChild(v))},T=o.value;T._styleExpression&&v(T._styleExpression.expression)}return d}}let nd;var Gh={get paint(){return nd=nd||new Ki({"background-color":new bt(ke.paint_background["background-color"]),"background-pattern":new Oo(ke.paint_background["background-pattern"]),"background-opacity":new bt(ke.paint_background["background-opacity"])})}};class rd extends Lr{constructor(e){super(e,Gh)}}let sd;var Ef={get paint(){return sd=sd||new Ki({"raster-opacity":new bt(ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new bt(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(ke.paint_raster["raster-saturation"]),"raster-contrast":new bt(ke.paint_raster["raster-contrast"]),"raster-resampling":new bt(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(ke.paint_raster["raster-fade-duration"])})}};class Af extends Lr{constructor(e){super(e,Ef)}}class If extends Lr{constructor(e){super(e,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Cf{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Zh=63710088e-1;class Ea{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ea(Ct(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,o=this.lat*n,c=e.lat*n,d=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return Zh*Math.acos(Math.min(d,1))}static convert(e){if(e instanceof Ea)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ea(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ea(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const od=2*Math.PI*Zh;function jh(i){return od*Math.cos(i*Math.PI/180)}function ad(i){return(180+i)/360}function Uc(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function ld(i,e){return i/jh(e)}function Wh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class ku{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){const o=Ea.convert(e);return new ku(ad(o.lng),Uc(o.lat),ld(n,o.lat))}toLngLat(){return new Ea(360*this.x-180,Wh(this.y))}toAltitude(){return this.z*jh(Wh(this.y))}meterInMercatorCoordinateUnits(){return 1/od*(e=Wh(this.y),1/Math.cos(e*Math.PI/180));var e}}function cd(i,e,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class Hh{constructor(e,n,o){if(e<0||e>25||o<0||o>=Math.pow(2,e)||n<0||n>=Math.pow(2,e))throw new Error(`x=${n}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=o,this.key=Nc(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,o){const c=(m=this.y,v=this.z,T=cd(256*(d=this.x),256*(m=Math.pow(2,v)-m-1),v),E=cd(256*(d+1),256*(m+1),v),T[0]+","+T[1]+","+E[0]+","+E[1]);var d,m,v,T,E;const P=function(D,U,q){let G,J="";for(let ne=D;ne>0;ne--)G=1<<ne-1,J+=(U&G?1:0)+(q&G?2:0);return J}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new ee((e.x*n-this.x)*Qi,(e.y*n-this.y)*Qi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ud{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Nc(e,n.z,n.z,n.x,n.y)}}class As{constructor(e,n,o,c,d){if(e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=n,this.canonical=new Hh(o,+c,+d),this.key=Nc(n,e,o,c,d)}clone(){return new As(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new As(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new As(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Nc(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Nc(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new As(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new As(n,this.wrap,n,o,c),new As(n,this.wrap,n,o+1,c),new As(n,this.wrap,n,o,c+1),new As(n,this.wrap,n,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new As(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new As(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ud(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new ku(e.x-this.wrap,e.y))}}function Nc(i,e,n,o,c){(i*=2)<0&&(i=-1*i-1);const d=1<<n;return(d*d*i+d*c+o).toString(36)+n.toString(36)+e.toString(36)}dt("CanonicalTileID",Hh),dt("OverscaledTileID",As,{omit:["posMatrix"]});class hd{constructor(e,n,o){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void Dt(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const c=this.dim=n.height-2;this.data=new Uint32Array(n.data.buffer),this.encoding=o||"mapbox";for(let d=0;d<c;d++)this.data[this._idx(-1,d)]=this.data[this._idx(0,d)],this.data[this._idx(c,d)]=this.data[this._idx(c-1,d)],this.data[this._idx(d,-1)]=this.data[this._idx(d,0)],this.data[this._idx(d,c)]=this.data[this._idx(d,c-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(c,-1)]=this.data[this._idx(c-1,0)],this.data[this._idx(-1,c)]=this.data[this._idx(0,c-1)],this.data[this._idx(c,c)]=this.data[this._idx(c-1,c-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let d=0;d<c;d++)for(let m=0;m<c;m++){const v=this.get(d,m);v>this.max&&(this.max=v),v<this.min&&(this.min=v)}}get(e,n){const o=new Uint8Array(this.data.buffer),c=4*this._idx(e,n);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(o[c],o[c+1],o[c+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,o){return(256*e*256+256*n+o)/10-1e4}_unpackTerrarium(e,n,o){return 256*e+n+o/256-32768}getPixels(){return new Jr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,d=n*this.dim+this.dim,m=o*this.dim,v=o*this.dim+this.dim;switch(n){case-1:c=d-1;break;case 1:d=c+1}switch(o){case-1:m=v-1;break;case 1:v=m+1}const T=-n*this.dim,E=-o*this.dim;for(let P=m;P<v;P++)for(let D=c;D<d;D++)this.data[this._idx(D,P)]=e.data[this._idx(D+T,P+E)]}}dt("DEMData",hd);class pd{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class dd{constructor(e,n,o,c,d){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=o,e._y=c,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}class fd{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Bo(Qi,16,0),this.grid3D=new Bo(Qi,16,0),this.featureIndexArray=new xe,this.promoteId=n}insert(e,n,o,c,d,m){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,d);const T=m?this.grid3D:this.grid;for(let E=0;E<n.length;E++){const P=n[E],D=[1/0,1/0,-1/0,-1/0];for(let U=0;U<P.length;U++){const q=P[U];D[0]=Math.min(D[0],q.x),D[1]=Math.min(D[1],q.y),D[2]=Math.max(D[2],q.x),D[3]=Math.max(D[3],q.y)}D[0]<Qi&&D[1]<Qi&&D[2]>=0&&D[3]>=0&&T.insert(v,D[0],D[1],D[2],D[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ba.VectorTile(new Ph(this.rawTileData)).layers,this.sourceLayerCoder=new pd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,n,o,c){this.loadVTLayers();const d=e.params||{},m=Qi/e.tileSize/e.scale,v=_c(d.filter),T=e.queryGeometry,E=e.queryPadding*m,P=gd(T),D=this.grid.query(P.minX-E,P.minY-E,P.maxX+E,P.maxY+E),U=gd(e.cameraQueryGeometry),q=this.grid3D.query(U.minX-E,U.minY-E,U.maxX+E,U.maxY+E,(ne,oe,me,he)=>function(be,Ie,Be,pt,ot){for(const lt of be)if(Ie<=lt.x&&Be<=lt.y&&pt>=lt.x&&ot>=lt.y)return!0;const Xe=[new ee(Ie,Be),new ee(Ie,ot),new ee(pt,ot),new ee(pt,Be)];if(be.length>2){for(const lt of Xe)if(Ka(be,lt))return!0}for(let lt=0;lt<be.length-1;lt++)if(gp(be[lt],be[lt+1],Xe))return!0;return!1}(e.cameraQueryGeometry,ne-E,oe-E,me+E,he+E));for(const ne of q)D.push(ne);D.sort(Mf);const G={};let J;for(let ne=0;ne<D.length;ne++){const oe=D[ne];if(oe===J)continue;J=oe;const me=this.featureIndexArray.get(oe);let he=null;this.loadMatchingFeature(G,me.bucketIndex,me.sourceLayerIndex,me.featureIndex,v,d.layers,d.availableImages,n,o,c,(be,Ie,Be)=>(he||(he=ds(be)),Ie.queryIntersectsFeature(T,be,Be,he,this.z,e.transform,m,e.pixelPosMatrix)))}return G}loadMatchingFeature(e,n,o,c,d,m,v,T,E,P,D){const U=this.bucketLayerIDs[n];if(m&&!function(ne,oe){for(let me=0;me<ne.length;me++)if(oe.indexOf(ne[me])>=0)return!0;return!1}(m,U))return;const q=this.sourceLayerCoder.decode(o),G=this.vtLayers[q].feature(c);if(d.needGeometry){const ne=Js(G,!0);if(!d.filter(new Gi(this.tileID.overscaledZ),ne,this.tileID.canonical))return}else if(!d.filter(new Gi(this.tileID.overscaledZ),G))return;const J=this.getId(G,q);for(let ne=0;ne<U.length;ne++){const oe=U[ne];if(m&&m.indexOf(oe)<0)continue;const me=T[oe];if(!me)continue;let he={};J&&P&&(he=P.getState(me.sourceLayer||"_geojsonTileLayer",J));const be=Ve({},E[oe]);be.paint=md(be.paint,me.paint,G,he,v),be.layout=md(be.layout,me.layout,G,he,v);const Ie=!D||D(G,me,he);if(!Ie)continue;const Be=new dd(G,this.z,this.x,this.y,J);Be.layer=be;let pt=e[oe];pt===void 0&&(pt=e[oe]=[]),pt.push({featureIndex:c,feature:Be,intersectionZ:Ie})}}lookupSymbolFeatures(e,n,o,c,d,m,v,T){const E={};this.loadVTLayers();const P=_c(d);for(const D of e)this.loadMatchingFeature(E,o,c,D,P,m,v,T,n);return E}hasLayer(e){for(const n of this.bucketLayerIDs)for(const o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function md(i,e,n,o,c){return et(i,(d,m)=>{const v=e instanceof zl?e.get(m):null;return v&&v.evaluate?v.evaluate(n,o,c):v})}function gd(i){let e=1/0,n=1/0,o=-1/0,c=-1/0;for(const d of i)e=Math.min(e,d.x),n=Math.min(n,d.y),o=Math.max(o,d.x),c=Math.max(c,d.y);return{minX:e,minY:n,maxX:o,maxY:c}}function Mf(i,e){return e-i}function _d(i,e,n,o,c){const d=[];for(let m=0;m<i.length;m++){const v=i[m];let T;for(let E=0;E<v.length-1;E++){let P=v[E],D=v[E+1];P.x<e&&D.x<e||(P.x<e?P=new ee(e,P.y+(e-P.x)/(D.x-P.x)*(D.y-P.y))._round():D.x<e&&(D=new ee(e,P.y+(e-P.x)/(D.x-P.x)*(D.y-P.y))._round()),P.y<n&&D.y<n||(P.y<n?P=new ee(P.x+(n-P.y)/(D.y-P.y)*(D.x-P.x),n)._round():D.y<n&&(D=new ee(P.x+(n-P.y)/(D.y-P.y)*(D.x-P.x),n)._round()),P.x>=o&&D.x>=o||(P.x>=o?P=new ee(o,P.y+(o-P.x)/(D.x-P.x)*(D.y-P.y))._round():D.x>=o&&(D=new ee(o,P.y+(o-P.x)/(D.x-P.x)*(D.y-P.y))._round()),P.y>=c&&D.y>=c||(P.y>=c?P=new ee(P.x+(c-P.y)/(D.y-P.y)*(D.x-P.x),c)._round():D.y>=c&&(D=new ee(P.x+(c-P.y)/(D.y-P.y)*(D.x-P.x),c)._round()),T&&P.equals(T[T.length-1])||(T=[P],d.push(T)),T.push(D)))))}}return d}dt("FeatureIndex",fd,{omit:["rawTileData","sourceLayerCoder"]});class jo extends ee{constructor(e,n,o,c){super(e,n),this.angle=o,c!==void 0&&(this.segment=c)}clone(){return new jo(this.x,this.y,this.angle,this.segment)}}function Xh(i,e,n,o,c){if(e.segment===void 0||n===0)return!0;let d=e,m=e.segment+1,v=0;for(;v>-n/2;){if(m--,m<0)return!1;v-=i[m].dist(d),d=i[m]}v+=i[m].dist(i[m+1]),m++;const T=[];let E=0;for(;v<n/2;){const P=i[m],D=i[m+1];if(!D)return!1;let U=i[m-1].angleTo(P)-P.angleTo(D);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:v,angleDelta:U}),E+=U;v-T[0].distance>o;)E-=T.shift().angleDelta;if(E>c)return!1;m++,v+=P.dist(D)}return!0}function yd(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function vd(i,e,n){return i?.6*e*n:0}function xd(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Pf(i,e,n,o,c,d){const m=vd(n,c,d),v=xd(n,o)*d;let T=0;const E=yd(i)/2;for(let P=0;P<i.length-1;P++){const D=i[P],U=i[P+1],q=D.dist(U);if(T+q>E){const G=(E-T)/q,J=Hr.number(D.x,U.x,G),ne=Hr.number(D.y,U.y,G),oe=new jo(J,ne,U.angleTo(D),P);return oe._round(),!m||Xh(i,oe,v,m,e)?oe:void 0}T+=q}}function zu(i,e,n,o,c,d,m,v,T){const E=vd(o,d,m),P=xd(o,c),D=P*m,U=i[0].x===0||i[0].x===T||i[0].y===0||i[0].y===T;return e-D<e/4&&(e=D+e/4),bd(i,U?e/2*v%e:(P/2+2*d)*m*v%e,e,E,n,D,U,!1,T)}function bd(i,e,n,o,c,d,m,v,T){const E=d/2,P=yd(i);let D=0,U=e-n,q=[];for(let G=0;G<i.length-1;G++){const J=i[G],ne=i[G+1],oe=J.dist(ne),me=ne.angleTo(J);for(;U+n<D+oe;){U+=n;const he=(U-D)/oe,be=Hr.number(J.x,ne.x,he),Ie=Hr.number(J.y,ne.y,he);if(be>=0&&be<T&&Ie>=0&&Ie<T&&U-E>=0&&U+E<=P){const Be=new jo(be,Ie,me,G);Be._round(),o&&!Xh(i,Be,d,o,c)||q.push(Be)}}D+=oe}return v||q.length||m||(q=bd(i,D/2,n,o,c,d,m,!0,T)),q}dt("Anchor",jo);const Xl=Qr;function wd(i,e,n,o){const c=[],d=i.image,m=d.pixelRatio,v=d.paddedRect.w-2*Xl,T=d.paddedRect.h-2*Xl,E=i.right-i.left,P=i.bottom-i.top,D=d.stretchX||[[0,v]],U=d.stretchY||[[0,T]],q=(st,mt)=>st+mt[1]-mt[0],G=D.reduce(q,0),J=U.reduce(q,0),ne=v-G,oe=T-J;let me=0,he=G,be=0,Ie=J,Be=0,pt=ne,ot=0,Xe=oe;if(d.content&&o){const st=d.content;me=Du(D,0,st[0]),be=Du(U,0,st[1]),he=Du(D,st[0],st[2]),Ie=Du(U,st[1],st[3]),Be=st[0]-me,ot=st[1]-be,pt=st[2]-st[0]-he,Xe=st[3]-st[1]-Ie}const lt=(st,mt,at,He)=>{const At=Lu(st.stretch-me,he,E,i.left),xt=Ru(st.fixed-Be,pt,st.stretch,G),Yt=Lu(mt.stretch-be,Ie,P,i.top),zi=Ru(mt.fixed-ot,Xe,mt.stretch,J),Zi=Lu(at.stretch-me,he,E,i.left),Bn=Ru(at.fixed-Be,pt,at.stretch,G),es=Lu(He.stretch-be,Ie,P,i.top),Kn=Ru(He.fixed-ot,Xe,He.stretch,J),Ai=new ee(At,Yt),rn=new ee(Zi,Yt),sr=new ee(Zi,es),ts=new ee(At,es),Fr=new ee(xt/m,zi/m),Pn=new ee(Bn/m,Kn/m),Fn=e*Math.PI/180;if(Fn){const Ut=Math.sin(Fn),Or=Math.cos(Fn),wi=[Or,-Ut,Ut,Or];Ai._matMult(wi),rn._matMult(wi),ts._matMult(wi),sr._matMult(wi)}const or=st.stretch+st.fixed,hn=mt.stretch+mt.fixed;return{tl:Ai,tr:rn,bl:ts,br:sr,tex:{x:d.paddedRect.x+Xl+or,y:d.paddedRect.y+Xl+hn,w:at.stretch+at.fixed-or,h:He.stretch+He.fixed-hn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fr,pixelOffsetBR:Pn,minFontScaleX:pt/m/E,minFontScaleY:Xe/m/P,isSDF:n}};if(o&&(d.stretchX||d.stretchY)){const st=Td(D,ne,G),mt=Td(U,oe,J);for(let at=0;at<st.length-1;at++){const He=st[at],At=st[at+1];for(let xt=0;xt<mt.length-1;xt++)c.push(lt(He,mt[xt],At,mt[xt+1]))}}else c.push(lt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:T+1}));return c}function Du(i,e,n){let o=0;for(const c of i)o+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return o}function Td(i,e,n){const o=[{fixed:-Xl,stretch:0}];for(const[c,d]of i){const m=o[o.length-1];o.push({fixed:c-m.stretch,stretch:m.stretch}),o.push({fixed:c-m.stretch,stretch:m.stretch+(d-c)})}return o.push({fixed:e+Xl,stretch:n}),o}function Lu(i,e,n,o){return i/e*n+o}function Ru(i,e,n,o){return i-e*n/o}class Bu{constructor(e,n,o,c,d,m,v,T,E,P){if(this.boxStartIndex=e.length,E){let D=m.top,U=m.bottom;const q=m.collisionPadding;q&&(D-=q[1],U+=q[3]);let G=U-D;G>0&&(G=Math.max(10,G),this.circleDiameter=G)}else{let D=m.top*v-T[0],U=m.bottom*v+T[2],q=m.left*v-T[3],G=m.right*v+T[1];const J=m.collisionPadding;if(J&&(q-=J[0]*v,D-=J[1]*v,G+=J[2]*v,U+=J[3]*v),P){const ne=new ee(q,D),oe=new ee(G,D),me=new ee(q,U),he=new ee(G,U),be=P*Math.PI/180;ne._rotate(be),oe._rotate(be),me._rotate(be),he._rotate(be),q=Math.min(ne.x,oe.x,me.x,he.x),G=Math.max(ne.x,oe.x,me.x,he.x),D=Math.min(ne.y,oe.y,me.y,he.y),U=Math.max(ne.y,oe.y,me.y,he.y)}e.emplaceBack(n.x,n.y,q,D,G,U,o,c,d)}this.boxEndIndex=e.length}}class kf{constructor(e=[],n=zf){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,c=n[e];for(;e>0;){const d=e-1>>1,m=n[d];if(o(c,m)>=0)break;n[e]=m,e=d}n[e]=c}_down(e){const{data:n,compare:o}=this,c=this.length>>1,d=n[e];for(;e<c;){let m=1+(e<<1),v=n[m];const T=m+1;if(T<this.length&&o(n[T],v)<0&&(m=T,v=n[T]),o(v,d)>=0)break;n[e]=v,e=m}n[e]=d}}function zf(i,e){return i<e?-1:i>e?1:0}function Df(i,e=1,n=!1){let o=1/0,c=1/0,d=-1/0,m=-1/0;const v=i[0];for(let q=0;q<v.length;q++){const G=v[q];(!q||G.x<o)&&(o=G.x),(!q||G.y<c)&&(c=G.y),(!q||G.x>d)&&(d=G.x),(!q||G.y>m)&&(m=G.y)}const T=Math.min(d-o,m-c);let E=T/2;const P=new kf([],Fu);if(T===0)return new ee(o,c);for(let q=o;q<d;q+=T)for(let G=c;G<m;G+=T)P.push(new Kl(q+E,G+E,E,i));let D=function(q){let G=0,J=0,ne=0;const oe=q[0];for(let me=0,he=oe.length,be=he-1;me<he;be=me++){const Ie=oe[me],Be=oe[be],pt=Ie.x*Be.y-Be.x*Ie.y;J+=(Ie.x+Be.x)*pt,ne+=(Ie.y+Be.y)*pt,G+=3*pt}return new Kl(J/G,ne/G,0,q)}(i),U=P.length;for(;P.length;){const q=P.pop();(q.d>D.d||!D.d)&&(D=q,n&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,U)),q.max-D.d<=e||(E=q.h/2,P.push(new Kl(q.p.x-E,q.p.y-E,E,i)),P.push(new Kl(q.p.x+E,q.p.y-E,E,i)),P.push(new Kl(q.p.x-E,q.p.y+E,E,i)),P.push(new Kl(q.p.x+E,q.p.y+E,E,i)),U+=4)}return n&&(console.log(`num probes: ${U}`),console.log(`best distance: ${D.d}`)),D.p}function Fu(i,e){return e.max-i.max}function Kl(i,e,n,o){this.p=new ee(i,e),this.h=n,this.d=function(c,d){let m=!1,v=1/0;for(let T=0;T<d.length;T++){const E=d[T];for(let P=0,D=E.length,U=D-1;P<D;U=P++){const q=E[P],G=E[U];q.y>c.y!=G.y>c.y&&c.x<(G.x-q.x)*(c.y-q.y)/(G.y-q.y)+q.x&&(m=!m),v=Math.min(v,uu(c,q,G))}}return(m?1:-1)*Math.sqrt(v)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Xn;a.TextAnchorEnum=void 0,(Xn=a.TextAnchorEnum||(a.TextAnchorEnum={}))[Xn.center=1]="center",Xn[Xn.left=2]="left",Xn[Xn.right=3]="right",Xn[Xn.top=4]="top",Xn[Xn.bottom=5]="bottom",Xn[Xn["top-left"]=6]="top-left",Xn[Xn["top-right"]=7]="top-right",Xn[Xn["bottom-left"]=8]="bottom-left",Xn[Xn["bottom-right"]=9]="bottom-right";const Wo=7,$c=Number.POSITIVE_INFINITY;function Kh(i,e){return e[1]!==$c?function(n,o,c){let d=0,m=0;switch(o=Math.abs(o),c=Math.abs(c),n){case"top-right":case"top-left":case"top":m=c-Wo;break;case"bottom-right":case"bottom-left":case"bottom":m=-c+Wo}switch(n){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}return[d,m]}(i,e[0],e[1]):function(n,o){let c=0,d=0;o<0&&(o=0);const m=o/Math.sqrt(2);switch(n){case"top-right":case"top-left":d=m-Wo;break;case"bottom-right":case"bottom-left":d=-m+Wo;break;case"bottom":d=-o+Wo;break;case"top":d=o-Wo}switch(n){case"top-right":case"bottom-right":c=-m;break;case"top-left":case"bottom-left":c=m;break;case"left":c=o;break;case"right":c=-o}return[c,d]}(i,e[0])}function Yh(i,e,n){var o;const c=i.layout,d=(o=c.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},n);if(d){const v=d.values,T=[];for(let E=0;E<v.length;E+=2){const P=T[E]=v[E],D=v[E+1].map(U=>U*Mn);P.startsWith("top")?D[1]-=Wo:P.startsWith("bottom")&&(D[1]+=Wo),T[E+1]=D}return new nr(T)}const m=c.get("text-variable-anchor");if(m){let v;v=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(e,{},n)*Mn,$c]:c.get("text-offset").evaluate(e,{},n).map(E=>E*Mn);const T=[];for(const E of m)T.push(E,Kh(E,v));return new nr(T)}return null}function Ou(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Sd(i,e,n,o,c,d,m,v,T,E,P){let D=d.textMaxSize.evaluate(e,{});D===void 0&&(D=m);const U=i.layers[0].layout,q=U.get("icon-offset").evaluate(e,{},P),G=Ad(n.horizontal),J=m/24,ne=i.tilePixelRatio*J,oe=i.tilePixelRatio*D/24,me=i.tilePixelRatio*v,he=i.tilePixelRatio*U.get("symbol-spacing"),be=U.get("text-padding")*i.tilePixelRatio,Ie=function(He,At,xt,Yt=1){const zi=He.get("icon-padding").evaluate(At,{},xt),Zi=zi&&zi.values;return[Zi[0]*Yt,Zi[1]*Yt,Zi[2]*Yt,Zi[3]*Yt]}(U,e,P,i.tilePixelRatio),Be=U.get("text-max-angle")/180*Math.PI,pt=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",ot=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Xe=U.get("symbol-placement"),lt=he/2,st=U.get("icon-text-fit");let mt;o&&st!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(mt=Jp(o,n.vertical,st,U.get("icon-text-fit-padding"),q,J)),G&&(o=Jp(o,G,st,U.get("icon-text-fit-padding"),q,J)));const at=(He,At)=>{At.x<0||At.x>=Qi||At.y<0||At.y>=Qi||function(xt,Yt,zi,Zi,Bn,es,Kn,Ai,rn,sr,ts,Fr,Pn,Fn,or,hn,Ut,Or,wi,Yn,ui,ri,ar,Sr,is){const Qs=xt.addToLineVertexArray(Yt,zi);let eo,Ho,Us,Is,ns=0,Xo=0,Gc=0,Md=0,np=-1,rp=-1;const Ko={};let Pd=Xs("");if(xt.allowVerticalPlacement&&Zi.vertical){const cr=Ai.layout.get("text-rotate").evaluate(ui,{},Sr)+90;Us=new Bu(rn,Yt,sr,ts,Fr,Zi.vertical,Pn,Fn,or,cr),Kn&&(Is=new Bu(rn,Yt,sr,ts,Fr,Kn,Ut,Or,or,cr))}if(Bn){const cr=Ai.layout.get("icon-rotate").evaluate(ui,{}),Cs=Ai.layout.get("icon-text-fit")!=="none",rl=wd(Bn,cr,ar,Cs),io=Kn?wd(Kn,cr,ar,Cs):void 0;Ho=new Bu(rn,Yt,sr,ts,Fr,Bn,Ut,Or,!1,cr),ns=4*rl.length;const Aa=xt.iconSizeData;let no=null;Aa.kind==="source"?(no=[vo*Ai.layout.get("icon-size").evaluate(ui,{})],no[0]>Sa&&Dt(`${xt.layerIds[0]}: Value for "icon-size" is >= ${Oc}. Reduce your "icon-size".`)):Aa.kind==="composite"&&(no=[vo*ri.compositeIconSizes[0].evaluate(ui,{},Sr),vo*ri.compositeIconSizes[1].evaluate(ui,{},Sr)],(no[0]>Sa||no[1]>Sa)&&Dt(`${xt.layerIds[0]}: Value for "icon-size" is >= ${Oc}. Reduce your "icon-size".`)),xt.addSymbols(xt.icon,rl,no,Yn,wi,ui,a.WritingMode.none,Yt,Qs.lineStartIndex,Qs.lineLength,-1,Sr),np=xt.icon.placedSymbolArray.length-1,io&&(Xo=4*io.length,xt.addSymbols(xt.icon,io,no,Yn,wi,ui,a.WritingMode.vertical,Yt,Qs.lineStartIndex,Qs.lineLength,-1,Sr),rp=xt.icon.placedSymbolArray.length-1)}const $u=Object.keys(Zi.horizontal);for(const cr of $u){const Cs=Zi.horizontal[cr];if(!eo){Pd=Xs(Cs.text);const io=Ai.layout.get("text-rotate").evaluate(ui,{},Sr);eo=new Bu(rn,Yt,sr,ts,Fr,Cs,Pn,Fn,or,io)}const rl=Cs.positionedLines.length===1;if(Gc+=Ed(xt,Yt,Cs,es,Ai,or,ui,hn,Qs,Zi.vertical?a.WritingMode.horizontal:a.WritingMode.horizontalOnly,rl?$u:[cr],Ko,np,ri,Sr),rl)break}Zi.vertical&&(Md+=Ed(xt,Yt,Zi.vertical,es,Ai,or,ui,hn,Qs,a.WritingMode.vertical,["vertical"],Ko,rp,ri,Sr));const Bf=eo?eo.boxStartIndex:xt.collisionBoxArray.length,sp=eo?eo.boxEndIndex:xt.collisionBoxArray.length,Ff=Us?Us.boxStartIndex:xt.collisionBoxArray.length,Of=Us?Us.boxEndIndex:xt.collisionBoxArray.length,Uf=Ho?Ho.boxStartIndex:xt.collisionBoxArray.length,lr=Ho?Ho.boxEndIndex:xt.collisionBoxArray.length,ms=Is?Is.boxStartIndex:xt.collisionBoxArray.length,Nf=Is?Is.boxEndIndex:xt.collisionBoxArray.length;let to=-1;const Vu=(cr,Cs)=>cr&&cr.circleDiameter?Math.max(cr.circleDiameter,Cs):Cs;to=Vu(eo,to),to=Vu(Us,to),to=Vu(Ho,to),to=Vu(Is,to);const op=to>-1?1:0;op&&(to*=is/Mn),xt.glyphOffsetArray.length>=Hl.MAX_GLYPHS&&Dt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ui.sortKey!==void 0&&xt.addToSortKeyRanges(xt.symbolInstances.length,ui.sortKey);const $f=Yh(Ai,ui,Sr),[Vf,qf]=function(cr,Cs){const rl=cr.length,io=Cs==null?void 0:Cs.values;if((io==null?void 0:io.length)>0)for(let Aa=0;Aa<io.length;Aa+=2){const no=io[Aa+1];cr.emplaceBack(a.TextAnchorEnum[io[Aa]],no[0],no[1])}return[rl,cr.length]}(xt.textAnchorOffsets,$f);xt.symbolInstances.emplaceBack(Yt.x,Yt.y,Ko.right>=0?Ko.right:-1,Ko.center>=0?Ko.center:-1,Ko.left>=0?Ko.left:-1,Ko.vertical||-1,np,rp,Pd,Bf,sp,Ff,Of,Uf,lr,ms,Nf,sr,Gc,Md,ns,Xo,op,0,Pn,to,Vf,qf)}(i,At,He,n,o,c,mt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,ne,[be,be,be,be],pt,T,me,Ie,ot,q,e,d,E,P,m)};if(Xe==="line")for(const He of _d(e.geometry,0,0,Qi,Qi)){const At=zu(He,he,Be,n.vertical||G,o,24,oe,i.overscaling,Qi);for(const xt of At)G&&Lf(i,G.text,lt,xt)||at(He,xt)}else if(Xe==="line-center"){for(const He of e.geometry)if(He.length>1){const At=Pf(He,Be,n.vertical||G,o,24,oe);At&&at(He,At)}}else if(e.type==="Polygon")for(const He of yu(e.geometry,0)){const At=Df(He,16);at(He[0],new jo(At.x,At.y,0))}else if(e.type==="LineString")for(const He of e.geometry)at(He,new jo(He[0].x,He[0].y,0));else if(e.type==="Point")for(const He of e.geometry)for(const At of He)at([At],new jo(At.x,At.y,0))}function Ed(i,e,n,o,c,d,m,v,T,E,P,D,U,q,G){const J=function(me,he,be,Ie,Be,pt,ot,Xe){const lt=Ie.layout.get("text-rotate").evaluate(pt,{})*Math.PI/180,st=[];for(const mt of he.positionedLines)for(const at of mt.positionedGlyphs){if(!at.rect)continue;const He=at.rect||{};let At=zh+1,xt=!0,Yt=1,zi=0;const Zi=(Be||Xe)&&at.vertical,Bn=at.metrics.advance*at.scale/2;if(Xe&&he.verticalizable&&(zi=mt.lineOffset/2-(at.imageName?-(Mn-at.metrics.width*at.scale)/2:(at.scale-1)*Mn)),at.imageName){const wi=ot[at.imageName];xt=wi.sdf,Yt=wi.pixelRatio,At=Qr/Yt}const es=Be?[at.x+Bn,at.y]:[0,0];let Kn=Be?[0,0]:[at.x+Bn+be[0],at.y+be[1]-zi],Ai=[0,0];Zi&&(Ai=Kn,Kn=[0,0]);const rn=(at.metrics.left-At)*at.scale-Bn+Kn[0],sr=(-at.metrics.top-At)*at.scale+Kn[1],ts=rn+He.w*at.scale/Yt,Fr=sr+He.h*at.scale/Yt,Pn=new ee(rn,sr),Fn=new ee(ts,sr),or=new ee(rn,Fr),hn=new ee(ts,Fr);if(Zi){const wi=new ee(-Bn,Bn-Bc),Yn=-Math.PI/2,ui=Mn/2-Bn,ri=new ee(5-Bc-ui,-(at.imageName?ui:0)),ar=new ee(...Ai);Pn._rotateAround(Yn,wi)._add(ri)._add(ar),Fn._rotateAround(Yn,wi)._add(ri)._add(ar),or._rotateAround(Yn,wi)._add(ri)._add(ar),hn._rotateAround(Yn,wi)._add(ri)._add(ar)}if(lt){const wi=Math.sin(lt),Yn=Math.cos(lt),ui=[Yn,-wi,wi,Yn];Pn._matMult(ui),Fn._matMult(ui),or._matMult(ui),hn._matMult(ui)}const Ut=new ee(0,0),Or=new ee(0,0);st.push({tl:Pn,tr:Fn,bl:or,br:hn,tex:He,writingMode:he.writingMode,glyphOffset:es,sectionIndex:at.sectionIndex,isSDF:xt,pixelOffsetTL:Ut,pixelOffsetBR:Or,minFontScaleX:0,minFontScaleY:0})}return st}(0,n,v,c,d,m,o,i.allowVerticalPlacement),ne=i.textSizeData;let oe=null;ne.kind==="source"?(oe=[vo*c.layout.get("text-size").evaluate(m,{})],oe[0]>Sa&&Dt(`${i.layerIds[0]}: Value for "text-size" is >= ${Oc}. Reduce your "text-size".`)):ne.kind==="composite"&&(oe=[vo*q.compositeTextSizes[0].evaluate(m,{},G),vo*q.compositeTextSizes[1].evaluate(m,{},G)],(oe[0]>Sa||oe[1]>Sa)&&Dt(`${i.layerIds[0]}: Value for "text-size" is >= ${Oc}. Reduce your "text-size".`)),i.addSymbols(i.text,J,oe,v,d,m,E,e,T.lineStartIndex,T.lineLength,U,G);for(const me of P)D[me]=i.text.placedSymbolArray.length-1;return 4*J.length}function Ad(i){for(const e in i)return i[e];return null}function Lf(i,e,n,o){const c=i.compareText;if(e in c){const d=c[e];for(let m=d.length-1;m>=0;m--)if(o.dist(d[m])<n)return!0}else c[e]=[];return c[e].push(o),!1}const Vc=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yl{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const d=Vc[15&o];if(!d)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new Yl(v,m,d,e)}constructor(e,n=64,o=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=Vc.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-v%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+v+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Jh(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:m,nodeSize:v}=this,T=[0,d.length-1,0],E=[];for(;T.length;){const P=T.pop()||0,D=T.pop()||0,U=T.pop()||0;if(D-U<=v){for(let ne=U;ne<=D;ne++){const oe=m[2*ne],me=m[2*ne+1];oe>=e&&oe<=o&&me>=n&&me<=c&&E.push(d[ne])}continue}const q=U+D>>1,G=m[2*q],J=m[2*q+1];G>=e&&G<=o&&J>=n&&J<=c&&E.push(d[q]),(P===0?e<=G:n<=J)&&(T.push(U),T.push(q-1),T.push(1-P)),(P===0?o>=G:c>=J)&&(T.push(q+1),T.push(D),T.push(1-P))}return E}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:m}=this,v=[0,c.length-1,0],T=[],E=o*o;for(;v.length;){const P=v.pop()||0,D=v.pop()||0,U=v.pop()||0;if(D-U<=m){for(let ne=U;ne<=D;ne++)Cd(d[2*ne],d[2*ne+1],e,n)<=E&&T.push(c[ne]);continue}const q=U+D>>1,G=d[2*q],J=d[2*q+1];Cd(G,J,e,n)<=E&&T.push(c[q]),(P===0?e-o<=G:n-o<=J)&&(v.push(U),v.push(q-1),v.push(1-P)),(P===0?e+o>=G:n+o>=J)&&(v.push(q+1),v.push(D),v.push(1-P))}return T}}function Jh(i,e,n,o,c,d){if(c-o<=n)return;const m=o+c>>1;Id(i,e,m,o,c,d),Jh(i,e,n,o,m-1,1-d),Jh(i,e,n,m+1,c,1-d)}function Id(i,e,n,o,c,d){for(;c>o;){if(c-o>600){const E=c-o+1,P=n-o+1,D=Math.log(E),U=.5*Math.exp(2*D/3),q=.5*Math.sqrt(D*U*(E-U)/E)*(P-E/2<0?-1:1);Id(i,e,n,Math.max(o,Math.floor(n-P*U/E+q)),Math.min(c,Math.floor(n+(E-P)*U/E+q)),d)}const m=e[2*n+d];let v=o,T=c;for(nl(i,e,o,n),e[2*c+d]>m&&nl(i,e,o,c);v<T;){for(nl(i,e,v,T),v++,T--;e[2*v+d]<m;)v++;for(;e[2*T+d]>m;)T--}e[2*o+d]===m?nl(i,e,o,T):(T++,nl(i,e,T,c)),T<=n&&(o=T+1),n<=T&&(c=T-1)}}function nl(i,e,n,o){Uu(i,n,o),Uu(e,2*n,2*o),Uu(e,2*n+1,2*o+1)}function Uu(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}function Cd(i,e,n,o){const c=i-n,d=e-o;return c*c+d*d}var Qh;a.PerformanceMarkers=void 0,(Qh=a.PerformanceMarkers||(a.PerformanceMarkers={})).create="create",Qh.load="load",Qh.fullLoad="fullLoad";let Nu=null,qc=[];const ep=1e3/60,tp="loadTime",ip="fullLoadTime",Rf={mark(i){performance.mark(i)},frame(i){const e=i;Nu!=null&&qc.push(e-Nu),Nu=e},clearMetrics(){Nu=null,qc=[],performance.clearMeasures(tp),performance.clearMeasures(ip);for(const i in a.PerformanceMarkers)performance.clearMarks(a.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure(tp,a.PerformanceMarkers.create,a.PerformanceMarkers.load),performance.measure(ip,a.PerformanceMarkers.create,a.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName(tp)[0].duration,e=performance.getEntriesByName(ip)[0].duration,n=qc.length,o=1/(qc.reduce((d,m)=>d+m,0)/n/1e3),c=qc.filter(d=>d>ep).reduce((d,m)=>d+(m-ep)/ep,0);return{loadTime:i,fullLoadTime:e,fps:o,percentDroppedFrames:c/(n+c)*100,totalFrames:n}}};a.AJAXError=ei,a.ARRAY_TYPE=ga,a.Actor=class{constructor(i,e,n){this.receive=o=>{const c=o.data,d=c.id;if(d&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){delete this.tasks[d];const m=this.cancelCallbacks[d];delete this.cancelCallbacks[d],m&&m()}else kt()||c.mustQueue?(this.tasks[d]=c,this.taskQueue.push(d),this.invoker.trigger()):this.processTask(d,c)},this.process=()=>{if(!this.taskQueue.length)return;const o=this.taskQueue.shift(),c=this.tasks[o];delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),c&&this.processTask(o,c)},this.target=i,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Cf(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=kt()?i:window}send(i,e,n,o,c=!1){const d=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[d]=n);const m=Tt(this.globalScope)?void 0:[];return this.target.postMessage({id:d,type:i,hasCallback:!!n,targetMapId:o,mustQueue:c,sourceMapId:this.mapId,data:mi(e,m)},m),{cancel:()=>{n&&delete this.callbacks[d],this.target.postMessage({id:d,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const n=this.callbacks[i];delete this.callbacks[i],n&&(e.error?n(oa(e.error)):n(null,oa(e.data)))}else{let n=!1;const o=Tt(this.globalScope)?void 0:[],c=e.hasCallback?(v,T)=>{n=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:v?mi(v):null,data:mi(T,o)},o)}:v=>{n=!0};let d=null;const m=oa(e.data);if(this.parent[e.type])d=this.parent[e.type](e.sourceMapId,m,c);else if(this.parent.getWorkerSource){const v=e.type.split(".");d=this.parent.getWorkerSource(e.sourceMapId,v[0],m.source)[v[1]](m,c)}else c(new Error(`Could not find function ${e.type}`));!n&&d&&d.cancel&&(this.cancelCallbacks[i]=d.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.AlphaImage=_a,a.CanonicalTileID=Hh,a.CollisionBoxArray=S,a.CollisionCircleLayoutArray=class extends Rl{},a.Color=Bt,a.DEMData=hd,a.DataConstantProperty=bt,a.DictionaryCoder=pd,a.EXTENT=Qi,a.ErrorEvent=On,a.EvaluationParameters=Gi,a.Event=on,a.Evented=dr,a.FeatureIndex=fd,a.FillBucket=Vl,a.FillExtrusionBucket=Gt,a.GeoJSONFeature=dd,a.ImageAtlas=Lh,a.ImagePosition=Dh,a.KDBush=Yl,a.LineBucket=Ah,a.LineStripIndexArray=class extends f{},a.LngLat=Ea,a.MercatorCoordinate=ku,a.ONE_EM=Mn,a.OverscaledTileID=As,a.PerformanceUtils=Rf,a.Point=ee,a.Pos3dArray=class extends pa{},a.PosArray=re,a.Properties=Ki,a.Protobuf=Ph,a.QuadTriangleArray=class extends Bl{},a.RGBAImage=Jr,a.RasterBoundsArray=class extends Uo{},a.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},a.SegmentVector=Pt,a.SymbolBucket=Hl,a.Transitionable=kl,a.TriangleIndexArray=gt,a.Uniform1f=Rn,a.Uniform1i=class extends Yi{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.Uniform2f=class extends Yi{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},a.Uniform3f=class extends Yi{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},a.Uniform4f=br,a.UniformColor=un,a.UniformMatrix4f=class extends Yi{constructor(i,e){super(i,e),this.current=wn}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},a.UnwrappedTileID=ud,a.ValidationError=Je,a.ZoomHistory=Za,a.addDynamicAttributes=Nh,a.arrayBufferToImage=function(i,e){const n=new Image;n.onload=()=>{e(null,n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame(()=>{n.src=yi})},n.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new Blob([new Uint8Array(i)],{type:"image/png"});n.src=i.byteLength?URL.createObjectURL(o):yi},a.arrayBufferToImageBitmap=function(i,e){const n=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(n).then(o=>{e(null,o)}).catch(o=>{e(new Error(`Could not load image because of ${o.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},a.asyncAll=function(i,e,n){if(!i.length)return n(null,[]);let o=i.length;const c=new Array(i.length);let d=null;i.forEach((m,v)=>{e(m,(T,E)=>{T&&(d=T),c[v]=E,--o==0&&n(d,c)})})},a.bezier=$e,a.browser=sn,a.clamp=Ze,a.clipLine=_d,a.clone=function(i){var e=new ga(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},a.clone$1=ut,a.collisionCircleLayout=hf,a.config=fn,a.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.create=function(){var i=new ga(16);return ga!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},a.createExpression=ti,a.createFilter=_c,a.createLayout=bn,a.createStyleLayer=function(i){if(i.type==="custom")return new If(i);switch(i.type){case"background":return new rd(i);case"circle":return new Xd(i);case"fill":return new Mp(i);case"fill-extrusion":return new Eh(i);case"heatmap":return new xp(i);case"hillshade":return new mh(i);case"line":return new uf(i);case"raster":return new Af(i);case"symbol":return new Pu(i)}},a.deepEqual=function i(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let o=0;o<e.length;o++)if(!i(e[o],n[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const o in e)if(!i(e[o],n[o]))return!1;return!0}return e===n},a.defaultEasing=De,a.derefLayers=function(i){i=i.slice();const e=Object.create(null);for(let n=0;n<i.length;n++)e[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=Vr(i[n],e[i[n].ref]));return i},a.diffStyles=function(i,e){if(!i)return[{command:Kt.setStyle,args:[e]}];let n=[];try{if(!li(i.version,e.version))return[{command:Kt.setStyle,args:[e]}];li(i.center,e.center)||n.push({command:Kt.setCenter,args:[e.center]}),li(i.zoom,e.zoom)||n.push({command:Kt.setZoom,args:[e.zoom]}),li(i.bearing,e.bearing)||n.push({command:Kt.setBearing,args:[e.bearing]}),li(i.pitch,e.pitch)||n.push({command:Kt.setPitch,args:[e.pitch]}),li(i.sprite,e.sprite)||n.push({command:Kt.setSprite,args:[e.sprite]}),li(i.glyphs,e.glyphs)||n.push({command:Kt.setGlyphs,args:[e.glyphs]}),li(i.transition,e.transition)||n.push({command:Kt.setTransition,args:[e.transition]}),li(i.light,e.light)||n.push({command:Kt.setLight,args:[e.light]});const o={},c=[];(function(m,v,T,E){let P;for(P in v=v||{},m=m||{})Object.prototype.hasOwnProperty.call(m,P)&&(Object.prototype.hasOwnProperty.call(v,P)||fr(P,T,E));for(P in v)Object.prototype.hasOwnProperty.call(v,P)&&(Object.prototype.hasOwnProperty.call(m,P)?li(m[P],v[P])||(m[P].type==="geojson"&&v[P].type==="geojson"&&qn(m,v,P)?T.push({command:Kt.setGeoJSONSourceData,args:[P,v[P].data]}):as(P,v,T,E)):os(P,v,T))})(i.sources,e.sources,c,o);const d=[];i.layers&&i.layers.forEach(m=>{o[m.source]?n.push({command:Kt.removeLayer,args:[m.id]}):d.push(m)}),n=n.concat(c),function(m,v,T){v=v||[];const E=(m=m||[]).map(qr),P=v.map(qr),D=m.reduce(Ls,{}),U=v.reduce(Ls,{}),q=E.slice(),G=Object.create(null);let J,ne,oe,me,he,be,Ie;for(J=0,ne=0;J<E.length;J++)oe=E[J],Object.prototype.hasOwnProperty.call(U,oe)?ne++:(T.push({command:Kt.removeLayer,args:[oe]}),q.splice(q.indexOf(oe,ne),1));for(J=0,ne=0;J<P.length;J++)oe=P[P.length-1-J],q[q.length-1-J]!==oe&&(Object.prototype.hasOwnProperty.call(D,oe)?(T.push({command:Kt.removeLayer,args:[oe]}),q.splice(q.lastIndexOf(oe,q.length-ne),1)):ne++,be=q[q.length-J],T.push({command:Kt.addLayer,args:[U[oe],be]}),q.splice(q.length-J,0,oe),G[oe]=!0);for(J=0;J<P.length;J++)if(oe=P[J],me=D[oe],he=U[oe],!G[oe]&&!li(me,he))if(li(me.source,he.source)&&li(me["source-layer"],he["source-layer"])&&li(me.type,he.type)){for(Ie in hi(me.layout,he.layout,T,oe,null,Kt.setLayoutProperty),hi(me.paint,he.paint,T,oe,null,Kt.setPaintProperty),li(me.filter,he.filter)||T.push({command:Kt.setFilter,args:[oe,he.filter]}),li(me.minzoom,he.minzoom)&&li(me.maxzoom,he.maxzoom)||T.push({command:Kt.setLayerZoomRange,args:[oe,he.minzoom,he.maxzoom]}),me)Object.prototype.hasOwnProperty.call(me,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?hi(me[Ie],he[Ie],T,oe,Ie.slice(6),Kt.setPaintProperty):li(me[Ie],he[Ie])||T.push({command:Kt.setLayerProperty,args:[oe,Ie,he[Ie]]}));for(Ie in he)Object.prototype.hasOwnProperty.call(he,Ie)&&!Object.prototype.hasOwnProperty.call(me,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?hi(me[Ie],he[Ie],T,oe,Ie.slice(6),Kt.setPaintProperty):li(me[Ie],he[Ie])||T.push({command:Kt.setLayerProperty,args:[oe,Ie,he[Ie]]}))}else T.push({command:Kt.removeLayer,args:[oe]}),be=q[q.lastIndexOf(oe)+1],T.push({command:Kt.addLayer,args:[he,be]})}(d,e.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:Kt.setStyle,args:[e]}]}return n},a.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},a.earthRadius=Zh,a.emitValidationErrors=qa,a.emptyStyle=function(){const i={},e=ke.$version;for(const n in ke.$root){const o=ke.$root[n];if(o.required){let c=null;c=n==="version"?e:o.type==="array"?[]:{},c!=null&&(i[n]=c)}}return i},a.equals=function(i,e){var n=i[0],o=i[1],c=i[2],d=i[3],m=i[4],v=i[5],T=i[6],E=i[7],P=i[8],D=i[9],U=i[10],q=i[11],G=i[12],J=i[13],ne=i[14],oe=i[15],me=e[0],he=e[1],be=e[2],Ie=e[3],Be=e[4],pt=e[5],ot=e[6],Xe=e[7],lt=e[8],st=e[9],mt=e[10],at=e[11],He=e[12],At=e[13],xt=e[14],Yt=e[15];return Math.abs(n-me)<=Rr*Math.max(1,Math.abs(n),Math.abs(me))&&Math.abs(o-he)<=Rr*Math.max(1,Math.abs(o),Math.abs(he))&&Math.abs(c-be)<=Rr*Math.max(1,Math.abs(c),Math.abs(be))&&Math.abs(d-Ie)<=Rr*Math.max(1,Math.abs(d),Math.abs(Ie))&&Math.abs(m-Be)<=Rr*Math.max(1,Math.abs(m),Math.abs(Be))&&Math.abs(v-pt)<=Rr*Math.max(1,Math.abs(v),Math.abs(pt))&&Math.abs(T-ot)<=Rr*Math.max(1,Math.abs(T),Math.abs(ot))&&Math.abs(E-Xe)<=Rr*Math.max(1,Math.abs(E),Math.abs(Xe))&&Math.abs(P-lt)<=Rr*Math.max(1,Math.abs(P),Math.abs(lt))&&Math.abs(D-st)<=Rr*Math.max(1,Math.abs(D),Math.abs(st))&&Math.abs(U-mt)<=Rr*Math.max(1,Math.abs(U),Math.abs(mt))&&Math.abs(q-at)<=Rr*Math.max(1,Math.abs(q),Math.abs(at))&&Math.abs(G-He)<=Rr*Math.max(1,Math.abs(G),Math.abs(He))&&Math.abs(J-At)<=Rr*Math.max(1,Math.abs(J),Math.abs(At))&&Math.abs(ne-xt)<=Rr*Math.max(1,Math.abs(ne),Math.abs(xt))&&Math.abs(oe-Yt)<=Rr*Math.max(1,Math.abs(oe),Math.abs(Yt))},a.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:c}){return i.kind==="source"?o/vo:i.kind==="composite"?Hr.number(o/vo,c/vo,n):e},a.evaluateSizeForZoom=function(i,e){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:d,maxZoom:m}=i,v=c?Ze(Xr.interpolationFactor(c,e,d,m),0,1):0;i.kind==="camera"?o=Hr.number(i.minSize,i.maxSize,v):n=v}return{uSizeT:n,uSize:o}},a.evented=Tc,a.extend=Ve,a.filterObject=je,a.findLineIntersection=function(i,e,n,o){const c=e.y-i.y,d=e.x-i.x,m=o.y-n.y,v=o.x-n.x,T=m*d-v*c;if(T===0)return null;const E=(v*(i.y-n.y)-m*(i.x-n.x))/T;return new ee(i.x+E*d,i.y+E*c)},a.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},a.getAnchorAlignment=Fh,a.getAnchorJustification=Ou,a.getArrayBuffer=ss,a.getDefaultExportFromCjs=V,a.getJSON=function(i,e){return Vn(Ve(i,{type:"json"}),e)},a.getOverlapMode=Uh,a.getProtocolAction=hr,a.getRTLTextPluginStatus=Sc,a.getReferrer=Ar,a.getVideo=function(i,e){const n=window.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let o=0;o<i.length;o++){const c=window.document.createElement("source");pr(i[o])||(n.crossOrigin="Anonymous"),c.src=i[o],n.appendChild(c)}return{cancel:()=>{}}},a.groupByLayout=function(i,e){const n={};for(let c=0;c<i.length;c++){const d=e&&e[i[c].id]||ih(i[c]);e&&(e[i[c].id]=d);let m=n[d];m||(m=n[d]=[]),m.push(i[c])}const o=[];for(const c in n)o.push(n[c]);return o},a.identity=pu,a.interpolate=Hr,a.invert=function(i,e){var n=e[0],o=e[1],c=e[2],d=e[3],m=e[4],v=e[5],T=e[6],E=e[7],P=e[8],D=e[9],U=e[10],q=e[11],G=e[12],J=e[13],ne=e[14],oe=e[15],me=n*v-o*m,he=n*T-c*m,be=n*E-d*m,Ie=o*T-c*v,Be=o*E-d*v,pt=c*E-d*T,ot=P*J-D*G,Xe=P*ne-U*G,lt=P*oe-q*G,st=D*ne-U*J,mt=D*oe-q*J,at=U*oe-q*ne,He=me*at-he*mt+be*st+Ie*lt-Be*Xe+pt*ot;return He?(i[0]=(v*at-T*mt+E*st)*(He=1/He),i[1]=(c*mt-o*at-d*st)*He,i[2]=(J*pt-ne*Be+oe*Ie)*He,i[3]=(U*Be-D*pt-q*Ie)*He,i[4]=(T*lt-m*at-E*Xe)*He,i[5]=(n*at-c*lt+d*Xe)*He,i[6]=(ne*be-G*pt-oe*he)*He,i[7]=(P*pt-U*be+q*he)*He,i[8]=(m*mt-v*lt+E*ot)*He,i[9]=(o*lt-n*mt-d*ot)*He,i[10]=(G*Be-J*be+oe*me)*He,i[11]=(D*be-P*Be-q*me)*He,i[12]=(v*Xe-m*st-T*ot)*He,i[13]=(n*st-o*Xe+c*ot)*He,i[14]=(J*he-G*Ie-ne*me)*He,i[15]=(P*Ie-D*he+U*me)*He,i):null},a.isImageBitmap=jt,a.isSafari=Tt,a.isWorker=kt,a.keysDifference=function(i,e){const n=[];for(const o in i)o in e||n.push(o);return n},a.lazyLoadRTLTextPlugin=function(){yr.isLoading()||yr.isLoaded()||Sc()!=="deferred"||Ha()},a.makeRequest=Vn,a.mapObject=et,a.mercatorXfromLng=ad,a.mercatorYfromLat=Uc,a.mercatorZfromAltitude=ld,a.mul=uh,a.mul$1=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},a.multiply=du,a.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},a.operations=Kt,a.ortho=function(i,e,n,o,c,d,m){var v=1/(e-n),T=1/(o-c),E=1/(d-m);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*E,i[11]=0,i[12]=(e+n)*v,i[13]=(c+o)*T,i[14]=(m+d)*E,i[15]=1,i},a.parseCacheControl=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,c,d)=>{const m=c||d;return e[o]=!m||m.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},a.parseGlyphPbf=function(i){return new Ph(i).readFields(vf,[])},a.pbf=Ih,a.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Qi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],n=e.layout,o=e._unevaluatedLayout._values,c={layoutIconSize:o["icon-size"].possiblyEvaluate(new Gi(i.bucket.zoom+1),i.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Gi(i.bucket.zoom+1),i.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Gi(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:E,maxZoom:P}=i.bucket.textSizeData;c.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Gi(E),i.canonical),o["text-size"].possiblyEvaluate(new Gi(P),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:E,maxZoom:P}=i.bucket.iconSizeData;c.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Gi(E),i.canonical),o["icon-size"].possiblyEvaluate(new Gi(P),i.canonical)]}const d=n.get("text-line-height")*Mn,m=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",v=n.get("text-keep-upright"),T=n.get("text-size");for(const E of i.bucket.features){const P=n.get("text-font").evaluate(E,{},i.canonical).join(","),D=T.evaluate(E,{},i.canonical),U=c.layoutTextSize.evaluate(E,{},i.canonical),q=c.layoutIconSize.evaluate(E,{},i.canonical),G={horizontal:{},vertical:void 0},J=E.text;let ne,oe=[0,0];if(J){const be=J.toString(),Ie=n.get("text-letter-spacing").evaluate(E,{},i.canonical)*Mn,Be=rh(be)?Ie:0,pt=n.get("text-anchor").evaluate(E,{},i.canonical),ot=Yh(e,E,i.canonical);if(!ot){const at=n.get("text-radial-offset").evaluate(E,{},i.canonical);oe=at?Kh(pt,[at*Mn,$c]):n.get("text-offset").evaluate(E,{},i.canonical).map(He=>He*Mn)}let Xe=m?"center":n.get("text-justify").evaluate(E,{},i.canonical);const lt=n.get("symbol-placement"),st=lt==="point"?n.get("text-max-width").evaluate(E,{},i.canonical)*Mn:0,mt=()=>{i.bucket.allowVerticalPlacement&&Al(be)&&(G.vertical=Iu(J,i.glyphMap,i.glyphPositions,i.imagePositions,P,st,d,pt,"left",Be,oe,a.WritingMode.vertical,!0,lt,U,D))};if(!m&&ot){const at=new Set;if(Xe==="auto")for(let At=0;At<ot.values.length;At+=2)at.add(Ou(ot.values[At]));else at.add(Xe);let He=!1;for(const At of at)if(!G.horizontal[At])if(He)G.horizontal[At]=G.horizontal[0];else{const xt=Iu(J,i.glyphMap,i.glyphPositions,i.imagePositions,P,st,d,"center",At,Be,oe,a.WritingMode.horizontal,!1,lt,U,D);xt&&(G.horizontal[At]=xt,He=xt.positionedLines.length===1)}mt()}else{Xe==="auto"&&(Xe=Ou(pt));const at=Iu(J,i.glyphMap,i.glyphPositions,i.imagePositions,P,st,d,pt,Xe,Be,oe,a.WritingMode.horizontal,!1,lt,U,D);at&&(G.horizontal[Xe]=at),mt(),Al(be)&&m&&v&&(G.vertical=Iu(J,i.glyphMap,i.glyphPositions,i.imagePositions,P,st,d,pt,Xe,Be,oe,a.WritingMode.vertical,!1,lt,U,D))}}let me=!1;if(E.icon&&E.icon.name){const be=i.imageMap[E.icon.name];be&&(ne=Oh(i.imagePositions[E.icon.name],n.get("icon-offset").evaluate(E,{},i.canonical),n.get("icon-anchor").evaluate(E,{},i.canonical)),me=!!be.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=me:i.bucket.sdfIcons!==me&&Dt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(be.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const he=Ad(G.horizontal)||G.vertical;i.bucket.iconsInText=!!he&&he.iconsInText,(he||ne)&&Sd(i.bucket,E,G,ne,i.imageMap,c,U,q,oe,me,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},a.perspective=function(i,e,n,o,c){var d,m=1/Math.tan(e/2);return i[0]=m/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+o)*(d=1/(o-c)),i[14]=2*c*o*d):(i[10]=-1,i[14]=-2*o),i},a.pick=function(i,e){const n={};for(let o=0;o<e.length;o++){const c=e[o];c in i&&(n[c]=i[c])}return n},a.plugin=yr,a.pointGeometry=F,a.polygonIntersectsPolygon=sh,a.potpack=Hp,a.register=dt,a.registerForPluginStateChange=function(i){return i({pluginStatus:Un,pluginURL:_r}),Tc.on("pluginStateChange",i),i},a.renderColorRamp=fh,a.rotateX=function(i,e,n){var o=Math.sin(n),c=Math.cos(n),d=e[4],m=e[5],v=e[6],T=e[7],E=e[8],P=e[9],D=e[10],U=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=d*c+E*o,i[5]=m*c+P*o,i[6]=v*c+D*o,i[7]=T*c+U*o,i[8]=E*c-d*o,i[9]=P*c-m*o,i[10]=D*c-v*o,i[11]=U*c-T*o,i},a.rotateZ=function(i,e,n){var o=Math.sin(n),c=Math.cos(n),d=e[0],m=e[1],v=e[2],T=e[3],E=e[4],P=e[5],D=e[6],U=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*c+E*o,i[1]=m*c+P*o,i[2]=v*c+D*o,i[3]=T*c+U*o,i[4]=E*c-d*o,i[5]=P*c-m*o,i[6]=D*c-v*o,i[7]=U*c-T*o,i},a.sameOrigin=pr,a.scale=function(i,e,n){var o=n[0],c=n[1],d=n[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*d,i[9]=e[9]*d,i[10]=e[10]*d,i[11]=e[11]*d,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.setRTLTextPlugin=function(i,e,n=!1){if(Un===aa||Un===Cl||Un===la)throw new Error("setRTLTextPlugin cannot be called multiple times.");_r=sn.resolveURL(i),Un=aa,Ml=e,wc(),n||Ha()},a.sphericalToCartesian=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}},a.toEvaluationFeature=Js,a.transformMat4=oi,a.translate=function(i,e,n){var o,c,d,m,v,T,E,P,D,U,q,G,J=n[0],ne=n[1],oe=n[2];return e===i?(i[12]=e[0]*J+e[4]*ne+e[8]*oe+e[12],i[13]=e[1]*J+e[5]*ne+e[9]*oe+e[13],i[14]=e[2]*J+e[6]*ne+e[10]*oe+e[14],i[15]=e[3]*J+e[7]*ne+e[11]*oe+e[15]):(c=e[1],d=e[2],m=e[3],v=e[4],T=e[5],E=e[6],P=e[7],D=e[8],U=e[9],q=e[10],G=e[11],i[0]=o=e[0],i[1]=c,i[2]=d,i[3]=m,i[4]=v,i[5]=T,i[6]=E,i[7]=P,i[8]=D,i[9]=U,i[10]=q,i[11]=G,i[12]=o*J+v*ne+D*oe+e[12],i[13]=c*J+T*ne+U*oe+e[13],i[14]=d*J+E*ne+q*oe+e[14],i[15]=m*J+P*ne+G*oe+e[15]),i},a.triggerPluginCompletionEvent=Wa,a.unicodeBlockLookup=ht,a.uniqueId=function(){return Ke++},a.v8Spec=ke,a.validateCustomStyleLayer=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateLight=Ro,a.validateStyle=Mi,a.vectorTile=ba,a.warnOnce=Dt,a.wrap=Ct}),M(["./shared"],function(a){class V{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,N){for(const ie of B){this._layerConfigs[ie.id]=ie;const W=this._layers[ie.id]=a.createStyleLayer(ie);W._featureFilter=a.createFilter(W.filter),this.keyCache[ie.id]&&delete this.keyCache[ie.id]}for(const ie of N)delete this.keyCache[ie],delete this._layerConfigs[ie],delete this._layers[ie];this.familiesBySource={};const j=a.groupByLayout(Object.values(this._layerConfigs),this.keyCache);for(const ie of j){const W=ie.map(Ue=>this._layers[Ue.id]),se=W[0];if(se.visibility==="none")continue;const ue=se.source||"";let le=this.familiesBySource[ue];le||(le=this.familiesBySource[ue]={});const ge=se.sourceLayer||"_geojsonTileLayer";let Fe=le[ge];Fe||(Fe=le[ge]=[]),Fe.push(W)}}}class F{constructor(B){const N={},j=[];for(const ue in B){const le=B[ue],ge=N[ue]={};for(const Fe in le){const Ue=le[+Fe];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const Ne={x:0,y:0,w:Ue.bitmap.width+2,h:Ue.bitmap.height+2};j.push(Ne),ge[Fe]={rect:Ne,metrics:Ue.metrics}}}const{w:ie,h:W}=a.potpack(j),se=new a.AlphaImage({width:ie||1,height:W||1});for(const ue in B){const le=B[ue];for(const ge in le){const Fe=le[+ge];if(!Fe||Fe.bitmap.width===0||Fe.bitmap.height===0)continue;const Ue=N[ue][ge].rect;a.AlphaImage.copy(Fe.bitmap,se,{x:0,y:0},{x:Ue.x+1,y:Ue.y+1},Fe.bitmap)}}this.image=se,this.positions=N}}a.register("GlyphAtlas",F);class ce{constructor(B){this.tileID=new a.OverscaledTileID(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.uid=B.uid,this.zoom=B.zoom,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=B.showCollisionBoxes,this.collectResourceTiming=!!B.collectResourceTiming,this.returnDependencies=!!B.returnDependencies,this.promoteId=B.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(B,N,j,ie,W){this.status="parsing",this.data=B,this.collisionBoxArray=new a.CollisionBoxArray;const se=new a.DictionaryCoder(Object.keys(B.layers).sort()),ue=new a.FeatureIndex(this.tileID,this.promoteId);ue.bucketLayerIDs=[];const le={},ge={featureIndex:ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},Fe=N.familiesBySource[this.source];for(const si in Fe){const pi=B.layers[si];if(!pi)continue;pi.version===1&&a.warnOnce(`Vector tile source "${this.source}" layer "${si}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Mr=se.encode(si),Bt=[];for(let tn=0;tn<pi.length;tn++){const jn=pi.feature(tn),Xi=ue.getId(jn,si);Bt.push({feature:jn,id:Xi,index:tn,sourceLayerIndex:Mr})}for(const tn of Fe[si]){const jn=tn[0];jn.source!==this.source&&a.warnOnce(`layer.source = ${jn.source} does not equal this.source = ${this.source}`),jn.minzoom&&this.zoom<Math.floor(jn.minzoom)||jn.maxzoom&&this.zoom>=jn.maxzoom||jn.visibility!=="none"&&(ee(tn,this.zoom,j),(le[jn.id]=jn.createBucket({index:ue.bucketLayerIDs.length,layers:tn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Mr,sourceID:this.source})).populate(Bt,ge,this.tileID.canonical),ue.bucketLayerIDs.push(tn.map(Xi=>Xi.id)))}}let Ue,Ne,Mt,Zt;const yt=a.mapObject(ge.glyphDependencies,si=>Object.keys(si).map(Number));this.inFlightDependencies.forEach(si=>si==null?void 0:si.cancel()),this.inFlightDependencies=[];const Et=++this.dependencySentinel;Object.keys(yt).length?this.inFlightDependencies.push(ie.send("getGlyphs",{uid:this.uid,stacks:yt,source:this.source,tileID:this.tileID,type:"glyphs"},(si,pi)=>{Et===this.dependencySentinel&&(Ue||(Ue=si,Ne=pi,Ri.call(this)))})):Ne={};const qt=Object.keys(ge.iconDependencies);qt.length?this.inFlightDependencies.push(ie.send("getImages",{icons:qt,source:this.source,tileID:this.tileID,type:"icons"},(si,pi)=>{Et===this.dependencySentinel&&(Ue||(Ue=si,Mt=pi,Ri.call(this)))})):Mt={};const fi=Object.keys(ge.patternDependencies);function Ri(){if(Ue)return W(Ue);if(Ne&&Mt&&Zt){const si=new F(Ne),pi=new a.ImageAtlas(Mt,Zt);for(const Mr in le){const Bt=le[Mr];Bt instanceof a.SymbolBucket?(ee(Bt.layers,this.zoom,j),a.performSymbolLayout({bucket:Bt,glyphMap:Ne,glyphPositions:si.positions,imageMap:Mt,imagePositions:pi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Bt.hasPattern&&(Bt instanceof a.LineBucket||Bt instanceof a.FillBucket||Bt instanceof a.FillExtrusionBucket)&&(ee(Bt.layers,this.zoom,j),Bt.addFeatures(ge,this.tileID.canonical,pi.patternPositions))}this.status="done",W(null,{buckets:Object.values(le).filter(Mr=>!Mr.isEmpty()),featureIndex:ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:si.image,imageAtlas:pi,glyphMap:this.returnDependencies?Ne:null,iconMap:this.returnDependencies?Mt:null,glyphPositions:this.returnDependencies?si.positions:null})}}fi.length?this.inFlightDependencies.push(ie.send("getImages",{icons:fi,source:this.source,tileID:this.tileID,type:"patterns"},(si,pi)=>{Et===this.dependencySentinel&&(Ue||(Ue=si,Zt=pi,Ri.call(this)))})):Zt={},Ri.call(this)}}function ee(te,B,N){const j=new a.EvaluationParameters(B);for(const ie of te)ie.recalculate(j,N)}function ve(te,B){const N=a.getArrayBuffer(te.request,(j,ie,W,se)=>{j?B(j):ie&&B(null,{vectorTile:new a.vectorTile.VectorTile(new a.Protobuf(ie)),rawData:ie,cacheControl:W,expires:se})});return()=>{N.cancel(),B()}}class _e{constructor(B,N,j,ie){this.actor=B,this.layerIndex=N,this.availableImages=j,this.loadVectorData=ie||ve,this.fetching={},this.loading={},this.loaded={}}loadTile(B,N){const j=B.uid;this.loading||(this.loading={});const ie=!!(B&&B.request&&B.request.collectResourceTiming)&&new a.RequestPerformance(B.request),W=this.loading[j]=new ce(B);W.abort=this.loadVectorData(B,(se,ue)=>{if(delete this.loading[j],se||!ue)return W.status="done",this.loaded[j]=W,N(se);const le=ue.rawData,ge={};ue.expires&&(ge.expires=ue.expires),ue.cacheControl&&(ge.cacheControl=ue.cacheControl);const Fe={};if(ie){const Ue=ie.finish();Ue&&(Fe.resourceTiming=JSON.parse(JSON.stringify(Ue)))}W.vectorTile=ue.vectorTile,W.parse(ue.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ue,Ne)=>{if(delete this.fetching[j],Ue||!Ne)return N(Ue);N(null,a.extend({rawTileData:le.slice(0)},Ne,ge,Fe))}),this.loaded=this.loaded||{},this.loaded[j]=W,this.fetching[j]={rawTileData:le,cacheControl:ge,resourceTiming:Fe}})}reloadTile(B,N){const j=this.loaded,ie=B.uid;if(j&&j[ie]){const W=j[ie];W.showCollisionBoxes=B.showCollisionBoxes,W.status==="parsing"?W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor,(se,ue)=>{if(se||!ue)return N(se,ue);let le;if(this.fetching[ie]){const{rawTileData:ge,cacheControl:Fe,resourceTiming:Ue}=this.fetching[ie];delete this.fetching[ie],le=a.extend({rawTileData:ge.slice(0)},ue,Fe,Ue)}else le=ue;N(null,le)}):W.status==="done"&&(W.vectorTile?W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor,N):N())}}abortTile(B,N){const j=this.loading,ie=B.uid;j&&j[ie]&&j[ie].abort&&(j[ie].abort(),delete j[ie]),N()}removeTile(B,N){const j=this.loaded,ie=B.uid;j&&j[ie]&&delete j[ie],N()}}class Ae{constructor(){this.loaded={}}loadTile(B,N){const{uid:j,encoding:ie,rawImageData:W}=B,se=a.isImageBitmap(W)?this.getImageData(W):W,ue=new a.DEMData(j,se,ie);this.loaded=this.loaded||{},this.loaded[j]=ue,N(null,ue)}getImageData(B){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);const N=this.offscreenCanvasContext.getImageData(-1,-1,B.width+2,B.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:N.width,height:N.height},N.data)}removeTile(B){const N=this.loaded,j=B.uid;N&&N[j]&&delete N[j]}}function $e(te,B){if(te.length!==0){De(te[0],B);for(var N=1;N<te.length;N++)De(te[N],!B)}}function De(te,B){for(var N=0,j=0,ie=0,W=te.length,se=W-1;ie<W;se=ie++){var ue=(te[ie][0]-te[se][0])*(te[se][1]+te[ie][1]),le=N+ue;j+=Math.abs(N)>=Math.abs(ue)?N-le+ue:ue-le+N,N=le}N+j>=0!=!!B&&te.reverse()}var Ze=a.getDefaultExportFromCjs(function te(B,N){var j,ie=B&&B.type;if(ie==="FeatureCollection")for(j=0;j<B.features.length;j++)te(B.features[j],N);else if(ie==="GeometryCollection")for(j=0;j<B.geometries.length;j++)te(B.geometries[j],N);else if(ie==="Feature")te(B.geometry,N);else if(ie==="Polygon")$e(B.coordinates,N);else if(ie==="MultiPolygon")for(j=0;j<B.coordinates.length;j++)$e(B.coordinates[j],N);return B});const Ct=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;var Ve={exports:{}},Ke=a.pointGeometry,et=a.vectorTile.VectorTileFeature,je=ut;function ut(te,B){this.options=B||{},this.features=te,this.length=te.length}function wt(te,B){this.id=typeof te.id=="number"?te.id:void 0,this.type=te.type,this.rawGeometry=te.type===1?[te.geometry]:te.geometry,this.properties=te.tags,this.extent=B||4096}ut.prototype.feature=function(te){return new wt(this.features[te],this.options.extent)},wt.prototype.loadGeometry=function(){var te=this.rawGeometry;this.geometry=[];for(var B=0;B<te.length;B++){for(var N=te[B],j=[],ie=0;ie<N.length;ie++)j.push(new Ke(N[ie][0],N[ie][1]));this.geometry.push(j)}return this.geometry},wt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var te=this.geometry,B=1/0,N=-1/0,j=1/0,ie=-1/0,W=0;W<te.length;W++)for(var se=te[W],ue=0;ue<se.length;ue++){var le=se[ue];B=Math.min(B,le.x),N=Math.max(N,le.x),j=Math.min(j,le.y),ie=Math.max(ie,le.y)}return[B,j,N,ie]},wt.prototype.toGeoJSON=et.prototype.toGeoJSON;var Dt=a.pbf,Nt=je;function ai(te){var B=new Dt;return function(N,j){for(var ie in N.layers)j.writeMessage(3,kt,N.layers[ie])}(te,B),B.finish()}function kt(te,B){var N;B.writeVarintField(15,te.version||1),B.writeStringField(1,te.name||""),B.writeVarintField(5,te.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<te.length;N++)j.feature=te.feature(N),B.writeMessage(2,$t,j);var ie=j.keys;for(N=0;N<ie.length;N++)B.writeStringField(3,ie[N]);var W=j.values;for(N=0;N<W.length;N++)B.writeMessage(4,Li,W[N])}function $t(te,B){var N=te.feature;N.id!==void 0&&B.writeVarintField(1,N.id),B.writeMessage(2,Tt,te),B.writeVarintField(3,N.type),B.writeMessage(4,vi,N)}function Tt(te,B){var N=te.feature,j=te.keys,ie=te.values,W=te.keycache,se=te.valuecache;for(var ue in N.properties){var le=N.properties[ue],ge=W[ue];if(le!==null){ge===void 0&&(j.push(ue),W[ue]=ge=j.length-1),B.writeVarint(ge);var Fe=typeof le;Fe!=="string"&&Fe!=="boolean"&&Fe!=="number"&&(le=JSON.stringify(le));var Ue=Fe+":"+le,Ne=se[Ue];Ne===void 0&&(ie.push(le),se[Ue]=Ne=ie.length-1),B.writeVarint(Ne)}}}function jt(te,B){return(B<<3)+(7&te)}function yi(te){return te<<1^te>>31}function vi(te,B){for(var N=te.loadGeometry(),j=te.type,ie=0,W=0,se=N.length,ue=0;ue<se;ue++){var le=N[ue],ge=1;j===1&&(ge=le.length),B.writeVarint(jt(1,ge));for(var Fe=j===3?le.length-1:le.length,Ue=0;Ue<Fe;Ue++){Ue===1&&j!==1&&B.writeVarint(jt(2,Fe-1));var Ne=le[Ue].x-ie,Mt=le[Ue].y-W;B.writeVarint(yi(Ne)),B.writeVarint(yi(Mt)),ie+=Ne,W+=Mt}j===3&&B.writeVarint(jt(7,1))}}function Li(te,B){var N=typeof te;N==="string"?B.writeStringField(1,te):N==="boolean"?B.writeBooleanField(7,te):N==="number"&&(te%1!=0?B.writeDoubleField(3,te):te<0?B.writeSVarintField(6,te):B.writeVarintField(5,te))}Ve.exports=ai,Ve.exports.fromVectorTileJs=ai,Ve.exports.fromGeojsonVt=function(te,B){B=B||{};var N={};for(var j in te)N[j]=new Nt(te[j].features,B),N[j].name=j,N[j].version=B.version,N[j].extent=B.extent;return ai({layers:N})},Ve.exports.GeoJSONWrapper=Nt;var sn=a.getDefaultExportFromCjs(Ve.exports);const fn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:te=>te},ei=Math.fround||(Ar=new Float32Array(1),te=>(Ar[0]=+te,Ar[0]));var Ar;const hr=3,xi=5,Vn=6;class ss{constructor(B){this.options=Object.assign(Object.create(fn),B),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(B){const{log:N,minZoom:j,maxZoom:ie}=this.options;N&&console.time("total time");const W=`prepare ${B.length} points`;N&&console.time(W),this.points=B;const se=[];for(let le=0;le<B.length;le++){const ge=B[le];if(!ge.geometry)continue;const[Fe,Ue]=ge.geometry.coordinates,Ne=ei(tr(Fe)),Mt=ei(on(Ue));se.push(Ne,Mt,1/0,le,-1,1),this.options.reduce&&se.push(0)}let ue=this.trees[ie+1]=this._createTree(se);N&&console.timeEnd(W);for(let le=ie;le>=j;le--){const ge=+Date.now();ue=this.trees[le]=this._createTree(this._cluster(ue,le)),N&&console.log("z%d: %d clusters in %dms",le,ue.numItems,+Date.now()-ge)}return N&&console.timeEnd("total time"),this}getClusters(B,N){let j=((B[0]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,B[1]));let W=B[2]===180?180:((B[2]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)j=-180,W=180;else if(j>W){const Ue=this.getClusters([j,ie,180,se],N),Ne=this.getClusters([-180,ie,W,se],N);return Ue.concat(Ne)}const ue=this.trees[this._limitZoom(N)],le=ue.range(tr(j),on(se),tr(W),on(ie)),ge=ue.data,Fe=[];for(const Ue of le){const Ne=this.stride*Ue;Fe.push(ge[Ne+xi]>1?pr(ge,Ne,this.clusterProps):this.points[ge[Ne+hr]])}return Fe}getChildren(B){const N=this._getOriginId(B),j=this._getOriginZoom(B),ie="No cluster with the specified id.",W=this.trees[j];if(!W)throw new Error(ie);const se=W.data;if(N*this.stride>=se.length)throw new Error(ie);const ue=this.options.radius/(this.options.extent*Math.pow(2,j-1)),le=W.within(se[N*this.stride],se[N*this.stride+1],ue),ge=[];for(const Fe of le){const Ue=Fe*this.stride;se[Ue+4]===B&&ge.push(se[Ue+xi]>1?pr(se,Ue,this.clusterProps):this.points[se[Ue+hr]])}if(ge.length===0)throw new Error(ie);return ge}getLeaves(B,N,j){const ie=[];return this._appendLeaves(ie,B,N=N||10,j=j||0,0),ie}getTile(B,N,j){const ie=this.trees[this._limitZoom(B)],W=Math.pow(2,B),{extent:se,radius:ue}=this.options,le=ue/se,ge=(j-le)/W,Fe=(j+1+le)/W,Ue={features:[]};return this._addTileFeatures(ie.range((N-le)/W,ge,(N+1+le)/W,Fe),ie.data,N,j,W,Ue),N===0&&this._addTileFeatures(ie.range(1-le/W,ge,1,Fe),ie.data,W,j,W,Ue),N===W-1&&this._addTileFeatures(ie.range(0,ge,le/W,Fe),ie.data,-1,j,W,Ue),Ue.features.length?Ue:null}getClusterExpansionZoom(B){let N=this._getOriginZoom(B)-1;for(;N<=this.options.maxZoom;){const j=this.getChildren(B);if(N++,j.length!==1)break;B=j[0].properties.cluster_id}return N}_appendLeaves(B,N,j,ie,W){const se=this.getChildren(N);for(const ue of se){const le=ue.properties;if(le&&le.cluster?W+le.point_count<=ie?W+=le.point_count:W=this._appendLeaves(B,le.cluster_id,j,ie,W):W<ie?W++:B.push(ue),B.length===j)break}return W}_createTree(B){const N=new a.KDBush(B.length/this.stride|0,this.options.nodeSize,Float32Array);for(let j=0;j<B.length;j+=this.stride)N.add(B[j],B[j+1]);return N.finish(),N.data=B,N}_addTileFeatures(B,N,j,ie,W,se){for(const ue of B){const le=ue*this.stride,ge=N[le+xi]>1;let Fe,Ue,Ne;if(ge)Fe=Ir(N,le,this.clusterProps),Ue=N[le],Ne=N[le+1];else{const yt=this.points[N[le+hr]];Fe=yt.properties;const[Et,qt]=yt.geometry.coordinates;Ue=tr(Et),Ne=on(qt)}const Mt={type:1,geometry:[[Math.round(this.options.extent*(Ue*W-j)),Math.round(this.options.extent*(Ne*W-ie))]],tags:Fe};let Zt;Zt=ge||this.options.generateId?N[le+hr]:this.points[N[le+hr]].id,Zt!==void 0&&(Mt.id=Zt),se.features.push(Mt)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(Math.floor(+B),this.options.maxZoom+1))}_cluster(B,N){const{radius:j,extent:ie,reduce:W,minPoints:se}=this.options,ue=j/(ie*Math.pow(2,N)),le=B.data,ge=[],Fe=this.stride;for(let Ue=0;Ue<le.length;Ue+=Fe){if(le[Ue+2]<=N)continue;le[Ue+2]=N;const Ne=le[Ue],Mt=le[Ue+1],Zt=B.within(le[Ue],le[Ue+1],ue),yt=le[Ue+xi];let Et=yt;for(const qt of Zt){const fi=qt*Fe;le[fi+2]>N&&(Et+=le[fi+xi])}if(Et>yt&&Et>=se){let qt,fi=Ne*yt,Ri=Mt*yt,si=-1;const pi=((Ue/Fe|0)<<5)+(N+1)+this.points.length;for(const Mr of Zt){const Bt=Mr*Fe;if(le[Bt+2]<=N)continue;le[Bt+2]=N;const tn=le[Bt+xi];fi+=le[Bt]*tn,Ri+=le[Bt+1]*tn,le[Bt+4]=pi,W&&(qt||(qt=this._map(le,Ue,!0),si=this.clusterProps.length,this.clusterProps.push(qt)),W(qt,this._map(le,Bt)))}le[Ue+4]=pi,ge.push(fi/Et,Ri/Et,1/0,pi,-1,Et),W&&ge.push(si)}else{for(let qt=0;qt<Fe;qt++)ge.push(le[Ue+qt]);if(Et>1)for(const qt of Zt){const fi=qt*Fe;if(!(le[fi+2]<=N)){le[fi+2]=N;for(let Ri=0;Ri<Fe;Ri++)ge.push(le[fi+Ri])}}}}return ge}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,N,j){if(B[N+xi]>1){const se=this.clusterProps[B[N+Vn]];return j?Object.assign({},se):se}const ie=this.points[B[N+hr]].properties,W=this.options.map(ie);return j&&W===ie?Object.assign({},W):W}}function pr(te,B,N){return{type:"Feature",id:te[B+hr],properties:Ir(te,B,N),geometry:{type:"Point",coordinates:[(j=te[B],360*(j-.5)),On(te[B+1])]}};var j}function Ir(te,B,N){const j=te[B+xi],ie=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j,W=te[B+Vn],se=W===-1?{}:Object.assign({},N[W]);return Object.assign(se,{cluster:!0,cluster_id:te[B+hr],point_count:j,point_count_abbreviated:ie})}function tr(te){return te/360+.5}function on(te){const B=Math.sin(te*Math.PI/180),N=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return N<0?0:N>1?1:N}function On(te){const B=(180-360*te)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function dr(te,B,N,j){for(var ie,W=j,se=N-B>>1,ue=N-B,le=te[B],ge=te[B+1],Fe=te[N],Ue=te[N+1],Ne=B+3;Ne<N;Ne+=3){var Mt=ke(te[Ne],te[Ne+1],le,ge,Fe,Ue);if(Mt>W)ie=Ne,W=Mt;else if(Mt===W){var Zt=Math.abs(Ne-se);Zt<ue&&(ie=Ne,ue=Zt)}}W>j&&(ie-B>3&&dr(te,B,ie,j),te[ie+2]=W,N-ie>3&&dr(te,ie,N,j))}function ke(te,B,N,j,ie,W){var se=ie-N,ue=W-j;if(se!==0||ue!==0){var le=((te-N)*se+(B-j)*ue)/(se*se+ue*ue);le>1?(N=ie,j=W):le>0&&(N+=se*le,j+=ue*le)}return(se=te-N)*se+(ue=B-j)*ue}function en(te,B,N,j){var ie={id:te===void 0?null:te,type:B,geometry:N,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(W){var se=W.geometry,ue=W.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")Vr(W,se);else if(ue==="Polygon"||ue==="MultiLineString")for(var le=0;le<se.length;le++)Vr(W,se[le]);else if(ue==="MultiPolygon")for(le=0;le<se.length;le++)for(var ge=0;ge<se[le].length;ge++)Vr(W,se[le][ge])}(ie),ie}function Vr(te,B){for(var N=0;N<B.length;N+=3)te.minX=Math.min(te.minX,B[N]),te.minY=Math.min(te.minY,B[N+1]),te.maxX=Math.max(te.maxX,B[N]),te.maxY=Math.max(te.maxY,B[N+1])}function li(te,B,N,j){if(B.geometry){var ie=B.geometry.coordinates,W=B.geometry.type,se=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2),ue=[],le=B.id;if(N.promoteId?le=B.properties[N.promoteId]:N.generateId&&(le=j||0),W==="Point")Kt(ie,ue);else if(W==="MultiPoint")for(var ge=0;ge<ie.length;ge++)Kt(ie[ge],ue);else if(W==="LineString")os(ie,ue,se,!1);else if(W==="MultiLineString"){if(N.lineMetrics){for(ge=0;ge<ie.length;ge++)os(ie[ge],ue=[],se,!1),te.push(en(le,"LineString",ue,B.properties));return}fr(ie,ue,se,!1)}else if(W==="Polygon")fr(ie,ue,se,!0);else{if(W!=="MultiPolygon"){if(W==="GeometryCollection"){for(ge=0;ge<B.geometry.geometries.length;ge++)li(te,{id:le,geometry:B.geometry.geometries[ge],properties:B.properties},N,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ge=0;ge<ie.length;ge++){var Fe=[];fr(ie[ge],Fe,se,!0),ue.push(Fe)}}te.push(en(le,W,ue,B.properties))}}function Kt(te,B){B.push(as(te[0])),B.push(qn(te[1])),B.push(0)}function os(te,B,N,j){for(var ie,W,se=0,ue=0;ue<te.length;ue++){var le=as(te[ue][0]),ge=qn(te[ue][1]);B.push(le),B.push(ge),B.push(0),ue>0&&(se+=j?(ie*ge-le*W)/2:Math.sqrt(Math.pow(le-ie,2)+Math.pow(ge-W,2))),ie=le,W=ge}var Fe=B.length-3;B[2]=1,dr(B,0,Fe,N),B[Fe+2]=1,B.size=Math.abs(se),B.start=0,B.end=B.size}function fr(te,B,N,j){for(var ie=0;ie<te.length;ie++){var W=[];os(te[ie],W,N,j),B.push(W)}}function as(te){return te/360+.5}function qn(te){var B=Math.sin(te*Math.PI/180),N=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return N<0?0:N>1?1:N}function hi(te,B,N,j,ie,W,se,ue){if(j/=B,W>=(N/=B)&&se<j)return te;if(se<N||W>=j)return null;for(var le=[],ge=0;ge<te.length;ge++){var Fe=te[ge],Ue=Fe.geometry,Ne=Fe.type,Mt=ie===0?Fe.minX:Fe.minY,Zt=ie===0?Fe.maxX:Fe.maxY;if(Mt>=N&&Zt<j)le.push(Fe);else if(!(Zt<N||Mt>=j)){var yt=[];if(Ne==="Point"||Ne==="MultiPoint")qr(Ue,yt,N,j,ie);else if(Ne==="LineString")Ls(Ue,yt,N,j,ie,!1,ue.lineMetrics);else if(Ne==="MultiLineString")Dn(Ue,yt,N,j,ie,!1);else if(Ne==="Polygon")Dn(Ue,yt,N,j,ie,!0);else if(Ne==="MultiPolygon")for(var Et=0;Et<Ue.length;Et++){var qt=[];Dn(Ue[Et],qt,N,j,ie,!0),qt.length&&yt.push(qt)}if(yt.length){if(ue.lineMetrics&&Ne==="LineString"){for(Et=0;Et<yt.length;Et++)le.push(en(Fe.id,Ne,yt[Et],Fe.tags));continue}Ne!=="LineString"&&Ne!=="MultiLineString"||(yt.length===1?(Ne="LineString",yt=yt[0]):Ne="MultiLineString"),Ne!=="Point"&&Ne!=="MultiPoint"||(Ne=yt.length===3?"Point":"MultiPoint"),le.push(en(Fe.id,Ne,yt,Fe.tags))}}}return le.length?le:null}function qr(te,B,N,j,ie){for(var W=0;W<te.length;W+=3){var se=te[W+ie];se>=N&&se<=j&&(B.push(te[W]),B.push(te[W+1]),B.push(te[W+2]))}}function Ls(te,B,N,j,ie,W,se){for(var ue,le,ge=Je(te),Fe=ie===0?Hi:mr,Ue=te.start,Ne=0;Ne<te.length-3;Ne+=3){var Mt=te[Ne],Zt=te[Ne+1],yt=te[Ne+2],Et=te[Ne+3],qt=te[Ne+4],fi=ie===0?Mt:Zt,Ri=ie===0?Et:qt,si=!1;se&&(ue=Math.sqrt(Math.pow(Mt-Et,2)+Math.pow(Zt-qt,2))),fi<N?Ri>N&&(le=Fe(ge,Mt,Zt,Et,qt,N),se&&(ge.start=Ue+ue*le)):fi>j?Ri<j&&(le=Fe(ge,Mt,Zt,Et,qt,j),se&&(ge.start=Ue+ue*le)):mn(ge,Mt,Zt,yt),Ri<N&&fi>=N&&(le=Fe(ge,Mt,Zt,Et,qt,N),si=!0),Ri>j&&fi<=j&&(le=Fe(ge,Mt,Zt,Et,qt,j),si=!0),!W&&si&&(se&&(ge.end=Ue+ue*le),B.push(ge),ge=Je(te)),se&&(Ue+=ue)}var pi=te.length-3;Mt=te[pi],Zt=te[pi+1],yt=te[pi+2],(fi=ie===0?Mt:Zt)>=N&&fi<=j&&mn(ge,Mt,Zt,yt),pi=ge.length-3,W&&pi>=3&&(ge[pi]!==ge[0]||ge[pi+1]!==ge[1])&&mn(ge,ge[0],ge[1],ge[2]),ge.length&&B.push(ge)}function Je(te){var B=[];return B.size=te.size,B.start=te.start,B.end=te.end,B}function Dn(te,B,N,j,ie,W){for(var se=0;se<te.length;se++)Ls(te[se],B,N,j,ie,W,!1)}function mn(te,B,N,j){te.push(B),te.push(N),te.push(j)}function Hi(te,B,N,j,ie,W){var se=(W-B)/(j-B);return te.push(W),te.push(N+(ie-N)*se),te.push(1),se}function mr(te,B,N,j,ie,W){var se=(W-N)/(ie-N);return te.push(B+(j-B)*se),te.push(W),te.push(1),se}function nt(te,B){for(var N=[],j=0;j<te.length;j++){var ie,W=te[j],se=W.type;if(se==="Point"||se==="MultiPoint"||se==="LineString")ie=Lt(W.geometry,B);else if(se==="MultiLineString"||se==="Polygon"){ie=[];for(var ue=0;ue<W.geometry.length;ue++)ie.push(Lt(W.geometry[ue],B))}else if(se==="MultiPolygon")for(ie=[],ue=0;ue<W.geometry.length;ue++){for(var le=[],ge=0;ge<W.geometry[ue].length;ge++)le.push(Lt(W.geometry[ue][ge],B));ie.push(le)}N.push(en(W.id,se,ie,W.tags))}return N}function Lt(te,B){var N=[];N.size=te.size,te.start!==void 0&&(N.start=te.start,N.end=te.end);for(var j=0;j<te.length;j+=3)N.push(te[j]+B,te[j+1],te[j+2]);return N}function Vt(te,B){if(te.transformed)return te;var N,j,ie,W=1<<te.z,se=te.x,ue=te.y;for(N=0;N<te.features.length;N++){var le=te.features[N],ge=le.geometry,Fe=le.type;if(le.geometry=[],Fe===1)for(j=0;j<ge.length;j+=2)le.geometry.push(gn(ge[j],ge[j+1],B,W,se,ue));else for(j=0;j<ge.length;j++){var Ue=[];for(ie=0;ie<ge[j].length;ie+=2)Ue.push(gn(ge[j][ie],ge[j][ie+1],B,W,se,ue));le.geometry.push(Ue)}}return te.transformed=!0,te}function gn(te,B,N,j,ie,W){return[Math.round(N*(te*j-ie)),Math.round(N*(B*j-W))]}function _n(te,B,N,j,ie){for(var W=B===ie.maxZoom?0:ie.tolerance/((1<<B)*ie.extent),se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:N,y:j,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ue=0;ue<te.length;ue++){se.numFeatures++,St(se,te[ue],W,ie);var le=te[ue].minX,ge=te[ue].minY,Fe=te[ue].maxX,Ue=te[ue].maxY;le<se.minX&&(se.minX=le),ge<se.minY&&(se.minY=ge),Fe>se.maxX&&(se.maxX=Fe),Ue>se.maxY&&(se.maxY=Ue)}return se}function St(te,B,N,j){var ie=B.geometry,W=B.type,se=[];if(W==="Point"||W==="MultiPoint")for(var ue=0;ue<ie.length;ue+=3)se.push(ie[ue]),se.push(ie[ue+1]),te.numPoints++,te.numSimplified++;else if(W==="LineString")ir(se,ie,te,N,!1,!1);else if(W==="MultiLineString"||W==="Polygon")for(ue=0;ue<ie.length;ue++)ir(se,ie[ue],te,N,W==="Polygon",ue===0);else if(W==="MultiPolygon")for(var le=0;le<ie.length;le++){var ge=ie[le];for(ue=0;ue<ge.length;ue++)ir(se,ge[ue],te,N,!0,ue===0)}if(se.length){var Fe=B.tags||null;if(W==="LineString"&&j.lineMetrics){for(var Ue in Fe={},B.tags)Fe[Ue]=B.tags[Ue];Fe.mapbox_clip_start=ie.start/ie.size,Fe.mapbox_clip_end=ie.end/ie.size}var Ne={geometry:se,type:W==="Polygon"||W==="MultiPolygon"?3:W==="LineString"||W==="MultiLineString"?2:1,tags:Fe};B.id!==null&&(Ne.id=B.id),te.features.push(Ne)}}function ir(te,B,N,j,ie,W){var se=j*j;if(j>0&&B.size<(ie?se:j))N.numPoints+=B.length/3;else{for(var ue=[],le=0;le<B.length;le+=3)(j===0||B[le+2]>se)&&(N.numSimplified++,ue.push(B[le]),ue.push(B[le+1])),N.numPoints++;ie&&function(ge,Fe){for(var Ue=0,Ne=0,Mt=ge.length,Zt=Mt-2;Ne<Mt;Zt=Ne,Ne+=2)Ue+=(ge[Ne]-ge[Zt])*(ge[Ne+1]+ge[Zt+1]);if(Ue>0===Fe)for(Ne=0,Mt=ge.length;Ne<Mt/2;Ne+=2){var yt=ge[Ne],Et=ge[Ne+1];ge[Ne]=ge[Mt-2-Ne],ge[Ne+1]=ge[Mt-1-Ne],ge[Mt-2-Ne]=yt,ge[Mt-1-Ne]=Et}}(ue,W),te.push(ue)}}function En(te,B){var N=(B=this.options=function(ie,W){for(var se in W)ie[se]=W[se];return ie}(Object.create(this.options),B)).debug;if(N&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var j=function(ie,W){var se=[];if(ie.type==="FeatureCollection")for(var ue=0;ue<ie.features.length;ue++)li(se,ie.features[ue],W,ue);else li(se,ie.type==="Feature"?ie:{geometry:ie},W);return se}(te,B);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),j=function(ie,W){var se=W.buffer/W.extent,ue=ie,le=hi(ie,1,-1-se,se,0,-1,2,W),ge=hi(ie,1,1-se,2+se,0,-1,2,W);return(le||ge)&&(ue=hi(ie,1,-se,1+se,0,-1,2,W)||[],le&&(ue=nt(le,1).concat(ue)),ge&&(ue=ue.concat(nt(ge,-1)))),ue}(j,B),j.length&&this.splitTile(j,0,0,0),N&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Gn(te,B,N){return 32*((1<<te)*N+B)+te}function Zn(te,B){return B?te.properties[B]:te.id}function ys(te,B){if(te==null)return!0;if(te.type==="Feature")return Zn(te,B)!=null;if(te.type==="FeatureCollection"){const N=new Set;for(const j of te.features){const ie=Zn(j,B);if(ie==null||N.has(ie))return!1;N.add(ie)}return!0}return!1}function an(te,B){const N=new Map;if(te!=null)if(te.type==="Feature")N.set(Zn(te,B),te);else for(const j of te.features)N.set(Zn(j,B),j);return N}function Si(te,B){const N=te.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);const j=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!j)return B(null,null);const ie=new class{constructor(se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=se.length,this._features=se}feature(se){return new class{constructor(ue){this._feature=ue,this.extent=a.EXTENT,this.type=ue.type,this.properties=ue.tags,"id"in ue&&!isNaN(ue.id)&&(this.id=parseInt(ue.id,10))}loadGeometry(){if(this._feature.type===1){const ue=[];for(const le of this._feature.geometry)ue.push([new a.Point(le[0],le[1])]);return ue}{const ue=[];for(const le of this._feature.geometry){const ge=[];for(const Fe of le)ge.push(new a.Point(Fe[0],Fe[1]));ue.push(ge)}return ue}}toGeoJSON(ue,le,ge){return Ct.call(this,ue,le,ge)}}(this._features[se])}}(j.features);let W=sn(ie);W.byteOffset===0&&W.byteLength===W.buffer.byteLength||(W=new Uint8Array(W)),B(null,{vectorTile:ie,rawData:W.buffer})}En.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},En.prototype.splitTile=function(te,B,N,j,ie,W,se){for(var ue=[te,B,N,j],le=this.options,ge=le.debug;ue.length;){j=ue.pop(),N=ue.pop(),B=ue.pop(),te=ue.pop();var Fe=1<<B,Ue=Gn(B,N,j),Ne=this.tiles[Ue];if(!Ne&&(ge>1&&console.time("creation"),Ne=this.tiles[Ue]=_n(te,B,N,j,le),this.tileCoords.push({z:B,x:N,y:j}),ge)){ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,N,j,Ne.numFeatures,Ne.numPoints,Ne.numSimplified),console.timeEnd("creation"));var Mt="z"+B;this.stats[Mt]=(this.stats[Mt]||0)+1,this.total++}if(Ne.source=te,ie){if(B===le.maxZoom||B===ie)continue;var Zt=1<<ie-B;if(N!==Math.floor(W/Zt)||j!==Math.floor(se/Zt))continue}else if(B===le.indexMaxZoom||Ne.numPoints<=le.indexMaxPoints)continue;if(Ne.source=null,te.length!==0){ge>1&&console.time("clipping");var yt,Et,qt,fi,Ri,si,pi=.5*le.buffer/le.extent,Mr=.5-pi,Bt=.5+pi,tn=1+pi;yt=Et=qt=fi=null,Ri=hi(te,Fe,N-pi,N+Bt,0,Ne.minX,Ne.maxX,le),si=hi(te,Fe,N+Mr,N+tn,0,Ne.minX,Ne.maxX,le),te=null,Ri&&(yt=hi(Ri,Fe,j-pi,j+Bt,1,Ne.minY,Ne.maxY,le),Et=hi(Ri,Fe,j+Mr,j+tn,1,Ne.minY,Ne.maxY,le),Ri=null),si&&(qt=hi(si,Fe,j-pi,j+Bt,1,Ne.minY,Ne.maxY,le),fi=hi(si,Fe,j+Mr,j+tn,1,Ne.minY,Ne.maxY,le),si=null),ge>1&&console.timeEnd("clipping"),ue.push(yt||[],B+1,2*N,2*j),ue.push(Et||[],B+1,2*N,2*j+1),ue.push(qt||[],B+1,2*N+1,2*j),ue.push(fi||[],B+1,2*N+1,2*j+1)}}},En.prototype.getTile=function(te,B,N){var j=this.options,ie=j.extent,W=j.debug;if(te<0||te>24)return null;var se=1<<te,ue=Gn(te,B=(B%se+se)%se,N);if(this.tiles[ue])return Vt(this.tiles[ue],ie);W>1&&console.log("drilling down to z%d-%d-%d",te,B,N);for(var le,ge=te,Fe=B,Ue=N;!le&&ge>0;)ge--,Fe=Math.floor(Fe/2),Ue=Math.floor(Ue/2),le=this.tiles[Gn(ge,Fe,Ue)];return le&&le.source?(W>1&&console.log("found parent tile z%d-%d-%d",ge,Fe,Ue),W>1&&console.time("drilling down"),this.splitTile(le.source,ge,Fe,Ue,te,B,N),W>1&&console.timeEnd("drilling down"),this.tiles[ue]?Vt(this.tiles[ue],ie):null):null};class Gr extends _e{constructor(B,N,j,ie){super(B,N,j,Si),this._dataUpdateable=new Map,this.loadGeoJSON=(W,se)=>{const{promoteId:ue}=W;if(W.request)return a.getJSON(W.request,(le,ge,Fe,Ue)=>{this._dataUpdateable=ys(ge,ue)?an(ge,ue):void 0,se(le,ge,Fe,Ue)});if(typeof W.data=="string")try{const le=JSON.parse(W.data);this._dataUpdateable=ys(le,ue)?an(le,ue):void 0,se(null,le)}catch{se(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`))}else W.dataDiff?this._dataUpdateable?(function(le,ge,Fe){var Ue,Ne,Mt,Zt;if(ge.removeAll&&le.clear(),ge.remove)for(const yt of ge.remove)le.delete(yt);if(ge.add)for(const yt of ge.add){const Et=Zn(yt,Fe);Et!=null&&le.set(Et,yt)}if(ge.update)for(const yt of ge.update){let Et=le.get(yt.id);if(Et==null)continue;const qt=!yt.removeAllProperties&&(((Ue=yt.removeProperties)===null||Ue===void 0?void 0:Ue.length)>0||((Ne=yt.addOrUpdateProperties)===null||Ne===void 0?void 0:Ne.length)>0);if((yt.newGeometry||yt.removeAllProperties||qt)&&(Et={...Et},le.set(yt.id,Et),qt&&(Et.properties={...Et.properties})),yt.newGeometry&&(Et.geometry=yt.newGeometry),yt.removeAllProperties)Et.properties={};else if(((Mt=yt.removeProperties)===null||Mt===void 0?void 0:Mt.length)>0)for(const fi of yt.removeProperties)Object.prototype.hasOwnProperty.call(Et.properties,fi)&&delete Et.properties[fi];if(((Zt=yt.addOrUpdateProperties)===null||Zt===void 0?void 0:Zt.length)>0)for(const{key:fi,value:Ri}of yt.addOrUpdateProperties)Et.properties[fi]=Ri}}(this._dataUpdateable,W.dataDiff,ue),se(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):se(new Error(`Cannot update existing geojson data in ${W.source}`)):se(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},ie&&(this.loadGeoJSON=ie)}loadData(B,N){var j;(j=this._pendingRequest)===null||j===void 0||j.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const ie=!!(B&&B.request&&B.request.collectResourceTiming)&&new a.RequestPerformance(B.request);this._pendingCallback=N,this._pendingRequest=this.loadGeoJSON(B,(W,se)=>{if(delete this._pendingCallback,delete this._pendingRequest,W||!se)return N(W);if(typeof se!="object")return N(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{Ze(se,!0);try{if(B.filter){const le=a.createExpression(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(le.result==="error")throw new Error(le.value.map(Fe=>`${Fe.key}: ${Fe.message}`).join(", "));se={type:"FeatureCollection",features:se.features.filter(Fe=>le.value.evaluate({zoom:0},Fe))}}this._geoJSONIndex=B.cluster?new ss(function({superclusterOptions:le,clusterProperties:ge}){if(!ge||!le)return le;const Fe={},Ue={},Ne={accumulated:null,zoom:0},Mt={properties:null},Zt=Object.keys(ge);for(const yt of Zt){const[Et,qt]=ge[yt],fi=a.createExpression(qt),Ri=a.createExpression(typeof Et=="string"?[Et,["accumulated"],["get",yt]]:Et);Fe[yt]=fi.value,Ue[yt]=Ri.value}return le.map=yt=>{Mt.properties=yt;const Et={};for(const qt of Zt)Et[qt]=Fe[qt].evaluate(Ne,Mt);return Et},le.reduce=(yt,Et)=>{Mt.properties=Et;for(const qt of Zt)Ne.accumulated=yt[qt],yt[qt]=Ue[qt].evaluate(Ne,Mt)},le}(B)).load(se.features):function(le,ge){return new En(le,ge)}(se,B.geojsonVtOptions)}catch(le){return N(le)}this.loaded={};const ue={};if(ie){const le=ie.finish();le&&(ue.resourceTiming={},ue.resourceTiming[B.source]=JSON.parse(JSON.stringify(le)))}N(null,ue)}})}reloadTile(B,N){const j=this.loaded;return j&&j[B.uid]?super.reloadTile(B,N):this.loadTile(B,N)}removeSource(B,N){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),N()}getClusterExpansionZoom(B,N){try{N(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(j){N(j)}}getClusterChildren(B,N){try{N(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(j){N(j)}}getClusterLeaves(B,N){try{N(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(j){N(j)}}}class Cr{constructor(B){this.self=B,this.actor=new a.Actor(B,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:_e,geojson:Gr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(N,j)=>{if(this.workerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.workerSourceTypes[N]=j},this.self.registerRTLTextPlugin=N=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=N.applyArabicShaping,a.plugin.processBidirectionalText=N.processBidirectionalText,a.plugin.processStyledBidirectionalText=N.processStyledBidirectionalText}}setReferrer(B,N){this.referrer=N}setImages(B,N,j){this.availableImages[B]=N;for(const ie in this.workerSources[B]){const W=this.workerSources[B][ie];for(const se in W)W[se].availableImages=N}j()}setLayers(B,N,j){this.getLayerIndex(B).replace(N),j()}updateLayers(B,N,j){this.getLayerIndex(B).update(N.layers,N.removedIds),j()}loadTile(B,N,j){this.getWorkerSource(B,N.type,N.source).loadTile(N,j)}loadDEMTile(B,N,j){this.getDEMWorkerSource(B,N.source).loadTile(N,j)}reloadTile(B,N,j){this.getWorkerSource(B,N.type,N.source).reloadTile(N,j)}abortTile(B,N,j){this.getWorkerSource(B,N.type,N.source).abortTile(N,j)}removeTile(B,N,j){this.getWorkerSource(B,N.type,N.source).removeTile(N,j)}removeDEMTile(B,N){this.getDEMWorkerSource(B,N.source).removeTile(N)}removeSource(B,N,j){if(!this.workerSources[B]||!this.workerSources[B][N.type]||!this.workerSources[B][N.type][N.source])return;const ie=this.workerSources[B][N.type][N.source];delete this.workerSources[B][N.type][N.source],ie.removeSource!==void 0?ie.removeSource(N,j):j()}loadWorkerSource(B,N,j){try{this.self.importScripts(N.url),j()}catch(ie){j(ie.toString())}}syncRTLPluginState(B,N,j){try{a.plugin.setState(N);const ie=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&ie!=null){this.self.importScripts(ie);const W=a.plugin.isParsed();j(W?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ie}`),W)}}catch(ie){j(ie.toString())}}getAvailableImages(B){let N=this.availableImages[B];return N||(N=[]),N}getLayerIndex(B){let N=this.layerIndexes[B];return N||(N=this.layerIndexes[B]=new V),N}getWorkerSource(B,N,j){if(this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][N]||(this.workerSources[B][N]={}),!this.workerSources[B][N][j]){const ie={send:(W,se,ue)=>{this.actor.send(W,se,ue,B)}};this.workerSources[B][N][j]=new this.workerSourceTypes[N](ie,this.getLayerIndex(B),this.getAvailableImages(B))}return this.workerSources[B][N][j]}getDEMWorkerSource(B,N){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][N]||(this.demWorkerSources[B][N]=new Ae),this.demWorkerSources[B][N]}}return a.isWorker()&&(self.worker=new Cr(self)),Cr}),M(["./shared"],function(a){var V="3.3.0";class F{static testProp(t){if(!F.docStyle)return t[0];for(let r=0;r<t.length;r++)if(t[r]in F.docStyle)return t[r];return t[0]}static create(t,r,l){const h=window.document.createElement(t);return r!==void 0&&(h.className=r),l&&l.appendChild(h),h}static createNS(t,r){return window.document.createElementNS(t,r)}static disableDrag(){F.docStyle&&F.selectProp&&(F.userSelect=F.docStyle[F.selectProp],F.docStyle[F.selectProp]="none")}static enableDrag(){F.docStyle&&F.selectProp&&(F.docStyle[F.selectProp]=F.userSelect)}static setTransform(t,r){t.style[F.transformProp]=r}static addEventListener(t,r,l,h={}){t.addEventListener(r,l,"passive"in h?h:h.capture)}static removeEventListener(t,r,l,h={}){t.removeEventListener(r,l,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",F.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",F.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",F.suppressClickInternal,!0)},0)}static mousePos(t,r){const l=t.getBoundingClientRect();return new a.Point(r.clientX-l.left-t.clientLeft,r.clientY-l.top-t.clientTop)}static touchPos(t,r){const l=t.getBoundingClientRect(),h=[];for(let f=0;f<r.length;f++)h.push(new a.Point(r[f].clientX-l.left-t.clientLeft,r[f].clientY-l.top-t.clientTop));return h}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}F.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,F.selectProp=F.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),F.transformProp=F.testProp(["transform","WebkitTransform"]);const ce={supported:!1,testSupport:function(p){!_e&&ve&&(Ae?$e(p):ee=p)}};let ee,ve,_e=!1,Ae=!1;function $e(p){const t=p.createTexture();p.bindTexture(p.TEXTURE_2D,t);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,ve),p.isContextLost())return;ce.supported=!0}catch{}p.deleteTexture(t),_e=!0}var De,Ze;typeof document<"u"&&(ve=document.createElement("img"),ve.onload=function(){ee&&$e(ee),ee=null,Ae=!0},ve.onerror=function(){_e=!0,ee=null},ve.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let t,r,l,h;p.resetRequestQueue=()=>{t=[],r=0,l=0,h={}},p.addThrottleControl=A=>{const k=l++;return h[k]=A,k},p.removeThrottleControl=A=>{delete h[A],w()},p.getImage=(A,k,z=!0)=>{ce.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*");const $={requestParameters:A,supportImageRefresh:z,callback:k,cancelled:!1,completed:!1,cancel:()=>{$.completed||$.cancelled||($.cancelled=!0,$.innerRequest&&($.innerRequest.cancel(),r--),w())}};return t.push($),w(),$};const f=A=>{const{requestParameters:k,supportImageRefresh:z,callback:$}=A;return a.extend(k,{type:"image"}),(z!==!1||a.isWorker()||a.getProtocolAction(k.url)||k.headers&&!Object.keys(k.headers).reduce((Y,K)=>Y&&K==="accept",!0)?a.makeRequest:S)(k,(Y,K,Q,X)=>{x(A,$,Y,K,Q,X)})},x=(A,k,z,$,Y,K)=>{z?k(z):$ instanceof HTMLImageElement||a.isImageBitmap($)?k(null,$):$&&((Q,X)=>{typeof createImageBitmap=="function"?a.arrayBufferToImageBitmap(Q,X):a.arrayBufferToImage(Q,X)})($,(Q,X)=>{Q!=null?k(Q):X!=null&&k(null,X,{cacheControl:Y,expires:K})}),A.cancelled||(A.completed=!0,r--,w())},w=()=>{const A=(()=>{const k=Object.keys(h);let z=!1;if(k.length>0){for(const $ of k)if(z=h[$](),z)break}return z})()?a.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=r;k<A&&t.length>0;k++){const z=t.shift();if(z.cancelled){k--;continue}const $=f(z);r++,z.innerRequest=$}},S=(A,k)=>{const z=new Image,$=A.url;let Y=!1;const K=A.credentials;return K&&K==="include"?z.crossOrigin="use-credentials":(K&&K==="same-origin"||!a.sameOrigin($))&&(z.crossOrigin="anonymous"),z.fetchPriority="high",z.onload=()=>{k(null,z),z.onerror=z.onload=null},z.onerror=()=>{Y||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),z.onerror=z.onload=null},z.src=$,{cancel:()=>{Y=!0,z.src=""}}}}(De||(De={})),De.resetRequestQueue(),function(p){p.Glyphs="Glyphs",p.Image="Image",p.Source="Source",p.SpriteImage="SpriteImage",p.SpriteJSON="SpriteJSON",p.Style="Style",p.Tile="Tile",p.Unknown="Unknown"}(Ze||(Ze={}));class Ct{constructor(t){this._transformRequestFn=t}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeSpriteURL(t,r,l){const h=function(f){const x=f.match(Ve);if(!x)throw new Error(`Unable to parse URL "${f}"`);return{protocol:x[1],authority:x[2],path:x[3]||"/",params:x[4]?x[4].split("&"):[]}}(t);return h.path+=`${r}${l}`,function(f){const x=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${x}`}(h)}setTransformRequest(t){this._transformRequestFn=t}}const Ve=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ke(p){var t=new a.ARRAY_TYPE(3);return t[0]=p[0],t[1]=p[1],t[2]=p[2],t}var et,je=function(p,t,r){return p[0]=t[0]-r[0],p[1]=t[1]-r[1],p[2]=t[2]-r[2],p};et=new a.ARRAY_TYPE(3),a.ARRAY_TYPE!=Float32Array&&(et[0]=0,et[1]=0,et[2]=0);var ut=function(p){var t=p[0],r=p[1];return t*t+r*r};function wt(p){const t=[];if(typeof p=="string")t.push({id:"default",url:p});else if(p&&p.length>0){const r=[];for(const{id:l,url:h}of p){const f=`${l}${h}`;r.indexOf(f)===-1&&(r.push(f),t.push({id:l,url:h}))}}return t}function Dt(p,t,r,l,h){if(l)return void p(l);if(h!==Object.values(t).length||h!==Object.values(r).length)return;const f={};for(const x in t){f[x]={};const w=a.browser.getImageCanvasContext(r[x]),S=t[x];for(const A in S){const{width:k,height:z,x:$,y:Y,sdf:K,pixelRatio:Q,stretchX:X,stretchY:pe,content:xe}=S[A];f[x][A]={data:null,pixelRatio:Q,sdf:K,stretchX:X,stretchY:pe,content:xe,spriteData:{width:k,height:z,x:$,y:Y,context:w}}}}p(null,f)}(function(){var p=new a.ARRAY_TYPE(2);a.ARRAY_TYPE!=Float32Array&&(p[0]=0,p[1]=0)})();class Nt{constructor(t,r,l,h){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(r,h)}update(t,r,l){const{width:h,height:f}=t,x=!(this.size&&this.size[0]===h&&this.size[1]===f||l),{context:w}=this,{gl:S}=w;if(this.useMipmap=!!(r&&r.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!r||r.premultiply!==!1)),x)this.size=[h,f],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.isImageBitmap(t)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,t):S.texImage2D(S.TEXTURE_2D,0,this.format,h,f,0,this.format,S.UNSIGNED_BYTE,t.data);else{const{x:A,y:k}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.isImageBitmap(t)?S.texSubImage2D(S.TEXTURE_2D,0,A,k,S.RGBA,S.UNSIGNED_BYTE,t):S.texSubImage2D(S.TEXTURE_2D,0,A,k,h,f,S.RGBA,S.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)}bind(t,r,l){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),l!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=f.LINEAR),t!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,l||t),this.filter=t),r!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function ai(p){const{userImage:t}=p;return!!(t&&t.render&&t.render())&&(p.data.replace(new Uint8Array(t.data.buffer)),!0)}class kt extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:r,callback:l}of this.requestors)this._notify(r,l);this.requestors=[]}}getImage(t){const r=this.images[t];if(r&&!r.data&&r.spriteData){const l=r.spriteData;r.data=new a.RGBAImage({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),r.spriteData=null}return r}addImage(t,r){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,r)&&(this.images[t]=r)}_validate(t,r){let l=!0;const h=r.data||r.spriteData;return this._validateStretch(r.stretchX,h&&h.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(r.stretchY,h&&h.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(r.content,r)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,r){if(!t)return!0;let l=0;for(const h of t){if(h[0]<l||h[1]<h[0]||r<h[1])return!1;l=h[1]}return!0}_validateContent(t,r){if(!t)return!0;if(t.length!==4)return!1;const l=r.spriteData,h=l&&l.width||r.data.width,f=l&&l.height||r.data.height;return!(t[0]<0||h<t[0]||t[1]<0||f<t[1]||t[2]<0||h<t[2]||t[3]<0||f<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,r,l=!0){const h=this.getImage(t);if(l&&(h.data.width!==r.data.width||h.data.height!==r.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=h.version+1,this.images[t]=r,this.updatedImages[t]=!0}removeImage(t){const r=this.images[t];delete this.images[t],delete this.patterns[t],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,r){let l=!0;if(!this.isLoaded())for(const h of t)this.images[h]||(l=!1);this.isLoaded()||l?this._notify(t,r):this.requestors.push({ids:t,callback:r})}_notify(t,r){const l={};for(const h of t){let f=this.getImage(h);f||(this.fire(new a.Event("styleimagemissing",{id:h})),f=this.getImage(h)),f?l[h]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:a.warnOnce(`Image "${h}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,l)}getPixelSize(){const{width:t,height:r}=this.atlasImage;return{width:t,height:r}}getPattern(t){const r=this.patterns[t],l=this.getImage(t);if(!l)return null;if(r&&r.position.version===l.version)return r.position;if(r)r.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},f=new a.ImagePosition(h,l);this.patterns[t]={bin:h,position:f}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const r=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Nt(t,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const f in this.patterns)t.push(this.patterns[f].bin);const{w:r,h:l}=a.potpack(t),h=this.atlasImage;h.resize({width:r||1,height:l||1});for(const f in this.patterns){const{bin:x}=this.patterns[f],w=x.x+1,S=x.y+1,A=this.getImage(f).data,k=A.width,z=A.height;a.RGBAImage.copy(A,h,{x:0,y:0},{x:w,y:S},{width:k,height:z}),a.RGBAImage.copy(A,h,{x:0,y:z-1},{x:w,y:S-1},{width:k,height:1}),a.RGBAImage.copy(A,h,{x:0,y:0},{x:w,y:S+z},{width:k,height:1}),a.RGBAImage.copy(A,h,{x:k-1,y:0},{x:w-1,y:S},{width:1,height:z}),a.RGBAImage.copy(A,h,{x:0,y:0},{x:w+k,y:S},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const r of t){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const l=this.getImage(r);l||a.warnOnce(`Image with ID: "${r}" was not found`),ai(l)&&this.updateImage(r,l)}}}const $t=1e20;function Tt(p,t,r,l,h,f,x,w,S){for(let A=t;A<t+l;A++)jt(p,r*f+A,f,h,x,w,S);for(let A=r;A<r+h;A++)jt(p,A*f+t,1,l,x,w,S)}function jt(p,t,r,l,h,f,x){f[0]=0,x[0]=-$t,x[1]=$t,h[0]=p[t];for(let w=1,S=0,A=0;w<l;w++){h[w]=p[t+w*r];const k=w*w;do{const z=f[S];A=(h[w]-h[z]+k-z*z)/(w-z)/2}while(A<=x[S]&&--S>-1);S++,f[S]=w,x[S]=A,x[S+1]=$t}for(let w=0,S=0;w<l;w++){for(;x[S+1]<w;)S++;const A=f[S],k=w-A;p[t+w*r]=h[A]+k*k}}class yi{constructor(t,r){this.requestManager=t,this.localIdeographFontFamily=r,this.entries={}}setURL(t){this.url=t}getGlyphs(t,r){const l=[];for(const h in t)for(const f of t[h])l.push({stack:h,id:f});a.asyncAll(l,({stack:h,id:f},x)=>{let w=this.entries[h];w||(w=this.entries[h]={glyphs:{},requests:{},ranges:{}});let S=w.glyphs[f];if(S!==void 0)return void x(null,{stack:h,id:f,glyph:S});if(S=this._tinySDF(w,h,f),S)return w.glyphs[f]=S,void x(null,{stack:h,id:f,glyph:S});const A=Math.floor(f/256);if(256*A>65535)return void x(new Error("glyphs > 65535 not supported"));if(w.ranges[A])return void x(null,{stack:h,id:f,glyph:S});if(!this.url)return void x(new Error("glyphsUrl is not set"));let k=w.requests[A];k||(k=w.requests[A]=[],yi.loadGlyphRange(h,A,this.url,this.requestManager,(z,$)=>{if($){for(const Y in $)this._doesCharSupportLocalGlyph(+Y)||(w.glyphs[+Y]=$[+Y]);w.ranges[A]=!0}for(const Y of k)Y(z,$);delete w.requests[A]})),k.push((z,$)=>{z?x(z):$&&x(null,{stack:h,id:f,glyph:$[f]||null})})},(h,f)=>{if(h)r(h);else if(f){const x={};for(const{stack:w,id:S,glyph:A}of f)(x[w]||(x[w]={}))[S]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};r(null,x)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(a.unicodeBlockLookup["CJK Unified Ideographs"](t)||a.unicodeBlockLookup["Hangul Syllables"](t)||a.unicodeBlockLookup.Hiragana(t)||a.unicodeBlockLookup.Katakana(t))}_tinySDF(t,r,l){const h=this.localIdeographFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let f=t.tinySDF;if(!f){let w="400";/bold/i.test(r)?w="900":/medium/i.test(r)?w="500":/light/i.test(r)&&(w="200"),f=t.tinySDF=new yi.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:h,fontWeight:w})}const x=f.draw(String.fromCharCode(l));return{id:l,bitmap:new a.AlphaImage({width:x.width||30,height:x.height||30},x.data),metrics:{width:x.glyphWidth||24,height:x.glyphHeight||24,left:x.glyphLeft||0,top:x.glyphTop-27||-8,advance:x.glyphAdvance||24}}}}yi.loadGlyphRange=function(p,t,r,l,h){const f=256*t,x=f+255,w=l.transformRequest(r.replace("{fontstack}",p).replace("{range}",`${f}-${x}`),Ze.Glyphs);a.getArrayBuffer(w,(S,A)=>{if(S)h(S);else if(A){const k={};for(const z of a.parseGlyphPbf(A))k[z.id]=z;h(null,k)}})},yi.TinySDF=class{constructor({fontSize:p=24,buffer:t=3,radius:r=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:f="normal",fontStyle:x="normal"}={}){this.buffer=t,this.cutoff=l,this.radius=r;const w=this.size=p+4*t,S=this._createCanvas(w),A=this.ctx=S.getContext("2d",{willReadFrequently:!0});A.font=`${x} ${f} ${p}px ${h}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(p){const t=document.createElement("canvas");return t.width=t.height=p,t}draw(p){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:f}=this.ctx.measureText(p),x=Math.ceil(r),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-h))),S=Math.min(this.size-this.buffer,x+Math.ceil(l)),A=w+2*this.buffer,k=S+2*this.buffer,z=Math.max(A*k,0),$=new Uint8ClampedArray(z),Y={data:$,width:A,height:k,glyphWidth:w,glyphHeight:S,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(w===0||S===0)return Y;const{ctx:K,buffer:Q,gridInner:X,gridOuter:pe}=this;K.clearRect(Q,Q,w,S),K.fillText(p,Q,Q+x);const xe=K.getImageData(Q,Q,w,S);pe.fill($t,0,z),X.fill(0,0,z);for(let re=0;re<S;re++)for(let fe=0;fe<w;fe++){const Ce=xe.data[4*(re*w+fe)+3]/255;if(Ce===0)continue;const Me=(re+Q)*A+fe+Q;if(Ce===1)pe[Me]=0,X[Me]=$t;else{const Re=.5-Ce;pe[Me]=Re>0?Re*Re:0,X[Me]=Re<0?Re*Re:0}}Tt(pe,0,0,A,k,A,this.f,this.v,this.z),Tt(X,Q,Q,w,S,A,this.f,this.v,this.z);for(let re=0;re<z;re++){const fe=Math.sqrt(pe[re])-Math.sqrt(X[re]);$[re]=Math.round(255-255*(fe/this.radius+this.cutoff))}return Y}};class vi{constructor(){this.specification=a.v8Spec.light.position}possiblyEvaluate(t,r){return a.sphericalToCartesian(t.expression.evaluate(r))}interpolate(t,r,l){return{x:a.interpolate.number(t.x,r.x,l),y:a.interpolate.number(t.y,r.y,l),z:a.interpolate.number(t.z,r.z,l)}}}let Li,sn;class fn extends a.Evented{constructor(t){super(),Li=Li||new a.Properties({anchor:new a.DataConstantProperty(a.v8Spec.light.anchor),position:new vi,color:new a.DataConstantProperty(a.v8Spec.light.color),intensity:new a.DataConstantProperty(a.v8Spec.light.intensity)}),this._transitionable=new a.Transitionable(Li),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r={}){if(!this._validate(a.validateLight,t,r))for(const l in t){const h=t[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,l){return(!l||l.validate!==!1)&&a.emitValidationErrors(this,t.call(a.validateStyle,a.extend({value:r,style:{glyphs:!0,sprite:!0},styleSpec:a.v8Spec})))}}class ei{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,r){const l=t.join(",")+String(r);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,r)),this.dashEntry[l]}getDashRanges(t,r,l){const h=[];let f=t.length%2==1?-t[t.length-1]*l:0,x=t[0]*l,w=!0;h.push({left:f,right:x,isDash:w,zeroLength:t[0]===0});let S=t[0];for(let A=1;A<t.length;A++){w=!w;const k=t[A];f=S*l,S+=k,x=S*l,h.push({left:f,right:x,isDash:w,zeroLength:k===0})}return h}addRoundDash(t,r,l){const h=r/2;for(let f=-l;f<=l;f++){const x=this.width*(this.nextRow+l+f);let w=0,S=t[w];for(let A=0;A<this.width;A++){A/S.right>1&&(S=t[++w]);const k=Math.abs(A-S.left),z=Math.abs(A-S.right),$=Math.min(k,z);let Y;const K=f/l*(h+1);if(S.isDash){const Q=h-Math.abs(K);Y=Math.sqrt($*$+Q*Q)}else Y=h-Math.sqrt($*$+K*K);this.data[x+A]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(t){for(let w=t.length-1;w>=0;--w){const S=t[w],A=t[w+1];S.zeroLength?t.splice(w,1):A&&A.isDash===S.isDash&&(A.left=S.left,t.splice(w,1))}const r=t[0],l=t[t.length-1];r.isDash===l.isDash&&(r.left=l.left-this.width,l.right=r.right+this.width);const h=this.width*this.nextRow;let f=0,x=t[f];for(let w=0;w<this.width;w++){w/x.right>1&&(x=t[++f]);const S=Math.abs(w-x.left),A=Math.abs(w-x.right),k=Math.min(S,A);this.data[h+w]=Math.max(0,Math.min(255,(x.isDash?k:-k)+128))}}addDash(t,r){const l=r?7:0,h=2*l+1;if(this.nextRow+h>this.height)return a.warnOnce("LineAtlas out of space"),null;let f=0;for(let w=0;w<t.length;w++)f+=t[w];if(f!==0){const w=this.width/f,S=this.getDashRanges(t,this.width,w);r?this.addRoundDash(S,w,l):this.addRegularDash(S)}const x={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:f};return this.nextRow+=h,this.dirty=!0,x}bind(t){const r=t.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}class Ar{constructor(t,r,l){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=l;const h=this.workerPool.acquire(l);for(let f=0;f<h.length;f++){const x=new Ar.Actor(h[f],r,l);x.name=`Worker ${f}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,r,l){a.asyncAll(this.actors,(h,f)=>{h.send(t,r,f)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function hr(p,t,r){const l=function(h,f){if(h)return r(h);if(f){const x=a.pick(a.extend(f,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);f.vector_layers&&(x.vectorLayers=f.vector_layers,x.vectorLayerIds=x.vectorLayers.map(w=>w.id)),r(null,x)}};return p.url?a.getJSON(t.transformRequest(p.url,Ze.Source),l):a.browser.frame(()=>l(null,p))}Ar.Actor=a.Actor;class xi{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof a.LngLat?new a.LngLat(t.lng,t.lat):a.LngLat.convert(t),this}setSouthWest(t){return this._sw=t instanceof a.LngLat?new a.LngLat(t.lng,t.lat):a.LngLat.convert(t),this}extend(t){const r=this._sw,l=this._ne;let h,f;if(t instanceof a.LngLat)h=t,f=t;else{if(!(t instanceof xi))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(xi.convert(t)):this.extend(a.LngLat.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(a.LngLat.convert(t)):this;if(h=t._sw,f=t._ne,!h||!f)return this}return r||l?(r.lng=Math.min(h.lng,r.lng),r.lat=Math.min(h.lat,r.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new a.LngLat(h.lng,h.lat),this._ne=new a.LngLat(f.lng,f.lat)),this}getCenter(){return new a.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new a.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:l}=a.LngLat.convert(t);let h=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(t){return t instanceof xi?t:t&&new xi(t)}static fromLngLat(t,r=0){const l=360*r/40075017,h=l/Math.cos(Math.PI/180*t.lat);return new xi(new a.LngLat(t.lng-h,t.lat-l),new a.LngLat(t.lng+h,t.lat+l))}}class Vn{constructor(t,r,l){this.bounds=xi.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),l=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*r),h=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*r),f=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*r),x=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*r);return t.x>=l&&t.x<f&&t.y>=h&&t.y<x}}class ss extends a.Evented{constructor(t,r,l,h){if(super(),this.load=()=>{this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=hr(this._options,this.map._requestManager,(f,x)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),f?this.fire(new a.ErrorEvent(f)):x&&(a.extend(this,x),x.bounds&&(this.tileBounds=new Vn(x.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>a.extend({},this._options),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(r,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,r){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h={request:this.map._requestManager.transformRequest(l,Ze.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function f(x,w){return delete t.request,t.aborted?r(null):x&&x.status!==404?r(x):(w&&w.resourceTiming&&(t.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&t.setExpiryData(w),t.loadVectorData(w,this.map.painter),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}h.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",h,f.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",h,f.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class pr extends a.Evented{constructor(t,r,l,h){super(),this.id=t,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},r),a.extend(this,a.pick(r,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=hr(this._options,this.map._requestManager,(t,r)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new a.ErrorEvent(t)):r&&(a.extend(this,r),r.bounds&&(this.tileBounds=new Vn(r.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=De.getImage(this.map._requestManager.transformRequest(l,Ze.Tile),(h,f,x)=>{if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(h)t.state="errored",r(h);else if(f){this.map._refreshExpiredTiles&&x&&t.setExpiryData(x);const w=this.map.painter.context,S=w.gl;t.texture=this.map.painter.getTileTexture(f.width),t.texture?t.texture.update(f,{useMipmap:!0}):(t.texture=new Nt(w,f,S.RGBA,{useMipmap:!0}),t.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),w.extTextureFilterAnisotropic&&S.texParameterf(S.TEXTURE_2D,w.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,w.extTextureFilterAnisotropicMax)),t.state="loaded",r(null)}},this.map._refreshExpiredTiles)}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r()}unloadTile(t,r){t.texture&&this.map.painter.saveTileTexture(t.texture),r()}hasTransition(){return!1}}class Ir extends pr{constructor(t,r,l,h){super(t,r,l,h),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(t,r){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function h(f,x){f&&(t.state="errored",r(f)),x&&(t.dem=x,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",r(null))}t.request=De.getImage(this.map._requestManager.transformRequest(l,Ze.Tile),(function(f,x){if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(f)t.state="errored",r(f);else if(x){this.map._refreshExpiredTiles&&t.setExpiryData(x),delete x.cacheControl,delete x.expires;const w=a.isImageBitmap(x)&&(sn==null&&(sn=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),sn)?x:a.browser.getImageData(x,1),S={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:w,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",S,h.bind(this)))}}).bind(this),this.map._refreshExpiredTiles),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const r=t.canonical,l=Math.pow(2,r.z),h=(r.x-1+l)%l,f=r.x===0?t.wrap-1:t.wrap,x=(r.x+1+l)%l,w=r.x+1===l?t.wrap+1:t.wrap,S={};return S[new a.OverscaledTileID(t.overscaledZ,f,r.z,h,r.y).key]={backfilled:!1},S[new a.OverscaledTileID(t.overscaledZ,w,r.z,x,r.y).key]={backfilled:!1},r.y>0&&(S[new a.OverscaledTileID(t.overscaledZ,f,r.z,h,r.y-1).key]={backfilled:!1},S[new a.OverscaledTileID(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},S[new a.OverscaledTileID(t.overscaledZ,w,r.z,x,r.y-1).key]={backfilled:!1}),r.y+1<l&&(S[new a.OverscaledTileID(t.overscaledZ,f,r.z,h,r.y+1).key]={backfilled:!1},S[new a.OverscaledTileID(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},S[new a.OverscaledTileID(t.overscaledZ,w,r.z,x,r.y+1).key]={backfilled:!1}),S}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class tr extends a.Evented{constructor(t,r,l,h){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>a.extend({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(h),this._data=r.data,this._options=a.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const f=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*f,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*f,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:a.EXTENT,radius:(r.clusterRadius||50)*f,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},r),this}getClusterChildren(t,r){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},r),this}getClusterLeaves(t,r,l,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:r,offset:l},h),this}_updateWorkerData(t){const r=a.extend({},this.workerOptions);t?r.dataDiff=t:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(a.browser.resolveURL(this._data),Ze.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,r,(l,h)=>{if(this._pendingLoads--,this._removed||h&&h.abandoned)return void this.fire(new a.Event("dataabort",{dataType:"source"}));let f=null;if(h&&h.resourceTiming&&h.resourceTiming[this.id]&&(f=h.resourceTiming[this.id].slice(0)),l)return void this.fire(new a.ErrorEvent(l));const x={dataType:"source"};this._collectResourceTiming&&f&&f.length>0&&a.extend(x,{resourceTiming:f}),this.fire(new a.Event("data",{...x,sourceDataType:"metadata"})),this.fire(new a.Event("data",{...x,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(t,r){const l=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const h={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(l,h,(f,x)=>(delete t.request,t.unloadVectorData(),t.aborted?r(null):f?r(f):(t.loadVectorData(x,this.map.painter,l==="reloadTile"),r(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var on=a.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class On extends a.Evented{constructor(t,r,l,h){super(),this.load=(f,x)=>{this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=De.getImage(this.map._requestManager.transformRequest(this.url,Ze.Image),(w,S)=>{this._request=null,this._loaded=!0,w?this.fire(new a.ErrorEvent(w)):S&&(this.image=S,f&&(this.coordinates=f),x&&x(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const f=this.map.painter.context,x=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,on.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Nt(f,this.image,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(const S in this.tiles){const A=this.tiles[S];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,w=!0)}w&&this.fire(new a.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=r}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const r=t.map(a.MercatorCoordinate.fromLngLat);this.tileID=function(h){let f=1/0,x=1/0,w=-1/0,S=-1/0;for(const $ of h)f=Math.min(f,$.x),x=Math.min(x,$.y),w=Math.max(w,$.x),S=Math.max(S,$.y);const A=Math.max(w-f,S-x),k=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),z=Math.pow(2,k);return new a.CanonicalTileID(k,Math.floor((f+w)/2*z),Math.floor((x+S)/2*z))}(r),this.minzoom=this.maxzoom=this.tileID.z;const l=r.map(h=>this.tileID.getTilePoint(h)._round());return this._boundsArray=new a.RasterBoundsArray,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,a.EXTENT,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,a.EXTENT),this._boundsArray.emplaceBack(l[2].x,l[2].y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,r){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},r(null)):(t.state="errored",r(null))}hasTransition(){return!1}}class dr extends On{constructor(t,r,l,h){super(t,r,l,h),this.load=()=>{this._loaded=!1;const f=this.options;this.urls=[];for(const x of f.urls)this.urls.push(this.map._requestManager.transformRequest(x,Ze.Source).url);a.getVideo(this.urls,(x,w)=>{this._loaded=!0,x?this.fire(new a.ErrorEvent(x)):w&&(this.video=w,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,x=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,on.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.texSubImage2D(x.TEXTURE_2D,0,0,0,x.RGBA,x.UNSIGNED_BYTE,this.video)):(this.texture=new Nt(f,this.video,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(const S in this.tiles){const A=this.tiles[S];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,w=!0)}w&&this.fire(new a.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=r}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class ke extends On{constructor(t,r,l,h){super(t,r,l,h),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const x=this.map.painter.context,w=x.gl;this.boundsBuffer||(this.boundsBuffer=x.createVertexBuffer(this._boundsArray,on.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Nt(x,this.canvas,w.RGBA,{premultiply:!0});let S=!1;for(const A in this.tiles){const k=this.tiles[A];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,S=!0)}S&&this.fire(new a.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(x=>typeof x!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const en={},Vr=p=>{switch(p){case"geojson":return tr;case"image":return On;case"raster":return pr;case"raster-dem":return Ir;case"vector":return ss;case"video":return dr;case"canvas":return ke}return en[p]};function li(p,t){const r=a.create();return a.translate(r,r,[1,1,0]),a.scale(r,r,[.5*p.width,.5*p.height,1]),a.multiply(r,r,p.calculatePosMatrix(t.toUnwrapped()))}function Kt(p,t,r,l,h,f){const x=function(z,$,Y){if(z)for(const K of z){const Q=$[K];if(Q&&Q.source===Y&&Q.type==="fill-extrusion")return!0}else for(const K in $){const Q=$[K];if(Q.source===Y&&Q.type==="fill-extrusion")return!0}return!1}(h&&h.layers,t,p.id),w=f.maxPitchScaleFactor(),S=p.tilesIn(l,w,x);S.sort(os);const A=[];for(const z of S)A.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(t,r,p._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,h,f,w,li(p.transform,z.tileID))});const k=function(z){const $={},Y={};for(const K of z){const Q=K.queryResults,X=K.wrappedTileID,pe=Y[X]=Y[X]||{};for(const xe in Q){const re=Q[xe],fe=pe[xe]=pe[xe]||{},Ce=$[xe]=$[xe]||[];for(const Me of re)fe[Me.featureIndex]||(fe[Me.featureIndex]=!0,Ce.push(Me))}}return $}(A);for(const z in k)k[z].forEach($=>{const Y=$.feature,K=p.getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=K});return k}function os(p,t){const r=p.tileID,l=t.tileID;return r.overscaledZ-l.overscaledZ||r.canonical.y-l.canonical.y||r.wrap-l.wrap||r.canonical.x-l.canonical.x}class fr{constructor(t,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=a.uniqueId(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const r=t+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,r,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,f){const x={};if(!f)return x;for(const w of h){const S=w.layerIds.map(A=>f.getLayer(A)).filter(Boolean);if(S.length!==0){w.layers=S,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(A=>S.filter(k=>k.id===A)[0]));for(const A of S)x[A.id]=w}}return x}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const f=this.buckets[h];if(f instanceof a.SymbolBucket){if(this.hasSymbolBuckets=!0,!l)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const f=this.buckets[h];if(f instanceof a.SymbolBucket&&f.hasRTLText){this.hasRTLText=!0,a.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const h in this.buckets){const f=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(h).queryRadius(f))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new a.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Nt(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Nt(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,r,l,h,f,x,w,S,A,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:f,scale:x,tileSize:this.tileSize,pixelPosMatrix:k,transform:S,params:w,queryPadding:this.queryPadding*A},t,r,l):{}}querySourceFeatures(t,r){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),f=r&&r.sourceLayer?r.sourceLayer:"",x=h._geojsonTileLayer||h[f];if(!x)return;const w=a.createFilter(r&&r.filter),{z:S,x:A,y:k}=this.tileID.canonical,z={z:S,x:A,y:k};for(let $=0;$<x.length;$++){const Y=x.feature($);if(w.needGeometry){const X=a.toEvaluationFeature(Y,!0);if(!w.filter(new a.EvaluationParameters(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!w.filter(new a.EvaluationParameters(this.tileID.overscaledZ),Y))continue;const K=l.getId(Y,f),Q=new a.GeoJSONFeature(Y,S,A,k,K);Q.tile=z,t.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const l=a.parseCacheControl(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(r)if(this.expirationTime<r)h=!0;else{const f=this.expirationTime-r;f?this.expirationTime=l+Math.max(f,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!r.style.hasLayer(h))continue;const f=this.buckets[h],x=f.layers[0].sourceLayer||"_geojsonTileLayer",w=l[x],S=t[x];if(!w||!S||Object.keys(S).length===0)continue;f.update(S,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=r&&r.style&&r.style.getLayer(h);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.browser.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=a.browser.now()+t}setDependencies(t,r){const l={};for(const h of r)l[h]=!0;this.dependencies[t]=l}hasDependency(t,r){for(const l of t){const h=this.dependencies[l];if(h){for(const f of r)if(h[f])return!0}}return!1}}class as{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,l){const h=t.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const f={value:r,timeout:void 0};if(l!==void 0&&(f.timeout=setTimeout(()=>{this.remove(t,f)},l)),this.data[h].push(f),this.order.push(h),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const l=t.wrapped().key,h=r===void 0?0:this.data[l].indexOf(r),f=this.data[l][h];return this.data[l].splice(h,1),f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(f.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const l in this.data)for(const h of this.data[l])t(h.value)||r.push(h);for(const l of r)this.remove(l.value.tileID,l)}}class qn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,l){const h=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},a.extend(this.stateChanges[t][h],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const f in this.state[t])f!==h&&(this.deletedStates[t][f]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const f in this.state[t][h])l[f]||(this.deletedStates[t][h][f]=null)}else for(const f in l)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][f]===null&&delete this.deletedStates[t][h][f]}removeFeatureState(t,r,l){if(this.deletedStates[t]===null)return;const h=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&r!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][l]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(l in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][l]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,r){const l=String(r),h=a.extend({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const f=this.deletedStates[t][r];if(f===null)return{};for(const x in f)delete h[x]}return h}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const f={};for(const x in this.stateChanges[h])this.state[h][x]||(this.state[h][x]={}),a.extend(this.state[h][x],this.stateChanges[h][x]),f[x]=this.state[h][x];l[h]=f}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const f={};if(this.deletedStates[h]===null)for(const x in this.state[h])f[x]={},this.state[h][x]={};else for(const x in this.deletedStates[h]){if(this.deletedStates[h][x]===null)this.state[h][x]={};else for(const w of Object.keys(this.deletedStates[h][x]))delete this.state[h][x][w];f[x]=this.state[h][x]}l[h]=l[h]||{},a.extend(l[h],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in t)t[h].setFeatureState(l,r)}}class hi extends a.Evented{constructor(t,r,l){super(),this.id=t,this.dispatcher=l,this.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((h,f,x,w)=>{const S=new(Vr(f.type))(h,f,x,w);if(S.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${S.id}`);return S})(t,r,l,this),this._tiles={},this._cache=new as(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new qn,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const r=this._tiles[t];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,r){return this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new a.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const l=this._tiles[r];l.upload(t),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(qr).map(t=>t.key)}getRenderableIds(t){const r=[];for(const l in this._tiles)this._isIdRenderable(l,t)&&r.push(this._tiles[l]);return t?r.sort((l,h)=>{const f=l.tileID,x=h.tileID,w=new a.Point(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),S=new a.Point(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-x.overscaledZ||S.y-w.y||S.x-w.x}).map(l=>l.tileID.key):r.map(l=>l.tileID).sort(qr).map(l=>l.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,r){const l=this._tiles[t];l&&(l.state!=="loading"&&(l.state=r),this._loadTile(l,this._tileLoaded.bind(this,l,t,r)))}_tileLoaded(t,r,l,h){if(h)return t.state="errored",void(h.status!==404?this._source.fire(new a.ErrorEvent(h,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=a.browser.now(),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new a.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const r=this.getRenderableIds();for(let h=0;h<r.length;h++){const f=r[h];if(t.neighboringTiles&&t.neighboringTiles[f]){const x=this.getTileByID(f);l(t,x),l(x,t)}}function l(h,f){h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0;let x=f.tileID.canonical.x-h.tileID.canonical.x;const w=f.tileID.canonical.y-h.tileID.canonical.y,S=Math.pow(2,h.tileID.canonical.z),A=f.tileID.key;x===0&&w===0||Math.abs(w)>1||(Math.abs(x)>1&&(Math.abs(x+S)===1?x+=S:Math.abs(x-S)===1&&(x-=S)),f.dem&&h.dem&&(h.dem.backfillBorder(f.dem,x,w),h.neighboringTiles&&h.neighboringTiles[A]&&(h.neighboringTiles[A].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,l,h){for(const f in this._tiles){let x=this._tiles[f];if(h[f]||!x.hasData()||x.tileID.overscaledZ<=r||x.tileID.overscaledZ>l)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>r+1;){const A=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[A.key],x&&x.hasData()&&(w=A)}let S=w;for(;S.overscaledZ>r;)if(S=S.scaledTo(S.overscaledZ-1),t[S.key]){h[w.key]=w;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const l=this._loadedParentTiles[t.key];return l&&l.tileID.overscaledZ>=r?l:null}for(let l=t.overscaledZ-1;l>=r;l--){const h=t.scaledTo(l),f=this._getLoadedTile(h);if(f)return f}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const r=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(r*l*(this._maxTileCacheZoomLevels===null?a.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(f)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const l={};for(const h in this._tiles){const f=this._tiles[h];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+r),l[f.tileID.key]=f}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(h,this._tiles[h])}}update(t,r){if(this.transform=t,this.terrain=r,!this._sourceLoaded||this._paused)return;let l;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new a.OverscaledTileID(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y)):(l=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r}),this._source.hasTile&&(l=l.filter(k=>this._source.hasTile(k)))):l=[];const h=t.coveringZoomLevel(this._source),f=Math.max(h-hi.maxOverzooming,this._source.minzoom),x=Math.max(h+hi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const k={};for(const z of l)if(z.canonical.z>this._source.minzoom){const $=z.scaledTo(z.canonical.z-1);k[$.key]=$;const Y=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));k[Y.key]=Y}l=l.concat(Object.values(k))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new a.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=this._updateRetainedTiles(l,h);if(Ls(this._source.type)){const k={},z={},$=Object.keys(S),Y=a.browser.now();for(const K of $){const Q=S[K],X=this._tiles[K];if(!X||X.fadeEndTime!==0&&X.fadeEndTime<=Y)continue;const pe=this.findLoadedParent(Q,f);pe&&(this._addTile(pe.tileID),k[pe.tileID.key]=pe.tileID),z[K]=Q}this._retainLoadedChildren(z,h,x,S);for(const K in k)S[K]||(this._coveredTiles[K]=!0,S[K]=k[K]);if(r){const K={},Q={};for(const X of l)this._tiles[X.key].hasData()?K[X.key]=X:Q[X.key]=X;for(const X in Q){const pe=Q[X].children(this._source.maxzoom);this._tiles[pe[0].key]&&this._tiles[pe[1].key]&&this._tiles[pe[2].key]&&this._tiles[pe[3].key]&&(K[pe[0].key]=S[pe[0].key]=pe[0],K[pe[1].key]=S[pe[1].key]=pe[1],K[pe[2].key]=S[pe[2].key]=pe[2],K[pe[3].key]=S[pe[3].key]=pe[3],delete Q[X])}for(const X in Q){const pe=this.findLoadedParent(Q[X],this._source.minzoom);if(pe){K[pe.tileID.key]=S[pe.tileID.key]=pe.tileID;for(const xe in K)K[xe].isChildOf(pe.tileID)&&delete K[xe]}}for(const X in this._tiles)K[X]||(this._coveredTiles[X]=!0)}}for(const k in S)this._tiles[k].clearFadeHold();const A=a.keysDifference(this._tiles,S);for(const k of A){const z=this._tiles[k];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(k)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,r){const l={},h={},f=Math.max(r-hi.maxOverzooming,this._source.minzoom),x=Math.max(r+hi.maxUnderzooming,this._source.minzoom),w={};for(const S of t){const A=this._addTile(S);l[S.key]=S,A.hasData()||r<this._source.maxzoom&&(w[S.key]=S)}this._retainLoadedChildren(w,r,x,l);for(const S of t){let A=this._tiles[S.key];if(A.hasData())continue;if(r+1>this._source.maxzoom){const z=S.children(this._source.maxzoom)[0],$=this.getTile(z);if($&&$.hasData()){l[z.key]=z;continue}}else{const z=S.children(this._source.maxzoom);if(l[z[0].key]&&l[z[1].key]&&l[z[2].key]&&l[z[3].key])continue}let k=A.wasRequested();for(let z=S.overscaledZ-1;z>=f;--z){const $=S.scaledTo(z);if(h[$.key])break;if(h[$.key]=!0,A=this.getTile($),!A&&k&&(A=this._addTile($)),A){const Y=A.hasData();if((k||Y)&&(l[$.key]=$),k=A.wasRequested(),Y)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let l,h=this._tiles[t].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}r.push(h.key);const f=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(f),l)break;h=f}for(const f of r)this._loadedParentTiles[f]=l}}_addTile(t){let r=this._tiles[t.key];if(r)return r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const l=r;return r||(r=new fr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))),r.uses++,this._tiles[t.key]=r,l||this._source.fire(new a.Event("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const l=r.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,r,l){const h=[],f=this.transform;if(!f)return h;const x=l?f.getCameraQueryGeometry(t):t,w=t.map(K=>f.pointCoordinate(K,this.terrain)),S=x.map(K=>f.pointCoordinate(K,this.terrain)),A=this.getIds();let k=1/0,z=1/0,$=-1/0,Y=-1/0;for(const K of S)k=Math.min(k,K.x),z=Math.min(z,K.y),$=Math.max($,K.x),Y=Math.max(Y,K.y);for(let K=0;K<A.length;K++){const Q=this._tiles[A[K]];if(Q.holdingForFade())continue;const X=Q.tileID,pe=Math.pow(2,f.zoom-Q.tileID.overscaledZ),xe=r*Q.queryPadding*a.EXTENT/Q.tileSize/pe,re=[X.getTilePoint(new a.MercatorCoordinate(k,z)),X.getTilePoint(new a.MercatorCoordinate($,Y))];if(re[0].x-xe<a.EXTENT&&re[0].y-xe<a.EXTENT&&re[1].x+xe>=0&&re[1].y+xe>=0){const fe=w.map(Me=>X.getTilePoint(Me)),Ce=S.map(Me=>X.getTilePoint(Me));h.push({tile:Q,tileID:X,queryGeometry:fe,cameraQueryGeometry:Ce,scale:pe})}}return h}getVisibleCoordinates(t){const r=this.getRenderableIds(t).map(l=>this._tiles[l].tileID);for(const l of r)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(Ls(this._source.type)){const t=a.browser.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=t)return!0}return!1}setFeatureState(t,r,l){this._state.updateState(t=t||"_geojsonTileLayer",r,l)}removeFeatureState(t,r,l){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,l)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,l){const h=this._tiles[t];h&&h.setDependencies(r,l)}reloadTilesForDependencies(t,r){for(const l in this._tiles)this._tiles[l].hasDependency(t,r)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(t,r))}}function qr(p,t){const r=Math.abs(2*p.wrap)-+(p.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return p.overscaledZ-t.overscaledZ||l-r||t.canonical.y-p.canonical.y||t.canonical.x-p.canonical.x}function Ls(p){return p==="raster"||p==="image"||p==="video"}hi.maxOverzooming=10,hi.maxUnderzooming=3;const Je="mapboxgl_preloaded_worker_pool";class Dn{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Dn.workerCount;)this.workers.push(new Worker(a.config.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Je]}numActive(){return Object.keys(this.active).length}}const mn=Math.floor(a.browser.hardwareConcurrency/2);let Hi;function mr(){return Hi||(Hi=new Dn),Hi}Dn.workerCount=a.isSafari(globalThis)?Math.max(Math.min(mn,3),1):1;class nt{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.clamp(t,0,1);let r=1,l=this._distances[r];const h=t*this.paddedLength+this.padding;for(;l<h&&r<this._distances.length;)l=this._distances[++r];const f=r-1,x=this._distances[f],w=l-x,S=w>0?(h-x)/w:0;return this.points[f].mult(1-S).add(this.points[r].mult(S))}}function Lt(p,t){let r=!0;return p==="always"||p!=="never"&&t!=="never"||(r=!1),r}class Vt{constructor(t,r,l){const h=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(r/l);for(let x=0;x<this.xCellCount*this.yCellCount;x++)h.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,l,h,f){this._forEachCell(r,l,h,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(f)}insertCircle(t,r,l,h){this._forEachCell(r-h,l-h,r+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(l),this.circles.push(h)}_insertBoxCell(t,r,l,h,f,x){this.boxCells[f].push(x)}_insertCircleCell(t,r,l,h,f,x){this.circleCells[f].push(x)}_query(t,r,l,h,f,x,w){if(l<0||t>this.width||h<0||r>this.height)return[];const S=[];if(t<=0&&r<=0&&this.width<=l&&this.height<=h){if(f)return[{key:null,x1:t,y1:r,x2:l,y2:h}];for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const k=this.circles[3*A],z=this.circles[3*A+1],$=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:k-$,y1:z-$,x2:k+$,y2:z+$})}}else this._forEachCell(t,r,l,h,this._queryCell,S,{hitTest:f,overlapMode:x,seenUids:{box:{},circle:{}}},w);return S}query(t,r,l,h){return this._query(t,r,l,h,!1,null)}hitTest(t,r,l,h,f,x){return this._query(t,r,l,h,!0,f,x).length>0}hitTestCircle(t,r,l,h,f){const x=t-l,w=t+l,S=r-l,A=r+l;if(w<0||x>this.width||A<0||S>this.height)return!1;const k=[];return this._forEachCell(x,S,w,A,this._queryCellCircle,k,{hitTest:!0,overlapMode:h,circle:{x:t,y:r,radius:l},seenUids:{box:{},circle:{}}},f),k.length>0}_queryCell(t,r,l,h,f,x,w,S){const{seenUids:A,hitTest:k,overlapMode:z}=w,$=this.boxCells[f];if($!==null){const K=this.bboxes;for(const Q of $)if(!A.box[Q]){A.box[Q]=!0;const X=4*Q,pe=this.boxKeys[Q];if(t<=K[X+2]&&r<=K[X+3]&&l>=K[X+0]&&h>=K[X+1]&&(!S||S(pe))&&(!k||!Lt(z,pe.overlapMode))&&(x.push({key:pe,x1:K[X],y1:K[X+1],x2:K[X+2],y2:K[X+3]}),k))return!0}}const Y=this.circleCells[f];if(Y!==null){const K=this.circles;for(const Q of Y)if(!A.circle[Q]){A.circle[Q]=!0;const X=3*Q,pe=this.circleKeys[Q];if(this._circleAndRectCollide(K[X],K[X+1],K[X+2],t,r,l,h)&&(!S||S(pe))&&(!k||!Lt(z,pe.overlapMode))){const xe=K[X],re=K[X+1],fe=K[X+2];if(x.push({key:pe,x1:xe-fe,y1:re-fe,x2:xe+fe,y2:re+fe}),k)return!0}}}return!1}_queryCellCircle(t,r,l,h,f,x,w,S){const{circle:A,seenUids:k,overlapMode:z}=w,$=this.boxCells[f];if($!==null){const K=this.bboxes;for(const Q of $)if(!k.box[Q]){k.box[Q]=!0;const X=4*Q,pe=this.boxKeys[Q];if(this._circleAndRectCollide(A.x,A.y,A.radius,K[X+0],K[X+1],K[X+2],K[X+3])&&(!S||S(pe))&&!Lt(z,pe.overlapMode))return x.push(!0),!0}}const Y=this.circleCells[f];if(Y!==null){const K=this.circles;for(const Q of Y)if(!k.circle[Q]){k.circle[Q]=!0;const X=3*Q,pe=this.circleKeys[Q];if(this._circlesCollide(K[X],K[X+1],K[X+2],A.x,A.y,A.radius)&&(!S||S(pe))&&!Lt(z,pe.overlapMode))return x.push(!0),!0}}}_forEachCell(t,r,l,h,f,x,w,S){const A=this._convertToXCellCoord(t),k=this._convertToYCellCoord(r),z=this._convertToXCellCoord(l),$=this._convertToYCellCoord(h);for(let Y=A;Y<=z;Y++)for(let K=k;K<=$;K++)if(f.call(this,t,r,l,h,this.xCellCount*K+Y,x,w,S))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,l,h,f,x){const w=h-t,S=f-r,A=l+x;return A*A>w*w+S*S}_circleAndRectCollide(t,r,l,h,f,x,w){const S=(x-h)/2,A=Math.abs(t-(h+S));if(A>S+l)return!1;const k=(w-f)/2,z=Math.abs(r-(f+k));if(z>k+l)return!1;if(A<=S||z<=k)return!0;const $=A-S,Y=z-k;return $*$+Y*Y<=l*l}}function gn(p,t,r,l,h){const f=a.create();return t?(a.scale(f,f,[1/h,1/h,1]),r||a.rotateZ(f,f,l.angle)):a.multiply(f,l.labelPlaneMatrix,p),f}function _n(p,t,r,l,h){if(t){const f=a.clone(p);return a.scale(f,f,[h,h,1]),r||a.rotateZ(f,f,-l.angle),f}return l.glCoordMatrix}function St(p,t,r){let l;r?(l=[p.x,p.y,r(p.x,p.y),1],a.transformMat4(l,l,t)):(l=[p.x,p.y,0,1],ie(l,l,t));const h=l[3];return{point:new a.Point(l[0]/h,l[1]/h),signedDistanceFromCamera:h}}function ir(p,t){return .5+p/t*.5}function En(p,t){const r=p[0]/p[3],l=p[1]/p[3];return r>=-t[0]&&r<=t[0]&&l>=-t[1]&&l<=t[1]}function Gn(p,t,r,l,h,f,x,w,S,A){const k=l?p.textSizeData:p.iconSizeData,z=a.evaluateSizeForZoom(k,r.transform.zoom),$=[256/r.width*2+1,256/r.height*2+1],Y=l?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;Y.clear();const K=p.lineVertexArray,Q=l?p.text.placedSymbolArray:p.icon.placedSymbolArray,X=r.transform.width/r.transform.height;let pe=!1;for(let xe=0;xe<Q.length;xe++){const re=Q.get(xe);if(re.hidden||re.writingMode===a.WritingMode.vertical&&!pe){j(re.numGlyphs,Y);continue}let fe;if(pe=!1,A?(fe=[re.anchorX,re.anchorY,A(re.anchorX,re.anchorY),1],a.transformMat4(fe,fe,t)):(fe=[re.anchorX,re.anchorY,0,1],ie(fe,fe,t)),!En(fe,$)){j(re.numGlyphs,Y);continue}const Ce=ir(r.transform.cameraToCenterDistance,fe[3]),Me=a.evaluateSizeForFeature(k,z,re),Re=x?Me/Ce:Me*Ce,We=new a.Point(re.anchorX,re.anchorY),Oe=St(We,h,A).point,tt={projections:{},offsets:{}},vt=an(re,Re,!1,w,t,h,f,p.glyphOffsetArray,K,Y,Oe,We,tt,X,S,A);pe=vt.useVertical,(vt.notEnoughRoom||pe||vt.needsFlipping&&an(re,Re,!0,w,t,h,f,p.glyphOffsetArray,K,Y,Oe,We,tt,X,S,A).notEnoughRoom)&&j(re.numGlyphs,Y)}l?p.text.dynamicLayoutVertexBuffer.updateData(Y):p.icon.dynamicLayoutVertexBuffer.updateData(Y)}function Zn(p,t,r,l,h,f,x,w,S,A,k,z,$){const Y=w.glyphStartIndex+w.numGlyphs,K=w.lineStartIndex,Q=w.lineStartIndex+w.lineLength,X=t.getoffsetX(w.glyphStartIndex),pe=t.getoffsetX(Y-1),xe=B(p*X,r,l,h,f,x,w.segment,K,Q,S,A,k,z,$);if(!xe)return null;const re=B(p*pe,r,l,h,f,x,w.segment,K,Q,S,A,k,z,$);return re?{first:xe,last:re}:null}function ys(p,t,r,l){return p===a.WritingMode.horizontal&&Math.abs(r.y-t.y)>Math.abs(r.x-t.x)*l?{useVertical:!0}:(p===a.WritingMode.vertical?t.y<r.y:t.x>r.x)?{needsFlipping:!0}:null}function an(p,t,r,l,h,f,x,w,S,A,k,z,$,Y,K,Q){const X=t/24,pe=p.lineOffsetX*X,xe=p.lineOffsetY*X;let re;if(p.numGlyphs>1){const fe=p.glyphStartIndex+p.numGlyphs,Ce=p.lineStartIndex,Me=p.lineStartIndex+p.lineLength,Re=Zn(X,w,pe,xe,r,k,z,p,S,f,$,K,Q);if(!Re)return{notEnoughRoom:!0};const We=St(Re.first.point,x,Q).point,Oe=St(Re.last.point,x,Q).point;if(l&&!r){const tt=ys(p.writingMode,We,Oe,Y);if(tt)return tt}re=[Re.first];for(let tt=p.glyphStartIndex+1;tt<fe-1;tt++)re.push(B(X*w.getoffsetX(tt),pe,xe,r,k,z,p.segment,Ce,Me,S,f,$,K,Q));re.push(Re.last)}else{if(l&&!r){const Ce=St(z,h,Q).point,Me=p.lineStartIndex+p.segment+1,Re=new a.Point(S.getx(Me),S.gety(Me)),We=St(Re,h,Q),Oe=We.signedDistanceFromCamera>0?We.point:Si(z,Re,Ce,1,h,Q),tt=ys(p.writingMode,Ce,Oe,Y);if(tt)return tt}const fe=B(X*w.getoffsetX(p.glyphStartIndex),pe,xe,r,k,z,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,S,f,$,K,Q);if(!fe)return{notEnoughRoom:!0};re=[fe]}for(const fe of re)a.addDynamicAttributes(A,fe.point,fe.angle);return{}}function Si(p,t,r,l,h,f){const x=St(p.add(p.sub(t)._unit()),h,f).point,w=r.sub(x);return r.add(w._mult(l/w.mag()))}function Gr(p,t){const{projectionCache:r,lineVertexArray:l,labelPlaneMatrix:h,tileAnchorPoint:f,distanceFromAnchor:x,getElevation:w,previousVertex:S,direction:A,absOffsetX:k}=t;if(r.projections[p])return r.projections[p];const z=new a.Point(l.getx(p),l.gety(p)),$=St(z,h,w);if($.signedDistanceFromCamera>0)return r.projections[p]=$.point,$.point;const Y=p-A;return Si(x===0?f:new a.Point(l.getx(Y),l.gety(Y)),z,S,k-x+1,h,w)}function Cr(p,t,r){return p._unit()._perp()._mult(t*r)}function te(p,t,r,l,h,f,x,w){const{projectionCache:S,direction:A}=w;if(S.offsets[p])return S.offsets[p];const k=r.add(t);if(p+A<l||p+A>=h)return S.offsets[p]=k,k;const z=Gr(p+A,w),$=Cr(z.sub(r),x,A),Y=r.add($),K=z.add($);return S.offsets[p]=a.findLineIntersection(f,k,Y,K)||k,S.offsets[p]}function B(p,t,r,l,h,f,x,w,S,A,k,z,$,Y){const K=l?p-t:p+t;let Q=K>0?1:-1,X=0;l&&(Q*=-1,X=Math.PI),Q<0&&(X+=Math.PI);let pe,xe,re=Q>0?w+x:w+x+1,fe=h,Ce=h,Me=0,Re=0;const We=Math.abs(K),Oe=[];let tt;for(;Me+Re<=We;){if(re+=Q,re<w||re>=S)return null;Me+=Re,Ce=fe,xe=pe;const rt={projectionCache:z,lineVertexArray:A,labelPlaneMatrix:k,tileAnchorPoint:f,distanceFromAnchor:Me,getElevation:Y,previousVertex:Ce,direction:Q,absOffsetX:We};if(fe=Gr(re,rt),r===0)Oe.push(Ce),tt=fe.sub(Ce);else{let It;const gt=fe.sub(Ce);It=gt.mag()===0?Cr(Gr(re+Q,rt).sub(fe),r,Q):Cr(gt,r,Q),xe||(xe=Ce.add(It)),pe=te(re,It,fe,w,S,xe,r,rt),Oe.push(xe),tt=pe.sub(xe)}Re=tt.mag()}const vt=tt._mult((We-Me)/Re)._add(xe||Ce),Qt=X+Math.atan2(fe.y-Ce.y,fe.x-Ce.x);return Oe.push(vt),{point:vt,angle:$?Qt:0,path:Oe}}const N=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function j(p,t){for(let r=0;r<p;r++){const l=t.length;t.resize(l+4),t.float32.set(N,3*l)}}function ie(p,t,r){const l=t[0],h=t[1];return p[0]=r[0]*l+r[4]*h+r[12],p[1]=r[1]*l+r[5]*h+r[13],p[3]=r[3]*l+r[7]*h+r[15],p}const W=100;class se{constructor(t,r=new Vt(t.width+200,t.height+200,25),l=new Vt(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=l,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+W,this.screenBottomBoundary=t.height+W,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,r,l,h,f,x){const w=this.projectAndGetPerspectiveRatio(h,t.anchorPointX,t.anchorPointY,x),S=l*w.perspectiveRatio,A=t.x1*S+w.point.x,k=t.y1*S+w.point.y,z=t.x2*S+w.point.x,$=t.y2*S+w.point.y;return!this.isInsideGrid(A,k,z,$)||r!=="always"&&this.grid.hitTest(A,k,z,$,r,f)||w.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[A,k,z,$],offscreen:this.isOffscreen(A,k,z,$)}}placeCollisionCircles(t,r,l,h,f,x,w,S,A,k,z,$,Y,K){const Q=[],X=new a.Point(r.anchorX,r.anchorY),pe=St(X,x,K),xe=ir(this.transform.cameraToCenterDistance,pe.signedDistanceFromCamera),re=(k?f/xe:f*xe)/a.ONE_EM,fe=St(X,w,K).point,Ce=Zn(re,h,r.lineOffsetX*re,r.lineOffsetY*re,!1,fe,X,r,l,w,{projections:{},offsets:{}},!1,K);let Me=!1,Re=!1,We=!0;if(Ce){const Oe=.5*$*xe+Y,tt=new a.Point(-100,-100),vt=new a.Point(this.screenRightBoundary,this.screenBottomBoundary),Qt=new nt,rt=Ce.first,It=Ce.last;let gt=[];for(let Ot=rt.path.length-1;Ot>=1;Ot--)gt.push(rt.path[Ot]);for(let Ot=1;Ot<It.path.length;Ot++)gt.push(It.path[Ot]);const $i=2.5*Oe;if(S){const Ot=gt.map(Pt=>St(Pt,S,K));gt=Ot.some(Pt=>Pt.signedDistanceFromCamera<=0)?[]:Ot.map(Pt=>Pt.point)}let ii=[];if(gt.length>0){const Ot=gt[0].clone(),Pt=gt[0].clone();for(let Vi=1;Vi<gt.length;Vi++)Ot.x=Math.min(Ot.x,gt[Vi].x),Ot.y=Math.min(Ot.y,gt[Vi].y),Pt.x=Math.max(Pt.x,gt[Vi].x),Pt.y=Math.max(Pt.y,gt[Vi].y);ii=Ot.x>=tt.x&&Pt.x<=vt.x&&Ot.y>=tt.y&&Pt.y<=vt.y?[gt]:Pt.x<tt.x||Ot.x>vt.x||Pt.y<tt.y||Ot.y>vt.y?[]:a.clipLine([gt],tt.x,tt.y,vt.x,vt.y)}for(const Ot of ii){Qt.reset(Ot,.25*Oe);let Pt=0;Pt=Qt.length<=.5*Oe?1:Math.ceil(Qt.paddedLength/$i)+1;for(let Vi=0;Vi<Pt;Vi++){const ni=Vi/Math.max(Pt-1,1),xr=Qt.lerp(ni),Ln=xr.x+W,cn=xr.y+W;Q.push(Ln,cn,Oe,0);const Nn=Ln-Oe,$n=cn-Oe,Fs=Ln+Oe,Xs=cn+Oe;if(We=We&&this.isOffscreen(Nn,$n,Fs,Xs),Re=Re||this.isInsideGrid(Nn,$n,Fs,Xs),t!=="always"&&this.grid.hitTestCircle(Ln,cn,Oe,t,z)&&(Me=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Me}}}}return{circles:!A&&Me||!Re||xe<this.perspectiveRatioCutoff?[]:Q,offscreen:We,collisionDetected:Me}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let l=1/0,h=1/0,f=-1/0,x=-1/0;for(const k of t){const z=new a.Point(k.x+W,k.y+W);l=Math.min(l,z.x),h=Math.min(h,z.y),f=Math.max(f,z.x),x=Math.max(x,z.y),r.push(z)}const w=this.grid.query(l,h,f,x).concat(this.ignoredGrid.query(l,h,f,x)),S={},A={};for(const k of w){const z=k.key;if(S[z.bucketInstanceId]===void 0&&(S[z.bucketInstanceId]={}),S[z.bucketInstanceId][z.featureIndex])continue;const $=[new a.Point(k.x1,k.y1),new a.Point(k.x2,k.y1),new a.Point(k.x2,k.y2),new a.Point(k.x1,k.y2)];a.polygonIntersectsPolygon(r,$)&&(S[z.bucketInstanceId][z.featureIndex]=!0,A[z.bucketInstanceId]===void 0&&(A[z.bucketInstanceId]=[]),A[z.bucketInstanceId].push(z.featureIndex))}return A}insertCollisionBox(t,r,l,h,f,x){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:f,collisionGroupID:x,overlapMode:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,l,h,f,x){const w=l?this.ignoredGrid:this.grid,S={bucketInstanceId:h,featureIndex:f,collisionGroupID:x,overlapMode:r};for(let A=0;A<t.length;A+=4)w.insertCircle(S,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,r,l,h){let f;return h?(f=[r,l,h(r,l),1],a.transformMat4(f,f,t)):(f=[r,l,0,1],ie(f,f,t)),{point:new a.Point((f[0]/f[3]+1)/2*this.transform.width+W,(-f[1]/f[3]+1)/2*this.transform.height+W),perspectiveRatio:.5+this.transform.cameraToCenterDistance/f[3]*.5}}isOffscreen(t,r,l,h){return l<W||t>=this.screenRightBoundary||h<W||r>this.screenBottomBoundary}isInsideGrid(t,r,l,h){return l>=0&&t<this.gridRightBoundary&&h>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=a.identity([]);return a.translate(t,t,[-100,-100,0]),t}}function ue(p,t,r){return t*(a.EXTENT/(p.tileSize*Math.pow(2,r-p.tileID.overscaledZ)))}class le{constructor(t,r,l,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class ge{constructor(t,r,l,h,f){this.text=new le(t?t.text:null,r,l,f),this.icon=new le(t?t.icon:null,r,h,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fe{constructor(t,r,l){this.text=t,this.icon=r,this.skipFade=l}}class Ue{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Ne{constructor(t,r,l,h,f){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=f}}class Mt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:l=>l.collisionGroupID===r}}return this.collisionGroups[t]}}function Zt(p,t,r,l,h){const{horizontalAlign:f,verticalAlign:x}=a.getAnchorAlignment(p);return new a.Point(-(f-.5)*t+l[0]*h,-(x-.5)*r+l[1]*h)}function yt(p,t,r,l,h,f){const{x1:x,x2:w,y1:S,y2:A,anchorPointX:k,anchorPointY:z}=p,$=new a.Point(t,r);return l&&$._rotate(h?f:-f),{x1:x+$.x,y1:S+$.y,x2:w+$.x,y2:A+$.y,anchorPointX:k,anchorPointY:z}}class Et{constructor(t,r,l,h,f){this.transform=t.clone(),this.terrain=r,this.collisionIndex=new se(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Mt(h),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,l,h){const f=l.getBucket(r),x=l.latestFeatureIndex;if(!f||!x||r.id!==f.layerIds[0])return;const w=l.collisionBoxArray,S=f.layers[0].layout,A=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),k=l.tileSize/a.EXTENT,z=this.transform.calculatePosMatrix(l.tileID.toUnwrapped()),$=S.get("text-pitch-alignment")==="map",Y=S.get("text-rotation-alignment")==="map",K=ue(l,1,this.transform.zoom),Q=gn(z,$,Y,this.transform,K);let X=null;if($){const xe=_n(z,$,Y,this.transform,K);X=a.multiply([],this.transform.labelPlaneMatrix,xe)}this.retainedQueryData[f.bucketInstanceId]=new Ne(f.bucketInstanceId,x,f.sourceLayerIndex,f.index,l.tileID);const pe={bucket:f,layout:S,posMatrix:z,textLabelPlaneMatrix:Q,labelToScreenMatrix:X,scale:A,textPixelRatio:k,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(h)for(const xe of f.sortKeyRanges){const{sortKey:re,symbolInstanceStart:fe,symbolInstanceEnd:Ce}=xe;t.push({sortKey:re,symbolInstanceStart:fe,symbolInstanceEnd:Ce,parameters:pe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(t,r,l,h,f,x,w,S,A,k,z,$,Y,K,Q,X){const pe=a.TextAnchorEnum[t.textAnchor],xe=[t.textOffset0,t.textOffset1],re=Zt(pe,l,h,xe,f),fe=this.collisionIndex.placeCollisionBox(yt(r,re.x,re.y,x,w,this.transform.angle),z,S,A,k.predicate,X);if((!Q||this.collisionIndex.placeCollisionBox(yt(Q,re.x,re.y,x,w,this.transform.angle),z,S,A,k.predicate,X).box.length!==0)&&fe.box.length>0){let Ce;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(Ce=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:xe,width:l,height:h,anchor:pe,textBoxScale:f,prevAnchor:Ce},this.markUsedJustification(Y,pe,$,K),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,K,$),this.placedOrientations[$.crossTileID]=K),{shift:re,placedGlyphBoxes:fe}}}placeLayerBucketPart(t,r,l){const{bucket:h,layout:f,posMatrix:x,textLabelPlaneMatrix:w,labelToScreenMatrix:S,textPixelRatio:A,holdingForFade:k,collisionBoxArray:z,partiallyEvaluatedTextSize:$,collisionGroup:Y}=t.parameters,K=f.get("text-optional"),Q=f.get("icon-optional"),X=a.getOverlapMode(f,"text-overlap","text-allow-overlap"),pe=X==="always",xe=a.getOverlapMode(f,"icon-overlap","icon-allow-overlap"),re=xe==="always",fe=f.get("text-rotation-alignment")==="map",Ce=f.get("text-pitch-alignment")==="map",Me=f.get("icon-text-fit")!=="none",Re=f.get("symbol-z-order")==="viewport-y",We=pe&&(re||!h.hasIconData()||Q),Oe=re&&(pe||!h.hasTextData()||K);!h.collisionArrays&&z&&h.deserializeCollisionBoxes(z);const tt=this.retainedQueryData[h.bucketInstanceId].tileID,vt=this.terrain?(rt,It)=>this.terrain.getElevation(tt,rt,It):null,Qt=(rt,It)=>{var gt,$i;if(r[rt.crossTileID])return;if(k)return void(this.placements[rt.crossTileID]=new Fe(!1,!1,!1));let ii=!1,Ot=!1,Pt=!0,Vi=null,ni={box:null,offscreen:null},xr={box:null,offscreen:null},Ln=null,cn=null,Nn=null,$n=0,Fs=0,Xs=0;It.textFeatureIndex?$n=It.textFeatureIndex:rt.useRuntimeCollisionCircles&&($n=rt.featureIndex),It.verticalTextFeatureIndex&&(Fs=It.verticalTextFeatureIndex);const bs=It.textBox;if(bs){const _i=un=>{let wn=a.WritingMode.horizontal;if(h.allowVerticalPlacement&&!un&&this.prevPlacement){const In=this.prevPlacement.placedOrientations[rt.crossTileID];In&&(this.placedOrientations[rt.crossTileID]=In,wn=In,this.markUsedOrientation(h,wn,rt))}return wn},Yi=(un,wn)=>{if(h.allowVerticalPlacement&&rt.numVerticalGlyphVertices>0&&It.verticalTextBox){for(const In of h.writingModes)if(In===a.WritingMode.vertical?(ni=wn(),xr=ni):ni=un(),ni&&ni.box&&ni.box.length)break}else ni=un()},Rn=rt.textAnchorOffsetStartIndex,br=rt.textAnchorOffsetEndIndex;if(br===Rn){const un=(wn,In)=>{const Ji=this.collisionIndex.placeCollisionBox(wn,X,A,x,Y.predicate,vt);return Ji&&Ji.box&&Ji.box.length&&(this.markUsedOrientation(h,In,rt),this.placedOrientations[rt.crossTileID]=In),Ji};Yi(()=>un(bs,a.WritingMode.horizontal),()=>{const wn=It.verticalTextBox;return h.allowVerticalPlacement&&rt.numVerticalGlyphVertices>0&&wn?un(wn,a.WritingMode.vertical):{box:null,offscreen:null}}),_i(ni&&ni.box&&ni.box.length)}else{let un=a.TextAnchorEnum[($i=(gt=this.prevPlacement)===null||gt===void 0?void 0:gt.variableOffsets[rt.crossTileID])===null||$i===void 0?void 0:$i.anchor];const wn=(Ji,Cn,ws)=>{const Ts=Ji.x2-Ji.x1,ho=Ji.y2-Ji.y1,au=rt.textBoxScale,Ys=Me&&xe==="never"?Cn:null;let fa={box:[],offscreen:!1},$o=X==="never"?1:2,Qi="never";un&&$o++;for(let Fl=0;Fl<$o;Fl++){for(let Ol=Rn;Ol<br;Ol++){const ds=h.textAnchorOffsets.get(Ol);if(un&&ds.textAnchor!==un)continue;const Js=this.attemptAnchorPlacement(ds,Ji,Ts,ho,au,fe,Ce,A,x,Y,Qi,rt,h,ws,Ys,vt);if(Js&&(fa=Js.placedGlyphBoxes,fa&&fa.box&&fa.box.length))return ii=!0,Vi=Js.shift,fa}un?un=null:Qi=X}return fa};Yi(()=>wn(bs,It.iconBox,a.WritingMode.horizontal),()=>{const Ji=It.verticalTextBox;return h.allowVerticalPlacement&&!(ni&&ni.box&&ni.box.length)&&rt.numVerticalGlyphVertices>0&&Ji?wn(Ji,It.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),ni&&(ii=ni.box,Pt=ni.offscreen);const In=_i(ni&&ni.box);if(!ii&&this.prevPlacement){const Ji=this.prevPlacement.variableOffsets[rt.crossTileID];Ji&&(this.variableOffsets[rt.crossTileID]=Ji,this.markUsedJustification(h,Ji.anchor,rt,In))}}}if(Ln=ni,ii=Ln&&Ln.box&&Ln.box.length>0,Pt=Ln&&Ln.offscreen,rt.useRuntimeCollisionCircles){const _i=h.text.placedSymbolArray.get(rt.centerJustifiedTextSymbolIndex),Yi=a.evaluateSizeForFeature(h.textSizeData,$,_i),Rn=f.get("text-padding");cn=this.collisionIndex.placeCollisionCircles(X,_i,h.lineVertexArray,h.glyphOffsetArray,Yi,x,w,S,l,Ce,Y.predicate,rt.collisionCircleDiameter,Rn,vt),cn.circles.length&&cn.collisionDetected&&!l&&a.warnOnce("Collisions detected, but collision boxes are not shown"),ii=pe||cn.circles.length>0&&!cn.collisionDetected,Pt=Pt&&cn.offscreen}if(It.iconFeatureIndex&&(Xs=It.iconFeatureIndex),It.iconBox){const _i=Yi=>{const Rn=Me&&Vi?yt(Yi,Vi.x,Vi.y,fe,Ce,this.transform.angle):Yi;return this.collisionIndex.placeCollisionBox(Rn,xe,A,x,Y.predicate,vt)};xr&&xr.box&&xr.box.length&&It.verticalIconBox?(Nn=_i(It.verticalIconBox),Ot=Nn.box.length>0):(Nn=_i(It.iconBox),Ot=Nn.box.length>0),Pt=Pt&&Nn.offscreen}const No=K||rt.numHorizontalGlyphVertices===0&&rt.numVerticalGlyphVertices===0,Ks=Q||rt.numIconVertices===0;if(No||Ks?Ks?No||(Ot=Ot&&ii):ii=Ot&&ii:Ot=ii=Ot&&ii,ii&&Ln&&Ln.box&&this.collisionIndex.insertCollisionBox(Ln.box,X,f.get("text-ignore-placement"),h.bucketInstanceId,xr&&xr.box&&Fs?Fs:$n,Y.ID),Ot&&Nn&&this.collisionIndex.insertCollisionBox(Nn.box,xe,f.get("icon-ignore-placement"),h.bucketInstanceId,Xs,Y.ID),cn&&(ii&&this.collisionIndex.insertCollisionCircles(cn.circles,X,f.get("text-ignore-placement"),h.bucketInstanceId,$n,Y.ID),l)){const _i=h.bucketInstanceId;let Yi=this.collisionCircleArrays[_i];Yi===void 0&&(Yi=this.collisionCircleArrays[_i]=new Ue);for(let Rn=0;Rn<cn.circles.length;Rn+=4)Yi.circles.push(cn.circles[Rn+0]),Yi.circles.push(cn.circles[Rn+1]),Yi.circles.push(cn.circles[Rn+2]),Yi.circles.push(cn.collisionDetected?1:0)}if(rt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[rt.crossTileID]=new Fe(ii||We,Ot||Oe,Pt||h.justReloaded),r[rt.crossTileID]=!0};if(Re){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const rt=h.getSortedSymbolIndexes(this.transform.angle);for(let It=rt.length-1;It>=0;--It){const gt=rt[It];Qt(h.symbolInstances.get(gt),h.collisionArrays[gt])}}else for(let rt=t.symbolInstanceStart;rt<t.symbolInstanceEnd;rt++)Qt(h.symbolInstances.get(rt),h.collisionArrays[rt]);if(l&&h.bucketInstanceId in this.collisionCircleArrays){const rt=this.collisionCircleArrays[h.bucketInstanceId];a.invert(rt.invProjMatrix,x),rt.viewportMatrix=this.collisionIndex.getViewportMatrix()}h.justReloaded=!1}markUsedJustification(t,r,l,h){let f;f=h===a.WritingMode.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(r)];const x=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of x)w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=f>=0&&w!==f?0:l.crossTileID)}markUsedOrientation(t,r,l){const h=r===a.WritingMode.horizontal||r===a.WritingMode.horizontalOnly?r:0,f=r===a.WritingMode.vertical?r:0,x=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of x)t.text.placedSymbolArray.get(w).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let l=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const h=r?r.symbolFadeChange(t):1,f=r?r.opacities:{},x=r?r.variableOffsets:{},w=r?r.placedOrientations:{};for(const S in this.placements){const A=this.placements[S],k=f[S];k?(this.opacities[S]=new ge(k,h,A.text,A.icon),l=l||A.text!==k.text.placed||A.icon!==k.icon.placed):(this.opacities[S]=new ge(null,h,A.text,A.icon,A.skipFade),l=l||A.text||A.icon)}for(const S in f){const A=f[S];if(!this.opacities[S]){const k=new ge(A,h,!1,!1);k.isHidden()||(this.opacities[S]=k,l=l||A.text.placed||A.icon.placed)}}for(const S in x)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=x[S]);for(const S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r){const l={};for(const h of r){const f=h.getBucket(t);f&&h.latestFeatureIndex&&t.id===f.layerIds[0]&&this.updateBucketOpacities(f,l,h.collisionBoxArray)}}updateBucketOpacities(t,r,l){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const h=t.layers[0],f=h.layout,x=new ge(null,0,!1,!1,!0),w=f.get("text-allow-overlap"),S=f.get("icon-allow-overlap"),A=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),k=f.get("text-rotation-alignment")==="map",z=f.get("text-pitch-alignment")==="map",$=f.get("icon-text-fit")!=="none",Y=new ge(null,0,w&&(S||!t.hasIconData()||f.get("icon-optional")),S&&(w||!t.hasTextData()||f.get("text-optional")),!0);!t.collisionArrays&&l&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(l);const K=(Q,X,pe)=>{for(let xe=0;xe<X/4;xe++)Q.opacityVertexArray.emplaceBack(pe);Q.hasVisibleVertices=Q.hasVisibleVertices||pe!==Xi};for(let Q=0;Q<t.symbolInstances.length;Q++){const X=t.symbolInstances.get(Q),{numHorizontalGlyphVertices:pe,numVerticalGlyphVertices:xe,crossTileID:re}=X;let fe=this.opacities[re];r[re]?fe=x:fe||(fe=Y,this.opacities[re]=fe),r[re]=!0;const Ce=X.numIconVertices>0,Me=this.placedOrientations[X.crossTileID],Re=Me===a.WritingMode.vertical,We=Me===a.WritingMode.horizontal||Me===a.WritingMode.horizontalOnly;if(pe>0||xe>0){const Oe=jn(fe.text);K(t.text,pe,Re?Xi:Oe),K(t.text,xe,We?Xi:Oe);const tt=fe.text.isHidden();[X.rightJustifiedTextSymbolIndex,X.centerJustifiedTextSymbolIndex,X.leftJustifiedTextSymbolIndex].forEach(rt=>{rt>=0&&(t.text.placedSymbolArray.get(rt).hidden=tt||Re?1:0)}),X.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(X.verticalPlacedTextSymbolIndex).hidden=tt||We?1:0);const vt=this.variableOffsets[X.crossTileID];vt&&this.markUsedJustification(t,vt.anchor,X,Me);const Qt=this.placedOrientations[X.crossTileID];Qt&&(this.markUsedJustification(t,"left",X,Qt),this.markUsedOrientation(t,Qt,X))}if(Ce){const Oe=jn(fe.icon),tt=!($&&X.verticalPlacedIconSymbolIndex&&Re);X.placedIconSymbolIndex>=0&&(K(t.icon,X.numIconVertices,tt?Oe:Xi),t.icon.placedSymbolArray.get(X.placedIconSymbolIndex).hidden=fe.icon.isHidden()),X.verticalPlacedIconSymbolIndex>=0&&(K(t.icon,X.numVerticalIconVertices,tt?Xi:Oe),t.icon.placedSymbolArray.get(X.verticalPlacedIconSymbolIndex).hidden=fe.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Oe=t.collisionArrays[Q];if(Oe){let tt=new a.Point(0,0);if(Oe.textBox||Oe.verticalTextBox){let Qt=!0;if(A){const rt=this.variableOffsets[re];rt?(tt=Zt(rt.anchor,rt.width,rt.height,rt.textOffset,rt.textBoxScale),k&&tt._rotate(z?this.transform.angle:-this.transform.angle)):Qt=!1}Oe.textBox&&qt(t.textCollisionBox.collisionVertexArray,fe.text.placed,!Qt||Re,tt.x,tt.y),Oe.verticalTextBox&&qt(t.textCollisionBox.collisionVertexArray,fe.text.placed,!Qt||We,tt.x,tt.y)}const vt=!!(!We&&Oe.verticalIconBox);Oe.iconBox&&qt(t.iconCollisionBox.collisionVertexArray,fe.icon.placed,vt,$?tt.x:0,$?tt.y:0),Oe.verticalIconBox&&qt(t.iconCollisionBox.collisionVertexArray,fe.icon.placed,!vt,$?tt.x:0,$?tt.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const Q=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Q.invProjMatrix,t.placementViewportMatrix=Q.viewportMatrix,t.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const l=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function qt(p,t,r,l,h){p.emplaceBack(t?1:0,r?1:0,l||0,h||0),p.emplaceBack(t?1:0,r?1:0,l||0,h||0),p.emplaceBack(t?1:0,r?1:0,l||0,h||0),p.emplaceBack(t?1:0,r?1:0,l||0,h||0)}const fi=Math.pow(2,25),Ri=Math.pow(2,24),si=Math.pow(2,17),pi=Math.pow(2,16),Mr=Math.pow(2,9),Bt=Math.pow(2,8),tn=Math.pow(2,1);function jn(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const t=p.placed?1:0,r=Math.floor(127*p.opacity);return r*fi+t*Ri+r*si+t*pi+r*Mr+t*Bt+r*tn+t}const Xi=0;class Zr{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,r,l,h,f){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(x,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((w,S)=>w.sortKey-S.sortKey));this._currentPartIndex<x.length;)if(r.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,f())return!0;return!1}}class Ju{constructor(t,r,l,h,f,x,w,S){this.placement=new Et(t,r,x,w,S),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,r,l){const h=a.browser.now(),f=()=>!this._forceFullPlacement&&a.browser.now()-h>2;for(;this._currentPlacementIndex>=0;){const x=r[t[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=w)&&(!x.maxzoom||x.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Zr(x)),this._inProgressLayer.continuePlacement(l[x.source],this.placement,this._showCollisionBoxes,x,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const nr=512/a.EXTENT/2;class jr{constructor(t,r,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let f=0;f<r.length;f++){const x=r.get(f),w=x.key,S=h.get(w);S?S.push(x):h.set(w,[x])}for(const[f,x]of h){const w={positions:x.map(S=>({x:Math.floor(S.anchorX*nr),y:Math.floor(S.anchorY*nr)})),crossTileIDs:x.map(S=>S.crossTileID)};if(w.positions.length>128){const S=new a.KDBush(w.positions.length,16,Uint16Array);for(const{x:A,y:k}of w.positions)S.add(A,k);S.finish(),delete w.positions,w.index=S}this._symbolsByKey[f]=w}}getScaledCoordinates(t,r){const{x:l,y:h,z:f}=this.tileID.canonical,{x,y:w,z:S}=r.canonical,A=nr/Math.pow(2,S-f),k=(w*a.EXTENT+t.anchorY)*A,z=h*a.EXTENT*nr;return{x:Math.floor((x*a.EXTENT+t.anchorX)*A-l*a.EXTENT*nr),y:Math.floor(k-z)}}findMatches(t,r,l){const h=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let f=0;f<t.length;f++){const x=t.get(f);if(x.crossTileID)continue;const w=this._symbolsByKey[x.key];if(!w)continue;const S=this.getScaledCoordinates(x,r);if(w.index){const A=w.index.range(S.x-h,S.y-h,S.x+h,S.y+h).sort();for(const k of A){const z=w.crossTileIDs[k];if(!l[z]){l[z]=!0,x.crossTileID=z;break}}}else if(w.positions)for(let A=0;A<w.positions.length;A++){const k=w.positions[A],z=w.crossTileIDs[A];if(Math.abs(k.x-S.x)<=h&&Math.abs(k.y-S.y)<=h&&!l[z]){l[z]=!0,x.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class ec{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ia{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const l in this.indexes){const h=this.indexes[l],f={};for(const x in h){const w=h[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+r),f[w.tileID.key]=w}this.indexes[l]=f}this.lng=t}addBucket(t,r,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let f=0;f<r.symbolInstances.length;f++)r.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const h=this.usedCrossTileIDs[t.overscaledZ];for(const f in this.indexes){const x=this.indexes[f];if(Number(f)>t.overscaledZ)for(const w in x){const S=x[w];S.tileID.isChildOf(t)&&S.findMatches(r.symbolInstances,t,h)}else{const w=x[t.scaledTo(Number(f)).key];w&&w.findMatches(r.symbolInstances,t,h)}}for(let f=0;f<r.symbolInstances.length;f++){const x=r.symbolInstances.get(f);x.crossTileID||(x.crossTileID=l.generate(),h[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new jr(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const l of r.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let r=!1;for(const l in this.indexes){const h=this.indexes[l];for(const f in h)t[h[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[f]),delete h[f],r=!0)}return r}}class yn{constructor(){this.layerIndexes={},this.crossTileIDs=new ec,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,l){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new Ia);let f=!1;const x={};h.handleWrapJump(l);for(const w of r){const S=w.getBucket(t);S&&t.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(w.tileID,S,this.crossTileIDs)&&(f=!0),x[S.bucketInstanceId]=!0)}return h.removeStaleBuckets(x)&&(f=!0),f}pruneUnusedLayers(t){const r={};t.forEach(l=>{r[l]=!0});for(const l in this.layerIndexes)r[l]||delete this.layerIndexes[l]}}const oo=(p,t)=>a.emitValidationErrors(p,t&&t.filter(r=>r.identifier!=="source.canvas")),wo=a.pick(a.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),vn=a.pick(a.operations,["setCenter","setZoom","setBearing","setPitch"]),Ca=a.emptyStyle();class Wn extends a.Evented{constructor(t,r={}){super(),this.map=t,this.dispatcher=new Ar(mr(),this,t._getMapId()),this.imageManager=new kt,this.imageManager.setEventedParent(this),this.glyphManager=new yi(t._requestManager,r.localIdeographFontFamily),this.lineAtlas=new ei(256,512),this.crossTileSymbolIndex=new yn,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const l=this;this._rtlTextPluginCallback=Wn.registerForPluginStateChange(h=>{l.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:h.pluginStatus,pluginURL:h.pluginURL},(f,x)=>{if(a.triggerPluginCompletionEvent(f),x&&x.every(w=>w))for(const w in l.sourceCaches){const S=l.sourceCaches[w].getSource().type;S!=="vector"&&S!=="geojson"||l.sourceCaches[w].reload()}})}),this.on("data",h=>{if(h.dataType!=="source"||h.sourceDataType!=="metadata")return;const f=this.sourceCaches[h.sourceId];if(!f)return;const x=f.getSource();if(x&&x.vectorLayerIds)for(const w in this._layers){const S=this._layers[w];S.source===x.id&&this._validateLayer(S)}})}loadURL(t,r={},l){this.fire(new a.Event("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const h=this.map._requestManager.transformRequest(t,Ze.Style);this._request=a.getJSON(h,(f,x)=>{this._request=null,f?this.fire(new a.ErrorEvent(f)):x&&this._load(x,r,l)})}loadJSON(t,r={},l){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.browser.frame(()=>{this._request=null,r.validate=r.validate!==!1,this._load(t,r,l)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Ca,{validate:!1})}_load(t,r,l){const h=r.transformStyle?r.transformStyle(l,t):t;if(!r.validate||!oo(this,a.validateStyle(h))){this._loaded=!0,this.stylesheet=h;for(const f in h.sources)this.addSource(f,h.sources[f],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs),this._createLayers(),this.light=new fn(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}}_createLayers(){const t=a.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of t){const l=a.createStyleLayer(r);l.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=l}}_loadSprite(t,r=!1,l=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(h,f,x,w){const S=wt(h),A=S.length,k=x>1?"@2x":"",z={},$={},Y={};for(const{id:K,url:Q}of S){const X=f.transformRequest(f.normalizeSpriteURL(Q,k,".json"),Ze.SpriteJSON),pe=`${K}_${X.url}`;z[pe]=a.getJSON(X,(fe,Ce)=>{delete z[pe],$[K]=Ce,Dt(w,$,Y,fe,A)});const xe=f.transformRequest(f.normalizeSpriteURL(Q,k,".png"),Ze.SpriteImage),re=`${K}_${xe.url}`;z[re]=De.getImage(xe,(fe,Ce)=>{delete z[re],Y[K]=Ce,Dt(w,$,Y,fe,A)})}return{cancel(){for(const K of Object.values(z))K.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(h,f)=>{if(this._spriteRequest=null,h)this.fire(new a.ErrorEvent(h));else if(f)for(const x in f){this._spritesImagesIds[x]=[];const w=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(S=>!(S in f)):[];for(const S of w)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in f[x]){const A=x==="default"?S:`${x}:${S}`;this._spritesImagesIds[x].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,f[x][S],!1):this.imageManager.addImage(A,f[x][S]),r&&(this._changedImages[A]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"})),l&&l(h)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}_validateLayer(t){const r=this.sourceCaches[t.source];if(!r)return;const l=t.sourceLayer;if(!l)return;const h=r.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const r=this._serializedAllLayers();if(!t||t.length===0)return Object.values(r);const l=[];for(const h of t)r[h]&&l.push(r[h]);return l}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const r=Object.keys(this._layers);for(const l of r){const h=this._layers[l];h.type!=="custom"&&(t[l]=h.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const r=this._changed;if(this._changed){const h=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(h.length||f.length)&&this._updateWorkerLayers(h,f);for(const x in this._updatedSources){const w=this._updatedSources[x];if(w==="reload")this._reloadSource(x);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const l={};for(const h in this.sourceCaches){const f=this.sourceCaches[h];l[h]=f.used,f.used=!1}for(const h of this._order){const f=this._layers[h];f.recalculate(t,this._availableImages),!f.isHidden(t.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const h in l){const f=this.sourceCaches[h];l[h]!==f.used&&f.fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.z=t.zoom,r&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,r){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,r={}){this._checkLoaded();const l=this.serialize();if(t=r.transformStyle?r.transformStyle(l,t):t,oo(this,a.validateStyle(t)))return!1;(t=a.clone$1(t)).layers=a.derefLayers(t.layers);const h=a.diffStyles(l,t).filter(x=>!(x.command in vn));if(h.length===0)return!1;const f=h.filter(x=>!(x.command in wo));if(f.length>0)throw new Error(`Unimplemented: ${f.map(x=>x.command).join(", ")}.`);for(const x of h)x.command!=="setTransition"&&this[x.command].apply(this,x.args);return this.stylesheet=t,!0}addImage(t,r){if(this.getImage(t))return this.fire(new a.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,r),this._afterImageUpdated(t)}updateImage(t,r){this.imageManager.updateImage(t,r)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new a.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,r,l={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(a.validateStyle.source,`sources.${t}`,r,null,l))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const h=this.sourceCaches[t]=new hi(t,r,this.dispatcher);h.style=this,h.setEventedParent(this,()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t})),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new a.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const r=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],r.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,r){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.sourceCaches[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(r),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,r,l={}){this._checkLoaded();const h=t.id;if(this.getLayer(h))return void this.fire(new a.ErrorEvent(new Error(`Layer "${h}" already exists on this map.`)));let f;if(t.type==="custom"){if(oo(this,a.validateCustomStyleLayer(t)))return;f=a.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(h,t.source),t=a.clone$1(t),t=a.extend(t,{source:h})),this._validate(a.validateStyle.layer,`layers.${h}`,t,{arrayIndex:-1},l))return;f=a.createStyleLayer(t),this._validateLayer(f),f.setEventedParent(this,{layer:{id:h}})}const x=r?this._order.indexOf(r):this._order.length;if(r&&x===-1)this.fire(new a.ErrorEvent(new Error(`Cannot add layer "${h}" before non-existing layer "${r}".`)));else{if(this._order.splice(x,0,h),this._layerOrderChanged=!0,this._layers[h]=f,this._removedLayers[h]&&f.source&&f.type!=="custom"){const w=this._removedLayers[h];delete this._removedLayers[h],w.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(t,r){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===r)return;const l=this._order.indexOf(t);this._order.splice(l,1);const h=r?this._order.indexOf(r):this._order.length;r&&h===-1?this.fire(new a.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${r}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const r=this._layers[t];if(!r)return void this.fire(new a.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));r.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=r,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],r.onRemove&&r.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,r,l){this._checkLoaded();const h=this.getLayer(t);h?h.minzoom===r&&h.maxzoom===l||(r!=null&&(h.minzoom=r),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new a.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,r,l={}){this._checkLoaded();const h=this.getLayer(t);if(h){if(!a.deepEqual(h.filter,r))return r==null?(h.filter=void 0,void this._updateLayer(h)):void(this._validate(a.validateStyle.filter,`layers.${h.id}.filter`,r,null,l)||(h.filter=a.clone$1(r),this._updateLayer(h)))}else this.fire(new a.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return a.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,r,l,h={}){this._checkLoaded();const f=this.getLayer(t);f?a.deepEqual(f.getLayoutProperty(r),l)||(f.setLayoutProperty(r,l,h),this._updateLayer(f)):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,r){const l=this.getLayer(t);if(l)return l.getLayoutProperty(r);this.fire(new a.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,r,l,h={}){this._checkLoaded();const f=this.getLayer(t);f?a.deepEqual(f.getPaintProperty(r),l)||(f.setPaintProperty(r,l,h)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,r){return this.getLayer(t).getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const l=t.source,h=t.sourceLayer,f=this.sourceCaches[l];if(f===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)));const x=f.getSource().type;x==="geojson"&&h?this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||h?(t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),f.setFeatureState(h,t.id,r)):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,r){this._checkLoaded();const l=t.source,h=this.sourceCaches[l];if(h===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)));const f=h.getSource().type,x=f==="vector"?t.sourceLayer:void 0;f!=="vector"||x?r&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(x,t.id,r):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const r=t.source,l=t.sourceLayer,h=this.sourceCaches[r];if(h!==void 0)return h.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,t.id)):void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=a.mapObject(this.sourceCaches,h=>h.serialize()),r=this._serializeByIds(this._order),l=this.stylesheet;return a.filterObject({version:l.version,name:l.name,metadata:l.metadata,light:l.light,center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,sprite:l.sprite,glyphs:l.glyphs,transition:l.transition,sources:t,layers:r},h=>h!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const r=x=>this._layers[x].type==="fill-extrusion",l={},h=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(r(w)){l[w]=x;for(const S of t){const A=S[w];if(A)for(const k of A)h.push(k)}}}h.sort((x,w)=>w.intersectionZ-x.intersectionZ);const f=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(r(w))for(let S=h.length-1;S>=0;S--){const A=h[S].feature;if(l[A.layer.id]<x)break;f.push(A),h.pop()}else for(const S of t){const A=S[w];if(A)for(const k of A)f.push(k.feature)}}return f}queryRenderedFeatures(t,r,l){r&&r.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",r.filter,null,r);const h={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const w of r.layers){const S=this._layers[w];if(!S)return this.fire(new a.ErrorEvent(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];h[S.source]=!0}}const f=[];r.availableImages=this._availableImages;const x=this._serializedAllLayers();for(const w in this.sourceCaches)r.layers&&!h[w]||f.push(Kt(this.sourceCaches[w],this._layers,x,t,r,l));return this.placement&&f.push(function(w,S,A,k,z,$,Y){const K={},Q=$.queryRenderedSymbols(k),X=[];for(const pe of Object.keys(Q).map(Number))X.push(Y[pe]);X.sort(os);for(const pe of X){const xe=pe.featureIndex.lookupSymbolFeatures(Q[pe.bucketInstanceId],S,pe.bucketIndex,pe.sourceLayerIndex,z.filter,z.layers,z.availableImages,w);for(const re in xe){const fe=K[re]=K[re]||[],Ce=xe[re];Ce.sort((Me,Re)=>{const We=pe.featureSortOrder;if(We){const Oe=We.indexOf(Me.featureIndex);return We.indexOf(Re.featureIndex)-Oe}return Re.featureIndex-Me.featureIndex});for(const Me of Ce)fe.push(Me)}}for(const pe in K)K[pe].forEach(xe=>{const re=xe.feature,fe=A[w[pe].source].getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=fe});return K}(this._layers,x,this.sourceCaches,t,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(t,r){r&&r.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",r.filter,null,r);const l=this.sourceCaches[t];return l?function(h,f){const x=h.getRenderableIds().map(A=>h.getTileByID(A)),w=[],S={};for(let A=0;A<x.length;A++){const k=x[A],z=k.tileID.canonical.key;S[z]||(S[z]=!0,k.querySourceFeatures(w,f))}return w}(l,r):[]}addSourceType(t,r,l){return Vr(t)?l(new Error(`A source type called "${t}" already exists.`)):(((h,f)=>{en[h]=f})(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},l):l(null,null))}getLight(){return this.light.getLight()}setLight(t,r={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const x in t)if(!a.deepEqual(t[x],l[x])){h=!0;break}if(!h)return;const f={now:a.browser.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,r),this.light.updateTransitions(f)}_validate(t,r,l,h,f={}){return(!f||f.validate!==!1)&&oo(this,t.call(a.validateStyle,a.extend({key:r,style:this.serialize(),value:l,styleSpec:a.v8Spec},h)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const l=this.sourceCaches[r];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const r in this.sourceCaches)this.sourceCaches[r].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,r,l,h,f=!1){let x=!1,w=!1;const S={};for(const A of this._order){const k=this._layers[A];if(k.type!=="symbol")continue;if(!S[k.source]){const $=this.sourceCaches[k.source];S[k.source]=$.getRenderableIds(!0).map(Y=>$.getTileByID(Y)).sort((Y,K)=>K.tileID.overscaledZ-Y.tileID.overscaledZ||(Y.tileID.isLessThan(K.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(k,S[k.source],t.center.lng);x=x||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.browser.now(),t.zoom))&&(this.pauseablePlacement=new Ju(t,this.map.terrain,this._order,f,r,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.browser.now()),w=!0),x&&this.pauseablePlacement.placement.setStale()),w||x)for(const A of this._order){const k=this._layers[A];k.type==="symbol"&&this.placement.updateLayerOpacities(k,S[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.browser.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,r,l){this.imageManager.getImages(r.icons,l),this._updateTilesForChangedImages();const h=this.sourceCaches[r.source];h&&h.setDependencies(r.tileID.key,r.type,r.icons)}getGlyphs(t,r,l){this.glyphManager.getGlyphs(r.stacks,l);const h=this.sourceCaches[r.source];h&&h.setDependencies(r.tileID.key,r.type,[""])}getResource(t,r,l){return a.makeRequest(r,l)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,r={}){this._checkLoaded(),t&&this._validate(a.validateStyle.glyphs,"glyphs",t,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,r,l={},h){this._checkLoaded();const f=[{id:t,url:r}],x=[...wt(this.stylesheet.sprite),...f];this._validate(a.validateStyle.sprite,"sprite",x,null,l)||(this.stylesheet.sprite=x,this._loadSprite(f,!0,h))}removeSprite(t){this._checkLoaded();const r=wt(this.stylesheet.sprite);if(r.find(l=>l.id===t)){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;r.splice(r.findIndex(l=>l.id===t),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}else this.fire(new a.ErrorEvent(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return wt(this.stylesheet.sprite)}setSprite(t,r={},l){this._checkLoaded(),t&&this._validate(a.validateStyle.sprite,"sprite",t,null,r)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}}Wn.registerForPluginStateChange=a.registerForPluginStateChange;var Ma=a.createLayout([{name:"a_pos",type:"Int16",components:2}]),ls="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Pa={prelude:Ii(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ii(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ii(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ii(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ii("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ii(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ii(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ii("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ii("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ii("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ii(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ii(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ii(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ii(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ii(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ii(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ii(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ii(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ii(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ii(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ii(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ii(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ii(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ii(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ii(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ii(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ii("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ls),terrainDepth:Ii("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ls),terrainCoords:Ii("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ls)};function Ii(p,t){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/attribute ([\w]+) ([\w]+)/g),h=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=f?f.concat(h):h,w={};return{fragmentSource:p=p.replace(r,(S,A,k,z,$)=>(w[$]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${$}
varying ${k} ${z} ${$};
#else
uniform ${k} ${z} u_${$};
#endif
`:`
#ifdef HAS_UNIFORM_u_${$}
    ${k} ${z} ${$} = u_${$};
#endif
`)),vertexSource:t=t.replace(r,(S,A,k,z,$)=>{const Y=z==="float"?"vec2":"vec4",K=$.match(/color/)?"color":Y;return w[$]?A==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${k} ${Y} a_${$};
varying ${k} ${z} ${$};
#else
uniform ${k} ${z} u_${$};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${k} ${z} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${K}(a_${$}, u_${$}_t);
#else
    ${k} ${z} ${$} = u_${$};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${k} ${Y} a_${$};
#else
uniform ${k} ${z} u_${$};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${k} ${z} ${$} = a_${$};
#else
    ${k} ${z} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${k} ${z} ${$} = unpack_mix_${K}(a_${$}, u_${$}_t);
#else
    ${k} ${z} ${$} = u_${$};
#endif
`}),staticAttributes:l,staticUniforms:x}}class To{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,r,l,h,f,x,w,S,A){this.context=t;let k=this.boundPaintVertexBuffers.length!==h.length;for(let z=0;!k&&z<h.length;z++)this.boundPaintVertexBuffers[z]!==h[z]&&(k=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==l||k||this.boundIndexBuffer!==f||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==A?this.freshBind(r,l,h,f,x,w,S,A):(t.bindVertexArray.set(this.vao),w&&w.bind(),f&&f.dynamicDraw&&f.bind(),S&&S.bind(),A&&A.bind())}freshBind(t,r,l,h,f,x,w,S){const A=t.numAttributes,k=this.context,z=k.gl;this.vao&&this.destroy(),this.vao=k.createVertexArray(),k.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=S,r.enableAttributes(z,t);for(const $ of l)$.enableAttributes(z,t);x&&x.enableAttributes(z,t),w&&w.enableAttributes(z,t),S&&S.enableAttributes(z,t),r.bind(),r.setVertexAttribPointers(z,t,f);for(const $ of l)$.bind(),$.setVertexAttribPointers(z,t,f);x&&(x.bind(),x.setVertexAttribPointers(z,t,f)),h&&h.bind(),w&&(w.bind(),w.setVertexAttribPointers(z,t,f)),S&&(S.bind(),S.setVertexAttribPointers(z,t,f)),k.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function So(p){const t=[];for(let r=0;r<p.length;r++){if(p[r]===null)continue;const l=p[r].split(" ");t.push(l.pop())}return t}class ao{constructor(t,r,l,h,f,x){const w=t.gl;this.program=w.createProgram();const S=So(r.staticAttributes),A=l?l.getBinderAttributes():[],k=S.concat(A),z=Pa.prelude.staticUniforms?So(Pa.prelude.staticUniforms):[],$=r.staticUniforms?So(r.staticUniforms):[],Y=l?l.getBinderUniforms():[],K=z.concat($).concat(Y),Q=[];for(const Me of K)Q.indexOf(Me)<0&&Q.push(Me);const X=l?l.defines():[];f&&X.push("#define OVERDRAW_INSPECTOR;"),x&&X.push("#define TERRAIN3D;");const pe=X.concat(Pa.prelude.fragmentSource,r.fragmentSource).join(`
`),xe=X.concat(Pa.prelude.vertexSource,r.vertexSource).join(`
`),re=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);w.shaderSource(re,pe),w.compileShader(re),w.attachShader(this.program,re);const fe=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);w.shaderSource(fe,xe),w.compileShader(fe),w.attachShader(this.program,fe),this.attributes={};const Ce={};this.numAttributes=k.length;for(let Me=0;Me<this.numAttributes;Me++)k[Me]&&(w.bindAttribLocation(this.program,Me,k[Me]),this.attributes[k[Me]]=Me);w.linkProgram(this.program),w.deleteShader(fe),w.deleteShader(re);for(let Me=0;Me<Q.length;Me++){const Re=Q[Me];if(Re&&!Ce[Re]){const We=w.getUniformLocation(this.program,Re);We&&(Ce[Re]=We)}}this.fixedUniforms=h(t,Ce),this.terrainUniforms=((Me,Re)=>({u_depth:new a.Uniform1i(Me,Re.u_depth),u_terrain:new a.Uniform1i(Me,Re.u_terrain),u_terrain_dim:new a.Uniform1f(Me,Re.u_terrain_dim),u_terrain_matrix:new a.UniformMatrix4f(Me,Re.u_terrain_matrix),u_terrain_unpack:new a.Uniform4f(Me,Re.u_terrain_unpack),u_terrain_exaggeration:new a.Uniform1f(Me,Re.u_terrain_exaggeration)}))(t,Ce),this.binderUniforms=l?l.getUniforms(t,Ce):[]}draw(t,r,l,h,f,x,w,S,A,k,z,$,Y,K,Q,X,pe,xe){const re=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(h),t.setColorMode(f),t.setCullFace(x),S){t.activeTexture.set(re.TEXTURE2),re.bindTexture(re.TEXTURE_2D,S.depthTexture),t.activeTexture.set(re.TEXTURE3),re.bindTexture(re.TEXTURE_2D,S.texture);for(const Ce in this.terrainUniforms)this.terrainUniforms[Ce].set(S[Ce])}for(const Ce in this.fixedUniforms)this.fixedUniforms[Ce].set(w[Ce]);Q&&Q.setUniforms(t,this.binderUniforms,Y,{zoom:K});let fe=0;switch(r){case re.LINES:fe=2;break;case re.TRIANGLES:fe=3;break;case re.LINE_STRIP:fe=1}for(const Ce of $.get()){const Me=Ce.vaos||(Ce.vaos={});(Me[A]||(Me[A]=new To)).bind(t,this,k,Q?Q.getPaintVertexBuffers():[],z,Ce.vertexOffset,X,pe,xe),re.drawElements(r,Ce.primitiveLength*fe,re.UNSIGNED_SHORT,Ce.primitiveOffset*fe*2)}}}function ka(p,t,r){const l=1/ue(r,1,t.transform.tileZoom),h=Math.pow(2,r.tileID.overscaledZ),f=r.tileSize*Math.pow(2,t.transform.tileZoom)/h,x=f*(r.tileID.canonical.x+r.tileID.wrap*h),w=f*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[l,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const Qo=(p,t,r,l)=>{const h=t.style.light,f=h.properties.get("position"),x=[f.x,f.y,f.z],w=function(){var A=new a.ARRAY_TYPE(9);return a.ARRAY_TYPE!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A}();h.properties.get("anchor")==="viewport"&&function(A,k){var z=Math.sin(k),$=Math.cos(k);A[0]=$,A[1]=z,A[2]=0,A[3]=-z,A[4]=$,A[5]=0,A[6]=0,A[7]=0,A[8]=1}(w,-t.transform.angle),function(A,k,z){var $=k[0],Y=k[1],K=k[2];A[0]=$*z[0]+Y*z[3]+K*z[6],A[1]=$*z[1]+Y*z[4]+K*z[7],A[2]=$*z[2]+Y*z[5]+K*z[8]}(x,x,w);const S=h.properties.get("color");return{u_matrix:p,u_lightpos:x,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+r,u_opacity:l}},tc=(p,t,r,l,h,f,x)=>a.extend(Qo(p,t,r,l),ka(f,t,x),{u_height_factor:-Math.pow(2,h.overscaledZ)/x.tileSize/8}),Xc=p=>({u_matrix:p}),za=(p,t,r,l)=>a.extend(Xc(p),ka(r,t,l)),ic=(p,t)=>({u_matrix:p,u_world:t}),al=(p,t,r,l,h)=>a.extend(za(p,t,r,l),{u_world:h}),ea=(p,t,r,l)=>{const h=p.transform;let f,x;if(l.paint.get("circle-pitch-alignment")==="map"){const w=ue(r,1,h.zoom);f=!0,x=[w,w]}else f=!1,x=h.pixelsToGLUnits;return{u_camera_to_center_distance:h.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(t.posMatrix,r,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:x}},nc=(p,t,r)=>{const l=ue(r,1,t.zoom),h=Math.pow(2,t.zoom-r.tileID.overscaledZ),f=r.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:l,u_extrude_scale:[t.pixelsToGLUnits[0]/(l*h),t.pixelsToGLUnits[1]/(l*h)],u_overscale_factor:f}},rc=(p,t,r=1)=>({u_matrix:p,u_color:t,u_overlay:0,u_overlay_scale:r}),ll=p=>({u_matrix:p}),sc=(p,t,r,l)=>({u_matrix:p,u_extrude_scale:ue(t,1,r),u_intensity:l});function oc(p,t){const r=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new a.MercatorCoordinate(0,l/r).toLngLat().lat,new a.MercatorCoordinate(0,(l+1)/r).toLngLat().lat]}const Da=(p,t,r,l)=>{const h=p.transform;return{u_matrix:ta(p,t,r,l),u_ratio:1/ue(t,1,h.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},ac=(p,t,r,l,h)=>a.extend(Da(p,t,r,h),{u_image:0,u_image_height:l}),Eo=(p,t,r,l,h)=>{const f=p.transform,x=Wr(t,f);return{u_matrix:ta(p,t,r,h),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ue(t,1,f.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[x,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},cl=(p,t,r,l,h,f)=>{const x=p.lineAtlas,w=Wr(t,p.transform),S=r.layout.get("line-cap")==="round",A=x.getDash(l.from,S),k=x.getDash(l.to,S),z=A.width*h.fromScale,$=k.width*h.toScale;return a.extend(Da(p,t,r,f),{u_patternscale_a:[w/z,-A.height/2],u_patternscale_b:[w/$,-k.height/2],u_sdfgamma:x.width/(256*Math.min(z,$)*p.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:k.y,u_mix:h.t})};function Wr(p,t){return 1/ue(p,1,t.tileZoom)}function ta(p,t,r,l){return p.translatePosMatrix(l?l.posMatrix:t.tileID.posMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const ul=(p,t,r,l,h)=>{return{u_matrix:p,u_tl_parent:t,u_scale_parent:r,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:(x=h.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(f=h.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:La(h.paint.get("raster-hue-rotate"))};var f,x};function La(p){p*=Math.PI/180;const t=Math.sin(p),r=Math.cos(p);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Ra=(p,t,r,l,h,f,x,w,S,A)=>{const k=h.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:k.cameraToCenterDistance,u_pitch:k.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:k.width/k.height,u_fade_change:h.options.fadeDuration?h.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:x,u_coord_matrix:w,u_is_text:+S,u_pitch_with_map:+l,u_texsize:A,u_texture:0}},Ba=(p,t,r,l,h,f,x,w,S,A,k)=>{const z=h.transform;return a.extend(Ra(p,t,r,l,h,f,x,w,S,A),{u_gamma_scale:l?Math.cos(z._pitch)*z.cameraToCenterDistance:1,u_device_pixel_ratio:h.pixelRatio,u_is_halo:+k})},Ao=(p,t,r,l,h,f,x,w,S,A)=>a.extend(Ba(p,t,r,l,h,f,x,w,!0,S,!0),{u_texsize_icon:A,u_texture_icon:1}),Io=(p,t,r)=>({u_matrix:p,u_opacity:t,u_color:r}),hl=(p,t,r,l,h,f)=>a.extend(function(x,w,S,A){const k=S.imageManager.getPattern(x.from.toString()),z=S.imageManager.getPattern(x.to.toString()),{width:$,height:Y}=S.imageManager.getPixelSize(),K=Math.pow(2,A.tileID.overscaledZ),Q=A.tileSize*Math.pow(2,S.transform.tileZoom)/K,X=Q*(A.tileID.canonical.x+A.tileID.wrap*K),pe=Q*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[$,Y],u_mix:w.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/ue(A,1,S.transform.tileZoom),u_pixel_coord_upper:[X>>16,pe>>16],u_pixel_coord_lower:[65535&X,65535&pe]}}(l,f,r,h),{u_matrix:p,u_opacity:t}),Hr={fillExtrusion:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_lightpos:new a.Uniform3f(p,t.u_lightpos),u_lightintensity:new a.Uniform1f(p,t.u_lightintensity),u_lightcolor:new a.Uniform3f(p,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(p,t.u_vertical_gradient),u_opacity:new a.Uniform1f(p,t.u_opacity)}),fillExtrusionPattern:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_lightpos:new a.Uniform3f(p,t.u_lightpos),u_lightintensity:new a.Uniform1f(p,t.u_lightintensity),u_lightcolor:new a.Uniform3f(p,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(p,t.u_vertical_gradient),u_height_factor:new a.Uniform1f(p,t.u_height_factor),u_image:new a.Uniform1i(p,t.u_image),u_texsize:new a.Uniform2f(p,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(p,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(p,t.u_scale),u_fade:new a.Uniform1f(p,t.u_fade),u_opacity:new a.Uniform1f(p,t.u_opacity)}),fill:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix)}),fillPattern:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_image:new a.Uniform1i(p,t.u_image),u_texsize:new a.Uniform2f(p,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(p,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(p,t.u_scale),u_fade:new a.Uniform1f(p,t.u_fade)}),fillOutline:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_world:new a.Uniform2f(p,t.u_world)}),fillOutlinePattern:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_world:new a.Uniform2f(p,t.u_world),u_image:new a.Uniform1i(p,t.u_image),u_texsize:new a.Uniform2f(p,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(p,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(p,t.u_scale),u_fade:new a.Uniform1f(p,t.u_fade)}),circle:(p,t)=>({u_camera_to_center_distance:new a.Uniform1f(p,t.u_camera_to_center_distance),u_scale_with_map:new a.Uniform1i(p,t.u_scale_with_map),u_pitch_with_map:new a.Uniform1i(p,t.u_pitch_with_map),u_extrude_scale:new a.Uniform2f(p,t.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(p,t.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(p,t.u_matrix)}),collisionBox:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_camera_to_center_distance:new a.Uniform1f(p,t.u_camera_to_center_distance),u_pixels_to_tile_units:new a.Uniform1f(p,t.u_pixels_to_tile_units),u_extrude_scale:new a.Uniform2f(p,t.u_extrude_scale),u_overscale_factor:new a.Uniform1f(p,t.u_overscale_factor)}),collisionCircle:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_inv_matrix:new a.UniformMatrix4f(p,t.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(p,t.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(p,t.u_viewport_size)}),debug:(p,t)=>({u_color:new a.UniformColor(p,t.u_color),u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_overlay:new a.Uniform1i(p,t.u_overlay),u_overlay_scale:new a.Uniform1f(p,t.u_overlay_scale)}),clippingMask:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix)}),heatmap:(p,t)=>({u_extrude_scale:new a.Uniform1f(p,t.u_extrude_scale),u_intensity:new a.Uniform1f(p,t.u_intensity),u_matrix:new a.UniformMatrix4f(p,t.u_matrix)}),heatmapTexture:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_world:new a.Uniform2f(p,t.u_world),u_image:new a.Uniform1i(p,t.u_image),u_color_ramp:new a.Uniform1i(p,t.u_color_ramp),u_opacity:new a.Uniform1f(p,t.u_opacity)}),hillshade:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_image:new a.Uniform1i(p,t.u_image),u_latrange:new a.Uniform2f(p,t.u_latrange),u_light:new a.Uniform2f(p,t.u_light),u_shadow:new a.UniformColor(p,t.u_shadow),u_highlight:new a.UniformColor(p,t.u_highlight),u_accent:new a.UniformColor(p,t.u_accent)}),hillshadePrepare:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_image:new a.Uniform1i(p,t.u_image),u_dimension:new a.Uniform2f(p,t.u_dimension),u_zoom:new a.Uniform1f(p,t.u_zoom),u_unpack:new a.Uniform4f(p,t.u_unpack)}),line:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_ratio:new a.Uniform1f(p,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(p,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(p,t.u_units_to_pixels)}),lineGradient:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_ratio:new a.Uniform1f(p,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(p,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(p,t.u_units_to_pixels),u_image:new a.Uniform1i(p,t.u_image),u_image_height:new a.Uniform1f(p,t.u_image_height)}),linePattern:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_texsize:new a.Uniform2f(p,t.u_texsize),u_ratio:new a.Uniform1f(p,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(p,t.u_device_pixel_ratio),u_image:new a.Uniform1i(p,t.u_image),u_units_to_pixels:new a.Uniform2f(p,t.u_units_to_pixels),u_scale:new a.Uniform3f(p,t.u_scale),u_fade:new a.Uniform1f(p,t.u_fade)}),lineSDF:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_ratio:new a.Uniform1f(p,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(p,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(p,t.u_units_to_pixels),u_patternscale_a:new a.Uniform2f(p,t.u_patternscale_a),u_patternscale_b:new a.Uniform2f(p,t.u_patternscale_b),u_sdfgamma:new a.Uniform1f(p,t.u_sdfgamma),u_image:new a.Uniform1i(p,t.u_image),u_tex_y_a:new a.Uniform1f(p,t.u_tex_y_a),u_tex_y_b:new a.Uniform1f(p,t.u_tex_y_b),u_mix:new a.Uniform1f(p,t.u_mix)}),raster:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_tl_parent:new a.Uniform2f(p,t.u_tl_parent),u_scale_parent:new a.Uniform1f(p,t.u_scale_parent),u_buffer_scale:new a.Uniform1f(p,t.u_buffer_scale),u_fade_t:new a.Uniform1f(p,t.u_fade_t),u_opacity:new a.Uniform1f(p,t.u_opacity),u_image0:new a.Uniform1i(p,t.u_image0),u_image1:new a.Uniform1i(p,t.u_image1),u_brightness_low:new a.Uniform1f(p,t.u_brightness_low),u_brightness_high:new a.Uniform1f(p,t.u_brightness_high),u_saturation_factor:new a.Uniform1f(p,t.u_saturation_factor),u_contrast_factor:new a.Uniform1f(p,t.u_contrast_factor),u_spin_weights:new a.Uniform3f(p,t.u_spin_weights)}),symbolIcon:(p,t)=>({u_is_size_zoom_constant:new a.Uniform1i(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(p,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(p,t.u_size_t),u_size:new a.Uniform1f(p,t.u_size),u_camera_to_center_distance:new a.Uniform1f(p,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(p,t.u_pitch),u_rotate_symbol:new a.Uniform1i(p,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(p,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(p,t.u_fade_change),u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(p,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(p,t.u_coord_matrix),u_is_text:new a.Uniform1i(p,t.u_is_text),u_pitch_with_map:new a.Uniform1i(p,t.u_pitch_with_map),u_texsize:new a.Uniform2f(p,t.u_texsize),u_texture:new a.Uniform1i(p,t.u_texture)}),symbolSDF:(p,t)=>({u_is_size_zoom_constant:new a.Uniform1i(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(p,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(p,t.u_size_t),u_size:new a.Uniform1f(p,t.u_size),u_camera_to_center_distance:new a.Uniform1f(p,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(p,t.u_pitch),u_rotate_symbol:new a.Uniform1i(p,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(p,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(p,t.u_fade_change),u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(p,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(p,t.u_coord_matrix),u_is_text:new a.Uniform1i(p,t.u_is_text),u_pitch_with_map:new a.Uniform1i(p,t.u_pitch_with_map),u_texsize:new a.Uniform2f(p,t.u_texsize),u_texture:new a.Uniform1i(p,t.u_texture),u_gamma_scale:new a.Uniform1f(p,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(p,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(p,t.u_is_halo)}),symbolTextAndIcon:(p,t)=>({u_is_size_zoom_constant:new a.Uniform1i(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(p,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(p,t.u_size_t),u_size:new a.Uniform1f(p,t.u_size),u_camera_to_center_distance:new a.Uniform1f(p,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(p,t.u_pitch),u_rotate_symbol:new a.Uniform1i(p,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(p,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(p,t.u_fade_change),u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(p,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(p,t.u_coord_matrix),u_is_text:new a.Uniform1i(p,t.u_is_text),u_pitch_with_map:new a.Uniform1i(p,t.u_pitch_with_map),u_texsize:new a.Uniform2f(p,t.u_texsize),u_texsize_icon:new a.Uniform2f(p,t.u_texsize_icon),u_texture:new a.Uniform1i(p,t.u_texture),u_texture_icon:new a.Uniform1i(p,t.u_texture_icon),u_gamma_scale:new a.Uniform1f(p,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(p,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(p,t.u_is_halo)}),background:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_opacity:new a.Uniform1f(p,t.u_opacity),u_color:new a.UniformColor(p,t.u_color)}),backgroundPattern:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_opacity:new a.Uniform1f(p,t.u_opacity),u_image:new a.Uniform1i(p,t.u_image),u_pattern_tl_a:new a.Uniform2f(p,t.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(p,t.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(p,t.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(p,t.u_pattern_br_b),u_texsize:new a.Uniform2f(p,t.u_texsize),u_mix:new a.Uniform1f(p,t.u_mix),u_pattern_size_a:new a.Uniform2f(p,t.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(p,t.u_pattern_size_b),u_scale_a:new a.Uniform1f(p,t.u_scale_a),u_scale_b:new a.Uniform1f(p,t.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(p,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(p,t.u_tile_units_to_pixels)}),terrain:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_texture:new a.Uniform1i(p,t.u_texture),u_ele_delta:new a.Uniform1f(p,t.u_ele_delta)}),terrainDepth:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_ele_delta:new a.Uniform1f(p,t.u_ele_delta)}),terrainCoords:(p,t)=>({u_matrix:new a.UniformMatrix4f(p,t.u_matrix),u_texture:new a.Uniform1i(p,t.u_texture),u_terrain_coords_id:new a.Uniform1f(p,t.u_terrain_coords_id),u_ele_delta:new a.Uniform1f(p,t.u_ele_delta)})};class Xr{constructor(t,r,l){this.context=t;const h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const lc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fi{constructor(t,r,l,h){this.length=r.length,this.attributes=l,this.itemSize=r.bytesPerElement,this.dynamicDraw=h,this.context=t;const f=t.gl;this.buffer=f.createBuffer(),t.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let l=0;l<this.attributes.length;l++){const h=r.attributes[this.attributes[l].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,r,l){for(let h=0;h<this.attributes.length;h++){const f=this.attributes[h],x=r.attributes[f.name];x!==void 0&&t.vertexAttribPointer(x,f.components,t[lc[f.type]],!1,this.itemSize,f.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ci=new WeakMap;function ia(p){if(Ci.has(p))return Ci.get(p);{const t=p.getParameter(p.VERSION).startsWith("WebGL 2.0");return Ci.set(p,t),t}}class gi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pl extends gi{getDefault(){return a.Color.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class cc extends gi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class uc extends gi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class dl extends gi{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class hc extends gi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Kc extends gi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class ln extends gi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class pc extends gi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Co extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Yc extends gi{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class dc extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class cs extends gi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Jc extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class fl extends gi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Fa extends gi{getDefault(){return a.Color.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ml extends gi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class gl extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class Mo extends gi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Pr extends gi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Qc extends gi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class kr extends gi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Po extends gi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class fc extends gi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Kr extends gi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Gs extends gi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class _l extends gi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ji extends gi{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ci extends gi{getDefault(){return null}set(t){var r;if(t===this.current&&!this.dirty)return;const l=this.gl;ia(l)?l.bindVertexArray(t):(r=l.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class na extends gi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Qu extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class yl extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ko extends gi{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class eh extends ko{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class th extends ko{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class mc extends ko{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class vl{constructor(t,r,l,h,f){this.context=t,this.width=r,this.height=l;const x=t.gl,w=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new eh(t,w),h)this.depthAttachment=f?new mc(t,w):new th(t,w);else if(f)throw new Error("Stencil cannot be setted without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,r=this.colorAttachment.get();if(r&&t.deleteTexture(r),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class Oi{constructor(t,r,l){this.blendFunction=t,this.blendColor=r,this.mask=l}}Oi.Replace=[1,0],Oi.disabled=new Oi(Oi.Replace,a.Color.transparent,[!1,!1,!1,!1]),Oi.unblended=new Oi(Oi.Replace,a.Color.transparent,[!0,!0,!0,!0]),Oi.alphaBlended=new Oi([1,771],a.Color.transparent,[!0,!0,!0,!0]);class xl{constructor(t){var r,l;if(this.gl=t,this.clearColor=new pl(this),this.clearDepth=new cc(this),this.clearStencil=new uc(this),this.colorMask=new dl(this),this.depthMask=new hc(this),this.stencilMask=new Kc(this),this.stencilFunc=new ln(this),this.stencilOp=new pc(this),this.stencilTest=new Co(this),this.depthRange=new Yc(this),this.depthTest=new dc(this),this.depthFunc=new cs(this),this.blend=new Jc(this),this.blendFunc=new fl(this),this.blendColor=new Fa(this),this.blendEquation=new ml(this),this.cullFace=new gl(this),this.cullFaceSide=new Mo(this),this.frontFace=new Pr(this),this.program=new Qc(this),this.activeTexture=new kr(this),this.viewport=new Po(this),this.bindFramebuffer=new fc(this),this.bindRenderbuffer=new Kr(this),this.bindTexture=new Gs(this),this.bindVertexBuffer=new _l(this),this.bindElementBuffer=new ji(this),this.bindVertexArray=new ci(this),this.pixelStoreUnpack=new na(this),this.pixelStoreUnpackPremultiplyAlpha=new Qu(this),this.pixelStoreUnpackFlipY=new yl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),ia(t)){this.HALF_FLOAT=t.HALF_FLOAT;const h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=t.RGBA16F)!==null&&r!==void 0?r:h==null?void 0:h.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:h==null?void 0:h.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h==null?void 0:h.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r){return new Xr(this,t,r)}createVertexBuffer(t,r,l){return new Fi(this,t,r,l)}createRenderbuffer(t,r,l){const h=this.gl,f=h.createRenderbuffer();return this.bindRenderbuffer.set(f),h.renderbufferStorage(h.RENDERBUFFER,t,r,l),this.bindRenderbuffer.set(null),f}createFramebuffer(t,r,l,h){return new vl(this,t,r,l,h)}clear({color:t,depth:r,stencil:l}){const h=this.gl;let f=0;t&&(f|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(f|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),l!==void 0&&(f|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(f)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){a.deepEqual(t.blendFunction,Oi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return ia(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var r;return ia(this.gl)?this.gl.deleteVertexArray(t):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class ti{constructor(t,r,l){this.func=t,this.mask=r,this.range=l}}ti.ReadOnly=!1,ti.ReadWrite=!0,ti.disabled=new ti(519,ti.ReadOnly,[0,1]);const ra=7680;class Ui{constructor(t,r,l,h,f,x){this.test=t,this.ref=r,this.mask=l,this.fail=h,this.depthFail=f,this.pass=x}}Ui.disabled=new Ui({func:519,mask:0},0,0,ra,ra,ra);class Ni{constructor(t,r,l){this.enable=t,this.mode=r,this.frontFace=l}}let lo;function Oa(p,t,r,l,h,f,x){const w=p.context,S=w.gl,A=p.useProgram("collisionBox"),k=[];let z=0,$=0;for(let re=0;re<l.length;re++){const fe=l[re],Ce=t.getTile(fe),Me=Ce.getBucket(r);if(!Me)continue;let Re=fe.posMatrix;h[0]===0&&h[1]===0||(Re=p.translatePosMatrix(fe.posMatrix,Ce,h,f));const We=x?Me.textCollisionBox:Me.iconCollisionBox,Oe=Me.collisionCircleArray;if(Oe.length>0){const tt=a.create(),vt=Re;a.mul(tt,Me.placementInvProjMatrix,p.transform.glCoordMatrix),a.mul(tt,tt,Me.placementViewportMatrix),k.push({circleArray:Oe,circleOffset:$,transform:vt,invTransform:tt,coord:fe}),z+=Oe.length/4,$=z}We&&A.draw(w,S.LINES,ti.disabled,Ui.disabled,p.colorModeForRenderPass(),Ni.disabled,nc(Re,p.transform,Ce),p.style.map.terrain&&p.style.map.terrain.getTerrainData(fe),r.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,p.transform.zoom,null,null,We.collisionVertexBuffer)}if(!x||!k.length)return;const Y=p.useProgram("collisionCircle"),K=new a.CollisionCircleLayoutArray;K.resize(4*z),K._trim();let Q=0;for(const re of k)for(let fe=0;fe<re.circleArray.length/4;fe++){const Ce=4*fe,Me=re.circleArray[Ce+0],Re=re.circleArray[Ce+1],We=re.circleArray[Ce+2],Oe=re.circleArray[Ce+3];K.emplace(Q++,Me,Re,We,Oe,0),K.emplace(Q++,Me,Re,We,Oe,1),K.emplace(Q++,Me,Re,We,Oe,2),K.emplace(Q++,Me,Re,We,Oe,3)}(!lo||lo.length<2*z)&&(lo=function(re){const fe=2*re,Ce=new a.QuadTriangleArray;Ce.resize(fe),Ce._trim();for(let Me=0;Me<fe;Me++){const Re=6*Me;Ce.uint16[Re+0]=4*Me+0,Ce.uint16[Re+1]=4*Me+1,Ce.uint16[Re+2]=4*Me+2,Ce.uint16[Re+3]=4*Me+2,Ce.uint16[Re+4]=4*Me+3,Ce.uint16[Re+5]=4*Me+0}return Ce}(z));const X=w.createIndexBuffer(lo,!0),pe=w.createVertexBuffer(K,a.collisionCircleLayout.members,!0);for(const re of k){const fe={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(xe=p.transform).cameraToCenterDistance,u_viewport_size:[xe.width,xe.height]};Y.draw(w,S.TRIANGLES,ti.disabled,Ui.disabled,p.colorModeForRenderPass(),Ni.disabled,fe,p.style.map.terrain&&p.style.map.terrain.getTerrainData(re.coord),r.id,pe,X,a.SegmentVector.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,p.transform.zoom,null,null,null)}var xe;pe.destroy(),X.destroy()}Ni.disabled=new Ni(!1,1029,2305),Ni.backCCW=new Ni(!0,1029,2305);const Ua=a.identity(new Float32Array(16));function gc(p,t,r,l,h,f){const{horizontalAlign:x,verticalAlign:w}=a.getAnchorAlignment(p);return new a.Point((-(x-.5)*t/h+l[0])*f,(-(w-.5)*r/h+l[1])*f)}function _c(p,t,r,l,h,f,x,w,S,A,k){const z=p.text.placedSymbolArray,$=p.text.dynamicLayoutVertexArray,Y=p.icon.dynamicLayoutVertexArray,K={};$.clear();for(let Q=0;Q<z.length;Q++){const X=z.get(Q),pe=X.hidden||!X.crossTileID||p.allowVerticalPlacement&&!X.placedOrientation?null:l[X.crossTileID];if(pe){const xe=new a.Point(X.anchorX,X.anchorY),re=St(xe,r?x:f,k),fe=ir(h.cameraToCenterDistance,re.signedDistanceFromCamera);let Ce=a.evaluateSizeForFeature(p.textSizeData,S,X)*fe/a.ONE_EM;r&&(Ce*=p.tilePixelRatio/w);const{width:Me,height:Re,anchor:We,textOffset:Oe,textBoxScale:tt}=pe,vt=gc(We,Me,Re,Oe,tt,Ce),Qt=r?St(xe.add(vt),f,k).point:re.point.add(t?vt.rotate(-h.angle):vt),rt=p.allowVerticalPlacement&&X.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let It=0;It<X.numGlyphs;It++)a.addDynamicAttributes($,Qt,rt);A&&X.associatedIconIndex>=0&&(K[X.associatedIconIndex]={shiftedAnchor:Qt,angle:rt})}else j(X.numGlyphs,$)}if(A){Y.clear();const Q=p.icon.placedSymbolArray;for(let X=0;X<Q.length;X++){const pe=Q.get(X);if(pe.hidden)j(pe.numGlyphs,Y);else{const xe=K[X];if(xe)for(let re=0;re<pe.numGlyphs;re++)a.addDynamicAttributes(Y,xe.shiftedAnchor,xe.angle);else j(pe.numGlyphs,Y)}}p.icon.dynamicLayoutVertexBuffer.updateData(Y)}p.text.dynamicLayoutVertexBuffer.updateData($)}function eu(p,t,r){return r.iconsInText&&t?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function gr(p,t,r,l,h,f,x,w,S,A,k,z){const $=p.context,Y=$.gl,K=p.transform,Q=w==="map",X=S==="map",pe=w!=="viewport"&&r.layout.get("symbol-placement")!=="point",xe=Q&&!X&&!pe,re=!r.layout.get("symbol-sort-key").isConstant();let fe=!1;const Ce=p.depthModeForSublayer(0,ti.ReadOnly),Me=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Re=[];for(const We of l){const Oe=t.getTile(We),tt=Oe.getBucket(r);if(!tt)continue;const vt=h?tt.text:tt.icon;if(!vt||!vt.segments.get().length||!vt.hasVisibleVertices)continue;const Qt=vt.programConfigurations.get(r.id),rt=h||tt.sdfIcons,It=h?tt.textSizeData:tt.iconSizeData,gt=X||K.pitch!==0,$i=p.useProgram(eu(rt,h,tt),Qt),ii=a.evaluateSizeForZoom(It,K.zoom),Ot=p.style.map.terrain&&p.style.map.terrain.getTerrainData(We);let Pt,Vi,ni,xr,Ln=[0,0],cn=null;if(h)Vi=Oe.glyphAtlasTexture,ni=Y.LINEAR,Pt=Oe.glyphAtlasTexture.size,tt.iconsInText&&(Ln=Oe.imageAtlasTexture.size,cn=Oe.imageAtlasTexture,xr=gt||p.options.rotating||p.options.zooming||It.kind==="composite"||It.kind==="camera"?Y.LINEAR:Y.NEAREST);else{const un=r.layout.get("icon-size").constantOr(0)!==1||tt.iconsNeedLinear;Vi=Oe.imageAtlasTexture,ni=rt||p.options.rotating||p.options.zooming||un||gt?Y.LINEAR:Y.NEAREST,Pt=Oe.imageAtlasTexture.size}const Nn=ue(Oe,1,p.transform.zoom),$n=gn(We.posMatrix,X,Q,p.transform,Nn),Fs=_n(We.posMatrix,X,Q,p.transform,Nn),Xs=Me&&tt.hasTextData(),bs=r.layout.get("icon-text-fit")!=="none"&&Xs&&tt.hasIconData();if(pe){const un=p.style.map.terrain?(In,Ji)=>p.style.map.terrain.getElevation(We,In,Ji):null,wn=r.layout.get("text-rotation-alignment")==="map";Gn(tt,We.posMatrix,p,h,$n,Fs,X,A,wn,un)}const No=p.translatePosMatrix(We.posMatrix,Oe,f,x),Ks=pe||h&&Me||bs?Ua:$n,_i=p.translatePosMatrix(Fs,Oe,f,x,!0),Yi=rt&&r.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Rn;Rn=rt?tt.iconsInText?Ao(It.kind,ii,xe,X,p,No,Ks,_i,Pt,Ln):Ba(It.kind,ii,xe,X,p,No,Ks,_i,h,Pt,!0):Ra(It.kind,ii,xe,X,p,No,Ks,_i,h,Pt);const br={program:$i,buffers:vt,uniformValues:Rn,atlasTexture:Vi,atlasTextureIcon:cn,atlasInterpolation:ni,atlasInterpolationIcon:xr,isSDF:rt,hasHalo:Yi};if(re&&tt.canOverlap){fe=!0;const un=vt.segments.get();for(const wn of un)Re.push({segments:new a.SegmentVector([wn]),sortKey:wn.sortKey,state:br,terrainData:Ot})}else Re.push({segments:vt.segments,sortKey:0,state:br,terrainData:Ot})}fe&&Re.sort((We,Oe)=>We.sortKey-Oe.sortKey);for(const We of Re){const Oe=We.state;if($.activeTexture.set(Y.TEXTURE0),Oe.atlasTexture.bind(Oe.atlasInterpolation,Y.CLAMP_TO_EDGE),Oe.atlasTextureIcon&&($.activeTexture.set(Y.TEXTURE1),Oe.atlasTextureIcon&&Oe.atlasTextureIcon.bind(Oe.atlasInterpolationIcon,Y.CLAMP_TO_EDGE)),Oe.isSDF){const tt=Oe.uniformValues;Oe.hasHalo&&(tt.u_is_halo=1,zo(Oe.buffers,We.segments,r,p,Oe.program,Ce,k,z,tt,We.terrainData)),tt.u_is_halo=0}zo(Oe.buffers,We.segments,r,p,Oe.program,Ce,k,z,Oe.uniformValues,We.terrainData)}}function zo(p,t,r,l,h,f,x,w,S,A){const k=l.context;h.draw(k,k.gl.TRIANGLES,f,x,w,Ni.disabled,S,A,r.id,p.layoutVertexBuffer,p.indexBuffer,t,r.paint,l.transform.zoom,p.programConfigurations.get(r.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function co(p,t,r,l,h){if(!r||!l||!l.imageAtlas)return;const f=l.imageAtlas.patternPositions;let x=f[r.to.toString()],w=f[r.from.toString()];if(!x||!w){const S=h.getPaintProperty(t);x=f[S],w=f[S]}x&&w&&p.setConstantPatternPositions(x,w)}function bl(p,t,r,l,h,f,x){const w=p.context.gl,S="fill-pattern",A=r.paint.get(S),k=A&&A.constantOr(1),z=r.getCrossfadeParameters();let $,Y,K,Q,X;x?(Y=k&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=w.LINES):(Y=k?"fillPattern":"fill",$=w.TRIANGLES);const pe=A.constantOr(null);for(const xe of l){const re=t.getTile(xe);if(k&&!re.patternsLoaded())continue;const fe=re.getBucket(r);if(!fe)continue;const Ce=fe.programConfigurations.get(r.id),Me=p.useProgram(Y,Ce),Re=p.style.map.terrain&&p.style.map.terrain.getTerrainData(xe);k&&(p.context.activeTexture.set(w.TEXTURE0),re.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),Ce.updatePaintBuffers(z)),co(Ce,S,pe,re,r);const We=Re?xe:null,Oe=p.translatePosMatrix(We?We.posMatrix:xe.posMatrix,re,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(x){Q=fe.indexBuffer2,X=fe.segments2;const tt=[w.drawingBufferWidth,w.drawingBufferHeight];K=Y==="fillOutlinePattern"&&k?al(Oe,p,z,re,tt):ic(Oe,tt)}else Q=fe.indexBuffer,X=fe.segments,K=k?za(Oe,p,z,re):Xc(Oe);Me.draw(p.context,$,h,p.stencilModeForClipping(xe),f,Ni.disabled,K,Re,r.id,fe.layoutVertexBuffer,Q,X,r.paint,p.transform.zoom,Ce)}}function Na(p,t,r,l,h,f,x){const w=p.context,S=w.gl,A="fill-extrusion-pattern",k=r.paint.get(A),z=k.constantOr(1),$=r.getCrossfadeParameters(),Y=r.paint.get("fill-extrusion-opacity"),K=k.constantOr(null);for(const Q of l){const X=t.getTile(Q),pe=X.getBucket(r);if(!pe)continue;const xe=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Q),re=pe.programConfigurations.get(r.id),fe=p.useProgram(z?"fillExtrusionPattern":"fillExtrusion",re);z&&(p.context.activeTexture.set(S.TEXTURE0),X.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),re.updatePaintBuffers($)),co(re,A,K,X,r);const Ce=p.translatePosMatrix(Q.posMatrix,X,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Me=r.paint.get("fill-extrusion-vertical-gradient"),Re=z?tc(Ce,p,Me,Y,Q,$,X):Qo(Ce,p,Me,Y);fe.draw(w,w.gl.TRIANGLES,h,f,x,Ni.backCCW,Re,xe,r.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,r.paint,p.transform.zoom,re,p.style.map.terrain&&pe.centroidVertexBuffer)}}function wl(p,t,r,l,h,f,x){const w=p.context,S=w.gl,A=r.fbo;if(!A)return;const k=p.useProgram("hillshade"),z=p.style.map.terrain&&p.style.map.terrain.getTerrainData(t);w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,A.colorAttachment.get()),k.draw(w,S.TRIANGLES,h,f,x,Ni.disabled,(($,Y,K,Q)=>{const X=K.paint.get("hillshade-shadow-color"),pe=K.paint.get("hillshade-highlight-color"),xe=K.paint.get("hillshade-accent-color");let re=K.paint.get("hillshade-illumination-direction")*(Math.PI/180);K.paint.get("hillshade-illumination-anchor")==="viewport"&&(re-=$.transform.angle);const fe=!$.options.moving;return{u_matrix:Q?Q.posMatrix:$.transform.calculatePosMatrix(Y.tileID.toUnwrapped(),fe),u_image:0,u_latrange:oc(0,Y.tileID),u_light:[K.paint.get("hillshade-exaggeration"),re],u_shadow:X,u_highlight:pe,u_accent:xe}})(p,r,l,z?t:null),z,l.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function yc(p,t,r,l,h,f){const x=p.context,w=x.gl,S=t.dem;if(S&&S.data){const A=S.dim,k=S.stride,z=S.getPixels();if(x.activeTexture.set(w.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||p.getTileTexture(k),t.demTexture){const Y=t.demTexture;Y.update(z,{premultiply:!1}),Y.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else t.demTexture=new Nt(x,z,w.RGBA,{premultiply:!1}),t.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);x.activeTexture.set(w.TEXTURE0);let $=t.fbo;if(!$){const Y=new Nt(x,{width:A,height:A,data:null},w.RGBA);Y.bind(w.LINEAR,w.CLAMP_TO_EDGE),$=t.fbo=x.createFramebuffer(A,A,!0,!1),$.colorAttachment.set(Y.texture)}x.bindFramebuffer.set($.framebuffer),x.viewport.set([0,0,A,A]),p.useProgram("hillshadePrepare").draw(x,w.TRIANGLES,l,h,f,Ni.disabled,((Y,K)=>{const Q=K.stride,X=a.create();return a.ortho(X,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(X,X,[0,-a.EXTENT,0]),{u_matrix:X,u_image:1,u_dimension:[Q,Q],u_zoom:Y.overscaledZ,u_unpack:K.getUnpackVector()}})(t.tileID,S),null,r.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function ih(p,t,r,l,h,f){const x=l.paint.get("raster-fade-duration");if(!f&&x>0){const w=a.browser.now(),S=(w-p.timeAdded)/x,A=t?(w-t.timeAdded)/x:-1,k=r.getSource(),z=h.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),$=!t||Math.abs(t.tileID.overscaledZ-z)>Math.abs(p.tileID.overscaledZ-z),Y=$&&p.refreshedUponExpiration?1:a.clamp($?S:1-A,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),t?{opacity:1,mix:1-Y}:{opacity:Y,mix:0}}return{opacity:1,mix:0}}const tu=new a.Color(1,0,0,1),xn=new a.Color(0,1,0,1),us=new a.Color(0,0,1,1),hs=new a.Color(1,0,1,1),vc=new a.Color(0,1,1,1);function sa(p,t,r,l){rr(p,0,t+r/2,p.transform.width,r,l)}function Tl(p,t,r,l){rr(p,t-r/2,0,r,p.transform.height,l)}function rr(p,t,r,l,h,f){const x=p.context,w=x.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*p.pixelRatio,r*p.pixelRatio,l*p.pixelRatio,h*p.pixelRatio),x.clear({color:f}),w.disable(w.SCISSOR_TEST)}function uo(p,t,r){const l=p.context,h=l.gl,f=r.posMatrix,x=p.useProgram("debug"),w=ti.disabled,S=Ui.disabled,A=p.colorModeForRenderPass(),k="$debug",z=p.style.map.terrain&&p.style.map.terrain.getTerrainData(r);l.activeTexture.set(h.TEXTURE0);const $=t.getTileByID(r.key).latestRawTileData,Y=Math.floor(($&&$.byteLength||0)/1024),K=t.getTile(r).tileSize,Q=512/Math.min(K,512)*(r.overscaledZ/p.transform.zoom)*.5;let X=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(X+=` => ${r.overscaledZ}`),function(pe,xe){pe.initDebugOverlayCanvas();const re=pe.debugOverlayCanvas,fe=pe.context.gl,Ce=pe.debugOverlayCanvas.getContext("2d");Ce.clearRect(0,0,re.width,re.height),Ce.shadowColor="white",Ce.shadowBlur=2,Ce.lineWidth=1.5,Ce.strokeStyle="white",Ce.textBaseline="top",Ce.font="bold 36px Open Sans, sans-serif",Ce.fillText(xe,5,5),Ce.strokeText(xe,5,5),pe.debugOverlayTexture.update(re),pe.debugOverlayTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)}(p,`${X} ${Y}kB`),x.draw(l,h.TRIANGLES,w,S,Oi.alphaBlended,Ni.disabled,rc(f,a.Color.transparent,Q),null,k,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),x.draw(l,h.LINE_STRIP,w,S,A,Ni.disabled,rc(f,a.Color.red),z,k,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function Sl(p,t,r){const l=p.context,h=l.gl,f=p.colorModeForRenderPass(),x=new ti(h.LEQUAL,ti.ReadWrite,p.depthRangeFor3D),w=p.useProgram("terrain"),S=t.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,p.width,p.height]);for(const A of r){const k=p.renderToTexture.getTexture(A),z=t.getTerrainData(A.tileID);l.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,k.texture);const $={u_matrix:p.transform.calculatePosMatrix(A.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(p.transform.zoom)};w.draw(l,h.TRIANGLES,x,Ui.disabled,f,Ni.backCCW,$,z,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}}class iu{constructor(t,r){this.context=new xl(t),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.create(),renderTime:0},this.setup(),this.numSublayers=hi.maxUnderzooming+hi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new yn}resize(t,r,l){if(this.width=Math.floor(t*l),this.height=Math.floor(r*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const t=this.context,r=new a.PosArray;r.emplaceBack(0,0),r.emplaceBack(a.EXTENT,0),r.emplaceBack(0,a.EXTENT),r.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(r,Ma.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const l=new a.PosArray;l.emplaceBack(0,0),l.emplaceBack(a.EXTENT,0),l.emplaceBack(0,a.EXTENT),l.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=t.createVertexBuffer(l,Ma.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const h=new a.RasterBoundsArray;h.emplaceBack(0,0,0,0),h.emplaceBack(a.EXTENT,0,a.EXTENT,0),h.emplaceBack(0,a.EXTENT,0,a.EXTENT),h.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(h,on.members),this.rasterBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const f=new a.PosArray;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,Ma.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const x=new a.LineStripIndexArray;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(x);const w=new a.TriangleIndexArray;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(w);const S=this.context.gl;this.stencilClearMode=new Ui({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)}clearStencil(){const t=this.context,r=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=a.create();a.ortho(l,0,this.width,this.height,0,0,1),a.scale(l,l,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,r.TRIANGLES,ti.disabled,this.stencilClearMode,Oi.disabled,Ni.disabled,ll(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,r){if(this.currentStencilSource===t.source||!t.isTileClipped()||!r||!r.length)return;this.currentStencilSource=t.source;const l=this.context,h=l.gl;this.nextStencilID+r.length>256&&this.clearStencil(),l.setColorMode(Oi.disabled),l.setDepthMode(ti.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of r){const w=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,S=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x);f.draw(l,h.TRIANGLES,ti.disabled,new Ui({func:h.ALWAYS,mask:0},w,255,h.KEEP,h.KEEP,h.REPLACE),Oi.disabled,Ni.disabled,ll(x.posMatrix),S,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new Ui({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){const r=this.context.gl;return new Ui({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,l=t.sort((x,w)=>w.overscaledZ-x.overscaledZ),h=l[l.length-1].overscaledZ,f=l[0].overscaledZ-h+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const x={};for(let w=0;w<f;w++)x[w+h]=new Ui({func:r.GEQUAL,mask:255},w+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=f,[x,l]}return[{[h]:Ui.disabled},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Oi([t.CONSTANT_COLOR,t.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Oi.unblended:Oi.alphaBlended}depthModeForSublayer(t,r,l){if(!this.opaquePassEnabledForLayer())return ti.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ti(l||this.context.gl.LEQUAL,r,[h,h])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){this.style=t,this.options=r,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(a.browser.now()),this.imageManager.beginFrame();const l=this.style._order,h=this.style.sourceCaches,f={},x={},w={};for(const S in h){const A=h[S];A.used&&A.prepare(this.context),f[S]=A.getVisibleCoordinates(),x[S]=f[S].slice().reverse(),w[S]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<l.length;S++)if(this.style._layers[l[S]].is3D()){this.opaquePassCutoff=S;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const S=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!a.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||S.length)&&(a.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,k){const z=A.context,$=z.gl,Y=Oi.unblended,K=new ti($.LEQUAL,ti.ReadWrite,[0,1]),Q=k.getTerrainMesh(),X=k.sourceCache.getRenderableTiles(),pe=A.useProgram("terrainDepth");z.bindFramebuffer.set(k.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),z.clear({color:a.Color.transparent,depth:1});for(const xe of X){const re=k.getTerrainData(xe.tileID),fe={u_matrix:A.transform.calculatePosMatrix(xe.tileID.toUnwrapped()),u_ele_delta:k.getMeshFrameDelta(A.transform.zoom)};pe.draw(z,$.TRIANGLES,K,Ui.disabled,Y,Ni.backCCW,fe,re,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,k){const z=A.context,$=z.gl,Y=Oi.unblended,K=new ti($.LEQUAL,ti.ReadWrite,[0,1]),Q=k.getTerrainMesh(),X=k.getCoordsTexture(),pe=k.sourceCache.getRenderableTiles(),xe=A.useProgram("terrainCoords");z.bindFramebuffer.set(k.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),z.clear({color:a.Color.transparent,depth:1}),k.coordsIndex=[];for(const re of pe){const fe=k.getTerrainData(re.tileID);z.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,X.texture);const Ce={u_matrix:A.transform.calculatePosMatrix(re.tileID.toUnwrapped()),u_terrain_coords_id:(255-k.coordsIndex.length)/255,u_texture:0,u_ele_delta:k.getMeshFrameDelta(A.transform.zoom)};xe.draw(z,$.TRIANGLES,K,Ui.disabled,Y,Ni.backCCW,Ce,fe,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments),k.coordsIndex.push(re.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const S of l){const A=this.style._layers[S];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const k=x[A.source];(A.type==="custom"||k.length)&&this.renderLayer(this,h[A.source],A,k)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[l[this.currentLayer]],A=h[S.source],k=f[S.source];this._renderTileClippingMasks(S,k),this.renderLayer(this,A,S,k)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const S=this.style._layers[l[this.currentLayer]],A=h[S.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(S))continue;const k=(S.type==="symbol"?w:x)[S.source];this._renderTileClippingMasks(S,f[S.source]),this.renderLayer(this,A,S,k)}if(this.options.showTileBoundaries){const S=function(A,k){let z=null;const $=Object.values(A._layers).flatMap(X=>X.source&&!X.isHidden(k)?[A.sourceCaches[X.source]]:[]),Y=$.filter(X=>X.getSource().type==="vector"),K=$.filter(X=>X.getSource().type!=="vector"),Q=X=>{(!z||z.getSource().maxzoom<X.getSource().maxzoom)&&(z=X)};return Y.forEach(X=>Q(X)),z||K.forEach(X=>Q(X)),z}(this.style,this.transform.zoom);S&&function(A,k,z){for(let $=0;$<z.length;$++)uo(A,k,z[$])}(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const A=S.transform.padding;sa(S,S.transform.height-(A.top||0),3,tu),sa(S,A.bottom||0,3,xn),Tl(S,A.left||0,3,us),Tl(S,S.transform.width-(A.right||0),3,hs);const k=S.transform.centerPoint;(function(z,$,Y,K){rr(z,$-1,Y-10,2,20,K),rr(z,$-10,Y-1,20,2,K)})(S,k.x,S.transform.height-k.y,vc)}(this),this.context.setDefault()}renderLayer(t,r,l,h){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(h||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(f,x,w,S,A){if(f.renderPass!=="translucent")return;const k=Ui.disabled,z=f.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function($,Y,K,Q,X,pe,xe){const re=Y.transform,fe=X==="map",Ce=pe==="map";for(const Me of $){const Re=Q.getTile(Me),We=Re.getBucket(K);if(!We||!We.text||!We.text.segments.get().length)continue;const Oe=a.evaluateSizeForZoom(We.textSizeData,re.zoom),tt=ue(Re,1,Y.transform.zoom),vt=gn(Me.posMatrix,Ce,fe,Y.transform,tt),Qt=K.layout.get("icon-text-fit")!=="none"&&We.hasIconData();if(Oe){const rt=Math.pow(2,re.zoom-Re.tileID.overscaledZ);_c(We,fe,Ce,xe,re,vt,Me.posMatrix,rt,Oe,Qt,Y.style.map.terrain?(It,gt)=>Y.style.map.terrain.getElevation(Me,It,gt):null)}}}(S,f,w,x,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),A),w.paint.get("icon-opacity").constantOr(1)!==0&&gr(f,x,w,S,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),k,z),w.paint.get("text-opacity").constantOr(1)!==0&&gr(f,x,w,S,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),k,z),x.map.showCollisionBoxes&&(Oa(f,x,w,S,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),!0),Oa(f,x,w,S,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),!1))})(t,r,l,h,this.style.placement.variableOffsets);break;case"circle":(function(f,x,w,S){if(f.renderPass!=="translucent")return;const A=w.paint.get("circle-opacity"),k=w.paint.get("circle-stroke-width"),z=w.paint.get("circle-stroke-opacity"),$=!w.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(k.constantOr(1)===0||z.constantOr(1)===0))return;const Y=f.context,K=Y.gl,Q=f.depthModeForSublayer(0,ti.ReadOnly),X=Ui.disabled,pe=f.colorModeForRenderPass(),xe=[];for(let re=0;re<S.length;re++){const fe=S[re],Ce=x.getTile(fe),Me=Ce.getBucket(w);if(!Me)continue;const Re=Me.programConfigurations.get(w.id),We=f.useProgram("circle",Re),Oe=Me.layoutVertexBuffer,tt=Me.indexBuffer,vt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(fe),Qt={programConfiguration:Re,program:We,layoutVertexBuffer:Oe,indexBuffer:tt,uniformValues:ea(f,fe,Ce,w),terrainData:vt};if($){const rt=Me.segments.get();for(const It of rt)xe.push({segments:new a.SegmentVector([It]),sortKey:It.sortKey,state:Qt})}else xe.push({segments:Me.segments,sortKey:0,state:Qt})}$&&xe.sort((re,fe)=>re.sortKey-fe.sortKey);for(const re of xe){const{programConfiguration:fe,program:Ce,layoutVertexBuffer:Me,indexBuffer:Re,uniformValues:We,terrainData:Oe}=re.state;Ce.draw(Y,K.TRIANGLES,Q,X,pe,Ni.disabled,We,Oe,w.id,Me,Re,re.segments,w.paint,f.transform.zoom,fe)}})(t,r,l,h);break;case"heatmap":(function(f,x,w,S){if(w.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const A=f.context,k=A.gl,z=Ui.disabled,$=new Oi([k.ONE,k.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(Y,K,Q){const X=Y.gl;Y.activeTexture.set(X.TEXTURE1),Y.viewport.set([0,0,K.width/4,K.height/4]);let pe=Q.heatmapFbo;if(pe)X.bindTexture(X.TEXTURE_2D,pe.colorAttachment.get()),Y.bindFramebuffer.set(pe.framebuffer);else{const xe=X.createTexture();X.bindTexture(X.TEXTURE_2D,xe),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),pe=Q.heatmapFbo=Y.createFramebuffer(K.width/4,K.height/4,!1,!1),function(re,fe,Ce,Me){var Re,We;const Oe=re.gl,tt=(Re=re.HALF_FLOAT)!==null&&Re!==void 0?Re:Oe.UNSIGNED_BYTE,vt=(We=re.RGBA16F)!==null&&We!==void 0?We:Oe.RGBA;Oe.texImage2D(Oe.TEXTURE_2D,0,vt,fe.width/4,fe.height/4,0,Oe.RGBA,tt,null),Me.colorAttachment.set(Ce)}(Y,K,xe,pe)}})(A,f,w),A.clear({color:a.Color.transparent});for(let Y=0;Y<S.length;Y++){const K=S[Y];if(x.hasRenderableParent(K))continue;const Q=x.getTile(K),X=Q.getBucket(w);if(!X)continue;const pe=X.programConfigurations.get(w.id),xe=f.useProgram("heatmap",pe),{zoom:re}=f.transform;xe.draw(A,k.TRIANGLES,ti.disabled,z,$,Ni.disabled,sc(K.posMatrix,Q,re,w.paint.get("heatmap-intensity")),null,w.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,w.paint,f.transform.zoom,pe)}A.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(A,k){const z=A.context,$=z.gl,Y=k.heatmapFbo;if(!Y)return;z.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,Y.colorAttachment.get()),z.activeTexture.set($.TEXTURE1);let K=k.colorRampTexture;K||(K=k.colorRampTexture=new Nt(z,k.colorRamp,$.RGBA)),K.bind($.LINEAR,$.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(z,$.TRIANGLES,ti.disabled,Ui.disabled,A.colorModeForRenderPass(),Ni.disabled,((Q,X,pe,xe)=>{const re=a.create();a.ortho(re,0,Q.width,Q.height,0,0,1);const fe=Q.context.gl;return{u_matrix:re,u_world:[fe.drawingBufferWidth,fe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:X.paint.get("heatmap-opacity")}})(A,k),null,k.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,k.paint,A.transform.zoom)}(f,w))})(t,r,l,h);break;case"line":(function(f,x,w,S){if(f.renderPass!=="translucent")return;const A=w.paint.get("line-opacity"),k=w.paint.get("line-width");if(A.constantOr(1)===0||k.constantOr(1)===0)return;const z=f.depthModeForSublayer(0,ti.ReadOnly),$=f.colorModeForRenderPass(),Y=w.paint.get("line-dasharray"),K=w.paint.get("line-pattern"),Q=K.constantOr(1),X=w.paint.get("line-gradient"),pe=w.getCrossfadeParameters(),xe=Q?"linePattern":Y?"lineSDF":X?"lineGradient":"line",re=f.context,fe=re.gl;let Ce=!0;for(const Me of S){const Re=x.getTile(Me);if(Q&&!Re.patternsLoaded())continue;const We=Re.getBucket(w);if(!We)continue;const Oe=We.programConfigurations.get(w.id),tt=f.context.program.get(),vt=f.useProgram(xe,Oe),Qt=Ce||vt.program!==tt,rt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Me),It=K.constantOr(null);if(It&&Re.imageAtlas){const ii=Re.imageAtlas,Ot=ii.patternPositions[It.to.toString()],Pt=ii.patternPositions[It.from.toString()];Ot&&Pt&&Oe.setConstantPatternPositions(Ot,Pt)}const gt=rt?Me:null,$i=Q?Eo(f,Re,w,pe,gt):Y?cl(f,Re,w,Y,pe,gt):X?ac(f,Re,w,We.lineClipsArray.length,gt):Da(f,Re,w,gt);if(Q)re.activeTexture.set(fe.TEXTURE0),Re.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),Oe.updatePaintBuffers(pe);else if(Y&&(Qt||f.lineAtlas.dirty))re.activeTexture.set(fe.TEXTURE0),f.lineAtlas.bind(re);else if(X){const ii=We.gradients[w.id];let Ot=ii.texture;if(w.gradientVersion!==ii.version){let Pt=256;if(w.stepInterpolant){const Vi=x.getSource().maxzoom,ni=Me.canonical.z===Vi?Math.ceil(1<<f.transform.maxZoom-Me.canonical.z):1;Pt=a.clamp(a.nextPowerOfTwo(We.maxLineLength/a.EXTENT*1024*ni),256,re.maxTextureSize)}ii.gradient=a.renderColorRamp({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:Pt,image:ii.gradient||void 0,clips:We.lineClipsArray}),ii.texture?ii.texture.update(ii.gradient):ii.texture=new Nt(re,ii.gradient,fe.RGBA),ii.version=w.gradientVersion,Ot=ii.texture}re.activeTexture.set(fe.TEXTURE0),Ot.bind(w.stepInterpolant?fe.NEAREST:fe.LINEAR,fe.CLAMP_TO_EDGE)}vt.draw(re,fe.TRIANGLES,z,f.stencilModeForClipping(Me),$,Ni.disabled,$i,rt,w.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,w.paint,f.transform.zoom,Oe,We.layoutVertexBuffer2),Ce=!1}})(t,r,l,h);break;case"fill":(function(f,x,w,S){const A=w.paint.get("fill-color"),k=w.paint.get("fill-opacity");if(k.constantOr(1)===0)return;const z=f.colorModeForRenderPass(),$=w.paint.get("fill-pattern"),Y=f.opaquePassEnabledForLayer()&&!$.constantOr(1)&&A.constantOr(a.Color.transparent).a===1&&k.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===Y){const K=f.depthModeForSublayer(1,f.renderPass==="opaque"?ti.ReadWrite:ti.ReadOnly);bl(f,x,w,S,K,z,!1)}if(f.renderPass==="translucent"&&w.paint.get("fill-antialias")){const K=f.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,ti.ReadOnly);bl(f,x,w,S,K,z,!0)}})(t,r,l,h);break;case"fill-extrusion":(function(f,x,w,S){const A=w.paint.get("fill-extrusion-opacity");if(A!==0&&f.renderPass==="translucent"){const k=new ti(f.context.gl.LEQUAL,ti.ReadWrite,f.depthRangeFor3D);if(A!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))Na(f,x,w,S,k,Ui.disabled,Oi.disabled),Na(f,x,w,S,k,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const z=f.colorModeForRenderPass();Na(f,x,w,S,k,Ui.disabled,z)}}})(t,r,l,h);break;case"hillshade":(function(f,x,w,S){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const A=f.context,k=f.depthModeForSublayer(0,ti.ReadOnly),z=f.colorModeForRenderPass(),[$,Y]=f.renderPass==="translucent"?f.stencilConfigForOverlap(S):[{},S];for(const K of Y){const Q=x.getTile(K);Q.needsHillshadePrepare!==void 0&&Q.needsHillshadePrepare&&f.renderPass==="offscreen"?yc(f,Q,w,k,Ui.disabled,z):f.renderPass==="translucent"&&wl(f,K,Q,w,k,$[K.overscaledZ],z)}A.viewport.set([0,0,f.width,f.height])})(t,r,l,h);break;case"raster":(function(f,x,w,S){if(f.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!S.length)return;const A=f.context,k=A.gl,z=x.getSource(),$=f.useProgram("raster"),Y=f.colorModeForRenderPass(),[K,Q]=z instanceof On?[{},S]:f.stencilConfigForOverlap(S),X=Q[Q.length-1].overscaledZ,pe=!f.options.moving;for(const xe of Q){const re=f.depthModeForSublayer(xe.overscaledZ-X,w.paint.get("raster-opacity")===1?ti.ReadWrite:ti.ReadOnly,k.LESS),fe=x.getTile(xe);fe.registerFadeDuration(w.paint.get("raster-fade-duration"));const Ce=x.findLoadedParent(xe,0),Me=ih(fe,Ce,x,w,f.transform,f.style.map.terrain);let Re,We;const Oe=w.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;A.activeTexture.set(k.TEXTURE0),fe.texture.bind(Oe,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(k.TEXTURE1),Ce?(Ce.texture.bind(Oe,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),Re=Math.pow(2,Ce.tileID.overscaledZ-fe.tileID.overscaledZ),We=[fe.tileID.canonical.x*Re%1,fe.tileID.canonical.y*Re%1]):fe.texture.bind(Oe,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST);const tt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(xe),vt=tt?xe:null,Qt=vt?vt.posMatrix:f.transform.calculatePosMatrix(xe.toUnwrapped(),pe),rt=ul(Qt,We||[0,0],Re||1,Me,w);z instanceof On?$.draw(A,k.TRIANGLES,re,Ui.disabled,Y,Ni.disabled,rt,tt,w.id,z.boundsBuffer,f.quadTriangleIndexBuffer,z.boundsSegments):$.draw(A,k.TRIANGLES,re,K[xe.overscaledZ],Y,Ni.disabled,rt,tt,w.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}})(t,r,l,h);break;case"background":(function(f,x,w,S){const A=w.paint.get("background-color"),k=w.paint.get("background-opacity");if(k===0)return;const z=f.context,$=z.gl,Y=f.transform,K=Y.tileSize,Q=w.paint.get("background-pattern");if(f.isPatternMissing(Q))return;const X=!Q&&A.a===1&&k===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==X)return;const pe=Ui.disabled,xe=f.depthModeForSublayer(0,X==="opaque"?ti.ReadWrite:ti.ReadOnly),re=f.colorModeForRenderPass(),fe=f.useProgram(Q?"backgroundPattern":"background"),Ce=S||Y.coveringTiles({tileSize:K,terrain:f.style.map.terrain});Q&&(z.activeTexture.set($.TEXTURE0),f.imageManager.bind(f.context));const Me=w.getCrossfadeParameters();for(const Re of Ce){const We=S?Re.posMatrix:f.transform.calculatePosMatrix(Re.toUnwrapped()),Oe=Q?hl(We,k,f,Q,{tileID:Re,tileSize:K},Me):Io(We,k,A),tt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Re);fe.draw(z,$.TRIANGLES,xe,pe,re,Ni.disabled,Oe,tt,w.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}})(t,0,l,h);break;case"custom":(function(f,x,w){const S=f.context,A=w.implementation;if(f.renderPass==="offscreen"){const k=A.prerender;k&&(f.setCustomLayerDefaults(),S.setColorMode(f.colorModeForRenderPass()),k.call(A,S.gl,f.transform.customLayerMatrix()),S.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),S.setColorMode(f.colorModeForRenderPass()),S.setStencilMode(Ui.disabled);const k=A.renderingMode==="3d"?new ti(f.context.gl.LEQUAL,ti.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,ti.ReadOnly);S.setDepthMode(k),A.render(S.gl,f.transform.customLayerMatrix()),S.setDirty(),f.setBaseState(),S.bindFramebuffer.set(null)}})(t,0,l)}}translatePosMatrix(t,r,l,h,f){if(!l[0]&&!l[1])return t;const x=f?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(x){const A=Math.sin(x),k=Math.cos(x);l=[l[0]*k-l[1]*A,l[0]*A+l[1]*k]}const w=[f?l[0]:ue(r,l[0],this.transform.zoom),f?l[1]:ue(r,l[1],this.transform.zoom),0],S=new Float32Array(16);return a.translate(S,t,w),S}saveTileTexture(t){const r=this._tileTextures[t.size[0]];r?r.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const r=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!r||!l}useProgram(t,r){this.cache=this.cache||{};const l=t+(r?r.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new ao(this.context,Pa[t],r,Hr[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Nt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:r}=this.context.gl;return this.width!==t||this.height!==r}}class El{constructor(t,r){this.points=t,this.planes=r}static fromInvProjectionMatrix(t,r,l){const h=Math.pow(2,l),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const S=1/(w=a.transformMat4([],w,t))[3]/r*h;return a.mul$1(w,w,[S,S,1/w[3],S])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const S=function($,Y){var K=Y[0],Q=Y[1],X=Y[2],pe=K*K+Q*Q+X*X;return pe>0&&(pe=1/Math.sqrt(pe)),$[0]=Y[0]*pe,$[1]=Y[1]*pe,$[2]=Y[2]*pe,$}([],function($,Y,K){var Q=Y[0],X=Y[1],pe=Y[2],xe=K[0],re=K[1],fe=K[2];return $[0]=X*fe-pe*re,$[1]=pe*xe-Q*fe,$[2]=Q*re-X*xe,$}([],je([],f[w[0]],f[w[1]]),je([],f[w[2]],f[w[1]]))),A=-((k=S)[0]*(z=f[w[1]])[0]+k[1]*z[1]+k[2]*z[2]);var k,z;return S.concat(A)});return new El(f,x)}}class Rs{constructor(t,r){this.min=t,this.max=r,this.center=function(l,h,f){return l[0]=.5*h[0],l[1]=.5*h[1],l[2]=.5*h[2],l}([],function(l,h,f){return l[0]=h[0]+f[0],l[1]=h[1]+f[1],l[2]=h[2]+f[2],l}([],this.min,this.max))}quadrant(t){const r=[t%2==0,t<2],l=Ke(this.min),h=Ke(this.max);for(let f=0;f<r.length;f++)l[f]=r[f]?this.min[f]:this.center[f],h[f]=r[f]?this.center[f]:this.max[f];return h[2]=this.max[2],new Rs(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const r=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let h=0;h<t.planes.length;h++){const f=t.planes[h];let x=0;for(let w=0;w<r.length;w++)a.dot(f,r[w])>=0&&x++;if(x===0)return 0;x!==r.length&&(l=!1)}if(l)return 2;for(let h=0;h<3;h++){let f=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let w=0;w<t.points.length;w++){const S=t.points[w][h]-this.min[h];f=Math.min(f,S),x=Math.max(x,S)}if(x<0||f>this.max[h]-this.min[h])return 0}return 1}}class zr{constructor(t=0,r=0,l=0,h=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=l,this.right=h}interpolate(t,r,l){return r.top!=null&&t.top!=null&&(this.top=a.interpolate.number(t.top,r.top,l)),r.bottom!=null&&t.bottom!=null&&(this.bottom=a.interpolate.number(t.bottom,r.bottom,l)),r.left!=null&&t.left!=null&&(this.left=a.interpolate.number(t.left,r.left,l)),r.right!=null&&t.right!=null&&(this.right=a.interpolate.number(t.right,r.right,l)),this}getCenter(t,r){const l=a.clamp((this.left+t-this.right)/2,0,t),h=a.clamp((this.top+r-this.bottom)/2,0,r);return new a.Point(l,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new zr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class $a{constructor(t,r,l,h,f){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=f===void 0||!!f,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=l??0,this._maxPitch=h??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new zr,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new $a(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const r=-a.wrap(t,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=function(){var l=new a.ARRAY_TYPE(4);return a.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,h,f){var x=h[0],w=h[1],S=h[2],A=h[3],k=Math.sin(f),z=Math.cos(f);l[0]=x*z+S*k,l[1]=w*z+A*k,l[2]=x*-k+S*z,l[3]=w*-k+A*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=a.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this.tileZoom=Math.max(0,Math.floor(r)),this.scale=this.zoomScale(r),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,l){this._unmodified=!1,this._edgeInsets.interpolate(t,r,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new a.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const l=this.pointCoordinate(new a.Point(0,0)),h=this.pointCoordinate(new a.Point(this.width,0)),f=this.pointCoordinate(new a.Point(this.width,this.height)),x=this.pointCoordinate(new a.Point(0,this.height)),w=Math.floor(Math.min(l.x,h.x,f.x,x.x)),S=Math.floor(Math.max(l.x,h.x,f.x,x.x)),A=1;for(let k=w-A;k<=S+A;k++)k!==0&&r.push(new a.UnwrappedTileID(k,t))}return r}coveringTiles(t){var r,l;let h=this.coveringZoomLevel(t);const f=h;if(t.minzoom!==void 0&&h<t.minzoom)return[];t.maxzoom!==void 0&&h>t.maxzoom&&(h=t.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),w=a.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,h),A=[S*x.x,S*x.y,0],k=[S*w.x,S*w.y,0],z=El.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h);let $=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&($=h);const Y=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,K=re=>({aabb:new Rs([re*S,0,0],[(re+1)*S,S,0]),zoom:0,x:0,y:0,wrap:re,fullyVisible:!1}),Q=[],X=[],pe=h,xe=t.reparseOverscaled?f:h;if(this._renderWorldCopies)for(let re=1;re<=3;re++)Q.push(K(-re)),Q.push(K(re));for(Q.push(K(0));Q.length>0;){const re=Q.pop(),fe=re.x,Ce=re.y;let Me=re.fullyVisible;if(!Me){const vt=re.aabb.intersects(z);if(vt===0)continue;Me=vt===2}const Re=t.terrain?A:k,We=re.aabb.distanceX(Re),Oe=re.aabb.distanceY(Re),tt=Math.max(Math.abs(We),Math.abs(Oe));if(re.zoom===pe||tt>Y+(1<<pe-re.zoom)-2&&re.zoom>=$){const vt=pe-re.zoom,Qt=A[0]-.5-(fe<<vt),rt=A[1]-.5-(Ce<<vt);X.push({tileID:new a.OverscaledTileID(re.zoom===pe?xe:re.zoom,re.wrap,re.zoom,fe,Ce),distanceSq:ut([k[0]-.5-fe,k[1]-.5-Ce]),tileDistanceToCamera:Math.sqrt(Qt*Qt+rt*rt)})}else for(let vt=0;vt<4;vt++){const Qt=(fe<<1)+vt%2,rt=(Ce<<1)+(vt>>1),It=re.zoom+1;let gt=re.aabb.quadrant(vt);if(t.terrain){const $i=new a.OverscaledTileID(It,re.wrap,It,Qt,rt),ii=t.terrain.getMinMaxElevation($i),Ot=(r=ii.minElevation)!==null&&r!==void 0?r:this.elevation,Pt=(l=ii.maxElevation)!==null&&l!==void 0?l:this.elevation;gt=new Rs([gt.min[0],gt.min[1],Ot],[gt.max[0],gt.max[1],Pt])}Q.push({aabb:gt,zoom:It,x:Qt,y:rt,wrap:re.wrap,fullyVisible:Me})}}return X.sort((re,fe)=>re.distanceSq-fe.distanceSq).map(re=>re.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=a.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.Point(a.mercatorXfromLng(t.lng)*this.worldSize,a.mercatorYfromLat(r)*this.worldSize)}unproject(t){return new a.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const r=this.pointLocation(this.centerPoint,t),l=t.getElevationForLngLatZoom(r,this.tileZoom);if(!(this.elevation-l))return;const h=this.getCameraPosition(),f=a.MercatorCoordinate.fromLngLat(h.lngLat,h.altitude),x=a.MercatorCoordinate.fromLngLat(r,l),w=f.x-x.x,S=f.y-x.y,A=f.z-x.z,k=Math.sqrt(w*w+S*S+A*A),z=this.scaleZoom(this.cameraToCenterDistance/k/this.tileSize);this._elevation=l,this._center=r,this.zoom=z}setLocationAtPoint(t,r){const l=this.pointCoordinate(r),h=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(t),x=new a.MercatorCoordinate(f.x-(l.x-h.x),f.y-(l.y-h.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,r){return r?this.coordinatePoint(this.locationCoordinate(t),r.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,r){return this.coordinateLocation(this.pointCoordinate(t,r))}locationCoordinate(t){return a.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,r){if(r){const $=r.pointCoordinate(t);if($!=null)return $}const l=[t.x,t.y,0,1],h=[t.x,t.y,1,1];a.transformMat4(l,l,this.pixelMatrixInverse),a.transformMat4(h,h,this.pixelMatrixInverse);const f=l[3],x=h[3],w=l[1]/f,S=h[1]/x,A=l[2]/f,k=h[2]/x,z=A===k?0:(0-A)/(k-A);return new a.MercatorCoordinate(a.interpolate.number(l[0]/f,h[0]/x,z)/this.worldSize,a.interpolate.number(w,S,z)/this.worldSize)}coordinatePoint(t,r=0,l=this.pixelMatrix){const h=[t.x*this.worldSize,t.y*this.worldSize,r,1];return a.transformMat4(h,h,l),new a.Point(h[0]/h[3],h[1]/h[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new xi().extend(this.pointLocation(new a.Point(0,t))).extend(this.pointLocation(new a.Point(this.width,t))).extend(this.pointLocation(new a.Point(this.width,this.height))).extend(this.pointLocation(new a.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new xi([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,r=!1){const l=t.key,h=r?this._alignedPosMatrixCache:this._posMatrixCache;if(h[l])return h[l];const f=t.canonical,x=this.worldSize/this.zoomScale(f.z),w=f.x+Math.pow(2,f.z)*t.wrap,S=a.identity(new Float64Array(16));return a.translate(S,S,[w*x,f.y*x,0]),a.scale(S,S,[x/a.EXTENT,x/a.EXTENT,1]),a.multiply(S,r?this.alignedProjMatrix:this.projMatrix,S),h[l]=new Float32Array(S),h[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,r,l,h,f=-90,x=90,w=-180,S=180;const A=this.size,k=this._unmodified;if(this.latRange){const Y=this.latRange;f=a.mercatorYfromLat(Y[1])*this.worldSize,x=a.mercatorYfromLat(Y[0])*this.worldSize,t=x-f<A.y?A.y/(x-f):0}if(this.lngRange){const Y=this.lngRange;w=a.wrap(a.mercatorXfromLng(Y[0])*this.worldSize,0,this.worldSize),S=a.wrap(a.mercatorXfromLng(Y[1])*this.worldSize,0,this.worldSize),S<w&&(S+=this.worldSize),r=S-w<A.x?A.x/(S-w):0}const z=this.point,$=Math.max(r||0,t||0);if($)return this.center=this.unproject(new a.Point(r?(S+w)/2:z.x,t?(x+f)/2:z.y)),this.zoom+=this.scaleZoom($),this._unmodified=k,void(this._constraining=!1);if(this.latRange){const Y=z.y,K=A.y/2;Y-K<f&&(h=f+K),Y+K>x&&(h=x-K)}if(this.lngRange){const Y=(w+S)/2,K=a.wrap(z.x,Y-this.worldSize/2,Y+this.worldSize/2),Q=A.x/2;K-Q<w&&(l=w+Q),K+Q>S&&(l=S-Q)}l===void 0&&h===void 0||(this.center=this.unproject(new a.Point(l!==void 0?l:z.x,h!==void 0?h:z.y)).wrap()),this._unmodified=k,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let h=a.identity(new Float64Array(16));a.scale(h,h,[this.width/2,-this.height/2,1]),a.translate(h,h,[1,-1,0]),this.labelPlaneMatrix=h,h=a.identity(new Float64Array(16)),a.scale(h,h,[1,-1,1]),a.translate(h,h,[-1,-1,0]),a.scale(h,h,[2/this.width,2/this.height,1]),this.glCoordMatrix=h;const f=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),x=Math.min(this.elevation,this._minEleveationForCurrentTile),w=f-x*this._pixelPerMeter/Math.cos(this._pitch),S=x<0?w:f,A=Math.PI/2+this._pitch,k=this._fov*(.5+t.y/this.height),z=Math.sin(k)*S/Math.sin(a.clamp(Math.PI-A-k,.01,Math.PI-.01)),$=this.getHorizon(),Y=2*Math.atan($/this.cameraToCenterDistance)*(.5+t.y/(2*$)),K=Math.sin(Y)*S/Math.sin(a.clamp(Math.PI-A-Y,.01,Math.PI-.01)),Q=Math.min(z,K),X=1.01*(Math.cos(Math.PI/2-this._pitch)*Q+S),pe=this.height/50;h=new Float64Array(16),a.perspective(h,this._fov,this.width/this.height,pe,X),h[8]=2*-t.x/this.width,h[9]=2*t.y/this.height,a.scale(h,h,[1,-1,1]),a.translate(h,h,[0,0,-this.cameraToCenterDistance]),a.rotateX(h,h,this._pitch),a.rotateZ(h,h,this.angle),a.translate(h,h,[-r,-l,0]),this.mercatorMatrix=a.scale([],h,[this.worldSize,this.worldSize,this.worldSize]),a.scale(h,h,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,h),a.translate(h,h,[0,0,-this.elevation]),this.projMatrix=h,this.invProjMatrix=a.invert([],h),this.pixelMatrix3D=a.multiply(new Float64Array(16),this.labelPlaneMatrix,h);const xe=this.width%2/2,re=this.height%2/2,fe=Math.cos(this.angle),Ce=Math.sin(this.angle),Me=r-Math.round(r)+fe*xe+Ce*re,Re=l-Math.round(l)+fe*re+Ce*xe,We=new Float64Array(h);if(a.translate(We,We,[Me>.5?Me-1:Me,Re>.5?Re-1:Re,0]),this.alignedProjMatrix=We,h=a.invert(new Float64Array(16),this.pixelMatrix),!h)throw new Error("failed to invert matrix");this.pixelMatrixInverse=h,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new a.Point(0,0)),r=[t.x*this.worldSize,t.y*this.worldSize,0,1];return a.transformMat4(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.Point(0,t))}getCameraQueryGeometry(t){const r=this.getCameraPoint();if(t.length===1)return[t[0],r];{let l=r.x,h=r.y,f=r.x,x=r.y;for(const w of t)l=Math.min(l,w.x),h=Math.min(h,w.y),f=Math.max(f,w.x),x=Math.max(x,w.y);return[new a.Point(l,h),new a.Point(f,h),new a.Point(f,x),new a.Point(l,x),new a.Point(l,h)]}}}class Do{constructor(t){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(l=h)}),(l&&l[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(r.length>=3&&!r.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:l,pitch:+(r[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,r)}catch{}},this._updateHash=function(r,l){let h=!1,f=null;const x=()=>{f=null,h&&(r(),f=setTimeout(x,300),h=!1)};return()=>(h=!0,f||x(),f)}(this._updateHashUnthrottled),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const r=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,h),x=Math.round(r.lng*f)/f,w=Math.round(r.lat*f)/f,S=this._map.getBearing(),A=this._map.getPitch();let k="";if(k+=t?`/${x}/${w}/${l}`:`${l}/${w}/${x}`,(S||A)&&(k+="/"+Math.round(10*S)/10),A&&(k+=`/${Math.round(A)}`),this._hashName){const z=this._hashName;let $=!1;const Y=window.location.hash.slice(1).split("&").map(K=>{const Q=K.split("=")[0];return Q===z?($=!0,`${Q}=${k}`):K}).filter(K=>K);return $||Y.push(`${z}=${k}`),`#${Y.join("&")}`}return`#${k}`}}const Va={linearity:.3,easing:a.bezier(0,0,.3,1)},nu=a.extend({deceleration:2500,maxSpeed:1400},Va),ru=a.extend({deceleration:20,maxSpeed:1400},Va),su=a.extend({deceleration:1e3,maxSpeed:360},Va),Lo=a.extend({deceleration:1e3,maxSpeed:90},Va);class ye{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.browser.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=a.browser.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new a.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)r.zoom+=f.zoomDelta||0,r.bearing+=f.bearingDelta||0,r.pitch+=f.pitchDelta||0,f.panDelta&&r.pan._add(f.panDelta),f.around&&(r.around=f.around),f.pinchAround&&(r.pinchAround=f.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(r.pan.mag()){const f=Pe(r.pan.mag(),l,a.extend({},nu,t||{}));h.offset=r.pan.mult(f.amount/r.pan.mag()),h.center=this._map.transform.center,ze(h,f)}if(r.zoom){const f=Pe(r.zoom,l,ru);h.zoom=this._map.transform.zoom+f.amount,ze(h,f)}if(r.bearing){const f=Pe(r.bearing,l,su);h.bearing=this._map.transform.bearing+a.clamp(f.amount,-179,179),ze(h,f)}if(r.pitch){const f=Pe(r.pitch,l,Lo);h.pitch=this._map.transform.pitch+f.amount,ze(h,f)}if(h.zoom||h.bearing){const f=r.pinchAround===void 0?r.around:r.pinchAround;h.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),a.extend(h,{noMoveStart:!0})}}function ze(p,t){(!p.duration||p.duration<t.duration)&&(p.duration=t.duration,p.easing=t.easing)}function Pe(p,t,r){const{maxSpeed:l,linearity:h,deceleration:f}=r,x=a.clamp(p*h/(t/1e3),-l,l),w=Math.abs(x)/(f*h);return{easing:r.easing,duration:1e3*w,amount:x*(w/2)}}class ct extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l,h={}){const f=F.mousePos(r.getCanvasContainer(),l),x=r.unproject(f);super(t,a.extend({point:f,lngLat:x,originalEvent:l},h)),this._defaultPrevented=!1,this.target=r}}class Ft extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l){const h=t==="touchend"?l.changedTouches:l.touches,f=F.touchPos(r.getCanvasContainer(),h),x=f.map(S=>r.unproject(S)),w=f.reduce((S,A,k,z)=>S.add(A.div(z.length)),new a.Point(0,0));super(t,{points:f,point:w,lngLats:x,lngLat:r.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class Ei extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class qi{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Ei(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new ct(t.type,this._map,t))}mouseup(t){this._map.fire(new ct(t.type,this._map,t))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new ct(t.type,this._map,t))}dblclick(t){return this._firePreventable(new ct(t.type,this._map,t))}mouseover(t){this._map.fire(new ct(t.type,this._map,t))}mouseout(t){this._map.fire(new ct(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ft(t.type,this._map,t))}touchmove(t){this._map.fire(new Ft(t.type,this._map,t))}touchend(t){this._map.fire(new Ft(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ft(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Mi{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new ct(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ct("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new ct(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ro{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(a.Point.convert(t),this._map.terrain)}}class nh{constructor(t,r){this._map=t,this._tr=new Ro(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(F.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const l=r;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=F.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const f=Math.min(h.x,l.x),x=Math.max(h.x,l.x),w=Math.min(h.y,l.y),S=Math.max(h.y,l.y);F.setTransform(this._box,`translate(${f}px,${w}px)`),this._box.style.width=x-f+"px",this._box.style.height=S-w+"px"}mouseupWindow(t,r){if(!this._active||t.button!==0)return;const l=this._startPos,h=r;if(this.reset(),F.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:f=>f.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(F.remove(this._box),this._box=null),F.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new a.Event(t,{originalEvent:r}))}}function Dr(p,t){if(p.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${t.length}`);const r={};for(let l=0;l<p.length;l++)r[p[l].identifier]=t[l];return r}class qa{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,r,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=function(h){const f=new a.Point(0,0);for(const x of h)f._add(x);return f.div(h.length)}(r),this.touches=Dr(l,r)))}touchmove(t,r,l){if(this.aborted||!this.centroid)return;const h=Dr(l,r);for(const f in this.touches){const x=h[f];(!x||x.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(t,r,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class Bo{constructor(t){this.singleTap=new qa(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,r,l){this.singleTap.touchstart(t,r,l)}touchmove(t,r,l){this.singleTap.touchmove(t,r,l)}touchend(t,r,l){const h=this.singleTap.touchend(t,r,l);if(h){const f=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(h)<30;if(f&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class Yr{constructor(t){this._tr=new Ro(t),this._zoomIn=new Bo({numTouches:1,numTaps:2}),this._zoomOut=new Bo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,l){this._zoomIn.touchstart(t,r,l),this._zoomOut.touchstart(t,r,l)}touchmove(t,r,l){this._zoomIn.touchmove(t,r,l),this._zoomOut.touchmove(t,r,l)}touchend(t,r,l){const h=this._zoomIn.touchend(t,r,l),f=this._zoomOut.touchend(t,r,l),x=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(h)},{originalEvent:t})}):f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(f)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dt{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const r=this._moveFunction(...t);if(r.bearingDelta||r.pitchDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(t,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=r.length?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,r){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const h=r.length?r[0]:r;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&F.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ga={0:1,2:2};class mi{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const r=F.mouseButton(t);this._eventButton=r}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(r,l){const h=Ga[l];return r.buttons===void 0||(r.buttons&h)!==h}(t,this._eventButton)}isValidEndEvent(t){return F.mouseButton(t)===this._eventButton}}class oa{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const Za=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=function(t){t.preventDefault()}},ht=({enable:p,clickTolerance:t,bearingDegreesPerPixelMoved:r=.8})=>{const l=new mi({checkCorrectEvent:h=>F.mouseButton(h)===0&&h.ctrlKey||F.mouseButton(h)===2});return new dt({clickTolerance:t,move:(h,f)=>({bearingDelta:(f.x-h.x)*r}),moveStateManager:l,enable:p,assignEvents:Za})},Al=({enable:p,clickTolerance:t,pitchDegreesPerPixelMoved:r=-.5})=>{const l=new mi({checkCorrectEvent:h=>F.mouseButton(h)===0&&h.ctrlKey||F.mouseButton(h)===2});return new dt({clickTolerance:t,move:(h,f)=>({pitchDelta:(f.y-h.y)*r}),moveStateManager:l,enable:p,assignEvents:Za})};class rh{constructor(t,r){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.Point(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,r,l){return this._calculateTransform(t,r,l)}touchmove(t,r,l){if(this._map._cooperativeGestures&&(this._minTouches===2&&l.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,l.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(l.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,r,l)}touchend(t,r,l){this._calculateTransform(t,r,l),this._active&&l.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,l){l.length>0&&(this._active=!0);const h=Dr(l,r),f=new a.Point(0,0),x=new a.Point(0,0);let w=0;for(const A in h){const k=h[A],z=this._touches[A];z&&(f._add(k),x._add(k.sub(z)),w++,h[A]=k)}if(this._touches=h,w<this._minTouches||!x.mag())return;const S=x.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(w),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,r,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,l){if(!this._firstTwoTouches)return;t.preventDefault();const[h,f]=this._firstTwoTouches,x=Zs(l,r,h),w=Zs(l,r,f);if(!x||!w)return;const S=this._aroundCenter?null:x.add(w).div(2);return this._move([x,w],S,t)}touchend(t,r,l){if(!this._firstTwoTouches)return;const[h,f]=this._firstTwoTouches,x=Zs(l,r,h),w=Zs(l,r,f);x&&w||(this._active&&F.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Zs(p,t,r){for(let l=0;l<p.length;l++)if(p[l].identifier===r)return t[l]}function Bs(p,t){return Math.log(p/t)/Math.LN2}class ja extends xc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Bs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Bs(this._distance,l),pinchAround:r}}}function bc(p,t){return 180*p.angleWith(t)/Math.PI}class Il extends xc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const l=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:bc(this._vector,l),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,l=bc(t,this._startVector);return Math.abs(l)<r}}function aa(p){return Math.abs(p.y)>Math.abs(p.x)}class Cl extends xc{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,r,l){super.touchstart(t,r,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,aa(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,l){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const h=t[0].sub(this._lastPoints[0]),f=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,f,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(t,r,l){if(this._valid!==void 0)return this._valid;const h=t.mag()>=2,f=r.mag()>=2;if(!h&&!f)return;if(!h||!f)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const x=t.y>0==r.y>0;return aa(t)&&aa(r)&&x}}const la={panStep:100,bearingStep:15,pitchStep:10};class Ml{constructor(t){this._tr=new Ro(t);const r=la;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,l=0,h=0,f=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),f=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),f=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:w=>{const S=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Un,zoom:r?Math.round(S.zoom)+r*(t.shiftKey?2:1):S.zoom,bearing:S.bearing+l*this._bearingStep,pitch:S.pitch+h*this._pitchStep,offset:[-f*this._panStep,-x*this._panStep],center:S.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Un(p){return p*(2-p)}const _r=4.000244140625;class Wa{constructor(t,r){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new Ro(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=a.browser.now(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,r!==0&&r%_r==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=F.mousePos(this._el,t),l=this._tr;this._around=a.LngLat.convert(this._aroundCenter?l.center:l.unproject(r)),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>_r?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&S!==0&&(S=1/S);const A=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(A*S))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,l=this._startZoom,h=this._easing;let f,x=!1;if(this._type==="wheel"&&l&&h){const w=Math.min((a.browser.now()-this._lastWheelEventTime)/200,1),S=h(w);f=a.interpolate.number(l,r,S),w<1?this._frameId||(this._frameId=!0):x=!0}else f=r,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:f-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=a.defaultEasing;if(this._prevEase){const l=this._prevEase,h=(a.browser.now()-l.start)/l.duration,f=l.easing(h+.01)-l.easing(h),x=.27/Math.sqrt(f*f+1e-4)*.01,w=Math.sqrt(.0729-x*x);r=a.bezier(x,w,.25,1)}return this._prevEase={start:a.browser.now(),duration:t,easing:r},r}reset(){this._active=!1}}class wc{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Tc{constructor(t){this._tr=new Ro(t),this.reset()}reset(){this._active=!1}dblclick(t,r){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sc{constructor(){this._tap=new Bo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,r,l){if(!this._swipePoint)if(this._tapTime){const h=r[0],f=t.timeStamp-this._tapTime<500,x=this._tapPoint.dist(h)<30;f&&x?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,r,l)}touchmove(t,r,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=r[0],f=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(t,r,l)}touchend(t,r,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(t,r,l);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ha{constructor(t,r,l){this._el=t,this._mousePan=r,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class yr{constructor(t,r,l){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Gi{constructor(t,r,l,h){this._el=t,this._touchZoom=r,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Fo=p=>p.zoom||p.drag||p.pitch||p.rotate;class Pl extends a.Event{}function kl(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class ou{constructor(t,r){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,f)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=h.type==="renderFrame"?void 0:h,w={needsRenderFrame:!1},S={},A={},k=h.touches,z=k?this._getMapTouches(k):void 0,$=z?F.touchPos(this._el,z):F.mousePos(this._el,h);for(const{handlerName:Q,handler:X,allowed:pe}of this._handlers){if(!X.isEnabled())continue;let xe;this._blockedByActive(A,pe,Q)?X.reset():X[f||h.type]&&(xe=X[f||h.type](h,$,z),this.mergeHandlerResult(w,S,xe,Q,x),xe&&xe.needsRenderFrame&&this._triggerRenderFrame()),(xe||X.isActive())&&(A[Q]=X)}const Y={};for(const Q in this._previousActiveHandlers)A[Q]||(Y[Q]=x);this._previousActiveHandlers=A,(Object.keys(Y).length||kl(w))&&(this._changes.push([w,S,Y]),this._triggerRenderFrame()),(Object.keys(A).length||kl(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:K}=w;K&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],K(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ye(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,f,x]of this._listeners)F.addEventListener(h,f,h===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,r,l]of this._listeners)F.removeEventListener(t,r,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const r=this._map,l=r.getCanvasContainer();this._add("mapEvent",new qi(r,t));const h=r.boxZoom=new nh(r,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();const f=new Yr(r),x=new Tc(r);r.doubleClickZoom=new wc(x,f),this._add("tapZoom",f),this._add("clickZoom",x),t.interactive&&t.doubleClickZoom&&r.doubleClickZoom.enable();const w=new Sc;this._add("tapDragZoom",w);const S=r.touchPitch=new Cl(r);this._add("touchPitch",S),t.interactive&&t.touchPitch&&r.touchPitch.enable(t.touchPitch);const A=ht(t),k=Al(t);r.dragRotate=new yr(t,A,k),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]),t.interactive&&t.dragRotate&&r.dragRotate.enable();const z=(({enable:pe,clickTolerance:xe})=>{const re=new mi({checkCorrectEvent:fe=>F.mouseButton(fe)===0&&!fe.ctrlKey});return new dt({clickTolerance:xe,move:(fe,Ce)=>({around:Ce,panDelta:Ce.sub(fe)}),activateOnStart:!0,moveStateManager:re,enable:pe,assignEvents:Za})})(t),$=new rh(t,r);r.dragPan=new Ha(l,z,$),this._add("mousePan",z),this._add("touchPan",$,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&r.dragPan.enable(t.dragPan);const Y=new Il,K=new ja;r.touchZoomRotate=new Gi(l,K,Y,w),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&r.touchZoomRotate.enable(t.touchZoomRotate);const Q=r.scrollZoom=new Wa(r,()=>this._triggerRenderFrame());this._add("scrollZoom",Q,["mousePan"]),t.interactive&&t.scrollZoom&&r.scrollZoom.enable(t.scrollZoom);const X=r.keyboard=new Ml(r);this._add("keyboard",X),t.interactive&&t.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new Mi(r))}_add(t,r,l){this._handlers.push({handlerName:t,handler:r,allowed:l}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fo(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,r,l){for(const h in t)if(h!==l&&(!r||r.indexOf(h)<0))return!0;return!1}_getMapTouches(t){const r=[];for(const l of t)this._el.contains(l.target)&&r.push(l);return r}mergeHandlerResult(t,r,l,h,f){if(!l)return;a.extend(t,l);const x={handlerName:h,originalEvent:l.originalEvent||f};l.zoomDelta!==void 0&&(r.zoom=x),l.panDelta!==void 0&&(r.drag=x),l.pitchDelta!==void 0&&(r.pitch=x),l.bearingDelta!==void 0&&(r.rotate=x)}_applyChanges(){const t={},r={},l={};for(const[h,f,x]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new a.Point(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),a.extend(r,f),a.extend(l,x);this._updateMapTransform(t,r,l),this._changes=[]}_updateMapTransform(t,r,l){const h=this._map,f=h._getTransformForUpdate(),x=h.terrain;if(!(kl(t)||x&&this._terrainMovement))return this._fireEvents(r,l,!0);let{panDelta:w,zoomDelta:S,bearingDelta:A,pitchDelta:k,around:z,pinchAround:$}=t;$!==void 0&&(z=$),h._stop(!0),z=z||h.transform.centerPoint;const Y=f.pointLocation(w?z.sub(w):z);A&&(f.bearing+=A),k&&(f.pitch+=k),S&&(f.zoom+=S),x?this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?f.center=f.pointLocation(f.centerPoint.sub(w)):f.setLocationAtPoint(Y,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,f.setLocationAtPoint(Y,z),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,f.recalculateZoom(h.terrain)})):f.setLocationAtPoint(Y,z),h._applyUpdatedTransform(f),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,l,!0)}_fireEvents(t,r,l){const h=Fo(this._eventsInProgress),f=Fo(t),x={};for(const k in t){const{originalEvent:z}=t[k];this._eventsInProgress[k]||(x[`${k}start`]=z),this._eventsInProgress[k]=t[k]}!h&&f&&this._fireEvent("movestart",f.originalEvent);for(const k in x)this._fireEvent(k,x[k]);f&&this._fireEvent("move",f.originalEvent);for(const k in t){const{originalEvent:z}=t[k];this._fireEvent(k,z)}const w={};let S;for(const k in this._eventsInProgress){const{handlerName:z,originalEvent:$}=this._eventsInProgress[k];this._handlersById[z].isActive()||(delete this._eventsInProgress[k],S=r[z]||$,w[`${k}end`]=S)}for(const k in w)this._fireEvent(k,w[k]);const A=Fo(this._eventsInProgress);if(l&&(h||f)&&!A){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;k?(z(k.bearing||this._map.getBearing())&&(k.bearing=0),k.freezeElevation=!0,this._map.easeTo(k,{originalEvent:S})):(this._map.fire(new a.Event("moveend",{originalEvent:S})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new a.Event(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Pl("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class An extends a.Evented{constructor(t,r){super(),this._renderFrameCallback=()=>{const l=Math.min((a.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,l){return t=a.Point.convert(t).mult(-1),this.panTo(this.transform.center,a.extend({offset:t},r),l)}panTo(t,r,l){return this.easeTo(a.extend({center:t},r),l)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,l){return this.easeTo(a.extend({zoom:t},r),l)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,l){return this.easeTo(a.extend({bearing:t},r),l)}resetNorth(t,r){return this.rotateTo(0,a.extend({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=xi.convert(t);const l=r&&r.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,r)}_cameraForBoxAndBearing(t,r,l,h){const f={top:0,bottom:0,right:0,left:0};if(typeof(h=a.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const Ce=h.padding;h.padding={top:Ce,bottom:Ce,right:Ce,left:Ce}}h.padding=a.extend(f,h.padding);const x=this.transform,w=x.padding,S=x.project(a.LngLat.convert(t)),A=x.project(a.LngLat.convert(r)),k=S.rotate(-l*Math.PI/180),z=A.rotate(-l*Math.PI/180),$=new a.Point(Math.max(k.x,z.x),Math.max(k.y,z.y)),Y=new a.Point(Math.min(k.x,z.x),Math.min(k.y,z.y)),K=$.sub(Y),Q=(x.width-(w.left+w.right+h.padding.left+h.padding.right))/K.x,X=(x.height-(w.top+w.bottom+h.padding.top+h.padding.bottom))/K.y;if(X<0||Q<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const pe=Math.min(x.scaleZoom(x.scale*Math.min(Q,X)),h.maxZoom),xe=a.Point.convert(h.offset),re=new a.Point((h.padding.left-h.padding.right)/2,(h.padding.top-h.padding.bottom)/2).rotate(l*Math.PI/180),fe=xe.add(re).mult(x.scale/x.zoomScale(pe));return{center:x.unproject(S.add(A).div(2).sub(fe)),zoom:pe,bearing:l}}fitBounds(t,r,l){return this._fitInternal(this.cameraForBounds(t,r),r,l)}fitScreenCoordinates(t,r,l,h,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.Point.convert(t)),this.transform.pointLocation(a.Point.convert(r)),l,h),h,f)}_fitInternal(t,r,l){return t?(delete(r=a.extend(t,r)).padding,r.linear?this.easeTo(r,l):this.flyTo(r,l)):this}jumpTo(t,r){this.stop();const l=this._getTransformForUpdate();let h=!1,f=!1,x=!1;return"zoom"in t&&l.zoom!==+t.zoom&&(h=!0,l.zoom=+t.zoom),t.center!==void 0&&(l.center=a.LngLat.convert(t.center)),"bearing"in t&&l.bearing!==+t.bearing&&(f=!0,l.bearing=+t.bearing),"pitch"in t&&l.pitch!==+t.pitch&&(x=!0,l.pitch=+t.pitch),t.padding==null||l.isPaddingEqual(t.padding)||(l.padding=t.padding),this._applyUpdatedTransform(l),this.fire(new a.Event("movestart",r)).fire(new a.Event("move",r)),h&&this.fire(new a.Event("zoomstart",r)).fire(new a.Event("zoom",r)).fire(new a.Event("zoomend",r)),f&&this.fire(new a.Event("rotatestart",r)).fire(new a.Event("rotate",r)).fire(new a.Event("rotateend",r)),x&&this.fire(new a.Event("pitchstart",r)).fire(new a.Event("pitch",r)).fire(new a.Event("pitchend",r)),this.fire(new a.Event("moveend",r))}calculateCameraOptionsFromTo(t,r,l,h=0){const f=a.MercatorCoordinate.fromLngLat(t,r),x=a.MercatorCoordinate.fromLngLat(l,h),w=x.x-f.x,S=x.y-f.y,A=x.z-f.z,k=Math.hypot(w,S,A);if(k===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(w,S),$=this.transform.scaleZoom(this.transform.cameraToCenterDistance/k/this.transform.tileSize),Y=180*Math.atan2(w,-S)/Math.PI;let K=180*Math.acos(z/k)/Math.PI;return K=A<0?90-K:90+K,{center:x.toLngLat(),zoom:$,pitch:K,bearing:Y}}easeTo(t,r){this._stop(!1,t.easeId),((t=a.extend({offset:[0,0],duration:500,easing:a.defaultEasing},t)).animate===!1||!t.essential&&a.browser.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),h=this.getZoom(),f=this.getBearing(),x=this.getPitch(),w=this.getPadding(),S="zoom"in t?+t.zoom:h,A="bearing"in t?this._normalizeBearing(t.bearing,f):f,k="pitch"in t?+t.pitch:x,z="padding"in t?t.padding:l.padding,$=a.Point.convert(t.offset);let Y=l.centerPoint.add($);const K=l.pointLocation(Y),Q=a.LngLat.convert(t.center||K);this._normalizeCenter(Q);const X=l.project(K),pe=l.project(Q).sub(X),xe=l.zoomScale(S-h);let re,fe;t.around&&(re=a.LngLat.convert(t.around),fe=l.locationPoint(re));const Ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||S!==h,this._rotating=this._rotating||f!==A,this._pitching=this._pitching||k!==x,this._padding=!l.isPaddingEqual(z),this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,Ce),this.terrain&&this._prepareElevation(Q),this._ease(Me=>{if(this._zooming&&(l.zoom=a.interpolate.number(h,S,Me)),this._rotating&&(l.bearing=a.interpolate.number(f,A,Me)),this._pitching&&(l.pitch=a.interpolate.number(x,k,Me)),this._padding&&(l.interpolatePadding(w,z,Me),Y=l.centerPoint.add($)),this.terrain&&!t.freezeElevation&&this._updateElevation(Me),re)l.setLocationAtPoint(re,fe);else{const Re=l.zoomScale(l.zoom-h),We=S>h?Math.min(2,xe):Math.max(.5,xe),Oe=Math.pow(We,1-Me),tt=l.unproject(X.add(pe.mult(Me*Oe)).mult(Re));l.setLocationAtPoint(l.renderWorldCopies?tt.wrap():tt,Y)}this._applyUpdatedTransform(l),this._fireMoveEvents(r)},Me=>{this.terrain&&this._finalizeElevation(),this._afterEase(r,Me)},t),this}_prepareEase(t,r,l={}){this._moving=!0,r||l.moving||this.fire(new a.Event("movestart",t)),this._zooming&&!l.zooming&&this.fire(new a.Event("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new a.Event("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new a.Event("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&r!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(r-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=r}this.transform.elevation=a.interpolate.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const r=t.clone(),{center:l,zoom:h,pitch:f,bearing:x,elevation:w}=this.transformCameraUpdate(r);l&&(r.center=l),h!==void 0&&(r.zoom=h),f!==void 0&&(r.pitch=f),x!==void 0&&(r.bearing=x),w!==void 0&&(r.elevation=w),this.transform.apply(r)}_fireMoveEvents(t){this.fire(new a.Event("move",t)),this._zooming&&this.fire(new a.Event("zoom",t)),this._rotating&&this.fire(new a.Event("rotate",t)),this._pitching&&this.fire(new a.Event("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const l=this._zooming,h=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new a.Event("zoomend",t)),h&&this.fire(new a.Event("rotateend",t)),f&&this.fire(new a.Event("pitchend",t)),this.fire(new a.Event("moveend",t))}flyTo(t,r){if(!t.essential&&a.browser.prefersReducedMotion){const gt=a.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(gt,r)}this.stop(),t=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.defaultEasing},t);const l=this._getTransformForUpdate(),h=this.getZoom(),f=this.getBearing(),x=this.getPitch(),w=this.getPadding(),S="zoom"in t?a.clamp(+t.zoom,l.minZoom,l.maxZoom):h,A="bearing"in t?this._normalizeBearing(t.bearing,f):f,k="pitch"in t?+t.pitch:x,z="padding"in t?t.padding:l.padding,$=l.zoomScale(S-h),Y=a.Point.convert(t.offset);let K=l.centerPoint.add(Y);const Q=l.pointLocation(K),X=a.LngLat.convert(t.center||Q);this._normalizeCenter(X);const pe=l.project(Q),xe=l.project(X).sub(pe);let re=t.curve;const fe=Math.max(l.width,l.height),Ce=fe/$,Me=xe.mag();if("minZoom"in t){const gt=a.clamp(Math.min(t.minZoom,h,S),l.minZoom,l.maxZoom),$i=fe/l.zoomScale(gt-h);re=Math.sqrt($i/Me*2)}const Re=re*re;function We(gt){const $i=(Ce*Ce-fe*fe+(gt?-1:1)*Re*Re*Me*Me)/(2*(gt?Ce:fe)*Re*Me);return Math.log(Math.sqrt($i*$i+1)-$i)}function Oe(gt){return(Math.exp(gt)-Math.exp(-gt))/2}function tt(gt){return(Math.exp(gt)+Math.exp(-gt))/2}const vt=We(!1);let Qt=function(gt){return tt(vt)/tt(vt+re*gt)},rt=function(gt){return fe*((tt(vt)*(Oe($i=vt+re*gt)/tt($i))-Oe(vt))/Re)/Me;var $i},It=(We(!0)-vt)/re;if(Math.abs(Me)<1e-6||!isFinite(It)){if(Math.abs(fe-Ce)<1e-6)return this.easeTo(t,r);const gt=Ce<fe?-1:1;It=Math.abs(Math.log(Ce/fe))/re,rt=function(){return 0},Qt=function($i){return Math.exp(gt*re*$i)}}return t.duration="duration"in t?+t.duration:1e3*It/("screenSpeed"in t?+t.screenSpeed/re:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=f!==A,this._pitching=k!==x,this._padding=!l.isPaddingEqual(z),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(X),this._ease(gt=>{const $i=gt*It,ii=1/Qt($i);l.zoom=gt===1?S:h+l.scaleZoom(ii),this._rotating&&(l.bearing=a.interpolate.number(f,A,gt)),this._pitching&&(l.pitch=a.interpolate.number(x,k,gt)),this._padding&&(l.interpolatePadding(w,z,gt),K=l.centerPoint.add(Y)),this.terrain&&!t.freezeElevation&&this._updateElevation(gt);const Ot=gt===1?X:l.unproject(pe.add(xe.mult(rt($i))).mult(ii));l.setLocationAtPoint(l.renderWorldCopies?Ot.wrap():Ot,K),this._applyUpdatedTransform(l),this._fireMoveEvents(r)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(r)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,r)}if(!t){const l=this.handlers;l&&l.stop(!1)}return this}_ease(t,r,l){l.animate===!1||l.duration===0?(t(1),r()):(this._easeStart=a.browser.now(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,r){t=a.wrap(t,-180,180);const l=Math.abs(t-r);return Math.abs(t-360-r)<l&&(t-=360),Math.abs(t+360-r)<l&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(!r.renderWorldCopies||r.lngRange)return;const l=t.lng-r.center.lng;t.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(a.LngLat.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class Hn{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=F.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=F.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=F.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){F.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,r){const l=this._map._getUIString(`AttributionControl.${r}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(h=>typeof h!="string"?"":h)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const r=this._map.style.sourceCaches;for(const h in r){const f=r[h];if(f.used||f.usedForTerrain){const x=f.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t=t.filter(h=>String(h).trim()),t.sort((h,f)=>h.length-f.length),t=t.filter((h,f)=>{for(let x=f+1;x<t.length;x++)if(t[x].indexOf(h)>=0)return!1;return!0});const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class vs{constructor(t={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=F.create("div","maplibregl-ctrl");const r=F.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){F.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class zl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,l=r?this._queue.concat(r):this._queue;for(const h of l)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const l of r)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const bt={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var zt=a.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class ca extends a.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,r){this.sourceCache.update(t,r),this._renderableTilesKeys=[];const l={};for(const h of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.posMatrix=new Float64Array(16),a.ortho(h.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),this._tiles[h.key]=new fr(h,this.tileSize));for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(t){for(const r in this._tiles){const l=this._tiles[r];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const r={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID;if(h.canonical.equals(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16),a.ortho(f.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),r[l]=f}else if(h.canonical.isChildOf(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const x=h.canonical.z-t.canonical.z,w=h.canonical.x-(h.canonical.x>>x<<x),S=h.canonical.y-(h.canonical.y>>x<<x),A=a.EXTENT>>x;a.ortho(f.posMatrix,0,A,0,A,0,1),a.translate(f.posMatrix,f.posMatrix,[-w*A,-S*A,0]),r[l]=f}else if(t.canonical.isChildOf(h.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const x=t.canonical.z-h.canonical.z,w=t.canonical.x-(t.canonical.x>>x<<x),S=t.canonical.y-(t.canonical.y>>x<<x),A=a.EXTENT>>x;a.ortho(f.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),a.translate(f.posMatrix,f.posMatrix,[w*A,S*A,0]),a.scale(f.posMatrix,f.posMatrix,[1/2**x,1/2**x,0]),r[l]=f}}return r}getSourceTile(t,r){const l=this.sourceCache._source;let h=t.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!f||!f.dem)&&r)for(;h>=l.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(t.scaledTo(h--).key);return f}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(r=>r.timeAdded>=t)}}class Oo{constructor(t,r,l){this.painter=t,this.sourceCache=new ca(r),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,r,l,h=a.EXTENT){var f;if(!(r>=0&&r<h&&l>=0&&l<h))return 0;const x=this.getTerrainData(t),w=(f=x.tile)===null||f===void 0?void 0:f.dem;if(!w)return 0;const S=function(K,Q,X){var pe=Q[0],xe=Q[1];return K[0]=X[0]*pe+X[4]*xe+X[12],K[1]=X[1]*pe+X[5]*xe+X[13],K}([],[r/h*a.EXTENT,l/h*a.EXTENT],x.u_terrain_matrix),A=[S[0]*w.dim,S[1]*w.dim],k=Math.floor(A[0]),z=Math.floor(A[1]),$=A[0]-k,Y=A[1]-z;return w.get(k,z)*(1-$)*(1-Y)+w.get(k+1,z)*$*(1-Y)+w.get(k,z+1)*(1-$)*Y+w.get(k+1,z+1)*$*Y}getElevationForLngLatZoom(t,r){const{tileID:l,mercatorX:h,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(t,r);return this.getElevation(l,h%a.EXTENT,f%a.EXTENT,a.EXTENT)}getElevation(t,r,l,h=a.EXTENT){return this.getDEMElevation(t,r,l,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const h=this.painter.context,f=new a.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Nt(h,f,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Nt(h,new a.RGBAImage({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.identity([])}const r=this.sourceCache.getSourceTile(t,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const h=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new Nt(h,r.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),r.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const l=r&&r+r.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const h=this.sourceCache.sourceCache._source.maxzoom;let f=t.canonical.z-r.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?f=t.canonical.z-h:a.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=t.canonical.x-(t.canonical.x>>f<<f),w=t.canonical.y-(t.canonical.y>>f<<f),S=a.fromScaling(new Float64Array(16),[1/(a.EXTENT<<f),1/(a.EXTENT<<f),0]);a.translate(S,S,[x*a.EXTENT,w*a.EXTENT,0]),this._demMatrixCache[t.key]={matrix:S,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(t){const r=this.painter,l=r.width/devicePixelRatio,h=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Nt(r.context,{width:l,height:h,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Nt(r.context,{width:l,height:h,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,x=0;f<this._coordsTextureSize;f++)for(let w=0;w<this._coordsTextureSize;w++,x+=4)r[x+0]=255&w,r[x+1]=255&f,r[x+2]=w>>8<<4|f>>8,r[x+3]=0;const l=new a.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),h=new Nt(t,l,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){const r=new Uint8Array(4),l=this.painter.context,h=l.gl;l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null);const f=r[0]+(r[2]>>4<<8),x=r[1]+((15&r[2])<<8),w=this.coordsIndex[255-r[3]],S=w&&this.sourceCache.getTileByID(w);if(!S)return null;const A=this._coordsTextureSize,k=(1<<S.tileID.canonical.z)*A;return new a.MercatorCoordinate((S.tileID.canonical.x*A+f)/k,(S.tileID.canonical.y*A+x)/k,this.getElevation(S.tileID,f,x,A))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,r=new a.Pos3dArray,l=new a.TriangleIndexArray,h=this.meshSize,f=a.EXTENT/h,x=h*h;for(let z=0;z<=h;z++)for(let $=0;$<=h;$++)r.emplaceBack($*f,z*f,0);for(let z=0;z<x;z+=h+1)for(let $=0;$<h;$++)l.emplaceBack($+z,h+$+z+1,h+$+z+2),l.emplaceBack($+z,h+$+z+2,$+z+1);const w=r.length,S=w+2*(h+1);for(const z of[0,1])for(let $=0;$<=h;$++)for(const Y of[0,1])r.emplaceBack($*f,z*a.EXTENT,Y);for(let z=0;z<2*h;z+=2)l.emplaceBack(S+z,S+z+1,S+z+3),l.emplaceBack(S+z,S+z+3,S+z+2),l.emplaceBack(w+z,w+z+3,w+z+1),l.emplaceBack(w+z,w+z+2,w+z+3);const A=r.length,k=A+2*(h+1);for(const z of[0,1])for(let $=0;$<=h;$++)for(const Y of[0,1])r.emplaceBack(z*a.EXTENT,$*f,Y);for(let z=0;z<2*h;z+=2)l.emplaceBack(A+z,A+z+1,A+z+3),l.emplaceBack(A+z,A+z+3,A+z+2),l.emplaceBack(k+z,k+z+3,k+z+1),l.emplaceBack(k+z,k+z+2,k+z+3);return this._mesh={indexBuffer:t.createIndexBuffer(l),vertexBuffer:t.createVertexBuffer(r,zt.members),segments:a.SegmentVector.simpleSegment(0,0,r.length,l.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*a.earthRadius/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,r){var l;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,r);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const r=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return r&&r.dem&&(l.minElevation=r.dem.min*this.exaggeration,l.maxElevation=r.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,r){const l=a.MercatorCoordinate.fromLngLat(t.wrap()),h=(1<<r)*a.EXTENT,f=l.x*h,x=l.y*h,w=Math.floor(f/a.EXTENT),S=Math.floor(x/a.EXTENT);return{tileID:new a.OverscaledTileID(r,0,r,w,S),mercatorX:f,mercatorY:x}}}class Xa{constructor(t,r,l){this._context=t,this._size=r,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new Nt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(l.texture),{id:t,fbo:r,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>t.id!==r),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Ki={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ua{constructor(t,r){this.painter=t,this.terrain=r,this.pool=new Xa(t.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(l=>!t._layers[l].isHidden(r)),this._coordsDescendingInv={};for(const l in t.sourceCaches){this._coordsDescendingInv[l]={};const h=t.sourceCaches[l].getVisibleCoordinates();for(const f of h){const x=this.terrain.sourceCache.getTerrainCoords(f);for(const w in x)this._coordsDescendingInv[l][w]||(this._coordsDescendingInv[l][w]=[]),this._coordsDescendingInv[l][w].push(x[w])}}this._coordsDescendingInvStr={};for(const l of t._order){const h=t._layers[l],f=h.source;if(Ki[h.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const x in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][x]=this._coordsDescendingInv[f][x].map(w=>w.key).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[h][l.tileID.key];f&&f!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const r=t.type,l=this.painter,h=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Ki[r]&&(this._prevType&&Ki[this._prevType]||this._stacks.push([]),this._prevType=r,this._stacks[this._stacks.length-1].push(t.id),!h))return!0;if(Ki[this._prevType]||Ki[r]&&h){this._prevType=r;const f=this._stacks.length-1,x=this._stacks[f]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(Sl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[f]){const A=this.pool.getObjectForId(w.rtt[f].id);if(A.stamp===w.rtt[f].stamp){this.pool.useObject(A);continue}}const S=this.pool.getOrCreateFreeObject();this.pool.useObject(S),this.pool.stampObject(S),w.rtt[f]={id:S.id,stamp:S.stamp},l.context.bindFramebuffer.set(S.fbo.framebuffer),l.context.clear({color:a.Color.transparent,stencil:0}),l.currentStencilSource=void 0;for(let A=0;A<x.length;A++){const k=l.style._layers[x[A]],z=k.source?this._coordsDescendingInv[k.source][w.tileID.key]:[w.tileID];l.context.viewport.set([0,0,S.fbo.width,S.fbo.height]),l._renderTileClippingMasks(k,z),l.renderLayer(l,l.style.sourceCaches[k.source],k,z),k.source&&(w.rttCoords[k.source]=this._coordsDescendingInvStr[k.source][w.tileID.key])}}return Sl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ki[r]}return!1}}const Lr=V,Dl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},xs=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},nn={showCompass:!0,showZoom:!0,visualizePitch:!1};class bn{constructor(t,r,l=!1){this.mousedown=x=>{this.startMouse(a.extend({},x,{ctrlKey:!0,preventDefault:()=>x.preventDefault()}),F.mousePos(this.element,x)),F.addEventListener(window,"mousemove",this.mousemove),F.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.moveMouse(x,F.mousePos(this.element,x))},this.mouseup=x=>{this.mouseRotate.dragEnd(x),this.mousePitch&&this.mousePitch.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=F.touchPos(this.element,x.targetTouches)[0],this.startTouch(x,this._startPos),F.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),F.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=F.touchPos(this.element,x.targetTouches)[0],this.moveTouch(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const h=t.dragRotate._mouseRotate.getClickTolerance(),f=t.dragRotate._mousePitch.getClickTolerance();this.element=r,this.mouseRotate=ht({clickTolerance:h,enable:!0}),this.touchRotate=(({enable:x,clickTolerance:w,bearingDegreesPerPixelMoved:S=.8})=>{const A=new oa;return new dt({clickTolerance:w,move:(k,z)=>({bearingDelta:(z.x-k.x)*S}),moveStateManager:A,enable:x,assignEvents:xs})})({clickTolerance:h,enable:!0}),this.map=t,l&&(this.mousePitch=Al({clickTolerance:f,enable:!0}),this.touchPitch=(({enable:x,clickTolerance:w,pitchDegreesPerPixelMoved:S=-.5})=>{const A=new oa;return new dt({clickTolerance:w,move:(k,z)=>({pitchDelta:(z.y-k.y)*S}),moveStateManager:A,enable:x,assignEvents:xs})})({clickTolerance:f,enable:!0})),F.addEventListener(r,"mousedown",this.mousedown),F.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),F.addEventListener(r,"touchcancel",this.reset)}startMouse(t,r){this.mouseRotate.dragStart(t,r),this.mousePitch&&this.mousePitch.dragStart(t,r),F.disableDrag()}startTouch(t,r){this.touchRotate.dragStart(t,r),this.touchPitch&&this.touchPitch.dragStart(t,r),F.disableDrag()}moveMouse(t,r){const l=this.map,{bearingDelta:h}=this.mouseRotate.dragMove(t,r)||{};if(h&&l.setBearing(l.getBearing()+h),this.mousePitch){const{pitchDelta:f}=this.mousePitch.dragMove(t,r)||{};f&&l.setPitch(l.getPitch()+f)}}moveTouch(t,r){const l=this.map,{bearingDelta:h}=this.touchRotate.dragMove(t,r)||{};if(h&&l.setBearing(l.getBearing()+h),this.touchPitch){const{pitchDelta:f}=this.touchPitch.dragMove(t,r)||{};f&&l.setPitch(l.getPitch()+f)}}off(){const t=this.element;F.removeEventListener(t,"mousedown",this.mousedown),F.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),F.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),F.removeEventListener(window,"touchend",this.touchend),F.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){F.enableDrag(),F.removeEventListener(window,"mousemove",this.mousemove),F.removeEventListener(window,"mouseup",this.mouseup),F.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),F.removeEventListener(window,"touchend",this.touchend)}}let js;function ha(p,t,r){if(p=new a.LngLat(p.lng,p.lat),t){const l=new a.LngLat(p.lng-360,p.lat),h=new a.LngLat(p.lng+360,p.lat),f=r.locationPoint(p).distSqr(t);r.locationPoint(l).distSqr(t)<f?p=l:r.locationPoint(h).distSqr(t)<f&&(p=h)}for(;Math.abs(p.lng-r.center.lng)>180;){const l=r.locationPoint(p);if(l.x>=0&&l.y>=0&&l.x<=r.width&&l.y<=r.height)break;p.lng>r.center.lng?p.lng-=360:p.lng+=360}return p}const pa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Uo(p,t,r){const l=p.classList;for(const h in pa)l.remove(`maplibregl-${r}-anchor-${h}`);l.add(`maplibregl-${r}-anchor-${t}`)}class Ws extends a.Evented{constructor(t){if(super(),this._onKeyPress=r=>{const l=r.code,h=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=r=>{const l=r.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=r=>{if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=ha(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let l="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?l=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(l=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let h="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?h="rotateX(0deg)":this._pitchAlignment==="map"&&(h=`rotateX(${this._map.getPitch()}deg)`),r&&r.type!=="moveend"||(this._pos=this._pos.round()),F.setTransform(this._element,`${pa[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${h} ${l}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const f=this._map.unproject(this._pos),x=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=f.distanceTo(this._lngLat)>20*x?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=r=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=a.Point.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=F.create("div"),this._element.setAttribute("aria-label","Map marker");const r=F.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${l}px`),r.setAttributeNS(null,"width",`${h}px`),r.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const f=F.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const x=F.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const w=F.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const pe of S){const xe=F.createNS("http://www.w3.org/2000/svg","ellipse");xe.setAttributeNS(null,"opacity","0.04"),xe.setAttributeNS(null,"cx","10.5"),xe.setAttributeNS(null,"cy","5.80029008"),xe.setAttributeNS(null,"rx",pe.rx),xe.setAttributeNS(null,"ry",pe.ry),w.appendChild(xe)}const A=F.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const k=F.createNS("http://www.w3.org/2000/svg","path");k.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(k);const z=F.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const $=F.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild($);const Y=F.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Y.setAttributeNS(null,"fill","#FFFFFF");const K=F.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Q=F.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#000000"),Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962");const X=F.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#FFFFFF"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962"),K.appendChild(Q),K.appendChild(X),x.appendChild(w),x.appendChild(A),x.appendChild(z),x.appendChild(Y),x.appendChild(K),r.appendChild(x),r.setAttributeNS(null,"height",l*this._scale+"px"),r.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(r),this._offset=a.Point.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),Uo(this._element,this._anchor,"marker"),t&&t.className)for(const r of t.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),F.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const h=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=a.Point.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Ll={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Z=0,ps=!1;const da={maxWidth:100,unit:"metric"};function vr(p,t,r){const l=r&&r.maxWidth||100,h=p._container.clientHeight/2,f=p.unproject([0,h]),x=p.unproject([l,h]),w=f.distanceTo(x);if(r&&r.unit==="imperial"){const S=3.2808*w;S>5280?Jt(t,l,S/5280,p._getUIString("ScaleControl.Miles")):Jt(t,l,S,p._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?Jt(t,l,w/1852,p._getUIString("ScaleControl.NauticalMiles")):w>=1e3?Jt(t,l,w/1e3,p._getUIString("ScaleControl.Kilometers")):Jt(t,l,w,p._getUIString("ScaleControl.Meters"))}function Jt(p,t,r,l){const h=function(f){const x=Math.pow(10,`${Math.floor(f)}`.length-1);let w=f/x;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(S){const A=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*A)/A}(w),x*w}(r);p.style.width=t*(h/r)+"px",p.innerHTML=`${h}&nbsp;${l}`}const Ec={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ac=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Rl(p){if(p){if(typeof p=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(p,2)));return{center:new a.Point(0,0),top:new a.Point(0,p),"top-left":new a.Point(t,t),"top-right":new a.Point(-t,t),bottom:new a.Point(0,-p),"bottom-left":new a.Point(t,-t),"bottom-right":new a.Point(-t,-t),left:new a.Point(p,0),right:new a.Point(-p,0)}}if(p instanceof a.Point||Array.isArray(p)){const t=a.Point.convert(p);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:a.Point.convert(p.center||[0,0]),top:a.Point.convert(p.top||[0,0]),"top-left":a.Point.convert(p["top-left"]||[0,0]),"top-right":a.Point.convert(p["top-right"]||[0,0]),bottom:a.Point.convert(p.bottom||[0,0]),"bottom-left":a.Point.convert(p["bottom-left"]||[0,0]),"bottom-right":a.Point.convert(p["bottom-right"]||[0,0]),left:a.Point.convert(p.left||[0,0]),right:a.Point.convert(p.right||[0,0])}}return Rl(new a.Point(0,0))}const Hs={extend:(p,...t)=>a.extend(p,...t),run(p){p()},logToElement(p,t=!1,r="log"){const l=window.document.getElementById(r);l&&(t&&(l.innerHTML=""),l.innerHTML+=`<br>${p}`)}},Bl=V;class bi{static get version(){return Bl}static get workerCount(){return Dn.workerCount}static set workerCount(t){Dn.workerCount=t}static get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){a.config.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return a.config.WORKER_URL}static set workerUrl(t){a.config.WORKER_URL=t}static addProtocol(t,r){a.config.REGISTERED_PROTOCOLS[t]=r}static removeProtocol(t){delete a.config.REGISTERED_PROTOCOLS[t]}}return bi.Map=class extends An{constructor(p){if(a.PerformanceUtils.mark(a.PerformanceMarkers.create),(p=a.extend({},Dl,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new $a(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),{bearingSnap:p.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._cooperativeGestures=p.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new zl,this._controls=[],this._mapId=a.uniqueId(),this._locale=a.extend({},bt,p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this._imageQueueHandle=De.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ct(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;this._resizeObserver=new ResizeObserver(r=>{t?this._trackResize&&this.resize(r)._update():t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ou(this,p),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=p.hash&&new Do(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,a.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new Hn({customAttribution:p.customAttribution})),p.maplibreLogo&&this.addControl(new vs,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new a.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new a.Event(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new a.Event("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(p,t){if(t===void 0&&(t=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=p.onAdd(this);this._controls.push(p);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(r,l.firstChild):l.appendChild(r),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(p);return t>-1&&this._controls.splice(t,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,t,r,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,t,r,l)}resize(p){var t;const r=this._containerDimensions(),l=r[0],h=r[1],f=this._getClampedPixelRatio(l,h);if(this._resizeCanvas(l,h,f),this.painter.resize(l,h,f),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const S=this._getClampedPixelRatio(l,h);this._resizeCanvas(l,h,S),this.painter.resize(l,h,S)}this.transform.resize(l,h),(t=this._requestedCameraState)===null||t===void 0||t.resize(l,h);const x=!this._moving;return x&&(this.stop(),this.fire(new a.Event("movestart",p)).fire(new a.Event("move",p))),this.fire(new a.Event("resize",p)),x&&this.fire(new a.Event("moveend",p)),this}_getClampedPixelRatio(p,t){const{0:r,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),f=p*h,x=t*h;return Math.min(f>r?r/f:1,x>l?l/x:1)*h}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(xi.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(p){return this.transform.locationPoint(a.LngLat.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(a.Point.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,t,r){if(p==="mouseenter"||p==="mouseover"){let l=!1;return{layer:t,listener:r,delegates:{mousemove:f=>{const x=this.getLayer(t)?this.queryRenderedFeatures(f.point,{layers:[t]}):[];x.length?l||(l=!0,r.call(this,new ct(p,this,f.originalEvent,{features:x}))):l=!1},mouseout:()=>{l=!1}}}}if(p==="mouseleave"||p==="mouseout"){let l=!1;return{layer:t,listener:r,delegates:{mousemove:x=>{(this.getLayer(t)?this.queryRenderedFeatures(x.point,{layers:[t]}):[]).length?l=!0:l&&(l=!1,r.call(this,new ct(p,this,x.originalEvent)))},mouseout:x=>{l&&(l=!1,r.call(this,new ct(p,this,x.originalEvent)))}}}}{const l=h=>{const f=this.getLayer(t)?this.queryRenderedFeatures(h.point,{layers:[t]}):[];f.length&&(h.features=f,r.call(this,h),delete h.features)};return{layer:t,listener:r,delegates:{[p]:l}}}}on(p,t,r){if(r===void 0)return super.on(p,t);const l=this._createDelegatedListener(p,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(l);for(const h in l.delegates)this.on(h,l.delegates[h]);return this}once(p,t,r){if(r===void 0)return super.once(p,t);const l=this._createDelegatedListener(p,t,r);for(const h in l.delegates)this.once(h,l.delegates[h]);return this}off(p,t,r){return r===void 0?super.off(p,t):(this._delegatedListeners&&this._delegatedListeners[p]&&(l=>{const h=this._delegatedListeners[p];for(let f=0;f<h.length;f++){const x=h[f];if(x.layer===t&&x.listener===r){for(const w in x.delegates)this.off(w,x.delegates[w]);return h.splice(f,1),this}}})(),this)}queryRenderedFeatures(p,t){if(!this.style)return[];let r;const l=p instanceof a.Point||Array.isArray(p),h=l?p:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:p)||{},h instanceof a.Point||typeof h[0]=="number")r=[a.Point.convert(h)];else{const f=a.Point.convert(h[0]),x=a.Point.convert(h[1]);r=[f,new a.Point(x.x,f.y),x,new a.Point(f.x,x.y),f]}return this.style.queryRenderedFeatures(r,t,this.transform)}querySourceFeatures(p,t){return this.style.querySourceFeatures(p,t)}setStyle(p,t){return(t=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(p,t))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const t=this._locale[p];if(t==null)throw new Error(`Missing UI string '${p}'`);return t}_updateStyle(p,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,t));const r=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new Wn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,t,r):this.style.loadJSON(p,t,r),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Wn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,t){if(typeof p=="string"){const r=this._requestManager.transformRequest(p,Ze.Style);a.getJSON(r,(l,h)=>{l?this.fire(new a.ErrorEvent(l)):h&&this._updateDiff(h,t)})}else typeof p=="object"&&this._updateDiff(p,t)}_updateDiff(p,t){try{this.style.setState(p,t)&&this._update(!0)}catch(r){a.warnOnce(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(p,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")}addSource(p,t){return this._lazyInitEmptyStyle(),this.style.addSource(p,t),this._update(!0)}isSourceLoaded(p){const t=this.style&&this.style.sourceCaches[p];if(t!==void 0)return t.loaded();this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const t=this.style.sourceCaches[p.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);for(const r in this.style._layers){const l=this.style._layers[r];l.type==="hillshade"&&l.source===p.source&&a.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Oo(this.painter,t,p),this.painter.renderToTexture=new ua(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=r=>{r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==p.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.Event("terrain",{terrain:p})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const t in p){const r=p[t]._tiles;for(const l in r){const h=r[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}}return!0}addSourceType(p,t,r){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,t,r)}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,t,r={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:f,stretchY:x,content:w}=r;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||a.isImageBitmap(t))){if(t.width===void 0||t.height===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:A,data:k}=t,z=t;return this.style.addImage(p,{data:new a.RGBAImage({width:S,height:A},new Uint8Array(k)),pixelRatio:l,stretchX:f,stretchY:x,content:w,sdf:h,version:0,userImage:z}),z.onAdd&&z.onAdd(this,p),this}}{const{width:S,height:A,data:k}=a.browser.getImageData(t);this.style.addImage(p,{data:new a.RGBAImage({width:S,height:A},k),pixelRatio:l,stretchX:f,stretchY:x,content:w,sdf:h,version:0})}}updateImage(p,t){const r=this.style.getImage(p);if(!r)return this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||a.isImageBitmap(t)?a.browser.getImageData(t):t,{width:h,height:f,data:x}=l;if(h===void 0||f===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==r.data.width||f!==r.data.height)return this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(t instanceof HTMLImageElement||a.isImageBitmap(t));return r.data.replace(x,w),this.style.updateImage(p,r),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,t){De.getImage(this._requestManager.transformRequest(p,Ze.Image),t)}listImages(){return this.style.listImages()}addLayer(p,t){return this._lazyInitEmptyStyle(),this.style.addLayer(p,t),this._update(!0)}moveLayer(p,t){return this.style.moveLayer(p,t),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,t,r){return this.style.setLayerZoomRange(p,t,r),this._update(!0)}setFilter(p,t,r={}){return this.style.setFilter(p,t,r),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,t,r,l={}){return this.style.setPaintProperty(p,t,r,l),this._update(!0)}getPaintProperty(p,t){return this.style.getPaintProperty(p,t)}setLayoutProperty(p,t,r,l={}){return this.style.setLayoutProperty(p,t,r,l),this._update(!0)}getLayoutProperty(p,t){return this.style.getLayoutProperty(p,t)}setGlyphs(p,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,t,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,t,r,l=>{l||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,t,r=>{r||this._update(!0)}),this}setLight(p,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(p,t){return this.style.setFeatureState(p,t),this._update()}removeFeatureState(p,t){return this.style.removeFeatureState(p,t),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,t=0;return this._container&&(p=this._container.clientWidth||400,t=this._container.clientHeight||300),[p,t]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const t=this._canvasContainer=F.create("div","maplibregl-canvas-container",p);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=F.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),l=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],l);const h=this._controlContainer=F.create("div","maplibregl-control-container",p),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{f[x]=F.create("div",`maplibregl-ctrl-${x} `,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=F.create("div","maplibregl-cooperative-gesture-screen",this._container);let p=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(p=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${p}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){F.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(p,t,r){this._canvas.width=Math.floor(r*p),this._canvas.height=Math.floor(r*t),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{t={requestedAttributes:p},l&&(t.statusMessage=l.statusMessage,t.type=l.type)},{once:!0});const r=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!r){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new iu(r,this.transform),ce.testSupport(r)}_onCooperativeGesture(p,t,r){return!t&&r<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let r=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const h=this.transform.zoom,f=a.browser.now();this.style.zoomHistory.update(h,f);const x=new a.EvaluationParameters(h,{now:f,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=x.crossFadingFactor();w===1&&w===this._crossFadingFactor||(r=!0,this._crossFadingFactor=w),this.style.update(x)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.load),this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||r)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.Event("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),De.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),F.remove(this._canvasContainer),F.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),a.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.browser.frame(p=>{a.PerformanceUtils.frame(p),this._frame=null,this._render(p)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return Lr}getCameraTargetElevation(){return this.transform.elevation}},bi.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const t=this._map.getZoom(),r=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,r)=>{const l=this._map._getUIString(`NavigationControl.${r}`);t.title=l,t.setAttribute("aria-label",l)},this.options=a.extend({},nn,p),this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),F.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),F.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=F.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new bn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){F.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,t){const r=F.create("button",p,this._container);return r.type="button",r.addEventListener("click",t),r}},bi.GeolocateControl=class extends a.Evented{constructor(p){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.Event("geolocate",t)),this._finish()}},this._updateCamera=t=>{const r=new a.LngLat(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,h=this._map.getBearing(),f=a.extend({bearing:h},this.options.fitBoundsOptions),x=xi.fromLngLat(r,l);this._map.fitBounds(x,f,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const r=new a.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ps)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.Event("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=F.create("button","maplibregl-ctrl-geolocate",this._container),F.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ws({element:this._dotElement}),this._circleElement=F.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ws({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}},this.options=a.extend({},Ll,p)}onAdd(p){return this._map=p,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,r=!1){js===void 0||r?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(l=>{js=l.state!=="denied",t(js)}).catch(()=>{js=!!window.navigator.geolocation,t(js)}):(js=!!window.navigator.geolocation,t(js)):t(js)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),F.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Z=0,ps=!1}_isOutOfMapMaxBounds(p){const t=this._map.getMaxBounds(),r=p.coords;return t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),t=p.getSouthEast(),r=p.getNorthEast(),l=t.distanceTo(r),h=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Z--,ps=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Z++,Z>1?(p={maximumAge:6e5,timeout:0},ps=!0):(p=this.options.positionOptions,ps=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},bi.AttributionControl=Hn,bi.LogoControl=vs,bi.ScaleControl=class{constructor(p){this._onMove=()=>{vr(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,vr(this._map,this._container,this.options)},this.options=a.extend({},da,p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){F.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},bi.FullscreenControl=class extends a.Evented{constructor(p={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){F.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=F.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);F.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.Event("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new a.Event("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},bi.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=p}onAdd(p){return this._map=p,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=F.create("button","maplibregl-ctrl-terrain",this._container),F.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){F.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},bi.Popup=class extends a.Evented{constructor(p){super(),this.remove=()=>(this._content&&F.remove(this._content),this._container&&(F.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=F.create("div","maplibregl-popup",this._map.getContainer()),this._tip=F.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ha(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const r=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let l=this.options.anchor;const h=Rl(this.options.offset);if(!l){const x=this._container.offsetWidth,w=this._container.offsetHeight;let S;S=r.y+h.bottom.y<w?["top"]:r.y>this._map.transform.height-w?["bottom"]:[],r.x<x/2?S.push("left"):r.x>this._map.transform.width-x/2&&S.push("right"),l=S.length===0?"bottom":S.join("-")}const f=r.add(h[l]).round();F.setTransform(this._container,`${pa[l]} translate(${f.x}px,${f.y}px)`),Uo(this._container,l,"popup")},this._onClose=()=>{this.remove()},this.options=a.extend(Object.create(Ec),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=a.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const t=document.createDocumentFragment(),r=document.createElement("body");let l;for(r.innerHTML=p;l=r.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=F.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){this._container&&this._container.classList.add(p)}removeClassName(p){this._container&&this._container.classList.remove(p)}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}_createCloseButton(){this.options.closeButton&&(this._closeButton=F.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Ac);p&&p.focus()}},bi.Marker=Ws,bi.Style=Wn,bi.LngLat=a.LngLat,bi.LngLatBounds=xi,bi.Point=a.Point,bi.MercatorCoordinate=a.MercatorCoordinate,bi.Evented=a.Evented,bi.AJAXError=a.AJAXError,bi.config=a.config,bi.CanvasSource=ke,bi.GeoJSONSource=tr,bi.ImageSource=On,bi.RasterDEMTileSource=Ir,bi.RasterTileSource=pr,bi.VectorTileSource=ss,bi.VideoSource=dr,bi.setRTLTextPlugin=a.setRTLTextPlugin,bi.getRTLTextPluginStatus=a.getRTLTextPluginStatus,bi.prewarm=function(){mr().acquire(Je)},bi.clearPrewarmedResources=function(){const p=Hi;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(Je),Hi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Hs.extend(bi,{isSafari:a.isSafari,getPerformanceMetrics:a.PerformanceUtils.getPerformanceMetrics}),bi});var L=R;return L})})(cg);var hg=cg.exports;const Vs=dy(hg);const qs="/maplibre-gl-directions/assets/style-7d708b4d.json";var fy=Object.defineProperty,my=(b,g,_)=>g in b?fy(b,g,{enumerable:!0,configurable:!0,writable:!0,value:_}):b[g]=_,Xt=(b,g,_)=>(my(b,typeof g!="symbol"?g+"":g,_),_);class gy{constructor(g){Xt(this,"map"),Xt(this,"listeners",{}),Xt(this,"oneTimeListeners",{}),this.map=g}fire(g){var _,C;g.target=this.map;const R=g.type;(_=this.listeners[R])==null||_.forEach(M=>M(g)),(C=this.oneTimeListeners[R])==null||C.forEach(M=>{var L,a;M(g);const V=(L=this.oneTimeListeners[R])==null?void 0:L.indexOf(M);V!==void 0&&~V&&((a=this.oneTimeListeners[R])==null||a.splice(V,1))})}on(g,_){this.listeners[g]=this.listeners[g]??[],this.listeners[g].push(_)}off(g,_){var C,R;const M=(C=this.listeners[g])==null?void 0:C.indexOf(_);M!==void 0&&~M&&((R=this.listeners[g])==null||R.splice(M,1))}once(g,_){this.oneTimeListeners[g]=this.oneTimeListeners[g]??[],this.oneTimeListeners[g].push(_)}}class jc{constructor(g,_,C){Xt(this,"type"),Xt(this,"target"),Xt(this,"originalEvent"),Xt(this,"data"),this.type=g,this.originalEvent=_,this.data=C}}class zm{constructor(g,_,C){Xt(this,"type"),Xt(this,"target"),Xt(this,"originalEvent"),Xt(this,"data"),this.type=g,this.originalEvent=_,this.data=C}}const _y={api:"https://router.project-osrm.org/route/v1",profile:"driving",requestOptions:{},requestTimeout:null,makePostRequest:!1,sourceName:"maplibre-gl-directions",pointsScalingFactor:1,linesScalingFactor:1,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint","maplibre-gl-directions-waypoint-casing"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint","maplibre-gl-directions-snappoint-casing"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline","maplibre-gl-directions-routeline-casing"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline","maplibre-gl-directions-alt-routeline-casing"],dragThreshold:10,refreshOnMove:!1,bearings:!1},Ur={snapline:"#34343f",altRouteline:"#9e91be",routelineFoot:"#3665ff",routelineBike:"#63c4ff",routeline:"#7b51f8",congestionLow:"#42c74c",congestionHigh:"#d72359",hoverpoint:"#30a856",snappoint:"#cb3373",snappointHighlight:"#e50d3f",waypointFoot:"#3665ff",waypointFootHighlight:"#0942ff",waypointBike:"#63c4ff",waypointBikeHighlight:"#0bb8ff",waypoint:"#7b51f8",waypointHighlight:"#6d26d7"},Dm=["case",["==",["get","profile",["get","arriveSnappointProperties"]],"foot"],Ur.routelineFoot,["==",["get","profile",["get","arriveSnappointProperties"]],"bike"],Ur.routelineBike,["interpolate-hcl",["linear"],["get","congestion"],0,Ur.routeline,1,Ur.congestionLow,100,Ur.congestionHigh]],Lm=["case",["==",["get","profile"],"foot"],["case",["boolean",["get","highlight"],!1],Ur.waypointFootHighlight,Ur.waypointFoot],["==",["get","profile"],"bike"],["case",["boolean",["get","highlight"],!1],Ur.waypointBikeHighlight,Ur.waypointBike],["case",["boolean",["get","highlight"],!1],Ur.waypointHighlight,Ur.waypoint]],Rm=["case",["boolean",["get","highlight"],!1],Ur.snappointHighlight,Ur.snappoint];function jd(b=1,g=1,_="maplibre-gl-directions"){const C=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],14*b,12*b],5,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],14*b,12*b],18,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],33*b,28*b]],R=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],9*b,7*b],5,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],9*b,7*b],18,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],21*b,16*b]],M=["interpolate",["exponential",1.5],["zoom"],0,3*g,5,3*g,18,10*g],L=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],10*g,7*g],5,["case",["boolean",["get","highlight"],!1],10*g,7*g],18,["case",["boolean",["get","highlight"],!1],32*g,23*g]];return[{id:`${_}-snapline`,type:"line",source:_,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":Ur.snapline,"line-opacity":.65,"line-width":3},filter:["==",["get","type"],"SNAPLINE"]},{id:`${_}-alt-routeline-casing`,type:"line",source:_,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":Ur.altRouteline,"line-opacity":.55,"line-width":L},filter:["==",["get","route"],"ALT"]},{id:`${_}-alt-routeline`,type:"line",source:_,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":Ur.altRouteline,"line-opacity":.85,"line-width":M},filter:["==",["get","route"],"ALT"]},{id:`${_}-routeline-casing`,type:"line",source:_,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":Dm,"line-opacity":.55,"line-width":L},filter:["==",["get","route"],"SELECTED"]},{id:`${_}-routeline`,type:"line",source:_,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":Dm,"line-opacity":.85,"line-width":M},filter:["==",["get","route"],"SELECTED"]},{id:`${_}-hoverpoint-casing`,type:"circle",source:_,paint:{"circle-radius":C,"circle-color":Ur.hoverpoint,"circle-opacity":.65},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${_}-hoverpoint`,type:"circle",source:_,paint:{"circle-radius":R,"circle-color":Ur.hoverpoint},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${_}-snappoint-casing`,type:"circle",source:_,paint:{"circle-radius":C,"circle-color":Rm,"circle-opacity":.65},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${_}-snappoint`,type:"circle",source:_,paint:{"circle-radius":R,"circle-color":Rm},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${_}-waypoint-casing`,type:"circle",source:_,paint:{"circle-radius":C,"circle-color":Lm,"circle-opacity":.65},filter:["==",["get","type"],"WAYPOINT"]},{id:`${_}-waypoint`,type:"circle",source:_,paint:{"circle-radius":R,"circle-color":Lm},filter:["==",["get","type"],"WAYPOINT"]}]}let pg=(b=21)=>crypto.getRandomValues(new Uint8Array(b)).reduce((g,_)=>(_&=63,_<36?g+=_.toString(36):_<62?g+=(_-26).toString(36).toUpperCase():_>62?g+="-":g+="_",g),"");function Bm(b){return b&1?~(b>>1):b>>1}function Fm(b,g=5){const _=Math.pow(10,g);let C=0,R=0,M=0;const L=[];let a=0,V=0,F=null,ce,ee;for(;C<b.length;){F=null,a=0,V=0;do F=b.charCodeAt(C++)-63,V|=(F&31)<<a,a+=5;while(F>=32);ce=Bm(V),a=V=0;do F=b.charCodeAt(C++)-63,V|=(F&31)<<a,a+=5;while(F>=32);ee=Bm(V),R+=ce,M+=ee,L.push([M/_,R/_])}return L}function yy(b,g){return b.geometries==="geojson"?g.coordinates:b.geometries==="polyline6"?Fm(g,6):Fm(g,5)}function vy(b,g,_){var C,R,M,L;if((C=b.annotations)!=null&&C.includes("congestion_numeric"))return((R=g==null?void 0:g.congestion_numeric)==null?void 0:R[_])??0;if((M=b.annotations)!=null&&M.includes("congestion"))switch(((L=g==null?void 0:g.congestion)==null?void 0:L[_])??""){case"unknown":return 0;case"low":return 1;case"moderate":return 34;case"heavy":return 77;case"severe":return 100;default:return 0}else return 0}function xy(b,g,_){return!b.geometries||b.geometries==="polyline"?Math.abs(g[0]-_[0])<=1e-5&&Math.abs(g[1]-_[1])<=1e-5:g[0]===_[0]&&g[1]===_[1]}function Om(b){return b.map(g=>[g.geometry.coordinates[0],g.geometry.coordinates[1]])}function Um(b){return b.map(g=>{var _,C,R;return Array.isArray((_=g.properties)==null?void 0:_.bearing)?[(C=g.properties)==null?void 0:C.bearing[0],(R=g.properties)==null?void 0:R.bearing[1]]:void 0})}function dg(b){const g=jd(b==null?void 0:b.pointsScalingFactor,b==null?void 0:b.linesScalingFactor,b==null?void 0:b.sourceName);return Object.assign({},_y,{layers:g},b)}function fg(b,g,_){const C=b.makePostRequest?"post":"get";let R,M;if(C==="get")R=`${b.api}/${b.profile}/${g.join(";")}`,M=new URLSearchParams(b.requestOptions);else{R=`${b.api}/${b.profile}${b.requestOptions.access_token?`?access_token=${b.requestOptions.access_token}`:""}`;const L=new FormData;Object.entries(b.requestOptions).forEach(([a,V])=>{a!=="access_token"&&L.set(a,V)}),L.set("coordinates",g.join(";")),M=new URLSearchParams(L)}return b.bearings&&_&&M.set("bearings",_.map(L=>L?`${L[0]},${L[1]}`:"").join(";")),{method:C,url:R,payload:M}}function mg(b,g,_){return{type:"Feature",geometry:{type:"Point",coordinates:b},properties:{type:g,id:pg(),..._??{}}}}function gg(b,g,_,C,R=!1){if(b.length!==g.length)return[];const M=b.map((L,a)=>({type:"Feature",geometry:{type:"LineString",coordinates:[[L[0],L[1]],[g[a][0],g[a][1]]]},properties:{type:"SNAPLINE"}}));return~C&&_!==void 0&&R&&(M.push({type:"Feature",geometry:{type:"LineString",coordinates:[[_[0],_[1]],[g[C][0],g[C][1]]]},properties:{type:"SNAPLINE"}}),M.push({type:"Feature",geometry:{type:"LineString",coordinates:[[_[0],_[1]],[g[C+1][0],g[C+1][1]]]},properties:{type:"SNAPLINE"}})),M}function _g(b,g,_,C){return g.map((R,M)=>{const L=yy(b,R.geometry),a=C.map(_e=>_e.geometry.coordinates);let V=0;const F=a.map(_e=>{const Ae=L.slice(V).findIndex($e=>xy(b,$e,_e));return Ae!==-1&&(V+=Ae),V}).slice(1);let ce=0;const ee=F.map(_e=>L.slice(ce,ce=_e+1)),ve=[];return ee.forEach((_e,Ae)=>{const $e=pg();_e.forEach((De,Ze)=>{var Ct,Ve,Ke;const et=ve[ve.length-1],je=vy(b,(Ct=R.legs[Ae])==null?void 0:Ct.annotation,Ze);if(Ae===((Ve=et==null?void 0:et.properties)==null?void 0:Ve.legIndex)&&((Ke=et.properties)==null?void 0:Ke.congestion)===je)et.geometry.coordinates.push(De);else{const ut=C[Ae].properties??{},wt=C[Ae+1].properties??{},Dt={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{id:$e,routeIndex:M,route:M===_?"SELECTED":"ALT",legIndex:Ae,congestion:je,departSnappointProperties:ut,arriveSnappointProperties:wt}};et&&Dt.geometry.coordinates.push(et.geometry.coordinates[et.geometry.coordinates.length-1]),Dt.geometry.coordinates.push(De),ve.push(Dt)}})}),ve})}const by=Object.freeze(Object.defineProperty({__proto__:null,buildConfiguration:dg,buildPoint:mg,buildRequest:fg,buildRoutelines:_g,buildSnaplines:gg},Symbol.toStringTag,{value:"Module"}));class Ps extends gy{constructor(g,_){super(g),Xt(this,"configuration"),Xt(this,"_interactive",!1),Xt(this,"_hoverable",!1),Xt(this,"buildRequest",fg),Xt(this,"buildPoint",mg),Xt(this,"buildSnaplines",gg),Xt(this,"buildRoutelines",_g),Xt(this,"onMoveHandler"),Xt(this,"onDragDownHandler"),Xt(this,"onDragMoveHandler"),Xt(this,"onDragUpHandler"),Xt(this,"onClickHandler"),Xt(this,"liveRefreshHandler"),Xt(this,"profiles",[]),Xt(this,"_waypoints",[]),Xt(this,"snappoints",[]),Xt(this,"routelines",[]),Xt(this,"selectedRouteIndex",0),Xt(this,"hoverpoint"),Xt(this,"highlightedWaypoints",[]),Xt(this,"highlightedSnappoints",[]),Xt(this,"dragDownPosition",{x:0,y:0}),Xt(this,"waypointBeingDragged"),Xt(this,"waypointBeingDraggedInitialCoordinates"),Xt(this,"departSnappointIndex",-1),Xt(this,"currentMousePosition",{x:0,y:0}),Xt(this,"refreshOnMoveIsRefreshing",!1),Xt(this,"noMouseMovementTimer"),Xt(this,"lastRequestMousePosition",{x:0,y:0}),Xt(this,"allowRouteSwitch",!1),Xt(this,"abortController"),this.map=g,this.configuration=dg(_),this.onMoveHandler=this.onMove.bind(this),this.onDragDownHandler=this.onDragDown.bind(this),this.onDragMoveHandler=this.onDragMove.bind(this),this.onDragUpHandler=this.onDragUp.bind(this),this.onClickHandler=this.onClick.bind(this),this.liveRefreshHandler=this.liveRefresh.bind(this),this.init()}get waypointsCoordinates(){return Om(this._waypoints)}get snappointsCoordinates(){return this.snappoints.map(g=>[g.geometry.coordinates[0],g.geometry.coordinates[1]])}get snaplines(){var g,_,C;return this.buildSnaplines(this.waypointsCoordinates,this.snappointsCoordinates,(g=this.hoverpoint)==null?void 0:g.geometry.coordinates,this.departSnappointIndex,(C=(_=this.hoverpoint)==null?void 0:_.properties)==null?void 0:C.showSnaplines)}init(){this.map.addSource(this.configuration.sourceName,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.configuration.layers.forEach(g=>{this.map.addLayer(g)})}async fetch({method:g,url:_,payload:C}){var R,M;const L=await(g==="get"?await fetch(`${_}?${C}`,{signal:(R=this.abortController)==null?void 0:R.signal}):await fetch(`${_}`,{signal:(M=this.abortController)==null?void 0:M.signal,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:C})).json();if(L.code!=="Ok")throw new Error(L.message??"An unexpected error occurred.");return L}async fetchDirections(g){var _,C;(_=this.abortController)==null||_.abort();const R=this.interactive;if(this._waypoints.length>=2){this.fire(new zm("fetchroutesstart",g)),this.abortController=new AbortController;const M=this.abortController.signal;M.onabort=()=>{this.interactive=R},this.interactive=!1;let L;this.configuration.requestTimeout!==null&&(L=setTimeout(()=>{var _e;return(_e=this.abortController)==null?void 0:_e.abort()},this.configuration.requestTimeout)),this.profiles.length||(this.profiles=[this.configuration.profile]);const a=[],V=[];this.profiles.reduce((_e,Ae,$e)=>{const De=$e===this.profiles.length-1,Ze=$e>0?this.profiles[$e-1]:void 0,Ct=Ae===Ze,Ve=De?this._waypoints.length:Ct?_e+1:_e+2;return Ct?V[V.length-1].push(...this._waypoints.slice(_e,Ve)):(V.push(this._waypoints.slice(_e,Ve)),a.push(Ae)),Ve},0);const F=a.map((_e,Ae)=>this.buildRequest({...this.configuration,profile:_e},Om(V[Ae]),this.configuration.bearings?Um(V[Ae]):void 0));let ce;try{ce=await Promise.all(F.map(async _e=>{let Ae;try{Ae=await this.fetch(_e)}finally{this.fire(new zm("fetchroutesend",g,Ae))}return Ae}))}finally{((C=this.abortController)==null?void 0:C.signal.reason)!=="DESTROY"&&(this.interactive=R),this.abortController=void 0,clearTimeout(L)}const ee=ce.flatMap((_e,Ae)=>{const $e=a[Ae],De=_e.waypoints.map((Ct,Ve)=>this.buildPoint(Ct.location,"SNAPPOINT",{profile:$e,waypointProperties:V[Ae][Ve].properties??{}})),Ze=this.buildRoutelines(this.configuration.requestOptions,_e.routes,this.selectedRouteIndex,De);return{snappoints:De,routelines:Ze}}),ve=ce.flatMap(_e=>_e.routes);this.snappoints=ee.flatMap(_e=>_e.snappoints),this.routelines=ee.flatMap(_e=>_e.routelines),ve.length<=this.selectedRouteIndex&&(this.selectedRouteIndex=0)}else this.snappoints=[],this.routelines=[];this.draw(!1)}draw(g=!0){const _=[...this._waypoints,...this.snappoints,...this.snaplines,...this.routelines.reduce((R,M)=>g?R.concat(...M):R.concat(...M.map(L=>(L.properties&&(L.properties.route=L.properties.routeIndex===this.selectedRouteIndex?"SELECTED":"ALT"),L))),[])];this.hoverpoint&&_.push(this.hoverpoint);const C={type:"FeatureCollection",features:_};this.map.getSource(this.configuration.sourceName)&&this.map.getSource(this.configuration.sourceName).setData(C)}deHighlight(){this.highlightedWaypoints.forEach(g=>{g!=null&&g.properties&&(g.properties.highlight=!1)}),this.highlightedSnappoints.forEach(g=>{g!=null&&g.properties&&(g.properties.highlight=!1)}),this.routelines.forEach(g=>{g.forEach(_=>{_.properties&&(_.properties.highlight=!1)})})}onMove(g){var _,C,R,M;const L=this.map.queryRenderedFeatures(g.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveRoutelineLayers,...this.configuration.sensitiveAltRoutelineLayers]})[0];if(this.deHighlight(),this.configuration.sensitiveWaypointLayers.includes((L==null?void 0:L.layer.id)??"")){this.map.getCanvas().style.cursor="pointer",this.interactive&&this.map.dragPan.disable();const a=this._waypoints.find(F=>{var ce,ee;return((ce=F.properties)==null?void 0:ce.id)===((ee=L==null?void 0:L.properties)==null?void 0:ee.id)}),V=a&&this.snappoints.find(F=>{var ce,ee,ve;return((ee=(ce=F.properties)==null?void 0:ce.waypointProperties)==null?void 0:ee.id)===((ve=a.properties)==null?void 0:ve.id)});a&&(this.highlightedWaypoints=[a]),V&&(this.highlightedSnappoints=[V]),(_=this.highlightedWaypoints[0])!=null&&_.properties&&(this.highlightedWaypoints[0].properties.highlight=!0),(C=this.highlightedSnappoints[0])!=null&&C.properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else if(this.configuration.sensitiveSnappointLayers.includes((L==null?void 0:L.layer.id)??"")){this.map.getCanvas().style.cursor="pointer";const a=this.snappoints.findIndex(V=>{var F,ce;return((F=V.properties)==null?void 0:F.id)===((ce=L==null?void 0:L.properties)==null?void 0:ce.id)});this.highlightedSnappoints=[this.snappoints[a]],this.highlightedWaypoints=[this._waypoints[a]],this.highlightedSnappoints[0].properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.highlightedWaypoints[0].properties&&(this.highlightedWaypoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else this.configuration.sensitiveRoutelineLayers.includes((L==null?void 0:L.layer.id)??"")?(this.map.getCanvas().style.cursor="pointer",this.interactive&&(this.map.dragPan.disable(),this.hoverpoint?this.hoverpoint.geometry.coordinates=[g.lngLat.lng,g.lngLat.lat]:this.hoverpoint=this.buildPoint([g.lngLat.lng,g.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse(((R=L==null?void 0:L.properties)==null?void 0:R.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse(((M=L==null?void 0:L.properties)==null?void 0:M.arriveSnappointProperties)??"{}")}})),this.routelines.forEach(a=>{a.forEach(V=>{var F,ce;V.properties&&((F=V.properties)==null?void 0:F.id)===((ce=L==null?void 0:L.properties)==null?void 0:ce.id)&&(V.properties.highlight=!0)})})):this.configuration.sensitiveAltRoutelineLayers.includes((L==null?void 0:L.layer.id)??"")?(this.map.getCanvas().style.cursor="pointer",this.routelines.forEach(a=>{a.forEach(V=>{var F,ce;V.properties&&((F=V.properties)==null?void 0:F.id)===((ce=L==null?void 0:L.properties)==null?void 0:ce.id)&&(V.properties.highlight=!0)})}),this.hoverpoint&&(this.hoverpoint=void 0)):(this.map.dragPan.enable(),this.map.getCanvas().style.cursor="",this.hoverpoint=void 0);this.draw()}onDragDown(g){var _,C,R,M,L,a;if(g.type==="touchstart"&&g.originalEvent.touches.length!==1||g.type==="mousedown"&&g.originalEvent.which!==1)return;const V=this.map.queryRenderedFeatures(g.point);if(V.length&&V[0].source===this.configuration.sourceName){const F=V.filter(ce=>this.configuration.sensitiveWaypointLayers.includes((ce==null?void 0:ce.layer.id)??"")||this.configuration.sensitiveSnappointLayers.includes((ce==null?void 0:ce.layer.id)??"")||this.configuration.sensitiveRoutelineLayers.includes((ce==null?void 0:ce.layer.id)??""))[0];if(this.dragDownPosition=g.point,this.currentMousePosition=g.point,this.configuration.sensitiveWaypointLayers.includes((F==null?void 0:F.layer.id)??""))this.waypointBeingDragged=this._waypoints.find(ce=>{var ee,ve;return((ee=ce.properties)==null?void 0:ee.id)===((ve=F==null?void 0:F.properties)==null?void 0:ve.id)}),this.waypointBeingDraggedInitialCoordinates=(_=this.waypointBeingDragged)==null?void 0:_.geometry.coordinates;else if(this.configuration.sensitiveRoutelineLayers.includes((F==null?void 0:F.layer.id)??"")){if(this.departSnappointIndex=JSON.parse((C=F==null?void 0:F.properties)==null?void 0:C.legIndex),this.hoverpoint)if(this.configuration.refreshOnMove){const ce=this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0;this._addWaypoint([g.lngLat.lng,g.lngLat.lat],ce,g),this.waypointBeingDragged=ce?this._waypoints[ce]:void 0,this.hoverpoint=void 0}else this.hoverpoint.geometry.coordinates=[g.lngLat.lng,g.lngLat.lat];else this.hoverpoint=this.buildPoint([g.lngLat.lng,g.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse(((R=F==null?void 0:F.properties)==null?void 0:R.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse(((M=F==null?void 0:F.properties)==null?void 0:M.arriveSnappointProperties)??"{}")}});(L=this.hoverpoint)!=null&&L.properties&&(this.hoverpoint.properties.showSnaplines=!0),~this.departSnappointIndex&&(a=this.snappoints[this.departSnappointIndex])!=null&&a.properties&&(this.snappoints[this.departSnappointIndex].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex]),this.snappoints[this.departSnappointIndex+1].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex+1]))}this.map.off("touchstart",this.onMoveHandler),this.map.off("mousemove",this.onMoveHandler),g.type==="touchstart"?(this.map.on("touchmove",this.onDragMoveHandler),this.map.on("touchend",this.onDragUpHandler)):g.type==="mousedown"&&(this.map.on("mousemove",this.onDragMoveHandler),this.map.on("mouseup",this.onDragUpHandler)),this.draw()}}onDragMove(g){if(this.configuration.refreshOnMove&&(clearTimeout(this.noMouseMovementTimer),this.noMouseMovementTimer=setTimeout(this.liveRefreshHandler,300,g)),g.type==="touchmove"&&g.originalEvent.touches.length!==1)return g.originalEvent.preventDefault();g.type==="mousemove"&&g.originalEvent.which!==1||(this.waypointBeingDragged?this.waypointBeingDragged.geometry.coordinates=[g.lngLat.lng,g.lngLat.lat]:this.hoverpoint&&(this.hoverpoint.geometry.coordinates=[g.lngLat.lng,g.lngLat.lat]),this.currentMousePosition=g.point,this.draw(),this.configuration.refreshOnMove&&!this.refreshOnMoveIsRefreshing&&this.liveRefreshHandler(g))}async onDragUp(g){var _,C,R;if(this.configuration.refreshOnMove&&clearTimeout(this.noMouseMovementTimer),!(g.type==="mouseup"&&g.originalEvent.which!==1)){if((_=this.hoverpoint)!=null&&_.properties&&(this.hoverpoint.properties.showSnaplines=!1),Math.abs(g.point.x-((C=this.dragDownPosition)==null?void 0:C.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(g.point.y-((R=this.dragDownPosition)==null?void 0:R.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0))if(this.waypointBeingDragged){this.waypointBeingDragged.geometry.coordinates=[g.lngLat.lng,g.lngLat.lat];const M=new jc("movewaypoint",g,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(M);try{await this.fetchDirections(M)}catch(L){L instanceof DOMException&&L.name=="AbortError"||this.waypointBeingDraggedInitialCoordinates&&(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates)}this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0}else this.hoverpoint&&(this._addWaypoint([g.lngLat.lng,g.lngLat.lat],this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0,g),this.hoverpoint=void 0);else this.waypointBeingDragged&&this.waypointBeingDraggedInitialCoordinates?(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates,this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0):this.hoverpoint&&(this.hoverpoint=void 0);this.deHighlight(),g.type==="touchend"?(this.map.off("touchmove",this.onDragMoveHandler),this.map.off("touchend",this.onDragUpHandler)):g.type==="mouseup"&&(this.map.off("mousemove",this.onDragMoveHandler),this.map.off("mouseup",this.onDragUpHandler)),this.map.on("touchstart",this.onMoveHandler),this.map.on("mousemove",this.onMoveHandler),this.map.dragPan.enable(),this.draw()}}async liveRefresh(g){var _,C,R,M;if(Math.abs(((_=this.lastRequestMousePosition)==null?void 0:_.x)-((C=this.currentMousePosition)==null?void 0:C.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(((R=this.lastRequestMousePosition)==null?void 0:R.y)-((M=this.currentMousePosition)==null?void 0:M.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)){if(this.refreshOnMoveIsRefreshing=!0,this.lastRequestMousePosition=this.currentMousePosition,this.waypointBeingDragged){const L=new jc("movewaypoint",g,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(L);try{await this.fetchDirections(L)}catch{}}this.refreshOnMoveIsRefreshing=!1}}onClick(g){const _=this.map.queryRenderedFeatures(g.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveAltRoutelineLayers,...this.configuration.sensitiveRoutelineLayers]})[0];if(this._interactive&&this.configuration.sensitiveWaypointLayers.includes((_==null?void 0:_.layer.id)??"")){const C=this._waypoints.findIndex(R=>{var M,L;return((M=R.properties)==null?void 0:M.id)===((L=_==null?void 0:_.properties)==null?void 0:L.id)});~C&&this._removeWaypoint(C,g)}else if(this._interactive&&this.configuration.sensitiveSnappointLayers.includes((_==null?void 0:_.layer.id)??"")){const C=this.snappoints.findIndex(R=>{var M,L;return((M=R.properties)==null?void 0:M.id)===((L=_==null?void 0:_.properties)==null?void 0:L.id)});~C&&this._removeWaypoint(C,g)}else(this.interactive||this.allowRouteSwitch)&&this.configuration.sensitiveAltRoutelineLayers.includes((_==null?void 0:_.layer.id)??"")?this.selectedRouteIndex=this.routelines.findIndex(C=>!!C.find(R=>{var M,L;return((M=R.properties)==null?void 0:M.id)===((L=_==null?void 0:_.properties)==null?void 0:L.id)})):this._interactive&&!this.configuration.sensitiveRoutelineLayers.includes((_==null?void 0:_.layer.id)??"")&&this._addWaypoint([g.lngLat.lng,g.lngLat.lat],void 0,g);this.draw(!1)}assignWaypointsCategories(){this._waypoints.forEach((g,_)=>{const C=_===0?"ORIGIN":_===this._waypoints.length-1?"DESTINATION":void 0;g.properties&&(g.properties.index=_,g.properties.category=C)})}async _addWaypoint(g,_,C){var R;(R=this.abortController)==null||R.abort(),_=_??this._waypoints.length,this._waypoints.splice(_,0,this.buildPoint(g,"WAYPOINT",this.configuration.bearings?{bearing:void 0}:void 0)),this.assignWaypointsCategories();const M=new jc("addwaypoint",C,{index:_});this.fire(M),this.draw();try{await this.fetchDirections(M)}catch{}}async _removeWaypoint(g,_){var C;(C=this.abortController)==null||C.abort(),this._waypoints.splice(g,1),this.snappoints.splice(g,1),this.assignWaypointsCategories();const R=new jc("removewaypoint",_,{index:g});this.fire(R),this.draw();try{await this.fetchDirections(R)}catch{}}get interactive(){return this._interactive}set interactive(g){this._interactive=g,g?(this.map.on("touchstart",this.onMoveHandler),this.map.on("touchstart",this.onDragDownHandler),this.map.on("mousedown",this.onDragDownHandler),this.map.on("click",this.onClickHandler),this.hoverable||(this.map.on("mousemove",this.onMoveHandler),this.map.on("click",this.onClickHandler))):(this.map.off("touchstart",this.onMoveHandler),this.map.off("touchstart",this.onDragDownHandler),this.map.off("mousedown",this.onDragDownHandler),this.hoverable||(this.map.off("mousemove",this.onMoveHandler),this.map.off("click",this.onClickHandler)))}get hoverable(){return this._hoverable}set hoverable(g){this._hoverable=g,g&&!this.interactive?(this.map.on("mousemove",this.onMoveHandler),this.map.on("click",this.onClickHandler)):this.interactive||(this.map.off("mousemove",this.onMoveHandler),this.map.off("click",this.onClickHandler))}get waypoints(){return this.waypointsCoordinates}set waypoints(g){this.setWaypoints(g)}get waypointsBearings(){return this.configuration.bearings?Um(this._waypoints):(console.warn("The `waypointsBearings` getter was referred to, but the `bearings` configuration option is not enabled!"),[])}set waypointsBearings(g){if(!this.configuration.bearings){console.warn("The `waypointsBearings` setter was referred to, but the `bearings` configuration option is not enabled!");return}this._waypoints.forEach((C,R)=>{(C.properties||(C.properties={})).bearing=g[R]});const _=new jc("rotatewaypoints",void 0);this.fire(_),this.draw();try{this.fetchDirections(_)}catch{}}async setWaypoints(g,_=[]){var C;(C=this.abortController)==null||C.abort(),this.profiles=_.slice(0,g.length-1),this.profiles.length===0&&this.profiles.push(this.configuration.profile),this._waypoints=this.profiles.flatMap((M,L)=>{const a=L===this.profiles.length-1,V=L>0?this.profiles[L-1]:void 0,F=M===V?L+1:L,ce=a?g.length:L+2;return g.slice(F,ce).map((ee,ve)=>this.buildPoint(ee,"WAYPOINT",{profile:M,...this.configuration.bearings?{bearing:this.waypointsBearings[ve]}:void 0}))}),this.assignWaypointsCategories();const R=new jc("setwaypoints",void 0);this.fire(R),this.draw();try{await this.fetchDirections(R)}catch{}}async addWaypoint(g,_){await this._addWaypoint(g,_)}async removeWaypoint(g){await this._removeWaypoint(g)}clear(){this.setWaypoints([]),this.routelines=[]}destroy(){var g;(g=this.abortController)==null||g.abort("DESTROY"),this.clear(),this.hoverable=!1,this.interactive=!1,this.configuration.layers.forEach(_=>{this.map.removeLayer(_.id)}),this.map.removeSource(this.configuration.sourceName)}}function Hc(){}function yg(b){return b()}function Nm(){return Object.create(null)}function fp(b){b.forEach(yg)}function vg(b){return typeof b=="function"}function xg(b,g){return b!=b?g==g:b!==g||b&&typeof b=="object"||typeof b=="function"}function wy(b){return Object.keys(b).length===0}function pn(b,g){b.appendChild(g)}function Ql(b,g,_){b.insertBefore(g,_||null)}function ol(b){b.parentNode&&b.parentNode.removeChild(b)}function Ty(b,g){for(let _=0;_<b.length;_+=1)b[_]&&b[_].d(g)}function xo(b){return document.createElement(b)}function Jo(b){return document.createElementNS("http://www.w3.org/2000/svg",b)}function Fd(b){return document.createTextNode(b)}function Jl(){return Fd(" ")}function Sy(){return Fd("")}function zd(b,g,_,C){return b.addEventListener(g,_,C),()=>b.removeEventListener(g,_,C)}function ft(b,g,_){_==null?b.removeAttribute(g):b.getAttribute(g)!==_&&b.setAttribute(g,_)}function Od(b){return b===""?null:+b}function Ey(b){return Array.from(b.childNodes)}function Ay(b,g){g=""+g,b.data!==g&&(b.data=g)}function Ud(b,g){b.value=g??""}function Zc(b,g,_,C){_==null?b.style.removeProperty(g):b.style.setProperty(g,_,C?"important":"")}let dp;function cp(b){dp=b}function Iy(){if(!dp)throw new Error("Function called outside component initialization");return dp}function Cy(b){Iy().$$.on_destroy.push(b)}const Xu=[],tm=[];let Yu=[];const $m=[],My=Promise.resolve();let im=!1;function Py(){im||(im=!0,My.then(bg))}function nm(b){Yu.push(b)}const Jf=new Set;let ju=0;function bg(){if(ju!==0)return;const b=dp;do{try{for(;ju<Xu.length;){const g=Xu[ju];ju++,cp(g),ky(g.$$)}}catch(g){throw Xu.length=0,ju=0,g}for(cp(null),Xu.length=0,ju=0;tm.length;)tm.pop()();for(let g=0;g<Yu.length;g+=1){const _=Yu[g];Jf.has(_)||(Jf.add(_),_())}Yu.length=0}while(Xu.length);for(;$m.length;)$m.pop()();im=!1,Jf.clear(),cp(b)}function ky(b){if(b.fragment!==null){b.update(),fp(b.before_update);const g=b.dirty;b.dirty=[-1],b.fragment&&b.fragment.p(b.ctx,g),b.after_update.forEach(nm)}}function zy(b){const g=[],_=[];Yu.forEach(C=>b.indexOf(C)===-1?g.push(C):_.push(C)),_.forEach(C=>C()),Yu=g}const Dy=new Set;function Ly(b,g){b&&b.i&&(Dy.delete(b),b.i(g))}function Vm(b){return(b==null?void 0:b.length)!==void 0?b:Array.from(b)}function Ry(b,g,_){const{fragment:C,after_update:R}=b.$$;C&&C.m(g,_),nm(()=>{const M=b.$$.on_mount.map(yg).filter(vg);b.$$.on_destroy?b.$$.on_destroy.push(...M):fp(M),b.$$.on_mount=[]}),R.forEach(nm)}function By(b,g){const _=b.$$;_.fragment!==null&&(zy(_.after_update),fp(_.on_destroy),_.fragment&&_.fragment.d(g),_.on_destroy=_.fragment=null,_.ctx=[])}function Fy(b,g){b.$$.dirty[0]===-1&&(Xu.push(b),Py(),b.$$.dirty.fill(0)),b.$$.dirty[g/31|0]|=1<<g%31}function wg(b,g,_,C,R,M,L,a=[-1]){const V=dp;cp(b);const F=b.$$={fragment:null,ctx:[],props:M,update:Hc,not_equal:R,bound:Nm(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(g.context||(V?V.$$.context:[])),callbacks:Nm(),dirty:a,skip_bound:!1,root:g.target||V.$$.root};L&&L(F.root);let ce=!1;if(F.ctx=_?_(b,g.props||{},(ee,ve,..._e)=>{const Ae=_e.length?_e[0]:ve;return F.ctx&&R(F.ctx[ee],F.ctx[ee]=Ae)&&(!F.skip_bound&&F.bound[ee]&&F.bound[ee](Ae),ce&&Fy(b,ee)),ve}):[],F.update(),ce=!0,fp(F.before_update),F.fragment=C?C(F.ctx):!1,g.target){if(g.hydrate){const ee=Ey(g.target);F.fragment&&F.fragment.l(ee),ee.forEach(ol)}else F.fragment&&F.fragment.c();g.intro&&Ly(b.$$.fragment),Ry(b,g.target,g.anchor),bg()}cp(V)}class Tg{constructor(){Xt(this,"$$"),Xt(this,"$$set")}$destroy(){By(this,1),this.$destroy=Hc}$on(g,_){if(!vg(_))return Hc;const C=this.$$.callbacks[g]||(this.$$.callbacks[g]=[]);return C.push(_),()=>{const R=C.indexOf(_);R!==-1&&C.splice(R,1)}}$set(g){this.$$set&&!wy(g)&&(this.$$.skip_bound=!0,this.$$set(g),this.$$.skip_bound=!1)}}const Oy="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Oy);function qm(b){let g,_,C,R,M,L,a,V,F,ce,ee,ve,_e,Ae,$e,De;return{c(){g=Jo("svg"),_=Jo("circle"),R=Jo("path"),L=Jo("g"),a=Jo("path"),F=Jo("path"),ee=Jo("path"),_e=Jo("animateTransform"),ft(_,"cx","64.13"),ft(_,"cy","64.13"),ft(_,"r","27.63"),ft(_,"fill",C=b[0].fill),ft(R,"d","M64.13 18.5A45.63 45.63 0 1 1 18.5 64.13 45.63 45.63 0 0 1 64.13 18.5zm0 7.85a37.78 37.78 0 1 1-37.78 37.78 37.78 37.78 0 0 1 37.78-37.78z"),ft(R,"fill-rule","evenodd"),ft(R,"fill",M=b[0].fill),ft(a,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),ft(a,"fill",V=b[0].fill),ft(F,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),ft(F,"fill",ce=b[0].fill),ft(F,"transform","rotate(120 64 64)"),ft(ee,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),ft(ee,"fill",ve=b[0].fill),ft(ee,"transform","rotate(240 64 64)"),ft(_e,"attributeName","transform"),ft(_e,"type","rotate"),ft(_e,"from","0 64 64"),ft(_e,"to","120 64 64"),ft(_e,"dur","360ms"),ft(_e,"repeatCount","indefinite"),ft(g,"xmlns","http://www.w3.org/2000/svg"),ft(g,"width",Ae=b[0].size),ft(g,"height",$e=b[0].size),ft(g,"viewBox","0 0 128 128"),ft(g,"xml:space","preserve"),ft(g,"class",De=b[0].class)},m(Ze,Ct){Ql(Ze,g,Ct),pn(g,_),pn(g,R),pn(g,L),pn(L,a),pn(L,F),pn(L,ee),pn(L,_e)},p(Ze,Ct){Ct&1&&C!==(C=Ze[0].fill)&&ft(_,"fill",C),Ct&1&&M!==(M=Ze[0].fill)&&ft(R,"fill",M),Ct&1&&V!==(V=Ze[0].fill)&&ft(a,"fill",V),Ct&1&&ce!==(ce=Ze[0].fill)&&ft(F,"fill",ce),Ct&1&&ve!==(ve=Ze[0].fill)&&ft(ee,"fill",ve),Ct&1&&Ae!==(Ae=Ze[0].size)&&ft(g,"width",Ae),Ct&1&&$e!==($e=Ze[0].size)&&ft(g,"height",$e),Ct&1&&De!==(De=Ze[0].class)&&ft(g,"class",De)},d(Ze){Ze&&ol(g)}}}function Uy(b){let g,_=b[1]&&qm(b);return{c(){_&&_.c(),g=Sy()},m(C,R){_&&_.m(C,R),Ql(C,g,R)},p(C,[R]){C[1]?_?_.p(C,R):(_=qm(C),_.c(),_.m(g.parentNode,g)):_&&(_.d(1),_=null)},i:Hc,o:Hc,d(C){C&&ol(g),_&&_.d(C)}}}function Ny(b,g,_){let{directions:C}=g,{configuration:R}=g,M;return C.on("fetchroutesstart",()=>{_(1,M=!0)}),C.on("fetchroutesend",()=>{_(1,M=!1)}),b.$$set=L=>{"directions"in L&&_(2,C=L.directions),"configuration"in L&&_(0,R=L.configuration)},[R,M,C]}class $y extends Tg{constructor(g){super(),wg(this,g,Ny,Uy,xg,{directions:2,configuration:0})}}const Vy={fill:"#6d26d7",size:"24px",class:""};class qy{constructor(g,_){Xt(this,"controlElement"),Xt(this,"directions"),Xt(this,"configuration"),this.directions=g,this.configuration=Object.assign({},Vy,_)}onAdd(){return this.controlElement=document.createElement("div"),new $y({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}function Gm(b,g,_){const C=b.slice();return C[16]=g[_],C[17]=g,C[18]=_,C}function Gy(b){let g,_,C,R,M,L,a,V,F;function ce(){b[11].call(g,b[17],b[18])}return{c(){g=xo("input"),L=Jl(),a=xo("span"),a.textContent="°",ft(g,"type","number"),g.disabled=_=!b[16].enabled,ft(g,"min",C=b[0].degreesMin),ft(g,"max",R=b[0].degreesMax),ft(g,"step",M=b[0].degreesStep),ft(g,"class","maplibre-gl-directions-bearings-control__input"),ft(a,"class","maplibre-gl-directions-bearings-control__text")},m(ee,ve){Ql(ee,g,ve),Ud(g,b[16].degrees),Ql(ee,L,ve),Ql(ee,a,ve),V||(F=zd(g,"input",ce),V=!0)},p(ee,ve){b=ee,ve&2&&_!==(_=!b[16].enabled)&&(g.disabled=_),ve&1&&C!==(C=b[0].degreesMin)&&ft(g,"min",C),ve&1&&R!==(R=b[0].degreesMax)&&ft(g,"max",R),ve&1&&M!==(M=b[0].degreesStep)&&ft(g,"step",M),ve&2&&Od(g.value)!==b[16].degrees&&Ud(g,b[16].degrees)},d(ee){ee&&(ol(g),ol(L),ol(a)),V=!1,F()}}}function Zy(b){let g,_=b[0].fixedDegrees+"",C,R;return{c(){g=xo("span"),C=Fd(_),R=Fd("°"),ft(g,"class","maplibre-gl-directions-bearings-control__text")},m(M,L){Ql(M,g,L),pn(g,C),pn(g,R)},p(M,L){L&1&&_!==(_=M[0].fixedDegrees+"")&&Ay(C,_)},d(M){M&&ol(g)}}}function Zm(b){let g,_,C,R,M,L,a,V,F,ce,ee,ve=b[18],_e,Ae,$e,De,Ze,Ct,Ve,Ke,et,je,ut,wt,Dt,Nt,ai;function kt(){b[7].call(R,b[17],b[18])}const $t=()=>b[8](L,ve),Tt=()=>b[8](null,ve);function jt(...fn){return b[9](b[18],...fn)}function yi(){b[10].call(Ae,b[17],b[18])}function vi(fn,ei){return fn[0].fixedDegrees?Zy:Gy}let Li=vi(b),sn=Li(b);return{c(){g=xo("div"),_=xo("span"),_.textContent=`${b[18]+1}.`,C=Jl(),R=xo("input"),M=Jl(),L=xo("div"),a=Jo("svg"),V=Jo("circle"),ee=Jo("circle"),_e=Jl(),Ae=xo("input"),Ve=Jl(),Ke=xo("span"),Ke.textContent="°",et=Jl(),je=xo("span"),je.textContent="±",ut=Jl(),sn.c(),wt=Jl(),ft(_,"class","maplibre-gl-directions-bearings-control__number text-slate-800"),ft(R,"type","checkbox"),ft(R,"class","maplibre-gl-directions-bearings-control__checkbox"),ft(V,"r","5"),ft(V,"cx","10"),ft(V,"cy","10"),ft(V,"fill","transparent"),ft(V,"stroke","rgba(109, 38, 215, 0.65)"),ft(V,"stroke-width","10"),ft(V,"stroke-dasharray",F=b[16].degrees/3.6*31.42/100+" 31.42"),ft(V,"transform",ce="rotate("+(-90-b[16].degrees/2+b[16].angle-b[3])+")"),Zc(V,"transform-origin","10px 10px"),ft(ee,"r","6"),ft(ee,"cx","10"),ft(ee,"cy","10"),ft(ee,"fill","rgb(109, 38, 215)"),ft(a,"height","20"),ft(a,"width","20"),ft(a,"viewBox","0 0 20 20"),ft(a,"class","maplibre-gl-directions-bearings-control__waypoint-image"),Zc(a,"width",b[0].imageSize+"px"),Zc(a,"height",b[0].imageSize+"px"),Zc(a,"opacity",b[16].enabled?1:.25),ft(L,"role","spinbutton"),ft(L,"tabindex","0"),ft(Ae,"type","number"),Ae.disabled=$e=!b[16].enabled,ft(Ae,"min",De=b[0].angleMin),ft(Ae,"max",Ze=b[0].angleMax),ft(Ae,"step",Ct=b[0].angleStep),ft(Ae,"class","maplibre-gl-directions-bearings-control__input"),ft(Ke,"class","maplibre-gl-directions-bearings-control__text"),ft(je,"class","maplibre-gl-directions-bearings-control__text"),ft(g,"class",Dt="maplibre-gl-directions-bearings-control__list-item "+(b[16].enabled?"maplibre-gl-directions-bearings-control__list-item--enabled":"maplibre-gl-directions-bearings-control__list-item--disabled")+" flex items-center gap-2 text-slate-800"+(b[16].enabled?"":"/50"))},m(fn,ei){Ql(fn,g,ei),pn(g,_),pn(g,C),pn(g,R),R.checked=b[16].enabled,pn(g,M),pn(g,L),pn(L,a),pn(a,V),pn(a,ee),$t(),pn(g,_e),pn(g,Ae),Ud(Ae,b[16].angle),pn(g,Ve),pn(g,Ke),pn(g,et),pn(g,je),pn(g,ut),sn.m(g,null),pn(g,wt),Nt||(ai=[zd(R,"change",kt),zd(L,"mousedown",jt),zd(Ae,"input",yi)],Nt=!0)},p(fn,ei){b=fn,ei&2&&(R.checked=b[16].enabled),ei&2&&F!==(F=b[16].degrees/3.6*31.42/100+" 31.42")&&ft(V,"stroke-dasharray",F),ei&10&&ce!==(ce="rotate("+(-90-b[16].degrees/2+b[16].angle-b[3])+")")&&ft(V,"transform",ce),ei&1&&Zc(a,"width",b[0].imageSize+"px"),ei&1&&Zc(a,"height",b[0].imageSize+"px"),ei&2&&Zc(a,"opacity",b[16].enabled?1:.25),ve!==b[18]&&(Tt(),ve=b[18],$t()),ei&2&&$e!==($e=!b[16].enabled)&&(Ae.disabled=$e),ei&1&&De!==(De=b[0].angleMin)&&ft(Ae,"min",De),ei&1&&Ze!==(Ze=b[0].angleMax)&&ft(Ae,"max",Ze),ei&1&&Ct!==(Ct=b[0].angleStep)&&ft(Ae,"step",Ct),ei&2&&Od(Ae.value)!==b[16].angle&&Ud(Ae,b[16].angle),Li===(Li=vi(b))&&sn?sn.p(b,ei):(sn.d(1),sn=Li(b),sn&&(sn.c(),sn.m(g,wt))),ei&2&&Dt!==(Dt="maplibre-gl-directions-bearings-control__list-item "+(b[16].enabled?"maplibre-gl-directions-bearings-control__list-item--enabled":"maplibre-gl-directions-bearings-control__list-item--disabled")+" flex items-center gap-2 text-slate-800"+(b[16].enabled?"":"/50"))&&ft(g,"class",Dt)},d(fn){fn&&ol(g),Tt(),sn.d(),Nt=!1,fp(ai)}}}function jy(b){let g,_,C,R=Vm(b[1]),M=[];for(let L=0;L<R.length;L+=1)M[L]=Zm(Gm(b,R,L));return{c(){g=xo("div"),_=xo("div");for(let L=0;L<M.length;L+=1)M[L].c();ft(_,"class","maplibre-gl-directions-bearings-control__list flex flex-col max-h-96 overflow-y-auto"),ft(g,"class",C="maplibre-gl-directions-bearings-control maplibregl-ctrl maplibregl-ctrl-group p-4 "+(b[1].length?"block":"hidden")+" bg-white text-base rounded")},m(L,a){Ql(L,g,a),pn(g,_);for(let V=0;V<M.length;V+=1)M[V]&&M[V].m(_,null)},p(L,[a]){if(a&31){R=Vm(L[1]);let V;for(V=0;V<R.length;V+=1){const F=Gm(L,R,V);M[V]?M[V].p(F,a):(M[V]=Zm(F),M[V].c(),M[V].m(_,null))}for(;V<M.length;V+=1)M[V].d(1);M.length=R.length}a&2&&C!==(C="maplibre-gl-directions-bearings-control maplibregl-ctrl maplibregl-ctrl-group p-4 "+(L[1].length?"block":"hidden")+" bg-white text-base rounded")&&ft(g,"class",C)},i:Hc,o:Hc,d(L){L&&ol(g),Ty(M,L)}}}function Wy(b,g,_){let{directions:C}=g,{configuration:R}=g;C.configuration.bearings||console.warn("The Bearings Control is used, but the `bearings` configuration option is not enabled!");let M=[];C.on("addwaypoint",L),C.on("removewaypoint",L),C.on("movewaypoint",L),C.on("setwaypoints",L);function L(){_(1,M=C.waypointsBearings.map((Ve,Ke)=>M[Ke]?M[Ke]:{enabled:R.defaultEnabled||!!Ve,angle:Ve?Ve[0]:R.angleDefault,degrees:Ve?Ve[1]:R.fixedDegrees?R.fixedDegrees:R.degreesDefault}))}L();let a;const V=[];let F=-1;function ce(Ve,Ke){var et;(et=M[Ke])!=null&&et.enabled&&(F=Ke,document.addEventListener("mouseup",ee),document.addEventListener("mousemove",ve))}function ee(){F=-1,document.removeEventListener("mouseup",ee),document.removeEventListener("mousemove",ve)}function ve(Ve){const Ke=V[F];if(Ke){const et=Ke.getBoundingClientRect().x+R.imageSize/2,je=Ke.getBoundingClientRect().y+R.imageSize/2,ut=Ve.pageX,wt=Ve.pageY,Dt=Math.atan2(ut-et,wt-je)*(180/Math.PI)*-1+90;_(1,M[F].angle=90+Dt+_e|0,M)}}Cy(()=>{document.removeEventListener("mouseup",ee),document.removeEventListener("mousemove",ve)});let _e=0;R.respectMapBearing&&C.map.on("rotate",()=>_(3,_e=C.map.getBearing()));function Ae(Ve,Ke){Ve[Ke].enabled=this.checked,_(1,M)}function $e(Ve,Ke){tm[Ve?"unshift":"push"](()=>{V[Ke]=Ve,_(2,V)})}const De=(Ve,Ke)=>ce(Ke,Ve);function Ze(Ve,Ke){Ve[Ke].angle=Od(this.value),_(1,M)}function Ct(Ve,Ke){Ve[Ke].degrees=Od(this.value),_(1,M)}return b.$$set=Ve=>{"directions"in Ve&&_(5,C=Ve.directions),"configuration"in Ve&&_(0,R=Ve.configuration)},b.$$.update=()=>{b.$$.dirty&67&&(a&&clearTimeout(a),_(6,a=setTimeout(()=>{_(5,C.waypointsBearings=M.map(Ve=>Ve.enabled?[Ve.angle,Ve.degrees]:void 0),C)},R.debounceTimeout)))},[R,M,V,_e,ce,C,a,Ae,$e,De,Ze,Ct]}let Hy=class extends Tg{constructor(b){super(),wg(this,b,Wy,jy,xg,{directions:5,configuration:0})}};const Xy={defaultEnabled:!1,debounceTimeout:150,angleDefault:0,angleMin:0,angleMax:359,angleStep:1,fixedDegrees:0,degreesDefault:45,degreesMin:15,degreesMax:360,degreesStep:15,respectMapBearing:!1,imageSize:50};class Ky{constructor(g,_){Xt(this,"controlElement"),Xt(this,"directions"),Xt(this,"configuration"),this.directions=g,this.configuration=Object.assign({},Xy,_)}onAdd(){return this.controlElement=document.createElement("div"),new Hy({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}function jm(b){let g,_;return{c(){g=we("p"),_=dn(b[6]),Ye(g,"class","text-red-500")},m(C,R){Se(C,g,R),Le(g,_)},p(C,R){R&64&&om(_,C[6])},d(C){C&&Te(g)}}}function Yy(b){let g,_,C,R,M,L,a,V,F,ce,ee,ve,_e,Ae,$e,De,Ze,Ct,Ve,Ke,et,je,ut,wt,Dt,Nt,ai,kt,$t=b[6]&&jm(b);return{c(){$t&&$t.c(),g=it(),_=we("label"),C=we("input"),M=it(),L=we("strong"),L.textContent="Interactivity enabled",a=it(),V=we("label"),F=we("input"),ee=it(),ve=we("strong"),ve.textContent="Hover enabled",_e=it(),Ae=we("label"),$e=we("input"),Ze=it(),Ct=we("strong"),Ct.textContent="Route switch",Ve=it(),Ke=we("label"),et=we("input"),ut=it(),wt=we("strong"),wt.textContent="Update route while dragging",Dt=it(),Nt=we("ul"),Nt.innerHTML=`<li>Click somewhere on the map to add a waypoint</li> <li>Click a waypoint to remove it and its related snappoint</li> <li>Click a snappoint to remove it and its related waypoint</li> <li>Drag a waypoint somewhere to move it</li> <li>Drag a routeline somewhere to add a waypoint in-between the 2 nearest ones</li> <li>Click an alternative routeline to select it<br/> <small><strong>Note</strong>, there&#39;s usually no alternative routelines in the server response if there are more than
        2 waypoints</small></li>`,Ye(C,"type","checkbox"),C.disabled=R=!b[0],Ye(_,"class","flex items-center gap-3"),Ye(F,"type","checkbox"),F.disabled=ce=!b[0],Ye(V,"class","flex items-center gap-3"),Ye($e,"type","checkbox"),$e.disabled=De=!b[0]||!b[2],Ye(Ae,"class","flex items-center gap-3 ml-5"),Ye(et,"type","checkbox"),et.disabled=je=!b[0],Ye(Ke,"class","flex items-center gap-3")},m(Tt,jt){$t&&$t.m(Tt,jt),Se(Tt,g,jt),Se(Tt,_,jt),Le(_,C),C.checked=b[1],Le(_,M),Le(_,L),Se(Tt,a,jt),Se(Tt,V,jt),Le(V,F),F.checked=b[2],Le(V,ee),Le(V,ve),Se(Tt,_e,jt),Se(Tt,Ae,jt),Le(Ae,$e),$e.checked=b[3],Le(Ae,Ze),Le(Ae,Ct),Se(Tt,Ve,jt),Se(Tt,Ke,jt),Le(Ke,et),et.checked=b[5],Le(Ke,ut),Le(Ke,wt),Se(Tt,Dt,jt),Se(Tt,Nt,jt),ai||(kt=[Bi(C,"change",b[9]),Bi(F,"change",b[10]),Bi($e,"change",b[11]),Bi(et,"change",b[12]),Bi(et,"click",b[8])],ai=!0)},p(Tt,jt){Tt[6]?$t?$t.p(Tt,jt):($t=jm(Tt),$t.c(),$t.m(g.parentNode,g)):$t&&($t.d(1),$t=null),jt&1&&R!==(R=!Tt[0])&&(C.disabled=R),jt&2&&(C.checked=Tt[1]),jt&1&&ce!==(ce=!Tt[0])&&(F.disabled=ce),jt&4&&(F.checked=Tt[2]),jt&5&&De!==(De=!Tt[0]||!Tt[2])&&($e.disabled=De),jt&8&&($e.checked=Tt[3]),jt&1&&je!==(je=!Tt[0])&&(et.disabled=je),jt&32&&(et.checked=Tt[5])},d(Tt){Tt&&(Te(g),Te(_),Te(a),Te(V),Te(_e),Te(Ae),Te(Ve),Te(Ke),Te(Dt),Te(Nt)),$t&&$t.d(Tt),ai=!1,bo(kt)}}}function Jy(b){let g;return{c(){g=we("span"),g.textContent=`${b[7].name}`,Ye(g,"slot","title")},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function Qy(b){let g,_,C,R;return g=new Ds({props:{$$slots:{title:[Jy],default:[Yy]},$$scope:{ctx:b}}}),{c(){ur(g.$$.fragment),_=it(),C=we("div"),Ye(C,"class","basis-full lg:basis-2/3 shadow-xl")},m(M,L){Qn(g,M,L),Se(M,_,L),Se(M,C,L),b[13](C),R=!0},p(M,[L]){const a={};L&65647&&(a.$$scope={dirty:L,ctx:M}),g.$set(a)},i(M){R||(Sn(g.$$.fragment,M),R=!0)},o(M){zn(g.$$.fragment,M),R=!1},d(M){M&&(Te(_),Te(C)),er(g,M),b[13](null)}}}function ev(b,g,_){let C;ks(b,zs,Ve=>_(15,C=Ve));const R=rs.find(Ve=>Ve.path===C);let M,L,a,V=!0,F=!1,ce=!1,ee=!1;function ve(){a&&a.destroy(),_(0,a=new Ps(L,{requestOptions:{alternatives:"true"},refreshOnMove:!ee}))}$s(()=>{L=new Vs.Map({container:M,style:qs,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"}),L.on("load",()=>{_(0,a=new Ps(L,{requestOptions:{alternatives:"true"}}))})});let _e;function Ae(){V=this.checked,_(1,V)}function $e(){F=this.checked,_(2,F)}function De(){ce=this.checked,_(3,ce)}function Ze(){ee=this.checked,_(5,ee)}function Ct(Ve){_s[Ve?"unshift":"push"](()=>{M=Ve,_(4,M)})}return b.$$.update=()=>{b.$$.dirty&15&&a&&(a.hoverable!==F&&_(0,a.hoverable=F,a),a.interactive!==V&&_(0,a.interactive=V,a),a.allowRouteSwitch!==ce&&_(0,a.allowRouteSwitch=ce,a),a.on("fetchroutesend",Ve=>{Ve.data&&Ve.data.code!=="Ok"?_(6,_e=`${Ve.data.code}: ${Ve.data.message??"no details available."}`):_(6,_e="")}))},[a,V,F,ce,M,ee,_e,R,ve,Ae,$e,De,Ze,Ct]}class tv extends $r{constructor(g){super(),Nr(this,g,ev,Qy,Er,{})}}const iv=Object.freeze(Object.defineProperty({__proto__:null,default:tv},Symbol.toStringTag,{value:"Module"}));function nv(b){let g,_,C,R,M,L,a,V,F,ce,ee,ve,_e,Ae,$e,De,Ze,Ct,Ve,Ke,et,je,ut,wt,Dt,Nt,ai,kt,$t,Tt,jt,yi,vi,Li,sn,fn,ei,Ar,hr,xi,Vn,ss,pr,Ir,tr,on,On,dr,ke,en,Vr,li,Kt,os,fr,as,qn,hi,qr,Ls,Je,Dn,mn,Hi,mr,nt,Lt,Vt,gn,_n,St,ir,En,Gn,Zn,ys,an,Si,Gr,Cr,te,B,N,j,ie;return{c(){g=we("p"),g.innerHTML=`The <a href="http://project-osrm.org/docs/v5.24.0/api/#requests" target="_blank" rel="noreferrer">bearings</a> support
    allows to control in which direction the route would be continued from a given waypoint.`,_=it(),C=we("p"),C.innerHTML=`In order to enable support for this API option on the plugin level, pass the <code>bearings: true</code> option to
    the plugin&#39;s configuration object. When this is done, each request would contain the <code>bearings</code> field. The
    problem with that is that the values for the waypoints&#39; bearings are not populated correctly since we need some way to
    assign these bearings values to our waypoints.`,R=it(),M=we("p"),M.innerHTML="Luckily, that&#39;s possible to achieve using the built-in <strong>Bearings Control</strong>.",L=it(),a=we("label"),V=we("input"),ce=it(),ee=we("strong"),ee.textContent="Default Enabled",ve=it(),_e=we("label"),Ae=we("span"),Ae.innerHTML="<strong>Debounce timeout</strong>",$e=it(),De=we("input"),Ct=it(),Ve=we("label"),Ke=we("span"),Ke.innerHTML="<strong>Default angle</strong>",et=it(),je=we("input"),wt=it(),Dt=we("label"),Nt=we("span"),Nt.innerHTML="<strong>Minimal allowed angle</strong>",ai=it(),kt=we("input"),Tt=it(),jt=we("label"),yi=we("span"),yi.innerHTML="<strong>Maximal allowed angle</strong>",vi=it(),Li=we("input"),fn=it(),ei=we("label"),Ar=we("span"),Ar.innerHTML="<strong>Angle step</strong>",hr=it(),xi=we("input"),ss=it(),pr=we("label"),Ir=we("span"),Ir.innerHTML="<strong>Fixed degrees</strong>",tr=it(),on=we("input"),dr=it(),ke=we("label"),en=we("span"),en.innerHTML="<strong>Degrees default</strong>",Vr=it(),li=we("input"),os=it(),fr=we("label"),as=we("span"),as.innerHTML="<strong>Minimal allowed degrees</strong>",qn=it(),hi=we("input"),Ls=it(),Je=we("label"),Dn=we("span"),Dn.innerHTML="<strong>Maximal allowed degrees</strong>",mn=it(),Hi=we("input"),nt=it(),Lt=we("label"),Vt=we("span"),Vt.innerHTML="<strong>Degrees step</strong>",gn=it(),_n=we("input"),ir=it(),En=we("label"),Gn=we("input"),ys=it(),an=we("strong"),an.textContent="Respect Map's Bearing",Si=it(),Gr=we("label"),Cr=we("span"),Cr.innerHTML="<strong>Image size</strong>",te=it(),B=we("input"),Ye(V,"type","checkbox"),V.disabled=F=!b[0],Ye(a,"class","flex items-center gap-3"),Ye(De,"type","number"),De.disabled=Ze=!b[0],Ye(_e,"class","flex flex-col gap-2"),Ye(je,"type","number"),je.disabled=ut=!b[0],Ye(Ve,"class","flex flex-col gap-2"),Ye(kt,"type","number"),kt.disabled=$t=!b[0],Ye(Dt,"class","flex flex-col gap-2"),Ye(Li,"type","number"),Li.disabled=sn=!b[0],Ye(jt,"class","flex flex-col gap-2"),Ye(xi,"type","number"),xi.disabled=Vn=!b[0],Ye(ei,"class","flex flex-col gap-2"),Ye(on,"type","number"),on.disabled=On=!b[0],Ye(pr,"class","flex flex-col gap-2"),Ye(li,"type","number"),li.disabled=Kt=!b[0]||!!b[1].fixedDegrees,Ye(ke,"class","flex flex-col gap-2"),Ye(hi,"type","number"),hi.disabled=qr=!b[0]||!!b[1].fixedDegrees,Ye(fr,"class","flex flex-col gap-2"),Ye(Hi,"type","number"),Hi.disabled=mr=!b[0]||!!b[1].fixedDegrees,Ye(Je,"class","flex flex-col gap-2"),Ye(_n,"type","number"),_n.disabled=St=!b[0]||!!b[1].fixedDegrees,Ye(Lt,"class","flex flex-col gap-2"),Ye(Gn,"type","checkbox"),Gn.disabled=Zn=!b[0],Ye(En,"class","flex items-center gap-3"),Ye(B,"type","number"),B.disabled=N=!b[0],Ye(Gr,"class","flex flex-col gap-2")},m(W,se){Se(W,g,se),Se(W,_,se),Se(W,C,se),Se(W,R,se),Se(W,M,se),Se(W,L,se),Se(W,a,se),Le(a,V),V.checked=b[1].defaultEnabled,Le(a,ce),Le(a,ee),Se(W,ve,se),Se(W,_e,se),Le(_e,Ae),Le(_e,$e),Le(_e,De),Wi(De,b[1].debounceTimeout),Se(W,Ct,se),Se(W,Ve,se),Le(Ve,Ke),Le(Ve,et),Le(Ve,je),Wi(je,b[1].angleDefault),Se(W,wt,se),Se(W,Dt,se),Le(Dt,Nt),Le(Dt,ai),Le(Dt,kt),Wi(kt,b[1].angleMin),Se(W,Tt,se),Se(W,jt,se),Le(jt,yi),Le(jt,vi),Le(jt,Li),Wi(Li,b[1].angleMax),Se(W,fn,se),Se(W,ei,se),Le(ei,Ar),Le(ei,hr),Le(ei,xi),Wi(xi,b[1].angleStep),Se(W,ss,se),Se(W,pr,se),Le(pr,Ir),Le(pr,tr),Le(pr,on),Wi(on,b[1].fixedDegrees),Se(W,dr,se),Se(W,ke,se),Le(ke,en),Le(ke,Vr),Le(ke,li),Wi(li,b[1].degreesDefault),Se(W,os,se),Se(W,fr,se),Le(fr,as),Le(fr,qn),Le(fr,hi),Wi(hi,b[1].degreesMin),Se(W,Ls,se),Se(W,Je,se),Le(Je,Dn),Le(Je,mn),Le(Je,Hi),Wi(Hi,b[1].degreesMax),Se(W,nt,se),Se(W,Lt,se),Le(Lt,Vt),Le(Lt,gn),Le(Lt,_n),Wi(_n,b[1].degreesStep),Se(W,ir,se),Se(W,En,se),Le(En,Gn),Gn.checked=b[1].respectMapBearing,Le(En,ys),Le(En,an),Se(W,Si,se),Se(W,Gr,se),Le(Gr,Cr),Le(Gr,te),Le(Gr,B),Wi(B,b[1].imageSize),j||(ie=[Bi(V,"change",b[6]),Bi(De,"input",b[7]),Bi(je,"input",b[8]),Bi(kt,"input",b[9]),Bi(Li,"input",b[10]),Bi(xi,"input",b[11]),Bi(on,"input",b[12]),Bi(li,"input",b[13]),Bi(hi,"input",b[14]),Bi(Hi,"input",b[15]),Bi(_n,"input",b[16]),Bi(Gn,"change",b[17]),Bi(B,"input",b[18])],j=!0)},p(W,se){se&1&&F!==(F=!W[0])&&(V.disabled=F),se&2&&(V.checked=W[1].defaultEnabled),se&1&&Ze!==(Ze=!W[0])&&(De.disabled=Ze),se&2&&kn(De.value)!==W[1].debounceTimeout&&Wi(De,W[1].debounceTimeout),se&1&&ut!==(ut=!W[0])&&(je.disabled=ut),se&2&&kn(je.value)!==W[1].angleDefault&&Wi(je,W[1].angleDefault),se&1&&$t!==($t=!W[0])&&(kt.disabled=$t),se&2&&kn(kt.value)!==W[1].angleMin&&Wi(kt,W[1].angleMin),se&1&&sn!==(sn=!W[0])&&(Li.disabled=sn),se&2&&kn(Li.value)!==W[1].angleMax&&Wi(Li,W[1].angleMax),se&1&&Vn!==(Vn=!W[0])&&(xi.disabled=Vn),se&2&&kn(xi.value)!==W[1].angleStep&&Wi(xi,W[1].angleStep),se&1&&On!==(On=!W[0])&&(on.disabled=On),se&2&&kn(on.value)!==W[1].fixedDegrees&&Wi(on,W[1].fixedDegrees),se&3&&Kt!==(Kt=!W[0]||!!W[1].fixedDegrees)&&(li.disabled=Kt),se&2&&kn(li.value)!==W[1].degreesDefault&&Wi(li,W[1].degreesDefault),se&3&&qr!==(qr=!W[0]||!!W[1].fixedDegrees)&&(hi.disabled=qr),se&2&&kn(hi.value)!==W[1].degreesMin&&Wi(hi,W[1].degreesMin),se&3&&mr!==(mr=!W[0]||!!W[1].fixedDegrees)&&(Hi.disabled=mr),se&2&&kn(Hi.value)!==W[1].degreesMax&&Wi(Hi,W[1].degreesMax),se&3&&St!==(St=!W[0]||!!W[1].fixedDegrees)&&(_n.disabled=St),se&2&&kn(_n.value)!==W[1].degreesStep&&Wi(_n,W[1].degreesStep),se&1&&Zn!==(Zn=!W[0])&&(Gn.disabled=Zn),se&2&&(Gn.checked=W[1].respectMapBearing),se&1&&N!==(N=!W[0])&&(B.disabled=N),se&2&&kn(B.value)!==W[1].imageSize&&Wi(B,W[1].imageSize)},d(W){W&&(Te(g),Te(_),Te(C),Te(R),Te(M),Te(L),Te(a),Te(ve),Te(_e),Te(Ct),Te(Ve),Te(wt),Te(Dt),Te(Tt),Te(jt),Te(fn),Te(ei),Te(ss),Te(pr),Te(dr),Te(ke),Te(os),Te(fr),Te(Ls),Te(Je),Te(nt),Te(Lt),Te(ir),Te(En),Te(Si),Te(Gr)),j=!1,bo(ie)}}}function rv(b){let g;return{c(){g=we("span"),g.textContent=`${b[3].name}`,Ye(g,"slot","title")},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function sv(b){let g,_,C,R;return g=new Ds({props:{$$slots:{title:[rv],default:[nv]},$$scope:{ctx:b}}}),{c(){ur(g.$$.fragment),_=it(),C=we("div"),Ye(C,"class","basis-full lg:basis-2/3 shadow-xl")},m(M,L){Qn(g,M,L),Se(M,_,L),Se(M,C,L),b[19](C),R=!0},p(M,[L]){const a={};L&2097155&&(a.$$scope={dirty:L,ctx:M}),g.$set(a)},i(M){R||(Sn(g.$$.fragment,M),R=!0)},o(M){zn(g.$$.fragment,M),R=!1},d(M){M&&(Te(_),Te(C)),er(g,M),b[19](null)}}}function ov(b,g,_){let C;ks(b,zs,wt=>_(20,C=wt));const R=rs.find(wt=>wt.path===C);let M,L,a;$s(()=>{_(4,L=new Vs.Map({container:M,style:qs,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"})),L.on("load",()=>{_(0,a=new Ps(L,{bearings:!0})),_(0,a.interactive=!0,a),L.addControl(new hg.NavigationControl({}))})});let V,F={defaultEnabled:!1,debounceTimeout:150,angleDefault:0,angleMin:0,angleMax:359,angleStep:1,fixedDegrees:0,degreesDefault:45,degreesMin:15,degreesMax:360,degreesStep:15,respectMapBearing:!1,imageSize:50};function ce(){F.defaultEnabled=this.checked,_(1,F)}function ee(){F.debounceTimeout=kn(this.value),_(1,F)}function ve(){F.angleDefault=kn(this.value),_(1,F)}function _e(){F.angleMin=kn(this.value),_(1,F)}function Ae(){F.angleMax=kn(this.value),_(1,F)}function $e(){F.angleStep=kn(this.value),_(1,F)}function De(){F.fixedDegrees=kn(this.value),_(1,F)}function Ze(){F.degreesDefault=kn(this.value),_(1,F)}function Ct(){F.degreesMin=kn(this.value),_(1,F)}function Ve(){F.degreesMax=kn(this.value),_(1,F)}function Ke(){F.degreesStep=kn(this.value),_(1,F)}function et(){F.respectMapBearing=this.checked,_(1,F)}function je(){F.imageSize=kn(this.value),_(1,F)}function ut(wt){_s[wt?"unshift":"push"](()=>{M=wt,_(2,M)})}return b.$$.update=()=>{b.$$.dirty&51&&L&&a&&(V&&L.hasControl(V)&&L.removeControl(V),L.addControl(_(5,V=new Ky(a,F)),"top-left"))},[a,F,M,R,L,V,ce,ee,ve,_e,Ae,$e,De,Ze,Ct,Ve,Ke,et,je,ut]}class av extends $r{constructor(g){super(),Nr(this,g,ov,sv,Er,{})}}const lv=Object.freeze(Object.defineProperty({__proto__:null,default:av},Symbol.toStringTag,{value:"Module"})),cv=[{id:"maplibre-gl-directions-snapline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[2,2],"line-color":"#ffffff","line-opacity":.65,"line-width":2},filter:["==",["get","type"],"SNAPLINE"]},{id:"maplibre-gl-directions-alt-routeline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-pattern":"routeline","line-width":12,"line-opacity":.5},filter:["==",["get","route"],"ALT"]},{id:"maplibre-gl-directions-routeline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-pattern":"routeline","line-width":12},filter:["==",["get","route"],"SELECTED"]},{id:"maplibre-gl-directions-hoverpoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-hoverpoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"HOVERPOINT"]},{id:"maplibre-gl-directions-snappoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-snappoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"SNAPPOINT"]},{id:"maplibre-gl-directions-waypoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-waypoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"WAYPOINT"]}],uv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJpSURBVEiJlZRLSFQBFIa/c2dyGMXHNKUrq0WLgsxt214L20gG0gxGhIIktIk2IS3bRFG4ahFBYQPlY8pQNxkFUbSQigyEiBKLIk3vOODUPO5pMV4fM/fOnTmbuffc8//ff+5jBI8abF9qEb/0iHIU2LPW/obyzEDvnI5vnymlF7cLE20aSAQTNxXtBQyXsZwKt7cZDRc7hyRdNmCiTQNm0JwEDtu92maoa84fr8xDcn6L5Lnf19DmBPE7AZarE7dE8+Y1jXCgWwntLZj5DB/vCqu/ATiSy5k3gAueGwy2L7UYPnkPGMEdcKhfCdQ5xYB0QnhzFVJ/AMghVmt0JPxp80zRvRW/9Nj9/VF3c4CqemVfRO1Tn2J0F84UAyyOAQTqYOdBd3O7GluhqnZNqxz3BCDsAqhuAnF9xzaNG1DTtH662xuA+gGsjLe5XVZ2TQk+T4AgPwGS35XsX2/zbAqSP2wtvzwBCh/yqYS5KW/A3NSWbd95AkDG7aMvY8LijPuDWJzJz6yHU8Y8ARk14kAW8vd2egBmh2B1YWNmdQFmH8L0gGDlNqSk5WlRXKdksQ5zHPREYd8fzP9mU44LxaOjoQ7PDQBQvebUzqZczRHDuu7UdwRE46GXwCtnK6c8TEWGw6/LBuQTcaVcf8Mw+t0uugIiw6EXqD7yche4Fxmpf1sxAEAsvQQkS7gv+3yZy6U8SgIiT8LzSPF/vF1qaV/nUGPR17s1QxkVO2nGEI0UtO9HR0NnvbQlN7Drn2ofMLcp1VcrZbluVjHg3OOQKYaeATJAGsPq6poMr5SjragenFo6H+sweyvR/Ac3+sqU/+vBXgAAAABJRU5ErkJggg==",hv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJwSURBVEiJlZTNSxRxGMc/v98KZmm67qJQ2At0Ksy/obeDXSy7ZBS5KEiCHaJLSMcuUSSeOmi7BkW16taKeDCjMIJOFRgUHSzMjExdc2O3fZmnwzrr6s7s7D6Xmeft+3me+c2MwsGWW9obVZnqRDgG7FsPf0V4LuiB2tDgTKF+ZZeQ5p7y1YroHYEuQNuUpVFyt0b/vaKCwUTRAGnuKY9URCeAI9lgwy5o2J25n5uHuR+5LS9qXNFmK0iZFWB1+1ofojLidV6k4ywc2L+56Mss6t4j+PUb4GgkXXkb6HHcYLmlvVG51HtA461Fei/DziqrOVCrUbjRB0srAGlDGU2ekaGPuTV5z1aVqU4zLudO2YoDSHUl0tZiui6N7thak394BseBjPDhg7biWWs6BFU71omccAYo9gBQ7wVl+5LlKGiorzO9vY4AMQ8+mXIWNy2VrXU5AhSyACDfFyD+z1k8Fof5BdP76QgA/QFApVIwNe0MmJrO2VbeOQIUMp69D0+iZj7bi898QoUnN3zRYUeAlnQIyIyUSkH/AATHYHFpo2hxCR6HUf2DkE6b0aRKxMfyB7awSKtvXOBkXqJiW+Yai1u1hdyj/lbHDQBEuGkVJxa3E8fQ3LKKWwLcIf8r4LWlkuVEasoz7H9TNCCTkevFymstvbYydgn3cOClCE+K0B+qHvG/LRkAIAZXgTXbAqVWki6uFdIoCPA888+h8v/xGwMY3XXBQN7Xu2mGQknTIqd9D0XRtiV83z3qv+jUW3AD00SkG/iWE5k1YgnbzUoGuJ8GIqLlApAEEoZW5z0TD/4U01uSLZ/xXYq0+rpK6fkPouPQTszwGH0AAAAASUVORK5CYII=",pv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAKQSURBVEiJlZRLSFRRGMd/586rVHQySDMqXRRESJuQ1BTsiS1atK5NGpIgodQiIghqleWYbVr0wDZpG6nUICym0UZ0kQXZTlSMHDUczee87mkxXlPn3rl3vtU5//N9/9/5zj3nCkyi3F9fiKBaSk4C+WvymIQeu4w99Za2/EhWL4wWKrvrXItZNg9C1ACKQVpMIp4EszIbhg/fCVsGVHbXuRZ22N8LSYWmFWzLocCVC8BoKMDo6tTGkk+zWVmVehC7HmDRbW/WzHc7s7mWd55D2/duyvm5MkHL7zdMhoMAJ7Ln5x8CdaYdlPvrCyV8A5RdDjeN+Zdx29P19sFcdIkbY8+YjswDxFSVI1+Oe4Y35iSeraBa06/knjU0B3Db06nKOaNNbYpC1dacBICUnNKKj2YcMDTXoijjIJm2tHgt8rQpANgHkOfIRjG+ZP8NhMIe504ABGK/FYAdIELM1FyLiIxqQ5sVwCTA2OoUK6ru1d4Uy2qI8fCMNg1YAIjv8V3F6AwOmgI6ZweJqGsdCIbMAULt0obtMz6GFkcMzb8ujdD+p3d9LqV4awpwKpEOIArxLu7+auPFdA+B+IMCIBAO8nzqA/cm2ojK9W8VIeZ8l7BfvZ2V9dd3ITm3VU9TXED83HWMOnwlngumHQAgua8nL6shXfM1xAM9VRfQW+L5jJR9Bk568dFX0uS3DACQCrctmksp1FtGi4aAvuJmr4TXFuxb+4ofDaQMAFDs4jqwkCQlaHM4bib1SLboK2qaECLxH78eklpvUWPC67UMAPAVe1pBvNqqC+TL3lJPm1m9KQDAFlJrgfEN0mhIiRl3lirAW9E8p6hcAiJAWCAuDhx7/NdKbUpR1t9wtdzfUJNKzT8AkN+WDptOYQAAAABJRU5ErkJggg==",dv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAACmAAAApgHdff84AAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAN9JREFUSIlj/P//PwMtARNNTWdgYGB0ic61oKUFLP8Z/h+nqQURFj9paT4Di4HsH9paULGam6YW0DwVjVpAELAwMDAwaKsqMthbGMEFn714zbBh9yGGSD83BkF+Xrj49gOQLOPpYAkXe//xM8PyTbsYAlztGKQkROHiB0+cY7h6+z7EAlZWFgYeLk64JAcHOwMDAwMDNycHijgLMzMDAwMDitivX7/hepDFWVlZGBgYGBgYnaNzaFraDf1IHvoWsDQFfqOtBY/e0dYTLHMOctDWAkYGRkvCysgHjEO+VQEA4IsuY5Zs3DIAAAAASUVORK5CYII=";function fv(b){let g,_,C,R,M,L,a,V,F,ce;return{c(){g=we("p"),_=dn(`It's completely up to you how to style the Directions' features shown on the map. You can either use the default
    styles provided by the plugin (see other examples), easily modify the default features' dimensions (see the
    `),C=we("a"),C.textContent="Touch-Friendly Features example",R=dn(`) or
    `),M=we("strong"),M.textContent="define your custom features' styles from scratch",L=dn("."),a=it(),V=we("p"),V.textContent="This example demonstrates the last option.",Ye(C,"href","/examples/touch-friendly-features")},m(ee,ve){Se(ee,g,ve),Le(g,_),Le(g,C),Le(g,R),Le(g,M),Le(g,L),Se(ee,a,ve),Se(ee,V,ve),F||(ce=Vd(Zd.call(null,C)),F=!0)},p:Di,d(ee){ee&&(Te(g),Te(a),Te(V)),F=!1,ce()}}}function mv(b){let g;return{c(){g=we("span"),g.textContent=`${b[1].name}`,Ye(g,"slot","title")},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function gv(b){let g,_,C,R;return g=new Ds({props:{$$slots:{title:[mv],default:[fv]},$$scope:{ctx:b}}}),{c(){ur(g.$$.fragment),_=it(),C=we("div"),Ye(C,"class","basis-full lg:basis-2/3 shadow-xl")},m(M,L){Qn(g,M,L),Se(M,_,L),Se(M,C,L),b[2](C),R=!0},p(M,[L]){const a={};L&32&&(a.$$scope={dirty:L,ctx:M}),g.$set(a)},i(M){R||(Sn(g.$$.fragment,M),R=!0)},o(M){zn(g.$$.fragment,M),R=!1},d(M){M&&(Te(_),Te(C)),er(g,M),b[2](null)}}}function _v(b,g,_){let C;ks(b,zs,V=>_(4,C=V));const R=rs.find(V=>V.path===C);let M,L;$s(()=>{const V=new Vs.Map({container:M,style:qs,center:[-74.1197632,40.6974034],zoom:11,customAttribution:`<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a> | Icons made by <a href="https://www.flaticon.com/authors/vectors-market" title="Vectors Market">Vectors Market</a> and by <a href="https://www.flaticon.com/authors/dinosoftlabs" title="DinosoftLabs">DinosoftLabs</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>`,fadeDuration:0});V.on("load",()=>{V.loadImage(uv,(F,ce)=>{!F&&ce&&V.addImage("balloon-waypoint",ce)}),V.loadImage(hv,(F,ce)=>{!F&&ce&&V.addImage("balloon-snappoint",ce)}),V.loadImage(pv,(F,ce)=>{!F&&ce&&V.addImage("balloon-hoverpoint",ce)}),V.loadImage(dv,(F,ce)=>{!F&&ce&&V.addImage("routeline",ce)}),L=new Ps(V,{requestOptions:{alternatives:"true"},layers:cv,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline"]}),L.interactive=!0})});function a(V){_s[V?"unshift":"push"](()=>{M=V,_(0,M)})}return[M,R,a]}class yv extends $r{constructor(g){super(),Nr(this,g,_v,gv,Er,{})}}const vv=Object.freeze(Object.defineProperty({__proto__:null,default:yv},Symbol.toStringTag,{value:"Module"}));class xv extends Ps{constructor(_,C){super(_,C);ap(this,"originalBuildRoutelines",by.buildRoutelines);ap(this,"buildRoutelines",(_,C,R,M)=>{const L=this.originalBuildRoutelines(_,C,R,M);return L[0].forEach((a,V)=>{a.properties&&(a.properties.distance=C[0].legs[V].distance)}),L})}}const gs="distance-measurement-maplibre-gl-directions",bv={sourceName:gs,layers:[{id:`${gs}-snapline`,type:"line",source:gs,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":"#34343f","line-width":2},filter:["==",["get","type"],"SNAPLINE"]},{id:`${gs}-routeline`,type:"line",source:gs,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#212121","line-opacity":.85,"line-width":3},filter:["==",["get","route"],"SELECTED"]},{id:`${gs}-routeline-distance`,type:"symbol",source:gs,layout:{"symbol-placement":"line-center","text-field":"{distance}m","text-size":16,"text-ignore-placement":!0,"text-allow-overlap":!0,"text-overlap":"always"},paint:{"text-color":"#212121","text-halo-color":"#ffffff","text-halo-width":1},filter:["==",["get","route"],"SELECTED"]},{id:`${gs}-hoverpoint`,type:"circle",source:gs,paint:{"circle-radius":9,"circle-color":"#212121"},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${gs}-snappoint`,type:"circle",source:gs,paint:{"circle-radius":["case",["boolean",["get","highlight"],!1],9,7],"circle-color":["case",["boolean",["get","highlight"],!1],"#313131","#494949"]},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${gs}-waypoint`,type:"circle",source:gs,paint:{"circle-radius":["case",["boolean",["get","highlight"],!1],9,7],"circle-color":["case",["boolean",["get","highlight"],!1],"#212121","#2c2c2c"]},filter:["==",["get","type"],"WAYPOINT"]}],sensitiveSnappointLayers:[`${gs}-snappoint`],sensitiveWaypointLayers:[`${gs}-waypoint`],sensitiveRoutelineLayers:[`${gs}-routeline`],sensitiveAltRoutelineLayers:[]};function wv(b){let g;return{c(){g=we("em"),g.textContent="unknown"},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function Tv(b){let g,_,C;return{c(){g=we("strong"),_=dn(b[1]),C=dn("m")},m(R,M){Se(R,g,M),Le(g,_),Le(g,C)},p(R,M){M&2&&om(_,R[1])},d(R){R&&Te(g)}}}function Sv(b){let g,_,C,R,M,L,a,V,F,ce;function ee(Ae,$e){return Ae[1]?Tv:wv}let ve=ee(b),_e=ve(b);return{c(){g=we("p"),_=dn(`Total Route Distance:
    `),_e.c(),C=it(),R=we("small"),R.innerHTML="<strong>Note</strong> that you might want to zoom in and out the map to toggle the distance-annotations visibility",M=it(),L=we("p"),L.textContent=`This is an example of how one could use the plugin's extensibility interfaces to create a distance measurement tool
    out of it.`,a=it(),V=we("p"),V.innerHTML=`Here we create a subclass of the <code>MapLibreGlDirections</code> main super class and augment the original
    <code>buildRoutelines</code>
    method to write each route leg&#39;s distance into a respective feature&#39;s <code>properties</code> object. These saved distances
    are then used by an additional &quot;symbol&quot; layer that displays them along the respective route&#39;s lines on the map.`,F=it(),ce=we("p"),ce.textContent=`The total distance comes from the response's specific field and is updated each time there's the "fetchroutesend" or
    the "removewaypoint" event fired.`},m(Ae,$e){Se(Ae,g,$e),Le(g,_),_e.m(g,null),Se(Ae,C,$e),Se(Ae,R,$e),Se(Ae,M,$e),Se(Ae,L,$e),Se(Ae,a,$e),Se(Ae,V,$e),Se(Ae,F,$e),Se(Ae,ce,$e)},p(Ae,$e){ve===(ve=ee(Ae))&&_e?_e.p(Ae,$e):(_e.d(1),_e=ve(Ae),_e&&(_e.c(),_e.m(g,null)))},d(Ae){Ae&&(Te(g),Te(C),Te(R),Te(M),Te(L),Te(a),Te(V),Te(F),Te(ce)),_e.d()}}}function Ev(b){let g;return{c(){g=we("span"),g.textContent=`${b[2].name}`,Ye(g,"slot","title")},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function Av(b){let g,_,C,R;return g=new Ds({props:{$$slots:{title:[Ev],default:[Sv]},$$scope:{ctx:b}}}),{c(){ur(g.$$.fragment),_=it(),C=we("div"),Ye(C,"class","basis-full lg:basis-2/3 shadow-xl")},m(M,L){Qn(g,M,L),Se(M,_,L),Se(M,C,L),b[3](C),R=!0},p(M,[L]){const a={};L&66&&(a.$$scope={dirty:L,ctx:M}),g.$set(a)},i(M){R||(Sn(g.$$.fragment,M),R=!0)},o(M){zn(g.$$.fragment,M),R=!1},d(M){M&&(Te(_),Te(C)),er(g,M),b[3](null)}}}function Iv(b,g,_){let C;ks(b,zs,F=>_(5,C=F));const R=rs.find(F=>F.path===C);let M,L,a=0;$s(()=>{const F=new Vs.Map({container:M,style:qs,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});F.on("load",()=>{L=new xv(F,bv),L.on("fetchroutesend",ce=>{var ee;_(1,a=(ee=ce.data)==null?void 0:ee.routes[0].distance)}),L.on("removewaypoint",()=>{L.waypoints.length<2&&_(1,a=0)}),L.interactive=!0})});function V(F){_s[F?"unshift":"push"](()=>{M=F,_(0,M)})}return[M,a,R,V]}class Cv extends $r{constructor(g){super(),Nr(this,g,Iv,Av,Er,{})}}const Mv=Object.freeze(Object.defineProperty({__proto__:null,default:Cv},Symbol.toStringTag,{value:"Module"}));class Pv extends Ps{constructor(g,_){super(g,_)}get waypointsFeatures(){return this._waypoints}setWaypointsFeatures(g){this._waypoints=g,this.assignWaypointsCategories();const _=new jc("setwaypoints",void 0);this.fire(_),this.draw()}get snappointsFeatures(){return this.snappoints}setSnappointsFeatures(g){this.snappoints=g,this.draw()}get routelinesFeatures(){return this.routelines}setRoutelinesFeatures(g){this.routelines=g,this.draw()}}function kv(b){let g,_,C,R,M,L,a,V,F,ce,ee,ve,_e,Ae,$e,De,Ze,Ct,Ve,Ke,et;return{c(){g=we("button"),_=dn("Load the saved Route"),R=it(),M=we("button"),L=dn("Save the Route"),V=it(),F=we("button"),ce=dn("Clear"),ve=it(),_e=we("small"),_e.innerHTML=`This example uses the <code>localStorage</code> to save routes, but you are obviously not restricted to it. There might
    instead be a file or a serverside-database or whatever else`,Ae=it(),$e=we("p"),$e.textContent=`If you want to save/load the route, the obvious way to do so would be to save the list of waypoints whenever the
    route is updated and to make a new routing-request with the saved waypoints' coordinates whenever you need to load
    it.`,De=it(),Ze=we("p"),Ze.textContent=`But what if the underlying roads networks changes for some reason? You'll get a different route for the same set of
    waypoints. Moreover, if there are some severe construction works going on, you run into a risk of not getting any
    routes whatsoever.`,Ct=it(),Ve=we("p"),Ve.textContent=`Sometimes it's actually a good idea to save the route as a list of GeoJSON Features and be able to load these saved
    features whenever there's a need. This example shows how that could be done.`,g.disabled=C=!b[1]||b[2],M.disabled=a=!b[1],F.disabled=ee=!b[1]},m(je,ut){Se(je,g,ut),Le(g,_),Se(je,R,ut),Se(je,M,ut),Le(M,L),Se(je,V,ut),Se(je,F,ut),Le(F,ce),Se(je,ve,ut),Se(je,_e,ut),Se(je,Ae,ut),Se(je,$e,ut),Se(je,De,ut),Se(je,Ze,ut),Se(je,Ct,ut),Se(je,Ve,ut),Ke||(et=[Bi(g,"click",b[4]),Bi(M,"click",b[5]),Bi(F,"click",b[6])],Ke=!0)},p(je,ut){ut&6&&C!==(C=!je[1]||je[2])&&(g.disabled=C),ut&2&&a!==(a=!je[1])&&(M.disabled=a),ut&2&&ee!==(ee=!je[1])&&(F.disabled=ee)},d(je){je&&(Te(g),Te(R),Te(M),Te(V),Te(F),Te(ve),Te(_e),Te(Ae),Te($e),Te(De),Te(Ze),Te(Ct),Te(Ve)),Ke=!1,bo(et)}}}function zv(b){let g;return{c(){g=we("span"),g.textContent=`${b[3].name}`,Ye(g,"slot","title")},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function Dv(b){let g,_,C,R;return g=new Ds({props:{$$slots:{title:[zv],default:[kv]},$$scope:{ctx:b}}}),{c(){ur(g.$$.fragment),_=it(),C=we("div"),Ye(C,"class","basis-full lg:basis-2/3 shadow-xl")},m(M,L){Qn(g,M,L),Se(M,_,L),Se(M,C,L),b[7](C),R=!0},p(M,[L]){const a={};L&518&&(a.$$scope={dirty:L,ctx:M}),g.$set(a)},i(M){R||(Sn(g.$$.fragment,M),R=!0)},o(M){zn(g.$$.fragment,M),R=!1},d(M){M&&(Te(_),Te(C)),er(g,M),b[7](null)}}}function Wm(){return localStorage.getItem("saved-waypoints-features")&&localStorage.getItem("saved-snappoints-features")&&localStorage.getItem("saved-routelines-features")}function Lv(b,g,_){let C;ks(b,zs,ve=>_(8,C=ve));const R=rs.find(ve=>ve.path===C);let M,L;$s(()=>{const ve=new Vs.Map({container:M,style:qs,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});ve.on("load",()=>{_(1,L=new Pv(ve)),_(1,L.interactive=!0,L)})});let a=!Wm();function V(){L.setWaypointsFeatures(JSON.parse(localStorage.getItem("saved-waypoints-features")||"")),L.setSnappointsFeatures(JSON.parse(localStorage.getItem("saved-snappoints-features")||"")),L.setRoutelinesFeatures(JSON.parse(localStorage.getItem("saved-routelines-features")||""))}function F(){localStorage.setItem("saved-waypoints-features",JSON.stringify(L.waypointsFeatures)),localStorage.setItem("saved-snappoints-features",JSON.stringify(L.snappointsFeatures)),localStorage.setItem("saved-routelines-features",JSON.stringify(L.routelinesFeatures)),_(2,a=!Wm())}const ce=()=>L.clear();function ee(ve){_s[ve?"unshift":"push"](()=>{M=ve,_(0,M)})}return[M,L,a,R,V,F,ce,ee]}class Rv extends $r{constructor(g){super(),Nr(this,g,Lv,Dv,Er,{})}}const Bv=Object.freeze(Object.defineProperty({__proto__:null,default:Rv},Symbol.toStringTag,{value:"Module"}));var Nd={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Nd.exports;(function(b,g){(function(){var _,C="4.17.21",R=200,M="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",L="Expected a function",a="Invalid `variable` option passed into `_.template`",V="__lodash_hash_undefined__",F=500,ce="__lodash_placeholder__",ee=1,ve=2,_e=4,Ae=1,$e=2,De=1,Ze=2,Ct=4,Ve=8,Ke=16,et=32,je=64,ut=128,wt=256,Dt=512,Nt=30,ai="...",kt=800,$t=16,Tt=1,jt=2,yi=3,vi=1/0,Li=9007199254740991,sn=17976931348623157e292,fn=0/0,ei=4294967295,Ar=ei-1,hr=ei>>>1,xi=[["ary",ut],["bind",De],["bindKey",Ze],["curry",Ve],["curryRight",Ke],["flip",Dt],["partial",et],["partialRight",je],["rearg",wt]],Vn="[object Arguments]",ss="[object Array]",pr="[object AsyncFunction]",Ir="[object Boolean]",tr="[object Date]",on="[object DOMException]",On="[object Error]",dr="[object Function]",ke="[object GeneratorFunction]",en="[object Map]",Vr="[object Number]",li="[object Null]",Kt="[object Object]",os="[object Promise]",fr="[object Proxy]",as="[object RegExp]",qn="[object Set]",hi="[object String]",qr="[object Symbol]",Ls="[object Undefined]",Je="[object WeakMap]",Dn="[object WeakSet]",mn="[object ArrayBuffer]",Hi="[object DataView]",mr="[object Float32Array]",nt="[object Float64Array]",Lt="[object Int8Array]",Vt="[object Int16Array]",gn="[object Int32Array]",_n="[object Uint8Array]",St="[object Uint8ClampedArray]",ir="[object Uint16Array]",En="[object Uint32Array]",Gn=/\b__p \+= '';/g,Zn=/\b(__p \+=) '' \+/g,ys=/(__e\(.*?\)|\b__t\)) \+\n'';/g,an=/&(?:amp|lt|gt|quot|#39);/g,Si=/[&<>"']/g,Gr=RegExp(an.source),Cr=RegExp(Si.source),te=/<%-([\s\S]+?)%>/g,B=/<%([\s\S]+?)%>/g,N=/<%=([\s\S]+?)%>/g,j=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ie=/^\w*$/,W=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,se=/[\\^$.*+?()[\]{}|]/g,ue=RegExp(se.source),le=/^\s+/,ge=/\s/,Fe=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ue=/\{\n\/\* \[wrapped with (.+)\] \*/,Ne=/,? & /,Mt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Zt=/[()=,{}\[\]\/\s]/,yt=/\\(\\)?/g,Et=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,qt=/\w*$/,fi=/^[-+]0x[0-9a-f]+$/i,Ri=/^0b[01]+$/i,si=/^\[object .+?Constructor\]$/,pi=/^0o[0-7]+$/i,Mr=/^(?:0|[1-9]\d*)$/,Bt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,tn=/($^)/,jn=/['\n\r\u2028\u2029\\]/g,Xi="\\ud800-\\udfff",Zr="\\u0300-\\u036f",Ju="\\ufe20-\\ufe2f",nr="\\u20d0-\\u20ff",jr=Zr+Ju+nr,ec="\\u2700-\\u27bf",Ia="a-z\\xdf-\\xf6\\xf8-\\xff",yn="\\xac\\xb1\\xd7\\xf7",oo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",wo="\\u2000-\\u206f",vn=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ca="A-Z\\xc0-\\xd6\\xd8-\\xde",Wn="\\ufe0e\\ufe0f",Ma=yn+oo+wo+vn,ls="['’]",Pa="["+Xi+"]",Ii="["+Ma+"]",To="["+jr+"]",So="\\d+",ao="["+ec+"]",ka="["+Ia+"]",Qo="[^"+Xi+Ma+So+ec+Ia+Ca+"]",tc="\\ud83c[\\udffb-\\udfff]",Xc="(?:"+To+"|"+tc+")",za="[^"+Xi+"]",ic="(?:\\ud83c[\\udde6-\\uddff]){2}",al="[\\ud800-\\udbff][\\udc00-\\udfff]",ea="["+Ca+"]",nc="\\u200d",rc="(?:"+ka+"|"+Qo+")",ll="(?:"+ea+"|"+Qo+")",sc="(?:"+ls+"(?:d|ll|m|re|s|t|ve))?",oc="(?:"+ls+"(?:D|LL|M|RE|S|T|VE))?",Da=Xc+"?",ac="["+Wn+"]?",Eo="(?:"+nc+"(?:"+[za,ic,al].join("|")+")"+ac+Da+")*",cl="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Wr="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ta=ac+Da+Eo,ul="(?:"+[ao,ic,al].join("|")+")"+ta,La="(?:"+[za+To+"?",To,ic,al,Pa].join("|")+")",Ra=RegExp(ls,"g"),Ba=RegExp(To,"g"),Ao=RegExp(tc+"(?="+tc+")|"+La+ta,"g"),Io=RegExp([ea+"?"+ka+"+"+sc+"(?="+[Ii,ea,"$"].join("|")+")",ll+"+"+oc+"(?="+[Ii,ea+rc,"$"].join("|")+")",ea+"?"+rc+"+"+sc,ea+"+"+oc,Wr,cl,So,ul].join("|"),"g"),hl=RegExp("["+nc+Xi+jr+Wn+"]"),Hr=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Xr=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],lc=-1,Fi={};Fi[mr]=Fi[nt]=Fi[Lt]=Fi[Vt]=Fi[gn]=Fi[_n]=Fi[St]=Fi[ir]=Fi[En]=!0,Fi[Vn]=Fi[ss]=Fi[mn]=Fi[Ir]=Fi[Hi]=Fi[tr]=Fi[On]=Fi[dr]=Fi[en]=Fi[Vr]=Fi[Kt]=Fi[as]=Fi[qn]=Fi[hi]=Fi[Je]=!1;var Ci={};Ci[Vn]=Ci[ss]=Ci[mn]=Ci[Hi]=Ci[Ir]=Ci[tr]=Ci[mr]=Ci[nt]=Ci[Lt]=Ci[Vt]=Ci[gn]=Ci[en]=Ci[Vr]=Ci[Kt]=Ci[as]=Ci[qn]=Ci[hi]=Ci[qr]=Ci[_n]=Ci[St]=Ci[ir]=Ci[En]=!0,Ci[On]=Ci[dr]=Ci[Je]=!1;var ia={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},gi={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},pl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},cc={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},uc=parseFloat,dl=parseInt,hc=typeof Hu=="object"&&Hu&&Hu.Object===Object&&Hu,Kc=typeof self=="object"&&self&&self.Object===Object&&self,ln=hc||Kc||Function("return this")(),pc=g&&!g.nodeType&&g,Co=pc&&!0&&b&&!b.nodeType&&b,Yc=Co&&Co.exports===pc,dc=Yc&&hc.process,cs=function(){try{var ye=Co&&Co.require&&Co.require("util").types;return ye||dc&&dc.binding&&dc.binding("util")}catch{}}(),Jc=cs&&cs.isArrayBuffer,fl=cs&&cs.isDate,Fa=cs&&cs.isMap,ml=cs&&cs.isRegExp,gl=cs&&cs.isSet,Mo=cs&&cs.isTypedArray;function Pr(ye,ze,Pe){switch(Pe.length){case 0:return ye.call(ze);case 1:return ye.call(ze,Pe[0]);case 2:return ye.call(ze,Pe[0],Pe[1]);case 3:return ye.call(ze,Pe[0],Pe[1],Pe[2])}return ye.apply(ze,Pe)}function Qc(ye,ze,Pe,ct){for(var Ft=-1,Ei=ye==null?0:ye.length;++Ft<Ei;){var qi=ye[Ft];ze(ct,qi,Pe(qi),ye)}return ct}function kr(ye,ze){for(var Pe=-1,ct=ye==null?0:ye.length;++Pe<ct&&ze(ye[Pe],Pe,ye)!==!1;);return ye}function Po(ye,ze){for(var Pe=ye==null?0:ye.length;Pe--&&ze(ye[Pe],Pe,ye)!==!1;);return ye}function fc(ye,ze){for(var Pe=-1,ct=ye==null?0:ye.length;++Pe<ct;)if(!ze(ye[Pe],Pe,ye))return!1;return!0}function Kr(ye,ze){for(var Pe=-1,ct=ye==null?0:ye.length,Ft=0,Ei=[];++Pe<ct;){var qi=ye[Pe];ze(qi,Pe,ye)&&(Ei[Ft++]=qi)}return Ei}function Gs(ye,ze){var Pe=ye==null?0:ye.length;return!!Pe&&Oi(ye,ze,0)>-1}function _l(ye,ze,Pe){for(var ct=-1,Ft=ye==null?0:ye.length;++ct<Ft;)if(Pe(ze,ye[ct]))return!0;return!1}function ji(ye,ze){for(var Pe=-1,ct=ye==null?0:ye.length,Ft=Array(ct);++Pe<ct;)Ft[Pe]=ze(ye[Pe],Pe,ye);return Ft}function ci(ye,ze){for(var Pe=-1,ct=ze.length,Ft=ye.length;++Pe<ct;)ye[Ft+Pe]=ze[Pe];return ye}function na(ye,ze,Pe,ct){var Ft=-1,Ei=ye==null?0:ye.length;for(ct&&Ei&&(Pe=ye[++Ft]);++Ft<Ei;)Pe=ze(Pe,ye[Ft],Ft,ye);return Pe}function Qu(ye,ze,Pe,ct){var Ft=ye==null?0:ye.length;for(ct&&Ft&&(Pe=ye[--Ft]);Ft--;)Pe=ze(Pe,ye[Ft],Ft,ye);return Pe}function yl(ye,ze){for(var Pe=-1,ct=ye==null?0:ye.length;++Pe<ct;)if(ze(ye[Pe],Pe,ye))return!0;return!1}var ko=Ui("length");function eh(ye){return ye.split("")}function th(ye){return ye.match(Mt)||[]}function mc(ye,ze,Pe){var ct;return Pe(ye,function(Ft,Ei,qi){if(ze(Ft,Ei,qi))return ct=Ei,!1}),ct}function vl(ye,ze,Pe,ct){for(var Ft=ye.length,Ei=Pe+(ct?1:-1);ct?Ei--:++Ei<Ft;)if(ze(ye[Ei],Ei,ye))return Ei;return-1}function Oi(ye,ze,Pe){return ze===ze?iu(ye,ze,Pe):vl(ye,ti,Pe)}function xl(ye,ze,Pe,ct){for(var Ft=Pe-1,Ei=ye.length;++Ft<Ei;)if(ct(ye[Ft],ze))return Ft;return-1}function ti(ye){return ye!==ye}function ra(ye,ze){var Pe=ye==null?0:ye.length;return Pe?Ua(ye,ze)/Pe:fn}function Ui(ye){return function(ze){return ze==null?_:ze[ye]}}function Ni(ye){return function(ze){return ye==null?_:ye[ze]}}function lo(ye,ze,Pe,ct,Ft){return Ft(ye,function(Ei,qi,Mi){Pe=ct?(ct=!1,Ei):ze(Pe,Ei,qi,Mi)}),Pe}function Oa(ye,ze){var Pe=ye.length;for(ye.sort(ze);Pe--;)ye[Pe]=ye[Pe].value;return ye}function Ua(ye,ze){for(var Pe,ct=-1,Ft=ye.length;++ct<Ft;){var Ei=ze(ye[ct]);Ei!==_&&(Pe=Pe===_?Ei:Pe+Ei)}return Pe}function gc(ye,ze){for(var Pe=-1,ct=Array(ye);++Pe<ye;)ct[Pe]=ze(Pe);return ct}function _c(ye,ze){return ji(ze,function(Pe){return[Pe,ye[Pe]]})}function eu(ye){return ye&&ye.slice(0,$a(ye)+1).replace(le,"")}function gr(ye){return function(ze){return ye(ze)}}function zo(ye,ze){return ji(ze,function(Pe){return ye[Pe]})}function co(ye,ze){return ye.has(ze)}function bl(ye,ze){for(var Pe=-1,ct=ye.length;++Pe<ct&&Oi(ze,ye[Pe],0)>-1;);return Pe}function Na(ye,ze){for(var Pe=ye.length;Pe--&&Oi(ze,ye[Pe],0)>-1;);return Pe}function wl(ye,ze){for(var Pe=ye.length,ct=0;Pe--;)ye[Pe]===ze&&++ct;return ct}var yc=Ni(ia),ih=Ni(gi);function tu(ye){return"\\"+cc[ye]}function xn(ye,ze){return ye==null?_:ye[ze]}function us(ye){return hl.test(ye)}function hs(ye){return Hr.test(ye)}function vc(ye){for(var ze,Pe=[];!(ze=ye.next()).done;)Pe.push(ze.value);return Pe}function sa(ye){var ze=-1,Pe=Array(ye.size);return ye.forEach(function(ct,Ft){Pe[++ze]=[Ft,ct]}),Pe}function Tl(ye,ze){return function(Pe){return ye(ze(Pe))}}function rr(ye,ze){for(var Pe=-1,ct=ye.length,Ft=0,Ei=[];++Pe<ct;){var qi=ye[Pe];(qi===ze||qi===ce)&&(ye[Pe]=ce,Ei[Ft++]=Pe)}return Ei}function uo(ye){var ze=-1,Pe=Array(ye.size);return ye.forEach(function(ct){Pe[++ze]=ct}),Pe}function Sl(ye){var ze=-1,Pe=Array(ye.size);return ye.forEach(function(ct){Pe[++ze]=[ct,ct]}),Pe}function iu(ye,ze,Pe){for(var ct=Pe-1,Ft=ye.length;++ct<Ft;)if(ye[ct]===ze)return ct;return-1}function El(ye,ze,Pe){for(var ct=Pe+1;ct--;)if(ye[ct]===ze)return ct;return ct}function Rs(ye){return us(ye)?Va(ye):ko(ye)}function zr(ye){return us(ye)?nu(ye):eh(ye)}function $a(ye){for(var ze=ye.length;ze--&&ge.test(ye.charAt(ze)););return ze}var Do=Ni(pl);function Va(ye){for(var ze=Ao.lastIndex=0;Ao.test(ye);)++ze;return ze}function nu(ye){return ye.match(Ao)||[]}function ru(ye){return ye.match(Io)||[]}var su=function ye(ze){ze=ze==null?ln:Lo.defaults(ln.Object(),ze,Lo.pick(ln,Xr));var Pe=ze.Array,ct=ze.Date,Ft=ze.Error,Ei=ze.Function,qi=ze.Math,Mi=ze.Object,Ro=ze.RegExp,nh=ze.String,Dr=ze.TypeError,qa=Pe.prototype,Bo=Ei.prototype,Yr=Mi.prototype,dt=ze["__core-js_shared__"],Ga=Bo.toString,mi=Yr.hasOwnProperty,oa=0,Za=function(){var s=/[^.]+$/.exec(dt&&dt.keys&&dt.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}(),ht=Yr.toString,Al=Ga.call(Mi),rh=ln._,xc=Ro("^"+Ga.call(mi).replace(se,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Zs=Yc?ze.Buffer:_,Bs=ze.Symbol,ja=ze.Uint8Array,bc=Zs?Zs.allocUnsafe:_,Il=Tl(Mi.getPrototypeOf,Mi),aa=Mi.create,Cl=Yr.propertyIsEnumerable,la=qa.splice,Ml=Bs?Bs.isConcatSpreadable:_,Un=Bs?Bs.iterator:_,_r=Bs?Bs.toStringTag:_,Wa=function(){try{var s=wa(Mi,"defineProperty");return s({},"",{}),s}catch{}}(),wc=ze.clearTimeout!==ln.clearTimeout&&ze.clearTimeout,Tc=ct&&ct.now!==ln.Date.now&&ct.now,Sc=ze.setTimeout!==ln.setTimeout&&ze.setTimeout,Ha=qi.ceil,yr=qi.floor,Gi=Mi.getOwnPropertySymbols,Fo=Zs?Zs.isBuffer:_,Pl=ze.isFinite,kl=qa.join,ou=Tl(Mi.keys,Mi),An=qi.max,Hn=qi.min,vs=ct.now,zl=ze.parseInt,bt=qi.random,zt=qa.reverse,ca=wa(ze,"DataView"),Oo=wa(ze,"Map"),Xa=wa(ze,"Promise"),Ki=wa(ze,"Set"),ua=wa(ze,"WeakMap"),Lr=wa(Mi,"create"),Dl=ua&&new ua,xs={},nn=il(ca),bn=il(Oo),js=il(Xa),ha=il(Ki),pa=il(ua),Uo=Bs?Bs.prototype:_,Ws=Uo?Uo.valueOf:_,Ll=Uo?Uo.toString:_;function Z(s){if(Xe(s)&&!T(s)&&!(s instanceof Jt)){if(s instanceof vr)return s;if(mi.call(s,"__wrapped__"))return Gp(s)}return new vr(s)}var ps=function(){function s(){}return function(u){if(!ot(u))return{};if(aa)return aa(u);s.prototype=u;var y=new s;return s.prototype=_,y}}();function da(){}function vr(s,u){this.__wrapped__=s,this.__actions__=[],this.__chain__=!!u,this.__index__=0,this.__values__=_}Z.templateSettings={escape:te,evaluate:B,interpolate:N,variable:"",imports:{_:Z}},Z.prototype=da.prototype,Z.prototype.constructor=Z,vr.prototype=ps(da.prototype),vr.prototype.constructor=vr;function Jt(s){this.__wrapped__=s,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ei,this.__views__=[]}function Ec(){var s=new Jt(this.__wrapped__);return s.__actions__=wr(this.__actions__),s.__dir__=this.__dir__,s.__filtered__=this.__filtered__,s.__iteratees__=wr(this.__iteratees__),s.__takeCount__=this.__takeCount__,s.__views__=wr(this.__views__),s}function Ac(){if(this.__filtered__){var s=new Jt(this);s.__dir__=-1,s.__filtered__=!0}else s=this.clone(),s.__dir__*=-1;return s}function Rl(){var s=this.__wrapped__.value(),u=this.__dir__,y=T(s),I=u<0,O=y?s.length:0,H=sf(0,O,this.__views__),ae=H.start,de=H.end,Ee=de-ae,qe=I?de:ae-1,Ge=this.__iteratees__,Qe=Ge.length,_t=0,Rt=Hn(Ee,this.__takeCount__);if(!y||!I&&O==Ee&&Rt==Ee)return mu(s,this.__actions__);var Wt=[];e:for(;Ee--&&_t<Rt;){qe+=u;for(var di=-1,Ht=s[qe];++di<Qe;){var Ti=Ge[di],Pi=Ti.iteratee,ro=Ti.type,Ms=Pi(Ht);if(ro==jt)Ht=Ms;else if(!Ms){if(ro==Tt)continue e;break e}}Wt[_t++]=Ht}return Wt}Jt.prototype=ps(da.prototype),Jt.prototype.constructor=Jt;function Hs(s){var u=-1,y=s==null?0:s.length;for(this.clear();++u<y;){var I=s[u];this.set(I[0],I[1])}}function Bl(){this.__data__=Lr?Lr(null):{},this.size=0}function bi(s){var u=this.has(s)&&delete this.__data__[s];return this.size-=u?1:0,u}function p(s){var u=this.__data__;if(Lr){var y=u[s];return y===V?_:y}return mi.call(u,s)?u[s]:_}function t(s){var u=this.__data__;return Lr?u[s]!==_:mi.call(u,s)}function r(s,u){var y=this.__data__;return this.size+=this.has(s)?0:1,y[s]=Lr&&u===_?V:u,this}Hs.prototype.clear=Bl,Hs.prototype.delete=bi,Hs.prototype.get=p,Hs.prototype.has=t,Hs.prototype.set=r;function l(s){var u=-1,y=s==null?0:s.length;for(this.clear();++u<y;){var I=s[u];this.set(I[0],I[1])}}function h(){this.__data__=[],this.size=0}function f(s){var u=this.__data__,y=It(u,s);if(y<0)return!1;var I=u.length-1;return y==I?u.pop():la.call(u,y,1),--this.size,!0}function x(s){var u=this.__data__,y=It(u,s);return y<0?_:u[y][1]}function w(s){return It(this.__data__,s)>-1}function S(s,u){var y=this.__data__,I=It(y,s);return I<0?(++this.size,y.push([s,u])):y[I][1]=u,this}l.prototype.clear=h,l.prototype.delete=f,l.prototype.get=x,l.prototype.has=w,l.prototype.set=S;function A(s){var u=-1,y=s==null?0:s.length;for(this.clear();++u<y;){var I=s[u];this.set(I[0],I[1])}}function k(){this.size=0,this.__data__={hash:new Hs,map:new(Oo||l),string:new Hs}}function z(s){var u=wu(this,s).delete(s);return this.size-=u?1:0,u}function $(s){return wu(this,s).get(s)}function Y(s){return wu(this,s).has(s)}function K(s,u){var y=wu(this,s),I=y.size;return y.set(s,u),this.size+=y.size==I?0:1,this}A.prototype.clear=k,A.prototype.delete=z,A.prototype.get=$,A.prototype.has=Y,A.prototype.set=K;function Q(s){var u=-1,y=s==null?0:s.length;for(this.__data__=new A;++u<y;)this.add(s[u])}function X(s){return this.__data__.set(s,V),this}function pe(s){return this.__data__.has(s)}Q.prototype.add=Q.prototype.push=X,Q.prototype.has=pe;function xe(s){var u=this.__data__=new l(s);this.size=u.size}function re(){this.__data__=new l,this.size=0}function fe(s){var u=this.__data__,y=u.delete(s);return this.size=u.size,y}function Ce(s){return this.__data__.get(s)}function Me(s){return this.__data__.has(s)}function Re(s,u){var y=this.__data__;if(y instanceof l){var I=y.__data__;if(!Oo||I.length<R-1)return I.push([s,u]),this.size=++y.size,this;y=this.__data__=new A(I)}return y.set(s,u),this.size=y.size,this}xe.prototype.clear=re,xe.prototype.delete=fe,xe.prototype.get=Ce,xe.prototype.has=Me,xe.prototype.set=Re;function We(s,u){var y=T(s),I=!y&&v(s),O=!y&&!I&&q(s),H=!y&&!I&&!O&&rn(s),ae=y||I||O||H,de=ae?gc(s.length,nh):[],Ee=de.length;for(var qe in s)(u||mi.call(s,qe))&&!(ae&&(qe=="length"||O&&(qe=="offset"||qe=="parent")||H&&(qe=="buffer"||qe=="byteLength"||qe=="byteOffset")||go(qe,Ee)))&&de.push(qe);return de}function Oe(s){var u=s.length;return u?s[du(0,u-1)]:_}function tt(s,u){return Zo(wr(s),Vi(u,0,s.length))}function vt(s){return Zo(wr(s))}function Qt(s,u,y){(y!==_&&!c(s[u],y)||y===_&&!(u in s))&&Ot(s,u,y)}function rt(s,u,y){var I=s[u];(!(mi.call(s,u)&&c(I,y))||y===_&&!(u in s))&&Ot(s,u,y)}function It(s,u){for(var y=s.length;y--;)if(c(s[y][0],u))return y;return-1}function gt(s,u,y,I){return $n(s,function(O,H,ae){u(I,O,y(O),ae)}),I}function $i(s,u){return s&&Es(u,lr(u),s)}function ii(s,u){return s&&Es(u,ms(u),s)}function Ot(s,u,y){u=="__proto__"&&Wa?Wa(s,u,{configurable:!0,enumerable:!0,value:y,writable:!0}):s[u]=y}function Pt(s,u){for(var y=-1,I=u.length,O=Pe(I),H=s==null;++y<I;)O[y]=H?_:$u(s,u[y]);return O}function Vi(s,u,y){return s===s&&(y!==_&&(s=s<=y?s:y),u!==_&&(s=s>=u?s:u)),s}function ni(s,u,y,I,O,H){var ae,de=u&ee,Ee=u&ve,qe=u&_e;if(y&&(ae=O?y(s,I,O,H):y(s)),ae!==_)return ae;if(!ot(s))return s;var Ge=T(s);if(Ge){if(ae=af(s),!de)return wr(s,ae)}else{var Qe=Tr(s),_t=Qe==dr||Qe==ke;if(q(s))return Tp(s,de);if(Qe==Kt||Qe==Vn||_t&&!O){if(ae=Ee||_t?{}:Fp(s),!de)return Ee?Ep(s,ii(ae,s)):kc(s,$i(ae,s))}else{if(!Ci[Qe])return O?s:{};ae=lf(s,Qe,de)}}H||(H=new xe);var Rt=H.get(s);if(Rt)return Rt;H.set(s,ae),es(s)?s.forEach(function(Ht){ae.add(ni(Ht,u,y,Ht,s,H))}):lt(s)&&s.forEach(function(Ht,Ti){ae.set(Ti,ni(Ht,u,y,Ti,s,H))});var Wt=qe?Ee?wh:bh:Ee?ms:lr,di=Ge?_:Wt(s);return kr(di||s,function(Ht,Ti){di&&(Ti=Ht,Ht=s[Ti]),rt(ae,Ti,ni(Ht,u,y,Ti,s,H))}),ae}function xr(s){var u=lr(s);return function(y){return Ln(y,s,u)}}function Ln(s,u,y){var I=y.length;if(s==null)return!I;for(s=Mi(s);I--;){var O=y[I],H=u[O],ae=s[O];if(ae===_&&!(O in s)||!H(ae))return!1}return!0}function cn(s,u,y){if(typeof s!="function")throw new Dr(L);return tl(function(){s.apply(_,y)},u)}function Nn(s,u,y,I){var O=-1,H=Gs,ae=!0,de=s.length,Ee=[],qe=u.length;if(!de)return Ee;y&&(u=ji(u,gr(y))),I?(H=_l,ae=!1):u.length>=R&&(H=co,ae=!1,u=new Q(u));e:for(;++O<de;){var Ge=s[O],Qe=y==null?Ge:y(Ge);if(Ge=I||Ge!==0?Ge:0,ae&&Qe===Qe){for(var _t=qe;_t--;)if(u[_t]===Qe)continue e;Ee.push(Ge)}else H(u,Qe,I)||Ee.push(Ge)}return Ee}var $n=gu(br),Fs=gu(un,!0);function Xs(s,u){var y=!0;return $n(s,function(I,O,H){return y=!!u(I,O,H),y}),y}function bs(s,u,y){for(var I=-1,O=s.length;++I<O;){var H=s[I],ae=u(H);if(ae!=null&&(de===_?ae===ae&&!Ai(ae):y(ae,de)))var de=ae,Ee=H}return Ee}function No(s,u,y,I){var O=s.length;for(y=Ut(y),y<0&&(y=-y>O?0:O+y),I=I===_||I>O?O:Ut(I),I<0&&(I+=O),I=y>I?0:Or(I);y<I;)s[y++]=u;return s}function Ks(s,u){var y=[];return $n(s,function(I,O,H){u(I,O,H)&&y.push(I)}),y}function _i(s,u,y,I,O){var H=-1,ae=s.length;for(y||(y=Ah),O||(O=[]);++H<ae;){var de=s[H];u>0&&y(de)?u>1?_i(de,u-1,y,I,O):ci(O,de):I||(O[O.length]=de)}return O}var Yi=_u(),Rn=_u(!0);function br(s,u){return s&&Yi(s,u,lr)}function un(s,u){return s&&Rn(s,u,lr)}function wn(s,u){return Kr(u,function(y){return Ie(s[y])})}function In(s,u){u=va(u,s);for(var y=0,I=u.length;s!=null&&y<I;)s=s[yo(u[y++])];return y&&y==I?s:_}function Ji(s,u,y){var I=u(s);return T(s)?I:ci(I,y(s))}function Cn(s){return s==null?s===_?Ls:li:_r&&_r in Mi(s)?rf(s):Rc(s)}function ws(s,u){return s>u}function Ts(s,u){return s!=null&&mi.call(s,u)}function ho(s,u){return s!=null&&u in Mi(s)}function au(s,u,y){return s>=Hn(u,y)&&s<An(u,y)}function Ys(s,u,y){for(var I=y?_l:Gs,O=s[0].length,H=s.length,ae=H,de=Pe(H),Ee=1/0,qe=[];ae--;){var Ge=s[ae];ae&&u&&(Ge=ji(Ge,gr(u))),Ee=Hn(Ge.length,Ee),de[ae]=!y&&(u||O>=120&&Ge.length>=120)?new Q(ae&&Ge):_}Ge=s[0];var Qe=-1,_t=de[0];e:for(;++Qe<O&&qe.length<Ee;){var Rt=Ge[Qe],Wt=u?u(Rt):Rt;if(Rt=y||Rt!==0?Rt:0,!(_t?co(_t,Wt):I(qe,Wt,y))){for(ae=H;--ae;){var di=de[ae];if(!(di?co(di,Wt):I(s[ae],Wt,y)))continue e}_t&&_t.push(Wt),qe.push(Rt)}}return qe}function fa(s,u,y,I){return br(s,function(O,H,ae){u(I,y(O),H,ae)}),I}function $o(s,u,y){u=va(u,s),s=Ih(s,u);var I=s==null?s:s[yo(Os(u))];return I==null?_:Pr(I,s,y)}function Qi(s){return Xe(s)&&Cn(s)==Vn}function Fl(s){return Xe(s)&&Cn(s)==mn}function Ol(s){return Xe(s)&&Cn(s)==tr}function ds(s,u,y,I,O){return s===u?!0:s==null||u==null||!Xe(s)&&!Xe(u)?s!==s&&u!==u:Js(s,u,y,I,ds,O)}function Js(s,u,y,I,O,H){var ae=T(s),de=T(u),Ee=ae?ss:Tr(s),qe=de?ss:Tr(u);Ee=Ee==Vn?Kt:Ee,qe=qe==Vn?Kt:qe;var Ge=Ee==Kt,Qe=qe==Kt,_t=Ee==qe;if(_t&&q(s)){if(!q(u))return!1;ae=!0,Ge=!1}if(_t&&!Ge)return H||(H=new xe),ae||rn(s)?Dp(s,u,y,I,O,H):Lp(s,u,Ee,y,I,O,H);if(!(y&Ae)){var Rt=Ge&&mi.call(s,"__wrapped__"),Wt=Qe&&mi.call(u,"__wrapped__");if(Rt||Wt){var di=Rt?s.value():s,Ht=Wt?u.value():u;return H||(H=new xe),O(di,Ht,y,I,H)}}return _t?(H||(H=new xe),Rp(s,u,y,I,O,H)):!1}function lu(s){return Xe(s)&&Tr(s)==en}function Ic(s,u,y,I){var O=y.length,H=O,ae=!I;if(s==null)return!H;for(s=Mi(s);O--;){var de=y[O];if(ae&&de[2]?de[1]!==s[de[0]]:!(de[0]in s))return!1}for(;++O<H;){de=y[O];var Ee=de[0],qe=s[Ee],Ge=de[1];if(ae&&de[2]){if(qe===_&&!(Ee in s))return!1}else{var Qe=new xe;if(I)var _t=I(qe,Ge,Ee,s,u,Qe);if(!(_t===_?ds(Ge,qe,Ae|$e,I,Qe):_t))return!1}}return!0}function sh(s){if(!ot(s)||uf(s))return!1;var u=Ie(s)?xc:si;return u.test(il(s))}function Wd(s){return Xe(s)&&Cn(s)==as}function mp(s){return Xe(s)&&Tr(s)==qn}function Hd(s){return Xe(s)&&pt(s.length)&&!!Fi[Cn(s)]}function cu(s){return typeof s=="function"?s:s==null?Ns:typeof s=="object"?T(s)?gp(s[0],s[1]):Ka(s):mm(s)}function oh(s){if(!Lc(s))return ou(s);var u=[];for(var y in Mi(s))mi.call(s,y)&&y!="constructor"&&u.push(y);return u}function ah(s){if(!ot(s))return pf(s);var u=Lc(s),y=[];for(var I in s)I=="constructor"&&(u||!mi.call(s,I))||y.push(I);return y}function uu(s,u){return s<u}function lh(s,u){var y=-1,I=P(s)?Pe(s.length):[];return $n(s,function(O,H,ae){I[++y]=u(O,H,ae)}),I}function Ka(s){var u=Sh(s);return u.length==1&&u[0][2]?$p(u[0][0],u[0][1]):function(y){return y===s||Ic(y,s,u)}}function gp(s,u){return Tu(s)&&Np(u)?$p(yo(s),u):function(y){var I=$u(y,s);return I===_&&I===u?sp(y,s):ds(u,I,Ae|$e)}}function ma(s,u,y,I,O){s!==u&&Yi(u,function(H,ae){if(O||(O=new xe),ot(H))hu(s,u,ae,y,ma,I,O);else{var de=I?I(Su(s,ae),H,ae+"",s,u,O):_;de===_&&(de=H),Qt(s,ae,de)}},ms)}function hu(s,u,y,I,O,H,ae){var de=Su(s,y),Ee=Su(u,y),qe=ae.get(Ee);if(qe){Qt(s,y,qe);return}var Ge=H?H(de,Ee,y+"",s,u,ae):_,Qe=Ge===_;if(Qe){var _t=T(Ee),Rt=!_t&&q(Ee),Wt=!_t&&!Rt&&rn(Ee);Ge=Ee,_t||Rt||Wt?T(de)?Ge=de:D(de)?Ge=wr(de):Rt?(Qe=!1,Ge=Tp(Ee,!0)):Wt?(Qe=!1,Ge=Ja(Ee,!0)):Ge=[]:zi(Ee)||v(Ee)?(Ge=de,v(de)?Ge=Yn(de):(!ot(de)||Ie(de))&&(Ge=Fp(Ee))):Qe=!1}Qe&&(ae.set(Ee,Ge),O(Ge,Ee,I,H,ae),ae.delete(Ee)),Qt(s,y,Ge)}function Cc(s,u){var y=s.length;if(y)return u+=u<0?y:0,go(u,y)?s[u]:_}function ch(s,u,y){u.length?u=ji(u,function(H){return T(H)?function(ae){return In(ae,H.length===1?H[0]:H)}:H}):u=[Ns];var I=-1;u=ji(u,gr(Gt()));var O=lh(s,function(H,ae,de){var Ee=ji(u,function(qe){return qe(H)});return{criteria:Ee,index:++I,value:H}});return Oa(O,function(H,ae){return Tn(H,ae,y)})}function _p(s,u){return yp(s,u,function(y,I){return sp(s,I)})}function yp(s,u,y){for(var I=-1,O=u.length,H={};++I<O;){var ae=u[I],de=In(s,ae);y(de,ae)&&Ul(H,va(ae,s),de)}return H}function Rr(s){return function(u){return In(u,s)}}function ga(s,u,y,I){var O=I?xl:Oi,H=-1,ae=u.length,de=s;for(s===u&&(u=wr(u)),y&&(de=ji(s,gr(y)));++H<ae;)for(var Ee=0,qe=u[H],Ge=y?y(qe):qe;(Ee=O(de,Ge,Ee,I))>-1;)de!==s&&la.call(de,Ee,1),la.call(s,Ee,1);return s}function pu(s,u){for(var y=s?u.length:0,I=y-1;y--;){var O=u[y];if(y==I||O!==H){var H=O;go(O)?la.call(s,O,1):mh(s,O)}}return s}function du(s,u){return s+yr(bt()*(u-s+1))}function Mc(s,u,y,I){for(var O=-1,H=An(Ha((u-s)/(y||1)),0),ae=Pe(H);H--;)ae[I?H:++O]=s,s+=y;return ae}function uh(s,u){var y="";if(!s||u<1||u>Li)return y;do u%2&&(y+=s),u=yr(u/2),u&&(s+=s);while(u);return y}function oi(s,u){return Eu(Mn(s,u,Ns),s+"")}function Xd(s){return Oe(qu(s))}function vp(s,u){var y=qu(s);return Zo(y,Vi(u,0,y.length))}function Ul(s,u,y,I){if(!ot(s))return s;u=va(u,s);for(var O=-1,H=u.length,ae=H-1,de=s;de!=null&&++O<H;){var Ee=yo(u[O]),qe=y;if(Ee==="__proto__"||Ee==="constructor"||Ee==="prototype")return s;if(O!=ae){var Ge=de[Ee];qe=I?I(Ge,Ee,de):_,qe===_&&(qe=ot(Ge)?Ge:go(u[O+1])?[]:{})}rt(de,Ee,qe),de=de[Ee]}return s}var hh=Dl?function(s,u){return Dl.set(s,u),s}:Ns,Kd=Wa?function(s,u){return Wa(s,"toString",{configurable:!0,enumerable:!1,value:Zf(u),writable:!0})}:Ns;function ph(s){return Zo(qu(s))}function Ss(s,u,y){var I=-1,O=s.length;u<0&&(u=-u>O?0:O+u),y=y>O?O:y,y<0&&(y+=O),O=u>y?0:y-u>>>0,u>>>=0;for(var H=Pe(O);++I<O;)H[I]=s[I+u];return H}function dh(s,u){var y;return $n(s,function(I,O,H){return y=u(I,O,H),!y}),!!y}function _a(s,u,y){var I=0,O=s==null?I:s.length;if(typeof u=="number"&&u===u&&O<=hr){for(;I<O;){var H=I+O>>>1,ae=s[H];ae!==null&&!Ai(ae)&&(y?ae<=u:ae<u)?I=H+1:O=H}return O}return Jr(s,u,Ns,y)}function Jr(s,u,y,I){var O=0,H=s==null?0:s.length;if(H===0)return 0;u=y(u);for(var ae=u!==u,de=u===null,Ee=Ai(u),qe=u===_;O<H;){var Ge=yr((O+H)/2),Qe=y(s[Ge]),_t=Qe!==_,Rt=Qe===null,Wt=Qe===Qe,di=Ai(Qe);if(ae)var Ht=I||Wt;else qe?Ht=Wt&&(I||_t):de?Ht=Wt&&_t&&(I||!Rt):Ee?Ht=Wt&&_t&&!Rt&&(I||!di):Rt||di?Ht=!1:Ht=I?Qe<=u:Qe<u;Ht?O=Ge+1:H=Ge}return Hn(H,Ar)}function fh(s,u){for(var y=-1,I=s.length,O=0,H=[];++y<I;){var ae=s[y],de=u?u(ae):ae;if(!y||!c(de,Ee)){var Ee=de;H[O++]=ae===0?0:ae}}return H}function xp(s){return typeof s=="number"?s:Ai(s)?fn:+s}function fs(s){if(typeof s=="string")return s;if(T(s))return ji(s,fs)+"";if(Ai(s))return Ll?Ll.call(s):"";var u=s+"";return u=="0"&&1/s==-vi?"-0":u}function ya(s,u,y){var I=-1,O=Gs,H=s.length,ae=!0,de=[],Ee=de;if(y)ae=!1,O=_l;else if(H>=R){var qe=u?null:ba(s);if(qe)return uo(qe);ae=!1,O=co,Ee=new Q}else Ee=u?[]:de;e:for(;++I<H;){var Ge=s[I],Qe=u?u(Ge):Ge;if(Ge=y||Ge!==0?Ge:0,ae&&Qe===Qe){for(var _t=Ee.length;_t--;)if(Ee[_t]===Qe)continue e;u&&Ee.push(Qe),de.push(Ge)}else O(Ee,Qe,y)||(Ee!==de&&Ee.push(Qe),de.push(Ge))}return de}function mh(s,u){return u=va(u,s),s=Ih(s,u),s==null||delete s[yo(Os(u))]}function bp(s,u,y,I){return Ul(s,u,y(In(s,u)),I)}function fu(s,u,y,I){for(var O=s.length,H=I?O:-1;(I?H--:++H<O)&&u(s[H],H,s););return y?Ss(s,I?0:H,I?H+1:O):Ss(s,I?H+1:0,I?O:H)}function mu(s,u){var y=s;return y instanceof Jt&&(y=y.value()),na(u,function(I,O){return O.func.apply(O.thisArg,ci([I],O.args))},y)}function Nl(s,u,y){var I=s.length;if(I<2)return I?ya(s[0]):[];for(var O=-1,H=Pe(I);++O<I;)for(var ae=s[O],de=-1;++de<I;)de!=O&&(H[O]=Nn(H[O]||ae,s[de],u,y));return ya(_i(H,1),u,y)}function gh(s,u,y){for(var I=-1,O=s.length,H=u.length,ae={};++I<O;){var de=I<H?u[I]:_;y(ae,s[I],de)}return ae}function Vo(s){return D(s)?s:[]}function Ya(s){return typeof s=="function"?s:Ns}function va(s,u){return T(s)?s:Tu(s,u)?[s]:Mh(ri(s))}var Yd=oi;function xa(s,u,y){var I=s.length;return y=y===_?I:y,!u&&y>=I?s:Ss(s,u,y)}var wp=wc||function(s){return ln.clearTimeout(s)};function Tp(s,u){if(u)return s.slice();var y=s.length,I=bc?bc(y):new s.constructor(y);return s.copy(I),I}function _h(s){var u=new s.constructor(s.byteLength);return new ja(u).set(new ja(s)),u}function Jd(s,u){var y=u?_h(s.buffer):s.buffer;return new s.constructor(y,s.byteOffset,s.byteLength)}function yh(s){var u=new s.constructor(s.source,qt.exec(s));return u.lastIndex=s.lastIndex,u}function Qd(s){return Ws?Mi(Ws.call(s)):{}}function Ja(s,u){var y=u?_h(s.buffer):s.buffer;return new s.constructor(y,s.byteOffset,s.length)}function Sp(s,u){if(s!==u){var y=s!==_,I=s===null,O=s===s,H=Ai(s),ae=u!==_,de=u===null,Ee=u===u,qe=Ai(u);if(!de&&!qe&&!H&&s>u||H&&ae&&Ee&&!de&&!qe||I&&ae&&Ee||!y&&Ee||!O)return 1;if(!I&&!H&&!qe&&s<u||qe&&y&&O&&!I&&!H||de&&y&&O||!ae&&O||!Ee)return-1}return 0}function Tn(s,u,y){for(var I=-1,O=s.criteria,H=u.criteria,ae=O.length,de=y.length;++I<ae;){var Ee=Sp(O[I],H[I]);if(Ee){if(I>=de)return Ee;var qe=y[I];return Ee*(qe=="desc"?-1:1)}}return s.index-u.index}function Pc(s,u,y,I){for(var O=-1,H=s.length,ae=y.length,de=-1,Ee=u.length,qe=An(H-ae,0),Ge=Pe(Ee+qe),Qe=!I;++de<Ee;)Ge[de]=u[de];for(;++O<ae;)(Qe||O<H)&&(Ge[y[O]]=s[O]);for(;qe--;)Ge[de++]=s[O++];return Ge}function vh(s,u,y,I){for(var O=-1,H=s.length,ae=-1,de=y.length,Ee=-1,qe=u.length,Ge=An(H-de,0),Qe=Pe(Ge+qe),_t=!I;++O<Ge;)Qe[O]=s[O];for(var Rt=O;++Ee<qe;)Qe[Rt+Ee]=u[Ee];for(;++ae<de;)(_t||O<H)&&(Qe[Rt+y[ae]]=s[O++]);return Qe}function wr(s,u){var y=-1,I=s.length;for(u||(u=Pe(I));++y<I;)u[y]=s[y];return u}function Es(s,u,y,I){var O=!y;y||(y={});for(var H=-1,ae=u.length;++H<ae;){var de=u[H],Ee=I?I(y[de],s[de],de,y,s):_;Ee===_&&(Ee=s[de]),O?Ot(y,de,Ee):rt(y,de,Ee)}return y}function kc(s,u){return Es(s,Eh(s),u)}function Ep(s,u){return Es(s,Gl(s),u)}function zc(s,u){return function(y,I){var O=T(y)?Qc:gt,H=u?u():{};return O(y,s,Gt(I,2),H)}}function po(s){return oi(function(u,y){var I=-1,O=y.length,H=O>1?y[O-1]:_,ae=O>2?y[2]:_;for(H=s.length>3&&typeof H=="function"?(O--,H):_,ae&&Br(y[0],y[1],ae)&&(H=O<3?_:H,O=1),u=Mi(u);++I<O;){var de=y[I];de&&s(u,de,I,H)}return u})}function gu(s,u){return function(y,I){if(y==null)return y;if(!P(y))return s(y,I);for(var O=y.length,H=u?O:-1,ae=Mi(y);(u?H--:++H<O)&&I(ae[H],H,ae)!==!1;);return y}}function _u(s){return function(u,y,I){for(var O=-1,H=Mi(u),ae=I(u),de=ae.length;de--;){var Ee=ae[s?de:++O];if(y(H[Ee],Ee,H)===!1)break}return u}}function Ap(s,u,y){var I=u&De,O=qo(s);function H(){var ae=this&&this!==ln&&this instanceof H?O:s;return ae.apply(I?y:this,arguments)}return H}function Ip(s){return function(u){u=ri(u);var y=us(u)?zr(u):_,I=y?y[0]:u.charAt(0),O=y?xa(y,1).join(""):u.slice(1);return I[s]()+O}}function Qa(s){return function(u){return na(dm(pm(u).replace(Ra,"")),s,"")}}function qo(s){return function(){var u=arguments;switch(u.length){case 0:return new s;case 1:return new s(u[0]);case 2:return new s(u[0],u[1]);case 3:return new s(u[0],u[1],u[2]);case 4:return new s(u[0],u[1],u[2],u[3]);case 5:return new s(u[0],u[1],u[2],u[3],u[4]);case 6:return new s(u[0],u[1],u[2],u[3],u[4],u[5]);case 7:return new s(u[0],u[1],u[2],u[3],u[4],u[5],u[6])}var y=ps(s.prototype),I=s.apply(y,u);return ot(I)?I:y}}function ef(s,u,y){var I=qo(s);function O(){for(var H=arguments.length,ae=Pe(H),de=H,Ee=mo(O);de--;)ae[de]=arguments[de];var qe=H<3&&ae[0]!==Ee&&ae[H-1]!==Ee?[]:rr(ae,Ee);if(H-=qe.length,H<y)return Pp(s,u,$l,O.placeholder,_,ae,qe,_,_,y-H);var Ge=this&&this!==ln&&this instanceof O?I:s;return Pr(Ge,this,ae)}return O}function yu(s){return function(u,y,I){var O=Mi(u);if(!P(u)){var H=Gt(y,3);u=lr(u),y=function(de){return H(O[de],de,O)}}var ae=s(u,y,I);return ae>-1?O[H?u[ae]:ae]:_}}function Cp(s){return Go(function(u){var y=u.length,I=y,O=vr.prototype.thru;for(s&&u.reverse();I--;){var H=u[I];if(typeof H!="function")throw new Dr(L);if(O&&!ae&&ql(H)=="wrapper")var ae=new vr([],!0)}for(I=ae?I:y;++I<y;){H=u[I];var de=ql(H),Ee=de=="wrapper"?Th(H):_;Ee&&Zl(Ee[0])&&Ee[1]==(ut|Ve|et|wt)&&!Ee[4].length&&Ee[9]==1?ae=ae[ql(Ee[0])].apply(ae,Ee[3]):ae=H.length==1&&Zl(H)?ae[de]():ae.thru(H)}return function(){var qe=arguments,Ge=qe[0];if(ae&&qe.length==1&&T(Ge))return ae.plant(Ge).value();for(var Qe=0,_t=y?u[Qe].apply(this,qe):Ge;++Qe<y;)_t=u[Qe].call(this,_t);return _t}})}function $l(s,u,y,I,O,H,ae,de,Ee,qe){var Ge=u&ut,Qe=u&De,_t=u&Ze,Rt=u&(Ve|Ke),Wt=u&Dt,di=_t?_:qo(s);function Ht(){for(var Ti=arguments.length,Pi=Pe(Ti),ro=Ti;ro--;)Pi[ro]=arguments[ro];if(Rt)var Ms=mo(Ht),so=wl(Pi,Ms);if(I&&(Pi=Pc(Pi,I,O,Rt)),H&&(Pi=vh(Pi,H,ae,Rt)),Ti-=so,Rt&&Ti<qe){var Jn=rr(Pi,Ms);return Pp(s,u,$l,Ht.placeholder,y,Pi,Jn,de,Ee,qe-Ti)}var Yo=Qe?y:this,sl=_t?Yo[s]:s;return Ti=Pi.length,de?Pi=qp(Pi,de):Wt&&Ti>1&&Pi.reverse(),Ge&&Ee<Ti&&(Pi.length=Ee),this&&this!==ln&&this instanceof Ht&&(sl=di||qo(sl)),sl.apply(Yo,Pi)}return Ht}function vu(s,u){return function(y,I){return fa(y,s,u(I),{})}}function Vl(s,u){return function(y,I){var O;if(y===_&&I===_)return u;if(y!==_&&(O=y),I!==_){if(O===_)return I;typeof y=="string"||typeof I=="string"?(y=fs(y),I=fs(I)):(y=xp(y),I=xp(I)),O=s(y,I)}return O}}function xu(s){return Go(function(u){return u=ji(u,gr(Gt())),oi(function(y){var I=this;return s(u,function(O){return Pr(O,I,y)})})})}function Dc(s,u){u=u===_?" ":fs(u);var y=u.length;if(y<2)return y?uh(u,s):u;var I=uh(u,Ha(s/Rs(u)));return us(u)?xa(zr(I),0,s).join(""):I.slice(0,s)}function tf(s,u,y,I){var O=u&De,H=qo(s);function ae(){for(var de=-1,Ee=arguments.length,qe=-1,Ge=I.length,Qe=Pe(Ge+Ee),_t=this&&this!==ln&&this instanceof ae?H:s;++qe<Ge;)Qe[qe]=I[qe];for(;Ee--;)Qe[qe++]=arguments[++de];return Pr(_t,O?y:this,Qe)}return ae}function Mp(s){return function(u,y,I){return I&&typeof I!="number"&&Br(u,y,I)&&(y=I=_),u=hn(u),y===_?(y=u,u=0):y=hn(y),I=I===_?u<y?1:-1:hn(I),Mc(u,y,I,s)}}function bu(s){return function(u,y){return typeof u=="string"&&typeof y=="string"||(u=wi(u),y=wi(y)),s(u,y)}}function Pp(s,u,y,I,O,H,ae,de,Ee,qe){var Ge=u&Ve,Qe=Ge?ae:_,_t=Ge?_:ae,Rt=Ge?H:_,Wt=Ge?_:H;u|=Ge?et:je,u&=~(Ge?je:et),u&Ct||(u&=~(De|Ze));var di=[s,u,O,Rt,Qe,Wt,_t,de,Ee,qe],Ht=y.apply(_,di);return Zl(s)&&ki(Ht,di),Ht.placeholder=I,Ch(Ht,s,u)}function xh(s){var u=qi[s];return function(y,I){if(y=wi(y),I=I==null?0:Hn(Ut(I),292),I&&Pl(y)){var O=(ri(y)+"e").split("e"),H=u(O[0]+"e"+(+O[1]+I));return O=(ri(H)+"e").split("e"),+(O[0]+"e"+(+O[1]-I))}return u(y)}}var ba=Ki&&1/uo(new Ki([,-0]))[1]==vi?function(s){return new Ki(s)}:Hf;function kp(s){return function(u){var y=Tr(u);return y==en?sa(u):y==qn?Sl(u):_c(u,s(u))}}function fo(s,u,y,I,O,H,ae,de){var Ee=u&Ze;if(!Ee&&typeof s!="function")throw new Dr(L);var qe=I?I.length:0;if(qe||(u&=~(et|je),I=O=_),ae=ae===_?ae:An(Ut(ae),0),de=de===_?de:Ut(de),qe-=O?O.length:0,u&je){var Ge=I,Qe=O;I=O=_}var _t=Ee?_:Th(s),Rt=[s,u,y,I,O,Ge,Qe,H,ae,de];if(_t&&hf(Rt,_t),s=Rt[0],u=Rt[1],y=Rt[2],I=Rt[3],O=Rt[4],de=Rt[9]=Rt[9]===_?Ee?0:s.length:An(Rt[9]-qe,0),!de&&u&(Ve|Ke)&&(u&=~(Ve|Ke)),!u||u==De)var Wt=Ap(s,u,y);else u==Ve||u==Ke?Wt=ef(s,u,de):(u==et||u==(De|et))&&!O.length?Wt=tf(s,u,y,I):Wt=$l.apply(_,Rt);var di=_t?hh:ki;return Ch(di(Wt,Rt),s,u)}function el(s,u,y,I){return s===_||c(s,Yr[y])&&!mi.call(I,y)?u:s}function zp(s,u,y,I,O,H){return ot(s)&&ot(u)&&(H.set(u,s),ma(s,u,_,zp,H),H.delete(u)),s}function nf(s){return zi(s)?_:s}function Dp(s,u,y,I,O,H){var ae=y&Ae,de=s.length,Ee=u.length;if(de!=Ee&&!(ae&&Ee>de))return!1;var qe=H.get(s),Ge=H.get(u);if(qe&&Ge)return qe==u&&Ge==s;var Qe=-1,_t=!0,Rt=y&$e?new Q:_;for(H.set(s,u),H.set(u,s);++Qe<de;){var Wt=s[Qe],di=u[Qe];if(I)var Ht=ae?I(di,Wt,Qe,u,s,H):I(Wt,di,Qe,s,u,H);if(Ht!==_){if(Ht)continue;_t=!1;break}if(Rt){if(!yl(u,function(Ti,Pi){if(!co(Rt,Pi)&&(Wt===Ti||O(Wt,Ti,y,I,H)))return Rt.push(Pi)})){_t=!1;break}}else if(!(Wt===di||O(Wt,di,y,I,H))){_t=!1;break}}return H.delete(s),H.delete(u),_t}function Lp(s,u,y,I,O,H,ae){switch(y){case Hi:if(s.byteLength!=u.byteLength||s.byteOffset!=u.byteOffset)return!1;s=s.buffer,u=u.buffer;case mn:return!(s.byteLength!=u.byteLength||!H(new ja(s),new ja(u)));case Ir:case tr:case Vr:return c(+s,+u);case On:return s.name==u.name&&s.message==u.message;case as:case hi:return s==u+"";case en:var de=sa;case qn:var Ee=I&Ae;if(de||(de=uo),s.size!=u.size&&!Ee)return!1;var qe=ae.get(s);if(qe)return qe==u;I|=$e,ae.set(s,u);var Ge=Dp(de(s),de(u),I,O,H,ae);return ae.delete(s),Ge;case qr:if(Ws)return Ws.call(s)==Ws.call(u)}return!1}function Rp(s,u,y,I,O,H){var ae=y&Ae,de=bh(s),Ee=de.length,qe=bh(u),Ge=qe.length;if(Ee!=Ge&&!ae)return!1;for(var Qe=Ee;Qe--;){var _t=de[Qe];if(!(ae?_t in u:mi.call(u,_t)))return!1}var Rt=H.get(s),Wt=H.get(u);if(Rt&&Wt)return Rt==u&&Wt==s;var di=!0;H.set(s,u),H.set(u,s);for(var Ht=ae;++Qe<Ee;){_t=de[Qe];var Ti=s[_t],Pi=u[_t];if(I)var ro=ae?I(Pi,Ti,_t,u,s,H):I(Ti,Pi,_t,s,u,H);if(!(ro===_?Ti===Pi||O(Ti,Pi,y,I,H):ro)){di=!1;break}Ht||(Ht=_t=="constructor")}if(di&&!Ht){var Ms=s.constructor,so=u.constructor;Ms!=so&&"constructor"in s&&"constructor"in u&&!(typeof Ms=="function"&&Ms instanceof Ms&&typeof so=="function"&&so instanceof so)&&(di=!1)}return H.delete(s),H.delete(u),di}function Go(s){return Eu(Mn(s,_,zh),s+"")}function bh(s){return Ji(s,lr,Eh)}function wh(s){return Ji(s,ms,Gl)}var Th=Dl?function(s){return Dl.get(s)}:Hf;function ql(s){for(var u=s.name+"",y=xs[u],I=mi.call(xs,u)?y.length:0;I--;){var O=y[I],H=O.func;if(H==null||H==s)return O.name}return u}function mo(s){var u=mi.call(Z,"placeholder")?Z:s;return u.placeholder}function Gt(){var s=Z.iteratee||jf;return s=s===jf?cu:s,arguments.length?s(arguments[0],arguments[1]):s}function wu(s,u){var y=s.__data__;return cf(u)?y[typeof u=="string"?"string":"hash"]:y.map}function Sh(s){for(var u=lr(s),y=u.length;y--;){var I=u[y],O=s[I];u[y]=[I,O,Np(O)]}return u}function wa(s,u){var y=xn(s,u);return sh(y)?y:_}function rf(s){var u=mi.call(s,_r),y=s[_r];try{s[_r]=_;var I=!0}catch{}var O=ht.call(s);return I&&(u?s[_r]=y:delete s[_r]),O}var Eh=Gi?function(s){return s==null?[]:(s=Mi(s),Kr(Gi(s),function(u){return Cl.call(s,u)}))}:Xf,Gl=Gi?function(s){for(var u=[];s;)ci(u,Eh(s)),s=Il(s);return u}:Xf,Tr=Cn;(ca&&Tr(new ca(new ArrayBuffer(1)))!=Hi||Oo&&Tr(new Oo)!=en||Xa&&Tr(Xa.resolve())!=os||Ki&&Tr(new Ki)!=qn||ua&&Tr(new ua)!=Je)&&(Tr=function(s){var u=Cn(s),y=u==Kt?s.constructor:_,I=y?il(y):"";if(I)switch(I){case nn:return Hi;case bn:return en;case js:return os;case ha:return qn;case pa:return Je}return u});function sf(s,u,y){for(var I=-1,O=y.length;++I<O;){var H=y[I],ae=H.size;switch(H.type){case"drop":s+=ae;break;case"dropRight":u-=ae;break;case"take":u=Hn(u,s+ae);break;case"takeRight":s=An(s,u-ae);break}}return{start:s,end:u}}function of(s){var u=s.match(Ue);return u?u[1].split(Ne):[]}function Bp(s,u,y){u=va(u,s);for(var I=-1,O=u.length,H=!1;++I<O;){var ae=yo(u[I]);if(!(H=s!=null&&y(s,ae)))break;s=s[ae]}return H||++I!=O?H:(O=s==null?0:s.length,!!O&&pt(O)&&go(ae,O)&&(T(s)||v(s)))}function af(s){var u=s.length,y=new s.constructor(u);return u&&typeof s[0]=="string"&&mi.call(s,"index")&&(y.index=s.index,y.input=s.input),y}function Fp(s){return typeof s.constructor=="function"&&!Lc(s)?ps(Il(s)):{}}function lf(s,u,y){var I=s.constructor;switch(u){case mn:return _h(s);case Ir:case tr:return new I(+s);case Hi:return Jd(s,y);case mr:case nt:case Lt:case Vt:case gn:case _n:case St:case ir:case En:return Ja(s,y);case en:return new I;case Vr:case hi:return new I(s);case as:return yh(s);case qn:return new I;case qr:return Qd(s)}}function Op(s,u){var y=u.length;if(!y)return s;var I=y-1;return u[I]=(y>1?"& ":"")+u[I],u=u.join(y>2?", ":" "),s.replace(Fe,`{
/* [wrapped with `+u+`] */
`)}function Ah(s){return T(s)||v(s)||!!(Ml&&s&&s[Ml])}function go(s,u){var y=typeof s;return u=u??Li,!!u&&(y=="number"||y!="symbol"&&Mr.test(s))&&s>-1&&s%1==0&&s<u}function Br(s,u,y){if(!ot(y))return!1;var I=typeof u;return(I=="number"?P(y)&&go(u,y.length):I=="string"&&u in y)?c(y[u],s):!1}function Tu(s,u){if(T(s))return!1;var y=typeof s;return y=="number"||y=="symbol"||y=="boolean"||s==null||Ai(s)?!0:ie.test(s)||!j.test(s)||u!=null&&s in Mi(u)}function cf(s){var u=typeof s;return u=="string"||u=="number"||u=="symbol"||u=="boolean"?s!=="__proto__":s===null}function Zl(s){var u=ql(s),y=Z[u];if(typeof y!="function"||!(u in Jt.prototype))return!1;if(s===y)return!0;var I=Th(y);return!!I&&s===I[0]}function uf(s){return!!Za&&Za in s}var Up=dt?Ie:Kf;function Lc(s){var u=s&&s.constructor,y=typeof u=="function"&&u.prototype||Yr;return s===y}function Np(s){return s===s&&!ot(s)}function $p(s,u){return function(y){return y==null?!1:y[s]===u&&(u!==_||s in Mi(y))}}function Vp(s){var u=Vc(s,function(I){return y.size===F&&y.clear(),I}),y=u.cache;return u}function hf(s,u){var y=s[1],I=u[1],O=y|I,H=O<(De|Ze|ut),ae=I==ut&&y==Ve||I==ut&&y==wt&&s[7].length<=u[8]||I==(ut|wt)&&u[7].length<=u[8]&&y==Ve;if(!(H||ae))return s;I&De&&(s[2]=u[2],O|=y&De?0:Ct);var de=u[3];if(de){var Ee=s[3];s[3]=Ee?Pc(Ee,de,u[4]):de,s[4]=Ee?rr(s[3],ce):u[4]}return de=u[5],de&&(Ee=s[5],s[5]=Ee?vh(Ee,de,u[6]):de,s[6]=Ee?rr(s[5],ce):u[6]),de=u[7],de&&(s[7]=de),I&ut&&(s[8]=s[8]==null?u[8]:Hn(s[8],u[8])),s[9]==null&&(s[9]=u[9]),s[0]=u[0],s[1]=O,s}function pf(s){var u=[];if(s!=null)for(var y in Mi(s))u.push(y);return u}function Rc(s){return ht.call(s)}function Mn(s,u,y){return u=An(u===_?s.length-1:u,0),function(){for(var I=arguments,O=-1,H=An(I.length-u,0),ae=Pe(H);++O<H;)ae[O]=I[u+O];O=-1;for(var de=Pe(u+1);++O<u;)de[O]=I[O];return de[u]=y(ae),Pr(s,this,de)}}function Ih(s,u){return u.length<2?s:In(s,Ss(u,0,-1))}function qp(s,u){for(var y=s.length,I=Hn(u.length,y),O=wr(s);I--;){var H=u[I];s[I]=go(H,y)?O[H]:_}return s}function Su(s,u){if(!(u==="constructor"&&typeof s[u]=="function")&&u!="__proto__")return s[u]}var ki=_o(hh),tl=Sc||function(s,u){return ln.setTimeout(s,u)},Eu=_o(Kd);function Ch(s,u,y){var I=u+"";return Eu(s,Op(I,df(of(I),y)))}function _o(s){var u=0,y=0;return function(){var I=vs(),O=$t-(I-y);if(y=I,O>0){if(++u>=kt)return arguments[0]}else u=0;return s.apply(_,arguments)}}function Zo(s,u){var y=-1,I=s.length,O=I-1;for(u=u===_?I:u;++y<u;){var H=du(y,O),ae=s[H];s[H]=s[y],s[y]=ae}return s.length=u,s}var Mh=Vp(function(s){var u=[];return s.charCodeAt(0)===46&&u.push(""),s.replace(W,function(y,I,O,H){u.push(O?H.replace(yt,"$1"):I||y)}),u});function yo(s){if(typeof s=="string"||Ai(s))return s;var u=s+"";return u=="0"&&1/s==-vi?"-0":u}function il(s){if(s!=null){try{return Ga.call(s)}catch{}try{return s+""}catch{}}return""}function df(s,u){return kr(xi,function(y){var I="_."+y[0];u&y[1]&&!Gs(s,I)&&s.push(I)}),s.sort()}function Gp(s){if(s instanceof Jt)return s.clone();var u=new vr(s.__wrapped__,s.__chain__);return u.__actions__=wr(s.__actions__),u.__index__=s.__index__,u.__values__=s.__values__,u}function ff(s,u,y){(y?Br(s,u,y):u===_)?u=1:u=An(Ut(u),0);var I=s==null?0:s.length;if(!I||u<1)return[];for(var O=0,H=0,ae=Pe(Ha(I/u));O<I;)ae[H++]=Ss(s,O,O+=u);return ae}function mf(s){for(var u=-1,y=s==null?0:s.length,I=0,O=[];++u<y;){var H=s[u];H&&(O[I++]=H)}return O}function gf(){var s=arguments.length;if(!s)return[];for(var u=Pe(s-1),y=arguments[0],I=s;I--;)u[I-1]=arguments[I];return ci(T(y)?wr(y):[y],_i(u,1))}var _f=oi(function(s,u){return D(s)?Nn(s,_i(u,1,D,!0)):[]}),yf=oi(function(s,u){var y=Os(u);return D(y)&&(y=_),D(s)?Nn(s,_i(u,1,D,!0),Gt(y,2)):[]}),Au=oi(function(s,u){var y=Os(u);return D(y)&&(y=_),D(s)?Nn(s,_i(u,1,D,!0),_,y):[]});function jl(s,u,y){var I=s==null?0:s.length;return I?(u=y||u===_?1:Ut(u),Ss(s,u<0?0:u,I)):[]}function Zp(s,u,y){var I=s==null?0:s.length;return I?(u=y||u===_?1:Ut(u),u=I-u,Ss(s,0,u<0?0:u)):[]}function Ph(s,u){return s&&s.length?fu(s,Gt(u,3),!0,!0):[]}function kh(s,u){return s&&s.length?fu(s,Gt(u,3),!0):[]}function vf(s,u,y,I){var O=s==null?0:s.length;return O?(y&&typeof y!="number"&&Br(s,u,y)&&(y=0,I=O),No(s,u,y,I)):[]}function jp(s,u,y){var I=s==null?0:s.length;if(!I)return-1;var O=y==null?0:Ut(y);return O<0&&(O=An(I+O,0)),vl(s,Gt(u,3),O)}function Wp(s,u,y){var I=s==null?0:s.length;if(!I)return-1;var O=I-1;return y!==_&&(O=Ut(y),O=y<0?An(I+O,0):Hn(O,I-1)),vl(s,Gt(u,3),O,!0)}function zh(s){var u=s==null?0:s.length;return u?_i(s,1):[]}function Hp(s){var u=s==null?0:s.length;return u?_i(s,vi):[]}function Qr(s,u){var y=s==null?0:s.length;return y?(u=u===_?1:Ut(u),_i(s,u)):[]}function Dh(s){for(var u=-1,y=s==null?0:s.length,I={};++u<y;){var O=s[u];I[O[0]]=O[1]}return I}function Lh(s){return s&&s.length?s[0]:_}function Ta(s,u,y){var I=s==null?0:s.length;if(!I)return-1;var O=y==null?0:Ut(y);return O<0&&(O=An(I+O,0)),Oi(s,u,O)}function Bc(s){var u=s==null?0:s.length;return u?Ss(s,0,-1):[]}var Fc=oi(function(s){var u=ji(s,Vo);return u.length&&u[0]===s[0]?Ys(u):[]}),Wl=oi(function(s){var u=Os(s),y=ji(s,Vo);return u===Os(y)?u=_:y.pop(),y.length&&y[0]===s[0]?Ys(y,Gt(u,2)):[]}),Iu=oi(function(s){var u=Os(s),y=ji(s,Vo);return u=typeof u=="function"?u:_,u&&y.pop(),y.length&&y[0]===s[0]?Ys(y,_,u):[]});function Cu(s,u){return s==null?"":kl.call(s,u)}function Os(s){var u=s==null?0:s.length;return u?s[u-1]:_}function Xp(s,u,y){var I=s==null?0:s.length;if(!I)return-1;var O=I;return y!==_&&(O=Ut(y),O=O<0?An(I+O,0):Hn(O,I-1)),u===u?El(s,u,O):vl(s,ti,O,!0)}function Kp(s,u){return s&&s.length?Cc(s,Ut(u)):_}var xf=oi(Rh);function Rh(s,u){return s&&s.length&&u&&u.length?ga(s,u):s}function Yp(s,u,y){return s&&s.length&&u&&u.length?ga(s,u,Gt(y,2)):s}function Bh(s,u,y){return s&&s.length&&u&&u.length?ga(s,u,_,y):s}var Fh=Go(function(s,u){var y=s==null?0:s.length,I=Pt(s,u);return pu(s,ji(u,function(O){return go(O,y)?+O:O}).sort(Sp)),I});function bf(s,u){var y=[];if(!(s&&s.length))return y;var I=-1,O=[],H=s.length;for(u=Gt(u,3);++I<H;){var ae=s[I];u(ae,I,s)&&(y.push(ae),O.push(I))}return pu(s,O),y}function Oh(s){return s==null?s:zt.call(s)}function Jp(s,u,y){var I=s==null?0:s.length;return I?(y&&typeof y!="number"&&Br(s,u,y)?(u=0,y=I):(u=u==null?0:Ut(u),y=y===_?I:Ut(y)),Ss(s,u,y)):[]}function Oc(s,u){return _a(s,u)}function vo(s,u,y){return Jr(s,u,Gt(y,2))}function Sa(s,u){var y=s==null?0:s.length;if(y){var I=_a(s,u);if(I<y&&c(s[I],u))return I}return-1}function Qp(s,u){return _a(s,u,!0)}function Uh(s,u,y){return Jr(s,u,Gt(y,2),!0)}function wf(s,u){var y=s==null?0:s.length;if(y){var I=_a(s,u,!0)-1;if(c(s[I],u))return I}return-1}function Tf(s){return s&&s.length?fh(s):[]}function Mu(s,u){return s&&s.length?fh(s,Gt(u,2)):[]}function Nh(s){var u=s==null?0:s.length;return u?Ss(s,1,u):[]}function Sf(s,u,y){return s&&s.length?(u=y||u===_?1:Ut(u),Ss(s,0,u<0?0:u)):[]}function $h(s,u,y){var I=s==null?0:s.length;return I?(u=y||u===_?1:Ut(u),u=I-u,Ss(s,u<0?0:u,I)):[]}function Vh(s,u){return s&&s.length?fu(s,Gt(u,3),!1,!0):[]}function Hl(s,u){return s&&s.length?fu(s,Gt(u,3)):[]}var ed=oi(function(s){return ya(_i(s,1,D,!0))}),td=oi(function(s){var u=Os(s);return D(u)&&(u=_),ya(_i(s,1,D,!0),Gt(u,2))}),qh=oi(function(s){var u=Os(s);return u=typeof u=="function"?u:_,ya(_i(s,1,D,!0),_,u)});function id(s){return s&&s.length?ya(s):[]}function Pu(s,u){return s&&s.length?ya(s,Gt(u,2)):[]}function nd(s,u){return u=typeof u=="function"?u:_,s&&s.length?ya(s,_,u):[]}function Gh(s){if(!(s&&s.length))return[];var u=0;return s=Kr(s,function(y){if(D(y))return u=An(y.length,u),!0}),gc(u,function(y){return ji(s,Ui(y))})}function rd(s,u){if(!(s&&s.length))return[];var y=Gh(s);return u==null?y:ji(y,function(I){return Pr(u,_,I)})}var sd=oi(function(s,u){return D(s)?Nn(s,u):[]}),Ef=oi(function(s){return Nl(Kr(s,D))}),Af=oi(function(s){var u=Os(s);return D(u)&&(u=_),Nl(Kr(s,D),Gt(u,2))}),If=oi(function(s){var u=Os(s);return u=typeof u=="function"?u:_,Nl(Kr(s,D),_,u)}),Cf=oi(Gh);function Zh(s,u){return gh(s||[],u||[],rt)}function Ea(s,u){return gh(s||[],u||[],Ul)}var od=oi(function(s){var u=s.length,y=u>1?s[u-1]:_;return y=typeof y=="function"?(s.pop(),y):_,rd(s,y)});function jh(s){var u=Z(s);return u.__chain__=!0,u}function ad(s,u){return u(s),s}function Uc(s,u){return u(s)}var ld=Go(function(s){var u=s.length,y=u?s[0]:0,I=this.__wrapped__,O=function(H){return Pt(H,s)};return u>1||this.__actions__.length||!(I instanceof Jt)||!go(y)?this.thru(O):(I=I.slice(y,+y+(u?1:0)),I.__actions__.push({func:Uc,args:[O],thisArg:_}),new vr(I,this.__chain__).thru(function(H){return u&&!H.length&&H.push(_),H}))});function Wh(){return jh(this)}function ku(){return new vr(this.value(),this.__chain__)}function cd(){this.__values__===_&&(this.__values__=or(this.value()));var s=this.__index__>=this.__values__.length,u=s?_:this.__values__[this.__index__++];return{done:s,value:u}}function Hh(){return this}function ud(s){for(var u,y=this;y instanceof da;){var I=Gp(y);I.__index__=0,I.__values__=_,u?O.__wrapped__=I:u=I;var O=I;y=y.__wrapped__}return O.__wrapped__=s,u}function As(){var s=this.__wrapped__;if(s instanceof Jt){var u=s;return this.__actions__.length&&(u=new Jt(this)),u=u.reverse(),u.__actions__.push({func:Uc,args:[Oh],thisArg:_}),new vr(u,this.__chain__)}return this.thru(Oh)}function Nc(){return mu(this.__wrapped__,this.__actions__)}var hd=zc(function(s,u,y){mi.call(s,y)?++s[y]:Ot(s,y,1)});function pd(s,u,y){var I=T(s)?fc:Xs;return y&&Br(s,u,y)&&(u=_),I(s,Gt(u,3))}function dd(s,u){var y=T(s)?Kr:Ks;return y(s,Gt(u,3))}var fd=yu(jp),md=yu(Wp);function gd(s,u){return _i(zu(s,u),1)}function Mf(s,u){return _i(zu(s,u),vi)}function _d(s,u,y){return y=y===_?1:Ut(y),_i(zu(s,u),y)}function jo(s,u){var y=T(s)?kr:$n;return y(s,Gt(u,3))}function Xh(s,u){var y=T(s)?Po:Fs;return y(s,Gt(u,3))}var yd=zc(function(s,u,y){mi.call(s,y)?s[y].push(u):Ot(s,y,[u])});function vd(s,u,y,I){s=P(s)?s:qu(s),y=y&&!I?Ut(y):0;var O=s.length;return y<0&&(y=An(O+y,0)),Kn(s)?y<=O&&s.indexOf(u,y)>-1:!!O&&Oi(s,u,y)>-1}var xd=oi(function(s,u,y){var I=-1,O=typeof u=="function",H=P(s)?Pe(s.length):[];return $n(s,function(ae){H[++I]=O?Pr(u,ae,y):$o(ae,u,y)}),H}),Pf=zc(function(s,u,y){Ot(s,y,u)});function zu(s,u){var y=T(s)?ji:lh;return y(s,Gt(u,3))}function bd(s,u,y,I){return s==null?[]:(T(u)||(u=u==null?[]:[u]),y=I?_:y,T(y)||(y=y==null?[]:[y]),ch(s,u,y))}var Xl=zc(function(s,u,y){s[y?0:1].push(u)},function(){return[[],[]]});function wd(s,u,y){var I=T(s)?na:lo,O=arguments.length<3;return I(s,Gt(u,4),y,O,$n)}function Du(s,u,y){var I=T(s)?Qu:lo,O=arguments.length<3;return I(s,Gt(u,4),y,O,Fs)}function Td(s,u){var y=T(s)?Kr:Ks;return y(s,Yl(Gt(u,3)))}function Lu(s){var u=T(s)?Oe:Xd;return u(s)}function Ru(s,u,y){(y?Br(s,u,y):u===_)?u=1:u=Ut(u);var I=T(s)?tt:vp;return I(s,u)}function Bu(s){var u=T(s)?vt:ph;return u(s)}function kf(s){if(s==null)return 0;if(P(s))return Kn(s)?Rs(s):s.length;var u=Tr(s);return u==en||u==qn?s.size:oh(s).length}function zf(s,u,y){var I=T(s)?yl:dh;return y&&Br(s,u,y)&&(u=_),I(s,Gt(u,3))}var Df=oi(function(s,u){if(s==null)return[];var y=u.length;return y>1&&Br(s,u[0],u[1])?u=[]:y>2&&Br(u[0],u[1],u[2])&&(u=[u[0]]),ch(s,_i(u,1),[])}),Fu=Tc||function(){return ln.Date.now()};function Kl(s,u){if(typeof u!="function")throw new Dr(L);return s=Ut(s),function(){if(--s<1)return u.apply(this,arguments)}}function Xn(s,u,y){return u=y?_:u,u=s&&u==null?s.length:u,fo(s,ut,_,_,_,_,u)}function Wo(s,u){var y;if(typeof u!="function")throw new Dr(L);return s=Ut(s),function(){return--s>0&&(y=u.apply(this,arguments)),s<=1&&(u=_),y}}var $c=oi(function(s,u,y){var I=De;if(y.length){var O=rr(y,mo($c));I|=et}return fo(s,I,u,y,O)}),Kh=oi(function(s,u,y){var I=De|Ze;if(y.length){var O=rr(y,mo(Kh));I|=et}return fo(u,I,s,y,O)});function Yh(s,u,y){u=y?_:u;var I=fo(s,Ve,_,_,_,_,_,u);return I.placeholder=Yh.placeholder,I}function Ou(s,u,y){u=y?_:u;var I=fo(s,Ke,_,_,_,_,_,u);return I.placeholder=Ou.placeholder,I}function Sd(s,u,y){var I,O,H,ae,de,Ee,qe=0,Ge=!1,Qe=!1,_t=!0;if(typeof s!="function")throw new Dr(L);u=wi(u)||0,ot(y)&&(Ge=!!y.leading,Qe="maxWait"in y,H=Qe?An(wi(y.maxWait)||0,u):H,_t="trailing"in y?!!y.trailing:_t);function Rt(Jn){var Yo=I,sl=O;return I=O=_,qe=Jn,ae=s.apply(sl,Yo),ae}function Wt(Jn){return qe=Jn,de=tl(Ti,u),Ge?Rt(Jn):ae}function di(Jn){var Yo=Jn-Ee,sl=Jn-qe,gm=u-Yo;return Qe?Hn(gm,H-sl):gm}function Ht(Jn){var Yo=Jn-Ee,sl=Jn-qe;return Ee===_||Yo>=u||Yo<0||Qe&&sl>=H}function Ti(){var Jn=Fu();if(Ht(Jn))return Pi(Jn);de=tl(Ti,di(Jn))}function Pi(Jn){return de=_,_t&&I?Rt(Jn):(I=O=_,ae)}function ro(){de!==_&&wp(de),qe=0,I=Ee=O=de=_}function Ms(){return de===_?ae:Pi(Fu())}function so(){var Jn=Fu(),Yo=Ht(Jn);if(I=arguments,O=this,Ee=Jn,Yo){if(de===_)return Wt(Ee);if(Qe)return wp(de),de=tl(Ti,u),Rt(Ee)}return de===_&&(de=tl(Ti,u)),ae}return so.cancel=ro,so.flush=Ms,so}var Ed=oi(function(s,u){return cn(s,1,u)}),Ad=oi(function(s,u,y){return cn(s,wi(u)||0,y)});function Lf(s){return fo(s,Dt)}function Vc(s,u){if(typeof s!="function"||u!=null&&typeof u!="function")throw new Dr(L);var y=function(){var I=arguments,O=u?u.apply(this,I):I[0],H=y.cache;if(H.has(O))return H.get(O);var ae=s.apply(this,I);return y.cache=H.set(O,ae)||H,ae};return y.cache=new(Vc.Cache||A),y}Vc.Cache=A;function Yl(s){if(typeof s!="function")throw new Dr(L);return function(){var u=arguments;switch(u.length){case 0:return!s.call(this);case 1:return!s.call(this,u[0]);case 2:return!s.call(this,u[0],u[1]);case 3:return!s.call(this,u[0],u[1],u[2])}return!s.apply(this,u)}}function Jh(s){return Wo(2,s)}var Id=Yd(function(s,u){u=u.length==1&&T(u[0])?ji(u[0],gr(Gt())):ji(_i(u,1),gr(Gt()));var y=u.length;return oi(function(I){for(var O=-1,H=Hn(I.length,y);++O<H;)I[O]=u[O].call(this,I[O]);return Pr(s,this,I)})}),nl=oi(function(s,u){var y=rr(u,mo(nl));return fo(s,et,_,u,y)}),Uu=oi(function(s,u){var y=rr(u,mo(Uu));return fo(s,je,_,u,y)}),Cd=Go(function(s,u){return fo(s,wt,_,_,_,u)});function Qh(s,u){if(typeof s!="function")throw new Dr(L);return u=u===_?u:Ut(u),oi(s,u)}function Nu(s,u){if(typeof s!="function")throw new Dr(L);return u=u==null?0:An(Ut(u),0),oi(function(y){var I=y[u],O=xa(y,0,u);return I&&ci(O,I),Pr(s,this,O)})}function qc(s,u,y){var I=!0,O=!0;if(typeof s!="function")throw new Dr(L);return ot(y)&&(I="leading"in y?!!y.leading:I,O="trailing"in y?!!y.trailing:O),Sd(s,u,{leading:I,maxWait:u,trailing:O})}function ep(s){return Xn(s,1)}function tp(s,u){return nl(Ya(u),s)}function ip(){if(!arguments.length)return[];var s=arguments[0];return T(s)?s:[s]}function Rf(s){return ni(s,_e)}function i(s,u){return u=typeof u=="function"?u:_,ni(s,_e,u)}function e(s){return ni(s,ee|_e)}function n(s,u){return u=typeof u=="function"?u:_,ni(s,ee|_e,u)}function o(s,u){return u==null||Ln(s,u,lr(u))}function c(s,u){return s===u||s!==s&&u!==u}var d=bu(ws),m=bu(function(s,u){return s>=u}),v=Qi(function(){return arguments}())?Qi:function(s){return Xe(s)&&mi.call(s,"callee")&&!Cl.call(s,"callee")},T=Pe.isArray,E=Jc?gr(Jc):Fl;function P(s){return s!=null&&pt(s.length)&&!Ie(s)}function D(s){return Xe(s)&&P(s)}function U(s){return s===!0||s===!1||Xe(s)&&Cn(s)==Ir}var q=Fo||Kf,G=fl?gr(fl):Ol;function J(s){return Xe(s)&&s.nodeType===1&&!zi(s)}function ne(s){if(s==null)return!0;if(P(s)&&(T(s)||typeof s=="string"||typeof s.splice=="function"||q(s)||rn(s)||v(s)))return!s.length;var u=Tr(s);if(u==en||u==qn)return!s.size;if(Lc(s))return!oh(s).length;for(var y in s)if(mi.call(s,y))return!1;return!0}function oe(s,u){return ds(s,u)}function me(s,u,y){y=typeof y=="function"?y:_;var I=y?y(s,u):_;return I===_?ds(s,u,_,y):!!I}function he(s){if(!Xe(s))return!1;var u=Cn(s);return u==On||u==on||typeof s.message=="string"&&typeof s.name=="string"&&!zi(s)}function be(s){return typeof s=="number"&&Pl(s)}function Ie(s){if(!ot(s))return!1;var u=Cn(s);return u==dr||u==ke||u==pr||u==fr}function Be(s){return typeof s=="number"&&s==Ut(s)}function pt(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=Li}function ot(s){var u=typeof s;return s!=null&&(u=="object"||u=="function")}function Xe(s){return s!=null&&typeof s=="object"}var lt=Fa?gr(Fa):lu;function st(s,u){return s===u||Ic(s,u,Sh(u))}function mt(s,u,y){return y=typeof y=="function"?y:_,Ic(s,u,Sh(u),y)}function at(s){return Yt(s)&&s!=+s}function He(s){if(Up(s))throw new Ft(M);return sh(s)}function At(s){return s===null}function xt(s){return s==null}function Yt(s){return typeof s=="number"||Xe(s)&&Cn(s)==Vr}function zi(s){if(!Xe(s)||Cn(s)!=Kt)return!1;var u=Il(s);if(u===null)return!0;var y=mi.call(u,"constructor")&&u.constructor;return typeof y=="function"&&y instanceof y&&Ga.call(y)==Al}var Zi=ml?gr(ml):Wd;function Bn(s){return Be(s)&&s>=-Li&&s<=Li}var es=gl?gr(gl):mp;function Kn(s){return typeof s=="string"||!T(s)&&Xe(s)&&Cn(s)==hi}function Ai(s){return typeof s=="symbol"||Xe(s)&&Cn(s)==qr}var rn=Mo?gr(Mo):Hd;function sr(s){return s===_}function ts(s){return Xe(s)&&Tr(s)==Je}function Fr(s){return Xe(s)&&Cn(s)==Dn}var Pn=bu(uu),Fn=bu(function(s,u){return s<=u});function or(s){if(!s)return[];if(P(s))return Kn(s)?zr(s):wr(s);if(Un&&s[Un])return vc(s[Un]());var u=Tr(s),y=u==en?sa:u==qn?uo:qu;return y(s)}function hn(s){if(!s)return s===0?s:0;if(s=wi(s),s===vi||s===-vi){var u=s<0?-1:1;return u*sn}return s===s?s:0}function Ut(s){var u=hn(s),y=u%1;return u===u?y?u-y:u:0}function Or(s){return s?Vi(Ut(s),0,ei):0}function wi(s){if(typeof s=="number")return s;if(Ai(s))return fn;if(ot(s)){var u=typeof s.valueOf=="function"?s.valueOf():s;s=ot(u)?u+"":u}if(typeof s!="string")return s===0?s:+s;s=eu(s);var y=Ri.test(s);return y||pi.test(s)?dl(s.slice(2),y?2:8):fi.test(s)?fn:+s}function Yn(s){return Es(s,ms(s))}function ui(s){return s?Vi(Ut(s),-Li,Li):s===0?s:0}function ri(s){return s==null?"":fs(s)}var ar=po(function(s,u){if(Lc(u)||P(u)){Es(u,lr(u),s);return}for(var y in u)mi.call(u,y)&&rt(s,y,u[y])}),Sr=po(function(s,u){Es(u,ms(u),s)}),is=po(function(s,u,y,I){Es(u,ms(u),s,I)}),Qs=po(function(s,u,y,I){Es(u,lr(u),s,I)}),eo=Go(Pt);function Ho(s,u){var y=ps(s);return u==null?y:$i(y,u)}var Us=oi(function(s,u){s=Mi(s);var y=-1,I=u.length,O=I>2?u[2]:_;for(O&&Br(u[0],u[1],O)&&(I=1);++y<I;)for(var H=u[y],ae=ms(H),de=-1,Ee=ae.length;++de<Ee;){var qe=ae[de],Ge=s[qe];(Ge===_||c(Ge,Yr[qe])&&!mi.call(s,qe))&&(s[qe]=H[qe])}return s}),Is=oi(function(s){return s.push(_,zp),Pr(op,_,s)});function ns(s,u){return mc(s,Gt(u,3),br)}function Xo(s,u){return mc(s,Gt(u,3),un)}function Gc(s,u){return s==null?s:Yi(s,Gt(u,3),ms)}function Md(s,u){return s==null?s:Rn(s,Gt(u,3),ms)}function np(s,u){return s&&br(s,Gt(u,3))}function rp(s,u){return s&&un(s,Gt(u,3))}function Ko(s){return s==null?[]:wn(s,lr(s))}function Pd(s){return s==null?[]:wn(s,ms(s))}function $u(s,u,y){var I=s==null?_:In(s,u);return I===_?y:I}function Bf(s,u){return s!=null&&Bp(s,u,Ts)}function sp(s,u){return s!=null&&Bp(s,u,ho)}var Ff=vu(function(s,u,y){u!=null&&typeof u.toString!="function"&&(u=ht.call(u)),s[u]=y},Zf(Ns)),Of=vu(function(s,u,y){u!=null&&typeof u.toString!="function"&&(u=ht.call(u)),mi.call(s,u)?s[u].push(y):s[u]=[y]},Gt),Uf=oi($o);function lr(s){return P(s)?We(s):oh(s)}function ms(s){return P(s)?We(s,!0):ah(s)}function Nf(s,u){var y={};return u=Gt(u,3),br(s,function(I,O,H){Ot(y,u(I,O,H),I)}),y}function to(s,u){var y={};return u=Gt(u,3),br(s,function(I,O,H){Ot(y,O,u(I,O,H))}),y}var Vu=po(function(s,u,y){ma(s,u,y)}),op=po(function(s,u,y,I){ma(s,u,y,I)}),$f=Go(function(s,u){var y={};if(s==null)return y;var I=!1;u=ji(u,function(H){return H=va(H,s),I||(I=H.length>1),H}),Es(s,wh(s),y),I&&(y=ni(y,ee|ve|_e,nf));for(var O=u.length;O--;)mh(y,u[O]);return y});function Vf(s,u){return cr(s,Yl(Gt(u)))}var qf=Go(function(s,u){return s==null?{}:_p(s,u)});function cr(s,u){if(s==null)return{};var y=ji(wh(s),function(I){return[I]});return u=Gt(u),yp(s,y,function(I,O){return u(I,O[0])})}function Cs(s,u,y){u=va(u,s);var I=-1,O=u.length;for(O||(O=1,s=_);++I<O;){var H=s==null?_:s[yo(u[I])];H===_&&(I=O,H=y),s=Ie(H)?H.call(s):H}return s}function rl(s,u,y){return s==null?s:Ul(s,u,y)}function io(s,u,y,I){return I=typeof I=="function"?I:_,s==null?s:Ul(s,u,y,I)}var Aa=kp(lr),no=kp(ms);function Sg(s,u,y){var I=T(s),O=I||q(s)||rn(s);if(u=Gt(u,4),y==null){var H=s&&s.constructor;O?y=I?new H:[]:ot(s)?y=Ie(H)?ps(Il(s)):{}:y={}}return(O?kr:br)(s,function(ae,de,Ee){return u(y,ae,de,Ee)}),y}function Eg(s,u){return s==null?!0:mh(s,u)}function Ag(s,u,y){return s==null?s:bp(s,u,Ya(y))}function Ig(s,u,y,I){return I=typeof I=="function"?I:_,s==null?s:bp(s,u,Ya(y),I)}function qu(s){return s==null?[]:zo(s,lr(s))}function Cg(s){return s==null?[]:zo(s,ms(s))}function Mg(s,u,y){return y===_&&(y=u,u=_),y!==_&&(y=wi(y),y=y===y?y:0),u!==_&&(u=wi(u),u=u===u?u:0),Vi(wi(s),u,y)}function Pg(s,u,y){return u=hn(u),y===_?(y=u,u=0):y=hn(y),s=wi(s),au(s,u,y)}function kg(s,u,y){if(y&&typeof y!="boolean"&&Br(s,u,y)&&(u=y=_),y===_&&(typeof u=="boolean"?(y=u,u=_):typeof s=="boolean"&&(y=s,s=_)),s===_&&u===_?(s=0,u=1):(s=hn(s),u===_?(u=s,s=0):u=hn(u)),s>u){var I=s;s=u,u=I}if(y||s%1||u%1){var O=bt();return Hn(s+O*(u-s+uc("1e-"+((O+"").length-1))),u)}return du(s,u)}var zg=Qa(function(s,u,y){return u=u.toLowerCase(),s+(y?hm(u):u)});function hm(s){return Gf(ri(s).toLowerCase())}function pm(s){return s=ri(s),s&&s.replace(Bt,yc).replace(Ba,"")}function Dg(s,u,y){s=ri(s),u=fs(u);var I=s.length;y=y===_?I:Vi(Ut(y),0,I);var O=y;return y-=u.length,y>=0&&s.slice(y,O)==u}function Lg(s){return s=ri(s),s&&Cr.test(s)?s.replace(Si,ih):s}function Rg(s){return s=ri(s),s&&ue.test(s)?s.replace(se,"\\$&"):s}var Bg=Qa(function(s,u,y){return s+(y?"-":"")+u.toLowerCase()}),Fg=Qa(function(s,u,y){return s+(y?" ":"")+u.toLowerCase()}),Og=Ip("toLowerCase");function Ug(s,u,y){s=ri(s),u=Ut(u);var I=u?Rs(s):0;if(!u||I>=u)return s;var O=(u-I)/2;return Dc(yr(O),y)+s+Dc(Ha(O),y)}function Ng(s,u,y){s=ri(s),u=Ut(u);var I=u?Rs(s):0;return u&&I<u?s+Dc(u-I,y):s}function $g(s,u,y){s=ri(s),u=Ut(u);var I=u?Rs(s):0;return u&&I<u?Dc(u-I,y)+s:s}function Vg(s,u,y){return y||u==null?u=0:u&&(u=+u),zl(ri(s).replace(le,""),u||0)}function qg(s,u,y){return(y?Br(s,u,y):u===_)?u=1:u=Ut(u),uh(ri(s),u)}function Gg(){var s=arguments,u=ri(s[0]);return s.length<3?u:u.replace(s[1],s[2])}var Zg=Qa(function(s,u,y){return s+(y?"_":"")+u.toLowerCase()});function jg(s,u,y){return y&&typeof y!="number"&&Br(s,u,y)&&(u=y=_),y=y===_?ei:y>>>0,y?(s=ri(s),s&&(typeof u=="string"||u!=null&&!Zi(u))&&(u=fs(u),!u&&us(s))?xa(zr(s),0,y):s.split(u,y)):[]}var Wg=Qa(function(s,u,y){return s+(y?" ":"")+Gf(u)});function Hg(s,u,y){return s=ri(s),y=y==null?0:Vi(Ut(y),0,s.length),u=fs(u),s.slice(y,y+u.length)==u}function Xg(s,u,y){var I=Z.templateSettings;y&&Br(s,u,y)&&(u=_),s=ri(s),u=is({},u,I,el);var O=is({},u.imports,I.imports,el),H=lr(O),ae=zo(O,H),de,Ee,qe=0,Ge=u.interpolate||tn,Qe="__p += '",_t=Ro((u.escape||tn).source+"|"+Ge.source+"|"+(Ge===N?Et:tn).source+"|"+(u.evaluate||tn).source+"|$","g"),Rt="//# sourceURL="+(mi.call(u,"sourceURL")?(u.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++lc+"]")+`
`;s.replace(_t,function(Ht,Ti,Pi,ro,Ms,so){return Pi||(Pi=ro),Qe+=s.slice(qe,so).replace(jn,tu),Ti&&(de=!0,Qe+=`' +
__e(`+Ti+`) +
'`),Ms&&(Ee=!0,Qe+=`';
`+Ms+`;
__p += '`),Pi&&(Qe+=`' +
((__t = (`+Pi+`)) == null ? '' : __t) +
'`),qe=so+Ht.length,Ht}),Qe+=`';
`;var Wt=mi.call(u,"variable")&&u.variable;if(!Wt)Qe=`with (obj) {
`+Qe+`
}
`;else if(Zt.test(Wt))throw new Ft(a);Qe=(Ee?Qe.replace(Gn,""):Qe).replace(Zn,"$1").replace(ys,"$1;"),Qe="function("+(Wt||"obj")+`) {
`+(Wt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(de?", __e = _.escape":"")+(Ee?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Qe+`return __p
}`;var di=fm(function(){return Ei(H,Rt+"return "+Qe).apply(_,ae)});if(di.source=Qe,he(di))throw di;return di}function Kg(s){return ri(s).toLowerCase()}function Yg(s){return ri(s).toUpperCase()}function Jg(s,u,y){if(s=ri(s),s&&(y||u===_))return eu(s);if(!s||!(u=fs(u)))return s;var I=zr(s),O=zr(u),H=bl(I,O),ae=Na(I,O)+1;return xa(I,H,ae).join("")}function Qg(s,u,y){if(s=ri(s),s&&(y||u===_))return s.slice(0,$a(s)+1);if(!s||!(u=fs(u)))return s;var I=zr(s),O=Na(I,zr(u))+1;return xa(I,0,O).join("")}function e_(s,u,y){if(s=ri(s),s&&(y||u===_))return s.replace(le,"");if(!s||!(u=fs(u)))return s;var I=zr(s),O=bl(I,zr(u));return xa(I,O).join("")}function t_(s,u){var y=Nt,I=ai;if(ot(u)){var O="separator"in u?u.separator:O;y="length"in u?Ut(u.length):y,I="omission"in u?fs(u.omission):I}s=ri(s);var H=s.length;if(us(s)){var ae=zr(s);H=ae.length}if(y>=H)return s;var de=y-Rs(I);if(de<1)return I;var Ee=ae?xa(ae,0,de).join(""):s.slice(0,de);if(O===_)return Ee+I;if(ae&&(de+=Ee.length-de),Zi(O)){if(s.slice(de).search(O)){var qe,Ge=Ee;for(O.global||(O=Ro(O.source,ri(qt.exec(O))+"g")),O.lastIndex=0;qe=O.exec(Ge);)var Qe=qe.index;Ee=Ee.slice(0,Qe===_?de:Qe)}}else if(s.indexOf(fs(O),de)!=de){var _t=Ee.lastIndexOf(O);_t>-1&&(Ee=Ee.slice(0,_t))}return Ee+I}function i_(s){return s=ri(s),s&&Gr.test(s)?s.replace(an,Do):s}var n_=Qa(function(s,u,y){return s+(y?" ":"")+u.toUpperCase()}),Gf=Ip("toUpperCase");function dm(s,u,y){return s=ri(s),u=y?_:u,u===_?hs(s)?ru(s):th(s):s.match(u)||[]}var fm=oi(function(s,u){try{return Pr(s,_,u)}catch(y){return he(y)?y:new Ft(y)}}),r_=Go(function(s,u){return kr(u,function(y){y=yo(y),Ot(s,y,$c(s[y],s))}),s});function s_(s){var u=s==null?0:s.length,y=Gt();return s=u?ji(s,function(I){if(typeof I[1]!="function")throw new Dr(L);return[y(I[0]),I[1]]}):[],oi(function(I){for(var O=-1;++O<u;){var H=s[O];if(Pr(H[0],this,I))return Pr(H[1],this,I)}})}function o_(s){return xr(ni(s,ee))}function Zf(s){return function(){return s}}function a_(s,u){return s==null||s!==s?u:s}var l_=Cp(),c_=Cp(!0);function Ns(s){return s}function jf(s){return cu(typeof s=="function"?s:ni(s,ee))}function u_(s){return Ka(ni(s,ee))}function h_(s,u){return gp(s,ni(u,ee))}var p_=oi(function(s,u){return function(y){return $o(y,s,u)}}),d_=oi(function(s,u){return function(y){return $o(s,y,u)}});function Wf(s,u,y){var I=lr(u),O=wn(u,I);y==null&&!(ot(u)&&(O.length||!I.length))&&(y=u,u=s,s=this,O=wn(u,lr(u)));var H=!(ot(y)&&"chain"in y)||!!y.chain,ae=Ie(s);return kr(O,function(de){var Ee=u[de];s[de]=Ee,ae&&(s.prototype[de]=function(){var qe=this.__chain__;if(H||qe){var Ge=s(this.__wrapped__),Qe=Ge.__actions__=wr(this.__actions__);return Qe.push({func:Ee,args:arguments,thisArg:s}),Ge.__chain__=qe,Ge}return Ee.apply(s,ci([this.value()],arguments))})}),s}function f_(){return ln._===this&&(ln._=rh),this}function Hf(){}function m_(s){return s=Ut(s),oi(function(u){return Cc(u,s)})}var g_=xu(ji),__=xu(fc),y_=xu(yl);function mm(s){return Tu(s)?Ui(yo(s)):Rr(s)}function v_(s){return function(u){return s==null?_:In(s,u)}}var x_=Mp(),b_=Mp(!0);function Xf(){return[]}function Kf(){return!1}function w_(){return{}}function T_(){return""}function S_(){return!0}function E_(s,u){if(s=Ut(s),s<1||s>Li)return[];var y=ei,I=Hn(s,ei);u=Gt(u),s-=ei;for(var O=gc(I,u);++y<s;)u(y);return O}function A_(s){return T(s)?ji(s,yo):Ai(s)?[s]:wr(Mh(ri(s)))}function I_(s){var u=++oa;return ri(s)+u}var C_=Vl(function(s,u){return s+u},0),M_=xh("ceil"),P_=Vl(function(s,u){return s/u},1),k_=xh("floor");function z_(s){return s&&s.length?bs(s,Ns,ws):_}function D_(s,u){return s&&s.length?bs(s,Gt(u,2),ws):_}function L_(s){return ra(s,Ns)}function R_(s,u){return ra(s,Gt(u,2))}function B_(s){return s&&s.length?bs(s,Ns,uu):_}function F_(s,u){return s&&s.length?bs(s,Gt(u,2),uu):_}var O_=Vl(function(s,u){return s*u},1),U_=xh("round"),N_=Vl(function(s,u){return s-u},0);function $_(s){return s&&s.length?Ua(s,Ns):0}function V_(s,u){return s&&s.length?Ua(s,Gt(u,2)):0}return Z.after=Kl,Z.ary=Xn,Z.assign=ar,Z.assignIn=Sr,Z.assignInWith=is,Z.assignWith=Qs,Z.at=eo,Z.before=Wo,Z.bind=$c,Z.bindAll=r_,Z.bindKey=Kh,Z.castArray=ip,Z.chain=jh,Z.chunk=ff,Z.compact=mf,Z.concat=gf,Z.cond=s_,Z.conforms=o_,Z.constant=Zf,Z.countBy=hd,Z.create=Ho,Z.curry=Yh,Z.curryRight=Ou,Z.debounce=Sd,Z.defaults=Us,Z.defaultsDeep=Is,Z.defer=Ed,Z.delay=Ad,Z.difference=_f,Z.differenceBy=yf,Z.differenceWith=Au,Z.drop=jl,Z.dropRight=Zp,Z.dropRightWhile=Ph,Z.dropWhile=kh,Z.fill=vf,Z.filter=dd,Z.flatMap=gd,Z.flatMapDeep=Mf,Z.flatMapDepth=_d,Z.flatten=zh,Z.flattenDeep=Hp,Z.flattenDepth=Qr,Z.flip=Lf,Z.flow=l_,Z.flowRight=c_,Z.fromPairs=Dh,Z.functions=Ko,Z.functionsIn=Pd,Z.groupBy=yd,Z.initial=Bc,Z.intersection=Fc,Z.intersectionBy=Wl,Z.intersectionWith=Iu,Z.invert=Ff,Z.invertBy=Of,Z.invokeMap=xd,Z.iteratee=jf,Z.keyBy=Pf,Z.keys=lr,Z.keysIn=ms,Z.map=zu,Z.mapKeys=Nf,Z.mapValues=to,Z.matches=u_,Z.matchesProperty=h_,Z.memoize=Vc,Z.merge=Vu,Z.mergeWith=op,Z.method=p_,Z.methodOf=d_,Z.mixin=Wf,Z.negate=Yl,Z.nthArg=m_,Z.omit=$f,Z.omitBy=Vf,Z.once=Jh,Z.orderBy=bd,Z.over=g_,Z.overArgs=Id,Z.overEvery=__,Z.overSome=y_,Z.partial=nl,Z.partialRight=Uu,Z.partition=Xl,Z.pick=qf,Z.pickBy=cr,Z.property=mm,Z.propertyOf=v_,Z.pull=xf,Z.pullAll=Rh,Z.pullAllBy=Yp,Z.pullAllWith=Bh,Z.pullAt=Fh,Z.range=x_,Z.rangeRight=b_,Z.rearg=Cd,Z.reject=Td,Z.remove=bf,Z.rest=Qh,Z.reverse=Oh,Z.sampleSize=Ru,Z.set=rl,Z.setWith=io,Z.shuffle=Bu,Z.slice=Jp,Z.sortBy=Df,Z.sortedUniq=Tf,Z.sortedUniqBy=Mu,Z.split=jg,Z.spread=Nu,Z.tail=Nh,Z.take=Sf,Z.takeRight=$h,Z.takeRightWhile=Vh,Z.takeWhile=Hl,Z.tap=ad,Z.throttle=qc,Z.thru=Uc,Z.toArray=or,Z.toPairs=Aa,Z.toPairsIn=no,Z.toPath=A_,Z.toPlainObject=Yn,Z.transform=Sg,Z.unary=ep,Z.union=ed,Z.unionBy=td,Z.unionWith=qh,Z.uniq=id,Z.uniqBy=Pu,Z.uniqWith=nd,Z.unset=Eg,Z.unzip=Gh,Z.unzipWith=rd,Z.update=Ag,Z.updateWith=Ig,Z.values=qu,Z.valuesIn=Cg,Z.without=sd,Z.words=dm,Z.wrap=tp,Z.xor=Ef,Z.xorBy=Af,Z.xorWith=If,Z.zip=Cf,Z.zipObject=Zh,Z.zipObjectDeep=Ea,Z.zipWith=od,Z.entries=Aa,Z.entriesIn=no,Z.extend=Sr,Z.extendWith=is,Wf(Z,Z),Z.add=C_,Z.attempt=fm,Z.camelCase=zg,Z.capitalize=hm,Z.ceil=M_,Z.clamp=Mg,Z.clone=Rf,Z.cloneDeep=e,Z.cloneDeepWith=n,Z.cloneWith=i,Z.conformsTo=o,Z.deburr=pm,Z.defaultTo=a_,Z.divide=P_,Z.endsWith=Dg,Z.eq=c,Z.escape=Lg,Z.escapeRegExp=Rg,Z.every=pd,Z.find=fd,Z.findIndex=jp,Z.findKey=ns,Z.findLast=md,Z.findLastIndex=Wp,Z.findLastKey=Xo,Z.floor=k_,Z.forEach=jo,Z.forEachRight=Xh,Z.forIn=Gc,Z.forInRight=Md,Z.forOwn=np,Z.forOwnRight=rp,Z.get=$u,Z.gt=d,Z.gte=m,Z.has=Bf,Z.hasIn=sp,Z.head=Lh,Z.identity=Ns,Z.includes=vd,Z.indexOf=Ta,Z.inRange=Pg,Z.invoke=Uf,Z.isArguments=v,Z.isArray=T,Z.isArrayBuffer=E,Z.isArrayLike=P,Z.isArrayLikeObject=D,Z.isBoolean=U,Z.isBuffer=q,Z.isDate=G,Z.isElement=J,Z.isEmpty=ne,Z.isEqual=oe,Z.isEqualWith=me,Z.isError=he,Z.isFinite=be,Z.isFunction=Ie,Z.isInteger=Be,Z.isLength=pt,Z.isMap=lt,Z.isMatch=st,Z.isMatchWith=mt,Z.isNaN=at,Z.isNative=He,Z.isNil=xt,Z.isNull=At,Z.isNumber=Yt,Z.isObject=ot,Z.isObjectLike=Xe,Z.isPlainObject=zi,Z.isRegExp=Zi,Z.isSafeInteger=Bn,Z.isSet=es,Z.isString=Kn,Z.isSymbol=Ai,Z.isTypedArray=rn,Z.isUndefined=sr,Z.isWeakMap=ts,Z.isWeakSet=Fr,Z.join=Cu,Z.kebabCase=Bg,Z.last=Os,Z.lastIndexOf=Xp,Z.lowerCase=Fg,Z.lowerFirst=Og,Z.lt=Pn,Z.lte=Fn,Z.max=z_,Z.maxBy=D_,Z.mean=L_,Z.meanBy=R_,Z.min=B_,Z.minBy=F_,Z.stubArray=Xf,Z.stubFalse=Kf,Z.stubObject=w_,Z.stubString=T_,Z.stubTrue=S_,Z.multiply=O_,Z.nth=Kp,Z.noConflict=f_,Z.noop=Hf,Z.now=Fu,Z.pad=Ug,Z.padEnd=Ng,Z.padStart=$g,Z.parseInt=Vg,Z.random=kg,Z.reduce=wd,Z.reduceRight=Du,Z.repeat=qg,Z.replace=Gg,Z.result=Cs,Z.round=U_,Z.runInContext=ye,Z.sample=Lu,Z.size=kf,Z.snakeCase=Zg,Z.some=zf,Z.sortedIndex=Oc,Z.sortedIndexBy=vo,Z.sortedIndexOf=Sa,Z.sortedLastIndex=Qp,Z.sortedLastIndexBy=Uh,Z.sortedLastIndexOf=wf,Z.startCase=Wg,Z.startsWith=Hg,Z.subtract=N_,Z.sum=$_,Z.sumBy=V_,Z.template=Xg,Z.times=E_,Z.toFinite=hn,Z.toInteger=Ut,Z.toLength=Or,Z.toLower=Kg,Z.toNumber=wi,Z.toSafeInteger=ui,Z.toString=ri,Z.toUpper=Yg,Z.trim=Jg,Z.trimEnd=Qg,Z.trimStart=e_,Z.truncate=t_,Z.unescape=i_,Z.uniqueId=I_,Z.upperCase=n_,Z.upperFirst=Gf,Z.each=jo,Z.eachRight=Xh,Z.first=Lh,Wf(Z,function(){var s={};return br(Z,function(u,y){mi.call(Z.prototype,y)||(s[y]=u)}),s}(),{chain:!1}),Z.VERSION=C,kr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(s){Z[s].placeholder=Z}),kr(["drop","take"],function(s,u){Jt.prototype[s]=function(y){y=y===_?1:An(Ut(y),0);var I=this.__filtered__&&!u?new Jt(this):this.clone();return I.__filtered__?I.__takeCount__=Hn(y,I.__takeCount__):I.__views__.push({size:Hn(y,ei),type:s+(I.__dir__<0?"Right":"")}),I},Jt.prototype[s+"Right"]=function(y){return this.reverse()[s](y).reverse()}}),kr(["filter","map","takeWhile"],function(s,u){var y=u+1,I=y==Tt||y==yi;Jt.prototype[s]=function(O){var H=this.clone();return H.__iteratees__.push({iteratee:Gt(O,3),type:y}),H.__filtered__=H.__filtered__||I,H}}),kr(["head","last"],function(s,u){var y="take"+(u?"Right":"");Jt.prototype[s]=function(){return this[y](1).value()[0]}}),kr(["initial","tail"],function(s,u){var y="drop"+(u?"":"Right");Jt.prototype[s]=function(){return this.__filtered__?new Jt(this):this[y](1)}}),Jt.prototype.compact=function(){return this.filter(Ns)},Jt.prototype.find=function(s){return this.filter(s).head()},Jt.prototype.findLast=function(s){return this.reverse().find(s)},Jt.prototype.invokeMap=oi(function(s,u){return typeof s=="function"?new Jt(this):this.map(function(y){return $o(y,s,u)})}),Jt.prototype.reject=function(s){return this.filter(Yl(Gt(s)))},Jt.prototype.slice=function(s,u){s=Ut(s);var y=this;return y.__filtered__&&(s>0||u<0)?new Jt(y):(s<0?y=y.takeRight(-s):s&&(y=y.drop(s)),u!==_&&(u=Ut(u),y=u<0?y.dropRight(-u):y.take(u-s)),y)},Jt.prototype.takeRightWhile=function(s){return this.reverse().takeWhile(s).reverse()},Jt.prototype.toArray=function(){return this.take(ei)},br(Jt.prototype,function(s,u){var y=/^(?:filter|find|map|reject)|While$/.test(u),I=/^(?:head|last)$/.test(u),O=Z[I?"take"+(u=="last"?"Right":""):u],H=I||/^find/.test(u);O&&(Z.prototype[u]=function(){var ae=this.__wrapped__,de=I?[1]:arguments,Ee=ae instanceof Jt,qe=de[0],Ge=Ee||T(ae),Qe=function(Ti){var Pi=O.apply(Z,ci([Ti],de));return I&&_t?Pi[0]:Pi};Ge&&y&&typeof qe=="function"&&qe.length!=1&&(Ee=Ge=!1);var _t=this.__chain__,Rt=!!this.__actions__.length,Wt=H&&!_t,di=Ee&&!Rt;if(!H&&Ge){ae=di?ae:new Jt(this);var Ht=s.apply(ae,de);return Ht.__actions__.push({func:Uc,args:[Qe],thisArg:_}),new vr(Ht,_t)}return Wt&&di?s.apply(this,de):(Ht=this.thru(Qe),Wt?I?Ht.value()[0]:Ht.value():Ht)})}),kr(["pop","push","shift","sort","splice","unshift"],function(s){var u=qa[s],y=/^(?:push|sort|unshift)$/.test(s)?"tap":"thru",I=/^(?:pop|shift)$/.test(s);Z.prototype[s]=function(){var O=arguments;if(I&&!this.__chain__){var H=this.value();return u.apply(T(H)?H:[],O)}return this[y](function(ae){return u.apply(T(ae)?ae:[],O)})}}),br(Jt.prototype,function(s,u){var y=Z[u];if(y){var I=y.name+"";mi.call(xs,I)||(xs[I]=[]),xs[I].push({name:u,func:y})}}),xs[$l(_,Ze).name]=[{name:"wrapper",func:_}],Jt.prototype.clone=Ec,Jt.prototype.reverse=Ac,Jt.prototype.value=Rl,Z.prototype.at=ld,Z.prototype.chain=Wh,Z.prototype.commit=ku,Z.prototype.next=cd,Z.prototype.plant=ud,Z.prototype.reverse=As,Z.prototype.toJSON=Z.prototype.valueOf=Z.prototype.value=Nc,Z.prototype.first=Z.prototype.head,Un&&(Z.prototype[Un]=Hh),Z},Lo=su();Co?((Co.exports=Lo)._=Lo,pc._=Lo):ln._=Lo}).call(Hu)})(Nd,Nd.exports);var Fv=Nd.exports;const Qf={snapline:"#34343f",altRouteline:"#9e91be",routelineFoot:"#3665ff",routelineBike:"#63c4ff",routeline:"#7b51f8",congestionLow:"#42c74c",congestionHigh:"#d72359",hoverpoint:"#30a856",snappoint:"#cb3373",snappointHighlight:"#e50d3f",waypointFoot:"#3665ff",waypointFootHighlight:"#0942ff",waypointBike:"#63c4ff",waypointBikeHighlight:"#0bb8ff",waypoint:"#7b51f8",waypointHighlight:"#6d26d7"};function Hm(b,g,_){const C=b.slice();return C[13]=g[_],C}function Xm(b){let g,_=b[13]+"";return{c(){g=we("li"),wm(g,"--marker-color",b[4][b[13]]),Ye(g,"class","color-marker svelte-ti4f1")},m(C,R){Se(C,g,R),g.innerHTML=_},p(C,R){R&4&&_!==(_=C[13]+"")&&(g.innerHTML=_),R&4&&wm(g,"--marker-color",C[4][C[13]])},d(C){C&&Te(g)}}}function Ov(b){let g,_,C,R,M,L,a,V,F,ce,ee,ve,_e,Ae,$e,De,Ze,Ct,Ve,Ke,et,je,ut,wt,Dt,Nt=pp(b[2]),ai=[];for(let kt=0;kt<Nt.length;kt+=1)ai[kt]=Xm(Hm(b,Nt,kt));return{c(){g=we("p"),_=dn(`This example showcases routing with multiple profiles. Segments corresponding to different profiles are displayed in
    different colors. Plugin provides default styles for typical `),C=we("a"),C.textContent="OSRM profiles",R=dn(`: car, bike, foot. Styles can be changed per profile via general style customization approach (consult the
    `),M=we("a"),M.textContent="Restyling example",L=dn(`). In case different profiles are used you can similarly
    style map features corresponding to each profile by targeting profile property of a feature (see
    `),a=we("a"),a.textContent="default styles",V=dn(")."),F=it(),ce=we("small"),ce.innerHTML="<strong>Note</strong> that interactivity is not supported for multiple profiles",ee=it(),ve=we("p"),ve.textContent="Used profiles:",_e=it(),Ae=we("ul");for(let kt=0;kt<ai.length;kt+=1)ai[kt].c();$e=it(),De=we("div"),Ze=we("button"),Ct=dn("Shuffle Profiles"),Ke=it(),et=we("button"),je=dn("Reset"),Ye(C,"href","https://project-osrm.org/docs/v5.5.1/api/#general-options"),Ye(C,"target","_blank"),Ye(M,"href","/examples/restyling"),Ye(a,"href","https://github.com/maplibre/maplibre-gl-directions/blob/main/src/directions/layers.ts"),Ye(a,"target","_blank"),Ze.disabled=Ve=!b[1],et.disabled=ut=!b[1],Ye(De,"class","flex gap-2 justify-center")},m(kt,$t){Se(kt,g,$t),Le(g,_),Le(g,C),Le(g,R),Le(g,M),Le(g,L),Le(g,a),Le(g,V),Se(kt,F,$t),Se(kt,ce,$t),Se(kt,ee,$t),Se(kt,ve,$t),Se(kt,_e,$t),Se(kt,Ae,$t);for(let Tt=0;Tt<ai.length;Tt+=1)ai[Tt]&&ai[Tt].m(Ae,null);Se(kt,$e,$t),Se(kt,De,$t),Le(De,Ze),Le(Ze,Ct),Le(De,Ke),Le(De,et),Le(et,je),wt||(Dt=[Vd(Zd.call(null,M)),Bi(Ze,"click",b[6]),Bi(et,"click",b[5])],wt=!0)},p(kt,$t){if($t&20){Nt=pp(kt[2]);let Tt;for(Tt=0;Tt<Nt.length;Tt+=1){const jt=Hm(kt,Nt,Tt);ai[Tt]?ai[Tt].p(jt,$t):(ai[Tt]=Xm(jt),ai[Tt].c(),ai[Tt].m(Ae,null))}for(;Tt<ai.length;Tt+=1)ai[Tt].d(1);ai.length=Nt.length}$t&2&&Ve!==(Ve=!kt[1])&&(Ze.disabled=Ve),$t&2&&ut!==(ut=!kt[1])&&(et.disabled=ut)},d(kt){kt&&(Te(g),Te(F),Te(ce),Te(ee),Te(ve),Te(_e),Te(Ae),Te($e),Te(De)),sm(ai,kt),wt=!1,bo(Dt)}}}function Uv(b){let g;return{c(){g=we("span"),g.textContent=`${b[3].name}`,Ye(g,"slot","title")},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function Nv(b){let g,_,C,R;return g=new Ds({props:{$$slots:{title:[Uv],default:[Ov]},$$scope:{ctx:b}}}),{c(){ur(g.$$.fragment),_=it(),C=we("div"),Ye(C,"class","basis-full lg:basis-2/3 shadow-xl")},m(M,L){Qn(g,M,L),Se(M,_,L),Se(M,C,L),b[8](C),R=!0},p(M,[L]){const a={};L&65542&&(a.$$scope={dirty:L,ctx:M}),g.$set(a)},i(M){R||(Sn(g.$$.fragment,M),R=!0)},o(M){zn(g.$$.fragment,M),R=!1},d(M){M&&(Te(_),Te(C)),er(g,M),b[8](null)}}}function $v(b,g,_){let C,R;ks(b,zs,De=>_(10,R=De));const M=rs.find(De=>De.path===R);let L,a,V;$s(()=>{const De=new Vs.Map({container:L,style:qs,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});De.on("load",()=>{a=De,_(1,V=new Ps(a,{requestOptions:{alternatives:"true"}})),_e()})});const F=[[-74.21349031181673,40.704951524836275],[-74.19666749687558,40.738517300855904],[-74.16611177177786,40.76634583723629],[-74.07169801445302,40.719004374548206],[-73.99170381279369,40.725509319065594],[-73.98071748466812,40.762445342516145]],ce={car:Qf.routeline,bike:Qf.routelineBike,foot:Qf.routelineFoot},ee=["car","bike","car","car","foot"];let ve=ee;function _e(){_(7,ve=ee),V==null||V.setWaypoints(F,ee)}function Ae(){_(7,ve=Fv.shuffle(ve)),V==null||V.setWaypoints(F,ve)}function $e(De){_s[De?"unshift":"push"](()=>{L=De,_(0,L)})}return b.$$.update=()=>{b.$$.dirty&128&&_(2,C=ve.reduce((De,Ze)=>(De[De.length-1]!==Ze&&De.push(Ze),De),[]))},[L,V,C,M,ce,_e,Ae,ve,$e]}class Vv extends $r{constructor(g){super(),Nr(this,g,$v,Nv,Er,{})}}const qv=Object.freeze(Object.defineProperty({__proto__:null,default:Vv},Symbol.toStringTag,{value:"Module"}));function Gv(b){let g,_,C,R,M,L,a,V,F,ce,ee,ve,_e,Ae,$e,De,Ze,Ct,Ve,Ke,et,je,ut,wt,Dt,Nt,ai,kt,$t,Tt,jt;return{c(){g=we("small"),g.innerHTML="<strong>Note</strong> that interactivity is disabled for this example",_=it(),C=we("div"),R=we("p"),R.textContent="Set waypoints to a predefined set",M=it(),L=we("button"),a=dn("Set Waypoints"),F=it(),ce=we("div"),ee=we("p"),ee.textContent="Add a random waypoint at some random index",ve=it(),_e=we("button"),Ae=dn("Add Waypoint"),De=it(),Ze=we("div"),Ct=we("p"),Ct.textContent="Delete a random waypoint",Ve=it(),Ke=we("button"),et=dn("Delete Waypoint"),ut=it(),wt=we("div"),Dt=we("p"),Dt.textContent="Clear the map from all the stuff added by the plugin",Nt=it(),ai=we("button"),kt=dn("Clear"),L.disabled=V=!b[1],Ye(L,"class","self-center"),Ye(C,"class","flex flex-col gap-2"),_e.disabled=$e=!b[1],Ye(_e,"class","self-center"),Ye(ce,"class","flex flex-col gap-2"),Ke.disabled=je=!b[1],Ye(Ke,"class","self-center"),Ye(Ze,"class","flex flex-col gap-2"),ai.disabled=$t=!b[1],Ye(ai,"class","self-center"),Ye(wt,"class","flex flex-col gap-2")},m(yi,vi){Se(yi,g,vi),Se(yi,_,vi),Se(yi,C,vi),Le(C,R),Le(C,M),Le(C,L),Le(L,a),Se(yi,F,vi),Se(yi,ce,vi),Le(ce,ee),Le(ce,ve),Le(ce,_e),Le(_e,Ae),Se(yi,De,vi),Se(yi,Ze,vi),Le(Ze,Ct),Le(Ze,Ve),Le(Ze,Ke),Le(Ke,et),Se(yi,ut,vi),Se(yi,wt,vi),Le(wt,Dt),Le(wt,Nt),Le(wt,ai),Le(ai,kt),Tt||(jt=[Bi(L,"click",b[3]),Bi(_e,"click",b[4]),Bi(Ke,"click",b[5]),Bi(ai,"click",b[6])],Tt=!0)},p(yi,vi){vi&2&&V!==(V=!yi[1])&&(L.disabled=V),vi&2&&$e!==($e=!yi[1])&&(_e.disabled=$e),vi&2&&je!==(je=!yi[1])&&(Ke.disabled=je),vi&2&&$t!==($t=!yi[1])&&(ai.disabled=$t)},d(yi){yi&&(Te(g),Te(_),Te(C),Te(F),Te(ce),Te(De),Te(Ze),Te(ut),Te(wt)),Tt=!1,bo(jt)}}}function Zv(b){let g;return{c(){g=we("span"),g.textContent=`${b[2].name}`,Ye(g,"slot","title")},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function jv(b){let g,_,C,R;return g=new Ds({props:{$$slots:{title:[Zv],default:[Gv]},$$scope:{ctx:b}}}),{c(){ur(g.$$.fragment),_=it(),C=we("div"),Ye(C,"class","basis-full lg:basis-2/3 shadow-xl")},m(M,L){Qn(g,M,L),Se(M,_,L),Se(M,C,L),b[7](C),R=!0},p(M,[L]){const a={};L&1026&&(a.$$scope={dirty:L,ctx:M}),g.$set(a)},i(M){R||(Sn(g.$$.fragment,M),R=!0)},o(M){zn(g.$$.fragment,M),R=!1},d(M){M&&(Te(_),Te(C)),er(g,M),b[7](null)}}}function Wv(b,g,_){let C;ks(b,zs,_e=>_(9,C=_e));const R=rs.find(_e=>_e.path===C);let M,L,a;$s(()=>{const _e=new Vs.Map({container:M,style:qs,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});_e.on("load",()=>{L=_e,_(1,a=new Ps(L,{requestOptions:{alternatives:"true"}}))})});function V(){a==null||a.setWaypoints([[-74.21349031181673,40.704951524836275],[-74.19666749687558,40.738517300855904],[-74.16611177177786,40.76634583723629],[-74.07169801445302,40.719004374548206],[-73.99170381279369,40.725509319065594],[-73.98071748466812,40.762445342516145]])}function F(){const _e=L==null?void 0:L.getBounds(),Ae=L==null?void 0:L.getCenter();if(_e&&Ae){const $e=_e.getEast()-_e.getWest(),De=_e.getSouth()-_e.getNorth();a==null||a.addWaypoint([Ae.lng-$e/2+$e*Math.random(),Ae.lat-De/2+De*Math.random()],(a==null?void 0:a.waypoints.length)*Math.random()|0)}}function ce(){a==null||a.removeWaypoint((a==null?void 0:a.waypoints.length)*Math.random()|0)}function ee(){a==null||a.clear()}function ve(_e){_s[_e?"unshift":"push"](()=>{M=_e,_(0,M)})}return[M,a,R,V,F,ce,ee,ve]}class Hv extends $r{constructor(g){super(),Nr(this,g,Wv,jv,Er,{})}}const Xv=Object.freeze(Object.defineProperty({__proto__:null,default:Hv},Symbol.toStringTag,{value:"Module"}));function Kv(b){let g,_,C,R,M,L,a,V,F,ce,ee,ve,_e,Ae,$e,De,Ze,Ct,Ve,Ke,et;return{c(){g=we("label"),_=we("span"),_.innerHTML="<strong>Congestions</strong>",C=it(),R=we("select"),M=we("option"),M.textContent="Stringy",L=we("option"),L.textContent="Numeric",V=it(),F=we("p"),F.textContent="This example makes POST requests to the official Mapbox Directions API with the following options:",ce=it(),ee=we("ul"),ve=we("li"),_e=we("strong"),Ae=dn("annotations="),$e=dn(b[1]),De=it(),Ze=we("li"),Ze.textContent="overview=full",Ct=it(),Ve=we("li"),Ve.textContent="alternatives=true",M.__value="congestion",Wi(M,M.__value),L.__value="congestion_numeric",Wi(L,L.__value),R.disabled=a=!b[0],b[1]===void 0&&hp(()=>b[5].call(R)),Ye(g,"class","flex flex-col gap-2")},m(je,ut){Se(je,g,ut),Le(g,_),Le(g,C),Le(g,R),Le(R,M),Le(R,L),Dd(R,b[1],!0),Se(je,V,ut),Se(je,F,ut),Se(je,ce,ut),Se(je,ee,ut),Le(ee,ve),Le(ve,_e),Le(_e,Ae),Le(_e,$e),Le(ee,De),Le(ee,Ze),Le(ee,Ct),Le(ee,Ve),Ke||(et=Bi(R,"change",b[5]),Ke=!0)},p(je,ut){ut&1&&a!==(a=!je[0])&&(R.disabled=a),ut&2&&Dd(R,je[1]),ut&2&&om($e,je[1])},d(je){je&&(Te(g),Te(V),Te(F),Te(ce),Te(ee)),Ke=!1,et()}}}function Yv(b){let g;return{c(){g=we("span"),g.textContent=`${b[3].name}`,Ye(g,"slot","title")},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function Jv(b){let g,_,C,R;return g=new Ds({props:{$$slots:{title:[Yv],default:[Kv]},$$scope:{ctx:b}}}),{c(){ur(g.$$.fragment),_=it(),C=we("div"),Ye(C,"class","basis-full lg:basis-2/3 shadow-xl")},m(M,L){Qn(g,M,L),Se(M,_,L),Se(M,C,L),b[6](C),R=!0},p(M,[L]){const a={};L&259&&(a.$$scope={dirty:L,ctx:M}),g.$set(a)},i(M){R||(Sn(g.$$.fragment,M),R=!0)},o(M){zn(g.$$.fragment,M),R=!1},d(M){M&&(Te(_),Te(C)),er(g,M),b[6](null)}}}function Qv(b,g,_){let C;ks(b,zs,ee=>_(7,C=ee));const R=rs.find(ee=>ee.path===C);let M,L,a,V="congestion";$s(()=>{const ee=new Vs.Map({container:M,style:qs,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='//docs.mapbox.com/help/getting-started/directions/' target='_blank'>&copy; Mapbox Directions</a>"});ee.on("load",()=>{_(4,L=ee)})});function F(){V=ig(this),_(1,V)}function ce(ee){_s[ee?"unshift":"push"](()=>{M=ee,_(2,M)})}return b.$$.update=()=>{b.$$.dirty&19&&L&&(a&&a.destroy(),_(0,a=new Ps(L,{api:"https://api.mapbox.com/directions/v5",profile:"mapbox/driving-traffic",makePostRequest:!0,requestOptions:{access_token:"pk.eyJ1Ijoic21lbGx5c2hvdmVsIiwiYSI6ImNsMW80eXQ4aTEwN3czcG8zMXM2NzJ2ODIifQ.oWHUIUiEj2SS4_hue3qv2g",alternatives:"true",annotations:V,overview:"full"}})),_(0,a.interactive=!0,a))},[a,V,M,R,L,F,ce]}class e0 extends $r{constructor(g){super(),Nr(this,g,Qv,Jv,Er,{})}}const t0=Object.freeze(Object.defineProperty({__proto__:null,default:e0},Symbol.toStringTag,{value:"Module"}));function i0(b){let g,_,C;return{c(){g=we("p"),g.textContent=`In this example the default layers used by the plugin are augmented with an additional "symbol" layer which is only
    rendered for the ORIGIN and DESTINATION waypoints.`,_=it(),C=we("p"),C.innerHTML=`<strong>Note</strong> how you don&#39;t need to re-define all the layers from scratch thanks to the exported
    <code>layersFactory</code> function that returns all the default layers allowing for their augmentation and modification`},m(R,M){Se(R,g,M),Se(R,_,M),Se(R,C,M)},p:Di,d(R){R&&(Te(g),Te(_),Te(C))}}}function n0(b){let g;return{c(){g=we("span"),g.textContent=`${b[1].name}`,Ye(g,"slot","title")},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function r0(b){let g,_,C,R;return g=new Ds({props:{$$slots:{title:[n0],default:[i0]},$$scope:{ctx:b}}}),{c(){ur(g.$$.fragment),_=it(),C=we("div"),Ye(C,"class","basis-full lg:basis-2/3 shadow-xl")},m(M,L){Qn(g,M,L),Se(M,_,L),Se(M,C,L),b[2](C),R=!0},p(M,[L]){const a={};L&32&&(a.$$scope={dirty:L,ctx:M}),g.$set(a)},i(M){R||(Sn(g.$$.fragment,M),R=!0)},o(M){zn(g.$$.fragment,M),R=!1},d(M){M&&(Te(_),Te(C)),er(g,M),b[2](null)}}}function s0(b,g,_){let C;ks(b,zs,V=>_(4,C=V));const R=rs.find(V=>V.path===C);let M,L;$s(()=>{const V=new Vs.Map({container:M,style:qs,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>",fadeDuration:0}),F=jd();F.push({id:"maplibre-gl-directions-waypoint-label",type:"symbol",source:"maplibre-gl-directions",layout:{"text-field":["case",["==",["get","category"],"ORIGIN"],"A",["==",["get","category"],"DESTINATION"],"B",""]},paint:{"text-color":"#ffffff","text-opacity":.7},filter:["all",["==",["geometry-type"],"Point"],["==",["get","type"],"WAYPOINT"],["in",["get","category"],["literal",["ORIGIN","DESTINATION"]]]]}),V.on("load",()=>{L=new Ps(V,{requestOptions:{alternatives:"true"},layers:F}),L.interactive=!0})});function a(V){_s[V?"unshift":"push"](()=>{M=V,_(0,M)})}return[M,R,a]}class o0 extends $r{constructor(g){super(),Nr(this,g,s0,r0,Er,{})}}const a0=Object.freeze(Object.defineProperty({__proto__:null,default:o0},Symbol.toStringTag,{value:"Module"})),l0="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAKRJREFUOE+lkkEOAVEQRF9tJBwCZxhHEFYOIXMWNuIynIOFI7B3hpKeDBFh0ub/ddfrX10lCp8K9aQAtsexSNLtc2EWsANqYC7p8g7JAobAEZgBS0mnJyQFiGHbXyFpwC+IbE+BDTBIJhI/WQH3sBSACbDtCahKLCwkndMA2yPg0CbRiJtuZHy34oixAl7ifwB7YF1SpDh0VPnaq8pdNlM36AI8AK1AOkjqIJazAAAAAElFTkSuQmCC";function c0(b){let g,_,C,R,M;return{c(){g=we("p"),g.textContent="Another example that demonstrates the ease of extending the original styles provided by the plugin.",_=it(),C=we("p"),C.textContent='This time a "symbol" layer is added that shows the direction the selected route goes in.',R=it(),M=we("small"),M.innerHTML=`<strong>Note</strong> that you have to manually load and add the images you intend to use for the custom layers you
    add`},m(L,a){Se(L,g,a),Se(L,_,a),Se(L,C,a),Se(L,R,a),Se(L,M,a)},p:Di,d(L){L&&(Te(g),Te(_),Te(C),Te(R),Te(M))}}}function u0(b){let g;return{c(){g=we("span"),g.textContent=`${b[1].name}`,Ye(g,"slot","title")},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function h0(b){let g,_,C,R;return g=new Ds({props:{$$slots:{title:[u0],default:[c0]},$$scope:{ctx:b}}}),{c(){ur(g.$$.fragment),_=it(),C=we("div"),Ye(C,"class","basis-full lg:basis-2/3 shadow-xl")},m(M,L){Qn(g,M,L),Se(M,_,L),Se(M,C,L),b[2](C),R=!0},p(M,[L]){const a={};L&32&&(a.$$scope={dirty:L,ctx:M}),g.$set(a)},i(M){R||(Sn(g.$$.fragment,M),R=!0)},o(M){zn(g.$$.fragment,M),R=!1},d(M){M&&(Te(_),Te(C)),er(g,M),b[2](null)}}}function p0(b,g,_){let C;ks(b,zs,V=>_(4,C=V));const R=rs.find(V=>V.path===C);let M,L;$s(()=>{const V=new Vs.Map({container:M,style:qs,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});V.loadImage(l0,(ce,ee)=>{!ce&&ee&&V.addImage("direction-arrow",ee)});const F=jd();F.push({id:"maplibre-gl-directions-routeline-direction-arrow",type:"symbol",source:"maplibre-gl-directions",layout:{"symbol-placement":"line-center","icon-image":"direction-arrow","icon-size":["interpolate",["exponential",1.5],["zoom"],12,.85,18,1.4]},paint:{"icon-opacity":.5},filter:["==",["get","route"],"SELECTED"]}),V.on("load",()=>{L=new Ps(V,{requestOptions:{alternatives:"true"},layers:F}),L.interactive=!0})});function a(V){_s[V?"unshift":"push"](()=>{M=V,_(0,M)})}return[M,R,a]}class d0 extends $r{constructor(g){super(),Nr(this,g,p0,h0,Er,{})}}const f0=Object.freeze(Object.defineProperty({__proto__:null,default:d0},Symbol.toStringTag,{value:"Module"}));function m0(b){let g,_,C,R,M,L,a,V,F,ce,ee,ve,_e;return{c(){g=we("label"),_=we("input"),R=it(),M=we("strong"),M.textContent="Simulate a Touch-Enabled Device",L=it(),a=we("p"),a.textContent=`Sometimes it's pretty hard to aim exactly at the selected route line to add a waypoint by dragging it when using the
    plugin on a touch device.`,V=it(),F=we("p"),F.innerHTML=`The example shows how one could use the <code>layersFactory</code>&#39;s input parameters to handle that case by
    increasing the points by 1.5 and the lines by 2 times when the map is used on a touch-enabled device.`,ce=it(),ee=we("small"),ee.innerHTML=`<strong>Note</strong> that you can either load the page on a touch-enabled device or toggle the checkbox above: both
    options apply the same effect`,Ye(_,"type","checkbox"),_.disabled=C=!b[0],Ye(g,"class","flex items-center gap-3")},m(Ae,$e){Se(Ae,g,$e),Le(g,_),_.checked=b[1],Le(g,R),Le(g,M),Se(Ae,L,$e),Se(Ae,a,$e),Se(Ae,V,$e),Se(Ae,F,$e),Se(Ae,ce,$e),Se(Ae,ee,$e),ve||(_e=Bi(_,"change",b[5]),ve=!0)},p(Ae,$e){$e&1&&C!==(C=!Ae[0])&&(_.disabled=C),$e&2&&(_.checked=Ae[1])},d(Ae){Ae&&(Te(g),Te(L),Te(a),Te(V),Te(F),Te(ce),Te(ee)),ve=!1,_e()}}}function g0(b){let g;return{c(){g=we("span"),g.textContent=`${b[3].name}`,Ye(g,"slot","title")},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function _0(b){let g,_,C,R;return g=new Ds({props:{$$slots:{title:[g0],default:[m0]},$$scope:{ctx:b}}}),{c(){ur(g.$$.fragment),_=it(),C=we("div"),Ye(C,"class","basis-full lg:basis-2/3 shadow-xl")},m(M,L){Qn(g,M,L),Se(M,_,L),Se(M,C,L),b[6](C),R=!0},p(M,[L]){const a={};L&259&&(a.$$scope={dirty:L,ctx:M}),g.$set(a)},i(M){R||(Sn(g.$$.fragment,M),R=!0)},o(M){zn(g.$$.fragment,M),R=!1},d(M){M&&(Te(_),Te(C)),er(g,M),b[6](null)}}}function y0(b,g,_){let C;ks(b,zs,ee=>_(7,C=ee));const R=rs.find(ee=>ee.path===C);let M,L,a,V="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;$s(()=>{const ee=new Vs.Map({container:M,style:qs,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});ee.on("load",()=>{_(4,L=ee)})});function F(){V=this.checked,_(1,V)}function ce(ee){_s[ee?"unshift":"push"](()=>{M=ee,_(2,M)})}return b.$$.update=()=>{if(b.$$.dirty&19&&L){a&&a.destroy();const ee=jd(V?1.5:1,V?2:1);_(0,a=new Ps(L,{requestOptions:{alternatives:"true"},layers:ee})),_(0,a.interactive=!0,a)}},[a,V,M,R,L,F,ce]}class v0 extends $r{constructor(g){super(),Nr(this,g,y0,_0,Er,{})}}const x0=Object.freeze(Object.defineProperty({__proto__:null,default:v0},Symbol.toStringTag,{value:"Module"}));function Km(b,g,_){const C=b.slice();return C[7]=g[_],C}function Ym(b){let g,_=b[7]+"";return{c(){g=we("li")},m(C,R){Se(C,g,R),g.innerHTML=_},p(C,R){R&2&&_!==(_=C[7]+"")&&(g.innerHTML=_)},d(C){C&&Te(g)}}}function Jm(b){let g,_,C;return{c(){g=we("button"),g.textContent="Clear"},m(R,M){Se(R,g,M),_||(C=Bi(g,"click",b[3]),_=!0)},p:Di,d(R){R&&Te(g),_=!1,C()}}}function b0(b){let g,_,C,R,M,L=pp(b[1]),a=[];for(let F=0;F<L.length;F+=1)a[F]=Ym(Km(b,L,F));let V=b[1].length&&Jm(b);return{c(){g=we("p"),g.textContent=`This example listens for all the available events and logs them below. Interact with the map to see the emitted
    events.`,_=it(),C=we("ol");for(let F=0;F<a.length;F+=1)a[F].c();R=it(),V&&V.c(),M=qd()},m(F,ce){Se(F,g,ce),Se(F,_,ce),Se(F,C,ce);for(let ee=0;ee<a.length;ee+=1)a[ee]&&a[ee].m(C,null);Se(F,R,ce),V&&V.m(F,ce),Se(F,M,ce)},p(F,ce){if(ce&2){L=pp(F[1]);let ee;for(ee=0;ee<L.length;ee+=1){const ve=Km(F,L,ee);a[ee]?a[ee].p(ve,ce):(a[ee]=Ym(ve),a[ee].c(),a[ee].m(C,null))}for(;ee<a.length;ee+=1)a[ee].d(1);a.length=L.length}F[1].length?V?V.p(F,ce):(V=Jm(F),V.c(),V.m(M.parentNode,M)):V&&(V.d(1),V=null)},d(F){F&&(Te(g),Te(_),Te(C),Te(R),Te(M)),sm(a,F),V&&V.d(F)}}}function w0(b){let g;return{c(){g=we("span"),g.textContent=`${b[2].name}`,Ye(g,"slot","title")},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function T0(b){let g,_,C,R;return g=new Ds({props:{$$slots:{title:[w0],default:[b0]},$$scope:{ctx:b}}}),{c(){ur(g.$$.fragment),_=it(),C=we("div"),Ye(C,"class","basis-full lg:basis-2/3 shadow-xl")},m(M,L){Qn(g,M,L),Se(M,_,L),Se(M,C,L),b[4](C),R=!0},p(M,[L]){const a={};L&1026&&(a.$$scope={dirty:L,ctx:M}),g.$set(a)},i(M){R||(Sn(g.$$.fragment,M),R=!0)},o(M){zn(g.$$.fragment,M),R=!1},d(M){M&&(Te(_),Te(C)),er(g,M),b[4](null)}}}function S0(b,g,_){let C;ks(b,zs,ce=>_(6,C=ce));const R=rs.find(ce=>ce.path===C);let M,L,a=[];$s(()=>{const ce=new Vs.Map({container:M,style:qs,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});ce.on("load",()=>{L=new Ps(ce,{requestOptions:{alternatives:"true"}}),L.interactive=!0,L.on("addwaypoint",ee=>{var ve,_e;a.push(`<strong>${ee.type}</strong>: waypoint added at index <strong>${(ve=ee.data)==null?void 0:ve.index}</strong>. Original event - <strong>${(_e=ee.originalEvent)==null?void 0:_e.type}</strong>`),_(1,a)}),L.on("removewaypoint",ee=>{var ve,_e;a.push(`<strong>${ee.type}</strong>: waypoint removed at index <strong>${(ve=ee.data)==null?void 0:ve.index}</strong>. Original event - <strong>${(_e=ee.originalEvent)==null?void 0:_e.type}</strong>`),_(1,a)}),L.on("movewaypoint",ee=>{var ve,_e,Ae,$e;a.push(`<strong>${ee.type}</strong>: waypoint at index <strong>${(ve=ee.data)==null?void 0:ve.index}</strong> moved from coordinates ${(Ae=(_e=ee.data)==null?void 0:_e.initialCoordinates)==null?void 0:Ae.map(De=>De.toFixed(5)).join(", ")}. Original event - <strong>${($e=ee.originalEvent)==null?void 0:$e.type}</strong>`),_(1,a)}),L.on("fetchroutesstart",ee=>{a.push(`<strong>${ee.type}</strong>: routing request started. Original event - <strong>${ee.originalEvent.type}</strong>`),_(1,a)}),L.on("fetchroutesend",ee=>{var ve;a.push(`<strong>${ee.type}</strong>: routing request finished with code <strong>${(ve=ee.data)==null?void 0:ve.code}</strong>. Original event - <strong>${ee.originalEvent.type}</strong>`),_(1,a)})})});const V=()=>_(1,a=[]);function F(ce){_s[ce?"unshift":"push"](()=>{M=ce,_(0,M)})}return[M,a,R,V,F]}class E0 extends $r{constructor(g){super(),Nr(this,g,S0,T0,Er,{})}}const A0=Object.freeze(Object.defineProperty({__proto__:null,default:E0},Symbol.toStringTag,{value:"Module"}));function I0(b){let g,_,C,R,M,L,a,V,F,ce,ee,ve,_e,Ae,$e;return{c(){g=we("button"),_=dn("Abort Manually"),R=it(),M=we("p"),M.innerHTML=`Instead of aborting routing-requests manually, you can set the <code>requestTimeout</code> configuration option to a
    number of ms that a routing-request is allowed to take before getting automatically aborted.`,L=it(),a=we("label"),V=we("span"),V.innerHTML="<strong>Request Timeout</strong>",F=it(),ce=we("input"),ve=it(),_e=we("small"),_e.innerHTML=`<strong>Note</strong> that you may need to manually
    <a href="https://www.browserstack.com/guide/how-to-perform-network-throttling-in-chrome" target="_blank" rel="noreferrer">enable network throttling</a> for the setting above to take effect`,g.disabled=C=!b[0],Ye(ce,"type","number"),ce.disabled=ee=!b[0],Ye(a,"class","flex flex-col gap-2")},m(De,Ze){Se(De,g,Ze),Le(g,_),Se(De,R,Ze),Se(De,M,Ze),Se(De,L,Ze),Se(De,a,Ze),Le(a,V),Le(a,F),Le(a,ce),Wi(ce,b[1]),Se(De,ve,Ze),Se(De,_e,Ze),Ae||($e=[Bi(g,"click",b[4]),Bi(ce,"input",b[6])],Ae=!0)},p(De,Ze){Ze&1&&C!==(C=!De[0])&&(g.disabled=C),Ze&1&&ee!==(ee=!De[0])&&(ce.disabled=ee),Ze&2&&kn(ce.value)!==De[1]&&Wi(ce,De[1])},d(De){De&&(Te(g),Te(R),Te(M),Te(L),Te(a),Te(ve),Te(_e)),Ae=!1,bo($e)}}}function C0(b){let g;return{c(){g=we("span"),g.textContent=`${b[3].name}`,Ye(g,"slot","title")},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function M0(b){let g,_,C,R;return g=new Ds({props:{$$slots:{title:[C0],default:[I0]},$$scope:{ctx:b}}}),{c(){ur(g.$$.fragment),_=it(),C=we("div"),Ye(C,"class","basis-full lg:basis-2/3 shadow-xl")},m(M,L){Qn(g,M,L),Se(M,_,L),Se(M,C,L),b[7](C),R=!0},p(M,[L]){const a={};L&515&&(a.$$scope={dirty:L,ctx:M}),g.$set(a)},i(M){R||(Sn(g.$$.fragment,M),R=!0)},o(M){zn(g.$$.fragment,M),R=!1},d(M){M&&(Te(_),Te(C)),er(g,M),b[7](null)}}}function P0(b,g,_){let C;ks(b,zs,ve=>_(8,C=ve));const R=rs.find(ve=>ve.path===C);let M,L,a,V=1e3;$s(()=>{const ve=new Vs.Map({container:M,style:qs,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank' rel='noreferrer'>&copy; OSRM</a>"});ve.on("load",()=>{_(5,L=ve)})});function F(){var ve;(ve=a==null?void 0:a.abortController)==null||ve.abort()}function ce(){V=kn(this.value),_(1,V)}function ee(ve){_s[ve?"unshift":"push"](()=>{M=ve,_(2,M)})}return b.$$.update=()=>{b.$$.dirty&35&&L&&(a&&a.destroy(),_(0,a=new Ps(L,{requestOptions:{alternatives:"true"},requestTimeout:V})),_(0,a.interactive=!0,a))},[a,V,M,R,F,L,ce,ee]}class k0 extends $r{constructor(g){super(),Nr(this,g,P0,M0,Er,{})}}const z0=Object.freeze(Object.defineProperty({__proto__:null,default:k0},Symbol.toStringTag,{value:"Module"}));function D0(b){let g,_,C,R,M,L,a,V,F,ce,ee,ve,_e;return{c(){g=we("label"),_=we("span"),_.innerHTML="<strong>Position</strong>",C=it(),R=we("select"),M=we("option"),M.textContent="Top-Left",L=we("option"),L.textContent="Top-Right",a=we("option"),a.textContent="Bottom-Left",V=we("option"),V.textContent="Bottom-Right",ce=it(),ee=we("p"),ee.innerHTML=`The <code>LoadingIndicatorControl</code> adds a simple spinning loader-icon which automatically appears whenever there&#39;s
    an ongoing routing-request.`,M.__value="top-left",Wi(M,M.__value),L.__value="top-right",Wi(L,L.__value),a.__value="bottom-left",Wi(a,a.__value),V.__value="bottom-right",Wi(V,V.__value),R.disabled=F=!b[0],b[1]===void 0&&hp(()=>b[6].call(R)),Ye(g,"class","flex flex-col gap-2")},m(Ae,$e){Se(Ae,g,$e),Le(g,_),Le(g,C),Le(g,R),Le(R,M),Le(R,L),Le(R,a),Le(R,V),Dd(R,b[1],!0),Se(Ae,ce,$e),Se(Ae,ee,$e),ve||(_e=Bi(R,"change",b[6]),ve=!0)},p(Ae,$e){$e&1&&F!==(F=!Ae[0])&&(R.disabled=F),$e&2&&Dd(R,Ae[1])},d(Ae){Ae&&(Te(g),Te(ce),Te(ee)),ve=!1,_e()}}}function L0(b){let g;return{c(){g=we("span"),g.textContent=`${b[3].name}`,Ye(g,"slot","title")},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function R0(b){let g,_,C,R;return g=new Ds({props:{$$slots:{title:[L0],default:[D0]},$$scope:{ctx:b}}}),{c(){ur(g.$$.fragment),_=it(),C=we("div"),Ye(C,"class","basis-full lg:basis-2/3 shadow-xl")},m(M,L){Qn(g,M,L),Se(M,_,L),Se(M,C,L),b[7](C),R=!0},p(M,[L]){const a={};L&515&&(a.$$scope={dirty:L,ctx:M}),g.$set(a)},i(M){R||(Sn(g.$$.fragment,M),R=!0)},o(M){zn(g.$$.fragment,M),R=!1},d(M){M&&(Te(_),Te(C)),er(g,M),b[7](null)}}}function B0(b,g,_){let C;ks(b,zs,ve=>_(8,C=ve));const R=rs.find(ve=>ve.path===C);let M,L,a;$s(()=>{_(4,L=new Vs.Map({container:M,style:qs,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"})),L.on("load",()=>{_(0,a=new Ps(L,{requestOptions:{alternatives:"true"}})),_(0,a.interactive=!0,a)})});let V,F="top-right";function ce(){F=ig(this),_(1,F)}function ee(ve){_s[ve?"unshift":"push"](()=>{M=ve,_(2,M)})}return b.$$.update=()=>{b.$$.dirty&51&&L&&a&&(V&&L.hasControl(V)&&L.removeControl(V),L.addControl(_(5,V=new qy(a,{class:"m-2"})),F))},[a,F,M,R,L,V,ce,ee]}class F0 extends $r{constructor(g){super(),Nr(this,g,B0,R0,Er,{})}}const O0=Object.freeze(Object.defineProperty({__proto__:null,default:F0},Symbol.toStringTag,{value:"Module"}));function U0(b,g,_){const C=b.slice();return C[0]=g[_],C}function N0(b){let g,_,C,R,M;return{c(){g=we("li"),_=we("a"),_.textContent=`${b[0].name}`,C=it(),Ye(_,"href",b[0].path),Ye(_,"class","svelte-1jo4v3w"),Ye(g,"class","svelte-1jo4v3w")},m(L,a){Se(L,g,a),Le(g,_),Le(g,C),R||(M=Vd(Zd.call(null,_)),R=!0)},p:Di,d(L){L&&Te(g),R=!1,M()}}}function $0(b){let g,_=pp(rs.sort(G0)),C=[];for(let R=0;R<_.length;R+=1)C[R]=N0(U0(b,_,R));return{c(){g=we("ul");for(let R=0;R<C.length;R+=1)C[R].c();Ye(g,"class","svelte-1jo4v3w")},m(R,M){Se(R,g,M);for(let L=0;L<C.length;L+=1)C[L]&&C[L].m(g,null)},p:Di,d(R){R&&Te(g),sm(C,R)}}}function V0(b){let g;return{c(){g=we("span"),g.textContent="Examples",Ye(g,"slot","title"),Ye(g,"class","svelte-1jo4v3w")},m(_,C){Se(_,g,C)},p:Di,d(_){_&&Te(g)}}}function q0(b){let g,_,C,R;return g=new Ds({props:{noHeader:!0,$$slots:{title:[V0],default:[$0]},$$scope:{ctx:b}}}),{c(){ur(g.$$.fragment),_=it(),C=we("div"),C.innerHTML='<div class="p-5 lg:p-10 h-full flex flex-col gap-5 lg:gap-10 justify-start lg:justify-center items-center flex-col bg-inherit overflow-x-hidden overflow-y-auto svelte-1jo4v3w"><h1 class="text-center max-w-3xl svelte-1jo4v3w">Please, choose an example at the sidebar on the left</h1> <span class="text-slate-500 svelte-1jo4v3w">or navigate to</span> <div class="flex flex-col gap-2.5 lg:gap-5 justify-center items-center svelte-1jo4v3w"><a href="https://github.com/maplibre/maplibre-gl-directions" target="_blank" rel="noreferrer" class="svelte-1jo4v3w">GitHub</a> <a href="/maplibre-gl-directions//api" target="_blank" rel="noreferrer" class="svelte-1jo4v3w">API</a></div></div>',Ye(C,"class","basis-full lg:basis-2/3 overflow-hidden rounded-3xl shadow-xl svelte-1jo4v3w")},m(M,L){Qn(g,M,L),Se(M,_,L),Se(M,C,L),R=!0},p(M,[L]){const a={};L&8&&(a.$$scope={dirty:L,ctx:M}),g.$set(a)},i(M){R||(Sn(g.$$.fragment,M),R=!0)},o(M){zn(g.$$.fragment,M),R=!1},d(M){M&&(Te(_),Te(C)),er(g,M)}}}const G0=(b,g)=>b.index-g.index;class Z0 extends $r{constructor(g){super(),Nr(this,g,null,q0,Er,{})}}const rs=Object.entries(Object.assign({"./examples/1 User Interaction.svelte":iv,"./examples/10 Bearings Support and Control.svelte":lv,"./examples/11 Restyling.svelte":vv,"./examples/12 Distance Measurement.svelte":Mv,"./examples/13 Load and Save.svelte":Bv,"./examples/14 Multiple profiles.svelte":qv,"./examples/2 Programmatical Control.svelte":Xv,"./examples/3 Mapbox Directions API and Congestions.svelte":t0,"./examples/4 Origin and Destination.svelte":a0,"./examples/5 Show Routes' Directions.svelte":f0,"./examples/6 Touch-Friendly Features.svelte":x0,"./examples/7 Events.svelte":A0,"./examples/8 Aborting Requests.svelte":z0,"./examples/9 Loading Indicator Control.svelte":O0})).map(([b,g])=>{const _=b.match(/\/(\d+)\s([^/]+)\./),C=parseInt(_[1]),R=_[2];return{path:"/examples/"+R.toLowerCase().replaceAll(/\s/g,"-"),index:C,name:R,component:g,sourceUrl:`https://github.com/maplibre/maplibre-gl-directions/tree/main/demo/src/${b}`}}),um={};rs.forEach(b=>{um[b.path]=b.component.default});um["*"]=Z0;function j0(b){let g,_,C;return _=new cy({props:{routes:um}}),{c(){g=we("main"),ur(_.$$.fragment),Ye(g,"class","p-5 lg:p-10 flex flex-col lg:flex-row landscape:flex-row w-full gap-5 lg:gap-10")},m(R,M){Se(R,g,M),Qn(_,g,null),C=!0},p:Di,i(R){C||(Sn(_.$$.fragment,R),C=!0)},o(R){zn(_.$$.fragment,R),C=!1},d(R){R&&Te(g),er(_)}}}class W0 extends $r{constructor(g){super(),Nr(this,g,null,j0,Er,{})}}new W0({target:document.getElementById("app")});
