var wm=Object.defineProperty,Am=Object.defineProperties;var Em=Object.getOwnPropertyDescriptors;var Dh=Object.getOwnPropertySymbols;var Sm=Object.prototype.hasOwnProperty,Im=Object.prototype.propertyIsEnumerable;var Wc=(b,m,_)=>m in b?wm(b,m,{enumerable:!0,configurable:!0,writable:!0,value:_}):b[m]=_,Lh=(b,m)=>{for(var _ in m||(m={}))Sm.call(m,_)&&Wc(b,_,m[_]);if(Dh)for(var _ of Dh(m))Im.call(m,_)&&Wc(b,_,m[_]);return b},Bh=(b,m)=>Am(b,Em(m));var Xc=(b,m,_)=>(Wc(b,typeof m!="symbol"?m+"":m,_),_);const zm=function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const D of document.querySelectorAll('link[rel="modulepreload"]'))k(D);new MutationObserver(D=>{for(const E of D)if(E.type==="childList")for(const P of E.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&k(P)}).observe(document,{childList:!0,subtree:!0});function _(D){const E={};return D.integrity&&(E.integrity=D.integrity),D.referrerpolicy&&(E.referrerPolicy=D.referrerpolicy),D.crossorigin==="use-credentials"?E.credentials="include":D.crossorigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function k(D){if(D.ep)return;D.ep=!0;const E=_(D);fetch(D.href,E)}};zm();function Vt(){}function ru(b,m){for(const _ in m)b[_]=m[_];return b}function cp(b){return b()}function Rh(){return Object.create(null)}function Pn(b){b.forEach(cp)}function nu(b){return typeof b=="function"}function Ri(b,m){return b!=b?m==m:b!==m||b&&typeof b=="object"||typeof b=="function"}function Tm(b){return Object.keys(b).length===0}function up(b,...m){if(b==null)return Vt;const _=b.subscribe(...m);return _.unsubscribe?()=>_.unsubscribe():_}function vr(b,m,_){b.$$.on_destroy.push(up(m,_))}function Fh(b,m,_,k){if(b){const D=hp(b,m,_,k);return b[0](D)}}function hp(b,m,_,k){return b[1]&&k?ru(_.ctx.slice(),b[1](k(m))):_.ctx}function Oh(b,m,_,k){if(b[2]&&k){const D=b[2](k(_));if(m.dirty===void 0)return D;if(typeof D=="object"){const E=[],P=Math.max(m.dirty.length,D.length);for(let a=0;a<P;a+=1)E[a]=m.dirty[a]|D[a];return E}return m.dirty|D}return m.dirty}function Vh(b,m,_,k,D,E){if(D){const P=hp(m,_,k,E);b.p(P,D)}}function Uh(b){if(b.ctx.length>32){const m=[],_=b.ctx.length/32;for(let k=0;k<_;k++)m[k]=-1;return m}return-1}function ou(b){return b&&nu(b.destroy)?b.destroy:Vt}function He(b,m){b.appendChild(m)}function ve(b,m,_){b.insertBefore(m,_||null)}function be(b){b.parentNode.removeChild(b)}function pp(b,m){for(let _=0;_<b.length;_+=1)b[_]&&b[_].d(m)}function Ee(b){return document.createElement(b)}function _i(b){return document.createTextNode(b)}function it(){return _i(" ")}function Vl(){return _i("")}function cr(b,m,_,k){return b.addEventListener(m,_,k),()=>b.removeEventListener(m,_,k)}function tt(b,m,_){_==null?b.removeAttribute(m):b.getAttribute(m)!==_&&b.setAttribute(m,_)}function dp(b){return b===""?null:+b}function km(b){return Array.from(b.childNodes)}function mp(b,m){m=""+m,b.wholeText!==m&&(b.data=m)}function $h(b,m){b.value=m==null?"":m}function Fl(b,m){for(let _=0;_<b.options.length;_+=1){const k=b.options[_];if(k.__value===m){k.selected=!0;return}}b.selectedIndex=-1}function fp(b){const m=b.querySelector(":checked")||b.options[0];return m&&m.__value}function Nh(b,m,_){b.classList[_?"add":"remove"](m)}function Cm(b,m,{bubbles:_=!1,cancelable:k=!1}={}){const D=document.createEvent("CustomEvent");return D.initCustomEvent(b,_,k,m),D}let Cs;function Ts(b){Cs=b}function Ul(){if(!Cs)throw new Error("Function called outside component initialization");return Cs}function Rr(b){Ul().$$.on_mount.push(b)}function Mm(b){Ul().$$.after_update.push(b)}function Pm(b){Ul().$$.on_destroy.push(b)}function Dm(){const b=Ul();return(m,_,{cancelable:k=!1}={})=>{const D=b.$$.callbacks[m];if(D){const E=Cm(m,_,{cancelable:k});return D.slice().forEach(P=>{P.call(b,E)}),!E.defaultPrevented}return!0}}function jh(b,m){const _=b.$$.callbacks[m.type];_&&_.slice().forEach(k=>k.call(this,m))}const Es=[],ur=[],Ll=[],qh=[],gp=Promise.resolve();let Jc=!1;function yp(){Jc||(Jc=!0,gp.then(_p))}function Lm(){return yp(),gp}function Ms(b){Ll.push(b)}const Yc=new Set;let Pl=0;function _p(){const b=Cs;do{for(;Pl<Es.length;){const m=Es[Pl];Pl++,Ts(m),Bm(m.$$)}for(Ts(null),Es.length=0,Pl=0;ur.length;)ur.pop()();for(let m=0;m<Ll.length;m+=1){const _=Ll[m];Yc.has(_)||(Yc.add(_),_())}Ll.length=0}while(Es.length);for(;qh.length;)qh.pop()();Jc=!1,Yc.clear(),Ts(b)}function Bm(b){if(b.fragment!==null){b.update(),Pn(b.before_update);const m=b.dirty;b.dirty=[-1],b.fragment&&b.fragment.p(b.ctx,m),b.after_update.forEach(Ms)}}const Bl=new Set;let Po;function au(){Po={r:0,c:[],p:Po}}function su(){Po.r||Pn(Po.c),Po=Po.p}function ii(b,m){b&&b.i&&(Bl.delete(b),b.i(m))}function ci(b,m,_,k){if(b&&b.o){if(Bl.has(b))return;Bl.add(b),Po.c.push(()=>{Bl.delete(b),k&&(_&&b.d(1),k())}),b.o(m)}}function xp(b,m){const _={},k={},D={$$scope:1};let E=b.length;for(;E--;){const P=b[E],a=m[E];if(a){for(const U in P)U in a||(k[U]=1);for(const U in a)D[U]||(_[U]=a[U],D[U]=1);b[E]=a}else for(const U in P)D[U]=1}for(const P in k)P in _||(_[P]=void 0);return _}function bp(b){return typeof b=="object"&&b!==null?b:{}}function Ti(b){b&&b.c()}function wi(b,m,_,k){const{fragment:D,on_mount:E,on_destroy:P,after_update:a}=b.$$;D&&D.m(m,_),k||Ms(()=>{const U=E.map(cp).filter(nu);P?P.push(...U):Pn(U),b.$$.on_mount=[]}),a.forEach(Ms)}function Ai(b,m){const _=b.$$;_.fragment!==null&&(Pn(_.on_destroy),_.fragment&&_.fragment.d(m),_.on_destroy=_.fragment=null,_.ctx=[])}function Rm(b,m){b.$$.dirty[0]===-1&&(Es.push(b),yp(),b.$$.dirty.fill(0)),b.$$.dirty[m/31|0]|=1<<m%31}function qi(b,m,_,k,D,E,P,a=[-1]){const U=Cs;Ts(b);const G=b.$$={fragment:null,ctx:null,props:E,update:Vt,not_equal:D,bound:Rh(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(m.context||(U?U.$$.context:[])),callbacks:Rh(),dirty:a,skip_bound:!1,root:m.target||U.$$.root};P&&P(G.root);let ne=!1;if(G.ctx=_?_(b,m.props||{},(W,j,...se)=>{const de=se.length?se[0]:j;return G.ctx&&D(G.ctx[W],G.ctx[W]=de)&&(!G.skip_bound&&G.bound[W]&&G.bound[W](de),ne&&Rm(b,W)),j}):[],G.update(),ne=!0,Pn(G.before_update),G.fragment=k?k(G.ctx):!1,m.target){if(m.hydrate){const W=km(m.target);G.fragment&&G.fragment.l(W),W.forEach(be)}else G.fragment&&G.fragment.c();m.intro&&ii(b.$$.fragment),wi(b,m.target,m.anchor,m.customElement),_p()}Ts(U)}class Gi{$destroy(){Ai(this,1),this.$destroy=Vt}$on(m,_){const k=this.$$.callbacks[m]||(this.$$.callbacks[m]=[]);return k.push(_),()=>{const D=k.indexOf(_);D!==-1&&k.splice(D,1)}}$set(m){this.$$set&&!Tm(m)&&(this.$$.skip_bound=!0,this.$$set(m),this.$$.skip_bound=!1)}}const wa=[];function vp(b,m){return{subscribe:wp(b,m).subscribe}}function wp(b,m=Vt){let _;const k=new Set;function D(a){if(Ri(b,a)&&(b=a,_)){const U=!wa.length;for(const G of k)G[1](),wa.push(G,b);if(U){for(let G=0;G<wa.length;G+=2)wa[G][0](wa[G+1]);wa.length=0}}}function E(a){D(a(b))}function P(a,U=Vt){const G=[a,U];return k.add(G),k.size===1&&(_=m(D)||Vt),a(b),()=>{k.delete(G),k.size===0&&(_(),_=null)}}return{set:D,update:E,subscribe:P}}function Ap(b,m,_){const k=!Array.isArray(b),D=k?[b]:b,E=m.length<2;return vp(_,P=>{let a=!1;const U=[];let G=0,ne=Vt;const W=()=>{if(G)return;ne();const se=m(k?U[0]:U,P);E?P(se):ne=nu(se)?se:Vt},j=D.map((se,de)=>up(se,Ce=>{U[de]=Ce,G&=~(1<<de),a&&W()},()=>{G|=1<<de}));return a=!0,W(),function(){Pn(j),ne()}})}function Fm(b,m){if(b instanceof RegExp)return{keys:!1,pattern:b};var _,k,D,E,P=[],a="",U=b.split("/");for(U[0]||U.shift();D=U.shift();)_=D[0],_==="*"?(P.push("wild"),a+="/(.*)"):_===":"?(k=D.indexOf("?",1),E=D.indexOf(".",1),P.push(D.substring(1,~k?k:~E?E:D.length)),a+=!!~k&&!~E?"(?:/([^/]+?))?":"/([^/]+?)",~E&&(a+=(~k?"?":"")+"\\"+D.substring(E))):a+="/"+D;return{keys:P,pattern:new RegExp("^"+a+(m?"(?=$|/)":"/?$"),"i")}}function Om(b){let m,_,k;const D=[b[2]];var E=b[0];function P(a){let U={};for(let G=0;G<D.length;G+=1)U=ru(U,D[G]);return{props:U}}return E&&(m=new E(P()),m.$on("routeEvent",b[7])),{c(){m&&Ti(m.$$.fragment),_=Vl()},m(a,U){m&&wi(m,a,U),ve(a,_,U),k=!0},p(a,U){const G=U&4?xp(D,[bp(a[2])]):{};if(E!==(E=a[0])){if(m){au();const ne=m;ci(ne.$$.fragment,1,0,()=>{Ai(ne,1)}),su()}E?(m=new E(P()),m.$on("routeEvent",a[7]),Ti(m.$$.fragment),ii(m.$$.fragment,1),wi(m,_.parentNode,_)):m=null}else E&&m.$set(G)},i(a){k||(m&&ii(m.$$.fragment,a),k=!0)},o(a){m&&ci(m.$$.fragment,a),k=!1},d(a){a&&be(_),m&&Ai(m,a)}}}function Vm(b){let m,_,k;const D=[{params:b[1]},b[2]];var E=b[0];function P(a){let U={};for(let G=0;G<D.length;G+=1)U=ru(U,D[G]);return{props:U}}return E&&(m=new E(P()),m.$on("routeEvent",b[6])),{c(){m&&Ti(m.$$.fragment),_=Vl()},m(a,U){m&&wi(m,a,U),ve(a,_,U),k=!0},p(a,U){const G=U&6?xp(D,[U&2&&{params:a[1]},U&4&&bp(a[2])]):{};if(E!==(E=a[0])){if(m){au();const ne=m;ci(ne.$$.fragment,1,0,()=>{Ai(ne,1)}),su()}E?(m=new E(P()),m.$on("routeEvent",a[6]),Ti(m.$$.fragment),ii(m.$$.fragment,1),wi(m,_.parentNode,_)):m=null}else E&&m.$set(G)},i(a){k||(m&&ii(m.$$.fragment,a),k=!0)},o(a){m&&ci(m.$$.fragment,a),k=!1},d(a){a&&be(_),m&&Ai(m,a)}}}function Um(b){let m,_,k,D;const E=[Vm,Om],P=[];function a(U,G){return U[1]?0:1}return m=a(b),_=P[m]=E[m](b),{c(){_.c(),k=Vl()},m(U,G){P[m].m(U,G),ve(U,k,G),D=!0},p(U,[G]){let ne=m;m=a(U),m===ne?P[m].p(U,G):(au(),ci(P[ne],1,1,()=>{P[ne]=null}),su(),_=P[m],_?_.p(U,G):(_=P[m]=E[m](U),_.c()),ii(_,1),_.m(k.parentNode,k))},i(U){D||(ii(_),D=!0)},o(U){ci(_),D=!1},d(U){P[m].d(U),U&&be(k)}}}function Gh(){const b=window.location.href.indexOf("#/");let m=b>-1?window.location.href.substr(b+1):"/";const _=m.indexOf("?");let k="";return _>-1&&(k=m.substr(_+1),m=m.substr(0,_)),{location:m,querystring:k}}const lu=vp(null,function(m){m(Gh());const _=()=>{m(Gh())};return window.addEventListener("hashchange",_,!1),function(){window.removeEventListener("hashchange",_,!1)}}),wr=Ap(lu,b=>b.location);Ap(lu,b=>b.querystring);const Zh=wp(void 0);function cu(b,m){if(m=Wh(m),!b||!b.tagName||b.tagName.toLowerCase()!="a")throw Error('Action "link" can only be used with <a> tags');return Hh(b,m),{update(_){_=Wh(_),Hh(b,_)}}}function Hh(b,m){let _=m.href||b.getAttribute("href");if(_&&_.charAt(0)=="/")_="#"+_;else if(!_||_.length<2||_.slice(0,2)!="#/")throw Error('Invalid value for "href" attribute: '+_);b.setAttribute("href",_),b.addEventListener("click",k=>{k.preventDefault(),m.disabled||$m(k.currentTarget.getAttribute("href"))})}function Wh(b){return b&&typeof b=="string"?{href:b}:b||{}}function $m(b){history.replaceState(Bh(Lh({},history.state),{__svelte_spa_router_scrollX:window.scrollX,__svelte_spa_router_scrollY:window.scrollY}),void 0,void 0),window.location.hash=b}function Nm(b,m,_){let{routes:k={}}=m,{prefix:D=""}=m,{restoreScrollState:E=!1}=m;class P{constructor(Ke,Ie){if(!Ie||typeof Ie!="function"&&(typeof Ie!="object"||Ie._sveltesparouter!==!0))throw Error("Invalid component object");if(!Ke||typeof Ke=="string"&&(Ke.length<1||Ke.charAt(0)!="/"&&Ke.charAt(0)!="*")||typeof Ke=="object"&&!(Ke instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:rt,keys:At}=Fm(Ke);this.path=Ke,typeof Ie=="object"&&Ie._sveltesparouter===!0?(this.component=Ie.component,this.conditions=Ie.conditions||[],this.userData=Ie.userData,this.props=Ie.props||{}):(this.component=()=>Promise.resolve(Ie),this.conditions=[],this.props={}),this._pattern=rt,this._keys=At}match(Ke){if(D){if(typeof D=="string")if(Ke.startsWith(D))Ke=Ke.substr(D.length)||"/";else return null;else if(D instanceof RegExp){const Ht=Ke.match(D);if(Ht&&Ht[0])Ke=Ke.substr(Ht[0].length)||"/";else return null}}const Ie=this._pattern.exec(Ke);if(Ie===null)return null;if(this._keys===!1)return Ie;const rt={};let At=0;for(;At<this._keys.length;){try{rt[this._keys[At]]=decodeURIComponent(Ie[At+1]||"")||null}catch{rt[this._keys[At]]=null}At++}return rt}async checkConditions(Ke){for(let Ie=0;Ie<this.conditions.length;Ie++)if(!await this.conditions[Ie](Ke))return!1;return!0}}const a=[];k instanceof Map?k.forEach((ot,Ke)=>{a.push(new P(Ke,ot))}):Object.keys(k).forEach(ot=>{a.push(new P(ot,k[ot]))});let U=null,G=null,ne={};const W=Dm();async function j(ot,Ke){await Lm(),W(ot,Ke)}let se=null,de=null;E&&(de=ot=>{ot.state&&ot.state.__svelte_spa_router_scrollY?se=ot.state:se=null},window.addEventListener("popstate",de),Mm(()=>{se?window.scrollTo(se.__svelte_spa_router_scrollX,se.__svelte_spa_router_scrollY):window.scrollTo(0,0)}));let Ce=null,je=null;const nt=lu.subscribe(async ot=>{Ce=ot;let Ke=0;for(;Ke<a.length;){const Ie=a[Ke].match(ot.location);if(!Ie){Ke++;continue}const rt={route:a[Ke].path,location:ot.location,querystring:ot.querystring,userData:a[Ke].userData,params:Ie&&typeof Ie=="object"&&Object.keys(Ie).length?Ie:null};if(!await a[Ke].checkConditions(rt)){_(0,U=null),je=null,j("conditionsFailed",rt);return}j("routeLoading",Object.assign({},rt));const At=a[Ke].component;if(je!=At){At.loading?(_(0,U=At.loading),je=At,_(1,G=At.loadingParams),_(2,ne={}),j("routeLoaded",Object.assign({},rt,{component:U,name:U.name,params:G}))):(_(0,U=null),je=null);const Ht=await At();if(ot!=Ce)return;_(0,U=Ht&&Ht.default||Ht),je=At}Ie&&typeof Ie=="object"&&Object.keys(Ie).length?_(1,G=Ie):_(1,G=null),_(2,ne=a[Ke].props),j("routeLoaded",Object.assign({},rt,{component:U,name:U.name,params:G})).then(()=>{Zh.set(G)});return}_(0,U=null),je=null,Zh.set(void 0)});Pm(()=>{nt(),de&&window.removeEventListener("popstate",de)});function Ct(ot){jh.call(this,b,ot)}function mt(ot){jh.call(this,b,ot)}return b.$$set=ot=>{"routes"in ot&&_(3,k=ot.routes),"prefix"in ot&&_(4,D=ot.prefix),"restoreScrollState"in ot&&_(5,E=ot.restoreScrollState)},b.$$.update=()=>{b.$$.dirty&32&&(history.scrollRestoration=E?"manual":"auto")},[U,G,ne,k,D,E,Ct,mt]}class jm extends Gi{constructor(m){super(),qi(this,m,Nm,Um,Ri,{routes:3,prefix:4,restoreScrollState:5})}}const qm=b=>({}),Xh=b=>({});function Yh(b){let m,_,k,D,E,P,a,U,G;return{c(){m=Ee("header"),_=Ee("a"),_.textContent="Back to Menu",D=it(),E=Ee("a"),P=_i("Source"),tt(_,"href","/"),tt(_,"class","svelte-1jo4v3w"),tt(E,"href",a=b[1].sourceUrl),tt(E,"target","_blank"),tt(E,"class","svelte-1jo4v3w"),tt(m,"class","p-5 lg:p-10 pb-2.5 lg:pb-5 flex justify-between gap-2.5 lg:gap-5 sticky top-0 bg-inherit svelte-1jo4v3w")},m(ne,W){ve(ne,m,W),He(m,_),He(m,D),He(m,E),He(E,P),U||(G=ou(k=cu.call(null,_)),U=!0)},p:Vt,d(ne){ne&&be(m),U=!1,G()}}}function Gm(b){let m,_,k,D,E,P,a,U=!b[0]&&Yh(b);const G=b[3].title,ne=Fh(G,b,b[2],Xh),W=b[3].default,j=Fh(W,b,b[2],null);return{c(){m=Ee("aside"),_=Ee("div"),U&&U.c(),k=it(),D=Ee("article"),E=Ee("h1"),ne&&ne.c(),P=it(),j&&j.c(),tt(E,"class","break-all svelte-1jo4v3w"),tt(D,"class","p-5 lg:p-10 flex flex-col gap-1.5 lg:gap-3 svelte-1jo4v3w"),Nh(D,"!pt-0",!b[0]),tt(_,"class","h-full flex flex-col bg-inherit overflow-x-hidden overflow-y-auto svelte-1jo4v3w"),tt(m,"class","basis-full lg:basis-1/3 overflow-hidden shadow-xl svelte-1jo4v3w")},m(se,de){ve(se,m,de),He(m,_),U&&U.m(_,null),He(_,k),He(_,D),He(D,E),ne&&ne.m(E,null),He(D,P),j&&j.m(D,null),a=!0},p(se,[de]){se[0]?U&&(U.d(1),U=null):U?U.p(se,de):(U=Yh(se),U.c(),U.m(_,k)),ne&&ne.p&&(!a||de&4)&&Vh(ne,G,se,se[2],a?Oh(G,se[2],de,qm):Uh(se[2]),Xh),j&&j.p&&(!a||de&4)&&Vh(j,W,se,se[2],a?Oh(W,se[2],de,null):Uh(se[2]),null),de&1&&Nh(D,"!pt-0",!se[0])},i(se){a||(ii(ne,se),ii(j,se),a=!0)},o(se){ci(ne,se),ci(j,se),a=!1},d(se){se&&be(m),U&&U.d(),ne&&ne.d(se),j&&j.d(se)}}}function Zm(b,m,_){let k;vr(b,wr,U=>_(4,k=U));let{$$slots:D={},$$scope:E}=m,{noHeader:P=!1}=m;const a=ji.find(U=>U.path===k);return b.$$set=U=>{"noHeader"in U&&_(0,P=U.noHeader),"$$scope"in U&&_(2,E=U.$$scope)},[P,a,E,D]}class Ar extends Gi{constructor(m){super(),qi(this,m,Zm,Gm,Ri,{noHeader:0})}}var Hm=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Ep={exports:{}};(function(b,m){(function(_,k){b.exports=k()})(Hm,function(){var _,k,D;function E(a,U){if(!_)_=U;else if(!k)k=U;else{var G="var sharedChunk = {}; ("+_+")(sharedChunk); ("+k+")(sharedChunk);",ne={};_(ne),D=U(ne),typeof window!="undefined"&&(D.workerUrl=window.URL.createObjectURL(new Blob([G],{type:"text/javascript"})))}}E(["exports"],function(a){var U=G;function G(i,e,r,o){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=o}function ne(i,e,r,o){const l=new U(i,e,r,o);return function(h){return l.solve(h)}}G.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,o=0;o<8;o++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<e)return r;var h=this.sampleCurveDerivativeX(r);if(Math.abs(h)<1e-6)break;r-=l/h}var p=0,f=1;for(r=i,o=0;o<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<e));o++)i>l?p=r:f=r,r=.5*(f-p)+p;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};const W=ne(.25,.1,.25,1);function j(i,e,r){return Math.min(r,Math.max(e,i))}function se(i,e,r){const o=r-e,l=((i-e)%o+o)%o+e;return l===e?r:l}function de(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}let Ce=1;function je(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function nt(i,e,r){const o={};for(const l in i)o[l]=e.call(r||this,i[l],l,i);return o}function Ct(i,e,r){const o={};for(const l in i)e.call(r||this,i[l],l,i)&&(o[l]=i[l]);return o}function mt(i){return Array.isArray(i)?i.map(mt):typeof i=="object"&&i?nt(i,mt):i}const ot={};function Ke(i){ot[i]||(typeof console!="undefined"&&console.warn(i),ot[i]=!0)}function Ie(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function rt(i){let e=0;for(let r,o,l=0,h=i.length,p=h-1;l<h;p=l++)r=i[l],o=i[p],e+=(o.x-r.x)*(r.y+o.y);return e}function At(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Ht(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,l,h)=>{const p=l||h;return e[o]=!p||p.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Zi,ki,hr=null;function Er(i){if(hr==null){const e=i.navigator?i.navigator.userAgent:null;hr=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return hr}function Hi(i){return typeof ImageBitmap!="undefined"&&i instanceof ImageBitmap}const Sr={now:typeof performance!="undefined"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const r=window.document.createElement("canvas"),o=r.getContext("2d");if(!o)throw new Error("failed to create canvas 2d context");return r.width=i.width,r.height=i.height,o.drawImage(i,0,0,i.width,i.height),o.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(Zi||(Zi=document.createElement("a")),Zi.href=i,Zi.href),hardwareConcurrency:typeof navigator!="undefined"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ki==null&&(ki=matchMedia("(prefers-reduced-motion: reduce)")),ki.matches)}};var Ve=Wt;function Wt(i,e){this.x=i,this.y=e}Wt.prototype={clone:function(){return new Wt(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),o=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=o,this},_rotateAround:function(i,e){var r=Math.cos(i),o=Math.sin(i),l=e.y+o*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-o*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Wt.convert=function(i){return i instanceof Wt?i:Array.isArray(i)?new Wt(i[0],i[1]):i};const Yr={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Kr="mapbox-tiles";let pr,on,an=500,Ur=50;function Jr(){typeof caches=="undefined"||pr||(pr=caches.open(Kr))}let sn=1/0;const dr={supported:!1,testSupport:function(i){!Dn&&Nr&&(Do?io(i):$r=i)}};let $r,Nr,Dn=!1,Do=!1;function io(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Nr),i.isContextLost())return;dr.supported=!0}catch{}i.deleteTexture(e),Dn=!0}typeof document!="undefined"&&(Nr=document.createElement("img"),Nr.onload=function(){$r&&io($r),$r=null,Do=!0},Nr.onerror=function(){Dn=!0,$r=null},Nr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Lo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Lo);class mi extends Error{constructor(e,r,o,l){super(`AJAXError: ${r} (${e}): ${o}`),this.status=e,this.statusText=r,this.url=o,this.body=l}}const Qr=At()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function ro(i,e){const r=new AbortController,o=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Qr(),signal:r.signal});let l=!1,h=!1;return i.type==="json"&&o.headers.set("Accept","application/json"),((p,f,y)=>{if(h)return;const w=Date.now();fetch(o).then(I=>I.ok?((T,M,B)=>{(i.type==="arrayBuffer"?T.arrayBuffer():i.type==="json"?T.json():T.text()).then(R=>{h||(M&&B&&function(X,Y,oe){if(Jr(),!pr)return;const ce={status:Y.status,statusText:Y.statusText,headers:new Headers};Y.headers.forEach((ge,Ae)=>ce.headers.set(Ae,ge));const le=Ht(Y.headers.get("Cache-Control")||"");le["no-store"]||(le["max-age"]&&ce.headers.set("Expires",new Date(oe+1e3*le["max-age"]).toUTCString()),new Date(ce.headers.get("Expires")).getTime()-oe<42e4||function(ge,Ae){if(on===void 0)try{new Response(new ReadableStream),on=!0}catch{on=!1}on?Ae(ge.body):ge.blob().then(Ae)}(Y,ge=>{const Ae=new Response(ge,ce);Jr(),pr&&pr.then(xe=>xe.put(function(Ne){const Xe=Ne.indexOf("?");return Xe<0?Ne:Ne.slice(0,Xe)}(X.url),Ae)).catch(xe=>Ke(xe.message))}))}(o,M,B),l=!0,e(null,R,T.headers.get("Cache-Control"),T.headers.get("Expires")))}).catch(R=>{h||e(new Error(R.message))})})(I,null,w):I.blob().then(T=>e(new mi(I.status,I.statusText,i.url,T)))).catch(I=>{I.code!==20&&e(new Error(I.message))})})(),{cancel:()=>{h=!0,l||r.abort()}}}const ln=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(At()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!At()){const o=i.url.substring(0,i.url.indexOf("://"));return(Yr.REGISTERED_PROTOCOLS[o]||ro)(i,e)}}if(!(/^file:/.test(r=i.url)||/^file:/.test(Qr())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ro(i,e);if(At()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(o,l){const h=new XMLHttpRequest;h.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const p in o.headers)h.setRequestHeader(p,o.headers[p]);return o.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=o.credentials==="include",h.onerror=()=>{l(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let p=h.response;if(o.type==="json")try{p=JSON.parse(h.response)}catch(f){return l(f)}l(null,p,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else{const p=new Blob([h.response],{type:h.getResponseHeader("Content-Type")});l(new mi(h.status,h.statusText,o.url,p))}},h.send(o.body),{cancel:()=>h.abort()}}(i,e)},Ir=function(i,e){return ln(de(i,{type:"arrayBuffer"}),e)};function Bo(i){const e=window.document.createElement("a");return e.href=i,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const jr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let zr,Tr;zr=[],Tr=0;const no=function(i,e){if(dr.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Tr>=Yr.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return zr.push(h),h}Tr++;let r=!1;const o=()=>{if(!r)for(r=!0,Tr--;zr.length&&Tr<Yr.MAX_PARALLEL_IMAGE_REQUESTS;){const h=zr.shift(),{requestParameters:p,callback:f,cancelled:y}=h;y||(h.cancel=no(p,f).cancel)}},l=Ir(i,(h,p,f,y)=>{o(),h?e(h):p&&function(w,I){typeof createImageBitmap=="function"?function(T,M){const B=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(B).then(R=>{M(null,R)}).catch(R=>{M(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(w,I):function(T,M){const B=new Image;B.onload=()=>{M(null,B),URL.revokeObjectURL(B.src),B.onload=null,window.requestAnimationFrame(()=>{B.src=jr})},B.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const R=new Blob([new Uint8Array(T)],{type:"image/png"});B.src=T.byteLength?URL.createObjectURL(R):jr}(w,I)}(p,(w,I)=>{w!=null?e(w):I!=null&&e(null,I,{cacheControl:f,expires:y})})});return{cancel:()=>{l.cancel(),o()}}};function vt(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function cn(i,e,r){if(r&&r[i]){const o=r[i].indexOf(e);o!==-1&&r[i].splice(o,1)}}class en{constructor(e,r={}){de(this,r),this.type=e}}class un extends en{constructor(e,r={}){super("error",de({error:e},r))}}class oo{on(e,r){return this._listeners=this._listeners||{},vt(e,r,this._listeners),this}off(e,r){return cn(e,r,this._listeners),cn(e,r,this._oneTimeListeners),this}once(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},vt(e,r,this._oneTimeListeners),this}fire(e,r){typeof e=="string"&&(e=new en(e,r||{}));const o=e.type;if(this.listens(o)){e.target=this;const l=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const f of l)f.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const f of h)cn(o,f,this._oneTimeListeners),f.call(this,e);const p=this._eventedParent;p&&(de(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof un&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class De{constructor(e,r,o,l){this.message=(e?`${e}: `:"")+o,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function hn(i){const e=i.value;return e?[new De(i.key,e,"constants have been deprecated as of v8")]:[]}function qr(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}function Rt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function rr(i){if(Array.isArray(i))return i.map(rr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=rr(i[r]);return e}return Rt(i)}class Ci extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class pn{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[o,l]of r)this.bindings[o]=l}concat(e){return new pn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ut={kind:"null"},Me={kind:"number"},dt={kind:"string"},ut={kind:"boolean"},Mi={kind:"color"},mr={kind:"object"},ht={kind:"value"},dn={kind:"collator"},fr={kind:"formatted"},Gr={kind:"resolvedImage"};function ri(i,e){return{kind:"array",itemType:i,N:e}}function Ft(i){if(i.kind==="array"){const e=Ft(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const nr=[Ut,Me,dt,ut,Mi,fr,mr,ri(ht),Gr];function mn(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!mn(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of nr)if(!mn(r,e))return null}}return`Expected ${Ft(i)} but found ${Ft(e)} instead.`}function ui(i,e){return e.some(r=>r.kind===i.kind)}function gr(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}var yr,ao={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ln(i){return(i=Math.round(i))<0?0:i>255?255:i}function Bn(i){return Ln(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function $(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function A(i,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?i+(e-i)*r*6:2*r<1?e:3*r<2?i+(e-i)*(2/3-r)*6:i}try{yr={}.parseCSSColor=function(i){var e,r=i.replace(/ /g,"").toLowerCase();if(r in ao)return ao[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var o=r.indexOf("("),l=r.indexOf(")");if(o!==-1&&l+1===r.length){var h=r.substr(0,o),p=r.substr(o+1,l-(o+1)).split(","),f=1;switch(h){case"rgba":if(p.length!==4)return null;f=$(p.pop());case"rgb":return p.length!==3?null:[Bn(p[0]),Bn(p[1]),Bn(p[2]),f];case"hsla":if(p.length!==4)return null;f=$(p.pop());case"hsl":if(p.length!==3)return null;var y=(parseFloat(p[0])%360+360)%360/360,w=$(p[1]),I=$(p[2]),T=I<=.5?I*(w+1):I+w-I*w,M=2*I-T;return[Ln(255*A(M,T,y+1/3)),Ln(255*A(M,T,y)),Ln(255*A(M,T,y-1/3)),f];default:return null}}return null}}catch{}class z{constructor(e,r,o,l=1){this.r=e,this.g=r,this.b=o,this.a=l}static parse(e){if(!e)return;if(e instanceof z)return e;if(typeof e!="string")return;const r=yr(e);return r?new z(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,o,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(o)},${l})`}toArray(){const{r:e,g:r,b:o,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*r/l,255*o/l,l]}}z.black=new z(0,0,0,1),z.white=new z(1,1,1,1),z.transparent=new z(0,0,0,0),z.red=new z(1,0,0,1);class F{constructor(e,r,o){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class N{constructor(e,r,o,l,h){this.text=e,this.image=r,this.scale=o,this.fontStack=l,this.textColor=h}}class q{constructor(e){this.sections=e}static fromString(e){return new q([new N(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof q?e:q.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const o={};r.fontStack&&(o["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(o["font-scale"]=r.scale),r.textColor&&(o["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(o)}return e}}class Q{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Q({name:e,available:!1}):null}serialize(){return["image",this.name]}}function K(i,e,r,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,r,o]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function J(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof z||i instanceof F||i instanceof q||i instanceof Q)return!0;if(Array.isArray(i)){for(const e of i)if(!J(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!J(i[e]))return!1;return!0}return!1}function ee(i){if(i===null)return Ut;if(typeof i=="string")return dt;if(typeof i=="boolean")return ut;if(typeof i=="number")return Me;if(i instanceof z)return Mi;if(i instanceof F)return dn;if(i instanceof q)return fr;if(i instanceof Q)return Gr;if(Array.isArray(i)){const e=i.length;let r;for(const o of i){const l=ee(o);if(r){if(r===l)continue;r=ht;break}r=l}return ri(r||ht,e)}return mr}function pe(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof z||i instanceof q||i instanceof Q?i.toString():JSON.stringify(i)}class we{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!J(e[1]))return r.error("invalid value");const o=e[1];let l=ee(o);const h=r.expectedType;return l.kind!=="array"||l.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(l=h),new we(l,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof z?["rgba"].concat(this.value.toArray()):this.value instanceof q?this.value.serialize():this.value}}class ue{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ge={string:dt,number:Me,boolean:ut,object:mr};class Oe{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o,l=1;const h=e[0];if(h==="array"){let f,y;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in Ge)||w==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);f=Ge[w],l++}else f=ht;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);y=e[2],l++}o=ri(f,y)}else o=Ge[h];const p=[];for(;l<e.length;l++){const f=r.parse(e[l],l,ht);if(!f)return null;p.push(f)}return new Oe(o,p)}evaluate(e){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(e);if(!mn(this.type,ee(o)))return o;if(r===this.args.length-1)throw new ue(`Expected value to be of type ${Ft(this.type)}, but found ${Ft(ee(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){r.push(o.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&r.push(l)}}return r.concat(this.args.map(o=>o.serialize()))}}class We{constructor(e){this.type=fr,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const l=[];let h=!1;for(let p=1;p<=e.length-1;++p){const f=e[p];if(h&&typeof f=="object"&&!Array.isArray(f)){h=!1;let y=null;if(f["font-scale"]&&(y=r.parse(f["font-scale"],1,Me),!y))return null;let w=null;if(f["text-font"]&&(w=r.parse(f["text-font"],1,ri(dt)),!w))return null;let I=null;if(f["text-color"]&&(I=r.parse(f["text-color"],1,Mi),!I))return null;const T=l[l.length-1];T.scale=y,T.font=w,T.textColor=I}else{const y=r.parse(e[p],1,ht);if(!y)return null;const w=y.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,l.push({content:y,scale:null,font:null,textColor:null})}}return new We(l)}evaluate(e){return new q(this.sections.map(r=>{const o=r.content.evaluate(e);return ee(o)===Gr?new N("",o,null,null,null):new N(pe(o),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const o={};r.scale&&(o["font-scale"]=r.scale.serialize()),r.font&&(o["text-font"]=r.font.serialize()),r.textColor&&(o["text-color"]=r.textColor.serialize()),e.push(o)}return e}}class Je{constructor(e){this.type=Gr,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const o=r.parse(e[1],1,dt);return o?new Je(o):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),o=Q.fromString(r);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(r)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Et={"to-boolean":ut,"to-color":Mi,"to-number":Me,"to-string":dt};class _t{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[0];if((o==="to-boolean"||o==="to-string")&&e.length!==2)return r.error("Expected one argument.");const l=Et[o],h=[];for(let p=1;p<e.length;p++){const f=r.parse(e[p],p,ht);if(!f)return null;h.push(f)}return new _t(l,h)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,o;for(const l of this.args){if(r=l.evaluate(e),o=null,r instanceof z)return r;if(typeof r=="string"){const h=e.parseColor(r);if(h)return h}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:K(r[0],r[1],r[2],r[3]),!o))return new z(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new ue(o||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const o of this.args){if(r=o.evaluate(e),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new ue(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?q.fromString(pe(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Q.fromString(pe(this.args[0].evaluate(e))):pe(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new We([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Je(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const ft=["Unknown","Point","LineString","Polygon"];class pt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ft[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=z.parse(e)),r}}class ct{constructor(e,r,o,l){this.name=e,this.type=r,this._evaluate=o,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const o=e[0],l=ct.definitions[o];if(!l)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,f=p.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let y=null;for(const[w,I]of f){y=new Oo(r.registry,r.path,null,r.scope);const T=[];let M=!1;for(let B=1;B<e.length;B++){const R=e[B],X=Array.isArray(w)?w[B-1]:w.type,Y=y.parse(R,1+T.length,X);if(!Y){M=!0;break}T.push(Y)}if(!M)if(Array.isArray(w)&&w.length!==T.length)y.error(`Expected ${w.length} arguments, but found ${T.length} instead.`);else{for(let B=0;B<T.length;B++){const R=Array.isArray(w)?w[B]:w.type,X=T[B];y.concat(B+1).checkSubtype(R,X.type)}if(y.errors.length===0)return new ct(o,h,I,T)}}if(f.length===1)r.errors.push(...y.errors);else{const w=(f.length?f:p).map(([T])=>{return M=T,Array.isArray(M)?`(${M.map(Ft).join(", ")})`:`(${Ft(M.type)}...)`;var M}).join(" | "),I=[];for(let T=1;T<e.length;T++){const M=r.parse(e[T],1+I.length);if(!M)return null;I.push(Ft(M.type))}r.error(`Expected arguments of type ${w}, but found (${I.join(", ")}) instead.`)}return null}static register(e,r){ct.definitions=r;for(const o in r)e[o]=ct}}class ei{constructor(e,r,o){this.type=dn,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const l=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,ut);if(!l)return null;const h=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,ut);if(!h)return null;let p=null;return o.locale&&(p=r.parse(o.locale,1,dt),!p)?null:new ei(l,h,p)}evaluate(e){return new F(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Kt=8192;function fi(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function xi(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Aa(i,e){const r=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*Kt),Math.round(o*l*Kt)]}function Ea(i,e,r){const o=i[0]-e[0],l=i[1]-e[1],h=i[0]-r[0],p=i[1]-r[1];return o*p-h*l==0&&o*h<=0&&l*p<=0}function Ot(i,e){let r=!1;for(let p=0,f=e.length;p<f;p++){const y=e[p];for(let w=0,I=y.length;w<I-1;w++){if(Ea(i,y[w],y[w+1]))return!1;(l=y[w])[1]>(o=i)[1]!=(h=y[w+1])[1]>o[1]&&o[0]<(h[0]-l[0])*(o[1]-l[1])/(h[1]-l[1])+l[0]&&(r=!r)}}var o,l,h;return r}function jl(i,e){for(let r=0;r<e.length;r++)if(Ot(i,e[r]))return!0;return!1}function Sa(i,e,r,o){const l=o[0]-r[0],h=o[1]-r[1],p=(i[0]-r[0])*h-l*(i[1]-r[1]),f=(e[0]-r[0])*h-l*(e[1]-r[1]);return p>0&&f<0||p<0&&f>0}function ql(i,e,r){for(const w of r)for(let I=0;I<w.length-1;++I)if((f=[(p=w[I+1])[0]-(h=w[I])[0],p[1]-h[1]])[0]*(y=[(l=e)[0]-(o=i)[0],l[1]-o[1]])[1]-f[1]*y[0]!=0&&Sa(o,l,h,p)&&Sa(h,p,o,l))return!0;var o,l,h,p,f,y;return!1}function Ia(i,e){for(let r=0;r<i.length;++r)if(!Ot(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(ql(i[r],i[r+1],e))return!1;return!0}function Ps(i,e){for(let r=0;r<e.length;r++)if(Ia(i,e[r]))return!0;return!1}function za(i,e,r){const o=[];for(let l=0;l<i.length;l++){const h=[];for(let p=0;p<i[l].length;p++){const f=Aa(i[l][p],r);fi(e,f),h.push(f)}o.push(h)}return o}function Ta(i,e,r){const o=[];for(let l=0;l<i.length;l++){const h=za(i[l],e,r);o.push(h)}return o}function ka(i,e,r,o){if(i[0]<r[0]||i[0]>r[2]){const l=.5*o;let h=i[0]-r[0]>l?-o:r[0]-i[0]>l?o:0;h===0&&(h=i[0]-r[2]>l?-o:r[2]-i[0]>l?o:0),i[0]+=h}fi(e,i)}function Ds(i,e,r,o){const l=Math.pow(2,o.z)*Kt,h=[o.x*Kt,o.y*Kt],p=[];for(const f of i)for(const y of f){const w=[y.x+h[0],y.y+h[1]];ka(w,e,r,l),p.push(w)}return p}function Ls(i,e,r,o){const l=Math.pow(2,o.z)*Kt,h=[o.x*Kt,o.y*Kt],p=[];for(const y of i){const w=[];for(const I of y){const T=[I.x+h[0],I.y+h[1]];fi(e,T),w.push(T)}p.push(w)}if(e[2]-e[0]<=l/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const y of p)for(const w of y)ka(w,e,r,l)}var f;return p}class fn{constructor(e,r){this.type=ut,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(J(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let l=0;l<o.features.length;++l){const h=o.features[l].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new fn(o,o.features[l].geometry)}else if(o.type==="Feature"){const l=o.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new fn(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new fn(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,o){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(o.type==="Polygon"){const f=za(o.coordinates,h,p),y=Ds(r.geometry(),l,h,p);if(!xi(l,h))return!1;for(const w of y)if(!Ot(w,f))return!1}if(o.type==="MultiPolygon"){const f=Ta(o.coordinates,h,p),y=Ds(r.geometry(),l,h,p);if(!xi(l,h))return!1;for(const w of y)if(!jl(w,f))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,o){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(o.type==="Polygon"){const f=za(o.coordinates,h,p),y=Ls(r.geometry(),l,h,p);if(!xi(l,h))return!1;for(const w of y)if(!Ia(w,f))return!1}if(o.type==="MultiPolygon"){const f=Ta(o.coordinates,h,p),y=Ls(r.geometry(),l,h,p);if(!xi(l,h))return!1;for(const w of y)if(!Ps(w,f))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Ro(i){if(i instanceof ct&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof fn)return!1;let e=!0;return i.eachChild(r=>{e&&!Ro(r)&&(e=!1)}),e}function Rn(i){if(i instanceof ct&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Rn(r)&&(e=!1)}),e}function so(i,e){if(i instanceof ct&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(o=>{r&&!so(o,e)&&(r=!1)}),r}class Fo{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=e[1];return r.scope.has(o)?new Fo(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Oo{constructor(e,r=[],o,l=new pn,h=[]){this.registry=e,this.path=r,this.key=r.map(p=>`[${p}]`).join(""),this.scope=l,this.errors=h,this.expectedType=o}parse(e,r,o,l,h={}){return r?this.concat(r,o,l)._parse(e,h):this._parse(e,h)}_parse(e,r){function o(l,h,p){return p==="assert"?new Oe(h,[l]):p==="coerce"?new _t(h,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[l];if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const f=this.expectedType,y=p.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||y.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(f,y))return null}else p=o(p,f,r.typeAnnotation||"coerce");else p=o(p,f,r.typeAnnotation||"assert")}if(!(p instanceof we)&&p.type.kind!=="resolvedImage"&&lo(p)){const f=new pt;try{p=new we(p.type,p.evaluate(f))}catch(y){return this.error(y.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,o){const l=typeof e=="number"?this.path.concat(e):this.path,h=o?this.scope.concat(o):this.scope;return new Oo(this.registry,l,r||null,h,this.errors)}error(e,...r){const o=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new Ci(o,e))}checkSubtype(e,r){const o=mn(e,r);return o&&this.error(o),o}}function lo(i){if(i instanceof Fo)return lo(i.boundExpression);if(i instanceof ct&&i.name==="error"||i instanceof ei||i instanceof fn)return!1;const e=i instanceof _t||i instanceof Oe;let r=!0;return i.eachChild(o=>{r=e?r&&lo(o):r&&o instanceof we}),!!r&&Ro(i)&&so(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Vo(i,e){const r=i.length-1;let o,l,h=0,p=r,f=0;for(;h<=p;)if(f=Math.floor((h+p)/2),o=i[f],l=i[f+1],o<=e){if(f===r||e<l)return f;h=f+1}else{if(!(o>e))throw new ue("Input is not a number.");p=f-1}return 0}class co{constructor(e,r,o){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[l,h]of o)this.labels.push(l),this.outputs.push(h)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(e[1],1,Me);if(!o)return null;const l=[];let h=null;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);for(let p=1;p<e.length;p+=2){const f=p===1?-1/0:e[p],y=e[p+1],w=p,I=p+1;if(typeof f!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(l.length&&l[l.length-1][0]>=f)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const T=r.parse(y,I,h);if(!T)return null;h=h||T.type,l.push([f,T])}return new co(h,o,l)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return o[0].evaluate(e);const h=r.length;return l>=r[h-1]?o[h-1].evaluate(e):o[Vo(r,l)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}function ni(i,e,r){return i*(1-r)+e*r}var uo=Object.freeze({__proto__:null,number:ni,color:function(i,e,r){return new z(ni(i.r,e.r,r),ni(i.g,e.g,r),ni(i.b,e.b,r),ni(i.a,e.a,r))},array:function(i,e,r){return i.map((o,l)=>ni(o,e[l],r))}});const Ca=.95047,Bs=1.08883,Rs=4/29,Uo=6/29,Ma=3*Uo*Uo,Gl=Math.PI/180,Zl=180/Math.PI;function Pa(i){return i>.008856451679035631?Math.pow(i,1/3):i/Ma+Rs}function Da(i){return i>Uo?i*i*i:Ma*(i-Rs)}function La(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Ba(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Fs(i){const e=Ba(i.r),r=Ba(i.g),o=Ba(i.b),l=Pa((.4124564*e+.3575761*r+.1804375*o)/Ca),h=Pa((.2126729*e+.7151522*r+.072175*o)/1);return{l:116*h-16,a:500*(l-h),b:200*(h-Pa((.0193339*e+.119192*r+.9503041*o)/Bs)),alpha:i.a}}function Tt(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,o=isNaN(i.b)?e:e-i.b/200;return e=1*Da(e),r=Ca*Da(r),o=Bs*Da(o),new z(La(3.2404542*r-1.5371385*e-.4985314*o),La(-.969266*r+1.8760108*e+.041556*o),La(.0556434*r-.2040259*e+1.0572252*o),i.alpha)}function Hl(i,e,r){const o=e-i;return i+r*(o>180||o<-180?o-360*Math.round(o/360):o)}const ho={forward:Fs,reverse:Tt,interpolate:function(i,e,r){return{l:ni(i.l,e.l,r),a:ni(i.a,e.a,r),b:ni(i.b,e.b,r),alpha:ni(i.alpha,e.alpha,r)}}},po={forward:function(i){const{l:e,a:r,b:o}=Fs(i),l=Math.atan2(o,r)*Zl;return{h:l<0?l+360:l,c:Math.sqrt(r*r+o*o),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Gl,r=i.c;return Tt({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:Hl(i.h,e.h,r),c:ni(i.c,e.c,r),l:ni(i.l,e.l,r),alpha:ni(i.alpha,e.alpha,r)}}};var Os=Object.freeze({__proto__:null,lab:ho,hcl:po});class Wi{constructor(e,r,o,l,h){this.type=e,this.operator=r,this.interpolation=o,this.input=l,this.labels=[],this.outputs=[];for(const[p,f]of h)this.labels.push(p),this.outputs.push(f)}static interpolationFactor(e,r,o,l){let h=0;if(e.name==="exponential")h=Ra(r,e.base,o,l);else if(e.name==="linear")h=Ra(r,1,o,l);else if(e.name==="cubic-bezier"){const p=e.controlPoints;h=new U(p[0],p[1],p[2],p[3]).solve(Ra(r,1,o,l))}return h}static parse(e,r){let[o,l,h,...p]=e;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const w=l[1];if(typeof w!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:w}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const w=l.slice(1);if(w.length!==4||w.some(I=>typeof I!="number"||I<0||I>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(h=r.parse(h,2,Me),!h)return null;const f=[];let y=null;o==="interpolate-hcl"||o==="interpolate-lab"?y=Mi:r.expectedType&&r.expectedType.kind!=="value"&&(y=r.expectedType);for(let w=0;w<p.length;w+=2){const I=p[w],T=p[w+1],M=w+3,B=w+4;if(typeof I!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(f.length&&f[f.length-1][0]>=I)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const R=r.parse(T,B,y);if(!R)return null;y=y||R.type,f.push([I,R])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new Wi(y,o,l,h,f):r.error(`Type ${Ft(y)} is not interpolatable.`)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return o[0].evaluate(e);const h=r.length;if(l>=r[h-1])return o[h-1].evaluate(e);const p=Vo(r,l),f=Wi.interpolationFactor(this.interpolation,l,r[p],r[p+1]),y=o[p].evaluate(e),w=o[p+1].evaluate(e);return this.operator==="interpolate"?uo[this.type.kind.toLowerCase()](y,w,f):this.operator==="interpolate-hcl"?po.reverse(po.interpolate(po.forward(y),po.forward(w),f)):ho.reverse(ho.interpolate(ho.forward(y),ho.forward(w),f))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)r.push(this.labels[o],this.outputs[o].serialize());return r}}function Ra(i,e,r,o){const l=o-r,h=i-r;return l===0?0:e===1?h/l:(Math.pow(e,h)-1)/(Math.pow(e,l)-1)}class $o{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let o=null;const l=r.expectedType;l&&l.kind!=="value"&&(o=l);const h=[];for(const f of e.slice(1)){const y=r.parse(f,1+h.length,o,void 0,{typeAnnotation:"omit"});if(!y)return null;o=o||y.type,h.push(y)}const p=l&&h.some(f=>mn(l,f.type));return new $o(p?ht:o,h)}evaluate(e){let r,o=null,l=0;for(const h of this.args)if(l++,o=h.evaluate(e),o&&o instanceof Q&&!o.available&&(r||(r=o.name),o=null,l===this.args.length&&(o=r)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class No{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let h=1;h<e.length-1;h+=2){const p=e[h];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",h);const f=r.parse(e[h+1],h+1);if(!f)return null;o.push([p,f])}const l=r.parse(e[e.length-1],e.length-1,r.expectedType,o);return l?new No(o,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,o]of this.bindings)e.push(r,o.serialize());return e.push(this.result.serialize()),e}}class Fa{constructor(e,r,o){this.type=e,this.index=r,this.input=o}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Me),l=r.parse(e[2],2,ri(r.expectedType||ht));return o&&l?new Fa(l.type.itemType,o,l):null}evaluate(e){const r=this.index.evaluate(e),o=this.input.evaluate(e);if(r<0)throw new ue(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new ue(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new ue(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Oa{constructor(e,r){this.type=ut,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,ht),l=r.parse(e[2],2,ht);return o&&l?ui(o.type,[ut,dt,Me,Ut,ht])?new Oa(o,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(o.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!gr(r,["boolean","string","number","null"]))throw new ue(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(ee(r))} instead.`);if(!gr(o,["string","array"]))throw new ue(`Expected second argument to be of type array or string, but found ${Ft(ee(o))} instead.`);return o.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class jo{constructor(e,r,o){this.type=Me,this.needle=e,this.haystack=r,this.fromIndex=o}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,ht),l=r.parse(e[2],2,ht);if(!o||!l)return null;if(!ui(o.type,[ut,dt,Me,Ut,ht]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(o.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Me);return h?new jo(o,l,h):null}return new jo(o,l)}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!gr(r,["boolean","string","number","null"]))throw new ue(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(ee(r))} instead.`);if(!gr(o,["string","array"]))throw new ue(`Expected second argument to be of type array or string, but found ${Ft(ee(o))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return o.indexOf(r,l)}return o.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Va{constructor(e,r,o,l,h,p){this.inputType=e,this.type=r,this.input=o,this.cases=l,this.outputs=h,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let o,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const h={},p=[];for(let w=2;w<e.length-1;w+=2){let I=e[w];const T=e[w+1];Array.isArray(I)||(I=[I]);const M=r.concat(w);if(I.length===0)return M.error("Expected at least one branch label.");for(const R of I){if(typeof R!="number"&&typeof R!="string")return M.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return M.error("Numeric branch labels must be integer values.");if(o){if(M.checkSubtype(o,ee(R)))return null}else o=ee(R);if(h[String(R)]!==void 0)return M.error("Branch labels must be unique.");h[String(R)]=p.length}const B=r.parse(T,w,l);if(!B)return null;l=l||B.type,p.push(B)}const f=r.parse(e[1],1,ht);if(!f)return null;const y=r.parse(e[e.length-1],e.length-1,l);return y?f.type.kind!=="value"&&r.concat(1).checkSubtype(o,f.type)?null:new Va(o,l,f,h,p,y):null}evaluate(e){const r=this.input.evaluate(e);return(ee(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),o=[],l={};for(const p of r){const f=l[this.cases[p]];f===void 0?(l[this.cases[p]]=o.length,o.push([this.cases[p],[p]])):o[f][1].push(p)}const h=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,f]of o)e.push(f.length===1?h(f[0]):f.map(h)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class Ua{constructor(e,r,o){this.type=e,this.branches=r,this.otherwise=o}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const l=[];for(let p=1;p<e.length-1;p+=2){const f=r.parse(e[p],p,ut);if(!f)return null;const y=r.parse(e[p+1],p+1,o);if(!y)return null;l.push([f,y]),o=o||y.type}const h=r.parse(e[e.length-1],e.length-1,o);return h?new Ua(o,l,h):null}evaluate(e){for(const[r,o]of this.branches)if(r.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,o]of this.branches)e(r),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class qo{constructor(e,r,o,l){this.type=e,this.input=r,this.beginIndex=o,this.endIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,ht),l=r.parse(e[2],2,Me);if(!o||!l)return null;if(!ui(o.type,[ri(ht),dt,ht]))return r.error(`Expected first argument to be of type array or string, but found ${Ft(o.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,Me);return h?new qo(o.type,o,l,h):null}return new qo(o.type,o,l)}evaluate(e){const r=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!gr(r,["string","array"]))throw new ue(`Expected first argument to be of type array or string, but found ${Ft(ee(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return r.slice(o,l)}return r.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Vs(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Us(i,e,r,o){return o.compare(e,r)===0}function Fn(i,e,r){const o=i!=="=="&&i!=="!=";return class Sp{constructor(h,p,f){this.type=ut,this.lhs=h,this.rhs=p,this.collator=f,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const f=h[0];let y=p.parse(h[1],1,ht);if(!y)return null;if(!Vs(f,y.type))return p.concat(1).error(`"${f}" comparisons are not supported for type '${Ft(y.type)}'.`);let w=p.parse(h[2],2,ht);if(!w)return null;if(!Vs(f,w.type))return p.concat(2).error(`"${f}" comparisons are not supported for type '${Ft(w.type)}'.`);if(y.type.kind!==w.type.kind&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${Ft(y.type)}' and '${Ft(w.type)}'.`);o&&(y.type.kind==="value"&&w.type.kind!=="value"?y=new Oe(w.type,[y]):y.type.kind!=="value"&&w.type.kind==="value"&&(w=new Oe(y.type,[w])));let I=null;if(h.length===4){if(y.type.kind!=="string"&&w.type.kind!=="string"&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(I=p.parse(h[3],3,dn),!I)return null}return new Sp(y,w,I)}evaluate(h){const p=this.lhs.evaluate(h),f=this.rhs.evaluate(h);if(o&&this.hasUntypedArgument){const y=ee(p),w=ee(f);if(y.kind!==w.kind||y.kind!=="string"&&y.kind!=="number")throw new ue(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${y.kind}, ${w.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const y=ee(p),w=ee(f);if(y.kind!=="string"||w.kind!=="string")return e(h,p,f)}return this.collator?r(h,p,f,this.collator.evaluate(h)):e(h,p,f)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[i];return this.eachChild(p=>{h.push(p.serialize())}),h}}}const Wl=Fn("==",function(i,e,r){return e===r},Us),Xl=Fn("!=",function(i,e,r){return e!==r},function(i,e,r,o){return!Us(0,e,r,o)}),Yl=Fn("<",function(i,e,r){return e<r},function(i,e,r,o){return o.compare(e,r)<0}),Kl=Fn(">",function(i,e,r){return e>r},function(i,e,r,o){return o.compare(e,r)>0}),Jl=Fn("<=",function(i,e,r){return e<=r},function(i,e,r,o){return o.compare(e,r)<=0}),Ql=Fn(">=",function(i,e,r){return e>=r},function(i,e,r,o){return o.compare(e,r)>=0});class $a{constructor(e,r,o,l,h){this.type=dt,this.number=e,this.locale=r,this.currency=o,this.minFractionDigits=l,this.maxFractionDigits=h}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const o=r.parse(e[1],1,Me);if(!o)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let h=null;if(l.locale&&(h=r.parse(l.locale,1,dt),!h))return null;let p=null;if(l.currency&&(p=r.parse(l.currency,1,dt),!p))return null;let f=null;if(l["min-fraction-digits"]&&(f=r.parse(l["min-fraction-digits"],1,Me),!f))return null;let y=null;return l["max-fraction-digits"]&&(y=r.parse(l["max-fraction-digits"],1,Me),!y)?null:new $a(o,h,p,f,y)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Na{constructor(e){this.type=Me,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=r.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Ft(o.type)} instead.`):new Na(o):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new ue(`Expected value to be of type string or array, but found ${Ft(ee(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const On={"==":Wl,"!=":Xl,">":Kl,"<":Yl,">=":Ql,"<=":Jl,array:Oe,at:Fa,boolean:Oe,case:Ua,coalesce:$o,collator:ei,format:We,image:Je,in:Oa,"index-of":jo,interpolate:Wi,"interpolate-hcl":Wi,"interpolate-lab":Wi,length:Na,let:No,literal:we,match:Va,number:Oe,"number-format":$a,object:Oe,slice:qo,step:co,string:Oe,"to-boolean":_t,"to-color":_t,"to-number":_t,"to-string":_t,var:Fo,within:fn};function $s(i,[e,r,o,l]){e=e.evaluate(i),r=r.evaluate(i),o=o.evaluate(i);const h=l?l.evaluate(i):1,p=K(e,r,o,h);if(p)throw new ue(p);return new z(e/255*h,r/255*h,o/255*h,h)}function Ns(i,e){return i in e}function ja(i,e){const r=e[i];return r===void 0?null:r}function gn(i){return{type:i}}function js(i){return{result:"success",value:i}}function yn(i){return{result:"error",value:i}}function Vn(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function qs(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function qa(i){return!!i.expression&&i.expression.interpolated}function lt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Go(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Dt(i){return i}function Zo(i,e){const r=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",l=o||!(o||i.property!==void 0),h=i.type||(qa(e)?"exponential":"interval");if(r&&((i=qr({},i)).stops&&(i.stops=i.stops.map(w=>[w[0],z.parse(w[1])])),i.default=z.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Os[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let p,f,y;if(h==="exponential")p=Ga;else if(h==="interval")p=Ho;else if(h==="categorical"){p=Jt,f=Object.create(null);for(const w of i.stops)f[w[0]]=w[1];y=typeof i.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);p=ec}if(o){const w={},I=[];for(let B=0;B<i.stops.length;B++){const R=i.stops[B],X=R[0].zoom;w[X]===void 0&&(w[X]={zoom:X,type:i.type,property:i.property,default:i.default,stops:[]},I.push(X)),w[X].stops.push([R[0].value,R[1]])}const T=[];for(const B of I)T.push([w[B].zoom,Zo(w[B],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:Wi.interpolationFactor.bind(void 0,M),zoomStops:T.map(B=>B[0]),evaluate:({zoom:B},R)=>Ga({stops:T,base:i.base},e,B).evaluate(B,R)}}if(l){const w=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Wi.interpolationFactor.bind(void 0,w),zoomStops:i.stops.map(I=>I[0]),evaluate:({zoom:I})=>p(i,e,I,f,y)}}return{kind:"source",evaluate(w,I){const T=I&&I.properties?I.properties[i.property]:void 0;return T===void 0?Nt(i.default,e.default):p(i,e,T,f,y)}}}function Nt(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Jt(i,e,r,o,l){return Nt(typeof r===l?o[r]:void 0,i.default,e.default)}function Ho(i,e,r){if(lt(r)!=="number")return Nt(i.default,e.default);const o=i.stops.length;if(o===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[o-1][0])return i.stops[o-1][1];const l=Vo(i.stops.map(h=>h[0]),r);return i.stops[l][1]}function Ga(i,e,r){const o=i.base!==void 0?i.base:1;if(lt(r)!=="number")return Nt(i.default,e.default);const l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];const h=Vo(i.stops.map(I=>I[0]),r),p=function(I,T,M,B){const R=B-M,X=I-M;return R===0?0:T===1?X/R:(Math.pow(T,X)-1)/(Math.pow(T,R)-1)}(r,o,i.stops[h][0],i.stops[h+1][0]),f=i.stops[h][1],y=i.stops[h+1][1];let w=uo[e.type]||Dt;if(i.colorSpace&&i.colorSpace!=="rgb"){const I=Os[i.colorSpace];w=(T,M)=>I.reverse(I.interpolate(I.forward(T),I.forward(M),p))}return typeof f.evaluate=="function"?{evaluate(...I){const T=f.evaluate.apply(void 0,I),M=y.evaluate.apply(void 0,I);if(T!==void 0&&M!==void 0)return w(T,M,p)}}:w(f,y,p)}function ec(i,e,r){return e.type==="color"?r=z.parse(r):e.type==="formatted"?r=q.fromString(r.toString()):e.type==="resolvedImage"?r=Q.fromString(r.toString()):lt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Nt(r,i.default,e.default)}ct.register(On,{error:[{kind:"error"},[dt],(i,[e])=>{throw new ue(e.evaluate(i))}],typeof:[dt,[ht],(i,[e])=>Ft(ee(e.evaluate(i)))],"to-rgba":[ri(Me,4),[Mi],(i,[e])=>e.evaluate(i).toArray()],rgb:[Mi,[Me,Me,Me],$s],rgba:[Mi,[Me,Me,Me,Me],$s],has:{type:ut,overloads:[[[dt],(i,[e])=>Ns(e.evaluate(i),i.properties())],[[dt,mr],(i,[e,r])=>Ns(e.evaluate(i),r.evaluate(i))]]},get:{type:ht,overloads:[[[dt],(i,[e])=>ja(e.evaluate(i),i.properties())],[[dt,mr],(i,[e,r])=>ja(e.evaluate(i),r.evaluate(i))]]},"feature-state":[ht,[dt],(i,[e])=>ja(e.evaluate(i),i.featureState||{})],properties:[mr,[],i=>i.properties()],"geometry-type":[dt,[],i=>i.geometryType()],id:[ht,[],i=>i.id()],zoom:[Me,[],i=>i.globals.zoom],"heatmap-density":[Me,[],i=>i.globals.heatmapDensity||0],"line-progress":[Me,[],i=>i.globals.lineProgress||0],accumulated:[ht,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Me,gn(Me),(i,e)=>{let r=0;for(const o of e)r+=o.evaluate(i);return r}],"*":[Me,gn(Me),(i,e)=>{let r=1;for(const o of e)r*=o.evaluate(i);return r}],"-":{type:Me,overloads:[[[Me,Me],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Me],(i,[e])=>-e.evaluate(i)]]},"/":[Me,[Me,Me],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Me,[Me,Me],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Me,[],()=>Math.LN2],pi:[Me,[],()=>Math.PI],e:[Me,[],()=>Math.E],"^":[Me,[Me,Me],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Me,[Me],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Me,[Me],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Me,[Me],(i,[e])=>Math.log(e.evaluate(i))],log2:[Me,[Me],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Me,[Me],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Me,[Me],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Me,[Me],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Me,[Me],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Me,[Me],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Me,[Me],(i,[e])=>Math.atan(e.evaluate(i))],min:[Me,gn(Me),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Me,gn(Me),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Me,[Me],(i,[e])=>Math.abs(e.evaluate(i))],round:[Me,[Me],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Me,[Me],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Me,[Me],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ut,[dt,ht],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[ut,[ht],(i,[e])=>i.id()===e.value],"filter-type-==":[ut,[dt],(i,[e])=>i.geometryType()===e.value],"filter-<":[ut,[dt,ht],(i,[e,r])=>{const o=i.properties()[e.value],l=r.value;return typeof o==typeof l&&o<l}],"filter-id-<":[ut,[ht],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<o}],"filter->":[ut,[dt,ht],(i,[e,r])=>{const o=i.properties()[e.value],l=r.value;return typeof o==typeof l&&o>l}],"filter-id->":[ut,[ht],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>o}],"filter-<=":[ut,[dt,ht],(i,[e,r])=>{const o=i.properties()[e.value],l=r.value;return typeof o==typeof l&&o<=l}],"filter-id-<=":[ut,[ht],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<=o}],"filter->=":[ut,[dt,ht],(i,[e,r])=>{const o=i.properties()[e.value],l=r.value;return typeof o==typeof l&&o>=l}],"filter-id->=":[ut,[ht],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>=o}],"filter-has":[ut,[ht],(i,[e])=>e.value in i.properties()],"filter-has-id":[ut,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ut,[ri(dt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ut,[ri(ht)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ut,[dt,ri(ht)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ut,[dt,ri(ht)],(i,[e,r])=>function(o,l,h,p){for(;h<=p;){const f=h+p>>1;if(l[f]===o)return!0;l[f]>o?p=f-1:h=f+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ut,overloads:[[[ut,ut],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[gn(ut),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:ut,overloads:[[[ut,ut],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[gn(ut),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[ut,[ut],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ut,[dt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[dt,[dt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[dt,[dt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[dt,gn(ht),(i,e)=>e.map(r=>pe(r.evaluate(i))).join("")],"resolved-locale":[dt,[dn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Za{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new pt,this._defaultValue=r?function(o){return o.type==="color"&&Go(o.default)?new z(0,0,0,0):o.type==="color"?z.parse(o.default)||null:o.default===void 0?null:o.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,o,l,h,p){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,r,o,l,h,p){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null;try{const f=this.expression.evaluate(this._evaluator);if(f==null||typeof f=="number"&&f!=f)return this._defaultValue;if(this._enumValues&&!(f in this._enumValues))throw new ue(`Expected value to be one of ${Object.keys(this._enumValues).map(y=>JSON.stringify(y)).join(", ")}, but found ${JSON.stringify(f)} instead.`);return f}catch(f){return this._warningHistory[f.message]||(this._warningHistory[f.message]=!0,typeof console!="undefined"&&console.warn(f.message)),this._defaultValue}}}function Wo(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in On}function Xo(i,e){const r=new Oo(On,[],e?function(l){const h={color:Mi,string:dt,number:Me,enum:dt,boolean:ut,formatted:fr,resolvedImage:Gr};return l.type==="array"?ri(h[l.value]||ht,l.length):h[l.type]}(e):void 0),o=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?js(new Za(o,e)):yn(r.errors)}class Yo{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Rn(r.expression)}evaluateWithoutErrorHandling(e,r,o,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,l,h,p)}evaluate(e,r,o,l,h,p){return this._styleExpression.evaluate(e,r,o,l,h,p)}}class Ko{constructor(e,r,o,l){this.kind=e,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Rn(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,r,o,l,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,l,h,p)}evaluate(e,r,o,l,h,p){return this._styleExpression.evaluate(e,r,o,l,h,p)}interpolationFactor(e,r,o){return this.interpolationType?Wi.interpolationFactor(this.interpolationType,e,r,o):0}}function Ha(i,e){const r=Xo(i,e);if(r.result==="error")return r;const o=r.value.expression,l=Ro(o);if(!l&&!Vn(e))return yn([new Ci("","data expressions not supported")]);const h=so(o,["zoom"]);if(!h&&!qs(e))return yn([new Ci("","zoom expressions not supported")]);const p=Jo(o);return p||h?p instanceof Ci?yn([p]):p instanceof Wi&&!qa(e)?yn([new Ci("",'"interpolate" expressions cannot be used with this property')]):js(p?new Ko(l?"camera":"composite",r.value,p.labels,p instanceof Wi?p.interpolation:void 0):new Yo(l?"constant":"source",r.value)):yn([new Ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Un{constructor(e,r){this._parameters=e,this._specification=r,qr(this,Zo(this._parameters,this._specification))}static deserialize(e){return new Un(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Jo(i){let e=null;if(i instanceof No)e=Jo(i.result);else if(i instanceof $o){for(const r of i.args)if(e=Jo(r),e)break}else(i instanceof co||i instanceof Wi)&&i.input instanceof ct&&i.input.name==="zoom"&&(e=i);return e instanceof Ci||i.eachChild(r=>{const o=Jo(r);o instanceof Ci?e=o:!e&&o?e=new Ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Ci("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function _r(i){const e=i.key,r=i.value,o=i.valueSpec||{},l=i.objectElementValidators||{},h=i.style,p=i.styleSpec;let f=[];const y=lt(r);if(y!=="object")return[new De(e,r,`object expected, ${y} found`)];for(const w in r){const I=w.split(".")[0],T=o[I]||o["*"];let M;if(l[I])M=l[I];else if(o[I])M=Fi;else if(l["*"])M=l["*"];else{if(!o["*"]){f.push(new De(e,r[w],`unknown property "${w}"`));continue}M=Fi}f=f.concat(M({key:(e&&`${e}.`)+w,value:r[w],valueSpec:T,style:h,styleSpec:p,object:r,objectKey:w},r))}for(const w in o)l[w]||o[w].required&&o[w].default===void 0&&r[w]===void 0&&f.push(new De(e,r,`missing required property "${w}"`));return f}function Gs(i){const e=i.value,r=i.valueSpec,o=i.style,l=i.styleSpec,h=i.key,p=i.arrayElementValidator||Fi;if(lt(e)!=="array")return[new De(h,e,`array expected, ${lt(e)} found`)];if(r.length&&e.length!==r.length)return[new De(h,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new De(h,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let f={type:r.value,values:r.values};l.$version<7&&(f.function=r.function),lt(r.value)==="object"&&(f=r.value);let y=[];for(let w=0;w<e.length;w++)y=y.concat(p({array:e,arrayIndex:w,value:e[w],valueSpec:f,style:o,styleSpec:l,key:`${h}[${w}]`}));return y}function Zs(i){const e=i.key,r=i.value,o=i.valueSpec;let l=lt(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new De(e,r,`number expected, ${l} found`)]:"minimum"in o&&r<o.minimum?[new De(e,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new De(e,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function Hs(i){const e=i.valueSpec,r=Rt(i.value.type);let o,l,h,p={};const f=r!=="categorical"&&i.value.property===void 0,y=!f,w=lt(i.value.stops)==="array"&&lt(i.value.stops[0])==="array"&&lt(i.value.stops[0][0])==="object",I=_r({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(B){if(r==="identity")return[new De(B.key,B.value,'identity function may not have a "stops" property')];let R=[];const X=B.value;return R=R.concat(Gs({key:B.key,value:X,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:T})),lt(X)==="array"&&X.length===0&&R.push(new De(B.key,X,"array must have at least one stop")),R},default:function(B){return Fi({key:B.key,value:B.value,valueSpec:e,style:B.style,styleSpec:B.styleSpec})}}});return r==="identity"&&f&&I.push(new De(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||I.push(new De(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!qa(i.valueSpec)&&I.push(new De(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(y&&!Vn(i.valueSpec)?I.push(new De(i.key,i.value,"property functions not supported")):f&&!qs(i.valueSpec)&&I.push(new De(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!w||i.value.property!==void 0||I.push(new De(i.key,i.value,'"property" property is required')),I;function T(B){let R=[];const X=B.value,Y=B.key;if(lt(X)!=="array")return[new De(Y,X,`array expected, ${lt(X)} found`)];if(X.length!==2)return[new De(Y,X,`array length 2 expected, length ${X.length} found`)];if(w){if(lt(X[0])!=="object")return[new De(Y,X,`object expected, ${lt(X[0])} found`)];if(X[0].zoom===void 0)return[new De(Y,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new De(Y,X,"object stop key must have value")];if(h&&h>Rt(X[0].zoom))return[new De(Y,X[0].zoom,"stop zoom values must appear in ascending order")];Rt(X[0].zoom)!==h&&(h=Rt(X[0].zoom),l=void 0,p={}),R=R.concat(_r({key:`${Y}[0]`,value:X[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Zs,value:M}}))}else R=R.concat(M({key:`${Y}[0]`,value:X[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},X));return Wo(rr(X[1]))?R.concat([new De(`${Y}[1]`,X[1],"expressions are not allowed in function stops.")]):R.concat(Fi({key:`${Y}[1]`,value:X[1],valueSpec:e,style:B.style,styleSpec:B.styleSpec}))}function M(B,R){const X=lt(B.value),Y=Rt(B.value),oe=B.value!==null?B.value:R;if(o){if(X!==o)return[new De(B.key,oe,`${X} stop domain type must match previous stop domain type ${o}`)]}else o=X;if(X!=="number"&&X!=="string"&&X!=="boolean")return[new De(B.key,oe,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&r!=="categorical"){let ce=`number expected, ${X} found`;return Vn(e)&&r===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(B.key,oe,ce)]}return r!=="categorical"||X!=="number"||isFinite(Y)&&Math.floor(Y)===Y?r!=="categorical"&&X==="number"&&l!==void 0&&Y<l?[new De(B.key,oe,"stop domain values must appear in ascending order")]:(l=Y,r==="categorical"&&Y in p?[new De(B.key,oe,"stop domain values must be unique")]:(p[Y]=!0,[])):[new De(B.key,oe,`integer expected, found ${Y}`)]}}function $n(i){const e=(i.expressionContext==="property"?Ha:Xo)(rr(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new De(`${i.key}${o.key}`,i.value,o.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new De(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Rn(r))return[new De(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Rn(r))return[new De(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!so(r,["zoom","feature-state"]))return[new De(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ro(r))return[new De(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Qo(i){const e=i.key,r=i.value,o=i.valueSpec,l=[];return Array.isArray(o.values)?o.values.indexOf(Rt(r))===-1&&l.push(new De(e,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(Rt(r))===-1&&l.push(new De(e,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function Wa(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Wa(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Ws={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ea(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Wa(i)||(i=mo(i));const e=Xo(i,Ws);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,o,l)=>e.value.evaluate(r,o,{},l),needGeometry:Xs(i)}}function ta(i,e){return i<e?-1:i>e?1:0}function Xs(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Xs(i[e]))return!0;return!1}function mo(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Xa(i[1],i[2],"=="):e==="!="?Nn(Xa(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Xa(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(mo))):e==="all"?["all"].concat(i.slice(1).map(mo)):e==="none"?["all"].concat(i.slice(1).map(mo).map(Nn)):e==="in"?ia(i[1],i.slice(2)):e==="!in"?Nn(ia(i[1],i.slice(2))):e==="has"?ra(i[1]):e==="!has"?Nn(ra(i[1])):e!=="within"||i;var r}function Xa(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function ia(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(ta)]]:["filter-in-small",i,["literal",e]]}}function ra(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Nn(i){return["!",i]}function fo(i){return Wa(rr(i.value))?$n(qr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ys(i)}function Ys(i){const e=i.value,r=i.key;if(lt(e)!=="array")return[new De(r,e,`array expected, ${lt(e)} found`)];const o=i.styleSpec;let l,h=[];if(e.length<1)return[new De(r,e,"filter array must have at least 1 element")];switch(h=h.concat(Qo({key:`${r}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),Rt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Rt(e[1])==="$type"&&h.push(new De(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new De(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=lt(e[1]),l!=="string"&&h.push(new De(`${r}[1]`,e[1],`string expected, ${l} found`)));for(let p=2;p<e.length;p++)l=lt(e[p]),Rt(e[1])==="$type"?h=h.concat(Qo({key:`${r}[${p}]`,value:e[p],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&h.push(new De(`${r}[${p}]`,e[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)h=h.concat(Ys({key:`${r}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=lt(e[1]),e.length!==2?h.push(new De(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&h.push(new De(`${r}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=lt(e[1]),e.length!==2?h.push(new De(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&h.push(new De(`${r}[1]`,e[1],`object expected, ${l} found`))}return h}function go(i,e){const r=i.key,o=i.style,l=i.styleSpec,h=i.value,p=i.objectKey,f=l[`${e}_${i.layerType}`];if(!f)return[];const y=p.match(/^(.*)-transition$/);if(e==="paint"&&y&&f[y[1]]&&f[y[1]].transition)return Fi({key:r,value:h,valueSpec:l.transition,style:o,styleSpec:l});const w=i.valueSpec||f[p];if(!w)return[new De(r,h,`unknown property "${p}"`)];let I;if(lt(h)==="string"&&Vn(w)&&!w.tokens&&(I=/^{([^}]+)}$/.exec(h)))return[new De(r,h,`"${p}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const T=[];return i.layerType==="symbol"&&(p==="text-field"&&o&&!o.glyphs&&T.push(new De(r,h,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&Go(rr(h))&&Rt(h.type)==="identity"&&T.push(new De(r,h,'"text-font" does not support identity functions'))),T.concat(Fi({key:i.key,value:h,valueSpec:w,style:o,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:p}))}function Ks(i){return go(i,"paint")}function Js(i){return go(i,"layout")}function Qs(i){let e=[];const r=i.value,o=i.key,l=i.style,h=i.styleSpec;r.type||r.ref||e.push(new De(o,r,'either "type" or "ref" is required'));let p=Rt(r.type);const f=Rt(r.ref);if(r.id){const y=Rt(r.id);for(let w=0;w<i.arrayIndex;w++){const I=l.layers[w];Rt(I.id)===y&&e.push(new De(o,r.id,`duplicate layer id "${r.id}", previously used at line ${I.id.__line__}`))}}if("ref"in r){let y;["type","source","source-layer","filter","layout"].forEach(w=>{w in r&&e.push(new De(o,r[w],`"${w}" is prohibited for ref layers`))}),l.layers.forEach(w=>{Rt(w.id)===f&&(y=w)}),y?y.ref?e.push(new De(o,r.ref,"ref cannot reference another ref layer")):p=Rt(y.type):e.push(new De(o,r.ref,`ref layer "${f}" not found`))}else if(p!=="background")if(r.source){const y=l.sources&&l.sources[r.source],w=y&&Rt(y.type);y?w==="vector"&&p==="raster"?e.push(new De(o,r.source,`layer "${r.id}" requires a raster source`)):w==="raster"&&p!=="raster"?e.push(new De(o,r.source,`layer "${r.id}" requires a vector source`)):w!=="vector"||r["source-layer"]?w==="raster-dem"&&p!=="hillshade"?e.push(new De(o,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]||w==="geojson"&&y.lineMetrics||e.push(new De(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new De(o,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new De(o,r.source,`source "${r.source}" not found`))}else e.push(new De(o,r,'missing required property "source"'));return e=e.concat(_r({key:o,value:r,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Fi({key:`${o}.type`,value:r.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:fo,layout:y=>_r({layer:r,key:y.key,value:y.value,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":w=>Js(qr({layerType:p},w))}}),paint:y=>_r({layer:r,key:y.key,value:y.value,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":w=>Ks(qr({layerType:p},w))}})}})),e}function jn(i){const e=i.value,r=i.key,o=lt(e);return o!=="string"?[new De(r,e,`string expected, ${o} found`)]:[]}const el={promoteId:function({key:i,value:e}){if(lt(e)==="string")return jn({key:i,value:e});{const r=[];for(const o in e)r.push(...jn({key:`${i}.${o}`,value:e[o]}));return r}}};function yo(i){const e=i.value,r=i.key,o=i.styleSpec,l=i.style;if(!e.type)return[new De(r,e,'"type" is required')];const h=Rt(e.type);let p;switch(h){case"vector":case"raster":case"raster-dem":return p=_r({key:r,value:e,valueSpec:o[`source_${h.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:el}),p;case"geojson":if(p=_r({key:r,value:e,valueSpec:o.source_geojson,style:l,styleSpec:o,objectElementValidators:el}),e.cluster)for(const f in e.clusterProperties){const[y,w]=e.clusterProperties[f],I=typeof y=="string"?[y,["accumulated"],["get",f]]:y;p.push(...$n({key:`${r}.${f}.map`,value:w,expressionContext:"cluster-map"})),p.push(...$n({key:`${r}.${f}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return p;case"video":return _r({key:r,value:e,valueSpec:o.source_video,style:l,styleSpec:o});case"image":return _r({key:r,value:e,valueSpec:o.source_image,style:l,styleSpec:o});case"canvas":return[new De(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qo({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,styleSpec:o})}}function _o(i){const e=i.value,r=i.styleSpec,o=r.light,l=i.style;let h=[];const p=lt(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new De("light",e,`object expected, ${p} found`)]),h;for(const f in e){const y=f.match(/^(.*)-transition$/);h=h.concat(y&&o[y[1]]&&o[y[1]].transition?Fi({key:f,value:e[f],valueSpec:r.transition,style:l,styleSpec:r}):o[f]?Fi({key:f,value:e[f],valueSpec:o[f],style:l,styleSpec:r}):[new De(f,e[f],`unknown property "${f}"`)])}return h}const Xi={"*":()=>[],array:Gs,boolean:function(i){const e=i.value,r=i.key,o=lt(e);return o!=="boolean"?[new De(r,e,`boolean expected, ${o} found`)]:[]},number:Zs,color:function(i){const e=i.key,r=i.value,o=lt(r);return o!=="string"?[new De(e,r,`color expected, ${o} found`)]:yr(r)===null?[new De(e,r,`color expected, "${r}" found`)]:[]},constants:hn,enum:Qo,filter:fo,function:Hs,layer:Qs,object:_r,source:yo,light:_o,string:jn,formatted:function(i){return jn(i).length===0?[]:$n(i)},resolvedImage:function(i){return jn(i).length===0?[]:$n(i)}};function Fi(i){const e=i.value,r=i.valueSpec,o=i.styleSpec;return r.expression&&Go(Rt(e))?Hs(i):r.expression&&Wo(rr(e))?$n(i):r.type&&Xi[r.type]?Xi[r.type](i):_r(qr({},i,{valueSpec:r.type?o[r.type]:r}))}function tc(i){const e=i.value,r=i.key,o=jn(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new De(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new De(r,e,'"glyphs" url must include a "{range}" token'))),o}function _n(i,e=fe){let r=[];return r=r.concat(Fi({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:tc,"*":()=>[]}})),i.constants&&(r=r.concat(hn({key:"constants",value:i.constants,style:i,styleSpec:e}))),tl(r)}function tl(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function qn(i){return function(...e){return tl(i.apply(this,e))}}_n.source=qn(yo),_n.light=qn(_o),_n.layer=qn(Qs),_n.filter=qn(fo),_n.paintProperty=qn(Ks),_n.layoutProperty=qn(Js);const xn=_n,ic=xn.light,Ya=xn.paintProperty,rc=xn.layoutProperty;function il(i,e){let r=!1;if(e&&e.length)for(const o of e)i.fire(new un(new Error(o.message))),r=!0;return r}class bn{constructor(e,r,o){const l=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(r=p[1])+2*(o=p[2]);for(let y=0;y<this.d*this.d;y++){const w=p[3+y],I=p[3+y+1];l.push(w===I?null:p.subarray(w,I))}const f=p[3+l.length+1];this.keys=p.subarray(p[3+l.length],f),this.bboxes=p.subarray(f),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let p=0;p<this.d*this.d;p++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=o,this.scale=r/e,this.uid=0;const h=o/r*e;this.min=-h,this.max=e+h}insert(e,r,o,l,h){this._forEachCell(r,o,l,h,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(h)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,o,l,h,p){this.cells[h].push(p)}query(e,r,o,l,h){const p=this.min,f=this.max;if(e<=p&&r<=p&&f<=o&&f<=l&&!h)return Array.prototype.slice.call(this.keys);{const y=[];return this._forEachCell(e,r,o,l,this._queryCell,y,{},h),y}}_queryCell(e,r,o,l,h,p,f,y){const w=this.cells[h];if(w!==null){const I=this.keys,T=this.bboxes;for(let M=0;M<w.length;M++){const B=w[M];if(f[B]===void 0){const R=4*B;(y?y(T[R+0],T[R+1],T[R+2],T[R+3]):e<=T[R+2]&&r<=T[R+3]&&o>=T[R+0]&&l>=T[R+1])?(f[B]=!0,p.push(I[B])):f[B]=!1}}}}_forEachCell(e,r,o,l,h,p,f,y){const w=this._convertToCellCoord(e),I=this._convertToCellCoord(r),T=this._convertToCellCoord(o),M=this._convertToCellCoord(l);for(let B=w;B<=T;B++)for(let R=I;R<=M;R++){const X=this.d*R+B;if((!y||y(this._convertFromCellCoord(B),this._convertFromCellCoord(R),this._convertFromCellCoord(B+1),this._convertFromCellCoord(R+1)))&&h.call(this,e,r,o,l,X,p,f,y))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let o=0;for(let p=0;p<this.cells.length;p++)o+=this.cells[p].length;const l=new Int32Array(r+o+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let h=r;for(let p=0;p<e.length;p++){const f=e[p];l[3+p]=h,l.set(f,h),h+=f.length}return l[3+e.length]=h,l.set(this.keys,h),h+=this.keys.length,l[3+e.length+1]=h,l.set(this.bboxes,h),h+=this.bboxes.length,l.buffer}static serialize(e,r){const o=e.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(e){return new bn(e.buffer)}}const Gn={};function $e(i,e,r={}){Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Gn[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}$e("Object",Object),$e("TransferableGridIndex",bn),$e("Color",z),$e("Error",Error),$e("AJAXError",mi),$e("ResolvedImage",Q),$e("StylePropertyFunction",Un),$e("StyleExpression",Za,{omit:["_evaluator"]}),$e("ZoomDependentExpression",Ko),$e("ZoomConstantExpression",Yo),$e("CompoundExpression",ct,{omit:["_evaluate"]});for(const i in On)On[i]._classRegistryKey||$e(`Expression_${i}`,On[i]);function Ka(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function xo(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Ka(i)||Hi(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const o of i)r.push(xo(o,e));return r}if(typeof i=="object"){const r=i.constructor,o=r._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");const l=r.serialize?r.serialize(i,e):{};if(!r.serialize){for(const h in i){if(!i.hasOwnProperty(h)||Gn[o].omit.indexOf(h)>=0)continue;const p=i[h];l[h]=Gn[o].shallow.indexOf(h)>=0?p:xo(p,e)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(l.$name=o),l}throw new Error("can't serialize object of type "+typeof i)}function vn(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Ka(i)||Hi(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(vn);if(typeof i=="object"){const e=i.$name||"Object";if(!Gn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Gn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const o=Object.create(r.prototype);for(const l of Object.keys(i)){if(l==="$name")continue;const h=i[l];o[l]=Gn[e].shallow.indexOf(l)>=0?h:vn(h)}return o}throw new Error("can't deserialize object of type "+typeof i)}class bo{constructor(){this.first=!0}update(e,r){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const Pe={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Ja(i){for(const e of i)if(vo(e.charCodeAt(0)))return!0;return!1}function rl(i){for(const e of i)if(!nc(e.charCodeAt(0)))return!1;return!0}function nc(i){return!(Pe.Arabic(i)||Pe["Arabic Supplement"](i)||Pe["Arabic Extended-A"](i)||Pe["Arabic Presentation Forms-A"](i)||Pe["Arabic Presentation Forms-B"](i))}function vo(i){return!(i!==746&&i!==747&&(i<4352||!(Pe["Bopomofo Extended"](i)||Pe.Bopomofo(i)||Pe["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Pe["CJK Compatibility Ideographs"](i)||Pe["CJK Compatibility"](i)||Pe["CJK Radicals Supplement"](i)||Pe["CJK Strokes"](i)||!(!Pe["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Pe["CJK Unified Ideographs Extension A"](i)||Pe["CJK Unified Ideographs"](i)||Pe["Enclosed CJK Letters and Months"](i)||Pe["Hangul Compatibility Jamo"](i)||Pe["Hangul Jamo Extended-A"](i)||Pe["Hangul Jamo Extended-B"](i)||Pe["Hangul Jamo"](i)||Pe["Hangul Syllables"](i)||Pe.Hiragana(i)||Pe["Ideographic Description Characters"](i)||Pe.Kanbun(i)||Pe["Kangxi Radicals"](i)||Pe["Katakana Phonetic Extensions"](i)||Pe.Katakana(i)&&i!==12540||!(!Pe["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Pe["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Pe["Unified Canadian Aboriginal Syllabics"](i)||Pe["Unified Canadian Aboriginal Syllabics Extended"](i)||Pe["Vertical Forms"](i)||Pe["Yijing Hexagram Symbols"](i)||Pe["Yi Syllables"](i)||Pe["Yi Radicals"](i))))}function nl(i){return!(vo(i)||function(e){return!!(Pe["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Pe["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Pe["Letterlike Symbols"](e)||Pe["Number Forms"](e)||Pe["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Pe["Control Pictures"](e)&&e!==9251||Pe["Optical Character Recognition"](e)||Pe["Enclosed Alphanumerics"](e)||Pe["Geometric Shapes"](e)||Pe["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Pe["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Pe["CJK Symbols and Punctuation"](e)||Pe.Katakana(e)||Pe["Private Use Area"](e)||Pe["CJK Compatibility Forms"](e)||Pe["Small Form Variants"](e)||Pe["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function ol(i){return i>=1424&&i<=2303||Pe["Arabic Presentation Forms-A"](i)||Pe["Arabic Presentation Forms-B"](i)}function oc(i,e){return!(!e&&ol(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Pe.Khmer(i))}function ac(i){for(const e of i)if(ol(e.charCodeAt(0)))return!0;return!1}const na="deferred",Qa="loading",es="loaded";let ts=null,Oi="unavailable",tn=null;const al=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Oi="error"),ts&&ts(i)};function is(){Zn.fire(new en("pluginStateChange",{pluginStatus:Oi,pluginURL:tn}))}const Zn=new oo,rs=function(){return Oi},oa=function(){if(Oi!==na||!tn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Oi=Qa,is(),tn&&Ir({url:tn},i=>{i?al(i):(Oi=es,is())})},or={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Oi===es||or.applyArabicShaping!=null,isLoading:()=>Oi===Qa,setState(i){Oi=i.pluginStatus,tn=i.pluginURL},isParsed:()=>or.applyArabicShaping!=null&&or.processBidirectionalText!=null&&or.processStyledBidirectionalText!=null,getPluginURL:()=>tn};class jt{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new bo,this.transition={})}isSupportedScript(e){return function(r,o){for(const l of r)if(!oc(l.charCodeAt(0),o))return!1;return!0}(e,or.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}class aa{constructor(e,r){this.property=e,this.value=r,this.expression=function(o,l){if(Go(o))return new Un(o,l);if(Wo(o)){const h=Ha(o,l);if(h.result==="error")throw new Error(h.value.map(p=>`${p.key}: ${p.message}`).join(", "));return h.value}{let h=o;return typeof o=="string"&&l.type==="color"&&(h=z.parse(o)),{kind:"constant",evaluate:()=>h}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,o){return this.property.possiblyEvaluate(this,e,r,o)}}class sa{constructor(e){this.property=e,this.value=new aa(e,void 0)}transitioned(e,r){return new sl(this.property,this.value,r,de({},e.transition,this.transition),e.now)}untransitioned(){return new sl(this.property,this.value,null,{},0)}}class ns{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return mt(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new sa(this._values[e].property)),this._values[e].value=new aa(this._values[e].property,r===null?void 0:mt(r))}getTransition(e){return mt(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new sa(this._values[e].property)),this._values[e].transition=mt(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o);const l=this.getTransition(r);l!==void 0&&(e[`${r}-transition`]=l)}return e}transitioned(e,r){const o=new ll(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].transitioned(e,r._values[l]);return o}untransitioned(){const e=new ll(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class sl{constructor(e,r,o,l,h){this.property=e,this.value=r,this.begin=h+l.delay||0,this.end=this.begin+l.duration||0,e.specification.transition&&(l.delay||l.duration)&&(this.prior=o)}possiblyEvaluate(e,r,o){const l=e.now||0,h=this.value.possiblyEvaluate(e,r,o),p=this.prior;if(p){if(l>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(l<this.begin)return p.possiblyEvaluate(e,r,o);{const f=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,o),h,function(y){if(y<=0)return 0;if(y>=1)return 1;const w=y*y,I=w*y;return 4*(y<.5?I:3*(y-w)+I-.75)}(f))}}return h}}class ll{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,o){const l=new la(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,o);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class sc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return mt(this._values[e].value)}setValue(e,r){this._values[e]=new aa(this._values[e].property,r===null?void 0:mt(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o)}return e}possiblyEvaluate(e,r,o){const l=new la(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,r,o);return l}}class kr{constructor(e,r,o){this.property=e,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,o,l){return this.property.evaluate(this.value,this.parameters,e,r,o,l)}}class la{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ze{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,o){const l=uo[this.specification.type];return l?l(e,r,o):e}}class Qe{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,o,l){return new kr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},o,l)}:e.expression,r)}interpolate(e,r,o){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new kr(this,{kind:"constant",value:void 0},e.parameters);const l=uo[this.specification.type];return l?new kr(this,{kind:"constant",value:l(e.value.value,r.value.value,o)},e.parameters):e}evaluate(e,r,o,l,h,p){return e.kind==="constant"?e.value:e.evaluate(r,o,l,h,p)}}class wo extends Qe{possiblyEvaluate(e,r,o,l){if(e.value===void 0)return new kr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const h=e.expression.evaluate(r,null,{},o,l),p=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,f=this._calculate(p,p,p,r);return new kr(this,{kind:"constant",value:f},r)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new kr(this,{kind:"constant",value:h},r)}return new kr(this,e.expression,r)}evaluate(e,r,o,l,h,p){if(e.kind==="source"){const f=e.evaluate(r,o,l,h,p);return this._calculate(f,f,f,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},o,l),e.evaluate({zoom:Math.floor(r.zoom)},o,l),e.evaluate({zoom:Math.floor(r.zoom)+1},o,l),r):e.value}_calculate(e,r,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class Ao{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(r,null,{},o,l);return this._calculate(h,h,h,r)}return this._calculate(e.expression.evaluate(new jt(Math.floor(r.zoom-1),r)),e.expression.evaluate(new jt(Math.floor(r.zoom),r)),e.expression.evaluate(new jt(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class os{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,l){return!!e.expression.evaluate(r,null,{},o,l)}interpolate(){return!1}}class hi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const o=e[r];o.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new aa(o,void 0),h=this.defaultTransitionablePropertyValues[r]=new sa(o);this.defaultTransitioningPropertyValues[r]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}$e("DataDrivenProperty",Qe),$e("DataConstantProperty",Ze),$e("CrossFadedDataDrivenProperty",wo),$e("CrossFadedProperty",Ao),$e("ColorRampProperty",os);const wn="-transition";class Vi extends oo{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new sc(r.layout)),r.paint)){this._transitionablePaint=new ns(r.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new la(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,o={}){r!=null&&this._validate(rc,`layers.${this.id}.layout.${e}`,e,r,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(wn)?this._transitionablePaint.getTransition(e.slice(0,-wn.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,o={}){if(r!=null&&this._validate(Ya,`layers.${this.id}.paint.${e}`,e,r,o))return!1;if(e.endsWith(wn))return this._transitionablePaint.setTransition(e.slice(0,-wn.length),r||void 0),!1;{const l=this._transitionablePaint._values[e],h=l.property.specification["property-type"]==="cross-faded-data-driven",p=l.value.isDataDriven(),f=l.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value;return y.isDataDriven()||p||h||this._handleOverridablePaintPropertyUpdate(e,f,y)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ct(e,(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}_validate(e,r,o,l,h={}){return(!h||h.validate!==!1)&&il(this,e.call(xn,{key:r,layerType:this.type,objectKey:o,value:l,styleSpec:fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof kr&&Vn(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const lc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Eo{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class $t{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function pi(i,e=1){let r=0,o=0;return{members:i.map(l=>{const h=lc[l.type].BYTES_PER_ELEMENT,p=r=cl(r,Math.max(e,h)),f=l.components||1;return o=Math.max(o,h),r+=h*f,{name:l.name,type:l.type,components:f,offset:p}}),size:cl(r,Math.max(o,e)),alignment:e}}function cl(i,e){return Math.ceil(i/e)*e}class Hn extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const l=2*e;return this.int16[l+0]=r,this.int16[l+1]=o,e}}Hn.prototype.bytesPerElement=4,$e("StructArrayLayout2i4",Hn);class So extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,o,l)}emplace(e,r,o,l,h){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=o,this.int16[p+2]=l,this.int16[p+3]=h,e}}So.prototype.bytesPerElement=8,$e("StructArrayLayout4i8",So);class c extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,l,h,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,o,l,h,p)}emplace(e,r,o,l,h,p,f){const y=6*e;return this.int16[y+0]=r,this.int16[y+1]=o,this.int16[y+2]=l,this.int16[y+3]=h,this.int16[y+4]=p,this.int16[y+5]=f,e}}c.prototype.bytesPerElement=12,$e("StructArrayLayout2i4i12",c);class t extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,l,h,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,o,l,h,p)}emplace(e,r,o,l,h,p,f){const y=4*e,w=8*e;return this.int16[y+0]=r,this.int16[y+1]=o,this.uint8[w+4]=l,this.uint8[w+5]=h,this.uint8[w+6]=p,this.uint8[w+7]=f,e}}t.prototype.bytesPerElement=8,$e("StructArrayLayout2i4ub8",t);class n extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const l=2*e;return this.float32[l+0]=r,this.float32[l+1]=o,e}}n.prototype.bytesPerElement=8,$e("StructArrayLayout2f8",n);class s extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,l,h,p,f,y,w,I){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,o,l,h,p,f,y,w,I)}emplace(e,r,o,l,h,p,f,y,w,I,T){const M=10*e;return this.uint16[M+0]=r,this.uint16[M+1]=o,this.uint16[M+2]=l,this.uint16[M+3]=h,this.uint16[M+4]=p,this.uint16[M+5]=f,this.uint16[M+6]=y,this.uint16[M+7]=w,this.uint16[M+8]=I,this.uint16[M+9]=T,e}}s.prototype.bytesPerElement=20,$e("StructArrayLayout10ui20",s);class u extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,l,h,p,f,y,w,I,T,M){const B=this.length;return this.resize(B+1),this.emplace(B,e,r,o,l,h,p,f,y,w,I,T,M)}emplace(e,r,o,l,h,p,f,y,w,I,T,M,B){const R=12*e;return this.int16[R+0]=r,this.int16[R+1]=o,this.int16[R+2]=l,this.int16[R+3]=h,this.uint16[R+4]=p,this.uint16[R+5]=f,this.uint16[R+6]=y,this.uint16[R+7]=w,this.int16[R+8]=I,this.int16[R+9]=T,this.int16[R+10]=M,this.int16[R+11]=B,e}}u.prototype.bytesPerElement=24,$e("StructArrayLayout4i4ui4i24",u);class d extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,o)}emplace(e,r,o,l){const h=3*e;return this.float32[h+0]=r,this.float32[h+1]=o,this.float32[h+2]=l,e}}d.prototype.bytesPerElement=12,$e("StructArrayLayout3f12",d);class g extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}g.prototype.bytesPerElement=4,$e("StructArrayLayout1ul4",g);class x extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,l,h,p,f,y,w){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,o,l,h,p,f,y,w)}emplace(e,r,o,l,h,p,f,y,w,I){const T=10*e,M=5*e;return this.int16[T+0]=r,this.int16[T+1]=o,this.int16[T+2]=l,this.int16[T+3]=h,this.int16[T+4]=p,this.int16[T+5]=f,this.uint32[M+3]=y,this.uint16[T+8]=w,this.uint16[T+9]=I,e}}x.prototype.bytesPerElement=20,$e("StructArrayLayout6i1ul2ui20",x);class v extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,l,h,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,o,l,h,p)}emplace(e,r,o,l,h,p,f){const y=6*e;return this.int16[y+0]=r,this.int16[y+1]=o,this.int16[y+2]=l,this.int16[y+3]=h,this.int16[y+4]=p,this.int16[y+5]=f,e}}v.prototype.bytesPerElement=12,$e("StructArrayLayout2i2i2i12",v);class S extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,o,l,h)}emplace(e,r,o,l,h,p){const f=4*e,y=8*e;return this.float32[f+0]=r,this.float32[f+1]=o,this.float32[f+2]=l,this.int16[y+6]=h,this.int16[y+7]=p,e}}S.prototype.bytesPerElement=16,$e("StructArrayLayout2f1f2i16",S);class C extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,o,l)}emplace(e,r,o,l,h){const p=12*e,f=3*e;return this.uint8[p+0]=r,this.uint8[p+1]=o,this.float32[f+1]=l,this.float32[f+2]=h,e}}C.prototype.bytesPerElement=12,$e("StructArrayLayout2ub2f12",C);class L extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,o)}emplace(e,r,o,l){const h=3*e;return this.uint16[h+0]=r,this.uint16[h+1]=o,this.uint16[h+2]=l,e}}L.prototype.bytesPerElement=6,$e("StructArrayLayout3ui6",L);class O extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,l,h,p,f,y,w,I,T,M,B,R,X,Y,oe){const ce=this.length;return this.resize(ce+1),this.emplace(ce,e,r,o,l,h,p,f,y,w,I,T,M,B,R,X,Y,oe)}emplace(e,r,o,l,h,p,f,y,w,I,T,M,B,R,X,Y,oe,ce){const le=24*e,ge=12*e,Ae=48*e;return this.int16[le+0]=r,this.int16[le+1]=o,this.uint16[le+2]=l,this.uint16[le+3]=h,this.uint32[ge+2]=p,this.uint32[ge+3]=f,this.uint32[ge+4]=y,this.uint16[le+10]=w,this.uint16[le+11]=I,this.uint16[le+12]=T,this.float32[ge+7]=M,this.float32[ge+8]=B,this.uint8[Ae+36]=R,this.uint8[Ae+37]=X,this.uint8[Ae+38]=Y,this.uint32[ge+10]=oe,this.int16[le+22]=ce,e}}O.prototype.bytesPerElement=48,$e("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",O);class H extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,l,h,p,f,y,w,I,T,M,B,R,X,Y,oe,ce,le,ge,Ae,xe,Ne,Xe,Be,Re,ke,Ue){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,e,r,o,l,h,p,f,y,w,I,T,M,B,R,X,Y,oe,ce,le,ge,Ae,xe,Ne,Xe,Be,Re,ke,Ue)}emplace(e,r,o,l,h,p,f,y,w,I,T,M,B,R,X,Y,oe,ce,le,ge,Ae,xe,Ne,Xe,Be,Re,ke,Ue,Fe){const ze=34*e,et=17*e;return this.int16[ze+0]=r,this.int16[ze+1]=o,this.int16[ze+2]=l,this.int16[ze+3]=h,this.int16[ze+4]=p,this.int16[ze+5]=f,this.int16[ze+6]=y,this.int16[ze+7]=w,this.uint16[ze+8]=I,this.uint16[ze+9]=T,this.uint16[ze+10]=M,this.uint16[ze+11]=B,this.uint16[ze+12]=R,this.uint16[ze+13]=X,this.uint16[ze+14]=Y,this.uint16[ze+15]=oe,this.uint16[ze+16]=ce,this.uint16[ze+17]=le,this.uint16[ze+18]=ge,this.uint16[ze+19]=Ae,this.uint16[ze+20]=xe,this.uint16[ze+21]=Ne,this.uint16[ze+22]=Xe,this.uint32[et+12]=Be,this.float32[et+13]=Re,this.float32[et+14]=ke,this.float32[et+15]=Ue,this.float32[et+16]=Fe,e}}H.prototype.bytesPerElement=68,$e("StructArrayLayout8i15ui1ul4f68",H);class V extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}V.prototype.bytesPerElement=4,$e("StructArrayLayout1f4",V);class Z extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,o)}emplace(e,r,o,l){const h=3*e;return this.int16[h+0]=r,this.int16[h+1]=o,this.int16[h+2]=l,e}}Z.prototype.bytesPerElement=6,$e("StructArrayLayout3i6",Z);class te extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,o)}emplace(e,r,o,l){const h=4*e;return this.uint32[2*e+0]=r,this.uint16[h+2]=o,this.uint16[h+3]=l,e}}te.prototype.bytesPerElement=8,$e("StructArrayLayout1ul2ui8",te);class ie extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const l=2*e;return this.uint16[l+0]=r,this.uint16[l+1]=o,e}}ie.prototype.bytesPerElement=4,$e("StructArrayLayout2ui4",ie);class ae extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}ae.prototype.bytesPerElement=2,$e("StructArrayLayout1ui2",ae);class re extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,o,l)}emplace(e,r,o,l,h){const p=4*e;return this.float32[p+0]=r,this.float32[p+1]=o,this.float32[p+2]=l,this.float32[p+3]=h,e}}re.prototype.bytesPerElement=16,$e("StructArrayLayout4f16",re);class _e extends Eo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Ve(this.anchorPointX,this.anchorPointY)}}_e.prototype.size=20;class he extends x{get(e){return new _e(this,e)}}$e("CollisionBoxArray",he);class me extends Eo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}me.prototype.size=48;class Se extends O{get(e){return new me(this,e)}}$e("PlacedSymbolArray",Se);class Te extends Eo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Te.prototype.size=68;class ye extends H{get(e){return new Te(this,e)}}$e("SymbolInstanceArray",ye);class qe extends V{getoffsetX(e){return this.float32[1*e+0]}}$e("GlyphOffsetArray",qe);class Le extends Z{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}$e("SymbolLineVertexArray",Le);class at extends Eo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}at.prototype.size=8;class wt extends te{get(e){return new at(this,e)}}$e("FeatureIndexArray",wt);class gt extends Hn{}class xt extends Hn{}class Yt extends c{}class st extends t{}class It extends n{}class Lt extends s{}class bi extends u{}class Yi extends d{}class ar extends g{}class sr extends v{}class rn extends C{}class Ui extends L{}class Cr extends ie{}const An=pi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ki}=An;class zt{constructor(e=[]){this.segments=e}prepareSegment(e,r,o,l){let h=this.segments[this.segments.length-1];return e>zt.MAX_VERTEX_ARRAY_LENGTH&&Ke(`Max vertices per segment is ${zt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>zt.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==l)&&(h={vertexOffset:r.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},l!==void 0&&(h.sortKey=l),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,o,l){return new zt([{vertexOffset:e,primitiveOffset:r,vertexLength:o,primitiveLength:l,vaos:{},sortKey:0}])}}function Mt(i,e){return 256*(i=j(Math.floor(i),0,255))+j(Math.floor(e),0,255)}zt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$e("SegmentVector",zt);const oi=pi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Pi={exports:{}},qt={exports:{}};qt.exports=function(i,e){var r,o,l,h,p,f,y,w;for(o=i.length-(r=3&i.length),l=e,p=3432918353,f=461845907,w=0;w<o;)y=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24,++w,l=27492+(65535&(h=5*(65535&(l=(l^=y=(65535&(y=(y=(65535&y)*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*f+(((y>>>16)*f&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(y=0,r){case 3:y^=(255&i.charCodeAt(w+2))<<16;case 2:y^=(255&i.charCodeAt(w+1))<<8;case 1:l^=y=(65535&(y=(y=(65535&(y^=255&i.charCodeAt(w)))*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*f+(((y>>>16)*f&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var En={exports:{}};En.exports=function(i,e){for(var r,o=i.length,l=e^o,h=0;o>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(h)|(255&i.charCodeAt(++h))<<8|(255&i.charCodeAt(++h))<<16|(255&i.charCodeAt(++h))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),o-=4,++h;switch(o){case 3:l^=(255&i.charCodeAt(h+2))<<16;case 2:l^=(255&i.charCodeAt(h+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(h)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var Mr=qt.exports,ca=En.exports;Pi.exports=Mr,Pi.exports.murmur3=Mr,Pi.exports.murmur2=ca;var as=Pi.exports;class ua{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,o,l){this.ids.push(ul(e)),this.positions.push(r,o,l)}getPositions(e){const r=ul(e);let o=0,l=this.ids.length-1;for(;o<l;){const p=o+l>>1;this.ids[p]>=r?l=p:o=p+1}const h=[];for(;this.ids[o]===r;)h.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return h}static serialize(e,r){const o=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Sn(o,l,0,o.length-1),r&&r.push(o.buffer,l.buffer),{ids:o,positions:l}}static deserialize(e){const r=new ua;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function ul(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:as(String(i))}function Sn(i,e,r,o){for(;r<o;){const l=i[r+o>>1];let h=r-1,p=o+1;for(;;){do h++;while(i[h]<l);do p--;while(i[p]>l);if(h>=p)break;ha(i,h,p),ha(e,3*h,3*p),ha(e,3*h+1,3*p+1),ha(e,3*h+2,3*p+2)}p-r<o-p?(Sn(i,e,r,p),r=p+1):(Sn(i,e,p+1,o),o=p)}}function ha(i,e,r){const o=i[e];i[e]=i[r],i[r]=o}$e("FeaturePositionMap",ua);class Pr{constructor(e,r){this.gl=e.gl,this.location=r}}class Wn extends Pr{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class du extends Pr{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class mu extends Pr{constructor(e,r){super(e,r),this.current=z.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Bp=new Float32Array(16);function cc(i){return[Mt(255*i.r,255*i.g),Mt(255*i.b,255*i.a)]}class ss{constructor(e,r,o){this.value=e,this.uniformNames=r.map(l=>`u_${l}`),this.type=o}setUniform(e,r,o){e.set(o.constantOr(this.value))}getBinding(e,r,o){return this.type==="color"?new mu(e,r):new Wn(e,r)}}class pa{constructor(e,r){this.uniformNames=r.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,o,l){const h=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&e.set(h)}getBinding(e,r,o){return o.substr(0,9)==="u_pattern"?new du(e,r):new Wn(e,r)}}class In{constructor(e,r,o,l){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,r,o,l,h){const p=this.paintVertexArray.length,f=this.expression.evaluate(new jt(0),r,{},l,[],h);this.paintVertexArray.resize(e),this._setPaintValue(p,e,f)}updatePaintArray(e,r,o,l){const h=this.expression.evaluate({zoom:0},o,l);this._setPaintValue(e,r,h)}_setPaintValue(e,r,o){if(this.type==="color"){const l=cc(o);for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Zr{constructor(e,r,o,l,h,p){this.expression=e,this.uniformNames=r.map(f=>`u_${f}_t`),this.type=o,this.useIntegerZoom=l,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,o,l,h){const p=this.expression.evaluate(new jt(this.zoom),r,{},l,[],h),f=this.expression.evaluate(new jt(this.zoom+1),r,{},l,[],h),y=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(y,e,p,f)}updatePaintArray(e,r,o,l){const h=this.expression.evaluate({zoom:this.zoom},o,l),p=this.expression.evaluate({zoom:this.zoom+1},o,l);this._setPaintValue(e,r,h,p)}_setPaintValue(e,r,o,l){if(this.type==="color"){const h=cc(o),p=cc(l);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,h[0],h[1],p[0],p[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,o,l);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=j(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(l)}getBinding(e,r,o){return new Wn(e,r)}}class Xn{constructor(e,r,o,l,h,p){this.expression=e,this.type=r,this.useIntegerZoom=o,this.zoom=l,this.layerId=p,this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(e,r,o){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(e,r,o,l,h){this._setPaintValues(e,r,o.patterns&&o.patterns[this.layerId],h)}_setPaintValues(e,r,o,l){if(!l||!o)return;const{min:h,mid:p,max:f}=o,y=l[h],w=l[p],I=l[f];if(y&&w&&I)for(let T=e;T<r;T++)this.zoomInPaintVertexArray.emplace(T,w.tl[0],w.tl[1],w.br[0],w.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],w.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(T,w.tl[0],w.tl[1],w.br[0],w.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],w.pixelRatio,I.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,oi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,oi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class fu{constructor(e,r,o){this.binders={},this._buffers=[];const l=[];for(const h in e.paint._values){if(!o(h))continue;const p=e.paint.get(h);if(!(p instanceof kr&&Vn(p.property.specification)))continue;const f=Rp(h,e.type),y=p.value,w=p.property.specification.type,I=p.property.useIntegerZoom,T=p.property.specification["property-type"],M=T==="cross-faded"||T==="cross-faded-data-driven";if(y.kind==="constant")this.binders[h]=M?new pa(y.value,f):new ss(y.value,f,w),l.push(`/u_${h}`);else if(y.kind==="source"||M){const B=gu(h,w,"source");this.binders[h]=M?new Xn(y,w,I,r,B,e.id):new In(y,f,w,B),l.push(`/a_${h}`)}else{const B=gu(h,w,"composite");this.binders[h]=new Zr(y,f,w,I,r,B),l.push(`/z_${h}`)}}this.cacheKey=l.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof In||r instanceof Zr?r.maxValue:0}populatePaintArrays(e,r,o,l,h){for(const p in this.binders){const f=this.binders[p];(f instanceof In||f instanceof Zr||f instanceof Xn)&&f.populatePaintArray(e,r,o,l,h)}}setConstantPatternPositions(e,r){for(const o in this.binders){const l=this.binders[o];l instanceof pa&&l.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,o,l,h){let p=!1;for(const f in e){const y=r.getPositions(f);for(const w of y){const I=o.feature(w.index);for(const T in this.binders){const M=this.binders[T];if((M instanceof In||M instanceof Zr||M instanceof Xn)&&M.expression.isStateDependent===!0){const B=l.paint.get(T);M.expression=B.value,M.updatePaintArray(w.start,w.end,I,e[f],h),p=!0}}}}return p}defines(){const e=[];for(const r in this.binders){const o=this.binders[r];(o instanceof ss||o instanceof pa)&&e.push(...o.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof In||o instanceof Zr)for(let l=0;l<o.paintVertexAttributes.length;l++)e.push(o.paintVertexAttributes[l].name);else if(o instanceof Xn)for(let l=0;l<oi.members.length;l++)e.push(oi.members[l].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof ss||o instanceof pa||o instanceof Zr)for(const l of o.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const o=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof ss||h instanceof pa||h instanceof Zr){for(const p of h.uniformNames)if(r[p]){const f=h.getBinding(e,r[p],p);o.push({name:p,property:l,binding:f})}}}return o}setUniforms(e,r,o,l){for(const{name:h,property:p,binding:f}of r)this.binders[p].setUniform(f,l,o.get(p),h)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(e&&o instanceof Xn){const l=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(o instanceof In||o instanceof Zr)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const r in this.binders){const o=this.binders[r];(o instanceof In||o instanceof Zr||o instanceof Xn)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof In||r instanceof Zr||r instanceof Xn)&&r.destroy()}}}class Io{constructor(e,r,o=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new fu(l,r,o);this.needsUpload=!1,this._featureMap=new ua,this._bufferOffset=0}populatePaintArrays(e,r,o,l,h,p){for(const f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(e,r,l,h,p);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,o,l){for(const h of o)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,r,h,l)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Rp(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function gu(i,e,r){const o={color:{source:n,composite:re},number:{source:V,composite:n}},l=function(h){return{"line-pattern":{source:Lt,composite:Lt},"fill-pattern":{source:Lt,composite:Lt},"fill-extrusion-pattern":{source:Lt,composite:Lt}}[h]}(i);return l&&l[r]||o[e][r]}$e("ConstantBinder",ss),$e("CrossFadedConstantBinder",pa),$e("SourceExpressionBinder",In),$e("CrossFadedCompositeBinder",Xn),$e("CompositeExpressionBinder",Zr),$e("ProgramConfiguration",fu,{omit:["_buffers"]}),$e("ProgramConfigurationSet",Io);var di=8192;const uc=Math.pow(2,14)-1,yu=-uc-1;function zo(i){const e=di/i.extent,r=i.loadGeometry();for(let o=0;o<r.length;o++){const l=r[o];for(let h=0;h<l.length;h++){const p=l[h],f=Math.round(p.x*e),y=Math.round(p.y*e);p.x=j(f,yu,uc),p.y=j(y,yu,uc),(f<p.x||f>p.x+1||y<p.y||y>p.y+1)&&Ke("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function To(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?zo(i):[]}}function hl(i,e,r,o,l){i.emplaceBack(2*e+(o+1)/2,2*r+(l+1)/2)}class hc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new gt,this.indexArray=new Ui,this.segments=new zt,this.programConfigurations=new Io(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){const l=this.layers[0],h=[];let p=null,f=!1;l.type==="circle"&&(p=l.layout.get("circle-sort-key"),f=!p.isConstant());for(const{feature:y,id:w,index:I,sourceLayerIndex:T}of e){const M=this.layers[0]._featureFilter.needGeometry,B=To(y,M);if(!this.layers[0]._featureFilter.filter(new jt(this.zoom),B,o))continue;const R=f?p.evaluate(B,{},o):void 0,X={id:w,properties:y.properties,type:y.type,sourceLayerIndex:T,index:I,geometry:M?B.geometry:zo(y),patterns:{},sortKey:R};h.push(X)}f&&h.sort((y,w)=>y.sortKey-w.sortKey);for(const y of h){const{geometry:w,index:I,sourceLayerIndex:T}=y,M=e[I].feature;this.addFeature(y,w,I,o),r.featureIndex.insert(M,w,I,T,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ki),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,o,l){for(const h of r)for(const p of h){const f=p.x,y=p.y;if(f<0||f>=di||y<0||y>=di)continue;const w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),I=w.vertexLength;hl(this.layoutVertexArray,f,y,-1,-1),hl(this.layoutVertexArray,f,y,1,-1),hl(this.layoutVertexArray,f,y,1,1),hl(this.layoutVertexArray,f,y,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),w.vertexLength+=4,w.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},l)}}function _u(i,e){for(let r=0;r<i.length;r++)if(da(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(da(i,e[r]))return!0;return!!pc(i,e)}function Fp(i,e,r){return!!da(i,e)||!!dc(e,i,r)}function xu(i,e){if(i.length===1)return vu(e,i[0]);for(let r=0;r<e.length;r++){const o=e[r];for(let l=0;l<o.length;l++)if(da(i,o[l]))return!0}for(let r=0;r<i.length;r++)if(vu(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(pc(i,e[r]))return!0;return!1}function Op(i,e,r){if(i.length>1){if(pc(i,e))return!0;for(let o=0;o<e.length;o++)if(dc(e[o],i,r))return!0}for(let o=0;o<i.length;o++)if(dc(i[o],e,r))return!0;return!1}function pc(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const o=i[r],l=i[r+1];for(let h=0;h<e.length-1;h++)if(Vp(o,l,e[h],e[h+1]))return!0}return!1}function Vp(i,e,r,o){return Ie(i,r,o)!==Ie(e,r,o)&&Ie(i,e,r)!==Ie(i,e,o)}function dc(i,e,r){const o=r*r;if(e.length===1)return i.distSqr(e[0])<o;for(let l=1;l<e.length;l++)if(bu(i,e[l-1],e[l])<o)return!0;return!1}function bu(i,e,r){const o=e.distSqr(r);if(o===0)return i.distSqr(e);const l=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/o;return i.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function vu(i,e){let r,o,l,h=!1;for(let p=0;p<i.length;p++){r=i[p];for(let f=0,y=r.length-1;f<r.length;y=f++)o=r[f],l=r[y],o.y>e.y!=l.y>e.y&&e.x<(l.x-o.x)*(e.y-o.y)/(l.y-o.y)+o.x&&(h=!h)}return h}function da(i,e){let r=!1;for(let o=0,l=i.length-1;o<i.length;l=o++){const h=i[o],p=i[l];h.y>e.y!=p.y>e.y&&e.x<(p.x-h.x)*(e.y-h.y)/(p.y-h.y)+h.x&&(r=!r)}return r}function Up(i,e,r){const o=r[0],l=r[2];if(i.x<o.x&&e.x<o.x||i.x>l.x&&e.x>l.x||i.y<o.y&&e.y<o.y||i.y>l.y&&e.y>l.y)return!1;const h=Ie(i,e,r[0]);return h!==Ie(i,e,r[1])||h!==Ie(i,e,r[2])||h!==Ie(i,e,r[3])}function ls(i,e,r){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:r.programConfigurations.get(e.id).getMaxValue(i)}function pl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function dl(i,e,r,o,l){if(!e[0]&&!e[1])return i;const h=Ve.convert(e)._mult(l);r==="viewport"&&h._rotate(-o);const p=[];for(let f=0;f<i.length;f++)p.push(i[f].sub(h));return p}$e("CircleBucket",hc,{omit:["layers"]});const $p=new hi({"circle-sort-key":new Qe(fe.layout_circle["circle-sort-key"])});var Np={paint:new hi({"circle-radius":new Qe(fe.paint_circle["circle-radius"]),"circle-color":new Qe(fe.paint_circle["circle-color"]),"circle-blur":new Qe(fe.paint_circle["circle-blur"]),"circle-opacity":new Qe(fe.paint_circle["circle-opacity"]),"circle-translate":new Ze(fe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ze(fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ze(fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ze(fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Qe(fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Qe(fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Qe(fe.paint_circle["circle-stroke-opacity"])}),layout:$p},ma=typeof Float32Array!="undefined"?Float32Array:Array;function mc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function wu(i,e,r){var o=e[0],l=e[1],h=e[2],p=e[3],f=e[4],y=e[5],w=e[6],I=e[7],T=e[8],M=e[9],B=e[10],R=e[11],X=e[12],Y=e[13],oe=e[14],ce=e[15],le=r[0],ge=r[1],Ae=r[2],xe=r[3];return i[0]=le*o+ge*f+Ae*T+xe*X,i[1]=le*l+ge*y+Ae*M+xe*Y,i[2]=le*h+ge*w+Ae*B+xe*oe,i[3]=le*p+ge*I+Ae*R+xe*ce,i[4]=(le=r[4])*o+(ge=r[5])*f+(Ae=r[6])*T+(xe=r[7])*X,i[5]=le*l+ge*y+Ae*M+xe*Y,i[6]=le*h+ge*w+Ae*B+xe*oe,i[7]=le*p+ge*I+Ae*R+xe*ce,i[8]=(le=r[8])*o+(ge=r[9])*f+(Ae=r[10])*T+(xe=r[11])*X,i[9]=le*l+ge*y+Ae*M+xe*Y,i[10]=le*h+ge*w+Ae*B+xe*oe,i[11]=le*p+ge*I+Ae*R+xe*ce,i[12]=(le=r[12])*o+(ge=r[13])*f+(Ae=r[14])*T+(xe=r[15])*X,i[13]=le*l+ge*y+Ae*M+xe*Y,i[14]=le*h+ge*w+Ae*B+xe*oe,i[15]=le*p+ge*I+Ae*R+xe*ce,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var cs,jp=wu;function ml(i,e,r){var o=e[0],l=e[1],h=e[2],p=e[3];return i[0]=r[0]*o+r[4]*l+r[8]*h+r[12]*p,i[1]=r[1]*o+r[5]*l+r[9]*h+r[13]*p,i[2]=r[2]*o+r[6]*l+r[10]*h+r[14]*p,i[3]=r[3]*o+r[7]*l+r[11]*h+r[15]*p,i}function Au(i,e){const r=ml([],[i.x,i.y,0,1],e);return new Ve(r[0]/r[3],r[1]/r[3])}cs=new ma(4),ma!=Float32Array&&(cs[0]=0,cs[1]=0,cs[2]=0,cs[3]=0);class Eu extends hc{}$e("HeatmapBucket",Eu,{omit:["layers"]});var qp={paint:new hi({"heatmap-radius":new Qe(fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Qe(fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ze(fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new os(fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ze(fe.paint_heatmap["heatmap-opacity"])})};function fc(i,{width:e,height:r},o,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*r*o)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${e*r*o}`)}else l=new Uint8Array(e*r*o);return i.width=e,i.height=r,i.data=l,i}function Su(i,{width:e,height:r},o){if(e===i.width&&r===i.height)return;const l=fc({},{width:e,height:r},o);gc(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},o),i.width=e,i.height=r,i.data=l.data}function gc(i,e,r,o,l,h){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||o.x>e.width-l.width||o.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,f=e.data;for(let y=0;y<l.height;y++){const w=((r.y+y)*i.width+r.x)*h,I=((o.y+y)*e.width+o.x)*h;for(let T=0;T<l.width*h;T++)f[I+T]=p[w+T]}return e}class us{constructor(e,r){fc(this,e,1,r)}resize(e){Su(this,e,1)}clone(){return new us({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,l,h){gc(e,r,o,l,h,1)}}class xr{constructor(e,r){fc(this,e,4,r)}resize(e){Su(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new xr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,l,h){gc(e,r,o,l,h,4)}}function Iu(i){const e={},r=i.resolution||256,o=i.clips?i.clips.length:1,l=i.image||new xr({width:r,height:o}),h=(p,f,y)=>{e[i.evaluationKey]=y;const w=i.expression.evaluate(e);l.data[p+f+0]=Math.floor(255*w.r/w.a),l.data[p+f+1]=Math.floor(255*w.g/w.a),l.data[p+f+2]=Math.floor(255*w.b/w.a),l.data[p+f+3]=Math.floor(255*w.a)};if(i.clips)for(let p=0,f=0;p<o;++p,f+=4*r)for(let y=0,w=0;y<r;y++,w+=4){const I=y/(r-1),{start:T,end:M}=i.clips[p];h(f,w,T*(1-I)+M*I)}else for(let p=0,f=0;p<r;p++,f+=4)h(0,f,p/(r-1));return l}$e("AlphaImage",us),$e("RGBAImage",xr);var Gp={paint:new hi({"hillshade-illumination-direction":new Ze(fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ze(fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ze(fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ze(fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ze(fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ze(fe.paint_hillshade["hillshade-accent-color"])})};const Zp=pi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Hp}=Zp;var yc={exports:{}};function fl(i,e,r){r=r||2;var o,l,h,p,f,y,w,I=e&&e.length,T=I?e[0]*r:i.length,M=zu(i,0,T,r,!0),B=[];if(!M||M.next===M.prev)return B;if(I&&(M=function(X,Y,oe,ce){var le,ge,Ae,xe=[];for(le=0,ge=Y.length;le<ge;le++)(Ae=zu(X,Y[le]*ce,le<ge-1?Y[le+1]*ce:X.length,ce,!1))===Ae.next&&(Ae.steiner=!0),xe.push(td(Ae));for(xe.sort(Jp),le=0;le<xe.length;le++)oe=Yn(oe=Qp(xe[le],oe),oe.next);return oe}(i,e,M,r)),i.length>80*r){o=h=i[0],l=p=i[1];for(var R=r;R<T;R+=r)(f=i[R])<o&&(o=f),(y=i[R+1])<l&&(l=y),f>h&&(h=f),y>p&&(p=y);w=(w=Math.max(h-o,p-l))!==0?1/w:0}return hs(M,B,r,o,l,w),B}function zu(i,e,r,o,l){var h,p;if(l===bc(i,e,r,o)>0)for(h=e;h<r;h+=o)p=Cu(h,i[h],i[h+1],p);else for(h=r-o;h>=e;h-=o)p=Cu(h,i[h],i[h+1],p);return p&&gl(p,p.next)&&(ds(p),p=p.next),p}function Yn(i,e){if(!i)return i;e||(e=i);var r,o=i;do if(r=!1,o.steiner||!gl(o,o.next)&&ti(o.prev,o,o.next)!==0)o=o.next;else{if(ds(o),(o=e=o.prev)===o.next)break;r=!0}while(r||o!==e);return e}function hs(i,e,r,o,l,h,p){if(i){!p&&h&&function(I,T,M,B){var R=I;do R.z===null&&(R.z=_c(R.x,R.y,T,M,B)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==I);R.prevZ.nextZ=null,R.prevZ=null,function(X){var Y,oe,ce,le,ge,Ae,xe,Ne,Xe=1;do{for(oe=X,X=null,ge=null,Ae=0;oe;){for(Ae++,ce=oe,xe=0,Y=0;Y<Xe&&(xe++,ce=ce.nextZ);Y++);for(Ne=Xe;xe>0||Ne>0&&ce;)xe!==0&&(Ne===0||!ce||oe.z<=ce.z)?(le=oe,oe=oe.nextZ,xe--):(le=ce,ce=ce.nextZ,Ne--),ge?ge.nextZ=le:X=le,le.prevZ=ge,ge=le;oe=ce}ge.nextZ=null,Xe*=2}while(Ae>1)}(R)}(i,o,l,h);for(var f,y,w=i;i.prev!==i.next;)if(f=i.prev,y=i.next,h?Xp(i,o,l,h):Wp(i))e.push(f.i/r),e.push(i.i/r),e.push(y.i/r),ds(i),i=y.next,w=y.next;else if((i=y)===w){p?p===1?hs(i=Yp(Yn(i),e,r),e,r,o,l,h,2):p===2&&Kp(i,e,r,o,l,h):hs(Yn(i),e,r,o,l,h,1);break}}}function Wp(i){var e=i.prev,r=i,o=i.next;if(ti(e,r,o)>=0)return!1;for(var l=i.next.next;l!==i.prev;){if(fa(e.x,e.y,r.x,r.y,o.x,o.y,l.x,l.y)&&ti(l.prev,l,l.next)>=0)return!1;l=l.next}return!0}function Xp(i,e,r,o){var l=i.prev,h=i,p=i.next;if(ti(l,h,p)>=0)return!1;for(var f=l.x>h.x?l.x>p.x?l.x:p.x:h.x>p.x?h.x:p.x,y=l.y>h.y?l.y>p.y?l.y:p.y:h.y>p.y?h.y:p.y,w=_c(l.x<h.x?l.x<p.x?l.x:p.x:h.x<p.x?h.x:p.x,l.y<h.y?l.y<p.y?l.y:p.y:h.y<p.y?h.y:p.y,e,r,o),I=_c(f,y,e,r,o),T=i.prevZ,M=i.nextZ;T&&T.z>=w&&M&&M.z<=I;){if(T!==i.prev&&T!==i.next&&fa(l.x,l.y,h.x,h.y,p.x,p.y,T.x,T.y)&&ti(T.prev,T,T.next)>=0||(T=T.prevZ,M!==i.prev&&M!==i.next&&fa(l.x,l.y,h.x,h.y,p.x,p.y,M.x,M.y)&&ti(M.prev,M,M.next)>=0))return!1;M=M.nextZ}for(;T&&T.z>=w;){if(T!==i.prev&&T!==i.next&&fa(l.x,l.y,h.x,h.y,p.x,p.y,T.x,T.y)&&ti(T.prev,T,T.next)>=0)return!1;T=T.prevZ}for(;M&&M.z<=I;){if(M!==i.prev&&M!==i.next&&fa(l.x,l.y,h.x,h.y,p.x,p.y,M.x,M.y)&&ti(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function Yp(i,e,r){var o=i;do{var l=o.prev,h=o.next.next;!gl(l,h)&&Tu(l,o,o.next,h)&&ps(l,h)&&ps(h,l)&&(e.push(l.i/r),e.push(o.i/r),e.push(h.i/r),ds(o),ds(o.next),o=i=h),o=o.next}while(o!==i);return Yn(o)}function Kp(i,e,r,o,l,h){var p=i;do{for(var f=p.next.next;f!==p.prev;){if(p.i!==f.i&&id(p,f)){var y=ku(p,f);return p=Yn(p,p.next),y=Yn(y,y.next),hs(p,e,r,o,l,h),void hs(y,e,r,o,l,h)}f=f.next}p=p.next}while(p!==i)}function Jp(i,e){return i.x-e.x}function Qp(i,e){var r=function(h,p){var f,y=p,w=h.x,I=h.y,T=-1/0;do{if(I<=y.y&&I>=y.next.y&&y.next.y!==y.y){var M=y.x+(I-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(M<=w&&M>T){if(T=M,M===w){if(I===y.y)return y;if(I===y.next.y)return y.next}f=y.x<y.next.x?y:y.next}}y=y.next}while(y!==p);if(!f)return null;if(w===T)return f;var B,R=f,X=f.x,Y=f.y,oe=1/0;y=f;do w>=y.x&&y.x>=X&&w!==y.x&&fa(I<Y?w:T,I,X,Y,I<Y?T:w,I,y.x,y.y)&&(B=Math.abs(I-y.y)/(w-y.x),ps(y,h)&&(B<oe||B===oe&&(y.x>f.x||y.x===f.x&&ed(f,y)))&&(f=y,oe=B)),y=y.next;while(y!==R);return f}(i,e);if(!r)return e;var o=ku(r,i),l=Yn(r,r.next);return Yn(o,o.next),e===r?l:e}function ed(i,e){return ti(i.prev,i,e.prev)<0&&ti(e.next,i,i.next)<0}function _c(i,e,r,o,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-r)*l)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-o)*l)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function td(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function fa(i,e,r,o,l,h,p,f){return(l-p)*(e-f)-(i-p)*(h-f)>=0&&(i-p)*(o-f)-(r-p)*(e-f)>=0&&(r-p)*(h-f)-(l-p)*(o-f)>=0}function id(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,o){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==o.i&&l.next.i!==o.i&&Tu(l,l.next,r,o))return!0;l=l.next}while(l!==r);return!1}(i,e)&&(ps(i,e)&&ps(e,i)&&function(r,o){var l=r,h=!1,p=(r.x+o.x)/2,f=(r.y+o.y)/2;do l.y>f!=l.next.y>f&&l.next.y!==l.y&&p<(l.next.x-l.x)*(f-l.y)/(l.next.y-l.y)+l.x&&(h=!h),l=l.next;while(l!==r);return h}(i,e)&&(ti(i.prev,i,e.prev)||ti(i,e.prev,e))||gl(i,e)&&ti(i.prev,i,i.next)>0&&ti(e.prev,e,e.next)>0)}function ti(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function gl(i,e){return i.x===e.x&&i.y===e.y}function Tu(i,e,r,o){var l=_l(ti(i,e,r)),h=_l(ti(i,e,o)),p=_l(ti(r,o,i)),f=_l(ti(r,o,e));return l!==h&&p!==f||!(l!==0||!yl(i,r,e))||!(h!==0||!yl(i,o,e))||!(p!==0||!yl(r,i,o))||!(f!==0||!yl(r,e,o))}function yl(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function _l(i){return i>0?1:i<0?-1:0}function ps(i,e){return ti(i.prev,i,i.next)<0?ti(i,e,i.next)>=0&&ti(i,i.prev,e)>=0:ti(i,e,i.prev)<0||ti(i,i.next,e)<0}function ku(i,e){var r=new xc(i.i,i.x,i.y),o=new xc(e.i,e.x,e.y),l=i.next,h=e.prev;return i.next=e,e.prev=i,r.next=l,l.prev=r,o.next=r,r.prev=o,h.next=o,o.prev=h,o}function Cu(i,e,r,o){var l=new xc(i,e,r);return o?(l.next=o.next,l.prev=o,o.next.prev=l,o.next=l):(l.prev=l,l.next=l),l}function ds(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function xc(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bc(i,e,r,o){for(var l=0,h=e,p=r-o;h<r;h+=o)l+=(i[p]-i[h])*(i[h+1]+i[p+1]),p=h;return l}yc.exports=fl,yc.exports.default=fl,fl.deviation=function(i,e,r,o){var l=e&&e.length,h=Math.abs(bc(i,0,l?e[0]*r:i.length,r));if(l)for(var p=0,f=e.length;p<f;p++)h-=Math.abs(bc(i,e[p]*r,p<f-1?e[p+1]*r:i.length,r));var y=0;for(p=0;p<o.length;p+=3){var w=o[p]*r,I=o[p+1]*r,T=o[p+2]*r;y+=Math.abs((i[w]-i[T])*(i[I+1]-i[w+1])-(i[w]-i[I])*(i[T+1]-i[w+1]))}return h===0&&y===0?0:Math.abs((y-h)/h)},fl.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},o=0,l=0;l<i.length;l++){for(var h=0;h<i[l].length;h++)for(var p=0;p<e;p++)r.vertices.push(i[l][h][p]);l>0&&r.holes.push(o+=i[l-1].length)}return r};var Mu=yc.exports;function rd(i,e,r,o,l){Pu(i,e,r||0,o||i.length-1,l||nd)}function Pu(i,e,r,o,l){for(;o>r;){if(o-r>600){var h=o-r+1,p=e-r+1,f=Math.log(h),y=.5*Math.exp(2*f/3),w=.5*Math.sqrt(f*y*(h-y)/h)*(p-h/2<0?-1:1);Pu(i,e,Math.max(r,Math.floor(e-p*y/h+w)),Math.min(o,Math.floor(e+(h-p)*y/h+w)),l)}var I=i[e],T=r,M=o;for(ms(i,r,e),l(i[o],I)>0&&ms(i,r,o);T<M;){for(ms(i,T,M),T++,M--;l(i[T],I)<0;)T++;for(;l(i[M],I)>0;)M--}l(i[r],I)===0?ms(i,r,M):ms(i,++M,o),M<=e&&(r=M+1),e<=M&&(o=M-1)}}function ms(i,e,r){var o=i[e];i[e]=i[r],i[r]=o}function nd(i,e){return i<e?-1:i>e?1:0}function vc(i,e){const r=i.length;if(r<=1)return[i];const o=[];let l,h;for(let p=0;p<r;p++){const f=rt(i[p]);f!==0&&(i[p].area=Math.abs(f),h===void 0&&(h=f<0),h===f<0?(l&&o.push(l),l=[i[p]]):l.push(i[p]))}if(l&&o.push(l),e>1)for(let p=0;p<o.length;p++)o[p].length<=e||(rd(o[p],e,1,o[p].length-1,od),o[p]=o[p].slice(0,e));return o}function od(i,e){return e.area-i.area}function wc(i,e,r){const o=r.patternDependencies;let l=!1;for(const h of e){const p=h.paint.get(`${i}-pattern`);p.isConstant()||(l=!0);const f=p.constantOr(null);f&&(l=!0,o[f.to]=!0,o[f.from]=!0)}return l}function Ac(i,e,r,o,l){const h=l.patternDependencies;for(const p of e){const f=p.paint.get(`${i}-pattern`).value;if(f.kind!=="constant"){let y=f.evaluate({zoom:o-1},r,{},l.availableImages),w=f.evaluate({zoom:o},r,{},l.availableImages),I=f.evaluate({zoom:o+1},r,{},l.availableImages);y=y&&y.name?y.name:y,w=w&&w.name?w.name:w,I=I&&I.name?I.name:I,h[y]=!0,h[w]=!0,h[I]=!0,r.patterns[p.id]={min:y,mid:w,max:I}}}return r}class Ec{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xt,this.indexArray=new Ui,this.indexArray2=new Cr,this.programConfigurations=new Io(e.layers,e.zoom),this.segments=new zt,this.segments2=new zt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=wc("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),h=!l.isConstant(),p=[];for(const{feature:f,id:y,index:w,sourceLayerIndex:I}of e){const T=this.layers[0]._featureFilter.needGeometry,M=To(f,T);if(!this.layers[0]._featureFilter.filter(new jt(this.zoom),M,o))continue;const B=h?l.evaluate(M,{},o,r.availableImages):void 0,R={id:y,properties:f.properties,type:f.type,sourceLayerIndex:I,index:w,geometry:T?M.geometry:zo(f),patterns:{},sortKey:B};p.push(R)}h&&p.sort((f,y)=>f.sortKey-y.sortKey);for(const f of p){const{geometry:y,index:w,sourceLayerIndex:I}=f;if(this.hasPattern){const T=Ac("fill",this.layers,f,this.zoom,r);this.patternFeatures.push(T)}else this.addFeature(f,y,w,o,{});r.featureIndex.insert(e[w].feature,y,w,I,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}addFeatures(e,r,o){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hp),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,o,l,h){for(const p of vc(r,500)){let f=0;for(const B of p)f+=B.length;const y=this.segments.prepareSegment(f,this.layoutVertexArray,this.indexArray),w=y.vertexLength,I=[],T=[];for(const B of p){if(B.length===0)continue;B!==p[0]&&T.push(I.length/2);const R=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),X=R.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(X+B.length-1,X),I.push(B[0].x),I.push(B[0].y);for(let Y=1;Y<B.length;Y++)this.layoutVertexArray.emplaceBack(B[Y].x,B[Y].y),this.indexArray2.emplaceBack(X+Y-1,X+Y),I.push(B[Y].x),I.push(B[Y].y);R.vertexLength+=B.length,R.primitiveLength+=B.length}const M=Mu(I,T);for(let B=0;B<M.length;B+=3)this.indexArray.emplaceBack(w+M[B],w+M[B+1],w+M[B+2]);y.vertexLength+=f,y.primitiveLength+=M.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,l)}}$e("FillBucket",Ec,{omit:["layers","patternFeatures"]});const ad=new hi({"fill-sort-key":new Qe(fe.layout_fill["fill-sort-key"])});var sd={paint:new hi({"fill-antialias":new Ze(fe.paint_fill["fill-antialias"]),"fill-opacity":new Qe(fe.paint_fill["fill-opacity"]),"fill-color":new Qe(fe.paint_fill["fill-color"]),"fill-outline-color":new Qe(fe.paint_fill["fill-outline-color"]),"fill-translate":new Ze(fe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ze(fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new wo(fe.paint_fill["fill-pattern"])}),layout:ad};const ld=pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),{members:cd}=ld;var Kn={},ud=Ve,Du=ga;function ga(i,e,r,o,l){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=l,i.readFields(hd,this,e)}function hd(i,e,r){i==1?e.id=r.readVarint():i==2?function(o,l){for(var h=o.readVarint()+o.pos;o.pos<h;){var p=l._keys[o.readVarint()],f=l._values[o.readVarint()];l.properties[p]=f}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function pd(i){for(var e,r,o=0,l=0,h=i.length,p=h-1;l<h;p=l++)o+=((r=i[p]).x-(e=i[l]).x)*(e.y+r.y);return o}ga.types=["Unknown","Point","LineString","Polygon"],ga.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,o=1,l=0,h=0,p=0,f=[];i.pos<r;){if(l<=0){var y=i.readVarint();o=7&y,l=y>>3}if(l--,o===1||o===2)h+=i.readSVarint(),p+=i.readSVarint(),o===1&&(e&&f.push(e),e=[]),e.push(new ud(h,p));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&f.push(e),f},ga.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,o=0,l=0,h=0,p=1/0,f=-1/0,y=1/0,w=-1/0;i.pos<e;){if(o<=0){var I=i.readVarint();r=7&I,o=I>>3}if(o--,r===1||r===2)(l+=i.readSVarint())<p&&(p=l),l>f&&(f=l),(h+=i.readSVarint())<y&&(y=h),h>w&&(w=h);else if(r!==7)throw new Error("unknown command "+r)}return[p,y,f,w]},ga.prototype.toGeoJSON=function(i,e,r){var o,l,h=this.extent*Math.pow(2,r),p=this.extent*i,f=this.extent*e,y=this.loadGeometry(),w=ga.types[this.type];function I(B){for(var R=0;R<B.length;R++){var X=B[R];B[R]=[360*(X.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+f)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var T=[];for(o=0;o<y.length;o++)T[o]=y[o][0];I(y=T);break;case 2:for(o=0;o<y.length;o++)I(y[o]);break;case 3:for(y=function(B){var R=B.length;if(R<=1)return[B];for(var X,Y,oe=[],ce=0;ce<R;ce++){var le=pd(B[ce]);le!==0&&(Y===void 0&&(Y=le<0),Y===le<0?(X&&oe.push(X),X=[B[ce]]):X.push(B[ce]))}return X&&oe.push(X),oe}(y),o=0;o<y.length;o++)for(l=0;l<y[o].length;l++)I(y[o][l])}y.length===1?y=y[0]:w="Multi"+w;var M={type:"Feature",geometry:{type:w,coordinates:y},properties:this.properties};return"id"in this&&(M.id=this.id),M};var dd=Du,Lu=Bu;function Bu(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(md,this,e),this.length=this._features.length}function md(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(o){for(var l=null,h=o.readVarint()+o.pos;o.pos<h;){var p=o.readVarint()>>3;l=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}return l}(r))}Bu.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new dd(this._pbf,e,this.extent,this._keys,this._values)};var fd=Lu;function gd(i,e,r){if(i===3){var o=new fd(r,r.readVarint()+r.pos);o.length&&(e[o.name]=o)}}Kn.VectorTile=function(i,e){this.layers=i.readFields(gd,{},e)},Kn.VectorTileFeature=Du,Kn.VectorTileLayer=Lu;const yd=Kn.VectorTileFeature.types,Sc=Math.pow(2,13);function fs(i,e,r,o,l,h,p,f){i.emplaceBack(e,r,2*Math.floor(o*Sc)+p,l*Sc*2,h*Sc*2,Math.round(f))}class Ic{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Yt,this.indexArray=new Ui,this.programConfigurations=new Io(e.layers,e.zoom),this.segments=new zt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.features=[],this.hasPattern=wc("fill-extrusion",this.layers,r);for(const{feature:l,id:h,index:p,sourceLayerIndex:f}of e){const y=this.layers[0]._featureFilter.needGeometry,w=To(l,y);if(!this.layers[0]._featureFilter.filter(new jt(this.zoom),w,o))continue;const I={id:h,sourceLayerIndex:f,index:p,geometry:y?w.geometry:zo(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(Ac("fill-extrusion",this.layers,I,this.zoom,r)):this.addFeature(I,I.geometry,p,o,{}),r.featureIndex.insert(l,I.geometry,p,f,this.index,!0)}}addFeatures(e,r,o){for(const l of this.features){const{geometry:h}=l;this.addFeature(l,h,l.index,r,o)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cd),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,o,l,h){for(const p of vc(r,500)){let f=0;for(const B of p)f+=B.length;let y=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const B of p){if(B.length===0||xd(B))continue;let R=0;for(let X=0;X<B.length;X++){const Y=B[X];if(X>=1){const oe=B[X-1];if(!_d(Y,oe)){y.vertexLength+4>zt.MAX_VERTEX_ARRAY_LENGTH&&(y=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ce=Y.sub(oe)._perp()._unit(),le=oe.dist(Y);R+le>32768&&(R=0),fs(this.layoutVertexArray,Y.x,Y.y,ce.x,ce.y,0,0,R),fs(this.layoutVertexArray,Y.x,Y.y,ce.x,ce.y,0,1,R),R+=le,fs(this.layoutVertexArray,oe.x,oe.y,ce.x,ce.y,0,0,R),fs(this.layoutVertexArray,oe.x,oe.y,ce.x,ce.y,0,1,R);const ge=y.vertexLength;this.indexArray.emplaceBack(ge,ge+2,ge+1),this.indexArray.emplaceBack(ge+1,ge+2,ge+3),y.vertexLength+=4,y.primitiveLength+=2}}}}if(y.vertexLength+f>zt.MAX_VERTEX_ARRAY_LENGTH&&(y=this.segments.prepareSegment(f,this.layoutVertexArray,this.indexArray)),yd[e.type]!=="Polygon")continue;const w=[],I=[],T=y.vertexLength;for(const B of p)if(B.length!==0){B!==p[0]&&I.push(w.length/2);for(let R=0;R<B.length;R++){const X=B[R];fs(this.layoutVertexArray,X.x,X.y,0,0,1,1,0),w.push(X.x),w.push(X.y)}}const M=Mu(w,I);for(let B=0;B<M.length;B+=3)this.indexArray.emplaceBack(T+M[B],T+M[B+2],T+M[B+1]);y.primitiveLength+=M.length/3,y.vertexLength+=f}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,l)}}function _d(i,e){return i.x===e.x&&(i.x<0||i.x>di)||i.y===e.y&&(i.y<0||i.y>di)}function xd(i){return i.every(e=>e.x<0)||i.every(e=>e.x>di)||i.every(e=>e.y<0)||i.every(e=>e.y>di)}$e("FillExtrusionBucket",Ic,{omit:["layers","features"]});var bd={paint:new hi({"fill-extrusion-opacity":new Ze(fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Qe(fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ze(fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ze(fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new wo(fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Qe(fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Qe(fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ze(fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function gs(i,e){return i.x*e.x+i.y*e.y}function Ru(i,e){if(i.length===1){let r=0;const o=e[r++];let l;for(;!l||o.equals(l);)if(l=e[r++],!l)return 1/0;for(;r<e.length;r++){const h=e[r],p=i[0],f=l.sub(o),y=h.sub(o),w=p.sub(o),I=gs(f,f),T=gs(f,y),M=gs(y,y),B=gs(w,f),R=gs(w,y),X=I*M-T*T,Y=(M*B-T*R)/X,oe=(I*R-T*B)/X,ce=o.z*(1-Y-oe)+l.z*Y+h.z*oe;if(isFinite(ce))return ce}return 1/0}{let r=1/0;for(const o of e)r=Math.min(r,o.z);return r}}const vd=pi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:wd}=vd,Ad=pi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ed}=Ad,Sd=Kn.VectorTileFeature.types,Id=Math.cos(Math.PI/180*37.5),Fu=Math.pow(2,14)/.5;class zc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new st,this.layoutVertexArray2=new It,this.indexArray=new Ui,this.programConfigurations=new Io(e.layers,e.zoom),this.segments=new zt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=wc("line",this.layers,r);const l=this.layers[0].layout.get("line-sort-key"),h=!l.isConstant(),p=[];for(const{feature:f,id:y,index:w,sourceLayerIndex:I}of e){const T=this.layers[0]._featureFilter.needGeometry,M=To(f,T);if(!this.layers[0]._featureFilter.filter(new jt(this.zoom),M,o))continue;const B=h?l.evaluate(M,{},o):void 0,R={id:y,properties:f.properties,type:f.type,sourceLayerIndex:I,index:w,geometry:T?M.geometry:zo(f),patterns:{},sortKey:B};p.push(R)}h&&p.sort((f,y)=>f.sortKey-y.sortKey);for(const f of p){const{geometry:y,index:w,sourceLayerIndex:I}=f;if(this.hasPattern){const T=Ac("line",this.layers,f,this.zoom,r);this.patternFeatures.push(T)}else this.addFeature(f,y,w,o,{});r.featureIndex.insert(e[w].feature,y,w,I,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}addFeatures(e,r,o){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Ed)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wd),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,o,l,h){const p=this.layers[0].layout,f=p.get("line-join").evaluate(e,{}),y=p.get("line-cap"),w=p.get("line-miter-limit"),I=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const T of r)this.addLine(T,e,f,y,w,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,l)}addLine(e,r,o,l,h,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let oe=0;oe<e.length-1;oe++)this.totalDistance+=e[oe].dist(e[oe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const f=Sd[r.type]==="Polygon";let y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let w=0;for(;w<y-1&&e[w].equals(e[w+1]);)w++;if(y<(f?3:2))return;o==="bevel"&&(h=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,T=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let M,B,R,X,Y;this.e1=this.e2=-1,f&&(M=e[y-2],Y=e[w].sub(M)._unit()._perp());for(let oe=w;oe<y;oe++){if(R=oe===y-1?f?e[w+1]:void 0:e[oe+1],R&&e[oe].equals(R))continue;Y&&(X=Y),M&&(B=M),M=e[oe],Y=R?R.sub(M)._unit()._perp():X,X=X||Y;let ce=X.add(Y);ce.x===0&&ce.y===0||ce._unit();const le=X.x*Y.x+X.y*Y.y,ge=ce.x*Y.x+ce.y*Y.y,Ae=ge!==0?1/ge:1/0,xe=2*Math.sqrt(2-2*ge),Ne=ge<Id&&B&&R,Xe=X.x*Y.y-X.y*Y.x>0;if(Ne&&oe>w){const ke=M.dist(B);if(ke>2*I){const Ue=M.sub(M.sub(B)._mult(I/ke)._round());this.updateDistance(B,Ue),this.addCurrentVertex(Ue,X,0,0,T),B=Ue}}const Be=B&&R;let Re=Be?o:f?"butt":l;if(Be&&Re==="round"&&(Ae<p?Re="miter":Ae<=2&&(Re="fakeround")),Re==="miter"&&Ae>h&&(Re="bevel"),Re==="bevel"&&(Ae>2&&(Re="flipbevel"),Ae<h&&(Re="miter")),B&&this.updateDistance(B,M),Re==="miter")ce._mult(Ae),this.addCurrentVertex(M,ce,0,0,T);else if(Re==="flipbevel"){if(Ae>100)ce=Y.mult(-1);else{const ke=Ae*X.add(Y).mag()/X.sub(Y).mag();ce._perp()._mult(ke*(Xe?-1:1))}this.addCurrentVertex(M,ce,0,0,T),this.addCurrentVertex(M,ce.mult(-1),0,0,T)}else if(Re==="bevel"||Re==="fakeround"){const ke=-Math.sqrt(Ae*Ae-1),Ue=Xe?ke:0,Fe=Xe?0:ke;if(B&&this.addCurrentVertex(M,X,Ue,Fe,T),Re==="fakeround"){const ze=Math.round(180*xe/Math.PI/20);for(let et=1;et<ze;et++){let Ye=et/ze;if(Ye!==.5){const Pt=Ye-.5;Ye+=Ye*Pt*(Ye-1)*((1.0904+le*(le*(3.55645-1.43519*le)-3.2452))*Pt*Pt+(.848013+le*(.215638*le-1.06021)))}const bt=Y.sub(X)._mult(Ye)._add(X)._unit()._mult(Xe?-1:1);this.addHalfVertex(M,bt.x,bt.y,!1,Xe,0,T)}}R&&this.addCurrentVertex(M,Y,-Ue,-Fe,T)}else if(Re==="butt")this.addCurrentVertex(M,ce,0,0,T);else if(Re==="square"){const ke=B?1:-1;this.addCurrentVertex(M,ce,ke,ke,T)}else Re==="round"&&(B&&(this.addCurrentVertex(M,X,0,0,T),this.addCurrentVertex(M,X,1,1,T,!0)),R&&(this.addCurrentVertex(M,Y,-1,-1,T,!0),this.addCurrentVertex(M,Y,0,0,T)));if(Ne&&oe<y-1){const ke=M.dist(R);if(ke>2*I){const Ue=M.add(R.sub(M)._mult(I/ke)._round());this.updateDistance(M,Ue),this.addCurrentVertex(Ue,Y,0,0,T),M=Ue}}}}addCurrentVertex(e,r,o,l,h,p=!1){const f=r.y*l-r.x,y=-r.y-r.x*l;this.addHalfVertex(e,r.x+r.y*o,r.y-r.x*o,p,!1,o,h),this.addHalfVertex(e,f,y,p,!0,-l,h),this.distance>Fu/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,r,o,l,h,p))}addHalfVertex({x:e,y:r},o,l,h,p,f,y){const w=.5*(this.lineClips?this.scaledDistance*(Fu-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(r<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*l)+128,1+(f===0?0:f<0?-1:1)|(63&w)<<2,w>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),y.primitiveLength++),p?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}$e("LineBucket",zc,{omit:["layers","patternFeatures"]});const zd=new hi({"line-cap":new Ze(fe.layout_line["line-cap"]),"line-join":new Qe(fe.layout_line["line-join"]),"line-miter-limit":new Ze(fe.layout_line["line-miter-limit"]),"line-round-limit":new Ze(fe.layout_line["line-round-limit"]),"line-sort-key":new Qe(fe.layout_line["line-sort-key"])});var Ou={paint:new hi({"line-opacity":new Qe(fe.paint_line["line-opacity"]),"line-color":new Qe(fe.paint_line["line-color"]),"line-translate":new Ze(fe.paint_line["line-translate"]),"line-translate-anchor":new Ze(fe.paint_line["line-translate-anchor"]),"line-width":new Qe(fe.paint_line["line-width"]),"line-gap-width":new Qe(fe.paint_line["line-gap-width"]),"line-offset":new Qe(fe.paint_line["line-offset"]),"line-blur":new Qe(fe.paint_line["line-blur"]),"line-dasharray":new Ao(fe.paint_line["line-dasharray"]),"line-pattern":new wo(fe.paint_line["line-pattern"]),"line-gradient":new os(fe.paint_line["line-gradient"])}),layout:zd};const Vu=new class extends Qe{possiblyEvaluate(i,e){return e=new jt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,o){return e=de({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,o)}}(Ou.paint.properties["line-width"].specification);function Uu(i,e){return e>0?e+2*i:i}Vu.useIntegerZoom=!0;const Td=pi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),kd=pi([{name:"a_projected_pos",components:3,type:"Float32"}],4);pi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Cd=pi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);pi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $u=pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Md=pi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Pd(i,e,r){return i.sections.forEach(o=>{o.text=function(l,h,p){const f=h.layout.get("text-transform").evaluate(p,{});return f==="uppercase"?l=l.toLocaleUpperCase():f==="lowercase"&&(l=l.toLocaleLowerCase()),or.applyArabicShaping&&(l=or.applyArabicShaping(l)),l}(o.text,e,r)}),i}pi([{name:"triangle",components:3,type:"Uint16"}]),pi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),pi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),pi([{type:"Float32",name:"offsetX"}]),pi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ys={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var vi=24,Tc=Bt,Nu=function(i,e,r,o,l){var h,p,f=8*l-o-1,y=(1<<f)-1,w=y>>1,I=-7,T=r?l-1:0,M=r?-1:1,B=i[e+T];for(T+=M,h=B&(1<<-I)-1,B>>=-I,I+=f;I>0;h=256*h+i[e+T],T+=M,I-=8);for(p=h&(1<<-I)-1,h>>=-I,I+=o;I>0;p=256*p+i[e+T],T+=M,I-=8);if(h===0)h=1-w;else{if(h===y)return p?NaN:1/0*(B?-1:1);p+=Math.pow(2,o),h-=w}return(B?-1:1)*p*Math.pow(2,h-o)},ju=function(i,e,r,o,l,h){var p,f,y,w=8*h-l-1,I=(1<<w)-1,T=I>>1,M=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=o?0:h-1,R=o?1:-1,X=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,p=I):(p=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-p))<1&&(p--,y*=2),(e+=p+T>=1?M/y:M*Math.pow(2,1-T))*y>=2&&(p++,y/=2),p+T>=I?(f=0,p=I):p+T>=1?(f=(e*y-1)*Math.pow(2,l),p+=T):(f=e*Math.pow(2,T-1)*Math.pow(2,l),p=0));l>=8;i[r+B]=255&f,B+=R,f/=256,l-=8);for(p=p<<l|f,w+=l;w>0;i[r+B]=255&p,B+=R,p/=256,w-=8);i[r+B-R]|=128*X};function Bt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Bt.Varint=0,Bt.Fixed64=1,Bt.Bytes=2,Bt.Fixed32=5;var Jn,kc=4294967296,qu=1/kc,Gu=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function zn(i){return i.type===Bt.Bytes?i.readVarint()+i.pos:i.pos+1}function ya(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Zu(i,e,r){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(o);for(var l=r.pos-1;l>=i;l--)r.buf[l+o]=r.buf[l]}function Dd(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Ld(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Bd(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Rd(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Fd(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Od(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Vd(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Ud(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function $d(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function xl(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function _a(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Hu(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Nd(i,e,r){i===1&&r.readMessage(jd,e)}function jd(i,e,r){if(i===3){const{id:o,bitmap:l,width:h,height:p,left:f,top:y,advance:w}=r.readMessage(qd,{});e.push({id:o,bitmap:new us({width:h+6,height:p+6},l),metrics:{width:h,height:p,left:f,top:y,advance:w}})}}function qd(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Wu(i){let e=0,r=0;for(const p of i)e+=p.w*p.h,r=Math.max(r,p.w);i.sort((p,f)=>f.h-p.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let l=0,h=0;for(const p of i)for(let f=o.length-1;f>=0;f--){const y=o[f];if(!(p.w>y.w||p.h>y.h)){if(p.x=y.x,p.y=y.y,h=Math.max(h,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===y.w&&p.h===y.h){const w=o.pop();f<o.length&&(o[f]=w)}else p.h===y.h?(y.x+=p.w,y.w-=p.w):p.w===y.w?(y.y+=p.h,y.h-=p.h):(o.push({x:y.x+p.w,y:y.y,w:y.w-p.w,h:p.h}),y.y+=p.h,y.h-=p.h);break}}return{w:l,h,fill:e/(l*h)||0}}Bt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var o=this.readVarint(),l=o>>3,h=this.pos;this.type=7&o,i(l,e,this),this.pos===h&&this.skip(o)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=xl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Hu(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=xl(this.buf,this.pos)+xl(this.buf,this.pos+4)*kc;return this.pos+=8,i},readSFixed64:function(){var i=xl(this.buf,this.pos)+Hu(this.buf,this.pos+4)*kc;return this.pos+=8,i},readFloat:function(){var i=Nu(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Nu(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,o=this.buf;return e=127&(r=o[this.pos++]),r<128?e:(e|=(127&(r=o[this.pos++]))<<7,r<128?e:(e|=(127&(r=o[this.pos++]))<<14,r<128?e:(e|=(127&(r=o[this.pos++]))<<21,r<128?e:function(l,h,p){var f,y,w=p.buf;if(f=(112&(y=w[p.pos++]))>>4,y<128||(f|=(127&(y=w[p.pos++]))<<3,y<128)||(f|=(127&(y=w[p.pos++]))<<10,y<128)||(f|=(127&(y=w[p.pos++]))<<17,y<128)||(f|=(127&(y=w[p.pos++]))<<24,y<128)||(f|=(1&(y=w[p.pos++]))<<31,y<128))return ya(l,f,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Gu?function(r,o,l){return Gu.decode(r.subarray(o,l))}(this.buf,e,i):function(r,o,l){for(var h="",p=o;p<l;){var f,y,w,I=r[p],T=null,M=I>239?4:I>223?3:I>191?2:1;if(p+M>l)break;M===1?I<128&&(T=I):M===2?(192&(f=r[p+1]))==128&&(T=(31&I)<<6|63&f)<=127&&(T=null):M===3?(y=r[p+2],(192&(f=r[p+1]))==128&&(192&y)==128&&((T=(15&I)<<12|(63&f)<<6|63&y)<=2047||T>=55296&&T<=57343)&&(T=null)):M===4&&(y=r[p+2],w=r[p+3],(192&(f=r[p+1]))==128&&(192&y)==128&&(192&w)==128&&((T=(15&I)<<18|(63&f)<<12|(63&y)<<6|63&w)<=65535||T>=1114112)&&(T=null)),T===null?(T=65533,M=1):T>65535&&(T-=65536,h+=String.fromCharCode(T>>>10&1023|55296),T=56320|1023&T),h+=String.fromCharCode(T),p+=M}return h}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Bt.Bytes)return i.push(this.readVarint(e));var r=zn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Bt.Bytes)return i.push(this.readSVarint());var e=zn(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Bt.Bytes)return i.push(this.readBoolean());var e=zn(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Bt.Bytes)return i.push(this.readFloat());var e=zn(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Bt.Bytes)return i.push(this.readDouble());var e=zn(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Bt.Bytes)return i.push(this.readFixed32());var e=zn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Bt.Bytes)return i.push(this.readSFixed32());var e=zn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Bt.Bytes)return i.push(this.readFixed64());var e=zn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Bt.Bytes)return i.push(this.readSFixed64());var e=zn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Bt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Bt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Bt.Fixed32)this.pos+=4;else{if(e!==Bt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),_a(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),_a(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),_a(this.buf,-1&i,this.pos),_a(this.buf,Math.floor(i*qu),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),_a(this.buf,-1&i,this.pos),_a(this.buf,Math.floor(i*qu),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var o,l;if(e>=0?(o=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(h,p,f){f.buf[f.pos++]=127&h|128,h>>>=7,f.buf[f.pos++]=127&h|128,h>>>=7,f.buf[f.pos++]=127&h|128,h>>>=7,f.buf[f.pos++]=127&h|128,f.buf[f.pos]=127&(h>>>=7)}(o,0,r),function(h,p){var f=(7&h)<<4;p.buf[p.pos++]|=f|((h>>>=3)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h)))))}(l,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(o,l,h){for(var p,f,y=0;y<l.length;y++){if((p=l.charCodeAt(y))>55295&&p<57344){if(!f){p>56319||y+1===l.length?(o[h++]=239,o[h++]=191,o[h++]=189):f=p;continue}if(p<56320){o[h++]=239,o[h++]=191,o[h++]=189,f=p;continue}p=f-55296<<10|p-56320|65536,f=null}else f&&(o[h++]=239,o[h++]=191,o[h++]=189,f=null);p<128?o[h++]=p:(p<2048?o[h++]=p>>6|192:(p<65536?o[h++]=p>>12|224:(o[h++]=p>>18|240,o[h++]=p>>12&63|128),o[h++]=p>>6&63|128),o[h++]=63&p|128)}return h}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Zu(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),ju(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),ju(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var o=this.pos-r;o>=128&&Zu(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,e,r){this.writeTag(i,Bt.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Dd,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Ld,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Fd,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Bd,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Rd,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Od,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Vd,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Ud,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,$d,e)},writeBytesField:function(i,e){this.writeTag(i,Bt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Bt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Bt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Bt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Bt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Bt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Bt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Bt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Bt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Bt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class Cc{constructor(e,{pixelRatio:r,version:o,stretchX:l,stretchY:h,content:p}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=l,this.stretchY=h,this.content=p,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Xu{constructor(e,r){const o={},l={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,o,h),this.addImages(r,l,h);const{w:p,h:f}=Wu(h),y=new xr({width:p||1,height:f||1});for(const w in e){const I=e[w],T=o[w].paddedRect;xr.copy(I.data,y,{x:0,y:0},{x:T.x+1,y:T.y+1},I.data)}for(const w in r){const I=r[w],T=l[w].paddedRect,M=T.x+1,B=T.y+1,R=I.data.width,X=I.data.height;xr.copy(I.data,y,{x:0,y:0},{x:M,y:B},I.data),xr.copy(I.data,y,{x:0,y:X-1},{x:M,y:B-1},{width:R,height:1}),xr.copy(I.data,y,{x:0,y:0},{x:M,y:B+X},{width:R,height:1}),xr.copy(I.data,y,{x:R-1,y:0},{x:M-1,y:B},{width:1,height:X}),xr.copy(I.data,y,{x:0,y:0},{x:M+R,y:B},{width:1,height:X})}this.image=y,this.iconPositions=o,this.patternPositions=l}addImages(e,r,o){for(const l in e){const h=e[l],p={x:0,y:0,w:h.data.width+2,h:h.data.height+2};o.push(p),r[l]=new Cc(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),r)}patchUpdatedImage(e,r,o){if(!e||!r||e.version===r.version)return;e.version=r.version;const[l,h]=e.tl;o.update(r.data,void 0,{x:l,y:h})}}$e("ImagePosition",Cc),$e("ImageAtlas",Xu),a.WritingMode=void 0,(Jn=a.WritingMode||(a.WritingMode={}))[Jn.none=0]="none",Jn[Jn.horizontal=1]="horizontal",Jn[Jn.vertical=2]="vertical",Jn[Jn.horizontalOnly=3]="horizontalOnly";const bl=-17;class _s{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const o=new _s;return o.scale=e||1,o.fontStack=r,o}static forImage(e){const r=new _s;return r.imageName=e,r}}class xa{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const o=new xa;for(let l=0;l<e.sections.length;l++){const h=e.sections[l];h.image?o.addImageSection(h):o.addTextSection(h,r)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let o=0;o<e.length;o++){const l=e.charCodeAt(o+1)||null,h=e.charCodeAt(o-1)||null;r+=l&&nl(l)&&!ys[e[o+1]]||h&&nl(h)&&!ys[e[o-1]]||!ys[e[o]]?e[o]:ys[e[o]]}return r}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&wl[this.text.charCodeAt(o)];o++)e++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&wl[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const o=new xa;return o.text=this.text.substring(e,r),o.sectionIndex=this.sectionIndex.slice(e,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(_s.forText(e.scale,e.fontStack||r));const o=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(o)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Ke("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(_s.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Ke("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vl(i,e,r,o,l,h,p,f,y,w,I,T,M,B,R,X){const Y=xa.fromFeature(i,l);let oe;T===a.WritingMode.vertical&&Y.verticalizePunctuation();const{processBidirectionalText:ce,processStyledBidirectionalText:le}=or;if(ce&&Y.sections.length===1){oe=[];const xe=ce(Y.toString(),Mc(Y,w,h,e,o,B,R));for(const Ne of xe){const Xe=new xa;Xe.text=Ne,Xe.sections=Y.sections;for(let Be=0;Be<Ne.length;Be++)Xe.sectionIndex.push(0);oe.push(Xe)}}else if(le){oe=[];const xe=le(Y.text,Y.sectionIndex,Mc(Y,w,h,e,o,B,R));for(const Ne of xe){const Xe=new xa;Xe.text=Ne[0],Xe.sectionIndex=Ne[1],Xe.sections=Y.sections,oe.push(Xe)}}else oe=function(xe,Ne){const Xe=[],Be=xe.text;let Re=0;for(const ke of Ne)Xe.push(xe.substring(Re,ke)),Re=ke;return Re<Be.length&&Xe.push(xe.substring(Re,Be.length)),Xe}(Y,Mc(Y,w,h,e,o,B,R));const ge=[],Ae={positionedLines:ge,text:Y.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:T,iconsInText:!1,verticalizable:!1};return function(xe,Ne,Xe,Be,Re,ke,Ue,Fe,ze,et,Ye,bt){let Pt=0,Gt=bl,Zt=0,Ei=0;const ai=Fe==="right"?1:Fe==="left"?0:.5;let si=0;for(const li of Re){li.trim();const Ii=li.getMaxScale(),Li=(Ii-1)*vi,$i={positionedGlyphs:[],lineOffset:0};xe.positionedLines[si]=$i;const Qi=$i.positionedGlyphs;let er=0;if(!li.length()){Gt+=ke,++si;continue}for(let yi=0;yi<li.length();yi++){const yt=li.getSection(yi),lr=li.getSectionIndex(yi),zi=li.getCharCode(yi);let Bi=0,Lr=null,Hr=null,Wr=null,kn=vi;const Br=!(ze===a.WritingMode.horizontal||!Ye&&!vo(zi)||Ye&&(wl[zi]||(gi=zi,Pe.Arabic(gi)||Pe["Arabic Supplement"](gi)||Pe["Arabic Extended-A"](gi)||Pe["Arabic Presentation Forms-A"](gi)||Pe["Arabic Presentation Forms-B"](gi))));if(yt.imageName){const br=Be[yt.imageName];if(!br)continue;Wr=yt.imageName,xe.iconsInText=xe.iconsInText||!0,Hr=br.paddedRect;const tr=br.displaySize;yt.scale=yt.scale*vi/bt,Lr={width:tr[0],height:tr[1],left:1,top:-3,advance:Br?tr[1]:tr[0]},Bi=Li+(vi-tr[1]*yt.scale),kn=Lr.advance;const Cn=Br?tr[0]*yt.scale-vi*Ii:tr[1]*yt.scale-vi*Ii;Cn>0&&Cn>er&&(er=Cn)}else{const br=Xe[yt.fontStack],tr=br&&br[zi];if(tr&&tr.rect)Hr=tr.rect,Lr=tr.metrics;else{const Cn=Ne[yt.fontStack],vs=Cn&&Cn[zi];if(!vs)continue;Lr=vs.metrics}Bi=(Ii-yt.scale)*vi}Br?(xe.verticalizable=!0,Qi.push({glyph:zi,imageName:Wr,x:Pt,y:Gt+Bi,vertical:Br,scale:yt.scale,fontStack:yt.fontStack,sectionIndex:lr,metrics:Lr,rect:Hr}),Pt+=kn*yt.scale+et):(Qi.push({glyph:zi,imageName:Wr,x:Pt,y:Gt+Bi,vertical:Br,scale:yt.scale,fontStack:yt.fontStack,sectionIndex:lr,metrics:Lr,rect:Hr}),Pt+=Lr.advance*yt.scale+et)}Qi.length!==0&&(Zt=Math.max(Pt-et,Zt),Hd(Qi,0,Qi.length-1,ai,er)),Pt=0;const Xt=ke*Ii+er;$i.lineOffset=Math.max(er,Li),Gt+=Xt,Ei=Math.max(Xt,Ei),++si}var gi;const Si=Gt-bl,{horizontalAlign:Di,verticalAlign:Ji}=Pc(Ue);(function(li,Ii,Li,$i,Qi,er,Xt,yi,yt){const lr=(Ii-Li)*Qi;let zi=0;zi=er!==Xt?-yi*$i-bl:(-$i*yt+.5)*Xt;for(const Bi of li)for(const Lr of Bi.positionedGlyphs)Lr.x+=lr,Lr.y+=zi})(xe.positionedLines,ai,Di,Ji,Zt,Ei,ke,Si,Re.length),xe.top+=-Ji*Si,xe.bottom=xe.top+Si,xe.left+=-Di*Zt,xe.right=xe.left+Zt}(Ae,e,r,o,oe,p,f,y,T,w,M,X),!function(xe){for(const Ne of xe)if(Ne.positionedGlyphs.length!==0)return!1;return!0}(ge)&&Ae}const wl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Gd={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Yu(i,e,r,o,l,h){if(e.imageName){const p=o[e.imageName];return p?p.displaySize[0]*e.scale*vi/h+l:0}{const p=r[e.fontStack],f=p&&p[i];return f?f.metrics.advance*e.scale+l:0}}function Ku(i,e,r,o){const l=Math.pow(i-e,2);return o?i<e?l/2:2*l:l+Math.abs(r)*r}function Zd(i,e,r){let o=0;return i===10&&(o-=1e4),r&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Ju(i,e,r,o,l,h){let p=null,f=Ku(e,r,l,h);for(const y of o){const w=Ku(e-y.x,r,l,h)+y.badness;w<=f&&(p=y,f=w)}return{index:i,x:e,priorBreak:p,badness:f}}function Qu(i){return i?Qu(i.priorBreak).concat(i.index):[]}function Mc(i,e,r,o,l,h,p){if(h!=="point")return[];if(!i)return[];const f=[],y=function(M,B,R,X,Y,oe){let ce=0;for(let le=0;le<M.length();le++){const ge=M.getSection(le);ce+=Yu(M.getCharCode(le),ge,X,Y,B,oe)}return ce/Math.max(1,Math.ceil(ce/R))}(i,e,r,o,l,p),w=i.text.indexOf("\u200B")>=0;let I=0;for(let M=0;M<i.length();M++){const B=i.getSection(M),R=i.getCharCode(M);if(wl[R]||(I+=Yu(R,B,o,l,e,p)),M<i.length()-1){const X=!((T=R)<11904||!(Pe["Bopomofo Extended"](T)||Pe.Bopomofo(T)||Pe["CJK Compatibility Forms"](T)||Pe["CJK Compatibility Ideographs"](T)||Pe["CJK Compatibility"](T)||Pe["CJK Radicals Supplement"](T)||Pe["CJK Strokes"](T)||Pe["CJK Symbols and Punctuation"](T)||Pe["CJK Unified Ideographs Extension A"](T)||Pe["CJK Unified Ideographs"](T)||Pe["Enclosed CJK Letters and Months"](T)||Pe["Halfwidth and Fullwidth Forms"](T)||Pe.Hiragana(T)||Pe["Ideographic Description Characters"](T)||Pe["Kangxi Radicals"](T)||Pe["Katakana Phonetic Extensions"](T)||Pe.Katakana(T)||Pe["Vertical Forms"](T)||Pe["Yi Radicals"](T)||Pe["Yi Syllables"](T)));(Gd[R]||X||B.imageName)&&f.push(Ju(M+1,I,y,f,Zd(R,i.getCharCode(M+1),X&&w),!1))}}var T;return Qu(Ju(i.length(),I,y,f,0,!0))}function Pc(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Hd(i,e,r,o,l){if(!o&&!l)return;const h=i[r],p=(i[r].x+h.metrics.advance*h.scale)*o;for(let f=e;f<=r;f++)i[f].x-=p,i[f].y+=l}function Wd(i,e,r){const{horizontalAlign:o,verticalAlign:l}=Pc(r),h=e[0]-i.displaySize[0]*o,p=e[1]-i.displaySize[1]*l;return{image:i,top:p,bottom:p+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function eh(i,e,r,o,l,h){const p=i.image;let f;if(p.content){const Y=p.content,oe=p.pixelRatio||1;f=[Y[0]/oe,Y[1]/oe,p.displaySize[0]-Y[2]/oe,p.displaySize[1]-Y[3]/oe]}const y=e.left*h,w=e.right*h;let I,T,M,B;r==="width"||r==="both"?(B=l[0]+y-o[3],T=l[0]+w+o[1]):(B=l[0]+(y+w-p.displaySize[0])/2,T=B+p.displaySize[0]);const R=e.top*h,X=e.bottom*h;return r==="height"||r==="both"?(I=l[1]+R-o[0],M=l[1]+X+o[2]):(I=l[1]+(R+X-p.displaySize[1])/2,M=I+p.displaySize[1]),{image:p,top:I,right:T,bottom:M,left:B,collisionPadding:f}}const Tn=128;function th(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new jt(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:l}=r;let h=0;for(;h<o.length&&o[h]<=i;)h++;h=Math.max(0,h-1);let p=h;for(;p<o.length&&o[p]<i+1;)p++;p=Math.min(o.length-1,p);const f=o[h],y=o[p];return r.kind==="composite"?{kind:"composite",minZoom:f,maxZoom:y,interpolationType:l}:{kind:"camera",minZoom:f,maxZoom:y,minSize:r.evaluate(new jt(f)),maxSize:r.evaluate(new jt(y)),interpolationType:l}}}class Qn extends Ve{constructor(e,r,o,l){super(e,r),this.angle=o,l!==void 0&&(this.segment=l)}clone(){return new Qn(this.x,this.y,this.angle,this.segment)}}function ih(i,e,r,o,l){if(e.segment===void 0)return!0;let h=e,p=e.segment+1,f=0;for(;f>-r/2;){if(p--,p<0)return!1;f-=i[p].dist(h),h=i[p]}f+=i[p].dist(i[p+1]),p++;const y=[];let w=0;for(;f<r/2;){const I=i[p],T=i[p+1];if(!T)return!1;let M=i[p-1].angleTo(I)-I.angleTo(T);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:f,angleDelta:M}),w+=M;f-y[0].distance>o;)w-=y.shift().angleDelta;if(w>l)return!1;p++,f+=I.dist(T)}return!0}function rh(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function nh(i,e,r){return i?.6*e*r:0}function oh(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Xd(i,e,r,o,l,h){const p=nh(r,l,h),f=oh(r,o)*h;let y=0;const w=rh(i)/2;for(let I=0;I<i.length-1;I++){const T=i[I],M=i[I+1],B=T.dist(M);if(y+B>w){const R=(w-y)/B,X=ni(T.x,M.x,R),Y=ni(T.y,M.y,R),oe=new Qn(X,Y,M.angleTo(T),I);return oe._round(),!p||ih(i,oe,f,p,e)?oe:void 0}y+=B}}function Yd(i,e,r,o,l,h,p,f,y){const w=nh(o,h,p),I=oh(o,l),T=I*p,M=i[0].x===0||i[0].x===y||i[0].y===0||i[0].y===y;return e-T<e/4&&(e=T+e/4),ah(i,M?e/2*f%e:(I/2+2*h)*p*f%e,e,w,r,T,M,!1,y)}function ah(i,e,r,o,l,h,p,f,y){const w=h/2,I=rh(i);let T=0,M=e-r,B=[];for(let R=0;R<i.length-1;R++){const X=i[R],Y=i[R+1],oe=X.dist(Y),ce=Y.angleTo(X);for(;M+r<T+oe;){M+=r;const le=(M-T)/oe,ge=ni(X.x,Y.x,le),Ae=ni(X.y,Y.y,le);if(ge>=0&&ge<y&&Ae>=0&&Ae<y&&M-w>=0&&M+w<=I){const xe=new Qn(ge,Ae,ce,R);xe._round(),o&&!ih(i,xe,h,o,l)||B.push(xe)}}T+=oe}return f||B.length||p||(B=ah(i,T/2,r,o,l,h,p,!0,y)),B}function sh(i,e,r,o,l){const h=[];for(let p=0;p<i.length;p++){const f=i[p];let y;for(let w=0;w<f.length-1;w++){let I=f[w],T=f[w+1];I.x<e&&T.x<e||(I.x<e?I=new Ve(e,I.y+(e-I.x)/(T.x-I.x)*(T.y-I.y))._round():T.x<e&&(T=new Ve(e,I.y+(e-I.x)/(T.x-I.x)*(T.y-I.y))._round()),I.y<r&&T.y<r||(I.y<r?I=new Ve(I.x+(r-I.y)/(T.y-I.y)*(T.x-I.x),r)._round():T.y<r&&(T=new Ve(I.x+(r-I.y)/(T.y-I.y)*(T.x-I.x),r)._round()),I.x>=o&&T.x>=o||(I.x>=o?I=new Ve(o,I.y+(o-I.x)/(T.x-I.x)*(T.y-I.y))._round():T.x>=o&&(T=new Ve(o,I.y+(o-I.x)/(T.x-I.x)*(T.y-I.y))._round()),I.y>=l&&T.y>=l||(I.y>=l?I=new Ve(I.x+(l-I.y)/(T.y-I.y)*(T.x-I.x),l)._round():T.y>=l&&(T=new Ve(I.x+(l-I.y)/(T.y-I.y)*(T.x-I.x),l)._round()),y&&I.equals(y[y.length-1])||(y=[I],h.push(y)),y.push(T)))))}}return h}function lh(i,e,r,o){const l=[],h=i.image,p=h.pixelRatio,f=h.paddedRect.w-2,y=h.paddedRect.h-2,w=i.right-i.left,I=i.bottom-i.top,T=h.stretchX||[[0,f]],M=h.stretchY||[[0,y]],B=(ke,Ue)=>ke+Ue[1]-Ue[0],R=T.reduce(B,0),X=M.reduce(B,0),Y=f-R,oe=y-X;let ce=0,le=R,ge=0,Ae=X,xe=0,Ne=Y,Xe=0,Be=oe;if(h.content&&o){const ke=h.content;ce=Al(T,0,ke[0]),ge=Al(M,0,ke[1]),le=Al(T,ke[0],ke[2]),Ae=Al(M,ke[1],ke[3]),xe=ke[0]-ce,Xe=ke[1]-ge,Ne=ke[2]-ke[0]-le,Be=ke[3]-ke[1]-Ae}const Re=(ke,Ue,Fe,ze)=>{const et=El(ke.stretch-ce,le,w,i.left),Ye=Sl(ke.fixed-xe,Ne,ke.stretch,R),bt=El(Ue.stretch-ge,Ae,I,i.top),Pt=Sl(Ue.fixed-Xe,Be,Ue.stretch,X),Gt=El(Fe.stretch-ce,le,w,i.left),Zt=Sl(Fe.fixed-xe,Ne,Fe.stretch,R),Ei=El(ze.stretch-ge,Ae,I,i.top),ai=Sl(ze.fixed-Xe,Be,ze.stretch,X),si=new Ve(et,bt),gi=new Ve(Gt,bt),Si=new Ve(Gt,Ei),Di=new Ve(et,Ei),Ji=new Ve(Ye/p,Pt/p),li=new Ve(Zt/p,ai/p),Ii=e*Math.PI/180;if(Ii){const Qi=Math.sin(Ii),er=Math.cos(Ii),Xt=[er,-Qi,Qi,er];si._matMult(Xt),gi._matMult(Xt),Di._matMult(Xt),Si._matMult(Xt)}const Li=ke.stretch+ke.fixed,$i=Ue.stretch+Ue.fixed;return{tl:si,tr:gi,bl:Di,br:Si,tex:{x:h.paddedRect.x+1+Li,y:h.paddedRect.y+1+$i,w:Fe.stretch+Fe.fixed-Li,h:ze.stretch+ze.fixed-$i},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ji,pixelOffsetBR:li,minFontScaleX:Ne/p/w,minFontScaleY:Be/p/I,isSDF:r}};if(o&&(h.stretchX||h.stretchY)){const ke=ch(T,Y,R),Ue=ch(M,oe,X);for(let Fe=0;Fe<ke.length-1;Fe++){const ze=ke[Fe],et=ke[Fe+1];for(let Ye=0;Ye<Ue.length-1;Ye++)l.push(Re(ze,Ue[Ye],et,Ue[Ye+1]))}}else l.push(Re({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:y+1}));return l}function Al(i,e,r){let o=0;for(const l of i)o+=Math.max(e,Math.min(r,l[1]))-Math.max(e,Math.min(r,l[0]));return o}function ch(i,e,r){const o=[{fixed:-1,stretch:0}];for(const[l,h]of i){const p=o[o.length-1];o.push({fixed:l-p.stretch,stretch:p.stretch}),o.push({fixed:l-p.stretch,stretch:p.stretch+(h-l)})}return o.push({fixed:e+1,stretch:r}),o}function El(i,e,r,o){return i/e*r+o}function Sl(i,e,r,o){return i-e*r/o}$e("Anchor",Qn);class Il{constructor(e,r,o,l,h,p,f,y,w,I){if(this.boxStartIndex=e.length,w){let T=p.top,M=p.bottom;const B=p.collisionPadding;B&&(T-=B[1],M+=B[3]);let R=M-T;R>0&&(R=Math.max(10,R),this.circleDiameter=R)}else{let T=p.top*f-y,M=p.bottom*f+y,B=p.left*f-y,R=p.right*f+y;const X=p.collisionPadding;if(X&&(B-=X[0]*f,T-=X[1]*f,R+=X[2]*f,M+=X[3]*f),I){const Y=new Ve(B,T),oe=new Ve(R,T),ce=new Ve(B,M),le=new Ve(R,M),ge=I*Math.PI/180;Y._rotate(ge),oe._rotate(ge),ce._rotate(ge),le._rotate(ge),B=Math.min(Y.x,oe.x,ce.x,le.x),R=Math.max(Y.x,oe.x,ce.x,le.x),T=Math.min(Y.y,oe.y,ce.y,le.y),M=Math.max(Y.y,oe.y,ce.y,le.y)}e.emplaceBack(r.x,r.y,B,T,R,M,o,l,h)}this.boxEndIndex=e.length}}class Kd{constructor(e=[],r=Jd){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:o}=this,l=r[e];for(;e>0;){const h=e-1>>1,p=r[h];if(o(l,p)>=0)break;r[e]=p,e=h}r[e]=l}_down(e){const{data:r,compare:o}=this,l=this.length>>1,h=r[e];for(;e<l;){let p=1+(e<<1),f=r[p];const y=p+1;if(y<this.length&&o(r[y],f)<0&&(p=y,f=r[y]),o(f,h)>=0)break;r[e]=f,e=p}r[e]=h}}function Jd(i,e){return i<e?-1:i>e?1:0}function Qd(i,e=1,r=!1){let o=1/0,l=1/0,h=-1/0,p=-1/0;const f=i[0];for(let B=0;B<f.length;B++){const R=f[B];(!B||R.x<o)&&(o=R.x),(!B||R.y<l)&&(l=R.y),(!B||R.x>h)&&(h=R.x),(!B||R.y>p)&&(p=R.y)}const y=Math.min(h-o,p-l);let w=y/2;const I=new Kd([],em);if(y===0)return new Ve(o,l);for(let B=o;B<h;B+=y)for(let R=l;R<p;R+=y)I.push(new ba(B+w,R+w,w,i));let T=function(B){let R=0,X=0,Y=0;const oe=B[0];for(let ce=0,le=oe.length,ge=le-1;ce<le;ge=ce++){const Ae=oe[ce],xe=oe[ge],Ne=Ae.x*xe.y-xe.x*Ae.y;X+=(Ae.x+xe.x)*Ne,Y+=(Ae.y+xe.y)*Ne,R+=3*Ne}return new ba(X/R,Y/R,0,B)}(i),M=I.length;for(;I.length;){const B=I.pop();(B.d>T.d||!T.d)&&(T=B,r&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,M)),B.max-T.d<=e||(w=B.h/2,I.push(new ba(B.p.x-w,B.p.y-w,w,i)),I.push(new ba(B.p.x+w,B.p.y-w,w,i)),I.push(new ba(B.p.x-w,B.p.y+w,w,i)),I.push(new ba(B.p.x+w,B.p.y+w,w,i)),M+=4)}return r&&(console.log(`num probes: ${M}`),console.log(`best distance: ${T.d}`)),T.p}function em(i,e){return e.max-i.max}function ba(i,e,r,o){this.p=new Ve(i,e),this.h=r,this.d=function(l,h){let p=!1,f=1/0;for(let y=0;y<h.length;y++){const w=h[y];for(let I=0,T=w.length,M=T-1;I<T;M=I++){const B=w[I],R=w[M];B.y>l.y!=R.y>l.y&&l.x<(R.x-B.x)*(l.y-B.y)/(R.y-B.y)+B.x&&(p=!p),f=Math.min(f,bu(l,B,R))}}return(p?1:-1)*Math.sqrt(f)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const Dc=Number.POSITIVE_INFINITY;function uh(i,e){return e[1]!==Dc?function(r,o,l){let h=0,p=0;switch(o=Math.abs(o),l=Math.abs(l),r){case"top-right":case"top-left":case"top":p=l-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-l}switch(r){case"top-right":case"bottom-right":case"right":h=-o;break;case"top-left":case"bottom-left":case"left":h=o}return[h,p]}(i,e[0],e[1]):function(r,o){let l=0,h=0;o<0&&(o=0);const p=o/Math.sqrt(2);switch(r){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-o;break;case"top":h=o-7}switch(r){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=o;break;case"right":l=-o}return[l,h]}(i,e[0])}function Lc(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tm(i,e,r,o,l,h,p,f,y,w,I){let T=h.textMaxSize.evaluate(e,{});T===void 0&&(T=p);const M=i.layers[0].layout,B=M.get("icon-offset").evaluate(e,{},I),R=ph(r.horizontal),X=p/24,Y=i.tilePixelRatio*X,oe=i.tilePixelRatio*T/24,ce=i.tilePixelRatio*f,le=i.tilePixelRatio*M.get("symbol-spacing"),ge=M.get("text-padding")*i.tilePixelRatio,Ae=M.get("icon-padding")*i.tilePixelRatio,xe=M.get("text-max-angle")/180*Math.PI,Ne=M.get("text-rotation-alignment")!=="viewport"&&M.get("symbol-placement")!=="point",Xe=M.get("icon-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",Be=M.get("symbol-placement"),Re=le/2,ke=M.get("icon-text-fit");let Ue;o&&ke!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Ue=eh(o,r.vertical,ke,M.get("icon-text-fit-padding"),B,X)),R&&(o=eh(o,R,ke,M.get("icon-text-fit-padding"),B,X)));const Fe=(ze,et)=>{et.x<0||et.x>=di||et.y<0||et.y>=di||function(Ye,bt,Pt,Gt,Zt,Ei,ai,si,gi,Si,Di,Ji,li,Ii,Li,$i,Qi,er,Xt,yi,yt,lr,zi,Bi,Lr){const Hr=Ye.addToLineVertexArray(bt,Pt);let Wr,kn,Br,br,tr=0,Cn=0,vs=0,Th=0,qc=-1,Gc=-1;const Mn={};let kh=as(""),Zc=0,Hc=0;if(si._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Zc,Hc]=si.layout.get("text-offset").evaluate(yt,{},Bi).map(ir=>ir*vi):(Zc=si.layout.get("text-radial-offset").evaluate(yt,{},Bi)*vi,Hc=Dc),Ye.allowVerticalPlacement&&Gt.vertical){const ir=si.layout.get("text-rotate").evaluate(yt,{},Bi)+90;Br=new Il(gi,bt,Si,Di,Ji,Gt.vertical,li,Ii,Li,ir),ai&&(br=new Il(gi,bt,Si,Di,Ji,ai,Qi,er,Li,ir))}if(Zt){const ir=si.layout.get("icon-rotate").evaluate(yt,{}),nn=si.layout.get("icon-text-fit")!=="none",ws=lh(Zt,ir,zi,nn),As=ai?lh(ai,ir,zi,nn):void 0;kn=new Il(gi,bt,Si,Di,Ji,Zt,Qi,er,!1,ir),tr=4*ws.length;const Ph=Ye.iconSizeData;let Co=null;Ph.kind==="source"?(Co=[Tn*si.layout.get("icon-size").evaluate(yt,{})],Co[0]>eo&&Ke(`${Ye.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ph.kind==="composite"&&(Co=[Tn*lr.compositeIconSizes[0].evaluate(yt,{},Bi),Tn*lr.compositeIconSizes[1].evaluate(yt,{},Bi)],(Co[0]>eo||Co[1]>eo)&&Ke(`${Ye.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ye.addSymbols(Ye.icon,ws,Co,yi,Xt,yt,a.WritingMode.none,bt,Hr.lineStartIndex,Hr.lineLength,-1,Bi),qc=Ye.icon.placedSymbolArray.length-1,As&&(Cn=4*As.length,Ye.addSymbols(Ye.icon,As,Co,yi,Xt,yt,a.WritingMode.vertical,bt,Hr.lineStartIndex,Hr.lineLength,-1,Bi),Gc=Ye.icon.placedSymbolArray.length-1)}const Ch=Object.keys(Gt.horizontal);for(const ir of Ch){const nn=Gt.horizontal[ir];if(!Wr){kh=as(nn.text);const As=si.layout.get("text-rotate").evaluate(yt,{},Bi);Wr=new Il(gi,bt,Si,Di,Ji,nn,li,Ii,Li,As)}const ws=nn.positionedLines.length===1;if(vs+=hh(Ye,bt,nn,Ei,si,Li,yt,$i,Hr,Gt.vertical?a.WritingMode.horizontal:a.WritingMode.horizontalOnly,ws?Ch:[ir],Mn,qc,lr,Bi),ws)break}Gt.vertical&&(Th+=hh(Ye,bt,Gt.vertical,Ei,si,Li,yt,$i,Hr,a.WritingMode.vertical,["vertical"],Mn,Gc,lr,Bi));const mm=Wr?Wr.boxStartIndex:Ye.collisionBoxArray.length,fm=Wr?Wr.boxEndIndex:Ye.collisionBoxArray.length,gm=Br?Br.boxStartIndex:Ye.collisionBoxArray.length,ym=Br?Br.boxEndIndex:Ye.collisionBoxArray.length,_m=kn?kn.boxStartIndex:Ye.collisionBoxArray.length,xm=kn?kn.boxEndIndex:Ye.collisionBoxArray.length,bm=br?br.boxStartIndex:Ye.collisionBoxArray.length,vm=br?br.boxEndIndex:Ye.collisionBoxArray.length;let Xr=-1;const Ml=(ir,nn)=>ir&&ir.circleDiameter?Math.max(ir.circleDiameter,nn):nn;Xr=Ml(Wr,Xr),Xr=Ml(Br,Xr),Xr=Ml(kn,Xr),Xr=Ml(br,Xr);const Mh=Xr>-1?1:0;Mh&&(Xr*=Lr/vi),Ye.glyphOffsetArray.length>=va.MAX_GLYPHS&&Ke("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yt.sortKey!==void 0&&Ye.addToSortKeyRanges(Ye.symbolInstances.length,yt.sortKey),Ye.symbolInstances.emplaceBack(bt.x,bt.y,Mn.right>=0?Mn.right:-1,Mn.center>=0?Mn.center:-1,Mn.left>=0?Mn.left:-1,Mn.vertical||-1,qc,Gc,kh,mm,fm,gm,ym,_m,xm,bm,vm,Si,vs,Th,tr,Cn,Mh,0,li,Zc,Hc,Xr)}(i,et,ze,r,o,l,Ue,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,Y,ge,Ne,y,ce,Ae,Xe,B,e,h,w,I,p)};if(Be==="line")for(const ze of sh(e.geometry,0,0,di,di)){const et=Yd(ze,le,xe,r.vertical||R,o,24,oe,i.overscaling,di);for(const Ye of et){const bt=R;bt&&im(i,bt.text,Re,Ye)||Fe(ze,Ye)}}else if(Be==="line-center"){for(const ze of e.geometry)if(ze.length>1){const et=Xd(ze,xe,r.vertical||R,o,24,oe);et&&Fe(ze,et)}}else if(e.type==="Polygon")for(const ze of vc(e.geometry,0)){const et=Qd(ze,16);Fe(ze[0],new Qn(et.x,et.y,0))}else if(e.type==="LineString")for(const ze of e.geometry)Fe(ze,new Qn(ze[0].x,ze[0].y,0));else if(e.type==="Point")for(const ze of e.geometry)for(const et of ze)Fe([et],new Qn(et.x,et.y,0))}const eo=32640;function hh(i,e,r,o,l,h,p,f,y,w,I,T,M,B,R){const X=function(ce,le,ge,Ae,xe,Ne,Xe,Be){const Re=Ae.layout.get("text-rotate").evaluate(Ne,{})*Math.PI/180,ke=[];for(const Ue of le.positionedLines)for(const Fe of Ue.positionedGlyphs){if(!Fe.rect)continue;const ze=Fe.rect||{};let et=4,Ye=!0,bt=1,Pt=0;const Gt=(xe||Be)&&Fe.vertical,Zt=Fe.metrics.advance*Fe.scale/2;if(Be&&le.verticalizable){const Xt=(Fe.scale-1)*vi,yi=(vi-Fe.metrics.width*Fe.scale)/2;Pt=Ue.lineOffset/2-(Fe.imageName?-yi:Xt)}if(Fe.imageName){const Xt=Xe[Fe.imageName];Ye=Xt.sdf,bt=Xt.pixelRatio,et=1/bt}const Ei=xe?[Fe.x+Zt,Fe.y]:[0,0];let ai=xe?[0,0]:[Fe.x+Zt+ge[0],Fe.y+ge[1]-Pt],si=[0,0];Gt&&(si=ai,ai=[0,0]);const gi=(Fe.metrics.left-et)*Fe.scale-Zt+ai[0],Si=(-Fe.metrics.top-et)*Fe.scale+ai[1],Di=gi+ze.w*Fe.scale/bt,Ji=Si+ze.h*Fe.scale/bt,li=new Ve(gi,Si),Ii=new Ve(Di,Si),Li=new Ve(gi,Ji),$i=new Ve(Di,Ji);if(Gt){const Xt=new Ve(-Zt,Zt-bl),yi=-Math.PI/2,yt=12-Zt,lr=new Ve(22-yt,-(Fe.imageName?yt:0)),zi=new Ve(...si);li._rotateAround(yi,Xt)._add(lr)._add(zi),Ii._rotateAround(yi,Xt)._add(lr)._add(zi),Li._rotateAround(yi,Xt)._add(lr)._add(zi),$i._rotateAround(yi,Xt)._add(lr)._add(zi)}if(Re){const Xt=Math.sin(Re),yi=Math.cos(Re),yt=[yi,-Xt,Xt,yi];li._matMult(yt),Ii._matMult(yt),Li._matMult(yt),$i._matMult(yt)}const Qi=new Ve(0,0),er=new Ve(0,0);ke.push({tl:li,tr:Ii,bl:Li,br:$i,tex:ze,writingMode:le.writingMode,glyphOffset:Ei,sectionIndex:Fe.sectionIndex,isSDF:Ye,pixelOffsetTL:Qi,pixelOffsetBR:er,minFontScaleX:0,minFontScaleY:0})}return ke}(0,r,f,l,h,p,o,i.allowVerticalPlacement),Y=i.textSizeData;let oe=null;Y.kind==="source"?(oe=[Tn*l.layout.get("text-size").evaluate(p,{})],oe[0]>eo&&Ke(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Y.kind==="composite"&&(oe=[Tn*B.compositeTextSizes[0].evaluate(p,{},R),Tn*B.compositeTextSizes[1].evaluate(p,{},R)],(oe[0]>eo||oe[1]>eo)&&Ke(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,X,oe,f,h,p,w,e,y.lineStartIndex,y.lineLength,M,R);for(const ce of I)T[ce]=i.text.placedSymbolArray.length-1;return 4*X.length}function ph(i){for(const e in i)return i[e];return null}function im(i,e,r,o){const l=i.compareText;if(e in l){const h=l[e];for(let p=h.length-1;p>=0;p--)if(o.dist(h[p])<r)return!0}else l[e]=[];return l[e].push(o),!1}const rm=Kn.VectorTileFeature.types,nm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zl(i,e,r,o,l,h,p,f,y,w,I,T,M){const B=f?Math.min(eo,Math.round(f[0])):0,R=f?Math.min(eo,Math.round(f[1])):0;i.emplaceBack(e,r,Math.round(32*o),Math.round(32*l),h,p,(B<<1)+(y?1:0),R,16*w,16*I,256*T,256*M)}function Bc(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function om(i){for(const e of i.sections)if(ac(e.text))return!0;return!1}class Rc{constructor(e){this.layoutVertexArray=new bi,this.indexArray=new Ui,this.programConfigurations=e,this.segments=new zt,this.dynamicLayoutVertexArray=new Yi,this.opacityVertexArray=new ar,this.placedSymbolArray=new Se}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,o,l){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Td.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,kd.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,nm,!0),this.opacityVertexBuffer.itemSize=1),(o||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}$e("SymbolBuffers",Rc);class Fc{constructor(e,r,o){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new o,this.segments=new zt,this.collisionVertexArray=new rn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Cd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}$e("CollisionBuffers",Fc);class va{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=mc([]),this.placementViewportMatrix=mc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=th(this.zoom,r["text-size"]),this.iconSizeData=th(this.zoom,r["icon-size"]);const o=this.layers[0].layout,l=o.get("symbol-sort-key"),h=o.get("symbol-z-order");this.canOverlap=Vc(o,"text-overlap","text-allow-overlap")!=="never"||Vc(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(p=>a.WritingMode[p])),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID}createArrays(){this.text=new Rc(new Io(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Rc(new Io(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new qe,this.lineVertexArray=new Le,this.symbolInstances=new ye}calculateGlyphDependencies(e,r,o,l,h){for(let p=0;p<e.length;p++)if(r[e.charCodeAt(p)]=!0,(o||l)&&h){const f=ys[e.charAt(p)];f&&(r[f.charCodeAt(0)]=!0)}}populate(e,r,o){const l=this.layers[0],h=l.layout,p=h.get("text-font"),f=h.get("text-field"),y=h.get("icon-image"),w=(f.value.kind!=="constant"||f.value.value instanceof q&&!f.value.value.isEmpty()||f.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),I=y.value.kind!=="constant"||!!y.value.value||Object.keys(y.parameters).length>0,T=h.get("symbol-sort-key");if(this.features=[],!w&&!I)return;const M=r.iconDependencies,B=r.glyphDependencies,R=r.availableImages,X=new jt(this.zoom);for(const{feature:Y,id:oe,index:ce,sourceLayerIndex:le}of e){const ge=l._featureFilter.needGeometry,Ae=To(Y,ge);if(!l._featureFilter.filter(X,Ae,o))continue;let xe,Ne;if(ge||(Ae.geometry=zo(Y)),w){const Be=l.getValueAndResolveTokens("text-field",Ae,o,R),Re=q.factory(Be);om(Re)&&(this.hasRTLText=!0),(!this.hasRTLText||rs()==="unavailable"||this.hasRTLText&&or.isParsed())&&(xe=Pd(Re,l,Ae))}if(I){const Be=l.getValueAndResolveTokens("icon-image",Ae,o,R);Ne=Be instanceof Q?Be:Q.fromString(Be)}if(!xe&&!Ne)continue;const Xe=this.sortFeaturesByKey?T.evaluate(Ae,{},o):void 0;if(this.features.push({id:oe,text:xe,icon:Ne,index:ce,sourceLayerIndex:le,geometry:Ae.geometry,properties:Y.properties,type:rm[Y.type],sortKey:Xe}),Ne&&(M[Ne.name]=!0),xe){const Be=p.evaluate(Ae,{},o).join(","),Re=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.WritingMode.vertical)>=0;for(const ke of xe.sections)if(ke.image)M[ke.image.name]=!0;else{const Ue=Ja(xe.toString()),Fe=ke.fontStack||Be,ze=B[Fe]=B[Fe]||{};this.calculateGlyphDependencies(ke.text,ze,Re,this.allowVerticalPlacement,Ue)}}}h.get("symbol-placement")==="line"&&(this.features=function(Y){const oe={},ce={},le=[];let ge=0;function Ae(Be){le.push(Y[Be]),ge++}function xe(Be,Re,ke){const Ue=ce[Be];return delete ce[Be],ce[Re]=Ue,le[Ue].geometry[0].pop(),le[Ue].geometry[0]=le[Ue].geometry[0].concat(ke[0]),Ue}function Ne(Be,Re,ke){const Ue=oe[Re];return delete oe[Re],oe[Be]=Ue,le[Ue].geometry[0].shift(),le[Ue].geometry[0]=ke[0].concat(le[Ue].geometry[0]),Ue}function Xe(Be,Re,ke){const Ue=ke?Re[0][Re[0].length-1]:Re[0][0];return`${Be}:${Ue.x}:${Ue.y}`}for(let Be=0;Be<Y.length;Be++){const Re=Y[Be],ke=Re.geometry,Ue=Re.text?Re.text.toString():null;if(!Ue){Ae(Be);continue}const Fe=Xe(Ue,ke),ze=Xe(Ue,ke,!0);if(Fe in ce&&ze in oe&&ce[Fe]!==oe[ze]){const et=Ne(Fe,ze,ke),Ye=xe(Fe,ze,le[et].geometry);delete oe[Fe],delete ce[ze],ce[Xe(Ue,le[Ye].geometry,!0)]=Ye,le[et].geometry=null}else Fe in ce?xe(Fe,ze,ke):ze in oe?Ne(Fe,ze,ke):(Ae(Be),oe[Fe]=ge-1,ce[ze]=ge-1)}return le.filter(Be=>Be.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Y,oe)=>Y.sortKey-oe.sortKey)}update(e,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const o=this.lineVertexArray.length;if(e.segment!==void 0){let l=e.dist(r[e.segment+1]),h=e.dist(r[e.segment]);const p={};for(let f=e.segment+1;f<r.length;f++)p[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:l},f<r.length-1&&(l+=r[f+1].dist(r[f]));for(let f=e.segment||0;f>=0;f--)p[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:h},f>0&&(h+=r[f-1].dist(r[f]));for(let f=0;f<r.length;f++){const y=p[f];this.lineVertexArray.emplaceBack(y.x,y.y,y.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,r,o,l,h,p,f,y,w,I,T,M){const B=e.indexArray,R=e.layoutVertexArray,X=e.segments.prepareSegment(4*r.length,R,B,this.canOverlap?p.sortKey:void 0),Y=this.glyphOffsetArray.length,oe=X.vertexLength,ce=this.allowVerticalPlacement&&f===a.WritingMode.vertical?Math.PI/2:0,le=p.text&&p.text.sections;for(let ge=0;ge<r.length;ge++){const{tl:Ae,tr:xe,bl:Ne,br:Xe,tex:Be,pixelOffsetTL:Re,pixelOffsetBR:ke,minFontScaleX:Ue,minFontScaleY:Fe,glyphOffset:ze,isSDF:et,sectionIndex:Ye}=r[ge],bt=X.vertexLength,Pt=ze[1];zl(R,y.x,y.y,Ae.x,Pt+Ae.y,Be.x,Be.y,o,et,Re.x,Re.y,Ue,Fe),zl(R,y.x,y.y,xe.x,Pt+xe.y,Be.x+Be.w,Be.y,o,et,ke.x,Re.y,Ue,Fe),zl(R,y.x,y.y,Ne.x,Pt+Ne.y,Be.x,Be.y+Be.h,o,et,Re.x,ke.y,Ue,Fe),zl(R,y.x,y.y,Xe.x,Pt+Xe.y,Be.x+Be.w,Be.y+Be.h,o,et,ke.x,ke.y,Ue,Fe),Bc(e.dynamicLayoutVertexArray,y,ce),B.emplaceBack(bt,bt+1,bt+2),B.emplaceBack(bt+1,bt+2,bt+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ze[0]),ge!==r.length-1&&Ye===r[ge+1].sectionIndex||e.programConfigurations.populatePaintArrays(R.length,p,p.index,{},M,le&&le[Ye])}e.placedSymbolArray.emplaceBack(y.x,y.y,Y,this.glyphOffsetArray.length-Y,oe,w,I,y.segment,o?o[0]:0,o?o[1]:0,l[0],l[1],f,0,!1,0,T)}_addCollisionDebugVertex(e,r,o,l,h,p){return r.emplaceBack(0,0),e.emplaceBack(o.x,o.y,l,h,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,r,o,l,h,p,f){const y=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),w=y.vertexLength,I=h.layoutVertexArray,T=h.collisionVertexArray,M=f.anchorX,B=f.anchorY;this._addCollisionDebugVertex(I,T,p,M,B,new Ve(e,r)),this._addCollisionDebugVertex(I,T,p,M,B,new Ve(o,r)),this._addCollisionDebugVertex(I,T,p,M,B,new Ve(o,l)),this._addCollisionDebugVertex(I,T,p,M,B,new Ve(e,l)),y.vertexLength+=4;const R=h.indexArray;R.emplaceBack(w,w+1),R.emplaceBack(w+1,w+2),R.emplaceBack(w+2,w+3),R.emplaceBack(w+3,w),y.primitiveLength+=4}addDebugCollisionBoxes(e,r,o,l){for(let h=e;h<r;h++){const p=this.collisionBoxArray.get(h);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,l?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Fc(sr,$u.members,Cr),this.iconCollisionBox=new Fc(sr,$u.members,Cr);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,o,l,h,p,f,y,w){const I={};for(let T=r;T<o;T++){const M=e.get(T);I.textBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},I.textFeatureIndex=M.featureIndex;break}for(let T=l;T<h;T++){const M=e.get(T);I.verticalTextBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},I.verticalTextFeatureIndex=M.featureIndex;break}for(let T=p;T<f;T++){const M=e.get(T);I.iconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},I.iconFeatureIndex=M.featureIndex;break}for(let T=y;T<w;T++){const M=e.get(T);I.verticalIconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},I.verticalIconFeatureIndex=M.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const o=e.placedSymbolArray.get(r),l=o.vertexStartIndex+4*o.numGlyphs;for(let h=o.vertexStartIndex;h<l;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),o=Math.cos(e),l=[],h=[],p=[];for(let f=0;f<this.symbolInstances.length;++f){p.push(f);const y=this.symbolInstances.get(f);l.push(0|Math.round(r*y.anchorX+o*y.anchorY)),h.push(y.featureIndex)}return p.sort((f,y)=>l[f]-l[y]||h[y]-h[f]),p}addToSortKeyRanges(e,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((l,h,p)=>{l>=0&&p.indexOf(l)===h&&this.addIndicesForPlacedSymbol(this.text,l)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}$e("SymbolBucket",va,{omit:["layers","collisionBoxArray","features","compareText"]}),va.MAX_GLYPHS=65535,va.addDynamicAttributes=Bc;const am=new hi({"symbol-placement":new Ze(fe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ze(fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ze(fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Qe(fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ze(fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ze(fe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ze(fe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ze(fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ze(fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ze(fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Qe(fe.layout_symbol["icon-size"]),"icon-text-fit":new Ze(fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ze(fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Qe(fe.layout_symbol["icon-image"]),"icon-rotate":new Qe(fe.layout_symbol["icon-rotate"]),"icon-padding":new Ze(fe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ze(fe.layout_symbol["icon-keep-upright"]),"icon-offset":new Qe(fe.layout_symbol["icon-offset"]),"icon-anchor":new Qe(fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ze(fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ze(fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ze(fe.layout_symbol["text-rotation-alignment"]),"text-field":new Qe(fe.layout_symbol["text-field"]),"text-font":new Qe(fe.layout_symbol["text-font"]),"text-size":new Qe(fe.layout_symbol["text-size"]),"text-max-width":new Qe(fe.layout_symbol["text-max-width"]),"text-line-height":new Ze(fe.layout_symbol["text-line-height"]),"text-letter-spacing":new Qe(fe.layout_symbol["text-letter-spacing"]),"text-justify":new Qe(fe.layout_symbol["text-justify"]),"text-radial-offset":new Qe(fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ze(fe.layout_symbol["text-variable-anchor"]),"text-anchor":new Qe(fe.layout_symbol["text-anchor"]),"text-max-angle":new Ze(fe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ze(fe.layout_symbol["text-writing-mode"]),"text-rotate":new Qe(fe.layout_symbol["text-rotate"]),"text-padding":new Ze(fe.layout_symbol["text-padding"]),"text-keep-upright":new Ze(fe.layout_symbol["text-keep-upright"]),"text-transform":new Qe(fe.layout_symbol["text-transform"]),"text-offset":new Qe(fe.layout_symbol["text-offset"]),"text-allow-overlap":new Ze(fe.layout_symbol["text-allow-overlap"]),"text-overlap":new Ze(fe.layout_symbol["text-overlap"]),"text-ignore-placement":new Ze(fe.layout_symbol["text-ignore-placement"]),"text-optional":new Ze(fe.layout_symbol["text-optional"])});var Oc={paint:new hi({"icon-opacity":new Qe(fe.paint_symbol["icon-opacity"]),"icon-color":new Qe(fe.paint_symbol["icon-color"]),"icon-halo-color":new Qe(fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Qe(fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Qe(fe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ze(fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ze(fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Qe(fe.paint_symbol["text-opacity"]),"text-color":new Qe(fe.paint_symbol["text-color"],{runtimeType:Mi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Qe(fe.paint_symbol["text-halo-color"]),"text-halo-width":new Qe(fe.paint_symbol["text-halo-width"]),"text-halo-blur":new Qe(fe.paint_symbol["text-halo-blur"]),"text-translate":new Ze(fe.paint_symbol["text-translate"]),"text-translate-anchor":new Ze(fe.paint_symbol["text-translate-anchor"])}),layout:am};class dh{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ut,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$e("FormatSectionOverride",dh,{omit:["defaultValue"]});class Tl extends Vi{constructor(e){super(e,Oc)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const l=[];for(const h of o)l.indexOf(h)<0&&l.push(h);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,o,l){const h=this.layout.get(e).evaluate(r,{},o,l),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Wo(p.value)||!h?h:function(f,y){return y.replace(/{([^{}]+)}/g,(w,I)=>I in f?String(f[I]):"")}(r.properties,h)}createBucket(e){return new va(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Oc.paint.overridableProperties){if(!Tl.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),o=new dh(r),l=new Za(o,r.property.specification);let h=null;h=r.value.kind==="constant"||r.value.kind==="source"?new Yo("source",l):new Ko("composite",l,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new kr(r.property,h,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&Tl.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const o=e.get("text-field"),l=Oc.paint.properties[r];let h=!1;const p=f=>{for(const y of f)if(l.overrides&&l.overrides.hasOverride(y))return void(h=!0)};if(o.value.kind==="constant"&&o.value.value instanceof q)p(o.value.value.sections);else if(o.value.kind==="source"){const f=w=>{h||(w instanceof we&&ee(w.value)===fr?p(w.value.sections):w instanceof We?p(w.sections):w.eachChild(f))},y=o.value;y._styleExpression&&f(y._styleExpression.expression)}return h}}function Vc(i,e,r){let o="never";const l=i.get(e);return l?o=l:i.get(r)&&(o="always"),o}var sm={paint:new hi({"background-color":new Ze(fe.paint_background["background-color"]),"background-pattern":new Ao(fe.paint_background["background-pattern"]),"background-opacity":new Ze(fe.paint_background["background-opacity"])})},lm={paint:new hi({"raster-opacity":new Ze(fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ze(fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ze(fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ze(fe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ze(fe.paint_raster["raster-saturation"]),"raster-contrast":new Ze(fe.paint_raster["raster-contrast"]),"raster-resampling":new Ze(fe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ze(fe.paint_raster["raster-fade-duration"])})};class cm extends Vi{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}}const um={circle:class extends Vi{constructor(i){super(i,Np)}createBucket(i){return new hc(i)}queryRadius(i){const e=i;return ls("circle-radius",this,e)+ls("circle-stroke-width",this,e)+pl(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,o,l,h,p,f){const y=dl(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,p),w=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),I=this.paint.get("circle-pitch-alignment")==="map",T=I?y:function(B,R){return B.map(X=>Au(X,R))}(y,f),M=I?w*p:w;for(const B of o)for(const R of B){const X=I?R:Au(R,f);let Y=M;const oe=ml([],[R.x,R.y,0,1],f);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Y*=oe[3]/h.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Y*=h.cameraToCenterDistance/oe[3]),Fp(T,X,Y))return!0}return!1}},heatmap:class extends Vi{constructor(i){super(i,qp),this._updateColorRamp()}createBucket(i){return new Eu(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Iu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Vi{constructor(i){super(i,Gp)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Vi{constructor(i){super(i,sd)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Ec(i)}queryRadius(){return pl(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,o,l,h,p){return xu(dl(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,p),o)}isTileClipped(){return!0}},"fill-extrusion":class extends Vi{constructor(i){super(i,bd)}createBucket(i){return new Ic(i)}queryRadius(){return pl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,e,r,o,l,h,p,f){const y=dl(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,p),w=this.paint.get("fill-extrusion-height").evaluate(e,r),I=this.paint.get("fill-extrusion-base").evaluate(e,r),T=function(B,R,X,Y){const oe=[];for(const ce of B){const le=[ce.x,ce.y,0,1];ml(le,le,R),oe.push(new Ve(le[0]/le[3],le[1]/le[3]))}return oe}(y,f),M=function(B,R,X,Y){const oe=[],ce=[],le=Y[8]*R,ge=Y[9]*R,Ae=Y[10]*R,xe=Y[11]*R,Ne=Y[8]*X,Xe=Y[9]*X,Be=Y[10]*X,Re=Y[11]*X;for(const ke of B){const Ue=[],Fe=[];for(const ze of ke){const et=ze.x,Ye=ze.y,bt=Y[0]*et+Y[4]*Ye+Y[12],Pt=Y[1]*et+Y[5]*Ye+Y[13],Gt=Y[2]*et+Y[6]*Ye+Y[14],Zt=Y[3]*et+Y[7]*Ye+Y[15],Ei=Gt+Ae,ai=Zt+xe,si=bt+Ne,gi=Pt+Xe,Si=Gt+Be,Di=Zt+Re,Ji=new Ve((bt+le)/ai,(Pt+ge)/ai);Ji.z=Ei/ai,Ue.push(Ji);const li=new Ve(si/Di,gi/Di);li.z=Si/Di,Fe.push(li)}oe.push(Ue),ce.push(Fe)}return[oe,ce]}(o,I,w,f);return function(B,R,X){let Y=1/0;xu(X,R)&&(Y=Ru(X,R[0]));for(let oe=0;oe<R.length;oe++){const ce=R[oe],le=B[oe];for(let ge=0;ge<ce.length-1;ge++){const Ae=ce[ge],xe=[Ae,ce[ge+1],le[ge+1],le[ge],Ae];_u(X,xe)&&(Y=Math.min(Y,Ru(X,xe)))}}return Y!==1/0&&Y}(M[0],M[1],T)}},line:class extends Vi{constructor(i){super(i,Ou),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof co,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Vu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new zc(i)}queryRadius(i){const e=i,r=Uu(ls("line-width",this,e),ls("line-gap-width",this,e)),o=ls("line-offset",this,e);return r/2+Math.abs(o)+pl(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,o,l,h,p){const f=dl(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,p),y=p/2*Uu(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),w=this.paint.get("line-offset").evaluate(e,r);return w&&(o=function(I,T){const M=[];for(let B=0;B<I.length;B++){const R=I[B],X=[];for(let Y=0;Y<R.length;Y++){const oe=R[Y-1],ce=R[Y],le=R[Y+1],ge=Y===0?new Ve(0,0):ce.sub(oe)._unit()._perp(),Ae=Y===R.length-1?new Ve(0,0):le.sub(ce)._unit()._perp(),xe=ge._add(Ae)._unit(),Ne=xe.x*Ae.x+xe.y*Ae.y;Ne!==0&&xe._mult(1/Ne),X.push(xe._mult(T)._add(ce))}M.push(X)}return M}(o,w*p)),function(I,T,M){for(let B=0;B<T.length;B++){const R=T[B];if(I.length>=3){for(let X=0;X<R.length;X++)if(da(I,R[X]))return!0}if(Op(I,R,M))return!0}return!1}(f,o,y)}isTileClipped(){return!0}},symbol:Tl,background:class extends Vi{constructor(i){super(i,sm)}},raster:class extends Vi{constructor(i){super(i,lm)}}};class hm{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const mh=63710088e-1;class Qt{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Qt(se(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,o=this.lat*r,l=e.lat*r,h=Math.sin(o)*Math.sin(l)+Math.cos(o)*Math.cos(l)*Math.cos((e.lng-this.lng)*r);return mh*Math.acos(Math.min(h,1))}toBounds(e=0){const r=360*e/40075017,o=r/Math.cos(Math.PI/180*this.lat);return new ko(new Qt(this.lng-o,this.lat-r),new Qt(this.lng+o,this.lat+r))}static convert(e){if(e instanceof Qt)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Qt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Qt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ko{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Qt?new Qt(e.lng,e.lat):Qt.convert(e),this}setSouthWest(e){return this._sw=e instanceof Qt?new Qt(e.lng,e.lat):Qt.convert(e),this}extend(e){const r=this._sw,o=this._ne;let l,h;if(e instanceof Qt)l=e,h=e;else{if(!(e instanceof ko))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ko.convert(e)):this.extend(Qt.convert(e)):this;if(l=e._sw,h=e._ne,!l||!h)return this}return r||o?(r.lng=Math.min(l.lng,r.lng),r.lat=Math.min(l.lat,r.lat),o.lng=Math.max(h.lng,o.lng),o.lat=Math.max(h.lat,o.lat)):(this._sw=new Qt(l.lng,l.lat),this._ne=new Qt(h.lng,h.lat)),this}getCenter(){return new Qt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Qt(this.getWest(),this.getNorth())}getSouthEast(){return new Qt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:o}=Qt.convert(e);let l=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&l}static convert(e){return e instanceof ko?e:e&&new ko(e)}}const fh=2*Math.PI*mh;function gh(i){return fh*Math.cos(i*Math.PI/180)}function yh(i){return(180+i)/360}function _h(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function xh(i,e){return i/gh(e)}function Uc(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class kl{constructor(e,r,o=0){this.x=+e,this.y=+r,this.z=+o}static fromLngLat(e,r=0){const o=Qt.convert(e);return new kl(yh(o.lng),_h(o.lat),xh(r,o.lat))}toLngLat(){return new Qt(360*this.x-180,Uc(this.y))}toAltitude(){return this.z*gh(Uc(this.y))}meterInMercatorCoordinateUnits(){return 1/fh*(e=Uc(this.y),1/Math.cos(e*Math.PI/180));var e}}function bh(i,e,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class $c{constructor(e,r,o){this.z=e,this.x=r,this.y=o,this.key=xs(0,e,e,r,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,o){const l=(p=this.y,f=this.z,y=bh(256*(h=this.x),256*(p=Math.pow(2,f)-p-1),f),w=bh(256*(h+1),256*(p+1),f),y[0]+","+y[1]+","+w[0]+","+w[1]);var h,p,f,y,w;const I=function(T,M,B){let R,X="";for(let Y=T;Y>0;Y--)R=1<<Y-1,X+=(M&R?1:0)+(B&R?2:0);return X}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,l)}getTilePoint(e){const r=Math.pow(2,this.z);return new Ve((e.x*r-this.x)*di,(e.y*r-this.y)*di)}toString(){return`${this.z}/${this.x}/${this.y}`}}class vh{constructor(e,r){this.wrap=e,this.canonical=r,this.key=xs(e,r.z,r.z,r.x,r.y)}}class Dr{constructor(e,r,o,l,h){this.overscaledZ=e,this.wrap=r,this.canonical=new $c(o,+l,+h),this.key=xs(r,e,o,l,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new Dr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Dr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){const o=this.canonical.z-e;return e>this.canonical.z?xs(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):xs(this.wrap*+r,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Dr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,l=2*this.canonical.y;return[new Dr(r,this.wrap,r,o,l),new Dr(r,this.wrap,r,o+1,l),new Dr(r,this.wrap,r,o,l+1),new Dr(r,this.wrap,r,o+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Dr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Dr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new vh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new kl(e.x-this.wrap,e.y))}}function xs(i,e,r,o,l){(i*=2)<0&&(i=-1*i-1);const h=1<<r;return(h*h*i+h*l+o).toString(36)+r.toString(36)+e.toString(36)}$e("CanonicalTileID",$c),$e("OverscaledTileID",Dr,{omit:["posMatrix"]});class wh{constructor(e,r,o){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void Ke(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const l=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=o||"mapbox";for(let h=0;h<l;h++)this.data[this._idx(-1,h)]=this.data[this._idx(0,h)],this.data[this._idx(l,h)]=this.data[this._idx(l-1,h)],this.data[this._idx(h,-1)]=this.data[this._idx(h,0)],this.data[this._idx(h,l)]=this.data[this._idx(h,l-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(l,-1)]=this.data[this._idx(l-1,0)],this.data[this._idx(-1,l)]=this.data[this._idx(0,l-1)],this.data[this._idx(l,l)]=this.data[this._idx(l-1,l-1)]}get(e,r){const o=new Uint8Array(this.data.buffer),l=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(o[l],o[l+1],o[l+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,o){return(256*e*256+256*r+o)/10-1e4}_unpackTerrarium(e,r,o){return 256*e+r+o/256-32768}getPixels(){return new xr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,h=r*this.dim+this.dim,p=o*this.dim,f=o*this.dim+this.dim;switch(r){case-1:l=h-1;break;case 1:h=l+1}switch(o){case-1:p=f-1;break;case 1:f=p+1}const y=-r*this.dim,w=-o*this.dim;for(let I=p;I<f;I++)for(let T=l;T<h;T++)this.data[this._idx(T,I)]=e.data[this._idx(T+y,I+w)]}}$e("DEMData",wh);class Ah{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const o=e[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Eh{constructor(e,r,o,l,h){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=o,e._y=l,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Sh{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new bn(di,16,0),this.grid3D=new bn(di,16,0),this.featureIndexArray=new wt,this.promoteId=r}insert(e,r,o,l,h,p){const f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,l,h);const y=p?this.grid3D:this.grid;for(let w=0;w<r.length;w++){const I=r[w],T=[1/0,1/0,-1/0,-1/0];for(let M=0;M<I.length;M++){const B=I[M];T[0]=Math.min(T[0],B.x),T[1]=Math.min(T[1],B.y),T[2]=Math.max(T[2],B.x),T[3]=Math.max(T[3],B.y)}T[0]<di&&T[1]<di&&T[2]>=0&&T[3]>=0&&y.insert(f,T[0],T[1],T[2],T[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Kn.VectorTile(new Tc(this.rawTileData)).layers,this.sourceLayerCoder=new Ah(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,o,l){this.loadVTLayers();const h=e.params||{},p=di/e.tileSize/e.scale,f=ea(h.filter),y=e.queryGeometry,w=e.queryPadding*p,I=zh(y),T=this.grid.query(I.minX-w,I.minY-w,I.maxX+w,I.maxY+w),M=zh(e.cameraQueryGeometry),B=this.grid3D.query(M.minX-w,M.minY-w,M.maxX+w,M.maxY+w,(Y,oe,ce,le)=>function(ge,Ae,xe,Ne,Xe){for(const Re of ge)if(Ae<=Re.x&&xe<=Re.y&&Ne>=Re.x&&Xe>=Re.y)return!0;const Be=[new Ve(Ae,xe),new Ve(Ae,Xe),new Ve(Ne,Xe),new Ve(Ne,xe)];if(ge.length>2){for(const Re of Be)if(da(ge,Re))return!0}for(let Re=0;Re<ge.length-1;Re++)if(Up(ge[Re],ge[Re+1],Be))return!0;return!1}(e.cameraQueryGeometry,Y-w,oe-w,ce+w,le+w));for(const Y of B)T.push(Y);T.sort(pm);const R={};let X;for(let Y=0;Y<T.length;Y++){const oe=T[Y];if(oe===X)continue;X=oe;const ce=this.featureIndexArray.get(oe);let le=null;this.loadMatchingFeature(R,ce.bucketIndex,ce.sourceLayerIndex,ce.featureIndex,f,h.layers,h.availableImages,r,o,l,(ge,Ae,xe)=>(le||(le=zo(ge)),Ae.queryIntersectsFeature(y,ge,xe,le,this.z,e.transform,p,e.pixelPosMatrix)))}return R}loadMatchingFeature(e,r,o,l,h,p,f,y,w,I,T){const M=this.bucketLayerIDs[r];if(p&&!function(Y,oe){for(let ce=0;ce<Y.length;ce++)if(oe.indexOf(Y[ce])>=0)return!0;return!1}(p,M))return;const B=this.sourceLayerCoder.decode(o),R=this.vtLayers[B].feature(l);if(h.needGeometry){const Y=To(R,!0);if(!h.filter(new jt(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!h.filter(new jt(this.tileID.overscaledZ),R))return;const X=this.getId(R,B);for(let Y=0;Y<M.length;Y++){const oe=M[Y];if(p&&p.indexOf(oe)<0)continue;const ce=y[oe];if(!ce)continue;let le={};X&&I&&(le=I.getState(ce.sourceLayer||"_geojsonTileLayer",X));const ge=de({},w[oe]);ge.paint=Ih(ge.paint,ce.paint,R,le,f),ge.layout=Ih(ge.layout,ce.layout,R,le,f);const Ae=!T||T(R,ce,le);if(!Ae)continue;const xe=new Eh(R,this.z,this.x,this.y,X);xe.layer=ge;let Ne=e[oe];Ne===void 0&&(Ne=e[oe]=[]),Ne.push({featureIndex:l,feature:xe,intersectionZ:Ae})}}lookupSymbolFeatures(e,r,o,l,h,p,f,y){const w={};this.loadVTLayers();const I=ea(h);for(const T of e)this.loadMatchingFeature(w,o,l,T,I,p,f,y,r);return w}hasLayer(e){for(const r of this.bucketLayerIDs)for(const o of r)if(e===o)return!0;return!1}getId(e,r){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof o=="boolean"&&(o=Number(o))),o}}function Ih(i,e,r,o,l){return nt(i,(h,p)=>{const f=e instanceof la?e.get(p):null;return f&&f.evaluate?f.evaluate(r,o,l):f})}function zh(i){let e=1/0,r=1/0,o=-1/0,l=-1/0;for(const h of i)e=Math.min(e,h.x),r=Math.min(r,h.y),o=Math.max(o,h.x),l=Math.max(l,h.y);return{minX:e,minY:r,maxX:o,maxY:l}}function pm(i,e){return e-i}var Nc;$e("FeatureIndex",Sh,{omit:["rawTileData","sourceLayerCoder"]}),a.PerformanceMarkers=void 0,(Nc=a.PerformanceMarkers||(a.PerformanceMarkers={})).create="create",Nc.load="load",Nc.fullLoad="fullLoad";let Cl=null,bs=[];const jc=1e3/30,dm={mark(i){performance.mark(i)},frame(i){const e=i;Cl!=null&&bs.push(e-Cl),Cl=e},clearMetrics(){Cl=null,bs=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in a.PerformanceMarkers)performance.clearMarks(a.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.load),performance.measure("fullLoadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,r=bs.length,o=1/(bs.reduce((h,p)=>h+p,0)/r/1e3),l=bs.filter(h=>h>jc).reduce((h,p)=>h+(p-jc)/jc,0);return{loadTime:i,fullLoadTime:e,fps:o,percentDroppedFrames:l/(r+l)*100}}};a.AJAXError=mi,a.ARRAY_TYPE=ma,a.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},je(["receive","process"],this),this.invoker=new hm(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=At()?i:window}send(i,e,r,o,l=!1){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[h]=r);const p=Er(this.globalScope)?void 0:[];return this.target.postMessage({id:h,type:i,hasCallback:!!r,targetMapId:o,mustQueue:l,sourceMapId:this.mapId,data:xo(e,p)},p),{cancel:()=>{r&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[r];const o=this.cancelCallbacks[r];delete this.cancelCallbacks[r],o&&o()}else At()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(vn(e.error)):r(null,vn(e.data)))}else{let r=!1;const o=Er(this.globalScope)?void 0:[],l=e.hasCallback?(f,y)=>{r=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:f?xo(f):null,data:xo(y,o)},o)}:f=>{r=!0};let h=null;const p=vn(e.data);if(this.parent[e.type])h=this.parent[e.type](e.sourceMapId,p,l);else if(this.parent.getWorkerSource){const f=e.type.split(".");h=this.parent.getWorkerSource(e.sourceMapId,f[0],p.source)[f[1]](p,l)}else l(new Error(`Could not find function ${e.type}`));!r&&h&&h.cancel&&(this.cancelCallbacks[i]=h.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.AlphaImage=us,a.CanonicalTileID=$c,a.CollisionBoxArray=he,a.CollisionCircleLayoutArray=class extends S{},a.Color=z,a.DEMData=wh,a.DataConstantProperty=Ze,a.DictionaryCoder=Ah,a.EXTENT=di,a.ErrorEvent=un,a.EvaluationParameters=jt,a.Event=en,a.Evented=oo,a.FeatureIndex=Sh,a.FillBucket=Ec,a.FillExtrusionBucket=Ic,a.GeoJSONFeature=Eh,a.ImageAtlas=Xu,a.ImagePosition=Cc,a.LineBucket=zc,a.LineStripIndexArray=class extends ae{},a.LngLat=Qt,a.LngLatBounds=ko,a.MercatorCoordinate=kl,a.ONE_EM=vi,a.OverscaledTileID=Dr,a.PerformanceUtils=dm,a.PosArray=class extends Hn{},a.Properties=hi,a.QuadTriangleArray=class extends L{},a.RGBAImage=xr,a.RasterBoundsArray=class extends So{},a.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},a.ResourceType=Lo,a.SegmentVector=zt,a.SymbolBucket=va,a.Transitionable=ns,a.TriangleIndexArray=Ui,a.Uniform1f=Wn,a.Uniform1i=class extends Pr{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.Uniform2f=class extends Pr{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},a.Uniform3f=class extends Pr{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},a.Uniform4f=du,a.UniformColor=mu,a.UniformMatrix4f=class extends Pr{constructor(i,e){super(i,e),this.current=Bp}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},a.UnwrappedTileID=vh,a.ValidationError=De,a.ZoomHistory=bo,a.addDynamicAttributes=Bc,a.asyncAll=function(i,e,r){if(!i.length)return r(null,[]);let o=i.length;const l=new Array(i.length);let h=null;i.forEach((p,f)=>{e(p,(y,w)=>{y&&(h=y),l[f]=w,--o==0&&r(h,l)})})},a.bezier=ne,a.bindAll=je,a.cacheEntryPossiblyAdded=function(i){sn++,sn>Ur&&(i.getActor().send("enforceCacheSizeLimit",an),sn=0)},a.clamp=j,a.clearTileCache=function(i){const e=caches.delete(Kr);i&&e.catch(i).then(()=>i())},a.clipLine=sh,a.clone=function(i){var e=new ma(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},a.clone$1=mt,a.collisionCircleLayout=Md,a.config=Yr,a.create=function(){var i=new ma(16);return ma!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},a.createExpression=Xo,a.createFilter=ea,a.createLayout=pi,a.createStyleLayer=function(i){return i.type==="custom"?new cm(i):new um[i.type](i)},a.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},a.ease=W,a.emitValidationErrors=il,a.enforceCacheSizeLimit=function(i){Jr(),pr&&pr.then(e=>{e.keys().then(r=>{for(let o=0;o<r.length-i;o++)e.delete(r[o])})})},a.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:r},{lowerSize:o,upperSize:l}){return i.kind==="source"?o/Tn:i.kind==="composite"?ni(o/Tn,l/Tn,r):e},a.evaluateSizeForZoom=function(i,e){let r=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:h,maxZoom:p}=i,f=l?j(Wi.interpolationFactor(l,e,h,p),0,1):0;i.kind==="camera"?o=ni(i.minSize,i.maxSize,f):r=f}return{uSizeT:r,uSize:o}},a.evaluateVariableOffset=uh,a.evented=Zn,a.exported=Sr,a.exported$1=dr,a.extend=de,a.filterObject=Ct,a.getAnchorAlignment=Pc,a.getAnchorJustification=Lc,a.getArrayBuffer=Ir,a.getImage=no,a.getJSON=function(i,e){return ln(de(i,{type:"json"}),e)},a.getOverlapMode=Vc,a.getRTLTextPluginStatus=rs,a.getReferrer=Qr,a.getVideo=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let o=0;o<i.length;o++){const l=window.document.createElement("source");Bo(i[o])||(r.crossOrigin="Anonymous"),l.src=i[o],r.appendChild(l)}return{cancel:()=>{}}},a.identity=mc,a.invert=function(i,e){var r=e[0],o=e[1],l=e[2],h=e[3],p=e[4],f=e[5],y=e[6],w=e[7],I=e[8],T=e[9],M=e[10],B=e[11],R=e[12],X=e[13],Y=e[14],oe=e[15],ce=r*f-o*p,le=r*y-l*p,ge=r*w-h*p,Ae=o*y-l*f,xe=o*w-h*f,Ne=l*w-h*y,Xe=I*X-T*R,Be=I*Y-M*R,Re=I*oe-B*R,ke=T*Y-M*X,Ue=T*oe-B*X,Fe=M*oe-B*Y,ze=ce*Fe-le*Ue+ge*ke+Ae*Re-xe*Be+Ne*Xe;return ze?(i[0]=(f*Fe-y*Ue+w*ke)*(ze=1/ze),i[1]=(l*Ue-o*Fe-h*ke)*ze,i[2]=(X*Ne-Y*xe+oe*Ae)*ze,i[3]=(M*xe-T*Ne-B*Ae)*ze,i[4]=(y*Re-p*Fe-w*Be)*ze,i[5]=(r*Fe-l*Re+h*Be)*ze,i[6]=(Y*ge-R*Ne-oe*le)*ze,i[7]=(I*Ne-M*ge+B*le)*ze,i[8]=(p*Ue-f*Re+w*Xe)*ze,i[9]=(o*Re-r*Ue-h*Xe)*ze,i[10]=(R*xe-X*ge+oe*ce)*ze,i[11]=(T*ge-I*xe-B*ce)*ze,i[12]=(f*Be-p*ke-y*Xe)*ze,i[13]=(r*ke-o*Be+l*Xe)*ze,i[14]=(X*le-R*Ae-Y*ce)*ze,i[15]=(I*Ae-T*le+M*ce)*ze,i):null},a.isImageBitmap=Hi,a.isSafari=Er,a.keysDifference=function(i,e){const r=[];for(const o in i)o in e||r.push(o);return r},a.lazyLoadRTLTextPlugin=function(){or.isLoading()||or.isLoaded()||rs()!=="deferred"||oa()},a.makeRequest=ln,a.mapObject=nt,a.mercatorXfromLng=yh,a.mercatorYfromLat=_h,a.mercatorZfromAltitude=xh,a.mul=jp,a.multiply=wu,a.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},a.number=ni,a.ortho=function(i,e,r,o,l,h,p){var f=1/(e-r),y=1/(o-l),w=1/(h-p);return i[0]=-2*f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*w,i[11]=0,i[12]=(e+r)*f,i[13]=(l+o)*y,i[14]=(p+h)*w,i[15]=1,i},a.parseCacheControl=Ht,a.parseGlyphPBF=function(i){return new Tc(i).readFields(Nd,[])},a.pbf=Tc,a.performSymbolLayout=function(i,e,r,o,l,h,p){i.createArrays(),i.tilePixelRatio=di/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const f=i.layers[0].layout,y=i.layers[0]._unevaluatedLayout._values,w={layoutIconSize:y["icon-size"].possiblyEvaluate(new jt(i.zoom+1),p),layoutTextSize:y["text-size"].possiblyEvaluate(new jt(i.zoom+1),p),textMaxSize:y["text-size"].possiblyEvaluate(new jt(18))};if(i.textSizeData.kind==="composite"){const{minZoom:R,maxZoom:X}=i.textSizeData;w.compositeTextSizes=[y["text-size"].possiblyEvaluate(new jt(R),p),y["text-size"].possiblyEvaluate(new jt(X),p)]}if(i.iconSizeData.kind==="composite"){const{minZoom:R,maxZoom:X}=i.iconSizeData;w.compositeIconSizes=[y["icon-size"].possiblyEvaluate(new jt(R),p),y["icon-size"].possiblyEvaluate(new jt(X),p)]}const I=f.get("text-line-height")*vi,T=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",M=f.get("text-keep-upright"),B=f.get("text-size");for(const R of i.features){const X=f.get("text-font").evaluate(R,{},p).join(","),Y=B.evaluate(R,{},p),oe=w.layoutTextSize.evaluate(R,{},p),ce=w.layoutIconSize.evaluate(R,{},p),le={horizontal:{},vertical:void 0},ge=R.text;let Ae,xe=[0,0];if(ge){const Be=ge.toString(),Re=f.get("text-letter-spacing").evaluate(R,{},p)*vi,ke=rl(Be)?Re:0,Ue=f.get("text-anchor").evaluate(R,{},p),Fe=f.get("text-variable-anchor");if(!Fe){const Pt=f.get("text-radial-offset").evaluate(R,{},p);xe=Pt?uh(Ue,[Pt*vi,Dc]):f.get("text-offset").evaluate(R,{},p).map(Gt=>Gt*vi)}let ze=T?"center":f.get("text-justify").evaluate(R,{},p);const et=f.get("symbol-placement"),Ye=et==="point"?f.get("text-max-width").evaluate(R,{},p)*vi:0,bt=()=>{i.allowVerticalPlacement&&Ja(Be)&&(le.vertical=vl(ge,e,r,l,X,Ye,I,Ue,"left",ke,xe,a.WritingMode.vertical,!0,et,oe,Y))};if(!T&&Fe){const Pt=ze==="auto"?Fe.map(Zt=>Lc(Zt)):[ze];let Gt=!1;for(let Zt=0;Zt<Pt.length;Zt++){const Ei=Pt[Zt];if(!le.horizontal[Ei])if(Gt)le.horizontal[Ei]=le.horizontal[0];else{const ai=vl(ge,e,r,l,X,Ye,I,"center",Ei,ke,xe,a.WritingMode.horizontal,!1,et,oe,Y);ai&&(le.horizontal[Ei]=ai,Gt=ai.positionedLines.length===1)}}bt()}else{ze==="auto"&&(ze=Lc(Ue));const Pt=vl(ge,e,r,l,X,Ye,I,Ue,ze,ke,xe,a.WritingMode.horizontal,!1,et,oe,Y);Pt&&(le.horizontal[ze]=Pt),bt(),Ja(Be)&&T&&M&&(le.vertical=vl(ge,e,r,l,X,Ye,I,Ue,ze,ke,xe,a.WritingMode.vertical,!1,et,oe,Y))}}let Ne=!1;if(R.icon&&R.icon.name){const Be=o[R.icon.name];Be&&(Ae=Wd(l[R.icon.name],f.get("icon-offset").evaluate(R,{},p),f.get("icon-anchor").evaluate(R,{},p)),Ne=!!Be.sdf,i.sdfIcons===void 0?i.sdfIcons=Ne:i.sdfIcons!==Ne&&Ke("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Be.pixelRatio!==i.pixelRatio||f.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Xe=ph(le.horizontal)||le.vertical;i.iconsInText=!!Xe&&Xe.iconsInText,(Xe||Ae)&&tm(i,R,le,Ae,o,w,oe,ce,xe,Ne,p)}h&&i.generateCollisionDebugBuffers()},a.perspective=function(i,e,r,o,l){var h,p=1/Math.tan(e/2);return i[0]=p/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+o)*(h=1/(o-l)),i[14]=2*l*o*h):(i[10]=-1,i[14]=-2*o),i},a.pick=function(i,e){const r={};for(let o=0;o<e.length;o++){const l=e[o];l in i&&(r[l]=i[l])}return r},a.plugin=or,a.pointGeometry=Ve,a.polygonIntersectsPolygon=_u,a.potpack=Wu,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.register=$e,a.registerForPluginStateChange=function(i){return i({pluginStatus:Oi,pluginURL:tn}),Zn.on("pluginStateChange",i),i},a.renderColorRamp=Iu,a.rotateX=function(i,e,r){var o=Math.sin(r),l=Math.cos(r),h=e[4],p=e[5],f=e[6],y=e[7],w=e[8],I=e[9],T=e[10],M=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=h*l+w*o,i[5]=p*l+I*o,i[6]=f*l+T*o,i[7]=y*l+M*o,i[8]=w*l-h*o,i[9]=I*l-p*o,i[10]=T*l-f*o,i[11]=M*l-y*o,i},a.rotateZ=function(i,e,r){var o=Math.sin(r),l=Math.cos(r),h=e[0],p=e[1],f=e[2],y=e[3],w=e[4],I=e[5],T=e[6],M=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*l+w*o,i[1]=p*l+I*o,i[2]=f*l+T*o,i[3]=y*l+M*o,i[4]=w*l-h*o,i[5]=I*l-p*o,i[6]=T*l-f*o,i[7]=M*l-y*o,i},a.scale=function(i,e,r){var o=r[0],l=r[1],h=r[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*h,i[9]=e[9]*h,i[10]=e[10]*h,i[11]=e[11]*h,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.scale$1=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i},a.setCacheLimits=function(i,e){an=i,Ur=e},a.setRTLTextPlugin=function(i,e,r=!1){if(Oi===na||Oi===Qa||Oi===es)throw new Error("setRTLTextPlugin cannot be called multiple times.");tn=Sr.resolveURL(i),Oi=na,ts=e,is(),r||oa()},a.spec=fe,a.sphericalToCartesian=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},a.toEvaluationFeature=To,a.transformMat4=ml,a.translate=function(i,e,r){var o,l,h,p,f,y,w,I,T,M,B,R,X=r[0],Y=r[1],oe=r[2];return e===i?(i[12]=e[0]*X+e[4]*Y+e[8]*oe+e[12],i[13]=e[1]*X+e[5]*Y+e[9]*oe+e[13],i[14]=e[2]*X+e[6]*Y+e[10]*oe+e[14],i[15]=e[3]*X+e[7]*Y+e[11]*oe+e[15]):(l=e[1],h=e[2],p=e[3],f=e[4],y=e[5],w=e[6],I=e[7],T=e[8],M=e[9],B=e[10],R=e[11],i[0]=o=e[0],i[1]=l,i[2]=h,i[3]=p,i[4]=f,i[5]=y,i[6]=w,i[7]=I,i[8]=T,i[9]=M,i[10]=B,i[11]=R,i[12]=o*X+f*Y+T*oe+e[12],i[13]=l*X+y*Y+M*oe+e[13],i[14]=h*X+w*Y+B*oe+e[14],i[15]=p*X+I*Y+R*oe+e[15]),i},a.triggerPluginCompletionEvent=al,a.unicodeBlockLookup=Pe,a.uniqueId=function(){return Ce++},a.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateLight=ic,a.validateStyle=xn,a.vectorTile=Kn,a.warnOnce=Ke,a.wrap=se}),E(["./shared"],function(a){function U($){const A=typeof $;if(A==="number"||A==="boolean"||A==="string"||$==null)return JSON.stringify($);if(Array.isArray($)){let N="[";for(const q of $)N+=`${U(q)},`;return`${N}]`}const z=Object.keys($).sort();let F="{";for(let N=0;N<z.length;N++)F+=`${JSON.stringify(z[N])}:${U($[z[N]])},`;return`${F}}`}function G($){let A="";for(const z of a.refProperties)A+=`/${U($[z])}`;return A}class ne{constructor(A){this.keyCache={},A&&this.replace(A)}replace(A){this._layerConfigs={},this._layers={},this.update(A,[])}update(A,z){for(const N of A){this._layerConfigs[N.id]=N;const q=this._layers[N.id]=a.createStyleLayer(N);q._featureFilter=a.createFilter(q.filter),this.keyCache[N.id]&&delete this.keyCache[N.id]}for(const N of z)delete this.keyCache[N],delete this._layerConfigs[N],delete this._layers[N];this.familiesBySource={};const F=function(N,q){const Q={};for(let J=0;J<N.length;J++){const ee=q&&q[N[J].id]||G(N[J]);q&&(q[N[J].id]=ee);let pe=Q[ee];pe||(pe=Q[ee]=[]),pe.push(N[J])}const K=[];for(const J in Q)K.push(Q[J]);return K}(Object.values(this._layerConfigs),this.keyCache);for(const N of F){const q=N.map(we=>this._layers[we.id]),Q=q[0];if(Q.visibility==="none")continue;const K=Q.source||"";let J=this.familiesBySource[K];J||(J=this.familiesBySource[K]={});const ee=Q.sourceLayer||"_geojsonTileLayer";let pe=J[ee];pe||(pe=J[ee]=[]),pe.push(q)}}}class W{constructor(A){const z={},F=[];for(const K in A){const J=A[K],ee=z[K]={};for(const pe in J){const we=J[+pe];if(!we||we.bitmap.width===0||we.bitmap.height===0)continue;const ue={x:0,y:0,w:we.bitmap.width+2,h:we.bitmap.height+2};F.push(ue),ee[pe]={rect:ue,metrics:we.metrics}}}const{w:N,h:q}=a.potpack(F),Q=new a.AlphaImage({width:N||1,height:q||1});for(const K in A){const J=A[K];for(const ee in J){const pe=J[+ee];if(!pe||pe.bitmap.width===0||pe.bitmap.height===0)continue;const we=z[K][ee].rect;a.AlphaImage.copy(pe.bitmap,Q,{x:0,y:0},{x:we.x+1,y:we.y+1},pe.bitmap)}}this.image=Q,this.positions=z}}a.register("GlyphAtlas",W);class j{constructor(A){this.tileID=new a.OverscaledTileID(A.tileID.overscaledZ,A.tileID.wrap,A.tileID.canonical.z,A.tileID.canonical.x,A.tileID.canonical.y),this.uid=A.uid,this.zoom=A.zoom,this.pixelRatio=A.pixelRatio,this.tileSize=A.tileSize,this.source=A.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=A.showCollisionBoxes,this.collectResourceTiming=!!A.collectResourceTiming,this.returnDependencies=!!A.returnDependencies,this.promoteId=A.promoteId}parse(A,z,F,N,q){this.status="parsing",this.data=A,this.collisionBoxArray=new a.CollisionBoxArray;const Q=new a.DictionaryCoder(Object.keys(A.layers).sort()),K=new a.FeatureIndex(this.tileID,this.promoteId);K.bucketLayerIDs=[];const J={},ee={featureIndex:K,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:F},pe=z.familiesBySource[this.source];for(const ft in pe){const pt=A.layers[ft];if(!pt)continue;pt.version===1&&a.warnOnce(`Vector tile source "${this.source}" layer "${ft}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ct=Q.encode(ft),ei=[];for(let Kt=0;Kt<pt.length;Kt++){const fi=pt.feature(Kt),xi=K.getId(fi,ft);ei.push({feature:fi,id:xi,index:Kt,sourceLayerIndex:ct})}for(const Kt of pe[ft]){const fi=Kt[0];fi.minzoom&&this.zoom<Math.floor(fi.minzoom)||fi.maxzoom&&this.zoom>=fi.maxzoom||fi.visibility!=="none"&&(se(Kt,this.zoom,F),(J[fi.id]=fi.createBucket({index:K.bucketLayerIDs.length,layers:Kt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ct,sourceID:this.source})).populate(ei,ee,this.tileID.canonical),K.bucketLayerIDs.push(Kt.map(xi=>xi.id)))}}let we,ue,Ge,Oe;const We=a.mapObject(ee.glyphDependencies,ft=>Object.keys(ft).map(Number));Object.keys(We).length?N.send("getGlyphs",{uid:this.uid,stacks:We},(ft,pt)=>{we||(we=ft,ue=pt,_t.call(this))}):ue={};const Je=Object.keys(ee.iconDependencies);Je.length?N.send("getImages",{icons:Je,source:this.source,tileID:this.tileID,type:"icons"},(ft,pt)=>{we||(we=ft,Ge=pt,_t.call(this))}):Ge={};const Et=Object.keys(ee.patternDependencies);function _t(){if(we)return q(we);if(ue&&Ge&&Oe){const ft=new W(ue),pt=new a.ImageAtlas(Ge,Oe);for(const ct in J){const ei=J[ct];ei instanceof a.SymbolBucket?(se(ei.layers,this.zoom,F),a.performSymbolLayout(ei,ue,ft.positions,Ge,pt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ei.hasPattern&&(ei instanceof a.LineBucket||ei instanceof a.FillBucket||ei instanceof a.FillExtrusionBucket)&&(se(ei.layers,this.zoom,F),ei.addFeatures(ee,this.tileID.canonical,pt.patternPositions))}this.status="done",q(null,{buckets:Object.values(J).filter(ct=>!ct.isEmpty()),featureIndex:K,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ft.image,imageAtlas:pt,glyphMap:this.returnDependencies?ue:null,iconMap:this.returnDependencies?Ge:null,glyphPositions:this.returnDependencies?ft.positions:null})}}Et.length?N.send("getImages",{icons:Et,source:this.source,tileID:this.tileID,type:"patterns"},(ft,pt)=>{we||(we=ft,Oe=pt,_t.call(this))}):Oe={},_t.call(this)}}function se($,A,z){const F=new a.EvaluationParameters(A);for(const N of $)N.recalculate(F,z)}function de($,A){const z=a.getArrayBuffer($.request,(F,N,q,Q)=>{F?A(F):N&&A(null,{vectorTile:new a.vectorTile.VectorTile(new a.pbf(N)),rawData:N,cacheControl:q,expires:Q})});return()=>{z.cancel(),A()}}class Ce{constructor(A,z,F,N){this.actor=A,this.layerIndex=z,this.availableImages=F,this.loadVectorData=N||de,this.loading={},this.loaded={}}loadTile(A,z){const F=A.uid;this.loading||(this.loading={});const N=!!(A&&A.request&&A.request.collectResourceTiming)&&new a.RequestPerformance(A.request),q=this.loading[F]=new j(A);q.abort=this.loadVectorData(A,(Q,K)=>{if(delete this.loading[F],Q||!K)return q.status="done",this.loaded[F]=q,z(Q);const J=K.rawData,ee={};K.expires&&(ee.expires=K.expires),K.cacheControl&&(ee.cacheControl=K.cacheControl);const pe={};if(N){const we=N.finish();we&&(pe.resourceTiming=JSON.parse(JSON.stringify(we)))}q.vectorTile=K.vectorTile,q.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,(we,ue)=>{if(we||!ue)return z(we);z(null,a.extend({rawTileData:J.slice(0)},ue,ee,pe))}),this.loaded=this.loaded||{},this.loaded[F]=q})}reloadTile(A,z){const F=this.loaded,N=A.uid,q=this;if(F&&F[N]){const Q=F[N];Q.showCollisionBoxes=A.showCollisionBoxes;const K=(J,ee)=>{const pe=Q.reloadCallback;pe&&(delete Q.reloadCallback,Q.parse(Q.vectorTile,q.layerIndex,this.availableImages,q.actor,pe)),z(J,ee)};Q.status==="parsing"?Q.reloadCallback=K:Q.status==="done"&&(Q.vectorTile?Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,K):K())}}abortTile(A,z){const F=this.loading,N=A.uid;F&&F[N]&&F[N].abort&&(F[N].abort(),delete F[N]),z()}removeTile(A,z){const F=this.loaded,N=A.uid;F&&F[N]&&delete F[N],z()}}class je{constructor(){this.loaded={}}loadTile(A,z){const{uid:F,encoding:N,rawImageData:q}=A,Q=a.isImageBitmap(q)?this.getImageData(q):q,K=new a.DEMData(F,Q,N);this.loaded=this.loaded||{},this.loaded[F]=K,z(null,K)}getImageData(A){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(A.width,A.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=A.width,this.offscreenCanvas.height=A.height,this.offscreenCanvasContext.drawImage(A,0,0,A.width,A.height);const z=this.offscreenCanvasContext.getImageData(-1,-1,A.width+2,A.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:z.width,height:z.height},z.data)}removeTile(A){const z=this.loaded,F=A.uid;z&&z[F]&&delete z[F]}}var nt=function $(A,z){var F,N=A&&A.type;if(N==="FeatureCollection")for(F=0;F<A.features.length;F++)$(A.features[F],z);else if(N==="GeometryCollection")for(F=0;F<A.geometries.length;F++)$(A.geometries[F],z);else if(N==="Feature")$(A.geometry,z);else if(N==="Polygon")Ct(A.coordinates,z);else if(N==="MultiPolygon")for(F=0;F<A.coordinates.length;F++)Ct(A.coordinates[F],z);return A};function Ct($,A){if($.length!==0){mt($[0],A);for(var z=1;z<$.length;z++)mt($[z],!A)}}function mt($,A){for(var z=0,F=0,N=0,q=$.length,Q=q-1;N<q;Q=N++){var K=($[N][0]-$[Q][0])*($[Q][1]+$[N][1]),J=z+K;F+=Math.abs(z)>=Math.abs(K)?z-J+K:K-J+z,z=J}z+F>=0!=!!A&&$.reverse()}const ot=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ke{constructor(A){this._feature=A,this.extent=a.EXTENT,this.type=A.type,this.properties=A.tags,"id"in A&&!isNaN(A.id)&&(this.id=parseInt(A.id,10))}loadGeometry(){if(this._feature.type===1){const A=[];for(const z of this._feature.geometry)A.push([new a.pointGeometry(z[0],z[1])]);return A}{const A=[];for(const z of this._feature.geometry){const F=[];for(const N of z)F.push(new a.pointGeometry(N[0],N[1]));A.push(F)}return A}}toGeoJSON(A,z,F){return ot.call(this,A,z,F)}}class Ie{constructor(A){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=A.length,this._features=A}feature(A){return new Ke(this._features[A])}}var rt={exports:{}},At=a.pointGeometry,Ht=a.vectorTile.VectorTileFeature,Zi=ki;function ki($,A){this.options=A||{},this.features=$,this.length=$.length}function hr($,A){this.id=typeof $.id=="number"?$.id:void 0,this.type=$.type,this.rawGeometry=$.type===1?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=A||4096}ki.prototype.feature=function($){return new hr(this.features[$],this.options.extent)},hr.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var A=0;A<$.length;A++){for(var z=$[A],F=[],N=0;N<z.length;N++)F.push(new At(z[N][0],z[N][1]));this.geometry.push(F)}return this.geometry},hr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,A=1/0,z=-1/0,F=1/0,N=-1/0,q=0;q<$.length;q++)for(var Q=$[q],K=0;K<Q.length;K++){var J=Q[K];A=Math.min(A,J.x),z=Math.max(z,J.x),F=Math.min(F,J.y),N=Math.max(N,J.y)}return[A,F,z,N]},hr.prototype.toGeoJSON=Ht.prototype.toGeoJSON;var Er=a.pbf,Hi=Zi;function Sr($){var A=new Er;return function(z,F){for(var N in z.layers)F.writeMessage(3,Ve,z.layers[N])}($,A),A.finish()}function Ve($,A){var z;A.writeVarintField(15,$.version||1),A.writeStringField(1,$.name||""),A.writeVarintField(5,$.extent||4096);var F={keys:[],values:[],keycache:{},valuecache:{}};for(z=0;z<$.length;z++)F.feature=$.feature(z),A.writeMessage(2,Wt,F);var N=F.keys;for(z=0;z<N.length;z++)A.writeStringField(3,N[z]);var q=F.values;for(z=0;z<q.length;z++)A.writeMessage(4,an,q[z])}function Wt($,A){var z=$.feature;z.id!==void 0&&A.writeVarintField(1,z.id),A.writeMessage(2,Yr,$),A.writeVarintField(3,z.type),A.writeMessage(4,on,z)}function Yr($,A){var z=$.feature,F=$.keys,N=$.values,q=$.keycache,Q=$.valuecache;for(var K in z.properties){var J=z.properties[K],ee=q[K];if(J!==null){ee===void 0&&(F.push(K),q[K]=ee=F.length-1),A.writeVarint(ee);var pe=typeof J;pe!=="string"&&pe!=="boolean"&&pe!=="number"&&(J=JSON.stringify(J));var we=pe+":"+J,ue=Q[we];ue===void 0&&(N.push(J),Q[we]=ue=N.length-1),A.writeVarint(ue)}}}function Kr($,A){return(A<<3)+(7&$)}function pr($){return $<<1^$>>31}function on($,A){for(var z=$.loadGeometry(),F=$.type,N=0,q=0,Q=z.length,K=0;K<Q;K++){var J=z[K],ee=1;F===1&&(ee=J.length),A.writeVarint(Kr(1,ee));for(var pe=F===3?J.length-1:J.length,we=0;we<pe;we++){we===1&&F!==1&&A.writeVarint(Kr(2,pe-1));var ue=J[we].x-N,Ge=J[we].y-q;A.writeVarint(pr(ue)),A.writeVarint(pr(Ge)),N+=ue,q+=Ge}F===3&&A.writeVarint(Kr(7,1))}}function an($,A){var z=typeof $;z==="string"?A.writeStringField(1,$):z==="boolean"?A.writeBooleanField(7,$):z==="number"&&($%1!=0?A.writeDoubleField(3,$):$<0?A.writeSVarintField(6,$):A.writeVarintField(5,$))}rt.exports=Sr,rt.exports.fromVectorTileJs=Sr,rt.exports.fromGeojsonVt=function($,A){A=A||{};var z={};for(var F in $)z[F]=new Hi($[F].features,A),z[F].name=F,z[F].version=A.version,z[F].extent=A.extent;return Sr({layers:z})},rt.exports.GeoJSONWrapper=Hi;var Ur=rt.exports;function Jr($,A,z,F,N,q){if(N-F<=z)return;const Q=F+N>>1;sn($,A,Q,F,N,q%2),Jr($,A,z,F,Q-1,q+1),Jr($,A,z,Q+1,N,q+1)}function sn($,A,z,F,N,q){for(;N>F;){if(N-F>600){const ee=N-F+1,pe=z-F+1,we=Math.log(ee),ue=.5*Math.exp(2*we/3),Ge=.5*Math.sqrt(we*ue*(ee-ue)/ee)*(pe-ee/2<0?-1:1);sn($,A,z,Math.max(F,Math.floor(z-pe*ue/ee+Ge)),Math.min(N,Math.floor(z+(ee-pe)*ue/ee+Ge)),q)}const Q=A[2*z+q];let K=F,J=N;for(dr($,A,F,z),A[2*N+q]>Q&&dr($,A,F,N);K<J;){for(dr($,A,K,J),K++,J--;A[2*K+q]<Q;)K++;for(;A[2*J+q]>Q;)J--}A[2*F+q]===Q?dr($,A,F,J):(J++,dr($,A,J,N)),J<=z&&(F=J+1),z<=J&&(N=J-1)}}function dr($,A,z,F){$r($,z,F),$r(A,2*z,2*F),$r(A,2*z+1,2*F+1)}function $r($,A,z){const F=$[A];$[A]=$[z],$[z]=F}function Nr($,A,z,F){const N=$-z,q=A-F;return N*N+q*q}const Dn=$=>$[0],Do=$=>$[1];class io{constructor(A,z=Dn,F=Do,N=64,q=Float64Array){this.nodeSize=N,this.points=A;const Q=A.length<65536?Uint16Array:Uint32Array,K=this.ids=new Q(A.length),J=this.coords=new q(2*A.length);for(let ee=0;ee<A.length;ee++)K[ee]=ee,J[2*ee]=z(A[ee]),J[2*ee+1]=F(A[ee]);Jr(K,J,N,0,K.length-1,0)}range(A,z,F,N){return function(q,Q,K,J,ee,pe,we){const ue=[0,q.length-1,0],Ge=[];let Oe,We;for(;ue.length;){const Je=ue.pop(),Et=ue.pop(),_t=ue.pop();if(Et-_t<=we){for(let ct=_t;ct<=Et;ct++)Oe=Q[2*ct],We=Q[2*ct+1],Oe>=K&&Oe<=ee&&We>=J&&We<=pe&&Ge.push(q[ct]);continue}const ft=Math.floor((_t+Et)/2);Oe=Q[2*ft],We=Q[2*ft+1],Oe>=K&&Oe<=ee&&We>=J&&We<=pe&&Ge.push(q[ft]);const pt=(Je+1)%2;(Je===0?K<=Oe:J<=We)&&(ue.push(_t),ue.push(ft-1),ue.push(pt)),(Je===0?ee>=Oe:pe>=We)&&(ue.push(ft+1),ue.push(Et),ue.push(pt))}return Ge}(this.ids,this.coords,A,z,F,N,this.nodeSize)}within(A,z,F){return function(N,q,Q,K,J,ee){const pe=[0,N.length-1,0],we=[],ue=J*J;for(;pe.length;){const Ge=pe.pop(),Oe=pe.pop(),We=pe.pop();if(Oe-We<=ee){for(let pt=We;pt<=Oe;pt++)Nr(q[2*pt],q[2*pt+1],Q,K)<=ue&&we.push(N[pt]);continue}const Je=Math.floor((We+Oe)/2),Et=q[2*Je],_t=q[2*Je+1];Nr(Et,_t,Q,K)<=ue&&we.push(N[Je]);const ft=(Ge+1)%2;(Ge===0?Q-J<=Et:K-J<=_t)&&(pe.push(We),pe.push(Je-1),pe.push(ft)),(Ge===0?Q+J>=Et:K+J>=_t)&&(pe.push(Je+1),pe.push(Oe),pe.push(ft))}return we}(this.ids,this.coords,A,z,F,this.nodeSize)}}const Lo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:$=>$},mi=Math.fround||(Qr=new Float32Array(1),$=>(Qr[0]=+$,Qr[0]));var Qr;class ro{constructor(A){this.options=vt(Object.create(Lo),A),this.trees=new Array(this.options.maxZoom+1)}load(A){const{log:z,minZoom:F,maxZoom:N,nodeSize:q}=this.options;z&&console.time("total time");const Q=`prepare ${A.length} points`;z&&console.time(Q),this.points=A;let K=[];for(let J=0;J<A.length;J++)A[J].geometry&&K.push(Ir(A[J],J));this.trees[N+1]=new io(K,cn,en,q,Float32Array),z&&console.timeEnd(Q);for(let J=N;J>=F;J--){const ee=+Date.now();K=this._cluster(K,J),this.trees[J]=new io(K,cn,en,q,Float32Array),z&&console.log("z%d: %d clusters in %dms",J,K.length,+Date.now()-ee)}return z&&console.timeEnd("total time"),this}getClusters(A,z){let F=((A[0]+180)%360+360)%360-180;const N=Math.max(-90,Math.min(90,A[1]));let q=A[2]===180?180:((A[2]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,A[3]));if(A[2]-A[0]>=360)F=-180,q=180;else if(F>q){const pe=this.getClusters([F,N,180,Q],z),we=this.getClusters([-180,N,q,Q],z);return pe.concat(we)}const K=this.trees[this._limitZoom(z)],J=K.range(zr(F),Tr(Q),zr(q),Tr(N)),ee=[];for(const pe of J){const we=K.points[pe];ee.push(we.numPoints?Bo(we):this.points[we.index])}return ee}getChildren(A){const z=this._getOriginId(A),F=this._getOriginZoom(A),N="No cluster with the specified id.",q=this.trees[F];if(!q)throw new Error(N);const Q=q.points[z];if(!Q)throw new Error(N);const K=this.options.radius/(this.options.extent*Math.pow(2,F-1)),J=q.within(Q.x,Q.y,K),ee=[];for(const pe of J){const we=q.points[pe];we.parentId===A&&ee.push(we.numPoints?Bo(we):this.points[we.index])}if(ee.length===0)throw new Error(N);return ee}getLeaves(A,z,F){const N=[];return this._appendLeaves(N,A,z=z||10,F=F||0,0),N}getTile(A,z,F){const N=this.trees[this._limitZoom(A)],q=Math.pow(2,A),{extent:Q,radius:K}=this.options,J=K/Q,ee=(F-J)/q,pe=(F+1+J)/q,we={features:[]};return this._addTileFeatures(N.range((z-J)/q,ee,(z+1+J)/q,pe),N.points,z,F,q,we),z===0&&this._addTileFeatures(N.range(1-J/q,ee,1,pe),N.points,q,F,q,we),z===q-1&&this._addTileFeatures(N.range(0,ee,J/q,pe),N.points,-1,F,q,we),we.features.length?we:null}getClusterExpansionZoom(A){let z=this._getOriginZoom(A)-1;for(;z<=this.options.maxZoom;){const F=this.getChildren(A);if(z++,F.length!==1)break;A=F[0].properties.cluster_id}return z}_appendLeaves(A,z,F,N,q){const Q=this.getChildren(z);for(const K of Q){const J=K.properties;if(J&&J.cluster?q+J.point_count<=N?q+=J.point_count:q=this._appendLeaves(A,J.cluster_id,F,N,q):q<N?q++:A.push(K),A.length===F)break}return q}_addTileFeatures(A,z,F,N,q,Q){for(const K of A){const J=z[K],ee=J.numPoints;let pe,we,ue;if(ee)pe=jr(J),we=J.x,ue=J.y;else{const We=this.points[J.index];pe=We.properties,we=zr(We.geometry.coordinates[0]),ue=Tr(We.geometry.coordinates[1])}const Ge={type:1,geometry:[[Math.round(this.options.extent*(we*q-F)),Math.round(this.options.extent*(ue*q-N))]],tags:pe};let Oe;ee?Oe=J.id:this.options.generateId?Oe=J.index:this.points[J.index].id&&(Oe=this.points[J.index].id),Oe!==void 0&&(Ge.id=Oe),Q.features.push(Ge)}}_limitZoom(A){return Math.max(this.options.minZoom,Math.min(+A,this.options.maxZoom+1))}_cluster(A,z){const F=[],{radius:N,extent:q,reduce:Q,minPoints:K}=this.options,J=N/(q*Math.pow(2,z));for(let ee=0;ee<A.length;ee++){const pe=A[ee];if(pe.zoom<=z)continue;pe.zoom=z;const we=this.trees[z+1],ue=we.within(pe.x,pe.y,J),Ge=pe.numPoints||1;let Oe=Ge;for(const We of ue){const Je=we.points[We];Je.zoom>z&&(Oe+=Je.numPoints||1)}if(Oe>Ge&&Oe>=K){let We=pe.x*Ge,Je=pe.y*Ge,Et=Q&&Ge>1?this._map(pe,!0):null;const _t=(ee<<5)+(z+1)+this.points.length;for(const ft of ue){const pt=we.points[ft];if(pt.zoom<=z)continue;pt.zoom=z;const ct=pt.numPoints||1;We+=pt.x*ct,Je+=pt.y*ct,pt.parentId=_t,Q&&(Et||(Et=this._map(pe,!0)),Q(Et,this._map(pt)))}pe.parentId=_t,F.push(ln(We/Oe,Je/Oe,_t,Oe,Et))}else if(F.push(pe),Oe>1)for(const We of ue){const Je=we.points[We];Je.zoom<=z||(Je.zoom=z,F.push(Je))}}return F}_getOriginId(A){return A-this.points.length>>5}_getOriginZoom(A){return(A-this.points.length)%32}_map(A,z){if(A.numPoints)return z?vt({},A.properties):A.properties;const F=this.points[A.index].properties,N=this.options.map(F);return z&&N===F?vt({},N):N}}function ln($,A,z,F,N){return{x:mi($),y:mi(A),zoom:1/0,id:z,parentId:-1,numPoints:F,properties:N}}function Ir($,A){const[z,F]=$.geometry.coordinates;return{x:mi(zr(z)),y:mi(Tr(F)),zoom:1/0,index:A,parentId:-1}}function Bo($){return{type:"Feature",id:$.id,properties:jr($),geometry:{type:"Point",coordinates:[(A=$.x,360*(A-.5)),no($.y)]}};var A}function jr($){const A=$.numPoints,z=A>=1e4?`${Math.round(A/1e3)}k`:A>=1e3?Math.round(A/100)/10+"k":A;return vt(vt({},$.properties),{cluster:!0,cluster_id:$.id,point_count:A,point_count_abbreviated:z})}function zr($){return $/360+.5}function Tr($){const A=Math.sin($*Math.PI/180),z=.5-.25*Math.log((1+A)/(1-A))/Math.PI;return z<0?0:z>1?1:z}function no($){const A=(180-360*$)*Math.PI/180;return 360*Math.atan(Math.exp(A))/Math.PI-90}function vt($,A){for(const z in A)$[z]=A[z];return $}function cn($){return $.x}function en($){return $.y}function un($,A,z,F){for(var N,q=F,Q=z-A>>1,K=z-A,J=$[A],ee=$[A+1],pe=$[z],we=$[z+1],ue=A+3;ue<z;ue+=3){var Ge=oo($[ue],$[ue+1],J,ee,pe,we);if(Ge>q)N=ue,q=Ge;else if(Ge===q){var Oe=Math.abs(ue-Q);Oe<K&&(N=ue,K=Oe)}}q>F&&(N-A>3&&un($,A,N,F),$[N+2]=q,z-N>3&&un($,N,z,F))}function oo($,A,z,F,N,q){var Q=N-z,K=q-F;if(Q!==0||K!==0){var J=(($-z)*Q+(A-F)*K)/(Q*Q+K*K);J>1?(z=N,F=q):J>0&&(z+=Q*J,F+=K*J)}return(Q=$-z)*Q+(K=A-F)*K}function fe($,A,z,F){var N={id:$===void 0?null:$,type:A,geometry:z,tags:F,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(q){var Q=q.geometry,K=q.type;if(K==="Point"||K==="MultiPoint"||K==="LineString")De(q,Q);else if(K==="Polygon"||K==="MultiLineString")for(var J=0;J<Q.length;J++)De(q,Q[J]);else if(K==="MultiPolygon")for(J=0;J<Q.length;J++)for(var ee=0;ee<Q[J].length;ee++)De(q,Q[J][ee])}(N),N}function De($,A){for(var z=0;z<A.length;z+=3)$.minX=Math.min($.minX,A[z]),$.minY=Math.min($.minY,A[z+1]),$.maxX=Math.max($.maxX,A[z]),$.maxY=Math.max($.maxY,A[z+1])}function hn($,A,z,F){if(A.geometry){var N=A.geometry.coordinates,q=A.geometry.type,Q=Math.pow(z.tolerance/((1<<z.maxZoom)*z.extent),2),K=[],J=A.id;if(z.promoteId?J=A.properties[z.promoteId]:z.generateId&&(J=F||0),q==="Point")qr(N,K);else if(q==="MultiPoint")for(var ee=0;ee<N.length;ee++)qr(N[ee],K);else if(q==="LineString")Rt(N,K,Q,!1);else if(q==="MultiLineString"){if(z.lineMetrics){for(ee=0;ee<N.length;ee++)Rt(N[ee],K=[],Q,!1),$.push(fe(J,"LineString",K,A.properties));return}rr(N,K,Q,!1)}else if(q==="Polygon")rr(N,K,Q,!0);else{if(q!=="MultiPolygon"){if(q==="GeometryCollection"){for(ee=0;ee<A.geometry.geometries.length;ee++)hn($,{id:J,geometry:A.geometry.geometries[ee],properties:A.properties},z,F);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ee=0;ee<N.length;ee++){var pe=[];rr(N[ee],pe,Q,!0),K.push(pe)}}$.push(fe(J,q,K,A.properties))}}function qr($,A){A.push(Ci($[0])),A.push(pn($[1])),A.push(0)}function Rt($,A,z,F){for(var N,q,Q=0,K=0;K<$.length;K++){var J=Ci($[K][0]),ee=pn($[K][1]);A.push(J),A.push(ee),A.push(0),K>0&&(Q+=F?(N*ee-J*q)/2:Math.sqrt(Math.pow(J-N,2)+Math.pow(ee-q,2))),N=J,q=ee}var pe=A.length-3;A[2]=1,un(A,0,pe,z),A[pe+2]=1,A.size=Math.abs(Q),A.start=0,A.end=A.size}function rr($,A,z,F){for(var N=0;N<$.length;N++){var q=[];Rt($[N],q,z,F),A.push(q)}}function Ci($){return $/360+.5}function pn($){var A=Math.sin($*Math.PI/180),z=.5-.25*Math.log((1+A)/(1-A))/Math.PI;return z<0?0:z>1?1:z}function Ut($,A,z,F,N,q,Q,K){if(F/=A,q>=(z/=A)&&Q<F)return $;if(Q<z||q>=F)return null;for(var J=[],ee=0;ee<$.length;ee++){var pe=$[ee],we=pe.geometry,ue=pe.type,Ge=N===0?pe.minX:pe.minY,Oe=N===0?pe.maxX:pe.maxY;if(Ge>=z&&Oe<F)J.push(pe);else if(!(Oe<z||Ge>=F)){var We=[];if(ue==="Point"||ue==="MultiPoint")Me(we,We,z,F,N);else if(ue==="LineString")dt(we,We,z,F,N,!1,K.lineMetrics);else if(ue==="MultiLineString")Mi(we,We,z,F,N,!1);else if(ue==="Polygon")Mi(we,We,z,F,N,!0);else if(ue==="MultiPolygon")for(var Je=0;Je<we.length;Je++){var Et=[];Mi(we[Je],Et,z,F,N,!0),Et.length&&We.push(Et)}if(We.length){if(K.lineMetrics&&ue==="LineString"){for(Je=0;Je<We.length;Je++)J.push(fe(pe.id,ue,We[Je],pe.tags));continue}ue!=="LineString"&&ue!=="MultiLineString"||(We.length===1?(ue="LineString",We=We[0]):ue="MultiLineString"),ue!=="Point"&&ue!=="MultiPoint"||(ue=We.length===3?"Point":"MultiPoint"),J.push(fe(pe.id,ue,We,pe.tags))}}}return J.length?J:null}function Me($,A,z,F,N){for(var q=0;q<$.length;q+=3){var Q=$[q+N];Q>=z&&Q<=F&&(A.push($[q]),A.push($[q+1]),A.push($[q+2]))}}function dt($,A,z,F,N,q,Q){for(var K,J,ee=ut($),pe=N===0?ht:dn,we=$.start,ue=0;ue<$.length-3;ue+=3){var Ge=$[ue],Oe=$[ue+1],We=$[ue+2],Je=$[ue+3],Et=$[ue+4],_t=N===0?Ge:Oe,ft=N===0?Je:Et,pt=!1;Q&&(K=Math.sqrt(Math.pow(Ge-Je,2)+Math.pow(Oe-Et,2))),_t<z?ft>z&&(J=pe(ee,Ge,Oe,Je,Et,z),Q&&(ee.start=we+K*J)):_t>F?ft<F&&(J=pe(ee,Ge,Oe,Je,Et,F),Q&&(ee.start=we+K*J)):mr(ee,Ge,Oe,We),ft<z&&_t>=z&&(J=pe(ee,Ge,Oe,Je,Et,z),pt=!0),ft>F&&_t<=F&&(J=pe(ee,Ge,Oe,Je,Et,F),pt=!0),!q&&pt&&(Q&&(ee.end=we+K*J),A.push(ee),ee=ut($)),Q&&(we+=K)}var ct=$.length-3;Ge=$[ct],Oe=$[ct+1],We=$[ct+2],(_t=N===0?Ge:Oe)>=z&&_t<=F&&mr(ee,Ge,Oe,We),ct=ee.length-3,q&&ct>=3&&(ee[ct]!==ee[0]||ee[ct+1]!==ee[1])&&mr(ee,ee[0],ee[1],ee[2]),ee.length&&A.push(ee)}function ut($){var A=[];return A.size=$.size,A.start=$.start,A.end=$.end,A}function Mi($,A,z,F,N,q){for(var Q=0;Q<$.length;Q++)dt($[Q],A,z,F,N,q,!1)}function mr($,A,z,F){$.push(A),$.push(z),$.push(F)}function ht($,A,z,F,N,q){var Q=(q-A)/(F-A);return $.push(q),$.push(z+(N-z)*Q),$.push(1),Q}function dn($,A,z,F,N,q){var Q=(q-z)/(N-z);return $.push(A+(F-A)*Q),$.push(q),$.push(1),Q}function fr($,A){for(var z=[],F=0;F<$.length;F++){var N,q=$[F],Q=q.type;if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")N=Gr(q.geometry,A);else if(Q==="MultiLineString"||Q==="Polygon"){N=[];for(var K=0;K<q.geometry.length;K++)N.push(Gr(q.geometry[K],A))}else if(Q==="MultiPolygon")for(N=[],K=0;K<q.geometry.length;K++){for(var J=[],ee=0;ee<q.geometry[K].length;ee++)J.push(Gr(q.geometry[K][ee],A));N.push(J)}z.push(fe(q.id,Q,N,q.tags))}return z}function Gr($,A){var z=[];z.size=$.size,$.start!==void 0&&(z.start=$.start,z.end=$.end);for(var F=0;F<$.length;F+=3)z.push($[F]+A,$[F+1],$[F+2]);return z}function ri($,A){if($.transformed)return $;var z,F,N,q=1<<$.z,Q=$.x,K=$.y;for(z=0;z<$.features.length;z++){var J=$.features[z],ee=J.geometry,pe=J.type;if(J.geometry=[],pe===1)for(F=0;F<ee.length;F+=2)J.geometry.push(Ft(ee[F],ee[F+1],A,q,Q,K));else for(F=0;F<ee.length;F++){var we=[];for(N=0;N<ee[F].length;N+=2)we.push(Ft(ee[F][N],ee[F][N+1],A,q,Q,K));J.geometry.push(we)}}return $.transformed=!0,$}function Ft($,A,z,F,N,q){return[Math.round(z*($*F-N)),Math.round(z*(A*F-q))]}function nr($,A,z,F,N){for(var q=A===N.maxZoom?0:N.tolerance/((1<<A)*N.extent),Q={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:z,y:F,z:A,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},K=0;K<$.length;K++){Q.numFeatures++,mn(Q,$[K],q,N);var J=$[K].minX,ee=$[K].minY,pe=$[K].maxX,we=$[K].maxY;J<Q.minX&&(Q.minX=J),ee<Q.minY&&(Q.minY=ee),pe>Q.maxX&&(Q.maxX=pe),we>Q.maxY&&(Q.maxY=we)}return Q}function mn($,A,z,F){var N=A.geometry,q=A.type,Q=[];if(q==="Point"||q==="MultiPoint")for(var K=0;K<N.length;K+=3)Q.push(N[K]),Q.push(N[K+1]),$.numPoints++,$.numSimplified++;else if(q==="LineString")ui(Q,N,$,z,!1,!1);else if(q==="MultiLineString"||q==="Polygon")for(K=0;K<N.length;K++)ui(Q,N[K],$,z,q==="Polygon",K===0);else if(q==="MultiPolygon")for(var J=0;J<N.length;J++){var ee=N[J];for(K=0;K<ee.length;K++)ui(Q,ee[K],$,z,!0,K===0)}if(Q.length){var pe=A.tags||null;if(q==="LineString"&&F.lineMetrics){for(var we in pe={},A.tags)pe[we]=A.tags[we];pe.mapbox_clip_start=N.start/N.size,pe.mapbox_clip_end=N.end/N.size}var ue={geometry:Q,type:q==="Polygon"||q==="MultiPolygon"?3:q==="LineString"||q==="MultiLineString"?2:1,tags:pe};A.id!==null&&(ue.id=A.id),$.features.push(ue)}}function ui($,A,z,F,N,q){var Q=F*F;if(F>0&&A.size<(N?Q:F))z.numPoints+=A.length/3;else{for(var K=[],J=0;J<A.length;J+=3)(F===0||A[J+2]>Q)&&(z.numSimplified++,K.push(A[J]),K.push(A[J+1])),z.numPoints++;N&&function(ee,pe){for(var we=0,ue=0,Ge=ee.length,Oe=Ge-2;ue<Ge;Oe=ue,ue+=2)we+=(ee[ue]-ee[Oe])*(ee[ue+1]+ee[Oe+1]);if(we>0===pe)for(ue=0,Ge=ee.length;ue<Ge/2;ue+=2){var We=ee[ue],Je=ee[ue+1];ee[ue]=ee[Ge-2-ue],ee[ue+1]=ee[Ge-1-ue],ee[Ge-2-ue]=We,ee[Ge-1-ue]=Je}}(K,q),$.push(K)}}function gr($,A){var z=(A=this.options=function(N,q){for(var Q in q)N[Q]=q[Q];return N}(Object.create(this.options),A)).debug;if(z&&console.time("preprocess data"),A.maxZoom<0||A.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(A.promoteId&&A.generateId)throw new Error("promoteId and generateId cannot be used together.");var F=function(N,q){var Q=[];if(N.type==="FeatureCollection")for(var K=0;K<N.features.length;K++)hn(Q,N.features[K],q,K);else hn(Q,N.type==="Feature"?N:{geometry:N},q);return Q}($,A);this.tiles={},this.tileCoords=[],z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",A.indexMaxZoom,A.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),F=function(N,q){var Q=q.buffer/q.extent,K=N,J=Ut(N,1,-1-Q,Q,0,-1,2,q),ee=Ut(N,1,1-Q,2+Q,0,-1,2,q);return(J||ee)&&(K=Ut(N,1,-Q,1+Q,0,-1,2,q)||[],J&&(K=fr(J,1).concat(K)),ee&&(K=K.concat(fr(ee,-1)))),K}(F,A),F.length&&this.splitTile(F,0,0,0),z&&(F.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function yr($,A,z){return 32*((1<<$)*z+A)+$}function ao($,A){const z=$.tileID.canonical;if(!this._geoJSONIndex)return A(null,null);const F=this._geoJSONIndex.getTile(z.z,z.x,z.y);if(!F)return A(null,null);const N=new Ie(F.features);let q=Ur(N);q.byteOffset===0&&q.byteLength===q.buffer.byteLength||(q=new Uint8Array(q)),A(null,{vectorTile:N,rawData:q.buffer})}gr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gr.prototype.splitTile=function($,A,z,F,N,q,Q){for(var K=[$,A,z,F],J=this.options,ee=J.debug;K.length;){F=K.pop(),z=K.pop(),A=K.pop(),$=K.pop();var pe=1<<A,we=yr(A,z,F),ue=this.tiles[we];if(!ue&&(ee>1&&console.time("creation"),ue=this.tiles[we]=nr($,A,z,F,J),this.tileCoords.push({z:A,x:z,y:F}),ee)){ee>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",A,z,F,ue.numFeatures,ue.numPoints,ue.numSimplified),console.timeEnd("creation"));var Ge="z"+A;this.stats[Ge]=(this.stats[Ge]||0)+1,this.total++}if(ue.source=$,N){if(A===J.maxZoom||A===N)continue;var Oe=1<<N-A;if(z!==Math.floor(q/Oe)||F!==Math.floor(Q/Oe))continue}else if(A===J.indexMaxZoom||ue.numPoints<=J.indexMaxPoints)continue;if(ue.source=null,$.length!==0){ee>1&&console.time("clipping");var We,Je,Et,_t,ft,pt,ct=.5*J.buffer/J.extent,ei=.5-ct,Kt=.5+ct,fi=1+ct;We=Je=Et=_t=null,ft=Ut($,pe,z-ct,z+Kt,0,ue.minX,ue.maxX,J),pt=Ut($,pe,z+ei,z+fi,0,ue.minX,ue.maxX,J),$=null,ft&&(We=Ut(ft,pe,F-ct,F+Kt,1,ue.minY,ue.maxY,J),Je=Ut(ft,pe,F+ei,F+fi,1,ue.minY,ue.maxY,J),ft=null),pt&&(Et=Ut(pt,pe,F-ct,F+Kt,1,ue.minY,ue.maxY,J),_t=Ut(pt,pe,F+ei,F+fi,1,ue.minY,ue.maxY,J),pt=null),ee>1&&console.timeEnd("clipping"),K.push(We||[],A+1,2*z,2*F),K.push(Je||[],A+1,2*z,2*F+1),K.push(Et||[],A+1,2*z+1,2*F),K.push(_t||[],A+1,2*z+1,2*F+1)}}},gr.prototype.getTile=function($,A,z){var F=this.options,N=F.extent,q=F.debug;if($<0||$>24)return null;var Q=1<<$,K=yr($,A=(A%Q+Q)%Q,z);if(this.tiles[K])return ri(this.tiles[K],N);q>1&&console.log("drilling down to z%d-%d-%d",$,A,z);for(var J,ee=$,pe=A,we=z;!J&&ee>0;)ee--,pe=Math.floor(pe/2),we=Math.floor(we/2),J=this.tiles[yr(ee,pe,we)];return J&&J.source?(q>1&&console.log("found parent tile z%d-%d-%d",ee,pe,we),q>1&&console.time("drilling down"),this.splitTile(J.source,ee,pe,we,$,A,z),q>1&&console.timeEnd("drilling down"),this.tiles[K]?ri(this.tiles[K],N):null):null};class Ln extends Ce{constructor(A,z,F,N){super(A,z,F,ao),N&&(this.loadGeoJSON=N)}loadData(A,z){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=z,this._pendingLoadDataParams=A,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const A=this._pendingCallback,z=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const F=!!(z&&z.request&&z.request.collectResourceTiming)&&new a.RequestPerformance(z.request);this.loadGeoJSON(z,(N,q)=>{if(N||!q)return A(N);if(typeof q!="object")return A(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));{nt(q,!0);try{if(z.filter){const K=a.createExpression(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(K.result==="error")throw new Error(K.value.map(ee=>`${ee.key}: ${ee.message}`).join(", "));const J=q.features.filter(ee=>K.value.evaluate({zoom:0},ee));q={type:"FeatureCollection",features:J}}this._geoJSONIndex=z.cluster?new ro(function({superclusterOptions:K,clusterProperties:J}){if(!J||!K)return K;const ee={},pe={},we={accumulated:null,zoom:0},ue={properties:null},Ge=Object.keys(J);for(const Oe of Ge){const[We,Je]=J[Oe],Et=a.createExpression(Je),_t=a.createExpression(typeof We=="string"?[We,["accumulated"],["get",Oe]]:We);ee[Oe]=Et.value,pe[Oe]=_t.value}return K.map=Oe=>{ue.properties=Oe;const We={};for(const Je of Ge)We[Je]=ee[Je].evaluate(we,ue);return We},K.reduce=(Oe,We)=>{ue.properties=We;for(const Je of Ge)we.accumulated=Oe[Je],Oe[Je]=pe[Je].evaluate(we,ue)},K}(z)).load(q.features):function(K,J){return new gr(K,J)}(q,z.geojsonVtOptions)}catch(K){return A(K)}this.loaded={};const Q={};if(F){const K=F.finish();K&&(Q.resourceTiming={},Q.resourceTiming[z.source]=JSON.parse(JSON.stringify(K)))}A(null,Q)}})}coalesce(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())}reloadTile(A,z){const F=this.loaded;return F&&F[A.uid]?super.reloadTile(A,z):this.loadTile(A,z)}loadGeoJSON(A,z){if(A.request)a.getJSON(A.request,z);else{if(typeof A.data!="string")return z(new Error(`Input data given to '${A.source}' is not a valid GeoJSON object.`));try{return z(null,JSON.parse(A.data))}catch{return z(new Error(`Input data given to '${A.source}' is not a valid GeoJSON object.`))}}}removeSource(A,z){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),z()}getClusterExpansionZoom(A,z){try{z(null,this._geoJSONIndex.getClusterExpansionZoom(A.clusterId))}catch(F){z(F)}}getClusterChildren(A,z){try{z(null,this._geoJSONIndex.getChildren(A.clusterId))}catch(F){z(F)}}getClusterLeaves(A,z){try{z(null,this._geoJSONIndex.getLeaves(A.clusterId,A.limit,A.offset))}catch(F){z(F)}}}class Bn{constructor(A){this.self=A,this.actor=new a.Actor(A,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ce,geojson:Ln},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(z,F)=>{if(this.workerSourceTypes[z])throw new Error(`Worker source with name "${z}" already registered.`);this.workerSourceTypes[z]=F},this.self.registerRTLTextPlugin=z=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=z.applyArabicShaping,a.plugin.processBidirectionalText=z.processBidirectionalText,a.plugin.processStyledBidirectionalText=z.processStyledBidirectionalText}}setReferrer(A,z){this.referrer=z}setImages(A,z,F){this.availableImages[A]=z;for(const N in this.workerSources[A]){const q=this.workerSources[A][N];for(const Q in q)q[Q].availableImages=z}F()}setLayers(A,z,F){this.getLayerIndex(A).replace(z),F()}updateLayers(A,z,F){this.getLayerIndex(A).update(z.layers,z.removedIds),F()}loadTile(A,z,F){this.getWorkerSource(A,z.type,z.source).loadTile(z,F)}loadDEMTile(A,z,F){this.getDEMWorkerSource(A,z.source).loadTile(z,F)}reloadTile(A,z,F){this.getWorkerSource(A,z.type,z.source).reloadTile(z,F)}abortTile(A,z,F){this.getWorkerSource(A,z.type,z.source).abortTile(z,F)}removeTile(A,z,F){this.getWorkerSource(A,z.type,z.source).removeTile(z,F)}removeDEMTile(A,z){this.getDEMWorkerSource(A,z.source).removeTile(z)}removeSource(A,z,F){if(!this.workerSources[A]||!this.workerSources[A][z.type]||!this.workerSources[A][z.type][z.source])return;const N=this.workerSources[A][z.type][z.source];delete this.workerSources[A][z.type][z.source],N.removeSource!==void 0?N.removeSource(z,F):F()}loadWorkerSource(A,z,F){try{this.self.importScripts(z.url),F()}catch(N){F(N.toString())}}syncRTLPluginState(A,z,F){try{a.plugin.setState(z);const N=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&N!=null){this.self.importScripts(N);const q=a.plugin.isParsed();F(q?void 0:new Error(`RTL Text Plugin failed to import scripts from ${N}`),q)}}catch(N){F(N.toString())}}getAvailableImages(A){let z=this.availableImages[A];return z||(z=[]),z}getLayerIndex(A){let z=this.layerIndexes[A];return z||(z=this.layerIndexes[A]=new ne),z}getWorkerSource(A,z,F){if(this.workerSources[A]||(this.workerSources[A]={}),this.workerSources[A][z]||(this.workerSources[A][z]={}),!this.workerSources[A][z][F]){const N={send:(q,Q,K)=>{this.actor.send(q,Q,K,A)}};this.workerSources[A][z][F]=new this.workerSourceTypes[z](N,this.getLayerIndex(A),this.getAvailableImages(A))}return this.workerSources[A][z][F]}getDEMWorkerSource(A,z){return this.demWorkerSources[A]||(this.demWorkerSources[A]={}),this.demWorkerSources[A][z]||(this.demWorkerSources[A][z]=new je),this.demWorkerSources[A][z]}enforceCacheSizeLimit(A,z){a.enforceCacheSizeLimit(z)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Bn(self)),Bn}),E(["./shared"],function(a){var U=G;function G(c){return!function(t){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var s,u,d=new Blob([""],{type:"text/javascript"}),g=URL.createObjectURL(d);try{u=new Worker(g),s=!0}catch{s=!1}return u&&u.terminate(),URL.revokeObjectURL(g),s}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var s=document.createElement("canvas");s.width=s.height=1;var u=s.getContext("2d");if(!u)return!1;var d=u.getImageData(0,0,1,1);return d&&d.width===s.width}()?(ne[n=t&&t.failIfMajorPerformanceCaveat]===void 0&&(ne[n]=function(s){var u,d=function(g){var x=document.createElement("canvas"),v=Object.create(G.webGLContextAttributes);return v.failIfMajorPerformanceCaveat=g,x.getContext("webgl",v)||x.getContext("experimental-webgl",v)}(s);if(!d)return!1;try{u=d.createShader(d.VERTEX_SHADER)}catch{return!1}return!(!u||d.isContextLost())&&(d.shaderSource(u,"void main() {}"),d.compileShader(u),d.getShaderParameter(u,d.COMPILE_STATUS)===!0)}(n)),ne[n]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var n}(c)}var ne={};function W(c,t){if(Array.isArray(c)){if(!Array.isArray(t)||c.length!==t.length)return!1;for(let n=0;n<c.length;n++)if(!W(c[n],t[n]))return!1;return!0}if(typeof c=="object"&&c!==null&&t!==null){if(typeof t!="object"||Object.keys(c).length!==Object.keys(t).length)return!1;for(const n in c)if(!W(c[n],t[n]))return!1;return!0}return c===t}G.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class j{static testProp(t){if(!j.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in j.docStyle)return t[n];return t[0]}static create(t,n,s){const u=window.document.createElement(t);return n!==void 0&&(u.className=n),s&&s.appendChild(u),u}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){j.docStyle&&j.selectProp&&(j.userSelect=j.docStyle[j.selectProp],j.docStyle[j.selectProp]="none")}static enableDrag(){j.docStyle&&j.selectProp&&(j.docStyle[j.selectProp]=j.userSelect)}static setTransform(t,n){t.style[j.transformProp]=n}static addEventListener(t,n,s,u={}){t.addEventListener(n,s,"passive"in u?u:u.capture)}static removeEventListener(t,n,s,u={}){t.removeEventListener(n,s,"passive"in u?u:u.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",j.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",j.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",j.suppressClickInternal,!0)},0)}static mousePos(t,n){const s=t.getBoundingClientRect();return new a.pointGeometry(n.clientX-s.left-t.clientLeft,n.clientY-s.top-t.clientTop)}static touchPos(t,n){const s=t.getBoundingClientRect(),u=[];for(let d=0;d<n.length;d++)u.push(new a.pointGeometry(n[d].clientX-s.left-t.clientLeft,n[d].clientY-s.top-t.clientTop));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}j.docStyle=typeof window!="undefined"&&window.document&&window.document.documentElement.style,j.selectProp=j.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),j.transformProp=j.testProp(["transform","WebkitTransform"]);class se{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,s){const u=function(d){const g=d.match(de);if(!g)throw new Error(`Unable to parse URL "${d}"`);return{protocol:g[1],authority:g[2],path:g[3]||"/",params:g[4]?g[4].split("&"):[]}}(t);return u.path+=`${n}${s}`,function(d){const g=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${g}`}(u)}setTransformRequest(t){this._transformRequestFn=t}}const de=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ce(c){var t=new a.ARRAY_TYPE(3);return t[0]=c[0],t[1]=c[1],t[2]=c[2],t}var je,nt=function(c,t,n){return c[0]=t[0]-n[0],c[1]=t[1]-n[1],c[2]=t[2]-n[2],c};je=new a.ARRAY_TYPE(3),a.ARRAY_TYPE!=Float32Array&&(je[0]=0,je[1]=0,je[2]=0);var Ct=function(c){var t=c[0],n=c[1];return t*t+n*n};(function(){var c=new a.ARRAY_TYPE(2);a.ARRAY_TYPE!=Float32Array&&(c[0]=0,c[1]=0)})();class mt{constructor(t,n,s,u){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(n,u)}update(t,n,s){const{width:u,height:d}=t,g=!(this.size&&this.size[0]===u&&this.size[1]===d||s),{context:x}=this,{gl:v}=x;if(this.useMipmap=Boolean(n&&n.useMipmap),v.bindTexture(v.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!n||n.premultiply!==!1)),g)this.size=[u,d],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.isImageBitmap(t)?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,t):v.texImage2D(v.TEXTURE_2D,0,this.format,u,d,0,this.format,v.UNSIGNED_BYTE,t.data);else{const{x:S,y:C}=s||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.isImageBitmap(t)?v.texSubImage2D(v.TEXTURE_2D,0,S,C,v.RGBA,v.UNSIGNED_BYTE,t):v.texSubImage2D(v.TEXTURE_2D,0,S,C,u,d,v.RGBA,v.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&v.generateMipmap(v.TEXTURE_2D)}bind(t,n,s){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),s!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=d.LINEAR),t!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,s||t),this.filter=t),n!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function ot(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ke extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,callback:s}of this.requestors)this._notify(n,s);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,n){this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let s=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),s=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),s=!1),this._validateContent(n.content,n)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),s=!1),s}_validateStretch(t,n){if(!t)return!0;let s=0;for(const u of t){if(u[0]<s||u[1]<u[0]||n<u[1])return!1;s=u[1]}return!0}_validateContent(t,n){return!(t&&(t.length!==4||t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,n){n.version=this.images[t].version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,n){let s=!0;if(!this.isLoaded())for(const u of t)this.images[u]||(s=!1);this.isLoaded()||s?this._notify(t,n):this.requestors.push({ids:t,callback:n})}_notify(t,n){const s={};for(const u of t){this.images[u]||this.fire(new a.Event("styleimagemissing",{id:u}));const d=this.images[u];d?s[u]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:Boolean(d.userImage&&d.userImage.render)}:a.warnOnce(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,s)}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],s=this.getImage(t);if(!s)return null;if(n&&n.position.version===s.version)return n.position;if(n)n.position.version=s.version;else{const u={w:s.data.width+2,h:s.data.height+2,x:0,y:0},d=new a.ImagePosition(u,s);this.patterns[t]={bin:u,position:d}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new mt(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const d in this.patterns)t.push(this.patterns[d].bin);const{w:n,h:s}=a.potpack(t),u=this.atlasImage;u.resize({width:n||1,height:s||1});for(const d in this.patterns){const{bin:g}=this.patterns[d],x=g.x+1,v=g.y+1,S=this.images[d].data,C=S.width,L=S.height;a.RGBAImage.copy(S,u,{x:0,y:0},{x,y:v},{width:C,height:L}),a.RGBAImage.copy(S,u,{x:0,y:L-1},{x,y:v-1},{width:C,height:1}),a.RGBAImage.copy(S,u,{x:0,y:0},{x,y:v+L},{width:C,height:1}),a.RGBAImage.copy(S,u,{x:C-1,y:0},{x:x-1,y:v},{width:1,height:L}),a.RGBAImage.copy(S,u,{x:0,y:0},{x:x+C,y:v},{width:1,height:L})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const s=this.images[n];ot(s)&&this.updateImage(n,s)}}}const Ie=1e20;function rt(c,t,n,s,u,d,g,x,v){for(let S=t;S<t+s;S++)At(c,n*d+S,d,u,g,x,v);for(let S=n;S<n+u;S++)At(c,S*d+t,1,s,g,x,v)}function At(c,t,n,s,u,d,g){d[0]=0,g[0]=-Ie,g[1]=Ie,u[0]=c[t];for(let x=1,v=0,S=0;x<s;x++){u[x]=c[t+x*n];const C=x*x;do{const L=d[v];S=(u[x]-u[L]+C-L*L)/(x-L)/2}while(S<=g[v]&&--v>-1);v++,d[v]=x,g[v]=S,g[v+1]=Ie}for(let x=0,v=0;x<s;x++){for(;g[v+1]<x;)v++;const S=d[v],C=x-S;c[t+x*n]=u[S]+C*C}}class Ht{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t,n){const s=[];for(const u in t)for(const d of t[u])s.push({stack:u,id:d});a.asyncAll(s,({stack:u,id:d},g)=>{let x=this.entries[u];x||(x=this.entries[u]={glyphs:{},requests:{},ranges:{}});let v=x.glyphs[d];if(v!==void 0)return void g(null,{stack:u,id:d,glyph:v});if(v=this._tinySDF(x,u,d),v)return x.glyphs[d]=v,void g(null,{stack:u,id:d,glyph:v});const S=Math.floor(d/256);if(256*S>65535)return void g(new Error("glyphs > 65535 not supported"));if(x.ranges[S])return void g(null,{stack:u,id:d,glyph:v});let C=x.requests[S];C||(C=x.requests[S]=[],Ht.loadGlyphRange(u,S,this.url,this.requestManager,(L,O)=>{if(O){for(const H in O)this._doesCharSupportLocalGlyph(+H)||(x.glyphs[+H]=O[+H]);x.ranges[S]=!0}for(const H of C)H(L,O);delete x.requests[S]})),C.push((L,O)=>{L?g(L):O&&g(null,{stack:u,id:d,glyph:O[d]||null})})},(u,d)=>{if(u)n(u);else if(d){const g={};for(const{stack:x,id:v,glyph:S}of d)(g[x]||(g[x]={}))[v]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};n(null,g)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(a.unicodeBlockLookup["CJK Unified Ideographs"](t)||a.unicodeBlockLookup["Hangul Syllables"](t)||a.unicodeBlockLookup.Hiragana(t)||a.unicodeBlockLookup.Katakana(t))}_tinySDF(t,n,s){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let d=t.tinySDF;if(!d){let x="400";/bold/i.test(n)?x="900":/medium/i.test(n)?x="500":/light/i.test(n)&&(x="200"),d=t.tinySDF=new Ht.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:u,fontWeight:x})}const g=d.draw(String.fromCharCode(s));return{id:s,bitmap:new a.AlphaImage({width:g.width||30,height:g.height||30},g.data),metrics:{width:g.glyphWidth||24,height:g.glyphHeight||24,left:g.glyphLeft||0,top:g.glyphTop-27||-8,advance:g.glyphAdvance||24}}}}Ht.loadGlyphRange=function(c,t,n,s,u){const d=256*t,g=d+255,x=s.transformRequest(n.replace("{fontstack}",c).replace("{range}",`${d}-${g}`),a.ResourceType.Glyphs);a.getArrayBuffer(x,(v,S)=>{if(v)u(v);else if(S){const C={};for(const L of a.parseGlyphPBF(S))C[L.id]=L;u(null,C)}})},Ht.TinySDF=class{constructor({fontSize:c=24,buffer:t=3,radius:n=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:d="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=s,this.radius=n;const x=this.size=c+4*t,v=this._createCanvas(x),S=this.ctx=v.getContext("2d",{willReadFrequently:!0});S.font=`${g} ${d} ${c}px ${u}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(c){const t=document.createElement("canvas");return t.width=t.height=c,t}draw(c){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:d}=this.ctx.measureText(c),g=Math.ceil(n),x=Math.min(this.size-this.buffer,Math.ceil(d-u)),v=Math.min(this.size-this.buffer,g+Math.ceil(s)),S=x+2*this.buffer,C=v+2*this.buffer,L=Math.max(S*C,0),O=new Uint8ClampedArray(L),H={data:O,width:S,height:C,glyphWidth:x,glyphHeight:v,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(x===0||v===0)return H;const{ctx:V,buffer:Z,gridInner:te,gridOuter:ie}=this;V.clearRect(Z,Z,x,v),V.fillText(c,Z,Z+g);const ae=V.getImageData(Z,Z,x,v);ie.fill(Ie,0,L),te.fill(0,0,L);for(let re=0;re<v;re++)for(let _e=0;_e<x;_e++){const he=ae.data[4*(re*x+_e)+3]/255;if(he===0)continue;const me=(re+Z)*S+_e+Z;if(he===1)ie[me]=0,te[me]=Ie;else{const Se=.5-he;ie[me]=Se>0?Se*Se:0,te[me]=Se<0?Se*Se:0}}rt(ie,0,0,S,C,S,this.f,this.v,this.z),rt(te,Z,Z,x,v,S,this.f,this.v,this.z);for(let re=0;re<L;re++){const _e=Math.sqrt(ie[re])-Math.sqrt(te[re]);O[re]=Math.round(255-255*(_e/this.radius+this.cutoff))}return H}};const Zi=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(c,t){return a.sphericalToCartesian(c.expression.evaluate(t))}interpolate(c,t,n){return{x:a.number(c.x,t.x,n),y:a.number(c.y,t.y,n),z:a.number(c.z,t.z,n)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),ki="-transition";class hr extends a.Evented{constructor(t){super(),this._transitionable=new a.Transitionable(Zi),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(a.validateLight,t,n))for(const s in t){const u=t[s];s.endsWith(ki)?this._transitionable.setTransition(s.slice(0,-ki.length),u):this._transitionable.setValue(s,u)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,s){return(!s||s.validate!==!1)&&a.emitValidationErrors(this,t.call(a.validateStyle,a.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Er{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const s=t.join(",")+String(n);return this.dashEntry[s]||(this.dashEntry[s]=this.addDash(t,n)),this.dashEntry[s]}getDashRanges(t,n,s){const u=[];let d=t.length%2==1?-t[t.length-1]*s:0,g=t[0]*s,x=!0;u.push({left:d,right:g,isDash:x,zeroLength:t[0]===0});let v=t[0];for(let S=1;S<t.length;S++){x=!x;const C=t[S];d=v*s,v+=C,g=v*s,u.push({left:d,right:g,isDash:x,zeroLength:C===0})}return u}addRoundDash(t,n,s){const u=n/2;for(let d=-s;d<=s;d++){const g=this.width*(this.nextRow+s+d);let x=0,v=t[x];for(let S=0;S<this.width;S++){S/v.right>1&&(v=t[++x]);const C=Math.abs(S-v.left),L=Math.abs(S-v.right),O=Math.min(C,L);let H;const V=d/s*(u+1);if(v.isDash){const Z=u-Math.abs(V);H=Math.sqrt(O*O+Z*Z)}else H=u-Math.sqrt(O*O+V*V);this.data[g+S]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(t){for(let x=t.length-1;x>=0;--x){const v=t[x],S=t[x+1];v.zeroLength?t.splice(x,1):S&&S.isDash===v.isDash&&(S.left=v.left,t.splice(x,1))}const n=t[0],s=t[t.length-1];n.isDash===s.isDash&&(n.left=s.left-this.width,s.right=n.right+this.width);const u=this.width*this.nextRow;let d=0,g=t[d];for(let x=0;x<this.width;x++){x/g.right>1&&(g=t[++d]);const v=Math.abs(x-g.left),S=Math.abs(x-g.right),C=Math.min(v,S);this.data[u+x]=Math.max(0,Math.min(255,(g.isDash?C:-C)+128))}}addDash(t,n){const s=n?7:0,u=2*s+1;if(this.nextRow+u>this.height)return a.warnOnce("LineAtlas out of space"),null;let d=0;for(let x=0;x<t.length;x++)d+=t[x];if(d!==0){const x=this.width/d,v=this.getDashRanges(t,this.width,x);n?this.addRoundDash(v,x,s):this.addRegularDash(v)}const g={y:(this.nextRow+s+.5)/this.height,height:2*s/this.height,width:d};return this.nextRow+=u,this.dirty=!0,g}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}class Hi{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const s=this.workerPool.acquire(this.id);for(let u=0;u<s.length;u++){const d=new Hi.Actor(s[u],n,this.id);d.name=`Worker ${u}`,this.actors.push(d)}}broadcast(t,n,s){a.asyncAll(this.actors,(u,d)=>{u.send(t,n,d)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Sr(c,t,n){const s=function(u,d){if(u)return n(u);if(d){const g=a.pick(a.extend(d,c),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(g.vectorLayers=d.vector_layers,g.vectorLayerIds=g.vectorLayers.map(x=>x.id)),n(null,g)}};return c.url?a.getJSON(t.transformRequest(c.url,a.ResourceType.Source),s):a.exported.frame(()=>s(null,c))}Hi.Actor=a.Actor;class Ve{constructor(t,n,s){this.bounds=a.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=s||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),s=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*n),u=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*n),d=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*n),g=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*n);return t.x>=s&&t.x<d&&t.y>=u&&t.y<g}}class Wt extends a.Evented{constructor(t,n,s,u){if(super(),this.id=t,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(n,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Sr(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new a.ErrorEvent(t)):n&&(a.extend(this,n),n.bounds&&(this.tileBounds=new Ve(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(t,n){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(s,a.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function d(g,x){return delete t.request,t.aborted?n(null):g&&g.status!==404?n(g):(x&&x.resourceTiming&&(t.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&x&&t.setExpiryData(x),t.loadVectorData(x,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}u.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",u,d.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",u,d.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Yr extends a.Evented{constructor(t,n,s,u){super(),this.id=t,this.dispatcher=s,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},n),a.extend(this,a.pick(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Sr(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new a.ErrorEvent(t)):n&&(a.extend(this,n),n.bounds&&(this.tileBounds=new Ve(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=a.getImage(this.map._requestManager.transformRequest(s,a.ResourceType.Tile),(u,d,g)=>{if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(u)t.state="errored",n(u);else if(d){this.map._refreshExpiredTiles&&t.setExpiryData(g);const x=this.map.painter.context,v=x.gl;t.texture=this.map.painter.getTileTexture(d.width),t.texture?t.texture.update(d,{useMipmap:!0}):(t.texture=new mt(x,d,v.RGBA,{useMipmap:!0}),t.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),x.extTextureFilterAnisotropic&&v.texParameterf(v.TEXTURE_2D,x.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,x.extTextureFilterAnisotropicMax)),t.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),n(null)}})}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&this.map.painter.saveTileTexture(t.texture),n()}hasTransition(){return!1}}let Kr;class pr extends Yr{constructor(t,n,s,u){super(t,n,s,u),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,n){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function u(d,g){d&&(t.state="errored",n(d)),g&&(t.dem=g,t.needsHillshadePrepare=!0,t.state="loaded",n(null))}t.request=a.getImage(this.map._requestManager.transformRequest(s,a.ResourceType.Tile),function(d,g){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(d)t.state="errored",n(d);else if(g){this.map._refreshExpiredTiles&&t.setExpiryData(g),delete g.cacheControl,delete g.expires;const x=a.isImageBitmap(g)&&(Kr==null&&(Kr=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Kr)?g:a.exported.getImageData(g,1),v={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:x,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",v,u.bind(this)))}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const n=t.canonical,s=Math.pow(2,n.z),u=(n.x-1+s)%s,d=n.x===0?t.wrap-1:t.wrap,g=(n.x+1+s)%s,x=n.x+1===s?t.wrap+1:t.wrap,v={};return v[new a.OverscaledTileID(t.overscaledZ,d,n.z,u,n.y).key]={backfilled:!1},v[new a.OverscaledTileID(t.overscaledZ,x,n.z,g,n.y).key]={backfilled:!1},n.y>0&&(v[new a.OverscaledTileID(t.overscaledZ,d,n.z,u,n.y-1).key]={backfilled:!1},v[new a.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},v[new a.OverscaledTileID(t.overscaledZ,x,n.z,g,n.y-1).key]={backfilled:!1}),n.y+1<s&&(v[new a.OverscaledTileID(t.overscaledZ,d,n.z,u,n.y+1).key]={backfilled:!1},v[new a.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},v[new a.OverscaledTileID(t.overscaledZ,x,n.z,g,n.y+1).key]={backfilled:!1}),v}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class on extends a.Evented{constructor(t,n,s,u){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=s.getActor(),this.setEventedParent(u),this._data=n.data,this._options=a.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const d=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*d,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*d,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:a.EXTENT,radius:(n.clusterRadius||50)*d,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},n),this}getClusterChildren(t,n){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},n),this}getClusterLeaves(t,n,s,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:n,offset:s},u),this}_updateWorkerData(t){const n=a.extend({},this.workerOptions),s=this._data;typeof s=="string"?(n.request=this.map._requestManager.transformRequest(a.exported.resolveURL(s),a.ResourceType.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(s),this._pendingLoads++,this.fire(new a.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,n,(u,d)=>{if(this._pendingLoads--,this._removed||d&&d.abandoned)return;let g=null;if(d&&d.resourceTiming&&d.resourceTiming[this.id]&&(g=d.resourceTiming[this.id].slice(0)),this.actor.send(`${this.type}.coalesce`,{source:n.source},null),u)return void this.fire(new a.ErrorEvent(u));const x={dataType:"source",sourceDataType:t};this._collectResourceTiming&&g&&g.length>0&&a.extend(x,{resourceTiming:g}),this.fire(new a.Event("data",x))})}loaded(){return this._pendingLoads===0}loadTile(t,n){const s=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(s,u,(d,g)=>(delete t.request,t.unloadVectorData(),t.aborted?n(null):d?n(d):(t.loadVectorData(g,this.map.painter,s==="reloadTile"),n(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var an=a.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ur extends a.Evented{constructor(t,n,s,u){super(),this.id=t,this.dispatcher=s,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=n}load(t,n){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(s,u)=>{this._loaded=!0,s?this.fire(new a.ErrorEvent(s)):u&&(this.image=u,t&&(this.coordinates=t),n&&n(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const n=t.map(a.MercatorCoordinate.fromLngLat);this.tileID=function(u){let d=1/0,g=1/0,x=-1/0,v=-1/0;for(const O of u)d=Math.min(d,O.x),g=Math.min(g,O.y),x=Math.max(x,O.x),v=Math.max(v,O.y);const S=Math.max(x-d,v-g),C=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),L=Math.pow(2,C);return new a.CanonicalTileID(C,Math.floor((d+x)/2*L),Math.floor((g+v)/2*L))}(n),this.minzoom=this.maxzoom=this.tileID.z;const s=n.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new a.RasterBoundsArray,this._boundsArray.emplaceBack(s[0].x,s[0].y,0,0),this._boundsArray.emplaceBack(s[1].x,s[1].y,a.EXTENT,0),this._boundsArray.emplaceBack(s[3].x,s[3].y,0,a.EXTENT),this._boundsArray.emplaceBack(s[2].x,s[2].y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,an.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new mt(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const s in this.tiles){const u=this.tiles[s];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture)}}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Jr extends Ur{constructor(t,n,s,u){super(t,n,s,u),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,a.ResourceType.Source).url);a.getVideo(this.urls,(n,s)=>{this._loaded=!0,n?this.fire(new a.ErrorEvent(n)):s&&(this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,an.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new mt(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const s in this.tiles){const u=this.tiles[s];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class sn extends Ur{constructor(t,n,s,u){super(t,n,s,u),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(g=>typeof g!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,s=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,an.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new mt(n,this.canvas,s.RGBA,{premultiply:!0});for(const u in this.tiles){const d=this.tiles[u];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const dr={vector:Wt,raster:Yr,"raster-dem":pr,geojson:on,video:Jr,image:Ur,canvas:sn};function $r(c,t){const n=a.create();return a.translate(n,n,[1,1,0]),a.scale(n,n,[.5*c.width,.5*c.height,1]),a.multiply(n,n,c.calculatePosMatrix(t.toUnwrapped()))}function Nr(c,t,n,s,u,d){const g=function(L,O,H){if(L)for(const V of L){const Z=O[V];if(Z&&Z.source===H&&Z.type==="fill-extrusion")return!0}else for(const V in O){const Z=O[V];if(Z.source===H&&Z.type==="fill-extrusion")return!0}return!1}(u&&u.layers,t,c.id),x=d.maxPitchScaleFactor(),v=c.tilesIn(s,x,g);v.sort(Dn);const S=[];for(const L of v)S.push({wrappedTileID:L.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(t,n,c._state,L.queryGeometry,L.cameraQueryGeometry,L.scale,u,d,x,$r(c.transform,L.tileID))});const C=function(L){const O={},H={};for(const V of L){const Z=V.queryResults,te=V.wrappedTileID,ie=H[te]=H[te]||{};for(const ae in Z){const re=Z[ae],_e=ie[ae]=ie[ae]||{},he=O[ae]=O[ae]||[];for(const me of re)_e[me.featureIndex]||(_e[me.featureIndex]=!0,he.push(me))}}return O}(S);for(const L in C)C[L].forEach(O=>{const H=O.feature,V=c.getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=V});return C}function Dn(c,t){const n=c.tileID,s=t.tileID;return n.overscaledZ-s.overscaledZ||n.canonical.y-s.canonical.y||n.wrap-s.wrap||n.canonical.x-s.canonical.x}class Do{constructor(t,n){this.tileID=t,this.uid=a.uniqueId(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<a.exported.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}loadVectorData(t,n,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(u,d){const g={};if(!d)return g;for(const x of u){const v=x.layerIds.map(S=>d.getLayer(S)).filter(Boolean);if(v.length!==0){x.layers=v,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(S=>v.filter(C=>C.id===S)[0]));for(const S of v)g[S.id]=x}}return g}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const d=this.buckets[u];if(d instanceof a.SymbolBucket){if(this.hasSymbolBuckets=!0,!s)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const d=this.buckets[u];if(d instanceof a.SymbolBucket&&d.hasRTLText){this.hasRTLText=!0,a.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const u in this.buckets){const d=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(u).queryRadius(d))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new a.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const s in this.buckets){const u=this.buckets[s];u.uploadPending()&&u.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new mt(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new mt(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,s,u,d,g,x,v,S,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:d,scale:g,tileSize:this.tileSize,pixelPosMatrix:C,transform:v,params:x,queryPadding:this.queryPadding*S},t,n,s):{}}querySourceFeatures(t,n){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const u=s.loadVTLayers(),d=n?n.sourceLayer:"",g=u._geojsonTileLayer||u[d];if(!g)return;const x=a.createFilter(n&&n.filter),{z:v,x:S,y:C}=this.tileID.canonical,L={z:v,x:S,y:C};for(let O=0;O<g.length;O++){const H=g.feature(O);if(x.needGeometry){const te=a.toEvaluationFeature(H,!0);if(!x.filter(new a.EvaluationParameters(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!x.filter(new a.EvaluationParameters(this.tileID.overscaledZ),H))continue;const V=s.getId(H,d),Z=new a.GeoJSONFeature(H,v,S,C,V);Z.tile=L,t.push(Z)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const s=a.parseCacheControl(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const s=Date.now();let u=!1;if(this.expirationTime>s)u=!1;else if(n)if(this.expirationTime<n)u=!0;else{const d=this.expirationTime-n;d?this.expirationTime=s+Math.max(d,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const s=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!n.style.hasLayer(u))continue;const d=this.buckets[u],g=d.layers[0].sourceLayer||"_geojsonTileLayer",x=s[g],v=t[g];if(!x||!v||Object.keys(v).length===0)continue;d.update(v,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});const S=n&&n.style&&n.style.getLayer(u);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=a.exported.now()+t}setDependencies(t,n){const s={};for(const u of n)s[u]=!0;this.dependencies[t]=s}hasDependency(t,n){for(const s of t){const u=this.dependencies[s];if(u){for(const d of n)if(u[d])return!0}}return!1}}class io{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,s){const u=t.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const d={value:n,timeout:void 0};if(s!==void 0&&(d.timeout=setTimeout(()=>{this.remove(t,d)},s)),this.data[u].push(d),this.order.push(u),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const s=t.wrapped().key,u=n===void 0?0:this.data[s].indexOf(n),d=this.data[s][u];return this.data[s].splice(u,1),d.timeout&&clearTimeout(d.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(d.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const s in this.data)for(const u of this.data[s])t(u.value)||n.push(u);for(const s of n)this.remove(s.value.tileID,s)}}class Lo{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,s){const u=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][u]=this.stateChanges[t][u]||{},a.extend(this.stateChanges[t][u],s),this.deletedStates[t]===null){this.deletedStates[t]={};for(const d in this.state[t])d!==u&&(this.deletedStates[t][d]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][u]===null){this.deletedStates[t][u]={};for(const d in this.state[t][u])s[d]||(this.deletedStates[t][u][d]=null)}else for(const d in s)this.deletedStates[t]&&this.deletedStates[t][u]&&this.deletedStates[t][u][d]===null&&delete this.deletedStates[t][u][d]}removeFeatureState(t,n,s){if(this.deletedStates[t]===null)return;const u=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&n!==void 0)this.deletedStates[t][u]!==null&&(this.deletedStates[t][u]=this.deletedStates[t][u]||{},this.deletedStates[t][u][s]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][u])for(s in this.deletedStates[t][u]={},this.stateChanges[t][u])this.deletedStates[t][u][s]=null;else this.deletedStates[t][u]=null;else this.deletedStates[t]=null}getState(t,n){const s=String(n),u=a.extend({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const d=this.deletedStates[t][n];if(d===null)return{};for(const g in d)delete u[g]}return u}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const s={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const d={};for(const g in this.stateChanges[u])this.state[u][g]||(this.state[u][g]={}),a.extend(this.state[u][g],this.stateChanges[u][g]),d[g]=this.state[u][g];s[u]=d}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const d={};if(this.deletedStates[u]===null)for(const g in this.state[u])d[g]={},this.state[u][g]={};else for(const g in this.deletedStates[u]){if(this.deletedStates[u][g]===null)this.state[u][g]={};else for(const x of Object.keys(this.deletedStates[u][g]))delete this.state[u][g][x];d[g]=this.state[u][g]}s[u]=s[u]||{},a.extend(s[u],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(const u in t)t[u].setFeatureState(s,n)}}class mi extends a.Evented{constructor(t,n,s){super(),this.id=t,this.dispatcher=s,this.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(u,d,g,x){const v=new dr[d.type](u,d,g,x);if(v.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${v.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],v),v}(t,n,s,this),this._tiles={},this._cache=new io(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Lo}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new a.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const s=this._tiles[n];s.upload(t),s.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Qr).map(t=>t.key)}getRenderableIds(t){const n=[];for(const s in this._tiles)this._isIdRenderable(s,t)&&n.push(this._tiles[s]);return t?n.sort((s,u)=>{const d=s.tileID,g=u.tileID,x=new a.pointGeometry(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),v=new a.pointGeometry(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-g.overscaledZ||v.y-x.y||v.x-x.x}).map(s=>s.tileID.key):n.map(s=>s.tileID).sort(Qr).map(s=>s.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){const s=this._tiles[t];s&&(s.state!=="loading"&&(s.state=n),this._loadTile(s,this._tileLoaded.bind(this,s,t,n)))}_tileLoaded(t,n,s,u){if(u)return t.state="errored",void(u.status!==404?this._source.fire(new a.ErrorEvent(u,{tile:t})):this.update(this.transform));t.timeAdded=a.exported.now(),s==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new a.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let u=0;u<n.length;u++){const d=n[u];if(t.neighboringTiles&&t.neighboringTiles[d]){const g=this.getTileByID(d);s(t,g),s(g,t)}}function s(u,d){u.needsHillshadePrepare=!0;let g=d.tileID.canonical.x-u.tileID.canonical.x;const x=d.tileID.canonical.y-u.tileID.canonical.y,v=Math.pow(2,u.tileID.canonical.z),S=d.tileID.key;g===0&&x===0||Math.abs(x)>1||(Math.abs(g)>1&&(Math.abs(g+v)===1?g+=v:Math.abs(g-v)===1&&(g-=v)),d.dem&&u.dem&&(u.dem.backfillBorder(d.dem,g,x),u.neighboringTiles&&u.neighboringTiles[S]&&(u.neighboringTiles[S].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,s,u){for(const d in this._tiles){let g=this._tiles[d];if(u[d]||!g.hasData()||g.tileID.overscaledZ<=n||g.tileID.overscaledZ>s)continue;let x=g.tileID;for(;g&&g.tileID.overscaledZ>n+1;){const S=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[S.key],g&&g.hasData()&&(x=S)}let v=x;for(;v.overscaledZ>n;)if(v=v.scaledTo(v.overscaledZ-1),t[v.key]){u[x.key]=x;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const s=this._loadedParentTiles[t.key];return s&&s.tileID.overscaledZ>=n?s:null}for(let s=t.overscaledZ-1;s>=n;s--){const u=t.scaledTo(s),d=this._getLoadedTile(u);if(d)return d}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,s=Math.ceil(t.height/this._source.tileSize)+1,u=Math.floor(n*s*5),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(d)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const s={};for(const u in this._tiles){const d=this._tiles[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),s[d.tileID.key]=d}this._tiles=s;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}update(t){if(this.transform=t,!this._sourceLoaded||this._paused)return;let n;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?n=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new a.OverscaledTileID(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(n=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(n=n.filter(v=>this._source.hasTile(v)))):n=[];const s=t.coveringZoomLevel(this._source),u=Math.max(s-mi.maxOverzooming,this._source.minzoom),d=Math.max(s+mi.maxUnderzooming,this._source.minzoom),g=this._updateRetainedTiles(n,s);if(ro(this._source.type)){const v={},S={},C=Object.keys(g);for(const L of C){const O=g[L],H=this._tiles[L];if(!H||H.fadeEndTime&&H.fadeEndTime<=a.exported.now())continue;const V=this.findLoadedParent(O,u);V&&(this._addTile(V.tileID),v[V.tileID.key]=V.tileID),S[L]=O}this._retainLoadedChildren(S,s,d,g);for(const L in v)g[L]||(this._coveredTiles[L]=!0,g[L]=v[L])}for(const v in g)this._tiles[v].clearFadeHold();const x=a.keysDifference(this._tiles,g);for(const v of x){const S=this._tiles[v];S.hasSymbolBuckets&&!S.holdingForFade()?S.setHoldDuration(this.map._fadeDuration):S.hasSymbolBuckets&&!S.symbolFadeFinished()||this._removeTile(v)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const s={},u={},d=Math.max(n-mi.maxOverzooming,this._source.minzoom),g=Math.max(n+mi.maxUnderzooming,this._source.minzoom),x={};for(const v of t){const S=this._addTile(v);s[v.key]=v,S.hasData()||n<this._source.maxzoom&&(x[v.key]=v)}this._retainLoadedChildren(x,n,g,s);for(const v of t){let S=this._tiles[v.key];if(S.hasData())continue;if(n+1>this._source.maxzoom){const L=v.children(this._source.maxzoom)[0],O=this.getTile(L);if(O&&O.hasData()){s[L.key]=L;continue}}else{const L=v.children(this._source.maxzoom);if(s[L[0].key]&&s[L[1].key]&&s[L[2].key]&&s[L[3].key])continue}let C=S.wasRequested();for(let L=v.overscaledZ-1;L>=d;--L){const O=v.scaledTo(L);if(u[O.key]||(u[O.key]=!0,S=this.getTile(O),!S&&C&&(S=this._addTile(O)),S&&(s[O.key]=O,C=S.wasRequested(),S.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let s,u=this._tiles[t].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){s=this._loadedParentTiles[u.key];break}n.push(u.key);const d=u.scaledTo(u.overscaledZ-1);if(s=this._getLoadedTile(d),s)break;u=d}for(const d of n)this._loadedParentTiles[d]=s}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const s=n;return n||(n=new Do(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n.uses++,this._tiles[t.key]=n,s||this._source.fire(new a.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const s=n.getExpiryTimeout();s&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},s))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,s){const u=[],d=this.transform;if(!d)return u;const g=s?d.getCameraQueryGeometry(t):t,x=t.map(V=>d.pointCoordinate(V)),v=g.map(V=>d.pointCoordinate(V)),S=this.getIds();let C=1/0,L=1/0,O=-1/0,H=-1/0;for(const V of v)C=Math.min(C,V.x),L=Math.min(L,V.y),O=Math.max(O,V.x),H=Math.max(H,V.y);for(let V=0;V<S.length;V++){const Z=this._tiles[S[V]];if(Z.holdingForFade())continue;const te=Z.tileID,ie=Math.pow(2,d.zoom-Z.tileID.overscaledZ),ae=n*Z.queryPadding*a.EXTENT/Z.tileSize/ie,re=[te.getTilePoint(new a.MercatorCoordinate(C,L)),te.getTilePoint(new a.MercatorCoordinate(O,H))];if(re[0].x-ae<a.EXTENT&&re[0].y-ae<a.EXTENT&&re[1].x+ae>=0&&re[1].y+ae>=0){const _e=x.map(me=>te.getTilePoint(me)),he=v.map(me=>te.getTilePoint(me));u.push({tile:Z,tileID:te,queryGeometry:_e,cameraQueryGeometry:he,scale:ie})}}return u}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(s=>this._tiles[s].tileID);for(const s of n)s.posMatrix=this.transform.calculatePosMatrix(s.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(ro(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=a.exported.now())return!0}return!1}setFeatureState(t,n,s){this._state.updateState(t=t||"_geojsonTileLayer",n,s)}removeFeatureState(t,n,s){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,s)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,s){const u=this._tiles[t];u&&u.setDependencies(n,s)}reloadTilesForDependencies(t,n){for(const s in this._tiles)this._tiles[s].hasDependency(t,n)&&this._reloadTile(s,"reloading");this._cache.filter(s=>!s.hasDependency(t,n))}}function Qr(c,t){const n=Math.abs(2*c.wrap)-+(c.wrap<0),s=Math.abs(2*t.wrap)-+(t.wrap<0);return c.overscaledZ-t.overscaledZ||s-n||t.canonical.y-c.canonical.y||t.canonical.x-c.canonical.x}function ro(c){return c==="raster"||c==="image"||c==="video"}mi.maxOverzooming=10,mi.maxUnderzooming=3;const ln="mapboxgl_preloaded_worker_pool";class Ir{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ir.workerCount;)this.workers.push(new Worker(So.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ln]}numActive(){return Object.keys(this.active).length}}const Bo=Math.floor(a.exported.hardwareConcurrency/2);let jr;function zr(){return jr||(jr=new Ir),jr}function Tr(c,t){const n={};for(const s in c)s!=="ref"&&(n[s]=c[s]);return a.refProperties.forEach(s=>{s in t&&(n[s]=t[s])}),n}function no(c){c=c.slice();const t=Object.create(null);for(let n=0;n<c.length;n++)t[c[n].id]=c[n];for(let n=0;n<c.length;n++)"ref"in c[n]&&(c[n]=Tr(c[n],t[c[n].ref]));return c}Ir.workerCount=Math.max(Math.min(Bo,6),1);const vt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function cn(c,t,n){n.push({command:vt.addSource,args:[c,t[c]]})}function en(c,t,n){t.push({command:vt.removeSource,args:[c]}),n[c]=!0}function un(c,t,n,s){en(c,n,s),cn(c,t,n)}function oo(c,t,n){let s;for(s in c[n])if(Object.prototype.hasOwnProperty.call(c[n],s)&&s!=="data"&&!W(c[n][s],t[n][s]))return!1;for(s in t[n])if(Object.prototype.hasOwnProperty.call(t[n],s)&&s!=="data"&&!W(c[n][s],t[n][s]))return!1;return!0}function fe(c,t,n,s,u,d){let g;for(g in t=t||{},c=c||{})Object.prototype.hasOwnProperty.call(c,g)&&(W(c[g],t[g])||n.push({command:d,args:[s,g,t[g],u]}));for(g in t)Object.prototype.hasOwnProperty.call(t,g)&&!Object.prototype.hasOwnProperty.call(c,g)&&(W(c[g],t[g])||n.push({command:d,args:[s,g,t[g],u]}))}function De(c){return c.id}function hn(c,t){return c[t.id]=t,c}class qr{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let s=1;s<this.points.length;s++)this._distances[s]=this._distances[s-1]+this.points[s].dist(this.points[s-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.clamp(t,0,1);let n=1,s=this._distances[n];const u=t*this.paddedLength+this.padding;for(;s<u&&n<this._distances.length;)s=this._distances[++n];const d=n-1,g=this._distances[d],x=s-g,v=x>0?(u-g)/x:0;return this.points[d].mult(1-v).add(this.points[n].mult(v))}}function Rt(c,t){let n=!0;return c==="always"||c!=="never"&&t!=="never"||(n=!1),n}class rr{constructor(t,n,s){const u=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(t/s),this.yCellCount=Math.ceil(n/s);for(let g=0;g<this.xCellCount*this.yCellCount;g++)u.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,s,u,d){this._forEachCell(n,s,u,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(d)}insertCircle(t,n,s,u){this._forEachCell(n-u,s-u,n+u,s+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(s),this.circles.push(u)}_insertBoxCell(t,n,s,u,d,g){this.boxCells[d].push(g)}_insertCircleCell(t,n,s,u,d,g){this.circleCells[d].push(g)}_query(t,n,s,u,d,g,x){if(s<0||t>this.width||u<0||n>this.height)return[];const v=[];if(t<=0&&n<=0&&this.width<=s&&this.height<=u){if(d)return[{key:null,x1:t,y1:n,x2:s,y2:u}];for(let S=0;S<this.boxKeys.length;S++)v.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const C=this.circles[3*S],L=this.circles[3*S+1],O=this.circles[3*S+2];v.push({key:this.circleKeys[S],x1:C-O,y1:L-O,x2:C+O,y2:L+O})}}else this._forEachCell(t,n,s,u,this._queryCell,v,{hitTest:d,overlapMode:g,seenUids:{box:{},circle:{}}},x);return v}query(t,n,s,u){return this._query(t,n,s,u,!1,null)}hitTest(t,n,s,u,d,g){return this._query(t,n,s,u,!0,d,g).length>0}hitTestCircle(t,n,s,u,d){const g=t-s,x=t+s,v=n-s,S=n+s;if(x<0||g>this.width||S<0||v>this.height)return!1;const C=[];return this._forEachCell(g,v,x,S,this._queryCellCircle,C,{hitTest:!0,overlapMode:u,circle:{x:t,y:n,radius:s},seenUids:{box:{},circle:{}}},d),C.length>0}_queryCell(t,n,s,u,d,g,x,v){const{seenUids:S,hitTest:C,overlapMode:L}=x,O=this.boxCells[d];if(O!==null){const V=this.bboxes;for(const Z of O)if(!S.box[Z]){S.box[Z]=!0;const te=4*Z,ie=this.boxKeys[Z];if(t<=V[te+2]&&n<=V[te+3]&&s>=V[te+0]&&u>=V[te+1]&&(!v||v(ie))&&(!C||!Rt(L,ie.overlapMode))&&(g.push({key:ie,x1:V[te],y1:V[te+1],x2:V[te+2],y2:V[te+3]}),C))return!0}}const H=this.circleCells[d];if(H!==null){const V=this.circles;for(const Z of H)if(!S.circle[Z]){S.circle[Z]=!0;const te=3*Z,ie=this.circleKeys[Z];if(this._circleAndRectCollide(V[te],V[te+1],V[te+2],t,n,s,u)&&(!v||v(ie))&&(!C||!Rt(L,ie.overlapMode))){const ae=V[te],re=V[te+1],_e=V[te+2];if(g.push({key:ie,x1:ae-_e,y1:re-_e,x2:ae+_e,y2:re+_e}),C)return!0}}}return!1}_queryCellCircle(t,n,s,u,d,g,x,v){const{circle:S,seenUids:C,overlapMode:L}=x,O=this.boxCells[d];if(O!==null){const V=this.bboxes;for(const Z of O)if(!C.box[Z]){C.box[Z]=!0;const te=4*Z,ie=this.boxKeys[Z];if(this._circleAndRectCollide(S.x,S.y,S.radius,V[te+0],V[te+1],V[te+2],V[te+3])&&(!v||v(ie))&&!Rt(L,ie.overlapMode))return g.push(!0),!0}}const H=this.circleCells[d];if(H!==null){const V=this.circles;for(const Z of H)if(!C.circle[Z]){C.circle[Z]=!0;const te=3*Z,ie=this.circleKeys[Z];if(this._circlesCollide(V[te],V[te+1],V[te+2],S.x,S.y,S.radius)&&(!v||v(ie))&&!Rt(L,ie.overlapMode))return g.push(!0),!0}}}_forEachCell(t,n,s,u,d,g,x,v){const S=this._convertToXCellCoord(t),C=this._convertToYCellCoord(n),L=this._convertToXCellCoord(s),O=this._convertToYCellCoord(u);for(let H=S;H<=L;H++)for(let V=C;V<=O;V++)if(d.call(this,t,n,s,u,this.xCellCount*V+H,g,x,v))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,s,u,d,g){const x=u-t,v=d-n,S=s+g;return S*S>x*x+v*v}_circleAndRectCollide(t,n,s,u,d,g,x){const v=(g-u)/2,S=Math.abs(t-(u+v));if(S>v+s)return!1;const C=(x-d)/2,L=Math.abs(n-(d+C));if(L>C+s)return!1;if(S<=v||L<=C)return!0;const O=S-v,H=L-C;return O*O+H*H<=s*s}}function Ci(c,t,n,s,u){const d=a.create();return t?(a.scale(d,d,[1/u,1/u,1]),n||a.rotateZ(d,d,s.angle)):a.multiply(d,s.labelPlaneMatrix,c),d}function pn(c,t,n,s,u){if(t){const d=a.clone(c);return a.scale(d,d,[u,u,1]),n||a.rotateZ(d,d,-s.angle),d}return s.glCoordMatrix}function Ut(c,t){const n=[c.x,c.y,0,1];Ft(n,n,t);const s=n[3];return{point:new a.pointGeometry(n[0]/s,n[1]/s),signedDistanceFromCamera:s}}function Me(c,t){return .5+c/t*.5}function dt(c,t){const n=c[0]/c[3],s=c[1]/c[3];return n>=-t[0]&&n<=t[0]&&s>=-t[1]&&s<=t[1]}function ut(c,t,n,s,u,d,g,x,v){const S=s?c.textSizeData:c.iconSizeData,C=a.evaluateSizeForZoom(S,n.transform.zoom),L=[256/n.width*2+1,256/n.height*2+1],O=s?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;O.clear();const H=c.lineVertexArray,V=s?c.text.placedSymbolArray:c.icon.placedSymbolArray,Z=n.transform.width/n.transform.height;let te=!1;for(let ie=0;ie<V.length;ie++){const ae=V.get(ie);if(ae.hidden||ae.writingMode===a.WritingMode.vertical&&!te){ri(ae.numGlyphs,O);continue}te=!1;const re=[ae.anchorX,ae.anchorY,0,1];if(a.transformMat4(re,re,t),!dt(re,L)){ri(ae.numGlyphs,O);continue}const _e=Me(n.transform.cameraToCenterDistance,re[3]),he=a.evaluateSizeForFeature(S,C,ae),me=g?he/_e:he*_e,Se=new a.pointGeometry(ae.anchorX,ae.anchorY),Te=Ut(Se,u).point,ye={},qe=ht(ae,me,!1,x,t,u,d,c.glyphOffsetArray,H,O,Te,Se,ye,Z,v);te=qe.useVertical,(qe.notEnoughRoom||te||qe.needsFlipping&&ht(ae,me,!0,x,t,u,d,c.glyphOffsetArray,H,O,Te,Se,ye,Z,v).notEnoughRoom)&&ri(ae.numGlyphs,O)}s?c.text.dynamicLayoutVertexBuffer.updateData(O):c.icon.dynamicLayoutVertexBuffer.updateData(O)}function Mi(c,t,n,s,u,d,g,x,v,S,C,L){const O=x.glyphStartIndex+x.numGlyphs,H=x.lineStartIndex,V=x.lineStartIndex+x.lineLength,Z=t.getoffsetX(x.glyphStartIndex),te=t.getoffsetX(O-1),ie=fr(c*Z,n,s,u,d,g,x.segment,H,V,v,S,C,L);if(!ie)return null;const ae=fr(c*te,n,s,u,d,g,x.segment,H,V,v,S,C,L);return ae?{first:ie,last:ae}:null}function mr(c,t,n,s){return c===a.WritingMode.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*s?{useVertical:!0}:(c===a.WritingMode.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function ht(c,t,n,s,u,d,g,x,v,S,C,L,O,H,V){const Z=t/24,te=c.lineOffsetX*Z,ie=c.lineOffsetY*Z;let ae;if(c.numGlyphs>1){const re=c.glyphStartIndex+c.numGlyphs,_e=c.lineStartIndex,he=c.lineStartIndex+c.lineLength,me=Mi(Z,x,te,ie,n,C,L,c,v,d,O,V);if(!me)return{notEnoughRoom:!0};const Se=Ut(me.first.point,g).point,Te=Ut(me.last.point,g).point;if(s&&!n){const ye=mr(c.writingMode,Se,Te,H);if(ye)return ye}ae=[me.first];for(let ye=c.glyphStartIndex+1;ye<re-1;ye++)ae.push(fr(Z*x.getoffsetX(ye),te,ie,n,C,L,c.segment,_e,he,v,d,O,V));ae.push(me.last)}else{if(s&&!n){const _e=Ut(L,u).point,he=c.lineStartIndex+c.segment+1,me=new a.pointGeometry(v.getx(he),v.gety(he)),Se=Ut(me,u),Te=Se.signedDistanceFromCamera>0?Se.point:dn(L,me,_e,1,u),ye=mr(c.writingMode,_e,Te,H);if(ye)return ye}const re=fr(Z*x.getoffsetX(c.glyphStartIndex),te,ie,n,C,L,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,v,d,O,V);if(!re)return{notEnoughRoom:!0};ae=[re]}for(const re of ae)a.addDynamicAttributes(S,re.point,re.angle);return{}}function dn(c,t,n,s,u){const d=Ut(c.add(c.sub(t)._unit()),u).point,g=n.sub(d);return n.add(g._mult(s/g.mag()))}function fr(c,t,n,s,u,d,g,x,v,S,C,L,O){const H=s?c-t:c+t;let V=H>0?1:-1,Z=0;s&&(V*=-1,Z=Math.PI),V<0&&(Z+=Math.PI);let te=V>0?x+g:x+g+1,ie=u,ae=u,re=0,_e=0;const he=Math.abs(H),me=[];for(;re+_e<=he;){if(te+=V,te<x||te>=v)return null;if(ae=ie,me.push(ie),ie=L[te],ie===void 0){const Le=new a.pointGeometry(S.getx(te),S.gety(te)),at=Ut(Le,C);if(at.signedDistanceFromCamera>0)ie=L[te]=at.point;else{const wt=te-V;ie=dn(re===0?d:new a.pointGeometry(S.getx(wt),S.gety(wt)),Le,ae,he-re+1,C)}}re+=_e,_e=ae.dist(ie)}const Se=(he-re)/_e,Te=ie.sub(ae),ye=Te.mult(Se)._add(ae);ye._add(Te._unit()._perp()._mult(n*V));const qe=Z+Math.atan2(ie.y-ae.y,ie.x-ae.x);return me.push(ye),{point:ye,angle:O?qe:0,path:me}}const Gr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ri(c,t){for(let n=0;n<c;n++){const s=t.length;t.resize(s+4),t.float32.set(Gr,3*s)}}function Ft(c,t,n){const s=t[0],u=t[1];return c[0]=n[0]*s+n[4]*u+n[12],c[1]=n[1]*s+n[5]*u+n[13],c[3]=n[3]*s+n[7]*u+n[15],c}const nr=100;class mn{constructor(t,n=new rr(t.width+200,t.height+200,25),s=new rr(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=s,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+nr,this.screenBottomBoundary=t.height+nr,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200}placeCollisionBox(t,n,s,u,d){const g=this.projectAndGetPerspectiveRatio(u,t.anchorPointX,t.anchorPointY),x=s*g.perspectiveRatio,v=t.x1*x+g.point.x,S=t.y1*x+g.point.y,C=t.x2*x+g.point.x,L=t.y2*x+g.point.y;return!this.isInsideGrid(v,S,C,L)||n!=="always"&&this.grid.hitTest(v,S,C,L,n,d)?{box:[],offscreen:!1}:{box:[v,S,C,L],offscreen:this.isOffscreen(v,S,C,L)}}placeCollisionCircles(t,n,s,u,d,g,x,v,S,C,L,O,H){const V=[],Z=new a.pointGeometry(n.anchorX,n.anchorY),te=Ut(Z,g),ie=Me(this.transform.cameraToCenterDistance,te.signedDistanceFromCamera),ae=(C?d/ie:d*ie)/a.ONE_EM,re=Ut(Z,x).point,_e=Mi(ae,u,n.lineOffsetX*ae,n.lineOffsetY*ae,!1,re,Z,n,s,x,{},!1);let he=!1,me=!1,Se=!0;if(_e){const Te=.5*O*ie+H,ye=new a.pointGeometry(-100,-100),qe=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Le=new qr,at=_e.first,wt=_e.last;let gt=[];for(let st=at.path.length-1;st>=1;st--)gt.push(at.path[st]);for(let st=1;st<wt.path.length;st++)gt.push(wt.path[st]);const xt=2.5*Te;if(v){const st=gt.map(It=>Ut(It,v));gt=st.some(It=>It.signedDistanceFromCamera<=0)?[]:st.map(It=>It.point)}let Yt=[];if(gt.length>0){const st=gt[0].clone(),It=gt[0].clone();for(let Lt=1;Lt<gt.length;Lt++)st.x=Math.min(st.x,gt[Lt].x),st.y=Math.min(st.y,gt[Lt].y),It.x=Math.max(It.x,gt[Lt].x),It.y=Math.max(It.y,gt[Lt].y);Yt=st.x>=ye.x&&It.x<=qe.x&&st.y>=ye.y&&It.y<=qe.y?[gt]:It.x<ye.x||st.x>qe.x||It.y<ye.y||st.y>qe.y?[]:a.clipLine([gt],ye.x,ye.y,qe.x,qe.y)}for(const st of Yt){Le.reset(st,.25*Te);let It=0;It=Le.length<=.5*Te?1:Math.ceil(Le.paddedLength/xt)+1;for(let Lt=0;Lt<It;Lt++){const bi=Lt/Math.max(It-1,1),Yi=Le.lerp(bi),ar=Yi.x+nr,sr=Yi.y+nr;V.push(ar,sr,Te,0);const rn=ar-Te,Ui=sr-Te,Cr=ar+Te,An=sr+Te;if(Se=Se&&this.isOffscreen(rn,Ui,Cr,An),me=me||this.isInsideGrid(rn,Ui,Cr,An),t!=="always"&&this.grid.hitTestCircle(ar,sr,Te,t,L)&&(he=!0,!S))return{circles:[],offscreen:!1,collisionDetected:he}}}}return{circles:!S&&he||!me?[]:V,offscreen:Se,collisionDetected:he}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let s=1/0,u=1/0,d=-1/0,g=-1/0;for(const C of t){const L=new a.pointGeometry(C.x+nr,C.y+nr);s=Math.min(s,L.x),u=Math.min(u,L.y),d=Math.max(d,L.x),g=Math.max(g,L.y),n.push(L)}const x=this.grid.query(s,u,d,g).concat(this.ignoredGrid.query(s,u,d,g)),v={},S={};for(const C of x){const L=C.key;if(v[L.bucketInstanceId]===void 0&&(v[L.bucketInstanceId]={}),v[L.bucketInstanceId][L.featureIndex])continue;const O=[new a.pointGeometry(C.x1,C.y1),new a.pointGeometry(C.x2,C.y1),new a.pointGeometry(C.x2,C.y2),new a.pointGeometry(C.x1,C.y2)];a.polygonIntersectsPolygon(n,O)&&(v[L.bucketInstanceId][L.featureIndex]=!0,S[L.bucketInstanceId]===void 0&&(S[L.bucketInstanceId]=[]),S[L.bucketInstanceId].push(L.featureIndex))}return S}insertCollisionBox(t,n,s,u,d,g){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:d,collisionGroupID:g,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,s,u,d,g){const x=s?this.ignoredGrid:this.grid,v={bucketInstanceId:u,featureIndex:d,collisionGroupID:g,overlapMode:n};for(let S=0;S<t.length;S+=4)x.insertCircle(v,t[S],t[S+1],t[S+2])}projectAndGetPerspectiveRatio(t,n,s){const u=[n,s,0,1];return Ft(u,u,t),{point:new a.pointGeometry((u[0]/u[3]+1)/2*this.transform.width+nr,(-u[1]/u[3]+1)/2*this.transform.height+nr),perspectiveRatio:.5+this.transform.cameraToCenterDistance/u[3]*.5}}isOffscreen(t,n,s,u){return s<nr||t>=this.screenRightBoundary||u<nr||n>this.screenBottomBoundary}isInsideGrid(t,n,s,u){return s>=0&&t<this.gridRightBoundary&&u>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=a.identity([]);return a.translate(t,t,[-100,-100,0]),t}}function ui(c,t,n){return t*(a.EXTENT/(c.tileSize*Math.pow(2,n-c.tileID.overscaledZ)))}class gr{constructor(t,n,s,u){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):u&&s?1:0,this.placed=s}isHidden(){return this.opacity===0&&!this.placed}}class yr{constructor(t,n,s,u,d){this.text=new gr(t?t.text:null,n,s,d),this.icon=new gr(t?t.icon:null,n,u,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ao{constructor(t,n,s){this.text=t,this.icon=n,this.skipFade=s}}class Ln{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Bn{constructor(t,n,s,u,d){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=s,this.bucketIndex=u,this.tileID=d}}class ${constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:s=>s.collisionGroupID===n}}return this.collisionGroups[t]}}function A(c,t,n,s,u){const{horizontalAlign:d,verticalAlign:g}=a.getAnchorAlignment(c),x=-(d-.5)*t,v=-(g-.5)*n,S=a.evaluateVariableOffset(c,s);return new a.pointGeometry(x+S[0]*u,v+S[1]*u)}function z(c,t,n,s,u,d){const{x1:g,x2:x,y1:v,y2:S,anchorPointX:C,anchorPointY:L}=c,O=new a.pointGeometry(t,n);return s&&O._rotate(u?d:-d),{x1:g+O.x,y1:v+O.y,x2:x+O.x,y2:S+O.y,anchorPointX:C,anchorPointY:L}}class F{constructor(t,n,s,u){this.transform=t.clone(),this.collisionIndex=new mn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new $(s),this.collisionCircleArrays={},this.prevPlacement=u,u&&(u.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,s,u){const d=s.getBucket(n),g=s.latestFeatureIndex;if(!d||!g||n.id!==d.layerIds[0])return;const x=s.collisionBoxArray,v=d.layers[0].layout,S=Math.pow(2,this.transform.zoom-s.tileID.overscaledZ),C=s.tileSize/a.EXTENT,L=this.transform.calculatePosMatrix(s.tileID.toUnwrapped()),O=v.get("text-pitch-alignment")==="map",H=v.get("text-rotation-alignment")==="map",V=ui(s,1,this.transform.zoom),Z=Ci(L,O,H,this.transform,V);let te=null;if(O){const ae=pn(L,O,H,this.transform,V);te=a.multiply([],this.transform.labelPlaneMatrix,ae)}this.retainedQueryData[d.bucketInstanceId]=new Bn(d.bucketInstanceId,g,d.sourceLayerIndex,d.index,s.tileID);const ie={bucket:d,layout:v,posMatrix:L,textLabelPlaneMatrix:Z,labelToScreenMatrix:te,scale:S,textPixelRatio:C,holdingForFade:s.holdingForFade(),collisionBoxArray:x,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(u)for(const ae of d.sortKeyRanges){const{sortKey:re,symbolInstanceStart:_e,symbolInstanceEnd:he}=ae;t.push({sortKey:re,symbolInstanceStart:_e,symbolInstanceEnd:he,parameters:ie})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(t,n,s,u,d,g,x,v,S,C,L,O,H,V,Z){const te=[O.textOffset0,O.textOffset1],ie=A(t,s,u,te,d),ae=this.collisionIndex.placeCollisionBox(z(n,ie.x,ie.y,g,x,this.transform.angle),L,v,S,C.predicate);if((!Z||this.collisionIndex.placeCollisionBox(z(Z,ie.x,ie.y,g,x,this.transform.angle),L,v,S,C.predicate).box.length!==0)&&ae.box.length>0){let re;return this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(re=this.prevPlacement.variableOffsets[O.crossTileID].anchor),this.variableOffsets[O.crossTileID]={textOffset:te,width:s,height:u,anchor:t,textBoxScale:d,prevAnchor:re},this.markUsedJustification(H,t,O,V),H.allowVerticalPlacement&&(this.markUsedOrientation(H,V,O),this.placedOrientations[O.crossTileID]=V),{shift:ie,placedGlyphBoxes:ae}}}placeLayerBucketPart(t,n,s){const{bucket:u,layout:d,posMatrix:g,textLabelPlaneMatrix:x,labelToScreenMatrix:v,textPixelRatio:S,holdingForFade:C,collisionBoxArray:L,partiallyEvaluatedTextSize:O,collisionGroup:H}=t.parameters,V=d.get("text-optional"),Z=d.get("icon-optional"),te=a.getOverlapMode(d,"text-overlap","text-allow-overlap"),ie=te==="always",ae=a.getOverlapMode(d,"icon-overlap","icon-allow-overlap"),re=ae==="always",_e=d.get("text-rotation-alignment")==="map",he=d.get("text-pitch-alignment")==="map",me=d.get("icon-text-fit")!=="none",Se=d.get("symbol-z-order")==="viewport-y",Te=ie&&(re||!u.hasIconData()||Z),ye=re&&(ie||!u.hasTextData()||V);!u.collisionArrays&&L&&u.deserializeCollisionBoxes(L);const qe=(Le,at)=>{if(n[Le.crossTileID])return;if(C)return void(this.placements[Le.crossTileID]=new ao(!1,!1,!1));let wt=!1,gt=!1,xt=!0,Yt=null,st={box:null,offscreen:null},It={box:null,offscreen:null},Lt=null,bi=null,Yi=null,ar=0,sr=0,rn=0;at.textFeatureIndex?ar=at.textFeatureIndex:Le.useRuntimeCollisionCircles&&(ar=Le.featureIndex),at.verticalTextFeatureIndex&&(sr=at.verticalTextFeatureIndex);const Ui=at.textBox;if(Ui){const Ki=Mt=>{let oi=a.WritingMode.horizontal;if(u.allowVerticalPlacement&&!Mt&&this.prevPlacement){const Pi=this.prevPlacement.placedOrientations[Le.crossTileID];Pi&&(this.placedOrientations[Le.crossTileID]=Pi,oi=Pi,this.markUsedOrientation(u,oi,Le))}return oi},zt=(Mt,oi)=>{if(u.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&at.verticalTextBox){for(const Pi of u.writingModes)if(Pi===a.WritingMode.vertical?(st=oi(),It=st):st=Mt(),st&&st.box&&st.box.length)break}else st=Mt()};if(d.get("text-variable-anchor")){let Mt=d.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Le.crossTileID]){const qt=this.prevPlacement.variableOffsets[Le.crossTileID];Mt.indexOf(qt.anchor)>0&&(Mt=Mt.filter(En=>En!==qt.anchor),Mt.unshift(qt.anchor))}const oi=(qt,En,Mr)=>{const ca=qt.x2-qt.x1,as=qt.y2-qt.y1,ua=Le.textBoxScale,ul=me&&ae==="never"?En:null;let Sn={box:[],offscreen:!1};const ha=te!=="never"?2*Mt.length:Mt.length;for(let Pr=0;Pr<ha;++Pr){const Wn=this.attemptAnchorPlacement(Mt[Pr%Mt.length],qt,ca,as,ua,_e,he,S,g,H,Pr>=Mt.length?te:"never",Le,u,Mr,ul);if(Wn&&(Sn=Wn.placedGlyphBoxes,Sn&&Sn.box&&Sn.box.length)){wt=!0,Yt=Wn.shift;break}}return Sn};zt(()=>oi(Ui,at.iconBox,a.WritingMode.horizontal),()=>{const qt=at.verticalTextBox;return u.allowVerticalPlacement&&!(st&&st.box&&st.box.length)&&Le.numVerticalGlyphVertices>0&&qt?oi(qt,at.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),st&&(wt=st.box,xt=st.offscreen);const Pi=Ki(st&&st.box);if(!wt&&this.prevPlacement){const qt=this.prevPlacement.variableOffsets[Le.crossTileID];qt&&(this.variableOffsets[Le.crossTileID]=qt,this.markUsedJustification(u,qt.anchor,Le,Pi))}}else{const Mt=(oi,Pi)=>{const qt=this.collisionIndex.placeCollisionBox(oi,te,S,g,H.predicate);return qt&&qt.box&&qt.box.length&&(this.markUsedOrientation(u,Pi,Le),this.placedOrientations[Le.crossTileID]=Pi),qt};zt(()=>Mt(Ui,a.WritingMode.horizontal),()=>{const oi=at.verticalTextBox;return u.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&oi?Mt(oi,a.WritingMode.vertical):{box:null,offscreen:null}}),Ki(st&&st.box&&st.box.length)}}if(Lt=st,wt=Lt&&Lt.box&&Lt.box.length>0,xt=Lt&&Lt.offscreen,Le.useRuntimeCollisionCircles){const Ki=u.text.placedSymbolArray.get(Le.centerJustifiedTextSymbolIndex),zt=a.evaluateSizeForFeature(u.textSizeData,O,Ki),Mt=d.get("text-padding");bi=this.collisionIndex.placeCollisionCircles(te,Ki,u.lineVertexArray,u.glyphOffsetArray,zt,g,x,v,s,he,H.predicate,Le.collisionCircleDiameter,Mt),wt=ie||bi.circles.length>0&&!bi.collisionDetected,xt=xt&&bi.offscreen}if(at.iconFeatureIndex&&(rn=at.iconFeatureIndex),at.iconBox){const Ki=zt=>{const Mt=me&&Yt?z(zt,Yt.x,Yt.y,_e,he,this.transform.angle):zt;return this.collisionIndex.placeCollisionBox(Mt,ae,S,g,H.predicate)};It&&It.box&&It.box.length&&at.verticalIconBox?(Yi=Ki(at.verticalIconBox),gt=Yi.box.length>0):(Yi=Ki(at.iconBox),gt=Yi.box.length>0),xt=xt&&Yi.offscreen}const Cr=V||Le.numHorizontalGlyphVertices===0&&Le.numVerticalGlyphVertices===0,An=Z||Le.numIconVertices===0;if(Cr||An?An?Cr||(gt=gt&&wt):wt=gt&&wt:gt=wt=gt&&wt,wt&&Lt&&Lt.box&&this.collisionIndex.insertCollisionBox(Lt.box,te,d.get("text-ignore-placement"),u.bucketInstanceId,It&&It.box&&sr?sr:ar,H.ID),gt&&Yi&&this.collisionIndex.insertCollisionBox(Yi.box,ae,d.get("icon-ignore-placement"),u.bucketInstanceId,rn,H.ID),bi&&(wt&&this.collisionIndex.insertCollisionCircles(bi.circles,te,d.get("text-ignore-placement"),u.bucketInstanceId,ar,H.ID),s)){const Ki=u.bucketInstanceId;let zt=this.collisionCircleArrays[Ki];zt===void 0&&(zt=this.collisionCircleArrays[Ki]=new Ln);for(let Mt=0;Mt<bi.circles.length;Mt+=4)zt.circles.push(bi.circles[Mt+0]),zt.circles.push(bi.circles[Mt+1]),zt.circles.push(bi.circles[Mt+2]),zt.circles.push(bi.collisionDetected?1:0)}this.placements[Le.crossTileID]=new ao(wt||Te,gt||ye,xt||u.justReloaded),n[Le.crossTileID]=!0};if(Se){const Le=u.getSortedSymbolIndexes(this.transform.angle);for(let at=Le.length-1;at>=0;--at){const wt=Le[at];qe(u.symbolInstances.get(wt),u.collisionArrays[wt])}}else for(let Le=t.symbolInstanceStart;Le<t.symbolInstanceEnd;Le++)qe(u.symbolInstances.get(Le),u.collisionArrays[Le]);if(s&&u.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[u.bucketInstanceId];a.invert(Le.invProjMatrix,g),Le.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}markUsedJustification(t,n,s,u){let d;d=u===a.WritingMode.vertical?s.verticalPlacedTextSymbolIndex:{left:s.leftJustifiedTextSymbolIndex,center:s.centerJustifiedTextSymbolIndex,right:s.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(n)];const g=[s.leftJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.rightJustifiedTextSymbolIndex,s.verticalPlacedTextSymbolIndex];for(const x of g)x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=d>=0&&x!==d?0:s.crossTileID)}markUsedOrientation(t,n,s){const u=n===a.WritingMode.horizontal||n===a.WritingMode.horizontalOnly?n:0,d=n===a.WritingMode.vertical?n:0,g=[s.leftJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.rightJustifiedTextSymbolIndex];for(const x of g)t.text.placedSymbolArray.get(x).placedOrientation=u;s.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(s.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let s=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const u=n?n.symbolFadeChange(t):1,d=n?n.opacities:{},g=n?n.variableOffsets:{},x=n?n.placedOrientations:{};for(const v in this.placements){const S=this.placements[v],C=d[v];C?(this.opacities[v]=new yr(C,u,S.text,S.icon),s=s||S.text!==C.text.placed||S.icon!==C.icon.placed):(this.opacities[v]=new yr(null,u,S.text,S.icon,S.skipFade),s=s||S.text||S.icon)}for(const v in d){const S=d[v];if(!this.opacities[v]){const C=new yr(S,u,!1,!1);C.isHidden()||(this.opacities[v]=C,s=s||S.text.placed||S.icon.placed)}}for(const v in g)this.variableOffsets[v]||!this.opacities[v]||this.opacities[v].isHidden()||(this.variableOffsets[v]=g[v]);for(const v in x)this.placedOrientations[v]||!this.opacities[v]||this.opacities[v].isHidden()||(this.placedOrientations[v]=x[v]);s?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const s={};for(const u of n){const d=u.getBucket(t);d&&u.latestFeatureIndex&&t.id===d.layerIds[0]&&this.updateBucketOpacities(d,s,u.collisionBoxArray)}}updateBucketOpacities(t,n,s){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const u=t.layers[0].layout,d=new yr(null,0,!1,!1,!0),g=u.get("text-allow-overlap"),x=u.get("icon-allow-overlap"),v=u.get("text-variable-anchor"),S=u.get("text-rotation-alignment")==="map",C=u.get("text-pitch-alignment")==="map",L=u.get("icon-text-fit")!=="none",O=new yr(null,0,g&&(x||!t.hasIconData()||u.get("icon-optional")),x&&(g||!t.hasTextData()||u.get("text-optional")),!0);!t.collisionArrays&&s&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(s);const H=(V,Z,te)=>{for(let ie=0;ie<Z/4;ie++)V.opacityVertexArray.emplaceBack(te)};for(let V=0;V<t.symbolInstances.length;V++){const Z=t.symbolInstances.get(V),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:ie,crossTileID:ae}=Z;let re=this.opacities[ae];n[ae]?re=d:re||(re=O,this.opacities[ae]=re),n[ae]=!0;const _e=Z.numIconVertices>0,he=this.placedOrientations[Z.crossTileID],me=he===a.WritingMode.vertical,Se=he===a.WritingMode.horizontal||he===a.WritingMode.horizontalOnly;if(te>0||ie>0){const Te=ue(re.text);H(t.text,te,me?Ge:Te),H(t.text,ie,Se?Ge:Te);const ye=re.text.isHidden();[Z.rightJustifiedTextSymbolIndex,Z.centerJustifiedTextSymbolIndex,Z.leftJustifiedTextSymbolIndex].forEach(at=>{at>=0&&(t.text.placedSymbolArray.get(at).hidden=ye||me?1:0)}),Z.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Z.verticalPlacedTextSymbolIndex).hidden=ye||Se?1:0);const qe=this.variableOffsets[Z.crossTileID];qe&&this.markUsedJustification(t,qe.anchor,Z,he);const Le=this.placedOrientations[Z.crossTileID];Le&&(this.markUsedJustification(t,"left",Z,Le),this.markUsedOrientation(t,Le,Z))}if(_e){const Te=ue(re.icon),ye=!(L&&Z.verticalPlacedIconSymbolIndex&&me);Z.placedIconSymbolIndex>=0&&(H(t.icon,Z.numIconVertices,ye?Te:Ge),t.icon.placedSymbolArray.get(Z.placedIconSymbolIndex).hidden=re.icon.isHidden()),Z.verticalPlacedIconSymbolIndex>=0&&(H(t.icon,Z.numVerticalIconVertices,ye?Ge:Te),t.icon.placedSymbolArray.get(Z.verticalPlacedIconSymbolIndex).hidden=re.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Te=t.collisionArrays[V];if(Te){let ye=new a.pointGeometry(0,0);if(Te.textBox||Te.verticalTextBox){let Le=!0;if(v){const at=this.variableOffsets[ae];at?(ye=A(at.anchor,at.width,at.height,at.textOffset,at.textBoxScale),S&&ye._rotate(C?this.transform.angle:-this.transform.angle)):Le=!1}Te.textBox&&N(t.textCollisionBox.collisionVertexArray,re.text.placed,!Le||me,ye.x,ye.y),Te.verticalTextBox&&N(t.textCollisionBox.collisionVertexArray,re.text.placed,!Le||Se,ye.x,ye.y)}const qe=Boolean(!Se&&Te.verticalIconBox);Te.iconBox&&N(t.iconCollisionBox.collisionVertexArray,re.icon.placed,qe,L?ye.x:0,L?ye.y:0),Te.verticalIconBox&&N(t.iconCollisionBox.collisionVertexArray,re.icon.placed,!qe,L?ye.x:0,L?ye.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const V=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=V.invProjMatrix,t.placementViewportMatrix=V.viewportMatrix,t.collisionCircleArray=V.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const s=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*s>t}setStale(){this.stale=!0}}function N(c,t,n,s,u){c.emplaceBack(t?1:0,n?1:0,s||0,u||0),c.emplaceBack(t?1:0,n?1:0,s||0,u||0),c.emplaceBack(t?1:0,n?1:0,s||0,u||0),c.emplaceBack(t?1:0,n?1:0,s||0,u||0)}const q=Math.pow(2,25),Q=Math.pow(2,24),K=Math.pow(2,17),J=Math.pow(2,16),ee=Math.pow(2,9),pe=Math.pow(2,8),we=Math.pow(2,1);function ue(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,n=Math.floor(127*c.opacity);return n*q+t*Q+n*K+t*J+n*ee+t*pe+n*we+t}const Ge=0;class Oe{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,s,u,d){const g=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(g,u,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,g.sort((x,v)=>x.sortKey-v.sortKey));this._currentPartIndex<g.length;)if(n.placeLayerBucketPart(g[this._currentPartIndex],this._seenCrossTileIDs,s),this._currentPartIndex++,d())return!0;return!1}}class We{constructor(t,n,s,u,d,g,x){this.placement=new F(t,d,g,x),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=s,this._showCollisionBoxes=u,this._done=!1}isDone(){return this._done}continuePlacement(t,n,s){const u=a.exported.now(),d=()=>{const g=a.exported.now()-u;return!this._forceFullPlacement&&g>2};for(;this._currentPlacementIndex>=0;){const g=n[t[this._currentPlacementIndex]],x=this.placement.collisionIndex.transform.zoom;if(g.type==="symbol"&&(!g.minzoom||g.minzoom<=x)&&(!g.maxzoom||g.maxzoom>x)){if(this._inProgressLayer||(this._inProgressLayer=new Oe(g)),this._inProgressLayer.continuePlacement(s[g.source],this.placement,this._showCollisionBoxes,g,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Je=512/a.EXTENT/2;class Et{constructor(t,n,s){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=s;for(let u=0;u<n.length;u++){const d=n.get(u),g=d.key;this.indexedSymbolInstances[g]||(this.indexedSymbolInstances[g]=[]),this.indexedSymbolInstances[g].push({crossTileID:d.crossTileID,coord:this.getScaledCoordinates(d,t)})}}getScaledCoordinates(t,n){const s=Je/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*a.EXTENT+t.anchorX)*s),y:Math.floor((n.canonical.y*a.EXTENT+t.anchorY)*s)}}findMatches(t,n,s){const u=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let d=0;d<t.length;d++){const g=t.get(d);if(g.crossTileID)continue;const x=this.indexedSymbolInstances[g.key];if(!x)continue;const v=this.getScaledCoordinates(g,n);for(const S of x)if(Math.abs(S.coord.x-v.x)<=u&&Math.abs(S.coord.y-v.y)<=u&&!s[S.crossTileID]){s[S.crossTileID]=!0,g.crossTileID=S.crossTileID;break}}}}class _t{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ft{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const s in this.indexes){const u=this.indexes[s],d={};for(const g in u){const x=u[g];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+n),d[x.tileID.key]=x}this.indexes[s]=d}this.lng=t}addBucket(t,n,s){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let d=0;d<n.symbolInstances.length;d++)n.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const u=this.usedCrossTileIDs[t.overscaledZ];for(const d in this.indexes){const g=this.indexes[d];if(Number(d)>t.overscaledZ)for(const x in g){const v=g[x];v.tileID.isChildOf(t)&&v.findMatches(n.symbolInstances,t,u)}else{const x=g[t.scaledTo(Number(d)).key];x&&x.findMatches(n.symbolInstances,t,u)}}for(let d=0;d<n.symbolInstances.length;d++){const g=n.symbolInstances.get(d);g.crossTileID||(g.crossTileID=s.generate(),u[g.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Et(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const s in n.indexedSymbolInstances)for(const u of n.indexedSymbolInstances[s])delete this.usedCrossTileIDs[t][u.crossTileID]}removeStaleBuckets(t){let n=!1;for(const s in this.indexes){const u=this.indexes[s];for(const d in u)t[u[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(s,u[d]),delete u[d],n=!0)}return n}}class pt{constructor(){this.layerIndexes={},this.crossTileIDs=new _t,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,s){let u=this.layerIndexes[t.id];u===void 0&&(u=this.layerIndexes[t.id]=new ft);let d=!1;const g={};u.handleWrapJump(s);for(const x of n){const v=x.getBucket(t);v&&t.id===v.layerIds[0]&&(v.bucketInstanceId||(v.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(x.tileID,v,this.crossTileIDs)&&(d=!0),g[v.bucketInstanceId]=!0)}return u.removeStaleBuckets(g)&&(d=!0),d}pruneUnusedLayers(t){const n={};t.forEach(s=>{n[s]=!0});for(const s in this.layerIndexes)n[s]||delete this.layerIndexes[s]}}const ct=(c,t)=>a.emitValidationErrors(c,t&&t.filter(n=>n.identifier!=="source.canvas")),ei=a.pick(vt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Kt=a.pick(vt,["setCenter","setZoom","setBearing","setPitch"]),fi=function(){const c={},t=a.spec.$version;for(const n in a.spec.$root){const s=a.spec.$root[n];if(s.required){let u=null;u=n==="version"?t:s.type==="array"?[]:{},u!=null&&(c[n]=u)}}return c}();class xi extends a.Evented{constructor(t,n={}){super(),this.map=t,this.dispatcher=new Hi(zr(),this),this.imageManager=new Ke,this.imageManager.setEventedParent(this),this.glyphManager=new Ht(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Er(256,512),this.crossTileSymbolIndex=new pt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const s=this;this._rtlTextPluginCallback=xi.registerForPluginStateChange(u=>{s.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:u.pluginStatus,pluginURL:u.pluginURL},(d,g)=>{if(a.triggerPluginCompletionEvent(d),g&&g.every(x=>x))for(const x in s.sourceCaches)s.sourceCaches[x].reload()})}),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const d=this.sourceCaches[u.sourceId];if(!d)return;const g=d.getSource();if(g&&g.vectorLayerIds)for(const x in this._layers){const v=this._layers[x];v.source===g.id&&this._validateLayer(v)}})}loadURL(t,n={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const s=typeof n.validate!="boolean"||n.validate,u=this.map._requestManager.transformRequest(t,a.ResourceType.Style);this._request=a.getJSON(u,(d,g)=>{this._request=null,d?this.fire(new a.ErrorEvent(d)):g&&this._load(g,s)})}loadJSON(t,n={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(fi,!1)}_load(t,n){if(n&&ct(this,a.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const u in t.sources)this.addSource(u,t.sources[u],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const s=no(this.stylesheet.layers);this._order=s.map(u=>u.id),this._layers={},this._serializedLayers={};for(let u of s)u=a.createStyleLayer(u),u.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=u,this._serializedLayers[u.id]=u.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new hr(this.stylesheet.light),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(n,s,u,d){let g,x,v;const S=u>1?"@2x":"";let C=a.getJSON(s.transformRequest(s.normalizeSpriteURL(n,S,".json"),a.ResourceType.SpriteJSON),(H,V)=>{C=null,v||(v=H,g=V,O())}),L=a.getImage(s.transformRequest(s.normalizeSpriteURL(n,S,".png"),a.ResourceType.SpriteImage),(H,V)=>{L=null,v||(v=H,x=V,O())});function O(){if(v)d(v);else if(g&&x){const H=a.exported.getImageData(x),V={};for(const Z in g){const{width:te,height:ie,x:ae,y:re,sdf:_e,pixelRatio:he,stretchX:me,stretchY:Se,content:Te}=g[Z],ye=new a.RGBAImage({width:te,height:ie});a.RGBAImage.copy(H,ye,{x:ae,y:re},{x:0,y:0},{width:te,height:ie}),V[Z]={data:ye,pixelRatio:he,sdf:_e,stretchX:me,stretchY:Se,content:Te}}d(null,V)}}return{cancel(){C&&(C.cancel(),C=null),L&&(L.cancel(),L=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(n,s)=>{if(this._spriteRequest=null,n)this.fire(new a.ErrorEvent(n));else if(s)for(const u in s)this.imageManager.addImage(u,s[u]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const s=t.sourceLayer;if(!s)return;const u=n.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(s)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${s}" does not exist on source "${u.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const n=[];for(const s of t){const u=this._layers[s];u.type!=="custom"&&n.push(u.serialize())}return n}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const u=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(u.length||d.length)&&this._updateWorkerLayers(u,d);for(const g in this._updatedSources){const x=this._updatedSources[g];x==="reload"?this._reloadSource(g):x==="clear"&&this._clearSource(g)}this._updateTilesForChangedImages();for(const g in this._updatedPaintProps)this._layers[g].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const s={};for(const u in this.sourceCaches){const d=this.sourceCaches[u];s[u]=d.used,d.used=!1}for(const u of this._order){const d=this._layers[u];d.recalculate(t,this._availableImages),!d.isHidden(t.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const u in s){const d=this.sourceCaches[u];s[u]!==d.used&&d.fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),ct(this,a.validateStyle(t)))return!1;(t=a.clone$1(t)).layers=no(t.layers);const n=function(u,d){if(!u)return[{command:vt.setStyle,args:[d]}];let g=[];try{if(!W(u.version,d.version))return[{command:vt.setStyle,args:[d]}];W(u.center,d.center)||g.push({command:vt.setCenter,args:[d.center]}),W(u.zoom,d.zoom)||g.push({command:vt.setZoom,args:[d.zoom]}),W(u.bearing,d.bearing)||g.push({command:vt.setBearing,args:[d.bearing]}),W(u.pitch,d.pitch)||g.push({command:vt.setPitch,args:[d.pitch]}),W(u.sprite,d.sprite)||g.push({command:vt.setSprite,args:[d.sprite]}),W(u.glyphs,d.glyphs)||g.push({command:vt.setGlyphs,args:[d.glyphs]}),W(u.transition,d.transition)||g.push({command:vt.setTransition,args:[d.transition]}),W(u.light,d.light)||g.push({command:vt.setLight,args:[d.light]});const x={},v=[];(function(C,L,O,H){let V;for(V in L=L||{},C=C||{})Object.prototype.hasOwnProperty.call(C,V)&&(Object.prototype.hasOwnProperty.call(L,V)||en(V,O,H));for(V in L)Object.prototype.hasOwnProperty.call(L,V)&&(Object.prototype.hasOwnProperty.call(C,V)?W(C[V],L[V])||(C[V].type==="geojson"&&L[V].type==="geojson"&&oo(C,L,V)?O.push({command:vt.setGeoJSONSourceData,args:[V,L[V].data]}):un(V,L,O,H)):cn(V,L,O))})(u.sources,d.sources,v,x);const S=[];u.layers&&u.layers.forEach(C=>{x[C.source]?g.push({command:vt.removeLayer,args:[C.id]}):S.push(C)}),g=g.concat(v),function(C,L,O){L=L||[];const H=(C=C||[]).map(De),V=L.map(De),Z=C.reduce(hn,{}),te=L.reduce(hn,{}),ie=H.slice(),ae=Object.create(null);let re,_e,he,me,Se,Te,ye;for(re=0,_e=0;re<H.length;re++)he=H[re],Object.prototype.hasOwnProperty.call(te,he)?_e++:(O.push({command:vt.removeLayer,args:[he]}),ie.splice(ie.indexOf(he,_e),1));for(re=0,_e=0;re<V.length;re++)he=V[V.length-1-re],ie[ie.length-1-re]!==he&&(Object.prototype.hasOwnProperty.call(Z,he)?(O.push({command:vt.removeLayer,args:[he]}),ie.splice(ie.lastIndexOf(he,ie.length-_e),1)):_e++,Te=ie[ie.length-re],O.push({command:vt.addLayer,args:[te[he],Te]}),ie.splice(ie.length-re,0,he),ae[he]=!0);for(re=0;re<V.length;re++)if(he=V[re],me=Z[he],Se=te[he],!ae[he]&&!W(me,Se))if(W(me.source,Se.source)&&W(me["source-layer"],Se["source-layer"])&&W(me.type,Se.type)){for(ye in fe(me.layout,Se.layout,O,he,null,vt.setLayoutProperty),fe(me.paint,Se.paint,O,he,null,vt.setPaintProperty),W(me.filter,Se.filter)||O.push({command:vt.setFilter,args:[he,Se.filter]}),W(me.minzoom,Se.minzoom)&&W(me.maxzoom,Se.maxzoom)||O.push({command:vt.setLayerZoomRange,args:[he,Se.minzoom,Se.maxzoom]}),me)Object.prototype.hasOwnProperty.call(me,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?fe(me[ye],Se[ye],O,he,ye.slice(6),vt.setPaintProperty):W(me[ye],Se[ye])||O.push({command:vt.setLayerProperty,args:[he,ye,Se[ye]]}));for(ye in Se)Object.prototype.hasOwnProperty.call(Se,ye)&&!Object.prototype.hasOwnProperty.call(me,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?fe(me[ye],Se[ye],O,he,ye.slice(6),vt.setPaintProperty):W(me[ye],Se[ye])||O.push({command:vt.setLayerProperty,args:[he,ye,Se[ye]]}))}else O.push({command:vt.removeLayer,args:[he]}),Te=ie[ie.lastIndexOf(he)+1],O.push({command:vt.addLayer,args:[Se,Te]})}(S,d.layers,g)}catch(x){console.warn("Unable to compute style diff:",x),g=[{command:vt.setStyle,args:[d]}]}return g}(this.serialize(),t).filter(u=>!(u.command in Kt));if(n.length===0)return!1;const s=n.filter(u=>!(u.command in ei));if(s.length>0)throw new Error(`Unimplemented: ${s.map(u=>u.command).join(", ")}.`);return n.forEach(u=>{u.command!=="setTransition"&&this[u.command].apply(this,u.args)}),this.stylesheet=t,!0}addImage(t,n){if(this.getImage(t))return this.fire(new a.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new a.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,s={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(a.validateStyle.source,`sources.${t}`,n,null,s))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const u=this.sourceCaches[t]=new mi(t,n,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:u.serialize(),sourceId:t})),u.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const s in this._layers)if(this._layers[s].source===t)return this.fire(new a.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${s}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){this._checkLoaded(),this.sourceCaches[t].getSource().setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,s={}){this._checkLoaded();const u=t.id;if(this.getLayer(u))return void this.fire(new a.ErrorEvent(new Error(`Layer "${u}" already exists on this map.`)));let d;if(t.type==="custom"){if(ct(this,a.validateCustomStyleLayer(t)))return;d=a.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(u,t.source),t=a.clone$1(t),t=a.extend(t,{source:u})),this._validate(a.validateStyle.layer,`layers.${u}`,t,{arrayIndex:-1},s))return;d=a.createStyleLayer(t),this._validateLayer(d),d.setEventedParent(this,{layer:{id:u}}),this._serializedLayers[d.id]=d.serialize()}const g=n?this._order.indexOf(n):this._order.length;if(n&&g===-1)this.fire(new a.ErrorEvent(new Error(`Cannot add layer "${u}" before non-existing layer "${n}".`)));else{if(this._order.splice(g,0,u),this._layerOrderChanged=!0,this._layers[u]=d,this._removedLayers[u]&&d.source&&d.type!=="custom"){const x=this._removedLayers[u];delete this._removedLayers[u],x.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const s=this._order.indexOf(t);this._order.splice(s,1);const u=n?this._order.indexOf(n):this._order.length;n&&u===-1?this.fire(new a.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(u,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new a.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const s=this._order.indexOf(t);this._order.splice(s,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,s){this._checkLoaded();const u=this.getLayer(t);u?u.minzoom===n&&u.maxzoom===s||(n!=null&&(u.minzoom=n),s!=null&&(u.maxzoom=s),this._updateLayer(u)):this.fire(new a.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,s={}){this._checkLoaded();const u=this.getLayer(t);if(u){if(!W(u.filter,n))return n==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(a.validateStyle.filter,`layers.${u.id}.filter`,n,null,s)||(u.filter=a.clone$1(n),this._updateLayer(u)))}else this.fire(new a.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return a.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,n,s,u={}){this._checkLoaded();const d=this.getLayer(t);d?W(d.getLayoutProperty(n),s)||(d.setLayoutProperty(n,s,u),this._updateLayer(d)):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const s=this.getLayer(t);if(s)return s.getLayoutProperty(n);this.fire(new a.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,s,u={}){this._checkLoaded();const d=this.getLayer(t);d?W(d.getPaintProperty(n),s)||(d.setPaintProperty(n,s,u)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const s=t.source,u=t.sourceLayer,d=this.sourceCaches[s];if(d===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)));const g=d.getSource().type;g==="geojson"&&u?this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):g!=="vector"||u?(t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),d.setFeatureState(u,t.id,n)):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const s=t.source,u=this.sourceCaches[s];if(u===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)));const d=u.getSource().type,g=d==="vector"?t.sourceLayer:void 0;d!=="vector"||g?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(g,t.id,n):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,s=t.sourceLayer,u=this.sourceCaches[n];if(u!==void 0)return u.getSource().type!=="vector"||s?(t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),u.getFeatureState(s,t.id)):void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:a.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=g=>this._layers[g].type==="fill-extrusion",s={},u=[];for(let g=this._order.length-1;g>=0;g--){const x=this._order[g];if(n(x)){s[x]=g;for(const v of t){const S=v[x];if(S)for(const C of S)u.push(C)}}}u.sort((g,x)=>x.intersectionZ-g.intersectionZ);const d=[];for(let g=this._order.length-1;g>=0;g--){const x=this._order[g];if(n(x))for(let v=u.length-1;v>=0;v--){const S=u[v].feature;if(s[S.layer.id]<g)break;d.push(S),u.pop()}else for(const v of t){const S=v[x];if(S)for(const C of S)d.push(C.feature)}}return d}queryRenderedFeatures(t,n,s){n&&n.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);const u={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const g of n.layers){const x=this._layers[g];if(!x)return this.fire(new a.ErrorEvent(new Error(`The layer '${g}' does not exist in the map's style and cannot be queried for features.`))),[];u[x.source]=!0}}const d=[];n.availableImages=this._availableImages;for(const g in this.sourceCaches)n.layers&&!u[g]||d.push(Nr(this.sourceCaches[g],this._layers,this._serializedLayers,t,n,s));return this.placement&&d.push(function(g,x,v,S,C,L,O){const H={},V=L.queryRenderedSymbols(S),Z=[];for(const te of Object.keys(V).map(Number))Z.push(O[te]);Z.sort(Dn);for(const te of Z){const ie=te.featureIndex.lookupSymbolFeatures(V[te.bucketInstanceId],x,te.bucketIndex,te.sourceLayerIndex,C.filter,C.layers,C.availableImages,g);for(const ae in ie){const re=H[ae]=H[ae]||[],_e=ie[ae];_e.sort((he,me)=>{const Se=te.featureSortOrder;if(Se){const Te=Se.indexOf(he.featureIndex);return Se.indexOf(me.featureIndex)-Te}return me.featureIndex-he.featureIndex});for(const he of _e)re.push(he)}}for(const te in H)H[te].forEach(ie=>{const ae=ie.feature,re=v[g[te].source].getFeatureState(ae.layer["source-layer"],ae.id);ae.source=ae.layer.source,ae.layer["source-layer"]&&(ae.sourceLayer=ae.layer["source-layer"]),ae.state=re});return H}(this._layers,this._serializedLayers,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(t,n){n&&n.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);const s=this.sourceCaches[t];return s?function(u,d){const g=u.getRenderableIds().map(S=>u.getTileByID(S)),x=[],v={};for(let S=0;S<g.length;S++){const C=g[S],L=C.tileID.canonical.key;v[L]||(v[L]=!0,C.querySourceFeatures(x,d))}return x}(s,n):[]}addSourceType(t,n,s){return xi.getSourceType(t)?s(new Error(`A source type called "${t}" already exists.`)):(xi.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},s):s(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const s=this.light.getLight();let u=!1;for(const g in t)if(!W(t[g],s[g])){u=!0;break}if(!u)return;const d={now:a.exported.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(d)}_validate(t,n,s,u,d={}){return(!d||d.validate!==!1)&&ct(this,t.call(a.validateStyle,a.extend({key:n,style:this.serialize(),value:s,styleSpec:a.spec},u)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const n=this.sourceCaches[t];n.setEventedParent(null),n.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,s,u,d=!1){let g=!1,x=!1;const v={};for(const S of this._order){const C=this._layers[S];if(C.type!=="symbol")continue;if(!v[C.source]){const O=this.sourceCaches[C.source];v[C.source]=O.getRenderableIds(!0).map(H=>O.getTileByID(H)).sort((H,V)=>V.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(V.tileID)?-1:1))}const L=this.crossTileSymbolIndex.addLayer(C,v[C.source],t.center.lng);g=g||L}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||s===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),t.zoom))&&(this.pauseablePlacement=new We(t,this._order,d,n,s,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,v),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),x=!0),g&&this.pauseablePlacement.placement.setStale()),x||g)for(const S of this._order){const C=this._layers[S];C.type==="symbol"&&this.placement.updateLayerOpacities(C,v[C.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n,s){this.imageManager.getImages(n.icons,s),this._updateTilesForChangedImages();const u=this.sourceCaches[n.source];u&&u.setDependencies(n.tileID.key,n.type,n.icons)}getGlyphs(t,n,s){this.glyphManager.getGlyphs(n.stacks,s)}getResource(t,n,s){return a.makeRequest(n,s)}}xi.getSourceType=function(c){return dr[c]},xi.setSourceType=function(c,t){dr[c]=t},xi.registerForPluginStateChange=a.registerForPluginStateChange;var Aa=a.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ea={prelude:Ot(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),background:Ot(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ot(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ot(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ot("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ot(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ot(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ot("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ot("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ot("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),fill:Ot(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ot(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ot(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ot(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ot(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ot(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ot(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),lineGradient:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),linePattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ot(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ot(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),symbolSDF:Ot(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ot(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`)};function Ot(c,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,s=t.match(/attribute ([\w]+) ([\w]+)/g),u=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=d?d.concat(u):u,x={};return{fragmentSource:c=c.replace(n,(v,S,C,L,O)=>(x[O]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${O}
varying ${C} ${L} ${O};
#else
uniform ${C} ${L} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${C} ${L} ${O} = u_${O};
#endif
`)),vertexSource:t=t.replace(n,(v,S,C,L,O)=>{const H=L==="float"?"vec2":"vec4",V=O.match(/color/)?"color":H;return x[O]?S==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${C} ${H} a_${O};
varying ${C} ${L} ${O};
#else
uniform ${C} ${L} u_${O};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${C} ${L} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${V}(a_${O}, u_${O}_t);
#else
    ${C} ${L} ${O} = u_${O};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${C} ${H} a_${O};
#else
uniform ${C} ${L} u_${O};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${C} ${L} ${O} = a_${O};
#else
    ${C} ${L} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${C} ${L} ${O} = unpack_mix_${V}(a_${O}, u_${O}_t);
#else
    ${C} ${L} ${O} = u_${O};
#endif
`}),staticAttributes:s,staticUniforms:g}}class jl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,s,u,d,g,x,v){this.context=t;let S=this.boundPaintVertexBuffers.length!==u.length;for(let C=0;!S&&C<u.length;C++)this.boundPaintVertexBuffers[C]!==u[C]&&(S=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===n&&this.boundLayoutVertexBuffer===s&&!S&&this.boundIndexBuffer===d&&this.boundVertexOffset===g&&this.boundDynamicVertexBuffer===x&&this.boundDynamicVertexBuffer2===v?(t.bindVertexArrayOES.set(this.vao),x&&x.bind(),d&&d.dynamicDraw&&d.bind(),v&&v.bind()):this.freshBind(n,s,u,d,g,x,v)}freshBind(t,n,s,u,d,g,x){let v;const S=t.numAttributes,C=this.context,L=C.gl;if(C.extVertexArrayObject)this.vao&&this.destroy(),this.vao=C.extVertexArrayObject.createVertexArrayOES(),C.bindVertexArrayOES.set(this.vao),v=0,this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=s,this.boundIndexBuffer=u,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=g,this.boundDynamicVertexBuffer2=x;else{v=C.currentNumAttributes||0;for(let O=S;O<v;O++)L.disableVertexAttribArray(O)}n.enableAttributes(L,t);for(const O of s)O.enableAttributes(L,t);g&&g.enableAttributes(L,t),x&&x.enableAttributes(L,t),n.bind(),n.setVertexAttribPointers(L,t,d);for(const O of s)O.bind(),O.setVertexAttribPointers(L,t,d);g&&(g.bind(),g.setVertexAttribPointers(L,t,d)),u&&u.bind(),x&&(x.bind(),x.setVertexAttribPointers(L,t,d)),C.currentNumAttributes=S}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Sa(c){const t=[];for(let n=0;n<c.length;n++){if(c[n]===null)continue;const s=c[n].split(" ");t.push(s.pop())}return t}class ql{constructor(t,n,s,u,d,g){const x=t.gl;this.program=x.createProgram();const v=Sa(s.staticAttributes),S=u?u.getBinderAttributes():[],C=v.concat(S),L=s.staticUniforms?Sa(s.staticUniforms):[],O=u?u.getBinderUniforms():[],H=L.concat(O),V=[];for(const he of H)V.indexOf(he)<0&&V.push(he);const Z=u?u.defines():[];g&&Z.push("#define OVERDRAW_INSPECTOR;");const te=Z.concat(Ea.prelude.fragmentSource,s.fragmentSource).join(`
`),ie=Z.concat(Ea.prelude.vertexSource,s.vertexSource).join(`
`),ae=x.createShader(x.FRAGMENT_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);x.shaderSource(ae,te),x.compileShader(ae),x.attachShader(this.program,ae);const re=x.createShader(x.VERTEX_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);x.shaderSource(re,ie),x.compileShader(re),x.attachShader(this.program,re),this.attributes={};const _e={};this.numAttributes=C.length;for(let he=0;he<this.numAttributes;he++)C[he]&&(x.bindAttribLocation(this.program,he,C[he]),this.attributes[C[he]]=he);x.linkProgram(this.program),x.deleteShader(re),x.deleteShader(ae);for(let he=0;he<V.length;he++){const me=V[he];if(me&&!_e[me]){const Se=x.getUniformLocation(this.program,me);Se&&(_e[me]=Se)}}this.fixedUniforms=d(t,_e),this.binderUniforms=u?u.getUniforms(t,_e):[]}draw(t,n,s,u,d,g,x,v,S,C,L,O,H,V,Z,te){const ie=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(s),t.setStencilMode(u),t.setColorMode(d),t.setCullFace(g);for(const re in this.fixedUniforms)this.fixedUniforms[re].set(x[re]);V&&V.setUniforms(t,this.binderUniforms,O,{zoom:H});const ae={[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[n];for(const re of L.get()){const _e=re.vaos||(re.vaos={});(_e[v]||(_e[v]=new jl)).bind(t,this,S,V?V.getPaintVertexBuffers():[],C,re.vertexOffset,Z,te),ie.drawElements(n,re.primitiveLength*ae,ie.UNSIGNED_SHORT,re.primitiveOffset*ae*2)}}}function Ia(c,t,n){const s=1/ui(n,1,t.transform.tileZoom),u=Math.pow(2,n.tileID.overscaledZ),d=n.tileSize*Math.pow(2,t.transform.tileZoom)/u,g=d*(n.tileID.canonical.x+n.tileID.wrap*u),x=d*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[s,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[g>>16,x>>16],u_pixel_coord_lower:[65535&g,65535&x]}}const Ps=(c,t,n,s)=>{const u=t.style.light,d=u.properties.get("position"),g=[d.x,d.y,d.z],x=function(){var S=new a.ARRAY_TYPE(9);return a.ARRAY_TYPE!=Float32Array&&(S[1]=0,S[2]=0,S[3]=0,S[5]=0,S[6]=0,S[7]=0),S[0]=1,S[4]=1,S[8]=1,S}();u.properties.get("anchor")==="viewport"&&function(S,C){var L=Math.sin(C),O=Math.cos(C);S[0]=O,S[1]=L,S[2]=0,S[3]=-L,S[4]=O,S[5]=0,S[6]=0,S[7]=0,S[8]=1}(x,-t.transform.angle),function(S,C,L){var O=C[0],H=C[1],V=C[2];S[0]=O*L[0]+H*L[3]+V*L[6],S[1]=O*L[1]+H*L[4]+V*L[7],S[2]=O*L[2]+H*L[5]+V*L[8]}(g,g,x);const v=u.properties.get("color");return{u_matrix:c,u_lightpos:g,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[v.r,v.g,v.b],u_vertical_gradient:+n,u_opacity:s}},za=(c,t,n,s,u,d,g)=>a.extend(Ps(c,t,n,s),Ia(d,t,g),{u_height_factor:-Math.pow(2,u.overscaledZ)/g.tileSize/8}),Ta=c=>({u_matrix:c}),ka=(c,t,n,s)=>a.extend(Ta(c),Ia(n,t,s)),Ds=(c,t)=>({u_matrix:c,u_world:t}),Ls=(c,t,n,s,u)=>a.extend(ka(c,t,n,s),{u_world:u}),fn=(c,t,n,s)=>{const u=c.transform;let d,g;if(s.paint.get("circle-pitch-alignment")==="map"){const x=ui(n,1,u.zoom);d=!0,g=[x,x]}else d=!1,g=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(t.posMatrix,n,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:c.pixelRatio,u_extrude_scale:g}},Ro=(c,t,n)=>{const s=ui(n,1,t.zoom),u=Math.pow(2,t.zoom-n.tileID.overscaledZ),d=n.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:s,u_extrude_scale:[t.pixelsToGLUnits[0]/(s*u),t.pixelsToGLUnits[1]/(s*u)],u_overscale_factor:d}},Rn=(c,t,n=1)=>({u_matrix:c,u_color:t,u_overlay:0,u_overlay_scale:n}),so=c=>({u_matrix:c}),Fo=(c,t,n,s)=>({u_matrix:c,u_extrude_scale:ui(t,1,n),u_intensity:s});function Oo(c,t){const n=Math.pow(2,t.canonical.z),s=t.canonical.y;return[new a.MercatorCoordinate(0,s/n).toLngLat().lat,new a.MercatorCoordinate(0,(s+1)/n).toLngLat().lat]}const lo=(c,t,n)=>{const s=c.transform;return{u_matrix:Ca(c,t,n),u_ratio:1/ui(t,1,s.zoom),u_device_pixel_ratio:c.pixelRatio,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},Vo=(c,t,n,s)=>a.extend(lo(c,t,n),{u_image:0,u_image_height:s}),co=(c,t,n,s)=>{const u=c.transform,d=uo(t,u);return{u_matrix:Ca(c,t,n),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ui(t,1,u.zoom),u_device_pixel_ratio:c.pixelRatio,u_image:0,u_scale:[d,s.fromScale,s.toScale],u_fade:s.t,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},ni=(c,t,n,s,u)=>{const d=c.lineAtlas,g=uo(t,c.transform),x=n.layout.get("line-cap")==="round",v=d.getDash(s.from,x),S=d.getDash(s.to,x),C=v.width*u.fromScale,L=S.width*u.toScale;return a.extend(lo(c,t,n),{u_patternscale_a:[g/C,-v.height/2],u_patternscale_b:[g/L,-S.height/2],u_sdfgamma:d.width/(256*Math.min(C,L)*c.pixelRatio)/2,u_image:0,u_tex_y_a:v.y,u_tex_y_b:S.y,u_mix:u.t})};function uo(c,t){return 1/ui(c,1,t.tileZoom)}function Ca(c,t,n){return c.translatePosMatrix(t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Bs=(c,t,n,s,u)=>{return{u_matrix:c,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(g=u.paint.get("raster-saturation"),g>0?1-1/(1.001-g):-g),u_contrast_factor:(d=u.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:Rs(u.paint.get("raster-hue-rotate"))};var d,g};function Rs(c){c*=Math.PI/180;const t=Math.sin(c),n=Math.cos(c);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Uo=(c,t,n,s,u,d,g,x,v,S)=>{const C=u.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:C.cameraToCenterDistance,u_pitch:C.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:C.width/C.height,u_fade_change:u.options.fadeDuration?u.symbolFadeChange:1,u_matrix:d,u_label_plane_matrix:g,u_coord_matrix:x,u_is_text:+v,u_pitch_with_map:+s,u_texsize:S,u_texture:0}},Ma=(c,t,n,s,u,d,g,x,v,S,C)=>{const L=u.transform;return a.extend(Uo(c,t,n,s,u,d,g,x,v,S),{u_gamma_scale:s?Math.cos(L._pitch)*L.cameraToCenterDistance:1,u_device_pixel_ratio:u.pixelRatio,u_is_halo:+C})},Gl=(c,t,n,s,u,d,g,x,v,S)=>a.extend(Ma(c,t,n,s,u,d,g,x,!0,v,!0),{u_texsize_icon:S,u_texture_icon:1}),Zl=(c,t,n)=>({u_matrix:c,u_opacity:t,u_color:n}),Pa=(c,t,n,s,u,d)=>a.extend(function(g,x,v,S){const C=v.imageManager.getPattern(g.from.toString()),L=v.imageManager.getPattern(g.to.toString()),{width:O,height:H}=v.imageManager.getPixelSize(),V=Math.pow(2,S.tileID.overscaledZ),Z=S.tileSize*Math.pow(2,v.transform.tileZoom)/V,te=Z*(S.tileID.canonical.x+S.tileID.wrap*V),ie=Z*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:L.tl,u_pattern_br_b:L.br,u_texsize:[O,H],u_mix:x.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:L.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/ui(S,1,v.transform.tileZoom),u_pixel_coord_upper:[te>>16,ie>>16],u_pixel_coord_lower:[65535&te,65535&ie]}}(s,d,n,u),{u_matrix:c,u_opacity:t}),Da={fillExtrusion:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_lightpos:new a.Uniform3f(c,t.u_lightpos),u_lightintensity:new a.Uniform1f(c,t.u_lightintensity),u_lightcolor:new a.Uniform3f(c,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(c,t.u_vertical_gradient),u_opacity:new a.Uniform1f(c,t.u_opacity)}),fillExtrusionPattern:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_lightpos:new a.Uniform3f(c,t.u_lightpos),u_lightintensity:new a.Uniform1f(c,t.u_lightintensity),u_lightcolor:new a.Uniform3f(c,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(c,t.u_vertical_gradient),u_height_factor:new a.Uniform1f(c,t.u_height_factor),u_image:new a.Uniform1i(c,t.u_image),u_texsize:new a.Uniform2f(c,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(c,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(c,t.u_scale),u_fade:new a.Uniform1f(c,t.u_fade),u_opacity:new a.Uniform1f(c,t.u_opacity)}),fill:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix)}),fillPattern:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_image:new a.Uniform1i(c,t.u_image),u_texsize:new a.Uniform2f(c,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(c,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(c,t.u_scale),u_fade:new a.Uniform1f(c,t.u_fade)}),fillOutline:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_world:new a.Uniform2f(c,t.u_world)}),fillOutlinePattern:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_world:new a.Uniform2f(c,t.u_world),u_image:new a.Uniform1i(c,t.u_image),u_texsize:new a.Uniform2f(c,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(c,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(c,t.u_scale),u_fade:new a.Uniform1f(c,t.u_fade)}),circle:(c,t)=>({u_camera_to_center_distance:new a.Uniform1f(c,t.u_camera_to_center_distance),u_scale_with_map:new a.Uniform1i(c,t.u_scale_with_map),u_pitch_with_map:new a.Uniform1i(c,t.u_pitch_with_map),u_extrude_scale:new a.Uniform2f(c,t.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(c,t.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(c,t.u_matrix)}),collisionBox:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_camera_to_center_distance:new a.Uniform1f(c,t.u_camera_to_center_distance),u_pixels_to_tile_units:new a.Uniform1f(c,t.u_pixels_to_tile_units),u_extrude_scale:new a.Uniform2f(c,t.u_extrude_scale),u_overscale_factor:new a.Uniform1f(c,t.u_overscale_factor)}),collisionCircle:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_inv_matrix:new a.UniformMatrix4f(c,t.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(c,t.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(c,t.u_viewport_size)}),debug:(c,t)=>({u_color:new a.UniformColor(c,t.u_color),u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_overlay:new a.Uniform1i(c,t.u_overlay),u_overlay_scale:new a.Uniform1f(c,t.u_overlay_scale)}),clippingMask:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix)}),heatmap:(c,t)=>({u_extrude_scale:new a.Uniform1f(c,t.u_extrude_scale),u_intensity:new a.Uniform1f(c,t.u_intensity),u_matrix:new a.UniformMatrix4f(c,t.u_matrix)}),heatmapTexture:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_world:new a.Uniform2f(c,t.u_world),u_image:new a.Uniform1i(c,t.u_image),u_color_ramp:new a.Uniform1i(c,t.u_color_ramp),u_opacity:new a.Uniform1f(c,t.u_opacity)}),hillshade:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_image:new a.Uniform1i(c,t.u_image),u_latrange:new a.Uniform2f(c,t.u_latrange),u_light:new a.Uniform2f(c,t.u_light),u_shadow:new a.UniformColor(c,t.u_shadow),u_highlight:new a.UniformColor(c,t.u_highlight),u_accent:new a.UniformColor(c,t.u_accent)}),hillshadePrepare:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_image:new a.Uniform1i(c,t.u_image),u_dimension:new a.Uniform2f(c,t.u_dimension),u_zoom:new a.Uniform1f(c,t.u_zoom),u_unpack:new a.Uniform4f(c,t.u_unpack)}),line:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_ratio:new a.Uniform1f(c,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(c,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(c,t.u_units_to_pixels)}),lineGradient:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_ratio:new a.Uniform1f(c,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(c,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(c,t.u_units_to_pixels),u_image:new a.Uniform1i(c,t.u_image),u_image_height:new a.Uniform1f(c,t.u_image_height)}),linePattern:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_texsize:new a.Uniform2f(c,t.u_texsize),u_ratio:new a.Uniform1f(c,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(c,t.u_device_pixel_ratio),u_image:new a.Uniform1i(c,t.u_image),u_units_to_pixels:new a.Uniform2f(c,t.u_units_to_pixels),u_scale:new a.Uniform3f(c,t.u_scale),u_fade:new a.Uniform1f(c,t.u_fade)}),lineSDF:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_ratio:new a.Uniform1f(c,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(c,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(c,t.u_units_to_pixels),u_patternscale_a:new a.Uniform2f(c,t.u_patternscale_a),u_patternscale_b:new a.Uniform2f(c,t.u_patternscale_b),u_sdfgamma:new a.Uniform1f(c,t.u_sdfgamma),u_image:new a.Uniform1i(c,t.u_image),u_tex_y_a:new a.Uniform1f(c,t.u_tex_y_a),u_tex_y_b:new a.Uniform1f(c,t.u_tex_y_b),u_mix:new a.Uniform1f(c,t.u_mix)}),raster:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_tl_parent:new a.Uniform2f(c,t.u_tl_parent),u_scale_parent:new a.Uniform1f(c,t.u_scale_parent),u_buffer_scale:new a.Uniform1f(c,t.u_buffer_scale),u_fade_t:new a.Uniform1f(c,t.u_fade_t),u_opacity:new a.Uniform1f(c,t.u_opacity),u_image0:new a.Uniform1i(c,t.u_image0),u_image1:new a.Uniform1i(c,t.u_image1),u_brightness_low:new a.Uniform1f(c,t.u_brightness_low),u_brightness_high:new a.Uniform1f(c,t.u_brightness_high),u_saturation_factor:new a.Uniform1f(c,t.u_saturation_factor),u_contrast_factor:new a.Uniform1f(c,t.u_contrast_factor),u_spin_weights:new a.Uniform3f(c,t.u_spin_weights)}),symbolIcon:(c,t)=>({u_is_size_zoom_constant:new a.Uniform1i(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(c,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(c,t.u_size_t),u_size:new a.Uniform1f(c,t.u_size),u_camera_to_center_distance:new a.Uniform1f(c,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(c,t.u_pitch),u_rotate_symbol:new a.Uniform1i(c,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(c,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(c,t.u_fade_change),u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(c,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(c,t.u_coord_matrix),u_is_text:new a.Uniform1i(c,t.u_is_text),u_pitch_with_map:new a.Uniform1i(c,t.u_pitch_with_map),u_texsize:new a.Uniform2f(c,t.u_texsize),u_texture:new a.Uniform1i(c,t.u_texture)}),symbolSDF:(c,t)=>({u_is_size_zoom_constant:new a.Uniform1i(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(c,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(c,t.u_size_t),u_size:new a.Uniform1f(c,t.u_size),u_camera_to_center_distance:new a.Uniform1f(c,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(c,t.u_pitch),u_rotate_symbol:new a.Uniform1i(c,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(c,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(c,t.u_fade_change),u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(c,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(c,t.u_coord_matrix),u_is_text:new a.Uniform1i(c,t.u_is_text),u_pitch_with_map:new a.Uniform1i(c,t.u_pitch_with_map),u_texsize:new a.Uniform2f(c,t.u_texsize),u_texture:new a.Uniform1i(c,t.u_texture),u_gamma_scale:new a.Uniform1f(c,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(c,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(c,t.u_is_halo)}),symbolTextAndIcon:(c,t)=>({u_is_size_zoom_constant:new a.Uniform1i(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(c,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(c,t.u_size_t),u_size:new a.Uniform1f(c,t.u_size),u_camera_to_center_distance:new a.Uniform1f(c,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(c,t.u_pitch),u_rotate_symbol:new a.Uniform1i(c,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(c,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(c,t.u_fade_change),u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(c,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(c,t.u_coord_matrix),u_is_text:new a.Uniform1i(c,t.u_is_text),u_pitch_with_map:new a.Uniform1i(c,t.u_pitch_with_map),u_texsize:new a.Uniform2f(c,t.u_texsize),u_texsize_icon:new a.Uniform2f(c,t.u_texsize_icon),u_texture:new a.Uniform1i(c,t.u_texture),u_texture_icon:new a.Uniform1i(c,t.u_texture_icon),u_gamma_scale:new a.Uniform1f(c,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(c,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(c,t.u_is_halo)}),background:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_opacity:new a.Uniform1f(c,t.u_opacity),u_color:new a.UniformColor(c,t.u_color)}),backgroundPattern:(c,t)=>({u_matrix:new a.UniformMatrix4f(c,t.u_matrix),u_opacity:new a.Uniform1f(c,t.u_opacity),u_image:new a.Uniform1i(c,t.u_image),u_pattern_tl_a:new a.Uniform2f(c,t.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(c,t.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(c,t.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(c,t.u_pattern_br_b),u_texsize:new a.Uniform2f(c,t.u_texsize),u_mix:new a.Uniform1f(c,t.u_mix),u_pattern_size_a:new a.Uniform2f(c,t.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(c,t.u_pattern_size_b),u_scale_a:new a.Uniform1f(c,t.u_scale_a),u_scale_b:new a.Uniform1f(c,t.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(c,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(c,t.u_tile_units_to_pixels)})};class La{constructor(t,n,s){this.context=t;const u=t.gl;this.buffer=u.createBuffer(),this.dynamicDraw=Boolean(s),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ba={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fs{constructor(t,n,s,u){this.length=n.length,this.attributes=s,this.itemSize=n.bytesPerElement,this.dynamicDraw=u,this.context=t;const d=t.gl;this.buffer=d.createBuffer(),t.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let s=0;s<this.attributes.length;s++){const u=n.attributes[this.attributes[s].name];u!==void 0&&t.enableVertexAttribArray(u)}}setVertexAttribPointers(t,n,s){for(let u=0;u<this.attributes.length;u++){const d=this.attributes[u],g=n.attributes[d.name];g!==void 0&&t.vertexAttribPointer(g,d.components,t[Ba[d.type]],!1,this.itemSize,d.offset+this.itemSize*(s||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Tt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Hl extends Tt{getDefault(){return a.Color.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ho extends Tt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class po extends Tt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Os extends Tt{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Wi extends Tt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ra extends Tt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class $o extends Tt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class No extends Tt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Fa extends Tt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Oa extends Tt{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class jo extends Tt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class Va extends Tt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ua extends Tt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class qo extends Tt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Vs extends Tt{getDefault(){return a.Color.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Us extends Tt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Fn extends Tt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Wl extends Tt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Xl extends Tt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Yl extends Tt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Kl extends Tt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Jl extends Tt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ql extends Tt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class $a extends Tt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Na extends Tt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class On extends Tt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class $s extends Tt{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ns extends Tt{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class ja extends Tt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class gn extends Tt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class js extends Tt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class yn extends Tt{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class Vn extends yn{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class qs extends yn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class qa{constructor(t,n,s,u){this.context=t,this.width=n,this.height=s;const d=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new Vn(t,d),u&&(this.depthAttachment=new qs(t,d))}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const s=this.depthAttachment.get();s&&t.deleteRenderbuffer(s)}t.deleteFramebuffer(this.framebuffer)}}class lt{constructor(t,n,s){this.blendFunction=t,this.blendColor=n,this.mask=s}}lt.Replace=[1,0],lt.disabled=new lt(lt.Replace,a.Color.transparent,[!1,!1,!1,!1]),lt.unblended=new lt(lt.Replace,a.Color.transparent,[!0,!0,!0,!0]),lt.alphaBlended=new lt([1,771],a.Color.transparent,[!0,!0,!0,!0]);class Go{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Hl(this),this.clearDepth=new ho(this),this.clearStencil=new po(this),this.colorMask=new Os(this),this.depthMask=new Wi(this),this.stencilMask=new Ra(this),this.stencilFunc=new $o(this),this.stencilOp=new No(this),this.stencilTest=new Fa(this),this.depthRange=new Oa(this),this.depthTest=new jo(this),this.depthFunc=new Va(this),this.blend=new Ua(this),this.blendFunc=new qo(this),this.blendColor=new Vs(this),this.blendEquation=new Us(this),this.cullFace=new Fn(this),this.cullFaceSide=new Wl(this),this.frontFace=new Xl(this),this.program=new Yl(this),this.activeTexture=new Kl(this),this.viewport=new Jl(this),this.bindFramebuffer=new Ql(this),this.bindRenderbuffer=new $a(this),this.bindTexture=new Na(this),this.bindVertexBuffer=new On(this),this.bindElementBuffer=new $s(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ns(this),this.pixelStoreUnpack=new ja(this),this.pixelStoreUnpackPremultiplyAlpha=new gn(this),this.pixelStoreUnpackFlipY=new js(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new La(this,t,n)}createVertexBuffer(t,n,s){return new Fs(this,t,n,s)}createRenderbuffer(t,n,s){const u=this.gl,d=u.createRenderbuffer();return this.bindRenderbuffer.set(d),u.renderbufferStorage(u.RENDERBUFFER,t,n,s),this.bindRenderbuffer.set(null),d}createFramebuffer(t,n,s){return new qa(this,t,n,s)}clear({color:t,depth:n}){const s=this.gl;let u=0;t&&(u|=s.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(u|=s.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),s.clear(u)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){W(t.blendFunction,lt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Dt{constructor(t,n,s){this.func=t,this.mask=n,this.range=s}}Dt.ReadOnly=!1,Dt.ReadWrite=!0,Dt.disabled=new Dt(519,Dt.ReadOnly,[0,1]);const Zo=7680;class Nt{constructor(t,n,s,u,d,g){this.test=t,this.ref=n,this.mask=s,this.fail=u,this.depthFail=d,this.pass=g}}Nt.disabled=new Nt({func:519,mask:0},0,0,Zo,Zo,Zo);class Jt{constructor(t,n,s){this.enable=t,this.mode=n,this.frontFace=s}}let Ho;function Ga(c,t,n,s,u,d,g){const x=c.context,v=x.gl,S=c.useProgram("collisionBox"),C=[];let L=0,O=0;for(let re=0;re<s.length;re++){const _e=s[re],he=t.getTile(_e),me=he.getBucket(n);if(!me)continue;let Se=_e.posMatrix;u[0]===0&&u[1]===0||(Se=c.translatePosMatrix(_e.posMatrix,he,u,d));const Te=g?me.textCollisionBox:me.iconCollisionBox,ye=me.collisionCircleArray;if(ye.length>0){const qe=a.create(),Le=Se;a.mul(qe,me.placementInvProjMatrix,c.transform.glCoordMatrix),a.mul(qe,qe,me.placementViewportMatrix),C.push({circleArray:ye,circleOffset:O,transform:Le,invTransform:qe}),L+=ye.length/4,O=L}Te&&S.draw(x,v.LINES,Dt.disabled,Nt.disabled,c.colorModeForRenderPass(),Jt.disabled,Ro(Se,c.transform,he),n.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,null,c.transform.zoom,null,null,Te.collisionVertexBuffer)}if(!g||!C.length)return;const H=c.useProgram("collisionCircle"),V=new a.CollisionCircleLayoutArray;V.resize(4*L),V._trim();let Z=0;for(const re of C)for(let _e=0;_e<re.circleArray.length/4;_e++){const he=4*_e,me=re.circleArray[he+0],Se=re.circleArray[he+1],Te=re.circleArray[he+2],ye=re.circleArray[he+3];V.emplace(Z++,me,Se,Te,ye,0),V.emplace(Z++,me,Se,Te,ye,1),V.emplace(Z++,me,Se,Te,ye,2),V.emplace(Z++,me,Se,Te,ye,3)}(!Ho||Ho.length<2*L)&&(Ho=function(re){const _e=2*re,he=new a.QuadTriangleArray;he.resize(_e),he._trim();for(let me=0;me<_e;me++){const Se=6*me;he.uint16[Se+0]=4*me+0,he.uint16[Se+1]=4*me+1,he.uint16[Se+2]=4*me+2,he.uint16[Se+3]=4*me+2,he.uint16[Se+4]=4*me+3,he.uint16[Se+5]=4*me+0}return he}(L));const te=x.createIndexBuffer(Ho,!0),ie=x.createVertexBuffer(V,a.collisionCircleLayout.members,!0);for(const re of C){const _e={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(ae=c.transform).cameraToCenterDistance,u_viewport_size:[ae.width,ae.height]};H.draw(x,v.TRIANGLES,Dt.disabled,Nt.disabled,c.colorModeForRenderPass(),Jt.disabled,_e,n.id,ie,te,a.SegmentVector.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,c.transform.zoom,null,null,null)}var ae;ie.destroy(),te.destroy()}Jt.disabled=new Jt(!1,1029,2305),Jt.backCCW=new Jt(!0,1029,2305);const ec=a.identity(new Float32Array(16));function Za(c,t,n,s,u,d){const{horizontalAlign:g,verticalAlign:x}=a.getAnchorAlignment(c),v=-(g-.5)*t,S=-(x-.5)*n,C=a.evaluateVariableOffset(c,s);return new a.pointGeometry((v/u+C[0])*d,(S/u+C[1])*d)}function Wo(c,t,n,s,u,d,g,x,v,S){const C=c.text.placedSymbolArray,L=c.text.dynamicLayoutVertexArray,O=c.icon.dynamicLayoutVertexArray,H={};L.clear();for(let V=0;V<C.length;V++){const Z=C.get(V),te=c.allowVerticalPlacement&&!Z.placedOrientation,ie=Z.hidden||!Z.crossTileID||te?null:s[Z.crossTileID];if(ie){const ae=new a.pointGeometry(Z.anchorX,Z.anchorY),re=Ut(ae,n?g:d),_e=Me(u.cameraToCenterDistance,re.signedDistanceFromCamera);let he=a.evaluateSizeForFeature(c.textSizeData,v,Z)*_e/a.ONE_EM;n&&(he*=c.tilePixelRatio/x);const{width:me,height:Se,anchor:Te,textOffset:ye,textBoxScale:qe}=ie,Le=Za(Te,me,Se,ye,qe,he),at=n?Ut(ae.add(Le),d).point:re.point.add(t?Le.rotate(-u.angle):Le),wt=c.allowVerticalPlacement&&Z.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let gt=0;gt<Z.numGlyphs;gt++)a.addDynamicAttributes(L,at,wt);S&&Z.associatedIconIndex>=0&&(H[Z.associatedIconIndex]={shiftedAnchor:at,angle:wt})}else ri(Z.numGlyphs,L)}if(S){O.clear();const V=c.icon.placedSymbolArray;for(let Z=0;Z<V.length;Z++){const te=V.get(Z);if(te.hidden)ri(te.numGlyphs,O);else{const ie=H[Z];if(ie)for(let ae=0;ae<te.numGlyphs;ae++)a.addDynamicAttributes(O,ie.shiftedAnchor,ie.angle);else ri(te.numGlyphs,O)}}c.icon.dynamicLayoutVertexBuffer.updateData(O)}c.text.dynamicLayoutVertexBuffer.updateData(L)}function Xo(c,t,n){return n.iconsInText&&t?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function Yo(c,t,n,s,u,d,g,x,v,S,C,L){const O=c.context,H=O.gl,V=c.transform,Z=x==="map",te=v==="map",ie=x!=="viewport"&&n.layout.get("symbol-placement")!=="point",ae=Z&&!te&&!ie,re=!n.layout.get("symbol-sort-key").isConstant();let _e=!1;const he=c.depthModeForSublayer(0,Dt.ReadOnly),me=n.layout.get("text-variable-anchor"),Se=[];for(const Te of s){const ye=t.getTile(Te),qe=ye.getBucket(n);if(!qe)continue;const Le=u?qe.text:qe.icon;if(!Le||!Le.segments.get().length)continue;const at=Le.programConfigurations.get(n.id),wt=u||qe.sdfIcons,gt=u?qe.textSizeData:qe.iconSizeData,xt=te||V.pitch!==0,Yt=c.useProgram(Xo(wt,u,qe),at),st=a.evaluateSizeForZoom(gt,V.zoom);let It,Lt,bi,Yi,ar=[0,0],sr=null;if(u){if(Lt=ye.glyphAtlasTexture,bi=H.LINEAR,It=ye.glyphAtlasTexture.size,qe.iconsInText){ar=ye.imageAtlasTexture.size,sr=ye.imageAtlasTexture;const Mr=gt.kind==="composite"||gt.kind==="camera";Yi=xt||c.options.rotating||c.options.zooming||Mr?H.LINEAR:H.NEAREST}}else{const Mr=n.layout.get("icon-size").constantOr(0)!==1||qe.iconsNeedLinear;Lt=ye.imageAtlasTexture,bi=wt||c.options.rotating||c.options.zooming||Mr||xt?H.LINEAR:H.NEAREST,It=ye.imageAtlasTexture.size}const rn=ui(ye,1,c.transform.zoom),Ui=Ci(Te.posMatrix,te,Z,c.transform,rn),Cr=pn(Te.posMatrix,te,Z,c.transform,rn),An=me&&qe.hasTextData(),Ki=n.layout.get("icon-text-fit")!=="none"&&An&&qe.hasIconData();if(ie){const Mr=n.layout.get("text-rotation-alignment")==="map";ut(qe,Te.posMatrix,c,u,Ui,Cr,te,S,Mr)}const zt=c.translatePosMatrix(Te.posMatrix,ye,d,g),Mt=ie||u&&me||Ki?ec:Ui,oi=c.translatePosMatrix(Cr,ye,d,g,!0),Pi=wt&&n.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let qt;qt=wt?qe.iconsInText?Gl(gt.kind,st,ae,te,c,zt,Mt,oi,It,ar):Ma(gt.kind,st,ae,te,c,zt,Mt,oi,u,It,!0):Uo(gt.kind,st,ae,te,c,zt,Mt,oi,u,It);const En={program:Yt,buffers:Le,uniformValues:qt,atlasTexture:Lt,atlasTextureIcon:sr,atlasInterpolation:bi,atlasInterpolationIcon:Yi,isSDF:wt,hasHalo:Pi};if(re&&qe.canOverlap){_e=!0;const Mr=Le.segments.get();for(const ca of Mr)Se.push({segments:new a.SegmentVector([ca]),sortKey:ca.sortKey,state:En})}else Se.push({segments:Le.segments,sortKey:0,state:En})}_e&&Se.sort((Te,ye)=>Te.sortKey-ye.sortKey);for(const Te of Se){const ye=Te.state;if(O.activeTexture.set(H.TEXTURE0),ye.atlasTexture.bind(ye.atlasInterpolation,H.CLAMP_TO_EDGE),ye.atlasTextureIcon&&(O.activeTexture.set(H.TEXTURE1),ye.atlasTextureIcon&&ye.atlasTextureIcon.bind(ye.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),ye.isSDF){const qe=ye.uniformValues;ye.hasHalo&&(qe.u_is_halo=1,Ko(ye.buffers,Te.segments,n,c,ye.program,he,C,L,qe)),qe.u_is_halo=0}Ko(ye.buffers,Te.segments,n,c,ye.program,he,C,L,ye.uniformValues)}}function Ko(c,t,n,s,u,d,g,x,v){const S=s.context;u.draw(S,S.gl.TRIANGLES,d,g,x,Jt.disabled,v,n.id,c.layoutVertexBuffer,c.indexBuffer,t,n.paint,s.transform.zoom,c.programConfigurations.get(n.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function Ha(c,t,n,s,u,d,g){const x=c.context.gl,v=n.paint.get("fill-pattern"),S=v&&v.constantOr(1),C=n.getCrossfadeParameters();let L,O,H,V,Z;g?(O=S&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=x.LINES):(O=S?"fillPattern":"fill",L=x.TRIANGLES);for(const te of s){const ie=t.getTile(te);if(S&&!ie.patternsLoaded())continue;const ae=ie.getBucket(n);if(!ae)continue;const re=ae.programConfigurations.get(n.id),_e=c.useProgram(O,re);S&&(c.context.activeTexture.set(x.TEXTURE0),ie.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),re.updatePaintBuffers(C));const he=v.constantOr(null);if(he&&ie.imageAtlas){const Se=ie.imageAtlas,Te=Se.patternPositions[he.to.toString()],ye=Se.patternPositions[he.from.toString()];Te&&ye&&re.setConstantPatternPositions(Te,ye)}const me=c.translatePosMatrix(te.posMatrix,ie,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(g){V=ae.indexBuffer2,Z=ae.segments2;const Se=[x.drawingBufferWidth,x.drawingBufferHeight];H=O==="fillOutlinePattern"&&S?Ls(me,c,C,ie,Se):Ds(me,Se)}else V=ae.indexBuffer,Z=ae.segments,H=S?ka(me,c,C,ie):Ta(me);_e.draw(c.context,L,u,c.stencilModeForClipping(te),d,Jt.disabled,H,n.id,ae.layoutVertexBuffer,V,Z,n.paint,c.transform.zoom,re)}}function Un(c,t,n,s,u,d,g){const x=c.context,v=x.gl,S=n.paint.get("fill-extrusion-pattern"),C=S.constantOr(1),L=n.getCrossfadeParameters(),O=n.paint.get("fill-extrusion-opacity");for(const H of s){const V=t.getTile(H),Z=V.getBucket(n);if(!Z)continue;const te=Z.programConfigurations.get(n.id),ie=c.useProgram(C?"fillExtrusionPattern":"fillExtrusion",te);C&&(c.context.activeTexture.set(v.TEXTURE0),V.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),te.updatePaintBuffers(L));const ae=S.constantOr(null);if(ae&&V.imageAtlas){const me=V.imageAtlas,Se=me.patternPositions[ae.to.toString()],Te=me.patternPositions[ae.from.toString()];Se&&Te&&te.setConstantPatternPositions(Se,Te)}const re=c.translatePosMatrix(H.posMatrix,V,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),_e=n.paint.get("fill-extrusion-vertical-gradient"),he=C?za(re,c,_e,O,H,L,V):Ps(re,c,_e,O);ie.draw(x,x.gl.TRIANGLES,u,d,g,Jt.backCCW,he,n.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,n.paint,c.transform.zoom,te)}}function Jo(c,t,n,s,u,d){const g=c.context,x=g.gl,v=t.fbo;if(!v)return;const S=c.useProgram("hillshade");g.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,v.colorAttachment.get());const C=((L,O,H)=>{const V=H.paint.get("hillshade-shadow-color"),Z=H.paint.get("hillshade-highlight-color"),te=H.paint.get("hillshade-accent-color");let ie=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);H.paint.get("hillshade-illumination-anchor")==="viewport"&&(ie-=L.transform.angle);const ae=!L.options.moving;return{u_matrix:L.transform.calculatePosMatrix(O.tileID.toUnwrapped(),ae),u_image:0,u_latrange:Oo(0,O.tileID),u_light:[H.paint.get("hillshade-exaggeration"),ie],u_shadow:V,u_highlight:Z,u_accent:te}})(c,t,n);S.draw(g,x.TRIANGLES,s,u,d,Jt.disabled,C,n.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}function _r(c,t,n,s,u,d){const g=c.context,x=g.gl,v=t.dem;if(v&&v.data){const S=v.dim,C=v.stride,L=v.getPixels();if(g.activeTexture.set(x.TEXTURE1),g.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(C),t.demTexture){const H=t.demTexture;H.update(L,{premultiply:!1}),H.bind(x.NEAREST,x.CLAMP_TO_EDGE)}else t.demTexture=new mt(g,L,x.RGBA,{premultiply:!1}),t.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);g.activeTexture.set(x.TEXTURE0);let O=t.fbo;if(!O){const H=new mt(g,{width:S,height:S,data:null},x.RGBA);H.bind(x.LINEAR,x.CLAMP_TO_EDGE),O=t.fbo=g.createFramebuffer(S,S,!0),O.colorAttachment.set(H.texture)}g.bindFramebuffer.set(O.framebuffer),g.viewport.set([0,0,S,S]),c.useProgram("hillshadePrepare").draw(g,x.TRIANGLES,s,u,d,Jt.disabled,((H,V)=>{const Z=V.stride,te=a.create();return a.ortho(te,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(te,te,[0,-a.EXTENT,0]),{u_matrix:te,u_image:1,u_dimension:[Z,Z],u_zoom:H.overscaledZ,u_unpack:V.getUnpackVector()}})(t.tileID,v),n.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Gs(c,t,n,s,u){const d=s.paint.get("raster-fade-duration");if(d>0){const g=a.exported.now(),x=(g-c.timeAdded)/d,v=t?(g-t.timeAdded)/d:-1,S=n.getSource(),C=u.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),L=!t||Math.abs(t.tileID.overscaledZ-C)>Math.abs(c.tileID.overscaledZ-C),O=L&&c.refreshedUponExpiration?1:a.clamp(L?x:1-v,0,1);return c.refreshedUponExpiration&&x>=1&&(c.refreshedUponExpiration=!1),t?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}const Zs=new a.Color(1,0,0,1),Hs=new a.Color(0,1,0,1),$n=new a.Color(0,0,1,1),Qo=new a.Color(1,0,1,1),Wa=new a.Color(0,1,1,1);function Ws(c,t,n,s){ta(c,0,t+n/2,c.transform.width,n,s)}function ea(c,t,n,s){ta(c,t-n/2,0,n,c.transform.height,s)}function ta(c,t,n,s,u,d){const g=c.context,x=g.gl;x.enable(x.SCISSOR_TEST),x.scissor(t*c.pixelRatio,n*c.pixelRatio,s*c.pixelRatio,u*c.pixelRatio),g.clear({color:d}),x.disable(x.SCISSOR_TEST)}function Xs(c,t,n){const s=c.context,u=s.gl,d=n.posMatrix,g=c.useProgram("debug"),x=Dt.disabled,v=Nt.disabled,S=c.colorModeForRenderPass(),C="$debug";s.activeTexture.set(u.TEXTURE0),c.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),g.draw(s,u.LINE_STRIP,x,v,S,Jt.disabled,Rn(d,a.Color.red),C,c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments);const L=t.getTileByID(n.key).latestRawTileData,O=Math.floor((L&&L.byteLength||0)/1024),H=t.getTile(n).tileSize,V=512/Math.min(H,512)*(n.overscaledZ/c.transform.zoom)*.5;let Z=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(Z+=` => ${n.overscaledZ}`),function(te,ie){te.initDebugOverlayCanvas();const ae=te.debugOverlayCanvas,re=te.context.gl,_e=te.debugOverlayCanvas.getContext("2d");_e.clearRect(0,0,ae.width,ae.height),_e.shadowColor="white",_e.shadowBlur=2,_e.lineWidth=1.5,_e.strokeStyle="white",_e.textBaseline="top",_e.font="bold 36px Open Sans, sans-serif",_e.fillText(ie,5,5),_e.strokeText(ie,5,5),te.debugOverlayTexture.update(ae),te.debugOverlayTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE)}(c,`${Z} ${O}kb`),g.draw(s,u.TRIANGLES,x,v,lt.alphaBlended,Jt.disabled,Rn(d,a.Color.transparent,V),C,c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}const mo={symbol:function(c,t,n,s,u){if(c.renderPass!=="translucent")return;const d=Nt.disabled,g=c.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(x,v,S,C,L,O,H){const V=v.transform,Z=L==="map",te=O==="map";for(const ie of x){const ae=C.getTile(ie),re=ae.getBucket(S);if(!re||!re.text||!re.text.segments.get().length)continue;const _e=a.evaluateSizeForZoom(re.textSizeData,V.zoom),he=ui(ae,1,v.transform.zoom),me=Ci(ie.posMatrix,te,Z,v.transform,he),Se=S.layout.get("icon-text-fit")!=="none"&&re.hasIconData();if(_e){const Te=Math.pow(2,V.zoom-ae.tileID.overscaledZ);Wo(re,Z,te,H,V,me,ie.posMatrix,Te,_e,Se)}}}(s,c,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),u),n.paint.get("icon-opacity").constantOr(1)!==0&&Yo(c,t,n,s,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),d,g),n.paint.get("text-opacity").constantOr(1)!==0&&Yo(c,t,n,s,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),d,g),t.map.showCollisionBoxes&&(Ga(c,t,n,s,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Ga(c,t,n,s,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(c,t,n,s){if(c.renderPass!=="translucent")return;const u=n.paint.get("circle-opacity"),d=n.paint.get("circle-stroke-width"),g=n.paint.get("circle-stroke-opacity"),x=!n.layout.get("circle-sort-key").isConstant();if(u.constantOr(1)===0&&(d.constantOr(1)===0||g.constantOr(1)===0))return;const v=c.context,S=v.gl,C=c.depthModeForSublayer(0,Dt.ReadOnly),L=Nt.disabled,O=c.colorModeForRenderPass(),H=[];for(let V=0;V<s.length;V++){const Z=s[V],te=t.getTile(Z),ie=te.getBucket(n);if(!ie)continue;const ae=ie.programConfigurations.get(n.id),re={programConfiguration:ae,program:c.useProgram("circle",ae),layoutVertexBuffer:ie.layoutVertexBuffer,indexBuffer:ie.indexBuffer,uniformValues:fn(c,Z,te,n)};if(x){const _e=ie.segments.get();for(const he of _e)H.push({segments:new a.SegmentVector([he]),sortKey:he.sortKey,state:re})}else H.push({segments:ie.segments,sortKey:0,state:re})}x&&H.sort((V,Z)=>V.sortKey-Z.sortKey);for(const V of H){const{programConfiguration:Z,program:te,layoutVertexBuffer:ie,indexBuffer:ae,uniformValues:re}=V.state;te.draw(v,S.TRIANGLES,C,L,O,Jt.disabled,re,n.id,ie,ae,V.segments,n.paint,c.transform.zoom,Z)}},heatmap:function(c,t,n,s){if(n.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const u=c.context,d=u.gl,g=Nt.disabled,x=new lt([d.ONE,d.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(v,S,C){const L=v.gl;v.activeTexture.set(L.TEXTURE1),v.viewport.set([0,0,S.width/4,S.height/4]);let O=C.heatmapFbo;if(O)L.bindTexture(L.TEXTURE_2D,O.colorAttachment.get()),v.bindFramebuffer.set(O.framebuffer);else{const H=L.createTexture();L.bindTexture(L.TEXTURE_2D,H),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,L.LINEAR),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,L.LINEAR),O=C.heatmapFbo=v.createFramebuffer(S.width/4,S.height/4,!1),function(V,Z,te,ie){const ae=V.gl;ae.texImage2D(ae.TEXTURE_2D,0,ae.RGBA,Z.width/4,Z.height/4,0,ae.RGBA,V.extRenderToTextureHalfFloat?V.extTextureHalfFloat.HALF_FLOAT_OES:ae.UNSIGNED_BYTE,null),ie.colorAttachment.set(te)}(v,S,H,O)}})(u,c,n),u.clear({color:a.Color.transparent});for(let v=0;v<s.length;v++){const S=s[v];if(t.hasRenderableParent(S))continue;const C=t.getTile(S),L=C.getBucket(n);if(!L)continue;const O=L.programConfigurations.get(n.id),H=c.useProgram("heatmap",O),{zoom:V}=c.transform;H.draw(u,d.TRIANGLES,Dt.disabled,g,x,Jt.disabled,Fo(S.posMatrix,C,V,n.paint.get("heatmap-intensity")),n.id,L.layoutVertexBuffer,L.indexBuffer,L.segments,n.paint,c.transform.zoom,O)}u.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(u,d){const g=u.context,x=g.gl,v=d.heatmapFbo;if(!v)return;g.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,v.colorAttachment.get()),g.activeTexture.set(x.TEXTURE1);let S=d.colorRampTexture;S||(S=d.colorRampTexture=new mt(g,d.colorRamp,x.RGBA)),S.bind(x.LINEAR,x.CLAMP_TO_EDGE),u.useProgram("heatmapTexture").draw(g,x.TRIANGLES,Dt.disabled,Nt.disabled,u.colorModeForRenderPass(),Jt.disabled,((C,L,O,H)=>{const V=a.create();a.ortho(V,0,C.width,C.height,0,0,1);const Z=C.context.gl;return{u_matrix:V,u_world:[Z.drawingBufferWidth,Z.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:L.paint.get("heatmap-opacity")}})(u,d),d.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments,d.paint,u.transform.zoom)}(c,n))},line:function(c,t,n,s){if(c.renderPass!=="translucent")return;const u=n.paint.get("line-opacity"),d=n.paint.get("line-width");if(u.constantOr(1)===0||d.constantOr(1)===0)return;const g=c.depthModeForSublayer(0,Dt.ReadOnly),x=c.colorModeForRenderPass(),v=n.paint.get("line-dasharray"),S=n.paint.get("line-pattern"),C=S.constantOr(1),L=n.paint.get("line-gradient"),O=n.getCrossfadeParameters(),H=C?"linePattern":v?"lineSDF":L?"lineGradient":"line",V=c.context,Z=V.gl;let te=!0;for(const ie of s){const ae=t.getTile(ie);if(C&&!ae.patternsLoaded())continue;const re=ae.getBucket(n);if(!re)continue;const _e=re.programConfigurations.get(n.id),he=c.context.program.get(),me=c.useProgram(H,_e),Se=te||me.program!==he,Te=S.constantOr(null);if(Te&&ae.imageAtlas){const qe=ae.imageAtlas,Le=qe.patternPositions[Te.to.toString()],at=qe.patternPositions[Te.from.toString()];Le&&at&&_e.setConstantPatternPositions(Le,at)}const ye=C?co(c,ae,n,O):v?ni(c,ae,n,v,O):L?Vo(c,ae,n,re.lineClipsArray.length):lo(c,ae,n);if(C)V.activeTexture.set(Z.TEXTURE0),ae.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),_e.updatePaintBuffers(O);else if(v&&(Se||c.lineAtlas.dirty))V.activeTexture.set(Z.TEXTURE0),c.lineAtlas.bind(V);else if(L){const qe=re.gradients[n.id];let Le=qe.texture;if(n.gradientVersion!==qe.version){let at=256;if(n.stepInterpolant){const wt=t.getSource().maxzoom,gt=ie.canonical.z===wt?Math.ceil(1<<c.transform.maxZoom-ie.canonical.z):1;at=a.clamp(a.nextPowerOfTwo(re.maxLineLength/a.EXTENT*1024*gt),256,V.maxTextureSize)}qe.gradient=a.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:at,image:qe.gradient||void 0,clips:re.lineClipsArray}),qe.texture?qe.texture.update(qe.gradient):qe.texture=new mt(V,qe.gradient,Z.RGBA),qe.version=n.gradientVersion,Le=qe.texture}V.activeTexture.set(Z.TEXTURE0),Le.bind(n.stepInterpolant?Z.NEAREST:Z.LINEAR,Z.CLAMP_TO_EDGE)}me.draw(V,Z.TRIANGLES,g,c.stencilModeForClipping(ie),x,Jt.disabled,ye,n.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,n.paint,c.transform.zoom,_e,re.layoutVertexBuffer2),te=!1}},fill:function(c,t,n,s){const u=n.paint.get("fill-color"),d=n.paint.get("fill-opacity");if(d.constantOr(1)===0)return;const g=c.colorModeForRenderPass(),x=n.paint.get("fill-pattern"),v=c.opaquePassEnabledForLayer()&&!x.constantOr(1)&&u.constantOr(a.Color.transparent).a===1&&d.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===v){const S=c.depthModeForSublayer(1,c.renderPass==="opaque"?Dt.ReadWrite:Dt.ReadOnly);Ha(c,t,n,s,S,g,!1)}if(c.renderPass==="translucent"&&n.paint.get("fill-antialias")){const S=c.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Dt.ReadOnly);Ha(c,t,n,s,S,g,!0)}},"fill-extrusion":function(c,t,n,s){const u=n.paint.get("fill-extrusion-opacity");if(u!==0&&c.renderPass==="translucent"){const d=new Dt(c.context.gl.LEQUAL,Dt.ReadWrite,c.depthRangeFor3D);if(u!==1||n.paint.get("fill-extrusion-pattern").constantOr(1))Un(c,t,n,s,d,Nt.disabled,lt.disabled),Un(c,t,n,s,d,c.stencilModeFor3D(),c.colorModeForRenderPass());else{const g=c.colorModeForRenderPass();Un(c,t,n,s,d,Nt.disabled,g)}}},hillshade:function(c,t,n,s){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const u=c.context,d=c.depthModeForSublayer(0,Dt.ReadOnly),g=c.colorModeForRenderPass(),[x,v]=c.renderPass==="translucent"?c.stencilConfigForOverlap(s):[{},s];for(const S of v){const C=t.getTile(S);C.needsHillshadePrepare&&c.renderPass==="offscreen"?_r(c,C,n,d,Nt.disabled,g):c.renderPass==="translucent"&&Jo(c,C,n,d,x[S.overscaledZ],g)}u.viewport.set([0,0,c.width,c.height])},raster:function(c,t,n,s){if(c.renderPass!=="translucent"||n.paint.get("raster-opacity")===0||!s.length)return;const u=c.context,d=u.gl,g=t.getSource(),x=c.useProgram("raster"),v=c.colorModeForRenderPass(),[S,C]=g instanceof Ur?[{},s]:c.stencilConfigForOverlap(s),L=C[C.length-1].overscaledZ,O=!c.options.moving;for(const H of C){const V=c.depthModeForSublayer(H.overscaledZ-L,n.paint.get("raster-opacity")===1?Dt.ReadWrite:Dt.ReadOnly,d.LESS),Z=t.getTile(H),te=c.transform.calculatePosMatrix(H.toUnwrapped(),O);Z.registerFadeDuration(n.paint.get("raster-fade-duration"));const ie=t.findLoadedParent(H,0),ae=Gs(Z,ie,t,n,c.transform);let re,_e;const he=n.paint.get("raster-resampling")==="nearest"?d.NEAREST:d.LINEAR;u.activeTexture.set(d.TEXTURE0),Z.texture.bind(he,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),u.activeTexture.set(d.TEXTURE1),ie?(ie.texture.bind(he,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),re=Math.pow(2,ie.tileID.overscaledZ-Z.tileID.overscaledZ),_e=[Z.tileID.canonical.x*re%1,Z.tileID.canonical.y*re%1]):Z.texture.bind(he,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST);const me=Bs(te,_e||[0,0],re||1,ae,n);g instanceof Ur?x.draw(u,d.TRIANGLES,V,Nt.disabled,v,Jt.disabled,me,n.id,g.boundsBuffer,c.quadTriangleIndexBuffer,g.boundsSegments):x.draw(u,d.TRIANGLES,V,S[H.overscaledZ],v,Jt.disabled,me,n.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}},background:function(c,t,n){const s=n.paint.get("background-color"),u=n.paint.get("background-opacity");if(u===0)return;const d=c.context,g=d.gl,x=c.transform,v=x.tileSize,S=n.paint.get("background-pattern");if(c.isPatternMissing(S))return;const C=!S&&s.a===1&&u===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==C)return;const L=Nt.disabled,O=c.depthModeForSublayer(0,C==="opaque"?Dt.ReadWrite:Dt.ReadOnly),H=c.colorModeForRenderPass(),V=c.useProgram(S?"backgroundPattern":"background"),Z=x.coveringTiles({tileSize:v});S&&(d.activeTexture.set(g.TEXTURE0),c.imageManager.bind(c.context));const te=n.getCrossfadeParameters();for(const ie of Z){const ae=c.transform.calculatePosMatrix(ie.toUnwrapped()),re=S?Pa(ae,u,c,S,{tileID:ie,tileSize:v},te):Zl(ae,u,s);V.draw(d,g.TRIANGLES,O,L,H,Jt.disabled,re,n.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}},debug:function(c,t,n){for(let s=0;s<n.length;s++)Xs(c,t,n[s])},custom:function(c,t,n){const s=c.context,u=n.implementation;if(c.renderPass==="offscreen"){const d=u.prerender;d&&(c.setCustomLayerDefaults(),s.setColorMode(c.colorModeForRenderPass()),d.call(u,s.gl,c.transform.customLayerMatrix()),s.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),s.setColorMode(c.colorModeForRenderPass()),s.setStencilMode(Nt.disabled);const d=u.renderingMode==="3d"?new Dt(c.context.gl.LEQUAL,Dt.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,Dt.ReadOnly);s.setDepthMode(d),u.render(s.gl,c.transform.customLayerMatrix()),s.setDirty(),c.setBaseState(),s.bindFramebuffer.set(null)}}};class Xa{constructor(t,n){this.context=new Go(t),this.transform=n,this._tileTextures={},this.setup(),this.numSublayers=mi.maxUnderzooming+mi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new pt,this.gpuTimers={}}resize(t,n,s){if(this.width=t*s,this.height=n*s,this.pixelRatio=s,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const t=this.context,n=new a.PosArray;n.emplaceBack(0,0),n.emplaceBack(a.EXTENT,0),n.emplaceBack(0,a.EXTENT),n.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(n,Aa.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const s=new a.PosArray;s.emplaceBack(0,0),s.emplaceBack(a.EXTENT,0),s.emplaceBack(0,a.EXTENT),s.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=t.createVertexBuffer(s,Aa.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const u=new a.RasterBoundsArray;u.emplaceBack(0,0,0,0),u.emplaceBack(a.EXTENT,0,a.EXTENT,0),u.emplaceBack(0,a.EXTENT,0,a.EXTENT),u.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(u,an.members),this.rasterBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const d=new a.PosArray;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(d,Aa.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const g=new a.LineStripIndexArray;g.emplaceBack(0),g.emplaceBack(1),g.emplaceBack(3),g.emplaceBack(2),g.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(g);const x=new a.TriangleIndexArray;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x),this.emptyTexture=new mt(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const v=this.context.gl;this.stencilClearMode=new Nt({func:v.ALWAYS,mask:0},0,255,v.ZERO,v.ZERO,v.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const s=a.create();a.ortho(s,0,this.width,this.height,0,0,1),a.scale(s,s,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,Dt.disabled,this.stencilClearMode,lt.disabled,Jt.disabled,so(s),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const s=this.context,u=s.gl;this.nextStencilID+n.length>256&&this.clearStencil(),s.setColorMode(lt.disabled),s.setDepthMode(Dt.disabled);const d=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const g of n){const x=this._tileClippingMaskIDs[g.key]=this.nextStencilID++;d.draw(s,u.TRIANGLES,Dt.disabled,new Nt({func:u.ALWAYS,mask:0},x,255,u.KEEP,u.KEEP,u.REPLACE),lt.disabled,Jt.disabled,so(g.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Nt({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new Nt({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,s=t.sort((g,x)=>x.overscaledZ-g.overscaledZ),u=s[s.length-1].overscaledZ,d=s[0].overscaledZ-u+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const g={};for(let x=0;x<d;x++)g[x+u]=new Nt({func:n.GEQUAL,mask:255},x+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=d,[g,s]}return[{[u]:Nt.disabled},s]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new lt([t.CONSTANT_COLOR,t.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?lt.unblended:lt.alphaBlended}depthModeForSublayer(t,n,s){if(!this.opaquePassEnabledForLayer())return Dt.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Dt(s||this.context.gl.LEQUAL,n,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const s=this.style._order,u=this.style.sourceCaches;for(const v in u){const S=u[v];S.used&&S.prepare(this.context)}const d={},g={},x={};for(const v in u){const S=u[v];d[v]=S.getVisibleCoordinates(),g[v]=d[v].slice().reverse(),x[v]=S.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let v=0;v<s.length;v++)if(this.style._layers[s[v]].is3D()){this.opaquePassCutoff=v;break}this.renderPass="offscreen";for(const v of s){const S=this.style._layers[v];if(!S.hasOffscreenPass()||S.isHidden(this.transform.zoom))continue;const C=g[S.source];(S.type==="custom"||C.length)&&this.renderLayer(this,u[S.source],S,C)}for(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=s.length-1;this.currentLayer>=0;this.currentLayer--){const v=this.style._layers[s[this.currentLayer]],S=u[v.source],C=d[v.source];this._renderTileClippingMasks(v,C),this.renderLayer(this,S,v,C)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<s.length;this.currentLayer++){const v=this.style._layers[s[this.currentLayer]],S=u[v.source],C=(v.type==="symbol"?x:g)[v.source];this._renderTileClippingMasks(v,d[v.source]),this.renderLayer(this,S,v,C)}if(this.options.showTileBoundaries){let v,S;Object.values(this.style._layers).forEach(C=>{C.source&&!C.isHidden(this.transform.zoom)&&(C.source!==(S&&S.id)&&(S=this.style.sourceCaches[C.source]),(!v||v.getSource().maxzoom<S.getSource().maxzoom)&&(v=S))}),v&&mo.debug(this,v,v.getVisibleCoordinates())}this.options.showPadding&&function(v){const S=v.transform.padding;Ws(v,v.transform.height-(S.top||0),3,Zs),Ws(v,S.bottom||0,3,Hs),ea(v,S.left||0,3,$n),ea(v,v.transform.width-(S.right||0),3,Qo);const C=v.transform.centerPoint;(function(L,O,H,V){ta(L,O-1,H-10,2,20,V),ta(L,O-10,H-1,20,2,V)})(v,C.x,v.transform.height-C.y,Wa)}(this),this.context.setDefault()}renderLayer(t,n,s,u){s.isHidden(this.transform.zoom)||(s.type==="background"||s.type==="custom"||u.length)&&(this.id=s.id,this.gpuTimingStart(s),mo[s.type](t,n,s,u,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;let s=this.gpuTimers[t.id];s||(s=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:n.createQueryEXT()}),s.calls++,n.beginQueryEXT(n.TIME_ELAPSED_EXT,s.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const n={};for(const s in t){const u=t[s],d=this.context.extTimerQuery,g=d.getQueryObjectEXT(u.query,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(u.query),n[s]=g}return n}translatePosMatrix(t,n,s,u,d){if(!s[0]&&!s[1])return t;const g=d?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(g){const S=Math.sin(g),C=Math.cos(g);s=[s[0]*C-s[1]*S,s[0]*S+s[1]*C]}const x=[d?s[0]:ui(n,s[0],this.transform.zoom),d?s[1]:ui(n,s[1],this.transform.zoom),0],v=new Float32Array(16);return a.translate(v,t,x),v}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),s=this.imageManager.getPattern(t.to.toString());return!n||!s}useProgram(t,n){this.cache=this.cache||{};const s=`${t}${n?n.cacheKey:""}${this._showOverdrawInspector?"/overdraw":""}`;return this.cache[s]||(this.cache[s]=new ql(this.context,t,Ea[t],n,Da[t],this._showOverdrawInspector)),this.cache[s]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new mt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class ia{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,s){const u=Math.pow(2,s),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>a.transformMat4([],x,t)).map(x=>a.scale$1([],x,1/x[3]/n*u)),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const v=function(O,H){var V=H[0],Z=H[1],te=H[2],ie=V*V+Z*Z+te*te;return ie>0&&(ie=1/Math.sqrt(ie)),O[0]=H[0]*ie,O[1]=H[1]*ie,O[2]=H[2]*ie,O}([],function(O,H,V){var Z=H[0],te=H[1],ie=H[2],ae=V[0],re=V[1],_e=V[2];return O[0]=te*_e-ie*re,O[1]=ie*ae-Z*_e,O[2]=Z*re-te*ae,O}([],nt([],d[x[0]],d[x[1]]),nt([],d[x[2]],d[x[1]]))),S=-((C=v)[0]*(L=d[x[1]])[0]+C[1]*L[1]+C[2]*L[2]);var C,L;return v.concat(S)});return new ia(d,g)}}class ra{constructor(t,n){this.min=t,this.max=n,this.center=function(s,u,d){return s[0]=.5*u[0],s[1]=.5*u[1],s[2]=.5*u[2],s}([],function(s,u,d){return s[0]=u[0]+d[0],s[1]=u[1]+d[1],s[2]=u[2]+d[2],s}([],this.min,this.max))}quadrant(t){const n=[t%2==0,t<2],s=Ce(this.min),u=Ce(this.max);for(let d=0;d<n.length;d++)s[d]=n[d]?this.min[d]:this.center[d],u[d]=n[d]?this.center[d]:this.max[d];return u[2]=this.max[2],new ra(s,u)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]];let s=!0;for(let u=0;u<t.planes.length;u++){const d=t.planes[u];let g=0;for(let x=0;x<n.length;x++)a.dot(d,n[x])>=0&&g++;if(g===0)return 0;g!==n.length&&(s=!1)}if(s)return 2;for(let u=0;u<3;u++){let d=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let x=0;x<t.points.length;x++){const v=t.points[x][u]-this.min[u];d=Math.min(d,v),g=Math.max(g,v)}if(g<0||d>this.max[u]-this.min[u])return 0}return 1}}class Nn{constructor(t=0,n=0,s=0,u=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(s)||s<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=s,this.right=u}interpolate(t,n,s){return n.top!=null&&t.top!=null&&(this.top=a.number(t.top,n.top,s)),n.bottom!=null&&t.bottom!=null&&(this.bottom=a.number(t.bottom,n.bottom,s)),n.left!=null&&t.left!=null&&(this.left=a.number(t.left,n.left,s)),n.right!=null&&t.right!=null&&(this.right=a.number(t.right,n.right,s)),this}getCenter(t,n){const s=a.clamp((this.left+t-this.right)/2,0,t),u=a.clamp((this.top+n-this.bottom)/2,0,n);return new a.pointGeometry(s,u)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Nn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class fo{constructor(t,n,s,u,d){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=d===void 0||!!d,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=s==null?0:s,this._maxPitch=u==null?60:u,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Nn,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new fo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-a.wrap(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var s=new a.ARRAY_TYPE(4);return a.ARRAY_TYPE!=Float32Array&&(s[1]=0,s[2]=0),s[0]=1,s[3]=1,s}(),function(s,u,d){var g=u[0],x=u[1],v=u[2],S=u[3],C=Math.sin(d),L=Math.cos(d);s[0]=g*L+v*C,s[1]=x*L+S*C,s[2]=g*-C+v*L,s[3]=x*-C+S*L}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=a.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,s){this._unmodified=!1,this._edgeInsets.interpolate(t,n,s),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new a.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const s=this.pointCoordinate(new a.pointGeometry(0,0)),u=this.pointCoordinate(new a.pointGeometry(this.width,0)),d=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),g=this.pointCoordinate(new a.pointGeometry(0,this.height)),x=Math.floor(Math.min(s.x,u.x,d.x,g.x)),v=Math.floor(Math.max(s.x,u.x,d.x,g.x)),S=1;for(let C=x-S;C<=v+S;C++)C!==0&&n.push(new a.UnwrappedTileID(C,t))}return n}coveringTiles(t){let n=this.coveringZoomLevel(t);const s=n;if(t.minzoom!==void 0&&n<t.minzoom)return[];t.maxzoom!==void 0&&n>t.maxzoom&&(n=t.maxzoom);const u=a.MercatorCoordinate.fromLngLat(this.center),d=Math.pow(2,n),g=[d*u.x,d*u.y,0],x=ia.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n);let v=t.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(v=n);const S=V=>({aabb:new ra([V*d,0,0],[(V+1)*d,d,0]),zoom:0,x:0,y:0,wrap:V,fullyVisible:!1}),C=[],L=[],O=n,H=t.reparseOverscaled?s:n;if(this._renderWorldCopies)for(let V=1;V<=3;V++)C.push(S(-V)),C.push(S(V));for(C.push(S(0));C.length>0;){const V=C.pop(),Z=V.x,te=V.y;let ie=V.fullyVisible;if(!ie){const me=V.aabb.intersects(x);if(me===0)continue;ie=me===2}const ae=V.aabb.distanceX(g),re=V.aabb.distanceY(g),_e=Math.max(Math.abs(ae),Math.abs(re)),he=3+(1<<O-V.zoom)-2;if(V.zoom===O||_e>he&&V.zoom>=v)L.push({tileID:new a.OverscaledTileID(V.zoom===O?H:V.zoom,V.wrap,V.zoom,Z,te),distanceSq:Ct([g[0]-.5-Z,g[1]-.5-te])});else for(let me=0;me<4;me++){const Se=(Z<<1)+me%2,Te=(te<<1)+(me>>1);C.push({aabb:V.aabb.quadrant(me),zoom:V.zoom+1,x:Se,y:Te,wrap:V.wrap,fullyVisible:ie})}}return L.sort((V,Z)=>V.distanceSq-Z.distanceSq).map(V=>V.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=a.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.pointGeometry(a.mercatorXfromLng(t.lng)*this.worldSize,a.mercatorYfromLat(n)*this.worldSize)}unproject(t){return new a.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(t,n){const s=this.pointCoordinate(n),u=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(t),g=new a.MercatorCoordinate(d.x-(s.x-u.x),d.y-(s.y-u.y));this.center=this.coordinateLocation(g),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}locationCoordinate(t){return a.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t.toLngLat()}pointCoordinate(t){const n=[t.x,t.y,0,1],s=[t.x,t.y,1,1];a.transformMat4(n,n,this.pixelMatrixInverse),a.transformMat4(s,s,this.pixelMatrixInverse);const u=n[3],d=s[3],g=n[1]/u,x=s[1]/d,v=n[2]/u,S=s[2]/d,C=v===S?0:(0-v)/(S-v);return new a.MercatorCoordinate(a.number(n[0]/u,s[0]/d,C)/this.worldSize,a.number(g,x,C)/this.worldSize)}coordinatePoint(t){const n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return a.transformMat4(n,n,this.pixelMatrix),new a.pointGeometry(n[0]/n[3],n[1]/n[3])}getBounds(){return new a.LngLatBounds().extend(this.pointLocation(new a.pointGeometry(0,0))).extend(this.pointLocation(new a.pointGeometry(this.width,0))).extend(this.pointLocation(new a.pointGeometry(this.width,this.height))).extend(this.pointLocation(new a.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new a.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){const s=t.key,u=n?this._alignedPosMatrixCache:this._posMatrixCache;if(u[s])return u[s];const d=t.canonical,g=this.worldSize/this.zoomScale(d.z),x=d.x+Math.pow(2,d.z)*t.wrap,v=a.identity(new Float64Array(16));return a.translate(v,v,[x*g,d.y*g,0]),a.scale(v,v,[g/a.EXTENT,g/a.EXTENT,1]),a.multiply(v,n?this.alignedProjMatrix:this.projMatrix,v),u[s]=new Float32Array(v),u[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,s,u,d=-90,g=90,x=-180,v=180;const S=this.size,C=this._unmodified;if(this.latRange){const H=this.latRange;d=a.mercatorYfromLat(H[1])*this.worldSize,g=a.mercatorYfromLat(H[0])*this.worldSize,t=g-d<S.y?S.y/(g-d):0}if(this.lngRange){const H=this.lngRange;x=a.mercatorXfromLng(H[0])*this.worldSize,v=a.mercatorXfromLng(H[1])*this.worldSize,n=v-x<S.x?S.x/(v-x):0}const L=this.point,O=Math.max(n||0,t||0);if(O)return this.center=this.unproject(new a.pointGeometry(n?(v+x)/2:L.x,t?(g+d)/2:L.y)),this.zoom+=this.scaleZoom(O),this._unmodified=C,void(this._constraining=!1);if(this.latRange){const H=L.y,V=S.y/2;H-V<d&&(u=d+V),H+V>g&&(u=g-V)}if(this.lngRange){const H=L.x,V=S.x/2;H-V<x&&(s=x+V),H+V>v&&(s=v-V)}s===void 0&&u===void 0||(this.center=this.unproject(new a.pointGeometry(s!==void 0?s:L.x,u!==void 0?u:L.y))),this._unmodified=C,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const n=Math.PI/2+this._pitch,s=this._fov*(.5+t.y/this.height),u=Math.sin(s)*this.cameraToCenterDistance/Math.sin(a.clamp(Math.PI-n-s,.01,Math.PI-.01)),d=this.point,g=d.x,x=d.y,v=1.01*(Math.cos(Math.PI/2-this._pitch)*u+this.cameraToCenterDistance),S=this.height/50;let C=new Float64Array(16);a.perspective(C,this._fov,this.width/this.height,S,v),C[8]=2*-t.x/this.width,C[9]=2*t.y/this.height,a.scale(C,C,[1,-1,1]),a.translate(C,C,[0,0,-this.cameraToCenterDistance]),a.rotateX(C,C,this._pitch),a.rotateZ(C,C,this.angle),a.translate(C,C,[-g,-x,0]),this.mercatorMatrix=a.scale([],C,[this.worldSize,this.worldSize,this.worldSize]),a.scale(C,C,[1,1,a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize]),this.projMatrix=C,this.invProjMatrix=a.invert([],this.projMatrix);const L=this.width%2/2,O=this.height%2/2,H=Math.cos(this.angle),V=Math.sin(this.angle),Z=g-Math.round(g)+H*L+V*O,te=x-Math.round(x)+H*O+V*L,ie=new Float64Array(C);if(a.translate(ie,ie,[Z>.5?Z-1:Z,te>.5?te-1:te,0]),this.alignedProjMatrix=ie,C=a.create(),a.scale(C,C,[this.width/2,-this.height/2,1]),a.translate(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=a.create(),a.scale(C,C,[1,-1,1]),a.translate(C,C,[-1,-1,0]),a.scale(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),C=a.invert(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");this.pixelMatrixInverse=C,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new a.pointGeometry(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return a.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let s=n.x,u=n.y,d=n.x,g=n.y;for(const x of t)s=Math.min(s,x.x),u=Math.min(u,x.y),d=Math.max(d,x.x),g=Math.max(g,x.y);return[new a.pointGeometry(s,u),new a.pointGeometry(d,u),new a.pointGeometry(d,g),new a.pointGeometry(s,g),new a.pointGeometry(s,u)]}}}class Ys{constructor(t){this._hashName=t&&encodeURIComponent(t),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(n,s){let u=!1,d=null;const g=()=>{d=null,u&&(n(),d=setTimeout(g,300),u=!1)};return()=>(u=!0,d||g(),d)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),s=Math.round(100*this._map.getZoom())/100,u=Math.ceil((s*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,u),g=Math.round(n.lng*d)/d,x=Math.round(n.lat*d)/d,v=this._map.getBearing(),S=this._map.getPitch();let C="";if(C+=t?`/${g}/${x}/${s}`:`${s}/${x}/${g}`,(v||S)&&(C+="/"+Math.round(10*v)/10),S&&(C+=`/${Math.round(S)}`),this._hashName){const L=this._hashName;let O=!1;const H=window.location.hash.slice(1).split("&").map(V=>{const Z=V.split("=")[0];return Z===L?(O=!0,`${Z}=${C}`):V}).filter(V=>V);return O||H.push(`${L}=${C}`),`#${H.join("&")}`}return`#${C}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(s=>s.split("=")).forEach(s=>{s[0]===this._hashName&&(n=s)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(n=>isNaN(n))){const n=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:n,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const go={linearity:.3,easing:a.bezier(0,0,.3,1)},Ks=a.extend({deceleration:2500,maxSpeed:1400},go),Js=a.extend({deceleration:20,maxSpeed:1400},go),Qs=a.extend({deceleration:1e3,maxSpeed:360},go),jn=a.extend({deceleration:1e3,maxSpeed:90},go);class el{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=a.exported.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)n.zoom+=d.zoomDelta||0,n.bearing+=d.bearingDelta||0,n.pitch+=d.pitchDelta||0,d.panDelta&&n.pan._add(d.panDelta),d.around&&(n.around=d.around),d.pinchAround&&(n.pinchAround=d.pinchAround);const s=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(n.pan.mag()){const d=_o(n.pan.mag(),s,a.extend({},Ks,t||{}));u.offset=n.pan.mult(d.amount/n.pan.mag()),u.center=this._map.transform.center,yo(u,d)}if(n.zoom){const d=_o(n.zoom,s,Js);u.zoom=this._map.transform.zoom+d.amount,yo(u,d)}if(n.bearing){const d=_o(n.bearing,s,Qs);u.bearing=this._map.transform.bearing+a.clamp(d.amount,-179,179),yo(u,d)}if(n.pitch){const d=_o(n.pitch,s,jn);u.pitch=this._map.transform.pitch+d.amount,yo(u,d)}if(u.zoom||u.bearing){const d=n.pinchAround===void 0?n.around:n.pinchAround;u.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),a.extend(u,{noMoveStart:!0})}}function yo(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function _o(c,t,n){const{maxSpeed:s,linearity:u,deceleration:d}=n,g=a.clamp(c*u/(t/1e3),-s,s),x=Math.abs(g)/(d*u);return{easing:n.easing,duration:1e3*x,amount:g*(x/2)}}class Xi extends a.Event{constructor(t,n,s,u={}){const d=j.mousePos(n.getCanvasContainer(),s),g=n.unproject(d);super(t,a.extend({point:d,lngLat:g,originalEvent:s},u)),this._defaultPrevented=!1,this.target=n}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Fi extends a.Event{constructor(t,n,s){const u=t==="touchend"?s.changedTouches:s.touches,d=j.touchPos(n.getCanvasContainer(),u),g=d.map(v=>n.unproject(v)),x=d.reduce((v,S,C,L)=>v.add(S.div(L.length)),new a.pointGeometry(0,0));super(t,{points:d,point:x,lngLats:g,lngLat:n.unproject(x),originalEvent:s}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class tc extends a.Event{constructor(t,n,s){super(t,{originalEvent:s}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class _n{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new tc(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Xi(t.type,this._map,t))}mouseup(t){this._map.fire(new Xi(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Xi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Xi(t.type,this._map,t))}mouseover(t){this._map.fire(new Xi(t.type,this._map,t))}mouseout(t){this._map.fire(new Xi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Fi(t.type,this._map,t))}touchmove(t){this._map.fire(new Fi(t.type,this._map,t))}touchend(t){this._map.fire(new Fi(t.type,this._map,t))}touchcancel(t){this._map.fire(new Fi(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tl{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Xi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Xi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qn{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(j.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const s=n;if(this._lastPos.equals(s)||!this._box&&s.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=s,this._box||(this._box=j.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const d=Math.min(u.x,s.x),g=Math.max(u.x,s.x),x=Math.min(u.y,s.y),v=Math.max(u.y,s.y);j.setTransform(this._box,`translate(${d}px,${x}px)`),this._box.style.width=g-d+"px",this._box.style.height=v-x+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const s=this._startPos,u=n;if(this.reset(),j.suppressClick(),s.x!==u.x||s.y!==u.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:d=>d.fitScreenCoordinates(s,u,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(j.remove(this._box),this._box=null),j.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new a.Event(t,{originalEvent:n}))}}function xn(c,t){const n={};for(let s=0;s<c.length;s++)n[c[s].identifier]=t[s];return n}class ic{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,s){(this.centroid||s.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),s.length===this.numTouches&&(this.centroid=function(u){const d=new a.pointGeometry(0,0);for(const g of u)d._add(g);return d.div(u.length)}(n),this.touches=xn(s,n)))}touchmove(t,n,s){if(this.aborted||!this.centroid)return;const u=xn(s,n);for(const d in this.touches){const g=this.touches[d],x=u[d];(!x||x.dist(g)>30)&&(this.aborted=!0)}}touchend(t,n,s){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),s.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Ya{constructor(t){this.singleTap=new ic(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,s){this.singleTap.touchstart(t,n,s)}touchmove(t,n,s){this.singleTap.touchmove(t,n,s)}touchend(t,n,s){const u=this.singleTap.touchend(t,n,s);if(u){const d=t.timeStamp-this.lastTime<500,g=!this.lastTap||this.lastTap.dist(u)<30;if(d&&g||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class rc{constructor(){this._zoomIn=new Ya({numTouches:1,numTaps:2}),this._zoomOut=new Ya({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,s){this._zoomIn.touchstart(t,n,s),this._zoomOut.touchstart(t,n,s)}touchmove(t,n,s){this._zoomIn.touchmove(t,n,s),this._zoomOut.touchmove(t,n,s)}touchend(t,n,s){const u=this._zoomIn.touchend(t,n,s),d=this._zoomOut.touchend(t,n,s);return u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:g.getZoom()+1,around:g.unproject(u)},{originalEvent:t})}):d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:g.getZoom()-1,around:g.unproject(d)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const il={0:1,2:2};class bn{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const s=j.mouseButton(t);this._correctButton(t,s)&&(this._lastPoint=n,this._eventButton=s)}mousemoveWindow(t,n){const s=this._lastPoint;if(s){if(t.preventDefault(),function(u,d){const g=il[d];return u.buttons===void 0||(u.buttons&g)!==g}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(s)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(s,n)}}mouseupWindow(t){this._lastPoint&&j.mouseButton(t)===this._eventButton&&(this._moved&&j.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gn extends bn{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class $e extends bn{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const s=.8*(n.x-t.x);if(s)return this._active=!0,{bearingDelta:s}}contextmenu(t){t.preventDefault()}}class Ka extends bn{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const s=-.5*(n.y-t.y);if(s)return this._active=!0,{pitchDelta:s}}contextmenu(t){t.preventDefault()}}class xo{constructor(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0)}touchstart(t,n,s){return this._calculateTransform(t,n,s)}touchmove(t,n,s){if(this._active&&!(s.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,n,s)}touchend(t,n,s){this._calculateTransform(t,n,s),this._active&&s.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,s){s.length>0&&(this._active=!0);const u=xn(s,n),d=new a.pointGeometry(0,0),g=new a.pointGeometry(0,0);let x=0;for(const S in u){const C=u[S],L=this._touches[S];L&&(d._add(C),g._add(C.sub(L)),x++,u[S]=C)}if(this._touches=u,x<this._minTouches||!g.mag())return;const v=g.div(x);return this._sum._add(v),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(x),panDelta:v}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,n,s){return{}}touchstart(t,n,s){this._firstTwoTouches||s.length<2||(this._firstTwoTouches=[s[0].identifier,s[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,s){if(!this._firstTwoTouches)return;t.preventDefault();const[u,d]=this._firstTwoTouches,g=bo(s,n,u),x=bo(s,n,d);if(!g||!x)return;const v=this._aroundCenter?null:g.add(x).div(2);return this._move([g,x],v,t)}touchend(t,n,s){if(!this._firstTwoTouches)return;const[u,d]=this._firstTwoTouches,g=bo(s,n,u),x=bo(s,n,d);g&&x||(this._active&&j.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function bo(c,t,n){for(let s=0;s<c.length;s++)if(c[s].identifier===n)return t[s]}function Pe(c,t){return Math.log(c/t)/Math.LN2}class Ja extends vn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const s=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Pe(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Pe(this._distance,s),pinchAround:n}}}function rl(c,t){return 180*c.angleWith(t)/Math.PI}class nc extends vn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const s=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:rl(this._vector,s),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,s=rl(t,this._startVector);return Math.abs(s)<n}}function vo(c){return Math.abs(c.y)>Math.abs(c.x)}class nl extends vn{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(t){this._lastPoints=t,vo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,s){const u=t[0].sub(this._lastPoints[0]),d=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(u,d,s.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(u.y+d.y)/2*-.5}}gestureBeginsVertically(t,n,s){if(this._valid!==void 0)return this._valid;const u=t.mag()>=2,d=n.mag()>=2;if(!u&&!d)return;if(!u||!d)return this._firstMove===void 0&&(this._firstMove=s),s-this._firstMove<100&&void 0;const g=t.y>0==n.y>0;return vo(t)&&vo(n)&&g}}const ol={panStep:100,bearingStep:15,pitchStep:10};class oc{constructor(){const t=ol;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,s=0,u=0,d=0,g=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?s=-1:(t.preventDefault(),d=-1);break;case 39:t.shiftKey?s=1:(t.preventDefault(),d=1);break;case 38:t.shiftKey?u=1:(t.preventDefault(),g=-1);break;case 40:t.shiftKey?u=-1:(t.preventDefault(),g=1);break;default:return}return this._rotationDisabled&&(s=0,u=0),{cameraAnimation:x=>{const v=x.getZoom();x.easeTo({duration:300,easeId:"keyboardHandler",easing:ac,zoom:n?Math.round(v)+n*(t.shiftKey?2:1):v,bearing:x.getBearing()+s*this._bearingStep,pitch:x.getPitch()+u*this._pitchStep,offset:[-d*this._panStep,-g*this._panStep],center:x.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ac(c){return c*(2-c)}const na=4.000244140625;class Qa{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const s=a.exported.now(),u=s-(this._lastWheelEventTime||0);this._lastWheelEventTime=s,n!==0&&n%na==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(u*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=j.mousePos(this._el,t);this._around=a.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(n)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const x=this._type==="wheel"&&Math.abs(this._delta)>na?this._wheelZoomRate:this._defaultZoomRate;let v=2/(1+Math.exp(-Math.abs(this._delta*x)));this._delta<0&&v!==0&&(v=1/v);const S=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(S*v))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,s=this._startZoom,u=this._easing;let d,g=!1;if(this._type==="wheel"&&s&&u){const x=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),v=u(x);d=a.number(s,n,v),x<1?this._frameId||(this._frameId=!0):g=!0}else d=n,g=!0;return this._active=!0,g&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!g,zoomDelta:d-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=a.ease;if(this._prevEase){const s=this._prevEase,u=(a.exported.now()-s.start)/s.duration,d=s.easing(u+.01)-s.easing(u),g=.27/Math.sqrt(d*d+1e-4)*.01,x=Math.sqrt(.0729-g*g);n=a.bezier(g,x,.25,1)}return this._prevEase={start:a.exported.now(),duration:t,easing:n},n}reset(){this._active=!1}}class es{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ts{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:s=>{s.easeTo({duration:300,zoom:s.getZoom()+(t.shiftKey?-1:1),around:s.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oi{constructor(){this._tap=new Ya({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,n,s){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?s.length>0&&(this._swipePoint=n[0],this._swipeTouch=s[0].identifier):this._tap.touchstart(t,n,s))}touchmove(t,n,s){if(this._tapTime){if(this._swipePoint){if(s[0].identifier!==this._swipeTouch)return;const u=n[0],d=u.y-this._swipePoint.y;return this._swipePoint=u,t.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(t,n,s)}touchend(t,n,s){this._tapTime?this._swipePoint&&s.length===0&&this.reset():this._tap.touchend(t,n,s)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tn{constructor(t,n,s){this._el=t,this._mousePan=n,this._touchPan=s}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class al{constructor(t,n,s){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=s}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class is{constructor(t,n,s,u){this._el=t,this._touchZoom=n,this._touchRotate=s,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Zn=c=>c.zoom||c.drag||c.pitch||c.rotate;class rs extends a.Event{}function oa(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class or{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new el(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n),a.bindAll(["handleEvent","handleWindowEvent"],this);const s=this._el;this._listeners=[[s,"touchstart",{passive:!0}],[s,"touchmove",{passive:!1}],[s,"touchend",void 0],[s,"touchcancel",void 0],[s,"mousedown",void 0],[s,"mousemove",void 0],[s,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[s,"mouseover",void 0],[s,"mouseout",void 0],[s,"dblclick",void 0],[s,"click",void 0],[s,"keydown",{capture:!1}],[s,"keyup",void 0],[s,"wheel",{passive:!1}],[s,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,d,g]of this._listeners)j.addEventListener(u,d,u===document?this.handleWindowEvent:this.handleEvent,g)}destroy(){for(const[t,n,s]of this._listeners)j.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,s)}_addDefaultHandlers(t){const n=this._map,s=n.getCanvasContainer();this._add("mapEvent",new _n(n,t));const u=n.boxZoom=new qn(n,t);this._add("boxZoom",u);const d=new rc,g=new ts;n.doubleClickZoom=new es(g,d),this._add("tapZoom",d),this._add("clickZoom",g);const x=new Oi;this._add("tapDragZoom",x);const v=n.touchPitch=new nl;this._add("touchPitch",v);const S=new $e(t),C=new Ka(t);n.dragRotate=new al(t,S,C),this._add("mouseRotate",S,["mousePitch"]),this._add("mousePitch",C,["mouseRotate"]);const L=new Gn(t),O=new xo(t);n.dragPan=new tn(s,L,O),this._add("mousePan",L),this._add("touchPan",O,["touchZoom","touchRotate"]);const H=new nc,V=new Ja;n.touchZoomRotate=new is(s,V,H,x),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",V,["touchPan","touchRotate"]);const Z=n.scrollZoom=new Qa(n,this);this._add("scrollZoom",Z,["mousePan"]);const te=n.keyboard=new oc;this._add("keyboard",te),this._add("blockableMapEvent",new tl(n));for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ie]&&n[ie].enable(t[ie])}_add(t,n,s){this._handlers.push({handlerName:t,handler:n,allowed:s}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Zn(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,n,s){for(const u in t)if(u!==s&&(!n||n.indexOf(u)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const s of t)this._el.contains(s.target)&&n.push(s);return n}handleEvent(t,n){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const s=t.type==="renderFrame"?void 0:t,u={needsRenderFrame:!1},d={},g={},x=t.touches,v=x?this._getMapTouches(x):void 0,S=v?j.touchPos(this._el,v):j.mousePos(this._el,t);for(const{handlerName:O,handler:H,allowed:V}of this._handlers){if(!H.isEnabled())continue;let Z;this._blockedByActive(g,V,O)?H.reset():H[n||t.type]&&(Z=H[n||t.type](t,S,v),this.mergeHandlerResult(u,d,Z,O,s),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||H.isActive())&&(g[O]=H)}const C={};for(const O in this._previousActiveHandlers)g[O]||(C[O]=s);this._previousActiveHandlers=g,(Object.keys(C).length||oa(u))&&(this._changes.push([u,d,C]),this._triggerRenderFrame()),(Object.keys(g).length||oa(u))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:L}=u;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))}mergeHandlerResult(t,n,s,u,d){if(!s)return;a.extend(t,s);const g={handlerName:u,originalEvent:s.originalEvent||d};s.zoomDelta!==void 0&&(n.zoom=g),s.panDelta!==void 0&&(n.drag=g),s.pitchDelta!==void 0&&(n.pitch=g),s.bearingDelta!==void 0&&(n.rotate=g)}_applyChanges(){const t={},n={},s={};for(const[u,d,g]of this._changes)u.panDelta&&(t.panDelta=(t.panDelta||new a.pointGeometry(0,0))._add(u.panDelta)),u.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(t.around=u.around),u.pinchAround!==void 0&&(t.pinchAround=u.pinchAround),u.noInertia&&(t.noInertia=u.noInertia),a.extend(n,d),a.extend(s,g);this._updateMapTransform(t,n,s),this._changes=[]}_updateMapTransform(t,n,s){const u=this._map,d=u.transform;if(!oa(t))return this._fireEvents(n,s,!0);let{panDelta:g,zoomDelta:x,bearingDelta:v,pitchDelta:S,around:C,pinchAround:L}=t;L!==void 0&&(C=L),u._stop(!0),C=C||u.transform.centerPoint;const O=d.pointLocation(g?C.sub(g):C);v&&(d.bearing+=v),S&&(d.pitch+=S),x&&(d.zoom+=x),d.setLocationAtPoint(O,C),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,s,!0)}_fireEvents(t,n,s){const u=Zn(this._eventsInProgress),d=Zn(t),g={};for(const C in t){const{originalEvent:L}=t[C];this._eventsInProgress[C]||(g[`${C}start`]=L),this._eventsInProgress[C]=t[C]}!u&&d&&this._fireEvent("movestart",d.originalEvent);for(const C in g)this._fireEvent(C,g[C]);d&&this._fireEvent("move",d.originalEvent);for(const C in t){const{originalEvent:L}=t[C];this._fireEvent(C,L)}const x={};let v;for(const C in this._eventsInProgress){const{handlerName:L,originalEvent:O}=this._eventsInProgress[C];this._handlersById[L].isActive()||(delete this._eventsInProgress[C],v=n[L]||O,x[`${C}end`]=v)}for(const C in x)this._fireEvent(C,x[C]);const S=Zn(this._eventsInProgress);if(s&&(u||d)&&!S){this._updatingCamera=!0;const C=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;C?(L(C.bearing||this._map.getBearing())&&(C.bearing=0),this._map.easeTo(C,{originalEvent:v})):(this._map.fire(new a.Event("moveend",{originalEvent:v})),L(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new a.Event(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new rs("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const jt={extend:(c,...t)=>a.extend(c,...t),run(c){c()},logToElement(c,t=!1,n="log"){const s=window.document.getElementById(n);s&&(t&&(s.innerHTML=""),s.innerHTML+=`<br>${c}`)}};class aa extends a.Evented{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,s){return t=a.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,a.extend({offset:t},n),s)}panTo(t,n,s){return this.easeTo(a.extend({center:t},n),s)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,s){return this.easeTo(a.extend({zoom:t},n),s)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,s){return this.easeTo(a.extend({bearing:t},n),s)}resetNorth(t,n){return this.rotateTo(0,a.extend({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=a.LngLatBounds.convert(t);const s=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),s,n)}_cameraForBoxAndBearing(t,n,s,u){const d={top:0,bottom:0,right:0,left:0};if(typeof(u=a.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const he=u.padding;u.padding={top:he,bottom:he,right:he,left:he}}u.padding=a.extend(d,u.padding);const g=this.transform,x=g.padding,v=g.project(a.LngLat.convert(t)),S=g.project(a.LngLat.convert(n)),C=v.rotate(-s*Math.PI/180),L=S.rotate(-s*Math.PI/180),O=new a.pointGeometry(Math.max(C.x,L.x),Math.max(C.y,L.y)),H=new a.pointGeometry(Math.min(C.x,L.x),Math.min(C.y,L.y)),V=O.sub(H),Z=(g.width-(x.left+x.right+u.padding.left+u.padding.right))/V.x,te=(g.height-(x.top+x.bottom+u.padding.top+u.padding.bottom))/V.y;if(te<0||Z<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ie=Math.min(g.scaleZoom(g.scale*Math.min(Z,te)),u.maxZoom),ae=a.pointGeometry.convert(u.offset),re=new a.pointGeometry((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(s*Math.PI/180),_e=ae.add(re).mult(g.scale/g.zoomScale(ie));return{center:g.unproject(v.add(S).div(2).sub(_e)),zoom:ie,bearing:s}}fitBounds(t,n,s){return this._fitInternal(this.cameraForBounds(t,n),n,s)}fitScreenCoordinates(t,n,s,u,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(t)),this.transform.pointLocation(a.pointGeometry.convert(n)),s,u),u,d)}_fitInternal(t,n,s){return t?(delete(n=a.extend(t,n)).padding,n.linear?this.easeTo(n,s):this.flyTo(n,s)):this}jumpTo(t,n){this.stop();const s=this.transform;let u=!1,d=!1,g=!1;return"zoom"in t&&s.zoom!==+t.zoom&&(u=!0,s.zoom=+t.zoom),t.center!==void 0&&(s.center=a.LngLat.convert(t.center)),"bearing"in t&&s.bearing!==+t.bearing&&(d=!0,s.bearing=+t.bearing),"pitch"in t&&s.pitch!==+t.pitch&&(g=!0,s.pitch=+t.pitch),t.padding==null||s.isPaddingEqual(t.padding)||(s.padding=t.padding),this.fire(new a.Event("movestart",n)).fire(new a.Event("move",n)),u&&this.fire(new a.Event("zoomstart",n)).fire(new a.Event("zoom",n)).fire(new a.Event("zoomend",n)),d&&this.fire(new a.Event("rotatestart",n)).fire(new a.Event("rotate",n)).fire(new a.Event("rotateend",n)),g&&this.fire(new a.Event("pitchstart",n)).fire(new a.Event("pitch",n)).fire(new a.Event("pitchend",n)),this.fire(new a.Event("moveend",n))}easeTo(t,n){this._stop(!1,t.easeId),((t=a.extend({offset:[0,0],duration:500,easing:a.ease},t)).animate===!1||!t.essential&&a.exported.prefersReducedMotion)&&(t.duration=0);const s=this.transform,u=this.getZoom(),d=this.getBearing(),g=this.getPitch(),x=this.getPadding(),v="zoom"in t?+t.zoom:u,S="bearing"in t?this._normalizeBearing(t.bearing,d):d,C="pitch"in t?+t.pitch:g,L="padding"in t?t.padding:s.padding,O=a.pointGeometry.convert(t.offset);let H=s.centerPoint.add(O);const V=s.pointLocation(H),Z=a.LngLat.convert(t.center||V);this._normalizeCenter(Z);const te=s.project(V),ie=s.project(Z).sub(te),ae=s.zoomScale(v-u);let re,_e;t.around&&(re=a.LngLat.convert(t.around),_e=s.locationPoint(re));const he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||v!==u,this._rotating=this._rotating||d!==S,this._pitching=this._pitching||C!==g,this._padding=!s.isPaddingEqual(L),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,he),this._ease(me=>{if(this._zooming&&(s.zoom=a.number(u,v,me)),this._rotating&&(s.bearing=a.number(d,S,me)),this._pitching&&(s.pitch=a.number(g,C,me)),this._padding&&(s.interpolatePadding(x,L,me),H=s.centerPoint.add(O)),re)s.setLocationAtPoint(re,_e);else{const Se=s.zoomScale(s.zoom-u),Te=v>u?Math.min(2,ae):Math.max(.5,ae),ye=Math.pow(Te,1-me),qe=s.unproject(te.add(ie.mult(me*ye)).mult(Se));s.setLocationAtPoint(s.renderWorldCopies?qe.wrap():qe,H)}this._fireMoveEvents(n)},me=>{this._afterEase(n,me)},t),this}_prepareEase(t,n,s={}){this._moving=!0,n||s.moving||this.fire(new a.Event("movestart",t)),this._zooming&&!s.zooming&&this.fire(new a.Event("zoomstart",t)),this._rotating&&!s.rotating&&this.fire(new a.Event("rotatestart",t)),this._pitching&&!s.pitching&&this.fire(new a.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new a.Event("move",t)),this._zooming&&this.fire(new a.Event("zoom",t)),this._rotating&&this.fire(new a.Event("rotate",t)),this._pitching&&this.fire(new a.Event("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const s=this._zooming,u=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,s&&this.fire(new a.Event("zoomend",t)),u&&this.fire(new a.Event("rotateend",t)),d&&this.fire(new a.Event("pitchend",t)),this.fire(new a.Event("moveend",t))}flyTo(t,n){if(!t.essential&&a.exported.prefersReducedMotion){const xt=a.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(xt,n)}this.stop(),t=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},t);const s=this.transform,u=this.getZoom(),d=this.getBearing(),g=this.getPitch(),x=this.getPadding(),v="zoom"in t?a.clamp(+t.zoom,s.minZoom,s.maxZoom):u,S="bearing"in t?this._normalizeBearing(t.bearing,d):d,C="pitch"in t?+t.pitch:g,L="padding"in t?t.padding:s.padding,O=s.zoomScale(v-u),H=a.pointGeometry.convert(t.offset);let V=s.centerPoint.add(H);const Z=s.pointLocation(V),te=a.LngLat.convert(t.center||Z);this._normalizeCenter(te);const ie=s.project(Z),ae=s.project(te).sub(ie);let re=t.curve;const _e=Math.max(s.width,s.height),he=_e/O,me=ae.mag();if("minZoom"in t){const xt=a.clamp(Math.min(t.minZoom,u,v),s.minZoom,s.maxZoom),Yt=_e/s.zoomScale(xt-u);re=Math.sqrt(Yt/me*2)}const Se=re*re;function Te(xt){const Yt=(he*he-_e*_e+(xt?-1:1)*Se*Se*me*me)/(2*(xt?he:_e)*Se*me);return Math.log(Math.sqrt(Yt*Yt+1)-Yt)}function ye(xt){return(Math.exp(xt)-Math.exp(-xt))/2}function qe(xt){return(Math.exp(xt)+Math.exp(-xt))/2}const Le=Te(0);let at=function(xt){return qe(Le)/qe(Le+re*xt)},wt=function(xt){return _e*((qe(Le)*(ye(Yt=Le+re*xt)/qe(Yt))-ye(Le))/Se)/me;var Yt},gt=(Te(1)-Le)/re;if(Math.abs(me)<1e-6||!isFinite(gt)){if(Math.abs(_e-he)<1e-6)return this.easeTo(t,n);const xt=he<_e?-1:1;gt=Math.abs(Math.log(he/_e))/re,wt=function(){return 0},at=function(Yt){return Math.exp(xt*re*Yt)}}return t.duration="duration"in t?+t.duration:1e3*gt/("screenSpeed"in t?+t.screenSpeed/re:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=d!==S,this._pitching=C!==g,this._padding=!s.isPaddingEqual(L),this._prepareEase(n,!1),this._ease(xt=>{const Yt=xt*gt,st=1/at(Yt);s.zoom=xt===1?v:u+s.scaleZoom(st),this._rotating&&(s.bearing=a.number(d,S,xt)),this._pitching&&(s.pitch=a.number(g,C,xt)),this._padding&&(s.interpolatePadding(x,L,xt),V=s.centerPoint.add(H));const It=xt===1?te:s.unproject(ie.add(ae.mult(wt(Yt))).mult(st));s.setLocationAtPoint(s.renderWorldCopies?It.wrap():It,V),this._fireMoveEvents(n)},()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const s=this._onEaseEnd;delete this._onEaseEnd,s.call(this,n)}if(!t){const s=this.handlers;s&&s.stop(!1)}return this}_ease(t,n,s){s.animate===!1||s.duration===0?(t(1),n()):(this._easeStart=a.exported.now(),this._easeOptions=s,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=a.wrap(t,-180,180);const s=Math.abs(t-n);return Math.abs(t-360-n)<s&&(t-=360),Math.abs(t+360-n)<s&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const s=t.lng-n.center.lng;t.lng+=s>180?-360:s<-180?360:0}}class sa{constructor(t={}){this.options=t,a.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=j.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=j.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=j.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){j.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const s=this._map._getUIString(`AttributionControl.${n}`);t.title=s,t.setAttribute("aria-label",s)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const n=this._map.style.sourceCaches;for(const u in n){const d=n[u];if(d.used){const g=d.getSource();g.attribution&&t.indexOf(g.attribution)<0&&t.push(g.attribution)}}t=t.filter(u=>String(u).trim()),t.sort((u,d)=>u.length-d.length),t=t.filter((u,d)=>{for(let g=d+1;g<t.length;g++)if(t[g].indexOf(u)>=0)return!1;return!0});const s=t.join(" | ");s!==this._attribHTML&&(this._attribHTML=s,t.length?(this._innerContainer.innerHTML=s,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class ns{constructor(t={}){this.options=t,a.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=j.create("div","maplibregl-ctrl mapboxgl-ctrl");const n=j.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){j.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&n.classList.add("maplibregl-compact","mapboxgl-compact"):n.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class sl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,s=n?this._queue.concat(n):this._queue;for(const u of s)if(u.id===t)return void(u.cancelled=!0)}run(t=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const s of n)if(!s.cancelled&&(s.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const ll={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},sc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},kr={showCompass:!0,showZoom:!0,visualizePitch:!1};class la{constructor(t,n,s=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new $e({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,s&&(this.mousePitch=new Ka({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),j.addEventListener(n,"mousedown",this.mousedown),j.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),j.addEventListener(n,"touchmove",this.touchmove),j.addEventListener(n,"touchend",this.touchend),j.addEventListener(n,"touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),j.disableDrag()}move(t,n){const s=this.map,u=this.mouseRotate.mousemoveWindow(t,n);if(u&&u.bearingDelta&&s.setBearing(s.getBearing()+u.bearingDelta),this.mousePitch){const d=this.mousePitch.mousemoveWindow(t,n);d&&d.pitchDelta&&s.setPitch(s.getPitch()+d.pitchDelta)}}off(){const t=this.element;j.removeEventListener(t,"mousedown",this.mousedown),j.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),j.removeEventListener(t,"touchmove",this.touchmove),j.removeEventListener(t,"touchend",this.touchend),j.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){j.enableDrag(),j.removeEventListener(window,"mousemove",this.mousemove),j.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(a.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),j.mousePos(this.element,t)),j.addEventListener(window,"mousemove",this.mousemove),j.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,j.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=j.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=j.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ze(c,t,n){if(c=new a.LngLat(c.lng,c.lat),t){const s=new a.LngLat(c.lng-360,c.lat),u=new a.LngLat(c.lng+360,c.lat),d=n.locationPoint(c).distSqr(t);n.locationPoint(s).distSqr(t)<d?c=s:n.locationPoint(u).distSqr(t)<d&&(c=u)}for(;Math.abs(c.lng-n.center.lng)>180;){const s=n.locationPoint(c);if(s.x>=0&&s.y>=0&&s.x<=n.width&&s.y<=n.height)break;c.lng>n.center.lng?c.lng-=360:c.lng+=360}return c}const Qe={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function wo(c,t,n){const s=c.classList;for(const u in Qe)s.remove(`maplibregl-${n}-anchor-${u}`,`mapboxgl-${n}-anchor-${u}`);s.add(`maplibregl-${n}-anchor-${t}`,`mapboxgl-${n}-anchor-${t}`)}class Ao extends a.Evented{constructor(t,n){if(super(),(t instanceof HTMLElement||n)&&(t=a.extend({element:t},n)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=a.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=j.create("div"),this._element.setAttribute("aria-label","Map marker");const s=j.createNS("http://www.w3.org/2000/svg","svg"),u=41,d=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${u}px`),s.setAttributeNS(null,"width",`${d}px`),s.setAttributeNS(null,"viewBox",`0 0 ${d} ${u}`);const g=j.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const x=j.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const v=j.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"transform","translate(3.0, 29.0)"),v.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ae of S){const re=j.createNS("http://www.w3.org/2000/svg","ellipse");re.setAttributeNS(null,"opacity","0.04"),re.setAttributeNS(null,"cx","10.5"),re.setAttributeNS(null,"cy","5.80029008"),re.setAttributeNS(null,"rx",ae.rx),re.setAttributeNS(null,"ry",ae.ry),v.appendChild(re)}const C=j.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const L=j.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(L);const O=j.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const H=j.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(H);const V=j.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(6.0, 7.0)"),V.setAttributeNS(null,"fill","#FFFFFF");const Z=j.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const te=j.createNS("http://www.w3.org/2000/svg","circle");te.setAttributeNS(null,"fill","#000000"),te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"cx","5.5"),te.setAttributeNS(null,"cy","5.5"),te.setAttributeNS(null,"r","5.4999962");const ie=j.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#FFFFFF"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962"),Z.appendChild(te),Z.appendChild(ie),x.appendChild(v),x.appendChild(C),x.appendChild(O),x.appendChild(V),x.appendChild(Z),s.appendChild(x),s.setAttributeNS(null,"height",u*this._scale+"px"),s.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(s),this._offset=a.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),wo(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),j.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const u=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const n=t.code,s=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&s!==32&&s!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,s=this._element;this._popup&&(n===s||s.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Ze(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let n="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?n=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(n=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let s="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?s="rotateX(0deg)":this._pitchAlignment==="map"&&(s=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),j.setTransform(this._element,`${Qe[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${s} ${n}`)}getOffset(){return this._offset}setOffset(t){return this._offset=a.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const n=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const os={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let hi,wn=0,Vi=!1;const lc={maxWidth:100,unit:"metric"};function Eo(c,t,n){const s=n&&n.maxWidth||100,u=c._container.clientHeight/2,d=c.unproject([0,u]),g=c.unproject([s,u]),x=d.distanceTo(g);if(n&&n.unit==="imperial"){const v=3.2808*x;v>5280?$t(t,s,v/5280,c._getUIString("ScaleControl.Miles")):$t(t,s,v,c._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?$t(t,s,x/1852,c._getUIString("ScaleControl.NauticalMiles")):x>=1e3?$t(t,s,x/1e3,c._getUIString("ScaleControl.Kilometers")):$t(t,s,x,c._getUIString("ScaleControl.Meters"))}function $t(c,t,n,s){const u=function(d){const g=Math.pow(10,`${Math.floor(d)}`.length-1);let x=d/g;return x=x>=10?10:x>=5?5:x>=3?3:x>=2?2:x>=1?1:function(v){const S=Math.pow(10,Math.ceil(-Math.log(v)/Math.LN10));return Math.round(v*S)/S}(x),g*x}(n);c.style.width=t*(u/n)+"px",c.innerHTML=`${u}&nbsp;${s}`}const pi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},cl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Hn(c){if(c){if(typeof c=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(c,2)));return{center:new a.pointGeometry(0,0),top:new a.pointGeometry(0,c),"top-left":new a.pointGeometry(t,t),"top-right":new a.pointGeometry(-t,t),bottom:new a.pointGeometry(0,-c),"bottom-left":new a.pointGeometry(t,-t),"bottom-right":new a.pointGeometry(-t,-t),left:new a.pointGeometry(c,0),right:new a.pointGeometry(-c,0)}}if(c instanceof a.pointGeometry||Array.isArray(c)){const t=a.pointGeometry.convert(c);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:a.pointGeometry.convert(c.center||[0,0]),top:a.pointGeometry.convert(c.top||[0,0]),"top-left":a.pointGeometry.convert(c["top-left"]||[0,0]),"top-right":a.pointGeometry.convert(c["top-right"]||[0,0]),bottom:a.pointGeometry.convert(c.bottom||[0,0]),"bottom-left":a.pointGeometry.convert(c["bottom-left"]||[0,0]),"bottom-right":a.pointGeometry.convert(c["bottom-right"]||[0,0]),left:a.pointGeometry.convert(c.left||[0,0]),right:a.pointGeometry.convert(c.right||[0,0])}}return Hn(new a.pointGeometry(0,0))}const So={supported:U,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends aa{constructor(c){var t;if(a.PerformanceUtils.mark(a.PerformanceMarkers.create),(c=a.extend({},sc,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new fo(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),{bearingSnap:c.bearingSnap}),this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._renderTaskQueue=new sl,this._controls=[],this._mapId=a.uniqueId(),this._locale=a.extend({},ll,c.locale),this._clickTolerance=c.clickTolerance,this._pixelRatio=(t=c.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new se(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),typeof window!="undefined"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new or(this,c),this._hash=c.hash&&new Ys(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,a.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new sa({customAttribution:c.customAttribution})),c.maplibreLogo&&this.addControl(new ns,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new a.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new a.Event(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new a.Event("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=c.onAdd(this);this._controls.push(c);const s=this._controlPositions[t];return t.indexOf("bottom")!==-1?s.insertBefore(n,s.firstChild):s.appendChild(n),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}resize(c){const t=this._containerDimensions(),n=t[0],s=t[1];this._resizeCanvas(n,s,this.getPixelRatio()),this.transform.resize(n,s),this.painter.resize(n,s,this.getPixelRatio());const u=!this._moving;return u&&(this.stop(),this.fire(new a.Event("movestart",c)).fire(new a.Event("move",c))),this.fire(new a.Event("resize",c)),u&&this.fire(new a.Event("moveend",c)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(c){const[t,n]=this._containerDimensions();this._pixelRatio=c,this._resizeCanvas(t,n,c),this.painter.resize(t,n,c)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(c){return this.transform.setMaxBounds(a.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c==null?-2:c)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c&&this.setZoom(c),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c==null?22:c)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c&&this.setZoom(c),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c==null?0:c)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c&&this.setPitch(c),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c==null?60:c)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c&&this.setPitch(c),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}project(c){return this.transform.locationPoint(a.LngLat.convert(c))}unproject(c){return this.transform.pointLocation(a.pointGeometry.convert(c))}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(c,t,n){if(c==="mouseenter"||c==="mouseover"){let s=!1;return{layer:t,listener:n,delegates:{mousemove:d=>{const g=this.getLayer(t)?this.queryRenderedFeatures(d.point,{layers:[t]}):[];g.length?s||(s=!0,n.call(this,new Xi(c,this,d.originalEvent,{features:g}))):s=!1},mouseout:()=>{s=!1}}}}if(c==="mouseleave"||c==="mouseout"){let s=!1;return{layer:t,listener:n,delegates:{mousemove:g=>{(this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[]).length?s=!0:s&&(s=!1,n.call(this,new Xi(c,this,g.originalEvent)))},mouseout:g=>{s&&(s=!1,n.call(this,new Xi(c,this,g.originalEvent)))}}}}{const s=u=>{const d=this.getLayer(t)?this.queryRenderedFeatures(u.point,{layers:[t]}):[];d.length&&(u.features=d,n.call(this,u),delete u.features)};return{layer:t,listener:n,delegates:{[c]:s}}}}on(c,t,n){if(n===void 0)return super.on(c,t);const s=this._createDelegatedListener(c,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(s);for(const u in s.delegates)this.on(u,s.delegates[u]);return this}once(c,t,n){if(n===void 0)return super.once(c,t);const s=this._createDelegatedListener(c,t,n);for(const u in s.delegates)this.once(u,s.delegates[u]);return this}off(c,t,n){return n===void 0?super.off(c,t):(this._delegatedListeners&&this._delegatedListeners[c]&&(s=>{const u=this._delegatedListeners[c];for(let d=0;d<u.length;d++){const g=u[d];if(g.layer===t&&g.listener===n){for(const x in g.delegates)this.off(x,g.delegates[x]);return u.splice(d,1),this}}})(),this)}queryRenderedFeatures(c,t){if(!this.style)return[];let n;if(t!==void 0||c===void 0||c instanceof a.pointGeometry||Array.isArray(c)||(t=c,c=void 0),t=t||{},(c=c||[[0,0],[this.transform.width,this.transform.height]])instanceof a.pointGeometry||typeof c[0]=="number")n=[a.pointGeometry.convert(c)];else{const s=a.pointGeometry.convert(c[0]),u=a.pointGeometry.convert(c[1]);n=[s,new a.pointGeometry(u.x,s.y),u,new a.pointGeometry(s.x,u.y),s]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(c,t){return this.style.querySourceFeatures(c,t)}setStyle(c,t){return(t=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&c?(this._diffStyle(c,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(c,t))}setTransformRequest(c){return this._requestManager.setTransformRequest(c),this}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),c?(this.style=new xi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,t){if(typeof c=="string"){const n=this._requestManager.transformRequest(c,a.ResourceType.Style);a.getJSON(n,(s,u)=>{s?this.fire(new a.ErrorEvent(s)):u&&this._updateDiff(u,t)})}else typeof c=="object"&&this._updateDiff(c,t)}_updateDiff(c,t){try{this.style.setState(c)&&this._update(!0)}catch(n){a.warnOnce(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(c,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")}addSource(c,t){return this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)}isSourceLoaded(c){const t=this.style&&this.style.sourceCaches[c];if(t!==void 0)return t.loaded();this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${c}'`)))}areTilesLoaded(){const c=this.style&&this.style.sourceCaches;for(const t in c){const n=c[t]._tiles;for(const s in n){const u=n[s];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}addSourceType(c,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(c,t,n)}removeSource(c){return this.style.removeSource(c),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,t,{pixelRatio:n=1,sdf:s=!1,stretchX:u,stretchY:d,content:g}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||a.isImageBitmap(t)){const{width:x,height:v,data:S}=a.exported.getImageData(t);this.style.addImage(c,{data:new a.RGBAImage({width:x,height:v},S),pixelRatio:n,stretchX:u,stretchY:d,content:g,sdf:s,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:x,height:v,data:S}=t,C=t;this.style.addImage(c,{data:new a.RGBAImage({width:x,height:v},new Uint8Array(S)),pixelRatio:n,stretchX:u,stretchY:d,content:g,sdf:s,version:0,userImage:C}),C.onAdd&&C.onAdd(this,c)}}}updateImage(c,t){const n=this.style.getImage(c);if(!n)return this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const s=t instanceof HTMLImageElement||a.isImageBitmap(t)?a.exported.getImageData(t):t,{width:u,height:d,data:g}=s;if(u===void 0||d===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==n.data.width||d!==n.data.height)return this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const x=!(t instanceof HTMLImageElement||a.isImageBitmap(t));n.data.replace(g,x),this.style.updateImage(c,n)}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,t){a.getImage(this._requestManager.transformRequest(c,a.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(c,t){return this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)}moveLayer(c,t){return this.style.moveLayer(c,t),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,t,n){return this.style.setLayerZoomRange(c,t,n),this._update(!0)}setFilter(c,t,n={}){return this.style.setFilter(c,t,n),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,t,n,s={}){return this.style.setPaintProperty(c,t,n,s),this._update(!0)}getPaintProperty(c,t){return this.style.getPaintProperty(c,t)}setLayoutProperty(c,t,n,s={}){return this.style.setLayoutProperty(c,t,n,s),this._update(!0)}getLayoutProperty(c,t){return this.style.getLayoutProperty(c,t)}setLight(c,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(c,t){return this.style.setFeatureState(c,t),this._update()}removeFeatureState(c,t){return this.style.removeFeatureState(c,t),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let c=0,t=0;return this._container&&(c=this._container.clientWidth||400,t=this._container.clientHeight||300),[c,t]}_setupContainer(){const c=this._container;c.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=j.create("div","maplibregl-canvas-container mapboxgl-canvas-container",c);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=j.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions();this._resizeCanvas(n[0],n[1],this.getPixelRatio());const s=this._controlContainer=j.create("div","maplibregl-control-container mapboxgl-control-container",c),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(d=>{u[d]=j.create("div",`maplibregl-ctrl-${d} mapboxgl-ctrl-${d}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t,n){this._canvas.width=n*c,this._canvas.height=n*t,this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const c=a.extend({},U.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);t?(this.painter=new Xa(t,this.transform),a.exported$1.testSupport(t)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_render(c){let t,n=0;const s=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=s.createQueryEXT(),s.beginQueryEXT(s.TIME_ELAPSED_EXT,t),n=a.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,x=a.exported.now();this.style.zoomHistory.update(g,x);const v=new a.EvaluationParameters(g,{now:x,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=v.crossFadingFactor();S===1&&S===this._crossFadingFactor||(u=!0,this._crossFadingFactor=S),this.style.update(v)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.load),this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const g=a.exported.now()-n;s.endQueryEXT(s.TIME_ELAPSED_EXT,t),setTimeout(()=>{const x=s.getQueryObjectEXT(t,s.QUERY_RESULT_EXT)/1e6;s.deleteQueryEXT(t),this.fire(new a.Event("gpu-timing-frame",{cpuTime:g,gpuTime:x}))},50)}if(this.listens("gpu-timing-layer")){const g=this.painter.collectGpuTimers();setTimeout(()=>{const x=this.painter.queryGpuTimers(g);this.fire(new a.Event("gpu-timing-layer",{layerTimes:x}))},50)}const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.Event("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window!="undefined"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),j.remove(this._canvasContainer),j.remove(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),a.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.exported.frame(c=>{a.PerformanceUtils.frame(c),this._frame=null,this._render(c)}))}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}_setCacheLimits(c,t){a.setCacheLimits(c,t)}},NavigationControl:class{constructor(c){this.options=a.extend({},kr,c),this._container=j.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),j.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),j.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=j.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map.getZoom(),t=c===this._map.getMaxZoom(),n=c===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=c}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new la(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){j.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(c,t){const n=j.create("button",c,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(c,t){const n=this._map._getUIString(`NavigationControl.${t}`);c.title=n,c.setAttribute("aria-label",n)}},GeolocateControl:class extends a.Evented{constructor(c){super(),this.options=a.extend({},os,c),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(c){var t;return this._map=c,this._container=j.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,hi!==void 0?t(hi):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(n=>{hi=n.state!=="denied",t(hi)}):(hi=!!window.navigator.geolocation,t(hi)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),j.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,wn=0,Vi=!1}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),n=c.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",c)),this._finish()}}_updateCamera(c){const t=new a.LngLat(c.coords.longitude,c.coords.latitude),n=c.coords.accuracy,s=this._map.getBearing(),u=a.extend({bearing:s},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),u,{geolocateSource:!0})}_updateMarker(c){if(c){const t=new a.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map._container.clientHeight/2,t=this._map.unproject([0,c]),n=this._map.unproject([1,c]),s=t.distanceTo(n),u=Math.ceil(2*this._accuracy/s);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Vi)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=j.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),j.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=j.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ao(this._dotElement),this._circleElement=j.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ao({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":wn--,Vi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),wn++,wn>1?(c={maximumAge:6e5,timeout:0},Vi=!0):(c=this.options.positionOptions,Vi=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:sa,LogoControl:ns,ScaleControl:class{constructor(c){this.options=a.extend({},lc,c),a.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Eo(this._map,this._container,this.options)}onAdd(c){return this._map=c,this._container=j.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){j.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(c){this.options.unit=c,Eo(this._map,this._container,this.options)}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=j.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){j.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=j.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);j.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(c){super(),this.options=a.extend(Object.create(pi),c),a.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&j.remove(this._content),this._container&&(j.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=a.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const t=document.createDocumentFragment(),n=document.createElement("body");let s;for(n.innerHTML=c;s=n.firstChild,s;)t.appendChild(s);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=j.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(c){this._container&&this._container.classList.add(c)}removeClassName(c){this._container&&this._container.classList.remove(c)}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){if(this._container)return this._container.classList.toggle(c)}_createCloseButton(){this.options.closeButton&&(this._closeButton=j.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(c){this._update(c.point)}_onMouseMove(c){this._update(c.point)}_onDrag(c){this._update(c.point)}_update(c){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=j.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=j.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(d=>this._container.classList.add(d)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ze(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!c))return;const t=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat);let n=this.options.anchor;const s=Hn(this.options.offset);if(!n){const d=this._container.offsetWidth,g=this._container.offsetHeight;let x;x=t.y+s.bottom.y<g?["top"]:t.y>this._map.transform.height-g?["bottom"]:[],t.x<d/2?x.push("left"):t.x>this._map.transform.width-d/2&&x.push("right"),n=x.length===0?"bottom":x.join("-")}const u=t.add(s[n]).round();j.setTransform(this._container,`${Qe[n]} translate(${u.x}px,${u.y}px)`),wo(this._container,n,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(cl);c&&c.focus()}_onClose(){this.remove()}},Marker:Ao,Style:xi,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,Evented:a.Evented,AJAXError:a.AJAXError,config:a.config,CanvasSource:sn,GeoJSONSource:on,ImageSource:Ur,RasterDEMTileSource:pr,RasterTileSource:Yr,VectorTileSource:Wt,VideoSource:Jr,prewarm:function(){zr().acquire(ln)},clearPrewarmedResources:function(){const c=jr;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(ln),jr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get workerCount(){return Ir.workerCount},set workerCount(c){Ir.workerCount=c},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){a.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){a.clearTileCache(c)},workerUrl:"",addProtocol(c,t){a.config.REGISTERED_PROTOCOLS[c]=t},removeProtocol(c){delete a.config.REGISTERED_PROTOCOLS[c]}};return jt.extend(So,{isSafari:a.isSafari,getPerformanceMetrics:a.PerformanceUtils.getPerformanceMetrics}),So});var P=D;return P})})(Ep);var Fr=Ep.exports;var Or="/maplibre-gl-directions/assets/style.7d708b4d.json",Wm=Object.defineProperty,Kh=Object.getOwnPropertySymbols,Xm=Object.prototype.hasOwnProperty,Ym=Object.prototype.propertyIsEnumerable,Qc=(b,m,_)=>m in b?Wm(b,m,{enumerable:!0,configurable:!0,writable:!0,value:_}):b[m]=_,Ss=(b,m)=>{for(var _ in m||(m={}))Xm.call(m,_)&&Qc(b,_,m[_]);if(Kh)for(var _ of Kh(m))Ym.call(m,_)&&Qc(b,_,m[_]);return b},St=(b,m,_)=>(Qc(b,typeof m!="symbol"?m+"":m,_),_);class Km{constructor(m){St(this,"map"),St(this,"listeners",{}),St(this,"oneTimeListeners",{}),this.map=m}fire(m){var _,k;m.target=this.map,(_=this.listeners[m.type])==null||_.forEach(D=>D(m)),(k=this.oneTimeListeners[m.type])==null||k.forEach(D=>{var E,P;D(m);const a=(E=this.oneTimeListeners[m.type])==null?void 0:E.indexOf(D);a&&~a&&((P=this.oneTimeListeners[m.type])==null||P.splice(a,1))})}on(m,_){var k;(this.listeners[m]=(k=this.listeners[m])!=null?k:[]).push(_)}off(m,_){var k,D;const E=(k=this.listeners[m])==null?void 0:k.indexOf(_);E&&~E&&((D=this.listeners[m])==null||D.splice(E,1))}once(m,_){var k;(this.oneTimeListeners[m]=(k=this.oneTimeListeners[m])!=null?k:[]).push(_)}}class Is{constructor(m,_,k){St(this,"type"),St(this,"target"),St(this,"originalEvent"),St(this,"data"),this.type=m,this.originalEvent=_,this.data=k}}class Jh{constructor(m,_,k){St(this,"type"),St(this,"target"),St(this,"originalEvent"),St(this,"data"),this.type=m,this.originalEvent=_,this.data=k}}const Jm={api:"https://router.project-osrm.org/route/v1",profile:"driving",requestOptions:{},requestTimeout:null,makePostRequest:!1,sourceName:"maplibre-gl-directions",pointsScalingFactor:1,linesScalingFactor:1,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint","maplibre-gl-directions-waypoint-casing"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint","maplibre-gl-directions-snappoint-casing"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline","maplibre-gl-directions-routeline-casing"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline","maplibre-gl-directions-alt-routeline-casing"],dragThreshold:10};function $l(b=1,m=1,_="maplibre-gl-directions"){return[{id:`${_}-snapline`,type:"line",source:_,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":"#34343f","line-opacity":.65,"line-width":3},filter:["==",["get","type"],"SNAPLINE"]},{id:`${_}-alt-routeline-casing`,type:"line",source:_,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#9e91be","line-opacity":.55,"line-width":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],10*m,7*m],5,["case",["boolean",["get","highlight"],!1],10*m,7*m],18,["case",["boolean",["get","highlight"],!1],32*m,23*m]]},filter:["==",["get","route"],"ALT"]},{id:`${_}-alt-routeline`,type:"line",source:_,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#9e91be","line-opacity":.85,"line-width":["interpolate",["exponential",1.5],["zoom"],0,3*m,5,3*m,18,10*m]},filter:["==",["get","route"],"ALT"]},{id:`${_}-routeline-casing`,type:"line",source:_,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":["interpolate-hcl",["linear"],["get","congestion"],0,"#7b51f8",1,"#42c74c",100,"#d72359"],"line-opacity":.55,"line-width":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],10*m,7*m],5,["case",["boolean",["get","highlight"],!1],10*m,7*m],18,["case",["boolean",["get","highlight"],!1],32*m,23*m]]},filter:["==",["get","route"],"SELECTED"]},{id:`${_}-routeline`,type:"line",source:_,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":["interpolate-hcl",["linear"],["get","congestion"],0,"#7b51f8",1,"#42c74c",100,"#d72359"],"line-opacity":.85,"line-width":["interpolate",["exponential",1.5],["zoom"],0,3*m,5,3*m,18,10*m]},filter:["==",["get","route"],"SELECTED"]},{id:`${_}-hoverpoint-casing`,type:"circle",source:_,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,14*b,5,14*b,18,33*b],"circle-color":"#30a856","circle-opacity":.65},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${_}-hoverpoint`,type:"circle",source:_,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,9*b,5,9*b,18,21*b],"circle-color":"#30a856"},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${_}-snappoint-casing`,type:"circle",source:_,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],14*b,12*b],5,["case",["boolean",["get","highlight"],!1],14*b,12*b],18,["case",["boolean",["get","highlight"],!1],33*b,28*b]],"circle-color":["case",["boolean",["get","highlight"],!1],"#e50d3f","#cb3373"],"circle-opacity":.65},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${_}-snappoint`,type:"circle",source:_,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],9*b,7*b],5,["case",["boolean",["get","highlight"],!1],9*b,7*b],18,["case",["boolean",["get","highlight"],!1],21*b,16*b]],"circle-color":["case",["boolean",["get","highlight"],!1],"#e50d3f","#cb3373"]},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${_}-waypoint-casing`,type:"circle",source:_,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],14*b,12*b],5,["case",["boolean",["get","highlight"],!1],14*b,12*b],18,["case",["boolean",["get","highlight"],!1],33*b,28*b]],"circle-color":["case",["boolean",["get","highlight"],!1],"#6d26d7","#7b33e7"],"circle-opacity":.65},filter:["==",["get","type"],"WAYPOINT"]},{id:`${_}-waypoint`,type:"circle",source:_,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],9*b,7*b],5,["case",["boolean",["get","highlight"],!1],9*b,7*b],18,["case",["boolean",["get","highlight"],!1],21*b,16*b]],"circle-color":["case",["boolean",["get","highlight"],!1],"#6d26d7","#7b33e7"]},filter:["==",["get","type"],"WAYPOINT"]}]}let Ip=(b=21)=>crypto.getRandomValues(new Uint8Array(b)).reduce((m,_)=>(_&=63,_<36?m+=_.toString(36):_<62?m+=(_-26).toString(36).toUpperCase():_>62?m+="-":m+="_",m),"");var eu={exports:{}};(function(b){var m={};function _(E){return Math.floor(Math.abs(E)+.5)*(E>=0?1:-1)}function k(E,P,a){E=_(E*a),P=_(P*a);var U=E-P;U<<=1,E-P<0&&(U=~U);for(var G="";U>=32;)G+=String.fromCharCode((32|U&31)+63),U>>=5;return G+=String.fromCharCode(U+63),G}m.decode=function(E,P){for(var a=0,U=0,G=0,ne=[],W=0,j=0,se=null,de,Ce,je=Math.pow(10,Number.isInteger(P)?P:5);a<E.length;){se=null,W=0,j=0;do se=E.charCodeAt(a++)-63,j|=(se&31)<<W,W+=5;while(se>=32);de=j&1?~(j>>1):j>>1,W=j=0;do se=E.charCodeAt(a++)-63,j|=(se&31)<<W,W+=5;while(se>=32);Ce=j&1?~(j>>1):j>>1,U+=de,G+=Ce,ne.push([U/je,G/je])}return ne},m.encode=function(E,P){if(!E.length)return"";for(var a=Math.pow(10,Number.isInteger(P)?P:5),U=k(E[0][0],0,a)+k(E[0][1],0,a),G=1;G<E.length;G++){var ne=E[G],W=E[G-1];U+=k(ne[0],W[0],a),U+=k(ne[1],W[1],a)}return U};function D(E){for(var P=[],a=0;a<E.length;a++){var U=E[a].slice();P.push([U[1],U[0]])}return P}m.fromGeoJSON=function(E,P){if(E&&E.type==="Feature"&&(E=E.geometry),!E||E.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return m.encode(D(E.coordinates),P)},m.toGeoJSON=function(E,P){var a=m.decode(E,P);return{type:"LineString",coordinates:D(a)}},b.exports&&(b.exports=m)})(eu);function Qm(b,m){return b.geometries==="geojson"?m.coordinates:b.geometries==="polyline6"?eu.exports.decode(m,6).map(_=>_.reverse()):eu.exports.decode(m,5).map(_=>_.reverse())}function ef(b,m,_){var k,D,E,P,a,U;if((k=b.annotations)!=null&&k.includes("congestion_numeric"))return(E=(D=m==null?void 0:m.congestion_numeric)==null?void 0:D[_])!=null?E:0;if((P=b.annotations)!=null&&P.includes("congestion"))switch((U=(a=m==null?void 0:m.congestion)==null?void 0:a[_])!=null?U:""){case"unknown":return 0;case"low":return 1;case"moderate":return 34;case"heavy":return 77;case"severe":return 100;default:return 0}else return 0}function tf(b,m,_){return!b.geometries||b.geometries==="polyline"?Math.abs(m[0]-_[0])<=1e-5&&Math.abs(m[1]-_[1])<=1e-5:m[0]===_[0]&&m[1]===_[1]}function zp(b){const m=$l(b==null?void 0:b.pointsScalingFactor,b==null?void 0:b.linesScalingFactor,b==null?void 0:b.sourceName);return Object.assign({},Jm,{layers:m},b)}function Tp(b,m){const _=b.makePostRequest?"post":"get";let k,D;if(_==="get")k=`${b.api}/${b.profile}/${m.join(";")}`,D=new URLSearchParams(b.requestOptions);else{k=`${b.api}/${b.profile}${b.requestOptions.access_token?`?access_token=${b.requestOptions.access_token}`:""}`;const E=new FormData;Object.entries(b.requestOptions).forEach(([P,a])=>{P!=="access_token"&&E.set(P,a)}),E.set("coordinates",m.join(";")),D=new URLSearchParams(E)}return{method:_,url:k,payload:D}}function kp(b,m,_){return{type:"Feature",geometry:{type:"Point",coordinates:b},properties:Ss({type:m,id:Ip()},_!=null?_:{})}}function Cp(b,m,_,k,D=!1){if(b.length!==m.length)return[];const E=b.map((P,a)=>({type:"Feature",geometry:{type:"LineString",coordinates:[[P[0],P[1]],[m[a][0],m[a][1]]]},properties:{type:"SNAPLINE"}}));return~k&&_!==void 0&&D&&(E.push({type:"Feature",geometry:{type:"LineString",coordinates:[[_[0],_[1]],[m[k][0],m[k][1]]]},properties:{type:"SNAPLINE"}}),E.push({type:"Feature",geometry:{type:"LineString",coordinates:[[_[0],_[1]],[m[k+1][0],m[k+1][1]]]},properties:{type:"SNAPLINE"}})),E}function Mp(b,m,_,k){return m.map((D,E)=>{const P=Qm(b,D.geometry),U=k.map(j=>j.geometry.coordinates).map(j=>P.findIndex(se=>tf(b,se,j))).slice(1);let G=0;const ne=U.map(j=>P.slice(G,G=j+1)),W=[];return ne.forEach((j,se)=>{const de=Ip();j.forEach((Ce,je)=>{var nt,Ct,mt,ot,Ke;const Ie=W[W.length-1],rt=ef(b,(nt=D.legs[se])==null?void 0:nt.annotation,je);if(se===((Ct=Ie==null?void 0:Ie.properties)==null?void 0:Ct.legIndex)&&((mt=Ie.properties)==null?void 0:mt.congestion)===rt)Ie.geometry.coordinates.push(Ce);else{const At=(ot=k[se].properties)!=null?ot:{},Ht=(Ke=k[se+1].properties)!=null?Ke:{},Zi={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{id:de,routeIndex:E,route:E===_?"SELECTED":"ALT",legIndex:se,congestion:rt,departSnappointProperties:At,arriveSnappointProperties:Ht}};Ie&&Zi.geometry.coordinates.push(Ie.geometry.coordinates[Ie.geometry.coordinates.length-1]),Zi.geometry.coordinates.push(Ce),W.push(Zi)}})}),W})}var rf=Object.freeze(Object.defineProperty({__proto__:null,buildConfiguration:zp,buildRequest:Tp,buildPoint:kp,buildSnaplines:Cp,buildRoutelines:Mp},Symbol.toStringTag,{value:"Module"}));class Vr extends Km{constructor(m,_){super(m),St(this,"configuration"),St(this,"_interactive",!1),St(this,"buildRequest",Tp),St(this,"buildPoint",kp),St(this,"buildSnaplines",Cp),St(this,"buildRoutelines",Mp),St(this,"onMoveHandler"),St(this,"onDragDownHandler"),St(this,"onDragMoveHandler"),St(this,"onDragUpHandler"),St(this,"onClickHandler"),St(this,"_waypoints",[]),St(this,"snappoints",[]),St(this,"routelines",[]),St(this,"selectedRouteIndex",0),St(this,"hoverpoint"),St(this,"highlightedWaypoints",[]),St(this,"highlightedSnappoints",[]),St(this,"dragDownPosition",{x:0,y:0}),St(this,"waypointBeingDragged"),St(this,"waypointBeingDraggedInitialCoordinates"),St(this,"departSnappointIndex",-1),St(this,"abortController"),this.map=m,this.configuration=zp(_),this.onMoveHandler=this.onMove.bind(this),this.onDragDownHandler=this.onDragDown.bind(this),this.onDragMoveHandler=this.onDragMove.bind(this),this.onDragUpHandler=this.onDragUp.bind(this),this.onClickHandler=this.onClick.bind(this),this.init()}get waypointsCoordinates(){return this._waypoints.map(m=>[m.geometry.coordinates[0],m.geometry.coordinates[1]])}get snappointsCoordinates(){return this.snappoints.map(m=>[m.geometry.coordinates[0],m.geometry.coordinates[1]])}get snaplines(){var m,_,k;return this.buildSnaplines(this.waypointsCoordinates,this.snappointsCoordinates,(m=this.hoverpoint)==null?void 0:m.geometry.coordinates,this.departSnappointIndex,(k=(_=this.hoverpoint)==null?void 0:_.properties)==null?void 0:k.showSnaplines)}init(){this.map.addSource(this.configuration.sourceName,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.configuration.layers.forEach(m=>{this.map.addLayer(m)})}async fetchDirections(m){var _;const k=this.interactive;if(this._waypoints.length>=2){this.fire(new Jh("fetchroutesstart",m)),this.interactive=!1,this.abortController=new AbortController;let D;this.configuration.requestTimeout!==null&&(D=setTimeout(()=>{var G;return(G=this.abortController)==null?void 0:G.abort()},this.configuration.requestTimeout));const{method:E,url:P,payload:a}=this.buildRequest(this.configuration,this.waypointsCoordinates);let U;try{if(E==="get"?U=await(await fetch(`${P}?${a}`,{signal:this.abortController.signal})).json():U=await(await fetch(`${P}`,{signal:this.abortController.signal,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a})).json(),U.code!=="Ok")throw new Error((_=U.message)!=null?_:"An unexpected error occurred.")}finally{this.interactive=k,this.abortController=void 0,clearTimeout(D),this.fire(new Jh("fetchroutesend",m,U))}this.snappoints=U.waypoints.map((G,ne)=>{var W;return this.buildPoint(G.location,"SNAPPOINT",{waypointProperties:(W=this._waypoints[ne].properties)!=null?W:{}})}),this.routelines=this.buildRoutelines(this.configuration.requestOptions,U.routes,this.selectedRouteIndex,this.snappoints),U.routes.length<=this.selectedRouteIndex&&(this.selectedRouteIndex=0)}else this.snappoints=[],this.routelines=[];this.draw(!1)}draw(m=!0){const _=[...this._waypoints,...this.snappoints,...this.snaplines,...this.routelines.reduce((D,E)=>m?D.concat(...E):D.concat(...E.map(P=>(P.properties&&(P.properties.route=P.properties.routeIndex===this.selectedRouteIndex?"SELECTED":"ALT"),P))),[])];this.hoverpoint&&_.push(this.hoverpoint);const k={type:"FeatureCollection",features:_};this.map.getSource(this.configuration.sourceName)&&this.map.getSource(this.configuration.sourceName).setData(k)}deHighlight(){this.highlightedWaypoints.forEach(m=>{m!=null&&m.properties&&(m.properties.highlight=!1)}),this.highlightedSnappoints.forEach(m=>{m!=null&&m.properties&&(m.properties.highlight=!1)}),this.routelines.forEach(m=>{m.forEach(_=>{_.properties&&(_.properties.highlight=!1)})})}onMove(m){var _,k,D,E,P,a,U,G,ne,W;const j=this.map.queryRenderedFeatures(m.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveRoutelineLayers,...this.configuration.sensitiveAltRoutelineLayers]})[0];if(this.deHighlight(),this.configuration.sensitiveWaypointLayers.includes((_=j==null?void 0:j.layer.id)!=null?_:"")){this.map.getCanvas().style.cursor="pointer",this.map.dragPan.disable();const se=this._waypoints.findIndex(de=>{var Ce,je;return((Ce=de.properties)==null?void 0:Ce.id)===((je=j==null?void 0:j.properties)==null?void 0:je.id)});this.highlightedWaypoints=[this._waypoints[se]],this.highlightedSnappoints=[this.snappoints[se]],(k=this.highlightedWaypoints[0])!=null&&k.properties&&(this.highlightedWaypoints[0].properties.highlight=!0),(D=this.highlightedSnappoints[0])!=null&&D.properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else if(this.configuration.sensitiveSnappointLayers.includes((E=j==null?void 0:j.layer.id)!=null?E:"")){this.map.getCanvas().style.cursor="pointer";const se=this.snappoints.findIndex(de=>{var Ce,je;return((Ce=de.properties)==null?void 0:Ce.id)===((je=j==null?void 0:j.properties)==null?void 0:je.id)});this.highlightedSnappoints=[this.snappoints[se]],this.highlightedWaypoints=[this._waypoints[se]],this.highlightedSnappoints[0].properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.highlightedWaypoints[0].properties&&(this.highlightedWaypoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else this.configuration.sensitiveRoutelineLayers.includes((P=j==null?void 0:j.layer.id)!=null?P:"")?(this.map.getCanvas().style.cursor="pointer",this.map.dragPan.disable(),this.hoverpoint?this.hoverpoint.geometry.coordinates=[m.lngLat.lng,m.lngLat.lat]:this.hoverpoint=this.buildPoint([m.lngLat.lng,m.lngLat.lat],"HOVERPOINT",{departSnappointProperties:Ss({},JSON.parse((U=(a=j==null?void 0:j.properties)==null?void 0:a.departSnappointProperties)!=null?U:"{}")),arriveSnappointProperties:Ss({},JSON.parse((ne=(G=j==null?void 0:j.properties)==null?void 0:G.arriveSnappointProperties)!=null?ne:"{}"))}),this.routelines.forEach(se=>{se.forEach(de=>{var Ce,je;de.properties&&((Ce=de.properties)==null?void 0:Ce.id)===((je=j==null?void 0:j.properties)==null?void 0:je.id)&&(de.properties.highlight=!0)})})):this.configuration.sensitiveAltRoutelineLayers.includes((W=j==null?void 0:j.layer.id)!=null?W:"")?(this.map.getCanvas().style.cursor="pointer",this.routelines.forEach(se=>{se.forEach(de=>{var Ce,je;de.properties&&((Ce=de.properties)==null?void 0:Ce.id)===((je=j==null?void 0:j.properties)==null?void 0:je.id)&&(de.properties.highlight=!0)})}),this.hoverpoint&&(this.hoverpoint=void 0)):(this.map.dragPan.enable(),this.map.getCanvas().style.cursor="",this.hoverpoint=void 0);this.draw()}onDragDown(m){var _,k,D,E,P,a,U,G,ne;if(m.type==="touchstart"&&m.originalEvent.touches.length!==1||m.type==="mousedown"&&m.originalEvent.which!==1)return;const W=this.map.queryRenderedFeatures(m.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveRoutelineLayers]})[0];this.dragDownPosition=m.point,this.configuration.sensitiveWaypointLayers.includes((_=W==null?void 0:W.layer.id)!=null?_:"")?(this.waypointBeingDragged=this._waypoints.find(j=>{var se,de;return((se=j.properties)==null?void 0:se.id)===((de=W==null?void 0:W.properties)==null?void 0:de.id)}),this.waypointBeingDraggedInitialCoordinates=(k=this.waypointBeingDragged)==null?void 0:k.geometry.coordinates):this.configuration.sensitiveRoutelineLayers.includes((D=W==null?void 0:W.layer.id)!=null?D:"")&&(this.hoverpoint?this.hoverpoint.geometry.coordinates=[m.lngLat.lng,m.lngLat.lat]:this.hoverpoint=this.buildPoint([m.lngLat.lng,m.lngLat.lat],"HOVERPOINT",{departSnappointProperties:Ss({},JSON.parse((P=(E=W==null?void 0:W.properties)==null?void 0:E.departSnappointProperties)!=null?P:"{}")),arriveSnappointProperties:Ss({},JSON.parse((U=(a=W==null?void 0:W.properties)==null?void 0:a.arriveSnappointProperties)!=null?U:"{}"))}),this.hoverpoint.properties&&(this.hoverpoint.properties.showSnaplines=!0),this.departSnappointIndex=JSON.parse((G=W==null?void 0:W.properties)==null?void 0:G.legIndex),~this.departSnappointIndex&&((ne=this.snappoints[this.departSnappointIndex])==null?void 0:ne.properties)&&(this.snappoints[this.departSnappointIndex].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex]),this.snappoints[this.departSnappointIndex+1].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex+1]))),this.map.off("touchstart",this.onMoveHandler),this.map.off("mousemove",this.onMoveHandler),m.type==="touchstart"?(this.map.on("touchmove",this.onDragMoveHandler),this.map.on("touchend",this.onDragUpHandler)):m.type==="mousedown"&&(this.map.on("mousemove",this.onDragMoveHandler),this.map.on("mouseup",this.onDragUpHandler)),this.draw()}onDragMove(m){if(m.type==="touchmove"&&m.originalEvent.touches.length!==1)return m.originalEvent.preventDefault();m.type==="mousemove"&&m.originalEvent.which!==1||(this.waypointBeingDragged?this.waypointBeingDragged.geometry.coordinates=[m.lngLat.lng,m.lngLat.lat]:this.hoverpoint&&(this.hoverpoint.geometry.coordinates=[m.lngLat.lng,m.lngLat.lat]),this.draw())}async onDragUp(m){var _,k,D;if(!(m.type==="mouseup"&&m.originalEvent.which!==1)){if((_=this.hoverpoint)!=null&&_.properties&&(this.hoverpoint.properties.showSnaplines=!1),Math.abs(m.point.x-((k=this.dragDownPosition)==null?void 0:k.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(m.point.y-((D=this.dragDownPosition)==null?void 0:D.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0))if(this.waypointBeingDragged){this.waypointBeingDragged.geometry.coordinates=[m.lngLat.lng,m.lngLat.lat];const E=new Is("movewaypoint",m,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(E);try{await this.fetchDirections(E)}catch{this.waypointBeingDraggedInitialCoordinates&&(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates)}this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0}else this.hoverpoint&&(this._addWaypoint([m.lngLat.lng,m.lngLat.lat],this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0,m),this.hoverpoint=void 0);else this.waypointBeingDragged&&this.waypointBeingDraggedInitialCoordinates?(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates,this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0):this.hoverpoint&&(this.hoverpoint=void 0);this.deHighlight(),m.type==="touchend"?(this.map.off("touchmove",this.onDragMoveHandler),this.map.off("touchend",this.onDragUpHandler)):m.type==="mouseup"&&(this.map.off("mousemove",this.onDragMoveHandler),this.map.off("mouseup",this.onDragUpHandler)),this.map.on("touchstart",this.onMoveHandler),this.map.on("mousemove",this.onMoveHandler),this.draw()}}onClick(m){var _,k,D,E;const P=this.map.queryRenderedFeatures(m.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveAltRoutelineLayers,...this.configuration.sensitiveRoutelineLayers]})[0];if(this.configuration.sensitiveWaypointLayers.includes((_=P==null?void 0:P.layer.id)!=null?_:"")){const a=this._waypoints.findIndex(U=>{var G,ne;return((G=U.properties)==null?void 0:G.id)===((ne=P==null?void 0:P.properties)==null?void 0:ne.id)});~a&&this._removeWaypoint(a,m)}else if(this.configuration.sensitiveSnappointLayers.includes((k=P==null?void 0:P.layer.id)!=null?k:"")){const a=this.snappoints.findIndex(U=>{var G,ne;return((G=U.properties)==null?void 0:G.id)===((ne=P==null?void 0:P.properties)==null?void 0:ne.id)});~a&&this._removeWaypoint(a,m)}else this.configuration.sensitiveAltRoutelineLayers.includes((D=P==null?void 0:P.layer.id)!=null?D:"")?this.selectedRouteIndex=this.routelines.findIndex(a=>!!a.find(U=>{var G,ne;return((G=U.properties)==null?void 0:G.id)===((ne=P==null?void 0:P.properties)==null?void 0:ne.id)})):this.configuration.sensitiveRoutelineLayers.includes((E=P==null?void 0:P.layer.id)!=null?E:"")||this._addWaypoint([m.lngLat.lng,m.lngLat.lat],void 0,m);this.draw(!1)}assignWaypointsCategories(){this._waypoints.forEach((m,_)=>{const k=_===0?"ORIGIN":_===this._waypoints.length-1?"DESTINATION":void 0;m.properties&&(m.properties.category=k)})}async _addWaypoint(m,_,k){var D;(D=this.abortController)==null||D.abort(),_=_!=null?_:this._waypoints.length,this._waypoints.splice(_,0,this.buildPoint(m,"WAYPOINT")),this.assignWaypointsCategories();const E=new Is("addwaypoint",k,{index:_});this.fire(E),this.draw(),await this.fetchDirections(E)}async _removeWaypoint(m,_){var k;(k=this.abortController)==null||k.abort(),this._waypoints.splice(m,1),this.snappoints.splice(m,1),this.assignWaypointsCategories();const D=new Is("removewaypoint",_,{index:m});this.fire(D),this.draw(),await this.fetchDirections(D)}get interactive(){return this._interactive}set interactive(m){this._interactive=m,m?(this.map.on("touchstart",this.onMoveHandler),this.map.on("touchstart",this.onDragDownHandler),this.map.on("mousemove",this.onMoveHandler),this.map.on("mousedown",this.onDragDownHandler),this.map.on("click",this.onClickHandler)):(this.map.off("touchstart",this.onMoveHandler),this.map.off("touchstart",this.onDragDownHandler),this.map.off("mousemove",this.onMoveHandler),this.map.off("mousedown",this.onDragDownHandler),this.map.off("click",this.onClickHandler))}get waypoints(){return this.waypointsCoordinates}set waypoints(m){this.setWaypoints(m)}async setWaypoints(m){var _;(_=this.abortController)==null||_.abort(),this._waypoints=m.map(D=>this.buildPoint(D,"WAYPOINT")),this.assignWaypointsCategories();const k=new Is("setwaypoints",void 0);this.fire(k),this.draw(),await this.fetchDirections(k)}async addWaypoint(m,_){await this._addWaypoint(m,_)}async removeWaypoint(m){await this._removeWaypoint(m)}clear(){this.setWaypoints([]),this.routelines=[]}destroy(){this.interactive=!1,this.clear(),this.configuration.layers.forEach(m=>{this.map.removeLayer(m.id)}),this.map.removeSource(this.configuration.sourceName)}}function Ol(){}function Pp(b){return b()}function Qh(){return Object.create(null)}function Nl(b){b.forEach(Pp)}function nf(b){return typeof b=="function"}function of(b,m){return b!=b?m==m:b!==m||b&&typeof b=="object"||typeof b=="function"}function af(b){return Object.keys(b).length===0}function Mo(b,m){b.appendChild(m)}function Dp(b,m,_){b.insertBefore(m,_||null)}function uu(b){b.parentNode.removeChild(b)}function to(b){return document.createElementNS("http://www.w3.org/2000/svg",b)}function sf(b){return document.createTextNode(b)}function lf(){return sf("")}function kt(b,m,_){_==null?b.removeAttribute(m):b.getAttribute(m)!==_&&b.setAttribute(m,_)}function cf(b){return Array.from(b.childNodes)}let hu;function ks(b){hu=b}const zs=[],ep=[],Rl=[],tp=[],uf=Promise.resolve();let tu=!1;function hf(){tu||(tu=!0,uf.then(Lp))}function iu(b){Rl.push(b)}const Kc=new Set;let Dl=0;function Lp(){const b=hu;do{for(;Dl<zs.length;){const m=zs[Dl];Dl++,ks(m),pf(m.$$)}for(ks(null),zs.length=0,Dl=0;ep.length;)ep.pop()();for(let m=0;m<Rl.length;m+=1){const _=Rl[m];Kc.has(_)||(Kc.add(_),_())}Rl.length=0}while(zs.length);for(;tp.length;)tp.pop()();tu=!1,Kc.clear(),ks(b)}function pf(b){if(b.fragment!==null){b.update(),Nl(b.before_update);const m=b.dirty;b.dirty=[-1],b.fragment&&b.fragment.p(b.ctx,m),b.after_update.forEach(iu)}}const df=new Set;function mf(b,m){b&&b.i&&(df.delete(b),b.i(m))}function ff(b,m,_,k){const{fragment:D,on_mount:E,on_destroy:P,after_update:a}=b.$$;D&&D.m(m,_),k||iu(()=>{const U=E.map(Pp).filter(nf);P?P.push(...U):Nl(U),b.$$.on_mount=[]}),a.forEach(iu)}function gf(b,m){const _=b.$$;_.fragment!==null&&(Nl(_.on_destroy),_.fragment&&_.fragment.d(m),_.on_destroy=_.fragment=null,_.ctx=[])}function yf(b,m){b.$$.dirty[0]===-1&&(zs.push(b),hf(),b.$$.dirty.fill(0)),b.$$.dirty[m/31|0]|=1<<m%31}function _f(b,m,_,k,D,E,P,a=[-1]){const U=hu;ks(b);const G=b.$$={fragment:null,ctx:null,props:E,update:Ol,not_equal:D,bound:Qh(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(m.context||(U?U.$$.context:[])),callbacks:Qh(),dirty:a,skip_bound:!1,root:m.target||U.$$.root};P&&P(G.root);let ne=!1;if(G.ctx=_?_(b,m.props||{},(W,j,...se)=>{const de=se.length?se[0]:j;return G.ctx&&D(G.ctx[W],G.ctx[W]=de)&&(!G.skip_bound&&G.bound[W]&&G.bound[W](de),ne&&yf(b,W)),j}):[],G.update(),ne=!0,Nl(G.before_update),G.fragment=k?k(G.ctx):!1,m.target){if(m.hydrate){const W=cf(m.target);G.fragment&&G.fragment.l(W),W.forEach(uu)}else G.fragment&&G.fragment.c();m.intro&&mf(b.$$.fragment),ff(b,m.target,m.anchor,m.customElement),Lp()}ks(U)}class xf{$destroy(){gf(this,1),this.$destroy=Ol}$on(m,_){const k=this.$$.callbacks[m]||(this.$$.callbacks[m]=[]);return k.push(_),()=>{const D=k.indexOf(_);D!==-1&&k.splice(D,1)}}$set(m){this.$$set&&!af(m)&&(this.$$.skip_bound=!0,this.$$set(m),this.$$.skip_bound=!1)}}function ip(b){let m,_,k,D,E,P,a,U,G,ne,W,j,se,de,Ce,je;return{c(){m=to("svg"),_=to("circle"),D=to("path"),P=to("g"),a=to("path"),G=to("path"),W=to("path"),se=to("animateTransform"),kt(_,"cx","64.13"),kt(_,"cy","64.13"),kt(_,"r","27.63"),kt(_,"fill",k=b[0].fill),kt(D,"d","M64.13 18.5A45.63 45.63 0 1 1 18.5 64.13 45.63 45.63 0 0 1 64.13 18.5zm0 7.85a37.78 37.78 0 1 1-37.78 37.78 37.78 37.78 0 0 1 37.78-37.78z"),kt(D,"fill-rule","evenodd"),kt(D,"fill",E=b[0].fill),kt(a,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),kt(a,"fill",U=b[0].fill),kt(G,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),kt(G,"fill",ne=b[0].fill),kt(G,"transform","rotate(120 64 64)"),kt(W,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),kt(W,"fill",j=b[0].fill),kt(W,"transform","rotate(240 64 64)"),kt(se,"attributeName","transform"),kt(se,"type","rotate"),kt(se,"from","0 64 64"),kt(se,"to","120 64 64"),kt(se,"dur","360ms"),kt(se,"repeatCount","indefinite"),kt(m,"xmlns","http://www.w3.org/2000/svg"),kt(m,"width",de=b[0].size),kt(m,"height",Ce=b[0].size),kt(m,"viewBox","0 0 128 128"),kt(m,"xml:space","preserve"),kt(m,"class",je=b[0].class)},m(nt,Ct){Dp(nt,m,Ct),Mo(m,_),Mo(m,D),Mo(m,P),Mo(P,a),Mo(P,G),Mo(P,W),Mo(P,se)},p(nt,Ct){Ct&1&&k!==(k=nt[0].fill)&&kt(_,"fill",k),Ct&1&&E!==(E=nt[0].fill)&&kt(D,"fill",E),Ct&1&&U!==(U=nt[0].fill)&&kt(a,"fill",U),Ct&1&&ne!==(ne=nt[0].fill)&&kt(G,"fill",ne),Ct&1&&j!==(j=nt[0].fill)&&kt(W,"fill",j),Ct&1&&de!==(de=nt[0].size)&&kt(m,"width",de),Ct&1&&Ce!==(Ce=nt[0].size)&&kt(m,"height",Ce),Ct&1&&je!==(je=nt[0].class)&&kt(m,"class",je)},d(nt){nt&&uu(m)}}}function bf(b){let m,_=b[1]&&ip(b);return{c(){_&&_.c(),m=lf()},m(k,D){_&&_.m(k,D),Dp(k,m,D)},p(k,[D]){k[1]?_?_.p(k,D):(_=ip(k),_.c(),_.m(m.parentNode,m)):_&&(_.d(1),_=null)},i:Ol,o:Ol,d(k){_&&_.d(k),k&&uu(m)}}}function vf(b,m,_){let{directions:k}=m,{configuration:D}=m,E;return k.on("fetchroutesstart",()=>{_(1,E=!0)}),k.on("fetchroutesend",()=>{_(1,E=!1)}),b.$$set=P=>{"directions"in P&&_(2,k=P.directions),"configuration"in P&&_(0,D=P.configuration)},[D,E,k]}class wf extends xf{constructor(m){super(),_f(this,m,vf,bf,of,{directions:2,configuration:0})}}const Af={fill:"#6d26d7",size:"24px",class:""};class Ef{constructor(m,_){St(this,"controlElement"),St(this,"directions"),St(this,"configuration"),this.directions=m,this.configuration=Object.assign({},Af,_)}onAdd(){return this.controlElement=document.createElement("div"),new wf({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}function Sf(b){let m,_,k,D,E,P,a,U,G;return{c(){m=Ee("label"),_=Ee("input"),D=it(),E=Ee("strong"),E.textContent="Interactivity enabled",P=it(),a=Ee("ul"),a.innerHTML=`<li>Click somewhere on the map to add a waypoint</li> 
    <li>Click a waypoint to remove it and its related snappoint</li> 
    <li>Click a snappoint to remove it and its related waypoint</li> 
    <li>Drag a waypoint somewhere to move it</li> 
    <li>Drag a routeline somewhere to add a waypoint in-between the 2 nearest ones</li> 
    <li>Click an alternative routeline to select it<br/> 
      <small><strong>Note</strong>, there&#39;s usually no alternative routelines in the server response if there are more than
        2 waypoints</small></li>`,tt(_,"type","checkbox"),_.disabled=k=!b[0],tt(m,"class","flex items-center gap-3")},m(ne,W){ve(ne,m,W),He(m,_),_.checked=b[1],He(m,D),He(m,E),ve(ne,P,W),ve(ne,a,W),U||(G=cr(_,"change",b[4]),U=!0)},p(ne,W){W&1&&k!==(k=!ne[0])&&(_.disabled=k),W&2&&(_.checked=ne[1])},d(ne){ne&&be(m),ne&&be(P),ne&&be(a),U=!1,G()}}}function If(b){let m;return{c(){m=Ee("span"),m.textContent=`${b[3].name}`,tt(m,"slot","title")},m(_,k){ve(_,m,k)},p:Vt,d(_){_&&be(m)}}}function zf(b){let m,_,k,D;return m=new Ar({props:{$$slots:{title:[If],default:[Sf]},$$scope:{ctx:b}}}),{c(){Ti(m.$$.fragment),_=it(),k=Ee("div"),tt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(E,P){wi(m,E,P),ve(E,_,P),ve(E,k,P),b[5](k),D=!0},p(E,[P]){const a={};P&131&&(a.$$scope={dirty:P,ctx:E}),m.$set(a)},i(E){D||(ii(m.$$.fragment,E),D=!0)},o(E){ci(m.$$.fragment,E),D=!1},d(E){Ai(m,E),E&&be(_),E&&be(k),b[5](null)}}}function Tf(b,m,_){let k;vr(b,wr,ne=>_(6,k=ne));const D=ji.find(ne=>ne.path===k);let E,P,a=!0;Rr(()=>{const ne=new Fr.Map({container:E,style:Or,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});ne.on("load",()=>{_(0,P=new Vr(ne,{requestOptions:{alternatives:"true"}}))})});function U(){a=this.checked,_(1,a)}function G(ne){ur[ne?"unshift":"push"](()=>{E=ne,_(2,E)})}return b.$$.update=()=>{b.$$.dirty&3&&P&&_(0,P.interactive=a,P)},[P,a,E,D,U,G]}class kf extends Gi{constructor(m){super(),qi(this,m,Tf,zf,Ri,{})}}var Cf=Object.freeze(Object.defineProperty({__proto__:null,default:kf},Symbol.toStringTag,{value:"Module"}));const Mf=[{id:"maplibre-gl-directions-snapline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[2,2],"line-color":"#ffffff","line-opacity":.65,"line-width":2},filter:["==",["get","type"],"SNAPLINE"]},{id:"maplibre-gl-directions-alt-routeline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-pattern":"routeline","line-width":12,"line-opacity":.5},filter:["==",["get","route"],"ALT"]},{id:"maplibre-gl-directions-routeline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-pattern":"routeline","line-width":12},filter:["==",["get","route"],"SELECTED"]},{id:"maplibre-gl-directions-hoverpoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-hoverpoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"HOVERPOINT"]},{id:"maplibre-gl-directions-snappoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-snappoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"SNAPPOINT"]},{id:"maplibre-gl-directions-waypoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-waypoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"WAYPOINT"]}];var Pf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJpSURBVEiJlZRLSFQBFIa/c2dyGMXHNKUrq0WLgsxt214L20gG0gxGhIIktIk2IS3bRFG4ahFBYQPlY8pQNxkFUbSQigyEiBKLIk3vOODUPO5pMV4fM/fOnTmbuffc8//ff+5jBI8abF9qEb/0iHIU2LPW/obyzEDvnI5vnymlF7cLE20aSAQTNxXtBQyXsZwKt7cZDRc7hyRdNmCiTQNm0JwEDtu92maoa84fr8xDcn6L5Lnf19DmBPE7AZarE7dE8+Y1jXCgWwntLZj5DB/vCqu/ATiSy5k3gAueGwy2L7UYPnkPGMEdcKhfCdQ5xYB0QnhzFVJ/AMghVmt0JPxp80zRvRW/9Nj9/VF3c4CqemVfRO1Tn2J0F84UAyyOAQTqYOdBd3O7GluhqnZNqxz3BCDsAqhuAnF9xzaNG1DTtH662xuA+gGsjLe5XVZ2TQk+T4AgPwGS35XsX2/zbAqSP2wtvzwBCh/yqYS5KW/A3NSWbd95AkDG7aMvY8LijPuDWJzJz6yHU8Y8ARk14kAW8vd2egBmh2B1YWNmdQFmH8L0gGDlNqSk5WlRXKdksQ5zHPREYd8fzP9mU44LxaOjoQ7PDQBQvebUzqZczRHDuu7UdwRE46GXwCtnK6c8TEWGw6/LBuQTcaVcf8Mw+t0uugIiw6EXqD7yche4Fxmpf1sxAEAsvQQkS7gv+3yZy6U8SgIiT8LzSPF/vF1qaV/nUGPR17s1QxkVO2nGEI0UtO9HR0NnvbQlN7Drn2ofMLcp1VcrZbluVjHg3OOQKYaeATJAGsPq6poMr5SjragenFo6H+sweyvR/Ac3+sqU/+vBXgAAAABJRU5ErkJggg==",Df="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJwSURBVEiJlZTNSxRxGMc/v98KZmm67qJQ2At0Ksy/obeDXSy7ZBS5KEiCHaJLSMcuUSSeOmi7BkW16taKeDCjMIJOFRgUHSzMjExdc2O3fZmnwzrr6s7s7D6Xmeft+3me+c2MwsGWW9obVZnqRDgG7FsPf0V4LuiB2tDgTKF+ZZeQ5p7y1YroHYEuQNuUpVFyt0b/vaKCwUTRAGnuKY9URCeAI9lgwy5o2J25n5uHuR+5LS9qXNFmK0iZFWB1+1ofojLidV6k4ywc2L+56Mss6t4j+PUb4GgkXXkb6HHcYLmlvVG51HtA461Fei/DziqrOVCrUbjRB0srAGlDGU2ekaGPuTV5z1aVqU4zLudO2YoDSHUl0tZiui6N7thak394BseBjPDhg7biWWs6BFU71omccAYo9gBQ7wVl+5LlKGiorzO9vY4AMQ8+mXIWNy2VrXU5AhSyACDfFyD+z1k8Fof5BdP76QgA/QFApVIwNe0MmJrO2VbeOQIUMp69D0+iZj7bi898QoUnN3zRYUeAlnQIyIyUSkH/AATHYHFpo2hxCR6HUf2DkE6b0aRKxMfyB7awSKtvXOBkXqJiW+Yai1u1hdyj/lbHDQBEuGkVJxa3E8fQ3LKKWwLcIf8r4LWlkuVEasoz7H9TNCCTkevFymstvbYydgn3cOClCE+K0B+qHvG/LRkAIAZXgTXbAqVWki6uFdIoCPA888+h8v/xGwMY3XXBQN7Xu2mGQknTIqd9D0XRtiV83z3qv+jUW3AD00SkG/iWE5k1YgnbzUoGuJ8GIqLlApAEEoZW5z0TD/4U01uSLZ/xXYq0+rpK6fkPouPQTszwGH0AAAAASUVORK5CYII=",Lf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAKQSURBVEiJlZRLSFRRGMd/586rVHQySDMqXRRESJuQ1BTsiS1atK5NGpIgodQiIghqleWYbVr0wDZpG6nUICym0UZ0kQXZTlSMHDUczee87mkxXlPn3rl3vtU5//N9/9/5zj3nCkyi3F9fiKBaSk4C+WvymIQeu4w99Za2/EhWL4wWKrvrXItZNg9C1ACKQVpMIp4EszIbhg/fCVsGVHbXuRZ22N8LSYWmFWzLocCVC8BoKMDo6tTGkk+zWVmVehC7HmDRbW/WzHc7s7mWd55D2/duyvm5MkHL7zdMhoMAJ7Ln5x8CdaYdlPvrCyV8A5RdDjeN+Zdx29P19sFcdIkbY8+YjswDxFSVI1+Oe4Y35iSeraBa06/knjU0B3Db06nKOaNNbYpC1dacBICUnNKKj2YcMDTXoijjIJm2tHgt8rQpANgHkOfIRjG+ZP8NhMIe504ABGK/FYAdIELM1FyLiIxqQ5sVwCTA2OoUK6ru1d4Uy2qI8fCMNg1YAIjv8V3F6AwOmgI6ZweJqGsdCIbMAULt0obtMz6GFkcMzb8ujdD+p3d9LqV4awpwKpEOIArxLu7+auPFdA+B+IMCIBAO8nzqA/cm2ojK9W8VIeZ8l7BfvZ2V9dd3ITm3VU9TXED83HWMOnwlngumHQAgua8nL6shXfM1xAM9VRfQW+L5jJR9Bk568dFX0uS3DACQCrctmksp1FtGi4aAvuJmr4TXFuxb+4ofDaQMAFDs4jqwkCQlaHM4bib1SLboK2qaECLxH78eklpvUWPC67UMAPAVe1pBvNqqC+TL3lJPm1m9KQDAFlJrgfEN0mhIiRl3lirAW9E8p6hcAiJAWCAuDhx7/NdKbUpR1t9wtdzfUJNKzT8AkN+WDptOYQAAAABJRU5ErkJggg==",Bf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAACmAAAApgHdff84AAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAN9JREFUSIlj/P//PwMtARNNTWdgYGB0ic61oKUFLP8Z/h+nqQURFj9paT4Di4HsH9paULGam6YW0DwVjVpAELAwMDAwaKsqMthbGMEFn714zbBh9yGGSD83BkF+Xrj49gOQLOPpYAkXe//xM8PyTbsYAlztGKQkROHiB0+cY7h6+z7EAlZWFgYeLk64JAcHOwMDAwMDNycHijgLMzMDAwMDitivX7/hepDFWVlZGBgYGBgYnaNzaFraDf1IHvoWsDQFfqOtBY/e0dYTLHMOctDWAkYGRkvCysgHjEO+VQEA4IsuY5Zs3DIAAAAASUVORK5CYII=";function Rf(b){let m,_,k,D,E,P,a,U,G,ne;return{c(){m=Ee("p"),_=_i(`It's completely up to you how to style the Directions' features shown on the map. You can either use the default
    styles provided by the plugin (see other examples), easily modify the default features' dimensions (see the
    `),k=Ee("a"),k.textContent="Touch-Friendly Features example",D=_i(`) or
    `),E=Ee("strong"),E.textContent="define your custom features' styles from scratch",P=_i("."),a=it(),U=Ee("p"),U.textContent="This example demonstrates the last option.",tt(k,"href","/examples/touch-friendly-features")},m(W,j){ve(W,m,j),He(m,_),He(m,k),He(m,D),He(m,E),He(m,P),ve(W,a,j),ve(W,U,j),G||(ne=ou(cu.call(null,k)),G=!0)},p:Vt,d(W){W&&be(m),W&&be(a),W&&be(U),G=!1,ne()}}}function Ff(b){let m;return{c(){m=Ee("span"),m.textContent=`${b[1].name}`,tt(m,"slot","title")},m(_,k){ve(_,m,k)},p:Vt,d(_){_&&be(m)}}}function Of(b){let m,_,k,D;return m=new Ar({props:{$$slots:{title:[Ff],default:[Rf]},$$scope:{ctx:b}}}),{c(){Ti(m.$$.fragment),_=it(),k=Ee("div"),tt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(E,P){wi(m,E,P),ve(E,_,P),ve(E,k,P),b[2](k),D=!0},p(E,[P]){const a={};P&32&&(a.$$scope={dirty:P,ctx:E}),m.$set(a)},i(E){D||(ii(m.$$.fragment,E),D=!0)},o(E){ci(m.$$.fragment,E),D=!1},d(E){Ai(m,E),E&&be(_),E&&be(k),b[2](null)}}}let Vf=!0;function Uf(b,m,_){let k;vr(b,wr,U=>_(4,k=U));const D=ji.find(U=>U.path===k);let E,P;Rr(()=>{const U=new Fr.Map({container:E,style:Or,center:[-74.1197632,40.6974034],zoom:11,customAttribution:`<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a> | Icons made by <a href="https://www.flaticon.com/authors/vectors-market" title="Vectors Market">Vectors Market</a> and by <a href="https://www.flaticon.com/authors/dinosoftlabs" title="DinosoftLabs">DinosoftLabs</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>`,fadeDuration:0});U.on("load",()=>{U.loadImage(Pf,(G,ne)=>{G||U.addImage("balloon-waypoint",ne)}),U.loadImage(Df,(G,ne)=>{G||U.addImage("balloon-snappoint",ne)}),U.loadImage(Lf,(G,ne)=>{G||U.addImage("balloon-hoverpoint",ne)}),U.loadImage(Bf,(G,ne)=>{G||U.addImage("routeline",ne)}),P=new Vr(U,{requestOptions:{alternatives:"true"},layers:Mf,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline"]}),P.interactive=Vf})});function a(U){ur[U?"unshift":"push"](()=>{E=U,_(0,E)})}return[E,D,a]}class $f extends Gi{constructor(m){super(),qi(this,m,Uf,Of,Ri,{})}}var Nf=Object.freeze(Object.defineProperty({__proto__:null,default:$f},Symbol.toStringTag,{value:"Module"}));class jf extends Vr{constructor(_,k){super(_,k);Xc(this,"originalBuildRoutelines",rf.buildRoutelines);Xc(this,"buildRoutelines",(_,k,D,E)=>{const P=this.originalBuildRoutelines(_,k,D,E);return P[0].forEach((a,U)=>{a.properties&&(a.properties.distance=k[0].legs[U].distance)}),P})}}const Ni="distance-measurement-maplibre-gl-directions",qf={sourceName:Ni,layers:[{id:`${Ni}-snapline`,type:"line",source:Ni,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":"#34343f","line-width":2},filter:["==",["get","type"],"SNAPLINE"]},{id:`${Ni}-routeline`,type:"line",source:Ni,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#212121","line-opacity":.85,"line-width":3},filter:["==",["get","route"],"SELECTED"]},{id:`${Ni}-routeline-distance`,type:"symbol",source:Ni,layout:{"symbol-placement":"line-center","text-field":"{distance}m","text-size":16,"text-ignore-placement":!0,"text-allow-overlap":!0,"text-overlap":"always"},paint:{"text-color":"#212121","text-halo-color":"#ffffff","text-halo-width":1},filter:["==",["get","route"],"SELECTED"]},{id:`${Ni}-hoverpoint`,type:"circle",source:Ni,paint:{"circle-radius":9,"circle-color":"#212121"},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${Ni}-snappoint`,type:"circle",source:Ni,paint:{"circle-radius":["case",["boolean",["get","highlight"],!1],9,7],"circle-color":["case",["boolean",["get","highlight"],!1],"#313131","#494949"]},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${Ni}-waypoint`,type:"circle",source:Ni,paint:{"circle-radius":["case",["boolean",["get","highlight"],!1],9,7],"circle-color":["case",["boolean",["get","highlight"],!1],"#212121","#2c2c2c"]},filter:["==",["get","type"],"WAYPOINT"]}],sensitiveSnappointLayers:[`${Ni}-snappoint`],sensitiveWaypointLayers:[`${Ni}-waypoint`],sensitiveRoutelineLayers:[`${Ni}-routeline`],sensitiveAltRoutelineLayers:[]};function Gf(b){let m;return{c(){m=Ee("em"),m.textContent="unknown"},m(_,k){ve(_,m,k)},p:Vt,d(_){_&&be(m)}}}function Zf(b){let m,_,k;return{c(){m=Ee("strong"),_=_i(b[1]),k=_i("m")},m(D,E){ve(D,m,E),He(m,_),He(m,k)},p(D,E){E&2&&mp(_,D[1])},d(D){D&&be(m)}}}function Hf(b){let m,_,k,D,E,P,a,U,G,ne;function W(de,Ce){return de[1]?Zf:Gf}let j=W(b),se=j(b);return{c(){m=Ee("p"),_=_i(`Total Route Distance:
    `),se.c(),k=it(),D=Ee("small"),D.innerHTML="<strong>Note</strong> that you might want to zoom in and out the map to toggle the distance-annotations visibility",E=it(),P=Ee("p"),P.textContent=`This is an example of how one could use the plugin's extensibility interfaces to create a distance measurement tool
    out of it.`,a=it(),U=Ee("p"),U.innerHTML=`Here we create a subclass of the <code>MapLibreGlDirections</code> main super class and augment the original
    <code>buildRoutelines</code>
    method to write each route leg&#39;s distance into a respective feature&#39;s <code>properties</code> object. These saved distances
    are then used by an additional &quot;symbol&quot; layer that displays them along the respective route&#39;s lines on the map.`,G=it(),ne=Ee("p"),ne.textContent=`The total distance comes from the response's specific field and is updated each time there's the "fetchroutesend" or
    the "removewaypoint" event fired.`},m(de,Ce){ve(de,m,Ce),He(m,_),se.m(m,null),ve(de,k,Ce),ve(de,D,Ce),ve(de,E,Ce),ve(de,P,Ce),ve(de,a,Ce),ve(de,U,Ce),ve(de,G,Ce),ve(de,ne,Ce)},p(de,Ce){j===(j=W(de))&&se?se.p(de,Ce):(se.d(1),se=j(de),se&&(se.c(),se.m(m,null)))},d(de){de&&be(m),se.d(),de&&be(k),de&&be(D),de&&be(E),de&&be(P),de&&be(a),de&&be(U),de&&be(G),de&&be(ne)}}}function Wf(b){let m;return{c(){m=Ee("span"),m.textContent=`${b[2].name}`,tt(m,"slot","title")},m(_,k){ve(_,m,k)},p:Vt,d(_){_&&be(m)}}}function Xf(b){let m,_,k,D;return m=new Ar({props:{$$slots:{title:[Wf],default:[Hf]},$$scope:{ctx:b}}}),{c(){Ti(m.$$.fragment),_=it(),k=Ee("div"),tt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(E,P){wi(m,E,P),ve(E,_,P),ve(E,k,P),b[3](k),D=!0},p(E,[P]){const a={};P&66&&(a.$$scope={dirty:P,ctx:E}),m.$set(a)},i(E){D||(ii(m.$$.fragment,E),D=!0)},o(E){ci(m.$$.fragment,E),D=!1},d(E){Ai(m,E),E&&be(_),E&&be(k),b[3](null)}}}let Yf=!0;function Kf(b,m,_){let k;vr(b,wr,G=>_(5,k=G));const D=ji.find(G=>G.path===k);let E,P,a=0;Rr(()=>{const G=new Fr.Map({container:E,style:Or,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});G.on("load",()=>{P=new jf(G,qf),P.on("fetchroutesend",ne=>{var W;_(1,a=(W=ne.data)==null?void 0:W.routes[0].distance)}),P.on("removewaypoint",()=>{P.waypoints.length<2&&_(1,a=0)}),P.interactive=Yf})});function U(G){ur[G?"unshift":"push"](()=>{E=G,_(0,E)})}return[E,a,D,U]}class Jf extends Gi{constructor(m){super(),qi(this,m,Kf,Xf,Ri,{})}}var Qf=Object.freeze(Object.defineProperty({__proto__:null,default:Jf},Symbol.toStringTag,{value:"Module"}));class eg extends Vr{constructor(m,_){super(m,_)}get waypointsFeatures(){return this._waypoints}setWaypointsFeatures(m){this._waypoints=m,this.assignWaypointsCategories();const _=new Is("setwaypoints",void 0);this.fire(_),this.draw()}get snappointsFeatures(){return this.snappoints}setSnappointsFeatures(m){this.snappoints=m,this.draw()}get routelinesFeatures(){return this.routelines}setRoutelinesFeatures(m){this.routelines=m,this.draw()}}function tg(b){let m,_,k,D,E,P,a,U,G,ne,W,j,se,de,Ce,je,nt,Ct,mt,ot,Ke;return{c(){m=Ee("button"),_=_i("Load the saved Route"),D=it(),E=Ee("button"),P=_i("Save the Route"),U=it(),G=Ee("button"),ne=_i("Clear"),j=it(),se=Ee("small"),se.innerHTML=`This example uses the <code>localStorage</code> to save routes, but you are obviously not restricted to it. There might
    instead be a file or a serverside-database or whatever else`,de=it(),Ce=Ee("p"),Ce.textContent=`If you want to save/load the route, the obvious way to do so would be to save the list of waypoints whenever the
    route is updated and to make a new routing-request with the saved waypoints' coordinates whenever you need to load
    it.`,je=it(),nt=Ee("p"),nt.textContent=`But what if the underlying roads networks changes for some reason? You'll get a different route for the same set of
    waypoints. Moreover, if there are some severe construction works going on, you run into a risk of not getting any
    routes whatsoever.`,Ct=it(),mt=Ee("p"),mt.textContent=`Sometimes it's actually a good idea to save the route as a list of GeoJSON Features and be able to load these saved
    features whenever there's a need. This example shows how that could be done.`,m.disabled=k=!b[1],E.disabled=a=!b[1],G.disabled=W=!b[1]},m(Ie,rt){ve(Ie,m,rt),He(m,_),ve(Ie,D,rt),ve(Ie,E,rt),He(E,P),ve(Ie,U,rt),ve(Ie,G,rt),He(G,ne),ve(Ie,j,rt),ve(Ie,se,rt),ve(Ie,de,rt),ve(Ie,Ce,rt),ve(Ie,je,rt),ve(Ie,nt,rt),ve(Ie,Ct,rt),ve(Ie,mt,rt),ot||(Ke=[cr(m,"click",b[3]),cr(E,"click",b[4]),cr(G,"click",b[5])],ot=!0)},p(Ie,rt){rt&2&&k!==(k=!Ie[1])&&(m.disabled=k),rt&2&&a!==(a=!Ie[1])&&(E.disabled=a),rt&2&&W!==(W=!Ie[1])&&(G.disabled=W)},d(Ie){Ie&&be(m),Ie&&be(D),Ie&&be(E),Ie&&be(U),Ie&&be(G),Ie&&be(j),Ie&&be(se),Ie&&be(de),Ie&&be(Ce),Ie&&be(je),Ie&&be(nt),Ie&&be(Ct),Ie&&be(mt),ot=!1,Pn(Ke)}}}function ig(b){let m;return{c(){m=Ee("span"),m.textContent=`${b[2].name}`,tt(m,"slot","title")},m(_,k){ve(_,m,k)},p:Vt,d(_){_&&be(m)}}}function rg(b){let m,_,k,D;return m=new Ar({props:{$$slots:{title:[ig],default:[tg]},$$scope:{ctx:b}}}),{c(){Ti(m.$$.fragment),_=it(),k=Ee("div"),tt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(E,P){wi(m,E,P),ve(E,_,P),ve(E,k,P),b[6](k),D=!0},p(E,[P]){const a={};P&258&&(a.$$scope={dirty:P,ctx:E}),m.$set(a)},i(E){D||(ii(m.$$.fragment,E),D=!0)},o(E){ci(m.$$.fragment,E),D=!1},d(E){Ai(m,E),E&&be(_),E&&be(k),b[6](null)}}}let ng=!0;function og(b,m,_){let k;vr(b,wr,W=>_(7,k=W));const D=ji.find(W=>W.path===k);let E,P;Rr(()=>{const W=new Fr.Map({container:E,style:Or,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});W.on("load",()=>{_(1,P=new eg(W)),_(1,P.interactive=ng,P)})});function a(){P.setWaypointsFeatures(JSON.parse(localStorage.getItem("saved-waypoints-features"))),P.setSnappointsFeatures(JSON.parse(localStorage.getItem("saved-snappoints-features"))),P.setRoutelinesFeatures(JSON.parse(localStorage.getItem("saved-routelines-features")))}function U(){localStorage.setItem("saved-waypoints-features",JSON.stringify(P.waypointsFeatures)),localStorage.setItem("saved-snappoints-features",JSON.stringify(P.snappointsFeatures)),localStorage.setItem("saved-routelines-features",JSON.stringify(P.routelinesFeatures))}const G=()=>P.clear();function ne(W){ur[W?"unshift":"push"](()=>{E=W,_(0,E)})}return[E,P,D,a,U,G,ne]}class ag extends Gi{constructor(m){super(),qi(this,m,og,rg,Ri,{})}}var sg=Object.freeze(Object.defineProperty({__proto__:null,default:ag},Symbol.toStringTag,{value:"Module"}));function lg(b){let m,_,k,D,E,P,a,U,G,ne,W,j,se,de,Ce,je,nt,Ct,mt,ot,Ke,Ie,rt,At,Ht,Zi,ki,hr,Er,Hi,Sr;return{c(){m=Ee("small"),m.innerHTML="<strong>Note</strong> that interactivity is disabled for this example",_=it(),k=Ee("div"),D=Ee("p"),D.textContent="Set waypoints to a predefined set",E=it(),P=Ee("button"),a=_i("Set Waypoints"),G=it(),ne=Ee("div"),W=Ee("p"),W.textContent="Add a random waypoint at some random index",j=it(),se=Ee("button"),de=_i("Add Waypoint"),je=it(),nt=Ee("div"),Ct=Ee("p"),Ct.textContent="Delete a random waypoint",mt=it(),ot=Ee("button"),Ke=_i("Delete Waypoint"),rt=it(),At=Ee("div"),Ht=Ee("p"),Ht.textContent="Clear the map from all the stuff added by the plugin",Zi=it(),ki=Ee("button"),hr=_i("Clear"),P.disabled=U=!b[1],tt(P,"class","self-center"),tt(k,"class","flex flex-col gap-2"),se.disabled=Ce=!b[1],tt(se,"class","self-center"),tt(ne,"class","flex flex-col gap-2"),ot.disabled=Ie=!b[1],tt(ot,"class","self-center"),tt(nt,"class","flex flex-col gap-2"),ki.disabled=Er=!b[1],tt(ki,"class","self-center"),tt(At,"class","flex flex-col gap-2")},m(Ve,Wt){ve(Ve,m,Wt),ve(Ve,_,Wt),ve(Ve,k,Wt),He(k,D),He(k,E),He(k,P),He(P,a),ve(Ve,G,Wt),ve(Ve,ne,Wt),He(ne,W),He(ne,j),He(ne,se),He(se,de),ve(Ve,je,Wt),ve(Ve,nt,Wt),He(nt,Ct),He(nt,mt),He(nt,ot),He(ot,Ke),ve(Ve,rt,Wt),ve(Ve,At,Wt),He(At,Ht),He(At,Zi),He(At,ki),He(ki,hr),Hi||(Sr=[cr(P,"click",b[3]),cr(se,"click",b[4]),cr(ot,"click",b[5]),cr(ki,"click",b[6])],Hi=!0)},p(Ve,Wt){Wt&2&&U!==(U=!Ve[1])&&(P.disabled=U),Wt&2&&Ce!==(Ce=!Ve[1])&&(se.disabled=Ce),Wt&2&&Ie!==(Ie=!Ve[1])&&(ot.disabled=Ie),Wt&2&&Er!==(Er=!Ve[1])&&(ki.disabled=Er)},d(Ve){Ve&&be(m),Ve&&be(_),Ve&&be(k),Ve&&be(G),Ve&&be(ne),Ve&&be(je),Ve&&be(nt),Ve&&be(rt),Ve&&be(At),Hi=!1,Pn(Sr)}}}function cg(b){let m;return{c(){m=Ee("span"),m.textContent=`${b[2].name}`,tt(m,"slot","title")},m(_,k){ve(_,m,k)},p:Vt,d(_){_&&be(m)}}}function ug(b){let m,_,k,D;return m=new Ar({props:{$$slots:{title:[cg],default:[lg]},$$scope:{ctx:b}}}),{c(){Ti(m.$$.fragment),_=it(),k=Ee("div"),tt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(E,P){wi(m,E,P),ve(E,_,P),ve(E,k,P),b[7](k),D=!0},p(E,[P]){const a={};P&1026&&(a.$$scope={dirty:P,ctx:E}),m.$set(a)},i(E){D||(ii(m.$$.fragment,E),D=!0)},o(E){ci(m.$$.fragment,E),D=!1},d(E){Ai(m,E),E&&be(_),E&&be(k),b[7](null)}}}function hg(b,m,_){let k;vr(b,wr,se=>_(9,k=se));const D=ji.find(se=>se.path===k);let E,P,a;Rr(()=>{const se=new Fr.Map({container:E,style:Or,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});se.on("load",()=>{P=se,_(1,a=new Vr(P,{requestOptions:{alternatives:"true"}}))})});function U(){a==null||a.setWaypoints([[-74.21349031181673,40.704951524836275],[-74.19666749687558,40.738517300855904],[-74.16611177177786,40.76634583723629],[-74.07169801445302,40.719004374548206],[-73.99170381279369,40.725509319065594],[-73.98071748466812,40.762445342516145]])}function G(){const se=P==null?void 0:P.getBounds(),de=P==null?void 0:P.getCenter();if(se&&de){const Ce=se.getEast()-se.getWest(),je=se.getSouth()-se.getNorth();a==null||a.addWaypoint([de.lng-Ce/2+Ce*Math.random(),de.lat-je/2+je*Math.random()],(a==null?void 0:a.waypoints.length)*Math.random()|0)}}function ne(){a==null||a.removeWaypoint((a==null?void 0:a.waypoints.length)*Math.random()|0)}function W(){a==null||a.clear()}function j(se){ur[se?"unshift":"push"](()=>{E=se,_(0,E)})}return[E,a,D,U,G,ne,W,j]}class pg extends Gi{constructor(m){super(),qi(this,m,hg,ug,Ri,{})}}var dg=Object.freeze(Object.defineProperty({__proto__:null,default:pg},Symbol.toStringTag,{value:"Module"}));function mg(b){let m,_,k,D,E,P,a,U,G,ne,W,j,se,de,Ce,je,nt,Ct,mt,ot,Ke;return{c(){m=Ee("label"),_=Ee("span"),_.innerHTML="<strong>Congestions</strong>",k=it(),D=Ee("select"),E=Ee("option"),E.textContent="Stringy",P=Ee("option"),P.textContent="Numeric",U=it(),G=Ee("p"),G.textContent="This example makes POST requests to the official Mapbox Directions API with the following options:",ne=it(),W=Ee("ul"),j=Ee("li"),se=Ee("strong"),de=_i("annotations="),Ce=_i(b[1]),je=it(),nt=Ee("li"),nt.textContent="overview=full",Ct=it(),mt=Ee("li"),mt.textContent="alternatives=true",E.__value="congestion",E.value=E.__value,P.__value="congestion_numeric",P.value=P.__value,D.disabled=a=!b[0],b[1]===void 0&&Ms(()=>b[5].call(D)),tt(m,"class","flex flex-col gap-2")},m(Ie,rt){ve(Ie,m,rt),He(m,_),He(m,k),He(m,D),He(D,E),He(D,P),Fl(D,b[1]),ve(Ie,U,rt),ve(Ie,G,rt),ve(Ie,ne,rt),ve(Ie,W,rt),He(W,j),He(j,se),He(se,de),He(se,Ce),He(W,je),He(W,nt),He(W,Ct),He(W,mt),ot||(Ke=cr(D,"change",b[5]),ot=!0)},p(Ie,rt){rt&1&&a!==(a=!Ie[0])&&(D.disabled=a),rt&2&&Fl(D,Ie[1]),rt&2&&mp(Ce,Ie[1])},d(Ie){Ie&&be(m),Ie&&be(U),Ie&&be(G),Ie&&be(ne),Ie&&be(W),ot=!1,Ke()}}}function fg(b){let m;return{c(){m=Ee("span"),m.textContent=`${b[3].name}`,tt(m,"slot","title")},m(_,k){ve(_,m,k)},p:Vt,d(_){_&&be(m)}}}function gg(b){let m,_,k,D;return m=new Ar({props:{$$slots:{title:[fg],default:[mg]},$$scope:{ctx:b}}}),{c(){Ti(m.$$.fragment),_=it(),k=Ee("div"),tt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(E,P){wi(m,E,P),ve(E,_,P),ve(E,k,P),b[6](k),D=!0},p(E,[P]){const a={};P&259&&(a.$$scope={dirty:P,ctx:E}),m.$set(a)},i(E){D||(ii(m.$$.fragment,E),D=!0)},o(E){ci(m.$$.fragment,E),D=!1},d(E){Ai(m,E),E&&be(_),E&&be(k),b[6](null)}}}function yg(b,m,_){let k;vr(b,wr,W=>_(7,k=W));const D=ji.find(W=>W.path===k);let E,P,a,U="congestion";Rr(()=>{const W=new Fr.Map({container:E,style:Or,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='//docs.mapbox.com/help/getting-started/directions/' target='_blank'>&copy; Mapbox Directions</a>"});W.on("load",()=>{_(4,P=W)})});function G(){U=fp(this),_(1,U)}function ne(W){ur[W?"unshift":"push"](()=>{E=W,_(2,E)})}return b.$$.update=()=>{b.$$.dirty&19&&P&&(a&&a.destroy(),_(0,a=new Vr(P,{api:"https://api.mapbox.com/directions/v5",profile:"mapbox/driving-traffic",makePostRequest:!0,requestOptions:{access_token:"pk.eyJ1Ijoic21lbGx5c2hvdmVsIiwiYSI6ImNsMW80eXQ4aTEwN3czcG8zMXM2NzJ2ODIifQ.oWHUIUiEj2SS4_hue3qv2g",alternatives:"true",annotations:U,overview:"full"}})),_(0,a.interactive=!0,a))},[a,U,E,D,P,G,ne]}class _g extends Gi{constructor(m){super(),qi(this,m,yg,gg,Ri,{})}}var xg=Object.freeze(Object.defineProperty({__proto__:null,default:_g},Symbol.toStringTag,{value:"Module"}));function bg(b){let m,_,k;return{c(){m=Ee("p"),m.textContent=`In this example the default layers used by the plugin are augmented with an additional "symbol" layer which is only
    rendered for the ORIGIN and DESTINATION waypoints.`,_=it(),k=Ee("p"),k.innerHTML=`<strong>Note</strong> how you don&#39;t need to re-define all the layers from scratch thanks to the exported
    <code>layersFactory</code> function that returns all the default layers allowing for their augmentation and modification`},m(D,E){ve(D,m,E),ve(D,_,E),ve(D,k,E)},p:Vt,d(D){D&&be(m),D&&be(_),D&&be(k)}}}function vg(b){let m;return{c(){m=Ee("span"),m.textContent=`${b[1].name}`,tt(m,"slot","title")},m(_,k){ve(_,m,k)},p:Vt,d(_){_&&be(m)}}}function wg(b){let m,_,k,D;return m=new Ar({props:{$$slots:{title:[vg],default:[bg]},$$scope:{ctx:b}}}),{c(){Ti(m.$$.fragment),_=it(),k=Ee("div"),tt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(E,P){wi(m,E,P),ve(E,_,P),ve(E,k,P),b[2](k),D=!0},p(E,[P]){const a={};P&32&&(a.$$scope={dirty:P,ctx:E}),m.$set(a)},i(E){D||(ii(m.$$.fragment,E),D=!0)},o(E){ci(m.$$.fragment,E),D=!1},d(E){Ai(m,E),E&&be(_),E&&be(k),b[2](null)}}}function Ag(b,m,_){let k;vr(b,wr,U=>_(4,k=U));const D=ji.find(U=>U.path===k);let E,P;Rr(()=>{const U=new Fr.Map({container:E,style:Or,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>",fadeDuration:0}),G=$l();G.push({id:"maplibre-gl-directions-waypoint-label",type:"symbol",source:"maplibre-gl-directions",layout:{"text-field":["case",["==",["get","category"],"ORIGIN"],"A",["==",["get","category"],"DESTINATION"],"B",""]},paint:{"text-color":"#ffffff","text-opacity":.7},filter:["all",["==",["geometry-type"],"Point"],["==",["get","type"],"WAYPOINT"],["in",["get","category"],["literal",["ORIGIN","DESTINATION"]]]]}),U.on("load",()=>{P=new Vr(U,{requestOptions:{alternatives:"true"},layers:G}),P.interactive=!0})});function a(U){ur[U?"unshift":"push"](()=>{E=U,_(0,E)})}return[E,D,a]}class Eg extends Gi{constructor(m){super(),qi(this,m,Ag,wg,Ri,{})}}var Sg=Object.freeze(Object.defineProperty({__proto__:null,default:Eg},Symbol.toStringTag,{value:"Module"})),Ig="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAKRJREFUOE+lkkEOAVEQRF9tJBwCZxhHEFYOIXMWNuIynIOFI7B3hpKeDBFh0ub/ddfrX10lCp8K9aQAtsexSNLtc2EWsANqYC7p8g7JAobAEZgBS0mnJyQFiGHbXyFpwC+IbE+BDTBIJhI/WQH3sBSACbDtCahKLCwkndMA2yPg0CbRiJtuZHy34oixAl7ifwB7YF1SpDh0VPnaq8pdNlM36AI8AK1AOkjqIJazAAAAAElFTkSuQmCC";function zg(b){let m,_,k,D,E;return{c(){m=Ee("p"),m.textContent="Another example that demonstrates the ease of extending the original styles provided by the plugin.",_=it(),k=Ee("p"),k.textContent='This time a "symbol" layer is added that shows the direction the selected route goes in.',D=it(),E=Ee("small"),E.innerHTML=`<strong>Note</strong> that you have to manually load and add the images you intend to use for the custom layers you
    add`},m(P,a){ve(P,m,a),ve(P,_,a),ve(P,k,a),ve(P,D,a),ve(P,E,a)},p:Vt,d(P){P&&be(m),P&&be(_),P&&be(k),P&&be(D),P&&be(E)}}}function Tg(b){let m;return{c(){m=Ee("span"),m.textContent=`${b[1].name}`,tt(m,"slot","title")},m(_,k){ve(_,m,k)},p:Vt,d(_){_&&be(m)}}}function kg(b){let m,_,k,D;return m=new Ar({props:{$$slots:{title:[Tg],default:[zg]},$$scope:{ctx:b}}}),{c(){Ti(m.$$.fragment),_=it(),k=Ee("div"),tt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(E,P){wi(m,E,P),ve(E,_,P),ve(E,k,P),b[2](k),D=!0},p(E,[P]){const a={};P&32&&(a.$$scope={dirty:P,ctx:E}),m.$set(a)},i(E){D||(ii(m.$$.fragment,E),D=!0)},o(E){ci(m.$$.fragment,E),D=!1},d(E){Ai(m,E),E&&be(_),E&&be(k),b[2](null)}}}function Cg(b,m,_){let k;vr(b,wr,U=>_(4,k=U));const D=ji.find(U=>U.path===k);let E,P;Rr(()=>{const U=new Fr.Map({container:E,style:Or,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});U.loadImage(Ig,(ne,W)=>{!ne&&W&&U.addImage("direction-arrow",W)});const G=$l();G.push({id:"maplibre-gl-directions-routeline-direction-arrow",type:"symbol",source:"maplibre-gl-directions",layout:{"symbol-placement":"line-center","icon-image":"direction-arrow","icon-size":["interpolate",["exponential",1.5],["zoom"],12,.85,18,1.4]},paint:{"icon-opacity":.5},filter:["==",["get","route"],"SELECTED"]}),U.on("load",()=>{P=new Vr(U,{requestOptions:{alternatives:"true"},layers:G}),P.interactive=!0})});function a(U){ur[U?"unshift":"push"](()=>{E=U,_(0,E)})}return[E,D,a]}class Mg extends Gi{constructor(m){super(),qi(this,m,Cg,kg,Ri,{})}}var Pg=Object.freeze(Object.defineProperty({__proto__:null,default:Mg},Symbol.toStringTag,{value:"Module"}));function Dg(b){let m,_,k,D,E,P,a,U,G,ne,W,j,se;return{c(){m=Ee("label"),_=Ee("input"),D=it(),E=Ee("strong"),E.textContent="Simulate a Touch-Enabled Device",P=it(),a=Ee("p"),a.textContent=`Sometimes it's pretty hard to aim exactly at the selected route line to add a waypoint by dragging it when using the
    plugin on a touch device.`,U=it(),G=Ee("p"),G.innerHTML=`The example shows how one could use the <code>layersFactory</code>&#39;s input parameters to handle that case by
    increasing the points by 1.5 and the lines by 2 times when the map is used on a touch-enabled device.`,ne=it(),W=Ee("small"),W.innerHTML=`<strong>Note</strong> that you can either load the page on a touch-enabled device or toggle the checkbox above: both
    options apply the same effect`,tt(_,"type","checkbox"),_.disabled=k=!b[0],tt(m,"class","flex items-center gap-3")},m(de,Ce){ve(de,m,Ce),He(m,_),_.checked=b[1],He(m,D),He(m,E),ve(de,P,Ce),ve(de,a,Ce),ve(de,U,Ce),ve(de,G,Ce),ve(de,ne,Ce),ve(de,W,Ce),j||(se=cr(_,"change",b[5]),j=!0)},p(de,Ce){Ce&1&&k!==(k=!de[0])&&(_.disabled=k),Ce&2&&(_.checked=de[1])},d(de){de&&be(m),de&&be(P),de&&be(a),de&&be(U),de&&be(G),de&&be(ne),de&&be(W),j=!1,se()}}}function Lg(b){let m;return{c(){m=Ee("span"),m.textContent=`${b[3].name}`,tt(m,"slot","title")},m(_,k){ve(_,m,k)},p:Vt,d(_){_&&be(m)}}}function Bg(b){let m,_,k,D;return m=new Ar({props:{$$slots:{title:[Lg],default:[Dg]},$$scope:{ctx:b}}}),{c(){Ti(m.$$.fragment),_=it(),k=Ee("div"),tt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(E,P){wi(m,E,P),ve(E,_,P),ve(E,k,P),b[6](k),D=!0},p(E,[P]){const a={};P&259&&(a.$$scope={dirty:P,ctx:E}),m.$set(a)},i(E){D||(ii(m.$$.fragment,E),D=!0)},o(E){ci(m.$$.fragment,E),D=!1},d(E){Ai(m,E),E&&be(_),E&&be(k),b[6](null)}}}function Rg(b,m,_){let k;vr(b,wr,W=>_(7,k=W));const D=ji.find(W=>W.path===k);let E,P,a,U="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;Rr(()=>{const W=new Fr.Map({container:E,style:Or,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});W.on("load",()=>{_(4,P=W)})});function G(){U=this.checked,_(1,U)}function ne(W){ur[W?"unshift":"push"](()=>{E=W,_(2,E)})}return b.$$.update=()=>{if(b.$$.dirty&19&&P){a&&a.destroy();const W=$l(U?1.5:1,U?2:1);_(0,a=new Vr(P,{requestOptions:{alternatives:"true"},layers:W})),_(0,a.interactive=!0,a)}},[a,U,E,D,P,G,ne]}class Fg extends Gi{constructor(m){super(),qi(this,m,Rg,Bg,Ri,{})}}var Og=Object.freeze(Object.defineProperty({__proto__:null,default:Fg},Symbol.toStringTag,{value:"Module"}));function rp(b,m,_){const k=b.slice();return k[7]=m[_],k}function np(b){let m,_=b[7]+"";return{c(){m=Ee("li")},m(k,D){ve(k,m,D),m.innerHTML=_},p(k,D){D&2&&_!==(_=k[7]+"")&&(m.innerHTML=_)},d(k){k&&be(m)}}}function op(b){let m,_,k;return{c(){m=Ee("button"),m.textContent="Clear"},m(D,E){ve(D,m,E),_||(k=cr(m,"click",b[3]),_=!0)},p:Vt,d(D){D&&be(m),_=!1,k()}}}function Vg(b){let m,_,k,D,E,P=b[1],a=[];for(let G=0;G<P.length;G+=1)a[G]=np(rp(b,P,G));let U=b[1].length&&op(b);return{c(){m=Ee("p"),m.textContent=`This example listens for all the available events and logs them below. Interact with the map to see the emitted
    events.`,_=it(),k=Ee("ol");for(let G=0;G<a.length;G+=1)a[G].c();D=it(),U&&U.c(),E=Vl()},m(G,ne){ve(G,m,ne),ve(G,_,ne),ve(G,k,ne);for(let W=0;W<a.length;W+=1)a[W].m(k,null);ve(G,D,ne),U&&U.m(G,ne),ve(G,E,ne)},p(G,ne){if(ne&2){P=G[1];let W;for(W=0;W<P.length;W+=1){const j=rp(G,P,W);a[W]?a[W].p(j,ne):(a[W]=np(j),a[W].c(),a[W].m(k,null))}for(;W<a.length;W+=1)a[W].d(1);a.length=P.length}G[1].length?U?U.p(G,ne):(U=op(G),U.c(),U.m(E.parentNode,E)):U&&(U.d(1),U=null)},d(G){G&&be(m),G&&be(_),G&&be(k),pp(a,G),G&&be(D),U&&U.d(G),G&&be(E)}}}function Ug(b){let m;return{c(){m=Ee("span"),m.textContent=`${b[2].name}`,tt(m,"slot","title")},m(_,k){ve(_,m,k)},p:Vt,d(_){_&&be(m)}}}function $g(b){let m,_,k,D;return m=new Ar({props:{$$slots:{title:[Ug],default:[Vg]},$$scope:{ctx:b}}}),{c(){Ti(m.$$.fragment),_=it(),k=Ee("div"),tt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(E,P){wi(m,E,P),ve(E,_,P),ve(E,k,P),b[4](k),D=!0},p(E,[P]){const a={};P&1026&&(a.$$scope={dirty:P,ctx:E}),m.$set(a)},i(E){D||(ii(m.$$.fragment,E),D=!0)},o(E){ci(m.$$.fragment,E),D=!1},d(E){Ai(m,E),E&&be(_),E&&be(k),b[4](null)}}}function Ng(b,m,_){let k;vr(b,wr,ne=>_(6,k=ne));const D=ji.find(ne=>ne.path===k);let E,P,a=[];Rr(()=>{const ne=new Fr.Map({container:E,style:Or,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});ne.on("load",()=>{P=new Vr(ne,{requestOptions:{alternatives:"true"}}),P.interactive=!0,P.on("addwaypoint",W=>{var j,se;a.push(`<strong>${W.type}</strong>: waypoint added at index <strong>${(j=W.data)==null?void 0:j.index}</strong>. Original event - <strong>${(se=W.originalEvent)==null?void 0:se.type}</strong>`),_(1,a)}),P.on("removewaypoint",W=>{var j,se;a.push(`<strong>${W.type}</strong>: waypoint removed at index <strong>${(j=W.data)==null?void 0:j.index}</strong>. Original event - <strong>${(se=W.originalEvent)==null?void 0:se.type}</strong>`),_(1,a)}),P.on("movewaypoint",W=>{var j,se,de,Ce;a.push(`<strong>${W.type}</strong>: waypoint at index <strong>${(j=W.data)==null?void 0:j.index}</strong> moved from coordinates ${(de=(se=W.data)==null?void 0:se.initialCoordinates)==null?void 0:de.map(je=>je.toFixed(5)).join(", ")}. Original event - <strong>${(Ce=W.originalEvent)==null?void 0:Ce.type}</strong>`),_(1,a)}),P.on("fetchroutesstart",W=>{a.push(`<strong>${W.type}</strong>: routing request started. Original event - <strong>${W.originalEvent.type}</strong>`),_(1,a)}),P.on("fetchroutesend",W=>{var j;a.push(`<strong>${W.type}</strong>: routing request finished with code <strong>${(j=W.data)==null?void 0:j.code}</strong>. Original event - <strong>${W.originalEvent.type}</strong>`),_(1,a)})})});const U=()=>_(1,a=[]);function G(ne){ur[ne?"unshift":"push"](()=>{E=ne,_(0,E)})}return[E,a,D,U,G]}class jg extends Gi{constructor(m){super(),qi(this,m,Ng,$g,Ri,{})}}var qg=Object.freeze(Object.defineProperty({__proto__:null,default:jg},Symbol.toStringTag,{value:"Module"}));function Gg(b){let m,_,k,D,E,P,a,U,G,ne,W,j,se,de,Ce;return{c(){m=Ee("button"),_=_i("Abort Manually"),D=it(),E=Ee("p"),E.innerHTML=`Instead of aborting routing-requests manually, you can set the <code>requestTimeout</code> configuration option to a
    number of ms that a routing-request is allowed to take before getting automatically aborted.`,P=it(),a=Ee("label"),U=Ee("span"),U.innerHTML="<strong>Request Timeout</strong>",G=it(),ne=Ee("input"),j=it(),se=Ee("small"),se.innerHTML=`<strong>Note</strong> that you may need to manually
    <a href="https://www.browserstack.com/guide/how-to-perform-network-throttling-in-chrome" target="_blank">enable network throttling</a> for the setting above to take effect`,m.disabled=k=!b[0],tt(ne,"type","number"),ne.disabled=W=!b[0],tt(a,"class","flex flex-col gap-2")},m(je,nt){ve(je,m,nt),He(m,_),ve(je,D,nt),ve(je,E,nt),ve(je,P,nt),ve(je,a,nt),He(a,U),He(a,G),He(a,ne),$h(ne,b[1]),ve(je,j,nt),ve(je,se,nt),de||(Ce=[cr(m,"click",b[4]),cr(ne,"input",b[6])],de=!0)},p(je,nt){nt&1&&k!==(k=!je[0])&&(m.disabled=k),nt&1&&W!==(W=!je[0])&&(ne.disabled=W),nt&2&&dp(ne.value)!==je[1]&&$h(ne,je[1])},d(je){je&&be(m),je&&be(D),je&&be(E),je&&be(P),je&&be(a),je&&be(j),je&&be(se),de=!1,Pn(Ce)}}}function Zg(b){let m;return{c(){m=Ee("span"),m.textContent=`${b[3].name}`,tt(m,"slot","title")},m(_,k){ve(_,m,k)},p:Vt,d(_){_&&be(m)}}}function Hg(b){let m,_,k,D;return m=new Ar({props:{$$slots:{title:[Zg],default:[Gg]},$$scope:{ctx:b}}}),{c(){Ti(m.$$.fragment),_=it(),k=Ee("div"),tt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(E,P){wi(m,E,P),ve(E,_,P),ve(E,k,P),b[7](k),D=!0},p(E,[P]){const a={};P&515&&(a.$$scope={dirty:P,ctx:E}),m.$set(a)},i(E){D||(ii(m.$$.fragment,E),D=!0)},o(E){ci(m.$$.fragment,E),D=!1},d(E){Ai(m,E),E&&be(_),E&&be(k),b[7](null)}}}function Wg(b,m,_){let k;vr(b,wr,j=>_(8,k=j));const D=ji.find(j=>j.path===k);let E,P,a,U=1e3;Rr(()=>{const j=new Fr.Map({container:E,style:Or,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});j.on("load",()=>{_(5,P=j)})});function G(){var j;(j=a==null?void 0:a.abortController)==null||j.abort()}function ne(){U=dp(this.value),_(1,U)}function W(j){ur[j?"unshift":"push"](()=>{E=j,_(2,E)})}return b.$$.update=()=>{b.$$.dirty&35&&P&&(a&&a.destroy(),_(0,a=new Vr(P,{requestOptions:{alternatives:"true"},requestTimeout:U})),_(0,a.interactive=!0,a))},[a,U,E,D,G,P,ne,W]}class Xg extends Gi{constructor(m){super(),qi(this,m,Wg,Hg,Ri,{})}}var Yg=Object.freeze(Object.defineProperty({__proto__:null,default:Xg},Symbol.toStringTag,{value:"Module"}));function Kg(b){let m,_,k,D,E,P,a,U,G,ne,W,j,se;return{c(){m=Ee("label"),_=Ee("span"),_.innerHTML="<strong>Position</strong>",k=it(),D=Ee("select"),E=Ee("option"),E.textContent="Top-Left",P=Ee("option"),P.textContent="Top-Right",a=Ee("option"),a.textContent="Bottom-Left",U=Ee("option"),U.textContent="Bottom-Right",ne=it(),W=Ee("p"),W.innerHTML=`The <code>LoadingIndicatorControl</code> adds a simple spinning loader-icon which automatically appears whenever there&#39;s
    an ongoing routing-request.`,E.__value="top-left",E.value=E.__value,P.__value="top-right",P.value=P.__value,a.__value="bottom-left",a.value=a.__value,U.__value="bottom-right",U.value=U.__value,D.disabled=G=!b[0],b[1]===void 0&&Ms(()=>b[6].call(D)),tt(m,"class","flex flex-col gap-2")},m(de,Ce){ve(de,m,Ce),He(m,_),He(m,k),He(m,D),He(D,E),He(D,P),He(D,a),He(D,U),Fl(D,b[1]),ve(de,ne,Ce),ve(de,W,Ce),j||(se=cr(D,"change",b[6]),j=!0)},p(de,Ce){Ce&1&&G!==(G=!de[0])&&(D.disabled=G),Ce&2&&Fl(D,de[1])},d(de){de&&be(m),de&&be(ne),de&&be(W),j=!1,se()}}}function Jg(b){let m;return{c(){m=Ee("span"),m.textContent=`${b[3].name}`,tt(m,"slot","title")},m(_,k){ve(_,m,k)},p:Vt,d(_){_&&be(m)}}}function Qg(b){let m,_,k,D;return m=new Ar({props:{$$slots:{title:[Jg],default:[Kg]},$$scope:{ctx:b}}}),{c(){Ti(m.$$.fragment),_=it(),k=Ee("div"),tt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(E,P){wi(m,E,P),ve(E,_,P),ve(E,k,P),b[7](k),D=!0},p(E,[P]){const a={};P&515&&(a.$$scope={dirty:P,ctx:E}),m.$set(a)},i(E){D||(ii(m.$$.fragment,E),D=!0)},o(E){ci(m.$$.fragment,E),D=!1},d(E){Ai(m,E),E&&be(_),E&&be(k),b[7](null)}}}function e1(b,m,_){let k;vr(b,wr,j=>_(8,k=j));const D=ji.find(j=>j.path===k);let E,P,a;Rr(()=>{_(4,P=new Fr.Map({container:E,style:Or,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"})),P.on("load",()=>{_(0,a=new Vr(P,{requestOptions:{alternatives:"true"}})),_(0,a.interactive=!0,a)})});let U,G="top-right";function ne(){G=fp(this),_(1,G)}function W(j){ur[j?"unshift":"push"](()=>{E=j,_(2,E)})}return b.$$.update=()=>{b.$$.dirty&51&&P&&a&&(U&&P.hasControl(U)&&P.removeControl(U),P.addControl(_(5,U=new Ef(a,{class:"m-2"})),G))},[a,G,E,D,P,U,ne,W]}class t1 extends Gi{constructor(m){super(),qi(this,m,e1,Qg,Ri,{})}}var i1=Object.freeze(Object.defineProperty({__proto__:null,default:t1},Symbol.toStringTag,{value:"Module"}));function ap(b,m,_){const k=b.slice();return k[0]=m[_],k}function sp(b){let m,_,k=b[0].name+"",D,E,P,a,U,G;return{c(){m=Ee("li"),_=Ee("a"),D=_i(k),a=it(),tt(_,"href",E=b[0].path),tt(_,"class","svelte-1jo4v3w"),tt(m,"class","svelte-1jo4v3w")},m(ne,W){ve(ne,m,W),He(m,_),He(_,D),He(m,a),U||(G=ou(P=cu.call(null,_)),U=!0)},p:Vt,d(ne){ne&&be(m),U=!1,G()}}}function r1(b){let m,_=ji.sort(lp),k=[];for(let D=0;D<_.length;D+=1)k[D]=sp(ap(b,_,D));return{c(){m=Ee("ul");for(let D=0;D<k.length;D+=1)k[D].c();tt(m,"class","svelte-1jo4v3w")},m(D,E){ve(D,m,E);for(let P=0;P<k.length;P+=1)k[P].m(m,null)},p(D,E){if(E&0){_=ji.sort(lp);let P;for(P=0;P<_.length;P+=1){const a=ap(D,_,P);k[P]?k[P].p(a,E):(k[P]=sp(a),k[P].c(),k[P].m(m,null))}for(;P<k.length;P+=1)k[P].d(1);k.length=_.length}},d(D){D&&be(m),pp(k,D)}}}function n1(b){let m;return{c(){m=Ee("span"),m.textContent="Examples",tt(m,"slot","title"),tt(m,"class","svelte-1jo4v3w")},m(_,k){ve(_,m,k)},p:Vt,d(_){_&&be(m)}}}function o1(b){let m,_,k,D;return m=new Ar({props:{noHeader:!0,$$slots:{title:[n1],default:[r1]},$$scope:{ctx:b}}}),{c(){Ti(m.$$.fragment),_=it(),k=Ee("div"),k.innerHTML=`<div class="p-5 lg:p-10 h-full flex flex-col gap-5 lg:gap-10 justify-start lg:justify-center items-center flex-col bg-inherit overflow-x-hidden overflow-y-auto svelte-1jo4v3w"><h1 class="text-center max-w-3xl svelte-1jo4v3w">Please, choose an example at the sidebar on the left</h1> 

    <span class="text-slate-500 svelte-1jo4v3w">or navigate to</span> 

    <div class="flex flex-col gap-2.5 lg:gap-5 justify-center items-center svelte-1jo4v3w"><a href="https://github.com/maplibre/maplibre-gl-directions" target="_blank" class="svelte-1jo4v3w">GitHub</a> 
      <a href="/maplibre-gl-directions//api" target="_blank" class="svelte-1jo4v3w">API</a></div></div>`,tt(k,"class","basis-full lg:basis-2/3 overflow-hidden rounded-3xl shadow-xl svelte-1jo4v3w")},m(E,P){wi(m,E,P),ve(E,_,P),ve(E,k,P),D=!0},p(E,[P]){const a={};P&8&&(a.$$scope={dirty:P,ctx:E}),m.$set(a)},i(E){D||(ii(m.$$.fragment,E),D=!0)},o(E){ci(m.$$.fragment,E),D=!1},d(E){Ai(m,E),E&&be(_),E&&be(k)}}}const lp=(b,m)=>b.index-m.index;class a1 extends Gi{constructor(m){super(),qi(this,m,null,o1,Ri,{})}}const ji=Object.entries({"./examples/1 User Interaction.svelte":Cf,"./examples/10 Restyling.svelte":Nf,"./examples/11 Distance Measurement.svelte":Qf,"./examples/12 Load and Save.svelte":sg,"./examples/2 Programmatical Control.svelte":dg,"./examples/3 Mapbox Directions API and Congestions.svelte":xg,"./examples/4 Origin and Destination.svelte":Sg,"./examples/5 Show Routes' Directions.svelte":Pg,"./examples/6 Touch-Friendly Features.svelte":Og,"./examples/7 Events.svelte":qg,"./examples/8 Aborting Requests.svelte":Yg,"./examples/9 Loading Indicator Control.svelte":i1}).map(([b,m])=>{const _=b.match(/\/(\d+)\s([^/]+)\./),k=parseInt(_[1]),D=_[2];return{path:"/examples/"+D.toLowerCase().replaceAll(/\s/g,"-"),index:k,name:D,component:m,sourceUrl:`https://github.com/maplibre/maplibre-gl-directions/tree/main/demo/src/${b}`}}),pu={};ji.forEach(b=>{pu[b.path]=b.component.default});pu["*"]=a1;function s1(b){let m,_,k;return _=new jm({props:{routes:pu}}),{c(){m=Ee("main"),Ti(_.$$.fragment),tt(m,"class","p-5 lg:p-10 flex flex-col lg:flex-row landscape:flex-row w-full gap-5 lg:gap-10")},m(D,E){ve(D,m,E),wi(_,m,null),k=!0},p:Vt,i(D){k||(ii(_.$$.fragment,D),k=!0)},o(D){ci(_.$$.fragment,D),k=!1},d(D){D&&be(m),Ai(_)}}}class l1 extends Gi{constructor(m){super(),qi(this,m,null,s1,Ri,{})}}new l1({target:document.getElementById("app")});
