var sm=Object.defineProperty;var om=(_,f,x)=>f in _?sm(_,f,{enumerable:!0,configurable:!0,writable:!0,value:x}):_[f]=x;var Iu=(_,f,x)=>(om(_,typeof f!="symbol"?f+"":f,x),x);(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const D of document.querySelectorAll('link[rel="modulepreload"]'))E(D);new MutationObserver(D=>{for(const S of D)if(S.type==="childList")for(const C of S.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&E(C)}).observe(document,{childList:!0,subtree:!0});function x(D){const S={};return D.integrity&&(S.integrity=D.integrity),D.referrerPolicy&&(S.referrerPolicy=D.referrerPolicy),D.crossOrigin==="use-credentials"?S.credentials="include":D.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function E(D){if(D.ep)return;D.ep=!0;const S=x(D);fetch(D.href,S)}})();function Nt(){}function Du(_,f){for(const x in f)_[x]=f[x];return _}function Zp(_){return _()}function _p(){return Object.create(null)}function Lr(_){_.forEach(Zp)}function fc(_){return typeof _=="function"}function ln(_,f){return _!=_?f==f:_!==f||_&&typeof _=="object"||typeof _=="function"}function am(_){return Object.keys(_).length===0}function Wp(_,...f){if(_==null)return Nt;const x=_.subscribe(...f);return x.unsubscribe?()=>x.unsubscribe():x}function Xn(_,f,x){_.$$.on_destroy.push(Wp(f,x))}function yp(_,f,x,E){if(_){const D=Hp(_,f,x,E);return _[0](D)}}function Hp(_,f,x,E){return _[1]&&E?Du(x.ctx.slice(),_[1](E(f))):x.ctx}function xp(_,f,x,E){if(_[2]&&E){const D=_[2](E(x));if(f.dirty===void 0)return D;if(typeof D=="object"){const S=[],C=Math.max(f.dirty.length,D.length);for(let o=0;o<C;o+=1)S[o]=f.dirty[o]|D[o];return S}return f.dirty|D}return f.dirty}function vp(_,f,x,E,D,S){if(D){const C=Hp(f,x,E,S);_.p(C,D)}}function bp(_){if(_.ctx.length>32){const f=[],x=_.ctx.length/32;for(let E=0;E<x;E++)f[E]=-1;return f}return-1}function Lu(_){return _&&fc(_.destroy)?_.destroy:Nt}const lm=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;"WeakMap"in lm;function Ae(_,f){_.appendChild(f)}function fe(_,f,x){_.insertBefore(f,x||null)}function de(_){_.parentNode&&_.parentNode.removeChild(_)}function Xp(_,f){for(let x=0;x<_.length;x+=1)_[x]&&_[x].d(f)}function me(_){return document.createElement(_)}function Li(_){return document.createTextNode(_)}function Oe(){return Li(" ")}function mc(){return Li("")}function Zt(_,f,x,E){return _.addEventListener(f,x,E),()=>_.removeEventListener(f,x,E)}function Be(_,f,x){x==null?_.removeAttribute(f):_.getAttribute(f)!==x&&_.setAttribute(f,x)}function pi(_){return _===""?null:+_}function cm(_){return Array.from(_.childNodes)}function Ru(_,f){f=""+f,_.data!==f&&(_.data=f)}function hi(_,f){_.value=f??""}function uc(_,f,x){for(let E=0;E<_.options.length;E+=1){const D=_.options[E];if(D.__value===f){D.selected=!0;return}}(!x||f!==void 0)&&(_.selectedIndex=-1)}function Yp(_){const f=_.querySelector(":checked");return f&&f.__value}function wp(_,f,x){_.classList[x?"add":"remove"](f)}function um(_,f,{bubbles:x=!1,cancelable:E=!1}={}){const D=document.createEvent("CustomEvent");return D.initCustomEvent(_,x,E,f),D}function hc(_,f){return new _(f)}let el;function Ja(_){el=_}function gc(){if(!el)throw new Error("Function called outside component initialization");return el}function ur(_){gc().$$.on_mount.push(_)}function hm(_){gc().$$.after_update.push(_)}function pm(_){gc().$$.on_destroy.push(_)}function dm(){const _=gc();return(f,x,{cancelable:E=!1}={})=>{const D=_.$$.callbacks[f];if(D){const S=um(f,x,{cancelable:E});return D.slice().forEach(C=>{C.call(_,S)}),!S.defaultPrevented}return!0}}function Tp(_,f){const x=_.$$.callbacks[f.type];x&&x.slice().forEach(E=>E.call(this,f))}const Go=[],$n=[];let Wo=[];const Sp=[],Kp=Promise.resolve();let Cu=!1;function Jp(){Cu||(Cu=!0,Kp.then(Qp))}function fm(){return Jp(),Kp}function tl(_){Wo.push(_)}const Au=new Set;let $o=0;function Qp(){if($o!==0)return;const _=el;do{try{for(;$o<Go.length;){const f=Go[$o];$o++,Ja(f),mm(f.$$)}}catch(f){throw Go.length=0,$o=0,f}for(Ja(null),Go.length=0,$o=0;$n.length;)$n.pop()();for(let f=0;f<Wo.length;f+=1){const x=Wo[f];Au.has(x)||(Au.add(x),x())}Wo.length=0}while(Go.length);for(;Sp.length;)Sp.pop()();Cu=!1,Au.clear(),Ja(_)}function mm(_){if(_.fragment!==null){_.update(),Lr(_.before_update);const f=_.dirty;_.dirty=[-1],_.fragment&&_.fragment.p(_.ctx,f),_.after_update.forEach(tl)}}function gm(_){const f=[],x=[];Wo.forEach(E=>_.indexOf(E)===-1?f.push(E):x.push(E)),x.forEach(E=>E()),Wo=f}const lc=new Set;let Zs;function Bu(){Zs={r:0,c:[],p:Zs}}function Fu(){Zs.r||Lr(Zs.c),Zs=Zs.p}function di(_,f){_&&_.i&&(lc.delete(_),_.i(f))}function Ti(_,f,x,E){if(_&&_.o){if(lc.has(_))return;lc.add(_),Zs.c.push(()=>{lc.delete(_),E&&(x&&_.d(1),E())}),_.o(f)}else E&&E()}function ed(_,f){const x={},E={},D={$$scope:1};let S=_.length;for(;S--;){const C=_[S],o=f[S];if(o){for(const U in C)U in o||(E[U]=1);for(const U in o)D[U]||(x[U]=o[U],D[U]=1);_[S]=o}else for(const U in C)D[U]=1}for(const C in E)C in x||(x[C]=void 0);return x}function td(_){return typeof _=="object"&&_!==null?_:{}}const _m=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"];[..._m];function Xi(_){_&&_.c()}function $i(_,f,x,E){const{fragment:D,after_update:S}=_.$$;D&&D.m(f,x),E||tl(()=>{const C=_.$$.on_mount.map(Zp).filter(fc);_.$$.on_destroy?_.$$.on_destroy.push(...C):Lr(C),_.$$.on_mount=[]}),S.forEach(tl)}function ji(_,f){const x=_.$$;x.fragment!==null&&(gm(x.after_update),Lr(x.on_destroy),x.fragment&&x.fragment.d(f),x.on_destroy=x.fragment=null,x.ctx=[])}function ym(_,f){_.$$.dirty[0]===-1&&(Go.push(_),Jp(),_.$$.dirty.fill(0)),_.$$.dirty[f/31|0]|=1<<f%31}function gn(_,f,x,E,D,S,C,o=[-1]){const U=el;Ja(_);const z=_.$$={fragment:null,ctx:[],props:S,update:Nt,not_equal:D,bound:_p(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(f.context||(U?U.$$.context:[])),callbacks:_p(),dirty:o,skip_bound:!1,root:f.target||U.$$.root};C&&C(z.root);let ie=!1;if(z.ctx=x?x(_,f.props||{},(W,ae,...he)=>{const _e=he.length?he[0]:ae;return z.ctx&&D(z.ctx[W],z.ctx[W]=_e)&&(!z.skip_bound&&z.bound[W]&&z.bound[W](_e),ie&&ym(_,W)),ae}):[],z.update(),ie=!0,Lr(z.before_update),z.fragment=E?E(z.ctx):!1,f.target){if(f.hydrate){const W=cm(f.target);z.fragment&&z.fragment.l(W),W.forEach(de)}else z.fragment&&z.fragment.c();f.intro&&di(_.$$.fragment),$i(_,f.target,f.anchor,f.customElement),Qp()}Ja(U)}class _n{$destroy(){ji(this,1),this.$destroy=Nt}$on(f,x){if(!fc(x))return Nt;const E=this.$$.callbacks[f]||(this.$$.callbacks[f]=[]);return E.push(x),()=>{const D=E.indexOf(x);D!==-1&&E.splice(D,1)}}$set(f){this.$$set&&!am(f)&&(this.$$.skip_bound=!0,this.$$set(f),this.$$.skip_bound=!1)}}const jo=[];function id(_,f){return{subscribe:nd(_,f).subscribe}}function nd(_,f=Nt){let x;const E=new Set;function D(o){if(ln(_,o)&&(_=o,x)){const U=!jo.length;for(const z of E)z[1](),jo.push(z,_);if(U){for(let z=0;z<jo.length;z+=2)jo[z][0](jo[z+1]);jo.length=0}}}function S(o){D(o(_))}function C(o,U=Nt){const z=[o,U];return E.add(z),E.size===1&&(x=f(D)||Nt),o(_),()=>{E.delete(z),E.size===0&&x&&(x(),x=null)}}return{set:D,update:S,subscribe:C}}function rd(_,f,x){const E=!Array.isArray(_),D=E?[_]:_,S=f.length<2;return id(x,C=>{let o=!1;const U=[];let z=0,ie=Nt;const W=()=>{if(z)return;ie();const he=f(E?U[0]:U,C);S?C(he):ie=fc(he)?he:Nt},ae=D.map((he,_e)=>Wp(he,Pe=>{U[_e]=Pe,z&=~(1<<_e),o&&W()},()=>{z|=1<<_e}));return o=!0,W(),function(){Lr(ae),ie(),o=!1}})}function xm(_,f){if(_ instanceof RegExp)return{keys:!1,pattern:_};var x,E,D,S,C=[],o="",U=_.split("/");for(U[0]||U.shift();D=U.shift();)x=D[0],x==="*"?(C.push("wild"),o+="/(.*)"):x===":"?(E=D.indexOf("?",1),S=D.indexOf(".",1),C.push(D.substring(1,~E?E:~S?S:D.length)),o+=~E&&!~S?"(?:/([^/]+?))?":"/([^/]+?)",~S&&(o+=(~E?"?":"")+"\\"+D.substring(S))):o+="/"+D;return{keys:C,pattern:new RegExp("^"+o+(f?"(?=$|/)":"/?$"),"i")}}function vm(_){let f,x,E;const D=[_[2]];var S=_[0];function C(o){let U={};for(let z=0;z<D.length;z+=1)U=Du(U,D[z]);return{props:U}}return S&&(f=hc(S,C()),f.$on("routeEvent",_[7])),{c(){f&&Xi(f.$$.fragment),x=mc()},m(o,U){f&&$i(f,o,U),fe(o,x,U),E=!0},p(o,U){const z=U&4?ed(D,[td(o[2])]):{};if(U&1&&S!==(S=o[0])){if(f){Bu();const ie=f;Ti(ie.$$.fragment,1,0,()=>{ji(ie,1)}),Fu()}S?(f=hc(S,C()),f.$on("routeEvent",o[7]),Xi(f.$$.fragment),di(f.$$.fragment,1),$i(f,x.parentNode,x)):f=null}else S&&f.$set(z)},i(o){E||(f&&di(f.$$.fragment,o),E=!0)},o(o){f&&Ti(f.$$.fragment,o),E=!1},d(o){o&&de(x),f&&ji(f,o)}}}function bm(_){let f,x,E;const D=[{params:_[1]},_[2]];var S=_[0];function C(o){let U={};for(let z=0;z<D.length;z+=1)U=Du(U,D[z]);return{props:U}}return S&&(f=hc(S,C()),f.$on("routeEvent",_[6])),{c(){f&&Xi(f.$$.fragment),x=mc()},m(o,U){f&&$i(f,o,U),fe(o,x,U),E=!0},p(o,U){const z=U&6?ed(D,[U&2&&{params:o[1]},U&4&&td(o[2])]):{};if(U&1&&S!==(S=o[0])){if(f){Bu();const ie=f;Ti(ie.$$.fragment,1,0,()=>{ji(ie,1)}),Fu()}S?(f=hc(S,C()),f.$on("routeEvent",o[6]),Xi(f.$$.fragment),di(f.$$.fragment,1),$i(f,x.parentNode,x)):f=null}else S&&f.$set(z)},i(o){E||(f&&di(f.$$.fragment,o),E=!0)},o(o){f&&Ti(f.$$.fragment,o),E=!1},d(o){o&&de(x),f&&ji(f,o)}}}function wm(_){let f,x,E,D;const S=[bm,vm],C=[];function o(U,z){return U[1]?0:1}return f=o(_),x=C[f]=S[f](_),{c(){x.c(),E=mc()},m(U,z){C[f].m(U,z),fe(U,E,z),D=!0},p(U,[z]){let ie=f;f=o(U),f===ie?C[f].p(U,z):(Bu(),Ti(C[ie],1,1,()=>{C[ie]=null}),Fu(),x=C[f],x?x.p(U,z):(x=C[f]=S[f](U),x.c()),di(x,1),x.m(E.parentNode,E))},i(U){D||(di(x),D=!0)},o(U){Ti(x),D=!1},d(U){C[f].d(U),U&&de(E)}}}function Ep(){const _=window.location.href.indexOf("#/");let f=_>-1?window.location.href.substr(_+1):"/";const x=f.indexOf("?");let E="";return x>-1&&(E=f.substr(x+1),f=f.substr(0,x)),{location:f,querystring:E}}const Ou=id(null,function(f){f(Ep());const x=()=>{f(Ep())};return window.addEventListener("hashchange",x,!1),function(){window.removeEventListener("hashchange",x,!1)}}),Yn=rd(Ou,_=>_.location);rd(Ou,_=>_.querystring);const Ip=nd(void 0);function Uu(_,f){if(f=Mp(f),!_||!_.tagName||_.tagName.toLowerCase()!="a")throw Error('Action "link" can only be used with <a> tags');return Ap(_,f),{update(x){x=Mp(x),Ap(_,x)}}}function Tm(_){_?window.scrollTo(_.__svelte_spa_router_scrollX,_.__svelte_spa_router_scrollY):window.scrollTo(0,0)}function Ap(_,f){let x=f.href||_.getAttribute("href");if(x&&x.charAt(0)=="/")x="#"+x;else if(!x||x.length<2||x.slice(0,2)!="#/")throw Error('Invalid value for "href" attribute: '+x);_.setAttribute("href",x),_.addEventListener("click",E=>{E.preventDefault(),f.disabled||Sm(E.currentTarget.getAttribute("href"))})}function Mp(_){return _&&typeof _=="string"?{href:_}:_||{}}function Sm(_){history.replaceState({...history.state,__svelte_spa_router_scrollX:window.scrollX,__svelte_spa_router_scrollY:window.scrollY},void 0),window.location.hash=_}function Em(_,f,x){let{routes:E={}}=f,{prefix:D=""}=f,{restoreScrollState:S=!1}=f;class C{constructor(nt,Ee){if(!Ee||typeof Ee!="function"&&(typeof Ee!="object"||Ee._sveltesparouter!==!0))throw Error("Invalid component object");if(!nt||typeof nt=="string"&&(nt.length<1||nt.charAt(0)!="/"&&nt.charAt(0)!="*")||typeof nt=="object"&&!(nt instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:Qe,keys:ht}=xm(nt);this.path=nt,typeof Ee=="object"&&Ee._sveltesparouter===!0?(this.component=Ee.component,this.conditions=Ee.conditions||[],this.userData=Ee.userData,this.props=Ee.props||{}):(this.component=()=>Promise.resolve(Ee),this.conditions=[],this.props={}),this._pattern=Qe,this._keys=ht}match(nt){if(D){if(typeof D=="string")if(nt.startsWith(D))nt=nt.substr(D.length)||"/";else return null;else if(D instanceof RegExp){const At=nt.match(D);if(At&&At[0])nt=nt.substr(At[0].length)||"/";else return null}}const Ee=this._pattern.exec(nt);if(Ee===null)return null;if(this._keys===!1)return Ee;const Qe={};let ht=0;for(;ht<this._keys.length;){try{Qe[this._keys[ht]]=decodeURIComponent(Ee[ht+1]||"")||null}catch{Qe[this._keys[ht]]=null}ht++}return Qe}async checkConditions(nt){for(let Ee=0;Ee<this.conditions.length;Ee++)if(!await this.conditions[Ee](nt))return!1;return!0}}const o=[];E instanceof Map?E.forEach((qe,nt)=>{o.push(new C(nt,qe))}):Object.keys(E).forEach(qe=>{o.push(new C(qe,E[qe]))});let U=null,z=null,ie={};const W=dm();async function ae(qe,nt){await fm(),W(qe,nt)}let he=null,_e=null;S&&(_e=qe=>{qe.state&&(qe.state.__svelte_spa_router_scrollY||qe.state.__svelte_spa_router_scrollX)?he=qe.state:he=null},window.addEventListener("popstate",_e),hm(()=>{Tm(he)}));let Pe=null,je=null;const Se=Ou.subscribe(async qe=>{Pe=qe;let nt=0;for(;nt<o.length;){const Ee=o[nt].match(qe.location);if(!Ee){nt++;continue}const Qe={route:o[nt].path,location:qe.location,querystring:qe.querystring,userData:o[nt].userData,params:Ee&&typeof Ee=="object"&&Object.keys(Ee).length?Ee:null};if(!await o[nt].checkConditions(Qe)){x(0,U=null),je=null,ae("conditionsFailed",Qe);return}ae("routeLoading",Object.assign({},Qe));const ht=o[nt].component;if(je!=ht){ht.loading?(x(0,U=ht.loading),je=ht,x(1,z=ht.loadingParams),x(2,ie={}),ae("routeLoaded",Object.assign({},Qe,{component:U,name:U.name,params:z}))):(x(0,U=null),je=null);const At=await ht();if(qe!=Pe)return;x(0,U=At&&At.default||At),je=ht}Ee&&typeof Ee=="object"&&Object.keys(Ee).length?x(1,z=Ee):x(1,z=null),x(2,ie=o[nt].props),ae("routeLoaded",Object.assign({},Qe,{component:U,name:U.name,params:z})).then(()=>{Ip.set(z)});return}x(0,U=null),je=null,Ip.set(void 0)});pm(()=>{Se(),_e&&window.removeEventListener("popstate",_e)});function Xe(qe){Tp.call(this,_,qe)}function ze(qe){Tp.call(this,_,qe)}return _.$$set=qe=>{"routes"in qe&&x(3,E=qe.routes),"prefix"in qe&&x(4,D=qe.prefix),"restoreScrollState"in qe&&x(5,S=qe.restoreScrollState)},_.$$.update=()=>{_.$$.dirty&32&&(history.scrollRestoration=S?"manual":"auto")},[U,z,ie,E,D,S,Xe,ze]}class Im extends _n{constructor(f){super(),gn(this,f,Em,wm,ln,{routes:3,prefix:4,restoreScrollState:5})}}const Am=_=>({}),Cp=_=>({});function Pp(_){let f,x,E,D,S,C,o;return{c(){f=me("header"),x=me("a"),x.textContent="Back to Menu",E=Oe(),D=me("a"),S=Li("Source"),Be(x,"href","/"),Be(x,"class","svelte-1jo4v3w"),Be(D,"href",_[1].sourceUrl),Be(D,"target","_blank"),Be(D,"rel","noreferrer"),Be(D,"class","svelte-1jo4v3w"),Be(f,"class","p-5 lg:p-10 pb-2.5 lg:pb-5 flex justify-between gap-2.5 lg:gap-5 sticky top-0 bg-inherit svelte-1jo4v3w")},m(U,z){fe(U,f,z),Ae(f,x),Ae(f,E),Ae(f,D),Ae(D,S),C||(o=Lu(Uu.call(null,x)),C=!0)},p:Nt,d(U){U&&de(f),C=!1,o()}}}function Mm(_){let f,x,E,D,S,C,o,U=!_[0]&&Pp(_);const z=_[3].title,ie=yp(z,_,_[2],Cp),W=_[3].default,ae=yp(W,_,_[2],null);return{c(){f=me("aside"),x=me("div"),U&&U.c(),E=Oe(),D=me("article"),S=me("h1"),ie&&ie.c(),C=Oe(),ae&&ae.c(),Be(S,"class","break-all svelte-1jo4v3w"),Be(D,"class","p-5 lg:p-10 flex flex-col gap-1.5 lg:gap-3 svelte-1jo4v3w"),wp(D,"!pt-0",!_[0]),Be(x,"class","h-full flex flex-col bg-inherit overflow-x-hidden overflow-y-auto svelte-1jo4v3w"),Be(f,"class","basis-full lg:basis-1/3 overflow-hidden shadow-xl svelte-1jo4v3w")},m(he,_e){fe(he,f,_e),Ae(f,x),U&&U.m(x,null),Ae(x,E),Ae(x,D),Ae(D,S),ie&&ie.m(S,null),Ae(D,C),ae&&ae.m(D,null),o=!0},p(he,[_e]){he[0]?U&&(U.d(1),U=null):U?U.p(he,_e):(U=Pp(he),U.c(),U.m(x,E)),ie&&ie.p&&(!o||_e&4)&&vp(ie,z,he,he[2],o?xp(z,he[2],_e,Am):bp(he[2]),Cp),ae&&ae.p&&(!o||_e&4)&&vp(ae,W,he,he[2],o?xp(W,he[2],_e,null):bp(he[2]),null),(!o||_e&1)&&wp(D,"!pt-0",!he[0])},i(he){o||(di(ie,he),di(ae,he),o=!0)},o(he){Ti(ie,he),Ti(ae,he),o=!1},d(he){he&&de(f),U&&U.d(),ie&&ie.d(he),ae&&ae.d(he)}}}function Cm(_,f,x){let E;Xn(_,Yn,U=>x(4,E=U));let{$$slots:D={},$$scope:S}=f,{noHeader:C=!1}=f;const o=mn.find(U=>U.path===E);return _.$$set=U=>{"noHeader"in U&&x(0,C=U.noHeader),"$$scope"in U&&x(2,S=U.$$scope)},[C,o,S,D]}class Kn extends _n{constructor(f){super(),gn(this,f,Cm,Mm,ln,{noHeader:0})}}var Pm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function km(_){return _&&_.__esModule&&Object.prototype.hasOwnProperty.call(_,"default")?_.default:_}var sd={exports:{}};(function(_,f){(function(x,E){_.exports=E()})(Pm,function(){var x,E,D;function S(o,U){if(!x)x=U;else if(!E)E=U;else{var z="var sharedChunk = {}; ("+x+")(sharedChunk); ("+E+")(sharedChunk);",ie={};x(ie),D=U(ie),typeof window<"u"&&(D.workerUrl=window.URL.createObjectURL(new Blob([z],{type:"text/javascript"})))}}S(["exports"],function(o){function U(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var z=ie;function ie(i,e){this.x=i,this.y=e}ie.prototype={clone:function(){return new ie(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),n=Math.sin(i),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(i,e){var n=Math.cos(i),s=Math.sin(i),c=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ie.convert=function(i){return i instanceof ie?i:Array.isArray(i)?new ie(i[0],i[1]):i};var W=U(z),ae=he;function he(i,e,n,s){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=n,this.p2y=s}he.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,s=0;s<8;s++){var c=this.sampleCurveX(n)-i;if(Math.abs(c)<e)return n;var h=this.sampleCurveDerivativeX(n);if(Math.abs(h)<1e-6)break;n-=c/h}var p=0,m=1;for(n=i,s=0;s<20&&(c=this.sampleCurveX(n),!(Math.abs(c-i)<e));s++)i>c?p=n:m=n,n=.5*(m-p)+p;return n},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var _e=U(ae);function Pe(i,e,n,s){const c=new _e(i,e,n,s);return function(h){return c.solve(h)}}const je=Pe(.25,.1,.25,1);function Se(i,e,n){return Math.min(n,Math.max(e,i))}function Xe(i,e,n){const s=n-e,c=((i-e)%s+s)%s+e;return c===e?n:c}function ze(i,...e){for(const n of e)for(const s in n)i[s]=n[s];return i}let qe=1;function nt(i,e){i.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Ee(i,e,n){const s={};for(const c in i)s[c]=e.call(n||this,i[c],c,i);return s}function Qe(i,e,n){const s={};for(const c in i)e.call(n||this,i[c],c,i)&&(s[c]=i[c]);return s}function ht(i){return Array.isArray(i)?i.map(ht):typeof i=="object"&&i?Ee(i,ht):i}const At={};function Wt(i){At[i]||(typeof console<"u"&&console.warn(i),At[i]=!0)}function yt(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function fi(i){let e=0;for(let n,s,c=0,h=i.length,p=h-1;c<h;p=c++)n=i[c],s=i[p],e+=(s.x-n.x)*(n.y+s.y);return e}function Ht(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Si=null;function mi(i){if(Si==null){const e=i.navigator?i.navigator.userAgent:null;Si=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Si}function Tt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ri,Cn;const Pn={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,n.drawImage(i,0,0,i.width,i.height),n},resolveURL:i=>(Ri||(Ri=document.createElement("a")),Ri.href=i,Ri.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Cn==null&&(Cn=matchMedia("(prefers-reduced-motion: reduce)")),Cn.matches)}},Ei={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class oi extends Error{constructor(e,n,s,c){super(`AJAXError: ${n} (${e}): ${s}`),this.status=e,this.statusText=n,this.url=s,this.body=c}}const Bi=Ht()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Mt=i=>Ei.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function Jn(i,e){const n=new AbortController,s=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Bi(),signal:n.signal});let c=!1,h=!1;return i.type==="json"&&s.headers.set("Accept","application/json"),h||fetch(s).then(p=>p.ok?(m=>{(i.type==="arrayBuffer"||i.type==="image"?m.arrayBuffer():i.type==="json"?m.json():m.text()).then(y=>{h||(c=!0,e(null,y,m.headers.get("Cache-Control"),m.headers.get("Expires")))}).catch(y=>{h||e(new Error(y.message))})})(p):p.blob().then(m=>e(new oi(p.status,p.statusText,i.url,m)))).catch(p=>{p.code!==20&&e(new Error(p.message))}),{cancel:()=>{h=!0,c||n.abort()}}}const ti=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Ht()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!Ht())return(Mt(i.url)||Jn)(i,e)}if(!(/^file:/.test(n=i.url)||/^file:/.test(Bi())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Jn(i,e);if(Ht()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var n;return function(s,c){const h=new XMLHttpRequest;h.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(h.responseType="arraybuffer");for(const p in s.headers)h.setRequestHeader(p,s.headers[p]);return s.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=s.credentials==="include",h.onerror=()=>{c(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let p=h.response;if(s.type==="json")try{p=JSON.parse(h.response)}catch(m){return c(m)}c(null,p,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else{const p=new Blob([h.response],{type:h.getResponseHeader("Content-Type")});c(new oi(h.status,h.statusText,s.url,p))}},h.send(s.body),{cancel:()=>h.abort()}}(i,e)},Yi=function(i,e){return ti(ze(i,{type:"arrayBuffer"}),e)};function Sr(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function Qn(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function Ki(i,e,n){if(n&&n[i]){const s=n[i].indexOf(e);s!==-1&&n[i].splice(s,1)}}class Ji{constructor(e,n={}){ze(this,n),this.type=e}}class yn extends Ji{constructor(e,n={}){super("error",ze({error:e},n))}}class Ii{on(e,n){return this._listeners=this._listeners||{},Qn(e,n,this._listeners),this}off(e,n){return Ki(e,n,this._listeners),Ki(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Qn(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){typeof e=="string"&&(e=new Ji(e,n||{}));const s=e.type;if(this.listens(s)){e.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const m of c)m.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const m of h)Ki(s,m,this._oneTimeListeners),m.call(this,e);const p=this._eventedParent;p&&(ze(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof yn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const dr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function qi(i,e){const n={};for(const s in i)s!=="ref"&&(n[s]=i[s]);return dr.forEach(s=>{s in e&&(n[s]=e[s])}),n}function Dt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!Dt(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!Dt(i[n],e[n]))return!1;return!0}return i===e}const It={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function gi(i,e,n){n.push({command:It.addSource,args:[i,e[i]]})}function Er(i,e,n){e.push({command:It.removeSource,args:[i]}),n[i]=!0}function Ur(i,e,n,s){Er(i,n,s),gi(i,e,n)}function xn(i,e,n){let s;for(s in i[n])if(Object.prototype.hasOwnProperty.call(i[n],s)&&s!=="data"&&!Dt(i[n][s],e[n][s]))return!1;for(s in e[n])if(Object.prototype.hasOwnProperty.call(e[n],s)&&s!=="data"&&!Dt(i[n][s],e[n][s]))return!1;return!0}function ai(i,e,n,s,c,h){let p;for(p in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,p)&&(Dt(i[p],e[p])||n.push({command:h,args:[s,p,e[p],c]}));for(p in e)Object.prototype.hasOwnProperty.call(e,p)&&!Object.prototype.hasOwnProperty.call(i,p)&&(Dt(i[p],e[p])||n.push({command:h,args:[s,p,e[p],c]}))}function er(i){return i.id}function kn(i,e){return i[e.id]=e,i}class Re{constructor(e,n,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function Gi(i,...e){for(const n of e)for(const s in n)i[s]=n[s];return i}class ii extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class cn{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[s,c]of n)this.bindings[s]=c}concat(e){return new cn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const zn={kind:"null"},De={kind:"number"},dt={kind:"string"},pt={kind:"boolean"},jt={kind:"color"},Qi={kind:"object"},rt={kind:"value"},Zi={kind:"collator"},Wi={kind:"formatted"},tr={kind:"padding"},ir={kind:"resolvedImage"};function _i(i,e){return{kind:"array",itemType:i,N:e}}function j(i){if(i.kind==="array"){const e=j(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const k=[zn,De,dt,pt,jt,Wi,Qi,_i(rt),tr,ir];function R(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!R(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of k)if(!R(n,e))return null}}return`Expected ${j(i)} but found ${j(e)} instead.`}function N(i,e){return e.some(n=>n.kind===i.kind)}function Y(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function Q(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const se=.96422,re=.82521,V=4/29,J=6/29,be=3*J*J,xe=Math.PI/180,we=180/Math.PI;function st(i){return(i%=360)<0&&(i+=360),i}function ft([i,e,n,s]){let c,h;const p=ot((.2225045*(i=et(i))+.7168786*(e=et(e))+.0606169*(n=et(n)))/1);i===e&&e===n?c=h=p:(c=ot((.4360747*i+.3850649*e+.1430804*n)/se),h=ot((.0139322*i+.0971045*e+.7141733*n)/re));const m=116*p-16;return[m<0?0:m,500*(c-p),200*(p-h),s]}function et(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ot(i){return i>.008856451679035631?Math.pow(i,1/3):i/be+V}function gt([i,e,n,s]){let c=(i+16)/116,h=isNaN(e)?c:c+e/500,p=isNaN(n)?c:c-n/200;return c=1*xt(c),h=se*xt(h),p=re*xt(p),[Et(3.1338561*h-1.6168667*c-.4906146*p),Et(-.9787684*h+1.9161415*c+.033454*p),Et(.0719453*h-.2289914*c+1.4052427*p),s]}function Et(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function xt(i){return i>J?i*i*i:be*(i-V)}function Rt(i){return parseInt(i.padEnd(2,i),16)/255}function Ft(i,e){return Kt(e?i/100:i,0,1)}function Kt(i,e,n){return Math.min(Math.max(e,i),n)}function ni(i){return!i.some(Number.isNaN)}const yi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ct{constructor(e,n,s,c=1,h=!0){this.r=e,this.g=n,this.b=s,this.a=c,h||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[e,n,s,c]))}static parse(e){if(e instanceof Ct)return e;if(typeof e!="string")return;const n=function(s){if((s=s.toLowerCase())==="transparent")return[0,0,0,0];const c=yi[s];if(c){const[m,y,w]=c;return[m/255,y/255,w/255,1]}if(/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const m=s.length<6?1:2;let y=1;return[Rt(s.slice(y,y+=m)),Rt(s.slice(y,y+=m)),Rt(s.slice(y,y+=m)),Rt(s.slice(y,y+m)||"ff")]}const h=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(h){const[m,y,w,I,P,L,B,O,H,q,ne,oe]=h,ee=[I||" ",B||" ",q].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const le=[w,L,H].join(""),pe=le==="%%%"?100:le===""?255:0;if(pe){const ve=[Kt(+y/pe,0,1),Kt(+P/pe,0,1),Kt(+O/pe,0,1),ne?Ft(+ne,oe):1];if(ni(ve))return ve}}return}const p=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[m,y,w,I,P,L,B,O,H]=p,q=[w||" ",P||" ",B].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const ne=[+y,Kt(+I,0,100),Kt(+L,0,100),O?Ft(+O,H):1];if(ni(ne))return function([oe,ee,le,pe]){function ve(Ye){const Je=(Ye+oe/30)%12,$e=ee*Math.min(le,1-le);return le-$e*Math.max(-1,Math.min(Je-3,9-Je,1))}return oe=st(oe),ee/=100,le/=100,[ve(0),ve(8),ve(4),pe]}(ne)}}}(e);return n?new Ct(...n,!1):void 0}get rgb(){const{r:e,g:n,b:s,a:c}=this,h=c||1/0;return this.overwriteGetter("rgb",[e/h,n/h,s/h,c])}get hcl(){return this.overwriteGetter("hcl",function(e){const[n,s,c,h]=ft(e),p=Math.sqrt(s*s+c*c);return[Math.round(1e4*p)?st(Math.atan2(c,s)*we):NaN,p,n,h]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ft(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,s,c]=this.rgb;return`rgba(${[e,n,s].map(h=>Math.round(255*h)).join(",")},${c})`}}Ct.black=new Ct(0,0,0,1),Ct.white=new Ct(1,1,1,1),Ct.transparent=new Ct(0,0,0,0),Ct.red=new Ct(1,0,0,1);class Yo{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ko{constructor(e,n,s,c,h){this.text=e,this.image=n,this.scale=s,this.fontStack=c,this.textColor=h}}class Dn{constructor(e){this.sections=e}static fromString(e){return new Dn([new Ko(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Dn?e:Dn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class vn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof vn)return e;if(typeof e=="number")return new vn([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new vn(e)}}toString(){return JSON.stringify(this.values)}}class en{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new en({name:e,available:!1}):null}}function rl(i,e,n,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,n,s]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Hs(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ct||i instanceof Yo||i instanceof Dn||i instanceof vn||i instanceof en)return!0;if(Array.isArray(i)){for(const e of i)if(!Hs(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Hs(i[e]))return!1;return!0}return!1}function ri(i){if(i===null)return zn;if(typeof i=="string")return dt;if(typeof i=="boolean")return pt;if(typeof i=="number")return De;if(i instanceof Ct)return jt;if(i instanceof Yo)return Zi;if(i instanceof Dn)return Wi;if(i instanceof vn)return tr;if(i instanceof en)return ir;if(Array.isArray(i)){const e=i.length;let n;for(const s of i){const c=ri(s);if(n){if(n===c)continue;n=rt;break}n=c}return _i(n||rt,e)}return Qi}function ys(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Ct||i instanceof Dn||i instanceof vn||i instanceof en?i.toString():JSON.stringify(i)}class Vr{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Hs(e[1]))return n.error("invalid value");const s=e[1];let c=ri(s);const h=n.expectedType;return c.kind!=="array"||c.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(c=h),new Vr(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Fi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const xs={string:dt,number:De,boolean:pt,object:Qi};class bn{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,c=1;const h=e[0];if(h==="array"){let m,y;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in xs)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);m=xs[w],c++}else m=rt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],c++}s=_i(m,y)}else{if(!xs[h])throw new Error(`Types doesn't contain name = ${h}`);s=xs[h]}const p=[];for(;c<e.length;c++){const m=n.parse(e[c],c,rt);if(!m)return null;p.push(m)}return new bn(s,p)}evaluate(e){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(e);if(!R(this.type,ri(s)))return s;if(n===this.args.length-1)throw new Fi(`Expected value to be of type ${j(this.type)}, but found ${j(ri(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const sl={"to-boolean":pt,"to-color":jt,"to-number":De,"to-string":dt};class Rr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[0];if(!sl[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return n.error("Expected one argument.");const c=sl[s],h=[];for(let p=1;p<e.length;p++){const m=n.parse(e[p],p,rt);if(!m)return null;h.push(m)}return new Rr(c,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,s;for(const c of this.args){if(n=c.evaluate(e),s=null,n instanceof Ct)return n;if(typeof n=="string"){const h=e.parseColor(n);if(h)return h}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:rl(n[0],n[1],n[2],n[3]),!s))return new Ct(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Fi(s||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}if(this.type.kind==="padding"){let n;for(const s of this.args){n=s.evaluate(e);const c=vn.parse(n);if(c)return c}throw new Fi(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}if(this.type.kind==="number"){let n=null;for(const s of this.args){if(n=s.evaluate(e),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new Fi(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Dn.fromString(ys(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?en.fromString(ys(this.args[0].evaluate(e))):ys(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const yc=["Unknown","Point","LineString","Polygon"];class nr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?yc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Ct.parse(e)),n}}class es{constructor(e,n,s=[],c,h=new cn,p=[]){this.registry=e,this.path=s,this.key=s.map(m=>`[${m}]`).join(""),this.scope=h,this.errors=p,this.expectedType=c,this._isConstant=n}parse(e,n,s,c,h={}){return n?this.concat(n,s,c)._parse(e,h):this._parse(e,h)}_parse(e,n){function s(c,h,p){return p==="assert"?new bn(h,[c]):p==="coerce"?new Rr(h,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[c];if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,y=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||y.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string")if(m.kind!=="padding"||y.kind!=="value"&&y.kind!=="number"&&y.kind!=="array"){if(this.checkSubtype(m,y))return null}else p=s(p,m,n.typeAnnotation||"coerce");else p=s(p,m,n.typeAnnotation||"coerce");else p=s(p,m,n.typeAnnotation||"assert")}if(!(p instanceof Vr)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const m=new nr;try{p=new Vr(p.type,p.evaluate(m))}catch(y){return this.error(y.message),null}}return p}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){const c=typeof e=="number"?this.path.concat(e):this.path,h=s?this.scope.concat(s):this.scope;return new es(this.registry,this._isConstant,c,n||null,h,this.errors)}error(e,...n){const s=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new ii(s,e))}checkSubtype(e,n){const s=R(e,n);return s&&this.error(s),s}}class ts{constructor(e,n,s){this.type=Zi,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return n.error("Collator options argument must be an object.");const c=n.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,pt);if(!c)return null;const h=n.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,pt);if(!h)return null;let p=null;return s.locale&&(p=n.parse(s.locale,1,dt),!p)?null:new ts(c,h,p)}evaluate(e){return new Yo(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const jn=8192;function Ot(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Xs(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Jo(i,e){const n=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*jn),Math.round(s*c*jn)]}function xc(i,e,n){const s=i[0]-e[0],c=i[1]-e[1],h=i[0]-n[0],p=i[1]-n[1];return s*p-h*c==0&&s*h<=0&&c*p<=0}function Ys(i,e){let n=!1;for(let p=0,m=e.length;p<m;p++){const y=e[p];for(let w=0,I=y.length;w<I-1;w++){if(xc(i,y[w],y[w+1]))return!1;(c=y[w])[1]>(s=i)[1]!=(h=y[w+1])[1]>s[1]&&s[0]<(h[0]-c[0])*(s[1]-c[1])/(h[1]-c[1])+c[0]&&(n=!n)}}var s,c,h;return n}function ol(i,e){for(let n=0;n<e.length;n++)if(Ys(i,e[n]))return!0;return!1}function al(i,e,n,s){const c=s[0]-n[0],h=s[1]-n[1],p=(i[0]-n[0])*h-c*(i[1]-n[1]),m=(e[0]-n[0])*h-c*(e[1]-n[1]);return p>0&&m<0||p<0&&m>0}function ll(i,e,n){for(const w of n)for(let I=0;I<w.length-1;++I)if((m=[(p=w[I+1])[0]-(h=w[I])[0],p[1]-h[1]])[0]*(y=[(c=e)[0]-(s=i)[0],c[1]-s[1]])[1]-m[1]*y[0]!=0&&al(s,c,h,p)&&al(h,p,s,c))return!0;var s,c,h,p,m,y;return!1}function Qo(i,e){for(let n=0;n<i.length;++n)if(!Ys(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(ll(i[n],i[n+1],e))return!1;return!0}function vc(i,e){for(let n=0;n<e.length;n++)if(Qo(i,e[n]))return!0;return!1}function ea(i,e,n){const s=[];for(let c=0;c<i.length;c++){const h=[];for(let p=0;p<i[c].length;p++){const m=Jo(i[c][p],n);Ot(e,m),h.push(m)}s.push(h)}return s}function cl(i,e,n){const s=[];for(let c=0;c<i.length;c++){const h=ea(i[c],e,n);s.push(h)}return s}function ul(i,e,n,s){if(i[0]<n[0]||i[0]>n[2]){const c=.5*s;let h=i[0]-n[0]>c?-s:n[0]-i[0]>c?s:0;h===0&&(h=i[0]-n[2]>c?-s:n[2]-i[0]>c?s:0),i[0]+=h}Ot(e,i)}function ta(i,e,n,s){const c=Math.pow(2,s.z)*jn,h=[s.x*jn,s.y*jn],p=[];for(const m of i)for(const y of m){const w=[y.x+h[0],y.y+h[1]];ul(w,e,n,c),p.push(w)}return p}function ia(i,e,n,s){const c=Math.pow(2,s.z)*jn,h=[s.x*jn,s.y*jn],p=[];for(const y of i){const w=[];for(const I of y){const P=[I.x+h[0],I.y+h[1]];Ot(e,P),w.push(P)}p.push(w)}if(e[2]-e[0]<=c/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const y of p)for(const w of y)ul(w,e,n,c)}var m;return p}class Nr{constructor(e,n){this.type=pt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Hs(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let c=0;c<s.features.length;++c){const h=s.features[c].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Nr(s,s.features[c].geometry)}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Nr(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Nr(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,s){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(s.type==="Polygon"){const m=ea(s.coordinates,h,p),y=ta(n.geometry(),c,h,p);if(!Xs(c,h))return!1;for(const w of y)if(!Ys(w,m))return!1}if(s.type==="MultiPolygon"){const m=cl(s.coordinates,h,p),y=ta(n.geometry(),c,h,p);if(!Xs(c,h))return!1;for(const w of y)if(!ol(w,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,s){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(s.type==="Polygon"){const m=ea(s.coordinates,h,p),y=ia(n.geometry(),c,h,p);if(!Xs(c,h))return!1;for(const w of y)if(!Qo(w,m))return!1}if(s.type==="MultiPolygon"){const m=cl(s.coordinates,h,p),y=ia(n.geometry(),c,h,p);if(!Xs(c,h))return!1;for(const w of y)if(!vc(w,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ks{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const s=e[1];return n.scope.has(s)?new Ks(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class wn{constructor(e,n,s,c){this.name=e,this.type=n,this._evaluate=s,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const s=e[0],c=wn.definitions[s];if(!c)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(c)?c[0]:c.type,p=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,m=p.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let y=null;for(const[w,I]of m){y=new es(n.registry,Js,n.path,null,n.scope);const P=[];let L=!1;for(let B=1;B<e.length;B++){const O=e[B],H=Array.isArray(w)?w[B-1]:w.type,q=y.parse(O,1+P.length,H);if(!q){L=!0;break}P.push(q)}if(!L)if(Array.isArray(w)&&w.length!==P.length)y.error(`Expected ${w.length} arguments, but found ${P.length} instead.`);else{for(let B=0;B<P.length;B++){const O=Array.isArray(w)?w[B]:w.type,H=P[B];y.concat(B+1).checkSubtype(O,H.type)}if(y.errors.length===0)return new wn(s,h,I,P)}}if(m.length===1)n.errors.push(...y.errors);else{const w=(m.length?m:p).map(([P])=>{return L=P,Array.isArray(L)?`(${L.map(j).join(", ")})`:`(${j(L.type)}...)`;var L}).join(" | "),I=[];for(let P=1;P<e.length;P++){const L=n.parse(e[P],1+I.length);if(!L)return null;I.push(j(L.type))}n.error(`Expected arguments of type ${w}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){wn.definitions=n;for(const s in n)e[s]=wn}}function Js(i){if(i instanceof Ks)return Js(i.boundExpression);if(i instanceof wn&&i.name==="error"||i instanceof ts||i instanceof Nr)return!1;const e=i instanceof Rr||i instanceof bn;let n=!0;return i.eachChild(s=>{n=e?n&&Js(s):n&&s instanceof Vr}),!!n&&Qs(i)&&bs(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Qs(i){if(i instanceof wn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Nr)return!1;let e=!0;return i.eachChild(n=>{e&&!Qs(n)&&(e=!1)}),e}function vs(i){if(i instanceof wn&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!vs(n)&&(e=!1)}),e}function bs(i,e){if(i instanceof wn&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(s=>{n&&!bs(s,e)&&(n=!1)}),n}function ws(i,e){const n=i.length-1;let s,c,h=0,p=n,m=0;for(;h<=p;)if(m=Math.floor((h+p)/2),s=i[m],c=i[m+1],s<=e){if(m===n||e<c)return m;h=m+1}else{if(!(s>e))throw new Fi("Input is not a number.");p=m-1}return 0}class Ts{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[c,h]of s)this.labels.push(c),this.outputs.push(h)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(e[1],1,De);if(!s)return null;const c=[];let h=null;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);for(let p=1;p<e.length;p+=2){const m=p===1?-1/0:e[p],y=e[p+1],w=p,I=p+1;if(typeof m!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(c.length&&c[c.length-1][0]>=m)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const P=n.parse(y,I,h);if(!P)return null;h=h||P.type,c.push([m,P])}return new Ts(h,s,c)}evaluate(e){const n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return s[0].evaluate(e);const h=n.length;return c>=n[h-1]?s[h-1].evaluate(e):s[ws(n,c)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ss(i,e,n){return i+n*(e-i)}function Es(i,e,n){return i.map((s,c)=>Ss(s,e[c],n))}const Tn={number:Ss,color:function(i,e,n,s="rgb"){switch(s){case"rgb":{const[c,h,p,m]=Es(i.rgb,e.rgb,n);return new Ct(c,h,p,m,!1)}case"hcl":{const[c,h,p,m]=i.hcl,[y,w,I,P]=e.hcl;let L,B;if(isNaN(c)||isNaN(y))isNaN(c)?isNaN(y)?L=NaN:(L=y,p!==1&&p!==0||(B=w)):(L=c,I!==1&&I!==0||(B=h));else{let oe=y-c;y>c&&oe>180?oe-=360:y<c&&c-y>180&&(oe+=360),L=c+n*oe}const[O,H,q,ne]=function([oe,ee,le,pe]){return oe=isNaN(oe)?0:oe*xe,gt([le,Math.cos(oe)*ee,Math.sin(oe)*ee,pe])}([L,B??Ss(h,w,n),Ss(p,I,n),Ss(m,P,n)]);return new Ct(O,H,q,ne,!1)}case"lab":{const[c,h,p,m]=gt(Es(i.lab,e.lab,n));return new Ct(c,h,p,m,!1)}}},array:Es,padding:function(i,e,n){return new vn(Es(i.values,e.values,n))}};class Ln{constructor(e,n,s,c,h){this.type=e,this.operator=n,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[p,m]of h)this.labels.push(p),this.outputs.push(m)}static interpolationFactor(e,n,s,c){let h=0;if(e.name==="exponential")h=na(n,e.base,s,c);else if(e.name==="linear")h=na(n,1,s,c);else if(e.name==="cubic-bezier"){const p=e.controlPoints;h=new _e(p[0],p[1],p[2],p[3]).solve(na(n,1,s,c))}return h}static parse(e,n){let[s,c,h,...p]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const w=c[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:w}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const w=c.slice(1);if(w.length!==4||w.some(I=>typeof I!="number"||I<0||I>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(h=n.parse(h,2,De),!h)return null;const m=[];let y=null;s==="interpolate-hcl"||s==="interpolate-lab"?y=jt:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let w=0;w<p.length;w+=2){const I=p[w],P=p[w+1],L=w+3,B=w+4;if(typeof I!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(m.length&&m[m.length-1][0]>=I)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const O=n.parse(P,B,y);if(!O)return null;y=y||O.type,m.push([I,O])}return Q(y,De)||Q(y,jt)||Q(y,tr)||Q(y,_i(De))?new Ln(y,s,c,h,m):n.error(`Type ${j(y)} is not interpolatable.`)}evaluate(e){const n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return s[0].evaluate(e);const h=n.length;if(c>=n[h-1])return s[h-1].evaluate(e);const p=ws(n,c),m=Ln.interpolationFactor(this.interpolation,c,n[p],n[p+1]),y=s[p].evaluate(e),w=s[p+1].evaluate(e);switch(this.operator){case"interpolate":return Tn[this.type.kind](y,w,m);case"interpolate-hcl":return Tn.color(y,w,m,"hcl");case"interpolate-lab":return Tn.color(y,w,m,"lab")}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function na(i,e,n,s){const c=s-n,h=i-n;return c===0?0:e===1?h/c:(Math.pow(e,h)-1)/(Math.pow(e,c)-1)}class eo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null;const c=n.expectedType;c&&c.kind!=="value"&&(s=c);const h=[];for(const m of e.slice(1)){const y=n.parse(m,1+h.length,s,void 0,{typeAnnotation:"omit"});if(!y)return null;s=s||y.type,h.push(y)}if(!s)throw new Error("No output type");const p=c&&h.some(m=>R(c,m.type));return new eo(p?rt:s,h)}evaluate(e){let n,s=null,c=0;for(const h of this.args)if(c++,s=h.evaluate(e),s&&s instanceof en&&!s.available&&(n||(n=s.name),s=null,c===this.args.length&&(s=n)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class to{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let h=1;h<e.length-1;h+=2){const p=e[h];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",h);const m=n.parse(e[h+1],h+1);if(!m)return null;s.push([p,m])}const c=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return c?new to(s,c):null}outputDefined(){return this.result.outputDefined()}}class ra{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,De),c=n.parse(e[2],2,_i(n.expectedType||rt));return s&&c?new ra(c.type.itemType,s,c):null}evaluate(e){const n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new Fi(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new Fi(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new Fi(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class sa{constructor(e,n){this.type=pt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,rt),c=n.parse(e[2],2,rt);return s&&c?N(s.type,[pt,dt,De,zn,rt])?new sa(s,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(s.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!Y(n,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${j(ri(n))} instead.`);if(!Y(s,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${j(ri(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class io{constructor(e,n,s){this.type=De,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,rt),c=n.parse(e[2],2,rt);if(!s||!c)return null;if(!N(s.type,[pt,dt,De,zn,rt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(s.type)} instead`);if(e.length===4){const h=n.parse(e[3],3,De);return h?new io(s,c,h):null}return new io(s,c)}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Y(n,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${j(ri(n))} instead.`);if(!Y(s,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${j(ri(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(n,c)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Pt{constructor(e,n,s,c,h,p){this.inputType=e,this.type=n,this.input=s,this.cases=c,this.outputs=h,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const h={},p=[];for(let w=2;w<e.length-1;w+=2){let I=e[w];const P=e[w+1];Array.isArray(I)||(I=[I]);const L=n.concat(w);if(I.length===0)return L.error("Expected at least one branch label.");for(const O of I){if(typeof O!="number"&&typeof O!="string")return L.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return L.error("Numeric branch labels must be integer values.");if(s){if(L.checkSubtype(s,ri(O)))return null}else s=ri(O);if(h[String(O)]!==void 0)return L.error("Branch labels must be unique.");h[String(O)]=p.length}const B=n.parse(P,w,c);if(!B)return null;c=c||B.type,p.push(B)}const m=n.parse(e[1],1,rt);if(!m)return null;const y=n.parse(e[e.length-1],e.length-1,c);return y?m.type.kind!=="value"&&n.concat(1).checkSubtype(s,m.type)?null:new Pt(s,c,m,h,p,y):null}evaluate(e){const n=this.input.evaluate(e);return(ri(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class oa{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&n.expectedType.kind!=="value"&&(s=n.expectedType);const c=[];for(let p=1;p<e.length-1;p+=2){const m=n.parse(e[p],p,pt);if(!m)return null;const y=n.parse(e[p+1],p+1,s);if(!y)return null;c.push([m,y]),s=s||y.type}const h=n.parse(e[e.length-1],e.length-1,s);if(!h)return null;if(!s)throw new Error("Can't infer output type");return new oa(s,c,h)}evaluate(e){for(const[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class no{constructor(e,n,s,c){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,rt),c=n.parse(e[2],2,De);if(!s||!c)return null;if(!N(s.type,[_i(rt),dt,rt]))return n.error(`Expected first argument to be of type array or string, but found ${j(s.type)} instead`);if(e.length===4){const h=n.parse(e[3],3,De);return h?new no(s.type,s,c,h):null}return new no(s.type,s,c)}evaluate(e){const n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Y(n,["string","array"]))throw new Fi(`Expected first argument to be of type array or string, but found ${j(ri(n))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return n.slice(s,c)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function hl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function pl(i,e,n,s){return s.compare(e,n)===0}function is(i,e,n){const s=i!=="=="&&i!=="!=";return class od{constructor(h,p,m){this.type=pt,this.lhs=h,this.rhs=p,this.collator=m,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const m=h[0];let y=p.parse(h[1],1,rt);if(!y)return null;if(!hl(m,y.type))return p.concat(1).error(`"${m}" comparisons are not supported for type '${j(y.type)}'.`);let w=p.parse(h[2],2,rt);if(!w)return null;if(!hl(m,w.type))return p.concat(2).error(`"${m}" comparisons are not supported for type '${j(w.type)}'.`);if(y.type.kind!==w.type.kind&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${j(y.type)}' and '${j(w.type)}'.`);s&&(y.type.kind==="value"&&w.type.kind!=="value"?y=new bn(w.type,[y]):y.type.kind!=="value"&&w.type.kind==="value"&&(w=new bn(y.type,[w])));let I=null;if(h.length===4){if(y.type.kind!=="string"&&w.type.kind!=="string"&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(I=p.parse(h[3],3,Zi),!I)return null}return new od(y,w,I)}evaluate(h){const p=this.lhs.evaluate(h),m=this.rhs.evaluate(h);if(s&&this.hasUntypedArgument){const y=ri(p),w=ri(m);if(y.kind!==w.kind||y.kind!=="string"&&y.kind!=="number")throw new Fi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${y.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const y=ri(p),w=ri(m);if(y.kind!=="string"||w.kind!=="string")return e(h,p,m)}return this.collator?n(h,p,m,this.collator.evaluate(h)):e(h,p,m)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}}}const bc=is("==",function(i,e,n){return e===n},pl),wc=is("!=",function(i,e,n){return e!==n},function(i,e,n,s){return!pl(0,e,n,s)}),Tc=is("<",function(i,e,n){return e<n},function(i,e,n,s){return s.compare(e,n)<0}),Sc=is(">",function(i,e,n){return e>n},function(i,e,n,s){return s.compare(e,n)>0}),Ec=is("<=",function(i,e,n){return e<=n},function(i,e,n,s){return s.compare(e,n)<=0}),Ic=is(">=",function(i,e,n){return e>=n},function(i,e,n,s){return s.compare(e,n)>=0});class aa{constructor(e,n,s,c,h){this.type=dt,this.number=e,this.locale=n,this.currency=s,this.minFractionDigits=c,this.maxFractionDigits=h}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const s=n.parse(e[1],1,De);if(!s)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let h=null;if(c.locale&&(h=n.parse(c.locale,1,dt),!h))return null;let p=null;if(c.currency&&(p=n.parse(c.currency,1,dt),!p))return null;let m=null;if(c["min-fraction-digits"]&&(m=n.parse(c["min-fraction-digits"],1,De),!m))return null;let y=null;return c["max-fraction-digits"]&&(y=n.parse(c["max-fraction-digits"],1,De),!y)?null:new aa(s,h,p,m,y)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class ro{constructor(e){this.type=Wi,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return n.error("First argument must be an image or text section.");const c=[];let h=!1;for(let p=1;p<=e.length-1;++p){const m=e[p];if(h&&typeof m=="object"&&!Array.isArray(m)){h=!1;let y=null;if(m["font-scale"]&&(y=n.parse(m["font-scale"],1,De),!y))return null;let w=null;if(m["text-font"]&&(w=n.parse(m["text-font"],1,_i(dt)),!w))return null;let I=null;if(m["text-color"]&&(I=n.parse(m["text-color"],1,jt),!I))return null;const P=c[c.length-1];P.scale=y,P.font=w,P.textColor=I}else{const y=n.parse(e[p],1,rt);if(!y)return null;const w=y.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,c.push({content:y,scale:null,font:null,textColor:null})}}return new ro(c)}evaluate(e){return new Dn(this.sections.map(n=>{const s=n.content.evaluate(e);return ri(s)===ir?new Ko("",s,null,null,null):new Ko(ys(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}}class la{constructor(e){this.type=ir,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const s=n.parse(e[1],1,dt);return s?new la(s):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),s=en.fromString(n);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(n)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class ca{constructor(e){this.type=De,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=n.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${j(s.type)} instead.`):new ca(s):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Fi(`Expected value to be of type string or array, but found ${j(ri(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const ns={"==":bc,"!=":wc,">":Sc,"<":Tc,">=":Ic,"<=":Ec,array:bn,at:ra,boolean:bn,case:oa,coalesce:eo,collator:ts,format:ro,image:la,in:sa,"index-of":io,interpolate:Ln,"interpolate-hcl":Ln,"interpolate-lab":Ln,length:ca,let:to,literal:Vr,match:Pt,number:bn,"number-format":aa,object:bn,slice:no,step:Ts,string:bn,"to-boolean":Rr,"to-color":Rr,"to-number":Rr,"to-string":Rr,var:Ks,within:Nr};function dl(i,[e,n,s,c]){e=e.evaluate(i),n=n.evaluate(i),s=s.evaluate(i);const h=c?c.evaluate(i):1,p=rl(e,n,s,h);if(p)throw new Fi(p);return new Ct(e/255,n/255,s/255,h,!1)}function fl(i,e){return i in e}function ua(i,e){const n=e[i];return n===void 0?null:n}function $r(i){return{type:i}}function ml(i){return{result:"success",value:i}}function rs(i){return{result:"error",value:i}}function ss(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function gl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function ha(i){return!!i.expression&&i.expression.interpolated}function Ut(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function so(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Ac(i){return i}function _l(i,e){const n=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",c=s||!(s||i.property!==void 0),h=i.type||(ha(e)?"exponential":"interval");if(n||e.type==="padding"){const I=n?Ct.parse:vn.parse;(i=Gi({},i)).stops&&(i.stops=i.stops.map(P=>[P[0],I(P[1])])),i.default=I(i.default?i.default:e.default)}if(i.colorSpace&&(p=i.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var p;let m,y,w;if(h==="exponential")m=yl;else if(h==="interval")m=pa;else if(h==="categorical"){m=Mc,y=Object.create(null);for(const I of i.stops)y[I[0]]=I[1];w=typeof i.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);m=Cc}if(s){const I={},P=[];for(let O=0;O<i.stops.length;O++){const H=i.stops[O],q=H[0].zoom;I[q]===void 0&&(I[q]={zoom:q,type:i.type,property:i.property,default:i.default,stops:[]},P.push(q)),I[q].stops.push([H[0].value,H[1]])}const L=[];for(const O of P)L.push([I[O].zoom,_l(I[O],e)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:Ln.interpolationFactor.bind(void 0,B),zoomStops:L.map(O=>O[0]),evaluate:({zoom:O},H)=>yl({stops:L,base:i.base},e,O).evaluate(O,H)}}if(c){const I=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Ln.interpolationFactor.bind(void 0,I),zoomStops:i.stops.map(P=>P[0]),evaluate:({zoom:P})=>m(i,e,P,y,w)}}return{kind:"source",evaluate(I,P){const L=P&&P.properties?P.properties[i.property]:void 0;return L===void 0?Is(i.default,e.default):m(i,e,L,y,w)}}}function Is(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function Mc(i,e,n,s,c){return Is(typeof n===c?s[n]:void 0,i.default,e.default)}function pa(i,e,n){if(Ut(n)!=="number")return Is(i.default,e.default);const s=i.stops.length;if(s===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[s-1][0])return i.stops[s-1][1];const c=ws(i.stops.map(h=>h[0]),n);return i.stops[c][1]}function yl(i,e,n){const s=i.base!==void 0?i.base:1;if(Ut(n)!=="number")return Is(i.default,e.default);const c=i.stops.length;if(c===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[c-1][0])return i.stops[c-1][1];const h=ws(i.stops.map(I=>I[0]),n),p=function(I,P,L,B){const O=B-L,H=I-L;return O===0?0:P===1?H/O:(Math.pow(P,H)-1)/(Math.pow(P,O)-1)}(n,s,i.stops[h][0],i.stops[h+1][0]),m=i.stops[h][1],y=i.stops[h+1][1],w=Tn[e.type]||Ac;return typeof m.evaluate=="function"?{evaluate(...I){const P=m.evaluate.apply(void 0,I),L=y.evaluate.apply(void 0,I);if(P!==void 0&&L!==void 0)return w(P,L,p,i.colorSpace)}}:w(m,y,p,i.colorSpace)}function Cc(i,e,n){switch(e.type){case"color":n=Ct.parse(n);break;case"formatted":n=Dn.fromString(n.toString());break;case"resolvedImage":n=en.fromString(n.toString());break;case"padding":n=vn.parse(n);break;default:Ut(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return Is(n,i.default,e.default)}wn.register(ns,{error:[{kind:"error"},[dt],(i,[e])=>{throw new Fi(e.evaluate(i))}],typeof:[dt,[rt],(i,[e])=>j(ri(e.evaluate(i)))],"to-rgba":[_i(De,4),[jt],(i,[e])=>{const[n,s,c,h]=e.evaluate(i).rgb;return[255*n,255*s,255*c,h]}],rgb:[jt,[De,De,De],dl],rgba:[jt,[De,De,De,De],dl],has:{type:pt,overloads:[[[dt],(i,[e])=>fl(e.evaluate(i),i.properties())],[[dt,Qi],(i,[e,n])=>fl(e.evaluate(i),n.evaluate(i))]]},get:{type:rt,overloads:[[[dt],(i,[e])=>ua(e.evaluate(i),i.properties())],[[dt,Qi],(i,[e,n])=>ua(e.evaluate(i),n.evaluate(i))]]},"feature-state":[rt,[dt],(i,[e])=>ua(e.evaluate(i),i.featureState||{})],properties:[Qi,[],i=>i.properties()],"geometry-type":[dt,[],i=>i.geometryType()],id:[rt,[],i=>i.id()],zoom:[De,[],i=>i.globals.zoom],"heatmap-density":[De,[],i=>i.globals.heatmapDensity||0],"line-progress":[De,[],i=>i.globals.lineProgress||0],accumulated:[rt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[De,$r(De),(i,e)=>{let n=0;for(const s of e)n+=s.evaluate(i);return n}],"*":[De,$r(De),(i,e)=>{let n=1;for(const s of e)n*=s.evaluate(i);return n}],"-":{type:De,overloads:[[[De,De],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[De],(i,[e])=>-e.evaluate(i)]]},"/":[De,[De,De],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[De,[De,De],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[De,[],()=>Math.LN2],pi:[De,[],()=>Math.PI],e:[De,[],()=>Math.E],"^":[De,[De,De],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[De,[De],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[De,[De],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[De,[De],(i,[e])=>Math.log(e.evaluate(i))],log2:[De,[De],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[De,[De],(i,[e])=>Math.sin(e.evaluate(i))],cos:[De,[De],(i,[e])=>Math.cos(e.evaluate(i))],tan:[De,[De],(i,[e])=>Math.tan(e.evaluate(i))],asin:[De,[De],(i,[e])=>Math.asin(e.evaluate(i))],acos:[De,[De],(i,[e])=>Math.acos(e.evaluate(i))],atan:[De,[De],(i,[e])=>Math.atan(e.evaluate(i))],min:[De,$r(De),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[De,$r(De),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[De,[De],(i,[e])=>Math.abs(e.evaluate(i))],round:[De,[De],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[De,[De],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[De,[De],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[pt,[dt,rt],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[pt,[rt],(i,[e])=>i.id()===e.value],"filter-type-==":[pt,[dt],(i,[e])=>i.geometryType()===e.value],"filter-<":[pt,[dt,rt],(i,[e,n])=>{const s=i.properties()[e.value],c=n.value;return typeof s==typeof c&&s<c}],"filter-id-<":[pt,[rt],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[pt,[dt,rt],(i,[e,n])=>{const s=i.properties()[e.value],c=n.value;return typeof s==typeof c&&s>c}],"filter-id->":[pt,[rt],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[pt,[dt,rt],(i,[e,n])=>{const s=i.properties()[e.value],c=n.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[pt,[rt],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[pt,[dt,rt],(i,[e,n])=>{const s=i.properties()[e.value],c=n.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[pt,[rt],(i,[e])=>{const n=i.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[pt,[rt],(i,[e])=>e.value in i.properties()],"filter-has-id":[pt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[pt,[_i(dt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[pt,[_i(rt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[pt,[dt,_i(rt)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[pt,[dt,_i(rt)],(i,[e,n])=>function(s,c,h,p){for(;h<=p;){const m=h+p>>1;if(c[m]===s)return!0;c[m]>s?p=m-1:h=m+1}return!1}(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:pt,overloads:[[[pt,pt],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[$r(pt),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:pt,overloads:[[[pt,pt],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[$r(pt),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[pt,[pt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[pt,[dt],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[dt,[dt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[dt,[dt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[dt,$r(rt),(i,e)=>e.map(n=>ys(n.evaluate(i))).join("")],"resolved-locale":[dt,[Zi],(i,[e])=>e.evaluate(i).resolvedLocale()]});class da{constructor(e,n){var s;this.expression=e,this._warningHistory={},this._evaluator=new nr,this._defaultValue=n?(s=n).type==="color"&&so(s.default)?new Ct(0,0,0,0):s.type==="color"?Ct.parse(s.default)||null:s.type==="padding"?vn.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,s,c,h,p){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=c,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,c,h,p){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null;try{const m=this.expression.evaluate(this._evaluator);if(m==null||typeof m=="number"&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new Fi(`Expected value to be one of ${Object.keys(this._enumValues).map(y=>JSON.stringify(y)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function oo(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ns}function si(i,e){const n=new es(ns,Js,[],e?function(c){const h={color:jt,string:dt,number:De,enum:dt,boolean:pt,formatted:Wi,padding:tr,resolvedImage:ir};return c.type==="array"?_i(h[c.value]||rt,c.length):h[c.type]}(e):void 0),s=n.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?ml(new da(s,e)):rs(n.errors)}class fa{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!vs(n.expression)}evaluateWithoutErrorHandling(e,n,s,c,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,c,h,p)}evaluate(e,n,s,c,h,p){return this._styleExpression.evaluate(e,n,s,c,h,p)}}class St{constructor(e,n,s,c){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!vs(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,s,c,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,c,h,p)}evaluate(e,n,s,c,h,p){return this._styleExpression.evaluate(e,n,s,c,h,p)}interpolationFactor(e,n,s){return this.interpolationType?Ln.interpolationFactor(this.interpolationType,e,n,s):0}}function ao(i,e){const n=si(i,e);if(n.result==="error")return n;const s=n.value.expression,c=Qs(s);if(!c&&!ss(e))return rs([new ii("","data expressions not supported")]);const h=bs(s,["zoom"]);if(!h&&!gl(e))return rs([new ii("","zoom expressions not supported")]);const p=qt(s);return p||h?p instanceof ii?rs([p]):p instanceof Ln&&!ha(e)?rs([new ii("",'"interpolate" expressions cannot be used with this property')]):ml(p?new St(c?"camera":"composite",n.value,p.labels,p instanceof Ln?p.interpolation:void 0):new fa(c?"constant":"source",n.value)):rs([new ii("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Gt{constructor(e,n){this._parameters=e,this._specification=n,Gi(this,_l(this._parameters,this._specification))}static deserialize(e){return new Gt(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function qt(i){let e=null;if(i instanceof to)e=qt(i.result);else if(i instanceof eo){for(const n of i.args)if(e=qt(n),e)break}else(i instanceof Ts||i instanceof Ln)&&i.input instanceof wn&&i.input.name==="zoom"&&(e=i);return e instanceof ii||i.eachChild(n=>{const s=qt(n);s instanceof ii?e=s:!e&&s?e=new ii("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new ii("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function os(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!os(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const xl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ma(i){if(i==null)return{filter:()=>!0,needGeometry:!1};os(i)||(i=lo(i));const e=si(i,xl);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,s,c)=>e.value.evaluate(n,s,{},c),needGeometry:vl(i)}}function Pc(i,e){return i<e?-1:i>e?1:0}function vl(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(vl(i[e]))return!0;return!1}function lo(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?co(i[1],i[2],"=="):e==="!="?As(co(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?co(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(lo))):e==="all"?["all"].concat(i.slice(1).map(lo)):e==="none"?["all"].concat(i.slice(1).map(lo).map(As)):e==="in"?ga(i[1],i.slice(2)):e==="!in"?As(ga(i[1],i.slice(2))):e==="has"?_a(i[1]):e==="!has"?As(_a(i[1])):e!=="within"||i;var n}function co(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function ga(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Pc)]]:["filter-in-small",i,["literal",e]]}}function _a(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function As(i){return["!",i]}function Ms(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let c="[";for(const h of i)c+=`${Ms(h)},`;return`${c}]`}const n=Object.keys(i).sort();let s="{";for(let c=0;c<n.length;c++)s+=`${JSON.stringify(n[c])}:${Ms(i[n[c]])},`;return`${s}}`}function kc(i){let e="";for(const n of dr)e+=`/${Ms(i[n])}`;return e}function bl(i){const e=i.value;return e?[new Re(i.key,e,"constants have been deprecated as of v8")]:[]}function xi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function jr(i){if(Array.isArray(i))return i.map(jr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=jr(i[n]);return e}return xi(i)}function qn(i){const e=i.key,n=i.value,s=i.valueSpec||{},c=i.objectElementValidators||{},h=i.style,p=i.styleSpec,m=i.validateSpec;let y=[];const w=Ut(n);if(w!=="object")return[new Re(e,n,`object expected, ${w} found`)];for(const I in n){const P=I.split(".")[0],L=s[P]||s["*"];let B;if(c[P])B=c[P];else if(s[P])B=m;else if(c["*"])B=c["*"];else{if(!s["*"]){y.push(new Re(e,n[I],`unknown property "${I}"`));continue}B=m}y=y.concat(B({key:(e&&`${e}.`)+I,value:n[I],valueSpec:L,style:h,styleSpec:p,object:n,objectKey:I,validateSpec:m},n))}for(const I in s)c[I]||s[I].required&&s[I].default===void 0&&n[I]===void 0&&y.push(new Re(e,n,`missing required property "${I}"`));return y}function wl(i){const e=i.value,n=i.valueSpec,s=i.style,c=i.styleSpec,h=i.key,p=i.arrayElementValidator||i.validateSpec;if(Ut(e)!=="array")return[new Re(h,e,`array expected, ${Ut(e)} found`)];if(n.length&&e.length!==n.length)return[new Re(h,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Re(h,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let m={type:n.value,values:n.values};c.$version<7&&(m.function=n.function),Ut(n.value)==="object"&&(m=n.value);let y=[];for(let w=0;w<e.length;w++)y=y.concat(p({array:e,arrayIndex:w,value:e[w],valueSpec:m,validateSpec:i.validateSpec,style:s,styleSpec:c,key:`${h}[${w}]`}));return y}function ya(i){const e=i.key,n=i.value,s=i.valueSpec;let c=Ut(n);return c==="number"&&n!=n&&(c="NaN"),c!=="number"?[new Re(e,n,`number expected, ${c} found`)]:"minimum"in s&&n<s.minimum?[new Re(e,n,`${n} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&n>s.maximum?[new Re(e,n,`${n} is greater than the maximum value ${s.maximum}`)]:[]}function Tl(i){const e=i.valueSpec,n=xi(i.value.type);let s,c,h,p={};const m=n!=="categorical"&&i.value.property===void 0,y=!m,w=Ut(i.value.stops)==="array"&&Ut(i.value.stops[0])==="array"&&Ut(i.value.stops[0][0])==="object",I=qn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(B){if(n==="identity")return[new Re(B.key,B.value,'identity function may not have a "stops" property')];let O=[];const H=B.value;return O=O.concat(wl({key:B.key,value:H,valueSpec:B.valueSpec,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:P})),Ut(H)==="array"&&H.length===0&&O.push(new Re(B.key,H,"array must have at least one stop")),O},default:function(B){return B.validateSpec({key:B.key,value:B.value,valueSpec:e,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec})}}});return n==="identity"&&m&&I.push(new Re(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||I.push(new Re(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!ha(i.valueSpec)&&I.push(new Re(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(y&&!ss(i.valueSpec)?I.push(new Re(i.key,i.value,"property functions not supported")):m&&!gl(i.valueSpec)&&I.push(new Re(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!w||i.value.property!==void 0||I.push(new Re(i.key,i.value,'"property" property is required')),I;function P(B){let O=[];const H=B.value,q=B.key;if(Ut(H)!=="array")return[new Re(q,H,`array expected, ${Ut(H)} found`)];if(H.length!==2)return[new Re(q,H,`array length 2 expected, length ${H.length} found`)];if(w){if(Ut(H[0])!=="object")return[new Re(q,H,`object expected, ${Ut(H[0])} found`)];if(H[0].zoom===void 0)return[new Re(q,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new Re(q,H,"object stop key must have value")];if(h&&h>xi(H[0].zoom))return[new Re(q,H[0].zoom,"stop zoom values must appear in ascending order")];xi(H[0].zoom)!==h&&(h=xi(H[0].zoom),c=void 0,p={}),O=O.concat(qn({key:`${q}[0]`,value:H[0],valueSpec:{zoom:{}},validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:ya,value:L}}))}else O=O.concat(L({key:`${q}[0]`,value:H[0],valueSpec:{},validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec},H));return oo(jr(H[1]))?O.concat([new Re(`${q}[1]`,H[1],"expressions are not allowed in function stops.")]):O.concat(B.validateSpec({key:`${q}[1]`,value:H[1],valueSpec:e,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec}))}function L(B,O){const H=Ut(B.value),q=xi(B.value),ne=B.value!==null?B.value:O;if(s){if(H!==s)return[new Re(B.key,ne,`${H} stop domain type must match previous stop domain type ${s}`)]}else s=H;if(H!=="number"&&H!=="string"&&H!=="boolean")return[new Re(B.key,ne,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&n!=="categorical"){let oe=`number expected, ${H} found`;return ss(e)&&n===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Re(B.key,ne,oe)]}return n!=="categorical"||H!=="number"||isFinite(q)&&Math.floor(q)===q?n!=="categorical"&&H==="number"&&c!==void 0&&q<c?[new Re(B.key,ne,"stop domain values must appear in ascending order")]:(c=q,n==="categorical"&&q in p?[new Re(B.key,ne,"stop domain values must be unique")]:(p[q]=!0,[])):[new Re(B.key,ne,`integer expected, found ${q}`)]}}function qr(i){const e=(i.expressionContext==="property"?ao:si)(jr(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new Re(`${i.key}${s.key}`,i.value,s.message));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Re(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!vs(n))return[new Re(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!vs(n))return[new Re(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!bs(n,["zoom","feature-state"]))return[new Re(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Qs(n))return[new Re(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Cs(i){const e=i.key,n=i.value,s=i.valueSpec,c=[];return Array.isArray(s.values)?s.values.indexOf(xi(n))===-1&&c.push(new Re(e,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(s.values).indexOf(xi(n))===-1&&c.push(new Re(e,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function as(i){return os(jr(i.value))?qr(Gi({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Sl(i)}function Sl(i){const e=i.value,n=i.key;if(Ut(e)!=="array")return[new Re(n,e,`array expected, ${Ut(e)} found`)];const s=i.styleSpec;let c,h=[];if(e.length<1)return[new Re(n,e,"filter array must have at least 1 element")];switch(h=h.concat(Cs({key:`${n}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),xi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&xi(e[1])==="$type"&&h.push(new Re(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new Re(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Ut(e[1]),c!=="string"&&h.push(new Re(`${n}[1]`,e[1],`string expected, ${c} found`)));for(let p=2;p<e.length;p++)c=Ut(e[p]),xi(e[1])==="$type"?h=h.concat(Cs({key:`${n}[${p}]`,value:e[p],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&h.push(new Re(`${n}[${p}]`,e[p],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)h=h.concat(Sl({key:`${n}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=Ut(e[1]),e.length!==2?h.push(new Re(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&h.push(new Re(`${n}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=Ut(e[1]),e.length!==2?h.push(new Re(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&h.push(new Re(`${n}[1]`,e[1],`object expected, ${c} found`))}return h}function xa(i,e){const n=i.key,s=i.validateSpec,c=i.style,h=i.styleSpec,p=i.value,m=i.objectKey,y=h[`${e}_${i.layerType}`];if(!y)return[];const w=m.match(/^(.*)-transition$/);if(e==="paint"&&w&&y[w[1]]&&y[w[1]].transition)return s({key:n,value:p,valueSpec:h.transition,style:c,styleSpec:h});const I=i.valueSpec||y[m];if(!I)return[new Re(n,p,`unknown property "${m}"`)];let P;if(Ut(p)==="string"&&ss(I)&&!I.tokens&&(P=/^{([^}]+)}$/.exec(p)))return[new Re(n,p,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const L=[];return i.layerType==="symbol"&&(m==="text-field"&&c&&!c.glyphs&&L.push(new Re(n,p,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&so(jr(p))&&xi(p.type)==="identity"&&L.push(new Re(n,p,'"text-font" does not support identity functions'))),L.concat(s({key:i.key,value:p,valueSpec:I,style:c,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:m}))}function va(i){return xa(i,"paint")}function El(i){return xa(i,"layout")}function uo(i){let e=[];const n=i.value,s=i.key,c=i.style,h=i.styleSpec;n.type||n.ref||e.push(new Re(s,n,'either "type" or "ref" is required'));let p=xi(n.type);const m=xi(n.ref);if(n.id){const y=xi(n.id);for(let w=0;w<i.arrayIndex;w++){const I=c.layers[w];xi(I.id)===y&&e.push(new Re(s,n.id,`duplicate layer id "${n.id}", previously used at line ${I.id.__line__}`))}}if("ref"in n){let y;["type","source","source-layer","filter","layout"].forEach(w=>{w in n&&e.push(new Re(s,n[w],`"${w}" is prohibited for ref layers`))}),c.layers.forEach(w=>{xi(w.id)===m&&(y=w)}),y?y.ref?e.push(new Re(s,n.ref,"ref cannot reference another ref layer")):p=xi(y.type):e.push(new Re(s,n.ref,`ref layer "${m}" not found`))}else if(p!=="background")if(n.source){const y=c.sources&&c.sources[n.source],w=y&&xi(y.type);y?w==="vector"&&p==="raster"?e.push(new Re(s,n.source,`layer "${n.id}" requires a raster source`)):w==="raster"&&p!=="raster"?e.push(new Re(s,n.source,`layer "${n.id}" requires a vector source`)):w!=="vector"||n["source-layer"]?w==="raster-dem"&&p!=="hillshade"?e.push(new Re(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!n.paint||!n.paint["line-gradient"]||w==="geojson"&&y.lineMetrics||e.push(new Re(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Re(s,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Re(s,n.source,`source "${n.source}" not found`))}else e.push(new Re(s,n,'missing required property "source"'));return e=e.concat(qn({key:s,value:n,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:n.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:as,layout:y=>qn({layer:n,key:y.key,value:y.value,style:y.style,styleSpec:y.styleSpec,validateSpec:y.validateSpec,objectElementValidators:{"*":w=>El(Gi({layerType:p},w))}}),paint:y=>qn({layer:n,key:y.key,value:y.value,style:y.style,styleSpec:y.styleSpec,validateSpec:y.validateSpec,objectElementValidators:{"*":w=>va(Gi({layerType:p},w))}})}})),e}function fr(i){const e=i.value,n=i.key,s=Ut(e);return s!=="string"?[new Re(n,e,`string expected, ${s} found`)]:[]}const ho={promoteId:function({key:i,value:e}){if(Ut(e)==="string")return fr({key:i,value:e});{const n=[];for(const s in e)n.push(...fr({key:`${i}.${s}`,value:e[s]}));return n}}};function po(i){const e=i.value,n=i.key,s=i.styleSpec,c=i.style,h=i.validateSpec;if(!e.type)return[new Re(n,e,'"type" is required')];const p=xi(e.type);let m;switch(p){case"vector":case"raster":case"raster-dem":return m=qn({key:n,value:e,valueSpec:s[`source_${p.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:ho,validateSpec:h}),m;case"geojson":if(m=qn({key:n,value:e,valueSpec:s.source_geojson,style:c,styleSpec:s,validateSpec:h,objectElementValidators:ho}),e.cluster)for(const y in e.clusterProperties){const[w,I]=e.clusterProperties[y],P=typeof w=="string"?[w,["accumulated"],["get",y]]:w;m.push(...qr({key:`${n}.${y}.map`,value:I,validateSpec:h,expressionContext:"cluster-map"})),m.push(...qr({key:`${n}.${y}.reduce`,value:P,validateSpec:h,expressionContext:"cluster-reduce"}))}return m;case"video":return qn({key:n,value:e,valueSpec:s.source_video,style:c,validateSpec:h,styleSpec:s});case"image":return qn({key:n,value:e,valueSpec:s.source_image,style:c,validateSpec:h,styleSpec:s});case"canvas":return[new Re(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Cs({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,validateSpec:h,styleSpec:s})}}function Il(i){const e=i.value,n=i.styleSpec,s=n.light,c=i.style;let h=[];const p=Ut(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Re("light",e,`object expected, ${p} found`)]),h;for(const m in e){const y=m.match(/^(.*)-transition$/);h=h.concat(y&&s[y[1]]&&s[y[1]].transition?i.validateSpec({key:m,value:e[m],valueSpec:n.transition,validateSpec:i.validateSpec,style:c,styleSpec:n}):s[m]?i.validateSpec({key:m,value:e[m],valueSpec:s[m],validateSpec:i.validateSpec,style:c,styleSpec:n}):[new Re(m,e[m],`unknown property "${m}"`)])}return h}function Ps(i){const e=i.value,n=i.styleSpec,s=n.terrain,c=i.style;let h=[];const p=Ut(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Re("terrain",e,`object expected, ${p} found`)]),h;for(const m in e)h=h.concat(s[m]?i.validateSpec({key:m,value:e[m],valueSpec:s[m],validateSpec:i.validateSpec,style:c,styleSpec:n}):[new Re(m,e[m],`unknown property "${m}"`)]);return h}function Al(i){let e=[];const n=i.value,s=i.key;if(Array.isArray(n)){const c=[],h=[];for(const p in n)n[p].id&&c.includes(n[p].id)&&e.push(new Re(s,n,`all the sprites' ids must be unique, but ${n[p].id} is duplicated`)),c.push(n[p].id),n[p].url&&h.includes(n[p].url)&&e.push(new Re(s,n,`all the sprites' URLs must be unique, but ${n[p].url} is duplicated`)),h.push(n[p].url),e=e.concat(qn({key:`${s}[${p}]`,value:n[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return fr({key:s,value:n})}const Ml={"*":()=>[],array:wl,boolean:function(i){const e=i.value,n=i.key,s=Ut(e);return s!=="boolean"?[new Re(n,e,`boolean expected, ${s} found`)]:[]},number:ya,color:function(i){const e=i.key,n=i.value,s=Ut(n);return s!=="string"?[new Re(e,n,`color expected, ${s} found`)]:Ct.parse(String(n))?[]:[new Re(e,n,`color expected, "${n}" found`)]},constants:bl,enum:Cs,filter:as,function:Tl,layer:uo,object:qn,source:po,light:Il,terrain:Ps,string:fr,formatted:function(i){return fr(i).length===0?[]:qr(i)},resolvedImage:function(i){return fr(i).length===0?[]:qr(i)},padding:function(i){const e=i.key,n=i.value;if(Ut(n)==="array"){if(n.length<1||n.length>4)return[new Re(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const s={type:"number"};let c=[];for(let h=0;h<n.length;h++)c=c.concat(i.validateSpec({key:`${e}[${h}]`,value:n[h],validateSpec:i.validateSpec,valueSpec:s}));return c}return ya({key:e,value:n,valueSpec:{}})},sprite:Al};function ks(i){const e=i.value,n=i.valueSpec,s=i.styleSpec;return i.validateSpec=ks,n.expression&&so(xi(e))?Tl(i):n.expression&&oo(jr(e))?qr(i):n.type&&Ml[n.type]?Ml[n.type](i):qn(Gi({},i,{valueSpec:n.type?s[n.type]:n}))}function Cl(i){const e=i.value,n=i.key,s=fr(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new Re(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new Re(n,e,'"glyphs" url must include a "{range}" token'))),s}function mr(i,e=ye){let n=[];return n=n.concat(ks({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:ks,objectElementValidators:{glyphs:Cl,"*":()=>[]}})),i.constants&&(n=n.concat(bl({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:ks}))),zs(n)}function Gn(i){return function(e){return i({...e,validateSpec:ks})}}function zs(i){return[].concat(i).sort((e,n)=>e.line-n.line)}function Ai(i){return function(...e){return zs(i.apply(this,e))}}mr.source=Ai(Gn(po)),mr.sprite=Ai(Gn(Al)),mr.glyphs=Ai(Gn(Cl)),mr.light=Ai(Gn(Il)),mr.terrain=Ai(Gn(Ps)),mr.layer=Ai(Gn(uo)),mr.filter=Ai(Gn(as)),mr.paintProperty=Ai(Gn(va)),mr.layoutProperty=Ai(Gn(El));const Br=mr,zc=Br.light,Dc=Br.paintProperty,Lc=Br.layoutProperty;function ls(i,e){let n=!1;if(e&&e.length)for(const s of e)i.fire(new yn(new Error(s.message))),n=!0;return n}class Ds{constructor(e,n,s){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(n=p[1])+2*(s=p[2]);for(let y=0;y<this.d*this.d;y++){const w=p[3+y],I=p[3+y+1];c.push(w===I?null:p.subarray(w,I))}const m=p[3+c.length+1];this.keys=p.subarray(p[3+c.length],m),this.bboxes=p.subarray(m),this.insert=this._insertReadonly}else{this.d=n+2*s;for(let p=0;p<this.d*this.d;p++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=s,this.scale=n/e,this.uid=0;const h=s/n*e;this.min=-h,this.max=e+h}insert(e,n,s,c,h){this._forEachCell(n,s,c,h,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(h)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,s,c,h,p){this.cells[h].push(p)}query(e,n,s,c,h){const p=this.min,m=this.max;if(e<=p&&n<=p&&m<=s&&m<=c&&!h)return Array.prototype.slice.call(this.keys);{const y=[];return this._forEachCell(e,n,s,c,this._queryCell,y,{},h),y}}_queryCell(e,n,s,c,h,p,m,y){const w=this.cells[h];if(w!==null){const I=this.keys,P=this.bboxes;for(let L=0;L<w.length;L++){const B=w[L];if(m[B]===void 0){const O=4*B;(y?y(P[O+0],P[O+1],P[O+2],P[O+3]):e<=P[O+2]&&n<=P[O+3]&&s>=P[O+0]&&c>=P[O+1])?(m[B]=!0,p.push(I[B])):m[B]=!1}}}}_forEachCell(e,n,s,c,h,p,m,y){const w=this._convertToCellCoord(e),I=this._convertToCellCoord(n),P=this._convertToCellCoord(s),L=this._convertToCellCoord(c);for(let B=w;B<=P;B++)for(let O=I;O<=L;O++){const H=this.d*O+B;if((!y||y(this._convertFromCellCoord(B),this._convertFromCellCoord(O),this._convertFromCellCoord(B+1),this._convertFromCellCoord(O+1)))&&h.call(this,e,n,s,c,H,p,m,y))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let s=0;for(let p=0;p<this.cells.length;p++)s+=this.cells[p].length;const c=new Int32Array(n+s+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let h=n;for(let p=0;p<e.length;p++){const m=e[p];c[3+p]=h,c.set(m,h),h+=m.length}return c[3+e.length]=h,c.set(this.keys,h),h+=this.keys.length,c[3+e.length+1]=h,c.set(this.bboxes,h),h+=this.bboxes.length,c.buffer}static serialize(e,n){const s=e.toArrayBuffer();return n&&n.push(s),{buffer:s}}static deserialize(e){return new Ds(e.buffer)}}const gr={};function Ke(i,e,n={}){if(gr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),gr[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}Ke("Object",Object),Ke("TransferableGridIndex",Ds),Ke("Color",Ct),Ke("Error",Error),Ke("AJAXError",oi),Ke("ResolvedImage",en),Ke("StylePropertyFunction",Gt),Ke("StyleExpression",da,{omit:["_evaluator"]}),Ke("ZoomDependentExpression",St),Ke("ZoomConstantExpression",fa),Ke("CompoundExpression",wn,{omit:["_evaluate"]});for(const i in ns)ns[i]._classRegistryKey||Ke(`Expression_${i}`,ns[i]);function fo(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Ls(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(fo(i)||Tt(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return e&&e.push(n.buffer),n}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const s of i)n.push(Ls(s,e));return n}if(typeof i=="object"){const n=i.constructor,s=n._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");if(!gr[s])throw new Error(`${s} is not registered.`);const c=n.serialize?n.serialize(i,e):{};if(n.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const h in i){if(!i.hasOwnProperty(h)||gr[s].omit.indexOf(h)>=0)continue;const p=i[h];c[h]=gr[s].shallow.indexOf(h)>=0?p:Ls(p,e)}i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof i)}function Ir(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||fo(i)||Tt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Ir);if(typeof i=="object"){const e=i.$name||"Object";if(!gr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=gr[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const s=Object.create(n.prototype);for(const c of Object.keys(i)){if(c==="$name")continue;const h=i[c];s[c]=gr[e].shallow.indexOf(c)>=0?h:Ir(h)}return s}throw new Error("can't deserialize object of type "+typeof i)}class Pl{constructor(){this.first=!0}update(e,n){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const Ne={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function mo(i){for(const e of i)if(go(e.charCodeAt(0)))return!0;return!1}function ba(i){for(const e of i)if(!kl(e.charCodeAt(0)))return!1;return!0}function kl(i){return!(Ne.Arabic(i)||Ne["Arabic Supplement"](i)||Ne["Arabic Extended-A"](i)||Ne["Arabic Presentation Forms-A"](i)||Ne["Arabic Presentation Forms-B"](i))}function go(i){return!(i!==746&&i!==747&&(i<4352||!(Ne["Bopomofo Extended"](i)||Ne.Bopomofo(i)||Ne["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ne["CJK Compatibility Ideographs"](i)||Ne["CJK Compatibility"](i)||Ne["CJK Radicals Supplement"](i)||Ne["CJK Strokes"](i)||!(!Ne["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ne["CJK Unified Ideographs Extension A"](i)||Ne["CJK Unified Ideographs"](i)||Ne["Enclosed CJK Letters and Months"](i)||Ne["Hangul Compatibility Jamo"](i)||Ne["Hangul Jamo Extended-A"](i)||Ne["Hangul Jamo Extended-B"](i)||Ne["Hangul Jamo"](i)||Ne["Hangul Syllables"](i)||Ne.Hiragana(i)||Ne["Ideographic Description Characters"](i)||Ne.Kanbun(i)||Ne["Kangxi Radicals"](i)||Ne["Katakana Phonetic Extensions"](i)||Ne.Katakana(i)&&i!==12540||!(!Ne["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ne["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ne["Unified Canadian Aboriginal Syllabics"](i)||Ne["Unified Canadian Aboriginal Syllabics Extended"](i)||Ne["Vertical Forms"](i)||Ne["Yijing Hexagram Symbols"](i)||Ne["Yi Syllables"](i)||Ne["Yi Radicals"](i))))}function zl(i){return!(go(i)||function(e){return!!(Ne["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ne["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ne["Letterlike Symbols"](e)||Ne["Number Forms"](e)||Ne["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ne["Control Pictures"](e)&&e!==9251||Ne["Optical Character Recognition"](e)||Ne["Enclosed Alphanumerics"](e)||Ne["Geometric Shapes"](e)||Ne["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ne["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ne["CJK Symbols and Punctuation"](e)||Ne.Katakana(e)||Ne["Private Use Area"](e)||Ne["CJK Compatibility Forms"](e)||Ne["Small Form Variants"](e)||Ne["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function _o(i){return i>=1424&&i<=2303||Ne["Arabic Presentation Forms-A"](i)||Ne["Arabic Presentation Forms-B"](i)}function yo(i,e){return!(!e&&_o(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ne.Khmer(i))}function Dl(i){for(const e of i)if(_o(e.charCodeAt(0)))return!0;return!1}const wa="deferred",xo="loading",Ta="loaded";let Rs=null,Sn="unavailable",Fr=null;const Ll=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Sn="error"),Rs&&Rs(i)};function Sa(){vo.fire(new Ji("pluginStateChange",{pluginStatus:Sn,pluginURL:Fr}))}const vo=new Ii,Ea=function(){return Sn},Rl=function(){if(Sn!==wa||!Fr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Sn=xo,Sa(),Fr&&Yi({url:Fr},i=>{i?Ll(i):(Sn=Ta,Sa())})},Zn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Sn===Ta||Zn.applyArabicShaping!=null,isLoading:()=>Sn===xo,setState(i){if(!Ht())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Sn=i.pluginStatus,Fr=i.pluginURL},isParsed(){if(!Ht())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Zn.applyArabicShaping!=null&&Zn.processBidirectionalText!=null&&Zn.processStyledBidirectionalText!=null},getPluginURL(){if(!Ht())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Fr}};class Jt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Pl,this.transition={})}isSupportedScript(e){return function(n,s){for(const c of n)if(!yo(c.charCodeAt(0),s))return!1;return!0}(e,Zn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*n}}}class bo{constructor(e,n){this.property=e,this.value=n,this.expression=function(s,c){if(so(s))return new Gt(s,c);if(oo(s)){const h=ao(s,c);if(h.result==="error")throw new Error(h.value.map(p=>`${p.key}: ${p.message}`).join(", "));return h.value}{let h=s;return c.type==="color"&&typeof s=="string"?h=Ct.parse(s):c.type!=="padding"||typeof s!="number"&&!Array.isArray(s)||(h=vn.parse(s)),{kind:"constant",evaluate:()=>h}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class Ia{constructor(e){this.property=e,this.value=new bo(e,void 0)}transitioned(e,n){return new Bs(this.property,this.value,n,ze({},e.transition,this.transition),e.now)}untransitioned(){return new Bs(this.property,this.value,null,{},0)}}class Bl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return ht(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ia(this._values[e].property)),this._values[e].value=new bo(this._values[e].property,n===null?void 0:ht(n))}getTransition(e){return ht(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ia(this._values[e].property)),this._values[e].transition=ht(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);s!==void 0&&(e[n]=s);const c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){const s=new Fl(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,n._values[c]);return s}untransitioned(){const e=new Fl(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Bs{constructor(e,n,s,c,h){this.property=e,this.value=n,this.begin=h+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){const c=e.now||0,h=this.value.possiblyEvaluate(e,n,s),p=this.prior;if(p){if(c>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(c<this.begin)return p.possiblyEvaluate(e,n,s);{const m=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,s),h,function(y){if(y<=0)return 0;if(y>=1)return 1;const w=y*y,I=w*y;return 4*(y<.5?I:3*(y-w)+I-.75)}(m))}}return h}}class Fl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){const c=new wo(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,n,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Aa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return ht(this._values[e].value)}setValue(e,n){this._values[e]=new bo(this._values[e].property,n===null?void 0:ht(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);s!==void 0&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){const c=new wo(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,n,s);return c}}class _r{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,s,c){return this.property.evaluate(this.value,this.parameters,e,n,s,c)}}class wo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class it{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,s){const c=Tn[this.specification.type];return c?c(e,n,s):e}}class ct{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,c){return new _r(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},s,c)}:e.expression,n)}interpolate(e,n,s){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new _r(this,{kind:"constant",value:void 0},e.parameters);const c=Tn[this.specification.type];if(c){const h=c(e.value.value,n.value.value,s);return new _r(this,{kind:"constant",value:h},e.parameters)}return e}evaluate(e,n,s,c,h,p){return e.kind==="constant"?e.value:e.evaluate(n,s,c,h,p)}}class Fs extends ct{possiblyEvaluate(e,n,s,c){if(e.value===void 0)return new _r(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const h=e.expression.evaluate(n,null,{},s,c),p=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,m=this._calculate(p,p,p,n);return new _r(this,{kind:"constant",value:m},n)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new _r(this,{kind:"constant",value:h},n)}return new _r(this,e.expression,n)}evaluate(e,n,s,c,h,p){if(e.kind==="source"){const m=e.evaluate(n,s,c,h,p);return this._calculate(m,m,m,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},s,c),e.evaluate({zoom:Math.floor(n.zoom)},s,c),e.evaluate({zoom:Math.floor(n.zoom)+1},s,c),n):e.value}_calculate(e,n,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:s,to:n}}interpolate(e){return e}}class Ma{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(n,null,{},s,c);return this._calculate(h,h,h,n)}return this._calculate(e.expression.evaluate(new Jt(Math.floor(n.zoom-1),n)),e.expression.evaluate(new Jt(Math.floor(n.zoom),n)),e.expression.evaluate(new Jt(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:s,to:n}}interpolate(e){return e}}class Ca{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,c){return!!e.expression.evaluate(n,null,{},s,c)}interpolate(){return!1}}class En{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const s=e[n];s.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new bo(s,void 0),h=this.defaultTransitionablePropertyValues[n]=new Ia(s);this.defaultTransitioningPropertyValues[n]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}Ke("DataDrivenProperty",ct),Ke("DataConstantProperty",it),Ke("CrossFadedDataDrivenProperty",Fs),Ke("CrossFadedProperty",Ma),Ke("ColorRampProperty",Ca);const To="-transition";class yr extends Ii{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new Aa(n.layout)),n.paint)){this._transitionablePaint=new Bl(n.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wo(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,s={}){n!=null&&this._validate(Lc,`layers.${this.id}.layout.${e}`,e,n,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(To)?this._transitionablePaint.getTransition(e.slice(0,-To.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,s={}){if(n!=null&&this._validate(Dc,`layers.${this.id}.paint.${e}`,e,n,s))return!1;if(e.endsWith(To))return this._transitionablePaint.setTransition(e.slice(0,-To.length),n||void 0),!1;{const c=this._transitionablePaint._values[e],h=c.property.specification["property-type"]==="cross-faded-data-driven",p=c.value.isDataDriven(),m=c.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value;return y.isDataDriven()||p||h||this._handleOverridablePaintPropertyUpdate(e,m,y)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Qe(e,(n,s)=>!(n===void 0||s==="layout"&&!Object.keys(n).length||s==="paint"&&!Object.keys(n).length))}_validate(e,n,s,c,h={}){return(!h||h.validate!==!1)&&ls(this,e.call(Br,{key:n,layerType:this.type,objectKey:s,value:c,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof _r&&ss(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const Rc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ar{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class li{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Mi(i,e=1){let n=0,s=0;return{members:i.map(c=>{const h=Rc[c.type].BYTES_PER_ELEMENT,p=n=Ol(n,Math.max(e,h)),m=c.components||1;return s=Math.max(s,h),n+=h*m,{name:c.name,type:c.type,components:m,offset:p}}),size:Ol(n,Math.max(s,e)),alignment:e}}function Ol(i,e){return Math.ceil(i/e)*e}class cs extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const c=2*e;return this.int16[c+0]=n,this.int16[c+1]=s,e}}cs.prototype.bytesPerElement=4,Ke("StructArrayLayout2i4",cs);class So extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,s)}emplace(e,n,s,c){const h=3*e;return this.int16[h+0]=n,this.int16[h+1]=s,this.int16[h+2]=c,e}}So.prototype.bytesPerElement=6,Ke("StructArrayLayout3i6",So);class Pa extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,c)}emplace(e,n,s,c,h){const p=4*e;return this.int16[p+0]=n,this.int16[p+1]=s,this.int16[p+2]=c,this.int16[p+3]=h,e}}Pa.prototype.bytesPerElement=8,Ke("StructArrayLayout4i8",Pa);class xr extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,c,h,p)}emplace(e,n,s,c,h,p,m){const y=6*e;return this.int16[y+0]=n,this.int16[y+1]=s,this.int16[y+2]=c,this.int16[y+3]=h,this.int16[y+4]=p,this.int16[y+5]=m,e}}xr.prototype.bytesPerElement=12,Ke("StructArrayLayout2i4i12",xr);class Eo extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,c,h,p)}emplace(e,n,s,c,h,p,m){const y=4*e,w=8*e;return this.int16[y+0]=n,this.int16[y+1]=s,this.uint8[w+4]=c,this.uint8[w+5]=h,this.uint8[w+6]=p,this.uint8[w+7]=m,e}}Eo.prototype.bytesPerElement=8,Ke("StructArrayLayout2i4ub8",Eo);class Gr extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const c=2*e;return this.float32[c+0]=n,this.float32[c+1]=s,e}}Gr.prototype.bytesPerElement=8,Ke("StructArrayLayout2f8",Gr);class Io extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,p,m,y,w,I){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,s,c,h,p,m,y,w,I)}emplace(e,n,s,c,h,p,m,y,w,I,P){const L=10*e;return this.uint16[L+0]=n,this.uint16[L+1]=s,this.uint16[L+2]=c,this.uint16[L+3]=h,this.uint16[L+4]=p,this.uint16[L+5]=m,this.uint16[L+6]=y,this.uint16[L+7]=w,this.uint16[L+8]=I,this.uint16[L+9]=P,e}}Io.prototype.bytesPerElement=20,Ke("StructArrayLayout10ui20",Io);class Os extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,p,m,y,w,I,P,L){const B=this.length;return this.resize(B+1),this.emplace(B,e,n,s,c,h,p,m,y,w,I,P,L)}emplace(e,n,s,c,h,p,m,y,w,I,P,L,B){const O=12*e;return this.int16[O+0]=n,this.int16[O+1]=s,this.int16[O+2]=c,this.int16[O+3]=h,this.uint16[O+4]=p,this.uint16[O+5]=m,this.uint16[O+6]=y,this.uint16[O+7]=w,this.int16[O+8]=I,this.int16[O+9]=P,this.int16[O+10]=L,this.int16[O+11]=B,e}}Os.prototype.bytesPerElement=24,Ke("StructArrayLayout4i4ui4i24",Os);class ka extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,s)}emplace(e,n,s,c){const h=3*e;return this.float32[h+0]=n,this.float32[h+1]=s,this.float32[h+2]=c,e}}ka.prototype.bytesPerElement=12,Ke("StructArrayLayout3f12",ka);class us extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}us.prototype.bytesPerElement=4,Ke("StructArrayLayout1ul4",us);class Zr extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,p,m,y,w){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,s,c,h,p,m,y,w)}emplace(e,n,s,c,h,p,m,y,w,I){const P=10*e,L=5*e;return this.int16[P+0]=n,this.int16[P+1]=s,this.int16[P+2]=c,this.int16[P+3]=h,this.int16[P+4]=p,this.int16[P+5]=m,this.uint32[L+3]=y,this.uint16[P+8]=w,this.uint16[P+9]=I,e}}Zr.prototype.bytesPerElement=20,Ke("StructArrayLayout6i1ul2ui20",Zr);class za extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,c,h,p)}emplace(e,n,s,c,h,p,m){const y=6*e;return this.int16[y+0]=n,this.int16[y+1]=s,this.int16[y+2]=c,this.int16[y+3]=h,this.int16[y+4]=p,this.int16[y+5]=m,e}}za.prototype.bytesPerElement=12,Ke("StructArrayLayout2i2i2i12",za);class Ao extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,s,c,h)}emplace(e,n,s,c,h,p){const m=4*e,y=8*e;return this.float32[m+0]=n,this.float32[m+1]=s,this.float32[m+2]=c,this.int16[y+6]=h,this.int16[y+7]=p,e}}Ao.prototype.bytesPerElement=16,Ke("StructArrayLayout2f1f2i16",Ao);class Wr extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,c)}emplace(e,n,s,c,h){const p=12*e,m=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=s,this.float32[m+1]=c,this.float32[m+2]=h,e}}Wr.prototype.bytesPerElement=12,Ke("StructArrayLayout2ub2f12",Wr);class Mo extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,s)}emplace(e,n,s,c){const h=3*e;return this.uint16[h+0]=n,this.uint16[h+1]=s,this.uint16[h+2]=c,e}}Mo.prototype.bytesPerElement=6,Ke("StructArrayLayout3ui6",Mo);class Da extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,p,m,y,w,I,P,L,B,O,H,q,ne){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,n,s,c,h,p,m,y,w,I,P,L,B,O,H,q,ne)}emplace(e,n,s,c,h,p,m,y,w,I,P,L,B,O,H,q,ne,oe){const ee=24*e,le=12*e,pe=48*e;return this.int16[ee+0]=n,this.int16[ee+1]=s,this.uint16[ee+2]=c,this.uint16[ee+3]=h,this.uint32[le+2]=p,this.uint32[le+3]=m,this.uint32[le+4]=y,this.uint16[ee+10]=w,this.uint16[ee+11]=I,this.uint16[ee+12]=P,this.float32[le+7]=L,this.float32[le+8]=B,this.uint8[pe+36]=O,this.uint8[pe+37]=H,this.uint8[pe+38]=q,this.uint32[le+10]=ne,this.int16[ee+22]=oe,e}}Da.prototype.bytesPerElement=48,Ke("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Da);class Co extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,p,m,y,w,I,P,L,B,O,H,q,ne,oe,ee,le,pe,ve,Ye,Je,$e,Ue,Le,Ge){const Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,e,n,s,c,h,p,m,y,w,I,P,L,B,O,H,q,ne,oe,ee,le,pe,ve,Ye,Je,$e,Ue,Le,Ge)}emplace(e,n,s,c,h,p,m,y,w,I,P,L,B,O,H,q,ne,oe,ee,le,pe,ve,Ye,Je,$e,Ue,Le,Ge,Ve){const Ce=34*e,lt=17*e;return this.int16[Ce+0]=n,this.int16[Ce+1]=s,this.int16[Ce+2]=c,this.int16[Ce+3]=h,this.int16[Ce+4]=p,this.int16[Ce+5]=m,this.int16[Ce+6]=y,this.int16[Ce+7]=w,this.uint16[Ce+8]=I,this.uint16[Ce+9]=P,this.uint16[Ce+10]=L,this.uint16[Ce+11]=B,this.uint16[Ce+12]=O,this.uint16[Ce+13]=H,this.uint16[Ce+14]=q,this.uint16[Ce+15]=ne,this.uint16[Ce+16]=oe,this.uint16[Ce+17]=ee,this.uint16[Ce+18]=le,this.uint16[Ce+19]=pe,this.uint16[Ce+20]=ve,this.uint16[Ce+21]=Ye,this.uint16[Ce+22]=Je,this.uint32[lt+12]=$e,this.float32[lt+13]=Ue,this.float32[lt+14]=Le,this.float32[lt+15]=Ge,this.float32[lt+16]=Ve,e}}Co.prototype.bytesPerElement=68,Ke("StructArrayLayout8i15ui1ul4f68",Co);class Po extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Po.prototype.bytesPerElement=4,Ke("StructArrayLayout1f4",Po);class ko extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,s)}emplace(e,n,s,c){const h=4*e;return this.uint32[2*e+0]=n,this.uint16[h+2]=s,this.uint16[h+3]=c,e}}ko.prototype.bytesPerElement=8,Ke("StructArrayLayout1ul2ui8",ko);class l extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=s,e}}l.prototype.bytesPerElement=4,Ke("StructArrayLayout2ui4",l);class t extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}t.prototype.bytesPerElement=2,Ke("StructArrayLayout1ui2",t);class r extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,c)}emplace(e,n,s,c,h){const p=4*e;return this.float32[p+0]=n,this.float32[p+1]=s,this.float32[p+2]=c,this.float32[p+3]=h,e}}r.prototype.bytesPerElement=16,Ke("StructArrayLayout4f16",r);class a extends Ar{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new W(this.anchorPointX,this.anchorPointY)}}a.prototype.size=20;class u extends Zr{get(e){return new a(this,e)}}Ke("CollisionBoxArray",u);class d extends Ar{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}d.prototype.size=48;class g extends Da{get(e){return new d(this,e)}}Ke("PlacedSymbolArray",g);class b extends Ar{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}b.prototype.size=68;class v extends Co{get(e){return new b(this,e)}}Ke("SymbolInstanceArray",v);class T extends Po{getoffsetX(e){return this.float32[1*e+0]}}Ke("GlyphOffsetArray",T);class M extends So{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ke("SymbolLineVertexArray",M);class A extends Ar{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}A.prototype.size=8;class F extends ko{get(e){return new A(this,e)}}Ke("FeatureIndexArray",F);class Z extends cs{}class $ extends cs{}class G extends cs{}class K extends xr{}class te extends Eo{}class ue extends Gr{}class X extends Io{}class ce extends Os{}class ge extends ka{}class Te extends us{}class Me extends za{}class ke extends Wr{}class Ie extends Mo{}class Ze extends l{}const at=Mi([{name:"a_pos",components:2,type:"Int16"}],4),{members:mt}=at;class Fe{constructor(e=[]){this.segments=e}prepareSegment(e,n,s,c){let h=this.segments[this.segments.length-1];return e>Fe.MAX_VERTEX_ARRAY_LENGTH&&Wt(`Max vertices per segment is ${Fe.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>Fe.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==c)&&(h={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},c!==void 0&&(h.sortKey=c),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,c){return new Fe([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}function ut(i,e){return 256*(i=Se(Math.floor(i),0,255))+Se(Math.floor(e),0,255)}Fe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ke("SegmentVector",Fe);const He=Mi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var kt={exports:{}},vi={exports:{}};vi.exports=function(i,e){var n,s,c,h,p,m,y,w;for(s=i.length-(n=3&i.length),c=e,p=3432918353,m=461845907,w=0;w<s;)y=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24,++w,c=27492+(65535&(h=5*(65535&(c=(c^=y=(65535&(y=(y=(65535&y)*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*m+(((y>>>16)*m&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(y=0,n){case 3:y^=(255&i.charCodeAt(w+2))<<16;case 2:y^=(255&i.charCodeAt(w+1))<<8;case 1:c^=y=(65535&(y=(y=(65535&(y^=255&i.charCodeAt(w)))*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*m+(((y>>>16)*m&65535)<<16)&4294967295}return c^=i.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var zt=vi.exports,_t={exports:{}};_t.exports=function(i,e){for(var n,s=i.length,c=e^s,h=0;s>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(h)|(255&i.charCodeAt(++h))<<8|(255&i.charCodeAt(++h))<<16|(255&i.charCodeAt(++h))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++h;switch(s){case 3:c^=(255&i.charCodeAt(h+2))<<16;case 2:c^=(255&i.charCodeAt(h+1))<<8;case 1:c=1540483477*(65535&(c^=255&i.charCodeAt(h)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var ci=zt,un=_t.exports;kt.exports=ci,kt.exports.murmur3=ci,kt.exports.murmur2=un;var bi=U(kt.exports);class Oi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,s,c){this.ids.push(Rn(e)),this.positions.push(n,s,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Rn(e);let s=0,c=this.ids.length-1;for(;s<c;){const p=s+c>>1;this.ids[p]>=n?c=p:s=p+1}const h=[];for(;this.ids[s]===n;)h.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return h}static serialize(e,n){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return rr(s,c,0,s.length-1),n&&n.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(e){const n=new Oi;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function Rn(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:bi(String(i))}function rr(i,e,n,s){for(;n<s;){const c=i[n+s>>1];let h=n-1,p=s+1;for(;;){do h++;while(i[h]<c);do p--;while(i[p]>c);if(h>=p)break;sr(i,h,p),sr(e,3*h,3*p),sr(e,3*h+1,3*p+1),sr(e,3*h+2,3*p+2)}p-n<s-p?(rr(i,e,n,p),n=p+1):(rr(i,e,p+1,s),s=p)}}function sr(i,e,n){const s=i[e];i[e]=i[n],i[n]=s}Ke("FeaturePositionMap",Oi);class hn{constructor(e,n){this.gl=e.gl,this.location=n}}class vr extends hn{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Us extends hn{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class tn extends hn{constructor(e,n){super(e,n),this.current=Ct.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Ui=new Float32Array(16);function Lt(i){return[ut(255*i.r,255*i.g),ut(255*i.b,255*i.a)]}class ki{constructor(e,n,s){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=s}setUniform(e,n,s){e.set(s.constantOr(this.value))}getBinding(e,n,s){return this.type==="color"?new tn(e,n):new vr(e,n)}}class Vi{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setUniform(e,n,s,c){const h=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&e.set(h)}getBinding(e,n,s){return s.substr(0,9)==="u_pattern"?new Us(e,n):new vr(e,n)}}class Bt{constructor(e,n,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(h=>({name:`a_${h}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,s,c,h){const p=this.paintVertexArray.length,m=this.expression.evaluate(new Jt(0),n,{},c,[],h);this.paintVertexArray.resize(e),this._setPaintValue(p,e,m)}updatePaintArray(e,n,s,c){const h=this.expression.evaluate({zoom:0},s,c);this._setPaintValue(e,n,h)}_setPaintValue(e,n,s){if(this.type==="color"){const c=Lt(s);for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class zi{constructor(e,n,s,c,h,p){this.expression=e,this.uniformNames=n.map(m=>`u_${m}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,s,c,h){const p=this.expression.evaluate(new Jt(this.zoom),n,{},c,[],h),m=this.expression.evaluate(new Jt(this.zoom+1),n,{},c,[],h),y=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(y,e,p,m)}updatePaintArray(e,n,s,c){const h=this.expression.evaluate({zoom:this.zoom},s,c),p=this.expression.evaluate({zoom:this.zoom+1},s,c);this._setPaintValue(e,n,h,p)}_setPaintValue(e,n,s,c){if(this.type==="color"){const h=Lt(s),p=Lt(c);for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,h[0],h[1],p[0],p[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const s=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=Se(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,n,s){return new vr(e,n)}}class Bn{constructor(e,n,s,c,h,p){this.expression=e,this.type=n,this.useIntegerZoom=s,this.zoom=c,this.layerId=p,this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(e,n,s){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,c,h){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],h)}_setPaintValues(e,n,s,c){if(!c||!s)return;const{min:h,mid:p,max:m}=s,y=c[h],w=c[p],I=c[m];if(y&&w&&I)for(let P=e;P<n;P++)this.zoomInPaintVertexArray.emplace(P,w.tl[0],w.tl[1],w.br[0],w.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],w.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,w.tl[0],w.tl[1],w.br[0],w.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],w.pixelRatio,I.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,He.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,He.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class zo{constructor(e,n,s){this.binders={},this._buffers=[];const c=[];for(const h in e.paint._values){if(!s(h))continue;const p=e.paint.get(h);if(!(p instanceof _r&&ss(p.property.specification)))continue;const m=Bc(h,e.type),y=p.value,w=p.property.specification.type,I=p.property.useIntegerZoom,P=p.property.specification["property-type"],L=P==="cross-faded"||P==="cross-faded-data-driven";if(y.kind==="constant")this.binders[h]=L?new Vi(y.value,m):new ki(y.value,m,w),c.push(`/u_${h}`);else if(y.kind==="source"||L){const B=Ul(h,w,"source");this.binders[h]=L?new Bn(y,w,I,n,B,e.id):new Bt(y,m,w,B),c.push(`/a_${h}`)}else{const B=Ul(h,w,"composite");this.binders[h]=new zi(y,m,w,I,n,B),c.push(`/z_${h}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Bt||n instanceof zi?n.maxValue:0}populatePaintArrays(e,n,s,c,h){for(const p in this.binders){const m=this.binders[p];(m instanceof Bt||m instanceof zi||m instanceof Bn)&&m.populatePaintArray(e,n,s,c,h)}}setConstantPatternPositions(e,n){for(const s in this.binders){const c=this.binders[s];c instanceof Vi&&c.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,s,c,h){let p=!1;for(const m in e){const y=n.getPositions(m);for(const w of y){const I=s.feature(w.index);for(const P in this.binders){const L=this.binders[P];if((L instanceof Bt||L instanceof zi||L instanceof Bn)&&L.expression.isStateDependent===!0){const B=c.paint.get(P);L.expression=B.value,L.updatePaintArray(w.start,w.end,I,e[m],h),p=!0}}}}return p}defines(){const e=[];for(const n in this.binders){const s=this.binders[n];(s instanceof ki||s instanceof Vi)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof Bt||s instanceof zi)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name);else if(s instanceof Bn)for(let c=0;c<He.members.length;c++)e.push(He.members[c].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof ki||s instanceof Vi||s instanceof zi)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const s=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof ki||h instanceof Vi||h instanceof zi){for(const p of h.uniformNames)if(n[p]){const m=h.getBinding(e,n[p],p);s.push({name:p,property:c,binding:m})}}}return s}setUniforms(e,n,s,c){for(const{name:h,property:p,binding:m}of n)this.binders[p].setUniform(m,c,s.get(p),h)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const s=this.binders[n];if(e&&s instanceof Bn){const c=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(s instanceof Bt||s instanceof zi)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const n in this.binders){const s=this.binders[n];(s instanceof Bt||s instanceof zi||s instanceof Bn)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Bt||n instanceof zi||n instanceof Bn)&&n.destroy()}}}class Mr{constructor(e,n,s=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new zo(c,n,s);this.needsUpload=!1,this._featureMap=new Oi,this._bufferOffset=0}populatePaintArrays(e,n,s,c,h,p){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(e,n,c,h,p);n.id!==void 0&&this._featureMap.add(n.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,c){for(const h of s)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,n,h,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Bc(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Ul(i,e,n){const s={color:{source:Gr,composite:r},number:{source:Po,composite:Gr}},c=function(h){return{"line-pattern":{source:X,composite:X},"fill-pattern":{source:X,composite:X},"fill-extrusion-pattern":{source:X,composite:X}}[h]}(i);return c&&c[n]||s[e][n]}Ke("ConstantBinder",ki),Ke("CrossFadedConstantBinder",Vi),Ke("SourceExpressionBinder",Bt),Ke("CrossFadedCompositeBinder",Bn),Ke("CompositeExpressionBinder",zi),Ke("ProgramConfiguration",zo,{omit:["_buffers"]}),Ke("ProgramConfigurationSet",Mr);var Qt=8192;const La=Math.pow(2,14)-1,Vs=-La-1;function Cr(i){const e=Qt/i.extent,n=i.loadGeometry();for(let s=0;s<n.length;s++){const c=n[s];for(let h=0;h<c.length;h++){const p=c[h],m=Math.round(p.x*e),y=Math.round(p.y*e);p.x=Se(m,Vs,La),p.y=Se(y,Vs,La),(m<p.x||m>p.x+1||y<p.y||y>p.y+1)&&Wt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Ns(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Cr(i):[]}}function Vl(i,e,n,s,c){i.emplaceBack(2*e+(s+1)/2,2*n+(c+1)/2)}class Fc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new $,this.indexArray=new Ie,this.segments=new Fe,this.programConfigurations=new Mr(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){const c=this.layers[0],h=[];let p=null,m=!1;c.type==="circle"&&(p=c.layout.get("circle-sort-key"),m=!p.isConstant());for(const{feature:y,id:w,index:I,sourceLayerIndex:P}of e){const L=this.layers[0]._featureFilter.needGeometry,B=Ns(y,L);if(!this.layers[0]._featureFilter.filter(new Jt(this.zoom),B,s))continue;const O=m?p.evaluate(B,{},s):void 0,H={id:w,properties:y.properties,type:y.type,sourceLayerIndex:P,index:I,geometry:L?B.geometry:Cr(y),patterns:{},sortKey:O};h.push(H)}m&&h.sort((y,w)=>y.sortKey-w.sortKey);for(const y of h){const{geometry:w,index:I,sourceLayerIndex:P}=y,L=e[I].feature;this.addFeature(y,w,I,s),n.featureIndex.insert(L,w,I,P,this.index)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,c){for(const h of n)for(const p of h){const m=p.x,y=p.y;if(m<0||m>=Qt||y<0||y>=Qt)continue;const w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),I=w.vertexLength;Vl(this.layoutVertexArray,m,y,-1,-1),Vl(this.layoutVertexArray,m,y,1,-1),Vl(this.layoutVertexArray,m,y,1,1),Vl(this.layoutVertexArray,m,y,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),w.vertexLength+=4,w.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c)}}function Nu(i,e){for(let n=0;n<i.length;n++)if(Do(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Do(i,e[n]))return!0;return!!Oc(i,e)}function bd(i,e,n){return!!Do(i,e)||!!Uc(e,i,n)}function $u(i,e){if(i.length===1)return qu(e,i[0]);for(let n=0;n<e.length;n++){const s=e[n];for(let c=0;c<s.length;c++)if(Do(i,s[c]))return!0}for(let n=0;n<i.length;n++)if(qu(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Oc(i,e[n]))return!0;return!1}function wd(i,e,n){if(i.length>1){if(Oc(i,e))return!0;for(let s=0;s<e.length;s++)if(Uc(e[s],i,n))return!0}for(let s=0;s<i.length;s++)if(Uc(i[s],e,n))return!0;return!1}function Oc(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const s=i[n],c=i[n+1];for(let h=0;h<e.length-1;h++)if(Td(s,c,e[h],e[h+1]))return!0}return!1}function Td(i,e,n,s){return yt(i,n,s)!==yt(e,n,s)&&yt(i,e,n)!==yt(i,e,s)}function Uc(i,e,n){const s=n*n;if(e.length===1)return i.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(ju(i,e[c-1],e[c])<s)return!0;return!1}function ju(i,e,n){const s=e.distSqr(n);if(s===0)return i.distSqr(e);const c=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/s;return i.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function qu(i,e){let n,s,c,h=!1;for(let p=0;p<i.length;p++){n=i[p];for(let m=0,y=n.length-1;m<n.length;y=m++)s=n[m],c=n[y],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(h=!h)}return h}function Do(i,e){let n=!1;for(let s=0,c=i.length-1;s<i.length;c=s++){const h=i[s],p=i[c];h.y>e.y!=p.y>e.y&&e.x<(p.x-h.x)*(e.y-h.y)/(p.y-h.y)+h.x&&(n=!n)}return n}function Sd(i,e,n){const s=n[0],c=n[2];if(i.x<s.x&&e.x<s.x||i.x>c.x&&e.x>c.x||i.y<s.y&&e.y<s.y||i.y>c.y&&e.y>c.y)return!1;const h=yt(i,e,n[0]);return h!==yt(i,e,n[1])||h!==yt(i,e,n[2])||h!==yt(i,e,n[3])}function Ra(i,e,n){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:n.programConfigurations.get(e.id).getMaxValue(i)}function Nl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function $l(i,e,n,s,c){if(!e[0]&&!e[1])return i;const h=W.convert(e)._mult(c);n==="viewport"&&h._rotate(-s);const p=[];for(let m=0;m<i.length;m++)p.push(i[m].sub(h));return p}let Gu,Zu;Ke("CircleBucket",Fc,{omit:["layers"]});var Ed={get paint(){return Zu=Zu||new En({"circle-radius":new ct(ye.paint_circle["circle-radius"]),"circle-color":new ct(ye.paint_circle["circle-color"]),"circle-blur":new ct(ye.paint_circle["circle-blur"]),"circle-opacity":new ct(ye.paint_circle["circle-opacity"]),"circle-translate":new it(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new it(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new it(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new it(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ct(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ct(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ct(ye.paint_circle["circle-stroke-opacity"])})},get layout(){return Gu=Gu||new En({"circle-sort-key":new ct(ye.layout_circle["circle-sort-key"])})}},In=1e-6,Lo=typeof Float32Array<"u"?Float32Array:Array;function Vc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Wu(i,e,n){var s=e[0],c=e[1],h=e[2],p=e[3],m=e[4],y=e[5],w=e[6],I=e[7],P=e[8],L=e[9],B=e[10],O=e[11],H=e[12],q=e[13],ne=e[14],oe=e[15],ee=n[0],le=n[1],pe=n[2],ve=n[3];return i[0]=ee*s+le*m+pe*P+ve*H,i[1]=ee*c+le*y+pe*L+ve*q,i[2]=ee*h+le*w+pe*B+ve*ne,i[3]=ee*p+le*I+pe*O+ve*oe,i[4]=(ee=n[4])*s+(le=n[5])*m+(pe=n[6])*P+(ve=n[7])*H,i[5]=ee*c+le*y+pe*L+ve*q,i[6]=ee*h+le*w+pe*B+ve*ne,i[7]=ee*p+le*I+pe*O+ve*oe,i[8]=(ee=n[8])*s+(le=n[9])*m+(pe=n[10])*P+(ve=n[11])*H,i[9]=ee*c+le*y+pe*L+ve*q,i[10]=ee*h+le*w+pe*B+ve*ne,i[11]=ee*p+le*I+pe*O+ve*oe,i[12]=(ee=n[12])*s+(le=n[13])*m+(pe=n[14])*P+(ve=n[15])*H,i[13]=ee*c+le*y+pe*L+ve*q,i[14]=ee*h+le*w+pe*B+ve*ne,i[15]=ee*p+le*I+pe*O+ve*oe,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Ba,Id=Wu;function jl(i,e,n){var s=e[0],c=e[1],h=e[2],p=e[3];return i[0]=n[0]*s+n[4]*c+n[8]*h+n[12]*p,i[1]=n[1]*s+n[5]*c+n[9]*h+n[13]*p,i[2]=n[2]*s+n[6]*c+n[10]*h+n[14]*p,i[3]=n[3]*s+n[7]*c+n[11]*h+n[15]*p,i}function Hu(i,e){const n=jl([],[i.x,i.y,0,1],e);return new W(n[0]/n[3],n[1]/n[3])}Ba=new Lo(4),Lo!=Float32Array&&(Ba[0]=0,Ba[1]=0,Ba[2]=0,Ba[3]=0);class Xu extends Fc{}let Yu;Ke("HeatmapBucket",Xu,{omit:["layers"]});var Ad={get paint(){return Yu=Yu||new En({"heatmap-radius":new ct(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ct(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new it(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ca(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new it(ye.paint_heatmap["heatmap-opacity"])})}};function Nc(i,{width:e,height:n},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*s)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*n*s}`)}else c=new Uint8Array(e*n*s);return i.width=e,i.height=n,i.data=c,i}function Ku(i,{width:e,height:n},s){if(e===i.width&&n===i.height)return;const c=Nc({},{width:e,height:n},s);$c(i,c,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},s),i.width=e,i.height=n,i.data=c.data}function $c(i,e,n,s,c,h){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||n.x>i.width-c.width||n.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,m=e.data;if(p===m)throw new Error("srcData equals dstData, so image is already copied");for(let y=0;y<c.height;y++){const w=((n.y+y)*i.width+n.x)*h,I=((s.y+y)*e.width+s.x)*h;for(let P=0;P<c.width*h;P++)m[I+P]=p[w+P]}return e}class Fa{constructor(e,n){Nc(this,e,1,n)}resize(e){Ku(this,e,1)}clone(){return new Fa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,c,h){$c(e,n,s,c,h,1)}}class or{constructor(e,n){Nc(this,e,4,n)}resize(e){Ku(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new or({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,c,h){$c(e,n,s,c,h,4)}}function Ju(i){const e={},n=i.resolution||256,s=i.clips?i.clips.length:1,c=i.image||new or({width:n,height:s});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const h=(p,m,y)=>{e[i.evaluationKey]=y;const w=i.expression.evaluate(e);c.data[p+m+0]=Math.floor(255*w.r/w.a),c.data[p+m+1]=Math.floor(255*w.g/w.a),c.data[p+m+2]=Math.floor(255*w.b/w.a),c.data[p+m+3]=Math.floor(255*w.a)};if(i.clips)for(let p=0,m=0;p<s;++p,m+=4*n)for(let y=0,w=0;y<n;y++,w+=4){const I=y/(n-1),{start:P,end:L}=i.clips[p];h(m,w,P*(1-I)+L*I)}else for(let p=0,m=0;p<n;p++,m+=4)h(0,m,p/(n-1));return c}let Qu;Ke("AlphaImage",Fa),Ke("RGBAImage",or);var Md={get paint(){return Qu=Qu||new En({"hillshade-illumination-direction":new it(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new it(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new it(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new it(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new it(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new it(ye.paint_hillshade["hillshade-accent-color"])})}};const Cd=Mi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Pd}=Cd;var jc={exports:{}};function ql(i,e,n){n=n||2;var s,c,h,p,m,y,w,I=e&&e.length,P=I?e[0]*n:i.length,L=eh(i,0,P,n,!0),B=[];if(!L||L.next===L.prev)return B;if(I&&(L=function(H,q,ne,oe){var ee,le,pe,ve=[];for(ee=0,le=q.length;ee<le;ee++)(pe=eh(H,q[ee]*oe,ee<le-1?q[ee+1]*oe:H.length,oe,!1))===pe.next&&(pe.steiner=!0),ve.push(Od(pe));for(ve.sort(Rd),ee=0;ee<ve.length;ee++)ne=Bd(ve[ee],ne);return ne}(i,e,L,n)),i.length>80*n){s=h=i[0],c=p=i[1];for(var O=n;O<P;O+=n)(m=i[O])<s&&(s=m),(y=i[O+1])<c&&(c=y),m>h&&(h=m),y>p&&(p=y);w=(w=Math.max(h-s,p-c))!==0?32767/w:0}return Oa(L,B,n,s,c,w,0),B}function eh(i,e,n,s,c){var h,p;if(c===Zc(i,e,n,s)>0)for(h=e;h<n;h+=s)p=nh(h,i[h],i[h+1],p);else for(h=n-s;h>=e;h-=s)p=nh(h,i[h],i[h+1],p);return p&&Gl(p,p.next)&&(Va(p),p=p.next),p}function $s(i,e){if(!i)return i;e||(e=i);var n,s=i;do if(n=!1,s.steiner||!Gl(s,s.next)&&wi(s.prev,s,s.next)!==0)s=s.next;else{if(Va(s),(s=e=s.prev)===s.next)break;n=!0}while(n||s!==e);return e}function Oa(i,e,n,s,c,h,p){if(i){!p&&h&&function(I,P,L,B){var O=I;do O.z===0&&(O.z=qc(O.x,O.y,P,L,B)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==I);O.prevZ.nextZ=null,O.prevZ=null,function(H){var q,ne,oe,ee,le,pe,ve,Ye,Je=1;do{for(ne=H,H=null,le=null,pe=0;ne;){for(pe++,oe=ne,ve=0,q=0;q<Je&&(ve++,oe=oe.nextZ);q++);for(Ye=Je;ve>0||Ye>0&&oe;)ve!==0&&(Ye===0||!oe||ne.z<=oe.z)?(ee=ne,ne=ne.nextZ,ve--):(ee=oe,oe=oe.nextZ,Ye--),le?le.nextZ=ee:H=ee,ee.prevZ=le,le=ee;ne=oe}le.nextZ=null,Je*=2}while(pe>1)}(O)}(i,s,c,h);for(var m,y,w=i;i.prev!==i.next;)if(m=i.prev,y=i.next,h?zd(i,s,c,h):kd(i))e.push(m.i/n|0),e.push(i.i/n|0),e.push(y.i/n|0),Va(i),i=y.next,w=y.next;else if((i=y)===w){p?p===1?Oa(i=Dd($s(i),e,n),e,n,s,c,h,2):p===2&&Ld(i,e,n,s,c,h):Oa($s(i),e,n,s,c,h,1);break}}}function kd(i){var e=i.prev,n=i,s=i.next;if(wi(e,n,s)>=0)return!1;for(var c=e.x,h=n.x,p=s.x,m=e.y,y=n.y,w=s.y,I=c<h?c<p?c:p:h<p?h:p,P=m<y?m<w?m:w:y<w?y:w,L=c>h?c>p?c:p:h>p?h:p,B=m>y?m>w?m:w:y>w?y:w,O=s.next;O!==e;){if(O.x>=I&&O.x<=L&&O.y>=P&&O.y<=B&&Ro(c,m,h,y,p,w,O.x,O.y)&&wi(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function zd(i,e,n,s){var c=i.prev,h=i,p=i.next;if(wi(c,h,p)>=0)return!1;for(var m=c.x,y=h.x,w=p.x,I=c.y,P=h.y,L=p.y,B=m<y?m<w?m:w:y<w?y:w,O=I<P?I<L?I:L:P<L?P:L,H=m>y?m>w?m:w:y>w?y:w,q=I>P?I>L?I:L:P>L?P:L,ne=qc(B,O,e,n,s),oe=qc(H,q,e,n,s),ee=i.prevZ,le=i.nextZ;ee&&ee.z>=ne&&le&&le.z<=oe;){if(ee.x>=B&&ee.x<=H&&ee.y>=O&&ee.y<=q&&ee!==c&&ee!==p&&Ro(m,I,y,P,w,L,ee.x,ee.y)&&wi(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,le.x>=B&&le.x<=H&&le.y>=O&&le.y<=q&&le!==c&&le!==p&&Ro(m,I,y,P,w,L,le.x,le.y)&&wi(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;ee&&ee.z>=ne;){if(ee.x>=B&&ee.x<=H&&ee.y>=O&&ee.y<=q&&ee!==c&&ee!==p&&Ro(m,I,y,P,w,L,ee.x,ee.y)&&wi(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;le&&le.z<=oe;){if(le.x>=B&&le.x<=H&&le.y>=O&&le.y<=q&&le!==c&&le!==p&&Ro(m,I,y,P,w,L,le.x,le.y)&&wi(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function Dd(i,e,n){var s=i;do{var c=s.prev,h=s.next.next;!Gl(c,h)&&th(c,s,s.next,h)&&Ua(c,h)&&Ua(h,c)&&(e.push(c.i/n|0),e.push(s.i/n|0),e.push(h.i/n|0),Va(s),Va(s.next),s=i=h),s=s.next}while(s!==i);return $s(s)}function Ld(i,e,n,s,c,h){var p=i;do{for(var m=p.next.next;m!==p.prev;){if(p.i!==m.i&&Ud(p,m)){var y=ih(p,m);return p=$s(p,p.next),y=$s(y,y.next),Oa(p,e,n,s,c,h,0),void Oa(y,e,n,s,c,h,0)}m=m.next}p=p.next}while(p!==i)}function Rd(i,e){return i.x-e.x}function Bd(i,e){var n=function(c,h){var p,m=h,y=c.x,w=c.y,I=-1/0;do{if(w<=m.y&&w>=m.next.y&&m.next.y!==m.y){var P=m.x+(w-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(P<=y&&P>I&&(I=P,p=m.x<m.next.x?m:m.next,P===y))return p}m=m.next}while(m!==h);if(!p)return null;var L,B=p,O=p.x,H=p.y,q=1/0;m=p;do y>=m.x&&m.x>=O&&y!==m.x&&Ro(w<H?y:I,w,O,H,w<H?I:y,w,m.x,m.y)&&(L=Math.abs(w-m.y)/(y-m.x),Ua(m,c)&&(L<q||L===q&&(m.x>p.x||m.x===p.x&&Fd(p,m)))&&(p=m,q=L)),m=m.next;while(m!==B);return p}(i,e);if(!n)return e;var s=ih(n,i);return $s(s,s.next),$s(n,n.next)}function Fd(i,e){return wi(i.prev,i,e.prev)<0&&wi(e.next,i,i.next)<0}function qc(i,e,n,s,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*c|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Od(i){var e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function Ro(i,e,n,s,c,h,p,m){return(c-p)*(e-m)>=(i-p)*(h-m)&&(i-p)*(s-m)>=(n-p)*(e-m)&&(n-p)*(h-m)>=(c-p)*(s-m)}function Ud(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(n,s){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==s.i&&c.next.i!==s.i&&th(c,c.next,n,s))return!0;c=c.next}while(c!==n);return!1}(i,e)&&(Ua(i,e)&&Ua(e,i)&&function(n,s){var c=n,h=!1,p=(n.x+s.x)/2,m=(n.y+s.y)/2;do c.y>m!=c.next.y>m&&c.next.y!==c.y&&p<(c.next.x-c.x)*(m-c.y)/(c.next.y-c.y)+c.x&&(h=!h),c=c.next;while(c!==n);return h}(i,e)&&(wi(i.prev,i,e.prev)||wi(i,e.prev,e))||Gl(i,e)&&wi(i.prev,i,i.next)>0&&wi(e.prev,e,e.next)>0)}function wi(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function Gl(i,e){return i.x===e.x&&i.y===e.y}function th(i,e,n,s){var c=Wl(wi(i,e,n)),h=Wl(wi(i,e,s)),p=Wl(wi(n,s,i)),m=Wl(wi(n,s,e));return c!==h&&p!==m||!(c!==0||!Zl(i,n,e))||!(h!==0||!Zl(i,s,e))||!(p!==0||!Zl(n,i,s))||!(m!==0||!Zl(n,e,s))}function Zl(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function Wl(i){return i>0?1:i<0?-1:0}function Ua(i,e){return wi(i.prev,i,i.next)<0?wi(i,e,i.next)>=0&&wi(i,i.prev,e)>=0:wi(i,e,i.prev)<0||wi(i,i.next,e)<0}function ih(i,e){var n=new Gc(i.i,i.x,i.y),s=new Gc(e.i,e.x,e.y),c=i.next,h=e.prev;return i.next=e,e.prev=i,n.next=c,c.prev=n,s.next=n,n.prev=s,h.next=s,s.prev=h,s}function nh(i,e,n,s){var c=new Gc(i,e,n);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function Va(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Gc(i,e,n){this.i=i,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Zc(i,e,n,s){for(var c=0,h=e,p=n-s;h<n;h+=s)c+=(i[p]-i[h])*(i[h+1]+i[p+1]),p=h;return c}jc.exports=ql,jc.exports.default=ql,ql.deviation=function(i,e,n,s){var c=e&&e.length,h=Math.abs(Zc(i,0,c?e[0]*n:i.length,n));if(c)for(var p=0,m=e.length;p<m;p++)h-=Math.abs(Zc(i,e[p]*n,p<m-1?e[p+1]*n:i.length,n));var y=0;for(p=0;p<s.length;p+=3){var w=s[p]*n,I=s[p+1]*n,P=s[p+2]*n;y+=Math.abs((i[w]-i[P])*(i[I+1]-i[w+1])-(i[w]-i[I])*(i[P+1]-i[w+1]))}return h===0&&y===0?0:Math.abs((y-h)/h)},ql.flatten=function(i){for(var e=i[0][0].length,n={vertices:[],holes:[],dimensions:e},s=0,c=0;c<i.length;c++){for(var h=0;h<i[c].length;h++)for(var p=0;p<e;p++)n.vertices.push(i[c][h][p]);c>0&&n.holes.push(s+=i[c-1].length)}return n};var rh=U(jc.exports);function Vd(i,e,n,s,c){sh(i,e,n||0,s||i.length-1,c||Nd)}function sh(i,e,n,s,c){for(;s>n;){if(s-n>600){var h=s-n+1,p=e-n+1,m=Math.log(h),y=.5*Math.exp(2*m/3),w=.5*Math.sqrt(m*y*(h-y)/h)*(p-h/2<0?-1:1);sh(i,e,Math.max(n,Math.floor(e-p*y/h+w)),Math.min(s,Math.floor(e+(h-p)*y/h+w)),c)}var I=i[e],P=n,L=s;for(Na(i,n,e),c(i[s],I)>0&&Na(i,n,s);P<L;){for(Na(i,P,L),P++,L--;c(i[P],I)<0;)P++;for(;c(i[L],I)>0;)L--}c(i[n],I)===0?Na(i,n,L):Na(i,++L,s),L<=e&&(n=L+1),e<=L&&(s=L-1)}}function Na(i,e,n){var s=i[e];i[e]=i[n],i[n]=s}function Nd(i,e){return i<e?-1:i>e?1:0}function Wc(i,e){const n=i.length;if(n<=1)return[i];const s=[];let c,h;for(let p=0;p<n;p++){const m=fi(i[p]);m!==0&&(i[p].area=Math.abs(m),h===void 0&&(h=m<0),h===m<0?(c&&s.push(c),c=[i[p]]):c.push(i[p]))}if(c&&s.push(c),e>1)for(let p=0;p<s.length;p++)s[p].length<=e||(Vd(s[p],e,1,s[p].length-1,$d),s[p]=s[p].slice(0,e));return s}function $d(i,e){return e.area-i.area}function Hc(i,e,n){const s=n.patternDependencies;let c=!1;for(const h of e){const p=h.paint.get(`${i}-pattern`);p.isConstant()||(c=!0);const m=p.constantOr(null);m&&(c=!0,s[m.to]=!0,s[m.from]=!0)}return c}function Xc(i,e,n,s,c){const h=c.patternDependencies;for(const p of e){const m=p.paint.get(`${i}-pattern`).value;if(m.kind!=="constant"){let y=m.evaluate({zoom:s-1},n,{},c.availableImages),w=m.evaluate({zoom:s},n,{},c.availableImages),I=m.evaluate({zoom:s+1},n,{},c.availableImages);y=y&&y.name?y.name:y,w=w&&w.name?w.name:w,I=I&&I.name?I.name:I,h[y]=!0,h[w]=!0,h[I]=!0,n.patterns[p.id]={min:y,mid:w,max:I}}}return n}class Yc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new G,this.indexArray=new Ie,this.indexArray2=new Ze,this.programConfigurations=new Mr(e.layers,e.zoom),this.segments=new Fe,this.segments2=new Fe,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){this.hasPattern=Hc("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),h=!c.isConstant(),p=[];for(const{feature:m,id:y,index:w,sourceLayerIndex:I}of e){const P=this.layers[0]._featureFilter.needGeometry,L=Ns(m,P);if(!this.layers[0]._featureFilter.filter(new Jt(this.zoom),L,s))continue;const B=h?c.evaluate(L,{},s,n.availableImages):void 0,O={id:y,properties:m.properties,type:m.type,sourceLayerIndex:I,index:w,geometry:P?L.geometry:Cr(m),patterns:{},sortKey:B};p.push(O)}h&&p.sort((m,y)=>m.sortKey-y.sortKey);for(const m of p){const{geometry:y,index:w,sourceLayerIndex:I}=m;if(this.hasPattern){const P=Xc("fill",this.layers,m,this.zoom,n);this.patternFeatures.push(P)}else this.addFeature(m,y,w,s,{});n.featureIndex.insert(e[w].feature,y,w,I,this.index)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}addFeatures(e,n,s){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,c,h){for(const p of Wc(n,500)){let m=0;for(const B of p)m+=B.length;const y=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),w=y.vertexLength,I=[],P=[];for(const B of p){if(B.length===0)continue;B!==p[0]&&P.push(I.length/2);const O=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),H=O.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(H+B.length-1,H),I.push(B[0].x),I.push(B[0].y);for(let q=1;q<B.length;q++)this.layoutVertexArray.emplaceBack(B[q].x,B[q].y),this.indexArray2.emplaceBack(H+q-1,H+q),I.push(B[q].x),I.push(B[q].y);O.vertexLength+=B.length,O.primitiveLength+=B.length}const L=rh(I,P);for(let B=0;B<L.length;B+=3)this.indexArray.emplaceBack(w+L[B],w+L[B+1],w+L[B+2]);y.vertexLength+=m,y.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,c)}}let oh,ah;Ke("FillBucket",Yc,{omit:["layers","patternFeatures"]});var jd={get paint(){return ah=ah||new En({"fill-antialias":new it(ye.paint_fill["fill-antialias"]),"fill-opacity":new ct(ye.paint_fill["fill-opacity"]),"fill-color":new ct(ye.paint_fill["fill-color"]),"fill-outline-color":new ct(ye.paint_fill["fill-outline-color"]),"fill-translate":new it(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new it(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fs(ye.paint_fill["fill-pattern"])})},get layout(){return oh=oh||new En({"fill-sort-key":new ct(ye.layout_fill["fill-sort-key"])})}};const qd=Mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Gd=Mi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Zd}=qd;var hs={},Wd=z,lh=Bo;function Bo(i,e,n,s,c){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=c,i.readFields(Hd,this,e)}function Hd(i,e,n){i==1?e.id=n.readVarint():i==2?function(s,c){for(var h=s.readVarint()+s.pos;s.pos<h;){var p=c._keys[s.readVarint()],m=c._values[s.readVarint()];c.properties[p]=m}}(n,e):i==3?e.type=n.readVarint():i==4&&(e._geometry=n.pos)}function Xd(i){for(var e,n,s=0,c=0,h=i.length,p=h-1;c<h;p=c++)s+=((n=i[p]).x-(e=i[c]).x)*(e.y+n.y);return s}Bo.types=["Unknown","Point","LineString","Polygon"],Bo.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,n=i.readVarint()+i.pos,s=1,c=0,h=0,p=0,m=[];i.pos<n;){if(c<=0){var y=i.readVarint();s=7&y,c=y>>3}if(c--,s===1||s===2)h+=i.readSVarint(),p+=i.readSVarint(),s===1&&(e&&m.push(e),e=[]),e.push(new Wd(h,p));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&m.push(e),m},Bo.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,n=1,s=0,c=0,h=0,p=1/0,m=-1/0,y=1/0,w=-1/0;i.pos<e;){if(s<=0){var I=i.readVarint();n=7&I,s=I>>3}if(s--,n===1||n===2)(c+=i.readSVarint())<p&&(p=c),c>m&&(m=c),(h+=i.readSVarint())<y&&(y=h),h>w&&(w=h);else if(n!==7)throw new Error("unknown command "+n)}return[p,y,m,w]},Bo.prototype.toGeoJSON=function(i,e,n){var s,c,h=this.extent*Math.pow(2,n),p=this.extent*i,m=this.extent*e,y=this.loadGeometry(),w=Bo.types[this.type];function I(B){for(var O=0;O<B.length;O++){var H=B[O];B[O]=[360*(H.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+m)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(s=0;s<y.length;s++)P[s]=y[s][0];I(y=P);break;case 2:for(s=0;s<y.length;s++)I(y[s]);break;case 3:for(y=function(B){var O=B.length;if(O<=1)return[B];for(var H,q,ne=[],oe=0;oe<O;oe++){var ee=Xd(B[oe]);ee!==0&&(q===void 0&&(q=ee<0),q===ee<0?(H&&ne.push(H),H=[B[oe]]):H.push(B[oe]))}return H&&ne.push(H),ne}(y),s=0;s<y.length;s++)for(c=0;c<y[s].length;c++)I(y[s][c])}y.length===1?y=y[0]:w="Multi"+w;var L={type:"Feature",geometry:{type:w,coordinates:y},properties:this.properties};return"id"in this&&(L.id=this.id),L};var Yd=lh,ch=uh;function uh(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Kd,this,e),this.length=this._features.length}function Kd(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push(function(s){for(var c=null,h=s.readVarint()+s.pos;s.pos<h;){var p=s.readVarint()>>3;c=p===1?s.readString():p===2?s.readFloat():p===3?s.readDouble():p===4?s.readVarint64():p===5?s.readVarint():p===6?s.readSVarint():p===7?s.readBoolean():null}return c}(n))}uh.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Yd(this._pbf,e,this.extent,this._keys,this._values)};var Jd=ch;function Qd(i,e,n){if(i===3){var s=new Jd(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}hs.VectorTile=function(i,e){this.layers=i.readFields(Qd,{},e)},hs.VectorTileFeature=lh,hs.VectorTileLayer=ch;const ef=hs.VectorTileFeature.types,Kc=Math.pow(2,13);function $a(i,e,n,s,c,h,p,m){i.emplaceBack(e,n,2*Math.floor(s*Kc)+p,c*Kc*2,h*Kc*2,Math.round(m))}class Jc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new K,this.centroidVertexArray=new Z,this.indexArray=new Ie,this.programConfigurations=new Mr(e.layers,e.zoom),this.segments=new Fe,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){this.features=[],this.hasPattern=Hc("fill-extrusion",this.layers,n);for(const{feature:c,id:h,index:p,sourceLayerIndex:m}of e){const y=this.layers[0]._featureFilter.needGeometry,w=Ns(c,y);if(!this.layers[0]._featureFilter.filter(new Jt(this.zoom),w,s))continue;const I={id:h,sourceLayerIndex:m,index:p,geometry:y?w.geometry:Cr(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Xc("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,p,s,{}),n.featureIndex.insert(c,I.geometry,p,m,this.index,!0)}}addFeatures(e,n,s){for(const c of this.features){const{geometry:h}=c;this.addFeature(c,h,c.index,n,s)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zd),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Gd.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,s,c,h){const p={x:0,y:0,vertexCount:0};for(const m of Wc(n,500)){let y=0;for(const O of m)y+=O.length;let w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const O of m){if(O.length===0||nf(O))continue;let H=0;for(let q=0;q<O.length;q++){const ne=O[q];if(q>=1){const oe=O[q-1];if(!tf(ne,oe)){w.vertexLength+4>Fe.MAX_VERTEX_ARRAY_LENGTH&&(w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ee=ne.sub(oe)._perp()._unit(),le=oe.dist(ne);H+le>32768&&(H=0),$a(this.layoutVertexArray,ne.x,ne.y,ee.x,ee.y,0,0,H),$a(this.layoutVertexArray,ne.x,ne.y,ee.x,ee.y,0,1,H),p.x+=2*ne.x,p.y+=2*ne.y,p.vertexCount+=2,H+=le,$a(this.layoutVertexArray,oe.x,oe.y,ee.x,ee.y,0,0,H),$a(this.layoutVertexArray,oe.x,oe.y,ee.x,ee.y,0,1,H),p.x+=2*oe.x,p.y+=2*oe.y,p.vertexCount+=2;const pe=w.vertexLength;this.indexArray.emplaceBack(pe,pe+2,pe+1),this.indexArray.emplaceBack(pe+1,pe+2,pe+3),w.vertexLength+=4,w.primitiveLength+=2}}}}if(w.vertexLength+y>Fe.MAX_VERTEX_ARRAY_LENGTH&&(w=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray)),ef[e.type]!=="Polygon")continue;const I=[],P=[],L=w.vertexLength;for(const O of m)if(O.length!==0){O!==m[0]&&P.push(I.length/2);for(let H=0;H<O.length;H++){const q=O[H];$a(this.layoutVertexArray,q.x,q.y,0,0,1,1,0),p.x+=q.x,p.y+=q.y,p.vertexCount+=1,I.push(q.x),I.push(q.y)}}const B=rh(I,P);for(let O=0;O<B.length;O+=3)this.indexArray.emplaceBack(L+B[O],L+B[O+2],L+B[O+1]);w.primitiveLength+=B.length/3,w.vertexLength+=y}for(let m=0;m<p.vertexCount;m++)this.centroidVertexArray.emplaceBack(Math.floor(p.x/p.vertexCount),Math.floor(p.y/p.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,c)}}function tf(i,e){return i.x===e.x&&(i.x<0||i.x>Qt)||i.y===e.y&&(i.y<0||i.y>Qt)}function nf(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Qt)||i.every(e=>e.y<0)||i.every(e=>e.y>Qt)}let hh;Ke("FillExtrusionBucket",Jc,{omit:["layers","features"]});var rf={get paint(){return hh=hh||new En({"fill-extrusion-opacity":new it(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ct(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new it(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new it(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fs(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ct(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ct(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new it(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};function ja(i,e){return i.x*e.x+i.y*e.y}function ph(i,e){if(i.length===1){let n=0;const s=e[n++];let c;for(;!c||s.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){const h=e[n],p=i[0],m=c.sub(s),y=h.sub(s),w=p.sub(s),I=ja(m,m),P=ja(m,y),L=ja(y,y),B=ja(w,m),O=ja(w,y),H=I*L-P*P,q=(L*B-P*O)/H,ne=(I*O-P*B)/H,oe=s.z*(1-q-ne)+c.z*q+h.z*ne;if(isFinite(oe))return oe}return 1/0}{let n=1/0;for(const s of e)n=Math.min(n,s.z);return n}}const sf=Mi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:of}=sf,af=Mi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:lf}=af,cf=hs.VectorTileFeature.types,uf=Math.cos(Math.PI/180*37.5),dh=Math.pow(2,14)/.5;class Qc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new te,this.layoutVertexArray2=new ue,this.indexArray=new Ie,this.programConfigurations=new Mr(e.layers,e.zoom),this.segments=new Fe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s){this.hasPattern=Hc("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),h=!c.isConstant(),p=[];for(const{feature:m,id:y,index:w,sourceLayerIndex:I}of e){const P=this.layers[0]._featureFilter.needGeometry,L=Ns(m,P);if(!this.layers[0]._featureFilter.filter(new Jt(this.zoom),L,s))continue;const B=h?c.evaluate(L,{},s):void 0,O={id:y,properties:m.properties,type:m.type,sourceLayerIndex:I,index:w,geometry:P?L.geometry:Cr(m),patterns:{},sortKey:B};p.push(O)}h&&p.sort((m,y)=>m.sortKey-y.sortKey);for(const m of p){const{geometry:y,index:w,sourceLayerIndex:I}=m;if(this.hasPattern){const P=Xc("line",this.layers,m,this.zoom,n);this.patternFeatures.push(P)}else this.addFeature(m,y,w,s,{});n.featureIndex.insert(e[w].feature,y,w,I,this.index)}}update(e,n,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s)}addFeatures(e,n,s){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,lf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,of),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,c,h){const p=this.layers[0].layout,m=p.get("line-join").evaluate(e,{}),y=p.get("line-cap"),w=p.get("line-miter-limit"),I=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of n)this.addLine(P,e,m,y,w,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,c)}addLine(e,n,s,c,h,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<e.length-1;ne++)this.totalDistance+=e[ne].dist(e[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=cf[n.type]==="Polygon";let y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let w=0;for(;w<y-1&&e[w].equals(e[w+1]);)w++;if(y<(m?3:2))return;s==="bevel"&&(h=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let L,B,O,H,q;this.e1=this.e2=-1,m&&(L=e[y-2],q=e[w].sub(L)._unit()._perp());for(let ne=w;ne<y;ne++){if(O=ne===y-1?m?e[w+1]:void 0:e[ne+1],O&&e[ne].equals(O))continue;q&&(H=q),L&&(B=L),L=e[ne],q=O?O.sub(L)._unit()._perp():H,H=H||q;let oe=H.add(q);oe.x===0&&oe.y===0||oe._unit();const ee=H.x*q.x+H.y*q.y,le=oe.x*q.x+oe.y*q.y,pe=le!==0?1/le:1/0,ve=2*Math.sqrt(2-2*le),Ye=le<uf&&B&&O,Je=H.x*q.y-H.y*q.x>0;if(Ye&&ne>w){const Le=L.dist(B);if(Le>2*I){const Ge=L.sub(L.sub(B)._mult(I/Le)._round());this.updateDistance(B,Ge),this.addCurrentVertex(Ge,H,0,0,P),B=Ge}}const $e=B&&O;let Ue=$e?s:m?"butt":c;if($e&&Ue==="round"&&(pe<p?Ue="miter":pe<=2&&(Ue="fakeround")),Ue==="miter"&&pe>h&&(Ue="bevel"),Ue==="bevel"&&(pe>2&&(Ue="flipbevel"),pe<h&&(Ue="miter")),B&&this.updateDistance(B,L),Ue==="miter")oe._mult(pe),this.addCurrentVertex(L,oe,0,0,P);else if(Ue==="flipbevel"){if(pe>100)oe=q.mult(-1);else{const Le=pe*H.add(q).mag()/H.sub(q).mag();oe._perp()._mult(Le*(Je?-1:1))}this.addCurrentVertex(L,oe,0,0,P),this.addCurrentVertex(L,oe.mult(-1),0,0,P)}else if(Ue==="bevel"||Ue==="fakeround"){const Le=-Math.sqrt(pe*pe-1),Ge=Je?Le:0,Ve=Je?0:Le;if(B&&this.addCurrentVertex(L,H,Ge,Ve,P),Ue==="fakeround"){const Ce=Math.round(180*ve/Math.PI/20);for(let lt=1;lt<Ce;lt++){let tt=lt/Ce;if(tt!==.5){const Xt=tt-.5;tt+=tt*Xt*(tt-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*Xt*Xt+(.848013+ee*(.215638*ee-1.06021)))}const bt=q.sub(H)._mult(tt)._add(H)._unit()._mult(Je?-1:1);this.addHalfVertex(L,bt.x,bt.y,!1,Je,0,P)}}O&&this.addCurrentVertex(L,q,-Ge,-Ve,P)}else if(Ue==="butt")this.addCurrentVertex(L,oe,0,0,P);else if(Ue==="square"){const Le=B?1:-1;this.addCurrentVertex(L,oe,Le,Le,P)}else Ue==="round"&&(B&&(this.addCurrentVertex(L,H,0,0,P),this.addCurrentVertex(L,H,1,1,P,!0)),O&&(this.addCurrentVertex(L,q,-1,-1,P,!0),this.addCurrentVertex(L,q,0,0,P)));if(Ye&&ne<y-1){const Le=L.dist(O);if(Le>2*I){const Ge=L.add(O.sub(L)._mult(I/Le)._round());this.updateDistance(L,Ge),this.addCurrentVertex(Ge,q,0,0,P),L=Ge}}}}addCurrentVertex(e,n,s,c,h,p=!1){const m=n.y*c-n.x,y=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*s,n.y-n.x*s,p,!1,s,h),this.addHalfVertex(e,m,y,p,!0,-c,h),this.distance>dh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,s,c,h,p))}addHalfVertex({x:e,y:n},s,c,h,p,m,y){const w=.5*(this.lineClips?this.scaledDistance*(dh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(n<<1)+(p?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(m===0?0:m<0?-1:1)|(63&w)<<2,w>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),y.primitiveLength++),p?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}let fh,mh;Ke("LineBucket",Qc,{omit:["layers","patternFeatures"]});var gh={get paint(){return mh=mh||new En({"line-opacity":new ct(ye.paint_line["line-opacity"]),"line-color":new ct(ye.paint_line["line-color"]),"line-translate":new it(ye.paint_line["line-translate"]),"line-translate-anchor":new it(ye.paint_line["line-translate-anchor"]),"line-width":new ct(ye.paint_line["line-width"]),"line-gap-width":new ct(ye.paint_line["line-gap-width"]),"line-offset":new ct(ye.paint_line["line-offset"]),"line-blur":new ct(ye.paint_line["line-blur"]),"line-dasharray":new Ma(ye.paint_line["line-dasharray"]),"line-pattern":new Fs(ye.paint_line["line-pattern"]),"line-gradient":new Ca(ye.paint_line["line-gradient"])})},get layout(){return fh=fh||new En({"line-cap":new it(ye.layout_line["line-cap"]),"line-join":new ct(ye.layout_line["line-join"]),"line-miter-limit":new it(ye.layout_line["line-miter-limit"]),"line-round-limit":new it(ye.layout_line["line-round-limit"]),"line-sort-key":new ct(ye.layout_line["line-sort-key"])})}};class hf extends ct{possiblyEvaluate(e,n){return n=new Jt(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,s,c){return n=ze({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,s,c)}}let Hl;function _h(i,e){return e>0?e+2*i:i}const pf=Mi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),df=Mi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Mi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ff=Mi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Mi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const yh=Mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),mf=Mi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function gf(i,e,n){return i.sections.forEach(s=>{s.text=function(c,h,p){const m=h.layout.get("text-transform").evaluate(p,{});return m==="uppercase"?c=c.toLocaleUpperCase():m==="lowercase"&&(c=c.toLocaleLowerCase()),Zn.applyArabicShaping&&(c=Zn.applyArabicShaping(c)),c}(s.text,e,n)}),i}Mi([{name:"triangle",components:3,type:"Uint16"}]),Mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Mi([{type:"Float32",name:"offsetX"}]),Mi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const qa={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Hi=24,xh=$t,vh=function(i,e,n,s,c){var h,p,m=8*c-s-1,y=(1<<m)-1,w=y>>1,I=-7,P=n?c-1:0,L=n?-1:1,B=i[e+P];for(P+=L,h=B&(1<<-I)-1,B>>=-I,I+=m;I>0;h=256*h+i[e+P],P+=L,I-=8);for(p=h&(1<<-I)-1,h>>=-I,I+=s;I>0;p=256*p+i[e+P],P+=L,I-=8);if(h===0)h=1-w;else{if(h===y)return p?NaN:1/0*(B?-1:1);p+=Math.pow(2,s),h-=w}return(B?-1:1)*p*Math.pow(2,h-s)},bh=function(i,e,n,s,c,h){var p,m,y,w=8*h-c-1,I=(1<<w)-1,P=I>>1,L=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=s?0:h-1,O=s?1:-1,H=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,p=I):(p=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-p))<1&&(p--,y*=2),(e+=p+P>=1?L/y:L*Math.pow(2,1-P))*y>=2&&(p++,y/=2),p+P>=I?(m=0,p=I):p+P>=1?(m=(e*y-1)*Math.pow(2,c),p+=P):(m=e*Math.pow(2,P-1)*Math.pow(2,c),p=0));c>=8;i[n+B]=255&m,B+=O,m/=256,c-=8);for(p=p<<c|m,w+=c;w>0;i[n+B]=255&p,B+=O,p/=256,w-=8);i[n+B-O]|=128*H};function $t(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}$t.Varint=0,$t.Fixed64=1,$t.Bytes=2,$t.Fixed32=5;var eu=4294967296,wh=1/eu,Th=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Hr(i){return i.type===$t.Bytes?i.readVarint()+i.pos:i.pos+1}function Fo(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Sh(i,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var c=n.pos-1;c>=i;c--)n.buf[c+s]=n.buf[c]}function _f(i,e){for(var n=0;n<i.length;n++)e.writeVarint(i[n])}function yf(i,e){for(var n=0;n<i.length;n++)e.writeSVarint(i[n])}function xf(i,e){for(var n=0;n<i.length;n++)e.writeFloat(i[n])}function vf(i,e){for(var n=0;n<i.length;n++)e.writeDouble(i[n])}function bf(i,e){for(var n=0;n<i.length;n++)e.writeBoolean(i[n])}function wf(i,e){for(var n=0;n<i.length;n++)e.writeFixed32(i[n])}function Tf(i,e){for(var n=0;n<i.length;n++)e.writeSFixed32(i[n])}function Sf(i,e){for(var n=0;n<i.length;n++)e.writeFixed64(i[n])}function Ef(i,e){for(var n=0;n<i.length;n++)e.writeSFixed64(i[n])}function Xl(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Oo(i,e,n){i[n]=e,i[n+1]=e>>>8,i[n+2]=e>>>16,i[n+3]=e>>>24}function Eh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}$t.prototype={destroy:function(){this.buf=null},readFields:function(i,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),c=s>>3,h=this.pos;this.type=7&s,i(c,e,this),this.pos===h&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Xl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Eh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Xl(this.buf,this.pos)+Xl(this.buf,this.pos+4)*eu;return this.pos+=8,i},readSFixed64:function(){var i=Xl(this.buf,this.pos)+Eh(this.buf,this.pos+4)*eu;return this.pos+=8,i},readFloat:function(){var i=vh(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=vh(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(c,h,p){var m,y,w=p.buf;if(m=(112&(y=w[p.pos++]))>>4,y<128||(m|=(127&(y=w[p.pos++]))<<3,y<128)||(m|=(127&(y=w[p.pos++]))<<10,y<128)||(m|=(127&(y=w[p.pos++]))<<17,y<128)||(m|=(127&(y=w[p.pos++]))<<24,y<128)||(m|=(1&(y=w[p.pos++]))<<31,y<128))return Fo(c,m,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Th?function(n,s,c){return Th.decode(n.subarray(s,c))}(this.buf,e,i):function(n,s,c){for(var h="",p=s;p<c;){var m,y,w,I=n[p],P=null,L=I>239?4:I>223?3:I>191?2:1;if(p+L>c)break;L===1?I<128&&(P=I):L===2?(192&(m=n[p+1]))==128&&(P=(31&I)<<6|63&m)<=127&&(P=null):L===3?(y=n[p+2],(192&(m=n[p+1]))==128&&(192&y)==128&&((P=(15&I)<<12|(63&m)<<6|63&y)<=2047||P>=55296&&P<=57343)&&(P=null)):L===4&&(y=n[p+2],w=n[p+3],(192&(m=n[p+1]))==128&&(192&y)==128&&(192&w)==128&&((P=(15&I)<<18|(63&m)<<12|(63&y)<<6|63&w)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,L=1):P>65535&&(P-=65536,h+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),h+=String.fromCharCode(P),p+=L}return h}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==$t.Bytes)return i.push(this.readVarint(e));var n=Hr(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==$t.Bytes)return i.push(this.readSVarint());var e=Hr(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==$t.Bytes)return i.push(this.readBoolean());var e=Hr(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==$t.Bytes)return i.push(this.readFloat());var e=Hr(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==$t.Bytes)return i.push(this.readDouble());var e=Hr(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==$t.Bytes)return i.push(this.readFixed32());var e=Hr(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==$t.Bytes)return i.push(this.readSFixed32());var e=Hr(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==$t.Bytes)return i.push(this.readFixed64());var e=Hr(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==$t.Bytes)return i.push(this.readSFixed64());var e=Hr(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===$t.Varint)for(;this.buf[this.pos++]>127;);else if(e===$t.Bytes)this.pos=this.readVarint()+this.pos;else if(e===$t.Fixed32)this.pos+=4;else{if(e!==$t.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Oo(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Oo(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Oo(this.buf,-1&i,this.pos),Oo(this.buf,Math.floor(i*wh),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Oo(this.buf,-1&i,this.pos),Oo(this.buf,Math.floor(i*wh),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,n){var s,c;if(e>=0?(s=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(h,p,m){m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,m.buf[m.pos]=127&(h>>>=7)}(s,0,n),function(h,p){var m=(7&h)<<4;p.buf[p.pos++]|=m|((h>>>=3)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h)))))}(c,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,c,h){for(var p,m,y=0;y<c.length;y++){if((p=c.charCodeAt(y))>55295&&p<57344){if(!m){p>56319||y+1===c.length?(s[h++]=239,s[h++]=191,s[h++]=189):m=p;continue}if(p<56320){s[h++]=239,s[h++]=191,s[h++]=189,m=p;continue}p=m-55296<<10|p-56320|65536,m=null}else m&&(s[h++]=239,s[h++]=191,s[h++]=189,m=null);p<128?s[h++]=p:(p<2048?s[h++]=p>>6|192:(p<65536?s[h++]=p>>12|224:(s[h++]=p>>18|240,s[h++]=p>>12&63|128),s[h++]=p>>6&63|128),s[h++]=63&p|128)}return h}(this.buf,i,this.pos);var n=this.pos-e;n>=128&&Sh(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),bh(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),bh(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,e){this.pos++;var n=this.pos;i(e,this);var s=this.pos-n;s>=128&&Sh(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,n){this.writeTag(i,$t.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,_f,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,yf,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,bf,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,xf,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,vf,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,wf,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Tf,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Sf,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Ef,e)},writeBytesField:function(i,e){this.writeTag(i,$t.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,$t.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,$t.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,$t.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,$t.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,$t.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,$t.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,$t.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,$t.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,$t.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var ps,tu=U(xh);function If(i,e,n){i===1&&n.readMessage(Af,e)}function Af(i,e,n){if(i===3){const{id:s,bitmap:c,width:h,height:p,left:m,top:y,advance:w}=n.readMessage(Mf,{});e.push({id:s,bitmap:new Fa({width:h+6,height:p+6},c),metrics:{width:h,height:p,left:m,top:y,advance:w}})}}function Mf(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}function Ih(i){let e=0,n=0;for(const p of i)e+=p.w*p.h,n=Math.max(n,p.w);i.sort((p,m)=>m.h-p.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let c=0,h=0;for(const p of i)for(let m=s.length-1;m>=0;m--){const y=s[m];if(!(p.w>y.w||p.h>y.h)){if(p.x=y.x,p.y=y.y,h=Math.max(h,p.y+p.h),c=Math.max(c,p.x+p.w),p.w===y.w&&p.h===y.h){const w=s.pop();m<s.length&&(s[m]=w)}else p.h===y.h?(y.x+=p.w,y.w-=p.w):p.w===y.w?(y.y+=p.h,y.h-=p.h):(s.push({x:y.x+p.w,y:y.y,w:y.w-p.w,h:p.h}),y.y+=p.h,y.h-=p.h);break}}return{w:c,h,fill:e/(c*h)||0}}class iu{constructor(e,{pixelRatio:n,version:s,stretchX:c,stretchY:h,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=h,this.content=p,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Ah{constructor(e,n){const s={},c={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,s,h),this.addImages(n,c,h);const{w:p,h:m}=Ih(h),y=new or({width:p||1,height:m||1});for(const w in e){const I=e[w],P=s[w].paddedRect;or.copy(I.data,y,{x:0,y:0},{x:P.x+1,y:P.y+1},I.data)}for(const w in n){const I=n[w],P=c[w].paddedRect,L=P.x+1,B=P.y+1,O=I.data.width,H=I.data.height;or.copy(I.data,y,{x:0,y:0},{x:L,y:B},I.data),or.copy(I.data,y,{x:0,y:H-1},{x:L,y:B-1},{width:O,height:1}),or.copy(I.data,y,{x:0,y:0},{x:L,y:B+H},{width:O,height:1}),or.copy(I.data,y,{x:O-1,y:0},{x:L-1,y:B},{width:1,height:H}),or.copy(I.data,y,{x:0,y:0},{x:L+O,y:B},{width:1,height:H})}this.image=y,this.iconPositions=s,this.patternPositions=c}addImages(e,n,s){for(const c in e){const h=e[c],p={x:0,y:0,w:h.data.width+2,h:h.data.height+2};s.push(p),n[c]=new iu(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;const[c,h]=e.tl;s.update(n.data,void 0,{x:c,y:h})}}Ke("ImagePosition",iu),Ke("ImageAtlas",Ah),o.WritingMode=void 0,(ps=o.WritingMode||(o.WritingMode={}))[ps.none=0]="none",ps[ps.horizontal=1]="horizontal",ps[ps.vertical=2]="vertical",ps[ps.horizontalOnly=3]="horizontalOnly";const Yl=-17;class Ga{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const s=new Ga;return s.scale=e||1,s.fontStack=n,s}static forImage(e){const n=new Ga;return n.imageName=e,n}}class Uo{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const s=new Uo;for(let c=0;c<e.sections.length;c++){const h=e.sections[c];h.image?s.addImageSection(h):s.addTextSection(h,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let n="";for(let s=0;s<e.length;s++){const c=e.charCodeAt(s+1)||null,h=e.charCodeAt(s-1)||null;n+=c&&zl(c)&&!qa[e[s+1]]||h&&zl(h)&&!qa[e[s-1]]||!qa[e[s]]?e[s]:qa[e[s]]}return n}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&Jl[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Jl[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const s=new Uo;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Ga.forText(e.scale,e.fontStack||n));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Wt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Ga.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Wt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Kl(i,e,n,s,c,h,p,m,y,w,I,P,L,B,O,H){const q=Uo.fromFeature(i,c);let ne;P===o.WritingMode.vertical&&q.verticalizePunctuation();const{processBidirectionalText:oe,processStyledBidirectionalText:ee}=Zn;if(oe&&q.sections.length===1){ne=[];const ve=oe(q.toString(),nu(q,w,h,e,s,B,O));for(const Ye of ve){const Je=new Uo;Je.text=Ye,Je.sections=q.sections;for(let $e=0;$e<Ye.length;$e++)Je.sectionIndex.push(0);ne.push(Je)}}else if(ee){ne=[];const ve=ee(q.text,q.sectionIndex,nu(q,w,h,e,s,B,O));for(const Ye of ve){const Je=new Uo;Je.text=Ye[0],Je.sectionIndex=Ye[1],Je.sections=q.sections,ne.push(Je)}}else ne=function(ve,Ye){const Je=[],$e=ve.text;let Ue=0;for(const Le of Ye)Je.push(ve.substring(Ue,Le)),Ue=Le;return Ue<$e.length&&Je.push(ve.substring(Ue,$e.length)),Je}(q,nu(q,w,h,e,s,B,O));const le=[],pe={positionedLines:le,text:q.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(ve,Ye,Je,$e,Ue,Le,Ge,Ve,Ce,lt,tt,bt){let Xt=0,ei=Yl,Di=0,lr=0;const nn=Ve==="right"?1:Ve==="left"?0:.5;let Ci=0;for(const Pi of Ue){Pi.trim();const sn=Pi.getMaxScale(),dn=(sn-1)*Hi,An={positionedGlyphs:[],lineOffset:0};ve.positionedLines[Ci]=An;const On=An.positionedGlyphs;let Un=0;if(!Pi.length()){ei+=Le,++Ci;continue}for(let on=0;on<Pi.length();on++){const wt=Pi.getSection(on),Wn=Pi.getSectionIndex(on),an=Pi.getCharCode(on);let fn=0,br=null,Pr=null,kr=null,Yr=Hi;const wr=!(Ce===o.WritingMode.horizontal||!tt&&!go(an)||tt&&(Jl[an]||(Ni=an,Ne.Arabic(Ni)||Ne["Arabic Supplement"](Ni)||Ne["Arabic Extended-A"](Ni)||Ne["Arabic Presentation Forms-A"](Ni)||Ne["Arabic Presentation Forms-B"](Ni))));if(wt.imageName){const cr=$e[wt.imageName];if(!cr)continue;kr=wt.imageName,ve.iconsInText=ve.iconsInText||!0,Pr=cr.paddedRect;const Vn=cr.displaySize;wt.scale=wt.scale*Hi/bt,br={width:Vn[0],height:Vn[1],left:1,top:-3,advance:wr?Vn[1]:Vn[0]},fn=dn+(Hi-Vn[1]*wt.scale),Yr=br.advance;const Kr=wr?Vn[0]*wt.scale-Hi*sn:Vn[1]*wt.scale-Hi*sn;Kr>0&&Kr>Un&&(Un=Kr)}else{const cr=Je[wt.fontStack],Vn=cr&&cr[an];if(Vn&&Vn.rect)Pr=Vn.rect,br=Vn.metrics;else{const Kr=Ye[wt.fontStack],Xa=Kr&&Kr[an];if(!Xa)continue;br=Xa.metrics}fn=(sn-wt.scale)*Hi}wr?(ve.verticalizable=!0,On.push({glyph:an,imageName:kr,x:Xt,y:ei+fn,vertical:wr,scale:wt.scale,fontStack:wt.fontStack,sectionIndex:Wn,metrics:br,rect:Pr}),Xt+=Yr*wt.scale+lt):(On.push({glyph:an,imageName:kr,x:Xt,y:ei+fn,vertical:wr,scale:wt.scale,fontStack:wt.fontStack,sectionIndex:Wn,metrics:br,rect:Pr}),Xt+=br.advance*wt.scale+lt)}On.length!==0&&(Di=Math.max(Xt-lt,Di),kf(On,0,On.length-1,nn,Un)),Xt=0;const ui=Le*sn+Un;An.lineOffset=Math.max(Un,dn),ei+=ui,lr=Math.max(ui,lr),++Ci}var Ni;const rn=ei-Yl,{horizontalAlign:pn,verticalAlign:Fn}=ru(Ge);(function(Pi,sn,dn,An,On,Un,ui,on,wt){const Wn=(sn-dn)*On;let an=0;an=Un!==ui?-on*An-Yl:(-An*wt+.5)*ui;for(const fn of Pi)for(const br of fn.positionedGlyphs)br.x+=Wn,br.y+=an})(ve.positionedLines,nn,pn,Fn,Di,lr,Le,rn,Ue.length),ve.top+=-Fn*rn,ve.bottom=ve.top+rn,ve.left+=-pn*Di,ve.right=ve.left+Di}(pe,e,n,s,ne,p,m,y,P,w,L,H),!function(ve){for(const Ye of ve)if(Ye.positionedGlyphs.length!==0)return!1;return!0}(le)&&pe}const Jl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Cf={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Mh(i,e,n,s,c,h){if(e.imageName){const p=s[e.imageName];return p?p.displaySize[0]*e.scale*Hi/h+c:0}{const p=n[e.fontStack],m=p&&p[i];return m?m.metrics.advance*e.scale+c:0}}function Ch(i,e,n,s){const c=Math.pow(i-e,2);return s?i<e?c/2:2*c:c+Math.abs(n)*n}function Pf(i,e,n){let s=0;return i===10&&(s-=1e4),n&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Ph(i,e,n,s,c,h){let p=null,m=Ch(e,n,c,h);for(const y of s){const w=Ch(e-y.x,n,c,h)+y.badness;w<=m&&(p=y,m=w)}return{index:i,x:e,priorBreak:p,badness:m}}function kh(i){return i?kh(i.priorBreak).concat(i.index):[]}function nu(i,e,n,s,c,h,p){if(h!=="point")return[];if(!i)return[];const m=[],y=function(L,B,O,H,q,ne){let oe=0;for(let ee=0;ee<L.length();ee++){const le=L.getSection(ee);oe+=Mh(L.getCharCode(ee),le,H,q,B,ne)}return oe/Math.max(1,Math.ceil(oe/O))}(i,e,n,s,c,p),w=i.text.indexOf("​")>=0;let I=0;for(let L=0;L<i.length();L++){const B=i.getSection(L),O=i.getCharCode(L);if(Jl[O]||(I+=Mh(O,B,s,c,e,p)),L<i.length()-1){const H=!((P=O)<11904||!(Ne["Bopomofo Extended"](P)||Ne.Bopomofo(P)||Ne["CJK Compatibility Forms"](P)||Ne["CJK Compatibility Ideographs"](P)||Ne["CJK Compatibility"](P)||Ne["CJK Radicals Supplement"](P)||Ne["CJK Strokes"](P)||Ne["CJK Symbols and Punctuation"](P)||Ne["CJK Unified Ideographs Extension A"](P)||Ne["CJK Unified Ideographs"](P)||Ne["Enclosed CJK Letters and Months"](P)||Ne["Halfwidth and Fullwidth Forms"](P)||Ne.Hiragana(P)||Ne["Ideographic Description Characters"](P)||Ne["Kangxi Radicals"](P)||Ne["Katakana Phonetic Extensions"](P)||Ne.Katakana(P)||Ne["Vertical Forms"](P)||Ne["Yi Radicals"](P)||Ne["Yi Syllables"](P)));(Cf[O]||H||B.imageName)&&m.push(Ph(L+1,I,y,m,Pf(O,i.getCharCode(L+1),H&&w),!1))}}var P;return kh(Ph(i.length(),I,y,m,0,!0))}function ru(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function kf(i,e,n,s,c){if(!s&&!c)return;const h=i[n],p=(i[n].x+h.metrics.advance*h.scale)*s;for(let m=e;m<=n;m++)i[m].x-=p,i[m].y+=c}function zf(i,e,n){const{horizontalAlign:s,verticalAlign:c}=ru(n),h=e[0]-i.displaySize[0]*s,p=e[1]-i.displaySize[1]*c;return{image:i,top:p,bottom:p+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function zh(i,e,n,s,c,h){const p=i.image;let m;if(p.content){const q=p.content,ne=p.pixelRatio||1;m=[q[0]/ne,q[1]/ne,p.displaySize[0]-q[2]/ne,p.displaySize[1]-q[3]/ne]}const y=e.left*h,w=e.right*h;let I,P,L,B;n==="width"||n==="both"?(B=c[0]+y-s[3],P=c[0]+w+s[1]):(B=c[0]+(y+w-p.displaySize[0])/2,P=B+p.displaySize[0]);const O=e.top*h,H=e.bottom*h;return n==="height"||n==="both"?(I=c[1]+O-s[0],L=c[1]+H+s[2]):(I=c[1]+(O+H-p.displaySize[1])/2,L=I+p.displaySize[1]),{image:p,top:I,right:P,bottom:L,left:B,collisionPadding:m}}const Xr=128,ds=32640;function Dh(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Jt(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:c}=n;let h=0;for(;h<s.length&&s[h]<=i;)h++;h=Math.max(0,h-1);let p=h;for(;p<s.length&&s[p]<i+1;)p++;p=Math.min(s.length-1,p);const m=s[h],y=s[p];return n.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:y,interpolationType:c}:{kind:"camera",minZoom:m,maxZoom:y,minSize:n.evaluate(new Jt(m)),maxSize:n.evaluate(new Jt(y)),interpolationType:c}}}function su(i,e,n){let s="never";const c=i.get(e);return c?s=c:i.get(n)&&(s="always"),s}const Df=hs.VectorTileFeature.types,Lf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ql(i,e,n,s,c,h,p,m,y,w,I,P,L){const B=m?Math.min(ds,Math.round(m[0])):0,O=m?Math.min(ds,Math.round(m[1])):0;i.emplaceBack(e,n,Math.round(32*s),Math.round(32*c),h,p,(B<<1)+(y?1:0),O,16*w,16*I,256*P,256*L)}function ou(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function Rf(i){for(const e of i.sections)if(Dl(e.text))return!0;return!1}class au{constructor(e){this.layoutVertexArray=new ce,this.indexArray=new Ie,this.programConfigurations=e,this.segments=new Fe,this.dynamicLayoutVertexArray=new ge,this.opacityVertexArray=new Te,this.hasVisibleVertices=!1,this.placedSymbolArray=new g}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,df.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Lf,!0),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ke("SymbolBuffers",au);class lu{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new Fe,this.collisionVertexArray=new ke}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ff.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ke("CollisionBuffers",lu);class Vo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Vc([]),this.placementViewportMatrix=Vc([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Dh(this.zoom,n["text-size"]),this.iconSizeData=Dh(this.zoom,n["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),h=s.get("symbol-z-order");this.canOverlap=su(s,"text-overlap","text-allow-overlap")!=="never"||su(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(p=>o.WritingMode[p])),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID}createArrays(){this.text=new au(new Mr(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new au(new Mr(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new T,this.lineVertexArray=new M,this.symbolInstances=new v}calculateGlyphDependencies(e,n,s,c,h){for(let p=0;p<e.length;p++)if(n[e.charCodeAt(p)]=!0,(s||c)&&h){const m=qa[e.charAt(p)];m&&(n[m.charCodeAt(0)]=!0)}}populate(e,n,s){const c=this.layers[0],h=c.layout,p=h.get("text-font"),m=h.get("text-field"),y=h.get("icon-image"),w=(m.value.kind!=="constant"||m.value.value instanceof Dn&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),I=y.value.kind!=="constant"||!!y.value.value||Object.keys(y.parameters).length>0,P=h.get("symbol-sort-key");if(this.features=[],!w&&!I)return;const L=n.iconDependencies,B=n.glyphDependencies,O=n.availableImages,H=new Jt(this.zoom);for(const{feature:q,id:ne,index:oe,sourceLayerIndex:ee}of e){const le=c._featureFilter.needGeometry,pe=Ns(q,le);if(!c._featureFilter.filter(H,pe,s))continue;let ve,Ye;if(le||(pe.geometry=Cr(q)),w){const $e=c.getValueAndResolveTokens("text-field",pe,s,O),Ue=Dn.factory($e);Rf(Ue)&&(this.hasRTLText=!0),(!this.hasRTLText||Ea()==="unavailable"||this.hasRTLText&&Zn.isParsed())&&(ve=gf(Ue,c,pe))}if(I){const $e=c.getValueAndResolveTokens("icon-image",pe,s,O);Ye=$e instanceof en?$e:en.fromString($e)}if(!ve&&!Ye)continue;const Je=this.sortFeaturesByKey?P.evaluate(pe,{},s):void 0;if(this.features.push({id:ne,text:ve,icon:Ye,index:oe,sourceLayerIndex:ee,geometry:pe.geometry,properties:q.properties,type:Df[q.type],sortKey:Je}),Ye&&(L[Ye.name]=!0),ve){const $e=p.evaluate(pe,{},s).join(","),Ue=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.WritingMode.vertical)>=0;for(const Le of ve.sections)if(Le.image)L[Le.image.name]=!0;else{const Ge=mo(ve.toString()),Ve=Le.fontStack||$e,Ce=B[Ve]=B[Ve]||{};this.calculateGlyphDependencies(Le.text,Ce,Ue,this.allowVerticalPlacement,Ge)}}}h.get("symbol-placement")==="line"&&(this.features=function(q){const ne={},oe={},ee=[];let le=0;function pe($e){ee.push(q[$e]),le++}function ve($e,Ue,Le){const Ge=oe[$e];return delete oe[$e],oe[Ue]=Ge,ee[Ge].geometry[0].pop(),ee[Ge].geometry[0]=ee[Ge].geometry[0].concat(Le[0]),Ge}function Ye($e,Ue,Le){const Ge=ne[Ue];return delete ne[Ue],ne[$e]=Ge,ee[Ge].geometry[0].shift(),ee[Ge].geometry[0]=Le[0].concat(ee[Ge].geometry[0]),Ge}function Je($e,Ue,Le){const Ge=Le?Ue[0][Ue[0].length-1]:Ue[0][0];return`${$e}:${Ge.x}:${Ge.y}`}for(let $e=0;$e<q.length;$e++){const Ue=q[$e],Le=Ue.geometry,Ge=Ue.text?Ue.text.toString():null;if(!Ge){pe($e);continue}const Ve=Je(Ge,Le),Ce=Je(Ge,Le,!0);if(Ve in oe&&Ce in ne&&oe[Ve]!==ne[Ce]){const lt=Ye(Ve,Ce,Le),tt=ve(Ve,Ce,ee[lt].geometry);delete ne[Ve],delete oe[Ce],oe[Je(Ge,ee[tt].geometry,!0)]=tt,ee[lt].geometry=null}else Ve in oe?ve(Ve,Ce,Le):Ce in ne?Ye(Ve,Ce,Le):(pe($e),ne[Ve]=le-1,oe[Ce]=le-1)}return ee.filter($e=>$e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((q,ne)=>q.sortKey-ne.sortKey)}update(e,n,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const s=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(n[e.segment+1]),h=e.dist(n[e.segment]);const p={};for(let m=e.segment+1;m<n.length;m++)p[m]={x:n[m].x,y:n[m].y,tileUnitDistanceFromAnchor:c},m<n.length-1&&(c+=n[m+1].dist(n[m]));for(let m=e.segment||0;m>=0;m--)p[m]={x:n[m].x,y:n[m].y,tileUnitDistanceFromAnchor:h},m>0&&(h+=n[m-1].dist(n[m]));for(let m=0;m<n.length;m++){const y=p[m];this.lineVertexArray.emplaceBack(y.x,y.y,y.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,c,h,p,m,y,w,I,P,L){const B=e.indexArray,O=e.layoutVertexArray,H=e.segments.prepareSegment(4*n.length,O,B,this.canOverlap?p.sortKey:void 0),q=this.glyphOffsetArray.length,ne=H.vertexLength,oe=this.allowVerticalPlacement&&m===o.WritingMode.vertical?Math.PI/2:0,ee=p.text&&p.text.sections;for(let le=0;le<n.length;le++){const{tl:pe,tr:ve,bl:Ye,br:Je,tex:$e,pixelOffsetTL:Ue,pixelOffsetBR:Le,minFontScaleX:Ge,minFontScaleY:Ve,glyphOffset:Ce,isSDF:lt,sectionIndex:tt}=n[le],bt=H.vertexLength,Xt=Ce[1];Ql(O,y.x,y.y,pe.x,Xt+pe.y,$e.x,$e.y,s,lt,Ue.x,Ue.y,Ge,Ve),Ql(O,y.x,y.y,ve.x,Xt+ve.y,$e.x+$e.w,$e.y,s,lt,Le.x,Ue.y,Ge,Ve),Ql(O,y.x,y.y,Ye.x,Xt+Ye.y,$e.x,$e.y+$e.h,s,lt,Ue.x,Le.y,Ge,Ve),Ql(O,y.x,y.y,Je.x,Xt+Je.y,$e.x+$e.w,$e.y+$e.h,s,lt,Le.x,Le.y,Ge,Ve),ou(e.dynamicLayoutVertexArray,y,oe),B.emplaceBack(bt,bt+1,bt+2),B.emplaceBack(bt+1,bt+2,bt+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ce[0]),le!==n.length-1&&tt===n[le+1].sectionIndex||e.programConfigurations.populatePaintArrays(O.length,p,p.index,{},L,ee&&ee[tt])}e.placedSymbolArray.emplaceBack(y.x,y.y,q,this.glyphOffsetArray.length-q,ne,w,I,y.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],m,0,!1,0,P)}_addCollisionDebugVertex(e,n,s,c,h,p){return n.emplaceBack(0,0),e.emplaceBack(s.x,s.y,c,h,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,n,s,c,h,p,m){const y=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),w=y.vertexLength,I=h.layoutVertexArray,P=h.collisionVertexArray,L=m.anchorX,B=m.anchorY;this._addCollisionDebugVertex(I,P,p,L,B,new W(e,n)),this._addCollisionDebugVertex(I,P,p,L,B,new W(s,n)),this._addCollisionDebugVertex(I,P,p,L,B,new W(s,c)),this._addCollisionDebugVertex(I,P,p,L,B,new W(e,c)),y.vertexLength+=4;const O=h.indexArray;O.emplaceBack(w,w+1),O.emplaceBack(w+1,w+2),O.emplaceBack(w+2,w+3),O.emplaceBack(w+3,w),y.primitiveLength+=4}addDebugCollisionBoxes(e,n,s,c){for(let h=e;h<n;h++){const p=this.collisionBoxArray.get(h);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,c?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new lu(Me,yh.members,Ze),this.iconCollisionBox=new lu(Me,yh.members,Ze);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,s,c,h,p,m,y,w){const I={};for(let P=n;P<s;P++){const L=e.get(P);I.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.textFeatureIndex=L.featureIndex;break}for(let P=c;P<h;P++){const L=e.get(P);I.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalTextFeatureIndex=L.featureIndex;break}for(let P=p;P<m;P++){const L=e.get(P);I.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.iconFeatureIndex=L.featureIndex;break}for(let P=y;P<w;P++){const L=e.get(P);I.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalIconFeatureIndex=L.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const s=e.placedSymbolArray.get(n),c=s.vertexStartIndex+4*s.numGlyphs;for(let h=s.vertexStartIndex;h<c;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),s=Math.cos(e),c=[],h=[],p=[];for(let m=0;m<this.symbolInstances.length;++m){p.push(m);const y=this.symbolInstances.get(m);c.push(0|Math.round(n*y.anchorX+s*y.anchorY)),h.push(y.featureIndex)}return p.sort((m,y)=>c[m]-c[y]||h[y]-h[m]),p}addToSortKeyRanges(e,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((c,h,p)=>{c>=0&&p.indexOf(c)===h&&this.addIndicesForPlacedSymbol(this.text,c)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Lh,Rh;Ke("SymbolBucket",Vo,{omit:["layers","collisionBoxArray","features","compareText"]}),Vo.MAX_GLYPHS=65535,Vo.addDynamicAttributes=ou;var cu={get paint(){return Rh=Rh||new En({"icon-opacity":new ct(ye.paint_symbol["icon-opacity"]),"icon-color":new ct(ye.paint_symbol["icon-color"]),"icon-halo-color":new ct(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new ct(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ct(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new it(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new it(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new ct(ye.paint_symbol["text-opacity"]),"text-color":new ct(ye.paint_symbol["text-color"],{runtimeType:jt,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ct(ye.paint_symbol["text-halo-color"]),"text-halo-width":new ct(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new ct(ye.paint_symbol["text-halo-blur"]),"text-translate":new it(ye.paint_symbol["text-translate"]),"text-translate-anchor":new it(ye.paint_symbol["text-translate-anchor"])})},get layout(){return Lh=Lh||new En({"symbol-placement":new it(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new it(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new it(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ct(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new it(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new it(ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new it(ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new it(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new it(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new it(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new ct(ye.layout_symbol["icon-size"]),"icon-text-fit":new it(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new it(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new ct(ye.layout_symbol["icon-image"]),"icon-rotate":new ct(ye.layout_symbol["icon-rotate"]),"icon-padding":new ct(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new it(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new ct(ye.layout_symbol["icon-offset"]),"icon-anchor":new ct(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new it(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new it(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new it(ye.layout_symbol["text-rotation-alignment"]),"text-field":new ct(ye.layout_symbol["text-field"]),"text-font":new ct(ye.layout_symbol["text-font"]),"text-size":new ct(ye.layout_symbol["text-size"]),"text-max-width":new ct(ye.layout_symbol["text-max-width"]),"text-line-height":new it(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new ct(ye.layout_symbol["text-letter-spacing"]),"text-justify":new ct(ye.layout_symbol["text-justify"]),"text-radial-offset":new ct(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new it(ye.layout_symbol["text-variable-anchor"]),"text-anchor":new ct(ye.layout_symbol["text-anchor"]),"text-max-angle":new it(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new it(ye.layout_symbol["text-writing-mode"]),"text-rotate":new ct(ye.layout_symbol["text-rotate"]),"text-padding":new it(ye.layout_symbol["text-padding"]),"text-keep-upright":new it(ye.layout_symbol["text-keep-upright"]),"text-transform":new ct(ye.layout_symbol["text-transform"]),"text-offset":new ct(ye.layout_symbol["text-offset"]),"text-allow-overlap":new it(ye.layout_symbol["text-allow-overlap"]),"text-overlap":new it(ye.layout_symbol["text-overlap"]),"text-ignore-placement":new it(ye.layout_symbol["text-ignore-placement"]),"text-optional":new it(ye.layout_symbol["text-optional"])})}};class Bh{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:zn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ke("FormatSectionOverride",Bh,{omit:["defaultValue"]});class ec extends yr{constructor(e){super(e,cu)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const h of s)c.indexOf(h)<0&&c.push(h);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,s,c){const h=this.layout.get(e).evaluate(n,{},s,c),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||oo(p.value)||!h?h:function(m,y){return y.replace(/{([^{}]+)}/g,(w,I)=>I in m?String(m[I]):"")}(n.properties,h)}createBucket(e){return new Vo(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of cu.paint.overridableProperties){if(!ec.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),s=new Bh(n),c=new da(s,n.property.specification);let h=null;h=n.value.kind==="constant"||n.value.kind==="source"?new fa("source",c):new St("composite",c,n.value.zoomStops),this.paint._values[e]=new _r(n.property,h,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&ec.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const s=e.get("text-field"),c=cu.paint.properties[n];let h=!1;const p=m=>{for(const y of m)if(c.overrides&&c.overrides.hasOverride(y))return void(h=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Dn)p(s.value.value.sections);else if(s.value.kind==="source"){const m=w=>{h||(w instanceof Vr&&ri(w.value)===Wi?p(w.value.sections):w instanceof ro?p(w.sections):w.eachChild(m))},y=s.value;y._styleExpression&&m(y._styleExpression.expression)}return h}}let Fh;var Bf={get paint(){return Fh=Fh||new En({"background-color":new it(ye.paint_background["background-color"]),"background-pattern":new Ma(ye.paint_background["background-pattern"]),"background-opacity":new it(ye.paint_background["background-opacity"])})}};let Oh;var Ff={get paint(){return Oh=Oh||new En({"raster-opacity":new it(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new it(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new it(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new it(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new it(ye.paint_raster["raster-saturation"]),"raster-contrast":new it(ye.paint_raster["raster-contrast"]),"raster-resampling":new it(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new it(ye.paint_raster["raster-fade-duration"])})}};class Of extends yr{constructor(e){super(e,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const Uf={circle:class extends yr{constructor(i){super(i,Ed)}createBucket(i){return new Fc(i)}queryRadius(i){const e=i;return Ra("circle-radius",this,e)+Ra("circle-stroke-width",this,e)+Nl(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,n,s,c,h,p,m){const y=$l(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,p),w=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n),I=this.paint.get("circle-pitch-alignment")==="map",P=I?y:function(B,O){return B.map(H=>Hu(H,O))}(y,m),L=I?w*p:w;for(const B of s)for(const O of B){const H=I?O:Hu(O,m);let q=L;const ne=jl([],[O.x,O.y,0,1],m);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?q*=ne[3]/h.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(q*=h.cameraToCenterDistance/ne[3]),bd(P,H,q))return!0}return!1}},heatmap:class extends yr{createBucket(i){return new Xu(i)}constructor(i){super(i,Ad),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ju({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends yr{constructor(i){super(i,Md)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends yr{constructor(i){super(i,jd)}recalculate(i,e){super.recalculate(i,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Yc(i)}queryRadius(){return Nl(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,n,s,c,h,p){return $u($l(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,p),s)}isTileClipped(){return!0}},"fill-extrusion":class extends yr{constructor(i){super(i,rf)}createBucket(i){return new Jc(i)}queryRadius(){return Nl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,e,n,s,c,h,p,m){const y=$l(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,p),w=this.paint.get("fill-extrusion-height").evaluate(e,n),I=this.paint.get("fill-extrusion-base").evaluate(e,n),P=function(B,O,H,q){const ne=[];for(const oe of B){const ee=[oe.x,oe.y,0,1];jl(ee,ee,O),ne.push(new W(ee[0]/ee[3],ee[1]/ee[3]))}return ne}(y,m),L=function(B,O,H,q){const ne=[],oe=[],ee=q[8]*O,le=q[9]*O,pe=q[10]*O,ve=q[11]*O,Ye=q[8]*H,Je=q[9]*H,$e=q[10]*H,Ue=q[11]*H;for(const Le of B){const Ge=[],Ve=[];for(const Ce of Le){const lt=Ce.x,tt=Ce.y,bt=q[0]*lt+q[4]*tt+q[12],Xt=q[1]*lt+q[5]*tt+q[13],ei=q[2]*lt+q[6]*tt+q[14],Di=q[3]*lt+q[7]*tt+q[15],lr=ei+pe,nn=Di+ve,Ci=bt+Ye,Ni=Xt+Je,rn=ei+$e,pn=Di+Ue,Fn=new W((bt+ee)/nn,(Xt+le)/nn);Fn.z=lr/nn,Ge.push(Fn);const Pi=new W(Ci/pn,Ni/pn);Pi.z=rn/pn,Ve.push(Pi)}ne.push(Ge),oe.push(Ve)}return[ne,oe]}(s,I,w,m);return function(B,O,H){let q=1/0;$u(H,O)&&(q=ph(H,O[0]));for(let ne=0;ne<O.length;ne++){const oe=O[ne],ee=B[ne];for(let le=0;le<oe.length-1;le++){const pe=oe[le],ve=[pe,oe[le+1],ee[le+1],ee[le],pe];Nu(H,ve)&&(q=Math.min(q,ph(H,ve)))}}return q!==1/0&&q}(L[0],L[1],P)}},line:class extends yr{constructor(i){super(i,gh),this.gradientVersion=0,Hl||(Hl=new hf(gh.paint.properties["line-width"].specification),Hl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ts,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Hl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Qc(i)}queryRadius(i){const e=i,n=_h(Ra("line-width",this,e),Ra("line-gap-width",this,e)),s=Ra("line-offset",this,e);return n/2+Math.abs(s)+Nl(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,n,s,c,h,p){const m=$l(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,p),y=p/2*_h(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),w=this.paint.get("line-offset").evaluate(e,n);return w&&(s=function(I,P){const L=[];for(let B=0;B<I.length;B++){const O=I[B],H=[];for(let q=0;q<O.length;q++){const ne=O[q-1],oe=O[q],ee=O[q+1],le=q===0?new W(0,0):oe.sub(ne)._unit()._perp(),pe=q===O.length-1?new W(0,0):ee.sub(oe)._unit()._perp(),ve=le._add(pe)._unit(),Ye=ve.x*pe.x+ve.y*pe.y;Ye!==0&&ve._mult(1/Ye),H.push(ve._mult(P)._add(oe))}L.push(H)}return L}(s,w*p)),function(I,P,L){for(let B=0;B<P.length;B++){const O=P[B];if(I.length>=3){for(let H=0;H<O.length;H++)if(Do(I,O[H]))return!0}if(wd(I,O,L))return!0}return!1}(m,s,y)}isTileClipped(){return!0}},symbol:ec,background:class extends yr{constructor(i){super(i,Bf)}},raster:class extends yr{constructor(i){super(i,Ff)}}};class Vf{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const uu=63710088e-1;class fs{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new fs(Xe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,s=this.lat*n,c=e.lat*n,h=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return uu*Math.acos(Math.min(h,1))}static convert(e){if(e instanceof fs)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new fs(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new fs(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Uh=2*Math.PI*uu;function Vh(i){return Uh*Math.cos(i*Math.PI/180)}function Nh(i){return(180+i)/360}function $h(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function jh(i,e){return i/Vh(e)}function hu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class tc{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){const s=fs.convert(e);return new tc(Nh(s.lng),$h(s.lat),jh(n,s.lat))}toLngLat(){return new fs(360*this.x-180,hu(this.y))}toAltitude(){return this.z*Vh(hu(this.y))}meterInMercatorCoordinateUnits(){return 1/Uh*(e=hu(this.y),1/Math.cos(e*Math.PI/180));var e}}function qh(i,e,n){var s=2*Math.PI*6378137/256/Math.pow(2,n);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class pu{constructor(e,n,s){if(e<0||e>25||s<0||s>=Math.pow(2,e)||n<0||n>=Math.pow(2,e))throw new Error(`x=${n}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=s,this.key=Za(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,s){const c=(p=this.y,m=this.z,y=qh(256*(h=this.x),256*(p=Math.pow(2,m)-p-1),m),w=qh(256*(h+1),256*(p+1),m),y[0]+","+y[1]+","+w[0]+","+w[1]);var h,p,m,y,w;const I=function(P,L,B){let O,H="";for(let q=P;q>0;q--)O=1<<q-1,H+=(L&O?1:0)+(B&O?2:0);return H}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new W((e.x*n-this.x)*Qt,(e.y*n-this.y)*Qt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Gh{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Za(e,n.z,n.z,n.x,n.y)}}class ar{constructor(e,n,s,c,h){if(e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=n,this.canonical=new pu(s,+c,+h),this.key=Za(n,e,s,c,h)}clone(){return new ar(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new ar(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ar(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?Za(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Za(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new ar(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new ar(n,this.wrap,n,s,c),new ar(n,this.wrap,n,s+1,c),new ar(n,this.wrap,n,s,c+1),new ar(n,this.wrap,n,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ar(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ar(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Gh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new tc(e.x-this.wrap,e.y))}}function Za(i,e,n,s,c){(i*=2)<0&&(i=-1*i-1);const h=1<<n;return(h*h*i+h*c+s).toString(36)+n.toString(36)+e.toString(36)}Ke("CanonicalTileID",pu),Ke("OverscaledTileID",ar,{omit:["posMatrix"]});class Zh{constructor(e,n,s){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void Wt(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const c=this.dim=n.height-2;this.data=new Uint32Array(n.data.buffer),this.encoding=s||"mapbox";for(let h=0;h<c;h++)this.data[this._idx(-1,h)]=this.data[this._idx(0,h)],this.data[this._idx(c,h)]=this.data[this._idx(c-1,h)],this.data[this._idx(h,-1)]=this.data[this._idx(h,0)],this.data[this._idx(h,c)]=this.data[this._idx(h,c-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(c,-1)]=this.data[this._idx(c-1,0)],this.data[this._idx(-1,c)]=this.data[this._idx(0,c-1)],this.data[this._idx(c,c)]=this.data[this._idx(c-1,c-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let h=0;h<c;h++)for(let p=0;p<c;p++){const m=this.get(h,p);m>this.max&&(this.max=m),m<this.min&&(this.min=m)}}get(e,n){const s=new Uint8Array(this.data.buffer),c=4*this._idx(e,n);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[c],s[c+1],s[c+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,s){return(256*e*256+256*n+s)/10-1e4}_unpackTerrarium(e,n,s){return 256*e+n+s/256-32768}getPixels(){return new or({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,h=n*this.dim+this.dim,p=s*this.dim,m=s*this.dim+this.dim;switch(n){case-1:c=h-1;break;case 1:h=c+1}switch(s){case-1:p=m-1;break;case 1:m=p+1}const y=-n*this.dim,w=-s*this.dim;for(let I=p;I<m;I++)for(let P=c;P<h;P++)this.data[this._idx(P,I)]=e.data[this._idx(P+y,I+w)]}}Ke("DEMData",Zh);class Wh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Hh{constructor(e,n,s,c,h){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=s,e._y=c,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}class Xh{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ds(Qt,16,0),this.grid3D=new Ds(Qt,16,0),this.featureIndexArray=new F,this.promoteId=n}insert(e,n,s,c,h,p){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,h);const y=p?this.grid3D:this.grid;for(let w=0;w<n.length;w++){const I=n[w],P=[1/0,1/0,-1/0,-1/0];for(let L=0;L<I.length;L++){const B=I[L];P[0]=Math.min(P[0],B.x),P[1]=Math.min(P[1],B.y),P[2]=Math.max(P[2],B.x),P[3]=Math.max(P[3],B.y)}P[0]<Qt&&P[1]<Qt&&P[2]>=0&&P[3]>=0&&y.insert(m,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new hs.VectorTile(new tu(this.rawTileData)).layers,this.sourceLayerCoder=new Wh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,n,s,c){this.loadVTLayers();const h=e.params||{},p=Qt/e.tileSize/e.scale,m=ma(h.filter),y=e.queryGeometry,w=e.queryPadding*p,I=Kh(y),P=this.grid.query(I.minX-w,I.minY-w,I.maxX+w,I.maxY+w),L=Kh(e.cameraQueryGeometry),B=this.grid3D.query(L.minX-w,L.minY-w,L.maxX+w,L.maxY+w,(q,ne,oe,ee)=>function(le,pe,ve,Ye,Je){for(const Ue of le)if(pe<=Ue.x&&ve<=Ue.y&&Ye>=Ue.x&&Je>=Ue.y)return!0;const $e=[new W(pe,ve),new W(pe,Je),new W(Ye,Je),new W(Ye,ve)];if(le.length>2){for(const Ue of $e)if(Do(le,Ue))return!0}for(let Ue=0;Ue<le.length-1;Ue++)if(Sd(le[Ue],le[Ue+1],$e))return!0;return!1}(e.cameraQueryGeometry,q-w,ne-w,oe+w,ee+w));for(const q of B)P.push(q);P.sort(Nf);const O={};let H;for(let q=0;q<P.length;q++){const ne=P[q];if(ne===H)continue;H=ne;const oe=this.featureIndexArray.get(ne);let ee=null;this.loadMatchingFeature(O,oe.bucketIndex,oe.sourceLayerIndex,oe.featureIndex,m,h.layers,h.availableImages,n,s,c,(le,pe,ve)=>(ee||(ee=Cr(le)),pe.queryIntersectsFeature(y,le,ve,ee,this.z,e.transform,p,e.pixelPosMatrix)))}return O}loadMatchingFeature(e,n,s,c,h,p,m,y,w,I,P){const L=this.bucketLayerIDs[n];if(p&&!function(q,ne){for(let oe=0;oe<q.length;oe++)if(ne.indexOf(q[oe])>=0)return!0;return!1}(p,L))return;const B=this.sourceLayerCoder.decode(s),O=this.vtLayers[B].feature(c);if(h.needGeometry){const q=Ns(O,!0);if(!h.filter(new Jt(this.tileID.overscaledZ),q,this.tileID.canonical))return}else if(!h.filter(new Jt(this.tileID.overscaledZ),O))return;const H=this.getId(O,B);for(let q=0;q<L.length;q++){const ne=L[q];if(p&&p.indexOf(ne)<0)continue;const oe=y[ne];if(!oe)continue;let ee={};H&&I&&(ee=I.getState(oe.sourceLayer||"_geojsonTileLayer",H));const le=ze({},w[ne]);le.paint=Yh(le.paint,oe.paint,O,ee,m),le.layout=Yh(le.layout,oe.layout,O,ee,m);const pe=!P||P(O,oe,ee);if(!pe)continue;const ve=new Hh(O,this.z,this.x,this.y,H);ve.layer=le;let Ye=e[ne];Ye===void 0&&(Ye=e[ne]=[]),Ye.push({featureIndex:c,feature:ve,intersectionZ:pe})}}lookupSymbolFeatures(e,n,s,c,h,p,m,y){const w={};this.loadVTLayers();const I=ma(h);for(const P of e)this.loadMatchingFeature(w,s,c,P,I,p,m,y,n);return w}hasLayer(e){for(const n of this.bucketLayerIDs)for(const s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof s=="boolean"&&(s=Number(s))),s}}function Yh(i,e,n,s,c){return Ee(i,(h,p)=>{const m=e instanceof wo?e.get(p):null;return m&&m.evaluate?m.evaluate(n,s,c):m})}function Kh(i){let e=1/0,n=1/0,s=-1/0,c=-1/0;for(const h of i)e=Math.min(e,h.x),n=Math.min(n,h.y),s=Math.max(s,h.x),c=Math.max(c,h.y);return{minX:e,minY:n,maxX:s,maxY:c}}function Nf(i,e){return e-i}function Jh(i,e,n,s,c){const h=[];for(let p=0;p<i.length;p++){const m=i[p];let y;for(let w=0;w<m.length-1;w++){let I=m[w],P=m[w+1];I.x<e&&P.x<e||(I.x<e?I=new W(e,I.y+(e-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x<e&&(P=new W(e,I.y+(e-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y<n&&P.y<n||(I.y<n?I=new W(I.x+(n-I.y)/(P.y-I.y)*(P.x-I.x),n)._round():P.y<n&&(P=new W(I.x+(n-I.y)/(P.y-I.y)*(P.x-I.x),n)._round()),I.x>=s&&P.x>=s||(I.x>=s?I=new W(s,I.y+(s-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x>=s&&(P=new W(s,I.y+(s-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y>=c&&P.y>=c||(I.y>=c?I=new W(I.x+(c-I.y)/(P.y-I.y)*(P.x-I.x),c)._round():P.y>=c&&(P=new W(I.x+(c-I.y)/(P.y-I.y)*(P.x-I.x),c)._round()),y&&I.equals(y[y.length-1])||(y=[I],h.push(y)),y.push(P)))))}}return h}Ke("FeatureIndex",Xh,{omit:["rawTileData","sourceLayerCoder"]});class ms extends W{constructor(e,n,s,c){super(e,n),this.angle=s,c!==void 0&&(this.segment=c)}clone(){return new ms(this.x,this.y,this.angle,this.segment)}}function Qh(i,e,n,s,c){if(e.segment===void 0)return!0;let h=e,p=e.segment+1,m=0;for(;m>-n/2;){if(p--,p<0)return!1;m-=i[p].dist(h),h=i[p]}m+=i[p].dist(i[p+1]),p++;const y=[];let w=0;for(;m<n/2;){const I=i[p],P=i[p+1];if(!P)return!1;let L=i[p-1].angleTo(I)-I.angleTo(P);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:m,angleDelta:L}),w+=L;m-y[0].distance>s;)w-=y.shift().angleDelta;if(w>c)return!1;p++,m+=I.dist(P)}return!0}function ep(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function tp(i,e,n){return i?.6*e*n:0}function ip(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function $f(i,e,n,s,c,h){const p=tp(n,c,h),m=ip(n,s)*h;let y=0;const w=ep(i)/2;for(let I=0;I<i.length-1;I++){const P=i[I],L=i[I+1],B=P.dist(L);if(y+B>w){const O=(w-y)/B,H=Tn.number(P.x,L.x,O),q=Tn.number(P.y,L.y,O),ne=new ms(H,q,L.angleTo(P),I);return ne._round(),!p||Qh(i,ne,m,p,e)?ne:void 0}y+=B}}function jf(i,e,n,s,c,h,p,m,y){const w=tp(s,h,p),I=ip(s,c),P=I*p,L=i[0].x===0||i[0].x===y||i[0].y===0||i[0].y===y;return e-P<e/4&&(e=P+e/4),np(i,L?e/2*m%e:(I/2+2*h)*p*m%e,e,w,n,P,L,!1,y)}function np(i,e,n,s,c,h,p,m,y){const w=h/2,I=ep(i);let P=0,L=e-n,B=[];for(let O=0;O<i.length-1;O++){const H=i[O],q=i[O+1],ne=H.dist(q),oe=q.angleTo(H);for(;L+n<P+ne;){L+=n;const ee=(L-P)/ne,le=Tn.number(H.x,q.x,ee),pe=Tn.number(H.y,q.y,ee);if(le>=0&&le<y&&pe>=0&&pe<y&&L-w>=0&&L+w<=I){const ve=new ms(le,pe,oe,O);ve._round(),s&&!Qh(i,ve,h,s,c)||B.push(ve)}}P+=ne}return m||B.length||p||(B=np(i,P/2,n,s,c,h,p,!0,y)),B}function rp(i,e,n,s){const c=[],h=i.image,p=h.pixelRatio,m=h.paddedRect.w-2,y=h.paddedRect.h-2,w=i.right-i.left,I=i.bottom-i.top,P=h.stretchX||[[0,m]],L=h.stretchY||[[0,y]],B=(Le,Ge)=>Le+Ge[1]-Ge[0],O=P.reduce(B,0),H=L.reduce(B,0),q=m-O,ne=y-H;let oe=0,ee=O,le=0,pe=H,ve=0,Ye=q,Je=0,$e=ne;if(h.content&&s){const Le=h.content;oe=ic(P,0,Le[0]),le=ic(L,0,Le[1]),ee=ic(P,Le[0],Le[2]),pe=ic(L,Le[1],Le[3]),ve=Le[0]-oe,Je=Le[1]-le,Ye=Le[2]-Le[0]-ee,$e=Le[3]-Le[1]-pe}const Ue=(Le,Ge,Ve,Ce)=>{const lt=nc(Le.stretch-oe,ee,w,i.left),tt=rc(Le.fixed-ve,Ye,Le.stretch,O),bt=nc(Ge.stretch-le,pe,I,i.top),Xt=rc(Ge.fixed-Je,$e,Ge.stretch,H),ei=nc(Ve.stretch-oe,ee,w,i.left),Di=rc(Ve.fixed-ve,Ye,Ve.stretch,O),lr=nc(Ce.stretch-le,pe,I,i.top),nn=rc(Ce.fixed-Je,$e,Ce.stretch,H),Ci=new W(lt,bt),Ni=new W(ei,bt),rn=new W(ei,lr),pn=new W(lt,lr),Fn=new W(tt/p,Xt/p),Pi=new W(Di/p,nn/p),sn=e*Math.PI/180;if(sn){const On=Math.sin(sn),Un=Math.cos(sn),ui=[Un,-On,On,Un];Ci._matMult(ui),Ni._matMult(ui),pn._matMult(ui),rn._matMult(ui)}const dn=Le.stretch+Le.fixed,An=Ge.stretch+Ge.fixed;return{tl:Ci,tr:Ni,bl:pn,br:rn,tex:{x:h.paddedRect.x+1+dn,y:h.paddedRect.y+1+An,w:Ve.stretch+Ve.fixed-dn,h:Ce.stretch+Ce.fixed-An},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fn,pixelOffsetBR:Pi,minFontScaleX:Ye/p/w,minFontScaleY:$e/p/I,isSDF:n}};if(s&&(h.stretchX||h.stretchY)){const Le=sp(P,q,O),Ge=sp(L,ne,H);for(let Ve=0;Ve<Le.length-1;Ve++){const Ce=Le[Ve],lt=Le[Ve+1];for(let tt=0;tt<Ge.length-1;tt++)c.push(Ue(Ce,Ge[tt],lt,Ge[tt+1]))}}else c.push(Ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:y+1}));return c}function ic(i,e,n){let s=0;for(const c of i)s+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return s}function sp(i,e,n){const s=[{fixed:-1,stretch:0}];for(const[c,h]of i){const p=s[s.length-1];s.push({fixed:c-p.stretch,stretch:p.stretch}),s.push({fixed:c-p.stretch,stretch:p.stretch+(h-c)})}return s.push({fixed:e+1,stretch:n}),s}function nc(i,e,n,s){return i/e*n+s}function rc(i,e,n,s){return i-e*n/s}Ke("Anchor",ms);class sc{constructor(e,n,s,c,h,p,m,y,w,I){if(this.boxStartIndex=e.length,w){let P=p.top,L=p.bottom;const B=p.collisionPadding;B&&(P-=B[1],L+=B[3]);let O=L-P;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{let P=p.top*m-y[0],L=p.bottom*m+y[2],B=p.left*m-y[3],O=p.right*m+y[1];const H=p.collisionPadding;if(H&&(B-=H[0]*m,P-=H[1]*m,O+=H[2]*m,L+=H[3]*m),I){const q=new W(B,P),ne=new W(O,P),oe=new W(B,L),ee=new W(O,L),le=I*Math.PI/180;q._rotate(le),ne._rotate(le),oe._rotate(le),ee._rotate(le),B=Math.min(q.x,ne.x,oe.x,ee.x),O=Math.max(q.x,ne.x,oe.x,ee.x),P=Math.min(q.y,ne.y,oe.y,ee.y),L=Math.max(q.y,ne.y,oe.y,ee.y)}e.emplaceBack(n.x,n.y,B,P,O,L,s,c,h)}this.boxEndIndex=e.length}}class qf{constructor(e=[],n=Gf){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:s}=this,c=n[e];for(;e>0;){const h=e-1>>1,p=n[h];if(s(c,p)>=0)break;n[e]=p,e=h}n[e]=c}_down(e){const{data:n,compare:s}=this,c=this.length>>1,h=n[e];for(;e<c;){let p=1+(e<<1),m=n[p];const y=p+1;if(y<this.length&&s(n[y],m)<0&&(p=y,m=n[y]),s(m,h)>=0)break;n[e]=m,e=p}n[e]=h}}function Gf(i,e){return i<e?-1:i>e?1:0}function Zf(i,e=1,n=!1){let s=1/0,c=1/0,h=-1/0,p=-1/0;const m=i[0];for(let B=0;B<m.length;B++){const O=m[B];(!B||O.x<s)&&(s=O.x),(!B||O.y<c)&&(c=O.y),(!B||O.x>h)&&(h=O.x),(!B||O.y>p)&&(p=O.y)}const y=Math.min(h-s,p-c);let w=y/2;const I=new qf([],Wf);if(y===0)return new W(s,c);for(let B=s;B<h;B+=y)for(let O=c;O<p;O+=y)I.push(new No(B+w,O+w,w,i));let P=function(B){let O=0,H=0,q=0;const ne=B[0];for(let oe=0,ee=ne.length,le=ee-1;oe<ee;le=oe++){const pe=ne[oe],ve=ne[le],Ye=pe.x*ve.y-ve.x*pe.y;H+=(pe.x+ve.x)*Ye,q+=(pe.y+ve.y)*Ye,O+=3*Ye}return new No(H/O,q/O,0,B)}(i),L=I.length;for(;I.length;){const B=I.pop();(B.d>P.d||!P.d)&&(P=B,n&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,L)),B.max-P.d<=e||(w=B.h/2,I.push(new No(B.p.x-w,B.p.y-w,w,i)),I.push(new No(B.p.x+w,B.p.y-w,w,i)),I.push(new No(B.p.x-w,B.p.y+w,w,i)),I.push(new No(B.p.x+w,B.p.y+w,w,i)),L+=4)}return n&&(console.log(`num probes: ${L}`),console.log(`best distance: ${P.d}`)),P.p}function Wf(i,e){return e.max-i.max}function No(i,e,n,s){this.p=new W(i,e),this.h=n,this.d=function(c,h){let p=!1,m=1/0;for(let y=0;y<h.length;y++){const w=h[y];for(let I=0,P=w.length,L=P-1;I<P;L=I++){const B=w[I],O=w[L];B.y>c.y!=O.y>c.y&&c.x<(O.x-B.x)*(c.y-B.y)/(O.y-B.y)+B.x&&(p=!p),m=Math.min(m,ju(c,B,O))}}return(p?1:-1)*Math.sqrt(m)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const du=Number.POSITIVE_INFINITY;function op(i,e){return e[1]!==du?function(n,s,c){let h=0,p=0;switch(s=Math.abs(s),c=Math.abs(c),n){case"top-right":case"top-left":case"top":p=c-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-c}switch(n){case"top-right":case"bottom-right":case"right":h=-s;break;case"top-left":case"bottom-left":case"left":h=s}return[h,p]}(i,e[0],e[1]):function(n,s){let c=0,h=0;s<0&&(s=0);const p=s/Math.sqrt(2);switch(n){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-s;break;case"top":h=s-7}switch(n){case"top-right":case"bottom-right":c=-p;break;case"top-left":case"bottom-left":c=p;break;case"left":c=s;break;case"right":c=-s}return[c,h]}(i,e[0])}function fu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Hf(i,e,n,s,c,h,p,m,y,w,I){let P=h.textMaxSize.evaluate(e,{});P===void 0&&(P=p);const L=i.layers[0].layout,B=L.get("icon-offset").evaluate(e,{},I),O=lp(n.horizontal),H=p/24,q=i.tilePixelRatio*H,ne=i.tilePixelRatio*P/24,oe=i.tilePixelRatio*m,ee=i.tilePixelRatio*L.get("symbol-spacing"),le=L.get("text-padding")*i.tilePixelRatio,pe=function(Ce,lt,tt,bt=1){const Xt=Ce.get("icon-padding").evaluate(lt,{},tt),ei=Xt&&Xt.values;return[ei[0]*bt,ei[1]*bt,ei[2]*bt,ei[3]*bt]}(L,e,I,i.tilePixelRatio),ve=L.get("text-max-angle")/180*Math.PI,Ye=L.get("text-rotation-alignment")!=="viewport"&&L.get("symbol-placement")!=="point",Je=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",$e=L.get("symbol-placement"),Ue=ee/2,Le=L.get("icon-text-fit");let Ge;s&&Le!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Ge=zh(s,n.vertical,Le,L.get("icon-text-fit-padding"),B,H)),O&&(s=zh(s,O,Le,L.get("icon-text-fit-padding"),B,H)));const Ve=(Ce,lt)=>{lt.x<0||lt.x>=Qt||lt.y<0||lt.y>=Qt||function(tt,bt,Xt,ei,Di,lr,nn,Ci,Ni,rn,pn,Fn,Pi,sn,dn,An,On,Un,ui,on,wt,Wn,an,fn,br){const Pr=tt.addToLineVertexArray(bt,Xt);let kr,Yr,wr,cr,Vn=0,Kr=0,Xa=0,pp=0,wu=-1,Tu=-1;const Jr={};let dp=bi(""),Su=0,Eu=0;if(Ci._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Su,Eu]=Ci.layout.get("text-offset").evaluate(wt,{},fn).map(Nn=>Nn*Hi):(Su=Ci.layout.get("text-radial-offset").evaluate(wt,{},fn)*Hi,Eu=du),tt.allowVerticalPlacement&&ei.vertical){const Nn=Ci.layout.get("text-rotate").evaluate(wt,{},fn)+90;wr=new sc(Ni,bt,rn,pn,Fn,ei.vertical,Pi,sn,dn,Nn),nn&&(cr=new sc(Ni,bt,rn,pn,Fn,nn,On,Un,dn,Nn))}if(Di){const Nn=Ci.layout.get("icon-rotate").evaluate(wt,{}),Or=Ci.layout.get("icon-text-fit")!=="none",Ya=rp(Di,Nn,an,Or),Ka=nn?rp(nn,Nn,an,Or):void 0;Yr=new sc(Ni,bt,rn,pn,Fn,Di,On,Un,!1,Nn),Vn=4*Ya.length;const gp=tt.iconSizeData;let js=null;gp.kind==="source"?(js=[Xr*Ci.layout.get("icon-size").evaluate(wt,{})],js[0]>ds&&Wt(`${tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):gp.kind==="composite"&&(js=[Xr*Wn.compositeIconSizes[0].evaluate(wt,{},fn),Xr*Wn.compositeIconSizes[1].evaluate(wt,{},fn)],(js[0]>ds||js[1]>ds)&&Wt(`${tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),tt.addSymbols(tt.icon,Ya,js,on,ui,wt,o.WritingMode.none,bt,Pr.lineStartIndex,Pr.lineLength,-1,fn),wu=tt.icon.placedSymbolArray.length-1,Ka&&(Kr=4*Ka.length,tt.addSymbols(tt.icon,Ka,js,on,ui,wt,o.WritingMode.vertical,bt,Pr.lineStartIndex,Pr.lineLength,-1,fn),Tu=tt.icon.placedSymbolArray.length-1)}const fp=Object.keys(ei.horizontal);for(const Nn of fp){const Or=ei.horizontal[Nn];if(!kr){dp=bi(Or.text);const Ka=Ci.layout.get("text-rotate").evaluate(wt,{},fn);kr=new sc(Ni,bt,rn,pn,Fn,Or,Pi,sn,dn,Ka)}const Ya=Or.positionedLines.length===1;if(Xa+=ap(tt,bt,Or,lr,Ci,dn,wt,An,Pr,ei.vertical?o.WritingMode.horizontal:o.WritingMode.horizontalOnly,Ya?fp:[Nn],Jr,wu,Wn,fn),Ya)break}ei.vertical&&(pp+=ap(tt,bt,ei.vertical,lr,Ci,dn,wt,An,Pr,o.WritingMode.vertical,["vertical"],Jr,Tu,Wn,fn));const Kf=kr?kr.boxStartIndex:tt.collisionBoxArray.length,Jf=kr?kr.boxEndIndex:tt.collisionBoxArray.length,Qf=wr?wr.boxStartIndex:tt.collisionBoxArray.length,em=wr?wr.boxEndIndex:tt.collisionBoxArray.length,tm=Yr?Yr.boxStartIndex:tt.collisionBoxArray.length,im=Yr?Yr.boxEndIndex:tt.collisionBoxArray.length,nm=cr?cr.boxStartIndex:tt.collisionBoxArray.length,rm=cr?cr.boxEndIndex:tt.collisionBoxArray.length;let zr=-1;const ac=(Nn,Or)=>Nn&&Nn.circleDiameter?Math.max(Nn.circleDiameter,Or):Or;zr=ac(kr,zr),zr=ac(wr,zr),zr=ac(Yr,zr),zr=ac(cr,zr);const mp=zr>-1?1:0;mp&&(zr*=br/Hi),tt.glyphOffsetArray.length>=Vo.MAX_GLYPHS&&Wt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wt.sortKey!==void 0&&tt.addToSortKeyRanges(tt.symbolInstances.length,wt.sortKey),tt.symbolInstances.emplaceBack(bt.x,bt.y,Jr.right>=0?Jr.right:-1,Jr.center>=0?Jr.center:-1,Jr.left>=0?Jr.left:-1,Jr.vertical||-1,wu,Tu,dp,Kf,Jf,Qf,em,tm,im,nm,rm,rn,Xa,pp,Vn,Kr,mp,0,Pi,Su,Eu,zr)}(i,lt,Ce,n,s,c,Ge,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,q,[le,le,le,le],Ye,y,oe,pe,Je,B,e,h,w,I,p)};if($e==="line")for(const Ce of Jh(e.geometry,0,0,Qt,Qt)){const lt=jf(Ce,ee,ve,n.vertical||O,s,24,ne,i.overscaling,Qt);for(const tt of lt)O&&Xf(i,O.text,Ue,tt)||Ve(Ce,tt)}else if($e==="line-center"){for(const Ce of e.geometry)if(Ce.length>1){const lt=$f(Ce,ve,n.vertical||O,s,24,ne);lt&&Ve(Ce,lt)}}else if(e.type==="Polygon")for(const Ce of Wc(e.geometry,0)){const lt=Zf(Ce,16);Ve(Ce[0],new ms(lt.x,lt.y,0))}else if(e.type==="LineString")for(const Ce of e.geometry)Ve(Ce,new ms(Ce[0].x,Ce[0].y,0));else if(e.type==="Point")for(const Ce of e.geometry)for(const lt of Ce)Ve([lt],new ms(lt.x,lt.y,0))}function ap(i,e,n,s,c,h,p,m,y,w,I,P,L,B,O){const H=function(oe,ee,le,pe,ve,Ye,Je,$e){const Ue=pe.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,Le=[];for(const Ge of ee.positionedLines)for(const Ve of Ge.positionedGlyphs){if(!Ve.rect)continue;const Ce=Ve.rect||{};let lt=4,tt=!0,bt=1,Xt=0;const ei=(ve||$e)&&Ve.vertical,Di=Ve.metrics.advance*Ve.scale/2;if($e&&ee.verticalizable&&(Xt=Ge.lineOffset/2-(Ve.imageName?-(Hi-Ve.metrics.width*Ve.scale)/2:(Ve.scale-1)*Hi)),Ve.imageName){const ui=Je[Ve.imageName];tt=ui.sdf,bt=ui.pixelRatio,lt=1/bt}const lr=ve?[Ve.x+Di,Ve.y]:[0,0];let nn=ve?[0,0]:[Ve.x+Di+le[0],Ve.y+le[1]-Xt],Ci=[0,0];ei&&(Ci=nn,nn=[0,0]);const Ni=(Ve.metrics.left-lt)*Ve.scale-Di+nn[0],rn=(-Ve.metrics.top-lt)*Ve.scale+nn[1],pn=Ni+Ce.w*Ve.scale/bt,Fn=rn+Ce.h*Ve.scale/bt,Pi=new W(Ni,rn),sn=new W(pn,rn),dn=new W(Ni,Fn),An=new W(pn,Fn);if(ei){const ui=new W(-Di,Di-Yl),on=-Math.PI/2,wt=12-Di,Wn=new W(22-wt,-(Ve.imageName?wt:0)),an=new W(...Ci);Pi._rotateAround(on,ui)._add(Wn)._add(an),sn._rotateAround(on,ui)._add(Wn)._add(an),dn._rotateAround(on,ui)._add(Wn)._add(an),An._rotateAround(on,ui)._add(Wn)._add(an)}if(Ue){const ui=Math.sin(Ue),on=Math.cos(Ue),wt=[on,-ui,ui,on];Pi._matMult(wt),sn._matMult(wt),dn._matMult(wt),An._matMult(wt)}const On=new W(0,0),Un=new W(0,0);Le.push({tl:Pi,tr:sn,bl:dn,br:An,tex:Ce,writingMode:ee.writingMode,glyphOffset:lr,sectionIndex:Ve.sectionIndex,isSDF:tt,pixelOffsetTL:On,pixelOffsetBR:Un,minFontScaleX:0,minFontScaleY:0})}return Le}(0,n,m,c,h,p,s,i.allowVerticalPlacement),q=i.textSizeData;let ne=null;q.kind==="source"?(ne=[Xr*c.layout.get("text-size").evaluate(p,{})],ne[0]>ds&&Wt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):q.kind==="composite"&&(ne=[Xr*B.compositeTextSizes[0].evaluate(p,{},O),Xr*B.compositeTextSizes[1].evaluate(p,{},O)],(ne[0]>ds||ne[1]>ds)&&Wt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,H,ne,m,h,p,w,e,y.lineStartIndex,y.lineLength,L,O);for(const oe of I)P[oe]=i.text.placedSymbolArray.length-1;return 4*H.length}function lp(i){for(const e in i)return i[e];return null}function Xf(i,e,n,s){const c=i.compareText;if(e in c){const h=c[e];for(let p=h.length-1;p>=0;p--)if(s.dist(h[p])<n)return!0}else c[e]=[];return c[e].push(s),!1}const cp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class mu{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,s]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=s>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const h=cp[15&s];if(!h)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[m]=new Uint32Array(e,4,1);return new mu(m,p,h,e)}constructor(e,n=64,s=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const h=cp.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,m=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-m%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${s}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+m+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=n,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return gu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:m}=this,y=[0,h.length-1,0],w=[];for(;y.length;){const I=y.pop()||0,P=y.pop()||0,L=y.pop()||0;if(P-L<=m){for(let q=L;q<=P;q++){const ne=p[2*q],oe=p[2*q+1];ne>=e&&ne<=s&&oe>=n&&oe<=c&&w.push(h[q])}continue}const B=L+P>>1,O=p[2*B],H=p[2*B+1];O>=e&&O<=s&&H>=n&&H<=c&&w.push(h[B]),(I===0?e<=O:n<=H)&&(y.push(L),y.push(B-1),y.push(1-I)),(I===0?s>=O:c>=H)&&(y.push(B+1),y.push(P),y.push(1-I))}return w}within(e,n,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:h,nodeSize:p}=this,m=[0,c.length-1,0],y=[],w=s*s;for(;m.length;){const I=m.pop()||0,P=m.pop()||0,L=m.pop()||0;if(P-L<=p){for(let q=L;q<=P;q++)hp(h[2*q],h[2*q+1],e,n)<=w&&y.push(c[q]);continue}const B=L+P>>1,O=h[2*B],H=h[2*B+1];hp(O,H,e,n)<=w&&y.push(c[B]),(I===0?e-s<=O:n-s<=H)&&(m.push(L),m.push(B-1),m.push(1-I)),(I===0?e+s>=O:n+s>=H)&&(m.push(B+1),m.push(P),m.push(1-I))}return y}}function gu(i,e,n,s,c,h){if(c-s<=n)return;const p=s+c>>1;up(i,e,p,s,c,h),gu(i,e,n,s,p-1,1-h),gu(i,e,n,p+1,c,1-h)}function up(i,e,n,s,c,h){for(;c>s;){if(c-s>600){const w=c-s+1,I=n-s+1,P=Math.log(w),L=.5*Math.exp(2*P/3),B=.5*Math.sqrt(P*L*(w-L)/w)*(I-w/2<0?-1:1);up(i,e,n,Math.max(s,Math.floor(n-I*L/w+B)),Math.min(c,Math.floor(n+(w-I)*L/w+B)),h)}const p=e[2*n+h];let m=s,y=c;for(Wa(i,e,s,n),e[2*c+h]>p&&Wa(i,e,s,c);m<y;){for(Wa(i,e,m,y),m++,y--;e[2*m+h]<p;)m++;for(;e[2*y+h]>p;)y--}e[2*s+h]===p?Wa(i,e,s,y):(y++,Wa(i,e,y,c)),y<=n&&(s=y+1),n<=y&&(c=y-1)}}function Wa(i,e,n,s){_u(i,n,s),_u(e,2*n,2*s),_u(e,2*n+1,2*s+1)}function _u(i,e,n){const s=i[e];i[e]=i[n],i[n]=s}function hp(i,e,n,s){const c=i-n,h=e-s;return c*c+h*h}var yu;o.PerformanceMarkers=void 0,(yu=o.PerformanceMarkers||(o.PerformanceMarkers={})).create="create",yu.load="load",yu.fullLoad="fullLoad";let oc=null,Ha=[];const xu=1e3/60,vu="loadTime",bu="fullLoadTime",Yf={mark(i){performance.mark(i)},frame(i){const e=i;oc!=null&&Ha.push(e-oc),oc=e},clearMetrics(){oc=null,Ha=[],performance.clearMeasures(vu),performance.clearMeasures(bu);for(const i in o.PerformanceMarkers)performance.clearMarks(o.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure(vu,o.PerformanceMarkers.create,o.PerformanceMarkers.load),performance.measure(bu,o.PerformanceMarkers.create,o.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName(vu)[0].duration,e=performance.getEntriesByName(bu)[0].duration,n=Ha.length,s=1/(Ha.reduce((h,p)=>h+p,0)/n/1e3),c=Ha.filter(h=>h>xu).reduce((h,p)=>h+(p-xu)/xu,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:c/(n+c)*100,totalFrames:n}}};o.AJAXError=oi,o.ARRAY_TYPE=Lo,o.Actor=class{constructor(i,e,n){this.target=i,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},nt(["receive","process"],this),this.invoker=new Vf(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ht()?i:window}send(i,e,n,s,c=!1){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[h]=n);const p=mi(this.globalScope)?void 0:[];return this.target.postMessage({id:h,type:i,hasCallback:!!n,targetMapId:s,mustQueue:c,sourceMapId:this.mapId,data:Ls(e,p)},p),{cancel:()=>{n&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(i){const e=i.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[n];const s=this.cancelCallbacks[n];delete this.cancelCallbacks[n],s&&s()}else Ht()||e.mustQueue?(this.tasks[n]=e,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,e)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){if(e.type==="<response>"){const n=this.callbacks[i];delete this.callbacks[i],n&&(e.error?n(Ir(e.error)):n(null,Ir(e.data)))}else{let n=!1;const s=mi(this.globalScope)?void 0:[],c=e.hasCallback?(m,y)=>{n=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:m?Ls(m):null,data:Ls(y,s)},s)}:m=>{n=!0};let h=null;const p=Ir(e.data);if(this.parent[e.type])h=this.parent[e.type](e.sourceMapId,p,c);else if(this.parent.getWorkerSource){const m=e.type.split(".");h=this.parent.getWorkerSource(e.sourceMapId,m[0],p.source)[m[1]](p,c)}else c(new Error(`Could not find function ${e.type}`));!n&&h&&h.cancel&&(this.cancelCallbacks[i]=h.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.AlphaImage=Fa,o.CanonicalTileID=pu,o.CollisionBoxArray=u,o.CollisionCircleLayoutArray=class extends Ao{},o.Color=Ct,o.DEMData=Zh,o.DataConstantProperty=it,o.DictionaryCoder=Wh,o.EXTENT=Qt,o.ErrorEvent=yn,o.EvaluationParameters=Jt,o.Event=Ji,o.Evented=Ii,o.FeatureIndex=Xh,o.FillBucket=Yc,o.FillExtrusionBucket=Jc,o.GeoJSONFeature=Hh,o.ImageAtlas=Ah,o.ImagePosition=iu,o.KDBush=mu,o.LineBucket=Qc,o.LineStripIndexArray=class extends t{},o.LngLat=fs,o.MercatorCoordinate=tc,o.ONE_EM=Hi,o.OverscaledTileID=ar,o.PerformanceUtils=Yf,o.Point=W,o.Pos3dArray=class extends So{},o.PosArray=Z,o.Properties=En,o.Protobuf=tu,o.QuadTriangleArray=class extends Mo{},o.RGBAImage=or,o.RasterBoundsArray=class extends Pa{},o.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},o.SegmentVector=Fe,o.SymbolBucket=Vo,o.Transitionable=Bl,o.TriangleIndexArray=Ie,o.Uniform1f=vr,o.Uniform1i=class extends hn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends hn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},o.Uniform3f=class extends hn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},o.Uniform4f=Us,o.UniformColor=tn,o.UniformMatrix4f=class extends hn{constructor(i,e){super(i,e),this.current=Ui}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},o.UnwrappedTileID=Gh,o.ValidationError=Re,o.ZoomHistory=Pl,o.addDynamicAttributes=ou,o.arrayBufferToImage=function(i,e){const n=new Image;n.onload=()=>{e(null,n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame(()=>{n.src=Vt})},n.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const s=new Blob([new Uint8Array(i)],{type:"image/png"});n.src=i.byteLength?URL.createObjectURL(s):Vt},o.arrayBufferToImageBitmap=function(i,e){const n=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(n).then(s=>{e(null,s)}).catch(s=>{e(new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},o.asyncAll=function(i,e,n){if(!i.length)return n(null,[]);let s=i.length;const c=new Array(i.length);let h=null;i.forEach((p,m)=>{e(p,(y,w)=>{y&&(h=y),c[m]=w,--s==0&&n(h,c)})})},o.bezier=Pe,o.bindAll=nt,o.clamp=Se,o.clipLine=Jh,o.clone=function(i){var e=new Lo(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},o.clone$1=ht,o.collisionCircleLayout=mf,o.config=Ei,o.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},o.create=function(){var i=new Lo(16);return Lo!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o.createExpression=si,o.createFilter=ma,o.createLayout=Mi,o.createStyleLayer=function(i){return i.type==="custom"?new Of(i):new Uf[i.type](i)},o.deepEqual=function i(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(!i(e[s],n[s]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const s in e)if(!i(e[s],n[s]))return!1;return!0}return e===n},o.derefLayers=function(i){i=i.slice();const e=Object.create(null);for(let n=0;n<i.length;n++)e[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=qi(i[n],e[i[n].ref]));return i},o.diffStyles=function(i,e){if(!i)return[{command:It.setStyle,args:[e]}];let n=[];try{if(!Dt(i.version,e.version))return[{command:It.setStyle,args:[e]}];Dt(i.center,e.center)||n.push({command:It.setCenter,args:[e.center]}),Dt(i.zoom,e.zoom)||n.push({command:It.setZoom,args:[e.zoom]}),Dt(i.bearing,e.bearing)||n.push({command:It.setBearing,args:[e.bearing]}),Dt(i.pitch,e.pitch)||n.push({command:It.setPitch,args:[e.pitch]}),Dt(i.sprite,e.sprite)||n.push({command:It.setSprite,args:[e.sprite]}),Dt(i.glyphs,e.glyphs)||n.push({command:It.setGlyphs,args:[e.glyphs]}),Dt(i.transition,e.transition)||n.push({command:It.setTransition,args:[e.transition]}),Dt(i.light,e.light)||n.push({command:It.setLight,args:[e.light]});const s={},c=[];(function(p,m,y,w){let I;for(I in m=m||{},p=p||{})Object.prototype.hasOwnProperty.call(p,I)&&(Object.prototype.hasOwnProperty.call(m,I)||Er(I,y,w));for(I in m)Object.prototype.hasOwnProperty.call(m,I)&&(Object.prototype.hasOwnProperty.call(p,I)?Dt(p[I],m[I])||(p[I].type==="geojson"&&m[I].type==="geojson"&&xn(p,m,I)?y.push({command:It.setGeoJSONSourceData,args:[I,m[I].data]}):Ur(I,m,y,w)):gi(I,m,y))})(i.sources,e.sources,c,s);const h=[];i.layers&&i.layers.forEach(p=>{s[p.source]?n.push({command:It.removeLayer,args:[p.id]}):h.push(p)}),n=n.concat(c),function(p,m,y){m=m||[];const w=(p=p||[]).map(er),I=m.map(er),P=p.reduce(kn,{}),L=m.reduce(kn,{}),B=w.slice(),O=Object.create(null);let H,q,ne,oe,ee,le,pe;for(H=0,q=0;H<w.length;H++)ne=w[H],Object.prototype.hasOwnProperty.call(L,ne)?q++:(y.push({command:It.removeLayer,args:[ne]}),B.splice(B.indexOf(ne,q),1));for(H=0,q=0;H<I.length;H++)ne=I[I.length-1-H],B[B.length-1-H]!==ne&&(Object.prototype.hasOwnProperty.call(P,ne)?(y.push({command:It.removeLayer,args:[ne]}),B.splice(B.lastIndexOf(ne,B.length-q),1)):q++,le=B[B.length-H],y.push({command:It.addLayer,args:[L[ne],le]}),B.splice(B.length-H,0,ne),O[ne]=!0);for(H=0;H<I.length;H++)if(ne=I[H],oe=P[ne],ee=L[ne],!O[ne]&&!Dt(oe,ee))if(Dt(oe.source,ee.source)&&Dt(oe["source-layer"],ee["source-layer"])&&Dt(oe.type,ee.type)){for(pe in ai(oe.layout,ee.layout,y,ne,null,It.setLayoutProperty),ai(oe.paint,ee.paint,y,ne,null,It.setPaintProperty),Dt(oe.filter,ee.filter)||y.push({command:It.setFilter,args:[ne,ee.filter]}),Dt(oe.minzoom,ee.minzoom)&&Dt(oe.maxzoom,ee.maxzoom)||y.push({command:It.setLayerZoomRange,args:[ne,ee.minzoom,ee.maxzoom]}),oe)Object.prototype.hasOwnProperty.call(oe,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?ai(oe[pe],ee[pe],y,ne,pe.slice(6),It.setPaintProperty):Dt(oe[pe],ee[pe])||y.push({command:It.setLayerProperty,args:[ne,pe,ee[pe]]}));for(pe in ee)Object.prototype.hasOwnProperty.call(ee,pe)&&!Object.prototype.hasOwnProperty.call(oe,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?ai(oe[pe],ee[pe],y,ne,pe.slice(6),It.setPaintProperty):Dt(oe[pe],ee[pe])||y.push({command:It.setLayerProperty,args:[ne,pe,ee[pe]]}))}else y.push({command:It.removeLayer,args:[ne]}),le=B[B.lastIndexOf(ne)+1],y.push({command:It.addLayer,args:[ee,le]})}(h,e.layers,n)}catch(s){console.warn("Unable to compute style diff:",s),n=[{command:It.setStyle,args:[e]}]}return n},o.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},o.earthRadius=uu,o.ease=je,o.emitValidationErrors=ls,o.emptyStyle=function(){const i={},e=ye.$version;for(const n in ye.$root){const s=ye.$root[n];if(s.required){let c=null;c=n==="version"?e:s.type==="array"?[]:{},c!=null&&(i[n]=c)}}return i},o.equals=function(i,e){var n=i[0],s=i[1],c=i[2],h=i[3],p=i[4],m=i[5],y=i[6],w=i[7],I=i[8],P=i[9],L=i[10],B=i[11],O=i[12],H=i[13],q=i[14],ne=i[15],oe=e[0],ee=e[1],le=e[2],pe=e[3],ve=e[4],Ye=e[5],Je=e[6],$e=e[7],Ue=e[8],Le=e[9],Ge=e[10],Ve=e[11],Ce=e[12],lt=e[13],tt=e[14],bt=e[15];return Math.abs(n-oe)<=In*Math.max(1,Math.abs(n),Math.abs(oe))&&Math.abs(s-ee)<=In*Math.max(1,Math.abs(s),Math.abs(ee))&&Math.abs(c-le)<=In*Math.max(1,Math.abs(c),Math.abs(le))&&Math.abs(h-pe)<=In*Math.max(1,Math.abs(h),Math.abs(pe))&&Math.abs(p-ve)<=In*Math.max(1,Math.abs(p),Math.abs(ve))&&Math.abs(m-Ye)<=In*Math.max(1,Math.abs(m),Math.abs(Ye))&&Math.abs(y-Je)<=In*Math.max(1,Math.abs(y),Math.abs(Je))&&Math.abs(w-$e)<=In*Math.max(1,Math.abs(w),Math.abs($e))&&Math.abs(I-Ue)<=In*Math.max(1,Math.abs(I),Math.abs(Ue))&&Math.abs(P-Le)<=In*Math.max(1,Math.abs(P),Math.abs(Le))&&Math.abs(L-Ge)<=In*Math.max(1,Math.abs(L),Math.abs(Ge))&&Math.abs(B-Ve)<=In*Math.max(1,Math.abs(B),Math.abs(Ve))&&Math.abs(O-Ce)<=In*Math.max(1,Math.abs(O),Math.abs(Ce))&&Math.abs(H-lt)<=In*Math.max(1,Math.abs(H),Math.abs(lt))&&Math.abs(q-tt)<=In*Math.max(1,Math.abs(q),Math.abs(tt))&&Math.abs(ne-bt)<=In*Math.max(1,Math.abs(ne),Math.abs(bt))},o.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:c}){return i.kind==="source"?s/Xr:i.kind==="composite"?Tn.number(s/Xr,c/Xr,n):e},o.evaluateSizeForZoom=function(i,e){let n=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:h,maxZoom:p}=i,m=c?Se(Ln.interpolationFactor(c,e,h,p),0,1):0;i.kind==="camera"?s=Tn.number(i.minSize,i.maxSize,m):n=m}return{uSizeT:n,uSize:s}},o.evaluateVariableOffset=op,o.evented=vo,o.exported=Pn,o.extend=ze,o.filterObject=Qe,o.findLineIntersection=function(i,e,n,s){const c=e.y-i.y,h=e.x-i.x,p=s.y-n.y,m=s.x-n.x,y=p*h-m*c;if(y===0)return null;const w=(m*(i.y-n.y)-p*(i.x-n.x))/y;return new W(i.x+w*h,i.y+w*c)},o.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.getAnchorAlignment=ru,o.getAnchorJustification=fu,o.getArrayBuffer=Yi,o.getDefaultExportFromCjs=U,o.getJSON=function(i,e){return ti(ze(i,{type:"json"}),e)},o.getOverlapMode=su,o.getProtocolAction=Mt,o.getRTLTextPluginStatus=Ea,o.getReferrer=Bi,o.getVideo=function(i,e){const n=window.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<i.length;s++){const c=window.document.createElement("source");Sr(i[s])||(n.crossOrigin="Anonymous"),c.src=i[s],n.appendChild(c)}return{cancel:()=>{}}},o.groupByLayout=function(i,e){const n={};for(let c=0;c<i.length;c++){const h=e&&e[i[c].id]||kc(i[c]);e&&(e[i[c].id]=h);let p=n[h];p||(p=n[h]=[]),p.push(i[c])}const s=[];for(const c in n)s.push(n[c]);return s},o.identity=Vc,o.interpolate=Tn,o.invert=function(i,e){var n=e[0],s=e[1],c=e[2],h=e[3],p=e[4],m=e[5],y=e[6],w=e[7],I=e[8],P=e[9],L=e[10],B=e[11],O=e[12],H=e[13],q=e[14],ne=e[15],oe=n*m-s*p,ee=n*y-c*p,le=n*w-h*p,pe=s*y-c*m,ve=s*w-h*m,Ye=c*w-h*y,Je=I*H-P*O,$e=I*q-L*O,Ue=I*ne-B*O,Le=P*q-L*H,Ge=P*ne-B*H,Ve=L*ne-B*q,Ce=oe*Ve-ee*Ge+le*Le+pe*Ue-ve*$e+Ye*Je;return Ce?(i[0]=(m*Ve-y*Ge+w*Le)*(Ce=1/Ce),i[1]=(c*Ge-s*Ve-h*Le)*Ce,i[2]=(H*Ye-q*ve+ne*pe)*Ce,i[3]=(L*ve-P*Ye-B*pe)*Ce,i[4]=(y*Ue-p*Ve-w*$e)*Ce,i[5]=(n*Ve-c*Ue+h*$e)*Ce,i[6]=(q*le-O*Ye-ne*ee)*Ce,i[7]=(I*Ye-L*le+B*ee)*Ce,i[8]=(p*Ge-m*Ue+w*Je)*Ce,i[9]=(s*Ue-n*Ge-h*Je)*Ce,i[10]=(O*ve-H*le+ne*oe)*Ce,i[11]=(P*le-I*ve-B*oe)*Ce,i[12]=(m*$e-p*Le-y*Je)*Ce,i[13]=(n*Le-s*$e+c*Je)*Ce,i[14]=(H*ee-O*pe-q*oe)*Ce,i[15]=(I*pe-P*ee+L*oe)*Ce,i):null},o.isImageBitmap=Tt,o.isSafari=mi,o.isWorker=Ht,o.keysDifference=function(i,e){const n=[];for(const s in i)s in e||n.push(s);return n},o.lazyLoadRTLTextPlugin=function(){Zn.isLoading()||Zn.isLoaded()||Ea()!=="deferred"||Rl()},o.makeRequest=ti,o.mapObject=Ee,o.mercatorXfromLng=Nh,o.mercatorYfromLat=$h,o.mercatorZfromAltitude=jh,o.mul=Id,o.mul$1=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},o.multiply=Wu,o.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},o.operations=It,o.ortho=function(i,e,n,s,c,h,p){var m=1/(e-n),y=1/(s-c),w=1/(h-p);return i[0]=-2*m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*w,i[11]=0,i[12]=(e+n)*m,i[13]=(c+s)*y,i[14]=(p+h)*w,i[15]=1,i},o.parseCacheControl=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,c,h)=>{const p=c||h;return e[s]=!p||p.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},o.parseGlyphPbf=function(i){return new tu(i).readFields(If,[])},o.pbf=xh,o.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Qt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0].layout,n=i.bucket.layers[0]._unevaluatedLayout._values,s={layoutIconSize:n["icon-size"].possiblyEvaluate(new Jt(i.bucket.zoom+1),i.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new Jt(i.bucket.zoom+1),i.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new Jt(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:y,maxZoom:w}=i.bucket.textSizeData;s.compositeTextSizes=[n["text-size"].possiblyEvaluate(new Jt(y),i.canonical),n["text-size"].possiblyEvaluate(new Jt(w),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:y,maxZoom:w}=i.bucket.iconSizeData;s.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new Jt(y),i.canonical),n["icon-size"].possiblyEvaluate(new Jt(w),i.canonical)]}const c=e.get("text-line-height")*Hi,h=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",p=e.get("text-keep-upright"),m=e.get("text-size");for(const y of i.bucket.features){const w=e.get("text-font").evaluate(y,{},i.canonical).join(","),I=m.evaluate(y,{},i.canonical),P=s.layoutTextSize.evaluate(y,{},i.canonical),L=s.layoutIconSize.evaluate(y,{},i.canonical),B={horizontal:{},vertical:void 0},O=y.text;let H,q=[0,0];if(O){const ee=O.toString(),le=e.get("text-letter-spacing").evaluate(y,{},i.canonical)*Hi,pe=ba(ee)?le:0,ve=e.get("text-anchor").evaluate(y,{},i.canonical),Ye=e.get("text-variable-anchor");if(!Ye){const Ge=e.get("text-radial-offset").evaluate(y,{},i.canonical);q=Ge?op(ve,[Ge*Hi,du]):e.get("text-offset").evaluate(y,{},i.canonical).map(Ve=>Ve*Hi)}let Je=h?"center":e.get("text-justify").evaluate(y,{},i.canonical);const $e=e.get("symbol-placement"),Ue=$e==="point"?e.get("text-max-width").evaluate(y,{},i.canonical)*Hi:0,Le=()=>{i.bucket.allowVerticalPlacement&&mo(ee)&&(B.vertical=Kl(O,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ue,c,ve,"left",pe,q,o.WritingMode.vertical,!0,$e,P,I))};if(!h&&Ye){const Ge=Je==="auto"?Ye.map(Ce=>fu(Ce)):[Je];let Ve=!1;for(let Ce=0;Ce<Ge.length;Ce++){const lt=Ge[Ce];if(!B.horizontal[lt])if(Ve)B.horizontal[lt]=B.horizontal[0];else{const tt=Kl(O,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ue,c,"center",lt,pe,q,o.WritingMode.horizontal,!1,$e,P,I);tt&&(B.horizontal[lt]=tt,Ve=tt.positionedLines.length===1)}}Le()}else{Je==="auto"&&(Je=fu(ve));const Ge=Kl(O,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ue,c,ve,Je,pe,q,o.WritingMode.horizontal,!1,$e,P,I);Ge&&(B.horizontal[Je]=Ge),Le(),mo(ee)&&h&&p&&(B.vertical=Kl(O,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ue,c,ve,Je,pe,q,o.WritingMode.vertical,!1,$e,P,I))}}let ne=!1;if(y.icon&&y.icon.name){const ee=i.imageMap[y.icon.name];ee&&(H=zf(i.imagePositions[y.icon.name],e.get("icon-offset").evaluate(y,{},i.canonical),e.get("icon-anchor").evaluate(y,{},i.canonical)),ne=!!ee.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ne:i.bucket.sdfIcons!==ne&&Wt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ee.pixelRatio!==i.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const oe=lp(B.horizontal)||B.vertical;i.bucket.iconsInText=!!oe&&oe.iconsInText,(oe||H)&&Hf(i.bucket,y,B,H,i.imageMap,s,P,L,q,ne,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},o.perspective=function(i,e,n,s,c){var h,p=1/Math.tan(e/2);return i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+s)*(h=1/(s-c)),i[14]=2*c*s*h):(i[10]=-1,i[14]=-2*s),i},o.pick=function(i,e){const n={};for(let s=0;s<e.length;s++){const c=e[s];c in i&&(n[c]=i[c])}return n},o.plugin=Zn,o.pointGeometry=z,o.polygonIntersectsPolygon=Nu,o.potpack=Ih,o.register=Ke,o.registerForPluginStateChange=function(i){return i({pluginStatus:Sn,pluginURL:Fr}),vo.on("pluginStateChange",i),i},o.renderColorRamp=Ju,o.rotateX=function(i,e,n){var s=Math.sin(n),c=Math.cos(n),h=e[4],p=e[5],m=e[6],y=e[7],w=e[8],I=e[9],P=e[10],L=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=h*c+w*s,i[5]=p*c+I*s,i[6]=m*c+P*s,i[7]=y*c+L*s,i[8]=w*c-h*s,i[9]=I*c-p*s,i[10]=P*c-m*s,i[11]=L*c-y*s,i},o.rotateZ=function(i,e,n){var s=Math.sin(n),c=Math.cos(n),h=e[0],p=e[1],m=e[2],y=e[3],w=e[4],I=e[5],P=e[6],L=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*c+w*s,i[1]=p*c+I*s,i[2]=m*c+P*s,i[3]=y*c+L*s,i[4]=w*c-h*s,i[5]=I*c-p*s,i[6]=P*c-m*s,i[7]=L*c-y*s,i},o.sameOrigin=Sr,o.scale=function(i,e,n){var s=n[0],c=n[1],h=n[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*h,i[9]=e[9]*h,i[10]=e[10]*h,i[11]=e[11]*h,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},o.setRTLTextPlugin=function(i,e,n=!1){if(Sn===wa||Sn===xo||Sn===Ta)throw new Error("setRTLTextPlugin cannot be called multiple times.");Fr=Pn.resolveURL(i),Sn=wa,Rs=e,Sa(),n||Rl()},o.sphericalToCartesian=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}},o.toEvaluationFeature=Ns,o.transformMat4=jl,o.translate=function(i,e,n){var s,c,h,p,m,y,w,I,P,L,B,O,H=n[0],q=n[1],ne=n[2];return e===i?(i[12]=e[0]*H+e[4]*q+e[8]*ne+e[12],i[13]=e[1]*H+e[5]*q+e[9]*ne+e[13],i[14]=e[2]*H+e[6]*q+e[10]*ne+e[14],i[15]=e[3]*H+e[7]*q+e[11]*ne+e[15]):(c=e[1],h=e[2],p=e[3],m=e[4],y=e[5],w=e[6],I=e[7],P=e[8],L=e[9],B=e[10],O=e[11],i[0]=s=e[0],i[1]=c,i[2]=h,i[3]=p,i[4]=m,i[5]=y,i[6]=w,i[7]=I,i[8]=P,i[9]=L,i[10]=B,i[11]=O,i[12]=s*H+m*q+P*ne+e[12],i[13]=c*H+y*q+L*ne+e[13],i[14]=h*H+w*q+B*ne+e[14],i[15]=p*H+I*q+O*ne+e[15]),i},o.triggerPluginCompletionEvent=Ll,o.unicodeBlockLookup=Ne,o.uniqueId=function(){return qe++},o.v8Spec=ye,o.validateCustomStyleLayer=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateLight=zc,o.validateStyle=Br,o.vectorTile=hs,o.warnOnce=Wt,o.wrap=Xe}),S(["./shared"],function(o){class U{constructor(k){this.keyCache={},k&&this.replace(k)}replace(k){this._layerConfigs={},this._layers={},this.update(k,[])}update(k,R){for(const Y of k){this._layerConfigs[Y.id]=Y;const Q=this._layers[Y.id]=o.createStyleLayer(Y);Q._featureFilter=o.createFilter(Q.filter),this.keyCache[Y.id]&&delete this.keyCache[Y.id]}for(const Y of R)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const N=o.groupByLayout(Object.values(this._layerConfigs),this.keyCache);for(const Y of N){const Q=Y.map(xe=>this._layers[xe.id]),se=Q[0];if(se.visibility==="none")continue;const re=se.source||"";let V=this.familiesBySource[re];V||(V=this.familiesBySource[re]={});const J=se.sourceLayer||"_geojsonTileLayer";let be=V[J];be||(be=V[J]=[]),be.push(Q)}}}class z{constructor(k){const R={},N=[];for(const re in k){const V=k[re],J=R[re]={};for(const be in V){const xe=V[+be];if(!xe||xe.bitmap.width===0||xe.bitmap.height===0)continue;const we={x:0,y:0,w:xe.bitmap.width+2,h:xe.bitmap.height+2};N.push(we),J[be]={rect:we,metrics:xe.metrics}}}const{w:Y,h:Q}=o.potpack(N),se=new o.AlphaImage({width:Y||1,height:Q||1});for(const re in k){const V=k[re];for(const J in V){const be=V[+J];if(!be||be.bitmap.width===0||be.bitmap.height===0)continue;const xe=R[re][J].rect;o.AlphaImage.copy(be.bitmap,se,{x:0,y:0},{x:xe.x+1,y:xe.y+1},be.bitmap)}}this.image=se,this.positions=R}}o.register("GlyphAtlas",z);class ie{constructor(k){this.tileID=new o.OverscaledTileID(k.tileID.overscaledZ,k.tileID.wrap,k.tileID.canonical.z,k.tileID.canonical.x,k.tileID.canonical.y),this.uid=k.uid,this.zoom=k.zoom,this.pixelRatio=k.pixelRatio,this.tileSize=k.tileSize,this.source=k.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=k.showCollisionBoxes,this.collectResourceTiming=!!k.collectResourceTiming,this.returnDependencies=!!k.returnDependencies,this.promoteId=k.promoteId}parse(k,R,N,Y,Q){this.status="parsing",this.data=k,this.collisionBoxArray=new o.CollisionBoxArray;const se=new o.DictionaryCoder(Object.keys(k.layers).sort()),re=new o.FeatureIndex(this.tileID,this.promoteId);re.bucketLayerIDs=[];const V={},J={featureIndex:re,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:N},be=R.familiesBySource[this.source];for(const xt in be){const Rt=k.layers[xt];if(!Rt)continue;Rt.version===1&&o.warnOnce(`Vector tile source "${this.source}" layer "${xt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ft=se.encode(xt),Kt=[];for(let ni=0;ni<Rt.length;ni++){const yi=Rt.feature(ni),Ct=re.getId(yi,xt);Kt.push({feature:yi,id:Ct,index:ni,sourceLayerIndex:Ft})}for(const ni of be[xt]){const yi=ni[0];yi.source!==this.source&&o.warnOnce(`layer.source = ${yi.source} does not equal this.source = ${this.source}`),yi.minzoom&&this.zoom<Math.floor(yi.minzoom)||yi.maxzoom&&this.zoom>=yi.maxzoom||yi.visibility!=="none"&&(W(ni,this.zoom,N),(V[yi.id]=yi.createBucket({index:re.bucketLayerIDs.length,layers:ni,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ft,sourceID:this.source})).populate(Kt,J,this.tileID.canonical),re.bucketLayerIDs.push(ni.map(Ct=>Ct.id)))}}let xe,we,st,ft;const et=o.mapObject(J.glyphDependencies,xt=>Object.keys(xt).map(Number));Object.keys(et).length?Y.send("getGlyphs",{uid:this.uid,stacks:et,source:this.source,tileID:this.tileID,type:"glyphs"},(xt,Rt)=>{xe||(xe=xt,we=Rt,Et.call(this))}):we={};const ot=Object.keys(J.iconDependencies);ot.length?Y.send("getImages",{icons:ot,source:this.source,tileID:this.tileID,type:"icons"},(xt,Rt)=>{xe||(xe=xt,st=Rt,Et.call(this))}):st={};const gt=Object.keys(J.patternDependencies);function Et(){if(xe)return Q(xe);if(we&&st&&ft){const xt=new z(we),Rt=new o.ImageAtlas(st,ft);for(const Ft in V){const Kt=V[Ft];Kt instanceof o.SymbolBucket?(W(Kt.layers,this.zoom,N),o.performSymbolLayout({bucket:Kt,glyphMap:we,glyphPositions:xt.positions,imageMap:st,imagePositions:Rt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Kt.hasPattern&&(Kt instanceof o.LineBucket||Kt instanceof o.FillBucket||Kt instanceof o.FillExtrusionBucket)&&(W(Kt.layers,this.zoom,N),Kt.addFeatures(J,this.tileID.canonical,Rt.patternPositions))}this.status="done",Q(null,{buckets:Object.values(V).filter(Ft=>!Ft.isEmpty()),featureIndex:re,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xt.image,imageAtlas:Rt,glyphMap:this.returnDependencies?we:null,iconMap:this.returnDependencies?st:null,glyphPositions:this.returnDependencies?xt.positions:null})}}gt.length?Y.send("getImages",{icons:gt,source:this.source,tileID:this.tileID,type:"patterns"},(xt,Rt)=>{xe||(xe=xt,ft=Rt,Et.call(this))}):ft={},Et.call(this)}}function W(j,k,R){const N=new o.EvaluationParameters(k);for(const Y of j)Y.recalculate(N,R)}function ae(j,k){const R=o.getArrayBuffer(j.request,(N,Y,Q,se)=>{N?k(N):Y&&k(null,{vectorTile:new o.vectorTile.VectorTile(new o.Protobuf(Y)),rawData:Y,cacheControl:Q,expires:se})});return()=>{R.cancel(),k()}}class he{constructor(k,R,N,Y){this.actor=k,this.layerIndex=R,this.availableImages=N,this.loadVectorData=Y||ae,this.loading={},this.loaded={}}loadTile(k,R){const N=k.uid;this.loading||(this.loading={});const Y=!!(k&&k.request&&k.request.collectResourceTiming)&&new o.RequestPerformance(k.request),Q=this.loading[N]=new ie(k);Q.abort=this.loadVectorData(k,(se,re)=>{if(delete this.loading[N],se||!re)return Q.status="done",this.loaded[N]=Q,R(se);const V=re.rawData,J={};re.expires&&(J.expires=re.expires),re.cacheControl&&(J.cacheControl=re.cacheControl);const be={};if(Y){const xe=Y.finish();xe&&(be.resourceTiming=JSON.parse(JSON.stringify(xe)))}Q.vectorTile=re.vectorTile,Q.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor,(xe,we)=>{if(xe||!we)return R(xe);R(null,o.extend({rawTileData:V.slice(0)},we,J,be))}),this.loaded=this.loaded||{},this.loaded[N]=Q})}reloadTile(k,R){const N=this.loaded,Y=k.uid,Q=this;if(N&&N[Y]){const se=N[Y];se.showCollisionBoxes=k.showCollisionBoxes;const re=(V,J)=>{const be=se.reloadCallback;be&&(delete se.reloadCallback,se.parse(se.vectorTile,Q.layerIndex,this.availableImages,Q.actor,be)),R(V,J)};se.status==="parsing"?se.reloadCallback=re:se.status==="done"&&(se.vectorTile?se.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor,re):re())}}abortTile(k,R){const N=this.loading,Y=k.uid;N&&N[Y]&&N[Y].abort&&(N[Y].abort(),delete N[Y]),R()}removeTile(k,R){const N=this.loaded,Y=k.uid;N&&N[Y]&&delete N[Y],R()}}class _e{constructor(){this.loaded={}}loadTile(k,R){const{uid:N,encoding:Y,rawImageData:Q}=k,se=o.isImageBitmap(Q)?this.getImageData(Q):Q,re=new o.DEMData(N,se,Y);this.loaded=this.loaded||{},this.loaded[N]=re,R(null,re)}getImageData(k){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(k.width,k.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=k.width,this.offscreenCanvas.height=k.height,this.offscreenCanvasContext.drawImage(k,0,0,k.width,k.height);const R=this.offscreenCanvasContext.getImageData(-1,-1,k.width+2,k.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:R.width,height:R.height},R.data)}removeTile(k){const R=this.loaded,N=k.uid;R&&R[N]&&delete R[N]}}function Pe(j,k){if(j.length!==0){je(j[0],k);for(var R=1;R<j.length;R++)je(j[R],!k)}}function je(j,k){for(var R=0,N=0,Y=0,Q=j.length,se=Q-1;Y<Q;se=Y++){var re=(j[Y][0]-j[se][0])*(j[se][1]+j[Y][1]),V=R+re;N+=Math.abs(R)>=Math.abs(re)?R-V+re:re-V+R,R=V}R+N>=0!=!!k&&j.reverse()}var Se=o.getDefaultExportFromCjs(function j(k,R){var N,Y=k&&k.type;if(Y==="FeatureCollection")for(N=0;N<k.features.length;N++)j(k.features[N],R);else if(Y==="GeometryCollection")for(N=0;N<k.geometries.length;N++)j(k.geometries[N],R);else if(Y==="Feature")j(k.geometry,R);else if(Y==="Polygon")Pe(k.coordinates,R);else if(Y==="MultiPolygon")for(N=0;N<k.coordinates.length;N++)Pe(k.coordinates[N],R);return k});const Xe=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;var ze={exports:{}},qe=o.pointGeometry,nt=o.vectorTile.VectorTileFeature,Ee=Qe;function Qe(j,k){this.options=k||{},this.features=j,this.length=j.length}function ht(j,k){this.id=typeof j.id=="number"?j.id:void 0,this.type=j.type,this.rawGeometry=j.type===1?[j.geometry]:j.geometry,this.properties=j.tags,this.extent=k||4096}Qe.prototype.feature=function(j){return new ht(this.features[j],this.options.extent)},ht.prototype.loadGeometry=function(){var j=this.rawGeometry;this.geometry=[];for(var k=0;k<j.length;k++){for(var R=j[k],N=[],Y=0;Y<R.length;Y++)N.push(new qe(R[Y][0],R[Y][1]));this.geometry.push(N)}return this.geometry},ht.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var j=this.geometry,k=1/0,R=-1/0,N=1/0,Y=-1/0,Q=0;Q<j.length;Q++)for(var se=j[Q],re=0;re<se.length;re++){var V=se[re];k=Math.min(k,V.x),R=Math.max(R,V.x),N=Math.min(N,V.y),Y=Math.max(Y,V.y)}return[k,N,R,Y]},ht.prototype.toGeoJSON=nt.prototype.toGeoJSON;var At=o.pbf,Wt=Ee;function yt(j){var k=new At;return function(R,N){for(var Y in R.layers)N.writeMessage(3,fi,R.layers[Y])}(j,k),k.finish()}function fi(j,k){var R;k.writeVarintField(15,j.version||1),k.writeStringField(1,j.name||""),k.writeVarintField(5,j.extent||4096);var N={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<j.length;R++)N.feature=j.feature(R),k.writeMessage(2,Ht,N);var Y=N.keys;for(R=0;R<Y.length;R++)k.writeStringField(3,Y[R]);var Q=N.values;for(R=0;R<Q.length;R++)k.writeMessage(4,Ri,Q[R])}function Ht(j,k){var R=j.feature;R.id!==void 0&&k.writeVarintField(1,R.id),k.writeMessage(2,Si,j),k.writeVarintField(3,R.type),k.writeMessage(4,Vt,R)}function Si(j,k){var R=j.feature,N=j.keys,Y=j.values,Q=j.keycache,se=j.valuecache;for(var re in R.properties){var V=R.properties[re],J=Q[re];if(V!==null){J===void 0&&(N.push(re),Q[re]=J=N.length-1),k.writeVarint(J);var be=typeof V;be!=="string"&&be!=="boolean"&&be!=="number"&&(V=JSON.stringify(V));var xe=be+":"+V,we=se[xe];we===void 0&&(Y.push(V),se[xe]=we=Y.length-1),k.writeVarint(we)}}}function mi(j,k){return(k<<3)+(7&j)}function Tt(j){return j<<1^j>>31}function Vt(j,k){for(var R=j.loadGeometry(),N=j.type,Y=0,Q=0,se=R.length,re=0;re<se;re++){var V=R[re],J=1;N===1&&(J=V.length),k.writeVarint(mi(1,J));for(var be=N===3?V.length-1:V.length,xe=0;xe<be;xe++){xe===1&&N!==1&&k.writeVarint(mi(2,be-1));var we=V[xe].x-Y,st=V[xe].y-Q;k.writeVarint(Tt(we)),k.writeVarint(Tt(st)),Y+=we,Q+=st}N===3&&k.writeVarint(mi(7,1))}}function Ri(j,k){var R=typeof j;R==="string"?k.writeStringField(1,j):R==="boolean"?k.writeBooleanField(7,j):R==="number"&&(j%1!=0?k.writeDoubleField(3,j):j<0?k.writeSVarintField(6,j):k.writeVarintField(5,j))}ze.exports=yt,ze.exports.fromVectorTileJs=yt,ze.exports.fromGeojsonVt=function(j,k){k=k||{};var R={};for(var N in j)R[N]=new Wt(j[N].features,k),R[N].name=N,R[N].version=k.version,R[N].extent=k.extent;return yt({layers:R})},ze.exports.GeoJSONWrapper=Wt;var Cn=o.getDefaultExportFromCjs(ze.exports);const Pn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:j=>j},Ei=Math.fround||(oi=new Float32Array(1),j=>(oi[0]=+j,oi[0]));var oi;class Bi{constructor(k){this.options=Object.assign(Object.create(Pn),k),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(k){const{log:R,minZoom:N,maxZoom:Y}=this.options;R&&console.time("total time");const Q=`prepare ${k.length} points`;R&&console.time(Q),this.points=k;const se=[];for(let V=0;V<k.length;V++){const J=k[V];if(!J.geometry)continue;const[be,xe]=J.geometry.coordinates,we=Ei(ti(be)),st=Ei(Yi(xe));se.push(we,st,1/0,V,-1,1),this.options.reduce&&se.push(0)}let re=this.trees[Y+1]=this._createTree(se);R&&console.timeEnd(Q);for(let V=Y;V>=N;V--){const J=+Date.now();re=this.trees[V]=this._createTree(this._cluster(re,V)),R&&console.log("z%d: %d clusters in %dms",V,re.numItems,+Date.now()-J)}return R&&console.timeEnd("total time"),this}getClusters(k,R){let N=((k[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,k[1]));let Q=k[2]===180?180:((k[2]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,k[3]));if(k[2]-k[0]>=360)N=-180,Q=180;else if(N>Q){const xe=this.getClusters([N,Y,180,se],R),we=this.getClusters([-180,Y,Q,se],R);return xe.concat(we)}const re=this.trees[this._limitZoom(R)],V=re.range(ti(N),Yi(se),ti(Q),Yi(Y)),J=re.data,be=[];for(const xe of V){const we=this.stride*xe;be.push(J[we+5]>1?Mt(J,we,this.clusterProps):this.points[J[we+3]])}return be}getChildren(k){const R=this._getOriginId(k),N=this._getOriginZoom(k),Y="No cluster with the specified id.",Q=this.trees[N];if(!Q)throw new Error(Y);const se=Q.data;if(R*this.stride>=se.length)throw new Error(Y);const re=this.options.radius/(this.options.extent*Math.pow(2,N-1)),V=Q.within(se[R*this.stride],se[R*this.stride+1],re),J=[];for(const be of V){const xe=be*this.stride;se[xe+4]===k&&J.push(se[xe+5]>1?Mt(se,xe,this.clusterProps):this.points[se[xe+3]])}if(J.length===0)throw new Error(Y);return J}getLeaves(k,R,N){const Y=[];return this._appendLeaves(Y,k,R=R||10,N=N||0,0),Y}getTile(k,R,N){const Y=this.trees[this._limitZoom(k)],Q=Math.pow(2,k),{extent:se,radius:re}=this.options,V=re/se,J=(N-V)/Q,be=(N+1+V)/Q,xe={features:[]};return this._addTileFeatures(Y.range((R-V)/Q,J,(R+1+V)/Q,be),Y.data,R,N,Q,xe),R===0&&this._addTileFeatures(Y.range(1-V/Q,J,1,be),Y.data,Q,N,Q,xe),R===Q-1&&this._addTileFeatures(Y.range(0,J,V/Q,be),Y.data,-1,N,Q,xe),xe.features.length?xe:null}getClusterExpansionZoom(k){let R=this._getOriginZoom(k)-1;for(;R<=this.options.maxZoom;){const N=this.getChildren(k);if(R++,N.length!==1)break;k=N[0].properties.cluster_id}return R}_appendLeaves(k,R,N,Y,Q){const se=this.getChildren(R);for(const re of se){const V=re.properties;if(V&&V.cluster?Q+V.point_count<=Y?Q+=V.point_count:Q=this._appendLeaves(k,V.cluster_id,N,Y,Q):Q<Y?Q++:k.push(re),k.length===N)break}return Q}_createTree(k){const R=new o.KDBush(k.length/this.stride|0,this.options.nodeSize,Float32Array);for(let N=0;N<k.length;N+=this.stride)R.add(k[N],k[N+1]);return R.finish(),R.data=k,R}_addTileFeatures(k,R,N,Y,Q,se){for(const re of k){const V=re*this.stride,J=R[V+5]>1;let be,xe,we;if(J)be=Jn(R,V,this.clusterProps),xe=R[V],we=R[V+1];else{const et=this.points[R[V+3]];be=et.properties;const[ot,gt]=et.geometry.coordinates;xe=ti(ot),we=Yi(gt)}const st={type:1,geometry:[[Math.round(this.options.extent*(xe*Q-N)),Math.round(this.options.extent*(we*Q-Y))]],tags:be};let ft;ft=J||this.options.generateId?R[V+3]:this.points[R[V+3]].id,ft!==void 0&&(st.id=ft),se.features.push(st)}}_limitZoom(k){return Math.max(this.options.minZoom,Math.min(Math.floor(+k),this.options.maxZoom+1))}_cluster(k,R){const{radius:N,extent:Y,reduce:Q,minPoints:se}=this.options,re=N/(Y*Math.pow(2,R)),V=k.data,J=[],be=this.stride;for(let xe=0;xe<V.length;xe+=be){if(V[xe+2]<=R)continue;V[xe+2]=R;const we=V[xe],st=V[xe+1],ft=k.within(V[xe],V[xe+1],re),et=V[xe+5];let ot=et;for(const gt of ft){const Et=gt*be;V[Et+2]>R&&(ot+=V[Et+5])}if(ot>et&&ot>=se){let gt,Et=we*et,xt=st*et,Rt=-1;const Ft=((xe/be|0)<<5)+(R+1)+this.points.length;for(const Kt of ft){const ni=Kt*be;if(V[ni+2]<=R)continue;V[ni+2]=R;const yi=V[ni+5];Et+=V[ni]*yi,xt+=V[ni+1]*yi,V[ni+4]=Ft,Q&&(gt||(gt=this._map(V,xe,!0),Rt=this.clusterProps.length,this.clusterProps.push(gt)),Q(gt,this._map(V,ni)))}V[xe+4]=Ft,J.push(Et/ot,xt/ot,1/0,Ft,-1,ot),Q&&J.push(Rt)}else{for(let gt=0;gt<be;gt++)J.push(V[xe+gt]);if(ot>1)for(const gt of ft){const Et=gt*be;if(!(V[Et+2]<=R)){V[Et+2]=R;for(let xt=0;xt<be;xt++)J.push(V[Et+xt])}}}}return J}_getOriginId(k){return k-this.points.length>>5}_getOriginZoom(k){return(k-this.points.length)%32}_map(k,R,N){if(k[R+5]>1){const se=this.clusterProps[k[R+6]];return N?Object.assign({},se):se}const Y=this.points[k[R+3]].properties,Q=this.options.map(Y);return N&&Q===Y?Object.assign({},Q):Q}}function Mt(j,k,R){return{type:"Feature",id:j[k+3],properties:Jn(j,k,R),geometry:{type:"Point",coordinates:[(N=j[k],360*(N-.5)),Sr(j[k+1])]}};var N}function Jn(j,k,R){const N=j[k+5],Y=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N,Q=j[k+6],se=Q===-1?{}:Object.assign({},R[Q]);return Object.assign(se,{cluster:!0,cluster_id:j[k+3],point_count:N,point_count_abbreviated:Y})}function ti(j){return j/360+.5}function Yi(j){const k=Math.sin(j*Math.PI/180),R=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return R<0?0:R>1?1:R}function Sr(j){const k=(180-360*j)*Math.PI/180;return 360*Math.atan(Math.exp(k))/Math.PI-90}function Qn(j,k,R,N){for(var Y,Q=N,se=R-k>>1,re=R-k,V=j[k],J=j[k+1],be=j[R],xe=j[R+1],we=k+3;we<R;we+=3){var st=Ki(j[we],j[we+1],V,J,be,xe);if(st>Q)Y=we,Q=st;else if(st===Q){var ft=Math.abs(we-se);ft<re&&(Y=we,re=ft)}}Q>N&&(Y-k>3&&Qn(j,k,Y,N),j[Y+2]=Q,R-Y>3&&Qn(j,Y,R,N))}function Ki(j,k,R,N,Y,Q){var se=Y-R,re=Q-N;if(se!==0||re!==0){var V=((j-R)*se+(k-N)*re)/(se*se+re*re);V>1?(R=Y,N=Q):V>0&&(R+=se*V,N+=re*V)}return(se=j-R)*se+(re=k-N)*re}function Ji(j,k,R,N){var Y={id:j===void 0?null:j,type:k,geometry:R,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Q){var se=Q.geometry,re=Q.type;if(re==="Point"||re==="MultiPoint"||re==="LineString")yn(Q,se);else if(re==="Polygon"||re==="MultiLineString")for(var V=0;V<se.length;V++)yn(Q,se[V]);else if(re==="MultiPolygon")for(V=0;V<se.length;V++)for(var J=0;J<se[V].length;J++)yn(Q,se[V][J])}(Y),Y}function yn(j,k){for(var R=0;R<k.length;R+=3)j.minX=Math.min(j.minX,k[R]),j.minY=Math.min(j.minY,k[R+1]),j.maxX=Math.max(j.maxX,k[R]),j.maxY=Math.max(j.maxY,k[R+1])}function Ii(j,k,R,N){if(k.geometry){var Y=k.geometry.coordinates,Q=k.geometry.type,se=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2),re=[],V=k.id;if(R.promoteId?V=k.properties[R.promoteId]:R.generateId&&(V=N||0),Q==="Point")ye(Y,re);else if(Q==="MultiPoint")for(var J=0;J<Y.length;J++)ye(Y[J],re);else if(Q==="LineString")dr(Y,re,se,!1);else if(Q==="MultiLineString"){if(R.lineMetrics){for(J=0;J<Y.length;J++)dr(Y[J],re=[],se,!1),j.push(Ji(V,"LineString",re,k.properties));return}qi(Y,re,se,!1)}else if(Q==="Polygon")qi(Y,re,se,!0);else{if(Q!=="MultiPolygon"){if(Q==="GeometryCollection"){for(J=0;J<k.geometry.geometries.length;J++)Ii(j,{id:V,geometry:k.geometry.geometries[J],properties:k.properties},R,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(J=0;J<Y.length;J++){var be=[];qi(Y[J],be,se,!0),re.push(be)}}j.push(Ji(V,Q,re,k.properties))}}function ye(j,k){k.push(Dt(j[0])),k.push(It(j[1])),k.push(0)}function dr(j,k,R,N){for(var Y,Q,se=0,re=0;re<j.length;re++){var V=Dt(j[re][0]),J=It(j[re][1]);k.push(V),k.push(J),k.push(0),re>0&&(se+=N?(Y*J-V*Q)/2:Math.sqrt(Math.pow(V-Y,2)+Math.pow(J-Q,2))),Y=V,Q=J}var be=k.length-3;k[2]=1,Qn(k,0,be,R),k[be+2]=1,k.size=Math.abs(se),k.start=0,k.end=k.size}function qi(j,k,R,N){for(var Y=0;Y<j.length;Y++){var Q=[];dr(j[Y],Q,R,N),k.push(Q)}}function Dt(j){return j/360+.5}function It(j){var k=Math.sin(j*Math.PI/180),R=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return R<0?0:R>1?1:R}function gi(j,k,R,N,Y,Q,se,re){if(N/=k,Q>=(R/=k)&&se<N)return j;if(se<R||Q>=N)return null;for(var V=[],J=0;J<j.length;J++){var be=j[J],xe=be.geometry,we=be.type,st=Y===0?be.minX:be.minY,ft=Y===0?be.maxX:be.maxY;if(st>=R&&ft<N)V.push(be);else if(!(ft<R||st>=N)){var et=[];if(we==="Point"||we==="MultiPoint")Er(xe,et,R,N,Y);else if(we==="LineString")Ur(xe,et,R,N,Y,!1,re.lineMetrics);else if(we==="MultiLineString")ai(xe,et,R,N,Y,!1);else if(we==="Polygon")ai(xe,et,R,N,Y,!0);else if(we==="MultiPolygon")for(var ot=0;ot<xe.length;ot++){var gt=[];ai(xe[ot],gt,R,N,Y,!0),gt.length&&et.push(gt)}if(et.length){if(re.lineMetrics&&we==="LineString"){for(ot=0;ot<et.length;ot++)V.push(Ji(be.id,we,et[ot],be.tags));continue}we!=="LineString"&&we!=="MultiLineString"||(et.length===1?(we="LineString",et=et[0]):we="MultiLineString"),we!=="Point"&&we!=="MultiPoint"||(we=et.length===3?"Point":"MultiPoint"),V.push(Ji(be.id,we,et,be.tags))}}}return V.length?V:null}function Er(j,k,R,N,Y){for(var Q=0;Q<j.length;Q+=3){var se=j[Q+Y];se>=R&&se<=N&&(k.push(j[Q]),k.push(j[Q+1]),k.push(j[Q+2]))}}function Ur(j,k,R,N,Y,Q,se){for(var re,V,J=xn(j),be=Y===0?kn:Re,xe=j.start,we=0;we<j.length-3;we+=3){var st=j[we],ft=j[we+1],et=j[we+2],ot=j[we+3],gt=j[we+4],Et=Y===0?st:ft,xt=Y===0?ot:gt,Rt=!1;se&&(re=Math.sqrt(Math.pow(st-ot,2)+Math.pow(ft-gt,2))),Et<R?xt>R&&(V=be(J,st,ft,ot,gt,R),se&&(J.start=xe+re*V)):Et>N?xt<N&&(V=be(J,st,ft,ot,gt,N),se&&(J.start=xe+re*V)):er(J,st,ft,et),xt<R&&Et>=R&&(V=be(J,st,ft,ot,gt,R),Rt=!0),xt>N&&Et<=N&&(V=be(J,st,ft,ot,gt,N),Rt=!0),!Q&&Rt&&(se&&(J.end=xe+re*V),k.push(J),J=xn(j)),se&&(xe+=re)}var Ft=j.length-3;st=j[Ft],ft=j[Ft+1],et=j[Ft+2],(Et=Y===0?st:ft)>=R&&Et<=N&&er(J,st,ft,et),Ft=J.length-3,Q&&Ft>=3&&(J[Ft]!==J[0]||J[Ft+1]!==J[1])&&er(J,J[0],J[1],J[2]),J.length&&k.push(J)}function xn(j){var k=[];return k.size=j.size,k.start=j.start,k.end=j.end,k}function ai(j,k,R,N,Y,Q){for(var se=0;se<j.length;se++)Ur(j[se],k,R,N,Y,Q,!1)}function er(j,k,R,N){j.push(k),j.push(R),j.push(N)}function kn(j,k,R,N,Y,Q){var se=(Q-k)/(N-k);return j.push(Q),j.push(R+(Y-R)*se),j.push(1),se}function Re(j,k,R,N,Y,Q){var se=(Q-R)/(Y-R);return j.push(k+(N-k)*se),j.push(Q),j.push(1),se}function Gi(j,k){for(var R=[],N=0;N<j.length;N++){var Y,Q=j[N],se=Q.type;if(se==="Point"||se==="MultiPoint"||se==="LineString")Y=ii(Q.geometry,k);else if(se==="MultiLineString"||se==="Polygon"){Y=[];for(var re=0;re<Q.geometry.length;re++)Y.push(ii(Q.geometry[re],k))}else if(se==="MultiPolygon")for(Y=[],re=0;re<Q.geometry.length;re++){for(var V=[],J=0;J<Q.geometry[re].length;J++)V.push(ii(Q.geometry[re][J],k));Y.push(V)}R.push(Ji(Q.id,se,Y,Q.tags))}return R}function ii(j,k){var R=[];R.size=j.size,j.start!==void 0&&(R.start=j.start,R.end=j.end);for(var N=0;N<j.length;N+=3)R.push(j[N]+k,j[N+1],j[N+2]);return R}function cn(j,k){if(j.transformed)return j;var R,N,Y,Q=1<<j.z,se=j.x,re=j.y;for(R=0;R<j.features.length;R++){var V=j.features[R],J=V.geometry,be=V.type;if(V.geometry=[],be===1)for(N=0;N<J.length;N+=2)V.geometry.push(zn(J[N],J[N+1],k,Q,se,re));else for(N=0;N<J.length;N++){var xe=[];for(Y=0;Y<J[N].length;Y+=2)xe.push(zn(J[N][Y],J[N][Y+1],k,Q,se,re));V.geometry.push(xe)}}return j.transformed=!0,j}function zn(j,k,R,N,Y,Q){return[Math.round(R*(j*N-Y)),Math.round(R*(k*N-Q))]}function De(j,k,R,N,Y){for(var Q=k===Y.maxZoom?0:Y.tolerance/((1<<k)*Y.extent),se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:R,y:N,z:k,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},re=0;re<j.length;re++){se.numFeatures++,dt(se,j[re],Q,Y);var V=j[re].minX,J=j[re].minY,be=j[re].maxX,xe=j[re].maxY;V<se.minX&&(se.minX=V),J<se.minY&&(se.minY=J),be>se.maxX&&(se.maxX=be),xe>se.maxY&&(se.maxY=xe)}return se}function dt(j,k,R,N){var Y=k.geometry,Q=k.type,se=[];if(Q==="Point"||Q==="MultiPoint")for(var re=0;re<Y.length;re+=3)se.push(Y[re]),se.push(Y[re+1]),j.numPoints++,j.numSimplified++;else if(Q==="LineString")pt(se,Y,j,R,!1,!1);else if(Q==="MultiLineString"||Q==="Polygon")for(re=0;re<Y.length;re++)pt(se,Y[re],j,R,Q==="Polygon",re===0);else if(Q==="MultiPolygon")for(var V=0;V<Y.length;V++){var J=Y[V];for(re=0;re<J.length;re++)pt(se,J[re],j,R,!0,re===0)}if(se.length){var be=k.tags||null;if(Q==="LineString"&&N.lineMetrics){for(var xe in be={},k.tags)be[xe]=k.tags[xe];be.mapbox_clip_start=Y.start/Y.size,be.mapbox_clip_end=Y.end/Y.size}var we={geometry:se,type:Q==="Polygon"||Q==="MultiPolygon"?3:Q==="LineString"||Q==="MultiLineString"?2:1,tags:be};k.id!==null&&(we.id=k.id),j.features.push(we)}}function pt(j,k,R,N,Y,Q){var se=N*N;if(N>0&&k.size<(Y?se:N))R.numPoints+=k.length/3;else{for(var re=[],V=0;V<k.length;V+=3)(N===0||k[V+2]>se)&&(R.numSimplified++,re.push(k[V]),re.push(k[V+1])),R.numPoints++;Y&&function(J,be){for(var xe=0,we=0,st=J.length,ft=st-2;we<st;ft=we,we+=2)xe+=(J[we]-J[ft])*(J[we+1]+J[ft+1]);if(xe>0===be)for(we=0,st=J.length;we<st/2;we+=2){var et=J[we],ot=J[we+1];J[we]=J[st-2-we],J[we+1]=J[st-1-we],J[st-2-we]=et,J[st-1-we]=ot}}(re,Q),j.push(re)}}function jt(j,k){var R=(k=this.options=function(Y,Q){for(var se in Q)Y[se]=Q[se];return Y}(Object.create(this.options),k)).debug;if(R&&console.time("preprocess data"),k.maxZoom<0||k.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(k.promoteId&&k.generateId)throw new Error("promoteId and generateId cannot be used together.");var N=function(Y,Q){var se=[];if(Y.type==="FeatureCollection")for(var re=0;re<Y.features.length;re++)Ii(se,Y.features[re],Q,re);else Ii(se,Y.type==="Feature"?Y:{geometry:Y},Q);return se}(j,k);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",k.indexMaxZoom,k.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),N=function(Y,Q){var se=Q.buffer/Q.extent,re=Y,V=gi(Y,1,-1-se,se,0,-1,2,Q),J=gi(Y,1,1-se,2+se,0,-1,2,Q);return(V||J)&&(re=gi(Y,1,-se,1+se,0,-1,2,Q)||[],V&&(re=Gi(V,1).concat(re)),J&&(re=re.concat(Gi(J,-1)))),re}(N,k),N.length&&this.splitTile(N,0,0,0),R&&(N.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Qi(j,k,R){return 32*((1<<j)*R+k)+j}function rt(j,k){return k?j.properties[k]:j.id}function Zi(j,k){if(j==null)return!0;if(j.type==="Feature")return rt(j,k)!=null;if(j.type==="FeatureCollection"){const R=new Set;for(const N of j.features){const Y=rt(N,k);if(Y==null||R.has(Y))return!1;R.add(Y)}return!0}return!1}function Wi(j,k){const R=new Map;if(j!=null)if(j.type==="Feature")R.set(rt(j,k),j);else for(const N of j.features)R.set(rt(N,k),N);return R}function tr(j,k){const R=j.tileID.canonical;if(!this._geoJSONIndex)return k(null,null);const N=this._geoJSONIndex.getTile(R.z,R.x,R.y);if(!N)return k(null,null);const Y=new class{constructor(se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=se.length,this._features=se}feature(se){return new class{constructor(re){this._feature=re,this.extent=o.EXTENT,this.type=re.type,this.properties=re.tags,"id"in re&&!isNaN(re.id)&&(this.id=parseInt(re.id,10))}loadGeometry(){if(this._feature.type===1){const re=[];for(const V of this._feature.geometry)re.push([new o.Point(V[0],V[1])]);return re}{const re=[];for(const V of this._feature.geometry){const J=[];for(const be of V)J.push(new o.Point(be[0],be[1]));re.push(J)}return re}}toGeoJSON(re,V,J){return Xe.call(this,re,V,J)}}(this._features[se])}}(N.features);let Q=Cn(Y);Q.byteOffset===0&&Q.byteLength===Q.buffer.byteLength||(Q=new Uint8Array(Q)),k(null,{vectorTile:Y,rawData:Q.buffer})}jt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},jt.prototype.splitTile=function(j,k,R,N,Y,Q,se){for(var re=[j,k,R,N],V=this.options,J=V.debug;re.length;){N=re.pop(),R=re.pop(),k=re.pop(),j=re.pop();var be=1<<k,xe=Qi(k,R,N),we=this.tiles[xe];if(!we&&(J>1&&console.time("creation"),we=this.tiles[xe]=De(j,k,R,N,V),this.tileCoords.push({z:k,x:R,y:N}),J)){J>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",k,R,N,we.numFeatures,we.numPoints,we.numSimplified),console.timeEnd("creation"));var st="z"+k;this.stats[st]=(this.stats[st]||0)+1,this.total++}if(we.source=j,Y){if(k===V.maxZoom||k===Y)continue;var ft=1<<Y-k;if(R!==Math.floor(Q/ft)||N!==Math.floor(se/ft))continue}else if(k===V.indexMaxZoom||we.numPoints<=V.indexMaxPoints)continue;if(we.source=null,j.length!==0){J>1&&console.time("clipping");var et,ot,gt,Et,xt,Rt,Ft=.5*V.buffer/V.extent,Kt=.5-Ft,ni=.5+Ft,yi=1+Ft;et=ot=gt=Et=null,xt=gi(j,be,R-Ft,R+ni,0,we.minX,we.maxX,V),Rt=gi(j,be,R+Kt,R+yi,0,we.minX,we.maxX,V),j=null,xt&&(et=gi(xt,be,N-Ft,N+ni,1,we.minY,we.maxY,V),ot=gi(xt,be,N+Kt,N+yi,1,we.minY,we.maxY,V),xt=null),Rt&&(gt=gi(Rt,be,N-Ft,N+ni,1,we.minY,we.maxY,V),Et=gi(Rt,be,N+Kt,N+yi,1,we.minY,we.maxY,V),Rt=null),J>1&&console.timeEnd("clipping"),re.push(et||[],k+1,2*R,2*N),re.push(ot||[],k+1,2*R,2*N+1),re.push(gt||[],k+1,2*R+1,2*N),re.push(Et||[],k+1,2*R+1,2*N+1)}}},jt.prototype.getTile=function(j,k,R){var N=this.options,Y=N.extent,Q=N.debug;if(j<0||j>24)return null;var se=1<<j,re=Qi(j,k=(k%se+se)%se,R);if(this.tiles[re])return cn(this.tiles[re],Y);Q>1&&console.log("drilling down to z%d-%d-%d",j,k,R);for(var V,J=j,be=k,xe=R;!V&&J>0;)J--,be=Math.floor(be/2),xe=Math.floor(xe/2),V=this.tiles[Qi(J,be,xe)];return V&&V.source?(Q>1&&console.log("found parent tile z%d-%d-%d",J,be,xe),Q>1&&console.time("drilling down"),this.splitTile(V.source,J,be,xe,j,k,R),Q>1&&console.timeEnd("drilling down"),this.tiles[re]?cn(this.tiles[re],Y):null):null};class ir extends he{constructor(k,R,N,Y){super(k,R,N,tr),this._dataUpdateable=new Map,this.loadGeoJSON=(Q,se)=>{const{promoteId:re}=Q;if(Q.request)return o.getJSON(Q.request,(V,J,be,xe)=>{this._dataUpdateable=Zi(J,re)?Wi(J,re):void 0,se(V,J,be,xe)});if(typeof Q.data=="string")try{const V=JSON.parse(Q.data);this._dataUpdateable=Zi(V,re)?Wi(V,re):void 0,se(null,V)}catch{se(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`))}else Q.dataDiff?this._dataUpdateable?(function(V,J,be){var xe,we,st,ft;if(J.removeAll&&V.clear(),J.remove)for(const et of J.remove)V.delete(et);if(J.add)for(const et of J.add){const ot=rt(et,be);ot!=null&&V.set(ot,et)}if(J.update)for(const et of J.update){let ot=V.get(et.id);if(ot==null)continue;const gt=!et.removeAllProperties&&(((xe=et.removeProperties)===null||xe===void 0?void 0:xe.length)>0||((we=et.addOrUpdateProperties)===null||we===void 0?void 0:we.length)>0);if((et.newGeometry||et.removeAllProperties||gt)&&(ot={...ot},V.set(et.id,ot),gt&&(ot.properties={...ot.properties})),et.newGeometry&&(ot.geometry=et.newGeometry),et.removeAllProperties)ot.properties={};else if(((st=et.removeProperties)===null||st===void 0?void 0:st.length)>0)for(const Et of et.removeProperties)Object.prototype.hasOwnProperty.call(ot.properties,Et)&&delete ot.properties[Et];if(((ft=et.addOrUpdateProperties)===null||ft===void 0?void 0:ft.length)>0)for(const{key:Et,value:xt}of et.addOrUpdateProperties)ot.properties[Et]=xt}}(this._dataUpdateable,Q.dataDiff,re),se(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):se(new Error(`Cannot update existing geojson data in ${Q.source}`)):se(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},Y&&(this.loadGeoJSON=Y)}loadData(k,R){var N;(N=this._pendingRequest)===null||N===void 0||N.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const Y=!!(k&&k.request&&k.request.collectResourceTiming)&&new o.RequestPerformance(k.request);this._pendingCallback=R,this._pendingRequest=this.loadGeoJSON(k,(Q,se)=>{if(delete this._pendingCallback,delete this._pendingRequest,Q||!se)return R(Q);if(typeof se!="object")return R(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`));{Se(se,!0);try{if(k.filter){const V=o.createExpression(k.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(V.result==="error")throw new Error(V.value.map(be=>`${be.key}: ${be.message}`).join(", "));se={type:"FeatureCollection",features:se.features.filter(be=>V.value.evaluate({zoom:0},be))}}this._geoJSONIndex=k.cluster?new Bi(function({superclusterOptions:V,clusterProperties:J}){if(!J||!V)return V;const be={},xe={},we={accumulated:null,zoom:0},st={properties:null},ft=Object.keys(J);for(const et of ft){const[ot,gt]=J[et],Et=o.createExpression(gt),xt=o.createExpression(typeof ot=="string"?[ot,["accumulated"],["get",et]]:ot);be[et]=Et.value,xe[et]=xt.value}return V.map=et=>{st.properties=et;const ot={};for(const gt of ft)ot[gt]=be[gt].evaluate(we,st);return ot},V.reduce=(et,ot)=>{st.properties=ot;for(const gt of ft)we.accumulated=et[gt],et[gt]=xe[gt].evaluate(we,st)},V}(k)).load(se.features):function(V,J){return new jt(V,J)}(se,k.geojsonVtOptions)}catch(V){return R(V)}this.loaded={};const re={};if(Y){const V=Y.finish();V&&(re.resourceTiming={},re.resourceTiming[k.source]=JSON.parse(JSON.stringify(V)))}R(null,re)}})}reloadTile(k,R){const N=this.loaded;return N&&N[k.uid]?super.reloadTile(k,R):this.loadTile(k,R)}removeSource(k,R){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),R()}getClusterExpansionZoom(k,R){try{R(null,this._geoJSONIndex.getClusterExpansionZoom(k.clusterId))}catch(N){R(N)}}getClusterChildren(k,R){try{R(null,this._geoJSONIndex.getChildren(k.clusterId))}catch(N){R(N)}}getClusterLeaves(k,R){try{R(null,this._geoJSONIndex.getLeaves(k.clusterId,k.limit,k.offset))}catch(N){R(N)}}}class _i{constructor(k){this.self=k,this.actor=new o.Actor(k,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:he,geojson:ir},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(R,N)=>{if(this.workerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.workerSourceTypes[R]=N},this.self.registerRTLTextPlugin=R=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=R.applyArabicShaping,o.plugin.processBidirectionalText=R.processBidirectionalText,o.plugin.processStyledBidirectionalText=R.processStyledBidirectionalText}}setReferrer(k,R){this.referrer=R}setImages(k,R,N){this.availableImages[k]=R;for(const Y in this.workerSources[k]){const Q=this.workerSources[k][Y];for(const se in Q)Q[se].availableImages=R}N()}setLayers(k,R,N){this.getLayerIndex(k).replace(R),N()}updateLayers(k,R,N){this.getLayerIndex(k).update(R.layers,R.removedIds),N()}loadTile(k,R,N){this.getWorkerSource(k,R.type,R.source).loadTile(R,N)}loadDEMTile(k,R,N){this.getDEMWorkerSource(k,R.source).loadTile(R,N)}reloadTile(k,R,N){this.getWorkerSource(k,R.type,R.source).reloadTile(R,N)}abortTile(k,R,N){this.getWorkerSource(k,R.type,R.source).abortTile(R,N)}removeTile(k,R,N){this.getWorkerSource(k,R.type,R.source).removeTile(R,N)}removeDEMTile(k,R){this.getDEMWorkerSource(k,R.source).removeTile(R)}removeSource(k,R,N){if(!this.workerSources[k]||!this.workerSources[k][R.type]||!this.workerSources[k][R.type][R.source])return;const Y=this.workerSources[k][R.type][R.source];delete this.workerSources[k][R.type][R.source],Y.removeSource!==void 0?Y.removeSource(R,N):N()}loadWorkerSource(k,R,N){try{this.self.importScripts(R.url),N()}catch(Y){N(Y.toString())}}syncRTLPluginState(k,R,N){try{o.plugin.setState(R);const Y=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&Y!=null){this.self.importScripts(Y);const Q=o.plugin.isParsed();N(Q?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Y}`),Q)}}catch(Y){N(Y.toString())}}getAvailableImages(k){let R=this.availableImages[k];return R||(R=[]),R}getLayerIndex(k){let R=this.layerIndexes[k];return R||(R=this.layerIndexes[k]=new U),R}getWorkerSource(k,R,N){if(this.workerSources[k]||(this.workerSources[k]={}),this.workerSources[k][R]||(this.workerSources[k][R]={}),!this.workerSources[k][R][N]){const Y={send:(Q,se,re)=>{this.actor.send(Q,se,re,k)}};this.workerSources[k][R][N]=new this.workerSourceTypes[R](Y,this.getLayerIndex(k),this.getAvailableImages(k))}return this.workerSources[k][R][N]}getDEMWorkerSource(k,R){return this.demWorkerSources[k]||(this.demWorkerSources[k]={}),this.demWorkerSources[k][R]||(this.demWorkerSources[k][R]=new _e),this.demWorkerSources[k][R]}}return o.isWorker()&&(self.worker=new _i(self)),_i}),S(["./shared"],function(o){var U="3.0.0";class z{static testProp(t){if(!z.docStyle)return t[0];for(let r=0;r<t.length;r++)if(t[r]in z.docStyle)return t[r];return t[0]}static create(t,r,a){const u=window.document.createElement(t);return r!==void 0&&(u.className=r),a&&a.appendChild(u),u}static createNS(t,r){return window.document.createElementNS(t,r)}static disableDrag(){z.docStyle&&z.selectProp&&(z.userSelect=z.docStyle[z.selectProp],z.docStyle[z.selectProp]="none")}static enableDrag(){z.docStyle&&z.selectProp&&(z.docStyle[z.selectProp]=z.userSelect)}static setTransform(t,r){t.style[z.transformProp]=r}static addEventListener(t,r,a,u={}){t.addEventListener(r,a,"passive"in u?u:u.capture)}static removeEventListener(t,r,a,u={}){t.removeEventListener(r,a,"passive"in u?u:u.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",z.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",z.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",z.suppressClickInternal,!0)},0)}static mousePos(t,r){const a=t.getBoundingClientRect();return new o.Point(r.clientX-a.left-t.clientLeft,r.clientY-a.top-t.clientTop)}static touchPos(t,r){const a=t.getBoundingClientRect(),u=[];for(let d=0;d<r.length;d++)u.push(new o.Point(r[d].clientX-a.left-t.clientLeft,r[d].clientY-a.top-t.clientTop));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}z.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,z.selectProp=z.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),z.transformProp=z.testProp(["transform","WebkitTransform"]);const ie={supported:!1,testSupport:function(l){!he&&ae&&(_e?Pe(l):W=l)}};let W,ae,he=!1,_e=!1;function Pe(l){const t=l.createTexture();l.bindTexture(l.TEXTURE_2D,t);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,ae),l.isContextLost())return;ie.supported=!0}catch{}l.deleteTexture(t),he=!0}var je;typeof document<"u"&&(ae=document.createElement("img"),ae.onload=function(){W&&Pe(W),W=null,_e=!0},ae.onerror=function(){he=!0,W=null},ae.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(l){let t,r,a,u;l.resetRequestQueue=()=>{t=[],r=0,a=0,u={}},l.addThrottleControl=T=>{const M=a++;return u[M]=T,M},l.removeThrottleControl=T=>{delete u[T],b()},l.getImage=(T,M,A=!0)=>{ie.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*");const F={requestParameters:T,supportImageRefresh:A,callback:M,cancelled:!1,completed:!1,cancel:()=>{F.completed||F.cancelled||(F.cancelled=!0,F.innerRequest&&(F.innerRequest.cancel(),r--),b())}};return t.push(F),b(),F};const d=T=>{const{requestParameters:M,supportImageRefresh:A,callback:F}=T;return o.extend(M,{type:"image"}),(A!==!1||o.isWorker()||o.getProtocolAction(M.url)||M.headers&&!Object.keys(M.headers).reduce((Z,$)=>Z&&$==="accept",!0)?o.makeRequest:v)(M,(Z,$,G,K)=>{g(T,F,Z,$,G,K)})},g=(T,M,A,F,Z,$)=>{A?M(A):F instanceof HTMLImageElement||F instanceof ImageBitmap?M(null,F):F&&((G,K)=>{typeof createImageBitmap=="function"?o.arrayBufferToImageBitmap(G,K):o.arrayBufferToImage(G,K)})(F,(G,K)=>{G!=null?M(G):K!=null&&M(null,K,{cacheControl:Z,expires:$})}),T.cancelled||(T.completed=!0,r--,b())},b=()=>{const T=(()=>{const M=Object.keys(u);let A=!1;if(M.length>0){for(const F of M)if(A=u[F](),A)break}return A})()?o.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let M=r;M<T&&t.length>0;M++){const A=t.shift();if(A.cancelled){M--;continue}const F=d(A);r++,A.innerRequest=F}},v=(T,M)=>{const A=new Image,F=T.url;let Z=!1;const $=T.credentials;return $&&$==="include"?A.crossOrigin="use-credentials":($&&$==="same-origin"||!o.sameOrigin(F))&&(A.crossOrigin="anonymous"),A.fetchPriority="high",A.onload=()=>{M(null,A),A.onerror=A.onload=null},A.onerror=()=>{Z||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),A.onerror=A.onload=null},A.src=F,{cancel:()=>{Z=!0,A.src=""}}}}(je||(je={})),je.resetRequestQueue();var Se,Xe=je;(function(l){l.Glyphs="Glyphs",l.Image="Image",l.Source="Source",l.SpriteImage="SpriteImage",l.SpriteJSON="SpriteJSON",l.Style="Style",l.Tile="Tile",l.Unknown="Unknown"})(Se||(Se={}));class ze{constructor(t){this._transformRequestFn=t}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeSpriteURL(t,r,a){const u=function(d){const g=d.match(qe);if(!g)throw new Error(`Unable to parse URL "${d}"`);return{protocol:g[1],authority:g[2],path:g[3]||"/",params:g[4]?g[4].split("&"):[]}}(t);return u.path+=`${r}${a}`,function(d){const g=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${g}`}(u)}setTransformRequest(t){this._transformRequestFn=t}}const qe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function nt(l){var t=new o.ARRAY_TYPE(3);return t[0]=l[0],t[1]=l[1],t[2]=l[2],t}var Ee,Qe=function(l,t,r){return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],l};Ee=new o.ARRAY_TYPE(3),o.ARRAY_TYPE!=Float32Array&&(Ee[0]=0,Ee[1]=0,Ee[2]=0);var ht=function(l){var t=l[0],r=l[1];return t*t+r*r};function At(l){const t=[];if(typeof l=="string")t.push({id:"default",url:l});else if(l&&l.length>0){const r=[];for(const{id:a,url:u}of l){const d=`${a}${u}`;r.indexOf(d)===-1&&(r.push(d),t.push({id:a,url:u}))}}return t}function Wt(l,t,r,a,u){if(a)return void l(a);if(u!==Object.values(t).length||u!==Object.values(r).length)return;const d={};for(const g in t){d[g]={};const b=o.exported.getImageCanvasContext(r[g]),v=t[g];for(const T in v){const{width:M,height:A,x:F,y:Z,sdf:$,pixelRatio:G,stretchX:K,stretchY:te,content:ue}=v[T];d[g][T]={data:null,pixelRatio:G,sdf:$,stretchX:K,stretchY:te,content:ue,spriteData:{width:M,height:A,x:F,y:Z,context:b}}}}l(null,d)}(function(){var l=new o.ARRAY_TYPE(2);o.ARRAY_TYPE!=Float32Array&&(l[0]=0,l[1]=0)})();class yt{constructor(t,r,a,u){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(r,u)}update(t,r,a){const{width:u,height:d}=t,g=!(this.size&&this.size[0]===u&&this.size[1]===d||a),{context:b}=this,{gl:v}=b;if(this.useMipmap=!!(r&&r.useMipmap),v.bindTexture(v.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!r||r.premultiply!==!1)),g)this.size=[u,d],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.isImageBitmap(t)?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,t):v.texImage2D(v.TEXTURE_2D,0,this.format,u,d,0,this.format,v.UNSIGNED_BYTE,t.data);else{const{x:T,y:M}=a||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.isImageBitmap(t)?v.texSubImage2D(v.TEXTURE_2D,0,T,M,v.RGBA,v.UNSIGNED_BYTE,t):v.texSubImage2D(v.TEXTURE_2D,0,T,M,u,d,v.RGBA,v.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&v.generateMipmap(v.TEXTURE_2D)}bind(t,r,a){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),a!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=d.LINEAR),t!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a||t),this.filter=t),r!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function fi(l){const{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ht extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:r,callback:a}of this.requestors)this._notify(r,a);this.requestors=[]}}getImage(t){const r=this.images[t];if(r&&!r.data&&r.spriteData){const a=r.spriteData;r.data=new o.RGBAImage({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),r.spriteData=null}return r}addImage(t,r){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,r)&&(this.images[t]=r)}_validate(t,r){let a=!0;const u=r.data||r.spriteData;return this._validateStretch(r.stretchX,u&&u.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),a=!1),this._validateStretch(r.stretchY,u&&u.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),a=!1),this._validateContent(r.content,r)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),a=!1),a}_validateStretch(t,r){if(!t)return!0;let a=0;for(const u of t){if(u[0]<a||u[1]<u[0]||r<u[1])return!1;a=u[1]}return!0}_validateContent(t,r){if(!t)return!0;if(t.length!==4)return!1;const a=r.spriteData,u=a&&a.width||r.data.width,d=a&&a.height||r.data.height;return!(t[0]<0||u<t[0]||t[1]<0||d<t[1]||t[2]<0||u<t[2]||t[3]<0||d<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,r,a=!0){const u=this.getImage(t);if(a&&(u.data.width!==r.data.width||u.data.height!==r.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=u.version+1,this.images[t]=r,this.updatedImages[t]=!0}removeImage(t){const r=this.images[t];delete this.images[t],delete this.patterns[t],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,r){let a=!0;if(!this.isLoaded())for(const u of t)this.images[u]||(a=!1);this.isLoaded()||a?this._notify(t,r):this.requestors.push({ids:t,callback:r})}_notify(t,r){const a={};for(const u of t){let d=this.getImage(u);d||(this.fire(new o.Event("styleimagemissing",{id:u})),d=this.getImage(u)),d?a[u]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:o.warnOnce(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,a)}getPixelSize(){const{width:t,height:r}=this.atlasImage;return{width:t,height:r}}getPattern(t){const r=this.patterns[t],a=this.getImage(t);if(!a)return null;if(r&&r.position.version===a.version)return r.position;if(r)r.position.version=a.version;else{const u={w:a.data.width+2,h:a.data.height+2,x:0,y:0},d=new o.ImagePosition(u,a);this.patterns[t]={bin:u,position:d}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const r=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new yt(t,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const d in this.patterns)t.push(this.patterns[d].bin);const{w:r,h:a}=o.potpack(t),u=this.atlasImage;u.resize({width:r||1,height:a||1});for(const d in this.patterns){const{bin:g}=this.patterns[d],b=g.x+1,v=g.y+1,T=this.getImage(d).data,M=T.width,A=T.height;o.RGBAImage.copy(T,u,{x:0,y:0},{x:b,y:v},{width:M,height:A}),o.RGBAImage.copy(T,u,{x:0,y:A-1},{x:b,y:v-1},{width:M,height:1}),o.RGBAImage.copy(T,u,{x:0,y:0},{x:b,y:v+A},{width:M,height:1}),o.RGBAImage.copy(T,u,{x:M-1,y:0},{x:b-1,y:v},{width:1,height:A}),o.RGBAImage.copy(T,u,{x:0,y:0},{x:b+M,y:v},{width:1,height:A})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const r of t){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const a=this.getImage(r);a||o.warnOnce(`Image with ID: "${r}" was not found`),fi(a)&&this.updateImage(r,a)}}}const Si=1e20;function mi(l,t,r,a,u,d,g,b,v){for(let T=t;T<t+a;T++)Tt(l,r*d+T,d,u,g,b,v);for(let T=r;T<r+u;T++)Tt(l,T*d+t,1,a,g,b,v)}function Tt(l,t,r,a,u,d,g){d[0]=0,g[0]=-Si,g[1]=Si,u[0]=l[t];for(let b=1,v=0,T=0;b<a;b++){u[b]=l[t+b*r];const M=b*b;do{const A=d[v];T=(u[b]-u[A]+M-A*A)/(b-A)/2}while(T<=g[v]&&--v>-1);v++,d[v]=b,g[v]=T,g[v+1]=Si}for(let b=0,v=0;b<a;b++){for(;g[v+1]<b;)v++;const T=d[v],M=b-T;l[t+b*r]=u[T]+M*M}}class Vt{constructor(t,r){this.requestManager=t,this.localIdeographFontFamily=r,this.entries={}}setURL(t){this.url=t}getGlyphs(t,r){const a=[];for(const u in t)for(const d of t[u])a.push({stack:u,id:d});o.asyncAll(a,({stack:u,id:d},g)=>{let b=this.entries[u];b||(b=this.entries[u]={glyphs:{},requests:{},ranges:{}});let v=b.glyphs[d];if(v!==void 0)return void g(null,{stack:u,id:d,glyph:v});if(v=this._tinySDF(b,u,d),v)return b.glyphs[d]=v,void g(null,{stack:u,id:d,glyph:v});const T=Math.floor(d/256);if(256*T>65535)return void g(new Error("glyphs > 65535 not supported"));if(b.ranges[T])return void g(null,{stack:u,id:d,glyph:v});if(!this.url)return void g(new Error("glyphsUrl is not set"));let M=b.requests[T];M||(M=b.requests[T]=[],Vt.loadGlyphRange(u,T,this.url,this.requestManager,(A,F)=>{if(F){for(const Z in F)this._doesCharSupportLocalGlyph(+Z)||(b.glyphs[+Z]=F[+Z]);b.ranges[T]=!0}for(const Z of M)Z(A,F);delete b.requests[T]})),M.push((A,F)=>{A?g(A):F&&g(null,{stack:u,id:d,glyph:F[d]||null})})},(u,d)=>{if(u)r(u);else if(d){const g={};for(const{stack:b,id:v,glyph:T}of d)(g[b]||(g[b]={}))[v]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};r(null,g)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(o.unicodeBlockLookup["CJK Unified Ideographs"](t)||o.unicodeBlockLookup["Hangul Syllables"](t)||o.unicodeBlockLookup.Hiragana(t)||o.unicodeBlockLookup.Katakana(t))}_tinySDF(t,r,a){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let d=t.tinySDF;if(!d){let b="400";/bold/i.test(r)?b="900":/medium/i.test(r)?b="500":/light/i.test(r)&&(b="200"),d=t.tinySDF=new Vt.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:u,fontWeight:b})}const g=d.draw(String.fromCharCode(a));return{id:a,bitmap:new o.AlphaImage({width:g.width||30,height:g.height||30},g.data),metrics:{width:g.glyphWidth||24,height:g.glyphHeight||24,left:g.glyphLeft||0,top:g.glyphTop-27||-8,advance:g.glyphAdvance||24}}}}Vt.loadGlyphRange=function(l,t,r,a,u){const d=256*t,g=d+255,b=a.transformRequest(r.replace("{fontstack}",l).replace("{range}",`${d}-${g}`),Se.Glyphs);o.getArrayBuffer(b,(v,T)=>{if(v)u(v);else if(T){const M={};for(const A of o.parseGlyphPbf(T))M[A.id]=A;u(null,M)}})},Vt.TinySDF=class{constructor({fontSize:l=24,buffer:t=3,radius:r=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:d="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=r;const b=this.size=l+4*t,v=this._createCanvas(b),T=this.ctx=v.getContext("2d",{willReadFrequently:!0});T.font=`${g} ${d} ${l}px ${u}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(l){const t=document.createElement("canvas");return t.width=t.height=l,t}draw(l){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:d}=this.ctx.measureText(l),g=Math.ceil(r),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-u))),v=Math.min(this.size-this.buffer,g+Math.ceil(a)),T=b+2*this.buffer,M=v+2*this.buffer,A=Math.max(T*M,0),F=new Uint8ClampedArray(A),Z={data:F,width:T,height:M,glyphWidth:b,glyphHeight:v,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(b===0||v===0)return Z;const{ctx:$,buffer:G,gridInner:K,gridOuter:te}=this;$.clearRect(G,G,b,v),$.fillText(l,G,G+g);const ue=$.getImageData(G,G,b,v);te.fill(Si,0,A),K.fill(0,0,A);for(let X=0;X<v;X++)for(let ce=0;ce<b;ce++){const ge=ue.data[4*(X*b+ce)+3]/255;if(ge===0)continue;const Te=(X+G)*T+ce+G;if(ge===1)te[Te]=0,K[Te]=Si;else{const Me=.5-ge;te[Te]=Me>0?Me*Me:0,K[Te]=Me<0?Me*Me:0}}mi(te,0,0,T,M,T,this.f,this.v,this.z),mi(K,G,G,b,v,T,this.f,this.v,this.z);for(let X=0;X<A;X++){const ce=Math.sqrt(te[X])-Math.sqrt(K[X]);F[X]=Math.round(255-255*(ce/this.radius+this.cutoff))}return Z}};class Ri{constructor(){this.specification=o.v8Spec.light.position}possiblyEvaluate(t,r){return o.sphericalToCartesian(t.expression.evaluate(r))}interpolate(t,r,a){return{x:o.interpolate.number(t.x,r.x,a),y:o.interpolate.number(t.y,r.y,a),z:o.interpolate.number(t.z,r.z,a)}}}const Cn="-transition";let Pn,Ei;class oi extends o.Evented{constructor(t){super(),Pn=Pn||new o.Properties({anchor:new o.DataConstantProperty(o.v8Spec.light.anchor),position:new Ri,color:new o.DataConstantProperty(o.v8Spec.light.color),intensity:new o.DataConstantProperty(o.v8Spec.light.intensity)}),this._transitionable=new o.Transitionable(Pn),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r={}){if(!this._validate(o.validateLight,t,r))for(const a in t){const u=t[a];a.endsWith(Cn)?this._transitionable.setTransition(a.slice(0,-Cn.length),u):this._transitionable.setValue(a,u)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,a){return(!a||a.validate!==!1)&&o.emitValidationErrors(this,t.call(o.validateStyle,o.extend({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.v8Spec})))}}class Bi{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,r){const a=t.join(",")+String(r);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(t,r)),this.dashEntry[a]}getDashRanges(t,r,a){const u=[];let d=t.length%2==1?-t[t.length-1]*a:0,g=t[0]*a,b=!0;u.push({left:d,right:g,isDash:b,zeroLength:t[0]===0});let v=t[0];for(let T=1;T<t.length;T++){b=!b;const M=t[T];d=v*a,v+=M,g=v*a,u.push({left:d,right:g,isDash:b,zeroLength:M===0})}return u}addRoundDash(t,r,a){const u=r/2;for(let d=-a;d<=a;d++){const g=this.width*(this.nextRow+a+d);let b=0,v=t[b];for(let T=0;T<this.width;T++){T/v.right>1&&(v=t[++b]);const M=Math.abs(T-v.left),A=Math.abs(T-v.right),F=Math.min(M,A);let Z;const $=d/a*(u+1);if(v.isDash){const G=u-Math.abs($);Z=Math.sqrt(F*F+G*G)}else Z=u-Math.sqrt(F*F+$*$);this.data[g+T]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(t){for(let b=t.length-1;b>=0;--b){const v=t[b],T=t[b+1];v.zeroLength?t.splice(b,1):T&&T.isDash===v.isDash&&(T.left=v.left,t.splice(b,1))}const r=t[0],a=t[t.length-1];r.isDash===a.isDash&&(r.left=a.left-this.width,a.right=r.right+this.width);const u=this.width*this.nextRow;let d=0,g=t[d];for(let b=0;b<this.width;b++){b/g.right>1&&(g=t[++d]);const v=Math.abs(b-g.left),T=Math.abs(b-g.right),M=Math.min(v,T);this.data[u+b]=Math.max(0,Math.min(255,(g.isDash?M:-M)+128))}}addDash(t,r){const a=r?7:0,u=2*a+1;if(this.nextRow+u>this.height)return o.warnOnce("LineAtlas out of space"),null;let d=0;for(let b=0;b<t.length;b++)d+=t[b];if(d!==0){const b=this.width/d,v=this.getDashRanges(t,this.width,b);r?this.addRoundDash(v,b,a):this.addRegularDash(v)}const g={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:d};return this.nextRow+=u,this.dirty=!0,g}bind(t){const r=t.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}class Mt{constructor(t,r,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const u=this.workerPool.acquire(a);for(let d=0;d<u.length;d++){const g=new Mt.Actor(u[d],r,a);g.name=`Worker ${d}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,r,a){o.asyncAll(this.actors,(u,d)=>{u.send(t,r,d)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function Jn(l,t,r){const a=function(u,d){if(u)return r(u);if(d){const g=o.pick(o.extend(d,l),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(g.vectorLayers=d.vector_layers,g.vectorLayerIds=g.vectorLayers.map(b=>b.id)),r(null,g)}};return l.url?o.getJSON(t.transformRequest(l.url,Se.Source),a):o.exported.frame(()=>a(null,l))}Mt.Actor=o.Actor;class ti{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof o.LngLat?new o.LngLat(t.lng,t.lat):o.LngLat.convert(t),this}setSouthWest(t){return this._sw=t instanceof o.LngLat?new o.LngLat(t.lng,t.lat):o.LngLat.convert(t),this}extend(t){const r=this._sw,a=this._ne;let u,d;if(t instanceof o.LngLat)u=t,d=t;else{if(!(t instanceof ti))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ti.convert(t)):this.extend(o.LngLat.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(o.LngLat.convert(t)):this;if(u=t._sw,d=t._ne,!u||!d)return this}return r||a?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new o.LngLat(u.lng,u.lat),this._ne=new o.LngLat(d.lng,d.lat)),this}getCenter(){return new o.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new o.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:a}=o.LngLat.convert(t);let u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(t){return t instanceof ti?t:t&&new ti(t)}static fromLngLat(t,r=0){const a=360*r/40075017,u=a/Math.cos(Math.PI/180*t.lat);return new ti(new o.LngLat(t.lng-u,t.lat-a),new o.LngLat(t.lng+u,t.lat+a))}}class Yi{constructor(t,r,a){this.bounds=ti.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=a||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),a=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*r),u=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*r),d=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*r),g=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*r);return t.x>=a&&t.x<d&&t.y>=u&&t.y<g}}class Sr extends o.Evented{constructor(t,r,a,u){if(super(),this.id=t,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(r,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Jn(this._options,this.map._requestManager,(t,r)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new o.ErrorEvent(t)):r&&(o.extend(this,r),r.bounds&&(this.tileBounds=new Yi(r.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(t,r){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(a,Se.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function d(g,b){return delete t.request,t.aborted?r(null):g&&g.status!==404?r(g):(b&&b.resourceTiming&&(t.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&b&&t.setExpiryData(b),t.loadVectorData(b,this.map.painter),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}u.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",u,d.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",u,d.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Qn extends o.Evented{constructor(t,r,a,u){super(),this.id=t,this.dispatcher=a,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},r),o.extend(this,o.pick(r,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Jn(this._options,this.map._requestManager,(t,r)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new o.ErrorEvent(t)):r&&(o.extend(this,r),r.bounds&&(this.tileBounds=new Yi(r.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=Xe.getImage(this.map._requestManager.transformRequest(a,Se.Tile),(u,d,g)=>{if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(u)t.state="errored",r(u);else if(d){this.map._refreshExpiredTiles&&g&&t.setExpiryData(g);const b=this.map.painter.context,v=b.gl;t.texture=this.map.painter.getTileTexture(d.width),t.texture?t.texture.update(d,{useMipmap:!0}):(t.texture=new yt(b,d,v.RGBA,{useMipmap:!0}),t.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),b.extTextureFilterAnisotropic&&v.texParameterf(v.TEXTURE_2D,b.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b.extTextureFilterAnisotropicMax)),t.state="loaded",r(null)}},this.map._refreshExpiredTiles)}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r()}unloadTile(t,r){t.texture&&this.map.painter.saveTileTexture(t.texture),r()}hasTransition(){return!1}}class Ki extends Qn{constructor(t,r,a,u){super(t,r,a,u),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,r){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function u(d,g){d&&(t.state="errored",r(d)),g&&(t.dem=g,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",r(null))}t.request=Xe.getImage(this.map._requestManager.transformRequest(a,Se.Tile),function(d,g){if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(d)t.state="errored",r(d);else if(g){this.map._refreshExpiredTiles&&t.setExpiryData(g),delete g.cacheControl,delete g.expires;const b=o.isImageBitmap(g)&&(Ei==null&&(Ei=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ei)?g:o.exported.getImageData(g,1),v={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:b,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",v,u.bind(this)))}}.bind(this),this.map._refreshExpiredTiles),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const r=t.canonical,a=Math.pow(2,r.z),u=(r.x-1+a)%a,d=r.x===0?t.wrap-1:t.wrap,g=(r.x+1+a)%a,b=r.x+1===a?t.wrap+1:t.wrap,v={};return v[new o.OverscaledTileID(t.overscaledZ,d,r.z,u,r.y).key]={backfilled:!1},v[new o.OverscaledTileID(t.overscaledZ,b,r.z,g,r.y).key]={backfilled:!1},r.y>0&&(v[new o.OverscaledTileID(t.overscaledZ,d,r.z,u,r.y-1).key]={backfilled:!1},v[new o.OverscaledTileID(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},v[new o.OverscaledTileID(t.overscaledZ,b,r.z,g,r.y-1).key]={backfilled:!1}),r.y+1<a&&(v[new o.OverscaledTileID(t.overscaledZ,d,r.z,u,r.y+1).key]={backfilled:!1},v[new o.OverscaledTileID(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},v[new o.OverscaledTileID(t.overscaledZ,b,r.z,g,r.y+1).key]={backfilled:!1}),v}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Ji extends o.Evented{constructor(t,r,a,u){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(u),this._data=r.data,this._options=o.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const d=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*d,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*d,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.EXTENT,radius:(r.clusterRadius||50)*d,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){this._updateWorkerData()}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},r),this}getClusterChildren(t,r){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},r),this}getClusterLeaves(t,r,a,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:r,offset:a},u),this}_updateWorkerData(t){const r=o.extend({},this.workerOptions);t?r.dataDiff=t:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(o.exported.resolveURL(this._data),Se.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,r,(a,u)=>{if(this._pendingLoads--,this._removed||u&&u.abandoned)return void this.fire(new o.Event("dataabort",{dataType:"source"}));let d=null;if(u&&u.resourceTiming&&u.resourceTiming[this.id]&&(d=u.resourceTiming[this.id].slice(0)),a)return void this.fire(new o.ErrorEvent(a));const g={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&o.extend(g,{resourceTiming:d}),this.fire(new o.Event("data",{...g,sourceDataType:"metadata"})),this.fire(new o.Event("data",{...g,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(t,r){const a=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(a,u,(d,g)=>(delete t.request,t.unloadVectorData(),t.aborted?r(null):d?r(d):(t.loadVectorData(g,this.map.painter,a==="reloadTile"),r(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var yn=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ii extends o.Evented{constructor(t,r,a,u){super(),this.id=t,this.dispatcher=a,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=r}load(t,r){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Xe.getImage(this.map._requestManager.transformRequest(this.url,Se.Image),(a,u)=>{this._request=null,this._loaded=!0,a?this.fire(new o.ErrorEvent(a)):u&&(this.image=u,t&&(this.coordinates=t),r&&r(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const r=t.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(u){let d=1/0,g=1/0,b=-1/0,v=-1/0;for(const F of u)d=Math.min(d,F.x),g=Math.min(g,F.y),b=Math.max(b,F.x),v=Math.max(v,F.y);const T=Math.max(b-d,v-g),M=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),A=Math.pow(2,M);return new o.CanonicalTileID(M,Math.floor((d+b)/2*A),Math.floor((g+v)/2*A))}(r),this.minzoom=this.maxzoom=this.tileID.z;const a=r.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new o.RasterBoundsArray,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(a[2].x,a[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,r=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,yn.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new yt(t,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let a=!1;for(const u in this.tiles){const d=this.tiles[u];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,a=!0)}a&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t,r){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},r(null)):(t.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ye extends Ii{constructor(t,r,a,u){super(t,r,a,u),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const r of t.urls)this.urls.push(this.map._requestManager.transformRequest(r,Se.Source).url);o.getVideo(this.urls,(r,a)=>{this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):a&&(this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,r=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,yn.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new yt(t,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let a=!1;for(const u in this.tiles){const d=this.tiles[u];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,a=!0)}a&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class dr extends Ii{constructor(t,r,a,u){super(t,r,a,u),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(g=>typeof g!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,a=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,yn.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new yt(r,this.canvas,a.RGBA,{premultiply:!0});let u=!1;for(const d in this.tiles){const g=this.tiles[d];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,u=!0)}u&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const qi={vector:Sr,raster:Qn,"raster-dem":Ki,geojson:Ji,video:ye,image:Ii,canvas:dr};function Dt(l,t){const r=o.create();return o.translate(r,r,[1,1,0]),o.scale(r,r,[.5*l.width,.5*l.height,1]),o.multiply(r,r,l.calculatePosMatrix(t.toUnwrapped()))}function It(l,t,r,a,u,d){const g=function(A,F,Z){if(A)for(const $ of A){const G=F[$];if(G&&G.source===Z&&G.type==="fill-extrusion")return!0}else for(const $ in F){const G=F[$];if(G.source===Z&&G.type==="fill-extrusion")return!0}return!1}(u&&u.layers,t,l.id),b=d.maxPitchScaleFactor(),v=l.tilesIn(a,b,g);v.sort(gi);const T=[];for(const A of v)T.push({wrappedTileID:A.tileID.wrapped().key,queryResults:A.tile.queryRenderedFeatures(t,r,l._state,A.queryGeometry,A.cameraQueryGeometry,A.scale,u,d,b,Dt(l.transform,A.tileID))});const M=function(A){const F={},Z={};for(const $ of A){const G=$.queryResults,K=$.wrappedTileID,te=Z[K]=Z[K]||{};for(const ue in G){const X=G[ue],ce=te[ue]=te[ue]||{},ge=F[ue]=F[ue]||[];for(const Te of X)ce[Te.featureIndex]||(ce[Te.featureIndex]=!0,ge.push(Te))}}return F}(T);for(const A in M)M[A].forEach(F=>{const Z=F.feature,$=l.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=$});return M}function gi(l,t){const r=l.tileID,a=t.tileID;return r.overscaledZ-a.overscaledZ||r.canonical.y-a.canonical.y||r.wrap-a.wrap||r.canonical.x-a.canonical.x}class Er{constructor(t,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=o.uniqueId(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const r=t+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,r,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(u,d){const g={};if(!d)return g;for(const b of u){const v=b.layerIds.map(T=>d.getLayer(T)).filter(Boolean);if(v.length!==0){b.layers=v,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(T=>v.filter(M=>M.id===T)[0]));for(const T of v)g[T.id]=b}}return g}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const d=this.buckets[u];if(d instanceof o.SymbolBucket){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const d=this.buckets[u];if(d instanceof o.SymbolBucket&&d.hasRTLText){this.hasRTLText=!0,o.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const u in this.buckets){const d=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(u).queryRadius(d))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new o.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const a in this.buckets){const u=this.buckets[a];u.uploadPending()&&u.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new yt(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new yt(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,r,a,u,d,g,b,v,T,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:d,scale:g,tileSize:this.tileSize,pixelPosMatrix:M,transform:v,params:b,queryPadding:this.queryPadding*T},t,r,a):{}}querySourceFeatures(t,r){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),d=r&&r.sourceLayer?r.sourceLayer:"",g=u._geojsonTileLayer||u[d];if(!g)return;const b=o.createFilter(r&&r.filter),{z:v,x:T,y:M}=this.tileID.canonical,A={z:v,x:T,y:M};for(let F=0;F<g.length;F++){const Z=g.feature(F);if(b.needGeometry){const K=o.toEvaluationFeature(Z,!0);if(!b.filter(new o.EvaluationParameters(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!b.filter(new o.EvaluationParameters(this.tileID.overscaledZ),Z))continue;const $=a.getId(Z,d),G=new o.GeoJSONFeature(Z,v,T,M,$);G.tile=A,t.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const a=o.parseCacheControl(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(r)if(this.expirationTime<r)u=!0;else{const d=this.expirationTime-r;d?this.expirationTime=a+Math.max(d,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!r.style.hasLayer(u))continue;const d=this.buckets[u],g=d.layers[0].sourceLayer||"_geojsonTileLayer",b=a[g],v=t[g];if(!b||!v||Object.keys(v).length===0)continue;d.update(v,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const T=r&&r.style&&r.style.getLayer(u);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.exported.now()+t}setDependencies(t,r){const a={};for(const u of r)a[u]=!0;this.dependencies[t]=a}hasDependency(t,r){for(const a of t){const u=this.dependencies[a];if(u){for(const d of r)if(u[d])return!0}}return!1}}class Ur{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,a){const u=t.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const d={value:r,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(t,d)},a)),this.data[u].push(d),this.order.push(u),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const a=t.wrapped().key,u=r===void 0?0:this.data[a].indexOf(r),d=this.data[a][u];return this.data[a].splice(u,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const a in this.data)for(const u of this.data[a])t(u.value)||r.push(u);for(const a of r)this.remove(a.value.tileID,a)}}class xn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,a){const u=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][u]=this.stateChanges[t][u]||{},o.extend(this.stateChanges[t][u],a),this.deletedStates[t]===null){this.deletedStates[t]={};for(const d in this.state[t])d!==u&&(this.deletedStates[t][d]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][u]===null){this.deletedStates[t][u]={};for(const d in this.state[t][u])a[d]||(this.deletedStates[t][u][d]=null)}else for(const d in a)this.deletedStates[t]&&this.deletedStates[t][u]&&this.deletedStates[t][u][d]===null&&delete this.deletedStates[t][u][d]}removeFeatureState(t,r,a){if(this.deletedStates[t]===null)return;const u=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&r!==void 0)this.deletedStates[t][u]!==null&&(this.deletedStates[t][u]=this.deletedStates[t][u]||{},this.deletedStates[t][u][a]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][u])for(a in this.deletedStates[t][u]={},this.stateChanges[t][u])this.deletedStates[t][u][a]=null;else this.deletedStates[t][u]=null;else this.deletedStates[t]=null}getState(t,r){const a=String(r),u=o.extend({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const d=this.deletedStates[t][r];if(d===null)return{};for(const g in d)delete u[g]}return u}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const d={};for(const g in this.stateChanges[u])this.state[u][g]||(this.state[u][g]={}),o.extend(this.state[u][g],this.stateChanges[u][g]),d[g]=this.state[u][g];a[u]=d}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const d={};if(this.deletedStates[u]===null)for(const g in this.state[u])d[g]={},this.state[u][g]={};else for(const g in this.deletedStates[u]){if(this.deletedStates[u][g]===null)this.state[u][g]={};else for(const b of Object.keys(this.deletedStates[u][g]))delete this.state[u][g][b];d[g]=this.state[u][g]}a[u]=a[u]||{},o.extend(a[u],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const u in t)t[u].setFeatureState(a,r)}}class ai extends o.Evented{constructor(t,r,a){super(),this.id=t,this.dispatcher=a,this.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(u,d,g,b){const v=new qi[d.type](u,d,g,b);if(v.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${v.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],v),v}(t,r,a,this),this._tiles={},this._cache=new Ur(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new xn,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const r=this._tiles[t];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,r){return this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new o.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const a=this._tiles[r];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(er).map(t=>t.key)}getRenderableIds(t){const r=[];for(const a in this._tiles)this._isIdRenderable(a,t)&&r.push(this._tiles[a]);return t?r.sort((a,u)=>{const d=a.tileID,g=u.tileID,b=new o.Point(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),v=new o.Point(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-g.overscaledZ||v.y-b.y||v.x-b.x}).map(a=>a.tileID.key):r.map(a=>a.tileID).sort(er).map(a=>a.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,r){const a=this._tiles[t];a&&(a.state!=="loading"&&(a.state=r),this._loadTile(a,this._tileLoaded.bind(this,a,t,r)))}_tileLoaded(t,r,a,u){if(u)return t.state="errored",void(u.status!==404?this._source.fire(new o.ErrorEvent(u,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=o.exported.now(),a==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new o.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const r=this.getRenderableIds();for(let u=0;u<r.length;u++){const d=r[u];if(t.neighboringTiles&&t.neighboringTiles[d]){const g=this.getTileByID(d);a(t,g),a(g,t)}}function a(u,d){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let g=d.tileID.canonical.x-u.tileID.canonical.x;const b=d.tileID.canonical.y-u.tileID.canonical.y,v=Math.pow(2,u.tileID.canonical.z),T=d.tileID.key;g===0&&b===0||Math.abs(b)>1||(Math.abs(g)>1&&(Math.abs(g+v)===1?g+=v:Math.abs(g-v)===1&&(g-=v)),d.dem&&u.dem&&(u.dem.backfillBorder(d.dem,g,b),u.neighboringTiles&&u.neighboringTiles[T]&&(u.neighboringTiles[T].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,a,u){for(const d in this._tiles){let g=this._tiles[d];if(u[d]||!g.hasData()||g.tileID.overscaledZ<=r||g.tileID.overscaledZ>a)continue;let b=g.tileID;for(;g&&g.tileID.overscaledZ>r+1;){const T=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[T.key],g&&g.hasData()&&(b=T)}let v=b;for(;v.overscaledZ>r;)if(v=v.scaledTo(v.overscaledZ-1),t[v.key]){u[b.key]=b;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=t.overscaledZ-1;a>=r;a--){const u=t.scaledTo(a),d=this._getLoadedTile(u);if(d)return d}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const r=Math.ceil(t.width/this._source.tileSize)+1,a=Math.ceil(t.height/this._source.tileSize)+1,u=Math.floor(r*a*5),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(d)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const a={};for(const u in this._tiles){const d=this._tiles[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+r),a[d.tileID.key]=d}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}update(t,r){if(this.transform=t,this.terrain=r,!this._sourceLoaded||this._paused)return;let a;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new o.OverscaledTileID(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(a=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r}),this._source.hasTile&&(a=a.filter(M=>this._source.hasTile(M)))):a=[];const u=t.coveringZoomLevel(this._source),d=Math.max(u-ai.maxOverzooming,this._source.minzoom),g=Math.max(u+ai.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const A of a)if(A.canonical.z>this._source.minzoom){const F=A.scaledTo(A.canonical.z-1);M[F.key]=F;const Z=A.scaledTo(Math.max(this._source.minzoom,Math.min(A.canonical.z,5)));M[Z.key]=Z}a=a.concat(Object.values(M))}const b=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new o.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const v=this._updateRetainedTiles(a,u);if(kn(this._source.type)){const M={},A={},F=Object.keys(v),Z=o.exported.now();for(const $ of F){const G=v[$],K=this._tiles[$];if(!K||K.fadeEndTime!==0&&K.fadeEndTime<=Z)continue;const te=this.findLoadedParent(G,d);te&&(this._addTile(te.tileID),M[te.tileID.key]=te.tileID),A[$]=G}this._retainLoadedChildren(A,u,g,v);for(const $ in M)v[$]||(this._coveredTiles[$]=!0,v[$]=M[$]);if(r){const $={},G={};for(const K of a)this._tiles[K.key].hasData()?$[K.key]=K:G[K.key]=K;for(const K in G){const te=G[K].children(this._source.maxzoom);this._tiles[te[0].key]&&this._tiles[te[1].key]&&this._tiles[te[2].key]&&this._tiles[te[3].key]&&($[te[0].key]=v[te[0].key]=te[0],$[te[1].key]=v[te[1].key]=te[1],$[te[2].key]=v[te[2].key]=te[2],$[te[3].key]=v[te[3].key]=te[3],delete G[K])}for(const K in G){const te=this.findLoadedParent(G[K],this._source.minzoom);if(te){$[te.tileID.key]=v[te.tileID.key]=te.tileID;for(const ue in $)$[ue].isChildOf(te.tileID)&&delete $[ue]}}for(const K in this._tiles)$[K]||(this._coveredTiles[K]=!0)}}for(const M in v)this._tiles[M].clearFadeHold();const T=o.keysDifference(this._tiles,v);for(const M of T){const A=this._tiles[M];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,r){const a={},u={},d=Math.max(r-ai.maxOverzooming,this._source.minzoom),g=Math.max(r+ai.maxUnderzooming,this._source.minzoom),b={};for(const v of t){const T=this._addTile(v);a[v.key]=v,T.hasData()||r<this._source.maxzoom&&(b[v.key]=v)}this._retainLoadedChildren(b,r,g,a);for(const v of t){let T=this._tiles[v.key];if(T.hasData())continue;if(r+1>this._source.maxzoom){const A=v.children(this._source.maxzoom)[0],F=this.getTile(A);if(F&&F.hasData()){a[A.key]=A;continue}}else{const A=v.children(this._source.maxzoom);if(a[A[0].key]&&a[A[1].key]&&a[A[2].key]&&a[A[3].key])continue}let M=T.wasRequested();for(let A=v.overscaledZ-1;A>=d;--A){const F=v.scaledTo(A);if(u[F.key])break;if(u[F.key]=!0,T=this.getTile(F),!T&&M&&(T=this._addTile(F)),T){const Z=T.hasData();if((M||Z)&&(a[F.key]=F),M=T.wasRequested(),Z)break}}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let a,u=this._tiles[t].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}r.push(u.key);const d=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;u=d}for(const d of r)this._loadedParentTiles[d]=a}}_addTile(t){let r=this._tiles[t.key];if(r)return r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const a=r;return r||(r=new Er(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))),r.uses++,this._tiles[t.key]=r,a||this._source.fire(new o.Event("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const a=r.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,r,a){const u=[],d=this.transform;if(!d)return u;const g=a?d.getCameraQueryGeometry(t):t,b=t.map($=>d.pointCoordinate($,this.terrain)),v=g.map($=>d.pointCoordinate($,this.terrain)),T=this.getIds();let M=1/0,A=1/0,F=-1/0,Z=-1/0;for(const $ of v)M=Math.min(M,$.x),A=Math.min(A,$.y),F=Math.max(F,$.x),Z=Math.max(Z,$.y);for(let $=0;$<T.length;$++){const G=this._tiles[T[$]];if(G.holdingForFade())continue;const K=G.tileID,te=Math.pow(2,d.zoom-G.tileID.overscaledZ),ue=r*G.queryPadding*o.EXTENT/G.tileSize/te,X=[K.getTilePoint(new o.MercatorCoordinate(M,A)),K.getTilePoint(new o.MercatorCoordinate(F,Z))];if(X[0].x-ue<o.EXTENT&&X[0].y-ue<o.EXTENT&&X[1].x+ue>=0&&X[1].y+ue>=0){const ce=b.map(Te=>K.getTilePoint(Te)),ge=v.map(Te=>K.getTilePoint(Te));u.push({tile:G,tileID:K,queryGeometry:ce,cameraQueryGeometry:ge,scale:te})}}return u}getVisibleCoordinates(t){const r=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);for(const a of r)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(kn(this._source.type)){const t=o.exported.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=t)return!0}return!1}setFeatureState(t,r,a){this._state.updateState(t=t||"_geojsonTileLayer",r,a)}removeFeatureState(t,r,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,a)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,a){const u=this._tiles[t];u&&u.setDependencies(r,a)}reloadTilesForDependencies(t,r){for(const a in this._tiles)this._tiles[a].hasDependency(t,r)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(t,r))}}function er(l,t){const r=Math.abs(2*l.wrap)-+(l.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return l.overscaledZ-t.overscaledZ||a-r||t.canonical.y-l.canonical.y||t.canonical.x-l.canonical.x}function kn(l){return l==="raster"||l==="image"||l==="video"}ai.maxOverzooming=10,ai.maxUnderzooming=3;const Re="mapboxgl_preloaded_worker_pool";class Gi{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Gi.workerCount;)this.workers.push(new Worker(o.config.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Re]}numActive(){return Object.keys(this.active).length}}const ii=Math.floor(o.exported.hardwareConcurrency/2);let cn;function zn(){return cn||(cn=new Gi),cn}Gi.workerCount=o.isSafari(globalThis)?Math.max(Math.min(ii,3),1):1;class De{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.clamp(t,0,1);let r=1,a=this._distances[r];const u=t*this.paddedLength+this.padding;for(;a<u&&r<this._distances.length;)a=this._distances[++r];const d=r-1,g=this._distances[d],b=a-g,v=b>0?(u-g)/b:0;return this.points[d].mult(1-v).add(this.points[r].mult(v))}}function dt(l,t){let r=!0;return l==="always"||l!=="never"&&t!=="never"||(r=!1),r}class pt{constructor(t,r,a){const u=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(t/a),this.yCellCount=Math.ceil(r/a);for(let g=0;g<this.xCellCount*this.yCellCount;g++)u.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,a,u,d){this._forEachCell(r,a,u,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(d)}insertCircle(t,r,a,u){this._forEachCell(r-u,a-u,r+u,a+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(a),this.circles.push(u)}_insertBoxCell(t,r,a,u,d,g){this.boxCells[d].push(g)}_insertCircleCell(t,r,a,u,d,g){this.circleCells[d].push(g)}_query(t,r,a,u,d,g,b){if(a<0||t>this.width||u<0||r>this.height)return[];const v=[];if(t<=0&&r<=0&&this.width<=a&&this.height<=u){if(d)return[{key:null,x1:t,y1:r,x2:a,y2:u}];for(let T=0;T<this.boxKeys.length;T++)v.push({key:this.boxKeys[T],x1:this.bboxes[4*T],y1:this.bboxes[4*T+1],x2:this.bboxes[4*T+2],y2:this.bboxes[4*T+3]});for(let T=0;T<this.circleKeys.length;T++){const M=this.circles[3*T],A=this.circles[3*T+1],F=this.circles[3*T+2];v.push({key:this.circleKeys[T],x1:M-F,y1:A-F,x2:M+F,y2:A+F})}}else this._forEachCell(t,r,a,u,this._queryCell,v,{hitTest:d,overlapMode:g,seenUids:{box:{},circle:{}}},b);return v}query(t,r,a,u){return this._query(t,r,a,u,!1,null)}hitTest(t,r,a,u,d,g){return this._query(t,r,a,u,!0,d,g).length>0}hitTestCircle(t,r,a,u,d){const g=t-a,b=t+a,v=r-a,T=r+a;if(b<0||g>this.width||T<0||v>this.height)return!1;const M=[];return this._forEachCell(g,v,b,T,this._queryCellCircle,M,{hitTest:!0,overlapMode:u,circle:{x:t,y:r,radius:a},seenUids:{box:{},circle:{}}},d),M.length>0}_queryCell(t,r,a,u,d,g,b,v){const{seenUids:T,hitTest:M,overlapMode:A}=b,F=this.boxCells[d];if(F!==null){const $=this.bboxes;for(const G of F)if(!T.box[G]){T.box[G]=!0;const K=4*G,te=this.boxKeys[G];if(t<=$[K+2]&&r<=$[K+3]&&a>=$[K+0]&&u>=$[K+1]&&(!v||v(te))&&(!M||!dt(A,te.overlapMode))&&(g.push({key:te,x1:$[K],y1:$[K+1],x2:$[K+2],y2:$[K+3]}),M))return!0}}const Z=this.circleCells[d];if(Z!==null){const $=this.circles;for(const G of Z)if(!T.circle[G]){T.circle[G]=!0;const K=3*G,te=this.circleKeys[G];if(this._circleAndRectCollide($[K],$[K+1],$[K+2],t,r,a,u)&&(!v||v(te))&&(!M||!dt(A,te.overlapMode))){const ue=$[K],X=$[K+1],ce=$[K+2];if(g.push({key:te,x1:ue-ce,y1:X-ce,x2:ue+ce,y2:X+ce}),M)return!0}}}return!1}_queryCellCircle(t,r,a,u,d,g,b,v){const{circle:T,seenUids:M,overlapMode:A}=b,F=this.boxCells[d];if(F!==null){const $=this.bboxes;for(const G of F)if(!M.box[G]){M.box[G]=!0;const K=4*G,te=this.boxKeys[G];if(this._circleAndRectCollide(T.x,T.y,T.radius,$[K+0],$[K+1],$[K+2],$[K+3])&&(!v||v(te))&&!dt(A,te.overlapMode))return g.push(!0),!0}}const Z=this.circleCells[d];if(Z!==null){const $=this.circles;for(const G of Z)if(!M.circle[G]){M.circle[G]=!0;const K=3*G,te=this.circleKeys[G];if(this._circlesCollide($[K],$[K+1],$[K+2],T.x,T.y,T.radius)&&(!v||v(te))&&!dt(A,te.overlapMode))return g.push(!0),!0}}}_forEachCell(t,r,a,u,d,g,b,v){const T=this._convertToXCellCoord(t),M=this._convertToYCellCoord(r),A=this._convertToXCellCoord(a),F=this._convertToYCellCoord(u);for(let Z=T;Z<=A;Z++)for(let $=M;$<=F;$++)if(d.call(this,t,r,a,u,this.xCellCount*$+Z,g,b,v))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,a,u,d,g){const b=u-t,v=d-r,T=a+g;return T*T>b*b+v*v}_circleAndRectCollide(t,r,a,u,d,g,b){const v=(g-u)/2,T=Math.abs(t-(u+v));if(T>v+a)return!1;const M=(b-d)/2,A=Math.abs(r-(d+M));if(A>M+a)return!1;if(T<=v||A<=M)return!0;const F=T-v,Z=A-M;return F*F+Z*Z<=a*a}}function jt(l,t,r,a,u){const d=o.create();return t?(o.scale(d,d,[1/u,1/u,1]),r||o.rotateZ(d,d,a.angle)):o.multiply(d,a.labelPlaneMatrix,l),d}function Qi(l,t,r,a,u){if(t){const d=o.clone(l);return o.scale(d,d,[u,u,1]),r||o.rotateZ(d,d,-a.angle),d}return a.glCoordMatrix}function rt(l,t,r){let a;r?(a=[l.x,l.y,r(l.x,l.y),1],o.transformMat4(a,a,t)):(a=[l.x,l.y,0,1],V(a,a,t));const u=a[3];return{point:new o.Point(a[0]/u,a[1]/u),signedDistanceFromCamera:u}}function Zi(l,t){return .5+l/t*.5}function Wi(l,t){const r=l[0]/l[3],a=l[1]/l[3];return r>=-t[0]&&r<=t[0]&&a>=-t[1]&&a<=t[1]}function tr(l,t,r,a,u,d,g,b,v,T){const M=a?l.textSizeData:l.iconSizeData,A=o.evaluateSizeForZoom(M,r.transform.zoom),F=[256/r.width*2+1,256/r.height*2+1],Z=a?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;Z.clear();const $=l.lineVertexArray,G=a?l.text.placedSymbolArray:l.icon.placedSymbolArray,K=r.transform.width/r.transform.height;let te=!1;for(let ue=0;ue<G.length;ue++){const X=G.get(ue);if(X.hidden||X.writingMode===o.WritingMode.vertical&&!te){re(X.numGlyphs,Z);continue}let ce;if(te=!1,T?(ce=[X.anchorX,X.anchorY,T(X.anchorX,X.anchorY),1],o.transformMat4(ce,ce,t)):(ce=[X.anchorX,X.anchorY,0,1],V(ce,ce,t)),!Wi(ce,F)){re(X.numGlyphs,Z);continue}const ge=Zi(r.transform.cameraToCenterDistance,ce[3]),Te=o.evaluateSizeForFeature(M,A,X),Me=g?Te/ge:Te*ge,ke=new o.Point(X.anchorX,X.anchorY),Ie=rt(ke,u,T).point,Ze={projections:{},offsets:{}},at=j(X,Me,!1,b,t,u,d,l.glyphOffsetArray,$,Z,Ie,ke,Ze,K,v,T);te=at.useVertical,(at.notEnoughRoom||te||at.needsFlipping&&j(X,Me,!0,b,t,u,d,l.glyphOffsetArray,$,Z,Ie,ke,Ze,K,v,T).notEnoughRoom)&&re(X.numGlyphs,Z)}a?l.text.dynamicLayoutVertexBuffer.updateData(Z):l.icon.dynamicLayoutVertexBuffer.updateData(Z)}function ir(l,t,r,a,u,d,g,b,v,T,M,A,F){const Z=b.glyphStartIndex+b.numGlyphs,$=b.lineStartIndex,G=b.lineStartIndex+b.lineLength,K=t.getoffsetX(b.glyphStartIndex),te=t.getoffsetX(Z-1),ue=Q(l*K,r,a,u,d,g,b.segment,$,G,v,T,M,A,F);if(!ue)return null;const X=Q(l*te,r,a,u,d,g,b.segment,$,G,v,T,M,A,F);return X?{first:ue,last:X}:null}function _i(l,t,r,a){return l===o.WritingMode.horizontal&&Math.abs(r.y-t.y)>Math.abs(r.x-t.x)*a?{useVertical:!0}:(l===o.WritingMode.vertical?t.y<r.y:t.x>r.x)?{needsFlipping:!0}:null}function j(l,t,r,a,u,d,g,b,v,T,M,A,F,Z,$,G){const K=t/24,te=l.lineOffsetX*K,ue=l.lineOffsetY*K;let X;if(l.numGlyphs>1){const ce=l.glyphStartIndex+l.numGlyphs,ge=l.lineStartIndex,Te=l.lineStartIndex+l.lineLength,Me=ir(K,b,te,ue,r,M,A,l,v,d,F,$,G);if(!Me)return{notEnoughRoom:!0};const ke=rt(Me.first.point,g,G).point,Ie=rt(Me.last.point,g,G).point;if(a&&!r){const Ze=_i(l.writingMode,ke,Ie,Z);if(Ze)return Ze}X=[Me.first];for(let Ze=l.glyphStartIndex+1;Ze<ce-1;Ze++)X.push(Q(K*b.getoffsetX(Ze),te,ue,r,M,A,l.segment,ge,Te,v,d,F,$,G));X.push(Me.last)}else{if(a&&!r){const ge=rt(A,u,G).point,Te=l.lineStartIndex+l.segment+1,Me=new o.Point(v.getx(Te),v.gety(Te)),ke=rt(Me,u,G),Ie=ke.signedDistanceFromCamera>0?ke.point:k(A,Me,ge,1,u,G),Ze=_i(l.writingMode,ge,Ie,Z);if(Ze)return Ze}const ce=Q(K*b.getoffsetX(l.glyphStartIndex),te,ue,r,M,A,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,v,d,F,$,G);if(!ce)return{notEnoughRoom:!0};X=[ce]}for(const ce of X)o.addDynamicAttributes(T,ce.point,ce.angle);return{}}function k(l,t,r,a,u,d){const g=rt(l.add(l.sub(t)._unit()),u,d).point,b=r.sub(g);return r.add(b._mult(a/b.mag()))}function R(l,t){const{projectionCache:r,lineVertexArray:a,labelPlaneMatrix:u,tileAnchorPoint:d,distanceFromAnchor:g,getElevation:b,previousVertex:v,direction:T,absOffsetX:M}=t;if(r.projections[l])return r.projections[l];const A=new o.Point(a.getx(l),a.gety(l)),F=rt(A,u,b);if(F.signedDistanceFromCamera>0)return r.projections[l]=F.point,F.point;const Z=l-T;return k(g===0?d:new o.Point(a.getx(Z),a.gety(Z)),A,v,M-g+1,u,b)}function N(l,t,r){return l._unit()._perp()._mult(t*r)}function Y(l,t,r,a,u,d,g,b){const{projectionCache:v,direction:T}=b;if(v.offsets[l])return v.offsets[l];const M=r.add(t);if(l+T<a||l+T>=u)return v.offsets[l]=M,M;const A=R(l+T,b),F=N(A.sub(r),g,T),Z=r.add(F),$=A.add(F);return v.offsets[l]=o.findLineIntersection(d,M,Z,$)||M,v.offsets[l]}function Q(l,t,r,a,u,d,g,b,v,T,M,A,F,Z){const $=a?l-t:l+t;let G=$>0?1:-1,K=0;a&&(G*=-1,K=Math.PI),G<0&&(K+=Math.PI);let te,ue,X=G>0?b+g:b+g+1,ce=u,ge=u,Te=0,Me=0;const ke=Math.abs($),Ie=[];let Ze;for(;Te+Me<=ke;){if(X+=G,X<b||X>=v)return null;Te+=Me,ge=ce,ue=te;const Fe={projectionCache:A,lineVertexArray:T,labelPlaneMatrix:M,tileAnchorPoint:d,distanceFromAnchor:Te,getElevation:Z,previousVertex:ge,direction:G,absOffsetX:ke};if(ce=R(X,Fe),r===0)Ie.push(ge),Ze=ce.sub(ge);else{let ut;const He=ce.sub(ge);ut=He.mag()===0?N(R(X+G,Fe).sub(ce),r,G):N(He,r,G),ue||(ue=ge.add(ut)),te=Y(X,ut,ce,b,v,ue,r,Fe),Ie.push(ue),Ze=te.sub(ue)}Me=Ze.mag()}const at=Ze._mult((ke-Te)/Me)._add(ue||ge),mt=K+Math.atan2(ce.y-ge.y,ce.x-ge.x);return Ie.push(at),{point:at,angle:F?mt:0,path:Ie}}const se=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function re(l,t){for(let r=0;r<l;r++){const a=t.length;t.resize(a+4),t.float32.set(se,3*a)}}function V(l,t,r){const a=t[0],u=t[1];return l[0]=r[0]*a+r[4]*u+r[12],l[1]=r[1]*a+r[5]*u+r[13],l[3]=r[3]*a+r[7]*u+r[15],l}const J=100;class be{constructor(t,r=new pt(t.width+200,t.height+200,25),a=new pt(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=a,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+J,this.screenBottomBoundary=t.height+J,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,r,a,u,d,g){const b=this.projectAndGetPerspectiveRatio(u,t.anchorPointX,t.anchorPointY,g),v=a*b.perspectiveRatio,T=t.x1*v+b.point.x,M=t.y1*v+b.point.y,A=t.x2*v+b.point.x,F=t.y2*v+b.point.y;return!this.isInsideGrid(T,M,A,F)||r!=="always"&&this.grid.hitTest(T,M,A,F,r,d)||b.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[T,M,A,F],offscreen:this.isOffscreen(T,M,A,F)}}placeCollisionCircles(t,r,a,u,d,g,b,v,T,M,A,F,Z,$){const G=[],K=new o.Point(r.anchorX,r.anchorY),te=rt(K,g,$),ue=Zi(this.transform.cameraToCenterDistance,te.signedDistanceFromCamera),X=(M?d/ue:d*ue)/o.ONE_EM,ce=rt(K,b,$).point,ge=ir(X,u,r.lineOffsetX*X,r.lineOffsetY*X,!1,ce,K,r,a,b,{projections:{},offsets:{}},!1,$);let Te=!1,Me=!1,ke=!0;if(ge){const Ie=.5*F*ue+Z,Ze=new o.Point(-100,-100),at=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),mt=new De,Fe=ge.first,ut=ge.last;let He=[];for(let zt=Fe.path.length-1;zt>=1;zt--)He.push(Fe.path[zt]);for(let zt=1;zt<ut.path.length;zt++)He.push(ut.path[zt]);const kt=2.5*Ie;if(v){const zt=He.map(_t=>rt(_t,v,$));He=zt.some(_t=>_t.signedDistanceFromCamera<=0)?[]:zt.map(_t=>_t.point)}let vi=[];if(He.length>0){const zt=He[0].clone(),_t=He[0].clone();for(let ci=1;ci<He.length;ci++)zt.x=Math.min(zt.x,He[ci].x),zt.y=Math.min(zt.y,He[ci].y),_t.x=Math.max(_t.x,He[ci].x),_t.y=Math.max(_t.y,He[ci].y);vi=zt.x>=Ze.x&&_t.x<=at.x&&zt.y>=Ze.y&&_t.y<=at.y?[He]:_t.x<Ze.x||zt.x>at.x||_t.y<Ze.y||zt.y>at.y?[]:o.clipLine([He],Ze.x,Ze.y,at.x,at.y)}for(const zt of vi){mt.reset(zt,.25*Ie);let _t=0;_t=mt.length<=.5*Ie?1:Math.ceil(mt.paddedLength/kt)+1;for(let ci=0;ci<_t;ci++){const un=ci/Math.max(_t-1,1),bi=mt.lerp(un),Oi=bi.x+J,Rn=bi.y+J;G.push(Oi,Rn,Ie,0);const rr=Oi-Ie,sr=Rn-Ie,hn=Oi+Ie,vr=Rn+Ie;if(ke=ke&&this.isOffscreen(rr,sr,hn,vr),Me=Me||this.isInsideGrid(rr,sr,hn,vr),t!=="always"&&this.grid.hitTestCircle(Oi,Rn,Ie,t,A)&&(Te=!0,!T))return{circles:[],offscreen:!1,collisionDetected:Te}}}}return{circles:!T&&Te||!Me||ue<this.perspectiveRatioCutoff?[]:G,offscreen:ke,collisionDetected:Te}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let a=1/0,u=1/0,d=-1/0,g=-1/0;for(const M of t){const A=new o.Point(M.x+J,M.y+J);a=Math.min(a,A.x),u=Math.min(u,A.y),d=Math.max(d,A.x),g=Math.max(g,A.y),r.push(A)}const b=this.grid.query(a,u,d,g).concat(this.ignoredGrid.query(a,u,d,g)),v={},T={};for(const M of b){const A=M.key;if(v[A.bucketInstanceId]===void 0&&(v[A.bucketInstanceId]={}),v[A.bucketInstanceId][A.featureIndex])continue;const F=[new o.Point(M.x1,M.y1),new o.Point(M.x2,M.y1),new o.Point(M.x2,M.y2),new o.Point(M.x1,M.y2)];o.polygonIntersectsPolygon(r,F)&&(v[A.bucketInstanceId][A.featureIndex]=!0,T[A.bucketInstanceId]===void 0&&(T[A.bucketInstanceId]=[]),T[A.bucketInstanceId].push(A.featureIndex))}return T}insertCollisionBox(t,r,a,u,d,g){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:d,collisionGroupID:g,overlapMode:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,a,u,d,g){const b=a?this.ignoredGrid:this.grid,v={bucketInstanceId:u,featureIndex:d,collisionGroupID:g,overlapMode:r};for(let T=0;T<t.length;T+=4)b.insertCircle(v,t[T],t[T+1],t[T+2])}projectAndGetPerspectiveRatio(t,r,a,u){let d;return u?(d=[r,a,u(r,a),1],o.transformMat4(d,d,t)):(d=[r,a,0,1],V(d,d,t)),{point:new o.Point((d[0]/d[3]+1)/2*this.transform.width+J,(-d[1]/d[3]+1)/2*this.transform.height+J),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}}isOffscreen(t,r,a,u){return a<J||t>=this.screenRightBoundary||u<J||r>this.screenBottomBoundary}isInsideGrid(t,r,a,u){return a>=0&&t<this.gridRightBoundary&&u>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=o.identity([]);return o.translate(t,t,[-100,-100,0]),t}}function xe(l,t,r){return t*(o.EXTENT/(l.tileSize*Math.pow(2,r-l.tileID.overscaledZ)))}class we{constructor(t,r,a,u){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):u&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class st{constructor(t,r,a,u,d){this.text=new we(t?t.text:null,r,a,d),this.icon=new we(t?t.icon:null,r,u,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ft{constructor(t,r,a){this.text=t,this.icon=r,this.skipFade=a}}class et{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class ot{constructor(t,r,a,u,d){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=a,this.bucketIndex=u,this.tileID=d}}class gt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:a=>a.collisionGroupID===r}}return this.collisionGroups[t]}}function Et(l,t,r,a,u){const{horizontalAlign:d,verticalAlign:g}=o.getAnchorAlignment(l),b=-(d-.5)*t,v=-(g-.5)*r,T=o.evaluateVariableOffset(l,a);return new o.Point(b+T[0]*u,v+T[1]*u)}function xt(l,t,r,a,u,d){const{x1:g,x2:b,y1:v,y2:T,anchorPointX:M,anchorPointY:A}=l,F=new o.Point(t,r);return a&&F._rotate(u?d:-d),{x1:g+F.x,y1:v+F.y,x2:b+F.x,y2:T+F.y,anchorPointX:M,anchorPointY:A}}class Rt{constructor(t,r,a,u,d){this.transform=t.clone(),this.terrain=r,this.collisionIndex=new be(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new gt(u),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,a,u){const d=a.getBucket(r),g=a.latestFeatureIndex;if(!d||!g||r.id!==d.layerIds[0])return;const b=a.collisionBoxArray,v=d.layers[0].layout,T=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),M=a.tileSize/o.EXTENT,A=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),F=v.get("text-pitch-alignment")==="map",Z=v.get("text-rotation-alignment")==="map",$=xe(a,1,this.transform.zoom),G=jt(A,F,Z,this.transform,$);let K=null;if(F){const ue=Qi(A,F,Z,this.transform,$);K=o.multiply([],this.transform.labelPlaneMatrix,ue)}this.retainedQueryData[d.bucketInstanceId]=new ot(d.bucketInstanceId,g,d.sourceLayerIndex,d.index,a.tileID);const te={bucket:d,layout:v,posMatrix:A,textLabelPlaneMatrix:G,labelToScreenMatrix:K,scale:T,textPixelRatio:M,holdingForFade:a.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(u)for(const ue of d.sortKeyRanges){const{sortKey:X,symbolInstanceStart:ce,symbolInstanceEnd:ge}=ue;t.push({sortKey:X,symbolInstanceStart:ce,symbolInstanceEnd:ge,parameters:te})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:te})}attemptAnchorPlacement(t,r,a,u,d,g,b,v,T,M,A,F,Z,$,G,K){const te=[F.textOffset0,F.textOffset1],ue=Et(t,a,u,te,d),X=this.collisionIndex.placeCollisionBox(xt(r,ue.x,ue.y,g,b,this.transform.angle),A,v,T,M.predicate,K);if((!G||this.collisionIndex.placeCollisionBox(xt(G,ue.x,ue.y,g,b,this.transform.angle),A,v,T,M.predicate,K).box.length!==0)&&X.box.length>0){let ce;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(ce=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:te,width:a,height:u,anchor:t,textBoxScale:d,prevAnchor:ce},this.markUsedJustification(Z,t,F,$),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,$,F),this.placedOrientations[F.crossTileID]=$),{shift:ue,placedGlyphBoxes:X}}}placeLayerBucketPart(t,r,a){const{bucket:u,layout:d,posMatrix:g,textLabelPlaneMatrix:b,labelToScreenMatrix:v,textPixelRatio:T,holdingForFade:M,collisionBoxArray:A,partiallyEvaluatedTextSize:F,collisionGroup:Z}=t.parameters,$=d.get("text-optional"),G=d.get("icon-optional"),K=o.getOverlapMode(d,"text-overlap","text-allow-overlap"),te=K==="always",ue=o.getOverlapMode(d,"icon-overlap","icon-allow-overlap"),X=ue==="always",ce=d.get("text-rotation-alignment")==="map",ge=d.get("text-pitch-alignment")==="map",Te=d.get("icon-text-fit")!=="none",Me=d.get("symbol-z-order")==="viewport-y",ke=te&&(X||!u.hasIconData()||G),Ie=X&&(te||!u.hasTextData()||$);!u.collisionArrays&&A&&u.deserializeCollisionBoxes(A);const Ze=this.retainedQueryData[u.bucketInstanceId].tileID,at=this.terrain?(Fe,ut)=>this.terrain.getElevation(Ze,Fe,ut):null,mt=(Fe,ut)=>{if(r[Fe.crossTileID])return;if(M)return void(this.placements[Fe.crossTileID]=new ft(!1,!1,!1));let He=!1,kt=!1,vi=!0,zt=null,_t={box:null,offscreen:null},ci={box:null,offscreen:null},un=null,bi=null,Oi=null,Rn=0,rr=0,sr=0;ut.textFeatureIndex?Rn=ut.textFeatureIndex:Fe.useRuntimeCollisionCircles&&(Rn=Fe.featureIndex),ut.verticalTextFeatureIndex&&(rr=ut.verticalTextFeatureIndex);const hn=ut.textBox;if(hn){const tn=Lt=>{let ki=o.WritingMode.horizontal;if(u.allowVerticalPlacement&&!Lt&&this.prevPlacement){const Vi=this.prevPlacement.placedOrientations[Fe.crossTileID];Vi&&(this.placedOrientations[Fe.crossTileID]=Vi,ki=Vi,this.markUsedOrientation(u,ki,Fe))}return ki},Ui=(Lt,ki)=>{if(u.allowVerticalPlacement&&Fe.numVerticalGlyphVertices>0&&ut.verticalTextBox){for(const Vi of u.writingModes)if(Vi===o.WritingMode.vertical?(_t=ki(),ci=_t):_t=Lt(),_t&&_t.box&&_t.box.length)break}else _t=Lt()};if(d.get("text-variable-anchor")){let Lt=d.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Fe.crossTileID]){const Bt=this.prevPlacement.variableOffsets[Fe.crossTileID];Lt.indexOf(Bt.anchor)>0&&(Lt=Lt.filter(zi=>zi!==Bt.anchor),Lt.unshift(Bt.anchor))}const ki=(Bt,zi,Bn)=>{const zo=Bt.x2-Bt.x1,Mr=Bt.y2-Bt.y1,Bc=Fe.textBoxScale,Ul=Te&&ue==="never"?zi:null;let Qt={box:[],offscreen:!1};const La=K!=="never"?2*Lt.length:Lt.length;for(let Vs=0;Vs<La;++Vs){const Cr=this.attemptAnchorPlacement(Lt[Vs%Lt.length],Bt,zo,Mr,Bc,ce,ge,T,g,Z,Vs>=Lt.length?K:"never",Fe,u,Bn,Ul,at);if(Cr&&(Qt=Cr.placedGlyphBoxes,Qt&&Qt.box&&Qt.box.length)){He=!0,zt=Cr.shift;break}}return Qt};Ui(()=>ki(hn,ut.iconBox,o.WritingMode.horizontal),()=>{const Bt=ut.verticalTextBox;return u.allowVerticalPlacement&&!(_t&&_t.box&&_t.box.length)&&Fe.numVerticalGlyphVertices>0&&Bt?ki(Bt,ut.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),_t&&(He=_t.box,vi=_t.offscreen);const Vi=tn(_t&&_t.box);if(!He&&this.prevPlacement){const Bt=this.prevPlacement.variableOffsets[Fe.crossTileID];Bt&&(this.variableOffsets[Fe.crossTileID]=Bt,this.markUsedJustification(u,Bt.anchor,Fe,Vi))}}else{const Lt=(ki,Vi)=>{const Bt=this.collisionIndex.placeCollisionBox(ki,K,T,g,Z.predicate,at);return Bt&&Bt.box&&Bt.box.length&&(this.markUsedOrientation(u,Vi,Fe),this.placedOrientations[Fe.crossTileID]=Vi),Bt};Ui(()=>Lt(hn,o.WritingMode.horizontal),()=>{const ki=ut.verticalTextBox;return u.allowVerticalPlacement&&Fe.numVerticalGlyphVertices>0&&ki?Lt(ki,o.WritingMode.vertical):{box:null,offscreen:null}}),tn(_t&&_t.box&&_t.box.length)}}if(un=_t,He=un&&un.box&&un.box.length>0,vi=un&&un.offscreen,Fe.useRuntimeCollisionCircles){const tn=u.text.placedSymbolArray.get(Fe.centerJustifiedTextSymbolIndex),Ui=o.evaluateSizeForFeature(u.textSizeData,F,tn),Lt=d.get("text-padding");bi=this.collisionIndex.placeCollisionCircles(K,tn,u.lineVertexArray,u.glyphOffsetArray,Ui,g,b,v,a,ge,Z.predicate,Fe.collisionCircleDiameter,Lt,at),bi.circles.length&&bi.collisionDetected&&!a&&o.warnOnce("Collisions detected, but collision boxes are not shown"),He=te||bi.circles.length>0&&!bi.collisionDetected,vi=vi&&bi.offscreen}if(ut.iconFeatureIndex&&(sr=ut.iconFeatureIndex),ut.iconBox){const tn=Ui=>{const Lt=Te&&zt?xt(Ui,zt.x,zt.y,ce,ge,this.transform.angle):Ui;return this.collisionIndex.placeCollisionBox(Lt,ue,T,g,Z.predicate,at)};ci&&ci.box&&ci.box.length&&ut.verticalIconBox?(Oi=tn(ut.verticalIconBox),kt=Oi.box.length>0):(Oi=tn(ut.iconBox),kt=Oi.box.length>0),vi=vi&&Oi.offscreen}const vr=$||Fe.numHorizontalGlyphVertices===0&&Fe.numVerticalGlyphVertices===0,Us=G||Fe.numIconVertices===0;if(vr||Us?Us?vr||(kt=kt&&He):He=kt&&He:kt=He=kt&&He,He&&un&&un.box&&this.collisionIndex.insertCollisionBox(un.box,K,d.get("text-ignore-placement"),u.bucketInstanceId,ci&&ci.box&&rr?rr:Rn,Z.ID),kt&&Oi&&this.collisionIndex.insertCollisionBox(Oi.box,ue,d.get("icon-ignore-placement"),u.bucketInstanceId,sr,Z.ID),bi&&(He&&this.collisionIndex.insertCollisionCircles(bi.circles,K,d.get("text-ignore-placement"),u.bucketInstanceId,Rn,Z.ID),a)){const tn=u.bucketInstanceId;let Ui=this.collisionCircleArrays[tn];Ui===void 0&&(Ui=this.collisionCircleArrays[tn]=new et);for(let Lt=0;Lt<bi.circles.length;Lt+=4)Ui.circles.push(bi.circles[Lt+0]),Ui.circles.push(bi.circles[Lt+1]),Ui.circles.push(bi.circles[Lt+2]),Ui.circles.push(bi.collisionDetected?1:0)}if(Fe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Fe.crossTileID]=new ft(He||ke,kt||Ie,vi||u.justReloaded),r[Fe.crossTileID]=!0};if(Me){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Fe=u.getSortedSymbolIndexes(this.transform.angle);for(let ut=Fe.length-1;ut>=0;--ut){const He=Fe[ut];mt(u.symbolInstances.get(He),u.collisionArrays[He])}}else for(let Fe=t.symbolInstanceStart;Fe<t.symbolInstanceEnd;Fe++)mt(u.symbolInstances.get(Fe),u.collisionArrays[Fe]);if(a&&u.bucketInstanceId in this.collisionCircleArrays){const Fe=this.collisionCircleArrays[u.bucketInstanceId];o.invert(Fe.invProjMatrix,g),Fe.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}markUsedJustification(t,r,a,u){let d;d=u===o.WritingMode.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(r)];const g=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const b of g)b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=d>=0&&b!==d?0:a.crossTileID)}markUsedOrientation(t,r,a){const u=r===o.WritingMode.horizontal||r===o.WritingMode.horizontalOnly?r:0,d=r===o.WritingMode.vertical?r:0,g=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const b of g)t.text.placedSymbolArray.get(b).placedOrientation=u;a.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let a=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const u=r?r.symbolFadeChange(t):1,d=r?r.opacities:{},g=r?r.variableOffsets:{},b=r?r.placedOrientations:{};for(const v in this.placements){const T=this.placements[v],M=d[v];M?(this.opacities[v]=new st(M,u,T.text,T.icon),a=a||T.text!==M.text.placed||T.icon!==M.icon.placed):(this.opacities[v]=new st(null,u,T.text,T.icon,T.skipFade),a=a||T.text||T.icon)}for(const v in d){const T=d[v];if(!this.opacities[v]){const M=new st(T,u,!1,!1);M.isHidden()||(this.opacities[v]=M,a=a||T.text.placed||T.icon.placed)}}for(const v in g)this.variableOffsets[v]||!this.opacities[v]||this.opacities[v].isHidden()||(this.variableOffsets[v]=g[v]);for(const v in b)this.placedOrientations[v]||!this.opacities[v]||this.opacities[v].isHidden()||(this.placedOrientations[v]=b[v]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r){const a={};for(const u of r){const d=u.getBucket(t);d&&u.latestFeatureIndex&&t.id===d.layerIds[0]&&this.updateBucketOpacities(d,a,u.collisionBoxArray)}}updateBucketOpacities(t,r,a){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const u=t.layers[0].layout,d=new st(null,0,!1,!1,!0),g=u.get("text-allow-overlap"),b=u.get("icon-allow-overlap"),v=u.get("text-variable-anchor"),T=u.get("text-rotation-alignment")==="map",M=u.get("text-pitch-alignment")==="map",A=u.get("icon-text-fit")!=="none",F=new st(null,0,g&&(b||!t.hasIconData()||u.get("icon-optional")),b&&(g||!t.hasTextData()||u.get("text-optional")),!0);!t.collisionArrays&&a&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(a);const Z=($,G,K)=>{for(let te=0;te<G/4;te++)$.opacityVertexArray.emplaceBack(K);$.hasVisibleVertices=$.hasVisibleVertices||K!==en};for(let $=0;$<t.symbolInstances.length;$++){const G=t.symbolInstances.get($),{numHorizontalGlyphVertices:K,numVerticalGlyphVertices:te,crossTileID:ue}=G;let X=this.opacities[ue];r[ue]?X=d:X||(X=F,this.opacities[ue]=X),r[ue]=!0;const ce=G.numIconVertices>0,ge=this.placedOrientations[G.crossTileID],Te=ge===o.WritingMode.vertical,Me=ge===o.WritingMode.horizontal||ge===o.WritingMode.horizontalOnly;if(K>0||te>0){const ke=vn(X.text);Z(t.text,K,Te?en:ke),Z(t.text,te,Me?en:ke);const Ie=X.text.isHidden();[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach(mt=>{mt>=0&&(t.text.placedSymbolArray.get(mt).hidden=Ie||Te?1:0)}),G.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).hidden=Ie||Me?1:0);const Ze=this.variableOffsets[G.crossTileID];Ze&&this.markUsedJustification(t,Ze.anchor,G,ge);const at=this.placedOrientations[G.crossTileID];at&&(this.markUsedJustification(t,"left",G,at),this.markUsedOrientation(t,at,G))}if(ce){const ke=vn(X.icon),Ie=!(A&&G.verticalPlacedIconSymbolIndex&&Te);G.placedIconSymbolIndex>=0&&(Z(t.icon,G.numIconVertices,Ie?ke:en),t.icon.placedSymbolArray.get(G.placedIconSymbolIndex).hidden=X.icon.isHidden()),G.verticalPlacedIconSymbolIndex>=0&&(Z(t.icon,G.numVerticalIconVertices,Ie?en:ke),t.icon.placedSymbolArray.get(G.verticalPlacedIconSymbolIndex).hidden=X.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ke=t.collisionArrays[$];if(ke){let Ie=new o.Point(0,0);if(ke.textBox||ke.verticalTextBox){let at=!0;if(v){const mt=this.variableOffsets[ue];mt?(Ie=Et(mt.anchor,mt.width,mt.height,mt.textOffset,mt.textBoxScale),T&&Ie._rotate(M?this.transform.angle:-this.transform.angle)):at=!1}ke.textBox&&Ft(t.textCollisionBox.collisionVertexArray,X.text.placed,!at||Te,Ie.x,Ie.y),ke.verticalTextBox&&Ft(t.textCollisionBox.collisionVertexArray,X.text.placed,!at||Me,Ie.x,Ie.y)}const Ze=!!(!Me&&ke.verticalIconBox);ke.iconBox&&Ft(t.iconCollisionBox.collisionVertexArray,X.icon.placed,Ze,A?Ie.x:0,A?Ie.y:0),ke.verticalIconBox&&Ft(t.iconCollisionBox.collisionVertexArray,X.icon.placed,!Ze,A?Ie.x:0,A?Ie.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const $=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=$.invProjMatrix,t.placementViewportMatrix=$.viewportMatrix,t.collisionCircleArray=$.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const a=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*a>t}setStale(){this.stale=!0}}function Ft(l,t,r,a,u){l.emplaceBack(t?1:0,r?1:0,a||0,u||0),l.emplaceBack(t?1:0,r?1:0,a||0,u||0),l.emplaceBack(t?1:0,r?1:0,a||0,u||0),l.emplaceBack(t?1:0,r?1:0,a||0,u||0)}const Kt=Math.pow(2,25),ni=Math.pow(2,24),yi=Math.pow(2,17),Ct=Math.pow(2,16),Yo=Math.pow(2,9),Ko=Math.pow(2,8),Dn=Math.pow(2,1);function vn(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const t=l.placed?1:0,r=Math.floor(127*l.opacity);return r*Kt+t*ni+r*yi+t*Ct+r*Yo+t*Ko+r*Dn+t}const en=0;class rl{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,r,a,u,d){const g=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(g,u,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,g.sort((b,v)=>b.sortKey-v.sortKey));this._currentPartIndex<g.length;)if(r.placeLayerBucketPart(g[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,d())return!0;return!1}}class Hs{constructor(t,r,a,u,d,g,b,v){this.placement=new Rt(t,r,g,b,v),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(t,r,a){const u=o.exported.now(),d=()=>!this._forceFullPlacement&&o.exported.now()-u>2;for(;this._currentPlacementIndex>=0;){const g=r[t[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(g.type==="symbol"&&(!g.minzoom||g.minzoom<=b)&&(!g.maxzoom||g.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new rl(g)),this._inProgressLayer.continuePlacement(a[g.source],this.placement,this._showCollisionBoxes,g,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ri=512/o.EXTENT/2;class ys{constructor(t,r,a){this.tileID=t,this.bucketInstanceId=a,this._symbolsByKey={};const u=new Map;for(let d=0;d<r.length;d++){const g=r.get(d),b=g.key,v=u.get(b);v?v.push(g):u.set(b,[g])}for(const[d,g]of u){const b={positions:g.map(v=>({x:Math.floor(v.anchorX*ri),y:Math.floor(v.anchorY*ri)})),crossTileIDs:g.map(v=>v.crossTileID)};if(b.positions.length>128){const v=new o.KDBush(b.positions.length,16,Uint16Array);for(const{x:T,y:M}of b.positions)v.add(T,M);v.finish(),delete b.positions,b.index=v}this._symbolsByKey[d]=b}}getScaledCoordinates(t,r){const{x:a,y:u,z:d}=this.tileID.canonical,{x:g,y:b,z:v}=r.canonical,T=ri/Math.pow(2,v-d),M=(b*o.EXTENT+t.anchorY)*T,A=u*o.EXTENT*ri;return{x:Math.floor((g*o.EXTENT+t.anchorX)*T-a*o.EXTENT*ri),y:Math.floor(M-A)}}findMatches(t,r,a){const u=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let d=0;d<t.length;d++){const g=t.get(d);if(g.crossTileID)continue;const b=this._symbolsByKey[g.key];if(!b)continue;const v=this.getScaledCoordinates(g,r);if(b.index){const T=b.index.range(v.x-u,v.y-u,v.x+u,v.y+u).sort();for(const M of T){const A=b.crossTileIDs[M];if(!a[A]){a[A]=!0,g.crossTileID=A;break}}}else if(b.positions)for(let T=0;T<b.positions.length;T++){const M=b.positions[T],A=b.crossTileIDs[T];if(Math.abs(M.x-v.x)<=u&&Math.abs(M.y-v.y)<=u&&!a[A]){a[A]=!0,g.crossTileID=A;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Vr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Fi{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const a in this.indexes){const u=this.indexes[a],d={};for(const g in u){const b=u[g];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+r),d[b.tileID.key]=b}this.indexes[a]=d}this.lng=t}addBucket(t,r,a){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let d=0;d<r.symbolInstances.length;d++)r.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const u=this.usedCrossTileIDs[t.overscaledZ];for(const d in this.indexes){const g=this.indexes[d];if(Number(d)>t.overscaledZ)for(const b in g){const v=g[b];v.tileID.isChildOf(t)&&v.findMatches(r.symbolInstances,t,u)}else{const b=g[t.scaledTo(Number(d)).key];b&&b.findMatches(r.symbolInstances,t,u)}}for(let d=0;d<r.symbolInstances.length;d++){const g=r.symbolInstances.get(d);g.crossTileID||(g.crossTileID=a.generate(),u[g.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ys(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const a of r.getCrossTileIDsLists())for(const u of a)delete this.usedCrossTileIDs[t][u]}removeStaleBuckets(t){let r=!1;for(const a in this.indexes){const u=this.indexes[a];for(const d in u)t[u[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,u[d]),delete u[d],r=!0)}return r}}class xs{constructor(){this.layerIndexes={},this.crossTileIDs=new Vr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,a){let u=this.layerIndexes[t.id];u===void 0&&(u=this.layerIndexes[t.id]=new Fi);let d=!1;const g={};u.handleWrapJump(a);for(const b of r){const v=b.getBucket(t);v&&t.id===v.layerIds[0]&&(v.bucketInstanceId||(v.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(b.tileID,v,this.crossTileIDs)&&(d=!0),g[v.bucketInstanceId]=!0)}return u.removeStaleBuckets(g)&&(d=!0),d}pruneUnusedLayers(t){const r={};t.forEach(a=>{r[a]=!0});for(const a in this.layerIndexes)r[a]||delete this.layerIndexes[a]}}const bn=(l,t)=>o.emitValidationErrors(l,t&&t.filter(r=>r.identifier!=="source.canvas")),sl=o.pick(o.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Rr=o.pick(o.operations,["setCenter","setZoom","setBearing","setPitch"]),yc=o.emptyStyle();class nr extends o.Evented{constructor(t,r={}){super(),this.map=t,this.dispatcher=new Mt(zn(),this,t._getMapId()),this.imageManager=new Ht,this.imageManager.setEventedParent(this),this.glyphManager=new Vt(t._requestManager,r.localIdeographFontFamily),this.lineAtlas=new Bi(256,512),this.crossTileSymbolIndex=new xs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const a=this;this._rtlTextPluginCallback=nr.registerForPluginStateChange(u=>{a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:u.pluginStatus,pluginURL:u.pluginURL},(d,g)=>{if(o.triggerPluginCompletionEvent(d),g&&g.every(b=>b))for(const b in a.sourceCaches){const v=a.sourceCaches[b].getSource().type;v!=="vector"&&v!=="geojson"||a.sourceCaches[b].reload()}})}),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const d=this.sourceCaches[u.sourceId];if(!d)return;const g=d.getSource();if(g&&g.vectorLayerIds)for(const b in this._layers){const v=this._layers[b];v.source===g.id&&this._validateLayer(v)}})}loadURL(t,r={},a){this.fire(new o.Event("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const u=this.map._requestManager.transformRequest(t,Se.Style);this._request=o.getJSON(u,(d,g)=>{this._request=null,d?this.fire(new o.ErrorEvent(d)):g&&this._load(g,r,a)})}loadJSON(t,r={},a){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,r.validate=r.validate!==!1,this._load(t,r,a)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(yc,{validate:!1})}_load(t,r,a){const u=r.transformStyle?r.transformStyle(a,t):t;if(!r.validate||!bn(this,o.validateStyle(u))){this._loaded=!0,this.stylesheet=u;for(const d in u.sources)this.addSource(d,u.sources[d],{validate:!1});u.sprite?this._loadSprite(u.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(u.glyphs),this._createLayers(),this.light=new oi(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}}_createLayers(){const t=o.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of t){const a=o.createStyleLayer(r);a.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=a}}_loadSprite(t,r=!1,a){this.imageManager.setLoaded(!1),this._spriteRequest=function(u,d,g,b){const v=At(u),T=v.length,M=g>1?"@2x":"",A={},F={},Z={};for(const{id:$,url:G}of v){const K=d.transformRequest(d.normalizeSpriteURL(G,M,".json"),Se.SpriteJSON),te=`${$}_${K.url}`;A[te]=o.getJSON(K,(ce,ge)=>{delete A[te],F[$]=ge,Wt(b,F,Z,ce,T)});const ue=d.transformRequest(d.normalizeSpriteURL(G,M,".png"),Se.SpriteImage),X=`${$}_${ue.url}`;A[X]=Xe.getImage(ue,(ce,ge)=>{delete A[X],Z[$]=ge,Wt(b,F,Z,ce,T)})}return{cancel(){for(const $ of Object.values(A))$.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(u,d)=>{if(this._spriteRequest=null,u)this.fire(new o.ErrorEvent(u));else if(d)for(const g in d){this._spritesImagesIds[g]=[];const b=this._spritesImagesIds[g]?this._spritesImagesIds[g].filter(v=>!(v in d)):[];for(const v of b)this.imageManager.removeImage(v),this._changedImages[v]=!0;for(const v in d[g]){const T=g==="default"?v:`${g}:${v}`;this._spritesImagesIds[g].push(T),T in this.imageManager.images?this.imageManager.updateImage(T,d[g][v],!1):this.imageManager.addImage(T,d[g][v]),r&&(this._changedImages[T]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"})),a&&a(u)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}_validateLayer(t){const r=this.sourceCaches[t.source];if(!r)return;const a=t.sourceLayer;if(!a)return;const u=r.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(a)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${a}" does not exist on source "${u.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const r=this._serializedAllLayers();if(!t||t.length===0)return Object.values(r);const a=[];for(const u of t)r[u]&&a.push(r[u]);return a}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const r=Object.keys(this._layers);for(const a of r){const u=this._layers[a];u.type!=="custom"&&(t[a]=u.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const r=this._changed;if(this._changed){const u=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(u.length||d.length)&&this._updateWorkerLayers(u,d);for(const g in this._updatedSources){const b=this._updatedSources[g];if(b==="reload")this._reloadSource(g);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(g)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const g in this._updatedPaintProps)this._layers[g].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const a={};for(const u in this.sourceCaches){const d=this.sourceCaches[u];a[u]=d.used,d.used=!1}for(const u of this._order){const d=this._layers[u];d.recalculate(t,this._availableImages),!d.isHidden(t.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const u in a){const d=this.sourceCaches[u];a[u]!==d.used&&d.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(t),this.z=t.zoom,r&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,r){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,r={}){this._checkLoaded();const a=this.serialize();if(t=r.transformStyle?r.transformStyle(a,t):t,bn(this,o.validateStyle(t)))return!1;(t=o.clone$1(t)).layers=o.derefLayers(t.layers);const u=o.diffStyles(a,t).filter(g=>!(g.command in Rr));if(u.length===0)return!1;const d=u.filter(g=>!(g.command in sl));if(d.length>0)throw new Error(`Unimplemented: ${d.map(g=>g.command).join(", ")}.`);for(const g of u)g.command!=="setTransition"&&this[g.command].apply(this,g.args);return this.stylesheet=t,!0}addImage(t,r){if(this.getImage(t))return this.fire(new o.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,r),this._afterImageUpdated(t)}updateImage(t,r){this.imageManager.updateImage(t,r)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new o.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,r,a={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(o.validateStyle.source,`sources.${t}`,r,null,a))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const u=this.sourceCaches[t]=new ai(t,r,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:t})),u.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===t)return this.fire(new o.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${a}" is using it.`)));const r=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],r.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,r){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const a=this.sourceCaches[t].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(r),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,r,a={}){this._checkLoaded();const u=t.id;if(this.getLayer(u))return void this.fire(new o.ErrorEvent(new Error(`Layer "${u}" already exists on this map.`)));let d;if(t.type==="custom"){if(bn(this,o.validateCustomStyleLayer(t)))return;d=o.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(u,t.source),t=o.clone$1(t),t=o.extend(t,{source:u})),this._validate(o.validateStyle.layer,`layers.${u}`,t,{arrayIndex:-1},a))return;d=o.createStyleLayer(t),this._validateLayer(d),d.setEventedParent(this,{layer:{id:u}})}const g=r?this._order.indexOf(r):this._order.length;if(r&&g===-1)this.fire(new o.ErrorEvent(new Error(`Cannot add layer "${u}" before non-existing layer "${r}".`)));else{if(this._order.splice(g,0,u),this._layerOrderChanged=!0,this._layers[u]=d,this._removedLayers[u]&&d.source&&d.type!=="custom"){const b=this._removedLayers[u];delete this._removedLayers[u],b.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(t,r){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===r)return;const a=this._order.indexOf(t);this._order.splice(a,1);const u=r?this._order.indexOf(r):this._order.length;r&&u===-1?this.fire(new o.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${r}".`))):(this._order.splice(u,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const r=this._layers[t];if(!r)return void this.fire(new o.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));r.setEventedParent(null);const a=this._order.indexOf(t);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=r,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],r.onRemove&&r.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,r,a){this._checkLoaded();const u=this.getLayer(t);u?u.minzoom===r&&u.maxzoom===a||(r!=null&&(u.minzoom=r),a!=null&&(u.maxzoom=a),this._updateLayer(u)):this.fire(new o.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,r,a={}){this._checkLoaded();const u=this.getLayer(t);if(u){if(!o.deepEqual(u.filter,r))return r==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(o.validateStyle.filter,`layers.${u.id}.filter`,r,null,a)||(u.filter=o.clone$1(r),this._updateLayer(u)))}else this.fire(new o.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return o.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,r,a,u={}){this._checkLoaded();const d=this.getLayer(t);d?o.deepEqual(d.getLayoutProperty(r),a)||(d.setLayoutProperty(r,a,u),this._updateLayer(d)):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,r){const a=this.getLayer(t);if(a)return a.getLayoutProperty(r);this.fire(new o.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,r,a,u={}){this._checkLoaded();const d=this.getLayer(t);d?o.deepEqual(d.getPaintProperty(r),a)||(d.setPaintProperty(r,a,u)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,r){return this.getLayer(t).getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const a=t.source,u=t.sourceLayer,d=this.sourceCaches[a];if(d===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const g=d.getSource().type;g==="geojson"&&u?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):g!=="vector"||u?(t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),d.setFeatureState(u,t.id,r)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,r){this._checkLoaded();const a=t.source,u=this.sourceCaches[a];if(u===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const d=u.getSource().type,g=d==="vector"?t.sourceLayer:void 0;d!=="vector"||g?r&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(g,t.id,r):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const r=t.source,a=t.sourceLayer,u=this.sourceCaches[r];if(u!==void 0)return u.getSource().type!=="vector"||a?(t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),u.getFeatureState(a,t.id)):void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t=o.mapObject(this.sourceCaches,u=>u.serialize()),r=this._serializeByIds(this._order),a=this.stylesheet;return o.filterObject({version:a.version,name:a.name,metadata:a.metadata,light:a.light,center:a.center,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch,sprite:a.sprite,glyphs:a.glyphs,transition:a.transition,sources:t,layers:r},u=>u!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const r=g=>this._layers[g].type==="fill-extrusion",a={},u=[];for(let g=this._order.length-1;g>=0;g--){const b=this._order[g];if(r(b)){a[b]=g;for(const v of t){const T=v[b];if(T)for(const M of T)u.push(M)}}}u.sort((g,b)=>b.intersectionZ-g.intersectionZ);const d=[];for(let g=this._order.length-1;g>=0;g--){const b=this._order[g];if(r(b))for(let v=u.length-1;v>=0;v--){const T=u[v].feature;if(a[T.layer.id]<g)break;d.push(T),u.pop()}else for(const v of t){const T=v[b];if(T)for(const M of T)d.push(M.feature)}}return d}queryRenderedFeatures(t,r,a){r&&r.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",r.filter,null,r);const u={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const b of r.layers){const v=this._layers[b];if(!v)return this.fire(new o.ErrorEvent(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];u[v.source]=!0}}const d=[];r.availableImages=this._availableImages;const g=this._serializedAllLayers();for(const b in this.sourceCaches)r.layers&&!u[b]||d.push(It(this.sourceCaches[b],this._layers,g,t,r,a));return this.placement&&d.push(function(b,v,T,M,A,F,Z){const $={},G=F.queryRenderedSymbols(M),K=[];for(const te of Object.keys(G).map(Number))K.push(Z[te]);K.sort(gi);for(const te of K){const ue=te.featureIndex.lookupSymbolFeatures(G[te.bucketInstanceId],v,te.bucketIndex,te.sourceLayerIndex,A.filter,A.layers,A.availableImages,b);for(const X in ue){const ce=$[X]=$[X]||[],ge=ue[X];ge.sort((Te,Me)=>{const ke=te.featureSortOrder;if(ke){const Ie=ke.indexOf(Te.featureIndex);return ke.indexOf(Me.featureIndex)-Ie}return Me.featureIndex-Te.featureIndex});for(const Te of ge)ce.push(Te)}}for(const te in $)$[te].forEach(ue=>{const X=ue.feature,ce=T[b[te].source].getFeatureState(X.layer["source-layer"],X.id);X.source=X.layer.source,X.layer["source-layer"]&&(X.sourceLayer=X.layer["source-layer"]),X.state=ce});return $}(this._layers,g,this.sourceCaches,t,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(t,r){r&&r.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",r.filter,null,r);const a=this.sourceCaches[t];return a?function(u,d){const g=u.getRenderableIds().map(T=>u.getTileByID(T)),b=[],v={};for(let T=0;T<g.length;T++){const M=g[T],A=M.tileID.canonical.key;v[A]||(v[A]=!0,M.querySourceFeatures(b,d))}return b}(a,r):[]}addSourceType(t,r,a){return nr.getSourceType(t)?a(new Error(`A source type called "${t}" already exists.`)):(nr.setSourceType(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},a):a(null,null))}getLight(){return this.light.getLight()}setLight(t,r={}){this._checkLoaded();const a=this.light.getLight();let u=!1;for(const g in t)if(!o.deepEqual(t[g],a[g])){u=!0;break}if(!u)return;const d={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,r),this.light.updateTransitions(d)}_validate(t,r,a,u,d={}){return(!d||d.validate!==!1)&&bn(this,t.call(o.validateStyle,o.extend({key:r,style:this.serialize(),value:a,styleSpec:o.v8Spec},u)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const a=this.sourceCaches[r];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const r in this.sourceCaches)this.sourceCaches[r].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,r,a,u,d=!1){let g=!1,b=!1;const v={};for(const T of this._order){const M=this._layers[T];if(M.type!=="symbol")continue;if(!v[M.source]){const F=this.sourceCaches[M.source];v[M.source]=F.getRenderableIds(!0).map(Z=>F.getTileByID(Z)).sort((Z,$)=>$.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan($.tileID)?-1:1))}const A=this.crossTileSymbolIndex.addLayer(M,v[M.source],t.center.lng);g=g||A}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),t.zoom))&&(this.pauseablePlacement=new Hs(t,this.map.terrain,this._order,d,r,a,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,v),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),b=!0),g&&this.pauseablePlacement.placement.setStale()),b||g)for(const T of this._order){const M=this._layers[T];M.type==="symbol"&&this.placement.updateLayerOpacities(M,v[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,r,a){this.imageManager.getImages(r.icons,a),this._updateTilesForChangedImages();const u=this.sourceCaches[r.source];u&&u.setDependencies(r.tileID.key,r.type,r.icons)}getGlyphs(t,r,a){this.glyphManager.getGlyphs(r.stacks,a);const u=this.sourceCaches[r.source];u&&u.setDependencies(r.tileID.key,r.type,[""])}getResource(t,r,a){return o.makeRequest(r,a)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,r={}){this._checkLoaded(),t&&this._validate(o.validateStyle.glyphs,"glyphs",t,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,r,a={},u){this._checkLoaded();const d=[{id:t,url:r}],g=[...At(this.stylesheet.sprite),...d];this._validate(o.validateStyle.sprite,"sprite",g,null,a)||(this.stylesheet.sprite=g,this._loadSprite(d,!0,u))}removeSprite(t){this._checkLoaded();const r=At(this.stylesheet.sprite);if(r.find(a=>a.id===t)){if(this._spritesImagesIds[t])for(const a of this._spritesImagesIds[t])this.imageManager.removeImage(a),this._changedImages[a]=!0;r.splice(r.findIndex(a=>a.id===t),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}else this.fire(new o.ErrorEvent(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return At(this.stylesheet.sprite)}setSprite(t,r={},a){this._checkLoaded(),t&&this._validate(o.validateStyle.sprite,"sprite",t,null,r)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,a):(this._unloadSprite(),a&&a(null)))}}nr.getSourceType=function(l){return qi[l]},nr.setSourceType=function(l,t){qi[l]=t},nr.registerForPluginStateChange=o.registerForPluginStateChange;var es=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),ts="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const jn={prelude:Ot(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ot(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ot(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ot(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ot("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ot(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ot(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ot("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ot("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ot("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ot(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ot(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ot(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ot(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ot(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ot(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ot(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ot(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ot(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ot(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ot(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ot("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ts),terrainDepth:Ot("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ts),terrainCoords:Ot("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ts)};function Ot(l,t){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=t.match(/attribute ([\w]+) ([\w]+)/g),u=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=d?d.concat(u):u,b={};return{fragmentSource:l=l.replace(r,(v,T,M,A,F)=>(b[F]=!0,T==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${M} ${A} ${F};
#else
uniform ${M} ${A} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${M} ${A} ${F} = u_${F};
#endif
`)),vertexSource:t=t.replace(r,(v,T,M,A,F)=>{const Z=A==="float"?"vec2":"vec4",$=F.match(/color/)?"color":Z;return b[F]?T==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${M} ${Z} a_${F};
varying ${M} ${A} ${F};
#else
uniform ${M} ${A} u_${F};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${M} ${A} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${M} ${A} ${F} = u_${F};
#endif
`:T==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${M} ${Z} a_${F};
#else
uniform ${M} ${A} u_${F};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${M} ${A} ${F} = a_${F};
#else
    ${M} ${A} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${M} ${A} ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${M} ${A} ${F} = u_${F};
#endif
`}),staticAttributes:a,staticUniforms:g}}class Xs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,r,a,u,d,g,b,v,T){this.context=t;let M=this.boundPaintVertexBuffers.length!==u.length;for(let A=0;!M&&A<u.length;A++)this.boundPaintVertexBuffers[A]!==u[A]&&(M=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==a||M||this.boundIndexBuffer!==d||this.boundVertexOffset!==g||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==v||this.boundDynamicVertexBuffer3!==T?this.freshBind(r,a,u,d,g,b,v,T):(t.bindVertexArray.set(this.vao),b&&b.bind(),d&&d.dynamicDraw&&d.bind(),v&&v.bind(),T&&T.bind())}freshBind(t,r,a,u,d,g,b,v){const T=t.numAttributes,M=this.context,A=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=u,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=g,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=v,r.enableAttributes(A,t);for(const F of a)F.enableAttributes(A,t);g&&g.enableAttributes(A,t),b&&b.enableAttributes(A,t),v&&v.enableAttributes(A,t),r.bind(),r.setVertexAttribPointers(A,t,d);for(const F of a)F.bind(),F.setVertexAttribPointers(A,t,d);g&&(g.bind(),g.setVertexAttribPointers(A,t,d)),u&&u.bind(),b&&(b.bind(),b.setVertexAttribPointers(A,t,d)),v&&(v.bind(),v.setVertexAttribPointers(A,t,d)),M.currentNumAttributes=T}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Jo(l){const t=[];for(let r=0;r<l.length;r++){if(l[r]===null)continue;const a=l[r].split(" ");t.push(a.pop())}return t}class xc{constructor(t,r,a,u,d,g,b){const v=t.gl;this.program=v.createProgram();const T=Jo(a.staticAttributes),M=u?u.getBinderAttributes():[],A=T.concat(M),F=jn.prelude.staticUniforms?Jo(jn.prelude.staticUniforms):[],Z=a.staticUniforms?Jo(a.staticUniforms):[],$=u?u.getBinderUniforms():[],G=F.concat(Z).concat($),K=[];for(const Me of G)K.indexOf(Me)<0&&K.push(Me);const te=u?u.defines():[];g&&te.push("#define OVERDRAW_INSPECTOR;"),b&&te.push("#define TERRAIN3D;");const ue=te.concat(jn.prelude.fragmentSource,a.fragmentSource).join(`
`),X=te.concat(jn.prelude.vertexSource,a.vertexSource).join(`
`),ce=v.createShader(v.FRAGMENT_SHADER);if(v.isContextLost())return void(this.failedToCreate=!0);v.shaderSource(ce,ue),v.compileShader(ce),v.attachShader(this.program,ce);const ge=v.createShader(v.VERTEX_SHADER);if(v.isContextLost())return void(this.failedToCreate=!0);v.shaderSource(ge,X),v.compileShader(ge),v.attachShader(this.program,ge),this.attributes={};const Te={};this.numAttributes=A.length;for(let Me=0;Me<this.numAttributes;Me++)A[Me]&&(v.bindAttribLocation(this.program,Me,A[Me]),this.attributes[A[Me]]=Me);v.linkProgram(this.program),v.deleteShader(ge),v.deleteShader(ce);for(let Me=0;Me<K.length;Me++){const ke=K[Me];if(ke&&!Te[ke]){const Ie=v.getUniformLocation(this.program,ke);Ie&&(Te[ke]=Ie)}}this.fixedUniforms=d(t,Te),this.terrainUniforms=((Me,ke)=>({u_depth:new o.Uniform1i(Me,ke.u_depth),u_terrain:new o.Uniform1i(Me,ke.u_terrain),u_terrain_dim:new o.Uniform1f(Me,ke.u_terrain_dim),u_terrain_matrix:new o.UniformMatrix4f(Me,ke.u_terrain_matrix),u_terrain_unpack:new o.Uniform4f(Me,ke.u_terrain_unpack),u_terrain_exaggeration:new o.Uniform1f(Me,ke.u_terrain_exaggeration)}))(t,Te),this.binderUniforms=u?u.getUniforms(t,Te):[]}draw(t,r,a,u,d,g,b,v,T,M,A,F,Z,$,G,K,te,ue){const X=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(a),t.setStencilMode(u),t.setColorMode(d),t.setCullFace(g),v){t.activeTexture.set(X.TEXTURE2),X.bindTexture(X.TEXTURE_2D,v.depthTexture),t.activeTexture.set(X.TEXTURE3),X.bindTexture(X.TEXTURE_2D,v.texture);for(const ge in this.terrainUniforms)this.terrainUniforms[ge].set(v[ge])}for(const ge in this.fixedUniforms)this.fixedUniforms[ge].set(b[ge]);G&&G.setUniforms(t,this.binderUniforms,Z,{zoom:$});let ce=0;switch(r){case X.LINES:ce=2;break;case X.TRIANGLES:ce=3;break;case X.LINE_STRIP:ce=1}for(const ge of F.get()){const Te=ge.vaos||(ge.vaos={});(Te[T]||(Te[T]=new Xs)).bind(t,this,M,G?G.getPaintVertexBuffers():[],A,ge.vertexOffset,K,te,ue),X.drawElements(r,ge.primitiveLength*ce,X.UNSIGNED_SHORT,ge.primitiveOffset*ce*2)}}}function Ys(l,t,r){const a=1/xe(r,1,t.transform.tileZoom),u=Math.pow(2,r.tileID.overscaledZ),d=r.tileSize*Math.pow(2,t.transform.tileZoom)/u,g=d*(r.tileID.canonical.x+r.tileID.wrap*u),b=d*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[a,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[g>>16,b>>16],u_pixel_coord_lower:[65535&g,65535&b]}}const ol=(l,t,r,a)=>{const u=t.style.light,d=u.properties.get("position"),g=[d.x,d.y,d.z],b=function(){var T=new o.ARRAY_TYPE(9);return o.ARRAY_TYPE!=Float32Array&&(T[1]=0,T[2]=0,T[3]=0,T[5]=0,T[6]=0,T[7]=0),T[0]=1,T[4]=1,T[8]=1,T}();u.properties.get("anchor")==="viewport"&&function(T,M){var A=Math.sin(M),F=Math.cos(M);T[0]=F,T[1]=A,T[2]=0,T[3]=-A,T[4]=F,T[5]=0,T[6]=0,T[7]=0,T[8]=1}(b,-t.transform.angle),function(T,M,A){var F=M[0],Z=M[1],$=M[2];T[0]=F*A[0]+Z*A[3]+$*A[6],T[1]=F*A[1]+Z*A[4]+$*A[7],T[2]=F*A[2]+Z*A[5]+$*A[8]}(g,g,b);const v=u.properties.get("color");return{u_matrix:l,u_lightpos:g,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[v.r,v.g,v.b],u_vertical_gradient:+r,u_opacity:a}},al=(l,t,r,a,u,d,g)=>o.extend(ol(l,t,r,a),Ys(d,t,g),{u_height_factor:-Math.pow(2,u.overscaledZ)/g.tileSize/8}),ll=l=>({u_matrix:l}),Qo=(l,t,r,a)=>o.extend(ll(l),Ys(r,t,a)),vc=(l,t)=>({u_matrix:l,u_world:t}),ea=(l,t,r,a,u)=>o.extend(Qo(l,t,r,a),{u_world:u}),cl=(l,t,r,a)=>{const u=l.transform;let d,g;if(a.paint.get("circle-pitch-alignment")==="map"){const b=xe(r,1,u.zoom);d=!0,g=[b,b]}else d=!1,g=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(t.posMatrix,r,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:l.pixelRatio,u_extrude_scale:g}},ul=(l,t,r)=>{const a=xe(r,1,t.zoom),u=Math.pow(2,t.zoom-r.tileID.overscaledZ),d=r.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:a,u_extrude_scale:[t.pixelsToGLUnits[0]/(a*u),t.pixelsToGLUnits[1]/(a*u)],u_overscale_factor:d}},ta=(l,t,r=1)=>({u_matrix:l,u_color:t,u_overlay:0,u_overlay_scale:r}),ia=l=>({u_matrix:l}),Nr=(l,t,r,a)=>({u_matrix:l,u_extrude_scale:xe(t,1,r),u_intensity:a});function Ks(l,t){const r=Math.pow(2,t.canonical.z),a=t.canonical.y;return[new o.MercatorCoordinate(0,a/r).toLngLat().lat,new o.MercatorCoordinate(0,(a+1)/r).toLngLat().lat]}const wn=(l,t,r,a)=>{const u=l.transform;return{u_matrix:ws(l,t,r,a),u_ratio:1/xe(t,1,u.zoom),u_device_pixel_ratio:l.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},Js=(l,t,r,a,u)=>o.extend(wn(l,t,r,u),{u_image:0,u_image_height:a}),Qs=(l,t,r,a,u)=>{const d=l.transform,g=bs(t,d);return{u_matrix:ws(l,t,r,u),u_texsize:t.imageAtlasTexture.size,u_ratio:1/xe(t,1,d.zoom),u_device_pixel_ratio:l.pixelRatio,u_image:0,u_scale:[g,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},vs=(l,t,r,a,u,d)=>{const g=l.lineAtlas,b=bs(t,l.transform),v=r.layout.get("line-cap")==="round",T=g.getDash(a.from,v),M=g.getDash(a.to,v),A=T.width*u.fromScale,F=M.width*u.toScale;return o.extend(wn(l,t,r,d),{u_patternscale_a:[b/A,-T.height/2],u_patternscale_b:[b/F,-M.height/2],u_sdfgamma:g.width/(256*Math.min(A,F)*l.pixelRatio)/2,u_image:0,u_tex_y_a:T.y,u_tex_y_b:M.y,u_mix:u.t})};function bs(l,t){return 1/xe(l,1,t.tileZoom)}function ws(l,t,r,a){return l.translatePosMatrix(a?a.posMatrix:t.tileID.posMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Ts=(l,t,r,a,u)=>{return{u_matrix:l,u_tl_parent:t,u_scale_parent:r,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(g=u.paint.get("raster-saturation"),g>0?1-1/(1.001-g):-g),u_contrast_factor:(d=u.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:Ss(u.paint.get("raster-hue-rotate"))};var d,g};function Ss(l){l*=Math.PI/180;const t=Math.sin(l),r=Math.cos(l);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Es=(l,t,r,a,u,d,g,b,v,T)=>{const M=u.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:M.cameraToCenterDistance,u_pitch:M.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:M.width/M.height,u_fade_change:u.options.fadeDuration?u.symbolFadeChange:1,u_matrix:d,u_label_plane_matrix:g,u_coord_matrix:b,u_is_text:+v,u_pitch_with_map:+a,u_texsize:T,u_texture:0}},Tn=(l,t,r,a,u,d,g,b,v,T,M)=>{const A=u.transform;return o.extend(Es(l,t,r,a,u,d,g,b,v,T),{u_gamma_scale:a?Math.cos(A._pitch)*A.cameraToCenterDistance:1,u_device_pixel_ratio:u.pixelRatio,u_is_halo:+M})},Ln=(l,t,r,a,u,d,g,b,v,T)=>o.extend(Tn(l,t,r,a,u,d,g,b,!0,v,!0),{u_texsize_icon:T,u_texture_icon:1}),na=(l,t,r)=>({u_matrix:l,u_opacity:t,u_color:r}),eo=(l,t,r,a,u,d)=>o.extend(function(g,b,v,T){const M=v.imageManager.getPattern(g.from.toString()),A=v.imageManager.getPattern(g.to.toString()),{width:F,height:Z}=v.imageManager.getPixelSize(),$=Math.pow(2,T.tileID.overscaledZ),G=T.tileSize*Math.pow(2,v.transform.tileZoom)/$,K=G*(T.tileID.canonical.x+T.tileID.wrap*$),te=G*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:A.tl,u_pattern_br_b:A.br,u_texsize:[F,Z],u_mix:b.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:A.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/xe(T,1,v.transform.tileZoom),u_pixel_coord_upper:[K>>16,te>>16],u_pixel_coord_lower:[65535&K,65535&te]}}(a,d,r,u),{u_matrix:l,u_opacity:t}),to={fillExtrusion:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_lightpos:new o.Uniform3f(l,t.u_lightpos),u_lightintensity:new o.Uniform1f(l,t.u_lightintensity),u_lightcolor:new o.Uniform3f(l,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(l,t.u_vertical_gradient),u_opacity:new o.Uniform1f(l,t.u_opacity)}),fillExtrusionPattern:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_lightpos:new o.Uniform3f(l,t.u_lightpos),u_lightintensity:new o.Uniform1f(l,t.u_lightintensity),u_lightcolor:new o.Uniform3f(l,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(l,t.u_vertical_gradient),u_height_factor:new o.Uniform1f(l,t.u_height_factor),u_image:new o.Uniform1i(l,t.u_image),u_texsize:new o.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(l,t.u_scale),u_fade:new o.Uniform1f(l,t.u_fade),u_opacity:new o.Uniform1f(l,t.u_opacity)}),fill:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix)}),fillPattern:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_image:new o.Uniform1i(l,t.u_image),u_texsize:new o.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(l,t.u_scale),u_fade:new o.Uniform1f(l,t.u_fade)}),fillOutline:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_world:new o.Uniform2f(l,t.u_world)}),fillOutlinePattern:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_world:new o.Uniform2f(l,t.u_world),u_image:new o.Uniform1i(l,t.u_image),u_texsize:new o.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(l,t.u_scale),u_fade:new o.Uniform1f(l,t.u_fade)}),circle:(l,t)=>({u_camera_to_center_distance:new o.Uniform1f(l,t.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(l,t.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(l,t.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(l,t.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(l,t.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(l,t.u_matrix)}),collisionBox:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_camera_to_center_distance:new o.Uniform1f(l,t.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(l,t.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(l,t.u_extrude_scale),u_overscale_factor:new o.Uniform1f(l,t.u_overscale_factor)}),collisionCircle:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_inv_matrix:new o.UniformMatrix4f(l,t.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(l,t.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(l,t.u_viewport_size)}),debug:(l,t)=>({u_color:new o.UniformColor(l,t.u_color),u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_overlay:new o.Uniform1i(l,t.u_overlay),u_overlay_scale:new o.Uniform1f(l,t.u_overlay_scale)}),clippingMask:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix)}),heatmap:(l,t)=>({u_extrude_scale:new o.Uniform1f(l,t.u_extrude_scale),u_intensity:new o.Uniform1f(l,t.u_intensity),u_matrix:new o.UniformMatrix4f(l,t.u_matrix)}),heatmapTexture:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_world:new o.Uniform2f(l,t.u_world),u_image:new o.Uniform1i(l,t.u_image),u_color_ramp:new o.Uniform1i(l,t.u_color_ramp),u_opacity:new o.Uniform1f(l,t.u_opacity)}),hillshade:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_image:new o.Uniform1i(l,t.u_image),u_latrange:new o.Uniform2f(l,t.u_latrange),u_light:new o.Uniform2f(l,t.u_light),u_shadow:new o.UniformColor(l,t.u_shadow),u_highlight:new o.UniformColor(l,t.u_highlight),u_accent:new o.UniformColor(l,t.u_accent)}),hillshadePrepare:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_image:new o.Uniform1i(l,t.u_image),u_dimension:new o.Uniform2f(l,t.u_dimension),u_zoom:new o.Uniform1f(l,t.u_zoom),u_unpack:new o.Uniform4f(l,t.u_unpack)}),line:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_ratio:new o.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(l,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(l,t.u_units_to_pixels)}),lineGradient:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_ratio:new o.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(l,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(l,t.u_units_to_pixels),u_image:new o.Uniform1i(l,t.u_image),u_image_height:new o.Uniform1f(l,t.u_image_height)}),linePattern:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_texsize:new o.Uniform2f(l,t.u_texsize),u_ratio:new o.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(l,t.u_device_pixel_ratio),u_image:new o.Uniform1i(l,t.u_image),u_units_to_pixels:new o.Uniform2f(l,t.u_units_to_pixels),u_scale:new o.Uniform3f(l,t.u_scale),u_fade:new o.Uniform1f(l,t.u_fade)}),lineSDF:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_ratio:new o.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(l,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(l,t.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(l,t.u_patternscale_a),u_patternscale_b:new o.Uniform2f(l,t.u_patternscale_b),u_sdfgamma:new o.Uniform1f(l,t.u_sdfgamma),u_image:new o.Uniform1i(l,t.u_image),u_tex_y_a:new o.Uniform1f(l,t.u_tex_y_a),u_tex_y_b:new o.Uniform1f(l,t.u_tex_y_b),u_mix:new o.Uniform1f(l,t.u_mix)}),raster:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_tl_parent:new o.Uniform2f(l,t.u_tl_parent),u_scale_parent:new o.Uniform1f(l,t.u_scale_parent),u_buffer_scale:new o.Uniform1f(l,t.u_buffer_scale),u_fade_t:new o.Uniform1f(l,t.u_fade_t),u_opacity:new o.Uniform1f(l,t.u_opacity),u_image0:new o.Uniform1i(l,t.u_image0),u_image1:new o.Uniform1i(l,t.u_image1),u_brightness_low:new o.Uniform1f(l,t.u_brightness_low),u_brightness_high:new o.Uniform1f(l,t.u_brightness_high),u_saturation_factor:new o.Uniform1f(l,t.u_saturation_factor),u_contrast_factor:new o.Uniform1f(l,t.u_contrast_factor),u_spin_weights:new o.Uniform3f(l,t.u_spin_weights)}),symbolIcon:(l,t)=>({u_is_size_zoom_constant:new o.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(l,t.u_size_t),u_size:new o.Uniform1f(l,t.u_size),u_camera_to_center_distance:new o.Uniform1f(l,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(l,t.u_pitch),u_rotate_symbol:new o.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(l,t.u_fade_change),u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new o.Uniform1i(l,t.u_is_text),u_pitch_with_map:new o.Uniform1i(l,t.u_pitch_with_map),u_texsize:new o.Uniform2f(l,t.u_texsize),u_texture:new o.Uniform1i(l,t.u_texture)}),symbolSDF:(l,t)=>({u_is_size_zoom_constant:new o.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(l,t.u_size_t),u_size:new o.Uniform1f(l,t.u_size),u_camera_to_center_distance:new o.Uniform1f(l,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(l,t.u_pitch),u_rotate_symbol:new o.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(l,t.u_fade_change),u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new o.Uniform1i(l,t.u_is_text),u_pitch_with_map:new o.Uniform1i(l,t.u_pitch_with_map),u_texsize:new o.Uniform2f(l,t.u_texsize),u_texture:new o.Uniform1i(l,t.u_texture),u_gamma_scale:new o.Uniform1f(l,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(l,t.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(l,t.u_is_halo)}),symbolTextAndIcon:(l,t)=>({u_is_size_zoom_constant:new o.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(l,t.u_size_t),u_size:new o.Uniform1f(l,t.u_size),u_camera_to_center_distance:new o.Uniform1f(l,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(l,t.u_pitch),u_rotate_symbol:new o.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(l,t.u_fade_change),u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new o.Uniform1i(l,t.u_is_text),u_pitch_with_map:new o.Uniform1i(l,t.u_pitch_with_map),u_texsize:new o.Uniform2f(l,t.u_texsize),u_texsize_icon:new o.Uniform2f(l,t.u_texsize_icon),u_texture:new o.Uniform1i(l,t.u_texture),u_texture_icon:new o.Uniform1i(l,t.u_texture_icon),u_gamma_scale:new o.Uniform1f(l,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(l,t.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(l,t.u_is_halo)}),background:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_opacity:new o.Uniform1f(l,t.u_opacity),u_color:new o.UniformColor(l,t.u_color)}),backgroundPattern:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_opacity:new o.Uniform1f(l,t.u_opacity),u_image:new o.Uniform1i(l,t.u_image),u_pattern_tl_a:new o.Uniform2f(l,t.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(l,t.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(l,t.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(l,t.u_pattern_br_b),u_texsize:new o.Uniform2f(l,t.u_texsize),u_mix:new o.Uniform1f(l,t.u_mix),u_pattern_size_a:new o.Uniform2f(l,t.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(l,t.u_pattern_size_b),u_scale_a:new o.Uniform1f(l,t.u_scale_a),u_scale_b:new o.Uniform1f(l,t.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(l,t.u_tile_units_to_pixels)}),terrain:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_texture:new o.Uniform1i(l,t.u_texture),u_ele_delta:new o.Uniform1f(l,t.u_ele_delta)}),terrainDepth:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_ele_delta:new o.Uniform1f(l,t.u_ele_delta)}),terrainCoords:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_texture:new o.Uniform1i(l,t.u_texture),u_terrain_coords_id:new o.Uniform1f(l,t.u_terrain_coords_id),u_ele_delta:new o.Uniform1f(l,t.u_ele_delta)})};class ra{constructor(t,r,a){this.context=t;const u=t.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const sa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class io{constructor(t,r,a,u){this.length=r.length,this.attributes=a,this.itemSize=r.bytesPerElement,this.dynamicDraw=u,this.context=t;const d=t.gl;this.buffer=d.createBuffer(),t.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let a=0;a<this.attributes.length;a++){const u=r.attributes[this.attributes[a].name];u!==void 0&&t.enableVertexAttribArray(u)}}setVertexAttribPointers(t,r,a){for(let u=0;u<this.attributes.length;u++){const d=this.attributes[u],g=r.attributes[d.name];g!==void 0&&t.vertexAttribPointer(g,d.components,t[sa[d.type]],!1,this.itemSize,d.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Pt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class oa extends Pt{getDefault(){return o.Color.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class no extends Pt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class hl extends Pt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class pl extends Pt{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class is extends Pt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class bc extends Pt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class wc extends Pt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Tc extends Pt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Sc extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Ec extends Pt{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ic extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class aa extends Pt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ro extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class la extends Pt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class ca extends Pt{getDefault(){return o.Color.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ns extends Pt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class dl extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class fl extends Pt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ua extends Pt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class $r extends Pt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ml extends Pt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class rs extends Pt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ss extends Pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class gl extends Pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ha extends Pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ut extends Pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class so extends Pt{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ac extends Pt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class _l extends Pt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Is extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Mc extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class pa extends Pt{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class yl extends pa{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Cc extends pa{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class da extends pa{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class oo{constructor(t,r,a,u,d){this.context=t,this.width=r,this.height=a;const g=t.gl,b=this.framebuffer=g.createFramebuffer();if(this.colorAttachment=new yl(t,b),u)this.depthAttachment=d?new da(t,b):new Cc(t,b);else if(d)throw new Error("Stencil cannot be setted without depth");if(g.checkFramebufferStatus(g.FRAMEBUFFER)!==g.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,r=this.colorAttachment.get();if(r&&t.deleteTexture(r),this.depthAttachment){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}t.deleteFramebuffer(this.framebuffer)}}class si{constructor(t,r,a){this.blendFunction=t,this.blendColor=r,this.mask=a}}si.Replace=[1,0],si.disabled=new si(si.Replace,o.Color.transparent,[!1,!1,!1,!1]),si.unblended=new si(si.Replace,o.Color.transparent,[!0,!0,!0,!0]),si.alphaBlended=new si([1,771],o.Color.transparent,[!0,!0,!0,!0]);class fa{constructor(t){this.gl=t,this.clearColor=new oa(this),this.clearDepth=new no(this),this.clearStencil=new hl(this),this.colorMask=new pl(this),this.depthMask=new is(this),this.stencilMask=new bc(this),this.stencilFunc=new wc(this),this.stencilOp=new Tc(this),this.stencilTest=new Sc(this),this.depthRange=new Ec(this),this.depthTest=new Ic(this),this.depthFunc=new aa(this),this.blend=new ro(this),this.blendFunc=new la(this),this.blendColor=new ca(this),this.blendEquation=new ns(this),this.cullFace=new dl(this),this.cullFaceSide=new fl(this),this.frontFace=new ua(this),this.program=new $r(this),this.activeTexture=new ml(this),this.viewport=new rs(this),this.bindFramebuffer=new ss(this),this.bindRenderbuffer=new gl(this),this.bindTexture=new ha(this),this.bindVertexBuffer=new Ut(this),this.bindElementBuffer=new so(this),this.bindVertexArray=new Ac(this),this.pixelStoreUnpack=new _l(this),this.pixelStoreUnpackPremultiplyAlpha=new Is(this),this.pixelStoreUnpackFlipY=new Mc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.HALF_FLOAT=t.HALF_FLOAT,t.getExtension("EXT_color_buffer_half_float"),this.RGBA16F=t.RGBA16F,this.RGB16F=t.RGB16F}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r){return new ra(this,t,r)}createVertexBuffer(t,r,a){return new io(this,t,r,a)}createRenderbuffer(t,r,a){const u=this.gl,d=u.createRenderbuffer();return this.bindRenderbuffer.set(d),u.renderbufferStorage(u.RENDERBUFFER,t,r,a),this.bindRenderbuffer.set(null),d}createFramebuffer(t,r,a,u){return new oo(this,t,r,a,u)}clear({color:t,depth:r,stencil:a}){const u=this.gl;let d=0;t&&(d|=u.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(d|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),a!==void 0&&(d|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),u.clear(d)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.deepEqual(t.blendFunction,si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){return this.gl.createVertexArray()}deleteVertexArray(t){return this.gl.deleteVertexArray(t)}unbindVAO(){this.bindVertexArray.set(null)}}class St{constructor(t,r,a){this.func=t,this.mask=r,this.range=a}}St.ReadOnly=!1,St.ReadWrite=!0,St.disabled=new St(519,St.ReadOnly,[0,1]);const ao=7680;class Gt{constructor(t,r,a,u,d,g){this.test=t,this.ref=r,this.mask=a,this.fail=u,this.depthFail=d,this.pass=g}}Gt.disabled=new Gt({func:519,mask:0},0,0,ao,ao,ao);class qt{constructor(t,r,a){this.enable=t,this.mode=r,this.frontFace=a}}let os;function xl(l,t,r,a,u,d,g){const b=l.context,v=b.gl,T=l.useProgram("collisionBox"),M=[];let A=0,F=0;for(let X=0;X<a.length;X++){const ce=a[X],ge=t.getTile(ce),Te=ge.getBucket(r);if(!Te)continue;let Me=ce.posMatrix;u[0]===0&&u[1]===0||(Me=l.translatePosMatrix(ce.posMatrix,ge,u,d));const ke=g?Te.textCollisionBox:Te.iconCollisionBox,Ie=Te.collisionCircleArray;if(Ie.length>0){const Ze=o.create(),at=Me;o.mul(Ze,Te.placementInvProjMatrix,l.transform.glCoordMatrix),o.mul(Ze,Ze,Te.placementViewportMatrix),M.push({circleArray:Ie,circleOffset:F,transform:at,invTransform:Ze,coord:ce}),A+=Ie.length/4,F=A}ke&&T.draw(b,v.LINES,St.disabled,Gt.disabled,l.colorModeForRenderPass(),qt.disabled,ul(Me,l.transform,ge),l.style.map.terrain&&l.style.map.terrain.getTerrainData(ce),r.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,null,l.transform.zoom,null,null,ke.collisionVertexBuffer)}if(!g||!M.length)return;const Z=l.useProgram("collisionCircle"),$=new o.CollisionCircleLayoutArray;$.resize(4*A),$._trim();let G=0;for(const X of M)for(let ce=0;ce<X.circleArray.length/4;ce++){const ge=4*ce,Te=X.circleArray[ge+0],Me=X.circleArray[ge+1],ke=X.circleArray[ge+2],Ie=X.circleArray[ge+3];$.emplace(G++,Te,Me,ke,Ie,0),$.emplace(G++,Te,Me,ke,Ie,1),$.emplace(G++,Te,Me,ke,Ie,2),$.emplace(G++,Te,Me,ke,Ie,3)}(!os||os.length<2*A)&&(os=function(X){const ce=2*X,ge=new o.QuadTriangleArray;ge.resize(ce),ge._trim();for(let Te=0;Te<ce;Te++){const Me=6*Te;ge.uint16[Me+0]=4*Te+0,ge.uint16[Me+1]=4*Te+1,ge.uint16[Me+2]=4*Te+2,ge.uint16[Me+3]=4*Te+2,ge.uint16[Me+4]=4*Te+3,ge.uint16[Me+5]=4*Te+0}return ge}(A));const K=b.createIndexBuffer(os,!0),te=b.createVertexBuffer($,o.collisionCircleLayout.members,!0);for(const X of M){const ce={u_matrix:X.transform,u_inv_matrix:X.invTransform,u_camera_to_center_distance:(ue=l.transform).cameraToCenterDistance,u_viewport_size:[ue.width,ue.height]};Z.draw(b,v.TRIANGLES,St.disabled,Gt.disabled,l.colorModeForRenderPass(),qt.disabled,ce,l.style.map.terrain&&l.style.map.terrain.getTerrainData(X.coord),r.id,te,K,o.SegmentVector.simpleSegment(0,2*X.circleOffset,X.circleArray.length,X.circleArray.length/2),null,l.transform.zoom,null,null,null)}var ue;te.destroy(),K.destroy()}qt.disabled=new qt(!1,1029,2305),qt.backCCW=new qt(!0,1029,2305);const ma=o.identity(new Float32Array(16));function Pc(l,t,r,a,u,d){const{horizontalAlign:g,verticalAlign:b}=o.getAnchorAlignment(l),v=-(g-.5)*t,T=-(b-.5)*r,M=o.evaluateVariableOffset(l,a);return new o.Point((v/u+M[0])*d,(T/u+M[1])*d)}function vl(l,t,r,a,u,d,g,b,v,T,M){const A=l.text.placedSymbolArray,F=l.text.dynamicLayoutVertexArray,Z=l.icon.dynamicLayoutVertexArray,$={};F.clear();for(let G=0;G<A.length;G++){const K=A.get(G),te=K.hidden||!K.crossTileID||l.allowVerticalPlacement&&!K.placedOrientation?null:a[K.crossTileID];if(te){const ue=new o.Point(K.anchorX,K.anchorY),X=rt(ue,r?g:d,M),ce=Zi(u.cameraToCenterDistance,X.signedDistanceFromCamera);let ge=o.evaluateSizeForFeature(l.textSizeData,v,K)*ce/o.ONE_EM;r&&(ge*=l.tilePixelRatio/b);const{width:Te,height:Me,anchor:ke,textOffset:Ie,textBoxScale:Ze}=te,at=Pc(ke,Te,Me,Ie,Ze,ge),mt=r?rt(ue.add(at),d,M).point:X.point.add(t?at.rotate(-u.angle):at),Fe=l.allowVerticalPlacement&&K.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let ut=0;ut<K.numGlyphs;ut++)o.addDynamicAttributes(F,mt,Fe);T&&K.associatedIconIndex>=0&&($[K.associatedIconIndex]={shiftedAnchor:mt,angle:Fe})}else re(K.numGlyphs,F)}if(T){Z.clear();const G=l.icon.placedSymbolArray;for(let K=0;K<G.length;K++){const te=G.get(K);if(te.hidden)re(te.numGlyphs,Z);else{const ue=$[K];if(ue)for(let X=0;X<te.numGlyphs;X++)o.addDynamicAttributes(Z,ue.shiftedAnchor,ue.angle);else re(te.numGlyphs,Z)}}l.icon.dynamicLayoutVertexBuffer.updateData(Z)}l.text.dynamicLayoutVertexBuffer.updateData(F)}function lo(l,t,r){return r.iconsInText&&t?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function co(l,t,r,a,u,d,g,b,v,T,M,A){const F=l.context,Z=F.gl,$=l.transform,G=b==="map",K=v==="map",te=b!=="viewport"&&r.layout.get("symbol-placement")!=="point",ue=G&&!K&&!te,X=!r.layout.get("symbol-sort-key").isConstant();let ce=!1;const ge=l.depthModeForSublayer(0,St.ReadOnly),Te=r.layout.get("text-variable-anchor"),Me=[];for(const ke of a){const Ie=t.getTile(ke),Ze=Ie.getBucket(r);if(!Ze)continue;const at=u?Ze.text:Ze.icon;if(!at||!at.segments.get().length||!at.hasVisibleVertices)continue;const mt=at.programConfigurations.get(r.id),Fe=u||Ze.sdfIcons,ut=u?Ze.textSizeData:Ze.iconSizeData,He=K||$.pitch!==0,kt=l.useProgram(lo(Fe,u,Ze),mt),vi=o.evaluateSizeForZoom(ut,$.zoom),zt=l.style.map.terrain&&l.style.map.terrain.getTerrainData(ke);let _t,ci,un,bi,Oi=[0,0],Rn=null;if(u)ci=Ie.glyphAtlasTexture,un=Z.LINEAR,_t=Ie.glyphAtlasTexture.size,Ze.iconsInText&&(Oi=Ie.imageAtlasTexture.size,Rn=Ie.imageAtlasTexture,bi=He||l.options.rotating||l.options.zooming||ut.kind==="composite"||ut.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const zi=r.layout.get("icon-size").constantOr(0)!==1||Ze.iconsNeedLinear;ci=Ie.imageAtlasTexture,un=Fe||l.options.rotating||l.options.zooming||zi||He?Z.LINEAR:Z.NEAREST,_t=Ie.imageAtlasTexture.size}const rr=xe(Ie,1,l.transform.zoom),sr=jt(ke.posMatrix,K,G,l.transform,rr),hn=Qi(ke.posMatrix,K,G,l.transform,rr),vr=Te&&Ze.hasTextData(),Us=r.layout.get("icon-text-fit")!=="none"&&vr&&Ze.hasIconData();if(te){const zi=l.style.map.terrain?(zo,Mr)=>l.style.map.terrain.getElevation(ke,zo,Mr):null,Bn=r.layout.get("text-rotation-alignment")==="map";tr(Ze,ke.posMatrix,l,u,sr,hn,K,T,Bn,zi)}const tn=l.translatePosMatrix(ke.posMatrix,Ie,d,g),Ui=te||u&&Te||Us?ma:sr,Lt=l.translatePosMatrix(hn,Ie,d,g,!0),ki=Fe&&r.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Vi;Vi=Fe?Ze.iconsInText?Ln(ut.kind,vi,ue,K,l,tn,Ui,Lt,_t,Oi):Tn(ut.kind,vi,ue,K,l,tn,Ui,Lt,u,_t,!0):Es(ut.kind,vi,ue,K,l,tn,Ui,Lt,u,_t);const Bt={program:kt,buffers:at,uniformValues:Vi,atlasTexture:ci,atlasTextureIcon:Rn,atlasInterpolation:un,atlasInterpolationIcon:bi,isSDF:Fe,hasHalo:ki};if(X&&Ze.canOverlap){ce=!0;const zi=at.segments.get();for(const Bn of zi)Me.push({segments:new o.SegmentVector([Bn]),sortKey:Bn.sortKey,state:Bt,terrainData:zt})}else Me.push({segments:at.segments,sortKey:0,state:Bt,terrainData:zt})}ce&&Me.sort((ke,Ie)=>ke.sortKey-Ie.sortKey);for(const ke of Me){const Ie=ke.state;if(F.activeTexture.set(Z.TEXTURE0),Ie.atlasTexture.bind(Ie.atlasInterpolation,Z.CLAMP_TO_EDGE),Ie.atlasTextureIcon&&(F.activeTexture.set(Z.TEXTURE1),Ie.atlasTextureIcon&&Ie.atlasTextureIcon.bind(Ie.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Ie.isSDF){const Ze=Ie.uniformValues;Ie.hasHalo&&(Ze.u_is_halo=1,ga(Ie.buffers,ke.segments,r,l,Ie.program,ge,M,A,Ze,ke.terrainData)),Ze.u_is_halo=0}ga(Ie.buffers,ke.segments,r,l,Ie.program,ge,M,A,Ie.uniformValues,ke.terrainData)}}function ga(l,t,r,a,u,d,g,b,v,T){const M=a.context;u.draw(M,M.gl.TRIANGLES,d,g,b,qt.disabled,v,T,r.id,l.layoutVertexBuffer,l.indexBuffer,t,r.paint,a.transform.zoom,l.programConfigurations.get(r.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function _a(l,t,r,a,u){if(!r||!a||!a.imageAtlas)return;const d=a.imageAtlas.patternPositions;let g=d[r.to.toString()],b=d[r.from.toString()];if(!g||!b){const v=u.getPaintProperty(t);g=d[v],b=d[v]}g&&b&&l.setConstantPatternPositions(g,b)}function As(l,t,r,a,u,d,g){const b=l.context.gl,v="fill-pattern",T=r.paint.get(v),M=T&&T.constantOr(1),A=r.getCrossfadeParameters();let F,Z,$,G,K;g?(Z=M&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=b.LINES):(Z=M?"fillPattern":"fill",F=b.TRIANGLES);const te=T.constantOr(null);for(const ue of a){const X=t.getTile(ue);if(M&&!X.patternsLoaded())continue;const ce=X.getBucket(r);if(!ce)continue;const ge=ce.programConfigurations.get(r.id),Te=l.useProgram(Z,ge),Me=l.style.map.terrain&&l.style.map.terrain.getTerrainData(ue);M&&(l.context.activeTexture.set(b.TEXTURE0),X.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),ge.updatePaintBuffers(A)),_a(ge,v,te,X,r);const ke=Me?ue:null,Ie=l.translatePosMatrix(ke?ke.posMatrix:ue.posMatrix,X,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(g){G=ce.indexBuffer2,K=ce.segments2;const Ze=[b.drawingBufferWidth,b.drawingBufferHeight];$=Z==="fillOutlinePattern"&&M?ea(Ie,l,A,X,Ze):vc(Ie,Ze)}else G=ce.indexBuffer,K=ce.segments,$=M?Qo(Ie,l,A,X):ll(Ie);Te.draw(l.context,F,u,l.stencilModeForClipping(ue),d,qt.disabled,$,Me,r.id,ce.layoutVertexBuffer,G,K,r.paint,l.transform.zoom,ge)}}function Ms(l,t,r,a,u,d,g){const b=l.context,v=b.gl,T="fill-extrusion-pattern",M=r.paint.get(T),A=M.constantOr(1),F=r.getCrossfadeParameters(),Z=r.paint.get("fill-extrusion-opacity"),$=M.constantOr(null);for(const G of a){const K=t.getTile(G),te=K.getBucket(r);if(!te)continue;const ue=l.style.map.terrain&&l.style.map.terrain.getTerrainData(G),X=te.programConfigurations.get(r.id),ce=l.useProgram(A?"fillExtrusionPattern":"fillExtrusion",X);A&&(l.context.activeTexture.set(v.TEXTURE0),K.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),X.updatePaintBuffers(F)),_a(X,T,$,K,r);const ge=l.translatePosMatrix(G.posMatrix,K,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Te=r.paint.get("fill-extrusion-vertical-gradient"),Me=A?al(ge,l,Te,Z,G,F,K):ol(ge,l,Te,Z);ce.draw(b,b.gl.TRIANGLES,u,d,g,qt.backCCW,Me,ue,r.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,r.paint,l.transform.zoom,X,l.style.map.terrain&&te.centroidVertexBuffer)}}function kc(l,t,r,a,u,d,g){const b=l.context,v=b.gl,T=r.fbo;if(!T)return;const M=l.useProgram("hillshade"),A=l.style.map.terrain&&l.style.map.terrain.getTerrainData(t);b.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,T.colorAttachment.get()),M.draw(b,v.TRIANGLES,u,d,g,qt.disabled,((F,Z,$,G)=>{const K=$.paint.get("hillshade-shadow-color"),te=$.paint.get("hillshade-highlight-color"),ue=$.paint.get("hillshade-accent-color");let X=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);$.paint.get("hillshade-illumination-anchor")==="viewport"&&(X-=F.transform.angle);const ce=!F.options.moving;return{u_matrix:G?G.posMatrix:F.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),ce),u_image:0,u_latrange:Ks(0,Z.tileID),u_light:[$.paint.get("hillshade-exaggeration"),X],u_shadow:K,u_highlight:te,u_accent:ue}})(l,r,a,A?t:null),A,a.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}function bl(l,t,r,a,u,d){const g=l.context,b=g.gl,v=t.dem;if(v&&v.data){const T=v.dim,M=v.stride,A=v.getPixels();if(g.activeTexture.set(b.TEXTURE1),g.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(M),t.demTexture){const Z=t.demTexture;Z.update(A,{premultiply:!1}),Z.bind(b.NEAREST,b.CLAMP_TO_EDGE)}else t.demTexture=new yt(g,A,b.RGBA,{premultiply:!1}),t.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);g.activeTexture.set(b.TEXTURE0);let F=t.fbo;if(!F){const Z=new yt(g,{width:T,height:T,data:null},b.RGBA);Z.bind(b.LINEAR,b.CLAMP_TO_EDGE),F=t.fbo=g.createFramebuffer(T,T,!0,!1),F.colorAttachment.set(Z.texture)}g.bindFramebuffer.set(F.framebuffer),g.viewport.set([0,0,T,T]),l.useProgram("hillshadePrepare").draw(g,b.TRIANGLES,a,u,d,qt.disabled,((Z,$)=>{const G=$.stride,K=o.create();return o.ortho(K,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(K,K,[0,-o.EXTENT,0]),{u_matrix:K,u_image:1,u_dimension:[G,G],u_zoom:Z.overscaledZ,u_unpack:$.getUnpackVector()}})(t.tileID,v),null,r.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function xi(l,t,r,a,u,d){const g=a.paint.get("raster-fade-duration");if(!d&&g>0){const b=o.exported.now(),v=(b-l.timeAdded)/g,T=t?(b-t.timeAdded)/g:-1,M=r.getSource(),A=u.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),F=!t||Math.abs(t.tileID.overscaledZ-A)>Math.abs(l.tileID.overscaledZ-A),Z=F&&l.refreshedUponExpiration?1:o.clamp(F?v:1-T,0,1);return l.refreshedUponExpiration&&v>=1&&(l.refreshedUponExpiration=!1),t?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const jr=new o.Color(1,0,0,1),qn=new o.Color(0,1,0,1),wl=new o.Color(0,0,1,1),ya=new o.Color(1,0,1,1),Tl=new o.Color(0,1,1,1);function qr(l,t,r,a){as(l,0,t+r/2,l.transform.width,r,a)}function Cs(l,t,r,a){as(l,t-r/2,0,r,l.transform.height,a)}function as(l,t,r,a,u,d){const g=l.context,b=g.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*l.pixelRatio,r*l.pixelRatio,a*l.pixelRatio,u*l.pixelRatio),g.clear({color:d}),b.disable(b.SCISSOR_TEST)}function Sl(l,t,r){const a=l.context,u=a.gl,d=r.posMatrix,g=l.useProgram("debug"),b=St.disabled,v=Gt.disabled,T=l.colorModeForRenderPass(),M="$debug",A=l.style.map.terrain&&l.style.map.terrain.getTerrainData(r);a.activeTexture.set(u.TEXTURE0);const F=t.getTileByID(r.key).latestRawTileData,Z=Math.floor((F&&F.byteLength||0)/1024),$=t.getTile(r).tileSize,G=512/Math.min($,512)*(r.overscaledZ/l.transform.zoom)*.5;let K=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(K+=` => ${r.overscaledZ}`),function(te,ue){te.initDebugOverlayCanvas();const X=te.debugOverlayCanvas,ce=te.context.gl,ge=te.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,X.width,X.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(ue,5,5),ge.strokeText(ue,5,5),te.debugOverlayTexture.update(X),te.debugOverlayTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}(l,`${K} ${Z}kB`),g.draw(a,u.TRIANGLES,b,v,si.alphaBlended,qt.disabled,ta(d,o.Color.transparent,G),null,M,l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments),g.draw(a,u.LINE_STRIP,b,v,T,qt.disabled,ta(d,o.Color.red),A,M,l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments)}function xa(l,t,r){const a=l.context,u=a.gl,d=l.colorModeForRenderPass(),g=new St(u.LEQUAL,St.ReadWrite,l.depthRangeFor3D),b=l.useProgram("terrain"),v=t.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,l.width,l.height]);for(const T of r){const M=l.renderToTexture.getTexture(T),A=t.getTerrainData(T.tileID);a.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,M.texture);const F={u_matrix:l.transform.calculatePosMatrix(T.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(l.transform.zoom)};b.draw(a,u.TRIANGLES,g,Gt.disabled,d,qt.backCCW,F,A,"terrain",v.vertexBuffer,v.indexBuffer,v.segments)}}const va={symbol:function(l,t,r,a,u){if(l.renderPass!=="translucent")return;const d=Gt.disabled,g=l.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(b,v,T,M,A,F,Z){const $=v.transform,G=A==="map",K=F==="map";for(const te of b){const ue=M.getTile(te),X=ue.getBucket(T);if(!X||!X.text||!X.text.segments.get().length)continue;const ce=o.evaluateSizeForZoom(X.textSizeData,$.zoom),ge=xe(ue,1,v.transform.zoom),Te=jt(te.posMatrix,K,G,v.transform,ge),Me=T.layout.get("icon-text-fit")!=="none"&&X.hasIconData();if(ce){const ke=Math.pow(2,$.zoom-ue.tileID.overscaledZ);vl(X,G,K,Z,$,Te,te.posMatrix,ke,ce,Me,v.style.map.terrain?(Ie,Ze)=>v.style.map.terrain.getElevation(te,Ie,Ze):null)}}}(a,l,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),u),r.paint.get("icon-opacity").constantOr(1)!==0&&co(l,t,r,a,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),d,g),r.paint.get("text-opacity").constantOr(1)!==0&&co(l,t,r,a,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),d,g),t.map.showCollisionBoxes&&(xl(l,t,r,a,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),xl(l,t,r,a,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,r,a){if(l.renderPass!=="translucent")return;const u=r.paint.get("circle-opacity"),d=r.paint.get("circle-stroke-width"),g=r.paint.get("circle-stroke-opacity"),b=!r.layout.get("circle-sort-key").isConstant();if(u.constantOr(1)===0&&(d.constantOr(1)===0||g.constantOr(1)===0))return;const v=l.context,T=v.gl,M=l.depthModeForSublayer(0,St.ReadOnly),A=Gt.disabled,F=l.colorModeForRenderPass(),Z=[];for(let $=0;$<a.length;$++){const G=a[$],K=t.getTile(G),te=K.getBucket(r);if(!te)continue;const ue=te.programConfigurations.get(r.id),X=l.useProgram("circle",ue),ce=te.layoutVertexBuffer,ge=te.indexBuffer,Te=l.style.map.terrain&&l.style.map.terrain.getTerrainData(G),Me={programConfiguration:ue,program:X,layoutVertexBuffer:ce,indexBuffer:ge,uniformValues:cl(l,G,K,r),terrainData:Te};if(b){const ke=te.segments.get();for(const Ie of ke)Z.push({segments:new o.SegmentVector([Ie]),sortKey:Ie.sortKey,state:Me})}else Z.push({segments:te.segments,sortKey:0,state:Me})}b&&Z.sort(($,G)=>$.sortKey-G.sortKey);for(const $ of Z){const{programConfiguration:G,program:K,layoutVertexBuffer:te,indexBuffer:ue,uniformValues:X,terrainData:ce}=$.state;K.draw(v,T.TRIANGLES,M,A,F,qt.disabled,X,ce,r.id,te,ue,$.segments,r.paint,l.transform.zoom,G)}},heatmap:function(l,t,r,a){if(r.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const u=l.context,d=u.gl,g=Gt.disabled,b=new si([d.ONE,d.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(v,T,M){const A=v.gl;v.activeTexture.set(A.TEXTURE1),v.viewport.set([0,0,T.width/4,T.height/4]);let F=M.heatmapFbo;if(F)A.bindTexture(A.TEXTURE_2D,F.colorAttachment.get()),v.bindFramebuffer.set(F.framebuffer);else{const Z=A.createTexture();A.bindTexture(A.TEXTURE_2D,Z),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR),F=M.heatmapFbo=v.createFramebuffer(T.width/4,T.height/4,!1,!1),function($,G,K,te){var ue,X;const ce=$.gl,ge=(ue=$.HALF_FLOAT)!==null&&ue!==void 0?ue:ce.UNSIGNED_BYTE,Te=(X=$.RGBA16F)!==null&&X!==void 0?X:ce.RGBA;ce.texImage2D(ce.TEXTURE_2D,0,Te,G.width/4,G.height/4,0,ce.RGBA,ge,null),te.colorAttachment.set(K)}(v,T,Z,F)}})(u,l,r),u.clear({color:o.Color.transparent});for(let v=0;v<a.length;v++){const T=a[v];if(t.hasRenderableParent(T))continue;const M=t.getTile(T),A=M.getBucket(r);if(!A)continue;const F=A.programConfigurations.get(r.id),Z=l.useProgram("heatmap",F),{zoom:$}=l.transform;Z.draw(u,d.TRIANGLES,St.disabled,g,b,qt.disabled,Nr(T.posMatrix,M,$,r.paint.get("heatmap-intensity")),null,r.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,r.paint,l.transform.zoom,F)}u.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(u,d){const g=u.context,b=g.gl,v=d.heatmapFbo;if(!v)return;g.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,v.colorAttachment.get()),g.activeTexture.set(b.TEXTURE1);let T=d.colorRampTexture;T||(T=d.colorRampTexture=new yt(g,d.colorRamp,b.RGBA)),T.bind(b.LINEAR,b.CLAMP_TO_EDGE),u.useProgram("heatmapTexture").draw(g,b.TRIANGLES,St.disabled,Gt.disabled,u.colorModeForRenderPass(),qt.disabled,((M,A,F,Z)=>{const $=o.create();o.ortho($,0,M.width,M.height,0,0,1);const G=M.context.gl;return{u_matrix:$,u_world:[G.drawingBufferWidth,G.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:A.paint.get("heatmap-opacity")}})(u,d),null,d.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments,d.paint,u.transform.zoom)}(l,r))},line:function(l,t,r,a){if(l.renderPass!=="translucent")return;const u=r.paint.get("line-opacity"),d=r.paint.get("line-width");if(u.constantOr(1)===0||d.constantOr(1)===0)return;const g=l.depthModeForSublayer(0,St.ReadOnly),b=l.colorModeForRenderPass(),v=r.paint.get("line-dasharray"),T=r.paint.get("line-pattern"),M=T.constantOr(1),A=r.paint.get("line-gradient"),F=r.getCrossfadeParameters(),Z=M?"linePattern":v?"lineSDF":A?"lineGradient":"line",$=l.context,G=$.gl;let K=!0;for(const te of a){const ue=t.getTile(te);if(M&&!ue.patternsLoaded())continue;const X=ue.getBucket(r);if(!X)continue;const ce=X.programConfigurations.get(r.id),ge=l.context.program.get(),Te=l.useProgram(Z,ce),Me=K||Te.program!==ge,ke=l.style.map.terrain&&l.style.map.terrain.getTerrainData(te),Ie=T.constantOr(null);if(Ie&&ue.imageAtlas){const mt=ue.imageAtlas,Fe=mt.patternPositions[Ie.to.toString()],ut=mt.patternPositions[Ie.from.toString()];Fe&&ut&&ce.setConstantPatternPositions(Fe,ut)}const Ze=ke?te:null,at=M?Qs(l,ue,r,F,Ze):v?vs(l,ue,r,v,F,Ze):A?Js(l,ue,r,X.lineClipsArray.length,Ze):wn(l,ue,r,Ze);if(M)$.activeTexture.set(G.TEXTURE0),ue.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),ce.updatePaintBuffers(F);else if(v&&(Me||l.lineAtlas.dirty))$.activeTexture.set(G.TEXTURE0),l.lineAtlas.bind($);else if(A){const mt=X.gradients[r.id];let Fe=mt.texture;if(r.gradientVersion!==mt.version){let ut=256;if(r.stepInterpolant){const He=t.getSource().maxzoom,kt=te.canonical.z===He?Math.ceil(1<<l.transform.maxZoom-te.canonical.z):1;ut=o.clamp(o.nextPowerOfTwo(X.maxLineLength/o.EXTENT*1024*kt),256,$.maxTextureSize)}mt.gradient=o.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:ut,image:mt.gradient||void 0,clips:X.lineClipsArray}),mt.texture?mt.texture.update(mt.gradient):mt.texture=new yt($,mt.gradient,G.RGBA),mt.version=r.gradientVersion,Fe=mt.texture}$.activeTexture.set(G.TEXTURE0),Fe.bind(r.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}Te.draw($,G.TRIANGLES,g,l.stencilModeForClipping(te),b,qt.disabled,at,ke,r.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,r.paint,l.transform.zoom,ce,X.layoutVertexBuffer2),K=!1}},fill:function(l,t,r,a){const u=r.paint.get("fill-color"),d=r.paint.get("fill-opacity");if(d.constantOr(1)===0)return;const g=l.colorModeForRenderPass(),b=r.paint.get("fill-pattern"),v=l.opaquePassEnabledForLayer()&&!b.constantOr(1)&&u.constantOr(o.Color.transparent).a===1&&d.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===v){const T=l.depthModeForSublayer(1,l.renderPass==="opaque"?St.ReadWrite:St.ReadOnly);As(l,t,r,a,T,g,!1)}if(l.renderPass==="translucent"&&r.paint.get("fill-antialias")){const T=l.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,St.ReadOnly);As(l,t,r,a,T,g,!0)}},"fill-extrusion":function(l,t,r,a){const u=r.paint.get("fill-extrusion-opacity");if(u!==0&&l.renderPass==="translucent"){const d=new St(l.context.gl.LEQUAL,St.ReadWrite,l.depthRangeFor3D);if(u!==1||r.paint.get("fill-extrusion-pattern").constantOr(1))Ms(l,t,r,a,d,Gt.disabled,si.disabled),Ms(l,t,r,a,d,l.stencilModeFor3D(),l.colorModeForRenderPass());else{const g=l.colorModeForRenderPass();Ms(l,t,r,a,d,Gt.disabled,g)}}},hillshade:function(l,t,r,a){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent")return;const u=l.context,d=l.depthModeForSublayer(0,St.ReadOnly),g=l.colorModeForRenderPass(),[b,v]=l.renderPass==="translucent"?l.stencilConfigForOverlap(a):[{},a];for(const T of v){const M=t.getTile(T);M.needsHillshadePrepare!==void 0&&M.needsHillshadePrepare&&l.renderPass==="offscreen"?bl(l,M,r,d,Gt.disabled,g):l.renderPass==="translucent"&&kc(l,T,M,r,d,b[T.overscaledZ],g)}u.viewport.set([0,0,l.width,l.height])},raster:function(l,t,r,a){if(l.renderPass!=="translucent"||r.paint.get("raster-opacity")===0||!a.length)return;const u=l.context,d=u.gl,g=t.getSource(),b=l.useProgram("raster"),v=l.colorModeForRenderPass(),[T,M]=g instanceof Ii?[{},a]:l.stencilConfigForOverlap(a),A=M[M.length-1].overscaledZ,F=!l.options.moving;for(const Z of M){const $=l.depthModeForSublayer(Z.overscaledZ-A,r.paint.get("raster-opacity")===1?St.ReadWrite:St.ReadOnly,d.LESS),G=t.getTile(Z);G.registerFadeDuration(r.paint.get("raster-fade-duration"));const K=t.findLoadedParent(Z,0),te=xi(G,K,t,r,l.transform,l.style.map.terrain);let ue,X;const ce=r.paint.get("raster-resampling")==="nearest"?d.NEAREST:d.LINEAR;u.activeTexture.set(d.TEXTURE0),G.texture.bind(ce,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),u.activeTexture.set(d.TEXTURE1),K?(K.texture.bind(ce,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),ue=Math.pow(2,K.tileID.overscaledZ-G.tileID.overscaledZ),X=[G.tileID.canonical.x*ue%1,G.tileID.canonical.y*ue%1]):G.texture.bind(ce,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST);const ge=l.style.map.terrain&&l.style.map.terrain.getTerrainData(Z),Te=ge?Z:null,Me=Te?Te.posMatrix:l.transform.calculatePosMatrix(Z.toUnwrapped(),F),ke=Ts(Me,X||[0,0],ue||1,te,r);g instanceof Ii?b.draw(u,d.TRIANGLES,$,Gt.disabled,v,qt.disabled,ke,ge,r.id,g.boundsBuffer,l.quadTriangleIndexBuffer,g.boundsSegments):b.draw(u,d.TRIANGLES,$,T[Z.overscaledZ],v,qt.disabled,ke,ge,r.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,t,r,a){const u=r.paint.get("background-color"),d=r.paint.get("background-opacity");if(d===0)return;const g=l.context,b=g.gl,v=l.transform,T=v.tileSize,M=r.paint.get("background-pattern");if(l.isPatternMissing(M))return;const A=!M&&u.a===1&&d===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==A)return;const F=Gt.disabled,Z=l.depthModeForSublayer(0,A==="opaque"?St.ReadWrite:St.ReadOnly),$=l.colorModeForRenderPass(),G=l.useProgram(M?"backgroundPattern":"background"),K=a||v.coveringTiles({tileSize:T,terrain:l.style.map.terrain});M&&(g.activeTexture.set(b.TEXTURE0),l.imageManager.bind(l.context));const te=r.getCrossfadeParameters();for(const ue of K){const X=a?ue.posMatrix:l.transform.calculatePosMatrix(ue.toUnwrapped()),ce=M?eo(X,d,l,M,{tileID:ue,tileSize:T},te):na(X,d,u),ge=l.style.map.terrain&&l.style.map.terrain.getTerrainData(ue);G.draw(g,b.TRIANGLES,Z,F,$,qt.disabled,ce,ge,r.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}},debug:function(l,t,r){for(let a=0;a<r.length;a++)Sl(l,t,r[a])},custom:function(l,t,r){const a=l.context,u=r.implementation;if(l.renderPass==="offscreen"){const d=u.prerender;d&&(l.setCustomLayerDefaults(),a.setColorMode(l.colorModeForRenderPass()),d.call(u,a.gl,l.transform.customLayerMatrix()),a.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),a.setColorMode(l.colorModeForRenderPass()),a.setStencilMode(Gt.disabled);const d=u.renderingMode==="3d"?new St(l.context.gl.LEQUAL,St.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,St.ReadOnly);a.setDepthMode(d),u.render(a.gl,l.transform.customLayerMatrix()),a.setDirty(),l.setBaseState(),a.bindFramebuffer.set(null)}}};class El{constructor(t,r){this.context=new fa(t),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.create(),renderTime:0},this.setup(),this.numSublayers=ai.maxUnderzooming+ai.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new xs}resize(t,r,a){if(this.width=t*a,this.height=r*a,this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const t=this.context,r=new o.PosArray;r.emplaceBack(0,0),r.emplaceBack(o.EXTENT,0),r.emplaceBack(0,o.EXTENT),r.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(r,es.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const a=new o.PosArray;a.emplaceBack(0,0),a.emplaceBack(o.EXTENT,0),a.emplaceBack(0,o.EXTENT),a.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=t.createVertexBuffer(a,es.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const u=new o.RasterBoundsArray;u.emplaceBack(0,0,0,0),u.emplaceBack(o.EXTENT,0,o.EXTENT,0),u.emplaceBack(0,o.EXTENT,0,o.EXTENT),u.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(u,yn.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const d=new o.PosArray;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(d,es.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const g=new o.LineStripIndexArray;g.emplaceBack(0),g.emplaceBack(1),g.emplaceBack(3),g.emplaceBack(2),g.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(g);const b=new o.TriangleIndexArray;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);const v=this.context.gl;this.stencilClearMode=new Gt({func:v.ALWAYS,mask:0},0,255,v.ZERO,v.ZERO,v.ZERO)}clearStencil(){const t=this.context,r=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=o.create();o.ortho(a,0,this.width,this.height,0,0,1),o.scale(a,a,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,r.TRIANGLES,St.disabled,this.stencilClearMode,si.disabled,qt.disabled,ia(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,r){if(this.currentStencilSource===t.source||!t.isTileClipped()||!r||!r.length)return;this.currentStencilSource=t.source;const a=this.context,u=a.gl;this.nextStencilID+r.length>256&&this.clearStencil(),a.setColorMode(si.disabled),a.setDepthMode(St.disabled);const d=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const g of r){const b=this._tileClippingMaskIDs[g.key]=this.nextStencilID++,v=this.style.map.terrain&&this.style.map.terrain.getTerrainData(g);d.draw(a,u.TRIANGLES,St.disabled,new Gt({func:u.ALWAYS,mask:0},b,255,u.KEEP,u.KEEP,u.REPLACE),si.disabled,qt.disabled,ia(g.posMatrix),v,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new Gt({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){const r=this.context.gl;return new Gt({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,a=t.sort((g,b)=>b.overscaledZ-g.overscaledZ),u=a[a.length-1].overscaledZ,d=a[0].overscaledZ-u+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const g={};for(let b=0;b<d;b++)g[b+u]=new Gt({func:r.GEQUAL,mask:255},b+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=d,[g,a]}return[{[u]:Gt.disabled},a]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new si([t.CONSTANT_COLOR,t.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?si.unblended:si.alphaBlended}depthModeForSublayer(t,r,a){if(!this.opaquePassEnabledForLayer())return St.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new St(a||this.context.gl.LEQUAL,r,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){this.style=t,this.options=r,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const a=this.style._order,u=this.style.sourceCaches,d={},g={},b={};for(const v in u){const T=u[v];T.used&&T.prepare(this.context),d[v]=T.getVisibleCoordinates(),g[v]=d[v].slice().reverse(),b[v]=T.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let v=0;v<a.length;v++)if(this.style._layers[a[v]].is3D()){this.opaquePassCutoff=v;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const v=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||v.length)&&(o.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(T,M){const A=T.context,F=A.gl,Z=si.unblended,$=new St(F.LEQUAL,St.ReadWrite,[0,1]),G=M.getTerrainMesh(),K=M.sourceCache.getRenderableTiles(),te=T.useProgram("terrainDepth");A.bindFramebuffer.set(M.getFramebuffer("depth").framebuffer),A.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),A.clear({color:o.Color.transparent,depth:1});for(const ue of K){const X=M.getTerrainData(ue.tileID),ce={u_matrix:T.transform.calculatePosMatrix(ue.tileID.toUnwrapped()),u_ele_delta:M.getMeshFrameDelta(T.transform.zoom)};te.draw(A,F.TRIANGLES,$,Gt.disabled,Z,qt.backCCW,ce,X,"terrain",G.vertexBuffer,G.indexBuffer,G.segments)}A.bindFramebuffer.set(null),A.viewport.set([0,0,T.width,T.height])}(this,this.style.map.terrain),function(T,M){const A=T.context,F=A.gl,Z=si.unblended,$=new St(F.LEQUAL,St.ReadWrite,[0,1]),G=M.getTerrainMesh(),K=M.getCoordsTexture(),te=M.sourceCache.getRenderableTiles(),ue=T.useProgram("terrainCoords");A.bindFramebuffer.set(M.getFramebuffer("coords").framebuffer),A.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),A.clear({color:o.Color.transparent,depth:1}),M.coordsIndex=[];for(const X of te){const ce=M.getTerrainData(X.tileID);A.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,K.texture);const ge={u_matrix:T.transform.calculatePosMatrix(X.tileID.toUnwrapped()),u_terrain_coords_id:(255-M.coordsIndex.length)/255,u_texture:0,u_ele_delta:M.getMeshFrameDelta(T.transform.zoom)};ue.draw(A,F.TRIANGLES,$,Gt.disabled,Z,qt.backCCW,ge,ce,"terrain",G.vertexBuffer,G.indexBuffer,G.segments),M.coordsIndex.push(X.tileID.key)}A.bindFramebuffer.set(null),A.viewport.set([0,0,T.width,T.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const v of a){const T=this.style._layers[v];if(!T.hasOffscreenPass()||T.isHidden(this.transform.zoom))continue;const M=g[T.source];(T.type==="custom"||M.length)&&this.renderLayer(this,u[T.source],T,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const v=this.style._layers[a[this.currentLayer]],T=u[v.source],M=d[v.source];this._renderTileClippingMasks(v,M),this.renderLayer(this,T,v,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const v=this.style._layers[a[this.currentLayer]],T=u[v.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(v))continue;const M=(v.type==="symbol"?b:g)[v.source];this._renderTileClippingMasks(v,d[v.source]),this.renderLayer(this,T,v,M)}if(this.options.showTileBoundaries){const v=function(T,M){let A=null;const F=Object.values(T._layers).flatMap(K=>K.source&&!K.isHidden(M)?[T.sourceCaches[K.source]]:[]),Z=F.filter(K=>K.getSource().type==="vector"),$=F.filter(K=>K.getSource().type!=="vector"),G=K=>{(!A||A.getSource().maxzoom<K.getSource().maxzoom)&&(A=K)};return Z.forEach(K=>G(K)),A||$.forEach(K=>G(K)),A}(this.style,this.transform.zoom);v&&va.debug(this,v,v.getVisibleCoordinates())}this.options.showPadding&&function(v){const T=v.transform.padding;qr(v,v.transform.height-(T.top||0),3,jr),qr(v,T.bottom||0,3,qn),Cs(v,T.left||0,3,wl),Cs(v,v.transform.width-(T.right||0),3,ya);const M=v.transform.centerPoint;(function(A,F,Z,$){as(A,F-1,Z-10,2,20,$),as(A,F-10,Z-1,20,2,$)})(v,M.x,v.transform.height-M.y,Tl)}(this),this.context.setDefault()}renderLayer(t,r,a,u){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||(u||[]).length)&&(this.id=a.id,va[a.type](t,r,a,u,this.style.placement.variableOffsets))}translatePosMatrix(t,r,a,u,d){if(!a[0]&&!a[1])return t;const g=d?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(g){const T=Math.sin(g),M=Math.cos(g);a=[a[0]*M-a[1]*T,a[0]*T+a[1]*M]}const b=[d?a[0]:xe(r,a[0],this.transform.zoom),d?a[1]:xe(r,a[1],this.transform.zoom),0],v=new Float32Array(16);return o.translate(v,t,b),v}saveTileTexture(t){const r=this._tileTextures[t.size[0]];r?r.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const r=this.imageManager.getPattern(t.from.toString()),a=this.imageManager.getPattern(t.to.toString());return!r||!a}useProgram(t,r){this.cache=this.cache||{};const a=t+(r?r.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new xc(this.context,t,jn[t],r,to[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new yt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class uo{constructor(t,r){this.points=t,this.planes=r}static fromInvProjectionMatrix(t,r,a){const u=Math.pow(2,a),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const v=1/(b=o.transformMat4([],b,t))[3]/r*u;return o.mul$1(b,b,[v,v,1/b[3],v])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const v=function(F,Z){var $=Z[0],G=Z[1],K=Z[2],te=$*$+G*G+K*K;return te>0&&(te=1/Math.sqrt(te)),F[0]=Z[0]*te,F[1]=Z[1]*te,F[2]=Z[2]*te,F}([],function(F,Z,$){var G=Z[0],K=Z[1],te=Z[2],ue=$[0],X=$[1],ce=$[2];return F[0]=K*ce-te*X,F[1]=te*ue-G*ce,F[2]=G*X-K*ue,F}([],Qe([],d[b[0]],d[b[1]]),Qe([],d[b[2]],d[b[1]]))),T=-((M=v)[0]*(A=d[b[1]])[0]+M[1]*A[1]+M[2]*A[2]);var M,A;return v.concat(T)});return new uo(d,g)}}class fr{constructor(t,r){this.min=t,this.max=r,this.center=function(a,u,d){return a[0]=.5*u[0],a[1]=.5*u[1],a[2]=.5*u[2],a}([],function(a,u,d){return a[0]=u[0]+d[0],a[1]=u[1]+d[1],a[2]=u[2]+d[2],a}([],this.min,this.max))}quadrant(t){const r=[t%2==0,t<2],a=nt(this.min),u=nt(this.max);for(let d=0;d<r.length;d++)a[d]=r[d]?this.min[d]:this.center[d],u[d]=r[d]?this.center[d]:this.max[d];return u[2]=this.max[2],new fr(a,u)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const r=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let u=0;u<t.planes.length;u++){const d=t.planes[u];let g=0;for(let b=0;b<r.length;b++)o.dot(d,r[b])>=0&&g++;if(g===0)return 0;g!==r.length&&(a=!1)}if(a)return 2;for(let u=0;u<3;u++){let d=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let b=0;b<t.points.length;b++){const v=t.points[b][u]-this.min[u];d=Math.min(d,v),g=Math.max(g,v)}if(g<0||d>this.max[u]-this.min[u])return 0}return 1}}class ho{constructor(t=0,r=0,a=0,u=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(a)||a<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=a,this.right=u}interpolate(t,r,a){return r.top!=null&&t.top!=null&&(this.top=o.interpolate.number(t.top,r.top,a)),r.bottom!=null&&t.bottom!=null&&(this.bottom=o.interpolate.number(t.bottom,r.bottom,a)),r.left!=null&&t.left!=null&&(this.left=o.interpolate.number(t.left,r.left,a)),r.right!=null&&t.right!=null&&(this.right=o.interpolate.number(t.right,r.right,a)),this}getCenter(t,r){const a=o.clamp((this.left+t-this.right)/2,0,t),u=o.clamp((this.top+r-this.bottom)/2,0,r);return new o.Point(a,u)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ho(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class po{constructor(t,r,a,u,d){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=d===void 0||!!d,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=a??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ho,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new po(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const r=-o.wrap(t,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=function(){var a=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,u,d){var g=u[0],b=u[1],v=u[2],T=u[3],M=Math.sin(d),A=Math.cos(d);a[0]=g*A+v*M,a[1]=b*A+T*M,a[2]=g*-M+v*A,a[3]=b*-M+T*A}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=o.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this.tileZoom=Math.max(0,Math.floor(r)),this.scale=this.zoomScale(r),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,a){this._unmodified=!1,this._edgeInsets.interpolate(t,r,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new o.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const a=this.pointCoordinate(new o.Point(0,0)),u=this.pointCoordinate(new o.Point(this.width,0)),d=this.pointCoordinate(new o.Point(this.width,this.height)),g=this.pointCoordinate(new o.Point(0,this.height)),b=Math.floor(Math.min(a.x,u.x,d.x,g.x)),v=Math.floor(Math.max(a.x,u.x,d.x,g.x)),T=1;for(let M=b-T;M<=v+T;M++)M!==0&&r.push(new o.UnwrappedTileID(M,t))}return r}coveringTiles(t){var r,a;let u=this.coveringZoomLevel(t);const d=u;if(t.minzoom!==void 0&&u<t.minzoom)return[];t.maxzoom!==void 0&&u>t.maxzoom&&(u=t.maxzoom);const g=this.pointCoordinate(this.getCameraPoint()),b=o.MercatorCoordinate.fromLngLat(this.center),v=Math.pow(2,u),T=[v*g.x,v*g.y,0],M=[v*b.x,v*b.y,0],A=uo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u);let F=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=u);const Z=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,$=X=>({aabb:new fr([X*v,0,0],[(X+1)*v,v,0]),zoom:0,x:0,y:0,wrap:X,fullyVisible:!1}),G=[],K=[],te=u,ue=t.reparseOverscaled?d:u;if(this._renderWorldCopies)for(let X=1;X<=3;X++)G.push($(-X)),G.push($(X));for(G.push($(0));G.length>0;){const X=G.pop(),ce=X.x,ge=X.y;let Te=X.fullyVisible;if(!Te){const at=X.aabb.intersects(A);if(at===0)continue;Te=at===2}const Me=t.terrain?T:M,ke=X.aabb.distanceX(Me),Ie=X.aabb.distanceY(Me),Ze=Math.max(Math.abs(ke),Math.abs(Ie));if(X.zoom===te||Ze>Z+(1<<te-X.zoom)-2&&X.zoom>=F){const at=te-X.zoom,mt=T[0]-.5-(ce<<at),Fe=T[1]-.5-(ge<<at);K.push({tileID:new o.OverscaledTileID(X.zoom===te?ue:X.zoom,X.wrap,X.zoom,ce,ge),distanceSq:ht([M[0]-.5-ce,M[1]-.5-ge]),tileDistanceToCamera:Math.sqrt(mt*mt+Fe*Fe)})}else for(let at=0;at<4;at++){const mt=(ce<<1)+at%2,Fe=(ge<<1)+(at>>1),ut=X.zoom+1;let He=X.aabb.quadrant(at);if(t.terrain){const kt=new o.OverscaledTileID(ut,X.wrap,ut,mt,Fe),vi=t.terrain.getMinMaxElevation(kt),zt=(r=vi.minElevation)!==null&&r!==void 0?r:this.elevation,_t=(a=vi.maxElevation)!==null&&a!==void 0?a:this.elevation;He=new fr([He.min[0],He.min[1],zt],[He.max[0],He.max[1],_t])}G.push({aabb:He,zoom:ut,x:mt,y:Fe,wrap:X.wrap,fullyVisible:Te})}}return K.sort((X,ce)=>X.distanceSq-ce.distanceSq).map(X=>X.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=o.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.Point(o.mercatorXfromLng(t.lng)*this.worldSize,o.mercatorYfromLat(r)*this.worldSize)}unproject(t){return new o.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,r){const a=o.MercatorCoordinate.fromLngLat(t.wrap()),u=(1<<this.tileZoom)*o.EXTENT,d=a.x*u,g=a.y*u,b=Math.floor(d/o.EXTENT),v=Math.floor(g/o.EXTENT),T=new o.OverscaledTileID(this.tileZoom,0,this.tileZoom,b,v);return r.getElevation(T,d%o.EXTENT,g%o.EXTENT,o.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const r=this.pointLocation(this.centerPoint,t),a=this.getElevation(r,t);if(!(this.elevation-a))return;const u=this.getCameraPosition(),d=o.MercatorCoordinate.fromLngLat(u.lngLat,u.altitude),g=o.MercatorCoordinate.fromLngLat(r,a),b=d.x-g.x,v=d.y-g.y,T=d.z-g.z,M=Math.sqrt(b*b+v*v+T*T),A=this.scaleZoom(this.cameraToCenterDistance/M/this.tileSize);this._elevation=a,this._center=r,this.zoom=A}setLocationAtPoint(t,r){const a=this.pointCoordinate(r),u=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(t),g=new o.MercatorCoordinate(d.x-(a.x-u.x),d.y-(a.y-u.y));this.center=this.coordinateLocation(g),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,r){return r?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,r),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,r){return this.coordinateLocation(this.pointCoordinate(t,r))}locationCoordinate(t){return o.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,r){if(r){const F=r.pointCoordinate(t);if(F!=null)return F}const a=[t.x,t.y,0,1],u=[t.x,t.y,1,1];o.transformMat4(a,a,this.pixelMatrixInverse),o.transformMat4(u,u,this.pixelMatrixInverse);const d=a[3],g=u[3],b=a[1]/d,v=u[1]/g,T=a[2]/d,M=u[2]/g,A=T===M?0:(0-T)/(M-T);return new o.MercatorCoordinate(o.interpolate.number(a[0]/d,u[0]/g,A)/this.worldSize,o.interpolate.number(b,v,A)/this.worldSize)}coordinatePoint(t,r=0,a=this.pixelMatrix){const u=[t.x*this.worldSize,t.y*this.worldSize,r,1];return o.transformMat4(u,u,a),new o.Point(u[0]/u[3],u[1]/u[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new ti().extend(this.pointLocation(new o.Point(0,t))).extend(this.pointLocation(new o.Point(this.width,t))).extend(this.pointLocation(new o.Point(this.width,this.height))).extend(this.pointLocation(new o.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ti([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,r=!1){const a=t.key,u=r?this._alignedPosMatrixCache:this._posMatrixCache;if(u[a])return u[a];const d=t.canonical,g=this.worldSize/this.zoomScale(d.z),b=d.x+Math.pow(2,d.z)*t.wrap,v=o.identity(new Float64Array(16));return o.translate(v,v,[b*g,d.y*g,0]),o.scale(v,v,[g/o.EXTENT,g/o.EXTENT,1]),o.multiply(v,r?this.alignedProjMatrix:this.projMatrix,v),u[a]=new Float32Array(v),u[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,r,a,u,d=-90,g=90,b=-180,v=180;const T=this.size,M=this._unmodified;if(this.latRange){const Z=this.latRange;d=o.mercatorYfromLat(Z[1])*this.worldSize,g=o.mercatorYfromLat(Z[0])*this.worldSize,t=g-d<T.y?T.y/(g-d):0}if(this.lngRange){const Z=this.lngRange;b=o.wrap(o.mercatorXfromLng(Z[0])*this.worldSize,0,this.worldSize),v=o.wrap(o.mercatorXfromLng(Z[1])*this.worldSize,0,this.worldSize),v<b&&(v+=this.worldSize),r=v-b<T.x?T.x/(v-b):0}const A=this.point,F=Math.max(r||0,t||0);if(F)return this.center=this.unproject(new o.Point(r?(v+b)/2:A.x,t?(g+d)/2:A.y)),this.zoom+=this.scaleZoom(F),this._unmodified=M,void(this._constraining=!1);if(this.latRange){const Z=A.y,$=T.y/2;Z-$<d&&(u=d+$),Z+$>g&&(u=g-$)}if(this.lngRange){const Z=(b+v)/2,$=o.wrap(A.x,Z-this.worldSize/2,Z+this.worldSize/2),G=T.x/2;$-G<b&&(a=b+G),$+G>v&&(a=v-G)}a===void 0&&u===void 0||(this.center=this.unproject(new o.Point(a!==void 0?a:A.x,u!==void 0?u:A.y)).wrap()),this._unmodified=M,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let u=o.identity(new Float64Array(16));o.scale(u,u,[this.width/2,-this.height/2,1]),o.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=o.identity(new Float64Array(16)),o.scale(u,u,[1,-1,1]),o.translate(u,u,[-1,-1,0]),o.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const d=this._elevation<0?this.cameraToCenterDistance:this.cameraToSeaLevelDistance,g=Math.PI/2+this._pitch,b=this._fov*(.5+t.y/this.height),v=Math.sin(b)*d/Math.sin(o.clamp(Math.PI-g-b,.01,Math.PI-.01)),T=this.getHorizon(),M=2*Math.atan(T/this.cameraToCenterDistance)*(.5+t.y/(2*T)),A=Math.sin(M)*d/Math.sin(o.clamp(Math.PI-g-M,.01,Math.PI-.01)),F=Math.min(v,A),Z=1.01*(Math.cos(Math.PI/2-this._pitch)*F+d),$=this.height/50;u=new Float64Array(16),o.perspective(u,this._fov,this.width/this.height,$,Z),u[8]=2*-t.x/this.width,u[9]=2*t.y/this.height,o.scale(u,u,[1,-1,1]),o.translate(u,u,[0,0,-this.cameraToCenterDistance]),o.rotateX(u,u,this._pitch),o.rotateZ(u,u,this.angle),o.translate(u,u,[-r,-a,0]),this.mercatorMatrix=o.scale([],u,[this.worldSize,this.worldSize,this.worldSize]),o.scale(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,u),o.translate(u,u,[0,0,-this.elevation]),this.projMatrix=u,this.invProjMatrix=o.invert([],u),this.pixelMatrix3D=o.multiply(new Float64Array(16),this.labelPlaneMatrix,u);const G=this.width%2/2,K=this.height%2/2,te=Math.cos(this.angle),ue=Math.sin(this.angle),X=r-Math.round(r)+te*G+ue*K,ce=a-Math.round(a)+te*K+ue*G,ge=new Float64Array(u);if(o.translate(ge,ge,[X>.5?X-1:X,ce>.5?ce-1:ce,0]),this.alignedProjMatrix=ge,u=o.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new o.Point(0,0)),r=[t.x*this.worldSize,t.y*this.worldSize,0,1];return o.transformMat4(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,t))}getCameraQueryGeometry(t){const r=this.getCameraPoint();if(t.length===1)return[t[0],r];{let a=r.x,u=r.y,d=r.x,g=r.y;for(const b of t)a=Math.min(a,b.x),u=Math.min(u,b.y),d=Math.max(d,b.x),g=Math.max(g,b.y);return[new o.Point(a,u),new o.Point(d,u),new o.Point(d,g),new o.Point(a,g),new o.Point(a,u)]}}}class Il{constructor(t){this._hashName=t&&encodeURIComponent(t),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(r,a){let u=!1,d=null;const g=()=>{d=null,u&&(r(),d=setTimeout(g,300),u=!1)};return()=>(u=!0,d||g(),d)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const r=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,u=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,u),g=Math.round(r.lng*d)/d,b=Math.round(r.lat*d)/d,v=this._map.getBearing(),T=this._map.getPitch();let M="";if(M+=t?`/${g}/${b}/${a}`:`${a}/${b}/${g}`,(v||T)&&(M+="/"+Math.round(10*v)/10),T&&(M+=`/${Math.round(T)}`),this._hashName){const A=this._hashName;let F=!1;const Z=window.location.hash.slice(1).split("&").map($=>{const G=$.split("=")[0];return G===A?(F=!0,`${G}=${M}`):$}).filter($=>$);return F||Z.push(`${A}=${M}`),`#${Z.join("&")}`}return`#${M}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let r;return t.split("&").map(a=>a.split("=")).forEach(a=>{a[0]===this._hashName&&(r=a)}),(r&&r[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(r=>isNaN(r))){const r=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:r,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const Ps={linearity:.3,easing:o.bezier(0,0,.3,1)},Al=o.extend({deceleration:2500,maxSpeed:1400},Ps),Ml=o.extend({deceleration:20,maxSpeed:1400},Ps),ks=o.extend({deceleration:1e3,maxSpeed:360},Ps),Cl=o.extend({deceleration:1e3,maxSpeed:90},Ps);class mr{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=o.exported.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)r.zoom+=d.zoomDelta||0,r.bearing+=d.bearingDelta||0,r.pitch+=d.pitchDelta||0,d.panDelta&&r.pan._add(d.panDelta),d.around&&(r.around=d.around),d.pinchAround&&(r.pinchAround=d.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(r.pan.mag()){const d=zs(r.pan.mag(),a,o.extend({},Al,t||{}));u.offset=r.pan.mult(d.amount/r.pan.mag()),u.center=this._map.transform.center,Gn(u,d)}if(r.zoom){const d=zs(r.zoom,a,Ml);u.zoom=this._map.transform.zoom+d.amount,Gn(u,d)}if(r.bearing){const d=zs(r.bearing,a,ks);u.bearing=this._map.transform.bearing+o.clamp(d.amount,-179,179),Gn(u,d)}if(r.pitch){const d=zs(r.pitch,a,Cl);u.pitch=this._map.transform.pitch+d.amount,Gn(u,d)}if(u.zoom||u.bearing){const d=r.pinchAround===void 0?r.around:r.pinchAround;u.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),o.extend(u,{noMoveStart:!0})}}function Gn(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function zs(l,t,r){const{maxSpeed:a,linearity:u,deceleration:d}=r,g=o.clamp(l*u/(t/1e3),-a,a),b=Math.abs(g)/(d*u);return{easing:r.easing,duration:1e3*b,amount:g*(b/2)}}class Ai extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,a,u={}){const d=z.mousePos(r.getCanvasContainer(),a),g=r.unproject(d);super(t,o.extend({point:d,lngLat:g,originalEvent:a},u)),this._defaultPrevented=!1,this.target=r}}class Br extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,a){const u=t==="touchend"?a.changedTouches:a.touches,d=z.touchPos(r.getCanvasContainer(),u),g=d.map(v=>r.unproject(v)),b=d.reduce((v,T,M,A)=>v.add(T.div(A.length)),new o.Point(0,0));super(t,{points:d,point:b,lngLats:g,lngLat:r.unproject(b),originalEvent:a}),this._defaultPrevented=!1}}class zc extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,a){super(t,{originalEvent:a}),this._defaultPrevented=!1}}class Dc{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new zc(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new Ai(t.type,this._map,t))}mouseup(t){this._map.fire(new Ai(t.type,this._map,t))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new Ai(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Ai(t.type,this._map,t))}mouseover(t){this._map.fire(new Ai(t.type,this._map,t))}mouseout(t){this._map.fire(new Ai(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Br(t.type,this._map,t))}touchmove(t){this._map.fire(new Br(t.type,this._map,t))}touchend(t){this._map.fire(new Br(t.type,this._map,t))}touchcancel(t){this._map.fire(new Br(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Lc{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Ai(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ai("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Ai(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ls{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(o.Point.convert(t),this._map.terrain)}}class Ds{constructor(t,r){this._map=t,this._tr=new ls(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(z.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const a=r;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=a,this._box||(this._box=z.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const d=Math.min(u.x,a.x),g=Math.max(u.x,a.x),b=Math.min(u.y,a.y),v=Math.max(u.y,a.y);z.setTransform(this._box,`translate(${d}px,${b}px)`),this._box.style.width=g-d+"px",this._box.style.height=v-b+"px"}mouseupWindow(t,r){if(!this._active||t.button!==0)return;const a=this._startPos,u=r;if(this.reset(),z.suppressClick(),a.x!==u.x||a.y!==u.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:d=>d.fitScreenCoordinates(a,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(z.remove(this._box),this._box=null),z.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new o.Event(t,{originalEvent:r}))}}function gr(l,t){if(l.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${l.length}, points ${t.length}`);const r={};for(let a=0;a<l.length;a++)r[l[a].identifier]=t[a];return r}class Ke{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,r,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),a.length===this.numTouches&&(this.centroid=function(u){const d=new o.Point(0,0);for(const g of u)d._add(g);return d.div(u.length)}(r),this.touches=gr(a,r)))}touchmove(t,r,a){if(this.aborted||!this.centroid)return;const u=gr(a,r);for(const d in this.touches){const g=u[d];(!g||g.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(t,r,a){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class fo{constructor(t){this.singleTap=new Ke(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,r,a){this.singleTap.touchstart(t,r,a)}touchmove(t,r,a){this.singleTap.touchmove(t,r,a)}touchend(t,r,a){const u=this.singleTap.touchend(t,r,a);if(u){const d=t.timeStamp-this.lastTime<500,g=!this.lastTap||this.lastTap.dist(u)<30;if(d&&g||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class Ls{constructor(t){this._tr=new ls(t),this._zoomIn=new fo({numTouches:1,numTaps:2}),this._zoomOut=new fo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,a){this._zoomIn.touchstart(t,r,a),this._zoomOut.touchstart(t,r,a)}touchmove(t,r,a){this._zoomIn.touchmove(t,r,a),this._zoomOut.touchmove(t,r,a)}touchend(t,r,a){const u=this._zoomIn.touchend(t,r,a),d=this._zoomOut.touchend(t,r,a),g=this._tr;return u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:g.zoom+1,around:g.unproject(u)},{originalEvent:t})}):d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:g.zoom-1,around:g.unproject(d)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ir{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const r=this._moveFunction(...t);if(r.bearingDelta||r.pitchDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(t,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=r.length?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,r){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const u=r.length?r[0]:r;return!this._moved&&u.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(a,u))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&z.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Pl={0:1,2:2};class Ne{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const r=z.mouseButton(t);this._eventButton=r}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(r,a){const u=Pl[a];return r.buttons===void 0||(r.buttons&u)!==u}(t,this._eventButton)}isValidEndEvent(t){return z.mouseButton(t)===this._eventButton}}class mo{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const ba=l=>{l.mousedown=l.dragStart,l.mousemoveWindow=l.dragMove,l.mouseup=l.dragEnd,l.contextmenu=function(t){t.preventDefault()}},kl=({enable:l,clickTolerance:t,bearingDegreesPerPixelMoved:r=.8})=>{const a=new Ne({checkCorrectEvent:u=>z.mouseButton(u)===0&&u.ctrlKey||z.mouseButton(u)===2});return new Ir({clickTolerance:t,move:(u,d)=>({bearingDelta:(d.x-u.x)*r}),moveStateManager:a,enable:l,assignEvents:ba})},go=({enable:l,clickTolerance:t,pitchDegreesPerPixelMoved:r=-.5})=>{const a=new Ne({checkCorrectEvent:u=>z.mouseButton(u)===0&&u.ctrlKey||z.mouseButton(u)===2});return new Ir({clickTolerance:t,move:(u,d)=>({pitchDelta:(d.y-u.y)*r}),moveStateManager:a,enable:l,assignEvents:ba})};class zl{constructor(t,r){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.Point(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,r,a){return this._calculateTransform(t,r,a)}touchmove(t,r,a){if(this._map._cooperativeGestures&&(this._minTouches===2&&a.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,a.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(a.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,r,a)}touchend(t,r,a){this._calculateTransform(t,r,a),this._active&&a.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,a){a.length>0&&(this._active=!0);const u=gr(a,r),d=new o.Point(0,0),g=new o.Point(0,0);let b=0;for(const T in u){const M=u[T],A=this._touches[T];A&&(d._add(M),g._add(M.sub(A)),b++,u[T]=M)}if(this._touches=u,b<this._minTouches||!g.mag())return;const v=g.div(b);return this._sum._add(v),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(b),panDelta:v}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _o{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,r,a){return{}}touchstart(t,r,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,a){if(!this._firstTwoTouches)return;t.preventDefault();const[u,d]=this._firstTwoTouches,g=yo(a,r,u),b=yo(a,r,d);if(!g||!b)return;const v=this._aroundCenter?null:g.add(b).div(2);return this._move([g,b],v,t)}touchend(t,r,a){if(!this._firstTwoTouches)return;const[u,d]=this._firstTwoTouches,g=yo(a,r,u),b=yo(a,r,d);g&&b||(this._active&&z.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function yo(l,t,r){for(let a=0;a<l.length;a++)if(l[a].identifier===r)return t[a]}function Dl(l,t){return Math.log(l/t)/Math.LN2}class wa extends _o{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const a=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Dl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Dl(this._distance,a),pinchAround:r}}}function xo(l,t){return 180*l.angleWith(t)/Math.PI}class Ta extends _o{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const a=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:xo(this._vector,a),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,a=xo(t,this._startVector);return Math.abs(a)<r}}function Rs(l){return Math.abs(l.y)>Math.abs(l.x)}class Sn extends _o{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,r,a){super.touchstart(t,r,a),this._currentTouchCount=a.length}_start(t){this._lastPoints=t,Rs(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,a){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const u=t[0].sub(this._lastPoints[0]),d=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,d,a.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(u.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(t,r,a){if(this._valid!==void 0)return this._valid;const u=t.mag()>=2,d=r.mag()>=2;if(!u&&!d)return;if(!u||!d)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const g=t.y>0==r.y>0;return Rs(t)&&Rs(r)&&g}}const Fr={panStep:100,bearingStep:15,pitchStep:10};class Ll{constructor(t){this._tr=new ls(t);const r=Fr;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,a=0,u=0,d=0,g=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?a=-1:(t.preventDefault(),d=-1);break;case 39:t.shiftKey?a=1:(t.preventDefault(),d=1);break;case 38:t.shiftKey?u=1:(t.preventDefault(),g=-1);break;case 40:t.shiftKey?u=-1:(t.preventDefault(),g=1);break;default:return}return this._rotationDisabled&&(a=0,u=0),{cameraAnimation:b=>{const v=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:Sa,zoom:r?Math.round(v.zoom)+r*(t.shiftKey?2:1):v.zoom,bearing:v.bearing+a*this._bearingStep,pitch:v.pitch+u*this._pitchStep,offset:[-d*this._panStep,-g*this._panStep],center:v.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Sa(l){return l*(2-l)}const vo=4.000244140625;class Ea{constructor(t,r){this._map=t,this._tr=new ls(t),this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const a=o.exported.now(),u=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,r!==0&&r%vo==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(u*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=z.mousePos(this._el,t),a=this._tr;this._around=o.LngLat.convert(this._aroundCenter?a.center:a.unproject(r)),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>vo?this._wheelZoomRate:this._defaultZoomRate;let v=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&v!==0&&(v=1/v);const T=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(T*v))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,a=this._startZoom,u=this._easing;let d,g=!1;if(this._type==="wheel"&&a&&u){const b=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),v=u(b);d=o.interpolate.number(a,r,v),b<1?this._frameId||(this._frameId=!0):g=!0}else d=r,g=!0;return this._active=!0,g&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!g,zoomDelta:d-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=o.ease;if(this._prevEase){const a=this._prevEase,u=(o.exported.now()-a.start)/a.duration,d=a.easing(u+.01)-a.easing(u),g=.27/Math.sqrt(d*d+1e-4)*.01,b=Math.sqrt(.0729-g*g);r=o.bezier(g,b,.25,1)}return this._prevEase={start:o.exported.now(),duration:t,easing:r},r}reset(){this._active=!1}}class Rl{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Zn{constructor(t){this._tr=new ls(t),this.reset()}reset(){this._active=!1}dblclick(t,r){return t.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jt{constructor(){this._tap=new fo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,r,a){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=r[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(t,r,a))}touchmove(t,r,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const u=r[0],d=u.y-this._swipePoint.y;return this._swipePoint=u,t.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(t,r,a)}touchend(t,r,a){this._tapTime?this._swipePoint&&a.length===0&&this.reset():this._tap.touchend(t,r,a)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bo{constructor(t,r,a){this._el=t,this._mousePan=r,this._touchPan=a}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ia{constructor(t,r,a){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Bl{constructor(t,r,a,u){this._el=t,this._touchZoom=r,this._touchRotate=a,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Bs=l=>l.zoom||l.drag||l.pitch||l.rotate;class Fl extends o.Event{}function Aa(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class _r{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new mr(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r),o.bindAll(["handleEvent","handleWindowEvent"],this);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,d,g]of this._listeners)z.addEventListener(u,d,u===document?this.handleWindowEvent:this.handleEvent,g)}destroy(){for(const[t,r,a]of this._listeners)z.removeEventListener(t,r,t===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(t){const r=this._map,a=r.getCanvasContainer();this._add("mapEvent",new Dc(r,t));const u=r.boxZoom=new Ds(r,t);this._add("boxZoom",u);const d=new Ls(r),g=new Zn(r);r.doubleClickZoom=new Rl(g,d),this._add("tapZoom",d),this._add("clickZoom",g);const b=new Jt;this._add("tapDragZoom",b);const v=r.touchPitch=new Sn(r);this._add("touchPitch",v);const T=kl(t),M=go(t);r.dragRotate=new Ia(t,T,M),this._add("mouseRotate",T,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]);const A=(({enable:te,clickTolerance:ue})=>{const X=new Ne({checkCorrectEvent:ce=>z.mouseButton(ce)===0&&!ce.ctrlKey});return new Ir({clickTolerance:ue,move:(ce,ge)=>({around:ge,panDelta:ge.sub(ce)}),activateOnStart:!0,moveStateManager:X,enable:te,assignEvents:ba})})(t),F=new zl(t,r);r.dragPan=new bo(a,A,F),this._add("mousePan",A),this._add("touchPan",F,["touchZoom","touchRotate"]);const Z=new Ta,$=new wa;r.touchZoomRotate=new Bl(a,$,Z,b),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]);const G=r.scrollZoom=new Ea(r,this);this._add("scrollZoom",G,["mousePan"]);const K=r.keyboard=new Ll(r);this._add("keyboard",K),this._add("blockableMapEvent",new Lc(r));for(const te of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[te]&&r[te].enable(t[te])}_add(t,r,a){this._handlers.push({handlerName:t,handler:r,allowed:a}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Bs(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,r,a){for(const u in t)if(u!==a&&(!r||r.indexOf(u)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const r=[];for(const a of t)this._el.contains(a.target)&&r.push(a);return r}handleEvent(t,r){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const a=t.type==="renderFrame"?void 0:t,u={needsRenderFrame:!1},d={},g={},b=t.touches,v=b?this._getMapTouches(b):void 0,T=v?z.touchPos(this._el,v):z.mousePos(this._el,t);for(const{handlerName:F,handler:Z,allowed:$}of this._handlers){if(!Z.isEnabled())continue;let G;this._blockedByActive(g,$,F)?Z.reset():Z[r||t.type]&&(G=Z[r||t.type](t,T,v),this.mergeHandlerResult(u,d,G,F,a),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||Z.isActive())&&(g[F]=Z)}const M={};for(const F in this._previousActiveHandlers)g[F]||(M[F]=a);this._previousActiveHandlers=g,(Object.keys(M).length||Aa(u))&&(this._changes.push([u,d,M]),this._triggerRenderFrame()),(Object.keys(g).length||Aa(u))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:A}=u;A&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],A(this._map))}mergeHandlerResult(t,r,a,u,d){if(!a)return;o.extend(t,a);const g={handlerName:u,originalEvent:a.originalEvent||d};a.zoomDelta!==void 0&&(r.zoom=g),a.panDelta!==void 0&&(r.drag=g),a.pitchDelta!==void 0&&(r.pitch=g),a.bearingDelta!==void 0&&(r.rotate=g)}_applyChanges(){const t={},r={},a={};for(const[u,d,g]of this._changes)u.panDelta&&(t.panDelta=(t.panDelta||new o.Point(0,0))._add(u.panDelta)),u.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(t.around=u.around),u.pinchAround!==void 0&&(t.pinchAround=u.pinchAround),u.noInertia&&(t.noInertia=u.noInertia),o.extend(r,d),o.extend(a,g);this._updateMapTransform(t,r,a),this._changes=[]}_updateMapTransform(t,r,a){const u=this._map,d=u._getTransformForUpdate(),g=u.terrain;if(!(Aa(t)||g&&this._terrainMovement))return this._fireEvents(r,a,!0);let{panDelta:b,zoomDelta:v,bearingDelta:T,pitchDelta:M,around:A,pinchAround:F}=t;F!==void 0&&(A=F),u._stop(!0),A=A||u.transform.centerPoint;const Z=d.pointLocation(b?A.sub(b):A);T&&(d.bearing+=T),M&&(d.pitch+=M),v&&(d.zoom+=v),g?this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?d.center=d.pointLocation(d.centerPoint.sub(b)):d.setLocationAtPoint(Z,A):(this._terrainMovement=!0,d.freezeElevation=!0,d.setLocationAtPoint(Z,A),this._map.once("moveend",()=>{d.freezeElevation=!1,this._terrainMovement=!1,d.recalculateZoom(u.terrain)})):d.setLocationAtPoint(Z,A),u._applyUpdatedTransform(d),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,a,!0)}_fireEvents(t,r,a){const u=Bs(this._eventsInProgress),d=Bs(t),g={};for(const M in t){const{originalEvent:A}=t[M];this._eventsInProgress[M]||(g[`${M}start`]=A),this._eventsInProgress[M]=t[M]}!u&&d&&this._fireEvent("movestart",d.originalEvent);for(const M in g)this._fireEvent(M,g[M]);d&&this._fireEvent("move",d.originalEvent);for(const M in t){const{originalEvent:A}=t[M];this._fireEvent(M,A)}const b={};let v;for(const M in this._eventsInProgress){const{handlerName:A,originalEvent:F}=this._eventsInProgress[M];this._handlersById[A].isActive()||(delete this._eventsInProgress[M],v=r[A]||F,b[`${M}end`]=v)}for(const M in b)this._fireEvent(M,b[M]);const T=Bs(this._eventsInProgress);if(a&&(u||d)&&!T){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),A=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;M?(A(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:v})):(this._map.fire(new o.Event("moveend",{originalEvent:v})),A(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new o.Event(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Fl("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const wo={extend:(l,...t)=>o.extend(l,...t),run(l){l()},logToElement(l,t=!1,r="log"){const a=window.document.getElementById(r);a&&(t&&(a.innerHTML=""),a.innerHTML+=`<br>${l}`)}};class it extends o.Evented{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,o.bindAll(["_renderFrameCallback"],this),this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,a){return t=o.Point.convert(t).mult(-1),this.panTo(this.transform.center,o.extend({offset:t},r),a)}panTo(t,r,a){return this.easeTo(o.extend({center:t},r),a)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,a){return this.easeTo(o.extend({zoom:t},r),a)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,a){return this.easeTo(o.extend({bearing:t},r),a)}resetNorth(t,r){return this.rotateTo(0,o.extend({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=ti.convert(t);const a=r&&r.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),a,r)}_cameraForBoxAndBearing(t,r,a,u){const d={top:0,bottom:0,right:0,left:0};if(typeof(u=o.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const ge=u.padding;u.padding={top:ge,bottom:ge,right:ge,left:ge}}u.padding=o.extend(d,u.padding);const g=this.transform,b=g.padding,v=g.project(o.LngLat.convert(t)),T=g.project(o.LngLat.convert(r)),M=v.rotate(-a*Math.PI/180),A=T.rotate(-a*Math.PI/180),F=new o.Point(Math.max(M.x,A.x),Math.max(M.y,A.y)),Z=new o.Point(Math.min(M.x,A.x),Math.min(M.y,A.y)),$=F.sub(Z),G=(g.width-(b.left+b.right+u.padding.left+u.padding.right))/$.x,K=(g.height-(b.top+b.bottom+u.padding.top+u.padding.bottom))/$.y;if(K<0||G<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const te=Math.min(g.scaleZoom(g.scale*Math.min(G,K)),u.maxZoom),ue=o.Point.convert(u.offset),X=new o.Point((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(a*Math.PI/180),ce=ue.add(X).mult(g.scale/g.zoomScale(te));return{center:g.unproject(v.add(T).div(2).sub(ce)),zoom:te,bearing:a}}fitBounds(t,r,a){return this._fitInternal(this.cameraForBounds(t,r),r,a)}fitScreenCoordinates(t,r,a,u,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.Point.convert(t)),this.transform.pointLocation(o.Point.convert(r)),a,u),u,d)}_fitInternal(t,r,a){return t?(delete(r=o.extend(t,r)).padding,r.linear?this.easeTo(r,a):this.flyTo(r,a)):this}jumpTo(t,r){this.stop();const a=this._getTransformForUpdate();let u=!1,d=!1,g=!1;return"zoom"in t&&a.zoom!==+t.zoom&&(u=!0,a.zoom=+t.zoom),t.center!==void 0&&(a.center=o.LngLat.convert(t.center)),"bearing"in t&&a.bearing!==+t.bearing&&(d=!0,a.bearing=+t.bearing),"pitch"in t&&a.pitch!==+t.pitch&&(g=!0,a.pitch=+t.pitch),t.padding==null||a.isPaddingEqual(t.padding)||(a.padding=t.padding),this._applyUpdatedTransform(a),this.fire(new o.Event("movestart",r)).fire(new o.Event("move",r)),u&&this.fire(new o.Event("zoomstart",r)).fire(new o.Event("zoom",r)).fire(new o.Event("zoomend",r)),d&&this.fire(new o.Event("rotatestart",r)).fire(new o.Event("rotate",r)).fire(new o.Event("rotateend",r)),g&&this.fire(new o.Event("pitchstart",r)).fire(new o.Event("pitch",r)).fire(new o.Event("pitchend",r)),this.fire(new o.Event("moveend",r))}calculateCameraOptionsFromTo(t,r,a,u=0){const d=o.MercatorCoordinate.fromLngLat(t,r),g=o.MercatorCoordinate.fromLngLat(a,u),b=g.x-d.x,v=g.y-d.y,T=g.z-d.z,M=Math.hypot(b,v,T);if(M===0)throw new Error("Can't calculate camera options with same From and To");const A=Math.hypot(b,v),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),Z=180*Math.atan2(b,-v)/Math.PI;let $=180*Math.acos(A/M)/Math.PI;return $=T<0?90-$:90+$,{center:g.toLngLat(),zoom:F,pitch:$,bearing:Z}}easeTo(t,r){this._stop(!1,t.easeId),((t=o.extend({offset:[0,0],duration:500,easing:o.ease},t)).animate===!1||!t.essential&&o.exported.prefersReducedMotion)&&(t.duration=0);const a=this._getTransformForUpdate(),u=this.getZoom(),d=this.getBearing(),g=this.getPitch(),b=this.getPadding(),v="zoom"in t?+t.zoom:u,T="bearing"in t?this._normalizeBearing(t.bearing,d):d,M="pitch"in t?+t.pitch:g,A="padding"in t?t.padding:a.padding,F=o.Point.convert(t.offset);let Z=a.centerPoint.add(F);const $=a.pointLocation(Z),G=o.LngLat.convert(t.center||$);this._normalizeCenter(G);const K=a.project($),te=a.project(G).sub(K),ue=a.zoomScale(v-u);let X,ce;t.around&&(X=o.LngLat.convert(t.around),ce=a.locationPoint(X));const ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||v!==u,this._rotating=this._rotating||d!==T,this._pitching=this._pitching||M!==g,this._padding=!a.isPaddingEqual(A),this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,ge),this.terrain&&this._prepareElevation(G),this._ease(Te=>{if(this._zooming&&(a.zoom=o.interpolate.number(u,v,Te)),this._rotating&&(a.bearing=o.interpolate.number(d,T,Te)),this._pitching&&(a.pitch=o.interpolate.number(g,M,Te)),this._padding&&(a.interpolatePadding(b,A,Te),Z=a.centerPoint.add(F)),this.terrain&&!t.freezeElevation&&this._updateElevation(Te),X)a.setLocationAtPoint(X,ce);else{const Me=a.zoomScale(a.zoom-u),ke=v>u?Math.min(2,ue):Math.max(.5,ue),Ie=Math.pow(ke,1-Te),Ze=a.unproject(K.add(te.mult(Te*Ie)).mult(Me));a.setLocationAtPoint(a.renderWorldCopies?Ze.wrap():Ze,Z)}this._applyUpdatedTransform(a),this._fireMoveEvents(r)},Te=>{this.terrain&&this._finalizeElevation(),this._afterEase(r,Te)},t),this}_prepareEase(t,r,a={}){this._moving=!0,r||a.moving||this.fire(new o.Event("movestart",t)),this._zooming&&!a.zooming&&this.fire(new o.Event("zoomstart",t)),this._rotating&&!a.rotating&&this.fire(new o.Event("rotatestart",t)),this._pitching&&!a.pitching&&this.fire(new o.Event("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.transform.getElevation(t,this.terrain),this.transform.freezeElevation=!0}_updateElevation(t){const r=this.transform.getElevation(this._elevationCenter,this.terrain);if(t<1&&r!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(a-(r-(a*t+this._elevationStart))/(1-t)),this._elevationTarget=r}this.transform.elevation=o.interpolate.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this.transform.freezeElevation=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const r=t.clone(),{center:a,zoom:u,pitch:d,bearing:g,elevation:b}=this.transformCameraUpdate(r);a&&(r.center=a),u!==void 0&&(r.zoom=u),d!==void 0&&(r.pitch=d),g!==void 0&&(r.bearing=g),b!==void 0&&(r.elevation=b),this.transform.apply(r)}_fireMoveEvents(t){this.fire(new o.Event("move",t)),this._zooming&&this.fire(new o.Event("zoom",t)),this._rotating&&this.fire(new o.Event("rotate",t)),this._pitching&&this.fire(new o.Event("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const a=this._zooming,u=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new o.Event("zoomend",t)),u&&this.fire(new o.Event("rotateend",t)),d&&this.fire(new o.Event("pitchend",t)),this.fire(new o.Event("moveend",t))}flyTo(t,r){if(!t.essential&&o.exported.prefersReducedMotion){const He=o.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(He,r)}this.stop(),t=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},t);const a=this._getTransformForUpdate(),u=this.getZoom(),d=this.getBearing(),g=this.getPitch(),b=this.getPadding(),v="zoom"in t?o.clamp(+t.zoom,a.minZoom,a.maxZoom):u,T="bearing"in t?this._normalizeBearing(t.bearing,d):d,M="pitch"in t?+t.pitch:g,A="padding"in t?t.padding:a.padding,F=a.zoomScale(v-u),Z=o.Point.convert(t.offset);let $=a.centerPoint.add(Z);const G=a.pointLocation($),K=o.LngLat.convert(t.center||G);this._normalizeCenter(K);const te=a.project(G),ue=a.project(K).sub(te);let X=t.curve;const ce=Math.max(a.width,a.height),ge=ce/F,Te=ue.mag();if("minZoom"in t){const He=o.clamp(Math.min(t.minZoom,u,v),a.minZoom,a.maxZoom),kt=ce/a.zoomScale(He-u);X=Math.sqrt(kt/Te*2)}const Me=X*X;function ke(He){const kt=(ge*ge-ce*ce+(He?-1:1)*Me*Me*Te*Te)/(2*(He?ge:ce)*Me*Te);return Math.log(Math.sqrt(kt*kt+1)-kt)}function Ie(He){return(Math.exp(He)-Math.exp(-He))/2}function Ze(He){return(Math.exp(He)+Math.exp(-He))/2}const at=ke(0);let mt=function(He){return Ze(at)/Ze(at+X*He)},Fe=function(He){return ce*((Ze(at)*(Ie(kt=at+X*He)/Ze(kt))-Ie(at))/Me)/Te;var kt},ut=(ke(1)-at)/X;if(Math.abs(Te)<1e-6||!isFinite(ut)){if(Math.abs(ce-ge)<1e-6)return this.easeTo(t,r);const He=ge<ce?-1:1;ut=Math.abs(Math.log(ge/ce))/X,Fe=function(){return 0},mt=function(kt){return Math.exp(He*X*kt)}}return t.duration="duration"in t?+t.duration:1e3*ut/("screenSpeed"in t?+t.screenSpeed/X:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=d!==T,this._pitching=M!==g,this._padding=!a.isPaddingEqual(A),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(K),this._ease(He=>{const kt=He*ut,vi=1/mt(kt);a.zoom=He===1?v:u+a.scaleZoom(vi),this._rotating&&(a.bearing=o.interpolate.number(d,T,He)),this._pitching&&(a.pitch=o.interpolate.number(g,M,He)),this._padding&&(a.interpolatePadding(b,A,He),$=a.centerPoint.add(Z)),this.terrain&&!t.freezeElevation&&this._updateElevation(He);const zt=He===1?K:a.unproject(te.add(ue.mult(Fe(kt))).mult(vi));a.setLocationAtPoint(a.renderWorldCopies?zt.wrap():zt,$),this._applyUpdatedTransform(a),this._fireMoveEvents(r)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(r)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const a=this._onEaseEnd;delete this._onEaseEnd,a.call(this,r)}if(!t){const a=this.handlers;a&&a.stop(!1)}return this}_ease(t,r,a){a.animate===!1||a.duration===0?(t(1),r()):(this._easeStart=o.exported.now(),this._easeOptions=a,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=o.wrap(t,-180,180);const a=Math.abs(t-r);return Math.abs(t-360-r)<a&&(t-=360),Math.abs(t+360-r)<a&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(!r.renderWorldCopies||r.lngRange)return;const a=t.lng-r.center.lng;t.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(t){return this.terrain?this.transform.getElevation(o.LngLat.convert(t),this.terrain)-this.transform.elevation:null}}class ct{constructor(t={}){this.options=t,o.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=z.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=z.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=z.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,r){const a=this._map._getUIString(`AttributionControl.${r}`);t.title=a,t.setAttribute("aria-label",a)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const r=this._map.style.sourceCaches;for(const u in r){const d=r[u];if(d.used||d.usedForTerrain){const g=d.getSource();g.attribution&&t.indexOf(g.attribution)<0&&t.push(g.attribution)}}t=t.filter(u=>String(u).trim()),t.sort((u,d)=>u.length-d.length),t=t.filter((u,d)=>{for(let g=d+1;g<t.length;g++)if(t[g].indexOf(u)>=0)return!1;return!0});const a=t.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")}}class Fs{constructor(t={}){this.options=t,o.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=z.create("div","maplibregl-ctrl");const r=z.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){z.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const r=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&r.classList.add("maplibregl-compact"):r.classList.remove("maplibregl-compact")}}}class Ma{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,a=r?this._queue.concat(r):this._queue;for(const u of a)if(u.id===t)return void(u.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const a of r)if(!a.cancelled&&(a.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Ca={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var En=o.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class To extends o.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,r){this.sourceCache.update(t,r),this._renderableTilesKeys=[];const a={};for(const u of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r}))a[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),o.ortho(u.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),this._tiles[u.key]=new Er(u,this.tileSize));for(const u in this._tiles)a[u]||delete this._tiles[u]}freeRtt(t){for(const r in this._tiles){const a=this._tiles[r];(!t||a.tileID.equals(t)||a.tileID.isChildOf(t)||t.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const r={};for(const a of this._renderableTilesKeys){const u=this._tiles[a].tileID;if(u.canonical.equals(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16),o.ortho(d.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),r[a]=d}else if(u.canonical.isChildOf(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const g=u.canonical.z-t.canonical.z,b=u.canonical.x-(u.canonical.x>>g<<g),v=u.canonical.y-(u.canonical.y>>g<<g),T=o.EXTENT>>g;o.ortho(d.posMatrix,0,T,0,T,0,1),o.translate(d.posMatrix,d.posMatrix,[-b*T,-v*T,0]),r[a]=d}else if(t.canonical.isChildOf(u.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const g=t.canonical.z-u.canonical.z,b=t.canonical.x-(t.canonical.x>>g<<g),v=t.canonical.y-(t.canonical.y>>g<<g),T=o.EXTENT>>g;o.ortho(d.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),o.translate(d.posMatrix,d.posMatrix,[b*T,v*T,0]),o.scale(d.posMatrix,d.posMatrix,[1/2**g,1/2**g,0]),r[a]=d}}return r}getSourceTile(t,r){const a=this.sourceCache._source;let u=t.overscaledZ-this.deltaZoom;if(u>a.maxzoom&&(u=a.maxzoom),u<a.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(u).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!d||!d.dem)&&r)for(;u>=a.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(t.scaledTo(u--).key);return d}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(r=>r.timeAdded>=t)}}class yr{constructor(t,r,a){this.painter=t,this.sourceCache=new To(r),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,r,a,u=o.EXTENT){if(!(r>=0&&r<u&&a>=0&&a<u))return 0;let d=0;const g=this.getTerrainData(t);if(g.tile&&g.tile.dem){const b=function($,G,K){var te=G[0],ue=G[1];return $[0]=K[0]*te+K[4]*ue+K[12],$[1]=K[1]*te+K[5]*ue+K[13],$}([],[r/u*o.EXTENT,a/u*o.EXTENT],g.u_terrain_matrix),v=[b[0]*g.tile.dem.dim,b[1]*g.tile.dem.dim],T=[Math.floor(v[0]),Math.floor(v[1])],M=g.tile.dem.get(T[0],T[1]),A=g.tile.dem.get(T[0],T[1]+1),F=g.tile.dem.get(T[0]+1,T[1]),Z=g.tile.dem.get(T[0]+1,T[1]+1);d=o.interpolate.number(o.interpolate.number(M,A,v[0]-T[0]),o.interpolate.number(F,Z,v[0]-T[0]),v[1]-T[1])}return d}getElevation(t,r,a,u=o.EXTENT){return this.getDEMElevation(t,r,a,u)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const u=this.painter.context,d=new o.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new yt(u,d,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new yt(u,new o.RGBAImage({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.identity([])}const r=this.sourceCache.getSourceTile(t,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const u=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new yt(u,r.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),r.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const a=r&&r+r.tileID.key+t.key;if(a&&!this._demMatrixCache[a]){const u=this.sourceCache.sourceCache._source.maxzoom;let d=t.canonical.z-r.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=u?d=t.canonical.z-u:o.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const g=t.canonical.x-(t.canonical.x>>d<<d),b=t.canonical.y-(t.canonical.y>>d<<d),v=o.fromScaling(new Float64Array(16),[1/(o.EXTENT<<d),1/(o.EXTENT<<d),0]);o.translate(v,v,[g*o.EXTENT,b*o.EXTENT,0]),this._demMatrixCache[t.key]={matrix:v,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(t){const r=this.painter,a=r.width/devicePixelRatio,u=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new yt(r.context,{width:a,height:u,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new yt(r.context,{width:a,height:u,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(a,u,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,a,u))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,g=0;d<this._coordsTextureSize;d++)for(let b=0;b<this._coordsTextureSize;b++,g+=4)r[g+0]=255&b,r[g+1]=255&d,r[g+2]=b>>8<<4|d>>8,r[g+3]=0;const a=new o.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),u=new yt(t,a,t.gl.RGBA,{premultiply:!1});return u.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(t){const r=new Uint8Array(4),a=this.painter.context,u=a.gl;a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,r),a.bindFramebuffer.set(null);const d=r[0]+(r[2]>>4<<8),g=r[1]+((15&r[2])<<8),b=this.coordsIndex[255-r[3]],v=b&&this.sourceCache.getTileByID(b);if(!v)return null;const T=this._coordsTextureSize,M=(1<<v.tileID.canonical.z)*T;return new o.MercatorCoordinate((v.tileID.canonical.x*T+d)/M,(v.tileID.canonical.y*T+g)/M,this.getElevation(v.tileID,d,g,T))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,r=new o.Pos3dArray,a=new o.TriangleIndexArray,u=this.meshSize,d=o.EXTENT/u,g=u*u;for(let A=0;A<=u;A++)for(let F=0;F<=u;F++)r.emplaceBack(F*d,A*d,0);for(let A=0;A<g;A+=u+1)for(let F=0;F<u;F++)a.emplaceBack(F+A,u+F+A+1,u+F+A+2),a.emplaceBack(F+A,u+F+A+2,F+A+1);const b=r.length,v=b+2*(u+1);for(const A of[0,1])for(let F=0;F<=u;F++)for(const Z of[0,1])r.emplaceBack(F*d,A*o.EXTENT,Z);for(let A=0;A<2*u;A+=2)a.emplaceBack(v+A,v+A+1,v+A+3),a.emplaceBack(v+A,v+A+3,v+A+2),a.emplaceBack(b+A,b+A+3,b+A+1),a.emplaceBack(b+A,b+A+2,b+A+3);const T=r.length,M=T+2*(u+1);for(const A of[0,1])for(let F=0;F<=u;F++)for(const Z of[0,1])r.emplaceBack(A*o.EXTENT,F*d,Z);for(let A=0;A<2*u;A+=2)a.emplaceBack(T+A,T+A+1,T+A+3),a.emplaceBack(T+A,T+A+3,T+A+2),a.emplaceBack(M+A,M+A+3,M+A+1),a.emplaceBack(M+A,M+A+2,M+A+3);return this._mesh={indexBuffer:t.createIndexBuffer(a),vertexBuffer:t.createVertexBuffer(r,En.members),segments:o.SegmentVector.simpleSegment(0,0,r.length,a.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*o.earthRadius/Math.pow(2,t)/5}getMinMaxElevation(t){const r=this.getTerrainData(t).tile,a={minElevation:null,maxElevation:null};return r&&r.dem&&(a.minElevation=r.dem.min*this.exaggeration,a.maxElevation=r.dem.max*this.exaggeration),a}}class Rc{constructor(t,r,a){this._context=t,this._size=r,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new yt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(a.texture),{id:t,fbo:r,texture:a,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>t.id!==r),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Ar={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class li{constructor(t,r){this.painter=t,this.terrain=r,this.pool=new Rc(t.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(a=>!t._layers[a].isHidden(r)),this._coordsDescendingInv={};for(const a in t.sourceCaches){this._coordsDescendingInv[a]={};const u=t.sourceCaches[a].getVisibleCoordinates();for(const d of u){const g=this.terrain.sourceCache.getTerrainCoords(d);for(const b in g)this._coordsDescendingInv[a][b]||(this._coordsDescendingInv[a][b]=[]),this._coordsDescendingInv[a][b].push(g[b])}}this._coordsDescendingInvStr={};for(const a of t._order){const u=t._layers[a],d=u.source;if(Ar[u.type]&&!this._coordsDescendingInvStr[d]){this._coordsDescendingInvStr[d]={};for(const g in this._coordsDescendingInv[d])this._coordsDescendingInvStr[d][g]=this._coordsDescendingInv[d][g].map(b=>b.key).sort().join()}}for(const a of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const d=this._coordsDescendingInvStr[u][a.tileID.key];d&&d!==a.rttCoords[u]&&(a.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const r=t.type,a=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Ar[r]&&(this._prevType&&Ar[this._prevType]||this._stacks.push([]),this._prevType=r,this._stacks[this._stacks.length-1].push(t.id),!u))return!0;if(Ar[this._prevType]||Ar[r]&&u){this._prevType=r;const d=this._stacks.length-1,g=this._stacks[d]||[];for(const b of this._renderableTiles){if(this.pool.isFull()&&(xa(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(b),b.rtt[d]){const T=this.pool.getObjectForId(b.rtt[d].id);if(T.stamp===b.rtt[d].stamp){this.pool.useObject(T);continue}}const v=this.pool.getOrCreateFreeObject();this.pool.useObject(v),this.pool.stampObject(v),b.rtt[d]={id:v.id,stamp:v.stamp},a.context.bindFramebuffer.set(v.fbo.framebuffer),a.context.clear({color:o.Color.transparent,stencil:0}),a.currentStencilSource=void 0;for(let T=0;T<g.length;T++){const M=a.style._layers[g[T]],A=M.source?this._coordsDescendingInv[M.source][b.tileID.key]:[b.tileID];a.context.viewport.set([0,0,v.fbo.width,v.fbo.height]),a._renderTileClippingMasks(M,A),a.renderLayer(a,a.style.sourceCaches[M.source],M,A),M.source&&(b.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][b.tileID.key])}}return xa(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ar[r]}return!1}}const Mi=U,Ol={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0},cs=l=>{l.touchstart=l.dragStart,l.touchmoveWindow=l.dragMove,l.touchend=l.dragEnd},So={showCompass:!0,showZoom:!0,visualizePitch:!1};class Pa{constructor(t,r,a=!1){this._clickTolerance=10;const u=t.dragRotate._mouseRotate.getClickTolerance(),d=t.dragRotate._mousePitch.getClickTolerance();this.element=r,this.mouseRotate=kl({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:g,clickTolerance:b,bearingDegreesPerPixelMoved:v=.8})=>{const T=new mo;return new Ir({clickTolerance:b,move:(M,A)=>({bearingDelta:(A.x-M.x)*v}),moveStateManager:T,enable:g,assignEvents:cs})})({clickTolerance:u,enable:!0}),this.map=t,a&&(this.mousePitch=go({clickTolerance:d,enable:!0}),this.touchPitch=(({enable:g,clickTolerance:b,pitchDegreesPerPixelMoved:v=-.5})=>{const T=new mo;return new Ir({clickTolerance:b,move:(M,A)=>({pitchDelta:(A.y-M.y)*v}),moveStateManager:T,enable:g,assignEvents:cs})})({clickTolerance:d,enable:!0})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),z.addEventListener(r,"mousedown",this.mousedown),z.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),z.addEventListener(r,"touchcancel",this.reset)}startMouse(t,r){this.mouseRotate.dragStart(t,r),this.mousePitch&&this.mousePitch.dragStart(t,r),z.disableDrag()}startTouch(t,r){this.touchRotate.dragStart(t,r),this.touchPitch&&this.touchPitch.dragStart(t,r),z.disableDrag()}moveMouse(t,r){const a=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(t,r)||{};if(u&&a.setBearing(a.getBearing()+u),this.mousePitch){const{pitchDelta:d}=this.mousePitch.dragMove(t,r)||{};d&&a.setPitch(a.getPitch()+d)}}moveTouch(t,r){const a=this.map,{bearingDelta:u}=this.touchRotate.dragMove(t,r)||{};if(u&&a.setBearing(a.getBearing()+u),this.touchPitch){const{pitchDelta:d}=this.touchPitch.dragMove(t,r)||{};d&&a.setPitch(a.getPitch()+d)}}off(){const t=this.element;z.removeEventListener(t,"mousedown",this.mousedown),z.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.removeEventListener(window,"touchend",this.touchend),z.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){z.enableDrag(),z.removeEventListener(window,"mousemove",this.mousemove),z.removeEventListener(window,"mouseup",this.mouseup),z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.removeEventListener(window,"touchend",this.touchend)}mousedown(t){this.startMouse(o.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),z.mousePos(this.element,t)),z.addEventListener(window,"mousemove",this.mousemove),z.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.moveMouse(t,z.mousePos(this.element,t))}mouseup(t){this.mouseRotate.dragEnd(t),this.mousePitch&&this.mousePitch.dragEnd(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=z.touchPos(this.element,t.targetTouches)[0],this.startTouch(t,this._startPos),z.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.addEventListener(window,"touchend",this.touchend))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=z.touchPos(this.element,t.targetTouches)[0],this.moveTouch(t,this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let xr;function Eo(l,t,r){if(l=new o.LngLat(l.lng,l.lat),t){const a=new o.LngLat(l.lng-360,l.lat),u=new o.LngLat(l.lng+360,l.lat),d=r.locationPoint(l).distSqr(t);r.locationPoint(a).distSqr(t)<d?l=a:r.locationPoint(u).distSqr(t)<d&&(l=u)}for(;Math.abs(l.lng-r.center.lng)>180;){const a=r.locationPoint(l);if(a.x>=0&&a.y>=0&&a.x<=r.width&&a.y<=r.height)break;l.lng>r.center.lng?l.lng-=360:l.lng+=360}return l}const Gr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Io(l,t,r){const a=l.classList;for(const u in Gr)a.remove(`maplibregl-${r}-anchor-${u}`);a.add(`maplibregl-${r}-anchor-${t}`)}class Os extends o.Evented{constructor(t,r){if(super(),(t instanceof HTMLElement||r)&&(t=o.extend({element:t},r)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=o.Point.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=z.create("div"),this._element.setAttribute("aria-label","Map marker");const a=z.createNS("http://www.w3.org/2000/svg","svg"),u=41,d=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${u}px`),a.setAttributeNS(null,"width",`${d}px`),a.setAttributeNS(null,"viewBox",`0 0 ${d} ${u}`);const g=z.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const b=z.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill-rule","nonzero");const v=z.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"transform","translate(3.0, 29.0)"),v.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ue of T){const X=z.createNS("http://www.w3.org/2000/svg","ellipse");X.setAttributeNS(null,"opacity","0.04"),X.setAttributeNS(null,"cx","10.5"),X.setAttributeNS(null,"cy","5.80029008"),X.setAttributeNS(null,"rx",ue.rx),X.setAttributeNS(null,"ry",ue.ry),v.appendChild(X)}const M=z.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill",this._color);const A=z.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),M.appendChild(A);const F=z.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"opacity","0.25"),F.setAttributeNS(null,"fill","#000000");const Z=z.createNS("http://www.w3.org/2000/svg","path");Z.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),F.appendChild(Z);const $=z.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");const G=z.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const K=z.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#000000"),K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962");const te=z.createNS("http://www.w3.org/2000/svg","circle");te.setAttributeNS(null,"fill","#FFFFFF"),te.setAttributeNS(null,"cx","5.5"),te.setAttributeNS(null,"cy","5.5"),te.setAttributeNS(null,"r","5.4999962"),G.appendChild(K),G.appendChild(te),b.appendChild(v),b.appendChild(M),b.appendChild(F),b.appendChild($),b.appendChild(G),a.appendChild(b),a.setAttributeNS(null,"height",u*this._scale+"px"),a.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(a),this._offset=o.Point.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),Io(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),z.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const u=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const r=t.code,a=t.charCode||t.keyCode;r!=="Space"&&r!=="Enter"&&a!==32&&a!==13||this.togglePopup()}_onMapClick(t){const r=t.originalEvent.target,a=this._element;this._popup&&(r===a||a.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Eo(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let r="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?r=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(r=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let a="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?a="rotateX(0deg)":this._pitchAlignment==="map"&&(a=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),z.setTransform(this._element,`${Gr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${a} ${r}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const u=this._map.unproject(this._pos),d=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=u.distanceTo(this._lngLat)>20*d?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=o.Point.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const r=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=r}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const ka={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let us=0,Zr=!1;const za={maxWidth:100,unit:"metric"};function Ao(l,t,r){const a=r&&r.maxWidth||100,u=l._container.clientHeight/2,d=l.unproject([0,u]),g=l.unproject([a,u]),b=d.distanceTo(g);if(r&&r.unit==="imperial"){const v=3.2808*b;v>5280?Wr(t,a,v/5280,l._getUIString("ScaleControl.Miles")):Wr(t,a,v,l._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?Wr(t,a,b/1852,l._getUIString("ScaleControl.NauticalMiles")):b>=1e3?Wr(t,a,b/1e3,l._getUIString("ScaleControl.Kilometers")):Wr(t,a,b,l._getUIString("ScaleControl.Meters"))}function Wr(l,t,r,a){const u=function(d){const g=Math.pow(10,`${Math.floor(d)}`.length-1);let b=d/g;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(v){const T=Math.pow(10,Math.ceil(-Math.log(v)/Math.LN10));return Math.round(v*T)/T}(b),g*b}(r);l.style.width=t*(u/r)+"px",l.innerHTML=`${u}&nbsp;${a}`}const Mo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Da=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Co(l){if(l){if(typeof l=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(l,2)));return{center:new o.Point(0,0),top:new o.Point(0,l),"top-left":new o.Point(t,t),"top-right":new o.Point(-t,t),bottom:new o.Point(0,-l),"bottom-left":new o.Point(t,-t),"bottom-right":new o.Point(-t,-t),left:new o.Point(l,0),right:new o.Point(-l,0)}}if(l instanceof o.Point||Array.isArray(l)){const t=o.Point.convert(l);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:o.Point.convert(l.center||[0,0]),top:o.Point.convert(l.top||[0,0]),"top-left":o.Point.convert(l["top-left"]||[0,0]),"top-right":o.Point.convert(l["top-right"]||[0,0]),bottom:o.Point.convert(l.bottom||[0,0]),"bottom-left":o.Point.convert(l["bottom-left"]||[0,0]),"bottom-right":o.Point.convert(l["bottom-right"]||[0,0]),left:o.Point.convert(l.left||[0,0]),right:o.Point.convert(l.right||[0,0])}}return Co(new o.Point(0,0))}const Po=U,ko={setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends it{constructor(l){var t;if(o.PerformanceUtils.mark(o.PerformanceMarkers.create),(l=o.extend({},Ol,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new po(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),{bearingSnap:l.bearingSnap}),this._interactive=l.interactive,this._cooperativeGestures=l.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=l.collectResourceTiming,this._renderTaskQueue=new Ma,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Ca,l.locale),this._clickTolerance=l.clickTolerance,this._pixelRatio=(t=l.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this.transformCameraUpdate=l.transformCameraUpdate,this._imageQueueHandle=Xe.addThrottleControl(()=>this.isMoving()),this._requestManager=new ze(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),o.bindAll(["_onWindowOnline","_onMapScroll","_cooperativeGesturesOnWheel","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let r=!1;this._resizeObserver=new ResizeObserver(a=>{r?this._trackResize&&this.resize(a)._update():r=!0}),this._resizeObserver.observe(this._container)}this.handlers=new _r(this,l),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=l.hash&&new Il(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,o.extend({},l.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new ct({customAttribution:l.customAttribution})),l.maplibreLogo&&this.addControl(new Fs,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new o.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new o.Event(`${r.dataType}dataloading`,r))}),this.on("dataabort",r=>{this.fire(new o.Event("sourcedataabort",r))})}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=l.onAdd(this);this._controls.push(l);const a=this._controlPositions[t];return t.indexOf("bottom")!==-1?a.insertBefore(r,a.firstChild):a.appendChild(r),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}calculateCameraOptionsFromTo(l,t,r,a){return a==null&&this.terrain&&(a=this.transform.getElevation(r,this.terrain)),super.calculateCameraOptionsFromTo(l,t,r,a)}resize(l){var t;const r=this._containerDimensions(),a=r[0],u=r[1];this._resizeCanvas(a,u,this.getPixelRatio()),this.transform.resize(a,u),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,u),this.painter.resize(a,u,this.getPixelRatio());const d=!this._moving;return d&&(this.stop(),this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l))),this.fire(new o.Event("resize",l)),d&&this.fire(new o.Event("moveend",l)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(l){const[t,r]=this._containerDimensions();this._pixelRatio=l,this._resizeCanvas(t,r,l),this.painter.resize(t,r,l)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(l){return this.transform.setMaxBounds(ti.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l&&this.setZoom(l),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l&&this.setZoom(l),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l&&this.setPitch(l),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l&&this.setPitch(l),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(l){return this._cooperativeGestures=l,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(l){return this.transform.locationPoint(o.LngLat.convert(l),this.style&&this.terrain)}unproject(l){return this.transform.pointLocation(o.Point.convert(l),this.terrain)}isMoving(){var l;return this._moving||((l=this.handlers)===null||l===void 0?void 0:l.isMoving())}isZooming(){var l;return this._zooming||((l=this.handlers)===null||l===void 0?void 0:l.isZooming())}isRotating(){var l;return this._rotating||((l=this.handlers)===null||l===void 0?void 0:l.isRotating())}_createDelegatedListener(l,t,r){if(l==="mouseenter"||l==="mouseover"){let a=!1;return{layer:t,listener:r,delegates:{mousemove:d=>{const g=this.getLayer(t)?this.queryRenderedFeatures(d.point,{layers:[t]}):[];g.length?a||(a=!0,r.call(this,new Ai(l,this,d.originalEvent,{features:g}))):a=!1},mouseout:()=>{a=!1}}}}if(l==="mouseleave"||l==="mouseout"){let a=!1;return{layer:t,listener:r,delegates:{mousemove:g=>{(this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[]).length?a=!0:a&&(a=!1,r.call(this,new Ai(l,this,g.originalEvent)))},mouseout:g=>{a&&(a=!1,r.call(this,new Ai(l,this,g.originalEvent)))}}}}{const a=u=>{const d=this.getLayer(t)?this.queryRenderedFeatures(u.point,{layers:[t]}):[];d.length&&(u.features=d,r.call(this,u),delete u.features)};return{layer:t,listener:r,delegates:{[l]:a}}}}on(l,t,r){if(r===void 0)return super.on(l,t);const a=this._createDelegatedListener(l,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(a);for(const u in a.delegates)this.on(u,a.delegates[u]);return this}once(l,t,r){if(r===void 0)return super.once(l,t);const a=this._createDelegatedListener(l,t,r);for(const u in a.delegates)this.once(u,a.delegates[u]);return this}off(l,t,r){return r===void 0?super.off(l,t):(this._delegatedListeners&&this._delegatedListeners[l]&&(a=>{const u=this._delegatedListeners[l];for(let d=0;d<u.length;d++){const g=u[d];if(g.layer===t&&g.listener===r){for(const b in g.delegates)this.off(b,g.delegates[b]);return u.splice(d,1),this}}})(),this)}queryRenderedFeatures(l,t){if(!this.style)return[];let r;const a=l instanceof o.Point||Array.isArray(l),u=a?l:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(a?{}:l)||{},u instanceof o.Point||typeof u[0]=="number")r=[o.Point.convert(u)];else{const d=o.Point.convert(u[0]),g=o.Point.convert(u[1]);r=[d,new o.Point(g.x,d.y),g,new o.Point(d.x,g.y),d]}return this.style.queryRenderedFeatures(r,t,this.transform)}querySourceFeatures(l,t){return this.style.querySourceFeatures(l,t)}setStyle(l,t){return(t=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&l?(this._diffStyle(l,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(l,t))}setTransformRequest(l){return this._requestManager.setTransformRequest(l),this}_getUIString(l){const t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(l,t));const r=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!l)),l?(this.style=new nr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof l=="string"?this.style.loadURL(l,t,r):this.style.loadJSON(l,t,r),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new nr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(l,t){if(typeof l=="string"){const r=this._requestManager.transformRequest(l,Se.Style);o.getJSON(r,(a,u)=>{a?this.fire(new o.ErrorEvent(a)):u&&this._updateDiff(u,t)})}else typeof l=="object"&&this._updateDiff(l,t)}_updateDiff(l,t){try{this.style.setState(l,t)&&this._update(!0)}catch(r){o.warnOnce(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(l,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(l,t){return this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)}isSourceLoaded(l){const t=this.style&&this.style.sourceCaches[l];if(t!==void 0)return t.loaded();this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${l}'`)))}setTerrain(l){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),l){const t=this.style.sourceCaches[l.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${l.source}`);for(const r in this.style._layers){const a=this.style._layers[r];a.type==="hillshade"&&a.source===l.source&&o.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new yr(this.painter,t,l),this.painter.renderToTexture=new li(this.painter,this.terrain),this.transform.updateElevation(this.terrain),this._terrainDataCallback=r=>{r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId===l.source&&this.transform.updateElevation(this.terrain),this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.updateElevation(this.terrain);return this.fire(new o.Event("terrain",{terrain:l})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){const l=this.style&&this.style.sourceCaches;for(const t in l){const r=l[t]._tiles;for(const a in r){const u=r[a];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}addSourceType(l,t,r){return this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,r)}removeSource(l){return this.style.removeSource(l),this._update(!0)}getSource(l){return this.style.getSource(l)}addImage(l,t,{pixelRatio:r=1,sdf:a=!1,stretchX:u,stretchY:d,content:g}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||o.isImageBitmap(t)){const{width:b,height:v,data:T}=o.exported.getImageData(t);this.style.addImage(l,{data:new o.RGBAImage({width:b,height:v},T),pixelRatio:r,stretchX:u,stretchY:d,content:g,sdf:a,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:b,height:v,data:T}=t,M=t;this.style.addImage(l,{data:new o.RGBAImage({width:b,height:v},new Uint8Array(T)),pixelRatio:r,stretchX:u,stretchY:d,content:g,sdf:a,version:0,userImage:M}),M.onAdd&&M.onAdd(this,l)}}}updateImage(l,t){const r=this.style.getImage(l);if(!r)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=t instanceof HTMLImageElement||o.isImageBitmap(t)?o.exported.getImageData(t):t,{width:u,height:d,data:g}=a;if(u===void 0||d===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==r.data.width||d!==r.data.height)return this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(t instanceof HTMLImageElement||o.isImageBitmap(t));r.data.replace(g,b),this.style.updateImage(l,r)}getImage(l){return this.style.getImage(l)}hasImage(l){return l?!!this.style.getImage(l):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,t){Xe.getImage(this._requestManager.transformRequest(l,Se.Image),t)}listImages(){return this.style.listImages()}addLayer(l,t){return this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)}moveLayer(l,t){return this.style.moveLayer(l,t),this._update(!0)}removeLayer(l){return this.style.removeLayer(l),this._update(!0)}getLayer(l){return this.style.getLayer(l)}setLayerZoomRange(l,t,r){return this.style.setLayerZoomRange(l,t,r),this._update(!0)}setFilter(l,t,r={}){return this.style.setFilter(l,t,r),this._update(!0)}getFilter(l){return this.style.getFilter(l)}setPaintProperty(l,t,r,a={}){return this.style.setPaintProperty(l,t,r,a),this._update(!0)}getPaintProperty(l,t){return this.style.getPaintProperty(l,t)}setLayoutProperty(l,t,r,a={}){return this.style.setLayoutProperty(l,t,r,a),this._update(!0)}getLayoutProperty(l,t){return this.style.getLayoutProperty(l,t)}setGlyphs(l,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(l,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(l,t,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(l,t,r,a=>{a||this._update(!0)}),this}removeSprite(l){return this._lazyInitEmptyStyle(),this.style.removeSprite(l),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(l,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(l,t,r=>{r||this._update(!0)}),this}setLight(l,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(l,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(l,t){return this.style.setFeatureState(l,t),this._update()}removeFeatureState(l,t){return this.style.removeFeatureState(l,t),this._update()}getFeatureState(l){return this.style.getFeatureState(l)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let l=0,t=0;return this._container&&(l=this._container.clientWidth||400,t=this._container.clientHeight||300),[l,t]}_setupContainer(){const l=this._container;l.classList.add("maplibregl-map");const t=this._canvasContainer=z.create("div","maplibregl-canvas-container",l);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=z.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const r=this._containerDimensions();this._resizeCanvas(r[0],r[1],this.getPixelRatio());const a=this._controlContainer=z.create("div","maplibregl-control-container",l),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(d=>{u[d]=z.create("div",`maplibregl-ctrl-${d} `,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_cooperativeGesturesOnWheel(l){this._onCooperativeGesture(l,l[this._metaKey],1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=z.create("div","maplibregl-cooperative-gesture-screen",this._container);let l=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(l=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${l}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){z.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(l,t,r){this._canvas.width=r*l,this._canvas.height=r*t,this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const l={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{t={requestedAttributes:l},a&&(t.statusMessage=a.statusMessage,t.type=a.type)},{once:!0});const r=this._canvas.getContext("webgl2",l);if(!r){const a="Failed to initialize WebGL";throw t?(t.message=a,new Error(JSON.stringify(t))):new Error(a)}this.painter=new El(r,this.transform),ie.testSupport(r)}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(l,t,r){return!t&&r<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(l){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_render(l){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(l),this._removed)return;let r=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,d=o.exported.now();this.style.zoomHistory.update(u,d);const g=new o.EvaluationParameters(u,{now:d,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),b=g.crossFadingFactor();b===1&&b===this._crossFadingFactor||(r=!0,this._crossFadingFactor=b),this.style.update(g)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain&&this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.updateElevation(this.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.load),this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||r)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var l;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Xe.removeThrottleControl(this._imageQueueHandle),(l=this._resizeObserver)===null||l===void 0||l.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),z.remove(this._canvasContainer),z.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),o.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.exported.frame(l=>{o.PerformanceUtils.frame(l),this._frame=null,this._render(l)}))}_onWindowOnline(){this._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get version(){return Mi}getCameraTargetElevation(){return this.transform.elevation}},NavigationControl:class{constructor(l){this.options=o.extend({},So,l),this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),z.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),z.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=z.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map.getZoom(),t=l===this._map.getMaxZoom(),r=l===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Pa(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(l,t){const r=z.create("button",l,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(l,t){const r=this._map._getUIString(`NavigationControl.${t}`);l.title=r,l.setAttribute("aria-label",r)}},GeolocateControl:class extends o.Evented{constructor(l){super(),this.options=o.extend({},ka,l),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(l){return this._map=l,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,r=!1){xr===void 0||r?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(a=>{xr=a.state!=="denied",t(xr)}).catch(()=>{xr=!!window.navigator.geolocation,t(xr)}):(xr=!!window.navigator.geolocation,t(xr)):t(xr)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,us=0,Zr=!1}_isOutOfMapMaxBounds(l){const t=this._map.getMaxBounds(),r=l.coords;return t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.Event("geolocate",l)),this._finish()}}_updateCamera(l){const t=new o.LngLat(l.coords.longitude,l.coords.latitude),r=l.coords.accuracy,a=this._map.getBearing(),u=o.extend({bearing:a},this.options.fitBoundsOptions),d=ti.fromLngLat(t,r);this._map.fitBounds(d,u,{geolocateSource:!0})}_updateMarker(l){if(l){const t=new o.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.getBounds(),t=l.getSouthEast(),r=l.getNorthEast(),a=t.distanceTo(r),u=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&Zr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.Event("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._map){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=z.create("button","maplibregl-ctrl-geolocate",this._container),z.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Os(this._dotElement),this._circleElement=z.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Os({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":us--,Zr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),us++,us>1?(l={maximumAge:6e5,timeout:0},Zr=!0):(l=this.options.positionOptions,Zr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,l)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ct,LogoControl:Fs,ScaleControl:class{constructor(l){this.options=o.extend({},za,l),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Ao(this._map,this._container,this.options)}onAdd(l){return this._map=l,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(l){this.options.unit=l,Ao(this._map,this._container,this.options)}},FullscreenControl:class extends o.Evented{constructor(l={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,l&&l.container&&(l.container instanceof HTMLElement?this._container=l.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){z.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const l=this._fullscreenButton=z.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);z.create("span","maplibregl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.Event("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new o.Event("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},TerrainControl:class{constructor(l){this.options=l,o.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(l){return this._map=l,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=z.create("button","maplibregl-ctrl-terrain",this._container),z.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){z.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends o.Evented{constructor(l){super(),this.options=o.extend(Object.create(Mo),l),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&z.remove(this._content),this._container&&(z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=o.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(document.createTextNode(l))}setHTML(l){const t=document.createDocumentFragment(),r=document.createElement("body");let a;for(r.innerHTML=l;a=r.firstChild,a;)t.appendChild(a);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=z.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(l),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(l){this._container&&this._container.classList.add(l)}removeClassName(l){this._container&&this._container.classList.remove(l)}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){if(this._container)return this._container.classList.toggle(l)}_createCloseButton(){this.options.closeButton&&(this._closeButton=z.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(l){this._update(l.point)}_onMouseMove(l){this._update(l.point)}_onDrag(l){this._update(l.point)}_update(l){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=z.create("div","maplibregl-popup",this._map.getContainer()),this._tip=z.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(d=>this._container.classList.add(d)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Eo(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!l))return;const t=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);let r=this.options.anchor;const a=Co(this.options.offset);if(!r){const d=this._container.offsetWidth,g=this._container.offsetHeight;let b;b=t.y+a.bottom.y<g?["top"]:t.y>this._map.transform.height-g?["bottom"]:[],t.x<d/2?b.push("left"):t.x>this._map.transform.width-d/2&&b.push("right"),r=b.length===0?"bottom":b.join("-")}const u=t.add(a[r]).round();z.setTransform(this._container,`${Gr[r]} translate(${u.x}px,${u.y}px)`),Io(this._container,r,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(Da);l&&l.focus()}_onClose(){this.remove()}},Marker:Os,Style:nr,LngLat:o.LngLat,LngLatBounds:ti,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,Evented:o.Evented,AJAXError:o.AJAXError,config:o.config,CanvasSource:dr,GeoJSONSource:Ji,ImageSource:Ii,RasterDEMTileSource:Ki,RasterTileSource:Qn,VectorTileSource:Sr,VideoSource:ye,prewarm:function(){zn().acquire(Re)},clearPrewarmedResources:function(){const l=cn;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Re),cn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return Po},get workerCount(){return Gi.workerCount},set workerCount(l){Gi.workerCount=l},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){o.config.MAX_PARALLEL_IMAGE_REQUESTS=l},get workerUrl(){return o.config.WORKER_URL},set workerUrl(l){o.config.WORKER_URL=l},addProtocol(l,t){o.config.REGISTERED_PROTOCOLS[l]=t},removeProtocol(l){delete o.config.REGISTERED_PROTOCOLS[l]}};return wo.extend(ko,{isSafari:o.isSafari,getPerformanceMetrics:o.PerformanceUtils.getPerformanceMetrics}),ko});var C=D;return C})})(sd);var ad=sd.exports;const hr=km(ad);const pr="/maplibre-gl-directions/assets/style-7d708b4d.json";var zm=Object.defineProperty,Dm=(_,f,x)=>f in _?zm(_,f,{enumerable:!0,configurable:!0,writable:!0,value:x}):_[f]=x,vt=(_,f,x)=>(Dm(_,typeof f!="symbol"?f+"":f,x),x);class Lm{constructor(f){vt(this,"map"),vt(this,"listeners",{}),vt(this,"oneTimeListeners",{}),this.map=f}fire(f){var x,E;f.target=this.map,(x=this.listeners[f.type])==null||x.forEach(D=>D(f)),(E=this.oneTimeListeners[f.type])==null||E.forEach(D=>{var S,C;D(f);const o=(S=this.oneTimeListeners[f.type])==null?void 0:S.indexOf(D);o&&~o&&((C=this.oneTimeListeners[f.type])==null||C.splice(o,1))})}on(f,x){(this.listeners[f]=this.listeners[f]??[]).push(x)}off(f,x){var E,D;const S=(E=this.listeners[f])==null?void 0:E.indexOf(x);~S&&((D=this.listeners[f])==null||D.splice(S,1))}once(f,x){(this.oneTimeListeners[f]=this.oneTimeListeners[f]??[]).push(x)}}class Gs{constructor(f,x,E){vt(this,"type"),vt(this,"target"),vt(this,"originalEvent"),vt(this,"data"),this.type=f,this.originalEvent=x,this.data=E}}class kp{constructor(f,x,E){vt(this,"type"),vt(this,"target"),vt(this,"originalEvent"),vt(this,"data"),this.type=f,this.originalEvent=x,this.data=E}}const Rm={api:"https://router.project-osrm.org/route/v1",profile:"driving",requestOptions:{},requestTimeout:null,makePostRequest:!1,sourceName:"maplibre-gl-directions",pointsScalingFactor:1,linesScalingFactor:1,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint","maplibre-gl-directions-waypoint-casing"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint","maplibre-gl-directions-snappoint-casing"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline","maplibre-gl-directions-routeline-casing"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline","maplibre-gl-directions-alt-routeline-casing"],dragThreshold:10,refreshOnMove:!1,bearings:!1};function _c(_=1,f=1,x="maplibre-gl-directions"){return[{id:`${x}-snapline`,type:"line",source:x,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":"#34343f","line-opacity":.65,"line-width":3},filter:["==",["get","type"],"SNAPLINE"]},{id:`${x}-alt-routeline-casing`,type:"line",source:x,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#9e91be","line-opacity":.55,"line-width":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],10*f,7*f],5,["case",["boolean",["get","highlight"],!1],10*f,7*f],18,["case",["boolean",["get","highlight"],!1],32*f,23*f]]},filter:["==",["get","route"],"ALT"]},{id:`${x}-alt-routeline`,type:"line",source:x,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#9e91be","line-opacity":.85,"line-width":["interpolate",["exponential",1.5],["zoom"],0,3*f,5,3*f,18,10*f]},filter:["==",["get","route"],"ALT"]},{id:`${x}-routeline-casing`,type:"line",source:x,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":["interpolate-hcl",["linear"],["get","congestion"],0,"#7b51f8",1,"#42c74c",100,"#d72359"],"line-opacity":.55,"line-width":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],10*f,7*f],5,["case",["boolean",["get","highlight"],!1],10*f,7*f],18,["case",["boolean",["get","highlight"],!1],32*f,23*f]]},filter:["==",["get","route"],"SELECTED"]},{id:`${x}-routeline`,type:"line",source:x,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":["interpolate-hcl",["linear"],["get","congestion"],0,"#7b51f8",1,"#42c74c",100,"#d72359"],"line-opacity":.85,"line-width":["interpolate",["exponential",1.5],["zoom"],0,3*f,5,3*f,18,10*f]},filter:["==",["get","route"],"SELECTED"]},{id:`${x}-hoverpoint-casing`,type:"circle",source:x,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,14*_,5,14*_,18,33*_],"circle-color":"#30a856","circle-opacity":.65},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${x}-hoverpoint`,type:"circle",source:x,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,9*_,5,9*_,18,21*_],"circle-color":"#30a856"},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${x}-snappoint-casing`,type:"circle",source:x,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],14*_,12*_],5,["case",["boolean",["get","highlight"],!1],14*_,12*_],18,["case",["boolean",["get","highlight"],!1],33*_,28*_]],"circle-color":["case",["boolean",["get","highlight"],!1],"#e50d3f","#cb3373"],"circle-opacity":.65},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${x}-snappoint`,type:"circle",source:x,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],9*_,7*_],5,["case",["boolean",["get","highlight"],!1],9*_,7*_],18,["case",["boolean",["get","highlight"],!1],21*_,16*_]],"circle-color":["case",["boolean",["get","highlight"],!1],"#e50d3f","#cb3373"]},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${x}-waypoint-casing`,type:"circle",source:x,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],14*_,12*_],5,["case",["boolean",["get","highlight"],!1],14*_,12*_],18,["case",["boolean",["get","highlight"],!1],33*_,28*_]],"circle-color":["case",["boolean",["get","highlight"],!1],"#6d26d7","#7b33e7"],"circle-opacity":.65},filter:["==",["get","type"],"WAYPOINT"]},{id:`${x}-waypoint`,type:"circle",source:x,paint:{"circle-radius":["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],9*_,7*_],5,["case",["boolean",["get","highlight"],!1],9*_,7*_],18,["case",["boolean",["get","highlight"],!1],21*_,16*_]],"circle-color":["case",["boolean",["get","highlight"],!1],"#6d26d7","#7b33e7"]},filter:["==",["get","type"],"WAYPOINT"]}]}let ld=(_=21)=>crypto.getRandomValues(new Uint8Array(_)).reduce((f,x)=>(x&=63,x<36?f+=x.toString(36):x<62?f+=(x-26).toString(36).toUpperCase():x>62?f+="-":f+="_",f),"");var cd={exports:{}};(function(_){var f={};function x(S){return Math.floor(Math.abs(S)+.5)*(S>=0?1:-1)}function E(S,C,o){S=x(S*o),C=x(C*o);var U=(S-C)*2;U<0&&(U=-U-1);for(var z="";U>=32;)z+=String.fromCharCode((32|U&31)+63),U/=32;return z+=String.fromCharCode((U|0)+63),z}f.decode=function(S,C){for(var o=0,U=0,z=0,ie=[],W=0,ae=0,he=null,_e,Pe,je=Math.pow(10,Number.isInteger(C)?C:5);o<S.length;){he=null,W=1,ae=0;do he=S.charCodeAt(o++)-63,ae+=(he&31)*W,W*=32;while(he>=32);_e=ae&1?(-ae-1)/2:ae/2,W=1,ae=0;do he=S.charCodeAt(o++)-63,ae+=(he&31)*W,W*=32;while(he>=32);Pe=ae&1?(-ae-1)/2:ae/2,U+=_e,z+=Pe,ie.push([U/je,z/je])}return ie},f.encode=function(S,C){if(!S.length)return"";for(var o=Math.pow(10,Number.isInteger(C)?C:5),U=E(S[0][0],0,o)+E(S[0][1],0,o),z=1;z<S.length;z++){var ie=S[z],W=S[z-1];U+=E(ie[0],W[0],o),U+=E(ie[1],W[1],o)}return U};function D(S){for(var C=[],o=0;o<S.length;o++){var U=S[o].slice();C.push([U[1],U[0]])}return C}f.fromGeoJSON=function(S,C){if(S&&S.type==="Feature"&&(S=S.geometry),!S||S.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return f.encode(D(S.coordinates),C)},f.toGeoJSON=function(S,C){var o=f.decode(S,C);return{type:"LineString",coordinates:D(o)}},_.exports&&(_.exports=f)})(cd);var zp=cd.exports;function Bm(_,f){return _.geometries==="geojson"?f.coordinates:_.geometries==="polyline6"?zp.decode(f,6).map(x=>x.reverse()):zp.decode(f,5).map(x=>x.reverse())}function Fm(_,f,x){var E,D,S,C;if((E=_.annotations)!=null&&E.includes("congestion_numeric"))return((D=f==null?void 0:f.congestion_numeric)==null?void 0:D[x])??0;if((S=_.annotations)!=null&&S.includes("congestion"))switch(((C=f==null?void 0:f.congestion)==null?void 0:C[x])??""){case"unknown":return 0;case"low":return 1;case"moderate":return 34;case"heavy":return 77;case"severe":return 100;default:return 0}else return 0}function Om(_,f,x){return!_.geometries||_.geometries==="polyline"?Math.abs(f[0]-x[0])<=1e-5&&Math.abs(f[1]-x[1])<=1e-5:f[0]===x[0]&&f[1]===x[1]}function ud(_){const f=_c(_==null?void 0:_.pointsScalingFactor,_==null?void 0:_.linesScalingFactor,_==null?void 0:_.sourceName);return Object.assign({},Rm,{layers:f},_)}function hd(_,f,x){const E=_.makePostRequest?"post":"get";let D,S;if(E==="get")D=`${_.api}/${_.profile}/${f.join(";")}`,S=new URLSearchParams(_.requestOptions);else{D=`${_.api}/${_.profile}${_.requestOptions.access_token?`?access_token=${_.requestOptions.access_token}`:""}`;const C=new FormData;Object.entries(_.requestOptions).forEach(([o,U])=>{o!=="access_token"&&C.set(o,U)}),C.set("coordinates",f.join(";")),S=new URLSearchParams(C)}return _.bearings&&S.set("bearings",x.map(C=>C?`${C[0]},${C[1]}`:"").join(";")),{method:E,url:D,payload:S}}function pd(_,f,x){return{type:"Feature",geometry:{type:"Point",coordinates:_},properties:{type:f,id:ld(),...x??{}}}}function dd(_,f,x,E,D=!1){if(_.length!==f.length)return[];const S=_.map((C,o)=>({type:"Feature",geometry:{type:"LineString",coordinates:[[C[0],C[1]],[f[o][0],f[o][1]]]},properties:{type:"SNAPLINE"}}));return~E&&x!==void 0&&D&&(S.push({type:"Feature",geometry:{type:"LineString",coordinates:[[x[0],x[1]],[f[E][0],f[E][1]]]},properties:{type:"SNAPLINE"}}),S.push({type:"Feature",geometry:{type:"LineString",coordinates:[[x[0],x[1]],[f[E+1][0],f[E+1][1]]]},properties:{type:"SNAPLINE"}})),S}function fd(_,f,x,E){return f.map((D,S)=>{const C=Bm(_,D.geometry),o=E.map(W=>W.geometry.coordinates).map(W=>C.findIndex(ae=>Om(_,ae,W))).slice(1);let U=0;const z=o.map(W=>C.slice(U,U=W+1)),ie=[];return z.forEach((W,ae)=>{const he=ld();W.forEach((_e,Pe)=>{var je,Se,Xe;const ze=ie[ie.length-1],qe=Fm(_,(je=D.legs[ae])==null?void 0:je.annotation,Pe);if(ae===((Se=ze==null?void 0:ze.properties)==null?void 0:Se.legIndex)&&((Xe=ze.properties)==null?void 0:Xe.congestion)===qe)ze.geometry.coordinates.push(_e);else{const nt=E[ae].properties??{},Ee=E[ae+1].properties??{},Qe={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{id:he,routeIndex:S,route:S===x?"SELECTED":"ALT",legIndex:ae,congestion:qe,departSnappointProperties:nt,arriveSnappointProperties:Ee}};ze&&Qe.geometry.coordinates.push(ze.geometry.coordinates[ze.geometry.coordinates.length-1]),Qe.geometry.coordinates.push(_e),ie.push(Qe)}})}),ie})}const Um=Object.freeze(Object.defineProperty({__proto__:null,buildConfiguration:ud,buildPoint:pd,buildRequest:hd,buildRoutelines:fd,buildSnaplines:dd},Symbol.toStringTag,{value:"Module"}));class Hn extends Lm{constructor(f,x){super(f),vt(this,"configuration"),vt(this,"_interactive",!1),vt(this,"buildRequest",hd),vt(this,"buildPoint",pd),vt(this,"buildSnaplines",dd),vt(this,"buildRoutelines",fd),vt(this,"onMoveHandler"),vt(this,"onDragDownHandler"),vt(this,"onDragMoveHandler"),vt(this,"onDragUpHandler"),vt(this,"onClickHandler"),vt(this,"liveRefreshHandler"),vt(this,"_waypoints",[]),vt(this,"snappoints",[]),vt(this,"routelines",[]),vt(this,"selectedRouteIndex",0),vt(this,"hoverpoint"),vt(this,"highlightedWaypoints",[]),vt(this,"highlightedSnappoints",[]),vt(this,"dragDownPosition",{x:0,y:0}),vt(this,"waypointBeingDragged"),vt(this,"waypointBeingDraggedInitialCoordinates"),vt(this,"departSnappointIndex",-1),vt(this,"currentMousePosition",{x:0,y:0}),vt(this,"refreshOnMoveIsRefreshing",!1),vt(this,"noMouseMovementTimer"),vt(this,"lastRequestMousePosition",{x:0,y:0}),vt(this,"abortController"),this.map=f,this.configuration=ud(x),this.onMoveHandler=this.onMove.bind(this),this.onDragDownHandler=this.onDragDown.bind(this),this.onDragMoveHandler=this.onDragMove.bind(this),this.onDragUpHandler=this.onDragUp.bind(this),this.onClickHandler=this.onClick.bind(this),this.liveRefreshHandler=this.liveRefresh.bind(this),this.init()}get waypointsCoordinates(){return this._waypoints.map(f=>[f.geometry.coordinates[0],f.geometry.coordinates[1]])}get snappointsCoordinates(){return this.snappoints.map(f=>[f.geometry.coordinates[0],f.geometry.coordinates[1]])}get snaplines(){var f,x,E;return this.buildSnaplines(this.waypointsCoordinates,this.snappointsCoordinates,(f=this.hoverpoint)==null?void 0:f.geometry.coordinates,this.departSnappointIndex,(E=(x=this.hoverpoint)==null?void 0:x.properties)==null?void 0:E.showSnaplines)}init(){this.map.addSource(this.configuration.sourceName,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.configuration.layers.forEach(f=>{this.map.addLayer(f)})}async fetchDirections(f){var x,E;(x=this.abortController)==null||x.abort();const D=this.interactive;if(this._waypoints.length>=2){this.fire(new kp("fetchroutesstart",f)),this.abortController=new AbortController;const S=this.abortController.signal;S.onabort=()=>{this.interactive=D},this.interactive=!1;let C;this.configuration.requestTimeout!==null&&(C=setTimeout(()=>{var W;return(W=this.abortController)==null?void 0:W.abort()},this.configuration.requestTimeout));const{method:o,url:U,payload:z}=this.buildRequest(this.configuration,this.waypointsCoordinates,this.configuration.bearings?this.waypointsBearings:void 0);let ie;try{if(o==="get"?ie=await(await fetch(`${U}?${z}`,{signal:this.abortController.signal})).json():ie=await(await fetch(`${U}`,{signal:this.abortController.signal,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:z})).json(),ie.code!=="Ok")throw new Error(ie.message??"An unexpected error occurred.")}finally{((E=this.abortController)==null?void 0:E.signal.reason)!=="DESTROY"&&(this.interactive=D),this.abortController=void 0,clearTimeout(C),this.fire(new kp("fetchroutesend",f,ie))}this.snappoints=ie.waypoints.map((W,ae)=>{var he;return this.buildPoint(W.location,"SNAPPOINT",{waypointProperties:((he=this._waypoints[ae])==null?void 0:he.properties)??{}})}),this.routelines=this.buildRoutelines(this.configuration.requestOptions,ie.routes,this.selectedRouteIndex,this.snappoints),ie.routes.length<=this.selectedRouteIndex&&(this.selectedRouteIndex=0)}else this.snappoints=[],this.routelines=[];this.draw(!1)}draw(f=!0){const x=[...this._waypoints,...this.snappoints,...this.snaplines,...this.routelines.reduce((D,S)=>f?D.concat(...S):D.concat(...S.map(C=>(C.properties&&(C.properties.route=C.properties.routeIndex===this.selectedRouteIndex?"SELECTED":"ALT"),C))),[])];this.hoverpoint&&x.push(this.hoverpoint);const E={type:"FeatureCollection",features:x};this.map.getSource(this.configuration.sourceName)&&this.map.getSource(this.configuration.sourceName).setData(E)}deHighlight(){this.highlightedWaypoints.forEach(f=>{f!=null&&f.properties&&(f.properties.highlight=!1)}),this.highlightedSnappoints.forEach(f=>{f!=null&&f.properties&&(f.properties.highlight=!1)}),this.routelines.forEach(f=>{f.forEach(x=>{x.properties&&(x.properties.highlight=!1)})})}onMove(f){var x,E,D,S;const C=this.map.queryRenderedFeatures(f.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveRoutelineLayers,...this.configuration.sensitiveAltRoutelineLayers]})[0];if(this.deHighlight(),this.configuration.sensitiveWaypointLayers.includes((C==null?void 0:C.layer.id)??"")){this.map.getCanvas().style.cursor="pointer",this.map.dragPan.disable();const o=this._waypoints.findIndex(U=>{var z,ie;return((z=U.properties)==null?void 0:z.id)===((ie=C==null?void 0:C.properties)==null?void 0:ie.id)});this.highlightedWaypoints=[this._waypoints[o]],this.highlightedSnappoints=[this.snappoints[o]],(x=this.highlightedWaypoints[0])!=null&&x.properties&&(this.highlightedWaypoints[0].properties.highlight=!0),(E=this.highlightedSnappoints[0])!=null&&E.properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else if(this.configuration.sensitiveSnappointLayers.includes((C==null?void 0:C.layer.id)??"")){this.map.getCanvas().style.cursor="pointer";const o=this.snappoints.findIndex(U=>{var z,ie;return((z=U.properties)==null?void 0:z.id)===((ie=C==null?void 0:C.properties)==null?void 0:ie.id)});this.highlightedSnappoints=[this.snappoints[o]],this.highlightedWaypoints=[this._waypoints[o]],this.highlightedSnappoints[0].properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.highlightedWaypoints[0].properties&&(this.highlightedWaypoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else this.configuration.sensitiveRoutelineLayers.includes((C==null?void 0:C.layer.id)??"")?(this.map.getCanvas().style.cursor="pointer",this.map.dragPan.disable(),this.hoverpoint?this.hoverpoint.geometry.coordinates=[f.lngLat.lng,f.lngLat.lat]:this.hoverpoint=this.buildPoint([f.lngLat.lng,f.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse(((D=C==null?void 0:C.properties)==null?void 0:D.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse(((S=C==null?void 0:C.properties)==null?void 0:S.arriveSnappointProperties)??"{}")}}),this.routelines.forEach(o=>{o.forEach(U=>{var z,ie;U.properties&&((z=U.properties)==null?void 0:z.id)===((ie=C==null?void 0:C.properties)==null?void 0:ie.id)&&(U.properties.highlight=!0)})})):this.configuration.sensitiveAltRoutelineLayers.includes((C==null?void 0:C.layer.id)??"")?(this.map.getCanvas().style.cursor="pointer",this.routelines.forEach(o=>{o.forEach(U=>{var z,ie;U.properties&&((z=U.properties)==null?void 0:z.id)===((ie=C==null?void 0:C.properties)==null?void 0:ie.id)&&(U.properties.highlight=!0)})}),this.hoverpoint&&(this.hoverpoint=void 0)):(this.map.dragPan.enable(),this.map.getCanvas().style.cursor="",this.hoverpoint=void 0);this.draw()}onDragDown(f){var x,E,D,S,C,o;if(f.type==="touchstart"&&f.originalEvent.touches.length!==1||f.type==="mousedown"&&f.originalEvent.which!==1)return;const U=this.map.queryRenderedFeatures(f.point);if(U.length&&U[0].source===this.configuration.sourceName){const z=U.filter(ie=>this.configuration.sensitiveWaypointLayers.includes((ie==null?void 0:ie.layer.id)??"")||this.configuration.sensitiveSnappointLayers.includes((ie==null?void 0:ie.layer.id)??"")||this.configuration.sensitiveRoutelineLayers.includes((ie==null?void 0:ie.layer.id)??""))[0];if(this.dragDownPosition=f.point,this.currentMousePosition=f.point,this.configuration.sensitiveWaypointLayers.includes((z==null?void 0:z.layer.id)??""))this.waypointBeingDragged=this._waypoints.find(ie=>{var W,ae;return((W=ie.properties)==null?void 0:W.id)===((ae=z==null?void 0:z.properties)==null?void 0:ae.id)}),this.waypointBeingDraggedInitialCoordinates=(x=this.waypointBeingDragged)==null?void 0:x.geometry.coordinates;else if(this.configuration.sensitiveRoutelineLayers.includes((z==null?void 0:z.layer.id)??"")){if(this.departSnappointIndex=JSON.parse((E=z==null?void 0:z.properties)==null?void 0:E.legIndex),this.hoverpoint)if(this.configuration.refreshOnMove){const ie=this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0;this._addWaypoint([f.lngLat.lng,f.lngLat.lat],ie,f),this.waypointBeingDragged=this._waypoints[ie],this.hoverpoint=void 0}else this.hoverpoint.geometry.coordinates=[f.lngLat.lng,f.lngLat.lat];else this.hoverpoint=this.buildPoint([f.lngLat.lng,f.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse(((D=z==null?void 0:z.properties)==null?void 0:D.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse(((S=z==null?void 0:z.properties)==null?void 0:S.arriveSnappointProperties)??"{}")}});(C=this.hoverpoint)!=null&&C.properties&&(this.hoverpoint.properties.showSnaplines=!0),~this.departSnappointIndex&&(o=this.snappoints[this.departSnappointIndex])!=null&&o.properties&&(this.snappoints[this.departSnappointIndex].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex]),this.snappoints[this.departSnappointIndex+1].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex+1]))}this.map.off("touchstart",this.onMoveHandler),this.map.off("mousemove",this.onMoveHandler),f.type==="touchstart"?(this.map.on("touchmove",this.onDragMoveHandler),this.map.on("touchend",this.onDragUpHandler)):f.type==="mousedown"&&(this.map.on("mousemove",this.onDragMoveHandler),this.map.on("mouseup",this.onDragUpHandler)),this.draw()}}onDragMove(f){if(this.configuration.refreshOnMove&&(clearTimeout(this.noMouseMovementTimer),this.noMouseMovementTimer=setTimeout(this.liveRefreshHandler,300,f)),f.type==="touchmove"&&f.originalEvent.touches.length!==1)return f.originalEvent.preventDefault();f.type==="mousemove"&&f.originalEvent.which!==1||(this.waypointBeingDragged?this.waypointBeingDragged.geometry.coordinates=[f.lngLat.lng,f.lngLat.lat]:this.hoverpoint&&(this.hoverpoint.geometry.coordinates=[f.lngLat.lng,f.lngLat.lat]),this.currentMousePosition=f.point,this.draw(),this.configuration.refreshOnMove&&!this.refreshOnMoveIsRefreshing&&this.liveRefreshHandler(f))}async onDragUp(f){var x,E,D;if(this.configuration.refreshOnMove&&clearTimeout(this.noMouseMovementTimer),!(f.type==="mouseup"&&f.originalEvent.which!==1)){if((x=this.hoverpoint)!=null&&x.properties&&(this.hoverpoint.properties.showSnaplines=!1),Math.abs(f.point.x-((E=this.dragDownPosition)==null?void 0:E.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(f.point.y-((D=this.dragDownPosition)==null?void 0:D.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0))if(this.waypointBeingDragged){this.waypointBeingDragged.geometry.coordinates=[f.lngLat.lng,f.lngLat.lat];const S=new Gs("movewaypoint",f,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(S);try{await this.fetchDirections(S)}catch(C){C instanceof DOMException&&C.name=="AbortError"||this.waypointBeingDraggedInitialCoordinates&&(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates)}this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0}else this.hoverpoint&&(this._addWaypoint([f.lngLat.lng,f.lngLat.lat],this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0,f),this.hoverpoint=void 0);else this.waypointBeingDragged&&this.waypointBeingDraggedInitialCoordinates?(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates,this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0):this.hoverpoint&&(this.hoverpoint=void 0);this.deHighlight(),f.type==="touchend"?(this.map.off("touchmove",this.onDragMoveHandler),this.map.off("touchend",this.onDragUpHandler)):f.type==="mouseup"&&(this.map.off("mousemove",this.onDragMoveHandler),this.map.off("mouseup",this.onDragUpHandler)),this.map.on("touchstart",this.onMoveHandler),this.map.on("mousemove",this.onMoveHandler),this.map.dragPan.enable(),this.draw()}}async liveRefresh(f){var x,E,D,S;if(Math.abs(((x=this.lastRequestMousePosition)==null?void 0:x.x)-((E=this.currentMousePosition)==null?void 0:E.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(((D=this.lastRequestMousePosition)==null?void 0:D.y)-((S=this.currentMousePosition)==null?void 0:S.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)){if(this.refreshOnMoveIsRefreshing=!0,this.lastRequestMousePosition=this.currentMousePosition,this.waypointBeingDragged){const C=new Gs("movewaypoint",f,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(C);try{await this.fetchDirections(C)}catch{}}this.refreshOnMoveIsRefreshing=!1}}onClick(f){const x=this.map.queryRenderedFeatures(f.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveAltRoutelineLayers,...this.configuration.sensitiveRoutelineLayers]})[0];if(this.configuration.sensitiveWaypointLayers.includes((x==null?void 0:x.layer.id)??"")){const E=this._waypoints.findIndex(D=>{var S,C;return((S=D.properties)==null?void 0:S.id)===((C=x==null?void 0:x.properties)==null?void 0:C.id)});~E&&this._removeWaypoint(E,f)}else if(this.configuration.sensitiveSnappointLayers.includes((x==null?void 0:x.layer.id)??"")){const E=this.snappoints.findIndex(D=>{var S,C;return((S=D.properties)==null?void 0:S.id)===((C=x==null?void 0:x.properties)==null?void 0:C.id)});~E&&this._removeWaypoint(E,f)}else this.configuration.sensitiveAltRoutelineLayers.includes((x==null?void 0:x.layer.id)??"")?this.selectedRouteIndex=this.routelines.findIndex(E=>!!E.find(D=>{var S,C;return((S=D.properties)==null?void 0:S.id)===((C=x==null?void 0:x.properties)==null?void 0:C.id)})):this.configuration.sensitiveRoutelineLayers.includes((x==null?void 0:x.layer.id)??"")||this._addWaypoint([f.lngLat.lng,f.lngLat.lat],void 0,f);this.draw(!1)}assignWaypointsCategories(){this._waypoints.forEach((f,x)=>{const E=x===0?"ORIGIN":x===this._waypoints.length-1?"DESTINATION":void 0;f.properties&&(f.properties.index=x,f.properties.category=E)})}async _addWaypoint(f,x,E){var D;(D=this.abortController)==null||D.abort(),x=x??this._waypoints.length,this._waypoints.splice(x,0,this.buildPoint(f,"WAYPOINT",this.configuration.bearings?{bearing:void 0}:void 0)),this.assignWaypointsCategories();const S=new Gs("addwaypoint",E,{index:x});this.fire(S),this.draw();try{await this.fetchDirections(S)}catch{}}async _removeWaypoint(f,x){var E;(E=this.abortController)==null||E.abort(),this._waypoints.splice(f,1),this.snappoints.splice(f,1),this.assignWaypointsCategories();const D=new Gs("removewaypoint",x,{index:f});this.fire(D),this.draw();try{await this.fetchDirections(D)}catch{}}get interactive(){return this._interactive}set interactive(f){this._interactive=f,f?(this.map.on("touchstart",this.onMoveHandler),this.map.on("touchstart",this.onDragDownHandler),this.map.on("mousemove",this.onMoveHandler),this.map.on("mousedown",this.onDragDownHandler),this.map.on("click",this.onClickHandler)):(this.map.off("touchstart",this.onMoveHandler),this.map.off("touchstart",this.onDragDownHandler),this.map.off("mousemove",this.onMoveHandler),this.map.off("mousedown",this.onDragDownHandler),this.map.off("click",this.onClickHandler))}get waypoints(){return this.waypointsCoordinates}set waypoints(f){this.setWaypoints(f)}get waypointsBearings(){return this.configuration.bearings?this._waypoints.map(f=>Array.isArray(f.properties.bearing)?[f.properties.bearing[0],f.properties.bearing[1]]:void 0):(console.warn("The `waypointsBearings` getter was referred to, but the `bearings` configuration option is not enabled!"),[])}set waypointsBearings(f){if(!this.configuration.bearings){console.warn("The `waypointsBearings` setter was referred to, but the `bearings` configuration option is not enabled!");return}this._waypoints.forEach((E,D)=>{E.properties.bearing=f[D]});const x=new Gs("rotatewaypoints",void 0);this.fire(x),this.draw();try{this.fetchDirections(x)}catch{}}async setWaypoints(f){var x;(x=this.abortController)==null||x.abort(),this._waypoints=f.map((D,S)=>this.buildPoint(D,"WAYPOINT",this.configuration.bearings?{bearing:this.waypointsBearings[S]}:void 0)),this.assignWaypointsCategories();const E=new Gs("setwaypoints",void 0);this.fire(E),this.draw();try{await this.fetchDirections(E)}catch{}}async addWaypoint(f,x){await this._addWaypoint(f,x)}async removeWaypoint(f){await this._removeWaypoint(f)}clear(){this.setWaypoints([]),this.routelines=[]}destroy(){var f;(f=this.abortController)==null||f.abort("DESTROY"),this.clear(),this.interactive=!1,this.configuration.layers.forEach(x=>{this.map.removeLayer(x.id)}),this.map.removeSource(this.configuration.sourceName)}}function Ws(){}function md(_){return _()}function Dp(){return Object.create(null)}function nl(_){_.forEach(md)}function gd(_){return typeof _=="function"}function _d(_,f){return _!=_?f==f:_!==f||_&&typeof _=="object"||typeof _=="function"}function Vm(_){return Object.keys(_).length===0}function Yt(_,f){_.appendChild(f)}function _s(_,f,x){_.insertBefore(f,x||null)}function Qr(_){_.parentNode&&_.parentNode.removeChild(_)}function Nm(_,f){for(let x=0;x<_.length;x+=1)_[x]&&_[x].d(f)}function Tr(_){return document.createElement(_)}function Dr(_){return document.createElementNS("http://www.w3.org/2000/svg",_)}function Xo(_){return document.createTextNode(_)}function gs(){return Xo(" ")}function $m(){return Xo("")}function cc(_,f,x,E){return _.addEventListener(f,x,E),()=>_.removeEventListener(f,x,E)}function We(_,f,x){x==null?_.removeAttribute(f):_.getAttribute(f)!==x&&_.setAttribute(f,x)}function pc(_){return _===""?null:+_}function jm(_){return Array.from(_.childNodes)}function qm(_,f){f=""+f,_.data!==f&&(_.data=f)}function dc(_,f){_.value=f??""}function qs(_,f,x,E){x==null?_.style.removeProperty(f):_.style.setProperty(f,x,E?"important":"")}let il;function Qa(_){il=_}function Gm(){if(!il)throw new Error("Function called outside component initialization");return il}function Zm(_){Gm().$$.on_destroy.push(_)}const Zo=[],Pu=[];let Ho=[];const Lp=[],Wm=Promise.resolve();let ku=!1;function Hm(){ku||(ku=!0,Wm.then(yd))}function zu(_){Ho.push(_)}const Mu=new Set;let qo=0;function yd(){if(qo!==0)return;const _=il;do{try{for(;qo<Zo.length;){const f=Zo[qo];qo++,Qa(f),Xm(f.$$)}}catch(f){throw Zo.length=0,qo=0,f}for(Qa(null),Zo.length=0,qo=0;Pu.length;)Pu.pop()();for(let f=0;f<Ho.length;f+=1){const x=Ho[f];Mu.has(x)||(Mu.add(x),x())}Ho.length=0}while(Zo.length);for(;Lp.length;)Lp.pop()();ku=!1,Mu.clear(),Qa(_)}function Xm(_){if(_.fragment!==null){_.update(),nl(_.before_update);const f=_.dirty;_.dirty=[-1],_.fragment&&_.fragment.p(_.ctx,f),_.after_update.forEach(zu)}}function Ym(_){const f=[],x=[];Ho.forEach(E=>_.indexOf(E)===-1?f.push(E):x.push(E)),x.forEach(E=>E()),Ho=f}const Km=new Set;function Jm(_,f){_&&_.i&&(Km.delete(_),_.i(f))}function Qm(_,f,x,E){const{fragment:D,after_update:S}=_.$$;D&&D.m(f,x),E||zu(()=>{const C=_.$$.on_mount.map(md).filter(gd);_.$$.on_destroy?_.$$.on_destroy.push(...C):nl(C),_.$$.on_mount=[]}),S.forEach(zu)}function eg(_,f){const x=_.$$;x.fragment!==null&&(Ym(x.after_update),nl(x.on_destroy),x.fragment&&x.fragment.d(f),x.on_destroy=x.fragment=null,x.ctx=[])}function tg(_,f){_.$$.dirty[0]===-1&&(Zo.push(_),Hm(),_.$$.dirty.fill(0)),_.$$.dirty[f/31|0]|=1<<f%31}function xd(_,f,x,E,D,S,C,o=[-1]){const U=il;Qa(_);const z=_.$$={fragment:null,ctx:[],props:S,update:Ws,not_equal:D,bound:Dp(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(f.context||(U?U.$$.context:[])),callbacks:Dp(),dirty:o,skip_bound:!1,root:f.target||U.$$.root};C&&C(z.root);let ie=!1;if(z.ctx=x?x(_,f.props||{},(W,ae,...he)=>{const _e=he.length?he[0]:ae;return z.ctx&&D(z.ctx[W],z.ctx[W]=_e)&&(!z.skip_bound&&z.bound[W]&&z.bound[W](_e),ie&&tg(_,W)),ae}):[],z.update(),ie=!0,nl(z.before_update),z.fragment=E?E(z.ctx):!1,f.target){if(f.hydrate){const W=jm(f.target);z.fragment&&z.fragment.l(W),W.forEach(Qr)}else z.fragment&&z.fragment.c();f.intro&&Jm(_.$$.fragment),Qm(_,f.target,f.anchor,f.customElement),yd()}Qa(U)}class vd{$destroy(){eg(this,1),this.$destroy=Ws}$on(f,x){if(!gd(x))return Ws;const E=this.$$.callbacks[f]||(this.$$.callbacks[f]=[]);return E.push(x),()=>{const D=E.indexOf(x);D!==-1&&E.splice(D,1)}}$set(f){this.$$set&&!Vm(f)&&(this.$$.skip_bound=!0,this.$$set(f),this.$$.skip_bound=!1)}}function Rp(_){let f,x,E,D,S,C,o,U,z,ie,W,ae,he,_e,Pe,je;return{c(){f=Dr("svg"),x=Dr("circle"),D=Dr("path"),C=Dr("g"),o=Dr("path"),z=Dr("path"),W=Dr("path"),he=Dr("animateTransform"),We(x,"cx","64.13"),We(x,"cy","64.13"),We(x,"r","27.63"),We(x,"fill",E=_[0].fill),We(D,"d","M64.13 18.5A45.63 45.63 0 1 1 18.5 64.13 45.63 45.63 0 0 1 64.13 18.5zm0 7.85a37.78 37.78 0 1 1-37.78 37.78 37.78 37.78 0 0 1 37.78-37.78z"),We(D,"fill-rule","evenodd"),We(D,"fill",S=_[0].fill),We(o,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),We(o,"fill",U=_[0].fill),We(z,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),We(z,"fill",ie=_[0].fill),We(z,"transform","rotate(120 64 64)"),We(W,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),We(W,"fill",ae=_[0].fill),We(W,"transform","rotate(240 64 64)"),We(he,"attributeName","transform"),We(he,"type","rotate"),We(he,"from","0 64 64"),We(he,"to","120 64 64"),We(he,"dur","360ms"),We(he,"repeatCount","indefinite"),We(f,"xmlns","http://www.w3.org/2000/svg"),We(f,"width",_e=_[0].size),We(f,"height",Pe=_[0].size),We(f,"viewBox","0 0 128 128"),We(f,"xml:space","preserve"),We(f,"class",je=_[0].class)},m(Se,Xe){_s(Se,f,Xe),Yt(f,x),Yt(f,D),Yt(f,C),Yt(C,o),Yt(C,z),Yt(C,W),Yt(C,he)},p(Se,Xe){Xe&1&&E!==(E=Se[0].fill)&&We(x,"fill",E),Xe&1&&S!==(S=Se[0].fill)&&We(D,"fill",S),Xe&1&&U!==(U=Se[0].fill)&&We(o,"fill",U),Xe&1&&ie!==(ie=Se[0].fill)&&We(z,"fill",ie),Xe&1&&ae!==(ae=Se[0].fill)&&We(W,"fill",ae),Xe&1&&_e!==(_e=Se[0].size)&&We(f,"width",_e),Xe&1&&Pe!==(Pe=Se[0].size)&&We(f,"height",Pe),Xe&1&&je!==(je=Se[0].class)&&We(f,"class",je)},d(Se){Se&&Qr(f)}}}function ig(_){let f,x=_[1]&&Rp(_);return{c(){x&&x.c(),f=$m()},m(E,D){x&&x.m(E,D),_s(E,f,D)},p(E,[D]){E[1]?x?x.p(E,D):(x=Rp(E),x.c(),x.m(f.parentNode,f)):x&&(x.d(1),x=null)},i:Ws,o:Ws,d(E){x&&x.d(E),E&&Qr(f)}}}function ng(_,f,x){let{directions:E}=f,{configuration:D}=f,S;return E.on("fetchroutesstart",()=>{x(1,S=!0)}),E.on("fetchroutesend",()=>{x(1,S=!1)}),_.$$set=C=>{"directions"in C&&x(2,E=C.directions),"configuration"in C&&x(0,D=C.configuration)},[D,S,E]}class rg extends vd{constructor(f){super(),xd(this,f,ng,ig,_d,{directions:2,configuration:0})}}const sg={fill:"#6d26d7",size:"24px",class:""};class og{constructor(f,x){vt(this,"controlElement"),vt(this,"directions"),vt(this,"configuration"),this.directions=f,this.configuration=Object.assign({},sg,x)}onAdd(){return this.controlElement=document.createElement("div"),new rg({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}function Bp(_,f,x){const E=_.slice();return E[16]=f[x],E[17]=f,E[18]=x,E}function ag(_){let f,x,E,D,S,C,o,U,z;function ie(){_[11].call(f,_[17],_[18])}return{c(){f=Tr("input"),C=gs(),o=Tr("span"),o.textContent="°",We(f,"type","number"),f.disabled=x=!_[16].enabled,We(f,"min",E=_[0].degreesMin),We(f,"max",D=_[0].degreesMax),We(f,"step",S=_[0].degreesStep),We(f,"class","maplibre-gl-directions-bearings-control__input"),We(o,"class","maplibre-gl-directions-bearings-control__text")},m(W,ae){_s(W,f,ae),dc(f,_[16].degrees),_s(W,C,ae),_s(W,o,ae),U||(z=cc(f,"input",ie),U=!0)},p(W,ae){_=W,ae&2&&x!==(x=!_[16].enabled)&&(f.disabled=x),ae&1&&E!==(E=_[0].degreesMin)&&We(f,"min",E),ae&1&&D!==(D=_[0].degreesMax)&&We(f,"max",D),ae&1&&S!==(S=_[0].degreesStep)&&We(f,"step",S),ae&2&&pc(f.value)!==_[16].degrees&&dc(f,_[16].degrees)},d(W){W&&Qr(f),W&&Qr(C),W&&Qr(o),U=!1,z()}}}function lg(_){let f,x=_[0].fixedDegrees+"",E,D;return{c(){f=Tr("span"),E=Xo(x),D=Xo("°"),We(f,"class","maplibre-gl-directions-bearings-control__text")},m(S,C){_s(S,f,C),Yt(f,E),Yt(f,D)},p(S,C){C&1&&x!==(x=S[0].fixedDegrees+"")&&qm(E,x)},d(S){S&&Qr(f)}}}function Fp(_){let f,x,E=_[18]+1+"",D,S,C,o,U,z,ie,W,ae,he,_e,Pe=_[18],je,Se,Xe,ze,qe,nt,Ee,Qe,ht,At,Wt,yt,fi,Ht,Si;function mi(){_[7].call(o,_[17],_[18])}const Tt=()=>_[8](z,Pe),Vt=()=>_[8](null,Pe);function Ri(...Bi){return _[9](_[18],...Bi)}function Cn(){_[10].call(Se,_[17],_[18])}function Pn(Bi,Mt){return Bi[0].fixedDegrees?lg:ag}let Ei=Pn(_),oi=Ei(_);return{c(){f=Tr("div"),x=Tr("span"),D=Xo(E),S=Xo("."),C=gs(),o=Tr("input"),U=gs(),z=Tr("div"),ie=Dr("svg"),W=Dr("circle"),_e=Dr("circle"),je=gs(),Se=Tr("input"),Ee=gs(),Qe=Tr("span"),Qe.textContent="°",ht=gs(),At=Tr("span"),At.textContent="±",Wt=gs(),oi.c(),yt=gs(),We(x,"class","maplibre-gl-directions-bearings-control__number text-slate-800"),We(o,"type","checkbox"),We(o,"class","maplibre-gl-directions-bearings-control__checkbox"),We(W,"r","5"),We(W,"cx","10"),We(W,"cy","10"),We(W,"fill","transparent"),We(W,"stroke","rgba(109, 38, 215, 0.65)"),We(W,"stroke-width","10"),We(W,"stroke-dasharray",ae=_[16].degrees/3.6*31.42/100+" 31.42"),We(W,"transform",he="rotate("+(-90-_[16].degrees/2+_[16].angle-_[3])+")"),qs(W,"transform-origin","10px 10px"),We(_e,"r","6"),We(_e,"cx","10"),We(_e,"cy","10"),We(_e,"fill","rgb(109, 38, 215)"),We(ie,"height","20"),We(ie,"width","20"),We(ie,"viewBox","0 0 20 20"),We(ie,"class","maplibre-gl-directions-bearings-control__waypoint-image"),qs(ie,"width",_[0].imageSize+"px"),qs(ie,"height",_[0].imageSize+"px"),qs(ie,"opacity",_[16].enabled?1:.25),We(Se,"type","number"),Se.disabled=Xe=!_[16].enabled,We(Se,"min",ze=_[0].angleMin),We(Se,"max",qe=_[0].angleMax),We(Se,"step",nt=_[0].angleStep),We(Se,"class","maplibre-gl-directions-bearings-control__input"),We(Qe,"class","maplibre-gl-directions-bearings-control__text"),We(At,"class","maplibre-gl-directions-bearings-control__text"),We(f,"class",fi="maplibre-gl-directions-bearings-control__list-item "+(_[16].enabled?"maplibre-gl-directions-bearings-control__list-item--enabled":"maplibre-gl-directions-bearings-control__list-item--disabled")+" flex items-center gap-2 text-slate-800"+(_[16].enabled?"":"/50"))},m(Bi,Mt){_s(Bi,f,Mt),Yt(f,x),Yt(x,D),Yt(x,S),Yt(f,C),Yt(f,o),o.checked=_[16].enabled,Yt(f,U),Yt(f,z),Yt(z,ie),Yt(ie,W),Yt(ie,_e),Tt(),Yt(f,je),Yt(f,Se),dc(Se,_[16].angle),Yt(f,Ee),Yt(f,Qe),Yt(f,ht),Yt(f,At),Yt(f,Wt),oi.m(f,null),Yt(f,yt),Ht||(Si=[cc(o,"change",mi),cc(z,"mousedown",Ri),cc(Se,"input",Cn)],Ht=!0)},p(Bi,Mt){_=Bi,Mt&2&&(o.checked=_[16].enabled),Mt&2&&ae!==(ae=_[16].degrees/3.6*31.42/100+" 31.42")&&We(W,"stroke-dasharray",ae),Mt&10&&he!==(he="rotate("+(-90-_[16].degrees/2+_[16].angle-_[3])+")")&&We(W,"transform",he),Mt&1&&qs(ie,"width",_[0].imageSize+"px"),Mt&1&&qs(ie,"height",_[0].imageSize+"px"),Mt&2&&qs(ie,"opacity",_[16].enabled?1:.25),Pe!==_[18]&&(Vt(),Pe=_[18],Tt()),Mt&2&&Xe!==(Xe=!_[16].enabled)&&(Se.disabled=Xe),Mt&1&&ze!==(ze=_[0].angleMin)&&We(Se,"min",ze),Mt&1&&qe!==(qe=_[0].angleMax)&&We(Se,"max",qe),Mt&1&&nt!==(nt=_[0].angleStep)&&We(Se,"step",nt),Mt&2&&pc(Se.value)!==_[16].angle&&dc(Se,_[16].angle),Ei===(Ei=Pn(_))&&oi?oi.p(_,Mt):(oi.d(1),oi=Ei(_),oi&&(oi.c(),oi.m(f,yt))),Mt&2&&fi!==(fi="maplibre-gl-directions-bearings-control__list-item "+(_[16].enabled?"maplibre-gl-directions-bearings-control__list-item--enabled":"maplibre-gl-directions-bearings-control__list-item--disabled")+" flex items-center gap-2 text-slate-800"+(_[16].enabled?"":"/50"))&&We(f,"class",fi)},d(Bi){Bi&&Qr(f),Vt(),oi.d(),Ht=!1,nl(Si)}}}function cg(_){let f,x,E,D=_[1],S=[];for(let C=0;C<D.length;C+=1)S[C]=Fp(Bp(_,D,C));return{c(){f=Tr("div"),x=Tr("div");for(let C=0;C<S.length;C+=1)S[C].c();We(x,"class","maplibre-gl-directions-bearings-control__list flex flex-col max-h-96 overflow-y-auto"),We(f,"class",E="maplibre-gl-directions-bearings-control maplibregl-ctrl maplibregl-ctrl-group p-4 "+(_[1].length?"block":"hidden")+" bg-white text-base rounded")},m(C,o){_s(C,f,o),Yt(f,x);for(let U=0;U<S.length;U+=1)S[U]&&S[U].m(x,null)},p(C,[o]){if(o&31){D=C[1];let U;for(U=0;U<D.length;U+=1){const z=Bp(C,D,U);S[U]?S[U].p(z,o):(S[U]=Fp(z),S[U].c(),S[U].m(x,null))}for(;U<S.length;U+=1)S[U].d(1);S.length=D.length}o&2&&E!==(E="maplibre-gl-directions-bearings-control maplibregl-ctrl maplibregl-ctrl-group p-4 "+(C[1].length?"block":"hidden")+" bg-white text-base rounded")&&We(f,"class",E)},i:Ws,o:Ws,d(C){C&&Qr(f),Nm(S,C)}}}function ug(_,f,x){let{directions:E}=f,{configuration:D}=f;E.configuration.bearings||console.warn("The Bearings Control is used, but the `bearings` configuration option is not enabled!");let S=[];E.on("addwaypoint",C),E.on("removewaypoint",C),E.on("movewaypoint",C),E.on("setwaypoints",C);function C(){x(1,S=E.waypointsBearings.map((ze,qe)=>S[qe]?S[qe]:{enabled:D.defaultEnabled||!!ze,angle:ze?ze[0]:D.angleDefault,degrees:ze?ze[1]:D.fixedDegrees?D.fixedDegrees:D.degreesDefault}))}C();let o;const U=[];let z=-1;function ie(ze,qe){var nt;(nt=S[qe])!=null&&nt.enabled&&(z=qe,document.addEventListener("mouseup",W),document.addEventListener("mousemove",ae))}function W(){z=-1,document.removeEventListener("mouseup",W),document.removeEventListener("mousemove",ae)}function ae(ze){if(~z&&U[z]){const qe=U[z],nt=qe.getBoundingClientRect().x+D.imageSize/2,Ee=qe.getBoundingClientRect().y+D.imageSize/2,Qe=ze.pageX,ht=ze.pageY,At=Math.atan2(Qe-nt,ht-Ee)*(180/Math.PI)*-1+90;x(1,S[z].angle=90+At+he|0,S)}}Zm(()=>{document.removeEventListener("mouseup",W),document.removeEventListener("mousemove",ae)});let he=0;D.respectMapBearing&&E.map.on("rotate",()=>x(3,he=E.map.getBearing()));function _e(ze,qe){ze[qe].enabled=this.checked,x(1,S)}function Pe(ze,qe){Pu[ze?"unshift":"push"](()=>{U[qe]=ze,x(2,U)})}const je=(ze,qe)=>ie(qe,ze);function Se(ze,qe){ze[qe].angle=pc(this.value),x(1,S)}function Xe(ze,qe){ze[qe].degrees=pc(this.value),x(1,S)}return _.$$set=ze=>{"directions"in ze&&x(5,E=ze.directions),"configuration"in ze&&x(0,D=ze.configuration)},_.$$.update=()=>{_.$$.dirty&67&&(o&&clearTimeout(o),x(6,o=setTimeout(()=>{x(5,E.waypointsBearings=S.map(ze=>ze.enabled?[ze.angle,ze.degrees]:void 0),E)},D.debounceTimeout)))},[D,S,U,he,ie,E,o,_e,Pe,je,Se,Xe]}let hg=class extends vd{constructor(_){super(),xd(this,_,ug,cg,_d,{directions:5,configuration:0})}};const pg={defaultEnabled:!1,debounceTimeout:150,angleDefault:0,angleMin:0,angleMax:359,angleStep:1,fixedDegrees:0,degreesDefault:45,degreesMin:15,degreesMax:360,degreesStep:15,respectMapBearing:!1,imageSize:50};class dg{constructor(f,x){vt(this,"controlElement"),vt(this,"directions"),vt(this,"configuration"),this.directions=f,this.configuration=Object.assign({},pg,x)}onAdd(){return this.controlElement=document.createElement("div"),new hg({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}function Op(_){let f,x;return{c(){f=me("p"),x=Li(_[4]),Be(f,"class","text-red-500")},m(E,D){fe(E,f,D),Ae(f,x)},p(E,D){D&16&&Ru(x,E[4])},d(E){E&&de(f)}}}function fg(_){let f,x,E,D,S,C,o,U,z,ie,W,ae,he,_e,Pe,je,Se=_[4]&&Op(_);return{c(){Se&&Se.c(),f=Oe(),x=me("label"),E=me("input"),S=Oe(),C=me("strong"),C.textContent="Interactivity enabled",o=Oe(),U=me("label"),z=me("input"),W=Oe(),ae=me("strong"),ae.textContent="Update route while dragging",he=Oe(),_e=me("ul"),_e.innerHTML=`<li>Click somewhere on the map to add a waypoint</li> 
    <li>Click a waypoint to remove it and its related snappoint</li> 
    <li>Click a snappoint to remove it and its related waypoint</li> 
    <li>Drag a waypoint somewhere to move it</li> 
    <li>Drag a routeline somewhere to add a waypoint in-between the 2 nearest ones</li> 
    <li>Click an alternative routeline to select it<br/> 
      <small><strong>Note</strong>, there&#39;s usually no alternative routelines in the server response if there are more than
        2 waypoints</small></li>`,Be(E,"type","checkbox"),E.disabled=D=!_[0],Be(x,"class","flex items-center gap-3"),Be(z,"type","checkbox"),z.disabled=ie=!_[0],Be(U,"class","flex items-center gap-3")},m(Xe,ze){Se&&Se.m(Xe,ze),fe(Xe,f,ze),fe(Xe,x,ze),Ae(x,E),E.checked=_[1],Ae(x,S),Ae(x,C),fe(Xe,o,ze),fe(Xe,U,ze),Ae(U,z),z.checked=_[3],Ae(U,W),Ae(U,ae),fe(Xe,he,ze),fe(Xe,_e,ze),Pe||(je=[Zt(E,"change",_[7]),Zt(z,"change",_[8]),Zt(z,"click",_[6])],Pe=!0)},p(Xe,ze){Xe[4]?Se?Se.p(Xe,ze):(Se=Op(Xe),Se.c(),Se.m(f.parentNode,f)):Se&&(Se.d(1),Se=null),ze&1&&D!==(D=!Xe[0])&&(E.disabled=D),ze&2&&(E.checked=Xe[1]),ze&1&&ie!==(ie=!Xe[0])&&(z.disabled=ie),ze&8&&(z.checked=Xe[3])},d(Xe){Se&&Se.d(Xe),Xe&&de(f),Xe&&de(x),Xe&&de(o),Xe&&de(U),Xe&&de(he),Xe&&de(_e),Pe=!1,Lr(je)}}}function mg(_){let f;return{c(){f=me("span"),f.textContent=`${_[5].name}`,Be(f,"slot","title")},m(x,E){fe(x,f,E)},p:Nt,d(x){x&&de(f)}}}function gg(_){let f,x,E,D;return f=new Kn({props:{$$slots:{title:[mg],default:[fg]},$$scope:{ctx:_}}}),{c(){Xi(f.$$.fragment),x=Oe(),E=me("div"),Be(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,C){$i(f,S,C),fe(S,x,C),fe(S,E,C),_[9](E),D=!0},p(S,[C]){const o={};C&4123&&(o.$$scope={dirty:C,ctx:S}),f.$set(o)},i(S){D||(di(f.$$.fragment,S),D=!0)},o(S){Ti(f.$$.fragment,S),D=!1},d(S){ji(f,S),S&&de(x),S&&de(E),_[9](null)}}}function _g(_,f,x){let E;Xn(_,Yn,Pe=>x(11,E=Pe));const D=mn.find(Pe=>Pe.path===E);let S,C,o,U=!0,z=!1;function ie(){o&&o.destroy(),x(0,o=new Hn(C,{requestOptions:{alternatives:"true"},refreshOnMove:!z}))}ur(()=>{C=new hr.Map({container:S,style:pr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"}),C.on("load",()=>{x(0,o=new Hn(C,{requestOptions:{alternatives:"true"}}))})});let W;function ae(){U=this.checked,x(1,U)}function he(){z=this.checked,x(3,z)}function _e(Pe){$n[Pe?"unshift":"push"](()=>{S=Pe,x(2,S)})}return _.$$.update=()=>{_.$$.dirty&3&&o&&(x(0,o.interactive=U,o),o.on("fetchroutesend",Pe=>{Pe.data.code!=="Ok"?x(4,W=`${Pe.data.code}: ${Pe.data.message??"no details available."}`):x(4,W="")}))},[o,U,S,z,W,D,ie,ae,he,_e]}class yg extends _n{constructor(f){super(),gn(this,f,_g,gg,ln,{})}}const xg=Object.freeze(Object.defineProperty({__proto__:null,default:yg},Symbol.toStringTag,{value:"Module"}));function vg(_){let f,x,E,D,S,C,o,U,z,ie,W,ae,he,_e,Pe,je,Se,Xe,ze,qe,nt,Ee,Qe,ht,At,Wt,yt,fi,Ht,Si,mi,Tt,Vt,Ri,Cn,Pn,Ei,oi,Bi,Mt,Jn,ti,Yi,Sr,Qn,Ki,Ji,yn,Ii,ye,dr,qi,Dt,It,gi,Er,Ur,xn,ai,er,kn,Re,Gi,ii,cn,zn,De,dt,pt,jt,Qi,rt,Zi,Wi,tr,ir,_i,j,k,R,N,Y,Q,se,re;return{c(){f=me("p"),f.innerHTML=`The <a href="http://project-osrm.org/docs/v5.24.0/api/#requests" target="_blank" rel="noreferrer">bearings</a> support
    allows to control in which direction the route would be continued from a given waypoint.`,x=Oe(),E=me("p"),E.innerHTML=`In order to enable support for this API option on the plugin level, pass the <code>bearings: true</code> option to
    the plugin&#39;s configuration object. When this is done, each request would contain the <code>bearings</code> field. The
    problem with that is that the values for the waypoints&#39; bearings are not populated correctly since we need some way to
    assign these bearings values to our waypoints.`,D=Oe(),S=me("p"),S.innerHTML="Luckily, that&#39;s possible to achieve using the built-in <strong>Bearings Control</strong>.",C=Oe(),o=me("label"),U=me("input"),ie=Oe(),W=me("strong"),W.textContent="Default Enabled",ae=Oe(),he=me("label"),_e=me("span"),_e.innerHTML="<strong>Debounce timeout</strong>",Pe=Oe(),je=me("input"),Xe=Oe(),ze=me("label"),qe=me("span"),qe.innerHTML="<strong>Default angle</strong>",nt=Oe(),Ee=me("input"),ht=Oe(),At=me("label"),Wt=me("span"),Wt.innerHTML="<strong>Minimal allowed angle</strong>",yt=Oe(),fi=me("input"),Si=Oe(),mi=me("label"),Tt=me("span"),Tt.innerHTML="<strong>Maximal allowed angle</strong>",Vt=Oe(),Ri=me("input"),Pn=Oe(),Ei=me("label"),oi=me("span"),oi.innerHTML="<strong>Angle step</strong>",Bi=Oe(),Mt=me("input"),ti=Oe(),Yi=me("label"),Sr=me("span"),Sr.innerHTML="<strong>Fixed degrees</strong>",Qn=Oe(),Ki=me("input"),yn=Oe(),Ii=me("label"),ye=me("span"),ye.innerHTML="<strong>Degrees default</strong>",dr=Oe(),qi=me("input"),It=Oe(),gi=me("label"),Er=me("span"),Er.innerHTML="<strong>Minimal allowed degrees</strong>",Ur=Oe(),xn=me("input"),er=Oe(),kn=me("label"),Re=me("span"),Re.innerHTML="<strong>Maximal allowed degrees</strong>",Gi=Oe(),ii=me("input"),zn=Oe(),De=me("label"),dt=me("span"),dt.innerHTML="<strong>Degrees step</strong>",pt=Oe(),jt=me("input"),rt=Oe(),Zi=me("label"),Wi=me("input"),ir=Oe(),_i=me("strong"),_i.textContent="Respect Map's Bearing",j=Oe(),k=me("label"),R=me("span"),R.innerHTML="<strong>Image size</strong>",N=Oe(),Y=me("input"),Be(U,"type","checkbox"),U.disabled=z=!_[0],Be(o,"class","flex items-center gap-3"),Be(je,"type","number"),je.disabled=Se=!_[0],Be(he,"class","flex flex-col gap-2"),Be(Ee,"type","number"),Ee.disabled=Qe=!_[0],Be(ze,"class","flex flex-col gap-2"),Be(fi,"type","number"),fi.disabled=Ht=!_[0],Be(At,"class","flex flex-col gap-2"),Be(Ri,"type","number"),Ri.disabled=Cn=!_[0],Be(mi,"class","flex flex-col gap-2"),Be(Mt,"type","number"),Mt.disabled=Jn=!_[0],Be(Ei,"class","flex flex-col gap-2"),Be(Ki,"type","number"),Ki.disabled=Ji=!_[0],Be(Yi,"class","flex flex-col gap-2"),Be(qi,"type","number"),qi.disabled=Dt=!_[0]||!!_[1].fixedDegrees,Be(Ii,"class","flex flex-col gap-2"),Be(xn,"type","number"),xn.disabled=ai=!_[0]||!!_[1].fixedDegrees,Be(gi,"class","flex flex-col gap-2"),Be(ii,"type","number"),ii.disabled=cn=!_[0]||!!_[1].fixedDegrees,Be(kn,"class","flex flex-col gap-2"),Be(jt,"type","number"),jt.disabled=Qi=!_[0]||!!_[1].fixedDegrees,Be(De,"class","flex flex-col gap-2"),Be(Wi,"type","checkbox"),Wi.disabled=tr=!_[0],Be(Zi,"class","flex items-center gap-3"),Be(Y,"type","number"),Y.disabled=Q=!_[0],Be(k,"class","flex flex-col gap-2")},m(V,J){fe(V,f,J),fe(V,x,J),fe(V,E,J),fe(V,D,J),fe(V,S,J),fe(V,C,J),fe(V,o,J),Ae(o,U),U.checked=_[1].defaultEnabled,Ae(o,ie),Ae(o,W),fe(V,ae,J),fe(V,he,J),Ae(he,_e),Ae(he,Pe),Ae(he,je),hi(je,_[1].debounceTimeout),fe(V,Xe,J),fe(V,ze,J),Ae(ze,qe),Ae(ze,nt),Ae(ze,Ee),hi(Ee,_[1].angleDefault),fe(V,ht,J),fe(V,At,J),Ae(At,Wt),Ae(At,yt),Ae(At,fi),hi(fi,_[1].angleMin),fe(V,Si,J),fe(V,mi,J),Ae(mi,Tt),Ae(mi,Vt),Ae(mi,Ri),hi(Ri,_[1].angleMax),fe(V,Pn,J),fe(V,Ei,J),Ae(Ei,oi),Ae(Ei,Bi),Ae(Ei,Mt),hi(Mt,_[1].angleStep),fe(V,ti,J),fe(V,Yi,J),Ae(Yi,Sr),Ae(Yi,Qn),Ae(Yi,Ki),hi(Ki,_[1].fixedDegrees),fe(V,yn,J),fe(V,Ii,J),Ae(Ii,ye),Ae(Ii,dr),Ae(Ii,qi),hi(qi,_[1].degreesDefault),fe(V,It,J),fe(V,gi,J),Ae(gi,Er),Ae(gi,Ur),Ae(gi,xn),hi(xn,_[1].degreesMin),fe(V,er,J),fe(V,kn,J),Ae(kn,Re),Ae(kn,Gi),Ae(kn,ii),hi(ii,_[1].degreesMax),fe(V,zn,J),fe(V,De,J),Ae(De,dt),Ae(De,pt),Ae(De,jt),hi(jt,_[1].degreesStep),fe(V,rt,J),fe(V,Zi,J),Ae(Zi,Wi),Wi.checked=_[1].respectMapBearing,Ae(Zi,ir),Ae(Zi,_i),fe(V,j,J),fe(V,k,J),Ae(k,R),Ae(k,N),Ae(k,Y),hi(Y,_[1].imageSize),se||(re=[Zt(U,"change",_[6]),Zt(je,"input",_[7]),Zt(Ee,"input",_[8]),Zt(fi,"input",_[9]),Zt(Ri,"input",_[10]),Zt(Mt,"input",_[11]),Zt(Ki,"input",_[12]),Zt(qi,"input",_[13]),Zt(xn,"input",_[14]),Zt(ii,"input",_[15]),Zt(jt,"input",_[16]),Zt(Wi,"change",_[17]),Zt(Y,"input",_[18])],se=!0)},p(V,J){J&1&&z!==(z=!V[0])&&(U.disabled=z),J&2&&(U.checked=V[1].defaultEnabled),J&1&&Se!==(Se=!V[0])&&(je.disabled=Se),J&2&&pi(je.value)!==V[1].debounceTimeout&&hi(je,V[1].debounceTimeout),J&1&&Qe!==(Qe=!V[0])&&(Ee.disabled=Qe),J&2&&pi(Ee.value)!==V[1].angleDefault&&hi(Ee,V[1].angleDefault),J&1&&Ht!==(Ht=!V[0])&&(fi.disabled=Ht),J&2&&pi(fi.value)!==V[1].angleMin&&hi(fi,V[1].angleMin),J&1&&Cn!==(Cn=!V[0])&&(Ri.disabled=Cn),J&2&&pi(Ri.value)!==V[1].angleMax&&hi(Ri,V[1].angleMax),J&1&&Jn!==(Jn=!V[0])&&(Mt.disabled=Jn),J&2&&pi(Mt.value)!==V[1].angleStep&&hi(Mt,V[1].angleStep),J&1&&Ji!==(Ji=!V[0])&&(Ki.disabled=Ji),J&2&&pi(Ki.value)!==V[1].fixedDegrees&&hi(Ki,V[1].fixedDegrees),J&3&&Dt!==(Dt=!V[0]||!!V[1].fixedDegrees)&&(qi.disabled=Dt),J&2&&pi(qi.value)!==V[1].degreesDefault&&hi(qi,V[1].degreesDefault),J&3&&ai!==(ai=!V[0]||!!V[1].fixedDegrees)&&(xn.disabled=ai),J&2&&pi(xn.value)!==V[1].degreesMin&&hi(xn,V[1].degreesMin),J&3&&cn!==(cn=!V[0]||!!V[1].fixedDegrees)&&(ii.disabled=cn),J&2&&pi(ii.value)!==V[1].degreesMax&&hi(ii,V[1].degreesMax),J&3&&Qi!==(Qi=!V[0]||!!V[1].fixedDegrees)&&(jt.disabled=Qi),J&2&&pi(jt.value)!==V[1].degreesStep&&hi(jt,V[1].degreesStep),J&1&&tr!==(tr=!V[0])&&(Wi.disabled=tr),J&2&&(Wi.checked=V[1].respectMapBearing),J&1&&Q!==(Q=!V[0])&&(Y.disabled=Q),J&2&&pi(Y.value)!==V[1].imageSize&&hi(Y,V[1].imageSize)},d(V){V&&de(f),V&&de(x),V&&de(E),V&&de(D),V&&de(S),V&&de(C),V&&de(o),V&&de(ae),V&&de(he),V&&de(Xe),V&&de(ze),V&&de(ht),V&&de(At),V&&de(Si),V&&de(mi),V&&de(Pn),V&&de(Ei),V&&de(ti),V&&de(Yi),V&&de(yn),V&&de(Ii),V&&de(It),V&&de(gi),V&&de(er),V&&de(kn),V&&de(zn),V&&de(De),V&&de(rt),V&&de(Zi),V&&de(j),V&&de(k),se=!1,Lr(re)}}}function bg(_){let f;return{c(){f=me("span"),f.textContent=`${_[3].name}`,Be(f,"slot","title")},m(x,E){fe(x,f,E)},p:Nt,d(x){x&&de(f)}}}function wg(_){let f,x,E,D;return f=new Kn({props:{$$slots:{title:[bg],default:[vg]},$$scope:{ctx:_}}}),{c(){Xi(f.$$.fragment),x=Oe(),E=me("div"),Be(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,C){$i(f,S,C),fe(S,x,C),fe(S,E,C),_[19](E),D=!0},p(S,[C]){const o={};C&2097155&&(o.$$scope={dirty:C,ctx:S}),f.$set(o)},i(S){D||(di(f.$$.fragment,S),D=!0)},o(S){Ti(f.$$.fragment,S),D=!1},d(S){ji(f,S),S&&de(x),S&&de(E),_[19](null)}}}function Tg(_,f,x){let E;Xn(_,Yn,ht=>x(20,E=ht));const D=mn.find(ht=>ht.path===E);let S,C,o;ur(()=>{x(4,C=new hr.Map({container:S,style:pr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"})),C.on("load",()=>{x(0,o=new Hn(C,{bearings:!0})),x(0,o.interactive=!0,o),C.addControl(new ad.NavigationControl({}))})});let U,z={defaultEnabled:!1,debounceTimeout:150,angleDefault:0,angleMin:0,angleMax:359,angleStep:1,fixedDegrees:0,degreesDefault:45,degreesMin:15,degreesMax:360,degreesStep:15,respectMapBearing:!1,imageSize:50};function ie(){z.defaultEnabled=this.checked,x(1,z)}function W(){z.debounceTimeout=pi(this.value),x(1,z)}function ae(){z.angleDefault=pi(this.value),x(1,z)}function he(){z.angleMin=pi(this.value),x(1,z)}function _e(){z.angleMax=pi(this.value),x(1,z)}function Pe(){z.angleStep=pi(this.value),x(1,z)}function je(){z.fixedDegrees=pi(this.value),x(1,z)}function Se(){z.degreesDefault=pi(this.value),x(1,z)}function Xe(){z.degreesMin=pi(this.value),x(1,z)}function ze(){z.degreesMax=pi(this.value),x(1,z)}function qe(){z.degreesStep=pi(this.value),x(1,z)}function nt(){z.respectMapBearing=this.checked,x(1,z)}function Ee(){z.imageSize=pi(this.value),x(1,z)}function Qe(ht){$n[ht?"unshift":"push"](()=>{S=ht,x(2,S)})}return _.$$.update=()=>{_.$$.dirty&51&&C&&o&&(U&&C.hasControl(U)&&C.removeControl(U),C.addControl(x(5,U=new dg(o,z)),"top-left"))},[o,z,S,D,C,U,ie,W,ae,he,_e,Pe,je,Se,Xe,ze,qe,nt,Ee,Qe]}class Sg extends _n{constructor(f){super(),gn(this,f,Tg,wg,ln,{})}}const Eg=Object.freeze(Object.defineProperty({__proto__:null,default:Sg},Symbol.toStringTag,{value:"Module"})),Ig=[{id:"maplibre-gl-directions-snapline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[2,2],"line-color":"#ffffff","line-opacity":.65,"line-width":2},filter:["==",["get","type"],"SNAPLINE"]},{id:"maplibre-gl-directions-alt-routeline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-pattern":"routeline","line-width":12,"line-opacity":.5},filter:["==",["get","route"],"ALT"]},{id:"maplibre-gl-directions-routeline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-pattern":"routeline","line-width":12},filter:["==",["get","route"],"SELECTED"]},{id:"maplibre-gl-directions-hoverpoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-hoverpoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"HOVERPOINT"]},{id:"maplibre-gl-directions-snappoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-snappoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"SNAPPOINT"]},{id:"maplibre-gl-directions-waypoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-waypoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"WAYPOINT"]}],Ag="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJpSURBVEiJlZRLSFQBFIa/c2dyGMXHNKUrq0WLgsxt214L20gG0gxGhIIktIk2IS3bRFG4ahFBYQPlY8pQNxkFUbSQigyEiBKLIk3vOODUPO5pMV4fM/fOnTmbuffc8//ff+5jBI8abF9qEb/0iHIU2LPW/obyzEDvnI5vnymlF7cLE20aSAQTNxXtBQyXsZwKt7cZDRc7hyRdNmCiTQNm0JwEDtu92maoa84fr8xDcn6L5Lnf19DmBPE7AZarE7dE8+Y1jXCgWwntLZj5DB/vCqu/ATiSy5k3gAueGwy2L7UYPnkPGMEdcKhfCdQ5xYB0QnhzFVJ/AMghVmt0JPxp80zRvRW/9Nj9/VF3c4CqemVfRO1Tn2J0F84UAyyOAQTqYOdBd3O7GluhqnZNqxz3BCDsAqhuAnF9xzaNG1DTtH662xuA+gGsjLe5XVZ2TQk+T4AgPwGS35XsX2/zbAqSP2wtvzwBCh/yqYS5KW/A3NSWbd95AkDG7aMvY8LijPuDWJzJz6yHU8Y8ARk14kAW8vd2egBmh2B1YWNmdQFmH8L0gGDlNqSk5WlRXKdksQ5zHPREYd8fzP9mU44LxaOjoQ7PDQBQvebUzqZczRHDuu7UdwRE46GXwCtnK6c8TEWGw6/LBuQTcaVcf8Mw+t0uugIiw6EXqD7yche4Fxmpf1sxAEAsvQQkS7gv+3yZy6U8SgIiT8LzSPF/vF1qaV/nUGPR17s1QxkVO2nGEI0UtO9HR0NnvbQlN7Drn2ofMLcp1VcrZbluVjHg3OOQKYaeATJAGsPq6poMr5SjragenFo6H+sweyvR/Ac3+sqU/+vBXgAAAABJRU5ErkJggg==",Mg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJwSURBVEiJlZTNSxRxGMc/v98KZmm67qJQ2At0Ksy/obeDXSy7ZBS5KEiCHaJLSMcuUSSeOmi7BkW16taKeDCjMIJOFRgUHSzMjExdc2O3fZmnwzrr6s7s7D6Xmeft+3me+c2MwsGWW9obVZnqRDgG7FsPf0V4LuiB2tDgTKF+ZZeQ5p7y1YroHYEuQNuUpVFyt0b/vaKCwUTRAGnuKY9URCeAI9lgwy5o2J25n5uHuR+5LS9qXNFmK0iZFWB1+1ofojLidV6k4ywc2L+56Mss6t4j+PUb4GgkXXkb6HHcYLmlvVG51HtA461Fei/DziqrOVCrUbjRB0srAGlDGU2ekaGPuTV5z1aVqU4zLudO2YoDSHUl0tZiui6N7thak394BseBjPDhg7biWWs6BFU71omccAYo9gBQ7wVl+5LlKGiorzO9vY4AMQ8+mXIWNy2VrXU5AhSyACDfFyD+z1k8Fof5BdP76QgA/QFApVIwNe0MmJrO2VbeOQIUMp69D0+iZj7bi898QoUnN3zRYUeAlnQIyIyUSkH/AATHYHFpo2hxCR6HUf2DkE6b0aRKxMfyB7awSKtvXOBkXqJiW+Yai1u1hdyj/lbHDQBEuGkVJxa3E8fQ3LKKWwLcIf8r4LWlkuVEasoz7H9TNCCTkevFymstvbYydgn3cOClCE+K0B+qHvG/LRkAIAZXgTXbAqVWki6uFdIoCPA888+h8v/xGwMY3XXBQN7Xu2mGQknTIqd9D0XRtiV83z3qv+jUW3AD00SkG/iWE5k1YgnbzUoGuJ8GIqLlApAEEoZW5z0TD/4U01uSLZ/xXYq0+rpK6fkPouPQTszwGH0AAAAASUVORK5CYII=",Cg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAKQSURBVEiJlZRLSFRRGMd/586rVHQySDMqXRRESJuQ1BTsiS1atK5NGpIgodQiIghqleWYbVr0wDZpG6nUICym0UZ0kQXZTlSMHDUczee87mkxXlPn3rl3vtU5//N9/9/5zj3nCkyi3F9fiKBaSk4C+WvymIQeu4w99Za2/EhWL4wWKrvrXItZNg9C1ACKQVpMIp4EszIbhg/fCVsGVHbXuRZ22N8LSYWmFWzLocCVC8BoKMDo6tTGkk+zWVmVehC7HmDRbW/WzHc7s7mWd55D2/duyvm5MkHL7zdMhoMAJ7Ln5x8CdaYdlPvrCyV8A5RdDjeN+Zdx29P19sFcdIkbY8+YjswDxFSVI1+Oe4Y35iSeraBa06/knjU0B3Db06nKOaNNbYpC1dacBICUnNKKj2YcMDTXoijjIJm2tHgt8rQpANgHkOfIRjG+ZP8NhMIe504ABGK/FYAdIELM1FyLiIxqQ5sVwCTA2OoUK6ru1d4Uy2qI8fCMNg1YAIjv8V3F6AwOmgI6ZweJqGsdCIbMAULt0obtMz6GFkcMzb8ujdD+p3d9LqV4awpwKpEOIArxLu7+auPFdA+B+IMCIBAO8nzqA/cm2ojK9W8VIeZ8l7BfvZ2V9dd3ITm3VU9TXED83HWMOnwlngumHQAgua8nL6shXfM1xAM9VRfQW+L5jJR9Bk568dFX0uS3DACQCrctmksp1FtGi4aAvuJmr4TXFuxb+4ofDaQMAFDs4jqwkCQlaHM4bib1SLboK2qaECLxH78eklpvUWPC67UMAPAVe1pBvNqqC+TL3lJPm1m9KQDAFlJrgfEN0mhIiRl3lirAW9E8p6hcAiJAWCAuDhx7/NdKbUpR1t9wtdzfUJNKzT8AkN+WDptOYQAAAABJRU5ErkJggg==",Pg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAACmAAAApgHdff84AAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAN9JREFUSIlj/P//PwMtARNNTWdgYGB0ic61oKUFLP8Z/h+nqQURFj9paT4Di4HsH9paULGam6YW0DwVjVpAELAwMDAwaKsqMthbGMEFn714zbBh9yGGSD83BkF+Xrj49gOQLOPpYAkXe//xM8PyTbsYAlztGKQkROHiB0+cY7h6+z7EAlZWFgYeLk64JAcHOwMDAwMDNycHijgLMzMDAwMDitivX7/hepDFWVlZGBgYGBgYnaNzaFraDf1IHvoWsDQFfqOtBY/e0dYTLHMOctDWAkYGRkvCysgHjEO+VQEA4IsuY5Zs3DIAAAAASUVORK5CYII=";function kg(_){let f,x,E,D,S,C,o,U,z,ie;return{c(){f=me("p"),x=Li(`It's completely up to you how to style the Directions' features shown on the map. You can either use the default
    styles provided by the plugin (see other examples), easily modify the default features' dimensions (see the
    `),E=me("a"),E.textContent="Touch-Friendly Features example",D=Li(`) or
    `),S=me("strong"),S.textContent="define your custom features' styles from scratch",C=Li("."),o=Oe(),U=me("p"),U.textContent="This example demonstrates the last option.",Be(E,"href","/examples/touch-friendly-features")},m(W,ae){fe(W,f,ae),Ae(f,x),Ae(f,E),Ae(f,D),Ae(f,S),Ae(f,C),fe(W,o,ae),fe(W,U,ae),z||(ie=Lu(Uu.call(null,E)),z=!0)},p:Nt,d(W){W&&de(f),W&&de(o),W&&de(U),z=!1,ie()}}}function zg(_){let f;return{c(){f=me("span"),f.textContent=`${_[1].name}`,Be(f,"slot","title")},m(x,E){fe(x,f,E)},p:Nt,d(x){x&&de(f)}}}function Dg(_){let f,x,E,D;return f=new Kn({props:{$$slots:{title:[zg],default:[kg]},$$scope:{ctx:_}}}),{c(){Xi(f.$$.fragment),x=Oe(),E=me("div"),Be(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,C){$i(f,S,C),fe(S,x,C),fe(S,E,C),_[2](E),D=!0},p(S,[C]){const o={};C&32&&(o.$$scope={dirty:C,ctx:S}),f.$set(o)},i(S){D||(di(f.$$.fragment,S),D=!0)},o(S){Ti(f.$$.fragment,S),D=!1},d(S){ji(f,S),S&&de(x),S&&de(E),_[2](null)}}}function Lg(_,f,x){let E;Xn(_,Yn,U=>x(4,E=U));const D=mn.find(U=>U.path===E);let S,C;ur(()=>{const U=new hr.Map({container:S,style:pr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:`<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a> | Icons made by <a href="https://www.flaticon.com/authors/vectors-market" title="Vectors Market">Vectors Market</a> and by <a href="https://www.flaticon.com/authors/dinosoftlabs" title="DinosoftLabs">DinosoftLabs</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>`,fadeDuration:0});U.on("load",()=>{U.loadImage(Ag,(z,ie)=>{z||U.addImage("balloon-waypoint",ie)}),U.loadImage(Mg,(z,ie)=>{z||U.addImage("balloon-snappoint",ie)}),U.loadImage(Cg,(z,ie)=>{z||U.addImage("balloon-hoverpoint",ie)}),U.loadImage(Pg,(z,ie)=>{z||U.addImage("routeline",ie)}),C=new Hn(U,{requestOptions:{alternatives:"true"},layers:Ig,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline"]}),C.interactive=!0})});function o(U){$n[U?"unshift":"push"](()=>{S=U,x(0,S)})}return[S,D,o]}class Rg extends _n{constructor(f){super(),gn(this,f,Lg,Dg,ln,{})}}const Bg=Object.freeze(Object.defineProperty({__proto__:null,default:Rg},Symbol.toStringTag,{value:"Module"}));class Fg extends Hn{constructor(x,E){super(x,E);Iu(this,"originalBuildRoutelines",Um.buildRoutelines);Iu(this,"buildRoutelines",(x,E,D,S)=>{const C=this.originalBuildRoutelines(x,E,D,S);return C[0].forEach((o,U)=>{o.properties&&(o.properties.distance=E[0].legs[U].distance)}),C})}}const Mn="distance-measurement-maplibre-gl-directions",Og={sourceName:Mn,layers:[{id:`${Mn}-snapline`,type:"line",source:Mn,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":"#34343f","line-width":2},filter:["==",["get","type"],"SNAPLINE"]},{id:`${Mn}-routeline`,type:"line",source:Mn,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#212121","line-opacity":.85,"line-width":3},filter:["==",["get","route"],"SELECTED"]},{id:`${Mn}-routeline-distance`,type:"symbol",source:Mn,layout:{"symbol-placement":"line-center","text-field":"{distance}m","text-size":16,"text-ignore-placement":!0,"text-allow-overlap":!0,"text-overlap":"always"},paint:{"text-color":"#212121","text-halo-color":"#ffffff","text-halo-width":1},filter:["==",["get","route"],"SELECTED"]},{id:`${Mn}-hoverpoint`,type:"circle",source:Mn,paint:{"circle-radius":9,"circle-color":"#212121"},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${Mn}-snappoint`,type:"circle",source:Mn,paint:{"circle-radius":["case",["boolean",["get","highlight"],!1],9,7],"circle-color":["case",["boolean",["get","highlight"],!1],"#313131","#494949"]},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${Mn}-waypoint`,type:"circle",source:Mn,paint:{"circle-radius":["case",["boolean",["get","highlight"],!1],9,7],"circle-color":["case",["boolean",["get","highlight"],!1],"#212121","#2c2c2c"]},filter:["==",["get","type"],"WAYPOINT"]}],sensitiveSnappointLayers:[`${Mn}-snappoint`],sensitiveWaypointLayers:[`${Mn}-waypoint`],sensitiveRoutelineLayers:[`${Mn}-routeline`],sensitiveAltRoutelineLayers:[]};function Ug(_){let f;return{c(){f=me("em"),f.textContent="unknown"},m(x,E){fe(x,f,E)},p:Nt,d(x){x&&de(f)}}}function Vg(_){let f,x,E;return{c(){f=me("strong"),x=Li(_[1]),E=Li("m")},m(D,S){fe(D,f,S),Ae(f,x),Ae(f,E)},p(D,S){S&2&&Ru(x,D[1])},d(D){D&&de(f)}}}function Ng(_){let f,x,E,D,S,C,o,U,z,ie;function W(_e,Pe){return _e[1]?Vg:Ug}let ae=W(_),he=ae(_);return{c(){f=me("p"),x=Li(`Total Route Distance:
    `),he.c(),E=Oe(),D=me("small"),D.innerHTML="<strong>Note</strong> that you might want to zoom in and out the map to toggle the distance-annotations visibility",S=Oe(),C=me("p"),C.textContent=`This is an example of how one could use the plugin's extensibility interfaces to create a distance measurement tool
    out of it.`,o=Oe(),U=me("p"),U.innerHTML=`Here we create a subclass of the <code>MapLibreGlDirections</code> main super class and augment the original
    <code>buildRoutelines</code>
    method to write each route leg&#39;s distance into a respective feature&#39;s <code>properties</code> object. These saved distances
    are then used by an additional &quot;symbol&quot; layer that displays them along the respective route&#39;s lines on the map.`,z=Oe(),ie=me("p"),ie.textContent=`The total distance comes from the response's specific field and is updated each time there's the "fetchroutesend" or
    the "removewaypoint" event fired.`},m(_e,Pe){fe(_e,f,Pe),Ae(f,x),he.m(f,null),fe(_e,E,Pe),fe(_e,D,Pe),fe(_e,S,Pe),fe(_e,C,Pe),fe(_e,o,Pe),fe(_e,U,Pe),fe(_e,z,Pe),fe(_e,ie,Pe)},p(_e,Pe){ae===(ae=W(_e))&&he?he.p(_e,Pe):(he.d(1),he=ae(_e),he&&(he.c(),he.m(f,null)))},d(_e){_e&&de(f),he.d(),_e&&de(E),_e&&de(D),_e&&de(S),_e&&de(C),_e&&de(o),_e&&de(U),_e&&de(z),_e&&de(ie)}}}function $g(_){let f;return{c(){f=me("span"),f.textContent=`${_[2].name}`,Be(f,"slot","title")},m(x,E){fe(x,f,E)},p:Nt,d(x){x&&de(f)}}}function jg(_){let f,x,E,D;return f=new Kn({props:{$$slots:{title:[$g],default:[Ng]},$$scope:{ctx:_}}}),{c(){Xi(f.$$.fragment),x=Oe(),E=me("div"),Be(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,C){$i(f,S,C),fe(S,x,C),fe(S,E,C),_[3](E),D=!0},p(S,[C]){const o={};C&66&&(o.$$scope={dirty:C,ctx:S}),f.$set(o)},i(S){D||(di(f.$$.fragment,S),D=!0)},o(S){Ti(f.$$.fragment,S),D=!1},d(S){ji(f,S),S&&de(x),S&&de(E),_[3](null)}}}function qg(_,f,x){let E;Xn(_,Yn,z=>x(5,E=z));const D=mn.find(z=>z.path===E);let S,C,o=0;ur(()=>{const z=new hr.Map({container:S,style:pr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});z.on("load",()=>{C=new Fg(z,Og),C.on("fetchroutesend",ie=>{var W;x(1,o=(W=ie.data)==null?void 0:W.routes[0].distance)}),C.on("removewaypoint",()=>{C.waypoints.length<2&&x(1,o=0)}),C.interactive=!0})});function U(z){$n[z?"unshift":"push"](()=>{S=z,x(0,S)})}return[S,o,D,U]}class Gg extends _n{constructor(f){super(),gn(this,f,qg,jg,ln,{})}}const Zg=Object.freeze(Object.defineProperty({__proto__:null,default:Gg},Symbol.toStringTag,{value:"Module"}));class Wg extends Hn{constructor(f,x){super(f,x)}get waypointsFeatures(){return this._waypoints}setWaypointsFeatures(f){this._waypoints=f,this.assignWaypointsCategories();const x=new Gs("setwaypoints",void 0);this.fire(x),this.draw()}get snappointsFeatures(){return this.snappoints}setSnappointsFeatures(f){this.snappoints=f,this.draw()}get routelinesFeatures(){return this.routelines}setRoutelinesFeatures(f){this.routelines=f,this.draw()}}function Hg(_){let f,x,E,D,S,C,o,U,z,ie,W,ae,he,_e,Pe,je,Se,Xe,ze,qe,nt;return{c(){f=me("button"),x=Li("Load the saved Route"),D=Oe(),S=me("button"),C=Li("Save the Route"),U=Oe(),z=me("button"),ie=Li("Clear"),ae=Oe(),he=me("small"),he.innerHTML=`This example uses the <code>localStorage</code> to save routes, but you are obviously not restricted to it. There might
    instead be a file or a serverside-database or whatever else`,_e=Oe(),Pe=me("p"),Pe.textContent=`If you want to save/load the route, the obvious way to do so would be to save the list of waypoints whenever the
    route is updated and to make a new routing-request with the saved waypoints' coordinates whenever you need to load
    it.`,je=Oe(),Se=me("p"),Se.textContent=`But what if the underlying roads networks changes for some reason? You'll get a different route for the same set of
    waypoints. Moreover, if there are some severe construction works going on, you run into a risk of not getting any
    routes whatsoever.`,Xe=Oe(),ze=me("p"),ze.textContent=`Sometimes it's actually a good idea to save the route as a list of GeoJSON Features and be able to load these saved
    features whenever there's a need. This example shows how that could be done.`,f.disabled=E=!_[1]||_[2],S.disabled=o=!_[1],z.disabled=W=!_[1]},m(Ee,Qe){fe(Ee,f,Qe),Ae(f,x),fe(Ee,D,Qe),fe(Ee,S,Qe),Ae(S,C),fe(Ee,U,Qe),fe(Ee,z,Qe),Ae(z,ie),fe(Ee,ae,Qe),fe(Ee,he,Qe),fe(Ee,_e,Qe),fe(Ee,Pe,Qe),fe(Ee,je,Qe),fe(Ee,Se,Qe),fe(Ee,Xe,Qe),fe(Ee,ze,Qe),qe||(nt=[Zt(f,"click",_[4]),Zt(S,"click",_[5]),Zt(z,"click",_[6])],qe=!0)},p(Ee,Qe){Qe&6&&E!==(E=!Ee[1]||Ee[2])&&(f.disabled=E),Qe&2&&o!==(o=!Ee[1])&&(S.disabled=o),Qe&2&&W!==(W=!Ee[1])&&(z.disabled=W)},d(Ee){Ee&&de(f),Ee&&de(D),Ee&&de(S),Ee&&de(U),Ee&&de(z),Ee&&de(ae),Ee&&de(he),Ee&&de(_e),Ee&&de(Pe),Ee&&de(je),Ee&&de(Se),Ee&&de(Xe),Ee&&de(ze),qe=!1,Lr(nt)}}}function Xg(_){let f;return{c(){f=me("span"),f.textContent=`${_[3].name}`,Be(f,"slot","title")},m(x,E){fe(x,f,E)},p:Nt,d(x){x&&de(f)}}}function Yg(_){let f,x,E,D;return f=new Kn({props:{$$slots:{title:[Xg],default:[Hg]},$$scope:{ctx:_}}}),{c(){Xi(f.$$.fragment),x=Oe(),E=me("div"),Be(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,C){$i(f,S,C),fe(S,x,C),fe(S,E,C),_[7](E),D=!0},p(S,[C]){const o={};C&518&&(o.$$scope={dirty:C,ctx:S}),f.$set(o)},i(S){D||(di(f.$$.fragment,S),D=!0)},o(S){Ti(f.$$.fragment,S),D=!1},d(S){ji(f,S),S&&de(x),S&&de(E),_[7](null)}}}function Up(){return localStorage.getItem("saved-waypoints-features")&&localStorage.getItem("saved-snappoints-features")&&localStorage.getItem("saved-routelines-features")}function Kg(_,f,x){let E;Xn(_,Yn,ae=>x(8,E=ae));const D=mn.find(ae=>ae.path===E);let S,C;ur(()=>{const ae=new hr.Map({container:S,style:pr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});ae.on("load",()=>{x(1,C=new Wg(ae)),x(1,C.interactive=!0,C)})});let o=!Up();function U(){C.setWaypointsFeatures(JSON.parse(localStorage.getItem("saved-waypoints-features"))),C.setSnappointsFeatures(JSON.parse(localStorage.getItem("saved-snappoints-features"))),C.setRoutelinesFeatures(JSON.parse(localStorage.getItem("saved-routelines-features")))}function z(){localStorage.setItem("saved-waypoints-features",JSON.stringify(C.waypointsFeatures)),localStorage.setItem("saved-snappoints-features",JSON.stringify(C.snappointsFeatures)),localStorage.setItem("saved-routelines-features",JSON.stringify(C.routelinesFeatures)),x(2,o=!Up())}const ie=()=>C.clear();function W(ae){$n[ae?"unshift":"push"](()=>{S=ae,x(0,S)})}return[S,C,o,D,U,z,ie,W]}class Jg extends _n{constructor(f){super(),gn(this,f,Kg,Yg,ln,{})}}const Qg=Object.freeze(Object.defineProperty({__proto__:null,default:Jg},Symbol.toStringTag,{value:"Module"}));function e_(_){let f,x,E,D,S,C,o,U,z,ie,W,ae,he,_e,Pe,je,Se,Xe,ze,qe,nt,Ee,Qe,ht,At,Wt,yt,fi,Ht,Si,mi;return{c(){f=me("small"),f.innerHTML="<strong>Note</strong> that interactivity is disabled for this example",x=Oe(),E=me("div"),D=me("p"),D.textContent="Set waypoints to a predefined set",S=Oe(),C=me("button"),o=Li("Set Waypoints"),z=Oe(),ie=me("div"),W=me("p"),W.textContent="Add a random waypoint at some random index",ae=Oe(),he=me("button"),_e=Li("Add Waypoint"),je=Oe(),Se=me("div"),Xe=me("p"),Xe.textContent="Delete a random waypoint",ze=Oe(),qe=me("button"),nt=Li("Delete Waypoint"),Qe=Oe(),ht=me("div"),At=me("p"),At.textContent="Clear the map from all the stuff added by the plugin",Wt=Oe(),yt=me("button"),fi=Li("Clear"),C.disabled=U=!_[1],Be(C,"class","self-center"),Be(E,"class","flex flex-col gap-2"),he.disabled=Pe=!_[1],Be(he,"class","self-center"),Be(ie,"class","flex flex-col gap-2"),qe.disabled=Ee=!_[1],Be(qe,"class","self-center"),Be(Se,"class","flex flex-col gap-2"),yt.disabled=Ht=!_[1],Be(yt,"class","self-center"),Be(ht,"class","flex flex-col gap-2")},m(Tt,Vt){fe(Tt,f,Vt),fe(Tt,x,Vt),fe(Tt,E,Vt),Ae(E,D),Ae(E,S),Ae(E,C),Ae(C,o),fe(Tt,z,Vt),fe(Tt,ie,Vt),Ae(ie,W),Ae(ie,ae),Ae(ie,he),Ae(he,_e),fe(Tt,je,Vt),fe(Tt,Se,Vt),Ae(Se,Xe),Ae(Se,ze),Ae(Se,qe),Ae(qe,nt),fe(Tt,Qe,Vt),fe(Tt,ht,Vt),Ae(ht,At),Ae(ht,Wt),Ae(ht,yt),Ae(yt,fi),Si||(mi=[Zt(C,"click",_[3]),Zt(he,"click",_[4]),Zt(qe,"click",_[5]),Zt(yt,"click",_[6])],Si=!0)},p(Tt,Vt){Vt&2&&U!==(U=!Tt[1])&&(C.disabled=U),Vt&2&&Pe!==(Pe=!Tt[1])&&(he.disabled=Pe),Vt&2&&Ee!==(Ee=!Tt[1])&&(qe.disabled=Ee),Vt&2&&Ht!==(Ht=!Tt[1])&&(yt.disabled=Ht)},d(Tt){Tt&&de(f),Tt&&de(x),Tt&&de(E),Tt&&de(z),Tt&&de(ie),Tt&&de(je),Tt&&de(Se),Tt&&de(Qe),Tt&&de(ht),Si=!1,Lr(mi)}}}function t_(_){let f;return{c(){f=me("span"),f.textContent=`${_[2].name}`,Be(f,"slot","title")},m(x,E){fe(x,f,E)},p:Nt,d(x){x&&de(f)}}}function i_(_){let f,x,E,D;return f=new Kn({props:{$$slots:{title:[t_],default:[e_]},$$scope:{ctx:_}}}),{c(){Xi(f.$$.fragment),x=Oe(),E=me("div"),Be(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,C){$i(f,S,C),fe(S,x,C),fe(S,E,C),_[7](E),D=!0},p(S,[C]){const o={};C&1026&&(o.$$scope={dirty:C,ctx:S}),f.$set(o)},i(S){D||(di(f.$$.fragment,S),D=!0)},o(S){Ti(f.$$.fragment,S),D=!1},d(S){ji(f,S),S&&de(x),S&&de(E),_[7](null)}}}function n_(_,f,x){let E;Xn(_,Yn,he=>x(9,E=he));const D=mn.find(he=>he.path===E);let S,C,o;ur(()=>{const he=new hr.Map({container:S,style:pr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});he.on("load",()=>{C=he,x(1,o=new Hn(C,{requestOptions:{alternatives:"true"}}))})});function U(){o==null||o.setWaypoints([[-74.21349031181673,40.704951524836275],[-74.19666749687558,40.738517300855904],[-74.16611177177786,40.76634583723629],[-74.07169801445302,40.719004374548206],[-73.99170381279369,40.725509319065594],[-73.98071748466812,40.762445342516145]])}function z(){const he=C==null?void 0:C.getBounds(),_e=C==null?void 0:C.getCenter();if(he&&_e){const Pe=he.getEast()-he.getWest(),je=he.getSouth()-he.getNorth();o==null||o.addWaypoint([_e.lng-Pe/2+Pe*Math.random(),_e.lat-je/2+je*Math.random()],(o==null?void 0:o.waypoints.length)*Math.random()|0)}}function ie(){o==null||o.removeWaypoint((o==null?void 0:o.waypoints.length)*Math.random()|0)}function W(){o==null||o.clear()}function ae(he){$n[he?"unshift":"push"](()=>{S=he,x(0,S)})}return[S,o,D,U,z,ie,W,ae]}class r_ extends _n{constructor(f){super(),gn(this,f,n_,i_,ln,{})}}const s_=Object.freeze(Object.defineProperty({__proto__:null,default:r_},Symbol.toStringTag,{value:"Module"}));function o_(_){let f,x,E,D,S,C,o,U,z,ie,W,ae,he,_e,Pe,je,Se,Xe,ze,qe,nt;return{c(){f=me("label"),x=me("span"),x.innerHTML="<strong>Congestions</strong>",E=Oe(),D=me("select"),S=me("option"),S.textContent="Stringy",C=me("option"),C.textContent="Numeric",U=Oe(),z=me("p"),z.textContent="This example makes POST requests to the official Mapbox Directions API with the following options:",ie=Oe(),W=me("ul"),ae=me("li"),he=me("strong"),_e=Li("annotations="),Pe=Li(_[1]),je=Oe(),Se=me("li"),Se.textContent="overview=full",Xe=Oe(),ze=me("li"),ze.textContent="alternatives=true",S.__value="congestion",S.value=S.__value,C.__value="congestion_numeric",C.value=C.__value,D.disabled=o=!_[0],_[1]===void 0&&tl(()=>_[5].call(D)),Be(f,"class","flex flex-col gap-2")},m(Ee,Qe){fe(Ee,f,Qe),Ae(f,x),Ae(f,E),Ae(f,D),Ae(D,S),Ae(D,C),uc(D,_[1],!0),fe(Ee,U,Qe),fe(Ee,z,Qe),fe(Ee,ie,Qe),fe(Ee,W,Qe),Ae(W,ae),Ae(ae,he),Ae(he,_e),Ae(he,Pe),Ae(W,je),Ae(W,Se),Ae(W,Xe),Ae(W,ze),qe||(nt=Zt(D,"change",_[5]),qe=!0)},p(Ee,Qe){Qe&1&&o!==(o=!Ee[0])&&(D.disabled=o),Qe&2&&uc(D,Ee[1]),Qe&2&&Ru(Pe,Ee[1])},d(Ee){Ee&&de(f),Ee&&de(U),Ee&&de(z),Ee&&de(ie),Ee&&de(W),qe=!1,nt()}}}function a_(_){let f;return{c(){f=me("span"),f.textContent=`${_[3].name}`,Be(f,"slot","title")},m(x,E){fe(x,f,E)},p:Nt,d(x){x&&de(f)}}}function l_(_){let f,x,E,D;return f=new Kn({props:{$$slots:{title:[a_],default:[o_]},$$scope:{ctx:_}}}),{c(){Xi(f.$$.fragment),x=Oe(),E=me("div"),Be(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,C){$i(f,S,C),fe(S,x,C),fe(S,E,C),_[6](E),D=!0},p(S,[C]){const o={};C&259&&(o.$$scope={dirty:C,ctx:S}),f.$set(o)},i(S){D||(di(f.$$.fragment,S),D=!0)},o(S){Ti(f.$$.fragment,S),D=!1},d(S){ji(f,S),S&&de(x),S&&de(E),_[6](null)}}}function c_(_,f,x){let E;Xn(_,Yn,W=>x(7,E=W));const D=mn.find(W=>W.path===E);let S,C,o,U="congestion";ur(()=>{const W=new hr.Map({container:S,style:pr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='//docs.mapbox.com/help/getting-started/directions/' target='_blank'>&copy; Mapbox Directions</a>"});W.on("load",()=>{x(4,C=W)})});function z(){U=Yp(this),x(1,U)}function ie(W){$n[W?"unshift":"push"](()=>{S=W,x(2,S)})}return _.$$.update=()=>{_.$$.dirty&19&&C&&(o&&o.destroy(),x(0,o=new Hn(C,{api:"https://api.mapbox.com/directions/v5",profile:"mapbox/driving-traffic",makePostRequest:!0,requestOptions:{access_token:"pk.eyJ1Ijoic21lbGx5c2hvdmVsIiwiYSI6ImNsMW80eXQ4aTEwN3czcG8zMXM2NzJ2ODIifQ.oWHUIUiEj2SS4_hue3qv2g",alternatives:"true",annotations:U,overview:"full"}})),x(0,o.interactive=!0,o))},[o,U,S,D,C,z,ie]}class u_ extends _n{constructor(f){super(),gn(this,f,c_,l_,ln,{})}}const h_=Object.freeze(Object.defineProperty({__proto__:null,default:u_},Symbol.toStringTag,{value:"Module"}));function p_(_){let f,x,E;return{c(){f=me("p"),f.textContent=`In this example the default layers used by the plugin are augmented with an additional "symbol" layer which is only
    rendered for the ORIGIN and DESTINATION waypoints.`,x=Oe(),E=me("p"),E.innerHTML=`<strong>Note</strong> how you don&#39;t need to re-define all the layers from scratch thanks to the exported
    <code>layersFactory</code> function that returns all the default layers allowing for their augmentation and modification`},m(D,S){fe(D,f,S),fe(D,x,S),fe(D,E,S)},p:Nt,d(D){D&&de(f),D&&de(x),D&&de(E)}}}function d_(_){let f;return{c(){f=me("span"),f.textContent=`${_[1].name}`,Be(f,"slot","title")},m(x,E){fe(x,f,E)},p:Nt,d(x){x&&de(f)}}}function f_(_){let f,x,E,D;return f=new Kn({props:{$$slots:{title:[d_],default:[p_]},$$scope:{ctx:_}}}),{c(){Xi(f.$$.fragment),x=Oe(),E=me("div"),Be(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,C){$i(f,S,C),fe(S,x,C),fe(S,E,C),_[2](E),D=!0},p(S,[C]){const o={};C&32&&(o.$$scope={dirty:C,ctx:S}),f.$set(o)},i(S){D||(di(f.$$.fragment,S),D=!0)},o(S){Ti(f.$$.fragment,S),D=!1},d(S){ji(f,S),S&&de(x),S&&de(E),_[2](null)}}}function m_(_,f,x){let E;Xn(_,Yn,U=>x(4,E=U));const D=mn.find(U=>U.path===E);let S,C;ur(()=>{const U=new hr.Map({container:S,style:pr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>",fadeDuration:0}),z=_c();z.push({id:"maplibre-gl-directions-waypoint-label",type:"symbol",source:"maplibre-gl-directions",layout:{"text-field":["case",["==",["get","category"],"ORIGIN"],"A",["==",["get","category"],"DESTINATION"],"B",""]},paint:{"text-color":"#ffffff","text-opacity":.7},filter:["all",["==",["geometry-type"],"Point"],["==",["get","type"],"WAYPOINT"],["in",["get","category"],["literal",["ORIGIN","DESTINATION"]]]]}),U.on("load",()=>{C=new Hn(U,{requestOptions:{alternatives:"true"},layers:z}),C.interactive=!0})});function o(U){$n[U?"unshift":"push"](()=>{S=U,x(0,S)})}return[S,D,o]}class g_ extends _n{constructor(f){super(),gn(this,f,m_,f_,ln,{})}}const __=Object.freeze(Object.defineProperty({__proto__:null,default:g_},Symbol.toStringTag,{value:"Module"})),y_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAKRJREFUOE+lkkEOAVEQRF9tJBwCZxhHEFYOIXMWNuIynIOFI7B3hpKeDBFh0ub/ddfrX10lCp8K9aQAtsexSNLtc2EWsANqYC7p8g7JAobAEZgBS0mnJyQFiGHbXyFpwC+IbE+BDTBIJhI/WQH3sBSACbDtCahKLCwkndMA2yPg0CbRiJtuZHy34oixAl7ifwB7YF1SpDh0VPnaq8pdNlM36AI8AK1AOkjqIJazAAAAAElFTkSuQmCC";function x_(_){let f,x,E,D,S;return{c(){f=me("p"),f.textContent="Another example that demonstrates the ease of extending the original styles provided by the plugin.",x=Oe(),E=me("p"),E.textContent='This time a "symbol" layer is added that shows the direction the selected route goes in.',D=Oe(),S=me("small"),S.innerHTML=`<strong>Note</strong> that you have to manually load and add the images you intend to use for the custom layers you
    add`},m(C,o){fe(C,f,o),fe(C,x,o),fe(C,E,o),fe(C,D,o),fe(C,S,o)},p:Nt,d(C){C&&de(f),C&&de(x),C&&de(E),C&&de(D),C&&de(S)}}}function v_(_){let f;return{c(){f=me("span"),f.textContent=`${_[1].name}`,Be(f,"slot","title")},m(x,E){fe(x,f,E)},p:Nt,d(x){x&&de(f)}}}function b_(_){let f,x,E,D;return f=new Kn({props:{$$slots:{title:[v_],default:[x_]},$$scope:{ctx:_}}}),{c(){Xi(f.$$.fragment),x=Oe(),E=me("div"),Be(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,C){$i(f,S,C),fe(S,x,C),fe(S,E,C),_[2](E),D=!0},p(S,[C]){const o={};C&32&&(o.$$scope={dirty:C,ctx:S}),f.$set(o)},i(S){D||(di(f.$$.fragment,S),D=!0)},o(S){Ti(f.$$.fragment,S),D=!1},d(S){ji(f,S),S&&de(x),S&&de(E),_[2](null)}}}function w_(_,f,x){let E;Xn(_,Yn,U=>x(4,E=U));const D=mn.find(U=>U.path===E);let S,C;ur(()=>{const U=new hr.Map({container:S,style:pr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});U.loadImage(y_,(ie,W)=>{!ie&&W&&U.addImage("direction-arrow",W)});const z=_c();z.push({id:"maplibre-gl-directions-routeline-direction-arrow",type:"symbol",source:"maplibre-gl-directions",layout:{"symbol-placement":"line-center","icon-image":"direction-arrow","icon-size":["interpolate",["exponential",1.5],["zoom"],12,.85,18,1.4]},paint:{"icon-opacity":.5},filter:["==",["get","route"],"SELECTED"]}),U.on("load",()=>{C=new Hn(U,{requestOptions:{alternatives:"true"},layers:z}),C.interactive=!0})});function o(U){$n[U?"unshift":"push"](()=>{S=U,x(0,S)})}return[S,D,o]}class T_ extends _n{constructor(f){super(),gn(this,f,w_,b_,ln,{})}}const S_=Object.freeze(Object.defineProperty({__proto__:null,default:T_},Symbol.toStringTag,{value:"Module"}));function E_(_){let f,x,E,D,S,C,o,U,z,ie,W,ae,he;return{c(){f=me("label"),x=me("input"),D=Oe(),S=me("strong"),S.textContent="Simulate a Touch-Enabled Device",C=Oe(),o=me("p"),o.textContent=`Sometimes it's pretty hard to aim exactly at the selected route line to add a waypoint by dragging it when using the
    plugin on a touch device.`,U=Oe(),z=me("p"),z.innerHTML=`The example shows how one could use the <code>layersFactory</code>&#39;s input parameters to handle that case by
    increasing the points by 1.5 and the lines by 2 times when the map is used on a touch-enabled device.`,ie=Oe(),W=me("small"),W.innerHTML=`<strong>Note</strong> that you can either load the page on a touch-enabled device or toggle the checkbox above: both
    options apply the same effect`,Be(x,"type","checkbox"),x.disabled=E=!_[0],Be(f,"class","flex items-center gap-3")},m(_e,Pe){fe(_e,f,Pe),Ae(f,x),x.checked=_[1],Ae(f,D),Ae(f,S),fe(_e,C,Pe),fe(_e,o,Pe),fe(_e,U,Pe),fe(_e,z,Pe),fe(_e,ie,Pe),fe(_e,W,Pe),ae||(he=Zt(x,"change",_[5]),ae=!0)},p(_e,Pe){Pe&1&&E!==(E=!_e[0])&&(x.disabled=E),Pe&2&&(x.checked=_e[1])},d(_e){_e&&de(f),_e&&de(C),_e&&de(o),_e&&de(U),_e&&de(z),_e&&de(ie),_e&&de(W),ae=!1,he()}}}function I_(_){let f;return{c(){f=me("span"),f.textContent=`${_[3].name}`,Be(f,"slot","title")},m(x,E){fe(x,f,E)},p:Nt,d(x){x&&de(f)}}}function A_(_){let f,x,E,D;return f=new Kn({props:{$$slots:{title:[I_],default:[E_]},$$scope:{ctx:_}}}),{c(){Xi(f.$$.fragment),x=Oe(),E=me("div"),Be(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,C){$i(f,S,C),fe(S,x,C),fe(S,E,C),_[6](E),D=!0},p(S,[C]){const o={};C&259&&(o.$$scope={dirty:C,ctx:S}),f.$set(o)},i(S){D||(di(f.$$.fragment,S),D=!0)},o(S){Ti(f.$$.fragment,S),D=!1},d(S){ji(f,S),S&&de(x),S&&de(E),_[6](null)}}}function M_(_,f,x){let E;Xn(_,Yn,W=>x(7,E=W));const D=mn.find(W=>W.path===E);let S,C,o,U="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;ur(()=>{const W=new hr.Map({container:S,style:pr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});W.on("load",()=>{x(4,C=W)})});function z(){U=this.checked,x(1,U)}function ie(W){$n[W?"unshift":"push"](()=>{S=W,x(2,S)})}return _.$$.update=()=>{if(_.$$.dirty&19&&C){o&&o.destroy();const W=_c(U?1.5:1,U?2:1);x(0,o=new Hn(C,{requestOptions:{alternatives:"true"},layers:W})),x(0,o.interactive=!0,o)}},[o,U,S,D,C,z,ie]}class C_ extends _n{constructor(f){super(),gn(this,f,M_,A_,ln,{})}}const P_=Object.freeze(Object.defineProperty({__proto__:null,default:C_},Symbol.toStringTag,{value:"Module"}));function Vp(_,f,x){const E=_.slice();return E[7]=f[x],E}function Np(_){let f,x=_[7]+"";return{c(){f=me("li")},m(E,D){fe(E,f,D),f.innerHTML=x},p(E,D){D&2&&x!==(x=E[7]+"")&&(f.innerHTML=x)},d(E){E&&de(f)}}}function $p(_){let f,x,E;return{c(){f=me("button"),f.textContent="Clear"},m(D,S){fe(D,f,S),x||(E=Zt(f,"click",_[3]),x=!0)},p:Nt,d(D){D&&de(f),x=!1,E()}}}function k_(_){let f,x,E,D,S,C=_[1],o=[];for(let z=0;z<C.length;z+=1)o[z]=Np(Vp(_,C,z));let U=_[1].length&&$p(_);return{c(){f=me("p"),f.textContent=`This example listens for all the available events and logs them below. Interact with the map to see the emitted
    events.`,x=Oe(),E=me("ol");for(let z=0;z<o.length;z+=1)o[z].c();D=Oe(),U&&U.c(),S=mc()},m(z,ie){fe(z,f,ie),fe(z,x,ie),fe(z,E,ie);for(let W=0;W<o.length;W+=1)o[W]&&o[W].m(E,null);fe(z,D,ie),U&&U.m(z,ie),fe(z,S,ie)},p(z,ie){if(ie&2){C=z[1];let W;for(W=0;W<C.length;W+=1){const ae=Vp(z,C,W);o[W]?o[W].p(ae,ie):(o[W]=Np(ae),o[W].c(),o[W].m(E,null))}for(;W<o.length;W+=1)o[W].d(1);o.length=C.length}z[1].length?U?U.p(z,ie):(U=$p(z),U.c(),U.m(S.parentNode,S)):U&&(U.d(1),U=null)},d(z){z&&de(f),z&&de(x),z&&de(E),Xp(o,z),z&&de(D),U&&U.d(z),z&&de(S)}}}function z_(_){let f;return{c(){f=me("span"),f.textContent=`${_[2].name}`,Be(f,"slot","title")},m(x,E){fe(x,f,E)},p:Nt,d(x){x&&de(f)}}}function D_(_){let f,x,E,D;return f=new Kn({props:{$$slots:{title:[z_],default:[k_]},$$scope:{ctx:_}}}),{c(){Xi(f.$$.fragment),x=Oe(),E=me("div"),Be(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,C){$i(f,S,C),fe(S,x,C),fe(S,E,C),_[4](E),D=!0},p(S,[C]){const o={};C&1026&&(o.$$scope={dirty:C,ctx:S}),f.$set(o)},i(S){D||(di(f.$$.fragment,S),D=!0)},o(S){Ti(f.$$.fragment,S),D=!1},d(S){ji(f,S),S&&de(x),S&&de(E),_[4](null)}}}function L_(_,f,x){let E;Xn(_,Yn,ie=>x(6,E=ie));const D=mn.find(ie=>ie.path===E);let S,C,o=[];ur(()=>{const ie=new hr.Map({container:S,style:pr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"});ie.on("load",()=>{C=new Hn(ie,{requestOptions:{alternatives:"true"}}),C.interactive=!0,C.on("addwaypoint",W=>{var ae,he;o.push(`<strong>${W.type}</strong>: waypoint added at index <strong>${(ae=W.data)==null?void 0:ae.index}</strong>. Original event - <strong>${(he=W.originalEvent)==null?void 0:he.type}</strong>`),x(1,o)}),C.on("removewaypoint",W=>{var ae,he;o.push(`<strong>${W.type}</strong>: waypoint removed at index <strong>${(ae=W.data)==null?void 0:ae.index}</strong>. Original event - <strong>${(he=W.originalEvent)==null?void 0:he.type}</strong>`),x(1,o)}),C.on("movewaypoint",W=>{var ae,he,_e,Pe;o.push(`<strong>${W.type}</strong>: waypoint at index <strong>${(ae=W.data)==null?void 0:ae.index}</strong> moved from coordinates ${(_e=(he=W.data)==null?void 0:he.initialCoordinates)==null?void 0:_e.map(je=>je.toFixed(5)).join(", ")}. Original event - <strong>${(Pe=W.originalEvent)==null?void 0:Pe.type}</strong>`),x(1,o)}),C.on("fetchroutesstart",W=>{o.push(`<strong>${W.type}</strong>: routing request started. Original event - <strong>${W.originalEvent.type}</strong>`),x(1,o)}),C.on("fetchroutesend",W=>{var ae;o.push(`<strong>${W.type}</strong>: routing request finished with code <strong>${(ae=W.data)==null?void 0:ae.code}</strong>. Original event - <strong>${W.originalEvent.type}</strong>`),x(1,o)})})});const U=()=>x(1,o=[]);function z(ie){$n[ie?"unshift":"push"](()=>{S=ie,x(0,S)})}return[S,o,D,U,z]}class R_ extends _n{constructor(f){super(),gn(this,f,L_,D_,ln,{})}}const B_=Object.freeze(Object.defineProperty({__proto__:null,default:R_},Symbol.toStringTag,{value:"Module"}));function F_(_){let f,x,E,D,S,C,o,U,z,ie,W,ae,he,_e,Pe;return{c(){f=me("button"),x=Li("Abort Manually"),D=Oe(),S=me("p"),S.innerHTML=`Instead of aborting routing-requests manually, you can set the <code>requestTimeout</code> configuration option to a
    number of ms that a routing-request is allowed to take before getting automatically aborted.`,C=Oe(),o=me("label"),U=me("span"),U.innerHTML="<strong>Request Timeout</strong>",z=Oe(),ie=me("input"),ae=Oe(),he=me("small"),he.innerHTML=`<strong>Note</strong> that you may need to manually
    <a href="https://www.browserstack.com/guide/how-to-perform-network-throttling-in-chrome" target="_blank" rel="noreferrer">enable network throttling</a> for the setting above to take effect`,f.disabled=E=!_[0],Be(ie,"type","number"),ie.disabled=W=!_[0],Be(o,"class","flex flex-col gap-2")},m(je,Se){fe(je,f,Se),Ae(f,x),fe(je,D,Se),fe(je,S,Se),fe(je,C,Se),fe(je,o,Se),Ae(o,U),Ae(o,z),Ae(o,ie),hi(ie,_[1]),fe(je,ae,Se),fe(je,he,Se),_e||(Pe=[Zt(f,"click",_[4]),Zt(ie,"input",_[6])],_e=!0)},p(je,Se){Se&1&&E!==(E=!je[0])&&(f.disabled=E),Se&1&&W!==(W=!je[0])&&(ie.disabled=W),Se&2&&pi(ie.value)!==je[1]&&hi(ie,je[1])},d(je){je&&de(f),je&&de(D),je&&de(S),je&&de(C),je&&de(o),je&&de(ae),je&&de(he),_e=!1,Lr(Pe)}}}function O_(_){let f;return{c(){f=me("span"),f.textContent=`${_[3].name}`,Be(f,"slot","title")},m(x,E){fe(x,f,E)},p:Nt,d(x){x&&de(f)}}}function U_(_){let f,x,E,D;return f=new Kn({props:{$$slots:{title:[O_],default:[F_]},$$scope:{ctx:_}}}),{c(){Xi(f.$$.fragment),x=Oe(),E=me("div"),Be(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,C){$i(f,S,C),fe(S,x,C),fe(S,E,C),_[7](E),D=!0},p(S,[C]){const o={};C&515&&(o.$$scope={dirty:C,ctx:S}),f.$set(o)},i(S){D||(di(f.$$.fragment,S),D=!0)},o(S){Ti(f.$$.fragment,S),D=!1},d(S){ji(f,S),S&&de(x),S&&de(E),_[7](null)}}}function V_(_,f,x){let E;Xn(_,Yn,ae=>x(8,E=ae));const D=mn.find(ae=>ae.path===E);let S,C,o,U=1e3;ur(()=>{const ae=new hr.Map({container:S,style:pr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank' rel='noreferrer'>&copy; OSRM</a>"});ae.on("load",()=>{x(5,C=ae)})});function z(){var ae;(ae=o==null?void 0:o.abortController)==null||ae.abort()}function ie(){U=pi(this.value),x(1,U)}function W(ae){$n[ae?"unshift":"push"](()=>{S=ae,x(2,S)})}return _.$$.update=()=>{_.$$.dirty&35&&C&&(o&&o.destroy(),x(0,o=new Hn(C,{requestOptions:{alternatives:"true"},requestTimeout:U})),x(0,o.interactive=!0,o))},[o,U,S,D,z,C,ie,W]}class N_ extends _n{constructor(f){super(),gn(this,f,V_,U_,ln,{})}}const $_=Object.freeze(Object.defineProperty({__proto__:null,default:N_},Symbol.toStringTag,{value:"Module"}));function j_(_){let f,x,E,D,S,C,o,U,z,ie,W,ae,he;return{c(){f=me("label"),x=me("span"),x.innerHTML="<strong>Position</strong>",E=Oe(),D=me("select"),S=me("option"),S.textContent="Top-Left",C=me("option"),C.textContent="Top-Right",o=me("option"),o.textContent="Bottom-Left",U=me("option"),U.textContent="Bottom-Right",ie=Oe(),W=me("p"),W.innerHTML=`The <code>LoadingIndicatorControl</code> adds a simple spinning loader-icon which automatically appears whenever there&#39;s
    an ongoing routing-request.`,S.__value="top-left",S.value=S.__value,C.__value="top-right",C.value=C.__value,o.__value="bottom-left",o.value=o.__value,U.__value="bottom-right",U.value=U.__value,D.disabled=z=!_[0],_[1]===void 0&&tl(()=>_[6].call(D)),Be(f,"class","flex flex-col gap-2")},m(_e,Pe){fe(_e,f,Pe),Ae(f,x),Ae(f,E),Ae(f,D),Ae(D,S),Ae(D,C),Ae(D,o),Ae(D,U),uc(D,_[1],!0),fe(_e,ie,Pe),fe(_e,W,Pe),ae||(he=Zt(D,"change",_[6]),ae=!0)},p(_e,Pe){Pe&1&&z!==(z=!_e[0])&&(D.disabled=z),Pe&2&&uc(D,_e[1])},d(_e){_e&&de(f),_e&&de(ie),_e&&de(W),ae=!1,he()}}}function q_(_){let f;return{c(){f=me("span"),f.textContent=`${_[3].name}`,Be(f,"slot","title")},m(x,E){fe(x,f,E)},p:Nt,d(x){x&&de(f)}}}function G_(_){let f,x,E,D;return f=new Kn({props:{$$slots:{title:[q_],default:[j_]},$$scope:{ctx:_}}}),{c(){Xi(f.$$.fragment),x=Oe(),E=me("div"),Be(E,"class","basis-full lg:basis-2/3 shadow-xl")},m(S,C){$i(f,S,C),fe(S,x,C),fe(S,E,C),_[7](E),D=!0},p(S,[C]){const o={};C&515&&(o.$$scope={dirty:C,ctx:S}),f.$set(o)},i(S){D||(di(f.$$.fragment,S),D=!0)},o(S){Ti(f.$$.fragment,S),D=!1},d(S){ji(f,S),S&&de(x),S&&de(E),_[7](null)}}}function Z_(_,f,x){let E;Xn(_,Yn,ae=>x(8,E=ae));const D=mn.find(ae=>ae.path===E);let S,C,o;ur(()=>{x(4,C=new hr.Map({container:S,style:pr,center:[-74.1197632,40.6974034],zoom:11,customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"})),C.on("load",()=>{x(0,o=new Hn(C,{requestOptions:{alternatives:"true"}})),x(0,o.interactive=!0,o)})});let U,z="top-right";function ie(){z=Yp(this),x(1,z)}function W(ae){$n[ae?"unshift":"push"](()=>{S=ae,x(2,S)})}return _.$$.update=()=>{_.$$.dirty&51&&C&&o&&(U&&C.hasControl(U)&&C.removeControl(U),C.addControl(x(5,U=new og(o,{class:"m-2"})),z))},[o,z,S,D,C,U,ie,W]}class W_ extends _n{constructor(f){super(),gn(this,f,Z_,G_,ln,{})}}const H_=Object.freeze(Object.defineProperty({__proto__:null,default:W_},Symbol.toStringTag,{value:"Module"}));function jp(_,f,x){const E=_.slice();return E[0]=f[x],E}function qp(_){let f,x,E=_[0].name+"",D,S,C,o;return{c(){f=me("li"),x=me("a"),D=Li(E),S=Oe(),Be(x,"href",_[0].path),Be(x,"class","svelte-1jo4v3w"),Be(f,"class","svelte-1jo4v3w")},m(U,z){fe(U,f,z),Ae(f,x),Ae(x,D),Ae(f,S),C||(o=Lu(Uu.call(null,x)),C=!0)},p:Nt,d(U){U&&de(f),C=!1,o()}}}function X_(_){let f,x=mn.sort(Gp),E=[];for(let D=0;D<x.length;D+=1)E[D]=qp(jp(_,x,D));return{c(){f=me("ul");for(let D=0;D<E.length;D+=1)E[D].c();Be(f,"class","svelte-1jo4v3w")},m(D,S){fe(D,f,S);for(let C=0;C<E.length;C+=1)E[C]&&E[C].m(f,null)},p(D,S){if(S&0){x=mn.sort(Gp);let C;for(C=0;C<x.length;C+=1){const o=jp(D,x,C);E[C]?E[C].p(o,S):(E[C]=qp(o),E[C].c(),E[C].m(f,null))}for(;C<E.length;C+=1)E[C].d(1);E.length=x.length}},d(D){D&&de(f),Xp(E,D)}}}function Y_(_){let f;return{c(){f=me("span"),f.textContent="Examples",Be(f,"slot","title"),Be(f,"class","svelte-1jo4v3w")},m(x,E){fe(x,f,E)},p:Nt,d(x){x&&de(f)}}}function K_(_){let f,x,E,D;return f=new Kn({props:{noHeader:!0,$$slots:{title:[Y_],default:[X_]},$$scope:{ctx:_}}}),{c(){Xi(f.$$.fragment),x=Oe(),E=me("div"),E.innerHTML=`<div class="p-5 lg:p-10 h-full flex flex-col gap-5 lg:gap-10 justify-start lg:justify-center items-center flex-col bg-inherit overflow-x-hidden overflow-y-auto svelte-1jo4v3w"><h1 class="text-center max-w-3xl svelte-1jo4v3w">Please, choose an example at the sidebar on the left</h1> 

    <span class="text-slate-500 svelte-1jo4v3w">or navigate to</span> 

    <div class="flex flex-col gap-2.5 lg:gap-5 justify-center items-center svelte-1jo4v3w"><a href="https://github.com/maplibre/maplibre-gl-directions" target="_blank" rel="noreferrer" class="svelte-1jo4v3w">GitHub</a> 
      <a href="/maplibre-gl-directions//api" target="_blank" rel="noreferrer" class="svelte-1jo4v3w">API</a></div></div>`,Be(E,"class","basis-full lg:basis-2/3 overflow-hidden rounded-3xl shadow-xl svelte-1jo4v3w")},m(S,C){$i(f,S,C),fe(S,x,C),fe(S,E,C),D=!0},p(S,[C]){const o={};C&8&&(o.$$scope={dirty:C,ctx:S}),f.$set(o)},i(S){D||(di(f.$$.fragment,S),D=!0)},o(S){Ti(f.$$.fragment,S),D=!1},d(S){ji(f,S),S&&de(x),S&&de(E)}}}const Gp=(_,f)=>_.index-f.index;class J_ extends _n{constructor(f){super(),gn(this,f,null,K_,ln,{})}}const mn=Object.entries(Object.assign({"./examples/1 User Interaction.svelte":xg,"./examples/10 Bearings Support and Control.svelte":Eg,"./examples/11 Restyling.svelte":Bg,"./examples/12 Distance Measurement.svelte":Zg,"./examples/13 Load and Save.svelte":Qg,"./examples/2 Programmatical Control.svelte":s_,"./examples/3 Mapbox Directions API and Congestions.svelte":h_,"./examples/4 Origin and Destination.svelte":__,"./examples/5 Show Routes' Directions.svelte":S_,"./examples/6 Touch-Friendly Features.svelte":P_,"./examples/7 Events.svelte":B_,"./examples/8 Aborting Requests.svelte":$_,"./examples/9 Loading Indicator Control.svelte":H_})).map(([_,f])=>{const x=_.match(/\/(\d+)\s([^/]+)\./),E=parseInt(x[1]),D=x[2];return{path:"/examples/"+D.toLowerCase().replaceAll(/\s/g,"-"),index:E,name:D,component:f,sourceUrl:`https://github.com/maplibre/maplibre-gl-directions/tree/main/demo/src/${_}`}}),Vu={};mn.forEach(_=>{Vu[_.path]=_.component.default});Vu["*"]=J_;function Q_(_){let f,x,E;return x=new Im({props:{routes:Vu}}),{c(){f=me("main"),Xi(x.$$.fragment),Be(f,"class","p-5 lg:p-10 flex flex-col lg:flex-row landscape:flex-row w-full gap-5 lg:gap-10")},m(D,S){fe(D,f,S),$i(x,f,null),E=!0},p:Nt,i(D){E||(di(x.$$.fragment,D),E=!0)},o(D){Ti(x.$$.fragment,D),E=!1},d(D){D&&de(f),ji(x)}}}class ey extends _n{constructor(f){super(),gn(this,f,null,Q_,ln,{})}}new ey({target:document.getElementById("app")});
