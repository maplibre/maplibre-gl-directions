var U_=Object.defineProperty;var G_=(S,y,v)=>y in S?U_(S,y,{enumerable:!0,configurable:!0,writable:!0,value:v}):S[y]=v;var td=(S,y,v)=>(G_(S,typeof y!="symbol"?y+"":y,v),v);(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const F of document.querySelectorAll('link[rel="modulepreload"]'))k(F);new MutationObserver(F=>{for(const D of F)if(D.type==="childList")for(const T of D.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&k(T)}).observe(document,{childList:!0,subtree:!0});function v(F){const D={};return F.integrity&&(D.integrity=F.integrity),F.referrerPolicy&&(D.referrerPolicy=F.referrerPolicy),F.crossOrigin==="use-credentials"?D.credentials="include":F.crossOrigin==="anonymous"?D.credentials="omit":D.credentials="same-origin",D}function k(F){if(F.ep)return;F.ep=!0;const D=v(F);fetch(F.href,D)}})();function zi(){}function rd(S,y){for(const v in y)S[v]=y[v];return S}function Vg(S){return S()}function sg(){return Object.create(null)}function Os(S){S.forEach(Vg)}function Bf(S){return typeof S=="function"}function xr(S,y){return S!=S?y==y:S!==y||S&&typeof S=="object"||typeof S=="function"}function Z_(S){return Object.keys(S).length===0}function Ug(S,...y){if(S==null){for(const k of y)k(void 0);return zi}const v=S.subscribe(...y);return v.unsubscribe?()=>v.unsubscribe():v}function Eo(S,y,v){S.$$.on_destroy.push(Ug(y,v))}function ag(S,y,v,k){if(S){const F=Gg(S,y,v,k);return S[0](F)}}function Gg(S,y,v,k){return S[1]&&k?rd(v.ctx.slice(),S[1](k(y))):v.ctx}function lg(S,y,v,k){if(S[2]&&k){const F=S[2](k(v));if(y.dirty===void 0)return F;if(typeof F=="object"){const D=[],T=Math.max(y.dirty.length,F.length);for(let a=0;a<T;a+=1)D[a]=y.dirty[a]|F[a];return D}return y.dirty|F}return y.dirty}function cg(S,y,v,k,F,D){if(F){const T=Gg(y,v,k,D);S.p(T,F)}}function ug(S){if(S.ctx.length>32){const y=[],v=S.ctx.length/32;for(let k=0;k<v;k++)y[k]=-1;return y}return-1}function Ff(S){return S&&Bf(S.destroy)?S.destroy:zi}function Ye(S,y){S.appendChild(y)}function Ee(S,y,v){S.insertBefore(y,v||null)}function Ae(S){S.parentNode&&S.parentNode.removeChild(S)}function Jm(S,y){for(let v=0;v<S.length;v+=1)S[v]&&S[v].d(y)}function Ie(S){return document.createElement(S)}function _n(S){return document.createTextNode(S)}function mt(){return _n(" ")}function Of(){return _n("")}function Ri(S,y,v,k){return S.addEventListener(y,v,k),()=>S.removeEventListener(y,v,k)}function lt(S,y,v){v==null?S.removeAttribute(y):S.getAttribute(y)!==v&&S.setAttribute(y,v)}function Rn(S){return S===""?null:+S}function q_(S){return Array.from(S.childNodes)}function Qm(S,y){y=""+y,S.data!==y&&(S.data=y)}function Gi(S,y){S.value=y??""}function hg(S,y,v,k){v==null?S.style.removeProperty(y):S.style.setProperty(y,v,k?"important":"")}function If(S,y,v){for(let k=0;k<S.options.length;k+=1){const F=S.options[k];if(F.__value===y){F.selected=!0;return}}(!v||y!==void 0)&&(S.selectedIndex=-1)}function Zg(S){const y=S.querySelector(":checked");return y&&y.__value}function pg(S,y,v){S.classList.toggle(y,!!v)}function H_(S,y,{bubbles:v=!1,cancelable:k=!1}={}){return new CustomEvent(S,{detail:y,bubbles:v,cancelable:k})}function Af(S,y){return new S(y)}let od;function id(S){od=S}function jf(){if(!od)throw new Error("Function called outside component initialization");return od}function Ko(S){jf().$$.on_mount.push(S)}function W_(S){jf().$$.after_update.push(S)}function X_(S){jf().$$.on_destroy.push(S)}function K_(){const S=jf();return(y,v,{cancelable:k=!1}={})=>{const F=S.$$.callbacks[y];if(F){const D=H_(y,v,{cancelable:k});return F.slice().forEach(T=>{T.call(S,D)}),!D.defaultPrevented}return!0}}function dg(S,y){const v=S.$$.callbacks[y.type];v&&v.slice().forEach(k=>k.call(this,y))}const Wh=[],go=[];let Yh=[];const fg=[],qg=Promise.resolve();let Wm=!1;function Hg(){Wm||(Wm=!0,qg.then(Wg))}function Y_(){return Hg(),qg}function sd(S){Yh.push(S)}const Zm=new Set;let Zh=0;function Wg(){if(Zh!==0)return;const S=od;do{try{for(;Zh<Wh.length;){const y=Wh[Zh];Zh++,id(y),J_(y.$$)}}catch(y){throw Wh.length=0,Zh=0,y}for(id(null),Wh.length=0,Zh=0;go.length;)go.pop()();for(let y=0;y<Yh.length;y+=1){const v=Yh[y];Zm.has(v)||(Zm.add(v),v())}Yh.length=0}while(Wh.length);for(;fg.length;)fg.pop()();Wm=!1,Zm.clear(),id(S)}function J_(S){if(S.fragment!==null){S.update(),Os(S.before_update);const y=S.dirty;S.dirty=[-1],S.fragment&&S.fragment.p(S.ctx,y),S.after_update.forEach(sd)}}function Q_(S){const y=[],v=[];Yh.forEach(k=>S.indexOf(k)===-1?y.push(k):v.push(k)),v.forEach(k=>k()),Yh=y}const Mf=new Set;let Ou;function eg(){Ou={r:0,c:[],p:Ou}}function tg(){Ou.r||Os(Ou.c),Ou=Ou.p}function Cn(S,y){S&&S.i&&(Mf.delete(S),S.i(y))}function Ln(S,y,v,k){if(S&&S.o){if(Mf.has(S))return;Mf.add(S),Ou.c.push(()=>{Mf.delete(S),k&&(v&&S.d(1),k())}),S.o(y)}else k&&k()}function ad(S){return(S==null?void 0:S.length)!==void 0?S:Array.from(S)}function Ef(S,y){const v={},k={},F={$$scope:1};let D=S.length;for(;D--;){const T=S[D],a=y[D];if(a){for(const q in T)q in a||(k[q]=1);for(const q in a)F[q]||(v[q]=a[q],F[q]=1);S[D]=a}else for(const q in T)F[q]=1}for(const T in k)T in v||(v[T]=void 0);return v}function kf(S){return typeof S=="object"&&S!==null?S:{}}function dr(S){S&&S.c()}function or(S,y,v){const{fragment:k,after_update:F}=S.$$;k&&k.m(y,v),sd(()=>{const D=S.$$.on_mount.map(Vg).filter(Bf);S.$$.on_destroy?S.$$.on_destroy.push(...D):Os(D),S.$$.on_mount=[]}),F.forEach(sd)}function sr(S,y){const v=S.$$;v.fragment!==null&&(Q_(v.after_update),Os(v.on_destroy),v.fragment&&v.fragment.d(y),v.on_destroy=v.fragment=null,v.ctx=[])}function ey(S,y){S.$$.dirty[0]===-1&&(Wh.push(S),Hg(),S.$$.dirty.fill(0)),S.$$.dirty[y/31|0]|=1<<y%31}function Or(S,y,v,k,F,D,T=null,a=[-1]){const q=od;id(S);const Y=S.$$={fragment:null,ctx:[],props:D,update:zi,not_equal:F,bound:sg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(y.context||(q?q.$$.context:[])),callbacks:sg(),dirty:a,skip_bound:!1,root:y.target||q.$$.root};T&&T(Y.root);let fe=!1;if(Y.ctx=v?v(S,y.props||{},(de,ge,...te)=>{const we=te.length?te[0]:ge;return Y.ctx&&F(Y.ctx[de],Y.ctx[de]=we)&&(!Y.skip_bound&&Y.bound[de]&&Y.bound[de](we),fe&&ey(S,de)),ge}):[],Y.update(),fe=!0,Os(Y.before_update),Y.fragment=k?k(Y.ctx):!1,y.target){if(y.hydrate){const de=q_(y.target);Y.fragment&&Y.fragment.l(de),de.forEach(Ae)}else Y.fragment&&Y.fragment.c();y.intro&&Cn(S.$$.fragment),or(S,y.target,y.anchor),Wg()}id(q)}class jr{constructor(){td(this,"$$");td(this,"$$set")}$destroy(){sr(this,1),this.$destroy=zi}$on(y,v){if(!Bf(v))return zi;const k=this.$$.callbacks[y]||(this.$$.callbacks[y]=[]);return k.push(v),()=>{const F=k.indexOf(v);F!==-1&&k.splice(F,1)}}$set(y){this.$$set&&!Z_(y)&&(this.$$.skip_bound=!0,this.$$set(y),this.$$.skip_bound=!1)}}const ty="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ty);const qh=[];function Xg(S,y){return{subscribe:Kg(S,y).subscribe}}function Kg(S,y=zi){let v;const k=new Set;function F(a){if(xr(S,a)&&(S=a,v)){const q=!qh.length;for(const Y of k)Y[1](),qh.push(Y,S);if(q){for(let Y=0;Y<qh.length;Y+=2)qh[Y][0](qh[Y+1]);qh.length=0}}}function D(a){F(a(S))}function T(a,q=zi){const Y=[a,q];return k.add(Y),k.size===1&&(v=y(F,D)||zi),a(S),()=>{k.delete(Y),k.size===0&&v&&(v(),v=null)}}return{set:F,update:D,subscribe:T}}function Yg(S,y,v){const k=!Array.isArray(S),F=k?[S]:S;if(!F.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const D=y.length<2;return Xg(v,(T,a)=>{let q=!1;const Y=[];let fe=0,de=zi;const ge=()=>{if(fe)return;de();const we=y(k?Y[0]:Y,T,a);D?T(we):de=Bf(we)?we:zi},te=F.map((we,it)=>Ug(we,Ke=>{Y[it]=Ke,fe&=~(1<<it),q&&ge()},()=>{fe|=1<<it}));return q=!0,ge(),function(){Os(te),de(),q=!1}})}function iy(S,y){if(S instanceof RegExp)return{keys:!1,pattern:S};var v,k,F,D,T=[],a="",q=S.split("/");for(q[0]||q.shift();F=q.shift();)v=F[0],v==="*"?(T.push("wild"),a+="/(.*)"):v===":"?(k=F.indexOf("?",1),D=F.indexOf(".",1),T.push(F.substring(1,~k?k:~D?D:F.length)),a+=~k&&!~D?"(?:/([^/]+?))?":"/([^/]+?)",~D&&(a+=(~k?"?":"")+"\\"+F.substring(D))):a+="/"+F;return{keys:T,pattern:new RegExp("^"+a+(y?"(?=$|/)":"/?$"),"i")}}function ny(S){let y,v,k;const F=[S[2]];var D=S[0];function T(a,q){let Y={};for(let fe=0;fe<F.length;fe+=1)Y=rd(Y,F[fe]);return q!==void 0&&q&4&&(Y=rd(Y,Ef(F,[kf(a[2])]))),{props:Y}}return D&&(y=Af(D,T(S)),y.$on("routeEvent",S[7])),{c(){y&&dr(y.$$.fragment),v=Of()},m(a,q){y&&or(y,a,q),Ee(a,v,q),k=!0},p(a,q){if(q&1&&D!==(D=a[0])){if(y){eg();const Y=y;Ln(Y.$$.fragment,1,0,()=>{sr(Y,1)}),tg()}D?(y=Af(D,T(a,q)),y.$on("routeEvent",a[7]),dr(y.$$.fragment),Cn(y.$$.fragment,1),or(y,v.parentNode,v)):y=null}else if(D){const Y=q&4?Ef(F,[kf(a[2])]):{};y.$set(Y)}},i(a){k||(y&&Cn(y.$$.fragment,a),k=!0)},o(a){y&&Ln(y.$$.fragment,a),k=!1},d(a){a&&Ae(v),y&&sr(y,a)}}}function ry(S){let y,v,k;const F=[{params:S[1]},S[2]];var D=S[0];function T(a,q){let Y={};for(let fe=0;fe<F.length;fe+=1)Y=rd(Y,F[fe]);return q!==void 0&&q&6&&(Y=rd(Y,Ef(F,[q&2&&{params:a[1]},q&4&&kf(a[2])]))),{props:Y}}return D&&(y=Af(D,T(S)),y.$on("routeEvent",S[6])),{c(){y&&dr(y.$$.fragment),v=Of()},m(a,q){y&&or(y,a,q),Ee(a,v,q),k=!0},p(a,q){if(q&1&&D!==(D=a[0])){if(y){eg();const Y=y;Ln(Y.$$.fragment,1,0,()=>{sr(Y,1)}),tg()}D?(y=Af(D,T(a,q)),y.$on("routeEvent",a[6]),dr(y.$$.fragment),Cn(y.$$.fragment,1),or(y,v.parentNode,v)):y=null}else if(D){const Y=q&6?Ef(F,[q&2&&{params:a[1]},q&4&&kf(a[2])]):{};y.$set(Y)}},i(a){k||(y&&Cn(y.$$.fragment,a),k=!0)},o(a){y&&Ln(y.$$.fragment,a),k=!1},d(a){a&&Ae(v),y&&sr(y,a)}}}function oy(S){let y,v,k,F;const D=[ry,ny],T=[];function a(q,Y){return q[1]?0:1}return y=a(S),v=T[y]=D[y](S),{c(){v.c(),k=Of()},m(q,Y){T[y].m(q,Y),Ee(q,k,Y),F=!0},p(q,[Y]){let fe=y;y=a(q),y===fe?T[y].p(q,Y):(eg(),Ln(T[fe],1,1,()=>{T[fe]=null}),tg(),v=T[y],v?v.p(q,Y):(v=T[y]=D[y](q),v.c()),Cn(v,1),v.m(k.parentNode,k))},i(q){F||(Cn(v),F=!0)},o(q){Ln(v),F=!1},d(q){q&&Ae(k),T[y].d(q)}}}function mg(){const S=window.location.href.indexOf("#/");let y=S>-1?window.location.href.substr(S+1):"/";const v=y.indexOf("?");let k="";return v>-1&&(k=y.substr(v+1),y=y.substr(0,v)),{location:y,querystring:k}}const ig=Xg(null,function(y){y(mg());const v=()=>{y(mg())};return window.addEventListener("hashchange",v,!1),function(){window.removeEventListener("hashchange",v,!1)}}),ko=Yg(ig,S=>S.location);Yg(ig,S=>S.querystring);const gg=Kg(void 0);function Nf(S,y){if(y=yg(y),!S||!S.tagName||S.tagName.toLowerCase()!="a")throw Error('Action "link" can only be used with <a> tags');return _g(S,y),{update(v){v=yg(v),_g(S,v)}}}function sy(S){S?window.scrollTo(S.__svelte_spa_router_scrollX,S.__svelte_spa_router_scrollY):window.scrollTo(0,0)}function _g(S,y){let v=y.href||S.getAttribute("href");if(v&&v.charAt(0)=="/")v="#"+v;else if(!v||v.length<2||v.slice(0,2)!="#/")throw Error('Invalid value for "href" attribute: '+v);S.setAttribute("href",v),S.addEventListener("click",k=>{k.preventDefault(),y.disabled||ay(k.currentTarget.getAttribute("href"))})}function yg(S){return S&&typeof S=="string"?{href:S}:S||{}}function ay(S){history.replaceState({...history.state,__svelte_spa_router_scrollX:window.scrollX,__svelte_spa_router_scrollY:window.scrollY},void 0),window.location.hash=S}function ly(S,y,v){let{routes:k={}}=y,{prefix:F=""}=y,{restoreScrollState:D=!1}=y;class T{constructor(ht,Xe){if(!Xe||typeof Xe!="function"&&(typeof Xe!="object"||Xe._sveltesparouter!==!0))throw Error("Invalid component object");if(!ht||typeof ht=="string"&&(ht.length<1||ht.charAt(0)!="/"&&ht.charAt(0)!="*")||typeof ht=="object"&&!(ht instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:ct,keys:Tt}=iy(ht);this.path=ht,typeof Xe=="object"&&Xe._sveltesparouter===!0?(this.component=Xe.component,this.conditions=Xe.conditions||[],this.userData=Xe.userData,this.props=Xe.props||{}):(this.component=()=>Promise.resolve(Xe),this.conditions=[],this.props={}),this._pattern=ct,this._keys=Tt}match(ht){if(F){if(typeof F=="string")if(ht.startsWith(F))ht=ht.substr(F.length)||"/";else return null;else if(F instanceof RegExp){const $t=ht.match(F);if($t&&$t[0])ht=ht.substr($t[0].length)||"/";else return null}}const Xe=this._pattern.exec(ht);if(Xe===null)return null;if(this._keys===!1)return Xe;const ct={};let Tt=0;for(;Tt<this._keys.length;){try{ct[this._keys[Tt]]=decodeURIComponent(Xe[Tt+1]||"")||null}catch{ct[this._keys[Tt]]=null}Tt++}return ct}async checkConditions(ht){for(let Xe=0;Xe<this.conditions.length;Xe++)if(!await this.conditions[Xe](ht))return!1;return!0}}const a=[];k instanceof Map?k.forEach((nt,ht)=>{a.push(new T(ht,nt))}):Object.keys(k).forEach(nt=>{a.push(new T(nt,k[nt]))});let q=null,Y=null,fe={};const de=K_();async function ge(nt,ht){await Y_(),de(nt,ht)}let te=null,we=null;D&&(we=nt=>{nt.state&&(nt.state.__svelte_spa_router_scrollY||nt.state.__svelte_spa_router_scrollX)?te=nt.state:te=null},window.addEventListener("popstate",we),W_(()=>{sy(te)}));let it=null,Ke=null;const vt=ig.subscribe(async nt=>{it=nt;let ht=0;for(;ht<a.length;){const Xe=a[ht].match(nt.location);if(!Xe){ht++;continue}const ct={route:a[ht].path,location:nt.location,querystring:nt.querystring,userData:a[ht].userData,params:Xe&&typeof Xe=="object"&&Object.keys(Xe).length?Xe:null};if(!await a[ht].checkConditions(ct)){v(0,q=null),Ke=null,ge("conditionsFailed",ct);return}ge("routeLoading",Object.assign({},ct));const Tt=a[ht].component;if(Ke!=Tt){Tt.loading?(v(0,q=Tt.loading),Ke=Tt,v(1,Y=Tt.loadingParams),v(2,fe={}),ge("routeLoaded",Object.assign({},ct,{component:q,name:q.name,params:Y}))):(v(0,q=null),Ke=null);const $t=await Tt();if(nt!=it)return;v(0,q=$t&&$t.default||$t),Ke=Tt}Xe&&typeof Xe=="object"&&Object.keys(Xe).length?v(1,Y=Xe):v(1,Y=null),v(2,fe=a[ht].props),ge("routeLoaded",Object.assign({},ct,{component:q,name:q.name,params:Y})).then(()=>{gg.set(Y)});return}v(0,q=null),Ke=null,gg.set(void 0)});X_(()=>{vt(),we&&window.removeEventListener("popstate",we)});function Rt(nt){dg.call(this,S,nt)}function gt(nt){dg.call(this,S,nt)}return S.$$set=nt=>{"routes"in nt&&v(3,k=nt.routes),"prefix"in nt&&v(4,F=nt.prefix),"restoreScrollState"in nt&&v(5,D=nt.restoreScrollState)},S.$$.update=()=>{S.$$.dirty&32&&(history.scrollRestoration=D?"manual":"auto")},[q,Y,fe,k,F,D,Rt,gt]}class cy extends jr{constructor(y){super(),Or(this,y,ly,oy,xr,{routes:3,prefix:4,restoreScrollState:5})}}const uy=S=>({}),vg=S=>({});function xg(S){let y,v,k,F,D,T,a;return{c(){y=Ie("header"),v=Ie("a"),v.textContent="Back to Menu",k=mt(),F=Ie("a"),D=_n("Source"),lt(v,"href","/"),lt(v,"class","svelte-1jo4v3w"),lt(F,"href",S[1].sourceUrl),lt(F,"target","_blank"),lt(F,"rel","noreferrer"),lt(F,"class","svelte-1jo4v3w"),lt(y,"class","p-5 lg:p-10 pb-2.5 lg:pb-5 flex justify-between gap-2.5 lg:gap-5 sticky top-0 bg-inherit svelte-1jo4v3w")},m(q,Y){Ee(q,y,Y),Ye(y,v),Ye(y,k),Ye(y,F),Ye(F,D),T||(a=Ff(Nf.call(null,v)),T=!0)},p:zi,d(q){q&&Ae(y),T=!1,a()}}}function hy(S){let y,v,k,F,D,T,a,q=!S[0]&&xg(S);const Y=S[3].title,fe=ag(Y,S,S[2],vg),de=S[3].default,ge=ag(de,S,S[2],null);return{c(){y=Ie("aside"),v=Ie("div"),q&&q.c(),k=mt(),F=Ie("article"),D=Ie("h1"),fe&&fe.c(),T=mt(),ge&&ge.c(),lt(D,"class","break-all svelte-1jo4v3w"),lt(F,"class","p-5 lg:p-10 flex flex-col gap-1.5 lg:gap-3 svelte-1jo4v3w"),pg(F,"!pt-0",!S[0]),lt(v,"class","h-full flex flex-col bg-inherit overflow-x-hidden overflow-y-auto svelte-1jo4v3w"),lt(y,"class","basis-full lg:basis-1/3 overflow-hidden shadow-xl svelte-1jo4v3w")},m(te,we){Ee(te,y,we),Ye(y,v),q&&q.m(v,null),Ye(v,k),Ye(v,F),Ye(F,D),fe&&fe.m(D,null),Ye(F,T),ge&&ge.m(F,null),a=!0},p(te,[we]){te[0]?q&&(q.d(1),q=null):q?q.p(te,we):(q=xg(te),q.c(),q.m(v,k)),fe&&fe.p&&(!a||we&4)&&cg(fe,Y,te,te[2],a?lg(Y,te[2],we,uy):ug(te[2]),vg),ge&&ge.p&&(!a||we&4)&&cg(ge,de,te,te[2],a?lg(de,te[2],we,null):ug(te[2]),null),(!a||we&1)&&pg(F,"!pt-0",!te[0])},i(te){a||(Cn(fe,te),Cn(ge,te),a=!0)},o(te){Ln(fe,te),Ln(ge,te),a=!1},d(te){te&&Ae(y),q&&q.d(),fe&&fe.d(te),ge&&ge.d(te)}}}function py(S,y,v){let k;Eo(S,ko,q=>v(4,k=q));let{$$slots:F={},$$scope:D}=y,{noHeader:T=!1}=y;const a=Jr.find(q=>q.path===k);return S.$$set=q=>{"noHeader"in q&&v(0,T=q.noHeader),"$$scope"in q&&v(2,D=q.$$scope)},[T,a,D,F]}class zo extends jr{constructor(y){super(),Or(this,y,py,hy,xr,{noHeader:0})}}var Xh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dy(S){return S&&S.__esModule&&Object.prototype.hasOwnProperty.call(S,"default")?S.default:S}var Jg={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.1.0/LICENSE.txt
 */(function(S,y){(function(v,k){S.exports=k()})(Xh,function(){var v={},k={};function F(T,a,q){if(k[T]=q,T==="index"){var Y="var sharedModule = {}; ("+k.shared+")(sharedModule); ("+k.worker+")(sharedModule);",fe={};return k.shared(fe),k.index(v,fe),typeof window<"u"&&v.setWorkerUrl(window.URL.createObjectURL(new Blob([Y],{type:"text/javascript"}))),v}}F("shared",["exports"],function(T){function a(n,t,r,o){return new(r||(r=Promise))(function(u,f){function m(M){try{w(o.next(M))}catch(I){f(I)}}function _(M){try{w(o.throw(M))}catch(I){f(I)}}function w(M){var I;M.done?u(M.value):(I=M.value,I instanceof r?I:new r(function(E){E(I)})).then(m,_)}w((o=o.apply(n,t||[])).next())})}function q(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Y,fe;function de(){if(fe)return Y;function n(t,r){this.x=t,this.y=r}return fe=1,Y=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,r){return this.clone()._rotateAround(t,r)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var r=t.x-this.x,o=t.y-this.y;return r*r+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,r){return Math.atan2(this.x*r-this.y*t,this.x*t+this.y*r)},_matMult:function(t){var r=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var r=Math.cos(t),o=Math.sin(t),u=o*this.x+r*this.y;return this.x=r*this.x-o*this.y,this.y=u,this},_rotateAround:function(t,r){var o=Math.cos(t),u=Math.sin(t),f=r.y+u*(this.x-r.x)+o*(this.y-r.y);return this.x=r.x+o*(this.x-r.x)-u*(this.y-r.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t},Y}typeof SuppressedError=="function"&&SuppressedError;var ge,te,we=q(de()),it=function(){if(te)return ge;function n(t,r,o,u){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=o,this.p2y=u}return te=1,ge=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,u=0;u<8;u++){var f=this.sampleCurveX(o)-t;if(Math.abs(f)<r)return o;var m=this.sampleCurveDerivativeX(o);if(Math.abs(m)<1e-6)break;o-=f/m}var _=0,w=1;for(o=t,u=0;u<20&&(f=this.sampleCurveX(o),!(Math.abs(f-t)<r));u++)t>f?_=o:w=o,o=.5*(w-_)+_;return o},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},ge}(),Ke=q(it);let vt,Rt;function gt(){return vt==null&&(vt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),vt}function nt(){if(Rt==null&&(Rt=!1,gt())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const u=4*o;t.fillStyle=`rgb(${u},${u+1},${u+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&r[o]!==o){Rt=!0;break}}}return Rt||!1}var ht,Xe=1e-6,ct=typeof Float32Array<"u"?Float32Array:Array;function Tt(){var n=new ct(9);return ct!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function $t(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Bi(){var n=new ct(3);return ct!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Jt(n,t,r){var o=new ct(3);return o[0]=n,o[1]=t,o[2]=r,o}function Ot(n,t,r){var o=t[0],u=t[1],f=t[2],m=t[3];return n[0]=r[0]*o+r[4]*u+r[8]*f+r[12]*m,n[1]=r[1]*o+r[5]*u+r[9]*f+r[13]*m,n[2]=r[2]*o+r[6]*u+r[10]*f+r[14]*m,n[3]=r[3]*o+r[7]*u+r[11]*f+r[15]*m,n}function Ft(){var n=new ct(4);return ct!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Pt(){var n=new ct(2);return ct!=Float32Array&&(n[0]=0,n[1]=0),n}function Wt(n,t){var r=new ct(2);return r[0]=n,r[1]=t,r}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)}),Bi(),ht=new ct(4),ct!=Float32Array&&(ht[0]=0,ht[1]=0,ht[2]=0,ht[3]=0),Bi(),Jt(1,0,0),Jt(0,1,0),Ft(),Ft(),Tt(),Pt();const jt=8192;function gi(n,t,r){return t*(jt/(n.tileSize*Math.pow(2,r-n.tileID.overscaledZ)))}function Pi(n,t){return(n%t+t)%t}function cn(n,t,r){return n*(1-r)+t*r}function Yi(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,r=t*n;return 4*(n<.5?r:3*(n-t)+r-.75)}function ni(n,t,r,o){const u=new Ke(n,t,r,o);return f=>u.solve(f)}const br=ni(.25,.1,.25,1);function wr(n,t,r){return Math.min(r,Math.max(t,n))}function pn(n,t,r){const o=r-t,u=((n-t)%o+o)%o+t;return u===t?r:u}function Fi(n,...t){for(const r of t)for(const o in r)n[o]=r[o];return n}let Tr=1;function fr(n,t,r){const o={};for(const u in n)o[u]=t.call(this,n[u],u,n);return o}function mr(n,t,r){const o={};for(const u in n)t.call(this,n[u],u,n)&&(o[u]=n[u]);return o}function In(n){return Array.isArray(n)?n.map(In):typeof n=="object"&&n?fr(n,In):n}const gr={};function Ji(n){gr[n]||(typeof console<"u"&&console.warn(n),gr[n]=!0)}function Ni(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function Zn(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let mi=null;function Sr(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Yn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Qi(n,t,r,o,u){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(n,{timestamp:0});try{const m=f==null?void 0:f.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const _=m.startsWith("BGR"),w=new Uint8ClampedArray(o*u*4);if(yield f.copyTo(w,function(M,I,E,L,j){const N=4*Math.max(1,0),G=(Math.max(0,E)-E)*L*4+N,J=4*L,oe=Math.max(0,I),xe=Math.max(0,E);return{rect:{x:oe,y:xe,width:Math.min(M.width,I+L)-oe,height:Math.min(M.height,E+j)-xe},layout:[{offset:G,stride:J}]}}(n,t,r,o,u)),_)for(let M=0;M<w.length;M+=4){const I=w[M];w[M]=w[M+2],w[M+2]=I}return w}finally{f.close()}})}let Nr,ar;function yn(n){return n/Math.PI*180}const An="AbortError";function vn(){return new Error(An)}const lr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Jo(n){return lr.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const Bn="global-dispatcher";class $r extends Error{constructor(t,r,o,u){super(`AJAXError: ${r} (${t}): ${o}`),this.status=t,this.statusText=r,this.url=o,this.body=u}}const Pr=()=>Zn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,en=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const o=Jo(n.url);if(o)return o(n,t);if(Zn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:Bn},t)}if(!(/^file:/.test(r=n.url)||/^file:/.test(Pr())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,u){return a(this,void 0,void 0,function*(){const f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Pr(),signal:u.signal});let m,_;o.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");try{m=yield fetch(f)}catch(M){throw new $r(0,M.message,o.url,new Blob)}if(!m.ok){const M=yield m.blob();throw new $r(m.status,m.statusText,o.url,M)}_=o.type==="arrayBuffer"||o.type==="image"?m.arrayBuffer():o.type==="json"?m.json():m.text();const w=yield _;if(u.signal.aborted)throw vn();return{data:w,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}})}(n,t);if(Zn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:Bn},t)}var r;return function(o,u){return new Promise((f,m)=>{var _;const w=new XMLHttpRequest;w.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(w.responseType="arraybuffer");for(const M in o.headers)w.setRequestHeader(M,o.headers[M]);o.type==="json"&&(w.responseType="text",!((_=o.headers)===null||_===void 0)&&_.Accept||w.setRequestHeader("Accept","application/json")),w.withCredentials=o.credentials==="include",w.onerror=()=>{m(new Error(w.statusText))},w.onload=()=>{if(!u.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let M=w.response;if(o.type==="json")try{M=JSON.parse(w.response)}catch(I){return void m(I)}f({data:M,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const M=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});m(new $r(w.status,w.statusText,o.url,M))}},u.signal.addEventListener("abort",()=>{w.abort(),m(vn())}),w.send(o.body)})}(n,t)};function Mr(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function Cr(n,t,r){r[n]&&r[n].indexOf(t)!==-1||(r[n]=r[n]||[],r[n].push(t))}function cr(n,t,r){if(r&&r[n]){const o=r[n].indexOf(t);o!==-1&&r[n].splice(o,1)}}class Qr{constructor(t,r={}){Fi(this,r),this.type=t}}class Do extends Qr{constructor(t,r={}){super("error",Fi({error:t},r))}}class En{on(t,r){return this._listeners=this._listeners||{},Cr(t,r,this._listeners),{unsubscribe:()=>{this.off(t,r)}}}off(t,r){return cr(t,r,this._listeners),cr(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Cr(t,r,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,r){typeof t=="string"&&(t=new Qr(t,r||{}));const o=t.type;if(this.listens(o)){t.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const _ of u)_.call(this,t);const f=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const _ of f)cr(o,_,this._oneTimeListeners),_.call(this,t);const m=this._eventedParent;m&&(Fi(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(t))}else t instanceof Do&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var Q={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const U=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function H(n,t){const r={};for(const o in n)o!=="ref"&&(r[o]=n[o]);return U.forEach(o=>{o in t&&(r[o]=t[o])}),r}function W(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!W(n[r],t[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const r in n)if(!W(n[r],t[r]))return!1;return!0}return n===t}function ae(n,t){n.push(t)}function _e(n,t,r){ae(r,{command:"addSource",args:[n,t[n]]})}function Pe(n,t,r){ae(t,{command:"removeSource",args:[n]}),r[n]=!0}function De(n,t,r,o){Pe(n,r,o),_e(n,t,r)}function Te(n,t,r){let o;for(o in n[r])if(Object.prototype.hasOwnProperty.call(n[r],o)&&o!=="data"&&!W(n[r][o],t[r][o]))return!1;for(o in t[r])if(Object.prototype.hasOwnProperty.call(t[r],o)&&o!=="data"&&!W(n[r][o],t[r][o]))return!1;return!0}function Ne(n,t,r,o,u,f){n=n||{},t=t||{};for(const m in n)Object.prototype.hasOwnProperty.call(n,m)&&(W(n[m],t[m])||r.push({command:f,args:[o,m,t[m],u]}));for(const m in t)Object.prototype.hasOwnProperty.call(t,m)&&!Object.prototype.hasOwnProperty.call(n,m)&&(W(n[m],t[m])||r.push({command:f,args:[o,m,t[m],u]}))}function Oe(n){return n.id}function Me(n,t){return n[t.id]=t,n}class be{constructor(t,r,o,u){this.message=(t?`${t}: `:"")+o,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function pt(n,...t){for(const r of t)for(const o in r)n[o]=r[o];return n}class dt extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class qe{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[o,u]of r)this.bindings[o]=u}concat(t){return new qe(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const rt={kind:"null"},Ge={kind:"number"},yt={kind:"string"},Mt={kind:"boolean"},Qt={kind:"color"},ui={kind:"projectionDefinition"},Lt={kind:"object"},wt={kind:"value"},un={kind:"collator"},_s={kind:"formatted"},Fn={kind:"padding"},xn={kind:"resolvedImage"},Zi={kind:"variableAnchorOffsetCollection"};function Vr(n,t){return{kind:"array",itemType:n,N:t}}function qi(n){if(n.kind==="array"){const t=qi(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const Ha=[rt,Ge,yt,Mt,Qt,ui,_s,Lt,Vr(wt),Fn,xn,Zi];function ga(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ga(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const r of Ha)if(!ga(r,t))return null}}return`Expected ${qi(n)} but found ${qi(t)} instead.`}function Gc(n,t){return t.some(r=>r.kind===n.kind)}function Ro(n,t){return t.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}function js(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const Wa=.96422,Zc=.82521,Nu=4/29,_a=6/29,qc=3*_a*_a,$u=_a*_a*_a,Vu=Math.PI/180,Qh=180/Math.PI;function Uu(n){return(n%=360)<0&&(n+=360),n}function Hc([n,t,r,o]){let u,f;const m=Ll((.2225045*(n=Ns(n))+.7168786*(t=Ns(t))+.0606169*(r=Ns(r)))/1);n===t&&t===r?u=f=m:(u=Ll((.4360747*n+.3850649*t+.1430804*r)/Wa),f=Ll((.0139322*n+.0971045*t+.7141733*r)/Zc));const _=116*m-16;return[_<0?0:_,500*(u-m),200*(m-f),o]}function Ns(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Ll(n){return n>$u?Math.pow(n,1/3):n/qc+Nu}function Wc([n,t,r,o]){let u=(n+16)/116,f=isNaN(t)?u:u+t/500,m=isNaN(r)?u:u-r/200;return u=1*Xa(u),f=Wa*Xa(f),m=Zc*Xa(m),[ys(3.1338561*f-1.6168667*u-.4906146*m),ys(-.9787684*f+1.9161415*u+.033454*m),ys(.0719453*f-.2289914*u+1.4052427*m),o]}function ys(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Xa(n){return n>_a?n*n*n:qc*(n-Nu)}function Bl(n){return parseInt(n.padEnd(2,n),16)/255}function Xc(n,t){return Lo(t?n/100:n,0,1)}function Lo(n,t,r){return Math.min(Math.max(t,n),r)}function Fl(n){return!n.some(Number.isNaN)}const Bo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Xt(n,t,r){return n+r*(t-n)}function _o(n,t,r){return n.map((o,u)=>Xt(o,t[u],r))}class Kt{constructor(t,r,o,u=1,f=!0){this.r=t,this.g=r,this.b=o,this.a=u,f||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[t,r,o,u]))}static parse(t){if(t instanceof Kt)return t;if(typeof t!="string")return;const r=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=Bo[o];if(u){const[m,_,w]=u;return[m/255,_/255,w/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const m=o.length<6?1:2;let _=1;return[Bl(o.slice(_,_+=m)),Bl(o.slice(_,_+=m)),Bl(o.slice(_,_+=m)),Bl(o.slice(_,_+m)||"ff")]}if(o.startsWith("rgb")){const m=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[_,w,M,I,E,L,j,N,G,J,oe,xe]=m,le=[I||" ",j||" ",J].join("");if(le==="  "||le==="  /"||le===",,"||le===",,,"){const O=[M,L,G].join(""),K=O==="%%%"?100:O===""?255:0;if(K){const ce=[Lo(+w/K,0,1),Lo(+E/K,0,1),Lo(+N/K,0,1),oe?Xc(+oe,xe):1];if(Fl(ce))return ce}}return}}const f=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[m,_,w,M,I,E,L,j,N]=f,G=[w||" ",I||" ",L].join("");if(G==="  "||G==="  /"||G===",,"||G===",,,"){const J=[+_,Lo(+M,0,100),Lo(+E,0,100),j?Xc(+j,N):1];if(Fl(J))return function([oe,xe,le,O]){function K(ce){const Re=(ce+oe/30)%12,Je=xe*Math.min(le,1-le);return le-Je*Math.max(-1,Math.min(Re-3,9-Re,1))}return oe=Uu(oe),xe/=100,le/=100,[K(0),K(8),K(4),O]}(J)}}}(t);return r?new Kt(...r,!1):void 0}get rgb(){const{r:t,g:r,b:o,a:u}=this,f=u||1/0;return this.overwriteGetter("rgb",[t/f,r/f,o/f,u])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,o,u,f]=Hc(t),m=Math.sqrt(o*o+u*u);return[Math.round(1e4*m)?Uu(Math.atan2(u,o)*Qh):NaN,m,r,f]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Hc(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,o,u]=this.rgb;return`rgba(${[t,r,o].map(f=>Math.round(255*f)).join(",")},${u})`}static interpolate(t,r,o,u="rgb"){switch(u){case"rgb":{const[f,m,_,w]=_o(t.rgb,r.rgb,o);return new Kt(f,m,_,w,!1)}case"hcl":{const[f,m,_,w]=t.hcl,[M,I,E,L]=r.hcl;let j,N;if(isNaN(f)||isNaN(M))isNaN(f)?isNaN(M)?j=NaN:(j=M,_!==1&&_!==0||(N=I)):(j=f,E!==1&&E!==0||(N=m));else{let le=M-f;M>f&&le>180?le-=360:M<f&&f-M>180&&(le+=360),j=f+o*le}const[G,J,oe,xe]=function([le,O,K,ce]){return le=isNaN(le)?0:le*Vu,Wc([K,Math.cos(le)*O,Math.sin(le)*O,ce])}([j,N??Xt(m,I,o),Xt(_,E,o),Xt(w,L,o)]);return new Kt(G,J,oe,xe,!1)}case"lab":{const[f,m,_,w]=Wc(_o(t.lab,r.lab,o));return new Kt(f,m,_,w,!1)}}}}Kt.black=new Kt(0,0,0,1),Kt.white=new Kt(1,1,1,1),Kt.transparent=new Kt(0,0,0,0),Kt.red=new Kt(1,0,0,1);class Ol{constructor(t,r,o){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Kc=["bottom","center","top"];class $s{constructor(t,r,o,u,f,m){this.text=t,this.image=r,this.scale=o,this.fontStack=u,this.textColor=f,this.verticalAlign=m}}class tn{constructor(t){this.sections=t}static fromString(t){return new tn([new $s(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof tn?t:tn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class nn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof nn)return t;if(typeof t=="number")return new nn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new nn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){return new nn(_o(t.values,r.values,o))}}class Hi{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const jl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ur{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ur)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const o=t[r],u=t[r+1];if(typeof o!="string"||!jl.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new ur(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){const u=t.values,f=r.values;if(u.length!==f.length)throw new Hi(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${r.toString()}`);const m=[];for(let _=0;_<u.length;_+=2){if(u[_]!==f[_])throw new Hi(`Cannot interpolate values containing mismatched anchors. from[${_}]: ${u[_]}, to[${_}]: ${f[_]}`);m.push(u[_]);const[w,M]=u[_+1],[I,E]=f[_+1];m.push([Xt(w,I,o),Xt(M,E,o)])}return new ur(m)}}class Jn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Jn({name:t,available:!1}):null}}class Qn{constructor(t,r,o){this.from=t,this.to=r,this.transition=o}static interpolate(t,r,o){return new Qn(t,r,o)}static parse(t){return t instanceof Qn?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Qn(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Qn(t.from,t.to,t.transition):typeof t=="string"?new Qn(t,t,1):void 0}}function Nl(n,t,r,o){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,t,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,t,r,o]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function vs(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Qn||n instanceof Kt||n instanceof Ol||n instanceof tn||n instanceof nn||n instanceof ur||n instanceof Jn)return!0;if(Array.isArray(n)){for(const t of n)if(!vs(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!vs(n[t]))return!1;return!0}return!1}function $i(n){if(n===null)return rt;if(typeof n=="string")return yt;if(typeof n=="boolean")return Mt;if(typeof n=="number")return Ge;if(n instanceof Kt)return Qt;if(n instanceof Qn)return ui;if(n instanceof Ol)return un;if(n instanceof tn)return _s;if(n instanceof nn)return Fn;if(n instanceof ur)return Zi;if(n instanceof Jn)return xn;if(Array.isArray(n)){const t=n.length;let r;for(const o of n){const u=$i(o);if(r){if(r===u)continue;r=wt;break}r=u}return Vr(r||wt,t)}return Lt}function Ka(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof Kt||n instanceof Qn||n instanceof tn||n instanceof nn||n instanceof ur||n instanceof Jn?n.toString():JSON.stringify(n)}class Fo{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!vs(t[1]))return r.error("invalid value");const o=t[1];let u=$i(o);const f=r.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new Fo(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Oo={string:yt,number:Ge,boolean:Mt,object:Lt};class eo{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let o,u=1;const f=t[0];if(f==="array"){let _,w;if(t.length>2){const M=t[1];if(typeof M!="string"||!(M in Oo)||M==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);_=Oo[M],u++}else _=wt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);w=t[2],u++}o=Vr(_,w)}else{if(!Oo[f])throw new Error(`Types doesn't contain name = ${f}`);o=Oo[f]}const m=[];for(;u<t.length;u++){const _=r.parse(t[u],u,wt);if(!_)return null;m.push(_)}return new eo(o,m)}evaluate(t){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(t);if(!ga(this.type,$i(o)))return o;if(r===this.args.length-1)throw new Hi(`Expected value to be of type ${qi(this.type)}, but found ${qi($i(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Yc={"to-boolean":Mt,"to-color":Qt,"to-number":Ge,"to-string":yt};class Qo{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[0];if(!Yc[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return r.error("Expected one argument.");const u=Yc[o],f=[];for(let m=1;m<t.length;m++){const _=r.parse(t[m],m,wt);if(!_)return null;f.push(_)}return new Qo(u,f)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,o;for(const u of this.args){if(r=u.evaluate(t),o=null,r instanceof Kt)return r;if(typeof r=="string"){const f=t.parseColor(r);if(f)return f}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Nl(r[0],r[1],r[2],r[3]),!o))return new Kt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Hi(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const o of this.args){r=o.evaluate(t);const u=nn.parse(r);if(u)return u}throw new Hi(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const o of this.args){r=o.evaluate(t);const u=ur.parse(r);if(u)return u}throw new Hi(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const o of this.args){if(r=o.evaluate(t),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new Hi(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return tn.fromString(Ka(this.args[0].evaluate(t)));case"resolvedImage":return Jn.fromString(Ka(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return Ka(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const $l=["Unknown","Point","LineString","Polygon"];class Li{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$l[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=Kt.parse(t)),r}}class ya{constructor(t,r,o=[],u,f=new qe,m=[]){this.registry=t,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=f,this.errors=m,this.expectedType=u,this._isConstant=r}parse(t,r,o,u,f={}){return r?this.concat(r,o,u)._parse(t,f):this._parse(t,f)}_parse(t,r){function o(u,f,m){return m==="assert"?new eo(f,[u]):m==="coerce"?new Qo(f,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let m=f.parse(t,this);if(!m)return null;if(this.expectedType){const _=this.expectedType,w=m.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||w.kind!=="value")if(_.kind!=="projectionDefinition"||w.kind!=="string"&&w.kind!=="array")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string")if(_.kind!=="padding"||w.kind!=="value"&&w.kind!=="number"&&w.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||w.kind!=="value"&&w.kind!=="array"){if(this.checkSubtype(_,w))return null}else m=o(m,_,r.typeAnnotation||"coerce");else m=o(m,_,r.typeAnnotation||"coerce");else m=o(m,_,r.typeAnnotation||"coerce");else m=o(m,_,r.typeAnnotation||"coerce");else m=o(m,_,r.typeAnnotation||"assert")}if(!(m instanceof Fo)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const _=new Li;try{m=new Fo(m.type,m.evaluate(_))}catch(w){return this.error(w.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,o){const u=typeof t=="number"?this.path.concat(t):this.path,f=o?this.scope.concat(o):this.scope;return new ya(this.registry,this._isConstant,u,r||null,f,this.errors)}error(t,...r){const o=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new dt(o,t))}checkSubtype(t,r){const o=ga(t,r);return o&&this.error(o),o}}class li{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let f=1;f<t.length-1;f+=2){const m=t[f];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",f);const _=r.parse(t[f+1],f+1);if(!_)return null;o.push([m,_])}const u=r.parse(t[t.length-1],t.length-1,r.expectedType,o);return u?new li(o,u):null}outputDefined(){return this.result.outputDefined()}}class Ht{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=t[1];return r.scope.has(o)?new Ht(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Ya{constructor(t,r,o){this.type=t,this.index=r,this.input=o}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Ge),u=r.parse(t[2],2,Vr(r.expectedType||wt));return o&&u?new Ya(u.type.itemType,o,u):null}evaluate(t){const r=this.index.evaluate(t),o=this.input.evaluate(t);if(r<0)throw new Hi(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new Hi(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new Hi(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class hi{constructor(t,r){this.type=Mt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,wt),u=r.parse(t[2],2,wt);return o&&u?Gc(o.type,[Mt,yt,Ge,rt,wt])?new hi(o,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${qi(o.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!Ro(r,["boolean","string","number","null"]))throw new Hi(`Expected first argument to be of type boolean, string, number or null, but found ${qi($i(r))} instead.`);if(!Ro(o,["string","array"]))throw new Hi(`Expected second argument to be of type array or string, but found ${qi($i(o))} instead.`);return o.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Mi{constructor(t,r,o){this.type=Ge,this.needle=t,this.haystack=r,this.fromIndex=o}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,wt),u=r.parse(t[2],2,wt);if(!o||!u)return null;if(!Gc(o.type,[Mt,yt,Ge,rt,wt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${qi(o.type)} instead`);if(t.length===4){const f=r.parse(t[3],3,Ge);return f?new Mi(o,u,f):null}return new Mi(o,u)}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!Ro(r,["boolean","string","number","null"]))throw new Hi(`Expected first argument to be of type boolean, string, number or null, but found ${qi($i(r))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(t)),Ro(o,["string"])){const f=o.indexOf(r,u);return f===-1?-1:[...o.slice(0,f)].length}if(Ro(o,["array"]))return o.indexOf(r,u);throw new Hi(`Expected second argument to be of type array or string, but found ${qi($i(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class pi{constructor(t,r,o,u,f,m){this.inputType=t,this.type=r,this.input=o,this.cases=u,this.outputs=f,this.otherwise=m}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let o,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const f={},m=[];for(let M=2;M<t.length-1;M+=2){let I=t[M];const E=t[M+1];Array.isArray(I)||(I=[I]);const L=r.concat(M);if(I.length===0)return L.error("Expected at least one branch label.");for(const N of I){if(typeof N!="number"&&typeof N!="string")return L.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return L.error("Numeric branch labels must be integer values.");if(o){if(L.checkSubtype(o,$i(N)))return null}else o=$i(N);if(f[String(N)]!==void 0)return L.error("Branch labels must be unique.");f[String(N)]=m.length}const j=r.parse(E,M,u);if(!j)return null;u=u||j.type,m.push(j)}const _=r.parse(t[1],1,wt);if(!_)return null;const w=r.parse(t[t.length-1],t.length-1,u);return w?_.type.kind!=="value"&&r.concat(1).checkSubtype(o,_.type)?null:new pi(o,u,_,f,m,w):null}evaluate(t){const r=this.input.evaluate(t);return($i(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Ja{constructor(t,r,o){this.type=t,this.branches=r,this.otherwise=o}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const u=[];for(let m=1;m<t.length-1;m+=2){const _=r.parse(t[m],m,Mt);if(!_)return null;const w=r.parse(t[m+1],m+1,o);if(!w)return null;u.push([_,w]),o=o||w.type}const f=r.parse(t[t.length-1],t.length-1,o);if(!f)return null;if(!o)throw new Error("Can't infer output type");return new Ja(o,u,f)}evaluate(t){for(const[r,o]of this.branches)if(r.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,o]of this.branches)t(r),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Qa{constructor(t,r,o,u){this.type=t,this.input=r,this.beginIndex=o,this.endIndex=u}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,wt),u=r.parse(t[2],2,Ge);if(!o||!u)return null;if(!Gc(o.type,[Vr(wt),yt,wt]))return r.error(`Expected first argument to be of type array or string, but found ${qi(o.type)} instead`);if(t.length===4){const f=r.parse(t[3],3,Ge);return f?new Qa(o.type,o,u,f):null}return new Qa(o.type,o,u)}evaluate(t){const r=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let u;if(this.endIndex&&(u=this.endIndex.evaluate(t)),Ro(r,["string"]))return[...r].slice(o,u).join("");if(Ro(r,["array"]))return r.slice(o,u);throw new Hi(`Expected first argument to be of type array or string, but found ${qi($i(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function el(n,t){const r=n.length-1;let o,u,f=0,m=r,_=0;for(;f<=m;)if(_=Math.floor((f+m)/2),o=n[_],u=n[_+1],o<=t){if(_===r||t<u)return _;f=_+1}else{if(!(o>t))throw new Hi("Input is not a number.");m=_-1}return 0}class Vs{constructor(t,r,o){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[u,f]of o)this.labels.push(u),this.outputs.push(f)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(t[1],1,Ge);if(!o)return null;const u=[];let f=null;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);for(let m=1;m<t.length;m+=2){const _=m===1?-1/0:t[m],w=t[m+1],M=m,I=m+1;if(typeof _!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(u.length&&u[u.length-1][0]>=_)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const E=r.parse(w,I,f);if(!E)return null;f=f||E.type,u.push([_,E])}return new Vs(f,o,u)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=r[0])return o[0].evaluate(t);const f=r.length;return u>=r[f-1]?o[f-1].evaluate(t):o[el(r,u)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Gu(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Jc,Vl,Zu=function(){if(Vl)return Jc;function n(t,r,o,u){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=o,this.p2y=u}return Vl=1,Jc=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,u=0;u<8;u++){var f=this.sampleCurveX(o)-t;if(Math.abs(f)<r)return o;var m=this.sampleCurveDerivativeX(o);if(Math.abs(m)<1e-6)break;o-=f/m}var _=0,w=1;for(o=t,u=0;u<20&&(f=this.sampleCurveX(o),!(Math.abs(f-t)<r));u++)t>f?_=o:w=o,o=.5*(w-_)+_;return o},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},Jc}(),bn=Gu(Zu);class Ci{constructor(t,r,o,u,f){this.type=t,this.operator=r,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[m,_]of f)this.labels.push(m),this.outputs.push(_)}static interpolationFactor(t,r,o,u){let f=0;if(t.name==="exponential")f=to(r,t.base,o,u);else if(t.name==="linear")f=to(r,1,o,u);else if(t.name==="cubic-bezier"){const m=t.controlPoints;f=new bn(m[0],m[1],m[2],m[3]).solve(to(r,1,o,u))}return f}static parse(t,r){let[o,u,f,...m]=t;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const M=u[1];if(typeof M!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:M}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const M=u.slice(1);if(M.length!==4||M.some(I=>typeof I!="number"||I<0||I>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:M}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(f=r.parse(f,2,Ge),!f)return null;const _=[];let w=null;o==="interpolate-hcl"||o==="interpolate-lab"?w=Qt:r.expectedType&&r.expectedType.kind!=="value"&&(w=r.expectedType);for(let M=0;M<m.length;M+=2){const I=m[M],E=m[M+1],L=M+3,j=M+4;if(typeof I!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(_.length&&_[_.length-1][0]>=I)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const N=r.parse(E,j,w);if(!N)return null;w=w||N.type,_.push([I,N])}return js(w,Ge)||js(w,ui)||js(w,Qt)||js(w,Fn)||js(w,Zi)||js(w,Vr(Ge))?new Ci(w,o,u,f,_):r.error(`Type ${qi(w)} is not interpolatable.`)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=r[0])return o[0].evaluate(t);const f=r.length;if(u>=r[f-1])return o[f-1].evaluate(t);const m=el(r,u),_=Ci.interpolationFactor(this.interpolation,u,r[m],r[m+1]),w=o[m].evaluate(t),M=o[m+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Xt(w,M,_);case"color":return Kt.interpolate(w,M,_);case"padding":return nn.interpolate(w,M,_);case"variableAnchorOffsetCollection":return ur.interpolate(w,M,_);case"array":return _o(w,M,_);case"projectionDefinition":return Qn.interpolate(w,M,_)}case"interpolate-hcl":return Kt.interpolate(w,M,_,"hcl");case"interpolate-lab":return Kt.interpolate(w,M,_,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function to(n,t,r,o){const u=o-r,f=n-r;return u===0?0:t===1?f/u:(Math.pow(t,f)-1)/(Math.pow(t,u)-1)}const io={color:Kt.interpolate,number:Xt,padding:nn.interpolate,variableAnchorOffsetCollection:ur.interpolate,array:_o};class es{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let o=null;const u=r.expectedType;u&&u.kind!=="value"&&(o=u);const f=[];for(const _ of t.slice(1)){const w=r.parse(_,1+f.length,o,void 0,{typeAnnotation:"omit"});if(!w)return null;o=o||w.type,f.push(w)}if(!o)throw new Error("No output type");const m=u&&f.some(_=>ga(u,_.type));return new es(m?wt:o,f)}evaluate(t){let r,o=null,u=0;for(const f of this.args)if(u++,o=f.evaluate(t),o&&o instanceof Jn&&!o.available&&(r||(r=o.name),o=null,u===this.args.length&&(o=r)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Ii(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Ul(n,t,r,o){return o.compare(t,r)===0}function ts(n,t,r){const o=n!=="=="&&n!=="!=";return class Qg{constructor(f,m,_){this.type=Mt,this.lhs=f,this.rhs=m,this.collator=_,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const _=f[0];let w=m.parse(f[1],1,wt);if(!w)return null;if(!Ii(_,w.type))return m.concat(1).error(`"${_}" comparisons are not supported for type '${qi(w.type)}'.`);let M=m.parse(f[2],2,wt);if(!M)return null;if(!Ii(_,M.type))return m.concat(2).error(`"${_}" comparisons are not supported for type '${qi(M.type)}'.`);if(w.type.kind!==M.type.kind&&w.type.kind!=="value"&&M.type.kind!=="value")return m.error(`Cannot compare types '${qi(w.type)}' and '${qi(M.type)}'.`);o&&(w.type.kind==="value"&&M.type.kind!=="value"?w=new eo(M.type,[w]):w.type.kind!=="value"&&M.type.kind==="value"&&(M=new eo(w.type,[M])));let I=null;if(f.length===4){if(w.type.kind!=="string"&&M.type.kind!=="string"&&w.type.kind!=="value"&&M.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(I=m.parse(f[3],3,un),!I)return null}return new Qg(w,M,I)}evaluate(f){const m=this.lhs.evaluate(f),_=this.rhs.evaluate(f);if(o&&this.hasUntypedArgument){const w=$i(m),M=$i(_);if(w.kind!==M.kind||w.kind!=="string"&&w.kind!=="number")throw new Hi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${w.kind}, ${M.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const w=$i(m),M=$i(_);if(w.kind!=="string"||M.kind!=="string")return t(f,m,_)}return this.collator?r(f,m,_,this.collator.evaluate(f)):t(f,m,_)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const Qc=ts("==",function(n,t,r){return t===r},Ul),qu=ts("!=",function(n,t,r){return t!==r},function(n,t,r,o){return!Ul(0,t,r,o)}),tl=ts("<",function(n,t,r){return t<r},function(n,t,r,o){return o.compare(t,r)<0}),Gl=ts(">",function(n,t,r){return t>r},function(n,t,r,o){return o.compare(t,r)>0}),Ur=ts("<=",function(n,t,r){return t<=r},function(n,t,r,o){return o.compare(t,r)<=0}),Zl=ts(">=",function(n,t,r){return t>=r},function(n,t,r,o){return o.compare(t,r)>=0});class qn{constructor(t,r,o){this.type=un,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const u=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Mt);if(!u)return null;const f=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Mt);if(!f)return null;let m=null;return o.locale&&(m=r.parse(o.locale,1,yt),!m)?null:new qn(u,f,m)}evaluate(t){return new Ol(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Gr{constructor(t,r,o,u,f){this.type=yt,this.number=t,this.locale=r,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const o=r.parse(t[1],1,Ge);if(!o)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=r.parse(u.locale,1,yt),!f))return null;let m=null;if(u.currency&&(m=r.parse(u.currency,1,yt),!m))return null;let _=null;if(u["min-fraction-digits"]&&(_=r.parse(u["min-fraction-digits"],1,Ge),!_))return null;let w=null;return u["max-fraction-digits"]&&(w=r.parse(u["max-fraction-digits"],1,Ge),!w)?null:new Gr(o,f,m,_,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class va{constructor(t){this.type=_s,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const u=[];let f=!1;for(let m=1;m<=t.length-1;++m){const _=t[m];if(f&&typeof _=="object"&&!Array.isArray(_)){f=!1;let w=null;if(_["font-scale"]&&(w=r.parse(_["font-scale"],1,Ge),!w))return null;let M=null;if(_["text-font"]&&(M=r.parse(_["text-font"],1,Vr(yt)),!M))return null;let I=null;if(_["text-color"]&&(I=r.parse(_["text-color"],1,Qt),!I))return null;let E=null;if(_["vertical-align"]){if(typeof _["vertical-align"]=="string"&&!Kc.includes(_["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${_["vertical-align"]}' instead.`);if(E=r.parse(_["vertical-align"],1,yt),!E)return null}const L=u[u.length-1];L.scale=w,L.font=M,L.textColor=I,L.verticalAlign=E}else{const w=r.parse(t[m],1,wt);if(!w)return null;const M=w.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:w,scale:null,font:null,textColor:null,verticalAlign:null})}}return new va(u)}evaluate(t){return new tn(this.sections.map(r=>{const o=r.content.evaluate(t);return $i(o)===xn?new $s("",o,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(t):null):new $s(Ka(o),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null,r.verticalAlign?r.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor),r.verticalAlign&&t(r.verticalAlign)}outputDefined(){return!1}}class Zr{constructor(t){this.type=xn,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const o=r.parse(t[1],1,yt);return o?new Zr(o):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),o=Jn.fromString(r);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(r)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class xa{constructor(t){this.type=Ge,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=r.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${qi(o.type)} instead.`):new xa(o):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Hi(`Expected value to be of type string or array, but found ${qi($i(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Ir=8192;function rn(n,t){const r=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(r*u*Ir),Math.round(o*u*Ir)]}function jo(n,t){const r=Math.pow(2,t.z);return[(u=(n[0]/Ir+t.x)/r,360*u-180),(o=(n[1]/Ir+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Us(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function il(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function ba(n,t,r){const o=n[0]-t[0],u=n[1]-t[1],f=n[0]-r[0],m=n[1]-r[1];return o*m-f*u==0&&o*f<=0&&u*m<=0}function ql(n,t,r,o){return(u=[o[0]-r[0],o[1]-r[1]])[0]*(f=[t[0]-n[0],t[1]-n[1]])[1]-u[1]*f[0]!=0&&!(!Xu(n,t,r,o)||!Xu(r,o,n,t));var u,f}function Hu(n,t,r){for(const o of r)for(let u=0;u<o.length-1;++u)if(ql(n,t,o[u],o[u+1]))return!0;return!1}function Gs(n,t,r=!1){let o=!1;for(const _ of t)for(let w=0;w<_.length-1;w++){if(ba(n,_[w],_[w+1]))return r;(f=_[w])[1]>(u=n)[1]!=(m=_[w+1])[1]>u[1]&&u[0]<(m[0]-f[0])*(u[1]-f[1])/(m[1]-f[1])+f[0]&&(o=!o)}var u,f,m;return o}function Wu(n,t){for(const r of t)if(Gs(n,r))return!0;return!1}function wa(n,t){for(const r of n)if(!Gs(r,t))return!1;for(let r=0;r<n.length-1;++r)if(Hu(n[r],n[r+1],t))return!1;return!0}function Ta(n,t){for(const r of t)if(wa(n,r))return!0;return!1}function Xu(n,t,r,o){const u=o[0]-r[0],f=o[1]-r[1],m=(n[0]-r[0])*f-u*(n[1]-r[1]),_=(t[0]-r[0])*f-u*(t[1]-r[1]);return m>0&&_<0||m<0&&_>0}function Hl(n,t,r){const o=[];for(let u=0;u<n.length;u++){const f=[];for(let m=0;m<n[u].length;m++){const _=rn(n[u][m],r);Us(t,_),f.push(_)}o.push(f)}return o}function eu(n,t,r){const o=[];for(let u=0;u<n.length;u++){const f=Hl(n[u],t,r);o.push(f)}return o}function Wl(n,t,r,o){if(n[0]<r[0]||n[0]>r[2]){const u=.5*o;let f=n[0]-r[0]>u?-o:r[0]-n[0]>u?o:0;f===0&&(f=n[0]-r[2]>u?-o:r[2]-n[0]>u?o:0),n[0]+=f}Us(t,n)}function nl(n,t,r,o){const u=Math.pow(2,o.z)*Ir,f=[o.x*Ir,o.y*Ir],m=[];for(const _ of n)for(const w of _){const M=[w.x+f[0],w.y+f[1]];Wl(M,t,r,u),m.push(M)}return m}function Xl(n,t,r,o){const u=Math.pow(2,o.z)*Ir,f=[o.x*Ir,o.y*Ir],m=[];for(const w of n){const M=[];for(const I of w){const E=[I.x+f[0],I.y+f[1]];Us(t,E),M.push(E)}m.push(M)}if(t[2]-t[0]<=u/2){(_=t)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const w of m)for(const M of w)Wl(M,t,r,u)}var _;return m}class xs{constructor(t,r){this.type=Mt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(vs(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const u=[];for(const f of o.features){const{type:m,coordinates:_}=f.geometry;m==="Polygon"&&u.push(_),m==="MultiPolygon"&&u.push(..._)}if(u.length)return new xs(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new xs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new xs(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(o.type==="Polygon"){const _=Hl(o.coordinates,f,m),w=nl(r.geometry(),u,f,m);if(!il(u,f))return!1;for(const M of w)if(!Gs(M,_))return!1}if(o.type==="MultiPolygon"){const _=eu(o.coordinates,f,m),w=nl(r.geometry(),u,f,m);if(!il(u,f))return!1;for(const M of w)if(!Wu(M,_))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(o.type==="Polygon"){const _=Hl(o.coordinates,f,m),w=Xl(r.geometry(),u,f,m);if(!il(u,f))return!1;for(const M of w)if(!wa(M,_))return!1}if(o.type==="MultiPolygon"){const _=eu(o.coordinates,f,m),w=Xl(r.geometry(),u,f,m);if(!il(u,f))return!1;for(const M of w)if(!Ta(M,_))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Kl=class{constructor(n=[],t=(r,o)=>r<o?-1:r>o?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:r}=this,o=t[n];for(;n>0;){const u=n-1>>1,f=t[u];if(r(o,f)>=0)break;t[n]=f,n=u}t[n]=o}_down(n){const{data:t,compare:r}=this,o=this.length>>1,u=t[n];for(;n<o;){let f=1+(n<<1);const m=f+1;if(m<this.length&&r(t[m],t[f])<0&&(f=m),r(t[f],u)>=0)break;t[n]=t[f],n=f}t[n]=u}};function Yl(n,t,r=0,o=n.length-1,u=Jl){for(;o>r;){if(o-r>600){const w=o-r+1,M=t-r+1,I=Math.log(w),E=.5*Math.exp(2*I/3),L=.5*Math.sqrt(I*E*(w-E)/w)*(M-w/2<0?-1:1);Yl(n,t,Math.max(r,Math.floor(t-M*E/w+L)),Math.min(o,Math.floor(t+(w-M)*E/w+L)),u)}const f=n[t];let m=r,_=o;for(rl(n,r,t),u(n[o],f)>0&&rl(n,r,o);m<_;){for(rl(n,m,_),m++,_--;u(n[m],f)<0;)m++;for(;u(n[_],f)>0;)_--}u(n[r],f)===0?rl(n,r,_):(_++,rl(n,_,o)),_<=t&&(r=_+1),t<=_&&(o=_-1)}}function rl(n,t,r){const o=n[t];n[t]=n[r],n[r]=o}function Jl(n,t){return n<t?-1:n>t?1:0}function hr(n,t){if(n.length<=1)return[n];const r=[];let o,u;for(const f of n){const m=ol(f);m!==0&&(f.area=Math.abs(m),u===void 0&&(u=m<0),u===m<0?(o&&r.push(o),o=[f]):o.push(f))}if(o&&r.push(o),t>1)for(let f=0;f<r.length;f++)r[f].length<=t||(Yl(r[f],t,1,r[f].length-1,tu),r[f]=r[f].slice(0,t));return r}function tu(n,t){return t.area-n.area}function ol(n){let t=0;for(let r,o,u=0,f=n.length,m=f-1;u<f;m=u++)r=n[u],o=n[m],t+=(o.x-r.x)*(r.y+o.y);return t}const Ql=1/298.257223563,ec=Ql*(2-Ql),Ku=Math.PI/180;class iu{constructor(t){const r=6378.137*Ku*1e3,o=Math.cos(t*Ku),u=1/(1-ec*(1-o*o)),f=Math.sqrt(u);this.kx=r*f*o,this.ky=r*f*u*(1-ec)}distance(t,r){const o=this.wrap(t[0]-r[0])*this.kx,u=(t[1]-r[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(t,r){let o,u,f,m,_=1/0;for(let w=0;w<t.length-1;w++){let M=t[w][0],I=t[w][1],E=this.wrap(t[w+1][0]-M)*this.kx,L=(t[w+1][1]-I)*this.ky,j=0;E===0&&L===0||(j=(this.wrap(r[0]-M)*this.kx*E+(r[1]-I)*this.ky*L)/(E*E+L*L),j>1?(M=t[w+1][0],I=t[w+1][1]):j>0&&(M+=E/this.kx*j,I+=L/this.ky*j)),E=this.wrap(r[0]-M)*this.kx,L=(r[1]-I)*this.ky;const N=E*E+L*L;N<_&&(_=N,o=M,u=I,f=w,m=j)}return{point:[o,u],index:f,t:Math.max(0,Math.min(1,m))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function nu(n,t){return t[0]-n[0]}function sl(n){return n[1]-n[0]+1}function is(n,t){return n[1]>=n[0]&&n[1]<t}function bs(n,t){if(n[0]>n[1])return[null,null];const r=sl(n);if(t){if(r===2)return[n,null];const u=Math.floor(r/2);return[[n[0],n[0]+u],[n[0]+u,n[1]]]}if(r===1)return[n,null];const o=Math.floor(r/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}function ru(n,t){if(!is(t,n.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)Us(r,n[o]);return r}function tc(n){const t=[1/0,1/0,-1/0,-1/0];for(const r of n)for(const o of r)Us(t,o);return t}function ic(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function nc(n,t,r){if(!ic(n)||!ic(t))return NaN;let o=0,u=0;return n[2]<t[0]&&(o=t[0]-n[2]),n[0]>t[2]&&(o=n[0]-t[2]),n[1]>t[3]&&(u=n[1]-t[3]),n[3]<t[1]&&(u=t[1]-n[3]),r.distance([0,0],[o,u])}function Ar(n,t,r){const o=r.pointOnLine(t,n);return r.distance(n,o.point)}function Sa(n,t,r,o,u){const f=Math.min(Ar(n,[r,o],u),Ar(t,[r,o],u)),m=Math.min(Ar(r,[n,t],u),Ar(o,[n,t],u));return Math.min(f,m)}function vi(n,t,r,o,u){if(!is(t,n.length)||!is(o,r.length))return 1/0;let f=1/0;for(let m=t[0];m<t[1];++m){const _=n[m],w=n[m+1];for(let M=o[0];M<o[1];++M){const I=r[M],E=r[M+1];if(ql(_,w,I,E))return 0;f=Math.min(f,Sa(_,w,I,E,u))}}return f}function ep(n,t,r,o,u){if(!is(t,n.length)||!is(o,r.length))return NaN;let f=1/0;for(let m=t[0];m<=t[1];++m)for(let _=o[0];_<=o[1];++_)if(f=Math.min(f,u.distance(n[m],r[_])),f===0)return f;return f}function tp(n,t,r){if(Gs(n,t,!0))return 0;let o=1/0;for(const u of t){const f=u[0],m=u[u.length-1];if(f!==m&&(o=Math.min(o,Ar(n,[m,f],r)),o===0))return o;const _=r.pointOnLine(u,n);if(o=Math.min(o,r.distance(n,_.point)),o===0)return o}return o}function Pa(n,t,r,o){if(!is(t,n.length))return NaN;for(let f=t[0];f<=t[1];++f)if(Gs(n[f],r,!0))return 0;let u=1/0;for(let f=t[0];f<t[1];++f){const m=n[f],_=n[f+1];for(const w of r)for(let M=0,I=w.length,E=I-1;M<I;E=M++){const L=w[E],j=w[M];if(ql(m,_,L,j))return 0;u=Math.min(u,Sa(m,_,L,j,o))}}return u}function no(n,t){for(const r of n)for(const o of r)if(Gs(o,t,!0))return!0;return!1}function Yu(n,t,r,o=1/0){const u=tc(n),f=tc(t);if(o!==1/0&&nc(u,f,r)>=o)return o;if(il(u,f)){if(no(n,t))return 0}else if(no(t,n))return 0;let m=1/0;for(const _ of n)for(let w=0,M=_.length,I=M-1;w<M;I=w++){const E=_[I],L=_[w];for(const j of t)for(let N=0,G=j.length,J=G-1;N<G;J=N++){const oe=j[J],xe=j[N];if(ql(E,L,oe,xe))return 0;m=Math.min(m,Sa(E,L,oe,xe,r))}}return m}function Ju(n,t,r,o,u,f){if(!f)return;const m=nc(ru(o,f),u,r);m<t&&n.push([m,f,[0,0]])}function rc(n,t,r,o,u,f,m){if(!f||!m)return;const _=nc(ru(o,f),ru(u,m),r);_<t&&n.push([_,f,m])}function oc(n,t,r,o,u=1/0){let f=Math.min(o.distance(n[0],r[0][0]),u);if(f===0)return f;const m=new Kl([[0,[0,n.length-1],[0,0]]],nu),_=tc(r);for(;m.length>0;){const w=m.pop();if(w[0]>=f)continue;const M=w[1],I=t?50:100;if(sl(M)<=I){if(!is(M,n.length))return NaN;if(t){const E=Pa(n,M,r,o);if(isNaN(E)||E===0)return E;f=Math.min(f,E)}else for(let E=M[0];E<=M[1];++E){const L=tp(n[E],r,o);if(f=Math.min(f,L),f===0)return 0}}else{const E=bs(M,t);Ju(m,f,o,n,_,E[0]),Ju(m,f,o,n,_,E[1])}}return f}function sc(n,t,r,o,u,f=1/0){let m=Math.min(f,u.distance(n[0],r[0]));if(m===0)return m;const _=new Kl([[0,[0,n.length-1],[0,r.length-1]]],nu);for(;_.length>0;){const w=_.pop();if(w[0]>=m)continue;const M=w[1],I=w[2],E=t?50:100,L=o?50:100;if(sl(M)<=E&&sl(I)<=L){if(!is(M,n.length)&&is(I,r.length))return NaN;let j;if(t&&o)j=vi(n,M,r,I,u),m=Math.min(m,j);else if(t&&!o){const N=n.slice(M[0],M[1]+1);for(let G=I[0];G<=I[1];++G)if(j=Ar(r[G],N,u),m=Math.min(m,j),m===0)return m}else if(!t&&o){const N=r.slice(I[0],I[1]+1);for(let G=M[0];G<=M[1];++G)if(j=Ar(n[G],N,u),m=Math.min(m,j),m===0)return m}else j=ep(n,M,r,I,u),m=Math.min(m,j)}else{const j=bs(M,t),N=bs(I,o);rc(_,m,u,n,r,j[0],N[0]),rc(_,m,u,n,r,j[0],N[1]),rc(_,m,u,n,r,j[1],N[0]),rc(_,m,u,n,r,j[1],N[1])}}return m}function ou(n){return n.type==="MultiPolygon"?n.coordinates.map(t=>({type:"Polygon",coordinates:t})):n.type==="MultiLineString"?n.coordinates.map(t=>({type:"LineString",coordinates:t})):n.type==="MultiPoint"?n.coordinates.map(t=>({type:"Point",coordinates:t})):[n]}class ro{constructor(t,r){this.type=Ge,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(vs(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new ro(o,o.features.map(u=>ou(u.geometry)).flat());if(o.type==="Feature")return new ro(o,ou(o.geometry));if("type"in o&&"coordinates"in o)return new ro(o,ou(o))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,o){const u=r.geometry(),f=u.flat().map(w=>jo([w.x,w.y],r.canonical));if(u.length===0)return NaN;const m=new iu(f[0][1]);let _=1/0;for(const w of o){switch(w.type){case"Point":_=Math.min(_,sc(f,!1,[w.coordinates],!1,m,_));break;case"LineString":_=Math.min(_,sc(f,!1,w.coordinates,!0,m,_));break;case"Polygon":_=Math.min(_,oc(f,!1,w.coordinates,m,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,o){const u=r.geometry(),f=u.flat().map(w=>jo([w.x,w.y],r.canonical));if(u.length===0)return NaN;const m=new iu(f[0][1]);let _=1/0;for(const w of o){switch(w.type){case"Point":_=Math.min(_,sc(f,!0,[w.coordinates],!1,m,_));break;case"LineString":_=Math.min(_,sc(f,!0,w.coordinates,!0,m,_));break;case"Polygon":_=Math.min(_,oc(f,!0,w.coordinates,m,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,o){const u=r.geometry();if(u.length===0||u[0].length===0)return NaN;const f=hr(u,0).map(w=>w.map(M=>M.map(I=>jo([I.x,I.y],r.canonical)))),m=new iu(f[0][0][0][1]);let _=1/0;for(const w of o)for(const M of f){switch(w.type){case"Point":_=Math.min(_,oc([w.coordinates],!1,M,m,_));break;case"LineString":_=Math.min(_,oc(w.coordinates,!0,M,m,_));break;case"Polygon":_=Math.min(_,Yu(M,w.coordinates,m,_))}if(_===0)return _}return _}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ce={"==":Qc,"!=":qu,">":Gl,"<":tl,">=":Zl,"<=":Ur,array:eo,at:Ya,boolean:eo,case:Ja,coalesce:es,collator:qn,format:va,image:Zr,in:hi,"index-of":Mi,interpolate:Ci,"interpolate-hcl":Ci,"interpolate-lab":Ci,length:xa,let:li,literal:Fo,match:pi,number:eo,"number-format":Gr,object:eo,slice:Qa,step:Vs,string:eo,"to-boolean":Qo,"to-color":Qo,"to-number":Qo,"to-string":Qo,var:Ht,within:xs,distance:ro};class Ze{constructor(t,r,o,u){this.name=t,this.type=r,this._evaluate=o,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const o=t[0],u=Ze.definitions[o];if(!u)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,_=m.filter(([M])=>!Array.isArray(M)||M.length===t.length-1);let w=null;for(const[M,I]of _){w=new ya(r.registry,dn,r.path,null,r.scope);const E=[];let L=!1;for(let j=1;j<t.length;j++){const N=t[j],G=Array.isArray(M)?M[j-1]:M.type,J=w.parse(N,1+E.length,G);if(!J){L=!0;break}E.push(J)}if(!L)if(Array.isArray(M)&&M.length!==E.length)w.error(`Expected ${M.length} arguments, but found ${E.length} instead.`);else{for(let j=0;j<E.length;j++){const N=Array.isArray(M)?M[j]:M.type,G=E[j];w.concat(j+1).checkSubtype(N,G.type)}if(w.errors.length===0)return new Ze(o,f,I,E)}}if(_.length===1)r.errors.push(...w.errors);else{const M=(_.length?_:m).map(([E])=>{return L=E,Array.isArray(L)?`(${L.map(qi).join(", ")})`:`(${qi(L.type)}...)`;var L}).join(" | "),I=[];for(let E=1;E<t.length;E++){const L=r.parse(t[E],1+I.length);if(!L)return null;I.push(qi(L.type))}r.error(`Expected arguments of type ${M}, but found (${I.join(", ")}) instead.`)}return null}static register(t,r){Ze.definitions=r;for(const o in r)t[o]=Ze}}function $e(n,[t,r,o,u]){t=t.evaluate(n),r=r.evaluate(n),o=o.evaluate(n);const f=u?u.evaluate(n):1,m=Nl(t,r,o,f);if(m)throw new Hi(m);return new Kt(t/255,r/255,o/255,f,!1)}function At(n,t){return n in t}function Vt(n,t){const r=t[n];return r===void 0?null:r}function ci(n){return{type:n}}function dn(n){if(n instanceof Ht)return dn(n.boundExpression);if(n instanceof Ze&&n.name==="error"||n instanceof qn||n instanceof xs||n instanceof ro)return!1;const t=n instanceof Qo||n instanceof eo;let r=!0;return n.eachChild(o=>{r=t?r&&dn(o):r&&o instanceof Fo}),!!r&&Ai(n)&&ac(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ai(n){if(n instanceof Ze&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof xs||n instanceof ro)return!1;let t=!0;return n.eachChild(r=>{t&&!Ai(r)&&(t=!1)}),t}function Zs(n){if(n instanceof Ze&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(r=>{t&&!Zs(r)&&(t=!1)}),t}function ac(n,t){if(n instanceof Ze&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(o=>{r&&!ac(o,t)&&(r=!1)}),r}function qr(n){return{result:"success",value:n}}function ns(n){return{result:"error",value:n}}function Ma(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function qs(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Ca(n){return!!n.expression&&n.expression.interpolated}function ai(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function xi(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function ip(n){return n}function su(n,t){const r=t.type==="color",o=n.stops&&typeof n.stops[0][0]=="object",u=o||!(o||n.property!==void 0),f=n.type||(Ca(t)?"exponential":"interval");if(r||t.type==="padding"){const I=r?Kt.parse:nn.parse;(n=pt({},n)).stops&&(n.stops=n.stops.map(E=>[E[0],I(E[1])])),n.default=I(n.default?n.default:t.default)}if(n.colorSpace&&(m=n.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var m;let _,w,M;if(f==="exponential")_=Qu;else if(f==="interval")_=np;else if(f==="categorical"){_=au,w=Object.create(null);for(const I of n.stops)w[I[0]]=I[1];M=typeof n.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);_=lc}if(o){const I={},E=[];for(let N=0;N<n.stops.length;N++){const G=n.stops[N],J=G[0].zoom;I[J]===void 0&&(I[J]={zoom:J,type:n.type,property:n.property,default:n.default,stops:[]},E.push(J)),I[J].stops.push([G[0].value,G[1]])}const L=[];for(const N of E)L.push([I[N].zoom,su(I[N],t)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:Ci.interpolationFactor.bind(void 0,j),zoomStops:L.map(N=>N[0]),evaluate:({zoom:N},G)=>Qu({stops:L,base:n.base},t,N).evaluate(N,G)}}if(u){const I=f==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Ci.interpolationFactor.bind(void 0,I),zoomStops:n.stops.map(E=>E[0]),evaluate:({zoom:E})=>_(n,t,E,w,M)}}return{kind:"source",evaluate(I,E){const L=E&&E.properties?E.properties[n.property]:void 0;return L===void 0?ws(n.default,t.default):_(n,t,L,w,M)}}}function ws(n,t,r){return n!==void 0?n:t!==void 0?t:r!==void 0?r:void 0}function au(n,t,r,o,u){return ws(typeof r===u?o[r]:void 0,n.default,t.default)}function np(n,t,r){if(ai(r)!=="number")return ws(n.default,t.default);const o=n.stops.length;if(o===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[o-1][0])return n.stops[o-1][1];const u=el(n.stops.map(f=>f[0]),r);return n.stops[u][1]}function Qu(n,t,r){const o=n.base!==void 0?n.base:1;if(ai(r)!=="number")return ws(n.default,t.default);const u=n.stops.length;if(u===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[u-1][0])return n.stops[u-1][1];const f=el(n.stops.map(I=>I[0]),r),m=function(I,E,L,j){const N=j-L,G=I-L;return N===0?0:E===1?G/N:(Math.pow(E,G)-1)/(Math.pow(E,N)-1)}(r,o,n.stops[f][0],n.stops[f+1][0]),_=n.stops[f][1],w=n.stops[f+1][1],M=io[t.type]||ip;return typeof _.evaluate=="function"?{evaluate(...I){const E=_.evaluate.apply(void 0,I),L=w.evaluate.apply(void 0,I);if(E!==void 0&&L!==void 0)return M(E,L,m,n.colorSpace)}}:M(_,w,m,n.colorSpace)}function lc(n,t,r){switch(t.type){case"color":r=Kt.parse(r);break;case"formatted":r=tn.fromString(r.toString());break;case"resolvedImage":r=Jn.fromString(r.toString());break;case"padding":r=nn.parse(r);break;default:ai(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return ws(r,n.default,t.default)}Ze.register(Ce,{error:[{kind:"error"},[yt],(n,[t])=>{throw new Hi(t.evaluate(n))}],typeof:[yt,[wt],(n,[t])=>qi($i(t.evaluate(n)))],"to-rgba":[Vr(Ge,4),[Qt],(n,[t])=>{const[r,o,u,f]=t.evaluate(n).rgb;return[255*r,255*o,255*u,f]}],rgb:[Qt,[Ge,Ge,Ge],$e],rgba:[Qt,[Ge,Ge,Ge,Ge],$e],has:{type:Mt,overloads:[[[yt],(n,[t])=>At(t.evaluate(n),n.properties())],[[yt,Lt],(n,[t,r])=>At(t.evaluate(n),r.evaluate(n))]]},get:{type:wt,overloads:[[[yt],(n,[t])=>Vt(t.evaluate(n),n.properties())],[[yt,Lt],(n,[t,r])=>Vt(t.evaluate(n),r.evaluate(n))]]},"feature-state":[wt,[yt],(n,[t])=>Vt(t.evaluate(n),n.featureState||{})],properties:[Lt,[],n=>n.properties()],"geometry-type":[yt,[],n=>n.geometryType()],id:[wt,[],n=>n.id()],zoom:[Ge,[],n=>n.globals.zoom],"heatmap-density":[Ge,[],n=>n.globals.heatmapDensity||0],"line-progress":[Ge,[],n=>n.globals.lineProgress||0],accumulated:[wt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Ge,ci(Ge),(n,t)=>{let r=0;for(const o of t)r+=o.evaluate(n);return r}],"*":[Ge,ci(Ge),(n,t)=>{let r=1;for(const o of t)r*=o.evaluate(n);return r}],"-":{type:Ge,overloads:[[[Ge,Ge],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[Ge],(n,[t])=>-t.evaluate(n)]]},"/":[Ge,[Ge,Ge],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[Ge,[Ge,Ge],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[Ge,[],()=>Math.LN2],pi:[Ge,[],()=>Math.PI],e:[Ge,[],()=>Math.E],"^":[Ge,[Ge,Ge],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[Ge,[Ge],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Ge,[Ge],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Ge,[Ge],(n,[t])=>Math.log(t.evaluate(n))],log2:[Ge,[Ge],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Ge,[Ge],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Ge,[Ge],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Ge,[Ge],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Ge,[Ge],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Ge,[Ge],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Ge,[Ge],(n,[t])=>Math.atan(t.evaluate(n))],min:[Ge,ci(Ge),(n,t)=>Math.min(...t.map(r=>r.evaluate(n)))],max:[Ge,ci(Ge),(n,t)=>Math.max(...t.map(r=>r.evaluate(n)))],abs:[Ge,[Ge],(n,[t])=>Math.abs(t.evaluate(n))],round:[Ge,[Ge],(n,[t])=>{const r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ge,[Ge],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Ge,[Ge],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Mt,[yt,wt],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[Mt,[wt],(n,[t])=>n.id()===t.value],"filter-type-==":[Mt,[yt],(n,[t])=>n.geometryType()===t.value],"filter-<":[Mt,[yt,wt],(n,[t,r])=>{const o=n.properties()[t.value],u=r.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Mt,[wt],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r<o}],"filter->":[Mt,[yt,wt],(n,[t,r])=>{const o=n.properties()[t.value],u=r.value;return typeof o==typeof u&&o>u}],"filter-id->":[Mt,[wt],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r>o}],"filter-<=":[Mt,[yt,wt],(n,[t,r])=>{const o=n.properties()[t.value],u=r.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Mt,[wt],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r<=o}],"filter->=":[Mt,[yt,wt],(n,[t,r])=>{const o=n.properties()[t.value],u=r.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Mt,[wt],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r>=o}],"filter-has":[Mt,[wt],(n,[t])=>t.value in n.properties()],"filter-has-id":[Mt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Mt,[Vr(yt)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Mt,[Vr(wt)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Mt,[yt,Vr(wt)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Mt,[yt,Vr(wt)],(n,[t,r])=>function(o,u,f,m){for(;f<=m;){const _=f+m>>1;if(u[_]===o)return!0;u[_]>o?m=_-1:f=_+1}return!1}(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Mt,overloads:[[[Mt,Mt],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[ci(Mt),(n,t)=>{for(const r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:Mt,overloads:[[[Mt,Mt],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[ci(Mt),(n,t)=>{for(const r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[Mt,[Mt],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Mt,[yt],(n,[t])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[yt,[yt],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[yt,[yt],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[yt,ci(wt),(n,t)=>t.map(r=>Ka(r.evaluate(n))).join("")],"resolved-locale":[yt,[un],(n,[t])=>t.evaluate(n).resolvedLocale()]});class yo{constructor(t,r){var o;this.expression=t,this._warningHistory={},this._evaluator=new Li,this._defaultValue=r?(o=r).type==="color"&&xi(o.default)?new Kt(0,0,0,0):o.type==="color"?Kt.parse(o.default)||null:o.type==="padding"?nn.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?ur.parse(o.default)||null:o.type==="projectionDefinition"?Qn.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,o,u,f,m){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(t,r,o,u,f,m){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new Hi(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function Hs(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Ce}function al(n,t){const r=new ya(Ce,dn,[],t?function(u){const f={color:Qt,string:yt,number:Ge,enum:yt,boolean:Mt,formatted:_s,padding:Fn,projectionDefinition:ui,resolvedImage:xn,variableAnchorOffsetCollection:Zi};return u.type==="array"?Vr(f[u.value]||wt,u.length):f[u.type]}(t):void 0),o=r.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?qr(new yo(o,t)):ns(r.errors)}class rs{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!Zs(r.expression)}evaluateWithoutErrorHandling(t,r,o,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,r,o,u,f,m)}evaluate(t,r,o,u,f,m){return this._styleExpression.evaluate(t,r,o,u,f,m)}}class ll{constructor(t,r,o,u){this.kind=t,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Zs(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(t,r,o,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,r,o,u,f,m)}evaluate(t,r,o,u,f,m){return this._styleExpression.evaluate(t,r,o,u,f,m)}interpolationFactor(t,r,o){return this.interpolationType?Ci.interpolationFactor(this.interpolationType,t,r,o):0}}function lu(n,t){const r=al(n,t);if(r.result==="error")return r;const o=r.value.expression,u=Ai(o);if(!u&&!Ma(t))return ns([new dt("","data expressions not supported")]);const f=ac(o,["zoom"]);if(!f&&!qs(t))return ns([new dt("","zoom expressions not supported")]);const m=cl(o);return m||f?m instanceof dt?ns([m]):m instanceof Ci&&!Ca(t)?ns([new dt("",'"interpolate" expressions cannot be used with this property')]):qr(m?new ll(u?"camera":"composite",r.value,m.labels,m instanceof Ci?m.interpolation:void 0):new rs(u?"constant":"source",r.value)):ns([new dt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ws{constructor(t,r){this._parameters=t,this._specification=r,pt(this,su(this._parameters,this._specification))}static deserialize(t){return new Ws(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function cl(n){let t=null;if(n instanceof li)t=cl(n.result);else if(n instanceof es){for(const r of n.args)if(t=cl(r),t)break}else(n instanceof Vs||n instanceof Ci)&&n.input instanceof Ze&&n.input.name==="zoom"&&(t=n);return t instanceof dt||n.eachChild(r=>{const o=cl(r);o instanceof dt?t=o:!t&&o?t=new dt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new dt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Xs(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!Xs(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Ks={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ys(n){if(n==null)return{filter:()=>!0,needGeometry:!1};Xs(n)||(n=cc(n));const t=al(n,Ks);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,o,u)=>t.value.evaluate(r,o,{},u),needGeometry:th(n)}}function eh(n,t){return n<t?-1:n>t?1:0}function th(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(th(n[t]))return!0;return!1}function cc(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?Js(n[1],n[2],"=="):t==="!="?hl(Js(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Js(n[1],n[2],t):t==="any"?(r=n.slice(1),["any"].concat(r.map(cc))):t==="all"?["all"].concat(n.slice(1).map(cc)):t==="none"?["all"].concat(n.slice(1).map(cc).map(hl)):t==="in"?Ia(n[1],n.slice(2)):t==="!in"?hl(Ia(n[1],n.slice(2))):t==="has"?ul(n[1]):t!=="!has"||hl(ul(n[1]));var r}function Js(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function Ia(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",n,["literal",t.sort(eh)]]:["filter-in-small",n,["literal",t]]}}function ul(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function hl(n){return["!",n]}function Aa(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let u="[";for(const f of n)u+=`${Aa(f)},`;return`${u}]`}const r=Object.keys(n).sort();let o="{";for(let u=0;u<r.length;u++)o+=`${JSON.stringify(r[u])}:${Aa(n[r[u]])},`;return`${o}}`}function cu(n){let t="";for(const r of U)t+=`/${Aa(n[r])}`;return t}function uc(n){const t=n.value;return t?[new be(n.key,t,"constants have been deprecated as of v8")]:[]}function Yt(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function fn(n){if(Array.isArray(n))return n.map(fn);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const r in n)t[r]=fn(n[r]);return t}return Yt(n)}function oo(n){const t=n.key,r=n.value,o=n.valueSpec||{},u=n.objectElementValidators||{},f=n.style,m=n.styleSpec,_=n.validateSpec;let w=[];const M=ai(r);if(M!=="object")return[new be(t,r,`object expected, ${M} found`)];for(const I in r){const E=I.split(".")[0],L=o[E]||o["*"];let j;if(u[E])j=u[E];else if(o[E])j=_;else if(u["*"])j=u["*"];else{if(!o["*"]){w.push(new be(t,r[I],`unknown property "${I}"`));continue}j=_}w=w.concat(j({key:(t&&`${t}.`)+I,value:r[I],valueSpec:L,style:f,styleSpec:m,object:r,objectKey:I,validateSpec:_},r))}for(const I in o)u[I]||o[I].required&&o[I].default===void 0&&r[I]===void 0&&w.push(new be(t,r,`missing required property "${I}"`));return w}function uu(n){const t=n.value,r=n.valueSpec,o=n.style,u=n.styleSpec,f=n.key,m=n.arrayElementValidator||n.validateSpec;if(ai(t)!=="array")return[new be(f,t,`array expected, ${ai(t)} found`)];if(r.length&&t.length!==r.length)return[new be(f,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new be(f,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let _={type:r.value,values:r.values};u.$version<7&&(_.function=r.function),ai(r.value)==="object"&&(_=r.value);let w=[];for(let M=0;M<t.length;M++)w=w.concat(m({array:t,arrayIndex:M,value:t[M],valueSpec:_,validateSpec:n.validateSpec,style:o,styleSpec:u,key:`${f}[${M}]`}));return w}function hc(n){const t=n.key,r=n.value,o=n.valueSpec;let u=ai(r);return u==="number"&&r!=r&&(u="NaN"),u!=="number"?[new be(t,r,`number expected, ${u} found`)]:"minimum"in o&&r<o.minimum?[new be(t,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new be(t,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function ih(n){const t=n.valueSpec,r=Yt(n.value.type);let o,u,f,m={};const _=r!=="categorical"&&n.value.property===void 0,w=!_,M=ai(n.value.stops)==="array"&&ai(n.value.stops[0])==="array"&&ai(n.value.stops[0][0])==="object",I=oo({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(j){if(r==="identity")return[new be(j.key,j.value,'identity function may not have a "stops" property')];let N=[];const G=j.value;return N=N.concat(uu({key:j.key,value:G,valueSpec:j.valueSpec,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:E})),ai(G)==="array"&&G.length===0&&N.push(new be(j.key,G,"array must have at least one stop")),N},default:function(j){return j.validateSpec({key:j.key,value:j.value,valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec})}}});return r==="identity"&&_&&I.push(new be(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||I.push(new be(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!Ca(n.valueSpec)&&I.push(new be(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(w&&!Ma(n.valueSpec)?I.push(new be(n.key,n.value,"property functions not supported")):_&&!qs(n.valueSpec)&&I.push(new be(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!M||n.value.property!==void 0||I.push(new be(n.key,n.value,'"property" property is required')),I;function E(j){let N=[];const G=j.value,J=j.key;if(ai(G)!=="array")return[new be(J,G,`array expected, ${ai(G)} found`)];if(G.length!==2)return[new be(J,G,`array length 2 expected, length ${G.length} found`)];if(M){if(ai(G[0])!=="object")return[new be(J,G,`object expected, ${ai(G[0])} found`)];if(G[0].zoom===void 0)return[new be(J,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new be(J,G,"object stop key must have value")];if(f&&f>Yt(G[0].zoom))return[new be(J,G[0].zoom,"stop zoom values must appear in ascending order")];Yt(G[0].zoom)!==f&&(f=Yt(G[0].zoom),u=void 0,m={}),N=N.concat(oo({key:`${J}[0]`,value:G[0],valueSpec:{zoom:{}},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:hc,value:L}}))}else N=N.concat(L({key:`${J}[0]`,value:G[0],valueSpec:{},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec},G));return Hs(fn(G[1]))?N.concat([new be(`${J}[1]`,G[1],"expressions are not allowed in function stops.")]):N.concat(j.validateSpec({key:`${J}[1]`,value:G[1],valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec}))}function L(j,N){const G=ai(j.value),J=Yt(j.value),oe=j.value!==null?j.value:N;if(o){if(G!==o)return[new be(j.key,oe,`${G} stop domain type must match previous stop domain type ${o}`)]}else o=G;if(G!=="number"&&G!=="string"&&G!=="boolean")return[new be(j.key,oe,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&r!=="categorical"){let xe=`number expected, ${G} found`;return Ma(t)&&r===void 0&&(xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new be(j.key,oe,xe)]}return r!=="categorical"||G!=="number"||isFinite(J)&&Math.floor(J)===J?r!=="categorical"&&G==="number"&&u!==void 0&&J<u?[new be(j.key,oe,"stop domain values must appear in ascending order")]:(u=J,r==="categorical"&&J in m?[new be(j.key,oe,"stop domain values must be unique")]:(m[J]=!0,[])):[new be(j.key,oe,`integer expected, found ${J}`)]}}function Ts(n){const t=(n.expressionContext==="property"?lu:al)(fn(n.value),n.valueSpec);if(t.result==="error")return t.value.map(o=>new be(`${n.key}${o.key}`,n.value,o.message));const r=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new be(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Zs(r))return[new be(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Zs(r))return[new be(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!ac(r,["zoom","feature-state"]))return[new be(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Ai(r))return[new be(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function No(n){const t=n.key,r=n.value,o=n.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(Yt(r))===-1&&u.push(new be(t,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(Yt(r))===-1&&u.push(new be(t,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function Ea(n){return Xs(fn(n.value))?Ts(pt({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):$o(n)}function $o(n){const t=n.value,r=n.key;if(ai(t)!=="array")return[new be(r,t,`array expected, ${ai(t)} found`)];const o=n.styleSpec;let u,f=[];if(t.length<1)return[new be(r,t,"filter array must have at least 1 element")];switch(f=f.concat(No({key:`${r}[0]`,value:t[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),Yt(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Yt(t[1])==="$type"&&f.push(new be(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&f.push(new be(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=ai(t[1]),u!=="string"&&f.push(new be(`${r}[1]`,t[1],`string expected, ${u} found`)));for(let m=2;m<t.length;m++)u=ai(t[m]),Yt(t[1])==="$type"?f=f.concat(No({key:`${r}[${m}]`,value:t[m],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&f.push(new be(`${r}[${m}]`,t[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<t.length;m++)f=f.concat($o({key:`${r}[${m}]`,value:t[m],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=ai(t[1]),t.length!==2?f.push(new be(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&f.push(new be(`${r}[1]`,t[1],`string expected, ${u} found`))}return f}function ka(n,t){const r=n.key,o=n.validateSpec,u=n.style,f=n.styleSpec,m=n.value,_=n.objectKey,w=f[`${t}_${n.layerType}`];if(!w)return[];const M=_.match(/^(.*)-transition$/);if(t==="paint"&&M&&w[M[1]]&&w[M[1]].transition)return o({key:r,value:m,valueSpec:f.transition,style:u,styleSpec:f});const I=n.valueSpec||w[_];if(!I)return[new be(r,m,`unknown property "${_}"`)];let E;if(ai(m)==="string"&&Ma(I)&&!I.tokens&&(E=/^{([^}]+)}$/.exec(m)))return[new be(r,m,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(E[1])} }\`.`)];const L=[];return n.layerType==="symbol"&&(_==="text-field"&&u&&!u.glyphs&&L.push(new be(r,m,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&xi(fn(m))&&Yt(m.type)==="identity"&&L.push(new be(r,m,'"text-font" does not support identity functions'))),L.concat(o({key:n.key,value:m,valueSpec:I,style:u,styleSpec:f,expressionContext:"property",propertyType:t,propertyKey:_}))}function Qs(n){return ka(n,"paint")}function za(n){return ka(n,"layout")}function ea(n){let t=[];const r=n.value,o=n.key,u=n.style,f=n.styleSpec;r.type||r.ref||t.push(new be(o,r,'either "type" or "ref" is required'));let m=Yt(r.type);const _=Yt(r.ref);if(r.id){const w=Yt(r.id);for(let M=0;M<n.arrayIndex;M++){const I=u.layers[M];Yt(I.id)===w&&t.push(new be(o,r.id,`duplicate layer id "${r.id}", previously used at line ${I.id.__line__}`))}}if("ref"in r){let w;["type","source","source-layer","filter","layout"].forEach(M=>{M in r&&t.push(new be(o,r[M],`"${M}" is prohibited for ref layers`))}),u.layers.forEach(M=>{Yt(M.id)===_&&(w=M)}),w?w.ref?t.push(new be(o,r.ref,"ref cannot reference another ref layer")):m=Yt(w.type):t.push(new be(o,r.ref,`ref layer "${_}" not found`))}else if(m!=="background")if(r.source){const w=u.sources&&u.sources[r.source],M=w&&Yt(w.type);w?M==="vector"&&m==="raster"?t.push(new be(o,r.source,`layer "${r.id}" requires a raster source`)):M!=="raster-dem"&&m==="hillshade"?t.push(new be(o,r.source,`layer "${r.id}" requires a raster-dem source`)):M==="raster"&&m!=="raster"?t.push(new be(o,r.source,`layer "${r.id}" requires a vector source`)):M!=="vector"||r["source-layer"]?M==="raster-dem"&&m!=="hillshade"?t.push(new be(o,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!r.paint||!r.paint["line-gradient"]||M==="geojson"&&w.lineMetrics||t.push(new be(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new be(o,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new be(o,r.source,`source "${r.source}" not found`))}else t.push(new be(o,r,'missing required property "source"'));return t=t.concat(oo({key:o,value:r,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${o}.type`,value:r.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:Ea,layout:w=>oo({layer:r,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":M=>za(pt({layerType:m},M))}}),paint:w=>oo({layer:r,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":M=>Qs(pt({layerType:m},M))}})}})),t}function Ss(n){const t=n.value,r=n.key,o=ai(t);return o!=="string"?[new be(r,t,`string expected, ${o} found`)]:[]}const hu={promoteId:function({key:n,value:t}){if(ai(t)==="string")return Ss({key:n,value:t});{const r=[];for(const o in t)r.push(...Ss({key:`${n}.${o}`,value:t[o]}));return r}}};function Da(n){const t=n.value,r=n.key,o=n.styleSpec,u=n.style,f=n.validateSpec;if(!t.type)return[new be(r,t,'"type" is required')];const m=Yt(t.type);let _;switch(m){case"vector":case"raster":return _=oo({key:r,value:t,valueSpec:o[`source_${m.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:hu,validateSpec:f}),_;case"raster-dem":return _=function(w){var M;const I=(M=w.sourceName)!==null&&M!==void 0?M:"",E=w.value,L=w.styleSpec,j=L.source_raster_dem,N=w.style;let G=[];const J=ai(E);if(E===void 0)return G;if(J!=="object")return G.push(new be("source_raster_dem",E,`object expected, ${J} found`)),G;const oe=Yt(E.encoding)==="custom",xe=["redFactor","greenFactor","blueFactor","baseShift"],le=w.value.encoding?`"${w.value.encoding}"`:"Default";for(const O in E)!oe&&xe.includes(O)?G.push(new be(O,E[O],`In "${I}": "${O}" is only valid when "encoding" is set to "custom". ${le} encoding found`)):j[O]?G=G.concat(w.validateSpec({key:O,value:E[O],valueSpec:j[O],validateSpec:w.validateSpec,style:N,styleSpec:L})):G.push(new be(O,E[O],`unknown property "${O}"`));return G}({sourceName:r,value:t,style:n.style,styleSpec:o,validateSpec:f}),_;case"geojson":if(_=oo({key:r,value:t,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:f,objectElementValidators:hu}),t.cluster)for(const w in t.clusterProperties){const[M,I]=t.clusterProperties[w],E=typeof M=="string"?[M,["accumulated"],["get",w]]:M;_.push(...Ts({key:`${r}.${w}.map`,value:I,validateSpec:f,expressionContext:"cluster-map"})),_.push(...Ts({key:`${r}.${w}.reduce`,value:E,validateSpec:f,expressionContext:"cluster-reduce"}))}return _;case"video":return oo({key:r,value:t,valueSpec:o.source_video,style:u,validateSpec:f,styleSpec:o});case"image":return oo({key:r,value:t,valueSpec:o.source_image,style:u,validateSpec:f,styleSpec:o});case"canvas":return[new be(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return No({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,validateSpec:f,styleSpec:o})}}function nh(n){const t=n.value,r=n.styleSpec,o=r.light,u=n.style;let f=[];const m=ai(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new be("light",t,`object expected, ${m} found`)]),f;for(const _ in t){const w=_.match(/^(.*)-transition$/);f=f.concat(w&&o[w[1]]&&o[w[1]].transition?n.validateSpec({key:_,value:t[_],valueSpec:r.transition,validateSpec:n.validateSpec,style:u,styleSpec:r}):o[_]?n.validateSpec({key:_,value:t[_],valueSpec:o[_],validateSpec:n.validateSpec,style:u,styleSpec:r}):[new be(_,t[_],`unknown property "${_}"`)])}return f}function rh(n){const t=n.value,r=n.styleSpec,o=r.sky,u=n.style,f=ai(t);if(t===void 0)return[];if(f!=="object")return[new be("sky",t,`object expected, ${f} found`)];let m=[];for(const _ in t)m=m.concat(o[_]?n.validateSpec({key:_,value:t[_],valueSpec:o[_],style:u,styleSpec:r}):[new be(_,t[_],`unknown property "${_}"`)]);return m}function pl(n){const t=n.value,r=n.styleSpec,o=r.terrain,u=n.style;let f=[];const m=ai(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new be("terrain",t,`object expected, ${m} found`)]),f;for(const _ in t)f=f.concat(o[_]?n.validateSpec({key:_,value:t[_],valueSpec:o[_],validateSpec:n.validateSpec,style:u,styleSpec:r}):[new be(_,t[_],`unknown property "${_}"`)]);return f}function Ra(n){let t=[];const r=n.value,o=n.key;if(Array.isArray(r)){const u=[],f=[];for(const m in r)r[m].id&&u.includes(r[m].id)&&t.push(new be(o,r,`all the sprites' ids must be unique, but ${r[m].id} is duplicated`)),u.push(r[m].id),r[m].url&&f.includes(r[m].url)&&t.push(new be(o,r,`all the sprites' URLs must be unique, but ${r[m].url} is duplicated`)),f.push(r[m].url),t=t.concat(oo({key:`${o}[${m}]`,value:r[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return Ss({key:o,value:r})}const pu={"*":()=>[],array:uu,boolean:function(n){const t=n.value,r=n.key,o=ai(t);return o!=="boolean"?[new be(r,t,`boolean expected, ${o} found`)]:[]},number:hc,color:function(n){const t=n.key,r=n.value,o=ai(r);return o!=="string"?[new be(t,r,`color expected, ${o} found`)]:Kt.parse(String(r))?[]:[new be(t,r,`color expected, "${r}" found`)]},constants:uc,enum:No,filter:Ea,function:ih,layer:ea,object:oo,source:Da,light:nh,sky:rh,terrain:pl,projection:function(n){const t=n.value,r=n.styleSpec,o=r.projection,u=n.style,f=ai(t);if(t===void 0)return[];if(f!=="object")return[new be("projection",t,`object expected, ${f} found`)];let m=[];for(const _ in t)m=m.concat(o[_]?n.validateSpec({key:_,value:t[_],valueSpec:o[_],style:u,styleSpec:r}):[new be(_,t[_],`unknown property "${_}"`)]);return m},projectionDefinition:function(n){const t=n.key;let r=n.value;r=r instanceof String?r.valueOf():r;const o=ai(r);return o!=="array"||function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"}(r)||function(u){return!!["interpolate","step","literal"].includes(u[0])}(r)?["array","string"].includes(o)?[]:[new be(t,r,`projection expected, invalid type "${o}" found`)]:[new be(t,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:Ss,formatted:function(n){return Ss(n).length===0?[]:Ts(n)},resolvedImage:function(n){return Ss(n).length===0?[]:Ts(n)},padding:function(n){const t=n.key,r=n.value;if(ai(r)==="array"){if(r.length<1||r.length>4)return[new be(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let u=[];for(let f=0;f<r.length;f++)u=u.concat(n.validateSpec({key:`${t}[${f}]`,value:r[f],validateSpec:n.validateSpec,valueSpec:o}));return u}return hc({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,r=n.value,o=ai(r),u=n.styleSpec;if(o!=="array"||r.length<1||r.length%2!=0)return[new be(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let m=0;m<r.length;m+=2)f=f.concat(No({key:`${t}[${m}]`,value:r[m],valueSpec:u.layout_symbol["text-anchor"]})),f=f.concat(uu({key:`${t}[${m+1}]`,value:r[m+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:u}));return f},sprite:Ra};function X(n){const t=n.value,r=n.valueSpec,o=n.styleSpec;return n.validateSpec=X,r.expression&&xi(Yt(t))?ih(n):r.expression&&Hs(fn(t))?Ts(n):r.type&&pu[r.type]?pu[r.type](n):oo(pt({},n,{valueSpec:r.type?o[r.type]:r}))}function vo(n){const t=n.value,r=n.key,o=Ss(n);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new be(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new be(r,t,'"glyphs" url must include a "{range}" token'))),o}function Hn(n,t=Q){let r=[];return r=r.concat(X({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:X,objectElementValidators:{glyphs:vo,"*":()=>[]}})),n.constants&&(r=r.concat(uc({key:"constants",value:n.constants,style:n,styleSpec:t,validateSpec:X}))),ti(r)}function _i(n){return function(t){return n({...t,validateSpec:X})}}function ti(n){return[].concat(n).sort((t,r)=>t.line-r.line)}function xo(n){return function(...t){return ti(n.apply(this,t))}}Hn.source=xo(_i(Da)),Hn.sprite=xo(_i(Ra)),Hn.glyphs=xo(_i(vo)),Hn.light=xo(_i(nh)),Hn.sky=xo(_i(rh)),Hn.terrain=xo(_i(pl)),Hn.layer=xo(_i(ea)),Hn.filter=xo(_i(Ea)),Hn.paintProperty=xo(_i(Qs)),Hn.layoutProperty=xo(_i(za));const La=Hn,rp=La.light,bo=La.sky,oh=La.paintProperty,du=La.layoutProperty;function sh(n,t){let r=!1;if(t&&t.length)for(const o of t)n.fire(new Do(new Error(o.message))),r=!0;return r}class ta{constructor(t,r,o){const u=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(r=m[1])+2*(o=m[2]);for(let w=0;w<this.d*this.d;w++){const M=m[3+w],I=m[3+w+1];u.push(M===I?null:m.subarray(M,I))}const _=m[3+u.length+1];this.keys=m.subarray(m[3+u.length],_),this.bboxes=m.subarray(_),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let m=0;m<this.d*this.d;m++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=o,this.scale=r/t,this.uid=0;const f=o/r*t;this.min=-f,this.max=t+f}insert(t,r,o,u,f){this._forEachCell(r,o,u,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,o,u,f,m){this.cells[f].push(m)}query(t,r,o,u,f){const m=this.min,_=this.max;if(t<=m&&r<=m&&_<=o&&_<=u&&!f)return Array.prototype.slice.call(this.keys);{const w=[];return this._forEachCell(t,r,o,u,this._queryCell,w,{},f),w}}_queryCell(t,r,o,u,f,m,_,w){const M=this.cells[f];if(M!==null){const I=this.keys,E=this.bboxes;for(let L=0;L<M.length;L++){const j=M[L];if(_[j]===void 0){const N=4*j;(w?w(E[N+0],E[N+1],E[N+2],E[N+3]):t<=E[N+2]&&r<=E[N+3]&&o>=E[N+0]&&u>=E[N+1])?(_[j]=!0,m.push(I[j])):_[j]=!1}}}}_forEachCell(t,r,o,u,f,m,_,w){const M=this._convertToCellCoord(t),I=this._convertToCellCoord(r),E=this._convertToCellCoord(o),L=this._convertToCellCoord(u);for(let j=M;j<=E;j++)for(let N=I;N<=L;N++){const G=this.d*N+j;if((!w||w(this._convertFromCellCoord(j),this._convertFromCellCoord(N),this._convertFromCellCoord(j+1),this._convertFromCellCoord(N+1)))&&f.call(this,t,r,o,u,G,m,_,w))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let o=0;for(let m=0;m<this.cells.length;m++)o+=this.cells[m].length;const u=new Int32Array(r+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let f=r;for(let m=0;m<t.length;m++){const _=t[m];u[3+m]=f,u.set(_,f),f+=_.length}return u[3+t.length]=f,u.set(this.keys,f),f+=this.keys.length,u[3+t.length+1]=f,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer}static serialize(t,r){const o=t.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(t){return new ta(t.buffer)}}const os={};function xt(n,t,r={}){if(os[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),os[n]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}xt("Object",Object),xt("TransferableGridIndex",ta),xt("Color",Kt),xt("Error",Error),xt("AJAXError",$r),xt("ResolvedImage",Jn),xt("StylePropertyFunction",Ws),xt("StyleExpression",yo,{omit:["_evaluator"]}),xt("ZoomDependentExpression",ll),xt("ZoomConstantExpression",rs),xt("CompoundExpression",Ze,{omit:["_evaluate"]});for(const n in Ce)Ce[n]._classRegistryKey||xt(`Expression_${n}`,Ce[n]);function ah(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function ia(n){return n.$name||n.constructor._classRegistryKey}function lh(n){return!function(t){if(t===null||typeof t!="object")return!1;const r=ia(t);return!(!r||r==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||ah(n)||Sr(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function dl(n,t){if(lh(n))return(ah(n)||Sr(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const f=[];for(const m of n)f.push(dl(m,t));return f}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const r=ia(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!os[r])throw new Error(`${r} is not registered.`);const{klass:o}=os[r],u=o.serialize?o.serialize(n,t):{};if(o.serialize){if(t&&u===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in n){if(!n.hasOwnProperty(f)||os[r].omit.indexOf(f)>=0)continue;const m=n[f];u[f]=os[r].shallow.indexOf(f)>=0?m:dl(m,t)}n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(u.$name=r),u}function Ps(n){if(lh(n))return n;if(Array.isArray(n))return n.map(Ps);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=ia(n)||"Object";if(!os[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=os[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);const o=Object.create(r.prototype);for(const u of Object.keys(n)){if(u==="$name")continue;const f=n[u];o[u]=os[t].shallow.indexOf(u)>=0?f:Ps(f)}return o}class Vo{constructor(){this.first=!0}update(t,r){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const ri={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Ba(n){for(const t of n)if(fc(t.charCodeAt(0)))return!0;return!1}function ch(n){for(const t of n)if(!Ms(t.charCodeAt(0)))return!1;return!0}function pc(n){const t=n.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const uh=pc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ms(n){return!uh.test(String.fromCodePoint(n))}const dc=pc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function fc(n){return!(n!==746&&n!==747&&(n<4352||!(ri["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||ri["CJK Compatibility"](n)||ri["CJK Strokes"](n)||!(!ri["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||ri["Enclosed CJK Letters and Months"](n)||ri["Ideographic Description Characters"](n)||ri.Kanbun(n)||ri.Katakana(n)&&n!==12540||!(!ri["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!ri["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||ri["Vertical Forms"](n)||ri["Yijing Hexagram Symbols"](n)||/\p{sc=Cans}/u.test(String.fromCodePoint(n))||/\p{sc=Hang}/u.test(String.fromCodePoint(n))||dc.test(String.fromCodePoint(n)))))}function so(n){return!(fc(n)||function(t){return!!(ri["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||ri["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||ri["Letterlike Symbols"](t)||ri["Number Forms"](t)||ri["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||ri["Control Pictures"](t)&&t!==9251||ri["Optical Character Recognition"](t)||ri["Enclosed Alphanumerics"](t)||ri["Geometric Shapes"](t)||ri["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ri["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ri["CJK Symbols and Punctuation"](t)||ri.Katakana(t)||ri["Private Use Area"](t)||ri["CJK Compatibility Forms"](t)||ri["Small Form Variants"](t)||ri["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}const hh=pc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ph(n){return hh.test(String.fromCodePoint(n))}function dh(n,t){return!(!t&&ph(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||ri.Khmer(n))}function fh(n){for(const t of n)if(ph(t.charCodeAt(0)))return!0;return!1}const ss=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(ss.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,t){return a(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const r=n.pluginURL,o=new Promise(f=>{this.loadScriptResolve=f});t(r);const u=new Promise(f=>setTimeout(()=>f(),this.TIMEOUT));if(yield Promise.race([o,u]),this.isParsed()){const f={pluginStatus:"loaded",pluginURL:r};return this.setState(f),f}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)})}};class Vi{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Vo,this.transition={})}isSupportedScript(t){return function(r,o){for(const u of r)if(!dh(u.charCodeAt(0),o))return!1;return!0}(t,ss.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}class fl{constructor(t,r){this.property=t,this.value=r,this.expression=function(o,u){if(xi(o))return new Ws(o,u);if(Hs(o)){const f=lu(o,u);if(f.result==="error")throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return f.value}{let f=o;return u.type==="color"&&typeof o=="string"?f=Kt.parse(o):u.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?u.type==="variableAnchorOffsetCollection"&&Array.isArray(o)?f=ur.parse(o):u.type==="projectionDefinition"&&typeof o=="string"&&(f=Qn.parse(o)):f=nn.parse(o),{kind:"constant",evaluate:()=>f}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,o){return this.property.possiblyEvaluate(this,t,r,o)}}class mc{constructor(t){this.property=t,this.value=new fl(t,void 0)}transitioned(t,r){return new ml(this.property,this.value,r,Fi({},t.transition,this.transition),t.now)}untransitioned(){return new ml(this.property,this.value,null,{},0)}}class fu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return In(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new mc(this._values[t].property)),this._values[t].value=new fl(this._values[t].property,r===null?void 0:In(r))}getTransition(t){return In(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new mc(this._values[t].property)),this._values[t].transition=In(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o);const u=this.getTransition(r);u!==void 0&&(t[`${r}-transition`]=u)}return t}transitioned(t,r){const o=new na(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(t,r._values[u]);return o}untransitioned(){const t=new na(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class ml{constructor(t,r,o,u,f){this.property=t,this.value=r,this.begin=f+u.delay||0,this.end=this.begin+u.duration||0,t.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(t,r,o){const u=t.now||0,f=this.value.possiblyEvaluate(t,r,o),m=this.prior;if(m){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return m.possiblyEvaluate(t,r,o);{const _=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,r,o),f,Yi(_))}}return f}}class na{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,o){const u=new oa(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(t,r,o);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ra{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return In(this._values[t].value)}setValue(t,r){this._values[t]=new fl(this._values[t].property,r===null?void 0:In(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o)}return t}possiblyEvaluate(t,r,o){const u=new oa(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(t,r,o);return u}}class Uo{constructor(t,r,o){this.property=t,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,o,u){return this.property.evaluate(this.value,this.parameters,t,r,o,u)}}class oa{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Et{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,o){const u=io[this.specification.type];return u?u(t,r,o):t}}class kt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,o,u){return new Uo(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},o,u)}:t.expression,r)}interpolate(t,r,o){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Uo(this,{kind:"constant",value:void 0},t.parameters);const u=io[this.specification.type];if(u){const f=u(t.value.value,r.value.value,o);return new Uo(this,{kind:"constant",value:f},t.parameters)}return t}evaluate(t,r,o,u,f,m){return t.kind==="constant"?t.value:t.evaluate(r,o,u,f,m)}}class sa extends kt{possiblyEvaluate(t,r,o,u){if(t.value===void 0)return new Uo(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const f=t.expression.evaluate(r,null,{},o,u),m=t.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,_=this._calculate(m,m,m,r);return new Uo(this,{kind:"constant",value:_},r)}if(t.expression.kind==="camera"){const f=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Uo(this,{kind:"constant",value:f},r)}return new Uo(this,t.expression,r)}evaluate(t,r,o,u,f,m){if(t.kind==="source"){const _=t.evaluate(r,o,u,f,m);return this._calculate(_,_,_,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},o,u),t.evaluate({zoom:Math.floor(r.zoom)},o,u),t.evaluate({zoom:Math.floor(r.zoom)+1},o,u),r):t.value}_calculate(t,r,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class Go{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,u){if(t.value!==void 0){if(t.expression.kind==="constant"){const f=t.expression.evaluate(r,null,{},o,u);return this._calculate(f,f,f,r)}return this._calculate(t.expression.evaluate(new Vi(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Vi(Math.floor(r.zoom),r)),t.expression.evaluate(new Vi(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class _r{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,u){return!!t.expression.evaluate(r,null,{},o,u)}interpolate(){return!1}}class Er{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const o=t[r];o.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new fl(o,void 0),f=this.defaultTransitionablePropertyValues[r]=new mc(o);this.defaultTransitioningPropertyValues[r]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate({})}}}xt("DataDrivenProperty",kt),xt("DataConstantProperty",Et),xt("CrossFadedDataDrivenProperty",sa),xt("CrossFadedProperty",Go),xt("ColorRampProperty",_r);const mu="-transition";class wo extends En{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new ra(r.layout)),r.paint)){this._transitionablePaint=new fu(r.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new oa(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,o={}){r!=null&&this._validate(du,`layers.${this.id}.layout.${t}`,t,r,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(mu)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,o={}){if(r!=null&&this._validate(oh,`layers.${this.id}.paint.${t}`,t,r,o))return!1;if(t.endsWith(mu))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const u=this._transitionablePaint._values[t],f=u.property.specification["property-type"]==="cross-faded-data-driven",m=u.value.isDataDriven(),_=u.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const w=this._transitionablePaint._values[t].value;return w.isDataDriven()||m||f||this._handleOverridablePaintPropertyUpdate(t,_,w)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),mr(t,(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}_validate(t,r,o,u,f={}){return(!f||f.validate!==!1)&&sh(this,t.call(La,{key:r,layerType:this.type,objectKey:o,value:u,styleSpec:Q,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Uo&&Ma(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const gl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ao{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Di{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function wn(n,t=1){let r=0,o=0;return{members:n.map(u=>{const f=gl[u.type].BYTES_PER_ELEMENT,m=r=_l(r,Math.max(t,f)),_=u.components||1;return o=Math.max(o,f),r+=f*_,{name:u.name,type:u.type,components:_,offset:m}}),size:_l(r,Math.max(o,t)),alignment:t}}function _l(n,t){return Math.ceil(n/t)*t}class yl extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const u=2*t;return this.int16[u+0]=r,this.int16[u+1]=o,t}}yl.prototype.bytesPerElement=4,xt("StructArrayLayout2i4",yl);class Fa extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,o)}emplace(t,r,o,u){const f=3*t;return this.int16[f+0]=r,this.int16[f+1]=o,this.int16[f+2]=u,t}}Fa.prototype.bytesPerElement=6,xt("StructArrayLayout3i6",Fa);class On extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,o,u)}emplace(t,r,o,u,f){const m=4*t;return this.int16[m+0]=r,this.int16[m+1]=o,this.int16[m+2]=u,this.int16[m+3]=f,t}}On.prototype.bytesPerElement=8,xt("StructArrayLayout4i8",On);class vl extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,o,u,f,m)}emplace(t,r,o,u,f,m,_){const w=6*t;return this.int16[w+0]=r,this.int16[w+1]=o,this.int16[w+2]=u,this.int16[w+3]=f,this.int16[w+4]=m,this.int16[w+5]=_,t}}vl.prototype.bytesPerElement=12,xt("StructArrayLayout2i4i12",vl);class Zo extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,o,u,f,m)}emplace(t,r,o,u,f,m,_){const w=4*t,M=8*t;return this.int16[w+0]=r,this.int16[w+1]=o,this.uint8[M+4]=u,this.uint8[M+5]=f,this.uint8[M+6]=m,this.uint8[M+7]=_,t}}Zo.prototype.bytesPerElement=8,xt("StructArrayLayout2i4ub8",Zo);class yr extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const u=2*t;return this.float32[u+0]=r,this.float32[u+1]=o,t}}yr.prototype.bytesPerElement=8,xt("StructArrayLayout2f8",yr);class aa extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m,_,w,M,I){const E=this.length;return this.resize(E+1),this.emplace(E,t,r,o,u,f,m,_,w,M,I)}emplace(t,r,o,u,f,m,_,w,M,I,E){const L=10*t;return this.uint16[L+0]=r,this.uint16[L+1]=o,this.uint16[L+2]=u,this.uint16[L+3]=f,this.uint16[L+4]=m,this.uint16[L+5]=_,this.uint16[L+6]=w,this.uint16[L+7]=M,this.uint16[L+8]=I,this.uint16[L+9]=E,t}}aa.prototype.bytesPerElement=20,xt("StructArrayLayout10ui20",aa);class la extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m,_,w,M,I,E,L){const j=this.length;return this.resize(j+1),this.emplace(j,t,r,o,u,f,m,_,w,M,I,E,L)}emplace(t,r,o,u,f,m,_,w,M,I,E,L,j){const N=12*t;return this.int16[N+0]=r,this.int16[N+1]=o,this.int16[N+2]=u,this.int16[N+3]=f,this.uint16[N+4]=m,this.uint16[N+5]=_,this.uint16[N+6]=w,this.uint16[N+7]=M,this.int16[N+8]=I,this.int16[N+9]=E,this.int16[N+10]=L,this.int16[N+11]=j,t}}la.prototype.bytesPerElement=24,xt("StructArrayLayout4i4ui4i24",la);class To extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,o)}emplace(t,r,o,u){const f=3*t;return this.float32[f+0]=r,this.float32[f+1]=o,this.float32[f+2]=u,t}}To.prototype.bytesPerElement=12,xt("StructArrayLayout3f12",To);class gc extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}gc.prototype.bytesPerElement=4,xt("StructArrayLayout1ul4",gc);class kn extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m,_,w,M){const I=this.length;return this.resize(I+1),this.emplace(I,t,r,o,u,f,m,_,w,M)}emplace(t,r,o,u,f,m,_,w,M,I){const E=10*t,L=5*t;return this.int16[E+0]=r,this.int16[E+1]=o,this.int16[E+2]=u,this.int16[E+3]=f,this.int16[E+4]=m,this.int16[E+5]=_,this.uint32[L+3]=w,this.uint16[E+8]=M,this.uint16[E+9]=I,t}}kn.prototype.bytesPerElement=20,xt("StructArrayLayout6i1ul2ui20",kn);class as extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,o,u,f,m)}emplace(t,r,o,u,f,m,_){const w=6*t;return this.int16[w+0]=r,this.int16[w+1]=o,this.int16[w+2]=u,this.int16[w+3]=f,this.int16[w+4]=m,this.int16[w+5]=_,t}}as.prototype.bytesPerElement=12,xt("StructArrayLayout2i2i2i12",as);class gu extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,o,u,f)}emplace(t,r,o,u,f,m){const _=4*t,w=8*t;return this.float32[_+0]=r,this.float32[_+1]=o,this.float32[_+2]=u,this.int16[w+6]=f,this.int16[w+7]=m,t}}gu.prototype.bytesPerElement=16,xt("StructArrayLayout2f1f2i16",gu);class _c extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,o,u,f,m)}emplace(t,r,o,u,f,m,_){const w=16*t,M=4*t,I=8*t;return this.uint8[w+0]=r,this.uint8[w+1]=o,this.float32[M+1]=u,this.float32[M+2]=f,this.int16[I+6]=m,this.int16[I+7]=_,t}}_c.prototype.bytesPerElement=16,xt("StructArrayLayout2ub2f2i16",_c);class Cs extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,o)}emplace(t,r,o,u){const f=3*t;return this.uint16[f+0]=r,this.uint16[f+1]=o,this.uint16[f+2]=u,t}}Cs.prototype.bytesPerElement=6,xt("StructArrayLayout3ui6",Cs);class xl extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m,_,w,M,I,E,L,j,N,G,J,oe){const xe=this.length;return this.resize(xe+1),this.emplace(xe,t,r,o,u,f,m,_,w,M,I,E,L,j,N,G,J,oe)}emplace(t,r,o,u,f,m,_,w,M,I,E,L,j,N,G,J,oe,xe){const le=24*t,O=12*t,K=48*t;return this.int16[le+0]=r,this.int16[le+1]=o,this.uint16[le+2]=u,this.uint16[le+3]=f,this.uint32[O+2]=m,this.uint32[O+3]=_,this.uint32[O+4]=w,this.uint16[le+10]=M,this.uint16[le+11]=I,this.uint16[le+12]=E,this.float32[O+7]=L,this.float32[O+8]=j,this.uint8[K+36]=N,this.uint8[K+37]=G,this.uint8[K+38]=J,this.uint32[O+10]=oe,this.int16[le+22]=xe,t}}xl.prototype.bytesPerElement=48,xt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",xl);class _u extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m,_,w,M,I,E,L,j,N,G,J,oe,xe,le,O,K,ce,Re,Je,Fe,Be,Qe,tt){const at=this.length;return this.resize(at+1),this.emplace(at,t,r,o,u,f,m,_,w,M,I,E,L,j,N,G,J,oe,xe,le,O,K,ce,Re,Je,Fe,Be,Qe,tt)}emplace(t,r,o,u,f,m,_,w,M,I,E,L,j,N,G,J,oe,xe,le,O,K,ce,Re,Je,Fe,Be,Qe,tt,at){const Ue=32*t,St=16*t;return this.int16[Ue+0]=r,this.int16[Ue+1]=o,this.int16[Ue+2]=u,this.int16[Ue+3]=f,this.int16[Ue+4]=m,this.int16[Ue+5]=_,this.int16[Ue+6]=w,this.int16[Ue+7]=M,this.uint16[Ue+8]=I,this.uint16[Ue+9]=E,this.uint16[Ue+10]=L,this.uint16[Ue+11]=j,this.uint16[Ue+12]=N,this.uint16[Ue+13]=G,this.uint16[Ue+14]=J,this.uint16[Ue+15]=oe,this.uint16[Ue+16]=xe,this.uint16[Ue+17]=le,this.uint16[Ue+18]=O,this.uint16[Ue+19]=K,this.uint16[Ue+20]=ce,this.uint16[Ue+21]=Re,this.uint16[Ue+22]=Je,this.uint32[St+12]=Fe,this.float32[St+13]=Be,this.float32[St+14]=Qe,this.uint16[Ue+30]=tt,this.uint16[Ue+31]=at,t}}_u.prototype.bytesPerElement=64,xt("StructArrayLayout8i15ui1ul2f2ui64",_u);class ls extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}ls.prototype.bytesPerElement=4,xt("StructArrayLayout1f4",ls);class yc extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,o)}emplace(t,r,o,u){const f=3*t;return this.uint16[6*t+0]=r,this.float32[f+1]=o,this.float32[f+2]=u,t}}yc.prototype.bytesPerElement=12,xt("StructArrayLayout1ui2f12",yc);class p extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,o)}emplace(t,r,o,u){const f=4*t;return this.uint32[2*t+0]=r,this.uint16[f+2]=o,this.uint16[f+3]=u,t}}p.prototype.bytesPerElement=8,xt("StructArrayLayout1ul2ui8",p);class e extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const u=2*t;return this.uint16[u+0]=r,this.uint16[u+1]=o,t}}e.prototype.bytesPerElement=4,xt("StructArrayLayout2ui4",e);class i extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}i.prototype.bytesPerElement=2,xt("StructArrayLayout1ui2",i);class s extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,o,u)}emplace(t,r,o,u,f){const m=4*t;return this.float32[m+0]=r,this.float32[m+1]=o,this.float32[m+2]=u,this.float32[m+3]=f,t}}s.prototype.bytesPerElement=16,xt("StructArrayLayout4f16",s);class c extends ao{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new we(this.anchorPointX,this.anchorPointY)}}c.prototype.size=20;class d extends kn{get(t){return new c(this,t)}}xt("CollisionBoxArray",d);class g extends ao{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}g.prototype.size=48;class b extends xl{get(t){return new g(this,t)}}xt("PlacedSymbolArray",b);class P extends ao{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}P.prototype.size=64;class C extends _u{get(t){return new P(this,t)}}xt("SymbolInstanceArray",C);class z extends ls{getoffsetX(t){return this.float32[1*t+0]}}xt("GlyphOffsetArray",z);class R extends Fa{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}xt("SymbolLineVertexArray",R);class B extends ao{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}B.prototype.size=12;class V extends yc{get(t){return new B(this,t)}}xt("TextAnchorOffsetArray",V);class Z extends ao{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Z.prototype.size=8;class ne extends p{get(t){return new Z(this,t)}}xt("FeatureIndexArray",ne);class ie extends yl{}class re extends yl{}class se extends yl{}class ue extends vl{}class he extends Zo{}class me extends yr{}class ve extends aa{}class ye extends la{}class ze extends To{}class Le extends gc{}class Ve extends as{}class He extends _c{}class je extends Cs{}class We extends e{}const ft=wn([{name:"a_pos",components:2,type:"Int16"}],4),{members:et}=ft;class _t{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,r,o,u){const f=this.segments[this.segments.length-1];return t>_t.MAX_VERTEX_ARRAY_LENGTH&&Ji(`Max vertices per segment is ${_t.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${_t.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!f||f.vertexLength+t>_t.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u?this.createNewSegment(r,o,u):f}createNewSegment(t,r,o){const u={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(t,r,o){return this.prepareSegment(0,t,r,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,o,u){return new _t([{vertexOffset:t,primitiveOffset:r,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function Ut(n,t){return 256*(n=wr(Math.floor(n),0,255))+wr(Math.floor(t),0,255)}_t.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xt("SegmentVector",_t);const di=wn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Wi,oi,Xi,bi={exports:{}},wi={exports:{}},Ei={exports:{}},Wn=function(){if(Xi)return bi.exports;Xi=1;var n=(Wi||(Wi=1,wi.exports=function(r,o){var u,f,m,_,w,M,I,E;for(f=r.length-(u=3&r.length),m=o,w=3432918353,M=461845907,E=0;E<f;)I=255&r.charCodeAt(E)|(255&r.charCodeAt(++E))<<8|(255&r.charCodeAt(++E))<<16|(255&r.charCodeAt(++E))<<24,++E,m=27492+(65535&(_=5*(65535&(m=(m^=I=(65535&(I=(I=(65535&I)*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*M+(((I>>>16)*M&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(I=0,u){case 3:I^=(255&r.charCodeAt(E+2))<<16;case 2:I^=(255&r.charCodeAt(E+1))<<8;case 1:m^=I=(65535&(I=(I=(65535&(I^=255&r.charCodeAt(E)))*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*M+(((I>>>16)*M&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),wi.exports),t=(oi||(oi=1,Ei.exports=function(r,o){for(var u,f=r.length,m=o^f,_=0;f>=4;)u=1540483477*(65535&(u=255&r.charCodeAt(_)|(255&r.charCodeAt(++_))<<8|(255&r.charCodeAt(++_))<<16|(255&r.charCodeAt(++_))<<24))+((1540483477*(u>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++_;switch(f){case 3:m^=(255&r.charCodeAt(_+2))<<16;case 2:m^=(255&r.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),Ei.exports);return bi.exports=n,bi.exports.murmur3=n,bi.exports.murmur2=t,bi.exports}(),Ti=q(Wn);class Oi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,o,u){this.ids.push(er(t)),this.positions.push(r,o,u)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=er(t);let o=0,u=this.ids.length-1;for(;o<u;){const m=o+u>>1;this.ids[m]>=r?u=m:o=m+1}const f=[];for(;this.ids[o]===r;)f.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return f}static serialize(t,r){const o=new Float64Array(t.ids),u=new Uint32Array(t.positions);return qo(o,u,0,o.length-1),r&&r.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(t){const r=new Oi;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function er(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Ti(String(n))}function qo(n,t,r,o){for(;r<o;){const u=n[r+o>>1];let f=r-1,m=o+1;for(;;){do f++;while(n[f]<u);do m--;while(n[m]>u);if(f>=m)break;Hr(n,f,m),Hr(t,3*f,3*m),Hr(t,3*f+1,3*m+1),Hr(t,3*f+2,3*m+2)}m-r<o-m?(qo(n,t,r,m),r=m+1):(qo(n,t,m+1,o),o=m)}}function Hr(n,t,r){const o=n[t];n[t]=n[r],n[r]=o}xt("FeaturePositionMap",Oi);class kr{constructor(t,r){this.gl=t.gl,this.location=r}}class So extends kr{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Oa extends kr{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class ca extends kr{constructor(t,r){super(t,r),this.current=Kt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Is=new Float32Array(16);function Tn(n){return[Ut(255*n.r,255*n.g),Ut(255*n.b,255*n.a)]}class lo{constructor(t,r,o){this.value=t,this.uniformNames=r.map(u=>`u_${u}`),this.type=o}setUniform(t,r,o){t.set(o.constantOr(this.value))}getBinding(t,r,o){return this.type==="color"?new ca(t,r):new So(t,r)}}class jn{constructor(t,r){this.uniformNames=r.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,o,u){const f=u==="u_pattern_to"?this.patternTo:u==="u_pattern_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&t.set(f)}getBinding(t,r,o){return o.substr(0,9)==="u_pattern"?new Oa(t,r):new So(t,r)}}class zr{constructor(t,r,o,u){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,r,o,u,f){const m=this.paintVertexArray.length,_=this.expression.evaluate(new Vi(0),r,{},u,[],f);this.paintVertexArray.resize(t),this._setPaintValue(m,t,_)}updatePaintArray(t,r,o,u){const f=this.expression.evaluate({zoom:0},o,u);this._setPaintValue(t,r,f)}_setPaintValue(t,r,o){if(this.type==="color"){const u=Tn(o);for(let f=t;f<r;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=t;u<r;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ki{constructor(t,r,o,u,f,m){this.expression=t,this.uniformNames=r.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,r,o,u,f){const m=this.expression.evaluate(new Vi(this.zoom),r,{},u,[],f),_=this.expression.evaluate(new Vi(this.zoom+1),r,{},u,[],f),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,m,_)}updatePaintArray(t,r,o,u){const f=this.expression.evaluate({zoom:this.zoom},o,u),m=this.expression.evaluate({zoom:this.zoom+1},o,u);this._setPaintValue(t,r,f,m)}_setPaintValue(t,r,o,u){if(this.type==="color"){const f=Tn(o),m=Tn(u);for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,f[0],f[1],m[0],m[1])}else{for(let f=t;f<r;f++)this.paintVertexArray.emplace(f,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,u=wr(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(u)}getBinding(t,r,o){return new So(t,r)}}class ji{constructor(t,r,o,u,f,m){this.expression=t,this.type=r,this.useIntegerZoom=o,this.zoom=u,this.layerId=m,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(t,r,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(u,t,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(t,r,o,u,f){this._setPaintValues(t,r,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(t,r,o,u){if(!u||!o)return;const{min:f,mid:m,max:_}=o,w=u[f],M=u[m],I=u[_];if(w&&M&&I)for(let E=t;E<r;E++)this.zoomInPaintVertexArray.emplace(E,M.tl[0],M.tl[1],M.br[0],M.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],M.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(E,M.tl[0],M.tl[1],M.br[0],M.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],M.pixelRatio,I.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,di.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,di.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Wr{constructor(t,r,o){this.binders={},this._buffers=[];const u=[];for(const f in t.paint._values){if(!o(f))continue;const m=t.paint.get(f);if(!(m instanceof Uo&&Ma(m.property.specification)))continue;const _=op(f,t.type),w=m.value,M=m.property.specification.type,I=m.property.useIntegerZoom,E=m.property.specification["property-type"],L=E==="cross-faded"||E==="cross-faded-data-driven";if(w.kind==="constant")this.binders[f]=L?new jn(w.value,_):new lo(w.value,_,M),u.push(`/u_${f}`);else if(w.kind==="source"||L){const j=yu(f,M,"source");this.binders[f]=L?new ji(w,M,I,r,j,t.id):new zr(w,_,M,j),u.push(`/a_${f}`)}else{const j=yu(f,M,"composite");this.binders[f]=new ki(w,_,M,I,r,j),u.push(`/z_${f}`)}}this.cacheKey=u.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof zr||r instanceof ki?r.maxValue:0}populatePaintArrays(t,r,o,u,f){for(const m in this.binders){const _=this.binders[m];(_ instanceof zr||_ instanceof ki||_ instanceof ji)&&_.populatePaintArray(t,r,o,u,f)}}setConstantPatternPositions(t,r){for(const o in this.binders){const u=this.binders[o];u instanceof jn&&u.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,o,u,f){let m=!1;for(const _ in t){const w=r.getPositions(_);for(const M of w){const I=o.feature(M.index);for(const E in this.binders){const L=this.binders[E];if((L instanceof zr||L instanceof ki||L instanceof ji)&&L.expression.isStateDependent===!0){const j=u.paint.get(E);L.expression=j.value,L.updatePaintArray(M.start,M.end,I,t[_],f),m=!0}}}}return m}defines(){const t=[];for(const r in this.binders){const o=this.binders[r];(o instanceof lo||o instanceof jn)&&t.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof zr||o instanceof ki)for(let u=0;u<o.paintVertexAttributes.length;u++)t.push(o.paintVertexAttributes[u].name);else if(o instanceof ji)for(let u=0;u<di.members.length;u++)t.push(di.members[u].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof lo||o instanceof jn||o instanceof ki)for(const u of o.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof lo||f instanceof jn||f instanceof ki){for(const m of f.uniformNames)if(r[m]){const _=f.getBinding(t,r[m],m);o.push({name:m,property:u,binding:_})}}}return o}setUniforms(t,r,o,u){for(const{name:f,property:m,binding:_}of r)this.binders[m].setUniform(_,u,o.get(m),f)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(t&&o instanceof ji){const u=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof zr||o instanceof ki)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const r in this.binders){const o=this.binders[r];(o instanceof zr||o instanceof ki||o instanceof ji)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof zr||r instanceof ki||r instanceof ji)&&r.destroy()}}}class on{constructor(t,r,o=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new Wr(u,r,o);this.needsUpload=!1,this._featureMap=new Oi,this._bufferOffset=0}populatePaintArrays(t,r,o,u,f,m){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,r,u,f,m);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,o,u){for(const f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(t,this._featureMap,r,f,u)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function op(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function yu(n,t,r){const o={color:{source:yr,composite:s},number:{source:ls,composite:yr}},u=function(f){return{"line-pattern":{source:ve,composite:ve},"fill-pattern":{source:ve,composite:ve},"fill-extrusion-pattern":{source:ve,composite:ve}}[f]}(n);return u&&u[r]||o[t][r]}xt("ConstantBinder",lo),xt("CrossFadedConstantBinder",jn),xt("SourceExpressionBinder",zr),xt("CrossFadedCompositeBinder",ji),xt("CompositeExpressionBinder",ki),xt("ProgramConfiguration",Wr,{omit:["_buffers"]}),xt("ProgramConfigurationSet",on);const vc=Math.pow(2,14)-1,mh=-vc-1;function As(n){const t=jt/n.extent,r=n.loadGeometry();for(let o=0;o<r.length;o++){const u=r[o];for(let f=0;f<u.length;f++){const m=u[f],_=Math.round(m.x*t),w=Math.round(m.y*t);m.x=wr(_,mh,vc),m.y=wr(w,mh,vc),(_<m.x||_>m.x+1||w<m.y||w>m.y+1)&&Ji("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Es(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?As(n):[]}}const Sn=-32768;function Po(n,t,r,o,u){n.emplaceBack(Sn+8*t+o,Sn+8*r+u)}class xc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new re,this.indexArray=new je,this.segments=new _t,this.programConfigurations=new on(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){const u=this.layers[0],f=[];let m=null,_=!1,w=u.type==="heatmap";if(u.type==="circle"){const I=u;m=I.layout.get("circle-sort-key"),_=!m.isConstant(),w=w||I.paint.get("circle-pitch-alignment")==="map"}const M=w?r.subdivisionGranularity.circle:1;for(const{feature:I,id:E,index:L,sourceLayerIndex:j}of t){const N=this.layers[0]._featureFilter.needGeometry,G=Es(I,N);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),G,o))continue;const J=_?m.evaluate(G,{},o):void 0,oe={id:E,properties:I.properties,type:I.type,sourceLayerIndex:j,index:L,geometry:N?G.geometry:As(I),patterns:{},sortKey:J};f.push(oe)}_&&f.sort((I,E)=>I.sortKey-E.sortKey);for(const I of f){const{geometry:E,index:L,sourceLayerIndex:j}=I,N=t[L].feature;this.addFeature(I,E,L,o,M),r.featureIndex.insert(N,E,L,j,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,et),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,o,u,f=1){let m;switch(f){case 1:m=[0,7];break;case 3:m=[0,2,5,7];break;case 5:m=[0,1,3,4,6,7];break;case 7:m=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${f}; valid values are 1, 3, 5, 7.`)}const _=m.length;for(const w of r)for(const M of w){const I=M.x,E=M.y;if(I<0||I>=jt||E<0||E>=jt)continue;const L=this.segments.prepareSegment(_*_,this.layoutVertexArray,this.indexArray,t.sortKey),j=L.vertexLength;for(let N=0;N<_;N++)for(let G=0;G<_;G++)Po(this.layoutVertexArray,I,E,m[G],m[N]);for(let N=0;N<_-1;N++)for(let G=0;G<_-1;G++){const J=j+N*_+G,oe=j+(N+1)*_+G;this.indexArray.emplaceBack(J,oe+1,J+1),this.indexArray.emplaceBack(J,oe,oe+1)}L.vertexLength+=_*_,L.primitiveLength+=(_-1)*(_-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},u)}}function vu(n,t){for(let r=0;r<n.length;r++)if(Tc(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(Tc(n,t[r]))return!0;return!!gh(n,t)}function ja(n,t,r){return!!Tc(n,t)||!!_h(t,n,r)}function ks(n,t){if(n.length===1)return wc(t,n[0]);for(let r=0;r<t.length;r++){const o=t[r];for(let u=0;u<o.length;u++)if(Tc(n,o[u]))return!0}for(let r=0;r<n.length;r++)if(wc(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(gh(n,t[r]))return!0;return!1}function bc(n,t,r){if(n.length>1){if(gh(n,t))return!0;for(let o=0;o<t.length;o++)if(_h(t[o],n,r))return!0}for(let o=0;o<n.length;o++)if(_h(n[o],t,r))return!0;return!1}function gh(n,t){if(n.length===0||t.length===0)return!1;for(let r=0;r<n.length-1;r++){const o=n[r],u=n[r+1];for(let f=0;f<t.length-1;f++)if(Vf(o,u,t[f],t[f+1]))return!0}return!1}function Vf(n,t,r,o){return Ni(n,r,o)!==Ni(t,r,o)&&Ni(n,t,r)!==Ni(n,t,o)}function _h(n,t,r){const o=r*r;if(t.length===1)return n.distSqr(t[0])<o;for(let u=1;u<t.length;u++)if(bl(n,t[u-1],t[u])<o)return!0;return!1}function bl(n,t,r){const o=t.distSqr(r);if(o===0)return n.distSqr(t);const u=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/o;return n.distSqr(u<0?t:u>1?r:r.sub(t)._mult(u)._add(t))}function wc(n,t){let r,o,u,f=!1;for(let m=0;m<n.length;m++){r=n[m];for(let _=0,w=r.length-1;_<r.length;w=_++)o=r[_],u=r[w],o.y>t.y!=u.y>t.y&&t.x<(u.x-o.x)*(t.y-o.y)/(u.y-o.y)+o.x&&(f=!f)}return f}function Tc(n,t){let r=!1;for(let o=0,u=n.length-1;o<n.length;u=o++){const f=n[o],m=n[u];f.y>t.y!=m.y>t.y&&t.x<(m.x-f.x)*(t.y-f.y)/(m.y-f.y)+f.x&&(r=!r)}return r}function ud(n,t,r){const o=r[0],u=r[2];if(n.x<o.x&&t.x<o.x||n.x>u.x&&t.x>u.x||n.y<o.y&&t.y<o.y||n.y>u.y&&t.y>u.y)return!1;const f=Ni(n,t,r[0]);return f!==Ni(n,t,r[1])||f!==Ni(n,t,r[2])||f!==Ni(n,t,r[3])}function Sc(n,t,r){const o=t.paint.get(n).value;return o.kind==="constant"?o.value:r.programConfigurations.get(t.id).getMaxValue(n)}function wl(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function xu(n,t,r,o,u){if(!t[0]&&!t[1])return n;const f=we.convert(t)._mult(u);r==="viewport"&&f._rotate(-o);const m=[];for(let _=0;_<n.length;_++)m.push(n[_].sub(f));return m}let bu,yh;xt("CircleBucket",xc,{omit:["layers"]});var vh={get paint(){return yh=yh||new Er({"circle-radius":new kt(Q.paint_circle["circle-radius"]),"circle-color":new kt(Q.paint_circle["circle-color"]),"circle-blur":new kt(Q.paint_circle["circle-blur"]),"circle-opacity":new kt(Q.paint_circle["circle-opacity"]),"circle-translate":new Et(Q.paint_circle["circle-translate"]),"circle-translate-anchor":new Et(Q.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Et(Q.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Et(Q.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new kt(Q.paint_circle["circle-stroke-width"]),"circle-stroke-color":new kt(Q.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new kt(Q.paint_circle["circle-stroke-opacity"])})},get layout(){return bu=bu||new Er({"circle-sort-key":new kt(Q.layout_circle["circle-sort-key"])})}};class Uf extends wo{constructor(t){super(t,vh)}createBucket(t){return new xc(t)}queryRadius(t){const r=t;return Sc("circle-radius",this,r)+Sc("circle-stroke-width",this,r)+wl(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:u,transform:f,pixelsToTileUnits:m,pixelPosMatrix:_}){const w=xu(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-f.bearingInRadians,m),M=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o),I=this.paint.get("circle-pitch-alignment")==="map",E=I?w:function(j,N){return j.map(G=>sp(G,N))}(w,_),L=I?M*m:M;for(const j of u)for(const N of j){const G=I?N:sp(N,_);let J=L;const oe=Ot([],[N.x,N.y,0,1],_);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?J*=oe[3]/f.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(J*=f.cameraToCenterDistance/oe[3]),ja(E,G,J))return!0}return!1}}function sp(n,t){const r=Ot([],[n.x,n.y,0,1],t);return new we(r[0]/r[3],r[1]/r[3])}class wu extends xc{}let ap;xt("HeatmapBucket",wu,{omit:["layers"]});var lp={get paint(){return ap=ap||new Er({"heatmap-radius":new kt(Q.paint_heatmap["heatmap-radius"]),"heatmap-weight":new kt(Q.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Et(Q.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _r(Q.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Et(Q.paint_heatmap["heatmap-opacity"])})}};function cp(n,{width:t,height:r},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*r*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${t*r*o}`)}else u=new Uint8Array(t*r*o);return n.width=t,n.height=r,n.data=u,n}function up(n,{width:t,height:r},o){if(t===n.width&&r===n.height)return;const u=cp({},{width:t,height:r},o);cs(n,u,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,r)},o),n.width=t,n.height=r,n.data=u.data}function cs(n,t,r,o,u,f){if(u.width===0||u.height===0)return t;if(u.width>n.width||u.height>n.height||r.x>n.width-u.width||r.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||o.x>t.width-u.width||o.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=n.data,_=t.data;if(m===_)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<u.height;w++){const M=((r.y+w)*n.width+r.x)*f,I=((o.y+w)*t.width+o.x)*f;for(let E=0;E<u.width*f;E++)_[I+E]=m[M+E]}return t}class Pc{constructor(t,r){cp(this,t,1,r)}resize(t){up(this,t,1)}clone(){return new Pc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,u,f){cs(t,r,o,u,f,1)}}class co{constructor(t,r){cp(this,t,4,r)}resize(t){up(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new co({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,u,f){cs(t,r,o,u,f,4)}}function hd(n){const t={},r=n.resolution||256,o=n.clips?n.clips.length:1,u=n.image||new co({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const f=(m,_,w)=>{t[n.evaluationKey]=w;const M=n.expression.evaluate(t);u.data[m+_+0]=Math.floor(255*M.r/M.a),u.data[m+_+1]=Math.floor(255*M.g/M.a),u.data[m+_+2]=Math.floor(255*M.b/M.a),u.data[m+_+3]=Math.floor(255*M.a)};if(n.clips)for(let m=0,_=0;m<o;++m,_+=4*r)for(let w=0,M=0;w<r;w++,M+=4){const I=w/(r-1),{start:E,end:L}=n.clips[m];f(_,M,E*(1-I)+L*I)}else for(let m=0,_=0;m<r;m++,_+=4)f(0,_,m/(r-1));return u}xt("AlphaImage",Pc),xt("RGBAImage",co);const xh="big-fb";class Gf extends wo{createBucket(t){return new wu(t)}constructor(t){super(t,lp),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(xh)&&this.heatmapFbos.delete(xh)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let pd;var ua={get paint(){return pd=pd||new Er({"hillshade-illumination-direction":new Et(Q.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Et(Q.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Et(Q.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Et(Q.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Et(Q.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Et(Q.paint_hillshade["hillshade-accent-color"])})}};class hp extends wo{constructor(t){super(t,ua)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const pp=wn([{name:"a_pos",components:2,type:"Int16"}],4),{members:dp}=pp;function Mc(n,t,r){const o=r.patternDependencies;let u=!1;for(const f of t){const m=f.paint.get(`${n}-pattern`);m.isConstant()||(u=!0);const _=m.constantOr(null);_&&(u=!0,o[_.to]=!0,o[_.from]=!0)}return u}function Na(n,t,r,o,u){const f=u.patternDependencies;for(const m of t){const _=m.paint.get(`${n}-pattern`).value;if(_.kind!=="constant"){let w=_.evaluate({zoom:o-1},r,{},u.availableImages),M=_.evaluate({zoom:o},r,{},u.availableImages),I=_.evaluate({zoom:o+1},r,{},u.availableImages);w=w&&w.name?w.name:w,M=M&&M.name?M.name:M,I=I&&I.name?I.name:I,f[w]=!0,f[M]=!0,f[I]=!0,r.patterns[m.id]={min:w,mid:M,max:I}}}return r}function Nt(n,t,r,o,u){let f;if(u===function(m,_,w,M){let I=0;for(let E=_,L=w-M;E<w;E+=M)I+=(m[L]-m[E])*(m[E+1]+m[L+1]),L=E;return I}(n,t,r,o)>0)for(let m=t;m<r;m+=o)f=md(m/o|0,n[m],n[m+1],f);else for(let m=r-o;m>=t;m-=o)f=md(m/o|0,n[m],n[m+1],f);return f&&uo(f,f.next)&&(ha(f),f=f.next),f}function zs(n,t){if(!n)return n;t||(t=n);let r,o=n;do if(r=!1,o.steiner||!uo(o,o.next)&&Pn(o.prev,o,o.next)!==0)o=o.next;else{if(ha(o),o=t=o.prev,o===o.next)break;r=!0}while(r||o!==t);return t}function Tl(n,t,r,o,u,f,m){if(!n)return;!m&&f&&function(w,M,I,E){let L=w;do L.z===0&&(L.z=bh(L.x,L.y,M,I,E)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==w);L.prevZ.nextZ=null,L.prevZ=null,function(j){let N,G=1;do{let J,oe=j;j=null;let xe=null;for(N=0;oe;){N++;let le=oe,O=0;for(let ce=0;ce<G&&(O++,le=le.nextZ,le);ce++);let K=G;for(;O>0||K>0&&le;)O!==0&&(K===0||!le||oe.z<=le.z)?(J=oe,oe=oe.nextZ,O--):(J=le,le=le.nextZ,K--),xe?xe.nextZ=J:j=J,J.prevZ=xe,xe=J;oe=le}xe.nextZ=null,G*=2}while(N>1)}(L)}(n,o,u,f);let _=n;for(;n.prev!==n.next;){const w=n.prev,M=n.next;if(f?Zf(n,o,u,f):Sl(n))t.push(w.i,n.i,M.i),ha(n),n=M.next,_=M.next;else if((n=M)===_){m?m===1?Tl(n=fp(zs(n),t),t,r,o,u,f,2):m===2&&dd(n,t,r,o,u,f):Tl(zs(n),t,r,o,u,f,1);break}}}function Sl(n){const t=n.prev,r=n,o=n.next;if(Pn(t,r,o)>=0)return!1;const u=t.x,f=r.x,m=o.x,_=t.y,w=r.y,M=o.y,I=Math.min(u,f,m),E=Math.min(_,w,M),L=Math.max(u,f,m),j=Math.max(_,w,M);let N=o.next;for(;N!==t;){if(N.x>=I&&N.x<=L&&N.y>=E&&N.y<=j&&Tu(u,_,f,w,m,M,N.x,N.y)&&Pn(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function Zf(n,t,r,o){const u=n.prev,f=n,m=n.next;if(Pn(u,f,m)>=0)return!1;const _=u.x,w=f.x,M=m.x,I=u.y,E=f.y,L=m.y,j=Math.min(_,w,M),N=Math.min(I,E,L),G=Math.max(_,w,M),J=Math.max(I,E,L),oe=bh(j,N,t,r,o),xe=bh(G,J,t,r,o);let le=n.prevZ,O=n.nextZ;for(;le&&le.z>=oe&&O&&O.z<=xe;){if(le.x>=j&&le.x<=G&&le.y>=N&&le.y<=J&&le!==u&&le!==m&&Tu(_,I,w,E,M,L,le.x,le.y)&&Pn(le.prev,le,le.next)>=0||(le=le.prevZ,O.x>=j&&O.x<=G&&O.y>=N&&O.y<=J&&O!==u&&O!==m&&Tu(_,I,w,E,M,L,O.x,O.y)&&Pn(O.prev,O,O.next)>=0))return!1;O=O.nextZ}for(;le&&le.z>=oe;){if(le.x>=j&&le.x<=G&&le.y>=N&&le.y<=J&&le!==u&&le!==m&&Tu(_,I,w,E,M,L,le.x,le.y)&&Pn(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;O&&O.z<=xe;){if(O.x>=j&&O.x<=G&&O.y>=N&&O.y<=J&&O!==u&&O!==m&&Tu(_,I,w,E,M,L,O.x,O.y)&&Pn(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function fp(n,t){let r=n;do{const o=r.prev,u=r.next.next;!uo(o,u)&&Rr(o,r,r.next,u)&&Pl(o,u)&&Pl(u,o)&&(t.push(o.i,r.i,u.i),ha(r),ha(r.next),r=n=u),r=r.next}while(r!==n);return zs(r)}function dd(n,t,r,o,u,f){let m=n;do{let _=m.next.next;for(;_!==m.prev;){if(m.i!==_.i&&Xf(m,_)){let w=fd(m,_);return m=zs(m,m.next),w=zs(w,w.next),Tl(m,t,r,o,u,f,0),void Tl(w,t,r,o,u,f,0)}_=_.next}m=m.next}while(m!==n)}function Dr(n,t){let r=n.x-t.x;return r===0&&(r=n.y-t.y,r===0)&&(r=(n.next.y-n.y)/(n.next.x-n.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function qf(n,t){const r=function(u,f){let m=f;const _=u.x,w=u.y;let M,I=-1/0;if(uo(u,m))return m;do{if(uo(u,m.next))return m.next;if(w<=m.y&&w>=m.next.y&&m.next.y!==m.y){const G=m.x+(w-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(G<=_&&G>I&&(I=G,M=m.x<m.next.x?m:m.next,G===_))return M}m=m.next}while(m!==f);if(!M)return null;const E=M,L=M.x,j=M.y;let N=1/0;m=M;do{if(_>=m.x&&m.x>=L&&_!==m.x&&mp(w<j?_:I,w,L,j,w<j?I:_,w,m.x,m.y)){const G=Math.abs(w-m.y)/(_-m.x);Pl(m,u)&&(G<N||G===N&&(m.x>M.x||m.x===M.x&&Hf(M,m)))&&(M=m,N=G)}m=m.next}while(m!==E);return M}(n,t);if(!r)return t;const o=fd(r,n);return zs(o,o.next),zs(r,r.next)}function Hf(n,t){return Pn(n.prev,n,t.prev)<0&&Pn(t.next,n,n.next)<0}function bh(n,t,r,o,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Wf(n){let t=n,r=n;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==n);return r}function mp(n,t,r,o,u,f,m,_){return(u-m)*(t-_)>=(n-m)*(f-_)&&(n-m)*(o-_)>=(r-m)*(t-_)&&(r-m)*(f-_)>=(u-m)*(o-_)}function Tu(n,t,r,o,u,f,m,_){return!(n===m&&t===_)&&mp(n,t,r,o,u,f,m,_)}function Xf(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(r,o){let u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==o.i&&u.next.i!==o.i&&Rr(u,u.next,r,o))return!0;u=u.next}while(u!==r);return!1}(n,t)&&(Pl(n,t)&&Pl(t,n)&&function(r,o){let u=r,f=!1;const m=(r.x+o.x)/2,_=(r.y+o.y)/2;do u.y>_!=u.next.y>_&&u.next.y!==u.y&&m<(u.next.x-u.x)*(_-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==r);return f}(n,t)&&(Pn(n.prev,n,t.prev)||Pn(n,t.prev,t))||uo(n,t)&&Pn(n.prev,n,n.next)>0&&Pn(t.prev,t,t.next)>0)}function Pn(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function uo(n,t){return n.x===t.x&&n.y===t.y}function Rr(n,t,r,o){const u=wh(Pn(n,t,r)),f=wh(Pn(n,t,o)),m=wh(Pn(r,o,n)),_=wh(Pn(r,o,t));return u!==f&&m!==_||!(u!==0||!Cc(n,r,t))||!(f!==0||!Cc(n,o,t))||!(m!==0||!Cc(r,n,o))||!(_!==0||!Cc(r,t,o))}function Cc(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function wh(n){return n>0?1:n<0?-1:0}function Pl(n,t){return Pn(n.prev,n,n.next)<0?Pn(n,t,n.next)>=0&&Pn(n,n.prev,t)>=0:Pn(n,t,n.prev)<0||Pn(n,n.next,t)<0}function fd(n,t){const r=Th(n.i,n.x,n.y),o=Th(t.i,t.x,t.y),u=n.next,f=t.prev;return n.next=t,t.prev=n,r.next=u,u.prev=r,o.next=r,r.prev=o,f.next=o,o.prev=f,o}function md(n,t,r,o){const u=Th(n,t,r);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function ha(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Th(n,t,r){return{i:n,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Ml{constructor(t,r){if(r>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=r}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Sh{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Sh.noSubdivision=new Sh({fill:new Ml(0,0),line:new Ml(0,0),tile:new Ml(0,0),stencil:new Ml(0,0),circle:1}),xt("SubdivisionGranularityExpression",Ml),xt("SubdivisionGranularitySetting",Sh);const Ic=-32768,Su=32767;class Kf{constructor(t,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=jt/t,this._canonical=r}_getKey(t,r){return(t+=32768)<<16|(r+=32768)<<0}_vertexToIndex(t,r){if(t<-32768||r<-32768||t>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),u=0|Math.round(r),f=this._getKey(o,u);if(this._vertexDictionary.has(f))return this._vertexDictionary.get(f);const m=this._vertexBuffer.length/2;return this._vertexDictionary.set(f,m),this._vertexBuffer.push(o,u),m}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(u,f){const m=[];for(let _=0;_<f.length;_+=3){const w=f[_],M=f[_+1],I=f[_+2],E=u[2*w],L=u[2*w+1];(u[2*M]-E)*(u[2*I+1]-L)-(u[2*M+1]-L)*(u[2*I]-E)>0?(m.push(w),m.push(I),m.push(M)):(m.push(w),m.push(M),m.push(I))}return m}(this._vertexBuffer,t);const r=[],o=t.length;for(let u=0;u<o;u+=3){const f=[t[u+0],t[u+1],t[u+2]],m=[this._vertexBuffer[2*t[u+0]+0],this._vertexBuffer[2*t[u+0]+1],this._vertexBuffer[2*t[u+1]+0],this._vertexBuffer[2*t[u+1]+1],this._vertexBuffer[2*t[u+2]+0],this._vertexBuffer[2*t[u+2]+1]];let _=1/0,w=1/0,M=-1/0,I=-1/0;for(let G=0;G<3;G++){const J=m[2*G],oe=m[2*G+1];_=Math.min(_,J),M=Math.max(M,J),w=Math.min(w,oe),I=Math.max(I,oe)}if(_===M||w===I)continue;const E=Math.floor(_/this._granularityCellSize),L=Math.ceil(M/this._granularityCellSize),j=Math.floor(w/this._granularityCellSize),N=Math.ceil(I/this._granularityCellSize);if(E!==L||j!==N)for(let G=j;G<N;G++){const J=this._scanlineGenerateVertexRingForCellRow(G,m,f);Yf(this._vertexBuffer,J,r)}else r.push(...f)}return r}_scanlineGenerateVertexRingForCellRow(t,r,o){const u=t*this._granularityCellSize,f=u+this._granularityCellSize,m=[];for(let _=0;_<3;_++){const w=r[2*_],M=r[2*_+1],I=r[2*(_+1)%6],E=r[(2*(_+1)+1)%6],L=r[2*(_+2)%6],j=r[(2*(_+2)+1)%6],N=I-w,G=E-M,J=N===0,oe=G===0,xe=(u-M)/G,le=(f-M)/G,O=Math.min(xe,le),K=Math.max(xe,le);if(!oe&&(O>=1||K<=0)||oe&&(M<u||M>f)){E>=u&&E<=f&&m.push(o[(_+1)%3]);continue}!oe&&O>0&&m.push(this._vertexToIndex(w+N*O,M+G*O));const ce=w+N*Math.max(O,0),Re=w+N*Math.min(K,1);J||this._generateIntraEdgeVertices(m,w,M,I,E,ce,Re),!oe&&K<1&&m.push(this._vertexToIndex(w+N*K,M+G*K)),(oe||E>=u&&E<=f)&&m.push(o[(_+1)%3]),!oe&&(E<=u||E>=f)&&this._generateInterEdgeVertices(m,w,M,I,E,L,j,Re,u,f)}return m}_generateIntraEdgeVertices(t,r,o,u,f,m,_){const w=u-r,M=f-o,I=M===0,E=I?Math.min(r,u):Math.min(m,_),L=I?Math.max(r,u):Math.max(m,_),j=Math.floor(E/this._granularityCellSize)+1,N=Math.ceil(L/this._granularityCellSize)-1;if(I?r<u:m<_)for(let G=j;G<=N;G++){const J=G*this._granularityCellSize;t.push(this._vertexToIndex(J,o+M*(J-r)/w))}else for(let G=N;G>=j;G--){const J=G*this._granularityCellSize;t.push(this._vertexToIndex(J,o+M*(J-r)/w))}}_generateInterEdgeVertices(t,r,o,u,f,m,_,w,M,I){const E=f-o,L=m-u,j=_-f,N=(M-f)/j,G=(I-f)/j,J=Math.min(N,G),oe=Math.max(N,G),xe=u+L*J;let le=Math.floor(Math.min(xe,w)/this._granularityCellSize)+1,O=Math.ceil(Math.max(xe,w)/this._granularityCellSize)-1,K=w<xe;const ce=j===0;if(ce&&(_===M||_===I))return;if(ce||J>=1||oe<=0){const Je=o-_,Fe=m+(r-m)*Math.min((M-_)/Je,(I-_)/Je);le=Math.floor(Math.min(Fe,w)/this._granularityCellSize)+1,O=Math.ceil(Math.max(Fe,w)/this._granularityCellSize)-1,K=w<Fe}const Re=E>0?I:M;if(K)for(let Je=le;Je<=O;Je++)t.push(this._vertexToIndex(Je*this._granularityCellSize,Re));else for(let Je=O;Je>=le;Je--)t.push(this._vertexToIndex(Je*this._granularityCellSize,Re))}_generateOutline(t){const r=[];for(const o of t){const u=$a(o,this._granularity,!0),f=this._pointArrayToIndices(u),m=[];for(let _=1;_<f.length;_++)m.push(f[_-1]),m.push(f[_]);r.push(m)}return r}_handlePoles(t){let r=!1,o=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(r||o)&&this._fillPoles(t,r,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let r=0;r<t.length;r+=2){const o=t[r+1];o===Ic&&(t[r+1]=-32767),o===Su&&(t[r+1]=32766)}}_generatePoleQuad(t,r,o,u,f,m){u>f!=(m===Ic)?(t.push(r),t.push(o),t.push(this._vertexToIndex(u,m)),t.push(o),t.push(this._vertexToIndex(f,m)),t.push(this._vertexToIndex(u,m))):(t.push(o),t.push(r),t.push(this._vertexToIndex(u,m)),t.push(this._vertexToIndex(f,m)),t.push(o),t.push(this._vertexToIndex(u,m)))}_fillPoles(t,r,o){const u=this._vertexBuffer,f=jt,m=t.length;for(let _=2;_<m;_+=3){const w=t[_-2],M=t[_-1],I=t[_],E=u[2*w],L=u[2*w+1],j=u[2*M],N=u[2*M+1],G=u[2*I],J=u[2*I+1];r&&(L===0&&N===0&&this._generatePoleQuad(t,w,M,E,j,Ic),N===0&&J===0&&this._generatePoleQuad(t,M,I,j,G,Ic),J===0&&L===0&&this._generatePoleQuad(t,I,w,G,E,Ic)),o&&(L===f&&N===f&&this._generatePoleQuad(t,w,M,E,j,Su),N===f&&J===f&&this._generatePoleQuad(t,M,I,j,G,Su),J===f&&L===f&&this._generatePoleQuad(t,I,w,G,E,Su))}}_initializeVertices(t){for(let r=0;r<t.length;r+=2)this._vertexToIndex(t[r],t[r+1])}subdividePolygonInternal(t,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=function(_){const w=[],M=[];for(const I of _)if(I.length!==0){I!==_[0]&&w.push(M.length/2);for(let E=0;E<I.length;E++)M.push(I[E].x),M.push(I[E].y)}return{flattened:M,holeIndices:w}}(t);let f;this._initializeVertices(o);try{const _=function(M,I,E=2){const L=I&&I.length,j=L?I[0]*E:M.length;let N=Nt(M,0,j,E,!0);const G=[];if(!N||N.next===N.prev)return G;let J,oe,xe;if(L&&(N=function(le,O,K,ce){const Re=[];for(let Je=0,Fe=O.length;Je<Fe;Je++){const Be=Nt(le,O[Je]*ce,Je<Fe-1?O[Je+1]*ce:le.length,ce,!1);Be===Be.next&&(Be.steiner=!0),Re.push(Wf(Be))}Re.sort(Dr);for(let Je=0;Je<Re.length;Je++)K=qf(Re[Je],K);return K}(M,I,N,E)),M.length>80*E){J=1/0,oe=1/0;let le=-1/0,O=-1/0;for(let K=E;K<j;K+=E){const ce=M[K],Re=M[K+1];ce<J&&(J=ce),Re<oe&&(oe=Re),ce>le&&(le=ce),Re>O&&(O=Re)}xe=Math.max(le-J,O-oe),xe=xe!==0?32767/xe:0}return Tl(N,G,E,J,oe,xe,0),G}(o,u),w=this._convertIndices(o,_);f=this._subdivideTrianglesScanline(w)}catch(_){console.error(_)}let m=[];return r&&(m=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(f),{verticesFlattened:this._vertexBuffer,indicesTriangles:f,indicesLineList:m}}_convertIndices(t,r){const o=[];for(let u=0;u<r.length;u++)o.push(this._vertexToIndex(t[2*r[u]],t[2*r[u]+1]));return o}_pointArrayToIndices(t){const r=[];for(let o=0;o<t.length;o++){const u=t[o];r.push(this._vertexToIndex(u.x,u.y))}return r}}function gp(n,t,r,o=!0){return new Kf(r,t).subdividePolygonInternal(n,o)}function $a(n,t,r=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const o=n[0],u=n[n.length-1],f=r&&(o.x!==u.x||o.y!==u.y);if(t<2)return f?[...n,n[0]]:[...n];const m=Math.floor(jt/t),_=[];_.push(new we(n[0].x,n[0].y));const w=n.length,M=f?w:w-1;for(let I=0;I<M;I++){const E=n[I],L=I<w-1?n[I+1]:n[0],j=E.x,N=E.y,G=L.x,J=L.y,oe=j!==G,xe=N!==J;if(!oe&&!xe)continue;const le=G-j,O=J-N,K=Math.abs(le),ce=Math.abs(O);let Re=j,Je=N;for(;;){const Be=le>0?(Math.floor(Re/m)+1)*m:(Math.ceil(Re/m)-1)*m,Qe=O>0?(Math.floor(Je/m)+1)*m:(Math.ceil(Je/m)-1)*m,tt=Math.abs(Re-Be),at=Math.abs(Je-Qe),Ue=Math.abs(Re-G),St=Math.abs(Je-J),Dt=oe?tt/K:Number.POSITIVE_INFINITY,zt=xe?at/ce:Number.POSITIVE_INFINITY;if((Ue<=tt||!oe)&&(St<=at||!xe))break;if(Dt<zt&&oe||!xe){Re=Be,Je+=O*Dt;const It=new we(Re,Math.round(Je));_[_.length-1].x===It.x&&_[_.length-1].y===It.y||_.push(It)}else{Re+=le*zt,Je=Qe;const It=new we(Math.round(Re),Je);_[_.length-1].x===It.x&&_[_.length-1].y===It.y||_.push(It)}}const Fe=new we(G,J);_[_.length-1].x===Fe.x&&_[_.length-1].y===Fe.y||_.push(Fe)}return _}function Yf(n,t,r){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=n[2*t[0]];for(let w=1;w<t.length;w++){const M=n[2*t[w]];M<u&&(u=M,o=w)}const f=t.length;let m=o,_=(m+1)%f;for(;;){const w=m-1>=0?m-1:f-1,M=(_+1)%f,I=n[2*t[w]],E=n[2*t[M]],L=n[2*t[m]],j=n[2*t[m]+1],N=n[2*t[_]+1];let G=!1;if(I<E)G=!0;else if(I>E)G=!1;else{const J=N-j,oe=-(n[2*t[_]]-L),xe=j<N?1:-1;((I-L)*J+(n[2*t[w]+1]-j)*oe)*xe>((E-L)*J+(n[2*t[M]+1]-j)*oe)*xe&&(G=!0)}if(G){const J=t[w],oe=t[m],xe=t[_];J!==oe&&J!==xe&&oe!==xe&&r.push(xe,oe,J),m--,m<0&&(m=f-1)}else{const J=t[M],oe=t[m],xe=t[_];J!==oe&&J!==xe&&oe!==xe&&r.push(xe,oe,J),_++,_>=f&&(_=0)}if(w===M)break}}function Ph(n,t,r,o,u,f,m,_,w){const M=u.length/2,I=m&&_&&w;if(M<_t.MAX_VERTEX_ARRAY_LENGTH){const E=t.prepareSegment(M,r,o),L=E.vertexLength;for(let G=0;G<f.length;G+=3)o.emplaceBack(L+f[G],L+f[G+1],L+f[G+2]);let j,N;E.vertexLength+=M,E.primitiveLength+=f.length/3,I&&(N=m.prepareSegment(M,r,_),j=N.vertexLength,N.vertexLength+=M);for(let G=0;G<u.length;G+=2)n(u[G],u[G+1]);if(I)for(let G=0;G<w.length;G++){const J=w[G];for(let oe=1;oe<J.length;oe+=2)_.emplaceBack(j+J[oe-1],j+J[oe]);N.primitiveLength+=J.length/2}}else(function(E,L,j,N,G,J){const oe=[];for(let ce=0;ce<N.length/2;ce++)oe.push(-1);const xe={count:0};let le=0,O=E.getOrCreateLatestSegment(L,j),K=O.vertexLength;for(let ce=2;ce<G.length;ce+=3){const Re=G[ce-2],Je=G[ce-1],Fe=G[ce];let Be=oe[Re]<le,Qe=oe[Je]<le,tt=oe[Fe]<le;O.vertexLength+((Be?1:0)+(Qe?1:0)+(tt?1:0))>_t.MAX_VERTEX_ARRAY_LENGTH&&(O=E.createNewSegment(L,j),le=xe.count,Be=!0,Qe=!0,tt=!0,K=0);const at=Ac(oe,N,J,xe,Re,Be,O),Ue=Ac(oe,N,J,xe,Je,Qe,O),St=Ac(oe,N,J,xe,Fe,tt,O);j.emplaceBack(K+at-le,K+Ue-le,K+St-le),O.primitiveLength++}})(t,r,o,u,f,n),I&&function(E,L,j,N,G,J){const oe=[];for(let ce=0;ce<N.length/2;ce++)oe.push(-1);const xe={count:0};let le=0,O=E.getOrCreateLatestSegment(L,j),K=O.vertexLength;for(let ce=0;ce<G.length;ce++){const Re=G[ce];for(let Je=1;Je<G[ce].length;Je+=2){const Fe=Re[Je-1],Be=Re[Je];let Qe=oe[Fe]<le,tt=oe[Be]<le;O.vertexLength+((Qe?1:0)+(tt?1:0))>_t.MAX_VERTEX_ARRAY_LENGTH&&(O=E.createNewSegment(L,j),le=xe.count,Qe=!0,tt=!0,K=0);const at=Ac(oe,N,J,xe,Fe,Qe,O),Ue=Ac(oe,N,J,xe,Be,tt,O);j.emplaceBack(K+at-le,K+Ue-le),O.primitiveLength++}}}(m,r,_,u,w,n),t.forceNewSegmentOnNextPrepare(),m==null||m.forceNewSegmentOnNextPrepare()}function Ac(n,t,r,o,u,f,m){if(f){const _=o.count;return r(t[2*u],t[2*u+1]),n[u]=o.count,o.count++,m.vertexLength++,_}return n[u]}class Cl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new se,this.indexArray=new je,this.indexArray2=new We,this.programConfigurations=new on(t.layers,t.zoom),this.segments=new _t,this.segments2=new _t,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.hasPattern=Mc("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),f=!u.isConstant(),m=[];for(const{feature:_,id:w,index:M,sourceLayerIndex:I}of t){const E=this.layers[0]._featureFilter.needGeometry,L=Es(_,E);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),L,o))continue;const j=f?u.evaluate(L,{},o,r.availableImages):void 0,N={id:w,properties:_.properties,type:_.type,sourceLayerIndex:I,index:M,geometry:E?L.geometry:As(_),patterns:{},sortKey:j};m.push(N)}f&&m.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of m){const{geometry:w,index:M,sourceLayerIndex:I}=_;if(this.hasPattern){const E=Na("fill",this.layers,_,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(_,w,M,o,{},r.subdivisionGranularity);r.featureIndex.insert(t[M].feature,w,M,I,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}addFeatures(t,r,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dp),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,o,u,f,m){for(const _ of hr(r,500)){const w=gp(_,u,m.fill.getGranularityForZoomLevel(u.z)),M=this.layoutVertexArray;Ph((I,E)=>{M.emplaceBack(I,E)},this.segments,this.layoutVertexArray,this.indexArray,w.verticesFlattened,w.indicesTriangles,this.segments2,this.indexArray2,w.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,f,u)}}let Mh,_p;xt("FillBucket",Cl,{omit:["layers","patternFeatures"]});var gd={get paint(){return _p=_p||new Er({"fill-antialias":new Et(Q.paint_fill["fill-antialias"]),"fill-opacity":new kt(Q.paint_fill["fill-opacity"]),"fill-color":new kt(Q.paint_fill["fill-color"]),"fill-outline-color":new kt(Q.paint_fill["fill-outline-color"]),"fill-translate":new Et(Q.paint_fill["fill-translate"]),"fill-translate-anchor":new Et(Q.paint_fill["fill-translate-anchor"]),"fill-pattern":new sa(Q.paint_fill["fill-pattern"])})},get layout(){return Mh=Mh||new Er({"fill-sort-key":new kt(Q.layout_fill["fill-sort-key"])})}};class Ch extends wo{constructor(t){super(t,gd)}recalculate(t,r){super.recalculate(t,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Cl(t)}queryRadius(){return wl(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:r,transform:o,pixelsToTileUnits:u}){return ks(xu(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),r)}isTileClipped(){return!0}}const _d=wn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ds=wn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Il}=_d;var yp,vp,xp,yd,bp,vd,xd,Ih={};function bd(){if(vp)return yp;vp=1;var n=de();function t(u,f,m,_,w){this.properties={},this.extent=m,this.type=0,this._pbf=u,this._geometry=-1,this._keys=_,this._values=w,u.readFields(r,this,f)}function r(u,f,m){u==1?f.id=m.readVarint():u==2?function(_,w){for(var M=_.readVarint()+_.pos;_.pos<M;){var I=w._keys[_.readVarint()],E=w._values[_.readVarint()];w.properties[I]=E}}(m,f):u==3?f.type=m.readVarint():u==4&&(f._geometry=m.pos)}function o(u){for(var f,m,_=0,w=0,M=u.length,I=M-1;w<M;I=w++)_+=((m=u[I]).x-(f=u[w]).x)*(f.y+m.y);return _}return yp=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var f,m=u.readVarint()+u.pos,_=1,w=0,M=0,I=0,E=[];u.pos<m;){if(w<=0){var L=u.readVarint();_=7&L,w=L>>3}if(w--,_===1||_===2)M+=u.readSVarint(),I+=u.readSVarint(),_===1&&(f&&E.push(f),f=[]),f.push(new n(M,I));else{if(_!==7)throw new Error("unknown command "+_);f&&f.push(f[0].clone())}}return f&&E.push(f),E},t.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var f=u.readVarint()+u.pos,m=1,_=0,w=0,M=0,I=1/0,E=-1/0,L=1/0,j=-1/0;u.pos<f;){if(_<=0){var N=u.readVarint();m=7&N,_=N>>3}if(_--,m===1||m===2)(w+=u.readSVarint())<I&&(I=w),w>E&&(E=w),(M+=u.readSVarint())<L&&(L=M),M>j&&(j=M);else if(m!==7)throw new Error("unknown command "+m)}return[I,L,E,j]},t.prototype.toGeoJSON=function(u,f,m){var _,w,M=this.extent*Math.pow(2,m),I=this.extent*u,E=this.extent*f,L=this.loadGeometry(),j=t.types[this.type];function N(oe){for(var xe=0;xe<oe.length;xe++){var le=oe[xe];oe[xe]=[360*(le.x+I)/M-180,360/Math.PI*Math.atan(Math.exp((180-360*(le.y+E)/M)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(_=0;_<L.length;_++)G[_]=L[_][0];N(L=G);break;case 2:for(_=0;_<L.length;_++)N(L[_]);break;case 3:for(L=function(oe){var xe=oe.length;if(xe<=1)return[oe];for(var le,O,K=[],ce=0;ce<xe;ce++){var Re=o(oe[ce]);Re!==0&&(O===void 0&&(O=Re<0),O===Re<0?(le&&K.push(le),le=[oe[ce]]):le.push(oe[ce]))}return le&&K.push(le),K}(L),_=0;_<L.length;_++)for(w=0;w<L[_].length;w++)N(L[_][w])}L.length===1?L=L[0]:j="Multi"+j;var J={type:"Feature",geometry:{type:j,coordinates:L},properties:this.properties};return"id"in this&&(J.id=this.id),J},yp}function wd(){if(yd)return xp;yd=1;var n=bd();function t(o,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(r,this,u),this.length=this._features.length}function r(o,u,f){o===15?u.version=f.readVarint():o===1?u.name=f.readString():o===5?u.extent=f.readVarint():o===2?u._features.push(f.pos):o===3?u._keys.push(f.readString()):o===4&&u._values.push(function(m){for(var _=null,w=m.readVarint()+m.pos;m.pos<w;){var M=m.readVarint()>>3;_=M===1?m.readString():M===2?m.readFloat():M===3?m.readDouble():M===4?m.readVarint64():M===5?m.readVarint():M===6?m.readSVarint():M===7?m.readBoolean():null}return _}(f))}return xp=t,t.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var u=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,u,this.extent,this._keys,this._values)},xp}function Td(){return xd||(xd=1,Ih.VectorTile=function(){if(vd)return bp;vd=1;var n=wd();function t(r,o,u){if(r===3){var f=new n(u,u.readVarint()+u.pos);f.length&&(o[f.name]=f)}}return bp=function(r,o){this.layers=r.readFields(t,{},o)},bp}(),Ih.VectorTileFeature=bd(),Ih.VectorTileLayer=wd()),Ih}var Pu=q(Td());const Jf=Pu.VectorTileFeature.types,Ah=Math.pow(2,13);function Ec(n,t,r,o,u,f,m,_){n.emplaceBack(t,r,2*Math.floor(o*Ah)+m,u*Ah*2,f*Ah*2,Math.round(_))}class Eh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ue,this.centroidVertexArray=new ie,this.indexArray=new je,this.programConfigurations=new on(t.layers,t.zoom),this.segments=new _t,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.features=[],this.hasPattern=Mc("fill-extrusion",this.layers,r);for(const{feature:u,id:f,index:m,sourceLayerIndex:_}of t){const w=this.layers[0]._featureFilter.needGeometry,M=Es(u,w);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),M,o))continue;const I={id:f,sourceLayerIndex:_,index:m,geometry:w?M.geometry:As(u),properties:u.properties,type:u.type,patterns:{}};this.hasPattern?this.features.push(Na("fill-extrusion",this.layers,I,this.zoom,r)):this.addFeature(I,I.geometry,m,o,{},r.subdivisionGranularity),r.featureIndex.insert(u,I.geometry,m,_,this.index,!0)}}addFeatures(t,r,o){for(const u of this.features){const{geometry:f}=u;this.addFeature(u,f,u.index,r,o,t.subdivisionGranularity)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Il),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Ds.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,o,u,f,m){for(const _ of hr(r,500)){const w={x:0,y:0,sampleCount:0},M=this.layoutVertexArray.length;this.processPolygon(w,u,t,_,m);const I=this.layoutVertexArray.length-M,E=Math.floor(w.x/w.sampleCount),L=Math.floor(w.y/w.sampleCount);for(let j=0;j<I;j++)this.centroidVertexArray.emplaceBack(E,L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,f,u)}processPolygon(t,r,o,u,f){if(u.length<1||Sd(u[0]))return;for(const E of u)E.length!==0&&Qf(t,E);const m={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},_=f.fill.getGranularityForZoomLevel(r.z),w=Jf[o.type]==="Polygon";for(const E of u){if(E.length===0||Sd(E))continue;const L=$a(E,_,w);this._generateSideFaces(L,m)}if(!w)return;const M=gp(u,r,_,!1),I=this.layoutVertexArray;Ph((E,L)=>{Ec(I,E,L,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles)}_generateSideFaces(t,r){let o=0;for(let u=1;u<t.length;u++){const f=t[u],m=t[u-1];if(em(f,m))continue;r.segment.vertexLength+4>_t.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const _=f.sub(m)._perp()._unit(),w=m.dist(f);o+w>32768&&(o=0),Ec(this.layoutVertexArray,f.x,f.y,_.x,_.y,0,0,o),Ec(this.layoutVertexArray,f.x,f.y,_.x,_.y,0,1,o),o+=w,Ec(this.layoutVertexArray,m.x,m.y,_.x,_.y,0,0,o),Ec(this.layoutVertexArray,m.x,m.y,_.x,_.y,0,1,o);const M=r.segment.vertexLength;this.indexArray.emplaceBack(M,M+2,M+1),this.indexArray.emplaceBack(M+1,M+2,M+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function Qf(n,t){for(let r=0;r<t.length;r++){const o=t[r];r===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(n.x+=o.x,n.y+=o.y,n.sampleCount++)}}function em(n,t){return n.x===t.x&&(n.x<0||n.x>jt)||n.y===t.y&&(n.y<0||n.y>jt)}function Sd(n){return n.every(t=>t.x<0)||n.every(t=>t.x>jt)||n.every(t=>t.y<0)||n.every(t=>t.y>jt)}let wp;xt("FillExtrusionBucket",Eh,{omit:["layers","features"]});var tm={get paint(){return wp=wp||new Er({"fill-extrusion-opacity":new Et(Q["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new kt(Q["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Et(Q["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Et(Q["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sa(Q["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new kt(Q["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new kt(Q["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Et(Q["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class im extends wo{constructor(t){super(t,tm)}createBucket(t){return new Eh(t)}queryRadius(){return wl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:u,transform:f,pixelsToTileUnits:m,pixelPosMatrix:_}){const w=xu(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-f.bearingInRadians,m),M=this.paint.get("fill-extrusion-height").evaluate(r,o),I=this.paint.get("fill-extrusion-base").evaluate(r,o),E=function(j,N,G){const J=[];for(const oe of j){const xe=[oe.x,oe.y,0,1];Ot(xe,xe,N),J.push(new we(xe[0]/xe[3],xe[1]/xe[3]))}return J}(w,_),L=function(j,N,G,J){const oe=[],xe=[],le=J[8]*N,O=J[9]*N,K=J[10]*N,ce=J[11]*N,Re=J[8]*G,Je=J[9]*G,Fe=J[10]*G,Be=J[11]*G;for(const Qe of j){const tt=[],at=[];for(const Ue of Qe){const St=Ue.x,Dt=Ue.y,zt=J[0]*St+J[4]*Dt+J[12],It=J[1]*St+J[5]*Dt+J[13],si=J[2]*St+J[6]*Dt+J[14],hn=J[3]*St+J[7]*Dt+J[15],$n=si+K,pr=hn+ce,fo=zt+Re,Lr=It+Je,ir=si+Fe,sn=hn+Be,Xn=new we((zt+le)/pr,(It+O)/pr);Xn.z=$n/pr,tt.push(Xn);const nr=new we(fo/sn,Lr/sn);nr.z=ir/sn,at.push(nr)}oe.push(tt),xe.push(at)}return[oe,xe]}(u,I,M,_);return function(j,N,G){let J=1/0;ks(G,N)&&(J=Pd(G,N[0]));for(let oe=0;oe<N.length;oe++){const xe=N[oe],le=j[oe];for(let O=0;O<xe.length-1;O++){const K=xe[O],ce=[K,xe[O+1],le[O+1],le[O],K];vu(G,ce)&&(J=Math.min(J,Pd(G,ce)))}}return J!==1/0&&J}(L[0],L[1],E)}}function Mu(n,t){return n.x*t.x+n.y*t.y}function Pd(n,t){if(n.length===1){let r=0;const o=t[r++];let u;for(;!u||o.equals(u);)if(u=t[r++],!u)return 1/0;for(;r<t.length;r++){const f=t[r],m=n[0],_=u.sub(o),w=f.sub(o),M=m.sub(o),I=Mu(_,_),E=Mu(_,w),L=Mu(w,w),j=Mu(M,_),N=Mu(M,w),G=I*L-E*E,J=(L*j-E*N)/G,oe=(I*N-E*j)/G,xe=o.z*(1-J-oe)+u.z*J+f.z*oe;if(isFinite(xe))return xe}return 1/0}{let r=1/0;for(const o of t)r=Math.min(r,o.z);return r}}const nm=wn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:rm}=nm,Ho=wn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:om}=Ho,sm=Pu.VectorTileFeature.types,am=Math.cos(Math.PI/180*37.5),Tp=Math.pow(2,14)/.5;class Sp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new he,this.layoutVertexArray2=new me,this.indexArray=new je,this.programConfigurations=new on(t.layers,t.zoom),this.segments=new _t,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.hasPattern=Mc("line",this.layers,r);const u=this.layers[0].layout.get("line-sort-key"),f=!u.isConstant(),m=[];for(const{feature:_,id:w,index:M,sourceLayerIndex:I}of t){const E=this.layers[0]._featureFilter.needGeometry,L=Es(_,E);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),L,o))continue;const j=f?u.evaluate(L,{},o):void 0,N={id:w,properties:_.properties,type:_.type,sourceLayerIndex:I,index:M,geometry:E?L.geometry:As(_),patterns:{},sortKey:j};m.push(N)}f&&m.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of m){const{geometry:w,index:M,sourceLayerIndex:I}=_;if(this.hasPattern){const E=Na("line",this.layers,_,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(_,w,M,o,{},r.subdivisionGranularity);r.featureIndex.insert(t[M].feature,w,M,I,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}addFeatures(t,r,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,om)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,rm),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,o,u,f,m){const _=this.layers[0].layout,w=_.get("line-join").evaluate(t,{}),M=_.get("line-cap"),I=_.get("line-miter-limit"),E=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const L of r)this.addLine(L,t,w,M,I,E,u,m);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,f,u)}addLine(t,r,o,u,f,m,_,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=$a(t,_?w.line.getGranularityForZoomLevel(_.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<t.length-1;le++)this.totalDistance+=t[le].dist(t[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=sm[r.type]==="Polygon";let I=t.length;for(;I>=2&&t[I-1].equals(t[I-2]);)I--;let E=0;for(;E<I-1&&t[E].equals(t[E+1]);)E++;if(I<(M?3:2))return;o==="bevel"&&(f=1.05);const L=this.overscaling<=16?15*jt/(512*this.overscaling):0,j=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let N,G,J,oe,xe;this.e1=this.e2=-1,M&&(N=t[I-2],xe=t[E].sub(N)._unit()._perp());for(let le=E;le<I;le++){if(J=le===I-1?M?t[E+1]:void 0:t[le+1],J&&t[le].equals(J))continue;xe&&(oe=xe),N&&(G=N),N=t[le],xe=J?J.sub(N)._unit()._perp():oe,oe=oe||xe;let O=oe.add(xe);O.x===0&&O.y===0||O._unit();const K=oe.x*xe.x+oe.y*xe.y,ce=O.x*xe.x+O.y*xe.y,Re=ce!==0?1/ce:1/0,Je=2*Math.sqrt(2-2*ce),Fe=ce<am&&G&&J,Be=oe.x*xe.y-oe.y*xe.x>0;if(Fe&&le>E){const at=N.dist(G);if(at>2*L){const Ue=N.sub(N.sub(G)._mult(L/at)._round());this.updateDistance(G,Ue),this.addCurrentVertex(Ue,oe,0,0,j),G=Ue}}const Qe=G&&J;let tt=Qe?o:M?"butt":u;if(Qe&&tt==="round"&&(Re<m?tt="miter":Re<=2&&(tt="fakeround")),tt==="miter"&&Re>f&&(tt="bevel"),tt==="bevel"&&(Re>2&&(tt="flipbevel"),Re<f&&(tt="miter")),G&&this.updateDistance(G,N),tt==="miter")O._mult(Re),this.addCurrentVertex(N,O,0,0,j);else if(tt==="flipbevel"){if(Re>100)O=xe.mult(-1);else{const at=Re*oe.add(xe).mag()/oe.sub(xe).mag();O._perp()._mult(at*(Be?-1:1))}this.addCurrentVertex(N,O,0,0,j),this.addCurrentVertex(N,O.mult(-1),0,0,j)}else if(tt==="bevel"||tt==="fakeround"){const at=-Math.sqrt(Re*Re-1),Ue=Be?at:0,St=Be?0:at;if(G&&this.addCurrentVertex(N,oe,Ue,St,j),tt==="fakeround"){const Dt=Math.round(180*Je/Math.PI/20);for(let zt=1;zt<Dt;zt++){let It=zt/Dt;if(It!==.5){const hn=It-.5;It+=It*hn*(It-1)*((1.0904+K*(K*(3.55645-1.43519*K)-3.2452))*hn*hn+(.848013+K*(.215638*K-1.06021)))}const si=xe.sub(oe)._mult(It)._add(oe)._unit()._mult(Be?-1:1);this.addHalfVertex(N,si.x,si.y,!1,Be,0,j)}}J&&this.addCurrentVertex(N,xe,-Ue,-St,j)}else if(tt==="butt")this.addCurrentVertex(N,O,0,0,j);else if(tt==="square"){const at=G?1:-1;this.addCurrentVertex(N,O,at,at,j)}else tt==="round"&&(G&&(this.addCurrentVertex(N,oe,0,0,j),this.addCurrentVertex(N,oe,1,1,j,!0)),J&&(this.addCurrentVertex(N,xe,-1,-1,j,!0),this.addCurrentVertex(N,xe,0,0,j)));if(Fe&&le<I-1){const at=N.dist(J);if(at>2*L){const Ue=N.add(J.sub(N)._mult(L/at)._round());this.updateDistance(N,Ue),this.addCurrentVertex(Ue,xe,0,0,j),N=Ue}}}}addCurrentVertex(t,r,o,u,f,m=!1){const _=r.y*u-r.x,w=-r.y-r.x*u;this.addHalfVertex(t,r.x+r.y*o,r.y-r.x*o,m,!1,o,f),this.addHalfVertex(t,_,w,m,!0,-u,f),this.distance>Tp/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,o,u,f,m))}addHalfVertex({x:t,y:r},o,u,f,m,_,w){const M=.5*(this.lineClips?this.scaledDistance*(Tp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(f?1:0),(r<<1)+(m?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(_===0?0:_<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,I,this.e2),w.primitiveLength++),m?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let Md,Cd;xt("LineBucket",Sp,{omit:["layers","patternFeatures"]});var Id={get paint(){return Cd=Cd||new Er({"line-opacity":new kt(Q.paint_line["line-opacity"]),"line-color":new kt(Q.paint_line["line-color"]),"line-translate":new Et(Q.paint_line["line-translate"]),"line-translate-anchor":new Et(Q.paint_line["line-translate-anchor"]),"line-width":new kt(Q.paint_line["line-width"]),"line-gap-width":new kt(Q.paint_line["line-gap-width"]),"line-offset":new kt(Q.paint_line["line-offset"]),"line-blur":new kt(Q.paint_line["line-blur"]),"line-dasharray":new Go(Q.paint_line["line-dasharray"]),"line-pattern":new sa(Q.paint_line["line-pattern"]),"line-gradient":new _r(Q.paint_line["line-gradient"])})},get layout(){return Md=Md||new Er({"line-cap":new Et(Q.layout_line["line-cap"]),"line-join":new kt(Q.layout_line["line-join"]),"line-miter-limit":new Et(Q.layout_line["line-miter-limit"]),"line-round-limit":new Et(Q.layout_line["line-round-limit"]),"line-sort-key":new kt(Q.layout_line["line-sort-key"])})}};class Pp extends kt{possiblyEvaluate(t,r){return r=new Vi(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,o,u){return r=Fi({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,o,u)}}let kh;class lm extends wo{constructor(t){super(t,Id),this.gradientVersion=0,kh||(kh=new Pp(Id.paint.properties["line-width"].specification),kh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Vs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=kh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Sp(t)}queryRadius(t){const r=t,o=Ad(Sc("line-width",this,r),Sc("line-gap-width",this,r)),u=Sc("line-offset",this,r);return o/2+Math.abs(u)+wl(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:u,transform:f,pixelsToTileUnits:m}){const _=xu(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-f.bearingInRadians,m),w=m/2*Ad(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),M=this.paint.get("line-offset").evaluate(r,o);return M&&(u=function(I,E){const L=[];for(let j=0;j<I.length;j++){const N=I[j],G=[];for(let J=0;J<N.length;J++){const oe=N[J-1],xe=N[J],le=N[J+1],O=J===0?new we(0,0):xe.sub(oe)._unit()._perp(),K=J===N.length-1?new we(0,0):le.sub(xe)._unit()._perp(),ce=O._add(K)._unit(),Re=ce.x*K.x+ce.y*K.y;Re!==0&&ce._mult(1/Re),G.push(ce._mult(E)._add(xe))}L.push(G)}return L}(u,M*m)),function(I,E,L){for(let j=0;j<E.length;j++){const N=E[j];if(I.length>=3){for(let G=0;G<N.length;G++)if(Tc(I,N[G]))return!0}if(bc(I,N,L))return!0}return!1}(_,u,w)}isTileClipped(){return!0}}function Ad(n,t){return t>0?t+2*n:n}const cm=wn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),um=wn([{name:"a_projected_pos",components:3,type:"Float32"}],4);wn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const hm=wn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);wn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ed=wn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),pm=wn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function dm(n,t,r){return n.sections.forEach(o=>{o.text=function(u,f,m){const _=f.layout.get("text-transform").evaluate(m,{});return _==="uppercase"?u=u.toLocaleUpperCase():_==="lowercase"&&(u=u.toLocaleLowerCase()),ss.applyArabicShaping&&(u=ss.applyArabicShaping(u)),u}(o.text,t,r)}),n}wn([{name:"triangle",components:3,type:"Uint16"}]),wn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),wn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),wn([{type:"Float32",name:"offsetX"}]),wn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),wn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Cu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var kd,Mp,zd,Nn=24,Cp={};function fm(){return kd||(kd=1,Cp.read=function(n,t,r,o,u){var f,m,_=8*u-o-1,w=(1<<_)-1,M=w>>1,I=-7,E=r?u-1:0,L=r?-1:1,j=n[t+E];for(E+=L,f=j&(1<<-I)-1,j>>=-I,I+=_;I>0;f=256*f+n[t+E],E+=L,I-=8);for(m=f&(1<<-I)-1,f>>=-I,I+=o;I>0;m=256*m+n[t+E],E+=L,I-=8);if(f===0)f=1-M;else{if(f===w)return m?NaN:1/0*(j?-1:1);m+=Math.pow(2,o),f-=M}return(j?-1:1)*m*Math.pow(2,f-o)},Cp.write=function(n,t,r,o,u,f){var m,_,w,M=8*f-u-1,I=(1<<M)-1,E=I>>1,L=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,j=o?0:f-1,N=o?1:-1,G=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(_=isNaN(t)?1:0,m=I):(m=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-m))<1&&(m--,w*=2),(t+=m+E>=1?L/w:L*Math.pow(2,1-E))*w>=2&&(m++,w/=2),m+E>=I?(_=0,m=I):m+E>=1?(_=(t*w-1)*Math.pow(2,u),m+=E):(_=t*Math.pow(2,E-1)*Math.pow(2,u),m=0));u>=8;n[r+j]=255&_,j+=N,_/=256,u-=8);for(m=m<<u|_,M+=u;M>0;n[r+j]=255&m,j+=N,m/=256,M-=8);n[r+j-N]|=128*G}),Cp}function Dd(){if(zd)return Mp;zd=1,Mp=t;var n=fm();function t(O){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(O)?O:new Uint8Array(O||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var r=4294967296,o=1/r,u=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function f(O){return O.type===t.Bytes?O.readVarint()+O.pos:O.pos+1}function m(O,K,ce){return ce?4294967296*K+(O>>>0):4294967296*(K>>>0)+(O>>>0)}function _(O,K,ce){var Re=K<=16383?1:K<=2097151?2:K<=268435455?3:Math.floor(Math.log(K)/(7*Math.LN2));ce.realloc(Re);for(var Je=ce.pos-1;Je>=O;Je--)ce.buf[Je+Re]=ce.buf[Je]}function w(O,K){for(var ce=0;ce<O.length;ce++)K.writeVarint(O[ce])}function M(O,K){for(var ce=0;ce<O.length;ce++)K.writeSVarint(O[ce])}function I(O,K){for(var ce=0;ce<O.length;ce++)K.writeFloat(O[ce])}function E(O,K){for(var ce=0;ce<O.length;ce++)K.writeDouble(O[ce])}function L(O,K){for(var ce=0;ce<O.length;ce++)K.writeBoolean(O[ce])}function j(O,K){for(var ce=0;ce<O.length;ce++)K.writeFixed32(O[ce])}function N(O,K){for(var ce=0;ce<O.length;ce++)K.writeSFixed32(O[ce])}function G(O,K){for(var ce=0;ce<O.length;ce++)K.writeFixed64(O[ce])}function J(O,K){for(var ce=0;ce<O.length;ce++)K.writeSFixed64(O[ce])}function oe(O,K){return(O[K]|O[K+1]<<8|O[K+2]<<16)+16777216*O[K+3]}function xe(O,K,ce){O[ce]=K,O[ce+1]=K>>>8,O[ce+2]=K>>>16,O[ce+3]=K>>>24}function le(O,K){return(O[K]|O[K+1]<<8|O[K+2]<<16)+(O[K+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(O,K,ce){for(ce=ce||this.length;this.pos<ce;){var Re=this.readVarint(),Je=Re>>3,Fe=this.pos;this.type=7&Re,O(Je,K,this),this.pos===Fe&&this.skip(Re)}return K},readMessage:function(O,K){return this.readFields(O,K,this.readVarint()+this.pos)},readFixed32:function(){var O=oe(this.buf,this.pos);return this.pos+=4,O},readSFixed32:function(){var O=le(this.buf,this.pos);return this.pos+=4,O},readFixed64:function(){var O=oe(this.buf,this.pos)+oe(this.buf,this.pos+4)*r;return this.pos+=8,O},readSFixed64:function(){var O=oe(this.buf,this.pos)+le(this.buf,this.pos+4)*r;return this.pos+=8,O},readFloat:function(){var O=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,O},readDouble:function(){var O=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,O},readVarint:function(O){var K,ce,Re=this.buf;return K=127&(ce=Re[this.pos++]),ce<128?K:(K|=(127&(ce=Re[this.pos++]))<<7,ce<128?K:(K|=(127&(ce=Re[this.pos++]))<<14,ce<128?K:(K|=(127&(ce=Re[this.pos++]))<<21,ce<128?K:function(Je,Fe,Be){var Qe,tt,at=Be.buf;if(Qe=(112&(tt=at[Be.pos++]))>>4,tt<128||(Qe|=(127&(tt=at[Be.pos++]))<<3,tt<128)||(Qe|=(127&(tt=at[Be.pos++]))<<10,tt<128)||(Qe|=(127&(tt=at[Be.pos++]))<<17,tt<128)||(Qe|=(127&(tt=at[Be.pos++]))<<24,tt<128)||(Qe|=(1&(tt=at[Be.pos++]))<<31,tt<128))return m(Je,Qe,Fe);throw new Error("Expected varint not more than 10 bytes")}(K|=(15&(ce=Re[this.pos]))<<28,O,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var O=this.readVarint();return O%2==1?(O+1)/-2:O/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var O=this.readVarint()+this.pos,K=this.pos;return this.pos=O,O-K>=12&&u?function(ce,Re,Je){return u.decode(ce.subarray(Re,Je))}(this.buf,K,O):function(ce,Re,Je){for(var Fe="",Be=Re;Be<Je;){var Qe,tt,at,Ue=ce[Be],St=null,Dt=Ue>239?4:Ue>223?3:Ue>191?2:1;if(Be+Dt>Je)break;Dt===1?Ue<128&&(St=Ue):Dt===2?(192&(Qe=ce[Be+1]))==128&&(St=(31&Ue)<<6|63&Qe)<=127&&(St=null):Dt===3?(tt=ce[Be+2],(192&(Qe=ce[Be+1]))==128&&(192&tt)==128&&((St=(15&Ue)<<12|(63&Qe)<<6|63&tt)<=2047||St>=55296&&St<=57343)&&(St=null)):Dt===4&&(tt=ce[Be+2],at=ce[Be+3],(192&(Qe=ce[Be+1]))==128&&(192&tt)==128&&(192&at)==128&&((St=(15&Ue)<<18|(63&Qe)<<12|(63&tt)<<6|63&at)<=65535||St>=1114112)&&(St=null)),St===null?(St=65533,Dt=1):St>65535&&(St-=65536,Fe+=String.fromCharCode(St>>>10&1023|55296),St=56320|1023&St),Fe+=String.fromCharCode(St),Be+=Dt}return Fe}(this.buf,K,O)},readBytes:function(){var O=this.readVarint()+this.pos,K=this.buf.subarray(this.pos,O);return this.pos=O,K},readPackedVarint:function(O,K){if(this.type!==t.Bytes)return O.push(this.readVarint(K));var ce=f(this);for(O=O||[];this.pos<ce;)O.push(this.readVarint(K));return O},readPackedSVarint:function(O){if(this.type!==t.Bytes)return O.push(this.readSVarint());var K=f(this);for(O=O||[];this.pos<K;)O.push(this.readSVarint());return O},readPackedBoolean:function(O){if(this.type!==t.Bytes)return O.push(this.readBoolean());var K=f(this);for(O=O||[];this.pos<K;)O.push(this.readBoolean());return O},readPackedFloat:function(O){if(this.type!==t.Bytes)return O.push(this.readFloat());var K=f(this);for(O=O||[];this.pos<K;)O.push(this.readFloat());return O},readPackedDouble:function(O){if(this.type!==t.Bytes)return O.push(this.readDouble());var K=f(this);for(O=O||[];this.pos<K;)O.push(this.readDouble());return O},readPackedFixed32:function(O){if(this.type!==t.Bytes)return O.push(this.readFixed32());var K=f(this);for(O=O||[];this.pos<K;)O.push(this.readFixed32());return O},readPackedSFixed32:function(O){if(this.type!==t.Bytes)return O.push(this.readSFixed32());var K=f(this);for(O=O||[];this.pos<K;)O.push(this.readSFixed32());return O},readPackedFixed64:function(O){if(this.type!==t.Bytes)return O.push(this.readFixed64());var K=f(this);for(O=O||[];this.pos<K;)O.push(this.readFixed64());return O},readPackedSFixed64:function(O){if(this.type!==t.Bytes)return O.push(this.readSFixed64());var K=f(this);for(O=O||[];this.pos<K;)O.push(this.readSFixed64());return O},skip:function(O){var K=7&O;if(K===t.Varint)for(;this.buf[this.pos++]>127;);else if(K===t.Bytes)this.pos=this.readVarint()+this.pos;else if(K===t.Fixed32)this.pos+=4;else{if(K!==t.Fixed64)throw new Error("Unimplemented type: "+K);this.pos+=8}},writeTag:function(O,K){this.writeVarint(O<<3|K)},realloc:function(O){for(var K=this.length||16;K<this.pos+O;)K*=2;if(K!==this.length){var ce=new Uint8Array(K);ce.set(this.buf),this.buf=ce,this.length=K}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(O){this.realloc(4),xe(this.buf,O,this.pos),this.pos+=4},writeSFixed32:function(O){this.realloc(4),xe(this.buf,O,this.pos),this.pos+=4},writeFixed64:function(O){this.realloc(8),xe(this.buf,-1&O,this.pos),xe(this.buf,Math.floor(O*o),this.pos+4),this.pos+=8},writeSFixed64:function(O){this.realloc(8),xe(this.buf,-1&O,this.pos),xe(this.buf,Math.floor(O*o),this.pos+4),this.pos+=8},writeVarint:function(O){(O=+O||0)>268435455||O<0?function(K,ce){var Re,Je;if(K>=0?(Re=K%4294967296|0,Je=K/4294967296|0):(Je=~(-K/4294967296),4294967295^(Re=~(-K%4294967296))?Re=Re+1|0:(Re=0,Je=Je+1|0)),K>=18446744073709552e3||K<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ce.realloc(10),function(Fe,Be,Qe){Qe.buf[Qe.pos++]=127&Fe|128,Fe>>>=7,Qe.buf[Qe.pos++]=127&Fe|128,Fe>>>=7,Qe.buf[Qe.pos++]=127&Fe|128,Fe>>>=7,Qe.buf[Qe.pos++]=127&Fe|128,Qe.buf[Qe.pos]=127&(Fe>>>=7)}(Re,0,ce),function(Fe,Be){var Qe=(7&Fe)<<4;Be.buf[Be.pos++]|=Qe|((Fe>>>=3)?128:0),Fe&&(Be.buf[Be.pos++]=127&Fe|((Fe>>>=7)?128:0),Fe&&(Be.buf[Be.pos++]=127&Fe|((Fe>>>=7)?128:0),Fe&&(Be.buf[Be.pos++]=127&Fe|((Fe>>>=7)?128:0),Fe&&(Be.buf[Be.pos++]=127&Fe|((Fe>>>=7)?128:0),Fe&&(Be.buf[Be.pos++]=127&Fe)))))}(Je,ce)}(O,this):(this.realloc(4),this.buf[this.pos++]=127&O|(O>127?128:0),O<=127||(this.buf[this.pos++]=127&(O>>>=7)|(O>127?128:0),O<=127||(this.buf[this.pos++]=127&(O>>>=7)|(O>127?128:0),O<=127||(this.buf[this.pos++]=O>>>7&127))))},writeSVarint:function(O){this.writeVarint(O<0?2*-O-1:2*O)},writeBoolean:function(O){this.writeVarint(!!O)},writeString:function(O){O=String(O),this.realloc(4*O.length),this.pos++;var K=this.pos;this.pos=function(Re,Je,Fe){for(var Be,Qe,tt=0;tt<Je.length;tt++){if((Be=Je.charCodeAt(tt))>55295&&Be<57344){if(!Qe){Be>56319||tt+1===Je.length?(Re[Fe++]=239,Re[Fe++]=191,Re[Fe++]=189):Qe=Be;continue}if(Be<56320){Re[Fe++]=239,Re[Fe++]=191,Re[Fe++]=189,Qe=Be;continue}Be=Qe-55296<<10|Be-56320|65536,Qe=null}else Qe&&(Re[Fe++]=239,Re[Fe++]=191,Re[Fe++]=189,Qe=null);Be<128?Re[Fe++]=Be:(Be<2048?Re[Fe++]=Be>>6|192:(Be<65536?Re[Fe++]=Be>>12|224:(Re[Fe++]=Be>>18|240,Re[Fe++]=Be>>12&63|128),Re[Fe++]=Be>>6&63|128),Re[Fe++]=63&Be|128)}return Fe}(this.buf,O,this.pos);var ce=this.pos-K;ce>=128&&_(K,ce,this),this.pos=K-1,this.writeVarint(ce),this.pos+=ce},writeFloat:function(O){this.realloc(4),n.write(this.buf,O,this.pos,!0,23,4),this.pos+=4},writeDouble:function(O){this.realloc(8),n.write(this.buf,O,this.pos,!0,52,8),this.pos+=8},writeBytes:function(O){var K=O.length;this.writeVarint(K),this.realloc(K);for(var ce=0;ce<K;ce++)this.buf[this.pos++]=O[ce]},writeRawMessage:function(O,K){this.pos++;var ce=this.pos;O(K,this);var Re=this.pos-ce;Re>=128&&_(ce,Re,this),this.pos=ce-1,this.writeVarint(Re),this.pos+=Re},writeMessage:function(O,K,ce){this.writeTag(O,t.Bytes),this.writeRawMessage(K,ce)},writePackedVarint:function(O,K){K.length&&this.writeMessage(O,w,K)},writePackedSVarint:function(O,K){K.length&&this.writeMessage(O,M,K)},writePackedBoolean:function(O,K){K.length&&this.writeMessage(O,L,K)},writePackedFloat:function(O,K){K.length&&this.writeMessage(O,I,K)},writePackedDouble:function(O,K){K.length&&this.writeMessage(O,E,K)},writePackedFixed32:function(O,K){K.length&&this.writeMessage(O,j,K)},writePackedSFixed32:function(O,K){K.length&&this.writeMessage(O,N,K)},writePackedFixed64:function(O,K){K.length&&this.writeMessage(O,G,K)},writePackedSFixed64:function(O,K){K.length&&this.writeMessage(O,J,K)},writeBytesField:function(O,K){this.writeTag(O,t.Bytes),this.writeBytes(K)},writeFixed32Field:function(O,K){this.writeTag(O,t.Fixed32),this.writeFixed32(K)},writeSFixed32Field:function(O,K){this.writeTag(O,t.Fixed32),this.writeSFixed32(K)},writeFixed64Field:function(O,K){this.writeTag(O,t.Fixed64),this.writeFixed64(K)},writeSFixed64Field:function(O,K){this.writeTag(O,t.Fixed64),this.writeSFixed64(K)},writeVarintField:function(O,K){this.writeTag(O,t.Varint),this.writeVarint(K)},writeSVarintField:function(O,K){this.writeTag(O,t.Varint),this.writeSVarint(K)},writeStringField:function(O,K){this.writeTag(O,t.Bytes),this.writeString(K)},writeFloatField:function(O,K){this.writeTag(O,t.Fixed32),this.writeFloat(K)},writeDoubleField:function(O,K){this.writeTag(O,t.Fixed64),this.writeDouble(K)},writeBooleanField:function(O,K){this.writeVarintField(O,!!K)}},Mp}var Ip=q(Dd());const Ap=3;function mm(n,t,r){n===1&&r.readMessage(Ep,t)}function Ep(n,t,r){if(n===3){const{id:o,bitmap:u,width:f,height:m,left:_,top:w,advance:M}=r.readMessage(Rd,{});t.push({id:o,bitmap:new Pc({width:f+2*Ap,height:m+2*Ap},u),metrics:{width:f,height:m,left:_,top:w,advance:M}})}}function Rd(n,t,r){n===1?t.id=r.readVarint():n===2?t.bitmap=r.readBytes():n===3?t.width=r.readVarint():n===4?t.height=r.readVarint():n===5?t.left=r.readSVarint():n===6?t.top=r.readSVarint():n===7&&(t.advance=r.readVarint())}const gm=Ap;function Ld(n){let t=0,r=0;for(const m of n)t+=m.w*m.h,r=Math.max(r,m.w);n.sort((m,_)=>_.h-m.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let u=0,f=0;for(const m of n)for(let _=o.length-1;_>=0;_--){const w=o[_];if(!(m.w>w.w||m.h>w.h)){if(m.x=w.x,m.y=w.y,f=Math.max(f,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===w.w&&m.h===w.h){const M=o.pop();_<o.length&&(o[_]=M)}else m.h===w.h?(w.x+=m.w,w.w-=m.w):m.w===w.w?(w.y+=m.h,w.h-=m.h):(o.push({x:w.x+m.w,y:w.y,w:w.w-m.w,h:m.h}),w.y+=m.h,w.h-=m.h);break}}return{w:u,h:f,fill:t/(u*f)||0}}const Xr=1;class kp{constructor(t,{pixelRatio:r,version:o,stretchX:u,stretchY:f,content:m,textFitWidth:_,textFitHeight:w}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=u,this.stretchY=f,this.content=m,this.version=o,this.textFitWidth=_,this.textFitHeight=w}get tl(){return[this.paddedRect.x+Xr,this.paddedRect.y+Xr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Xr,this.paddedRect.y+this.paddedRect.h-Xr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Xr)/this.pixelRatio,(this.paddedRect.h-2*Xr)/this.pixelRatio]}}class Bd{constructor(t,r){const o={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(t,o,f),this.addImages(r,u,f);const{w:m,h:_}=Ld(f),w=new co({width:m||1,height:_||1});for(const M in t){const I=t[M],E=o[M].paddedRect;co.copy(I.data,w,{x:0,y:0},{x:E.x+Xr,y:E.y+Xr},I.data)}for(const M in r){const I=r[M],E=u[M].paddedRect,L=E.x+Xr,j=E.y+Xr,N=I.data.width,G=I.data.height;co.copy(I.data,w,{x:0,y:0},{x:L,y:j},I.data),co.copy(I.data,w,{x:0,y:G-1},{x:L,y:j-1},{width:N,height:1}),co.copy(I.data,w,{x:0,y:0},{x:L,y:j+G},{width:N,height:1}),co.copy(I.data,w,{x:N-1,y:0},{x:L-1,y:j},{width:1,height:G}),co.copy(I.data,w,{x:0,y:0},{x:L+N,y:j},{width:1,height:G})}this.image=w,this.iconPositions=o,this.patternPositions=u}addImages(t,r,o){for(const u in t){const f=t[u],m={x:0,y:0,w:f.data.width+2*Xr,h:f.data.height+2*Xr};o.push(m),r[u]=new kp(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),r)}patchUpdatedImage(t,r,o){if(!t||!r||t.version===r.version)return;t.version=r.version;const[u,f]=t.tl;o.update(r.data,void 0,{x:u,y:f})}}var Va;xt("ImagePosition",kp),xt("ImageAtlas",Bd),T.ai=void 0,(Va=T.ai||(T.ai={}))[Va.none=0]="none",Va[Va.horizontal=1]="horizontal",Va[Va.vertical=2]="vertical",Va[Va.horizontalOnly=3]="horizontalOnly";const zh=-17;class Iu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,r,o){const u=new Iu;return u.scale=t||1,u.fontStack=r,u.verticalAlign=o||"bottom",u}static forImage(t,r){const o=new Iu;return o.imageName=t,o.verticalAlign=r||"bottom",o}}class Al{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const o=new Al;for(let u=0;u<t.sections.length;u++){const f=t.sections[u];f.image?o.addImageSection(f):o.addTextSection(f,r)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let o=0;o<t.length;o++){const u=t.charCodeAt(o+1)||null,f=t.charCodeAt(o-1)||null;r+=u&&so(u)&&!Cu[t[o+1]]||f&&so(f)&&!Cu[t[o-1]]||!Cu[t[o]]?t[o]:Cu[t[o]]}return r}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&El[this.text.charCodeAt(o)];o++)t++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&El[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const o=new Al;return o.text=this.text.substring(t,r),o.sectionIndex=this.sectionIndex.slice(t,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}getMaxImageSize(t){let r=0,o=0;for(let u=0;u<this.length();u++){const f=this.getSection(u);if(f.imageName){const m=t[f.imageName];if(!m)continue;const _=m.displaySize;r=Math.max(r,_[0]),o=Math.max(o,_[1])}}return{maxImageWidth:r,maxImageHeight:o}}addTextSection(t,r){this.text+=t.text,this.sections.push(Iu.forText(t.scale,t.fontStack||r,t.verticalAlign));const o=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(o)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Ji("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Iu.forImage(r,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Ji("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Dh(n,t,r,o,u,f,m,_,w,M,I,E,L,j,N){const G=Al.fromFeature(n,u);let J;E===T.ai.vertical&&G.verticalizePunctuation();const{processBidirectionalText:oe,processStyledBidirectionalText:xe}=ss;if(oe&&G.sections.length===1){J=[];const K=oe(G.toString(),zp(G,M,f,t,o,j));for(const ce of K){const Re=new Al;Re.text=ce,Re.sections=G.sections;for(let Je=0;Je<ce.length;Je++)Re.sectionIndex.push(0);J.push(Re)}}else if(xe){J=[];const K=xe(G.text,G.sectionIndex,zp(G,M,f,t,o,j));for(const ce of K){const Re=new Al;Re.text=ce[0],Re.sectionIndex=ce[1],Re.sections=G.sections,J.push(Re)}}else J=function(K,ce){const Re=[],Je=K.text;let Fe=0;for(const Be of ce)Re.push(K.substring(Fe,Be)),Fe=Be;return Fe<Je.length&&Re.push(K.substring(Fe,Je.length)),Re}(G,zp(G,M,f,t,o,j));const le=[],O={positionedLines:le,text:G.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:E,iconsInText:!1,verticalizable:!1};return function(K,ce,Re,Je,Fe,Be,Qe,tt,at,Ue,St,Dt){let zt=0,It=0,si=0,hn=0;const $n=tt==="right"?1:tt==="left"?0:.5,pr=Nn/Dt;let fo=0;for(const sn of Fe){sn.trim();const Xn=sn.getMaxScale(),nr={positionedGlyphs:[],lineOffset:0};K.positionedLines[fo]=nr;const mn=nr.positionedGlyphs;let Br=0;if(!sn.length()){It+=Be,++fo;continue}const Co=xm(Je,sn,pr);for(let Yr=0;Yr<sn.length();Yr++){const Vn=sn.getSection(Yr),Un=sn.getSectionIndex(Yr),Gn=sn.getCharCode(Yr),Dn=bm(at,St,Gn);let Ui;if(Vn.imageName){if(K.iconsInText=!0,Vn.scale=Vn.scale*pr,Ui=Tm(Vn,Dn,Xn,Co,Je),!Ui)continue;Br=Math.max(Br,Ui.imageOffset)}else if(Ui=wm(Vn,Gn,Dn,Co,ce,Re),!Ui)continue;const{rect:hs,metrics:Fc,baselineOffset:ps}=Ui;mn.push({glyph:Gn,imageName:Vn.imageName,x:zt,y:It+ps+zh,vertical:Dn,scale:Vn.scale,fontStack:Vn.fontStack,sectionIndex:Un,metrics:Fc,rect:hs}),Dn?(K.verticalizable=!0,zt+=(Vn.imageName?Fc.advance:Nn)*Vn.scale+Ue):zt+=Fc.advance*Vn.scale+Ue}mn.length!==0&&(si=Math.max(zt-Ue,si),Sm(mn,0,mn.length-1,$n)),zt=0,nr.lineOffset=Math.max(Br,(Xn-1)*Nn);const Kn=Be*Xn+Br;It+=Kn,hn=Math.max(Kn,hn),++fo}const{horizontalAlign:Lr,verticalAlign:ir}=Dp(Qe);(function(sn,Xn,nr,mn,Br,Co,Kn,Yr,Vn){const Un=(Xn-nr)*Br;let Gn=0;Gn=Co!==Kn?-Yr*mn-zh:-mn*Vn*Kn+.5*Kn;for(const Dn of sn)for(const Ui of Dn.positionedGlyphs)Ui.x+=Un,Ui.y+=Gn})(K.positionedLines,$n,Lr,ir,si,hn,Be,It,Fe.length),K.top+=-ir*It,K.bottom=K.top+It,K.left+=-Lr*si,K.right=K.left+si}(O,t,r,o,J,m,_,w,E,M,L,N),!function(K){for(const ce of K)if(ce.positionedGlyphs.length!==0)return!1;return!0}(le)&&O}const El={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_m={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},ym={40:!0};function Fd(n,t,r,o,u,f){if(t.imageName){const m=o[t.imageName];return m?m.displaySize[0]*t.scale*Nn/f+u:0}{const m=r[t.fontStack],_=m&&m[n];return _?_.metrics.advance*t.scale+u:0}}function Od(n,t,r,o){const u=Math.pow(n-t,2);return o?n<t?u/2:2*u:u+Math.abs(r)*r}function vm(n,t,r){let o=0;return n===10&&(o-=1e4),r&&(o+=150),n!==40&&n!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function jd(n,t,r,o,u,f){let m=null,_=Od(t,r,u,f);for(const w of o){const M=Od(t-w.x,r,u,f)+w.badness;M<=_&&(m=w,_=M)}return{index:n,x:t,priorBreak:m,badness:_}}function Nd(n){return n?Nd(n.priorBreak).concat(n.index):[]}function zp(n,t,r,o,u,f){if(!n)return[];const m=[],_=function(E,L,j,N,G,J){let oe=0;for(let xe=0;xe<E.length();xe++){const le=E.getSection(xe);oe+=Fd(E.getCharCode(xe),le,N,G,L,J)}return oe/Math.max(1,Math.ceil(oe/j))}(n,t,r,o,u,f),w=n.text.indexOf("​")>=0;let M=0;for(let E=0;E<n.length();E++){const L=n.getSection(E),j=n.getCharCode(E);if(El[j]||(M+=Fd(j,L,o,u,t,f)),E<n.length()-1){const N=!((I=j)<11904)&&(!!ri["CJK Compatibility Forms"](I)||!!ri["CJK Compatibility"](I)||!!ri["CJK Strokes"](I)||!!ri["CJK Symbols and Punctuation"](I)||!!ri["Enclosed CJK Letters and Months"](I)||!!ri["Halfwidth and Fullwidth Forms"](I)||!!ri["Ideographic Description Characters"](I)||!!ri["Vertical Forms"](I)||dc.test(String.fromCodePoint(I)));(_m[j]||N||L.imageName||E!==n.length()-2&&ym[n.getCharCode(E+1)])&&m.push(jd(E+1,M,_,m,vm(j,n.getCharCode(E+1),N&&w),!1))}}var I;return Nd(jd(n.length(),M,_,m,0,!0))}function Dp(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function xm(n,t,r){const o=t.getMaxScale()*Nn,{maxImageWidth:u,maxImageHeight:f}=t.getMaxImageSize(n),m=Math.max(o,f*r);return{verticalLineContentWidth:Math.max(o,u*r),horizontalLineContentHeight:m}}function $d(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function bm(n,t,r){return!(n===T.ai.horizontal||!t&&!fc(r)||t&&(El[r]||(o=r,/\p{sc=Arab}/u.test(String.fromCodePoint(o)))));var o}function wm(n,t,r,o,u,f){const m=f[n.fontStack],_=function(M,I,E,L){if(M&&M.rect)return M;const j=I[E.fontStack],N=j&&j[L];return N?{rect:null,metrics:N.metrics}:null}(m&&m[t],u,n,t);if(_===null)return null;let w;if(r)w=o.verticalLineContentWidth-n.scale*Nn;else{const M=$d(n.verticalAlign);w=(o.horizontalLineContentHeight-n.scale*Nn)*M}return{rect:_.rect,metrics:_.metrics,baselineOffset:w}}function Tm(n,t,r,o,u){const f=u[n.imageName];if(!f)return null;const m=f.paddedRect,_=f.displaySize,w={width:_[0],height:_[1],left:Xr,top:-3,advance:t?_[1]:_[0]};let M;if(t)M=o.verticalLineContentWidth-_[1]*n.scale;else{const I=$d(n.verticalAlign);M=(o.horizontalLineContentHeight-_[1]*n.scale)*I}return{rect:m,metrics:w,baselineOffset:M,imageOffset:(t?_[0]:_[1])*n.scale-Nn*r}}function Sm(n,t,r,o){if(o===0)return;const u=n[r],f=(n[r].x+u.metrics.advance*u.scale)*o;for(let m=t;m<=r;m++)n[m].x-=f}function Pm(n,t,r){const{horizontalAlign:o,verticalAlign:u}=Dp(r),f=t[0]-n.displaySize[0]*o,m=t[1]-n.displaySize[1]*u;return{image:n,top:m,bottom:m+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function Rp(n){var t,r;let o=n.left,u=n.top,f=n.right-o,m=n.bottom-u;const _=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",w=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",M=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(w==="proportional"){if(_==="stretchOnly"&&f/m<M||_==="proportional"){const I=Math.ceil(m*M);o*=I/f,f=I}}else if(_==="proportional"&&w==="stretchOnly"&&M!==0&&f/m>M){const I=Math.ceil(f/M);u*=I/m,m=I}return{x1:o,y1:u,x2:o+f,y2:u+m}}function Lp(n,t,r,o,u,f){const m=n.image;let _;if(m.content){const J=m.content,oe=m.pixelRatio||1;_=[J[0]/oe,J[1]/oe,m.displaySize[0]-J[2]/oe,m.displaySize[1]-J[3]/oe]}const w=t.left*f,M=t.right*f;let I,E,L,j;r==="width"||r==="both"?(j=u[0]+w-o[3],E=u[0]+M+o[1]):(j=u[0]+(w+M-m.displaySize[0])/2,E=j+m.displaySize[0]);const N=t.top*f,G=t.bottom*f;return r==="height"||r==="both"?(I=u[1]+N-o[0],L=u[1]+G+o[2]):(I=u[1]+(N+G-m.displaySize[1])/2,L=I+m.displaySize[1]),{image:m,top:I,right:E,bottom:L,left:j,collisionPadding:_}}const Au=255,Rs=128,Ua=Au*Rs;function Vd(n,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Vi(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=r;let f=0;for(;f<o.length&&o[f]<=n;)f++;f=Math.max(0,f-1);let m=f;for(;m<o.length&&o[m]<n+1;)m++;m=Math.min(o.length-1,m);const _=o[f],w=o[m];return r.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:w,interpolationType:u}:{kind:"camera",minZoom:_,maxZoom:w,minSize:r.evaluate(new Vi(_)),maxSize:r.evaluate(new Vi(w)),interpolationType:u}}}function kc(n,t,r){let o="never";const u=n.get(t);return u?o=u:n.get(r)&&(o="always"),o}const Mm=Pu.VectorTileFeature.types,Cm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Rh(n,t,r,o,u,f,m,_,w,M,I,E,L){const j=_?Math.min(Ua,Math.round(_[0])):0,N=_?Math.min(Ua,Math.round(_[1])):0;n.emplaceBack(t,r,Math.round(32*o),Math.round(32*u),f,m,(j<<1)+(w?1:0),N,16*M,16*I,256*E,256*L)}function Bp(n,t,r){n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r)}function Im(n){for(const t of n.sections)if(fh(t.text))return!0;return!1}class Fp{constructor(t){this.layoutVertexArray=new ye,this.indexArray=new je,this.programConfigurations=t,this.segments=new _t,this.dynamicLayoutVertexArray=new ze,this.opacityVertexArray=new Le,this.hasVisibleVertices=!1,this.placedSymbolArray=new b}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,cm.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,um.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Cm,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}xt("SymbolBuffers",Fp);class Op{constructor(t,r,o){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new o,this.segments=new _t,this.collisionVertexArray=new He}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,hm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}xt("CollisionBuffers",Op);class zc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vd(this.zoom,r["text-size"]),this.iconSizeData=Vd(this.zoom,r["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),f=o.get("symbol-z-order");this.canOverlap=kc(o,"text-overlap","text-allow-overlap")!=="never"||kc(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(m=>T.ai[m])),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID}createArrays(){this.text=new Fp(new on(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Fp(new on(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new z,this.lineVertexArray=new R,this.symbolInstances=new C,this.textAnchorOffsets=new V}calculateGlyphDependencies(t,r,o,u,f){for(let m=0;m<t.length;m++)if(r[t.charCodeAt(m)]=!0,(o||u)&&f){const _=Cu[t.charAt(m)];_&&(r[_.charCodeAt(0)]=!0)}}populate(t,r,o){const u=this.layers[0],f=u.layout,m=f.get("text-font"),_=f.get("text-field"),w=f.get("icon-image"),M=(_.value.kind!=="constant"||_.value.value instanceof tn&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),I=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,E=f.get("symbol-sort-key");if(this.features=[],!M&&!I)return;const L=r.iconDependencies,j=r.glyphDependencies,N=r.availableImages,G=new Vi(this.zoom);for(const{feature:J,id:oe,index:xe,sourceLayerIndex:le}of t){const O=u._featureFilter.needGeometry,K=Es(J,O);if(!u._featureFilter.filter(G,K,o))continue;let ce,Re;if(O||(K.geometry=As(J)),M){const Fe=u.getValueAndResolveTokens("text-field",K,o,N),Be=tn.factory(Fe),Qe=this.hasRTLText=this.hasRTLText||Im(Be);(!Qe||ss.getRTLTextPluginStatus()==="unavailable"||Qe&&ss.isParsed())&&(ce=dm(Be,u,K))}if(I){const Fe=u.getValueAndResolveTokens("icon-image",K,o,N);Re=Fe instanceof Jn?Fe:Jn.fromString(Fe)}if(!ce&&!Re)continue;const Je=this.sortFeaturesByKey?E.evaluate(K,{},o):void 0;if(this.features.push({id:oe,text:ce,icon:Re,index:xe,sourceLayerIndex:le,geometry:K.geometry,properties:J.properties,type:Mm[J.type],sortKey:Je}),Re&&(L[Re.name]=!0),ce){const Fe=m.evaluate(K,{},o).join(","),Be=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(T.ai.vertical)>=0;for(const Qe of ce.sections)if(Qe.image)L[Qe.image.name]=!0;else{const tt=Ba(ce.toString()),at=Qe.fontStack||Fe,Ue=j[at]=j[at]||{};this.calculateGlyphDependencies(Qe.text,Ue,Be,this.allowVerticalPlacement,tt)}}}f.get("symbol-placement")==="line"&&(this.features=function(J){const oe={},xe={},le=[];let O=0;function K(Fe){le.push(J[Fe]),O++}function ce(Fe,Be,Qe){const tt=xe[Fe];return delete xe[Fe],xe[Be]=tt,le[tt].geometry[0].pop(),le[tt].geometry[0]=le[tt].geometry[0].concat(Qe[0]),tt}function Re(Fe,Be,Qe){const tt=oe[Be];return delete oe[Be],oe[Fe]=tt,le[tt].geometry[0].shift(),le[tt].geometry[0]=Qe[0].concat(le[tt].geometry[0]),tt}function Je(Fe,Be,Qe){const tt=Qe?Be[0][Be[0].length-1]:Be[0][0];return`${Fe}:${tt.x}:${tt.y}`}for(let Fe=0;Fe<J.length;Fe++){const Be=J[Fe],Qe=Be.geometry,tt=Be.text?Be.text.toString():null;if(!tt){K(Fe);continue}const at=Je(tt,Qe),Ue=Je(tt,Qe,!0);if(at in xe&&Ue in oe&&xe[at]!==oe[Ue]){const St=Re(at,Ue,Qe),Dt=ce(at,Ue,le[St].geometry);delete oe[at],delete xe[Ue],xe[Je(tt,le[Dt].geometry,!0)]=Dt,le[St].geometry=null}else at in xe?ce(at,Ue,Qe):Ue in oe?Re(at,Ue,Qe):(K(Fe),oe[at]=O-1,xe[Ue]=O-1)}return le.filter(Fe=>Fe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,oe)=>J.sortKey-oe.sortKey)}update(t,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const o=this.lineVertexArray.length;if(t.segment!==void 0){let u=t.dist(r[t.segment+1]),f=t.dist(r[t.segment]);const m={};for(let _=t.segment+1;_<r.length;_++)m[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:u},_<r.length-1&&(u+=r[_+1].dist(r[_]));for(let _=t.segment||0;_>=0;_--)m[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:f},_>0&&(f+=r[_-1].dist(r[_]));for(let _=0;_<r.length;_++){const w=m[_];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,r,o,u,f,m,_,w,M,I,E,L){const j=t.indexArray,N=t.layoutVertexArray,G=t.segments.prepareSegment(4*r.length,N,j,this.canOverlap?m.sortKey:void 0),J=this.glyphOffsetArray.length,oe=G.vertexLength,xe=this.allowVerticalPlacement&&_===T.ai.vertical?Math.PI/2:0,le=m.text&&m.text.sections;for(let O=0;O<r.length;O++){const{tl:K,tr:ce,bl:Re,br:Je,tex:Fe,pixelOffsetTL:Be,pixelOffsetBR:Qe,minFontScaleX:tt,minFontScaleY:at,glyphOffset:Ue,isSDF:St,sectionIndex:Dt}=r[O],zt=G.vertexLength,It=Ue[1];Rh(N,w.x,w.y,K.x,It+K.y,Fe.x,Fe.y,o,St,Be.x,Be.y,tt,at),Rh(N,w.x,w.y,ce.x,It+ce.y,Fe.x+Fe.w,Fe.y,o,St,Qe.x,Be.y,tt,at),Rh(N,w.x,w.y,Re.x,It+Re.y,Fe.x,Fe.y+Fe.h,o,St,Be.x,Qe.y,tt,at),Rh(N,w.x,w.y,Je.x,It+Je.y,Fe.x+Fe.w,Fe.y+Fe.h,o,St,Qe.x,Qe.y,tt,at),Bp(t.dynamicLayoutVertexArray,w,xe),j.emplaceBack(zt,zt+2,zt+1),j.emplaceBack(zt+1,zt+2,zt+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ue[0]),O!==r.length-1&&Dt===r[O+1].sectionIndex||t.programConfigurations.populatePaintArrays(N.length,m,m.index,{},L,le&&le[Dt])}t.placedSymbolArray.emplaceBack(w.x,w.y,J,this.glyphOffsetArray.length-J,oe,M,I,w.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],_,0,!1,0,E)}_addCollisionDebugVertex(t,r,o,u,f,m){return r.emplaceBack(0,0),t.emplaceBack(o.x,o.y,u,f,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(t,r,o,u,f,m,_){const w=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),M=w.vertexLength,I=f.layoutVertexArray,E=f.collisionVertexArray,L=_.anchorX,j=_.anchorY;this._addCollisionDebugVertex(I,E,m,L,j,new we(t,r)),this._addCollisionDebugVertex(I,E,m,L,j,new we(o,r)),this._addCollisionDebugVertex(I,E,m,L,j,new we(o,u)),this._addCollisionDebugVertex(I,E,m,L,j,new we(t,u)),w.vertexLength+=4;const N=f.indexArray;N.emplaceBack(M,M+1),N.emplaceBack(M+1,M+2),N.emplaceBack(M+2,M+3),N.emplaceBack(M+3,M),w.primitiveLength+=4}addDebugCollisionBoxes(t,r,o,u){for(let f=t;f<r;f++){const m=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,u?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Op(Ve,Ed.members,We),this.iconCollisionBox=new Op(Ve,Ed.members,We);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,o,u,f,m,_,w,M){const I={};for(let E=r;E<o;E++){const L=t.get(E);I.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.textFeatureIndex=L.featureIndex;break}for(let E=u;E<f;E++){const L=t.get(E);I.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalTextFeatureIndex=L.featureIndex;break}for(let E=m;E<_;E++){const L=t.get(E);I.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.iconFeatureIndex=L.featureIndex;break}for(let E=w;E<M;E++){const L=t.get(E);I.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalIconFeatureIndex=L.featureIndex;break}return I}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const o=t.placedSymbolArray.get(r),u=o.vertexStartIndex+4*o.numGlyphs;for(let f=o.vertexStartIndex;f<u;f+=4)t.indexArray.emplaceBack(f,f+2,f+1),t.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),o=Math.cos(t),u=[],f=[],m=[];for(let _=0;_<this.symbolInstances.length;++_){m.push(_);const w=this.symbolInstances.get(_);u.push(0|Math.round(r*w.anchorX+o*w.anchorY)),f.push(w.featureIndex)}return m.sort((_,w)=>u[_]-u[w]||f[w]-f[_]),m}addToSortKeyRanges(t,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((u,f,m)=>{u>=0&&m.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ud,Gd;xt("SymbolBucket",zc,{omit:["layers","collisionBoxArray","features","compareText"]}),zc.MAX_GLYPHS=65535,zc.addDynamicAttributes=Bp;var jp={get paint(){return Gd=Gd||new Er({"icon-opacity":new kt(Q.paint_symbol["icon-opacity"]),"icon-color":new kt(Q.paint_symbol["icon-color"]),"icon-halo-color":new kt(Q.paint_symbol["icon-halo-color"]),"icon-halo-width":new kt(Q.paint_symbol["icon-halo-width"]),"icon-halo-blur":new kt(Q.paint_symbol["icon-halo-blur"]),"icon-translate":new Et(Q.paint_symbol["icon-translate"]),"icon-translate-anchor":new Et(Q.paint_symbol["icon-translate-anchor"]),"text-opacity":new kt(Q.paint_symbol["text-opacity"]),"text-color":new kt(Q.paint_symbol["text-color"],{runtimeType:Qt,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new kt(Q.paint_symbol["text-halo-color"]),"text-halo-width":new kt(Q.paint_symbol["text-halo-width"]),"text-halo-blur":new kt(Q.paint_symbol["text-halo-blur"]),"text-translate":new Et(Q.paint_symbol["text-translate"]),"text-translate-anchor":new Et(Q.paint_symbol["text-translate-anchor"])})},get layout(){return Ud=Ud||new Er({"symbol-placement":new Et(Q.layout_symbol["symbol-placement"]),"symbol-spacing":new Et(Q.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Et(Q.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new kt(Q.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Et(Q.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Et(Q.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Et(Q.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Et(Q.layout_symbol["icon-ignore-placement"]),"icon-optional":new Et(Q.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Et(Q.layout_symbol["icon-rotation-alignment"]),"icon-size":new kt(Q.layout_symbol["icon-size"]),"icon-text-fit":new Et(Q.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Et(Q.layout_symbol["icon-text-fit-padding"]),"icon-image":new kt(Q.layout_symbol["icon-image"]),"icon-rotate":new kt(Q.layout_symbol["icon-rotate"]),"icon-padding":new kt(Q.layout_symbol["icon-padding"]),"icon-keep-upright":new Et(Q.layout_symbol["icon-keep-upright"]),"icon-offset":new kt(Q.layout_symbol["icon-offset"]),"icon-anchor":new kt(Q.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Et(Q.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Et(Q.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Et(Q.layout_symbol["text-rotation-alignment"]),"text-field":new kt(Q.layout_symbol["text-field"]),"text-font":new kt(Q.layout_symbol["text-font"]),"text-size":new kt(Q.layout_symbol["text-size"]),"text-max-width":new kt(Q.layout_symbol["text-max-width"]),"text-line-height":new Et(Q.layout_symbol["text-line-height"]),"text-letter-spacing":new kt(Q.layout_symbol["text-letter-spacing"]),"text-justify":new kt(Q.layout_symbol["text-justify"]),"text-radial-offset":new kt(Q.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Et(Q.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new kt(Q.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new kt(Q.layout_symbol["text-anchor"]),"text-max-angle":new Et(Q.layout_symbol["text-max-angle"]),"text-writing-mode":new Et(Q.layout_symbol["text-writing-mode"]),"text-rotate":new kt(Q.layout_symbol["text-rotate"]),"text-padding":new Et(Q.layout_symbol["text-padding"]),"text-keep-upright":new Et(Q.layout_symbol["text-keep-upright"]),"text-transform":new kt(Q.layout_symbol["text-transform"]),"text-offset":new kt(Q.layout_symbol["text-offset"]),"text-allow-overlap":new Et(Q.layout_symbol["text-allow-overlap"]),"text-overlap":new Et(Q.layout_symbol["text-overlap"]),"text-ignore-placement":new Et(Q.layout_symbol["text-ignore-placement"]),"text-optional":new Et(Q.layout_symbol["text-optional"])})}};class Eu{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:rt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}xt("FormatSectionOverride",Eu,{omit:["defaultValue"]});class Lh extends wo{constructor(t){super(t,jp)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const f of o)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,o,u){const f=this.layout.get(t).evaluate(r,{},o,u),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||Hs(m.value)||!f?f:function(_,w){return w.replace(/{([^{}]+)}/g,(M,I)=>_&&I in _?String(_[I]):"")}(r.properties,f)}createBucket(t){return new zc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of jp.paint.overridableProperties){if(!Lh.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),o=new Eu(r),u=new yo(o,r.property.specification);let f=null;f=r.value.kind==="constant"||r.value.kind==="source"?new rs("source",u):new ll("composite",u,r.value.zoomStops),this.paint._values[t]=new Uo(r.property,f,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&Lh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const o=t.get("text-field"),u=jp.paint.properties[r];let f=!1;const m=_=>{for(const w of _)if(u.overrides&&u.overrides.hasOverride(w))return void(f=!0)};if(o.value.kind==="constant"&&o.value.value instanceof tn)m(o.value.value.sections);else if(o.value.kind==="source"){const _=M=>{f||(M instanceof Fo&&$i(M.value)===_s?m(M.value.sections):M instanceof va?m(M.sections):M.eachChild(_))},w=o.value;w._styleExpression&&_(w._styleExpression.expression)}return f}}let Np;var Zd={get paint(){return Np=Np||new Er({"background-color":new Et(Q.paint_background["background-color"]),"background-pattern":new Go(Q.paint_background["background-pattern"]),"background-opacity":new Et(Q.paint_background["background-opacity"])})}};class $p extends wo{constructor(t){super(t,Zd)}}let Vp;var qd={get paint(){return Vp=Vp||new Er({"raster-opacity":new Et(Q.paint_raster["raster-opacity"]),"raster-hue-rotate":new Et(Q.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Et(Q.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Et(Q.paint_raster["raster-brightness-max"]),"raster-saturation":new Et(Q.paint_raster["raster-saturation"]),"raster-contrast":new Et(Q.paint_raster["raster-contrast"]),"raster-resampling":new Et(Q.paint_raster["raster-resampling"]),"raster-fade-duration":new Et(Q.paint_raster["raster-fade-duration"])})}};class Hd extends wo{constructor(t){super(t,qd)}}class Wd extends wo{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Am{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Up=63710088e-1;class Ga{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ga(pn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,o=this.lat*r,u=t.lat*r,f=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((t.lng-this.lng)*r);return Up*Math.acos(Math.min(f,1))}static convert(t){if(t instanceof Ga)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ga(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ga(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ku=2*Math.PI*Up;function zu(n){return ku*Math.cos(n*Math.PI/180)}function Xd(n){return(180+n)/360}function Kd(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Bh(n,t){return n/zu(t)}function Fh(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Yd(n,t){return n*zu(Fh(t))}class Du{constructor(t,r,o=0){this.x=+t,this.y=+r,this.z=+o}static fromLngLat(t,r=0){const o=Ga.convert(t);return new Du(Xd(o.lng),Kd(o.lat),Bh(r,o.lat))}toLngLat(){return new Ga(360*this.x-180,Fh(this.y))}toAltitude(){return Yd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ku*(t=Fh(this.y),1/Math.cos(t*Math.PI/180));var t}}function Jd(n,t,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[n*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class Gp{constructor(t,r,o){if(!function(u,f,m){return!(u<0||u>25||m<0||m>=Math.pow(2,u)||f<0||f>=Math.pow(2,u))}(t,r,o))throw new Error(`x=${r}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=o,this.key=Dc(0,t,t,r,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,o){const u=(m=this.y,_=this.z,w=Jd(256*(f=this.x),256*(m=Math.pow(2,_)-m-1),_),M=Jd(256*(f+1),256*(m+1),_),w[0]+","+w[1]+","+M[0]+","+M[1]);var f,m,_,w,M;const I=function(E,L,j){let N,G="";for(let J=E;J>0;J--)N=1<<J-1,G+=(L&N?1:0)+(j&N?2:0);return G}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,u)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new we((t.x*r-this.x)*jt,(t.y*r-this.y)*jt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Qd{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Dc(t,r.z,r.z,r.x,r.y)}}class Mo{constructor(t,r,o,u,f){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=r,this.canonical=new Gp(o,+u,+f),this.key=Dc(r,t,o,u,f)}clone(){return new Mo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new Mo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Mo(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?Dc(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Dc(this.wrap*+r,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Mo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new Mo(r,this.wrap,r,o,u),new Mo(r,this.wrap,r,o+1,u),new Mo(r,this.wrap,r,o,u+1),new Mo(r,this.wrap,r,o+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Mo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Mo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Qd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Du(t.x-this.wrap,t.y))}}function Dc(n,t,r,o,u){(n*=2)<0&&(n=-1*n-1);const f=1<<r;return(f*f*n+f*u+o).toString(36)+r.toString(36)+t.toString(36)}xt("CanonicalTileID",Gp),xt("OverscaledTileID",Mo,{omit:["terrainRttPosMatrix32f"]});class ef{constructor(t,r,o,u=1,f=1,m=1,_=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Ji(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const w=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=f,this.blueFactor=m,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<w;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(w,M)]=this.data[this._idx(w-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,w)]=this.data[this._idx(M,w-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(w,-1)]=this.data[this._idx(w-1,0)],this.data[this._idx(-1,w)]=this.data[this._idx(0,w-1)],this.data[this._idx(w,w)]=this.data[this._idx(w-1,w-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<w;M++)for(let I=0;I<w;I++){const E=this.get(M,I);E>this.max&&(this.max=E),E<this.min&&(this.min=E)}}get(t,r){const o=new Uint8Array(this.data.buffer),u=4*this._idx(t,r);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,o){return t*this.redFactor+r*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new co({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,f=r*this.dim+this.dim,m=o*this.dim,_=o*this.dim+this.dim;switch(r){case-1:u=f-1;break;case 1:f=u+1}switch(o){case-1:m=_-1;break;case 1:_=m+1}const w=-r*this.dim,M=-o*this.dim;for(let I=m;I<_;I++)for(let E=u;E<f;E++)this.data[this._idx(E,I)]=t.data[this._idx(E+w,I+M)]}}xt("DEMData",ef);class tf{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const o=t[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class nf{constructor(t,r,o,u,f){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=o,t._y=u,this.properties=t.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class rf{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ta(jt,16,0),this.grid3D=new ta(jt,16,0),this.featureIndexArray=new ne,this.promoteId=r}insert(t,r,o,u,f,m){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,f);const w=m?this.grid3D:this.grid;for(let M=0;M<r.length;M++){const I=r[M],E=[1/0,1/0,-1/0,-1/0];for(let L=0;L<I.length;L++){const j=I[L];E[0]=Math.min(E[0],j.x),E[1]=Math.min(E[1],j.y),E[2]=Math.max(E[2],j.x),E[3]=Math.max(E[3],j.y)}E[0]<jt&&E[1]<jt&&E[2]>=0&&E[3]>=0&&w.insert(_,E[0],E[1],E[2],E[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Pu.VectorTile(new Ip(this.rawTileData)).layers,this.sourceLayerCoder=new tf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,o,u){this.loadVTLayers();const f=t.params,m=jt/t.tileSize/t.scale,_=Ys(f.filter),w=t.queryGeometry,M=t.queryPadding*m,I=Wo(w),E=this.grid.query(I.minX-M,I.minY-M,I.maxX+M,I.maxY+M),L=Wo(t.cameraQueryGeometry),j=this.grid3D.query(L.minX-M,L.minY-M,L.maxX+M,L.maxY+M,(J,oe,xe,le)=>function(O,K,ce,Re,Je){for(const Be of O)if(K<=Be.x&&ce<=Be.y&&Re>=Be.x&&Je>=Be.y)return!0;const Fe=[new we(K,ce),new we(K,Je),new we(Re,Je),new we(Re,ce)];if(O.length>2){for(const Be of Fe)if(Tc(O,Be))return!0}for(let Be=0;Be<O.length-1;Be++)if(ud(O[Be],O[Be+1],Fe))return!0;return!1}(t.cameraQueryGeometry,J-M,oe-M,xe+M,le+M));for(const J of j)E.push(J);E.sort(Em);const N={};let G;for(let J=0;J<E.length;J++){const oe=E[J];if(oe===G)continue;G=oe;const xe=this.featureIndexArray.get(oe);let le=null;this.loadMatchingFeature(N,xe.bucketIndex,xe.sourceLayerIndex,xe.featureIndex,_,f.layers,f.availableImages,r,o,u,(O,K,ce)=>(le||(le=As(O)),K.queryIntersectsFeature({queryGeometry:w,feature:O,featureState:ce,geometry:le,zoom:this.z,transform:t.transform,pixelsToTileUnits:m,pixelPosMatrix:t.pixelPosMatrix})))}return N}loadMatchingFeature(t,r,o,u,f,m,_,w,M,I,E){const L=this.bucketLayerIDs[r];if(m&&!L.some(J=>m.has(J)))return;const j=this.sourceLayerCoder.decode(o),N=this.vtLayers[j].feature(u);if(f.needGeometry){const J=Es(N,!0);if(!f.filter(new Vi(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!f.filter(new Vi(this.tileID.overscaledZ),N))return;const G=this.getId(N,j);for(let J=0;J<L.length;J++){const oe=L[J];if(m&&!m.has(oe))continue;const xe=w[oe];if(!xe)continue;let le={};G&&I&&(le=I.getState(xe.sourceLayer||"_geojsonTileLayer",G));const O=Fi({},M[oe]);O.paint=of(O.paint,xe.paint,N,le,_),O.layout=of(O.layout,xe.layout,N,le,_);const K=!E||E(N,xe,le);if(!K)continue;const ce=new nf(N,this.z,this.x,this.y,G);ce.layer=O;let Re=t[oe];Re===void 0&&(Re=t[oe]=[]),Re.push({featureIndex:u,feature:ce,intersectionZ:K})}}lookupSymbolFeatures(t,r,o,u,f,m,_,w){const M={};this.loadVTLayers();const I=Ys(f);for(const E of t)this.loadMatchingFeature(M,o,u,E,I,m,_,w,r);return M}hasLayer(t){for(const r of this.bucketLayerIDs)for(const o of r)if(t===o)return!0;return!1}getId(t,r){var o;let u=t.id;return this.promoteId&&(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(t.properties.cluster_id))),u}}function of(n,t,r,o,u){return fr(n,(f,m)=>{const _=t instanceof oa?t.get(m):null;return _&&_.evaluate?_.evaluate(r,o,u):_})}function Wo(n){let t=1/0,r=1/0,o=-1/0,u=-1/0;for(const f of n)t=Math.min(t,f.x),r=Math.min(r,f.y),o=Math.max(o,f.x),u=Math.max(u,f.y);return{minX:t,minY:r,maxX:o,maxY:u}}function Em(n,t){return t-n}function sf(n,t,r,o,u){const f=[];for(let m=0;m<n.length;m++){const _=n[m];let w;for(let M=0;M<_.length-1;M++){let I=_[M],E=_[M+1];I.x<t&&E.x<t||(I.x<t?I=new we(t,I.y+(t-I.x)/(E.x-I.x)*(E.y-I.y))._round():E.x<t&&(E=new we(t,I.y+(t-I.x)/(E.x-I.x)*(E.y-I.y))._round()),I.y<r&&E.y<r||(I.y<r?I=new we(I.x+(r-I.y)/(E.y-I.y)*(E.x-I.x),r)._round():E.y<r&&(E=new we(I.x+(r-I.y)/(E.y-I.y)*(E.x-I.x),r)._round()),I.x>=o&&E.x>=o||(I.x>=o?I=new we(o,I.y+(o-I.x)/(E.x-I.x)*(E.y-I.y))._round():E.x>=o&&(E=new we(o,I.y+(o-I.x)/(E.x-I.x)*(E.y-I.y))._round()),I.y>=u&&E.y>=u||(I.y>=u?I=new we(I.x+(u-I.y)/(E.y-I.y)*(E.x-I.x),u)._round():E.y>=u&&(E=new we(I.x+(u-I.y)/(E.y-I.y)*(E.x-I.x),u)._round()),w&&I.equals(w[w.length-1])||(w=[I],f.push(w)),w.push(E)))))}}return f}xt("FeatureIndex",rf,{omit:["rawTileData","sourceLayerCoder"]});class ho extends we{constructor(t,r,o,u){super(t,r),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new ho(this.x,this.y,this.angle,this.segment)}}function ei(n,t,r,o,u){if(t.segment===void 0||r===0)return!0;let f=t,m=t.segment+1,_=0;for(;_>-r/2;){if(m--,m<0)return!1;_-=n[m].dist(f),f=n[m]}_+=n[m].dist(n[m+1]),m++;const w=[];let M=0;for(;_<r/2;){const I=n[m],E=n[m+1];if(!E)return!1;let L=n[m-1].angleTo(I)-I.angleTo(E);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:_,angleDelta:L}),M+=L;_-w[0].distance>o;)M-=w.shift().angleDelta;if(M>u)return!1;m++,_+=I.dist(E)}return!0}function af(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function Kr(n,t,r){return n?.6*t*r:0}function zn(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function km(n,t,r,o,u,f){const m=Kr(r,u,f),_=zn(r,o)*f;let w=0;const M=af(n)/2;for(let I=0;I<n.length-1;I++){const E=n[I],L=n[I+1],j=E.dist(L);if(w+j>M){const N=(M-w)/j,G=io.number(E.x,L.x,N),J=io.number(E.y,L.y,N),oe=new ho(G,J,L.angleTo(E),I);return oe._round(),!m||ei(n,oe,_,m,t)?oe:void 0}w+=j}}function Za(n,t,r,o,u,f,m,_,w){const M=Kr(o,f,m),I=zn(o,u),E=I*m,L=n[0].x===0||n[0].x===w||n[0].y===0||n[0].y===w;return t-E<t/4&&(t=E+t/4),lf(n,L?t/2*_%t:(I/2+2*f)*m*_%t,t,M,r,E,L,!1,w)}function lf(n,t,r,o,u,f,m,_,w){const M=f/2,I=af(n);let E=0,L=t-r,j=[];for(let N=0;N<n.length-1;N++){const G=n[N],J=n[N+1],oe=G.dist(J),xe=J.angleTo(G);for(;L+r<E+oe;){L+=r;const le=(L-E)/oe,O=io.number(G.x,J.x,le),K=io.number(G.y,J.y,le);if(O>=0&&O<w&&K>=0&&K<w&&L-M>=0&&L+M<=I){const ce=new ho(O,K,xe,N);ce._round(),o&&!ei(n,ce,f,o,u)||j.push(ce)}}E+=oe}return _||j.length||m||(j=lf(n,E/2,r,o,u,f,m,!0,w)),j}xt("Anchor",ho);const Ru=Xr;function cf(n,t,r,o){const u=[],f=n.image,m=f.pixelRatio,_=f.paddedRect.w-2*Ru,w=f.paddedRect.h-2*Ru;let M={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const I=f.stretchX||[[0,_]],E=f.stretchY||[[0,w]],L=(Ue,St)=>Ue+St[1]-St[0],j=I.reduce(L,0),N=E.reduce(L,0),G=_-j,J=w-N;let oe=0,xe=j,le=0,O=N,K=0,ce=G,Re=0,Je=J;if(f.content&&o){const Ue=f.content,St=Ue[2]-Ue[0],Dt=Ue[3]-Ue[1];(f.textFitWidth||f.textFitHeight)&&(M=Rp(n)),oe=Oh(I,0,Ue[0]),le=Oh(E,0,Ue[1]),xe=Oh(I,Ue[0],Ue[2]),O=Oh(E,Ue[1],Ue[3]),K=Ue[0]-oe,Re=Ue[1]-le,ce=St-xe,Je=Dt-O}const Fe=M.x1,Be=M.y1,Qe=M.x2-Fe,tt=M.y2-Be,at=(Ue,St,Dt,zt)=>{const It=Rc(Ue.stretch-oe,xe,Qe,Fe),si=jh(Ue.fixed-K,ce,Ue.stretch,j),hn=Rc(St.stretch-le,O,tt,Be),$n=jh(St.fixed-Re,Je,St.stretch,N),pr=Rc(Dt.stretch-oe,xe,Qe,Fe),fo=jh(Dt.fixed-K,ce,Dt.stretch,j),Lr=Rc(zt.stretch-le,O,tt,Be),ir=jh(zt.fixed-Re,Je,zt.stretch,N),sn=new we(It,hn),Xn=new we(pr,hn),nr=new we(pr,Lr),mn=new we(It,Lr),Br=new we(si/m,$n/m),Co=new we(fo/m,ir/m),Kn=t*Math.PI/180;if(Kn){const Un=Math.sin(Kn),Gn=Math.cos(Kn),Dn=[Gn,-Un,Un,Gn];sn._matMult(Dn),Xn._matMult(Dn),mn._matMult(Dn),nr._matMult(Dn)}const Yr=Ue.stretch+Ue.fixed,Vn=St.stretch+St.fixed;return{tl:sn,tr:Xn,bl:mn,br:nr,tex:{x:f.paddedRect.x+Ru+Yr,y:f.paddedRect.y+Ru+Vn,w:Dt.stretch+Dt.fixed-Yr,h:zt.stretch+zt.fixed-Vn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Br,pixelOffsetBR:Co,minFontScaleX:ce/m/Qe,minFontScaleY:Je/m/tt,isSDF:r}};if(o&&(f.stretchX||f.stretchY)){const Ue=uf(I,G,j),St=uf(E,J,N);for(let Dt=0;Dt<Ue.length-1;Dt++){const zt=Ue[Dt],It=Ue[Dt+1];for(let si=0;si<St.length-1;si++)u.push(at(zt,St[si],It,St[si+1]))}}else u.push(at({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:w+1}));return u}function Oh(n,t,r){let o=0;for(const u of n)o+=Math.max(t,Math.min(r,u[1]))-Math.max(t,Math.min(r,u[0]));return o}function uf(n,t,r){const o=[{fixed:-1,stretch:0}];for(const[u,f]of n){const m=o[o.length-1];o.push({fixed:u-m.stretch,stretch:m.stretch}),o.push({fixed:u-m.stretch,stretch:m.stretch+(f-u)})}return o.push({fixed:t+Ru,stretch:r}),o}function Rc(n,t,r,o){return n/t*r+o}function jh(n,t,r,o){return n-t*r/o}class Xo{constructor(t,r,o,u,f,m,_,w,M,I){var E;if(this.boxStartIndex=t.length,M){let L=m.top,j=m.bottom;const N=m.collisionPadding;N&&(L-=N[1],j+=N[3]);let G=j-L;G>0&&(G=Math.max(10,G),this.circleDiameter=G)}else{const L=!((E=m.image)===null||E===void 0)&&E.content&&(m.image.textFitWidth||m.image.textFitHeight)?Rp(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};L.y1=L.y1*_-w[0],L.y2=L.y2*_+w[2],L.x1=L.x1*_-w[3],L.x2=L.x2*_+w[1];const j=m.collisionPadding;if(j&&(L.x1-=j[0]*_,L.y1-=j[1]*_,L.x2+=j[2]*_,L.y2+=j[3]*_),I){const N=new we(L.x1,L.y1),G=new we(L.x2,L.y1),J=new we(L.x1,L.y2),oe=new we(L.x2,L.y2),xe=I*Math.PI/180;N._rotate(xe),G._rotate(xe),J._rotate(xe),oe._rotate(xe),L.x1=Math.min(N.x,G.x,J.x,oe.x),L.x2=Math.max(N.x,G.x,J.x,oe.x),L.y1=Math.min(N.y,G.y,J.y,oe.y),L.y2=Math.max(N.y,G.y,J.y,oe.y)}t.emplaceBack(r.x,r.y,L.x1,L.y1,L.x2,L.y2,o,u,f)}this.boxEndIndex=t.length}}class hf{constructor(t=[],r=(o,u)=>o<u?-1:o>u?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:o}=this,u=r[t];for(;t>0;){const f=t-1>>1,m=r[f];if(o(u,m)>=0)break;r[t]=m,t=f}r[t]=u}_down(t){const{data:r,compare:o}=this,u=this.length>>1,f=r[t];for(;t<u;){let m=1+(t<<1);const _=m+1;if(_<this.length&&o(r[_],r[m])<0&&(m=_),o(r[m],f)>=0)break;r[t]=r[m],t=m}r[t]=f}}function Nh(n,t=1,r=!1){let o=1/0,u=1/0,f=-1/0,m=-1/0;const _=n[0];for(let j=0;j<_.length;j++){const N=_[j];(!j||N.x<o)&&(o=N.x),(!j||N.y<u)&&(u=N.y),(!j||N.x>f)&&(f=N.x),(!j||N.y>m)&&(m=N.y)}const w=Math.min(f-o,m-u);let M=w/2;const I=new hf([],Mn);if(w===0)return new we(o,u);for(let j=o;j<f;j+=w)for(let N=u;N<m;N+=w)I.push(new Ki(j+M,N+M,M,n));let E=function(j){let N=0,G=0,J=0;const oe=j[0];for(let xe=0,le=oe.length,O=le-1;xe<le;O=xe++){const K=oe[xe],ce=oe[O],Re=K.x*ce.y-ce.x*K.y;G+=(K.x+ce.x)*Re,J+=(K.y+ce.y)*Re,N+=3*Re}return new Ki(G/N,J/N,0,j)}(n),L=I.length;for(;I.length;){const j=I.pop();(j.d>E.d||!E.d)&&(E=j,r&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,L)),j.max-E.d<=t||(M=j.h/2,I.push(new Ki(j.p.x-M,j.p.y-M,M,n)),I.push(new Ki(j.p.x+M,j.p.y-M,M,n)),I.push(new Ki(j.p.x-M,j.p.y+M,M,n)),I.push(new Ki(j.p.x+M,j.p.y+M,M,n)),L+=4)}return r&&(console.log(`num probes: ${L}`),console.log(`best distance: ${E.d}`)),E.p}function Mn(n,t){return t.max-n.max}function Ki(n,t,r,o){this.p=new we(n,t),this.h=r,this.d=function(u,f){let m=!1,_=1/0;for(let w=0;w<f.length;w++){const M=f[w];for(let I=0,E=M.length,L=E-1;I<E;L=I++){const j=M[I],N=M[L];j.y>u.y!=N.y>u.y&&u.x<(N.x-j.x)*(u.y-j.y)/(N.y-j.y)+j.x&&(m=!m),_=Math.min(_,bl(u,j,N))}}return(m?1:-1)*Math.sqrt(_)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var tr;T.av=void 0,(tr=T.av||(T.av={}))[tr.center=1]="center",tr[tr.left=2]="left",tr[tr.right=3]="right",tr[tr.top=4]="top",tr[tr.bottom=5]="bottom",tr[tr["top-left"]=6]="top-left",tr[tr["top-right"]=7]="top-right",tr[tr["bottom-left"]=8]="bottom-left",tr[tr["bottom-right"]=9]="bottom-right";const qa=7,Zp=Number.POSITIVE_INFINITY;function pf(n,t){return t[1]!==Zp?function(r,o,u){let f=0,m=0;switch(o=Math.abs(o),u=Math.abs(u),r){case"top-right":case"top-left":case"top":m=u-qa;break;case"bottom-right":case"bottom-left":case"bottom":m=-u+qa}switch(r){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}return[f,m]}(n,t[0],t[1]):function(r,o){let u=0,f=0;o<0&&(o=0);const m=o/Math.SQRT2;switch(r){case"top-right":case"top-left":f=m-qa;break;case"bottom-right":case"bottom-left":f=-m+qa;break;case"bottom":f=-o+qa;break;case"top":f=o-qa}switch(r){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=o;break;case"right":u=-o}return[u,f]}(n,t[0])}function df(n,t,r){var o;const u=n.layout,f=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},r);if(f){const _=f.values,w=[];for(let M=0;M<_.length;M+=2){const I=w[M]=_[M],E=_[M+1].map(L=>L*Nn);I.startsWith("top")?E[1]-=qa:I.startsWith("bottom")&&(E[1]+=qa),w[M+1]=E}return new ur(w)}const m=u.get("text-variable-anchor");if(m){let _;_=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(t,{},r)*Nn,Zp]:u.get("text-offset").evaluate(t,{},r).map(M=>M*Nn);const w=[];for(const M of m)w.push(M,pf(M,_));return new ur(w)}return null}function qp(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function zm(n,t,r,o,u,f,m,_,w,M,I,E){let L=f.textMaxSize.evaluate(t,{});L===void 0&&(L=m);const j=n.layers[0].layout,N=j.get("icon-offset").evaluate(t,{},I),G=Lc(r.horizontal),J=m/24,oe=n.tilePixelRatio*J,xe=n.tilePixelRatio*L/24,le=n.tilePixelRatio*_,O=n.tilePixelRatio*j.get("symbol-spacing"),K=j.get("text-padding")*n.tilePixelRatio,ce=function(Dt,zt,It,si=1){const hn=Dt.get("icon-padding").evaluate(zt,{},It),$n=hn&&hn.values;return[$n[0]*si,$n[1]*si,$n[2]*si,$n[3]*si]}(j,t,I,n.tilePixelRatio),Re=j.get("text-max-angle")/180*Math.PI,Je=j.get("text-rotation-alignment")!=="viewport"&&j.get("symbol-placement")!=="point",Fe=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",Be=j.get("symbol-placement"),Qe=O/2,tt=j.get("icon-text-fit");let at;o&&tt!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(at=Lp(o,r.vertical,tt,j.get("icon-text-fit-padding"),N,J)),G&&(o=Lp(o,G,tt,j.get("icon-text-fit-padding"),N,J)));const Ue=I?E.line.getGranularityForZoomLevel(I.z):1,St=(Dt,zt)=>{zt.x<0||zt.x>=jt||zt.y<0||zt.y>=jt||function(It,si,hn,$n,pr,fo,Lr,ir,sn,Xn,nr,mn,Br,Co,Kn,Yr,Vn,Un,Gn,Dn,Ui,hs,Fc,ps,Dm){const Oc=It.addToLineVertexArray(si,hn);let kl,jc,Nc,$c,_f=0,yf=0,vf=0,xf=0,Yp=-1,Jp=-1;const pa={};let bf=Ti("");if(It.allowVerticalPlacement&&$n.vertical){const vr=ir.layout.get("text-rotate").evaluate(Ui,{},ps)+90;Nc=new Xo(sn,si,Xn,nr,mn,$n.vertical,Br,Co,Kn,vr),Lr&&($c=new Xo(sn,si,Xn,nr,mn,Lr,Vn,Un,Kn,vr))}if(pr){const vr=ir.layout.get("icon-rotate").evaluate(Ui,{}),an=ir.layout.get("icon-text-fit")!=="none",da=cf(pr,vr,Fc,an),fs=Lr?cf(Lr,vr,Fc,an):void 0;jc=new Xo(sn,si,Xn,nr,mn,pr,Vn,Un,!1,vr),_f=4*da.length;const zl=It.iconSizeData;let Bs=null;zl.kind==="source"?(Bs=[Rs*ir.layout.get("icon-size").evaluate(Ui,{})],Bs[0]>Ua&&Ji(`${It.layerIds[0]}: Value for "icon-size" is >= ${Au}. Reduce your "icon-size".`)):zl.kind==="composite"&&(Bs=[Rs*hs.compositeIconSizes[0].evaluate(Ui,{},ps),Rs*hs.compositeIconSizes[1].evaluate(Ui,{},ps)],(Bs[0]>Ua||Bs[1]>Ua)&&Ji(`${It.layerIds[0]}: Value for "icon-size" is >= ${Au}. Reduce your "icon-size".`)),It.addSymbols(It.icon,da,Bs,Dn,Gn,Ui,T.ai.none,si,Oc.lineStartIndex,Oc.lineLength,-1,ps),Yp=It.icon.placedSymbolArray.length-1,fs&&(yf=4*fs.length,It.addSymbols(It.icon,fs,Bs,Dn,Gn,Ui,T.ai.vertical,si,Oc.lineStartIndex,Oc.lineLength,-1,ps),Jp=It.icon.placedSymbolArray.length-1)}const wf=Object.keys($n.horizontal);for(const vr of wf){const an=$n.horizontal[vr];if(!kl){bf=Ti(an.text);const fs=ir.layout.get("text-rotate").evaluate(Ui,{},ps);kl=new Xo(sn,si,Xn,nr,mn,an,Br,Co,Kn,fs)}const da=an.positionedLines.length===1;if(vf+=Hp(It,si,an,fo,ir,Kn,Ui,Yr,Oc,$n.vertical?T.ai.horizontal:T.ai.horizontalOnly,da?wf:[vr],pa,Yp,hs,ps),da)break}$n.vertical&&(xf+=Hp(It,si,$n.vertical,fo,ir,Kn,Ui,Yr,Oc,T.ai.vertical,["vertical"],pa,Jp,hs,ps));const Rm=kl?kl.boxStartIndex:It.collisionBoxArray.length,Lm=kl?kl.boxEndIndex:It.collisionBoxArray.length,Bm=Nc?Nc.boxStartIndex:It.collisionBoxArray.length,Fm=Nc?Nc.boxEndIndex:It.collisionBoxArray.length,Om=jc?jc.boxStartIndex:It.collisionBoxArray.length,Qp=jc?jc.boxEndIndex:It.collisionBoxArray.length,Tf=$c?$c.boxStartIndex:It.collisionBoxArray.length,Sf=$c?$c.boxEndIndex:It.collisionBoxArray.length;let ds=-1;const Gh=(vr,an)=>vr&&vr.circleDiameter?Math.max(vr.circleDiameter,an):an;ds=Gh(kl,ds),ds=Gh(Nc,ds),ds=Gh(jc,ds),ds=Gh($c,ds);const Pf=ds>-1?1:0;Pf&&(ds*=Dm/Nn),It.glyphOffsetArray.length>=zc.MAX_GLYPHS&&Ji("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ui.sortKey!==void 0&&It.addToSortKeyRanges(It.symbolInstances.length,Ui.sortKey);const ed=df(ir,Ui,ps),[jm,Nm]=function(vr,an){const da=vr.length,fs=an==null?void 0:an.values;if((fs==null?void 0:fs.length)>0)for(let zl=0;zl<fs.length;zl+=2){const Bs=fs[zl+1];vr.emplaceBack(T.av[fs[zl]],Bs[0],Bs[1])}return[da,vr.length]}(It.textAnchorOffsets,ed);It.symbolInstances.emplaceBack(si.x,si.y,pa.right>=0?pa.right:-1,pa.center>=0?pa.center:-1,pa.left>=0?pa.left:-1,pa.vertical||-1,Yp,Jp,bf,Rm,Lm,Bm,Fm,Om,Qp,Tf,Sf,Xn,vf,xf,_f,yf,Pf,0,Br,ds,jm,Nm)}(n,zt,Dt,r,o,u,at,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,oe,[K,K,K,K],Je,w,le,ce,Fe,N,t,f,M,I,m)};if(Be==="line")for(const Dt of sf(t.geometry,0,0,jt,jt)){const zt=$a(Dt,Ue),It=Za(zt,O,Re,r.vertical||G,o,24,xe,n.overscaling,jt);for(const si of It)G&&Wp(n,G.text,Qe,si)||St(zt,si)}else if(Be==="line-center"){for(const Dt of t.geometry)if(Dt.length>1){const zt=$a(Dt,Ue),It=km(zt,Re,r.vertical||G,o,24,xe);It&&St(zt,It)}}else if(t.type==="Polygon")for(const Dt of hr(t.geometry,0)){const zt=Nh(Dt,16);St($a(Dt[0],Ue,!0),new ho(zt.x,zt.y,0))}else if(t.type==="LineString")for(const Dt of t.geometry){const zt=$a(Dt,Ue);St(zt,new ho(zt[0].x,zt[0].y,0))}else if(t.type==="Point")for(const Dt of t.geometry)for(const zt of Dt)St([zt],new ho(zt.x,zt.y,0))}function Hp(n,t,r,o,u,f,m,_,w,M,I,E,L,j,N){const G=function(xe,le,O,K,ce,Re,Je,Fe){const Be=K.layout.get("text-rotate").evaluate(Re,{})*Math.PI/180,Qe=[];for(const tt of le.positionedLines)for(const at of tt.positionedGlyphs){if(!at.rect)continue;const Ue=at.rect||{};let St=gm+1,Dt=!0,zt=1,It=0;const si=(ce||Fe)&&at.vertical,hn=at.metrics.advance*at.scale/2;if(Fe&&le.verticalizable&&(It=tt.lineOffset/2-(at.imageName?-(Nn-at.metrics.width*at.scale)/2:(at.scale-1)*Nn)),at.imageName){const Un=Je[at.imageName];Dt=Un.sdf,zt=Un.pixelRatio,St=Xr/zt}const $n=ce?[at.x+hn,at.y]:[0,0];let pr=ce?[0,0]:[at.x+hn+O[0],at.y+O[1]-It],fo=[0,0];si&&(fo=pr,pr=[0,0]);const Lr=at.metrics.isDoubleResolution?2:1,ir=(at.metrics.left-St)*at.scale-hn+pr[0],sn=(-at.metrics.top-St)*at.scale+pr[1],Xn=ir+Ue.w/Lr*at.scale/zt,nr=sn+Ue.h/Lr*at.scale/zt,mn=new we(ir,sn),Br=new we(Xn,sn),Co=new we(ir,nr),Kn=new we(Xn,nr);if(si){const Un=new we(-hn,hn-zh),Gn=-Math.PI/2,Dn=Nn/2-hn,Ui=new we(5-zh-Dn,-(at.imageName?Dn:0)),hs=new we(...fo);mn._rotateAround(Gn,Un)._add(Ui)._add(hs),Br._rotateAround(Gn,Un)._add(Ui)._add(hs),Co._rotateAround(Gn,Un)._add(Ui)._add(hs),Kn._rotateAround(Gn,Un)._add(Ui)._add(hs)}if(Be){const Un=Math.sin(Be),Gn=Math.cos(Be),Dn=[Gn,-Un,Un,Gn];mn._matMult(Dn),Br._matMult(Dn),Co._matMult(Dn),Kn._matMult(Dn)}const Yr=new we(0,0),Vn=new we(0,0);Qe.push({tl:mn,tr:Br,bl:Co,br:Kn,tex:Ue,writingMode:le.writingMode,glyphOffset:$n,sectionIndex:at.sectionIndex,isSDF:Dt,pixelOffsetTL:Yr,pixelOffsetBR:Vn,minFontScaleX:0,minFontScaleY:0})}return Qe}(0,r,_,u,f,m,o,n.allowVerticalPlacement),J=n.textSizeData;let oe=null;J.kind==="source"?(oe=[Rs*u.layout.get("text-size").evaluate(m,{})],oe[0]>Ua&&Ji(`${n.layerIds[0]}: Value for "text-size" is >= ${Au}. Reduce your "text-size".`)):J.kind==="composite"&&(oe=[Rs*j.compositeTextSizes[0].evaluate(m,{},N),Rs*j.compositeTextSizes[1].evaluate(m,{},N)],(oe[0]>Ua||oe[1]>Ua)&&Ji(`${n.layerIds[0]}: Value for "text-size" is >= ${Au}. Reduce your "text-size".`)),n.addSymbols(n.text,G,oe,_,f,m,M,t,w.lineStartIndex,w.lineLength,L,N);for(const xe of I)E[xe]=n.text.placedSymbolArray.length-1;return 4*G.length}function Lc(n){for(const t in n)return n[t];return null}function Wp(n,t,r,o){const u=n.compareText;if(t in u){const f=u[t];for(let m=f.length-1;m>=0;m--)if(o.dist(f[m])<r)return!0}else u[t]=[];return u[t].push(o),!1}const ff=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $h{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,o]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=ff[15&o];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[_]=new Uint32Array(t,4,1);return new $h(_,m,f,t)}constructor(t,r=64,o=Float64Array,u){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const f=ff.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,_=t*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-_%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+w,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+_+w),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+w,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=r,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Bc(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:_}=this,w=[0,f.length-1,0],M=[];for(;w.length;){const I=w.pop()||0,E=w.pop()||0,L=w.pop()||0;if(E-L<=_){for(let J=L;J<=E;J++){const oe=m[2*J],xe=m[2*J+1];oe>=t&&oe<=o&&xe>=r&&xe<=u&&M.push(f[J])}continue}const j=L+E>>1,N=m[2*j],G=m[2*j+1];N>=t&&N<=o&&G>=r&&G<=u&&M.push(f[j]),(I===0?t<=N:r<=G)&&(w.push(L),w.push(j-1),w.push(1-I)),(I===0?o>=N:u>=G)&&(w.push(j+1),w.push(E),w.push(1-I))}return M}within(t,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:m}=this,_=[0,u.length-1,0],w=[],M=o*o;for(;_.length;){const I=_.pop()||0,E=_.pop()||0,L=_.pop()||0;if(E-L<=m){for(let J=L;J<=E;J++)mf(f[2*J],f[2*J+1],t,r)<=M&&w.push(u[J]);continue}const j=L+E>>1,N=f[2*j],G=f[2*j+1];mf(N,G,t,r)<=M&&w.push(u[j]),(I===0?t-o<=N:r-o<=G)&&(_.push(L),_.push(j-1),_.push(1-I)),(I===0?t+o>=N:r+o>=G)&&(_.push(j+1),_.push(E),_.push(1-I))}return w}}function Bc(n,t,r,o,u,f){if(u-o<=r)return;const m=o+u>>1;po(n,t,m,o,u,f),Bc(n,t,r,o,m-1,1-f),Bc(n,t,r,m+1,u,1-f)}function po(n,t,r,o,u,f){for(;u>o;){if(u-o>600){const M=u-o+1,I=r-o+1,E=Math.log(M),L=.5*Math.exp(2*E/3),j=.5*Math.sqrt(E*L*(M-L)/M)*(I-M/2<0?-1:1);po(n,t,r,Math.max(o,Math.floor(r-I*L/M+j)),Math.min(u,Math.floor(r+(M-I)*L/M+j)),f)}const m=t[2*r+f];let _=o,w=u;for(Ls(n,t,o,r),t[2*u+f]>m&&Ls(n,t,o,u);_<w;){for(Ls(n,t,_,w),_++,w--;t[2*_+f]<m;)_++;for(;t[2*w+f]>m;)w--}t[2*o+f]===m?Ls(n,t,o,w):(w++,Ls(n,t,w,u)),w<=r&&(o=w+1),r<=w&&(u=w-1)}}function Ls(n,t,r,o){Xp(n,r,o),Xp(t,2*r,2*o),Xp(t,2*r+1,2*o+1)}function Xp(n,t,r){const o=n[t];n[t]=n[r],n[r]=o}function mf(n,t,r,o){const u=n-r,f=t-o;return u*u+f*f}var Kp;T.ce=void 0,(Kp=T.ce||(T.ce={})).create="create",Kp.load="load",Kp.fullLoad="fullLoad";let Vh=null,Lu=[];const Uh=1e3/60,us="loadTime",ii="fullLoadTime",gf={mark(n){performance.mark(n)},frame(n){const t=n;Vh!=null&&Lu.push(t-Vh),Vh=t},clearMetrics(){Vh=null,Lu=[],performance.clearMeasures(us),performance.clearMeasures(ii);for(const n in T.ce)performance.clearMarks(T.ce[n])},getPerformanceMetrics(){performance.measure(us,T.ce.create,T.ce.load),performance.measure(ii,T.ce.create,T.ce.fullLoad);const n=performance.getEntriesByName(us)[0].duration,t=performance.getEntriesByName(ii)[0].duration,r=Lu.length,o=1/(Lu.reduce((f,m)=>f+m,0)/r/1e3),u=Lu.filter(f=>f>Uh).reduce((f,m)=>f+(m-Uh)/Uh,0);return{loadTime:n,fullLoadTime:t,fps:o,percentDroppedFrames:u/(r+u)*100,totalFrames:r}}};T.$=be,T.A=ct,T.B=bo,T.C=function(n){if(mi==null){const t=n.navigator?n.navigator.userAgent:null;mi=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return mi},T.D=Et,T.E=En,T.F=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Am(()=>this.process()),this.subscription=function(r,o,u,f){return r.addEventListener(o,u,!1),{unsubscribe:()=>{r.removeEventListener(o,u,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Zn(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((r,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[u]={resolve:r,reject:o},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[u];const _={id:u,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)},{once:!0});const f=[],m=Object.assign(Object.assign({},n),{id:u,sourceMapId:this.mapId,origin:location.origin,data:dl(n.data,f)});this.target.postMessage(m,{transfer:f})})}receive(n){const t=n.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const o=this.abortControllers[r];return delete this.abortControllers[r],void(o&&o.abort())}if(Zn(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return a(this,void 0,void 0,function*(){if(t.type==="<response>"){const u=this.resolveRejects[n];return delete this.resolveRejects[n],u?void(t.error?u.reject(Ps(t.error)):u.resolve(Ps(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Ps(t.data),o=new AbortController;this.abortControllers[n]=o;try{const u=yield this.messageHandlers[t.type](t.sourceMapId,r,o);this.completeTask(n,null,u)}catch(u){this.completeTask(n,u)}})}completeTask(n,t,r){const o=[];delete this.abortControllers[n];const u={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?dl(t):null,data:dl(r,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},T.G=Bn,T.H=function(){var n=new ct(16);return ct!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},T.I=kp,T.J=function(n,t,r){var o,u,f,m,_,w,M,I,E,L,j,N,G=r[0],J=r[1],oe=r[2];return t===n?(n[12]=t[0]*G+t[4]*J+t[8]*oe+t[12],n[13]=t[1]*G+t[5]*J+t[9]*oe+t[13],n[14]=t[2]*G+t[6]*J+t[10]*oe+t[14],n[15]=t[3]*G+t[7]*J+t[11]*oe+t[15]):(u=t[1],f=t[2],m=t[3],_=t[4],w=t[5],M=t[6],I=t[7],E=t[8],L=t[9],j=t[10],N=t[11],n[0]=o=t[0],n[1]=u,n[2]=f,n[3]=m,n[4]=_,n[5]=w,n[6]=M,n[7]=I,n[8]=E,n[9]=L,n[10]=j,n[11]=N,n[12]=o*G+_*J+E*oe+t[12],n[13]=u*G+w*J+L*oe+t[13],n[14]=f*G+M*J+j*oe+t[14],n[15]=m*G+I*J+N*oe+t[15]),n},T.K=function(n,t,r){var o=r[0],u=r[1],f=r[2];return n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n[3]=t[3]*o,n[4]=t[4]*u,n[5]=t[5]*u,n[6]=t[6]*u,n[7]=t[7]*u,n[8]=t[8]*f,n[9]=t[9]*f,n[10]=t[10]*f,n[11]=t[11]*f,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},T.L=function(n,t,r){var o=t[0],u=t[1],f=t[2],m=t[3],_=t[4],w=t[5],M=t[6],I=t[7],E=t[8],L=t[9],j=t[10],N=t[11],G=t[12],J=t[13],oe=t[14],xe=t[15],le=r[0],O=r[1],K=r[2],ce=r[3];return n[0]=le*o+O*_+K*E+ce*G,n[1]=le*u+O*w+K*L+ce*J,n[2]=le*f+O*M+K*j+ce*oe,n[3]=le*m+O*I+K*N+ce*xe,n[4]=(le=r[4])*o+(O=r[5])*_+(K=r[6])*E+(ce=r[7])*G,n[5]=le*u+O*w+K*L+ce*J,n[6]=le*f+O*M+K*j+ce*oe,n[7]=le*m+O*I+K*N+ce*xe,n[8]=(le=r[8])*o+(O=r[9])*_+(K=r[10])*E+(ce=r[11])*G,n[9]=le*u+O*w+K*L+ce*J,n[10]=le*f+O*M+K*j+ce*oe,n[11]=le*m+O*I+K*N+ce*xe,n[12]=(le=r[12])*o+(O=r[13])*_+(K=r[14])*E+(ce=r[15])*G,n[13]=le*u+O*w+K*L+ce*J,n[14]=le*f+O*M+K*j+ce*oe,n[15]=le*m+O*I+K*N+ce*xe,n},T.M=function(n,t){const r={};for(let o=0;o<t.length;o++){const u=t[o];u in n&&(r[u]=n[u])}return r},T.N=Ga,T.O=Xd,T.P=we,T.Q=Kd,T.R=co,T.S=Mo,T.T=fu,T.U=gt,T.V=nt,T.W=Qi,T.X=jt,T.Y=Du,T.Z=Gp,T._=a,T.a=lr,T.a$=function(){return new Float64Array(16)},T.a0=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const o of n){const u=window.document.createElement("source");Mr(o)||(t.crossOrigin="Anonymous"),u.src=o,t.appendChild(u)}})},T.a1=function(){return Tr++},T.a2=d,T.a3=zc,T.a4=Ys,T.a5=Es,T.a6=nf,T.a7=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,u,f)=>{const m=u||f;return t[o]=!m||m.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},T.a8=function(n){return Math.log(n)/Math.LN2},T.a9=function(n){var t=n[0],r=n[1];return t*t+r*r},T.aA=wn,T.aB=Sh,T.aC=ie,T.aD=_t,T.aE=je,T.aF=85.051129,T.aG=function(n){return Math.pow(2,n)},T.aH=Bh,T.aI=pn,T.aJ=yn,T.aK=Yd,T.aL=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n},T.aM=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n},T.aN=function(n){var t=new ct(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},T.aO=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},T.aP=function(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n},T.aQ=function(n,t){var r=t[0],o=t[1],u=t[2],f=r*r+o*o+u*u;return f>0&&(f=1/Math.sqrt(f)),n[0]=t[0]*f,n[1]=t[1]*f,n[2]=t[2]*f,n},T.aR=function(n,t,r){var o=t[0],u=t[1],f=t[2],m=r[0],_=r[1],w=r[2];return n[0]=u*w-f*_,n[1]=f*m-o*w,n[2]=o*_-u*m,n},T.aS=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},T.aT=Qd,T.aU=Dc,T.aV=function(n,t,r,o,u){var f,m=1/Math.tan(t/2);return n[0]=m/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,u!=null&&u!==1/0?(n[10]=(u+o)*(f=1/(o-u)),n[14]=2*u*o*f):(n[10]=-1,n[14]=-2*o),n},T.aW=function(n){var t=new ct(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},T.aX=function(n,t,r){var o=Math.sin(r),u=Math.cos(r),f=t[0],m=t[1],_=t[2],w=t[3],M=t[4],I=t[5],E=t[6],L=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=f*u+M*o,n[1]=m*u+I*o,n[2]=_*u+E*o,n[3]=w*u+L*o,n[4]=M*u-f*o,n[5]=I*u-m*o,n[6]=E*u-_*o,n[7]=L*u-w*o,n},T.aY=function(n,t,r){var o=Math.sin(r),u=Math.cos(r),f=t[4],m=t[5],_=t[6],w=t[7],M=t[8],I=t[9],E=t[10],L=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=f*u+M*o,n[5]=m*u+I*o,n[6]=_*u+E*o,n[7]=w*u+L*o,n[8]=M*u-f*o,n[9]=I*u-m*o,n[10]=E*u-_*o,n[11]=L*u-w*o,n},T.aZ=function(){const n=new Float32Array(16);return $t(n),n},T.a_=function(){const n=new Float64Array(16);return $t(n),n},T.aa=function(n){return n*Math.PI/180},T.ab=wr,T.ac=function(n,t){const r=[];for(const o in n)o in t||r.push(o);return r},T.ad=Pt,T.ae=function(n){return Math.hypot(n[0],n[1])},T.af=function(n){return n[0]=0,n[1]=0,n},T.ag=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n},T.ah=function(n,t){let r=0,o=0;if(n.kind==="constant")o=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:u,minZoom:f,maxZoom:m}=n,_=u?wr(Ci.interpolationFactor(u,t,f,m),0,1):0;n.kind==="camera"?o=io.number(n.minSize,n.maxSize,_):r=_}return{uSizeT:r,uSize:o}},T.aj=function(n,{uSize:t,uSizeT:r},{lowerSize:o,upperSize:u}){return n.kind==="source"?o/Rs:n.kind==="composite"?io.number(o/Rs,u/Rs,r):t},T.ak=Bp,T.al=Ot,T.am=function(n,t,r,o){const u=t.y-n.y,f=t.x-n.x,m=o.y-r.y,_=o.x-r.x,w=m*f-_*u;if(w===0)return null;const M=(_*(n.y-r.y)-m*(n.x-r.x))/w;return new we(n.x+M*f,n.y+M*u)},T.an=function(n,t){var r=t[0],o=t[1],u=t[2],f=t[3],m=t[4],_=t[5],w=t[6],M=t[7],I=t[8],E=t[9],L=t[10],j=t[11],N=t[12],G=t[13],J=t[14],oe=t[15],xe=r*_-o*m,le=r*w-u*m,O=r*M-f*m,K=o*w-u*_,ce=o*M-f*_,Re=u*M-f*w,Je=I*G-E*N,Fe=I*J-L*N,Be=I*oe-j*N,Qe=E*J-L*G,tt=E*oe-j*G,at=L*oe-j*J,Ue=xe*at-le*tt+O*Qe+K*Be-ce*Fe+Re*Je;return Ue?(n[0]=(_*at-w*tt+M*Qe)*(Ue=1/Ue),n[1]=(u*tt-o*at-f*Qe)*Ue,n[2]=(G*Re-J*ce+oe*K)*Ue,n[3]=(L*ce-E*Re-j*K)*Ue,n[4]=(w*Be-m*at-M*Fe)*Ue,n[5]=(r*at-u*Be+f*Fe)*Ue,n[6]=(J*O-N*Re-oe*le)*Ue,n[7]=(I*Re-L*O+j*le)*Ue,n[8]=(m*tt-_*Be+M*Je)*Ue,n[9]=(o*Be-r*tt-f*Je)*Ue,n[10]=(N*ce-G*O+oe*xe)*Ue,n[11]=(E*O-I*ce-j*xe)*Ue,n[12]=(_*Fe-m*Qe-w*Je)*Ue,n[13]=(r*Qe-o*Fe+u*Je)*Ue,n[14]=(G*le-N*K-J*xe)*Ue,n[15]=(I*K-E*le+L*xe)*Ue,n):null},T.ao=sf,T.ap=vu,T.aq=$t,T.ar=function(n){let t=1/0,r=1/0,o=-1/0,u=-1/0;for(const f of n)t=Math.min(t,f.x),r=Math.min(r,f.y),o=Math.max(o,f.x),u=Math.max(u,f.y);return[t,r,o,u]},T.as=Nn,T.at=gi,T.au=function(n,t,r,o,u=!1){if(!r[0]&&!r[1])return[0,0];const f=u?o==="map"?-n.bearingInRadians:0:o==="viewport"?n.bearingInRadians:0;if(f){const m=Math.sin(f),_=Math.cos(f);r=[r[0]*_-r[1]*m,r[0]*m+r[1]*_]}return[u?r[0]:gi(t,r[0],n.zoom),u?r[1]:gi(t,r[1],n.zoom)]},T.aw=kc,T.ax=qp,T.ay=Dp,T.az=$h,T.b=Sr,T.b$=n=>n.type==="line",T.b0=function(n,t,r){const o=new Float64Array(4);return function(u,f,m,_){var w=.5*Math.PI/180;f*=w,m*=w,_*=w;var M=Math.sin(f),I=Math.cos(f),E=Math.sin(m),L=Math.cos(m),j=Math.sin(_),N=Math.cos(_);u[0]=M*L*N-I*E*j,u[1]=I*E*N+M*L*j,u[2]=I*L*j-M*E*N,u[3]=I*L*N+M*E*j}(o,n,t-90,r),o},T.b1=function(n,t,r,o){var u,f,m,_,w,M=t[0],I=t[1],E=t[2],L=t[3],j=r[0],N=r[1],G=r[2],J=r[3];return(f=M*j+I*N+E*G+L*J)<0&&(f=-f,j=-j,N=-N,G=-G,J=-J),1-f>Xe?(u=Math.acos(f),m=Math.sin(u),_=Math.sin((1-o)*u)/m,w=Math.sin(o*u)/m):(_=1-o,w=o),n[0]=_*M+w*j,n[1]=_*I+w*N,n[2]=_*E+w*G,n[3]=_*L+w*J,n},T.b2=function(n){const t=new Float64Array(9);var r,o,u,f,m,_,w,M,I,E,L,j,N,G,J,oe,xe,le;E=(u=(o=n)[0])*(w=u+u),L=(f=o[1])*w,N=(m=o[2])*w,G=m*(M=f+f),oe=(_=o[3])*w,xe=_*M,le=_*(I=m+m),(r=t)[0]=1-(j=f*M)-(J=m*I),r[3]=L-le,r[6]=N+xe,r[1]=L+le,r[4]=1-E-J,r[7]=G-oe,r[2]=N-xe,r[5]=G+oe,r[8]=1-E-j;const O=yn(-Math.asin(wr(t[2],-1,1)));let K,ce;return Math.hypot(t[5],t[8])<.001?(K=0,ce=-yn(Math.atan2(t[3],t[4]))):(K=yn(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),ce=yn(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:K,pitch:O+90,bearing:ce}},T.b3=function(n,t){return n.roll==t.roll&&n.pitch==t.pitch&&n.bearing==t.bearing},T.b4=Kt,T.b5=So,T.b6=Ic,T.b7=Su,T.b8=Ml,T.b9=cn,T.bA=fr,T.bB=mr,T.bC=class extends kr{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},T.bD=class extends kr{constructor(n,t){super(n,t),this.current=Is}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},T.bE=Oa,T.bF=ca,T.bG=class extends kr{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},T.bH=class extends kr{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},T.bI=Tt,T.bJ=function(n,t){var r=Math.sin(t),o=Math.cos(t);return n[0]=o,n[1]=r,n[2]=0,n[3]=-r,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},T.bK=function(n,t,r){var o=t[0],u=t[1],f=t[2];return n[0]=o*r[0]+u*r[3]+f*r[6],n[1]=o*r[1]+u*r[4]+f*r[7],n[2]=o*r[2]+u*r[5]+f*r[8],n},T.bL=function(n,t,r,o,u,f,m){var _=1/(t-r),w=1/(o-u),M=1/(f-m);return n[0]=-2*_,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*M,n[11]=0,n[12]=(t+r)*_,n[13]=(u+o)*w,n[14]=(m+f)*M,n[15]=1,n},T.bM=class extends gu{},T.bN=pm,T.bO=class extends Cs{},T.bP=xh,T.bQ=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},T.bR=hd,T.bS=function(n,t,r){var o=t[0],u=t[1],f=t[2],m=r[3]*o+r[7]*u+r[11]*f+r[15];return n[0]=(r[0]*o+r[4]*u+r[8]*f+r[12])/(m=m||1),n[1]=(r[1]*o+r[5]*u+r[9]*f+r[13])/m,n[2]=(r[2]*o+r[6]*u+r[10]*f+r[14])/m,n},T.bT=class extends On{},T.bU=class extends i{},T.bV=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},T.bW=function(n,t){var r=n[0],o=n[1],u=n[2],f=n[3],m=n[4],_=n[5],w=n[6],M=n[7],I=n[8],E=n[9],L=n[10],j=n[11],N=n[12],G=n[13],J=n[14],oe=n[15],xe=t[0],le=t[1],O=t[2],K=t[3],ce=t[4],Re=t[5],Je=t[6],Fe=t[7],Be=t[8],Qe=t[9],tt=t[10],at=t[11],Ue=t[12],St=t[13],Dt=t[14],zt=t[15];return Math.abs(r-xe)<=Xe*Math.max(1,Math.abs(r),Math.abs(xe))&&Math.abs(o-le)<=Xe*Math.max(1,Math.abs(o),Math.abs(le))&&Math.abs(u-O)<=Xe*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(f-K)<=Xe*Math.max(1,Math.abs(f),Math.abs(K))&&Math.abs(m-ce)<=Xe*Math.max(1,Math.abs(m),Math.abs(ce))&&Math.abs(_-Re)<=Xe*Math.max(1,Math.abs(_),Math.abs(Re))&&Math.abs(w-Je)<=Xe*Math.max(1,Math.abs(w),Math.abs(Je))&&Math.abs(M-Fe)<=Xe*Math.max(1,Math.abs(M),Math.abs(Fe))&&Math.abs(I-Be)<=Xe*Math.max(1,Math.abs(I),Math.abs(Be))&&Math.abs(E-Qe)<=Xe*Math.max(1,Math.abs(E),Math.abs(Qe))&&Math.abs(L-tt)<=Xe*Math.max(1,Math.abs(L),Math.abs(tt))&&Math.abs(j-at)<=Xe*Math.max(1,Math.abs(j),Math.abs(at))&&Math.abs(N-Ue)<=Xe*Math.max(1,Math.abs(N),Math.abs(Ue))&&Math.abs(G-St)<=Xe*Math.max(1,Math.abs(G),Math.abs(St))&&Math.abs(J-Dt)<=Xe*Math.max(1,Math.abs(J),Math.abs(Dt))&&Math.abs(oe-zt)<=Xe*Math.max(1,Math.abs(oe),Math.abs(zt))},T.bX=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},T.bY=n=>n.type==="symbol",T.bZ=n=>n.type==="circle",T.b_=n=>n.type==="heatmap",T.ba=Yi,T.bb=Qn,T.bc=function(n,t,r,o,u){return cn(o,u,wr((n-t)/(r-t),0,1))},T.bd=Pi,T.be=function(){return new Float64Array(4)},T.bf=function(){return new Float64Array(3)},T.bg=function(n,t,r,o){var u=[],f=[];return u[0]=t[0]-r[0],u[1]=t[1]-r[1],u[2]=t[2]-r[2],f[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),f[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),f[2]=u[2],n[0]=f[0]+r[0],n[1]=f[1]+r[1],n[2]=f[2]+r[2],n},T.bh=function(n,t,r,o){var u=[],f=[];return u[0]=t[0]-r[0],u[1]=t[1]-r[1],u[2]=t[2]-r[2],f[0]=u[0],f[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),f[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),n[0]=f[0]+r[0],n[1]=f[1]+r[1],n[2]=f[2]+r[2],n},T.bi=function(n,t,r,o){var u=[],f=[];return u[0]=t[0]-r[0],u[1]=t[1]-r[1],u[2]=t[2]-r[2],f[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),f[1]=u[1],f[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),n[0]=f[0]+r[0],n[1]=f[1]+r[1],n[2]=f[2]+r[2],n},T.bj=function(n,t,r){var o=Math.sin(r),u=Math.cos(r),f=t[0],m=t[1],_=t[2],w=t[3],M=t[8],I=t[9],E=t[10],L=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=f*u-M*o,n[1]=m*u-I*o,n[2]=_*u-E*o,n[3]=w*u-L*o,n[8]=f*o+M*u,n[9]=m*o+I*u,n[10]=_*o+E*u,n[11]=w*o+L*u,n},T.bk=function(n,t){const r=Pi(n,360),o=Pi(t,360),u=o-r,f=o>r?u-360:u+360;return Math.abs(u)<Math.abs(f)?u:f},T.bl=function(n){return n[0]=0,n[1]=0,n[2]=0,n},T.bm=function(n,t,r,o){const u=Math.sqrt(n*n+t*t),f=Math.sqrt(r*r+o*o);n/=u,t/=u,r/=f,o/=f;const m=Math.acos(n*r+t*o);return-t*r+n*o>0?m:-m},T.bn=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]},T.bo=Up,T.bp=function(n,t){const r=Pi(n,2*Math.PI),o=Pi(t,2*Math.PI);return Math.min(Math.abs(r-o),Math.abs(r-o+2*Math.PI),Math.abs(r-o-2*Math.PI))},T.bq=function(n){return Math.hypot(n[0],n[1],n[2])},T.br=function(){const n={},t=Q.$version;for(const r in Q.$root){const o=Q.$root[r];if(o.required){let u=null;u=r==="version"?t:o.type==="array"?[]:{},u!=null&&(n[r]=u)}}return n},T.bs=Vo,T.bt=Pr,T.bu=function(n){n=n.slice();const t=Object.create(null);for(let r=0;r<n.length;r++)t[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=H(n[r],t[n[r].ref]));return n},T.bv=function(n){if(n.type==="custom")return new Wd(n);switch(n.type){case"background":return new $p(n);case"circle":return new Uf(n);case"fill":return new Ch(n);case"fill-extrusion":return new im(n);case"heatmap":return new Gf(n);case"hillshade":return new hp(n);case"line":return new lm(n);case"raster":return new Hd(n);case"symbol":return new Lh(n)}},T.bw=In,T.bx=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let r=[];try{if(!W(n.version,t.version))return[{command:"setStyle",args:[t]}];W(n.center,t.center)||r.push({command:"setCenter",args:[t.center]}),W(n.centerAltitude,t.centerAltitude)||r.push({command:"setCenterAltitude",args:[t.centerAltitude]}),W(n.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),W(n.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),W(n.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),W(n.roll,t.roll)||r.push({command:"setRoll",args:[t.roll]}),W(n.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),W(n.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),W(n.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),W(n.light,t.light)||r.push({command:"setLight",args:[t.light]}),W(n.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),W(n.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),W(n.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const o={},u=[];(function(m,_,w,M){let I;for(I in _=_||{},m=m||{})Object.prototype.hasOwnProperty.call(m,I)&&(Object.prototype.hasOwnProperty.call(_,I)||Pe(I,w,M));for(I in _)Object.prototype.hasOwnProperty.call(_,I)&&(Object.prototype.hasOwnProperty.call(m,I)?W(m[I],_[I])||(m[I].type==="geojson"&&_[I].type==="geojson"&&Te(m,_,I)?ae(w,{command:"setGeoJSONSourceData",args:[I,_[I].data]}):De(I,_,w,M)):_e(I,_,w))})(n.sources,t.sources,u,o);const f=[];n.layers&&n.layers.forEach(m=>{"source"in m&&o[m.source]?r.push({command:"removeLayer",args:[m.id]}):f.push(m)}),r=r.concat(u),function(m,_,w){_=_||[];const M=(m=m||[]).map(Oe),I=_.map(Oe),E=m.reduce(Me,{}),L=_.reduce(Me,{}),j=M.slice(),N=Object.create(null);let G,J,oe,xe,le;for(let O=0,K=0;O<M.length;O++)G=M[O],Object.prototype.hasOwnProperty.call(L,G)?K++:(ae(w,{command:"removeLayer",args:[G]}),j.splice(j.indexOf(G,K),1));for(let O=0,K=0;O<I.length;O++)G=I[I.length-1-O],j[j.length-1-O]!==G&&(Object.prototype.hasOwnProperty.call(E,G)?(ae(w,{command:"removeLayer",args:[G]}),j.splice(j.lastIndexOf(G,j.length-K),1)):K++,xe=j[j.length-O],ae(w,{command:"addLayer",args:[L[G],xe]}),j.splice(j.length-O,0,G),N[G]=!0);for(let O=0;O<I.length;O++)if(G=I[O],J=E[G],oe=L[G],!N[G]&&!W(J,oe))if(W(J.source,oe.source)&&W(J["source-layer"],oe["source-layer"])&&W(J.type,oe.type)){for(le in Ne(J.layout,oe.layout,w,G,null,"setLayoutProperty"),Ne(J.paint,oe.paint,w,G,null,"setPaintProperty"),W(J.filter,oe.filter)||ae(w,{command:"setFilter",args:[G,oe.filter]}),W(J.minzoom,oe.minzoom)&&W(J.maxzoom,oe.maxzoom)||ae(w,{command:"setLayerZoomRange",args:[G,oe.minzoom,oe.maxzoom]}),J)Object.prototype.hasOwnProperty.call(J,le)&&le!=="layout"&&le!=="paint"&&le!=="filter"&&le!=="metadata"&&le!=="minzoom"&&le!=="maxzoom"&&(le.indexOf("paint.")===0?Ne(J[le],oe[le],w,G,le.slice(6),"setPaintProperty"):W(J[le],oe[le])||ae(w,{command:"setLayerProperty",args:[G,le,oe[le]]}));for(le in oe)Object.prototype.hasOwnProperty.call(oe,le)&&!Object.prototype.hasOwnProperty.call(J,le)&&le!=="layout"&&le!=="paint"&&le!=="filter"&&le!=="metadata"&&le!=="minzoom"&&le!=="maxzoom"&&(le.indexOf("paint.")===0?Ne(J[le],oe[le],w,G,le.slice(6),"setPaintProperty"):W(J[le],oe[le])||ae(w,{command:"setLayerProperty",args:[G,le,oe[le]]}))}else ae(w,{command:"removeLayer",args:[G]}),xe=j[j.lastIndexOf(G)+1],ae(w,{command:"addLayer",args:[oe,xe]})}(f,t.layers,r)}catch(o){console.warn("Unable to compute style diff:",o),r=[{command:"setStyle",args:[t]}]}return r},T.by=function(n){const t=[],r=n.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},T.bz=function n(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let o=0;o<t.length;o++)if(!n(t[o],r[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const o in t)if(!n(t[o],r[o]))return!1;return!0}return t===r},T.c=vn,T.c0=n=>n.type==="fill",T.c1=n=>n.type==="fill-extrusion",T.c2=n=>n.type==="hillshade",T.c3=n=>n.type==="raster",T.c4=n=>n.type==="background",T.c5=n=>n.type==="custom",T.c6=ni,T.c7=function(n,t,r){const o=Wt(t.x-r.x,t.y-r.y),u=Wt(n.x-r.x,n.y-r.y);var f,m;return yn(Math.atan2(o[0]*u[1]-o[1]*u[0],(f=o)[0]*(m=u)[0]+f[1]*m[1]))},T.c8=br,T.c9=function(n,t,r){var o=t[0],u=t[1];return n[0]=r[0]*o+r[4]*u+r[12],n[1]=r[1]*o+r[5]*u+r[13],n},T.cA=Dd,T.cB=al,T.cC=ss,T.ca=function(n,t){const{x:r,y:o}=Du.fromLngLat(t);return!(n<0||n>25||o<0||o>=1||r<0||r>=1)},T.cb=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},T.cc=class extends Fa{},T.cd=gf,T.cf=function(n){return n.message===An},T.cg=$r,T.ch=function(n,t){lr.REGISTERED_PROTOCOLS[n]=t},T.ci=function(n){delete lr.REGISTERED_PROTOCOLS[n]},T.cj=function(n,t){const r={};for(let u=0;u<n.length;u++){const f=t&&t[n[u].id]||cu(n[u]);t&&(t[n[u].id]=f);let m=r[f];m||(m=r[f]=[]),m.push(n[u])}const o=[];for(const u in r)o.push(r[u]);return o},T.ck=xt,T.cl=tf,T.cm=rf,T.cn=Bd,T.co=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=jt/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],r=t.layout,o=t._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new Vi(n.bucket.zoom+1),n.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Vi(n.bucket.zoom+1),n.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Vi(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:I}=n.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Vi(M),n.canonical),o["text-size"].possiblyEvaluate(new Vi(I),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:I}=n.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Vi(M),n.canonical),o["icon-size"].possiblyEvaluate(new Vi(I),n.canonical)]}const f=r.get("text-line-height")*Nn,m=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",_=r.get("text-keep-upright"),w=r.get("text-size");for(const M of n.bucket.features){const I=r.get("text-font").evaluate(M,{},n.canonical).join(","),E=w.evaluate(M,{},n.canonical),L=u.layoutTextSize.evaluate(M,{},n.canonical),j=u.layoutIconSize.evaluate(M,{},n.canonical),N={horizontal:{},vertical:void 0},G=M.text;let J,oe=[0,0];if(G){const O=G.toString(),K=r.get("text-letter-spacing").evaluate(M,{},n.canonical)*Nn,ce=ch(O)?K:0,Re=r.get("text-anchor").evaluate(M,{},n.canonical),Je=df(t,M,n.canonical);if(!Je){const tt=r.get("text-radial-offset").evaluate(M,{},n.canonical);oe=tt?pf(Re,[tt*Nn,Zp]):r.get("text-offset").evaluate(M,{},n.canonical).map(at=>at*Nn)}let Fe=m?"center":r.get("text-justify").evaluate(M,{},n.canonical);const Be=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(M,{},n.canonical)*Nn:1/0,Qe=()=>{n.bucket.allowVerticalPlacement&&Ba(O)&&(N.vertical=Dh(G,n.glyphMap,n.glyphPositions,n.imagePositions,I,Be,f,Re,"left",ce,oe,T.ai.vertical,!0,L,E))};if(!m&&Je){const tt=new Set;if(Fe==="auto")for(let Ue=0;Ue<Je.values.length;Ue+=2)tt.add(qp(Je.values[Ue]));else tt.add(Fe);let at=!1;for(const Ue of tt)if(!N.horizontal[Ue])if(at)N.horizontal[Ue]=N.horizontal[0];else{const St=Dh(G,n.glyphMap,n.glyphPositions,n.imagePositions,I,Be,f,"center",Ue,ce,oe,T.ai.horizontal,!1,L,E);St&&(N.horizontal[Ue]=St,at=St.positionedLines.length===1)}Qe()}else{Fe==="auto"&&(Fe=qp(Re));const tt=Dh(G,n.glyphMap,n.glyphPositions,n.imagePositions,I,Be,f,Re,Fe,ce,oe,T.ai.horizontal,!1,L,E);tt&&(N.horizontal[Fe]=tt),Qe(),Ba(O)&&m&&_&&(N.vertical=Dh(G,n.glyphMap,n.glyphPositions,n.imagePositions,I,Be,f,Re,Fe,ce,oe,T.ai.vertical,!1,L,E))}}let xe=!1;if(M.icon&&M.icon.name){const O=n.imageMap[M.icon.name];O&&(J=Pm(n.imagePositions[M.icon.name],r.get("icon-offset").evaluate(M,{},n.canonical),r.get("icon-anchor").evaluate(M,{},n.canonical)),xe=!!O.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=xe:n.bucket.sdfIcons!==xe&&Ji("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(O.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const le=Lc(N.horizontal)||N.vertical;n.bucket.iconsInText=!!le&&le.iconsInText,(le||J)&&zm(n.bucket,M,N,J,n.imageMap,u,L,j,oe,xe,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},T.cp=Sp,T.cq=Cl,T.cr=Eh,T.cs=Pu,T.ct=Ip,T.cu=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},T.cv=function(n,t,r,o,u){return a(this,void 0,void 0,function*(){if(nt())try{return yield Qi(n,t,r,o,u)}catch{}return function(f,m,_,w,M){const I=f.width,E=f.height;Nr&&ar||(Nr=new OffscreenCanvas(I,E),ar=Nr.getContext("2d",{willReadFrequently:!0})),Nr.width=I,Nr.height=E,ar.drawImage(f,0,0,I,E);const L=ar.getImageData(m,_,w,M);return ar.clearRect(0,0,I,E),L.data}(n,t,r,o,u)})},T.cw=ef,T.cx=q,T.cy=de,T.cz=Td,T.d=n=>a(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),T.e=Fi,T.f=n=>new Promise((t,r)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=Yn})},o.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(n)],{type:"image/png"});o.src=n.byteLength?URL.createObjectURL(u):Yn}),T.g=Jo,T.h=(n,t)=>en(Fi(n,{type:"json"}),t),T.i=Zn,T.j=Do,T.k=Qr,T.l=(n,t)=>en(Fi(n,{type:"arrayBuffer"}),t),T.m=en,T.n=function(n){return new Ip(n).readFields(mm,[])},T.o=Pc,T.p=Ld,T.q=Er,T.r=rp,T.s=Mr,T.t=sh,T.u=La,T.v=Q,T.w=Ji,T.x=function([n,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(r),y:n*Math.sin(t)*Math.sin(r),z:n*Math.cos(r)}},T.y=io,T.z=Vi}),F("worker",["./shared"],function(T){class a{constructor(U){this.keyCache={},U&&this.replace(U)}replace(U){this._layerConfigs={},this._layers={},this.update(U,[])}update(U,H){for(const ae of U){this._layerConfigs[ae.id]=ae;const _e=this._layers[ae.id]=T.bv(ae);_e._featureFilter=T.a4(_e.filter),this.keyCache[ae.id]&&delete this.keyCache[ae.id]}for(const ae of H)delete this.keyCache[ae],delete this._layerConfigs[ae],delete this._layers[ae];this.familiesBySource={};const W=T.cj(Object.values(this._layerConfigs),this.keyCache);for(const ae of W){const _e=ae.map(Me=>this._layers[Me.id]),Pe=_e[0];if(Pe.visibility==="none")continue;const De=Pe.source||"";let Te=this.familiesBySource[De];Te||(Te=this.familiesBySource[De]={});const Ne=Pe.sourceLayer||"_geojsonTileLayer";let Oe=Te[Ne];Oe||(Oe=Te[Ne]=[]),Oe.push(_e)}}}class q{constructor(U){const H={},W=[];for(const De in U){const Te=U[De],Ne=H[De]={};for(const Oe in Te){const Me=Te[+Oe];if(!Me||Me.bitmap.width===0||Me.bitmap.height===0)continue;const be={x:0,y:0,w:Me.bitmap.width+2,h:Me.bitmap.height+2};W.push(be),Ne[Oe]={rect:be,metrics:Me.metrics}}}const{w:ae,h:_e}=T.p(W),Pe=new T.o({width:ae||1,height:_e||1});for(const De in U){const Te=U[De];for(const Ne in Te){const Oe=Te[+Ne];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;const Me=H[De][Ne].rect;T.o.copy(Oe.bitmap,Pe,{x:0,y:0},{x:Me.x+1,y:Me.y+1},Oe.bitmap)}}this.image=Pe,this.positions=H}}T.ck("GlyphAtlas",q);class Y{constructor(U){this.tileID=new T.S(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.uid=U.uid,this.zoom=U.zoom,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=U.showCollisionBoxes,this.collectResourceTiming=!!U.collectResourceTiming,this.returnDependencies=!!U.returnDependencies,this.promoteId=U.promoteId,this.inFlightDependencies=[]}parse(U,H,W,ae,_e){return T._(this,void 0,void 0,function*(){this.status="parsing",this.data=U,this.collisionBoxArray=new T.a2;const Pe=new T.cl(Object.keys(U.layers).sort()),De=new T.cm(this.tileID,this.promoteId);De.bucketLayerIDs=[];const Te={},Ne={featureIndex:De,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:W,subdivisionGranularity:_e},Oe=H.familiesBySource[this.source];for(const Lt in Oe){const wt=U.layers[Lt];if(!wt)continue;wt.version===1&&T.w(`Vector tile source "${this.source}" layer "${Lt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const un=Pe.encode(Lt),_s=[];for(let Fn=0;Fn<wt.length;Fn++){const xn=wt.feature(Fn),Zi=De.getId(xn,Lt);_s.push({feature:xn,id:Zi,index:Fn,sourceLayerIndex:un})}for(const Fn of Oe[Lt]){const xn=Fn[0];xn.source!==this.source&&T.w(`layer.source = ${xn.source} does not equal this.source = ${this.source}`),xn.minzoom&&this.zoom<Math.floor(xn.minzoom)||xn.maxzoom&&this.zoom>=xn.maxzoom||xn.visibility!=="none"&&(fe(Fn,this.zoom,W),(Te[xn.id]=xn.createBucket({index:De.bucketLayerIDs.length,layers:Fn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:un,sourceID:this.source})).populate(_s,Ne,this.tileID.canonical),De.bucketLayerIDs.push(Fn.map(Zi=>Zi.id)))}}const Me=T.bA(Ne.glyphDependencies,Lt=>Object.keys(Lt).map(Number));this.inFlightDependencies.forEach(Lt=>Lt==null?void 0:Lt.abort()),this.inFlightDependencies=[];let be=Promise.resolve({});if(Object.keys(Me).length){const Lt=new AbortController;this.inFlightDependencies.push(Lt),be=ae.sendAsync({type:"GG",data:{stacks:Me,source:this.source,tileID:this.tileID,type:"glyphs"}},Lt)}const pt=Object.keys(Ne.iconDependencies);let dt=Promise.resolve({});if(pt.length){const Lt=new AbortController;this.inFlightDependencies.push(Lt),dt=ae.sendAsync({type:"GI",data:{icons:pt,source:this.source,tileID:this.tileID,type:"icons"}},Lt)}const qe=Object.keys(Ne.patternDependencies);let rt=Promise.resolve({});if(qe.length){const Lt=new AbortController;this.inFlightDependencies.push(Lt),rt=ae.sendAsync({type:"GI",data:{icons:qe,source:this.source,tileID:this.tileID,type:"patterns"}},Lt)}const[Ge,yt,Mt]=yield Promise.all([be,dt,rt]),Qt=new q(Ge),ui=new T.cn(yt,Mt);for(const Lt in Te){const wt=Te[Lt];wt instanceof T.a3?(fe(wt.layers,this.zoom,W),T.co({bucket:wt,glyphMap:Ge,glyphPositions:Qt.positions,imageMap:yt,imagePositions:ui.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ne.subdivisionGranularity})):wt.hasPattern&&(wt instanceof T.cp||wt instanceof T.cq||wt instanceof T.cr)&&(fe(wt.layers,this.zoom,W),wt.addFeatures(Ne,this.tileID.canonical,ui.patternPositions))}return this.status="done",{buckets:Object.values(Te).filter(Lt=>!Lt.isEmpty()),featureIndex:De,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Qt.image,imageAtlas:ui,glyphMap:this.returnDependencies?Ge:null,iconMap:this.returnDependencies?yt:null,glyphPositions:this.returnDependencies?Qt.positions:null}})}}function fe(Q,U,H){const W=new T.z(U);for(const ae of Q)ae.recalculate(W,H)}class de{constructor(U,H,W){this.actor=U,this.layerIndex=H,this.availableImages=W,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(U,H){return T._(this,void 0,void 0,function*(){const W=yield T.l(U.request,H);try{return{vectorTile:new T.cs.VectorTile(new T.ct(W.data)),rawData:W.data,cacheControl:W.cacheControl,expires:W.expires}}catch(ae){const _e=new Uint8Array(W.data);let Pe=`Unable to parse the tile at ${U.request.url}, `;throw Pe+=_e[0]===31&&_e[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ae.message}`,new Error(Pe)}})}loadTile(U){return T._(this,void 0,void 0,function*(){const H=U.uid,W=!!(U&&U.request&&U.request.collectResourceTiming)&&new T.cu(U.request),ae=new Y(U);this.loading[H]=ae;const _e=new AbortController;ae.abort=_e;try{const Pe=yield this.loadVectorTile(U,_e);if(delete this.loading[H],!Pe)return null;const De=Pe.rawData,Te={};Pe.expires&&(Te.expires=Pe.expires),Pe.cacheControl&&(Te.cacheControl=Pe.cacheControl);const Ne={};if(W){const Me=W.finish();Me&&(Ne.resourceTiming=JSON.parse(JSON.stringify(Me)))}ae.vectorTile=Pe.vectorTile;const Oe=ae.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.actor,U.subdivisionGranularity);this.loaded[H]=ae,this.fetching[H]={rawTileData:De,cacheControl:Te,resourceTiming:Ne};try{const Me=yield Oe;return T.e({rawTileData:De.slice(0)},Me,Te,Ne)}finally{delete this.fetching[H]}}catch(Pe){throw delete this.loading[H],ae.status="done",this.loaded[H]=ae,Pe}})}reloadTile(U){return T._(this,void 0,void 0,function*(){const H=U.uid;if(!this.loaded||!this.loaded[H])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const W=this.loaded[H];if(W.showCollisionBoxes=U.showCollisionBoxes,W.status==="parsing"){const ae=yield W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor,U.subdivisionGranularity);let _e;if(this.fetching[H]){const{rawTileData:Pe,cacheControl:De,resourceTiming:Te}=this.fetching[H];delete this.fetching[H],_e=T.e({rawTileData:Pe.slice(0)},ae,De,Te)}else _e=ae;return _e}if(W.status==="done"&&W.vectorTile)return W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor,U.subdivisionGranularity)})}abortTile(U){return T._(this,void 0,void 0,function*(){const H=this.loading,W=U.uid;H&&H[W]&&H[W].abort&&(H[W].abort.abort(),delete H[W])})}removeTile(U){return T._(this,void 0,void 0,function*(){this.loaded&&this.loaded[U.uid]&&delete this.loaded[U.uid]})}}class ge{constructor(){this.loaded={}}loadTile(U){return T._(this,void 0,void 0,function*(){const{uid:H,encoding:W,rawImageData:ae,redFactor:_e,greenFactor:Pe,blueFactor:De,baseShift:Te}=U,Ne=ae.width+2,Oe=ae.height+2,Me=T.b(ae)?new T.R({width:Ne,height:Oe},yield T.cv(ae,-1,-1,Ne,Oe)):ae,be=new T.cw(H,Me,W,_e,Pe,De,Te);return this.loaded=this.loaded||{},this.loaded[H]=be,be})}removeTile(U){const H=this.loaded,W=U.uid;H&&H[W]&&delete H[W]}}var te,we,it=function(){if(we)return te;function Q(H,W){if(H.length!==0){U(H[0],W);for(var ae=1;ae<H.length;ae++)U(H[ae],!W)}}function U(H,W){for(var ae=0,_e=0,Pe=0,De=H.length,Te=De-1;Pe<De;Te=Pe++){var Ne=(H[Pe][0]-H[Te][0])*(H[Te][1]+H[Pe][1]),Oe=ae+Ne;_e+=Math.abs(ae)>=Math.abs(Ne)?ae-Oe+Ne:Ne-Oe+ae,ae=Oe}ae+_e>=0!=!!W&&H.reverse()}return we=1,te=function H(W,ae){var _e,Pe=W&&W.type;if(Pe==="FeatureCollection")for(_e=0;_e<W.features.length;_e++)H(W.features[_e],ae);else if(Pe==="GeometryCollection")for(_e=0;_e<W.geometries.length;_e++)H(W.geometries[_e],ae);else if(Pe==="Feature")H(W.geometry,ae);else if(Pe==="Polygon")Q(W.coordinates,ae);else if(Pe==="MultiPolygon")for(_e=0;_e<W.coordinates.length;_e++)Q(W.coordinates[_e],ae);return W}}(),Ke=T.cx(it);const vt=T.cs.VectorTileFeature.prototype.toGeoJSON;class Rt{constructor(U){this._feature=U,this.extent=T.X,this.type=U.type,this.properties=U.tags,"id"in U&&!isNaN(U.id)&&(this.id=parseInt(U.id,10))}loadGeometry(){if(this._feature.type===1){const U=[];for(const H of this._feature.geometry)U.push([new T.P(H[0],H[1])]);return U}{const U=[];for(const H of this._feature.geometry){const W=[];for(const ae of H)W.push(new T.P(ae[0],ae[1]));U.push(W)}return U}}toGeoJSON(U,H,W){return vt.call(this,U,H,W)}}class gt{constructor(U){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=T.X,this.length=U.length,this._features=U}feature(U){return new Rt(this._features[U])}}var nt,ht,Xe,ct={exports:{}},Tt=function(){if(Xe)return ct.exports;Xe=1;var Q=T.cA(),U=function(){if(ht)return nt;ht=1;var Oe=T.cy(),Me=T.cz().VectorTileFeature;function be(dt,qe){this.options=qe||{},this.features=dt,this.length=dt.length}function pt(dt,qe){this.id=typeof dt.id=="number"?dt.id:void 0,this.type=dt.type,this.rawGeometry=dt.type===1?[dt.geometry]:dt.geometry,this.properties=dt.tags,this.extent=qe||4096}return nt=be,be.prototype.feature=function(dt){return new pt(this.features[dt],this.options.extent)},pt.prototype.loadGeometry=function(){var dt=this.rawGeometry;this.geometry=[];for(var qe=0;qe<dt.length;qe++){for(var rt=dt[qe],Ge=[],yt=0;yt<rt.length;yt++)Ge.push(new Oe(rt[yt][0],rt[yt][1]));this.geometry.push(Ge)}return this.geometry},pt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var dt=this.geometry,qe=1/0,rt=-1/0,Ge=1/0,yt=-1/0,Mt=0;Mt<dt.length;Mt++)for(var Qt=dt[Mt],ui=0;ui<Qt.length;ui++){var Lt=Qt[ui];qe=Math.min(qe,Lt.x),rt=Math.max(rt,Lt.x),Ge=Math.min(Ge,Lt.y),yt=Math.max(yt,Lt.y)}return[qe,Ge,rt,yt]},pt.prototype.toGeoJSON=Me.prototype.toGeoJSON,nt}();function H(Oe){var Me=new Q;return function(be,pt){for(var dt in be.layers)pt.writeMessage(3,W,be.layers[dt])}(Oe,Me),Me.finish()}function W(Oe,Me){var be;Me.writeVarintField(15,Oe.version||1),Me.writeStringField(1,Oe.name||""),Me.writeVarintField(5,Oe.extent||4096);var pt={keys:[],values:[],keycache:{},valuecache:{}};for(be=0;be<Oe.length;be++)pt.feature=Oe.feature(be),Me.writeMessage(2,ae,pt);var dt=pt.keys;for(be=0;be<dt.length;be++)Me.writeStringField(3,dt[be]);var qe=pt.values;for(be=0;be<qe.length;be++)Me.writeMessage(4,Ne,qe[be])}function ae(Oe,Me){var be=Oe.feature;be.id!==void 0&&Me.writeVarintField(1,be.id),Me.writeMessage(2,_e,Oe),Me.writeVarintField(3,be.type),Me.writeMessage(4,Te,be)}function _e(Oe,Me){var be=Oe.feature,pt=Oe.keys,dt=Oe.values,qe=Oe.keycache,rt=Oe.valuecache;for(var Ge in be.properties){var yt=be.properties[Ge],Mt=qe[Ge];if(yt!==null){Mt===void 0&&(pt.push(Ge),qe[Ge]=Mt=pt.length-1),Me.writeVarint(Mt);var Qt=typeof yt;Qt!=="string"&&Qt!=="boolean"&&Qt!=="number"&&(yt=JSON.stringify(yt));var ui=Qt+":"+yt,Lt=rt[ui];Lt===void 0&&(dt.push(yt),rt[ui]=Lt=dt.length-1),Me.writeVarint(Lt)}}}function Pe(Oe,Me){return(Me<<3)+(7&Oe)}function De(Oe){return Oe<<1^Oe>>31}function Te(Oe,Me){for(var be=Oe.loadGeometry(),pt=Oe.type,dt=0,qe=0,rt=be.length,Ge=0;Ge<rt;Ge++){var yt=be[Ge],Mt=1;pt===1&&(Mt=yt.length),Me.writeVarint(Pe(1,Mt));for(var Qt=pt===3?yt.length-1:yt.length,ui=0;ui<Qt;ui++){ui===1&&pt!==1&&Me.writeVarint(Pe(2,Qt-1));var Lt=yt[ui].x-dt,wt=yt[ui].y-qe;Me.writeVarint(De(Lt)),Me.writeVarint(De(wt)),dt+=Lt,qe+=wt}pt===3&&Me.writeVarint(Pe(7,1))}}function Ne(Oe,Me){var be=typeof Oe;be==="string"?Me.writeStringField(1,Oe):be==="boolean"?Me.writeBooleanField(7,Oe):be==="number"&&(Oe%1!=0?Me.writeDoubleField(3,Oe):Oe<0?Me.writeSVarintField(6,Oe):Me.writeVarintField(5,Oe))}return ct.exports=H,ct.exports.fromVectorTileJs=H,ct.exports.fromGeojsonVt=function(Oe,Me){Me=Me||{};var be={};for(var pt in Oe)be[pt]=new U(Oe[pt].features,Me),be[pt].name=pt,be[pt].version=Me.version,be[pt].extent=Me.extent;return H({layers:be})},ct.exports.GeoJSONWrapper=U,ct.exports}(),$t=T.cx(Tt);const Bi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Q=>Q},Jt=Math.fround||(Ot=new Float32Array(1),Q=>(Ot[0]=+Q,Ot[0]));var Ot;const Ft=3,Pt=5,Wt=6;class jt{constructor(U){this.options=Object.assign(Object.create(Bi),U),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(U){const{log:H,minZoom:W,maxZoom:ae}=this.options;H&&console.time("total time");const _e=`prepare ${U.length} points`;H&&console.time(_e),this.points=U;const Pe=[];for(let Te=0;Te<U.length;Te++){const Ne=U[Te];if(!Ne.geometry)continue;const[Oe,Me]=Ne.geometry.coordinates,be=Jt(cn(Oe)),pt=Jt(Yi(Me));Pe.push(be,pt,1/0,Te,-1,1),this.options.reduce&&Pe.push(0)}let De=this.trees[ae+1]=this._createTree(Pe);H&&console.timeEnd(_e);for(let Te=ae;Te>=W;Te--){const Ne=+Date.now();De=this.trees[Te]=this._createTree(this._cluster(De,Te)),H&&console.log("z%d: %d clusters in %dms",Te,De.numItems,+Date.now()-Ne)}return H&&console.timeEnd("total time"),this}getClusters(U,H){let W=((U[0]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,U[1]));let _e=U[2]===180?180:((U[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)W=-180,_e=180;else if(W>_e){const Me=this.getClusters([W,ae,180,Pe],H),be=this.getClusters([-180,ae,_e,Pe],H);return Me.concat(be)}const De=this.trees[this._limitZoom(H)],Te=De.range(cn(W),Yi(Pe),cn(_e),Yi(ae)),Ne=De.data,Oe=[];for(const Me of Te){const be=this.stride*Me;Oe.push(Ne[be+Pt]>1?gi(Ne,be,this.clusterProps):this.points[Ne[be+Ft]])}return Oe}getChildren(U){const H=this._getOriginId(U),W=this._getOriginZoom(U),ae="No cluster with the specified id.",_e=this.trees[W];if(!_e)throw new Error(ae);const Pe=_e.data;if(H*this.stride>=Pe.length)throw new Error(ae);const De=this.options.radius/(this.options.extent*Math.pow(2,W-1)),Te=_e.within(Pe[H*this.stride],Pe[H*this.stride+1],De),Ne=[];for(const Oe of Te){const Me=Oe*this.stride;Pe[Me+4]===U&&Ne.push(Pe[Me+Pt]>1?gi(Pe,Me,this.clusterProps):this.points[Pe[Me+Ft]])}if(Ne.length===0)throw new Error(ae);return Ne}getLeaves(U,H,W){const ae=[];return this._appendLeaves(ae,U,H=H||10,W=W||0,0),ae}getTile(U,H,W){const ae=this.trees[this._limitZoom(U)],_e=Math.pow(2,U),{extent:Pe,radius:De}=this.options,Te=De/Pe,Ne=(W-Te)/_e,Oe=(W+1+Te)/_e,Me={features:[]};return this._addTileFeatures(ae.range((H-Te)/_e,Ne,(H+1+Te)/_e,Oe),ae.data,H,W,_e,Me),H===0&&this._addTileFeatures(ae.range(1-Te/_e,Ne,1,Oe),ae.data,_e,W,_e,Me),H===_e-1&&this._addTileFeatures(ae.range(0,Ne,Te/_e,Oe),ae.data,-1,W,_e,Me),Me.features.length?Me:null}getClusterExpansionZoom(U){let H=this._getOriginZoom(U)-1;for(;H<=this.options.maxZoom;){const W=this.getChildren(U);if(H++,W.length!==1)break;U=W[0].properties.cluster_id}return H}_appendLeaves(U,H,W,ae,_e){const Pe=this.getChildren(H);for(const De of Pe){const Te=De.properties;if(Te&&Te.cluster?_e+Te.point_count<=ae?_e+=Te.point_count:_e=this._appendLeaves(U,Te.cluster_id,W,ae,_e):_e<ae?_e++:U.push(De),U.length===W)break}return _e}_createTree(U){const H=new T.az(U.length/this.stride|0,this.options.nodeSize,Float32Array);for(let W=0;W<U.length;W+=this.stride)H.add(U[W],U[W+1]);return H.finish(),H.data=U,H}_addTileFeatures(U,H,W,ae,_e,Pe){for(const De of U){const Te=De*this.stride,Ne=H[Te+Pt]>1;let Oe,Me,be;if(Ne)Oe=Pi(H,Te,this.clusterProps),Me=H[Te],be=H[Te+1];else{const qe=this.points[H[Te+Ft]];Oe=qe.properties;const[rt,Ge]=qe.geometry.coordinates;Me=cn(rt),be=Yi(Ge)}const pt={type:1,geometry:[[Math.round(this.options.extent*(Me*_e-W)),Math.round(this.options.extent*(be*_e-ae))]],tags:Oe};let dt;dt=Ne||this.options.generateId?H[Te+Ft]:this.points[H[Te+Ft]].id,dt!==void 0&&(pt.id=dt),Pe.features.push(pt)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,H){const{radius:W,extent:ae,reduce:_e,minPoints:Pe}=this.options,De=W/(ae*Math.pow(2,H)),Te=U.data,Ne=[],Oe=this.stride;for(let Me=0;Me<Te.length;Me+=Oe){if(Te[Me+2]<=H)continue;Te[Me+2]=H;const be=Te[Me],pt=Te[Me+1],dt=U.within(Te[Me],Te[Me+1],De),qe=Te[Me+Pt];let rt=qe;for(const Ge of dt){const yt=Ge*Oe;Te[yt+2]>H&&(rt+=Te[yt+Pt])}if(rt>qe&&rt>=Pe){let Ge,yt=be*qe,Mt=pt*qe,Qt=-1;const ui=((Me/Oe|0)<<5)+(H+1)+this.points.length;for(const Lt of dt){const wt=Lt*Oe;if(Te[wt+2]<=H)continue;Te[wt+2]=H;const un=Te[wt+Pt];yt+=Te[wt]*un,Mt+=Te[wt+1]*un,Te[wt+4]=ui,_e&&(Ge||(Ge=this._map(Te,Me,!0),Qt=this.clusterProps.length,this.clusterProps.push(Ge)),_e(Ge,this._map(Te,wt)))}Te[Me+4]=ui,Ne.push(yt/rt,Mt/rt,1/0,ui,-1,rt),_e&&Ne.push(Qt)}else{for(let Ge=0;Ge<Oe;Ge++)Ne.push(Te[Me+Ge]);if(rt>1)for(const Ge of dt){const yt=Ge*Oe;if(!(Te[yt+2]<=H)){Te[yt+2]=H;for(let Mt=0;Mt<Oe;Mt++)Ne.push(Te[yt+Mt])}}}}return Ne}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,H,W){if(U[H+Pt]>1){const Pe=this.clusterProps[U[H+Wt]];return W?Object.assign({},Pe):Pe}const ae=this.points[U[H+Ft]].properties,_e=this.options.map(ae);return W&&_e===ae?Object.assign({},_e):_e}}function gi(Q,U,H){return{type:"Feature",id:Q[U+Ft],properties:Pi(Q,U,H),geometry:{type:"Point",coordinates:[(W=Q[U],360*(W-.5)),ni(Q[U+1])]}};var W}function Pi(Q,U,H){const W=Q[U+Pt],ae=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W,_e=Q[U+Wt],Pe=_e===-1?{}:Object.assign({},H[_e]);return Object.assign(Pe,{cluster:!0,cluster_id:Q[U+Ft],point_count:W,point_count_abbreviated:ae})}function cn(Q){return Q/360+.5}function Yi(Q){const U=Math.sin(Q*Math.PI/180),H=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return H<0?0:H>1?1:H}function ni(Q){const U=(180-360*Q)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function br(Q,U,H,W){let ae=W;const _e=U+(H-U>>1);let Pe,De=H-U;const Te=Q[U],Ne=Q[U+1],Oe=Q[H],Me=Q[H+1];for(let be=U+3;be<H;be+=3){const pt=wr(Q[be],Q[be+1],Te,Ne,Oe,Me);if(pt>ae)Pe=be,ae=pt;else if(pt===ae){const dt=Math.abs(be-_e);dt<De&&(Pe=be,De=dt)}}ae>W&&(Pe-U>3&&br(Q,U,Pe,W),Q[Pe+2]=ae,H-Pe>3&&br(Q,Pe,H,W))}function wr(Q,U,H,W,ae,_e){let Pe=ae-H,De=_e-W;if(Pe!==0||De!==0){const Te=((Q-H)*Pe+(U-W)*De)/(Pe*Pe+De*De);Te>1?(H=ae,W=_e):Te>0&&(H+=Pe*Te,W+=De*Te)}return Pe=Q-H,De=U-W,Pe*Pe+De*De}function pn(Q,U,H,W){const ae={id:Q??null,type:U,geometry:H,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(U==="Point"||U==="MultiPoint"||U==="LineString")Fi(ae,H);else if(U==="Polygon")Fi(ae,H[0]);else if(U==="MultiLineString")for(const _e of H)Fi(ae,_e);else if(U==="MultiPolygon")for(const _e of H)Fi(ae,_e[0]);return ae}function Fi(Q,U){for(let H=0;H<U.length;H+=3)Q.minX=Math.min(Q.minX,U[H]),Q.minY=Math.min(Q.minY,U[H+1]),Q.maxX=Math.max(Q.maxX,U[H]),Q.maxY=Math.max(Q.maxY,U[H+1])}function Tr(Q,U,H,W){if(!U.geometry)return;const ae=U.geometry.coordinates;if(ae&&ae.length===0)return;const _e=U.geometry.type,Pe=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2);let De=[],Te=U.id;if(H.promoteId?Te=U.properties[H.promoteId]:H.generateId&&(Te=W||0),_e==="Point")fr(ae,De);else if(_e==="MultiPoint")for(const Ne of ae)fr(Ne,De);else if(_e==="LineString")mr(ae,De,Pe,!1);else if(_e==="MultiLineString"){if(H.lineMetrics){for(const Ne of ae)De=[],mr(Ne,De,Pe,!1),Q.push(pn(Te,"LineString",De,U.properties));return}In(ae,De,Pe,!1)}else if(_e==="Polygon")In(ae,De,Pe,!0);else{if(_e!=="MultiPolygon"){if(_e==="GeometryCollection"){for(const Ne of U.geometry.geometries)Tr(Q,{id:Te,geometry:Ne,properties:U.properties},H,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ne of ae){const Oe=[];In(Ne,Oe,Pe,!0),De.push(Oe)}}Q.push(pn(Te,_e,De,U.properties))}function fr(Q,U){U.push(gr(Q[0]),Ji(Q[1]),0)}function mr(Q,U,H,W){let ae,_e,Pe=0;for(let Te=0;Te<Q.length;Te++){const Ne=gr(Q[Te][0]),Oe=Ji(Q[Te][1]);U.push(Ne,Oe,0),Te>0&&(Pe+=W?(ae*Oe-Ne*_e)/2:Math.sqrt(Math.pow(Ne-ae,2)+Math.pow(Oe-_e,2))),ae=Ne,_e=Oe}const De=U.length-3;U[2]=1,br(U,0,De,H),U[De+2]=1,U.size=Math.abs(Pe),U.start=0,U.end=U.size}function In(Q,U,H,W){for(let ae=0;ae<Q.length;ae++){const _e=[];mr(Q[ae],_e,H,W),U.push(_e)}}function gr(Q){return Q/360+.5}function Ji(Q){const U=Math.sin(Q*Math.PI/180),H=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return H<0?0:H>1?1:H}function Ni(Q,U,H,W,ae,_e,Pe,De){if(W/=U,_e>=(H/=U)&&Pe<W)return Q;if(Pe<H||_e>=W)return null;const Te=[];for(const Ne of Q){const Oe=Ne.geometry;let Me=Ne.type;const be=ae===0?Ne.minX:Ne.minY,pt=ae===0?Ne.maxX:Ne.maxY;if(be>=H&&pt<W){Te.push(Ne);continue}if(pt<H||be>=W)continue;let dt=[];if(Me==="Point"||Me==="MultiPoint")Zn(Oe,dt,H,W,ae);else if(Me==="LineString")mi(Oe,dt,H,W,ae,!1,De.lineMetrics);else if(Me==="MultiLineString")Yn(Oe,dt,H,W,ae,!1);else if(Me==="Polygon")Yn(Oe,dt,H,W,ae,!0);else if(Me==="MultiPolygon")for(const qe of Oe){const rt=[];Yn(qe,rt,H,W,ae,!0),rt.length&&dt.push(rt)}if(dt.length){if(De.lineMetrics&&Me==="LineString"){for(const qe of dt)Te.push(pn(Ne.id,Me,qe,Ne.tags));continue}Me!=="LineString"&&Me!=="MultiLineString"||(dt.length===1?(Me="LineString",dt=dt[0]):Me="MultiLineString"),Me!=="Point"&&Me!=="MultiPoint"||(Me=dt.length===3?"Point":"MultiPoint"),Te.push(pn(Ne.id,Me,dt,Ne.tags))}}return Te.length?Te:null}function Zn(Q,U,H,W,ae){for(let _e=0;_e<Q.length;_e+=3){const Pe=Q[_e+ae];Pe>=H&&Pe<=W&&Qi(U,Q[_e],Q[_e+1],Q[_e+2])}}function mi(Q,U,H,W,ae,_e,Pe){let De=Sr(Q);const Te=ae===0?Nr:ar;let Ne,Oe,Me=Q.start;for(let rt=0;rt<Q.length-3;rt+=3){const Ge=Q[rt],yt=Q[rt+1],Mt=Q[rt+2],Qt=Q[rt+3],ui=Q[rt+4],Lt=ae===0?Ge:yt,wt=ae===0?Qt:ui;let un=!1;Pe&&(Ne=Math.sqrt(Math.pow(Ge-Qt,2)+Math.pow(yt-ui,2))),Lt<H?wt>H&&(Oe=Te(De,Ge,yt,Qt,ui,H),Pe&&(De.start=Me+Ne*Oe)):Lt>W?wt<W&&(Oe=Te(De,Ge,yt,Qt,ui,W),Pe&&(De.start=Me+Ne*Oe)):Qi(De,Ge,yt,Mt),wt<H&&Lt>=H&&(Oe=Te(De,Ge,yt,Qt,ui,H),un=!0),wt>W&&Lt<=W&&(Oe=Te(De,Ge,yt,Qt,ui,W),un=!0),!_e&&un&&(Pe&&(De.end=Me+Ne*Oe),U.push(De),De=Sr(Q)),Pe&&(Me+=Ne)}let be=Q.length-3;const pt=Q[be],dt=Q[be+1],qe=ae===0?pt:dt;qe>=H&&qe<=W&&Qi(De,pt,dt,Q[be+2]),be=De.length-3,_e&&be>=3&&(De[be]!==De[0]||De[be+1]!==De[1])&&Qi(De,De[0],De[1],De[2]),De.length&&U.push(De)}function Sr(Q){const U=[];return U.size=Q.size,U.start=Q.start,U.end=Q.end,U}function Yn(Q,U,H,W,ae,_e){for(const Pe of Q)mi(Pe,U,H,W,ae,_e,!1)}function Qi(Q,U,H,W){Q.push(U,H,W)}function Nr(Q,U,H,W,ae,_e){const Pe=(_e-U)/(W-U);return Qi(Q,_e,H+(ae-H)*Pe,1),Pe}function ar(Q,U,H,W,ae,_e){const Pe=(_e-H)/(ae-H);return Qi(Q,U+(W-U)*Pe,_e,1),Pe}function yn(Q,U){const H=[];for(let W=0;W<Q.length;W++){const ae=Q[W],_e=ae.type;let Pe;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")Pe=An(ae.geometry,U);else if(_e==="MultiLineString"||_e==="Polygon"){Pe=[];for(const De of ae.geometry)Pe.push(An(De,U))}else if(_e==="MultiPolygon"){Pe=[];for(const De of ae.geometry){const Te=[];for(const Ne of De)Te.push(An(Ne,U));Pe.push(Te)}}H.push(pn(ae.id,_e,Pe,ae.tags))}return H}function An(Q,U){const H=[];H.size=Q.size,Q.start!==void 0&&(H.start=Q.start,H.end=Q.end);for(let W=0;W<Q.length;W+=3)H.push(Q[W]+U,Q[W+1],Q[W+2]);return H}function vn(Q,U){if(Q.transformed)return Q;const H=1<<Q.z,W=Q.x,ae=Q.y;for(const _e of Q.features){const Pe=_e.geometry,De=_e.type;if(_e.geometry=[],De===1)for(let Te=0;Te<Pe.length;Te+=2)_e.geometry.push(lr(Pe[Te],Pe[Te+1],U,H,W,ae));else for(let Te=0;Te<Pe.length;Te++){const Ne=[];for(let Oe=0;Oe<Pe[Te].length;Oe+=2)Ne.push(lr(Pe[Te][Oe],Pe[Te][Oe+1],U,H,W,ae));_e.geometry.push(Ne)}}return Q.transformed=!0,Q}function lr(Q,U,H,W,ae,_e){return[Math.round(H*(Q*W-ae)),Math.round(H*(U*W-_e))]}function Jo(Q,U,H,W,ae){const _e=U===ae.maxZoom?0:ae.tolerance/((1<<U)*ae.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:Q.length,source:null,x:H,y:W,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const De of Q)Bn(Pe,De,_e,ae);return Pe}function Bn(Q,U,H,W){const ae=U.geometry,_e=U.type,Pe=[];if(Q.minX=Math.min(Q.minX,U.minX),Q.minY=Math.min(Q.minY,U.minY),Q.maxX=Math.max(Q.maxX,U.maxX),Q.maxY=Math.max(Q.maxY,U.maxY),_e==="Point"||_e==="MultiPoint")for(let De=0;De<ae.length;De+=3)Pe.push(ae[De],ae[De+1]),Q.numPoints++,Q.numSimplified++;else if(_e==="LineString")$r(Pe,ae,Q,H,!1,!1);else if(_e==="MultiLineString"||_e==="Polygon")for(let De=0;De<ae.length;De++)$r(Pe,ae[De],Q,H,_e==="Polygon",De===0);else if(_e==="MultiPolygon")for(let De=0;De<ae.length;De++){const Te=ae[De];for(let Ne=0;Ne<Te.length;Ne++)$r(Pe,Te[Ne],Q,H,!0,Ne===0)}if(Pe.length){let De=U.tags||null;if(_e==="LineString"&&W.lineMetrics){De={};for(const Ne in U.tags)De[Ne]=U.tags[Ne];De.mapbox_clip_start=ae.start/ae.size,De.mapbox_clip_end=ae.end/ae.size}const Te={geometry:Pe,type:_e==="Polygon"||_e==="MultiPolygon"?3:_e==="LineString"||_e==="MultiLineString"?2:1,tags:De};U.id!==null&&(Te.id=U.id),Q.features.push(Te)}}function $r(Q,U,H,W,ae,_e){const Pe=W*W;if(W>0&&U.size<(ae?Pe:W))return void(H.numPoints+=U.length/3);const De=[];for(let Te=0;Te<U.length;Te+=3)(W===0||U[Te+2]>Pe)&&(H.numSimplified++,De.push(U[Te],U[Te+1])),H.numPoints++;ae&&function(Te,Ne){let Oe=0;for(let Me=0,be=Te.length,pt=be-2;Me<be;pt=Me,Me+=2)Oe+=(Te[Me]-Te[pt])*(Te[Me+1]+Te[pt+1]);if(Oe>0===Ne)for(let Me=0,be=Te.length;Me<be/2;Me+=2){const pt=Te[Me],dt=Te[Me+1];Te[Me]=Te[be-2-Me],Te[Me+1]=Te[be-1-Me],Te[be-2-Me]=pt,Te[be-1-Me]=dt}}(De,_e),Q.push(De)}const Pr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class en{constructor(U,H){const W=(H=this.options=function(_e,Pe){for(const De in Pe)_e[De]=Pe[De];return _e}(Object.create(Pr),H)).debug;if(W&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");let ae=function(_e,Pe){const De=[];if(_e.type==="FeatureCollection")for(let Te=0;Te<_e.features.length;Te++)Tr(De,_e.features[Te],Pe,Te);else Tr(De,_e.type==="Feature"?_e:{geometry:_e},Pe);return De}(U,H);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ae=function(_e,Pe){const De=Pe.buffer/Pe.extent;let Te=_e;const Ne=Ni(_e,1,-1-De,De,0,-1,2,Pe),Oe=Ni(_e,1,1-De,2+De,0,-1,2,Pe);return(Ne||Oe)&&(Te=Ni(_e,1,-De,1+De,0,-1,2,Pe)||[],Ne&&(Te=yn(Ne,1).concat(Te)),Oe&&(Te=Te.concat(yn(Oe,-1)))),Te}(ae,H),ae.length&&this.splitTile(ae,0,0,0),W&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(U,H,W,ae,_e,Pe,De){const Te=[U,H,W,ae],Ne=this.options,Oe=Ne.debug;for(;Te.length;){ae=Te.pop(),W=Te.pop(),H=Te.pop(),U=Te.pop();const Me=1<<H,be=Mr(H,W,ae);let pt=this.tiles[be];if(!pt&&(Oe>1&&console.time("creation"),pt=this.tiles[be]=Jo(U,H,W,ae,Ne),this.tileCoords.push({z:H,x:W,y:ae}),Oe)){Oe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,W,ae,pt.numFeatures,pt.numPoints,pt.numSimplified),console.timeEnd("creation"));const un=`z${H}`;this.stats[un]=(this.stats[un]||0)+1,this.total++}if(pt.source=U,_e==null){if(H===Ne.indexMaxZoom||pt.numPoints<=Ne.indexMaxPoints)continue}else{if(H===Ne.maxZoom||H===_e)continue;if(_e!=null){const un=_e-H;if(W!==Pe>>un||ae!==De>>un)continue}}if(pt.source=null,U.length===0)continue;Oe>1&&console.time("clipping");const dt=.5*Ne.buffer/Ne.extent,qe=.5-dt,rt=.5+dt,Ge=1+dt;let yt=null,Mt=null,Qt=null,ui=null,Lt=Ni(U,Me,W-dt,W+rt,0,pt.minX,pt.maxX,Ne),wt=Ni(U,Me,W+qe,W+Ge,0,pt.minX,pt.maxX,Ne);U=null,Lt&&(yt=Ni(Lt,Me,ae-dt,ae+rt,1,pt.minY,pt.maxY,Ne),Mt=Ni(Lt,Me,ae+qe,ae+Ge,1,pt.minY,pt.maxY,Ne),Lt=null),wt&&(Qt=Ni(wt,Me,ae-dt,ae+rt,1,pt.minY,pt.maxY,Ne),ui=Ni(wt,Me,ae+qe,ae+Ge,1,pt.minY,pt.maxY,Ne),wt=null),Oe>1&&console.timeEnd("clipping"),Te.push(yt||[],H+1,2*W,2*ae),Te.push(Mt||[],H+1,2*W,2*ae+1),Te.push(Qt||[],H+1,2*W+1,2*ae),Te.push(ui||[],H+1,2*W+1,2*ae+1)}}getTile(U,H,W){U=+U,H=+H,W=+W;const ae=this.options,{extent:_e,debug:Pe}=ae;if(U<0||U>24)return null;const De=1<<U,Te=Mr(U,H=H+De&De-1,W);if(this.tiles[Te])return vn(this.tiles[Te],_e);Pe>1&&console.log("drilling down to z%d-%d-%d",U,H,W);let Ne,Oe=U,Me=H,be=W;for(;!Ne&&Oe>0;)Oe--,Me>>=1,be>>=1,Ne=this.tiles[Mr(Oe,Me,be)];return Ne&&Ne.source?(Pe>1&&(console.log("found parent tile z%d-%d-%d",Oe,Me,be),console.time("drilling down")),this.splitTile(Ne.source,Oe,Me,be,U,H,W),Pe>1&&console.timeEnd("drilling down"),this.tiles[Te]?vn(this.tiles[Te],_e):null):null}}function Mr(Q,U,H){return 32*((1<<Q)*H+U)+Q}function Cr(Q,U){return U?Q.properties[U]:Q.id}function cr(Q,U){if(Q==null)return!0;if(Q.type==="Feature")return Cr(Q,U)!=null;if(Q.type==="FeatureCollection"){const H=new Set;for(const W of Q.features){const ae=Cr(W,U);if(ae==null||H.has(ae))return!1;H.add(ae)}return!0}return!1}function Qr(Q,U){const H=new Map;if(Q!=null)if(Q.type==="Feature")H.set(Cr(Q,U),Q);else for(const W of Q.features)H.set(Cr(W,U),W);return H}class Do extends de{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(U,H){return T._(this,void 0,void 0,function*(){const W=U.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ae=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!ae)return null;const _e=new gt(ae.features);let Pe=$t(_e);return Pe.byteOffset===0&&Pe.byteLength===Pe.buffer.byteLength||(Pe=new Uint8Array(Pe)),{vectorTile:_e,rawData:Pe.buffer}})}loadData(U){return T._(this,void 0,void 0,function*(){var H;(H=this._pendingRequest)===null||H===void 0||H.abort();const W=!!(U&&U.request&&U.request.collectResourceTiming)&&new T.cu(U.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(U,this._pendingRequest),this._geoJSONIndex=U.cluster?new jt(function({superclusterOptions:Pe,clusterProperties:De}){if(!De||!Pe)return Pe;const Te={},Ne={},Oe={accumulated:null,zoom:0},Me={properties:null},be=Object.keys(De);for(const pt of be){const[dt,qe]=De[pt],rt=T.cB(qe),Ge=T.cB(typeof dt=="string"?[dt,["accumulated"],["get",pt]]:dt);Te[pt]=rt.value,Ne[pt]=Ge.value}return Pe.map=pt=>{Me.properties=pt;const dt={};for(const qe of be)dt[qe]=Te[qe].evaluate(Oe,Me);return dt},Pe.reduce=(pt,dt)=>{Me.properties=dt;for(const qe of be)Oe.accumulated=pt[qe],pt[qe]=Ne[qe].evaluate(Oe,Me)},Pe}(U)).load((yield this._pendingData).features):(ae=yield this._pendingData,new en(ae,U.geojsonVtOptions)),this.loaded={};const _e={};if(W){const Pe=W.finish();Pe&&(_e.resourceTiming={},_e.resourceTiming[U.source]=JSON.parse(JSON.stringify(Pe)))}return _e}catch(_e){if(delete this._pendingRequest,T.cf(_e))return{abandoned:!0};throw _e}var ae})}getData(){return T._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(U){const H=this.loaded;return H&&H[U.uid]?super.reloadTile(U):this.loadTile(U)}loadAndProcessGeoJSON(U,H){return T._(this,void 0,void 0,function*(){let W=yield this.loadGeoJSON(U,H);if(delete this._pendingRequest,typeof W!="object")throw new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`);if(Ke(W,!0),U.filter){const ae=T.cB(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ae.result==="error")throw new Error(ae.value.map(Pe=>`${Pe.key}: ${Pe.message}`).join(", "));W={type:"FeatureCollection",features:W.features.filter(Pe=>ae.value.evaluate({zoom:0},Pe))}}return W})}loadGeoJSON(U,H){return T._(this,void 0,void 0,function*(){const{promoteId:W}=U;if(U.request){const ae=yield T.h(U.request,H);return this._dataUpdateable=cr(ae.data,W)?Qr(ae.data,W):void 0,ae.data}if(typeof U.data=="string")try{const ae=JSON.parse(U.data);return this._dataUpdateable=cr(ae,W)?Qr(ae,W):void 0,ae}catch{throw new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`)}if(!U.dataDiff)throw new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${U.source}`);return function(ae,_e,Pe){var De,Te,Ne,Oe;if(_e.removeAll&&ae.clear(),_e.remove)for(const Me of _e.remove)ae.delete(Me);if(_e.add)for(const Me of _e.add){const be=Cr(Me,Pe);be!=null&&ae.set(be,Me)}if(_e.update)for(const Me of _e.update){let be=ae.get(Me.id);if(be==null)continue;const pt=!Me.removeAllProperties&&(((De=Me.removeProperties)===null||De===void 0?void 0:De.length)>0||((Te=Me.addOrUpdateProperties)===null||Te===void 0?void 0:Te.length)>0);if((Me.newGeometry||Me.removeAllProperties||pt)&&(be=Object.assign({},be),ae.set(Me.id,be),pt&&(be.properties=Object.assign({},be.properties))),Me.newGeometry&&(be.geometry=Me.newGeometry),Me.removeAllProperties)be.properties={};else if(((Ne=Me.removeProperties)===null||Ne===void 0?void 0:Ne.length)>0)for(const dt of Me.removeProperties)Object.prototype.hasOwnProperty.call(be.properties,dt)&&delete be.properties[dt];if(((Oe=Me.addOrUpdateProperties)===null||Oe===void 0?void 0:Oe.length)>0)for(const{key:dt,value:qe}of Me.addOrUpdateProperties)be.properties[dt]=qe}}(this._dataUpdateable,U.dataDiff,W),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(U){return T._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(U){return this._geoJSONIndex.getClusterExpansionZoom(U.clusterId)}getClusterChildren(U){return this._geoJSONIndex.getChildren(U.clusterId)}getClusterLeaves(U){return this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset)}}class En{constructor(U){this.self=U,this.actor=new T.F(U),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(H,W)=>{if(this.externalWorkerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.externalWorkerSourceTypes[H]=W},this.self.addProtocol=T.ch,this.self.removeProtocol=T.ci,this.self.registerRTLTextPlugin=H=>{T.cC.setMethods(H)},this.actor.registerMessageHandler("LDT",(H,W)=>this._getDEMWorkerSource(H,W.source).loadTile(W)),this.actor.registerMessageHandler("RDT",(H,W)=>T._(this,void 0,void 0,function*(){this._getDEMWorkerSource(H,W.source).removeTile(W)})),this.actor.registerMessageHandler("GCEZ",(H,W)=>T._(this,void 0,void 0,function*(){return this._getWorkerSource(H,W.type,W.source).getClusterExpansionZoom(W)})),this.actor.registerMessageHandler("GCC",(H,W)=>T._(this,void 0,void 0,function*(){return this._getWorkerSource(H,W.type,W.source).getClusterChildren(W)})),this.actor.registerMessageHandler("GCL",(H,W)=>T._(this,void 0,void 0,function*(){return this._getWorkerSource(H,W.type,W.source).getClusterLeaves(W)})),this.actor.registerMessageHandler("LD",(H,W)=>this._getWorkerSource(H,W.type,W.source).loadData(W)),this.actor.registerMessageHandler("GD",(H,W)=>this._getWorkerSource(H,W.type,W.source).getData()),this.actor.registerMessageHandler("LT",(H,W)=>this._getWorkerSource(H,W.type,W.source).loadTile(W)),this.actor.registerMessageHandler("RT",(H,W)=>this._getWorkerSource(H,W.type,W.source).reloadTile(W)),this.actor.registerMessageHandler("AT",(H,W)=>this._getWorkerSource(H,W.type,W.source).abortTile(W)),this.actor.registerMessageHandler("RMT",(H,W)=>this._getWorkerSource(H,W.type,W.source).removeTile(W)),this.actor.registerMessageHandler("RS",(H,W)=>T._(this,void 0,void 0,function*(){if(!this.workerSources[H]||!this.workerSources[H][W.type]||!this.workerSources[H][W.type][W.source])return;const ae=this.workerSources[H][W.type][W.source];delete this.workerSources[H][W.type][W.source],ae.removeSource!==void 0&&ae.removeSource(W)})),this.actor.registerMessageHandler("RM",H=>T._(this,void 0,void 0,function*(){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H]})),this.actor.registerMessageHandler("SR",(H,W)=>T._(this,void 0,void 0,function*(){this.referrer=W})),this.actor.registerMessageHandler("SRPS",(H,W)=>this._syncRTLPluginState(H,W)),this.actor.registerMessageHandler("IS",(H,W)=>T._(this,void 0,void 0,function*(){this.self.importScripts(W)})),this.actor.registerMessageHandler("SI",(H,W)=>this._setImages(H,W)),this.actor.registerMessageHandler("UL",(H,W)=>T._(this,void 0,void 0,function*(){this._getLayerIndex(H).update(W.layers,W.removedIds)})),this.actor.registerMessageHandler("SL",(H,W)=>T._(this,void 0,void 0,function*(){this._getLayerIndex(H).replace(W)}))}_setImages(U,H){return T._(this,void 0,void 0,function*(){this.availableImages[U]=H;for(const W in this.workerSources[U]){const ae=this.workerSources[U][W];for(const _e in ae)ae[_e].availableImages=H}})}_syncRTLPluginState(U,H){return T._(this,void 0,void 0,function*(){return yield T.cC.syncState(H,this.self.importScripts)})}_getAvailableImages(U){let H=this.availableImages[U];return H||(H=[]),H}_getLayerIndex(U){let H=this.layerIndexes[U];return H||(H=this.layerIndexes[U]=new a),H}_getWorkerSource(U,H,W){if(this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][H]||(this.workerSources[U][H]={}),!this.workerSources[U][H][W]){const ae={sendAsync:(_e,Pe)=>(_e.targetMapId=U,this.actor.sendAsync(_e,Pe))};switch(H){case"vector":this.workerSources[U][H][W]=new de(ae,this._getLayerIndex(U),this._getAvailableImages(U));break;case"geojson":this.workerSources[U][H][W]=new Do(ae,this._getLayerIndex(U),this._getAvailableImages(U));break;default:this.workerSources[U][H][W]=new this.externalWorkerSourceTypes[H](ae,this._getLayerIndex(U),this._getAvailableImages(U))}}return this.workerSources[U][H][W]}_getDEMWorkerSource(U,H){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][H]||(this.demWorkerSources[U][H]=new ge),this.demWorkerSources[U][H]}}return T.i(self)&&(self.worker=new En(self)),En}),F("index",["exports","./shared"],function(T,a){var q="5.1.0";function Y(){var p=new a.A(4);return a.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}let fe,de;const ge={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(p,e,i){const s=requestAnimationFrame(e);p.signal.addEventListener("abort",()=>{cancelAnimationFrame(s),i(a.c())})},frameAsync(p){return new Promise((e,i)=>{this.frame(p,e,i)})},getImageData(p,e=0){return this.getImageCanvasContext(p).getImageData(-e,-e,p.width+2*e,p.height+2*e)},getImageCanvasContext(p){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=p.width,e.height=p.height,i.drawImage(p,0,0,p.width,p.height),i},resolveURL:p=>(fe||(fe=document.createElement("a")),fe.href=p,fe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(de==null&&(de=matchMedia("(prefers-reduced-motion: reduce)")),de.matches)}};class te{static testProp(e){if(!te.docStyle)return e[0];for(let i=0;i<e.length;i++)if(e[i]in te.docStyle)return e[i];return e[0]}static create(e,i,s){const c=window.document.createElement(e);return i!==void 0&&(c.className=i),s&&s.appendChild(c),c}static createNS(e,i){return window.document.createElementNS(e,i)}static disableDrag(){te.docStyle&&te.selectProp&&(te.userSelect=te.docStyle[te.selectProp],te.docStyle[te.selectProp]="none")}static enableDrag(){te.docStyle&&te.selectProp&&(te.docStyle[te.selectProp]=te.userSelect)}static setTransform(e,i){e.style[te.transformProp]=i}static addEventListener(e,i,s,c={}){e.addEventListener(i,s,"passive"in c?c:c.capture)}static removeEventListener(e,i,s,c={}){e.removeEventListener(i,s,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",te.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",te.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",te.suppressClickInternal,!0)},0)}static getScale(e){const i=e.getBoundingClientRect();return{x:i.width/e.offsetWidth||1,y:i.height/e.offsetHeight||1,boundingClientRect:i}}static getPoint(e,i,s){const c=i.boundingClientRect;return new a.P((s.clientX-c.left)/i.x-e.clientLeft,(s.clientY-c.top)/i.y-e.clientTop)}static mousePos(e,i){const s=te.getScale(e);return te.getPoint(e,s,i)}static touchPos(e,i){const s=[],c=te.getScale(e);for(let d=0;d<i.length;d++)s.push(te.getPoint(e,c,i[d]));return s}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const i=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),s=i.querySelectorAll("script");for(const c of s)c.remove();return te.clean(i),i.innerHTML}static isPossiblyDangerous(e,i){const s=i.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!s.includes("javascript:")&&!s.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const i=e.children;for(const s of i)te.removeAttributes(s),te.clean(s)}static removeAttributes(e){for(const{name:i,value:s}of e.attributes)te.isPossiblyDangerous(i,s)&&e.removeAttribute(i)}}te.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,te.selectProp=te.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),te.transformProp=te.testProp(["transform","WebkitTransform"]);const we={supported:!1,testSupport:function(p){!vt&&Ke&&(Rt?gt(p):it=p)}};let it,Ke,vt=!1,Rt=!1;function gt(p){const e=p.createTexture();p.bindTexture(p.TEXTURE_2D,e);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,Ke),p.isContextLost())return;we.supported=!0}catch{}p.deleteTexture(e),vt=!0}var nt;typeof document<"u"&&(Ke=document.createElement("img"),Ke.onload=()=>{it&&gt(it),it=null,Rt=!0},Ke.onerror=()=>{vt=!0,it=null},Ke.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let e,i,s,c;p.resetRequestQueue=()=>{e=[],i=0,s=0,c={}},p.addThrottleControl=P=>{const C=s++;return c[C]=P,C},p.removeThrottleControl=P=>{delete c[P],g()},p.getImage=(P,C,z=!0)=>new Promise((R,B)=>{we.supported&&(P.headers||(P.headers={}),P.headers.accept="image/webp,*/*"),a.e(P,{type:"image"}),e.push({abortController:C,requestParameters:P,supportImageRefresh:z,state:"queued",onError:V=>{B(V)},onSuccess:V=>{R(V)}}),g()});const d=P=>a._(this,void 0,void 0,function*(){P.state="running";const{requestParameters:C,supportImageRefresh:z,onError:R,onSuccess:B,abortController:V}=P,Z=z===!1&&!a.i(self)&&!a.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((re,se)=>re&&se==="accept",!0));i++;const ne=Z?b(C,V):a.m(C,V);try{const re=yield ne;delete P.abortController,P.state="completed",re.data instanceof HTMLImageElement||a.b(re.data)?B(re):re.data&&B({data:yield(ie=re.data,typeof createImageBitmap=="function"?a.d(ie):a.f(ie)),cacheControl:re.cacheControl,expires:re.expires})}catch(re){delete P.abortController,R(re)}finally{i--,g()}var ie}),g=()=>{const P=(()=>{for(const C of Object.keys(c))if(c[C]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=i;C<P&&e.length>0;C++){const z=e.shift();z.abortController.signal.aborted?C--:d(z)}},b=(P,C)=>new Promise((z,R)=>{const B=new Image,V=P.url,Z=P.credentials;Z&&Z==="include"?B.crossOrigin="use-credentials":(Z&&Z==="same-origin"||!a.s(V))&&(B.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{B.src="",R(a.c())}),B.fetchPriority="high",B.onload=()=>{B.onerror=B.onload=null,z({data:B})},B.onerror=()=>{B.onerror=B.onload=null,C.signal.aborted||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},B.src=V})}(nt||(nt={})),nt.resetRequestQueue();class ht{constructor(e){this._transformRequestFn=e}transformRequest(e,i){return this._transformRequestFn&&this._transformRequestFn(e,i)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Xe(p){const e=[];if(typeof p=="string")e.push({id:"default",url:p});else if(p&&p.length>0){const i=[];for(const{id:s,url:c}of p){const d=`${s}${c}`;i.indexOf(d)===-1&&(i.push(d),e.push({id:s,url:c}))}}return e}function ct(p,e,i){try{const s=new URL(p);return s.pathname+=`${e}${i}`,s.toString()}catch{throw new Error(`Invalid sprite URL "${p}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class Tt{constructor(e,i,s,c){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(i,c)}update(e,i,s){const{width:c,height:d}=e,g=!(this.size&&this.size[0]===c&&this.size[1]===d||s),{context:b}=this,{gl:P}=b;if(this.useMipmap=!!(i&&i.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!i||i.premultiply!==!1)),g)this.size=[c,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||a.b(e)?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,e):P.texImage2D(P.TEXTURE_2D,0,this.format,c,d,0,this.format,P.UNSIGNED_BYTE,e.data);else{const{x:C,y:z}=s||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||a.b(e)?P.texSubImage2D(P.TEXTURE_2D,0,C,z,P.RGBA,P.UNSIGNED_BYTE,e):P.texSubImage2D(P.TEXTURE_2D,0,C,z,c,d,P.RGBA,P.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)}bind(e,i,s){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),s!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=d.LINEAR),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,s||e),this.filter=e),i!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function $t(p){const{userImage:e}=p;return!!(e&&e.render&&e.render())&&(p.data.replace(new Uint8Array(e.data.buffer)),!0)}class Bi extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:i,promiseResolve:s}of this.requestors)s(this._getImagesForIds(i));this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const s=i.spriteData;i.data=new a.R({width:s.width,height:s.height},s.context.getImageData(s.x,s.y,s.width,s.height).data),i.spriteData=null}return i}addImage(e,i){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,i)&&(this.images[e]=i)}_validate(e,i){let s=!0;const c=i.data||i.spriteData;return this._validateStretch(i.stretchX,c&&c.width)||(this.fire(new a.j(new Error(`Image "${e}" has invalid "stretchX" value`))),s=!1),this._validateStretch(i.stretchY,c&&c.height)||(this.fire(new a.j(new Error(`Image "${e}" has invalid "stretchY" value`))),s=!1),this._validateContent(i.content,i)||(this.fire(new a.j(new Error(`Image "${e}" has invalid "content" value`))),s=!1),s}_validateStretch(e,i){if(!e)return!0;let s=0;for(const c of e){if(c[0]<s||c[1]<c[0]||i<c[1])return!1;s=c[1]}return!0}_validateContent(e,i){if(!e)return!0;if(e.length!==4)return!1;const s=i.spriteData,c=s&&s.width||i.data.width,d=s&&s.height||i.data.height;return!(e[0]<0||c<e[0]||e[1]<0||d<e[1]||e[2]<0||c<e[2]||e[3]<0||d<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,i,s=!0){const c=this.getImage(e);if(s&&(c.data.width!==i.data.width||c.data.height!==i.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${i.data.width}x${i.data.height}).`);i.version=c.version+1,this.images[e]=i,this.updatedImages[e]=!0}removeImage(e){const i=this.images[e];delete this.images[e],delete this.patterns[e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((i,s)=>{let c=!0;if(!this.isLoaded())for(const d of e)this.images[d]||(c=!1);this.isLoaded()||c?i(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:i})})}_getImagesForIds(e){const i={};for(const s of e){let c=this.getImage(s);c||(this.fire(new a.k("styleimagemissing",{id:s})),c=this.getImage(s)),c?i[s]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:a.w(`Image "${s}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:e,height:i}=this.atlasImage;return{width:e,height:i}}getPattern(e){const i=this.patterns[e],s=this.getImage(e);if(!s)return null;if(i&&i.position.version===s.version)return i.position;if(i)i.position.version=s.version;else{const c={w:s.data.width+2,h:s.data.height+2,x:0,y:0},d=new a.I(c,s);this.patterns[e]={bin:c,position:d}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Tt(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const d in this.patterns)e.push(this.patterns[d].bin);const{w:i,h:s}=a.p(e),c=this.atlasImage;c.resize({width:i||1,height:s||1});for(const d in this.patterns){const{bin:g}=this.patterns[d],b=g.x+1,P=g.y+1,C=this.getImage(d).data,z=C.width,R=C.height;a.R.copy(C,c,{x:0,y:0},{x:b,y:P},{width:z,height:R}),a.R.copy(C,c,{x:0,y:R-1},{x:b,y:P-1},{width:z,height:1}),a.R.copy(C,c,{x:0,y:0},{x:b,y:P+R},{width:z,height:1}),a.R.copy(C,c,{x:z-1,y:0},{x:b-1,y:P},{width:1,height:R}),a.R.copy(C,c,{x:0,y:0},{x:b+z,y:P},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const s=this.getImage(i);s||a.w(`Image with ID: "${i}" was not found`),$t(s)&&this.updateImage(i,s)}}}const Jt=1e20;function Ot(p,e,i,s,c,d,g,b,P){for(let C=e;C<e+s;C++)Ft(p,i*d+C,d,c,g,b,P);for(let C=i;C<i+c;C++)Ft(p,C*d+e,1,s,g,b,P)}function Ft(p,e,i,s,c,d,g){d[0]=0,g[0]=-1e20,g[1]=Jt,c[0]=p[e];for(let b=1,P=0,C=0;b<s;b++){c[b]=p[e+b*i];const z=b*b;do{const R=d[P];C=(c[b]-c[R]+z-R*R)/(b-R)/2}while(C<=g[P]&&--P>-1);P++,d[P]=b,g[P]=C,g[P+1]=Jt}for(let b=0,P=0;b<s;b++){for(;g[P+1]<b;)P++;const C=d[P],z=b-C;p[e+b*i]=c[C]+z*z}}class Pt{constructor(e,i){this.requestManager=e,this.localIdeographFontFamily=i,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return a._(this,void 0,void 0,function*(){const i=[];for(const d in e)for(const g of e[d])i.push(this._getAndCacheGlyphsPromise(d,g));const s=yield Promise.all(i),c={};for(const{stack:d,id:g,glyph:b}of s)c[d]||(c[d]={}),c[d][g]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return c})}_getAndCacheGlyphsPromise(e,i){return a._(this,void 0,void 0,function*(){let s=this.entries[e];s||(s=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=s.glyphs[i];if(c!==void 0)return{stack:e,id:i,glyph:c};if(c=this._tinySDF(s,e,i),c)return s.glyphs[i]=c,{stack:e,id:i,glyph:c};const d=Math.floor(i/256);if(256*d>65535)throw new Error("glyphs > 65535 not supported");if(s.ranges[d])return{stack:e,id:i,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!s.requests[d]){const b=Pt.loadGlyphRange(e,d,this.url,this.requestManager);s.requests[d]=b}const g=yield s.requests[d];for(const b in g)this._doesCharSupportLocalGlyph(+b)||(s.glyphs[+b]=g[+b]);return s.ranges[d]=!0,{stack:e,id:i,glyph:g[i]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(e))}_tinySDF(e,i,s){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(s))return;let d=e.tinySDF;if(!d){let b="400";/bold/i.test(i)?b="900":/medium/i.test(i)?b="500":/light/i.test(i)&&(b="200"),d=e.tinySDF=new Pt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:b})}const g=d.draw(String.fromCharCode(s));return{id:s,bitmap:new a.o({width:g.width||60,height:g.height||60},g.data),metrics:{width:g.glyphWidth/2||24,height:g.glyphHeight/2||24,left:g.glyphLeft/2+.5||0,top:g.glyphTop/2-27.5||-8,advance:g.glyphAdvance/2||24,isDoubleResolution:!0}}}}Pt.loadGlyphRange=function(p,e,i,s){return a._(this,void 0,void 0,function*(){const c=256*e,d=c+255,g=s.transformRequest(i.replace("{fontstack}",p).replace("{range}",`${c}-${d}`),"Glyphs"),b=yield a.l(g,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${d}`);const P={};for(const C of a.n(b.data))P[C.id]=C;return P})},Pt.TinySDF=class{constructor({fontSize:p=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=i;const b=this.size=p+4*e,P=this._createCanvas(b),C=this.ctx=P.getContext("2d",{willReadFrequently:!0});C.font=`${g} ${d} ${p}px ${c}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(p){const e=document.createElement("canvas");return e.width=e.height=p,e}draw(p){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(p),g=Math.ceil(i),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),P=Math.min(this.size-this.buffer,g+Math.ceil(s)),C=b+2*this.buffer,z=P+2*this.buffer,R=Math.max(C*z,0),B=new Uint8ClampedArray(R),V={data:B,width:C,height:z,glyphWidth:b,glyphHeight:P,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(b===0||P===0)return V;const{ctx:Z,buffer:ne,gridInner:ie,gridOuter:re}=this;Z.clearRect(ne,ne,b,P),Z.fillText(p,ne,ne+g);const se=Z.getImageData(ne,ne,b,P);re.fill(Jt,0,R),ie.fill(0,0,R);for(let ue=0;ue<P;ue++)for(let he=0;he<b;he++){const me=se.data[4*(ue*b+he)+3]/255;if(me===0)continue;const ve=(ue+ne)*C+he+ne;if(me===1)re[ve]=0,ie[ve]=Jt;else{const ye=.5-me;re[ve]=ye>0?ye*ye:0,ie[ve]=ye<0?ye*ye:0}}Ot(re,0,0,C,z,C,this.f,this.v,this.z),Ot(ie,ne,ne,b,P,C,this.f,this.v,this.z);for(let ue=0;ue<R;ue++){const he=Math.sqrt(re[ue])-Math.sqrt(ie[ue]);B[ue]=Math.round(255-255*(he/this.radius+this.cutoff))}return V}};class Wt{constructor(){this.specification=a.v.light.position}possiblyEvaluate(e,i){return a.x(e.expression.evaluate(i))}interpolate(e,i,s){return{x:a.y.number(e.x,i.x,s),y:a.y.number(e.y,i.y,s),z:a.y.number(e.z,i.z,s)}}}let jt;class gi extends a.E{constructor(e){super(),jt=jt||new a.q({anchor:new a.D(a.v.light.anchor),position:new Wt,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(jt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(a.r,e,i))for(const s in e){const c=e[s];s.endsWith("-transition")?this._transitionable.setTransition(s.slice(0,-11),c):this._transitionable.setValue(s,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,s){return(!s||s.validate!==!1)&&a.t(this,e.call(a.u,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const Pi=new a.q({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class cn extends a.E{constructor(e){super(),this._transitionable=new a.T(Pi),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.z(0))}setSky(e,i={}){if(!this._validate(a.B,e,i)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const s in e){const c=e[s];s.endsWith("-transition")?this._transitionable.setTransition(s.slice(0,-11),c):this._transitionable.setValue(s,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,s={}){return(s==null?void 0:s.validate)!==!1&&a.t(this,e.call(a.u,a.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Yi{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,i){const s=e.join(",")+String(i);return this.dashEntry[s]||(this.dashEntry[s]=this.addDash(e,i)),this.dashEntry[s]}getDashRanges(e,i,s){const c=[];let d=e.length%2==1?-e[e.length-1]*s:0,g=e[0]*s,b=!0;c.push({left:d,right:g,isDash:b,zeroLength:e[0]===0});let P=e[0];for(let C=1;C<e.length;C++){b=!b;const z=e[C];d=P*s,P+=z,g=P*s,c.push({left:d,right:g,isDash:b,zeroLength:z===0})}return c}addRoundDash(e,i,s){const c=i/2;for(let d=-s;d<=s;d++){const g=this.width*(this.nextRow+s+d);let b=0,P=e[b];for(let C=0;C<this.width;C++){C/P.right>1&&(P=e[++b]);const z=Math.abs(C-P.left),R=Math.abs(C-P.right),B=Math.min(z,R);let V;const Z=d/s*(c+1);if(P.isDash){const ne=c-Math.abs(Z);V=Math.sqrt(B*B+ne*ne)}else V=c-Math.sqrt(B*B+Z*Z);this.data[g+C]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(e){for(let b=e.length-1;b>=0;--b){const P=e[b],C=e[b+1];P.zeroLength?e.splice(b,1):C&&C.isDash===P.isDash&&(C.left=P.left,e.splice(b,1))}const i=e[0],s=e[e.length-1];i.isDash===s.isDash&&(i.left=s.left-this.width,s.right=i.right+this.width);const c=this.width*this.nextRow;let d=0,g=e[d];for(let b=0;b<this.width;b++){b/g.right>1&&(g=e[++d]);const P=Math.abs(b-g.left),C=Math.abs(b-g.right),z=Math.min(P,C);this.data[c+b]=Math.max(0,Math.min(255,(g.isDash?z:-z)+128))}}addDash(e,i){const s=i?7:0,c=2*s+1;if(this.nextRow+c>this.height)return a.w("LineAtlas out of space"),null;let d=0;for(let b=0;b<e.length;b++)d+=e[b];if(d!==0){const b=this.width/d,P=this.getDashRanges(e,this.width,b);i?this.addRoundDash(P,b,s):this.addRegularDash(P)}const g={y:(this.nextRow+s+.5)/this.height,height:2*s/this.height,width:d};return this.nextRow+=c,this.dirty=!0,g}bind(e){const i=e.gl;this.texture?(i.bindTexture(i.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(i.TEXTURE_2D,0,0,0,this.width,this.height,i.ALPHA,i.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.ALPHA,this.width,this.height,0,i.ALPHA,i.UNSIGNED_BYTE,this.data))}}const ni="maplibre_preloaded_worker_pool";class br{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<br.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ni]}numActive(){return Object.keys(this.active).length}}const wr=Math.floor(ge.hardwareConcurrency/2);let pn,Fi;function Tr(){return pn||(pn=new br),pn}br.workerCount=a.C(globalThis)?Math.max(Math.min(wr,3),1):1;class fr{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=i;const s=this.workerPool.acquire(i);for(let c=0;c<s.length;c++){const d=new a.F(s[c],i);d.name=`Worker ${c}`,this.actors.push(d)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,i){const s=[];for(const c of this.actors)s.push(c.sendAsync({type:e,data:i}));return Promise.all(s)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(i=>{i.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,i){for(const s of this.actors)s.registerMessageHandler(e,i)}}function mr(){return Fi||(Fi=new fr(Tr(),a.G),Fi.registerMessageHandler("GR",(p,e,i)=>a.m(e,i))),Fi}function In(p,e){const i=a.H();return a.J(i,i,[1,1,0]),a.K(i,i,[.5*p.width,.5*p.height,1]),p.calculatePosMatrix?a.L(i,i,p.calculatePosMatrix(e.toUnwrapped())):i}function gr(p,e,i,s,c,d){var g;const b=function(R,B,V){if(R)for(const Z of R){const ne=B[Z];if(ne&&ne.source===V&&ne.type==="fill-extrusion")return!0}else for(const Z in B){const ne=B[Z];if(ne.source===V&&ne.type==="fill-extrusion")return!0}return!1}((g=c==null?void 0:c.layers)!==null&&g!==void 0?g:null,e,p.id),P=d.maxPitchScaleFactor(),C=p.tilesIn(s,P,b);C.sort(Ji);const z=[];for(const R of C)z.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(e,i,p._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,c,d,P,In(p.transform,R.tileID))});return function(R,B){for(const V in R)for(const Z of R[V])Ni(Z,B);return R}(function(R){const B={},V={};for(const Z of R){const ne=Z.queryResults,ie=Z.wrappedTileID,re=V[ie]=V[ie]||{};for(const se in ne){const ue=ne[se],he=re[se]=re[se]||{},me=B[se]=B[se]||[];for(const ve of ue)he[ve.featureIndex]||(he[ve.featureIndex]=!0,me.push(ve))}}return B}(z),p)}function Ji(p,e){const i=p.tileID,s=e.tileID;return i.overscaledZ-s.overscaledZ||i.canonical.y-s.canonical.y||i.wrap-s.wrap||i.canonical.x-s.canonical.x}function Ni(p,e){const i=p.feature,s=e.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=s}function Zn(p,e,i){return a._(this,void 0,void 0,function*(){let s=p;if(p.url?s=(yield a.h(e.transformRequest(p.url,"Source"),i)).data:yield ge.frameAsync(i),!s)return null;const c=a.M(a.e(s,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in s&&s.vector_layers&&(c.vectorLayerIds=s.vector_layers.map(d=>d.id)),c})}class mi{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof a.N?new a.N(e.lng,e.lat):a.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof a.N?new a.N(e.lng,e.lat):a.N.convert(e),this}extend(e){const i=this._sw,s=this._ne;let c,d;if(e instanceof a.N)c=e,d=e;else{if(!(e instanceof mi))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(mi.convert(e)):this.extend(a.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(a.N.convert(e)):this;if(c=e._sw,d=e._ne,!c||!d)return this}return i||s?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),s.lng=Math.max(d.lng,s.lng),s.lat=Math.max(d.lat,s.lat)):(this._sw=new a.N(c.lng,c.lat),this._ne=new a.N(d.lng,d.lat)),this}getCenter(){return new a.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.N(this.getWest(),this.getNorth())}getSouthEast(){return new a.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=a.N.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){return e instanceof mi?e:e&&new mi(e)}static fromLngLat(e,i=0){const s=360*i/40075017,c=s/Math.cos(Math.PI/180*e.lat);return new mi(new a.N(e.lng-c,e.lat-s),new a.N(e.lng+c,e.lat+s))}adjustAntiMeridian(){const e=new a.N(this._sw.lng,this._sw.lat),i=new a.N(this._ne.lng,this._ne.lat);return new mi(e,e.lng>i.lng?new a.N(i.lng+360,i.lat):i)}}class Sr{constructor(e,i,s){this.bounds=mi.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=s||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),s=Math.floor(a.O(this.bounds.getWest())*i),c=Math.floor(a.Q(this.bounds.getNorth())*i),d=Math.ceil(a.O(this.bounds.getEast())*i),g=Math.ceil(a.Q(this.bounds.getSouth())*i);return e.x>=s&&e.x<d&&e.y>=c&&e.y<g}}class Yn extends a.E{constructor(e,i,s,c){if(super(),this.id=e,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.M(i,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Zn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(a.e(this,e),e.bounds&&(this.tileBounds=new Sr(e.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new a.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(e){return a._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),s={request:this.map._requestManager.transformRequest(i,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};s.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((d,g)=>{e.reloadPromise={resolve:d,reject:g}})}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{const d=yield e.actor.sendAsync({type:c,data:s},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,d)}catch(d){if(delete e.abortController,e.aborted)return;if(d&&d.status!==404)throw d;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,i){if(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),i&&this.map._refreshExpiredTiles&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),e.reloadPromise){const s=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(s.resolve).catch(s.reject)}}abortTile(e){return a._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return a._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Qi extends a.E{constructor(e,i,s,c){super(),this.id=e,this.dispatcher=s,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},i),a.e(this,a.M(i,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Zn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(a.e(this,i),i.bounds&&(this.tileBounds=new Sr(i.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(i){this._tileJSONRequest=null,this.fire(new a.j(i))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return a.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return a._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const s=yield nt.getImage(this.map._requestManager.transformRequest(i,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(s&&s.data){this.map._refreshExpiredTiles&&s.cacheControl&&s.expires&&e.setExpiryData({cacheControl:s.cacheControl,expires:s.expires});const c=this.map.painter.context,d=c.gl,g=s.data;e.texture=this.map.painter.getTileTexture(g.width),e.texture?e.texture.update(g,{useMipmap:!0}):(e.texture=new Tt(c,g,d.RGBA,{useMipmap:!0}),e.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(s){if(delete e.abortController,e.aborted)e.state="unloaded";else if(s)throw e.state="errored",s}})}abortTile(e){return a._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return a._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Nr extends Qi{constructor(e,i,s,c){super(e,i,s,c),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e){return a._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),s=this.map._requestManager.transformRequest(i,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const c=yield nt.getImage(s,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){const d=c.data;this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const g=a.b(d)&&a.U()?d:yield this.readImageNow(d),b={type:this.type,uid:e.uid,source:this.id,rawImageData:g,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const P=yield e.actor.sendAsync({type:"LDT",data:b});e.dem=P,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}readImageNow(e){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.V()){const i=e.width+2,s=e.height+2;try{return new a.R({width:i,height:s},yield a.W(e,-1,-1,i,s))}catch{}}return ge.getImageData(e,1)})}_getNeighboringTiles(e){const i=e.canonical,s=Math.pow(2,i.z),c=(i.x-1+s)%s,d=i.x===0?e.wrap-1:e.wrap,g=(i.x+1+s)%s,b=i.x+1===s?e.wrap+1:e.wrap,P={};return P[new a.S(e.overscaledZ,d,i.z,c,i.y).key]={backfilled:!1},P[new a.S(e.overscaledZ,b,i.z,g,i.y).key]={backfilled:!1},i.y>0&&(P[new a.S(e.overscaledZ,d,i.z,c,i.y-1).key]={backfilled:!1},P[new a.S(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},P[new a.S(e.overscaledZ,b,i.z,g,i.y-1).key]={backfilled:!1}),i.y+1<s&&(P[new a.S(e.overscaledZ,d,i.z,c,i.y+1).key]={backfilled:!1},P[new a.S(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},P[new a.S(e.overscaledZ,b,i.z,g,i.y+1).key]={backfilled:!1}),P}unloadTile(e){return a._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class ar extends a.E{constructor(e,i,s,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=s.getActor(),this.setEventedParent(c),this._data=i.data,this._options=a.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,i.clusterMaxZoom!==void 0&&this.maxzoom<=i.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(i.buffer!==void 0?i.buffer:128),tolerance:this._pixelsToTileUnits(i.tolerance!==void 0?i.tolerance:.375),extent:a.X,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:a.X,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(a.X/this.tileSize)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return a._(this,void 0,void 0,function*(){const e=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,i,s){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:i,offset:s}})}_updateWorkerData(e){return a._(this,void 0,void 0,function*(){const i=a.e({type:this.type},this.workerOptions);e?i.dataDiff=e:typeof this._data=="string"?(i.request=this.map._requestManager.transformRequest(ge.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const s=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||s.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let c=null;s.resourceTiming&&s.resourceTiming[this.id]&&(c=s.resourceTiming[this.id].slice(0));const d={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&a.e(d,{resourceTiming:c}),this.fire(new a.k("data",Object.assign(Object.assign({},d),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},d),{sourceDataType:"content"})))}catch(s){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(s))}})}loaded(){return this._pendingLoads===0}loadTile(e){return a._(this,void 0,void 0,function*(){const i=e.actor?"RT":"LT";e.actor=this.actor;const s={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const c=yield this.actor.sendAsync({type:i,data:s},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,i==="RT")})}abortTile(e){return a._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return a._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class yn extends a.E{constructor(e,i,s,c){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=s,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=i}load(e){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const i=yield nt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,i&&i.data&&(this.image=i.data,e&&(this.coordinates=e),this._finishLoading())}catch(i){this._request=null,this._loaded=!0,this.fire(new a.j(i))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(a.Y.fromLngLat);var s;return this.tileID=function(c){let d=1/0,g=1/0,b=-1/0,P=-1/0;for(const B of c)d=Math.min(d,B.x),g=Math.min(g,B.y),b=Math.max(b,B.x),P=Math.max(P,B.y);const C=Math.max(b-d,P-g),z=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),R=Math.pow(2,z);return new a.Z(z,Math.floor((d+b)/2*R),Math.floor((g+P)/2*R))}(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map(c=>this.tileID.getTilePoint(c)._round()),this.flippedWindingOrder=((s=this.tileCoords)[1].x-s[0].x)*(s[2].y-s[0].y)-(s[1].y-s[0].y)*(s[2].x-s[0].x)<0,this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,i=e.gl;this.texture||(this.texture=new Tt(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let s=!1;for(const c in this.tiles){const d=this.tiles[c];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,s=!0)}s&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class An extends yn{constructor(e,i,s,c){super(e,i,s,c),this.roundZoom=!0,this.type="video",this.options=i}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,"Source").url);try{const i=yield a.a0(this.urls);if(this._loaded=!0,!i)return;this.video=i,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(i){this.fire(new a.j(i))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new a.j(new a.$(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new Tt(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let s=!1;for(const c in this.tiles){const d=this.tiles[c];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,s=!0)}s&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class vn extends yn{constructor(e,i,s,c){super(e,i,s,c),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(g=>typeof g!="number"))||this.fire(new a.j(new a.$(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.$(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new a.j(new a.$(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.$(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.$(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,s=i.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Tt(i,this.canvas,s.RGBA,{premultiply:!0});let c=!1;for(const d in this.tiles){const g=this.tiles[d];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,c=!0)}c&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const lr={},Jo=p=>{switch(p){case"geojson":return ar;case"image":return yn;case"raster":return Qi;case"raster-dem":return Nr;case"vector":return Yn;case"video":return An;case"canvas":return vn}return lr[p]},Bn="RTLPluginLoaded";class $r extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=mr()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(i=>{throw this.status="error",i})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return a._(this,arguments,void 0,function*(i,s=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ge.resolveURL(i),!this.url)throw new Error(`requested url ${i} is invalid`);if(this.status==="unavailable"){if(!s)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(Bn))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Pr=null;function en(){return Pr||(Pr=new $r),Pr}class Mr{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=a.a1(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const i=e+this.timeAdded;i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,d){const g={};if(!d)return g;for(const b of c){const P=b.layerIds.map(C=>d.getLayer(C)).filter(Boolean);if(P.length!==0){b.layers=P,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(C=>P.filter(z=>z.id===C)[0]));for(const C of P)g[C.id]=b}}return g}(e.buckets,i==null?void 0:i.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof a.a3){if(this.hasSymbolBuckets=!0,!s)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof a.a3&&d.hasRTLText){this.hasRTLText=!0,en().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(c).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new a.a2}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const c=this.buckets[s];c.uploadPending()&&c.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Tt(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Tt(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,s,c,d,g,b,P,C,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:d,scale:g,tileSize:this.tileSize,pixelPosMatrix:z,transform:P,params:b,queryPadding:this.queryPadding*C},e,i,s):{}}querySourceFeatures(e,i){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const c=s.loadVTLayers(),d=i&&i.sourceLayer?i.sourceLayer:"",g=c._geojsonTileLayer||c[d];if(!g)return;const b=a.a4(i&&i.filter),{z:P,x:C,y:z}=this.tileID.canonical,R={z:P,x:C,y:z};for(let B=0;B<g.length;B++){const V=g.feature(B);if(b.needGeometry){const ie=a.a5(V,!0);if(!b.filter(new a.z(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!b.filter(new a.z(this.tileID.overscaledZ),V))continue;const Z=s.getId(V,d),ne=new a.a6(V,P,C,z,Z);ne.tile=R,e.push(ne)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const s=a.a7(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let c=!1;if(this.expirationTime>s)c=!1;else if(i)if(this.expirationTime<i)c=!0;else{const d=this.expirationTime-i;d?this.expirationTime=s+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const s=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!i.style.hasLayer(c))continue;const d=this.buckets[c],g=d.layers[0].sourceLayer||"_geojsonTileLayer",b=s[g],P=e[g];if(!b||!P||Object.keys(P).length===0)continue;d.update(P,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=i&&i.style&&i.style.getLayer(c);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ge.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ge.now()+e}setDependencies(e,i){const s={};for(const c of i)s[c]=!0;this.dependencies[e]=s}hasDependency(e,i){for(const s of e){const c=this.dependencies[s];if(c){for(const d of i)if(c[d])return!0}}return!1}}class Cr{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,s){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:i,timeout:void 0};if(s!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},s)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const s=e.wrapped().key,c=i===void 0?0:this.data[s].indexOf(i),d=this.data[s][c];return this.data[s].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(d.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const s in this.data)for(const c of this.data[s])e(c.value)||i.push(c);for(const s of i)this.remove(s.value.tileID,s)}}class cr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,s){const c=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},a.e(this.stateChanges[e][c],s),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==c&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const d in this.state[e][c])s[d]||(this.deletedStates[e][c][d]=null)}else for(const d in s)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][d]===null&&delete this.deletedStates[e][c][d]}removeFeatureState(e,i,s){if(this.deletedStates[e]===null)return;const c=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&i!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][s]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(s in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][s]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,i){const s=String(i),c=a.e({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][i];if(d===null)return{};for(const g in d)delete c[g]}return c}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const s={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const g in this.stateChanges[c])this.state[c][g]||(this.state[c][g]={}),a.e(this.state[c][g],this.stateChanges[c][g]),d[g]=this.state[c][g];s[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const g in this.state[c])d[g]={},this.state[c][g]={};else for(const g in this.deletedStates[c]){if(this.deletedStates[c][g]===null)this.state[c][g]={};else for(const b of Object.keys(this.deletedStates[c][g]))delete this.state[c][g][b];d[g]=this.state[c][g]}s[c]=s[c]||{},a.e(s[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(const c in e)e[c].setFeatureState(s,i)}}function Qr(p,e,i){const s=e.intersectsFrustum(p);if(!i)return s;const c=e.intersectsPlane(i);return s===0||c===0?0:s===2&&c===2?2:1}function Do(p,e,i,s,c){let d=p;const g=Math.atan(e/i),b=Math.hypot(e,i);return d=p+a.a8(s/b/Math.max(.5,Math.cos(a.aa(c/2)))),d+=1*a.a8(Math.cos(g))/2,d+=a.ab(p-d,-0,0),d}function En(p,e){const i=(e.roundZoom?Math.round:Math.floor)(p.zoom+a.a8(p.tileSize/e.tileSize));return Math.max(0,i)}function Q(p,e){const i=p.getCameraFrustum(),s=p.getClippingPlane(),c=p.screenPointToMercatorCoordinate(p.getCameraPoint()),d=a.Y.fromLngLat(p.center,p.elevation);c.z=d.z+Math.cos(p.pitchInRadians)*p.cameraToCenterDistance/p.worldSize;const g=p.getCoveringTilesDetailsProvider(),b=g.allowVariableZoom(p,e),P=En(p,e),C=e.minzoom||0,z=e.maxzoom!==void 0?e.maxzoom:p.maxZoom,R=Math.min(Math.max(0,P),z),B=Math.pow(2,R),V=[B*c.x,B*c.y,0],Z=[B*d.x,B*d.y,0],ne=Math.hypot(d.x-c.x,d.y-c.y),ie=Math.abs(d.z-c.z),re=Math.hypot(ne,ie),se=me=>({zoom:0,x:0,y:0,wrap:me,fullyVisible:!1}),ue=[],he=[];if(p.renderWorldCopies&&g.allowWorldCopies())for(let me=1;me<=3;me++)ue.push(se(-me)),ue.push(se(me));for(ue.push(se(0));ue.length>0;){const me=ue.pop(),ve=me.x,ye=me.y;let ze=me.fullyVisible;const Le={x:ve,y:ye,z:me.zoom},Ve=g.getTileAABB(Le,me.wrap,p.elevation,e);if(!ze){const ft=Qr(i,Ve,s);if(ft===0)continue;ze=ft===2}const He=g.distanceToTile2d(c.x,c.y,Le,Ve);let je=P;b&&(je=(e.calculateTileZoom||Do)(p.zoom+a.a8(p.tileSize/e.tileSize),He,ie,re,p.fov)),je=(e.roundZoom?Math.round:Math.floor)(je),je=Math.max(0,je);const We=Math.min(je,z);if(me.wrap=g.getWrap(d,Le,me.wrap),me.zoom>=We){if(me.zoom<C)continue;const ft=R-me.zoom,et=V[0]-.5-(ve<<ft),_t=V[1]-.5-(ye<<ft),Ut=e.reparseOverscaled?Math.max(me.zoom,je):me.zoom;he.push({tileID:new a.S(me.zoom===z?Ut:me.zoom,me.wrap,me.zoom,ve,ye),distanceSq:a.a9([Z[0]-.5-ve,Z[1]-.5-ye]),tileDistanceToCamera:Math.sqrt(et*et+_t*_t)})}else for(let ft=0;ft<4;ft++)ue.push({zoom:me.zoom+1,x:(ve<<1)+ft%2,y:(ye<<1)+(ft>>1),wrap:me.wrap,fullyVisible:ze})}return he.sort((me,ve)=>me.distanceSq-ve.distanceSq).map(me=>me.tileID)}class U extends a.E{constructor(e,i,s){super(),this.id=e,this.dispatcher=s,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,d,g,b)=>{const P=new(Jo(d.type))(c,d,g,b);if(P.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${P.id}`);return P})(e,i,s,this),this._tiles={},this._cache=new Cr(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new cr,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,i,s){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,i,s)}catch(c){e.state="errored",c.status!==404?this._source.fire(new a.j(c,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new a.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const s=this._tiles[i];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(H).map(e=>e.key)}getRenderableIds(e){const i=[];for(const s in this._tiles)this._isIdRenderable(s,e)&&i.push(this._tiles[s]);return e?i.sort((s,c)=>{const d=s.tileID,g=c.tileID,b=new a.P(d.canonical.x,d.canonical.y)._rotate(-this.transform.bearingInRadians),P=new a.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians);return d.overscaledZ-g.overscaledZ||P.y-b.y||P.x-b.x}).map(s=>s.tileID.key):i.map(s=>s.tileID).sort(H).map(s=>s.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)(e||this._tiles[i].state!=="errored")&&this._reloadTile(i,"reloading")}}_reloadTile(e,i){return a._(this,void 0,void 0,function*(){const s=this._tiles[e];s&&(s.state!=="loading"&&(s.state=i),yield this._loadTile(s,e,i))})}_tileLoaded(e,i,s){e.timeAdded=ge.now(),s==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const i=this.getRenderableIds();for(let c=0;c<i.length;c++){const d=i[c];if(e.neighboringTiles&&e.neighboringTiles[d]){const g=this.getTileByID(d);s(e,g),s(g,e)}}function s(c,d){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let g=d.tileID.canonical.x-c.tileID.canonical.x;const b=d.tileID.canonical.y-c.tileID.canonical.y,P=Math.pow(2,c.tileID.canonical.z),C=d.tileID.key;g===0&&b===0||Math.abs(b)>1||(Math.abs(g)>1&&(Math.abs(g+P)===1?g+=P:Math.abs(g-P)===1&&(g-=P)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,g,b),c.neighboringTiles&&c.neighboringTiles[C]&&(c.neighboringTiles[C].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,s,c){for(const d in this._tiles){let g=this._tiles[d];if(c[d]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>s)continue;let b=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const C=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[C.key],g&&g.hasData()&&(b=C)}let P=b;for(;P.overscaledZ>i;)if(P=P.scaledTo(P.overscaledZ-1),e[P.key]||e[P.canonical.key]){c[b.key]=b;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=i?s:null}for(let s=e.overscaledZ-1;s>=i;s--){const c=e.scaledTo(s),d=this._getLoadedTile(c);if(d)return d}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,s=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(i*s*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(d)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const s={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+i),s[d.tileID.key]=d}this._tiles=s;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}_updateCoveredAndRetainedTiles(e,i,s,c,d,g){const b={},P={},C=Object.keys(e),z=ge.now();for(const R of C){const B=e[R],V=this._tiles[R];if(!V||V.fadeEndTime!==0&&V.fadeEndTime<=z)continue;const Z=this.findLoadedParent(B,i),ne=this.findLoadedSibling(B),ie=Z||ne||null;ie&&(this._addTile(ie.tileID),b[ie.tileID.key]=ie.tileID),P[R]=B}this._retainLoadedChildren(P,c,s,e);for(const R in b)e[R]||(this._coveredTiles[R]=!0,e[R]=b[R]);if(g){const R={},B={};for(const V of d)this._tiles[V.key].hasData()?R[V.key]=V:B[V.key]=V;for(const V in B){const Z=B[V].children(this._source.maxzoom);this._tiles[Z[0].key]&&this._tiles[Z[1].key]&&this._tiles[Z[2].key]&&this._tiles[Z[3].key]&&(R[Z[0].key]=e[Z[0].key]=Z[0],R[Z[1].key]=e[Z[1].key]=Z[1],R[Z[2].key]=e[Z[2].key]=Z[2],R[Z[3].key]=e[Z[3].key]=Z[3],delete B[V])}for(const V in B){const Z=B[V],ne=this.findLoadedParent(Z,this._source.minzoom),ie=this.findLoadedSibling(Z),re=ne||ie||null;if(re){R[re.tileID.key]=e[re.tileID.key]=re.tileID;for(const se in R)R[se].isChildOf(re.tileID)&&delete R[se]}}for(const V in this._tiles)R[V]||(this._coveredTiles[V]=!0)}}update(e,i){if(!this._sourceLoaded||this._paused)return;let s;this.transform=e,this.terrain=i,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?s=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new a.S(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)):(s=Q(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(s=s.filter(z=>this._source.hasTile(z)))):s=[];const c=En(e,this._source),d=Math.max(c-U.maxOverzooming,this._source.minzoom),g=Math.max(c+U.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const z={};for(const R of s)if(R.canonical.z>this._source.minzoom){const B=R.scaledTo(R.canonical.z-1);z[B.key]=B;const V=R.scaledTo(Math.max(this._source.minzoom,Math.min(R.canonical.z,5)));z[V.key]=V}s=s.concat(Object.values(z))}const b=s.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const P=this._updateRetainedTiles(s,c);W(this._source.type)&&this._updateCoveredAndRetainedTiles(P,d,g,c,s,i);for(const z in P)this._tiles[z].clearFadeHold();const C=a.ac(this._tiles,P);for(const z of C){const R=this._tiles[z];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(z)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,i){var s;const c={},d={},g=Math.max(i-U.maxOverzooming,this._source.minzoom),b=Math.max(i+U.maxUnderzooming,this._source.minzoom),P={};for(const C of e){const z=this._addTile(C);c[C.key]=C,z.hasData()||i<this._source.maxzoom&&(P[C.key]=C)}this._retainLoadedChildren(P,i,b,c);for(const C of e){let z=this._tiles[C.key];if(z.hasData())continue;if(i+1>this._source.maxzoom){const B=C.children(this._source.maxzoom)[0],V=this.getTile(B);if(V&&V.hasData()){c[B.key]=B;continue}}else{const B=C.children(this._source.maxzoom);if(c[B[0].key]&&c[B[1].key]&&c[B[2].key]&&c[B[3].key])continue}let R=z.wasRequested();for(let B=C.overscaledZ-1;B>=g;--B){const V=C.scaledTo(B);if(d[V.key])break;if(d[V.key]=!0,z=this.getTile(V),!z&&R&&(z=this._addTile(V)),z){const Z=z.hasData();if((Z||!(!((s=this.map)===null||s===void 0)&&s.cancelPendingTileRequestsWhileZooming)||R)&&(c[V.key]=V),R=z.wasRequested(),Z)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let s,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){s=this._loadedParentTiles[c.key];break}i.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(s=this._getLoadedTile(d),s)break;c=d}for(const d of i)this._loadedParentTiles[d]=s}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const i=this._tiles[e].tileID,s=this._getLoadedTile(i);this._loadedSiblingTiles[i.key]=s}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const s=i;return i||(i=new Mr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,e.key,i.state)),i.uses++,this._tiles[e.key]=i,s||this._source.fire(new a.k("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=i.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}_dataHandler(e){const i=e.sourceDataType;e.dataType==="source"&&i==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&i==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,i,s){const c=[],d=this.transform;if(!d)return c;const g=s?d.getCameraQueryGeometry(e):e,b=e.map(Z=>d.screenPointToMercatorCoordinate(Z,this.terrain)),P=g.map(Z=>d.screenPointToMercatorCoordinate(Z,this.terrain)),C=this.getIds();let z=1/0,R=1/0,B=-1/0,V=-1/0;for(const Z of P)z=Math.min(z,Z.x),R=Math.min(R,Z.y),B=Math.max(B,Z.x),V=Math.max(V,Z.y);for(let Z=0;Z<C.length;Z++){const ne=this._tiles[C[Z]];if(ne.holdingForFade())continue;const ie=ne.tileID,re=Math.pow(2,d.zoom-ne.tileID.overscaledZ),se=i*ne.queryPadding*a.X/ne.tileSize/re,ue=[ie.getTilePoint(new a.Y(z,R)),ie.getTilePoint(new a.Y(B,V))];if(ue[0].x-se<a.X&&ue[0].y-se<a.X&&ue[1].x+se>=0&&ue[1].y+se>=0){const he=b.map(ve=>ie.getTilePoint(ve)),me=P.map(ve=>ie.getTilePoint(ve));c.push({tile:ne,tileID:ie,queryGeometry:he,cameraQueryGeometry:me,scale:re})}}return c}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);return this.transform&&this.transform.populateCache(i),i}hasTransition(){if(this._source.hasTransition())return!0;if(W(this._source.type)){const e=ge.now();for(const i in this._tiles)if(this._tiles[i].fadeEndTime>=e)return!0}return!1}setFeatureState(e,i,s){this._state.updateState(e=e||"_geojsonTileLayer",i,s)}removeFeatureState(e,i,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,s)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,s){const c=this._tiles[e];c&&c.setDependencies(i,s)}reloadTilesForDependencies(e,i){for(const s in this._tiles)this._tiles[s].hasDependency(e,i)&&this._reloadTile(s,"reloading");this._cache.filter(s=>!s.hasDependency(e,i))}}function H(p,e){const i=Math.abs(2*p.wrap)-+(p.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return p.overscaledZ-e.overscaledZ||s-i||e.canonical.y-p.canonical.y||e.canonical.x-p.canonical.x}function W(p){return p==="raster"||p==="image"||p==="video"}U.maxOverzooming=10,U.maxUnderzooming=3;class ae{constructor(e,i){this.reset(e,i)}reset(e,i){this.points=e||[],this._distances=[0];for(let s=1;s<this.points.length;s++)this._distances[s]=this._distances[s-1]+this.points[s].dist(this.points[s-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=a.ab(e,0,1);let i=1,s=this._distances[i];const c=e*this.paddedLength+this.padding;for(;s<c&&i<this._distances.length;)s=this._distances[++i];const d=i-1,g=this._distances[d],b=s-g,P=b>0?(c-g)/b:0;return this.points[d].mult(1-P).add(this.points[i].mult(P))}}function _e(p,e){let i=!0;return p==="always"||p!=="never"&&e!=="never"||(i=!1),i}class Pe{constructor(e,i,s){const c=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(e/s),this.yCellCount=Math.ceil(i/s);for(let g=0;g<this.xCellCount*this.yCellCount;g++)c.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,i,s,c,d){this._forEachCell(i,s,c,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(d)}insertCircle(e,i,s,c){this._forEachCell(i-c,s-c,i+c,s+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(i),this.circles.push(s),this.circles.push(c)}_insertBoxCell(e,i,s,c,d,g){this.boxCells[d].push(g)}_insertCircleCell(e,i,s,c,d,g){this.circleCells[d].push(g)}_query(e,i,s,c,d,g,b){if(s<0||e>this.width||c<0||i>this.height)return[];const P=[];if(e<=0&&i<=0&&this.width<=s&&this.height<=c){if(d)return[{key:null,x1:e,y1:i,x2:s,y2:c}];for(let C=0;C<this.boxKeys.length;C++)P.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const z=this.circles[3*C],R=this.circles[3*C+1],B=this.circles[3*C+2];P.push({key:this.circleKeys[C],x1:z-B,y1:R-B,x2:z+B,y2:R+B})}}else this._forEachCell(e,i,s,c,this._queryCell,P,{hitTest:d,overlapMode:g,seenUids:{box:{},circle:{}}},b);return P}query(e,i,s,c){return this._query(e,i,s,c,!1,null)}hitTest(e,i,s,c,d,g){return this._query(e,i,s,c,!0,d,g).length>0}hitTestCircle(e,i,s,c,d){const g=e-s,b=e+s,P=i-s,C=i+s;if(b<0||g>this.width||C<0||P>this.height)return!1;const z=[];return this._forEachCell(g,P,b,C,this._queryCellCircle,z,{hitTest:!0,overlapMode:c,circle:{x:e,y:i,radius:s},seenUids:{box:{},circle:{}}},d),z.length>0}_queryCell(e,i,s,c,d,g,b,P){const{seenUids:C,hitTest:z,overlapMode:R}=b,B=this.boxCells[d];if(B!==null){const Z=this.bboxes;for(const ne of B)if(!C.box[ne]){C.box[ne]=!0;const ie=4*ne,re=this.boxKeys[ne];if(e<=Z[ie+2]&&i<=Z[ie+3]&&s>=Z[ie+0]&&c>=Z[ie+1]&&(!P||P(re))&&(!z||!_e(R,re.overlapMode))&&(g.push({key:re,x1:Z[ie],y1:Z[ie+1],x2:Z[ie+2],y2:Z[ie+3]}),z))return!0}}const V=this.circleCells[d];if(V!==null){const Z=this.circles;for(const ne of V)if(!C.circle[ne]){C.circle[ne]=!0;const ie=3*ne,re=this.circleKeys[ne];if(this._circleAndRectCollide(Z[ie],Z[ie+1],Z[ie+2],e,i,s,c)&&(!P||P(re))&&(!z||!_e(R,re.overlapMode))){const se=Z[ie],ue=Z[ie+1],he=Z[ie+2];if(g.push({key:re,x1:se-he,y1:ue-he,x2:se+he,y2:ue+he}),z)return!0}}}return!1}_queryCellCircle(e,i,s,c,d,g,b,P){const{circle:C,seenUids:z,overlapMode:R}=b,B=this.boxCells[d];if(B!==null){const Z=this.bboxes;for(const ne of B)if(!z.box[ne]){z.box[ne]=!0;const ie=4*ne,re=this.boxKeys[ne];if(this._circleAndRectCollide(C.x,C.y,C.radius,Z[ie+0],Z[ie+1],Z[ie+2],Z[ie+3])&&(!P||P(re))&&!_e(R,re.overlapMode))return g.push(!0),!0}}const V=this.circleCells[d];if(V!==null){const Z=this.circles;for(const ne of V)if(!z.circle[ne]){z.circle[ne]=!0;const ie=3*ne,re=this.circleKeys[ne];if(this._circlesCollide(Z[ie],Z[ie+1],Z[ie+2],C.x,C.y,C.radius)&&(!P||P(re))&&!_e(R,re.overlapMode))return g.push(!0),!0}}}_forEachCell(e,i,s,c,d,g,b,P){const C=this._convertToXCellCoord(e),z=this._convertToYCellCoord(i),R=this._convertToXCellCoord(s),B=this._convertToYCellCoord(c);for(let V=C;V<=R;V++)for(let Z=z;Z<=B;Z++)if(d.call(this,e,i,s,c,this.xCellCount*Z+V,g,b,P))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,i,s,c,d,g){const b=c-e,P=d-i,C=s+g;return C*C>b*b+P*P}_circleAndRectCollide(e,i,s,c,d,g,b){const P=(g-c)/2,C=Math.abs(e-(c+P));if(C>P+s)return!1;const z=(b-d)/2,R=Math.abs(i-(d+z));if(R>z+s)return!1;if(C<=P||R<=z)return!0;const B=C-P,V=R-z;return B*B+V*V<=s*s}}function De(p,e,i){const s=a.H();if(!p){const{vecSouth:R,vecEast:B}=Ne(e),V=Y();V[0]=B[0],V[1]=B[1],V[2]=R[0],V[3]=R[1],c=V,(z=(g=(d=V)[0])*(C=d[3])-(P=d[2])*(b=d[1]))&&(c[0]=C*(z=1/z),c[1]=-b*z,c[2]=-P*z,c[3]=g*z),s[0]=V[0],s[1]=V[1],s[4]=V[2],s[5]=V[3]}var c,d,g,b,P,C,z;return a.K(s,s,[1/i,1/i,1]),s}function Te(p,e,i,s){if(p){const c=a.H();if(!e){const{vecSouth:d,vecEast:g}=Ne(i);c[0]=g[0],c[1]=g[1],c[4]=d[0],c[5]=d[1]}return a.K(c,c,[s,s,1]),c}return i.pixelsToClipSpaceMatrix}function Ne(p){const e=Math.cos(p.rollInRadians),i=Math.sin(p.rollInRadians),s=Math.cos(p.pitchInRadians),c=Math.cos(p.bearingInRadians),d=Math.sin(p.bearingInRadians),g=a.ad();g[0]=-c*s*i-d*e,g[1]=-d*s*i+c*e;const b=a.ae(g);b<1e-9?a.af(g):a.ag(g,g,1/b);const P=a.ad();P[0]=c*s*e-d*i,P[1]=d*s*e+c*i;const C=a.ae(P);return C<1e-9?a.af(P):a.ag(P,P,1/C),{vecEast:P,vecSouth:g}}function Oe(p,e,i,s){let c;s?(c=[p,e,s(p,e),1],a.al(c,c,i)):(c=[p,e,0,1],xn(c,c,i));const d=c[3];return{point:new a.P(c[0]/d,c[1]/d),signedDistanceFromCamera:d,isOccluded:!1}}function Me(p,e){return .5+p/e*.5}function be(p,e){return p.x>=-e[0]&&p.x<=e[0]&&p.y>=-e[1]&&p.y<=e[1]}function pt(p,e,i,s,c,d,g,b,P,C,z,R,B){const V=i?p.textSizeData:p.iconSizeData,Z=a.ah(V,e.transform.zoom),ne=[256/e.width*2+1,256/e.height*2+1],ie=i?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;ie.clear();const re=p.lineVertexArray,se=i?p.text.placedSymbolArray:p.icon.placedSymbolArray,ue=e.transform.width/e.transform.height;let he=!1;for(let me=0;me<se.length;me++){const ve=se.get(me);if(ve.hidden||ve.writingMode===a.ai.vertical&&!he){Fn(ve.numGlyphs,ie);continue}he=!1;const ye=new a.P(ve.anchorX,ve.anchorY),ze={getElevation:B,pitchedLabelPlaneMatrix:s,lineVertexArray:re,pitchWithMap:d,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ye,unwrappedTileID:P,width:C,height:z,translation:R},Le=ui(ve.anchorX,ve.anchorY,ze);if(!be(Le.point,ne)){Fn(ve.numGlyphs,ie);continue}const Ve=Me(e.transform.cameraToCenterDistance,Le.signedDistanceFromCamera),He=a.aj(V,Z,ve),je=d?He*e.transform.getPitchedTextCorrection(ve.anchorX,ve.anchorY,P)/Ve:He*Ve,We=rt({projectionContext:ze,pitchedLabelPlaneMatrixInverse:c,symbol:ve,fontSize:je,flip:!1,keepUpright:g,glyphOffsetArray:p.glyphOffsetArray,dynamicLayoutVertexArray:ie,aspectRatio:ue,rotateToLine:b});he=We.useVertical,(We.notEnoughRoom||he||We.needsFlipping&&rt({projectionContext:ze,pitchedLabelPlaneMatrixInverse:c,symbol:ve,fontSize:je,flip:!0,keepUpright:g,glyphOffsetArray:p.glyphOffsetArray,dynamicLayoutVertexArray:ie,aspectRatio:ue,rotateToLine:b}).notEnoughRoom)&&Fn(ve.numGlyphs,ie)}i?p.text.dynamicLayoutVertexBuffer.updateData(ie):p.icon.dynamicLayoutVertexBuffer.updateData(ie)}function dt(p,e,i,s,c,d,g,b){const P=d.glyphStartIndex+d.numGlyphs,C=d.lineStartIndex,z=d.lineStartIndex+d.lineLength,R=e.getoffsetX(d.glyphStartIndex),B=e.getoffsetX(P-1),V=un(p*R,i,s,c,d.segment,C,z,b,g);if(!V)return null;const Z=un(p*B,i,s,c,d.segment,C,z,b,g);return Z?b.projectionCache.anyProjectionOccluded?null:{first:V,last:Z}:null}function qe(p,e,i,s){return p===a.ai.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*s?{useVertical:!0}:(p===a.ai.vertical?e.y<i.y:e.x>i.x)?{needsFlipping:!0}:null}function rt(p){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:i,symbol:s,fontSize:c,flip:d,keepUpright:g,glyphOffsetArray:b,dynamicLayoutVertexArray:P,aspectRatio:C,rotateToLine:z}=p,R=c/24,B=s.lineOffsetX*R,V=s.lineOffsetY*R;let Z;if(s.numGlyphs>1){const ne=s.glyphStartIndex+s.numGlyphs,ie=s.lineStartIndex,re=s.lineStartIndex+s.lineLength,se=dt(R,b,B,V,d,s,z,e);if(!se)return{notEnoughRoom:!0};const ue=Qt(se.first.point.x,se.first.point.y,e,i),he=Qt(se.last.point.x,se.last.point.y,e,i);if(g&&!d){const me=qe(s.writingMode,ue,he,C);if(me)return me}Z=[se.first];for(let me=s.glyphStartIndex+1;me<ne-1;me++)Z.push(un(R*b.getoffsetX(me),B,V,d,s.segment,ie,re,e,z));Z.push(se.last)}else{if(g&&!d){const ie=Mt(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,re=s.lineStartIndex+s.segment+1,se=new a.P(e.lineVertexArray.getx(re),e.lineVertexArray.gety(re)),ue=Mt(se.x,se.y,e),he=ue.signedDistanceFromCamera>0?ue.point:Ge(e.tileAnchorPoint,se,ie,1,e),me=Qt(ie.x,ie.y,e,i),ve=Qt(he.x,he.y,e,i),ye=qe(s.writingMode,me,ve,C);if(ye)return ye}const ne=un(R*b.getoffsetX(s.glyphStartIndex),B,V,d,s.segment,s.lineStartIndex,s.lineStartIndex+s.lineLength,e,z);if(!ne||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Z=[ne]}for(const ne of Z)a.ak(P,ne.point,ne.angle);return{}}function Ge(p,e,i,s,c){const d=p.add(p.sub(e)._unit()),g=Mt(d.x,d.y,c).point,b=i.sub(g);return i.add(b._mult(s/b.mag()))}function yt(p,e,i){const s=e.projectionCache;if(s.projections[p])return s.projections[p];const c=new a.P(e.lineVertexArray.getx(p),e.lineVertexArray.gety(p)),d=Mt(c.x,c.y,e);if(d.signedDistanceFromCamera>0)return s.projections[p]=d.point,s.anyProjectionOccluded=s.anyProjectionOccluded||d.isOccluded,d.point;const g=p-i.direction;return Ge(i.distanceFromAnchor===0?e.tileAnchorPoint:new a.P(e.lineVertexArray.getx(g),e.lineVertexArray.gety(g)),c,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,e)}function Mt(p,e,i){const s=p+i.translation[0],c=e+i.translation[1];let d;return i.pitchWithMap?(d=Oe(s,c,i.pitchedLabelPlaneMatrix,i.getElevation),d.isOccluded=!1):(d=i.transform.projectTileCoordinates(s,c,i.unwrappedTileID,i.getElevation),d.point.x=(.5*d.point.x+.5)*i.width,d.point.y=(.5*-d.point.y+.5)*i.height),d}function Qt(p,e,i,s){if(i.pitchWithMap){const c=[p,e,0,1];return a.al(c,c,s),i.transform.projectTileCoordinates(c[0]/c[3],c[1]/c[3],i.unwrappedTileID,i.getElevation).point}return{x:p/i.width*2-1,y:e/i.height*2-1}}function ui(p,e,i){return i.transform.projectTileCoordinates(p,e,i.unwrappedTileID,i.getElevation)}function Lt(p,e,i){return p._unit()._perp()._mult(e*i)}function wt(p,e,i,s,c,d,g,b,P){if(b.projectionCache.offsets[p])return b.projectionCache.offsets[p];const C=i.add(e);if(p+P.direction<s||p+P.direction>=c)return b.projectionCache.offsets[p]=C,C;const z=yt(p+P.direction,b,P),R=Lt(z.sub(i),g,P.direction),B=i.add(R),V=z.add(R);return b.projectionCache.offsets[p]=a.am(d,C,B,V)||C,b.projectionCache.offsets[p]}function un(p,e,i,s,c,d,g,b,P){const C=s?p-e:p+e;let z=C>0?1:-1,R=0;s&&(z*=-1,R=Math.PI),z<0&&(R+=Math.PI);let B,V=z>0?d+c:d+c+1;b.projectionCache.cachedAnchorPoint?B=b.projectionCache.cachedAnchorPoint:(B=Mt(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=B);let Z,ne,ie=B,re=B,se=0,ue=0;const he=Math.abs(C),me=[];let ve;for(;se+ue<=he;){if(V+=z,V<d||V>=g)return null;se+=ue,re=ie,ne=Z;const Le={absOffsetX:he,direction:z,distanceFromAnchor:se,previousVertex:re};if(ie=yt(V,b,Le),i===0)me.push(re),ve=ie.sub(re);else{let Ve;const He=ie.sub(re);Ve=He.mag()===0?Lt(yt(V+z,b,Le).sub(ie),i,z):Lt(He,i,z),ne||(ne=re.add(Ve)),Z=wt(V,Ve,ie,d,g,ne,i,b,Le),me.push(ne),ve=Z.sub(ne)}ue=ve.mag()}const ye=ve._mult((he-se)/ue)._add(ne||re),ze=R+Math.atan2(ie.y-re.y,ie.x-re.x);return me.push(ye),{point:ye,angle:P?ze:0,path:me}}const _s=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Fn(p,e){for(let i=0;i<p;i++){const s=e.length;e.resize(s+4),e.float32.set(_s,3*s)}}function xn(p,e,i){const s=e[0],c=e[1];return p[0]=i[0]*s+i[4]*c+i[12],p[1]=i[1]*s+i[5]*c+i[13],p[3]=i[3]*s+i[7]*c+i[15],p}const Zi=100;class Vr{constructor(e,i=new Pe(e.width+200,e.height+200,25),s=new Pe(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=s,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Zi,this.screenBottomBoundary=e.height+Zi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,i,s,c,d,g,b,P,C,z,R,B){const V=this.projectAndGetPerspectiveRatio(e.anchorPointX+P[0],e.anchorPointY+P[1],d,z,B),Z=s*V.perspectiveRatio;let ne;if(g||b)ne=this._projectCollisionBox(e,Z,c,d,g,b,P,V,z,R,B);else{const ve=V.x+(R?R.x*Z:0),ye=V.y+(R?R.y*Z:0);ne={allPointsOccluded:!1,box:[ve+e.x1*Z,ye+e.y1*Z,ve+e.x2*Z,ye+e.y2*Z]}}const[ie,re,se,ue]=ne.box,he=g?ne.allPointsOccluded:V.isOccluded;let me=he;return me||(me=V.perspectiveRatio<this.perspectiveRatioCutoff),me||(me=!this.isInsideGrid(ie,re,se,ue)),me||i!=="always"&&this.grid.hitTest(ie,re,se,ue,i,C)?{box:[ie,re,se,ue],placeable:!1,offscreen:!1,occluded:he}:{box:[ie,re,se,ue],placeable:!0,offscreen:this.isOffscreen(ie,re,se,ue),occluded:he}}placeCollisionCircles(e,i,s,c,d,g,b,P,C,z,R,B,V,Z){const ne=[],ie=new a.P(i.anchorX,i.anchorY),re=this.getPerspectiveRatio(ie.x,ie.y,g,Z),se=(C?d*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,g)/re:d*re)/a.as,ue={getElevation:Z,pitchedLabelPlaneMatrix:b,lineVertexArray:s,pitchWithMap:C,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ie,unwrappedTileID:g,width:this.transform.width,height:this.transform.height,translation:V},he=dt(se,c,i.lineOffsetX*se,i.lineOffsetY*se,!1,i,!1,ue);let me=!1,ve=!1,ye=!0;if(he){const ze=.5*R*re+B,Le=new a.P(-100,-100),Ve=new a.P(this.screenRightBoundary,this.screenBottomBoundary),He=new ae,je=he.first,We=he.last;let ft=[];for(let Ut=je.path.length-1;Ut>=1;Ut--)ft.push(je.path[Ut]);for(let Ut=1;Ut<We.path.length;Ut++)ft.push(We.path[Ut]);const et=2.5*ze;if(C){const Ut=this.projectPathToScreenSpace(ft,ue);ft=Ut.some(di=>di.signedDistanceFromCamera<=0)?[]:Ut.map(di=>di.point)}let _t=[];if(ft.length>0){const Ut=ft[0].clone(),di=ft[0].clone();for(let Wi=1;Wi<ft.length;Wi++)Ut.x=Math.min(Ut.x,ft[Wi].x),Ut.y=Math.min(Ut.y,ft[Wi].y),di.x=Math.max(di.x,ft[Wi].x),di.y=Math.max(di.y,ft[Wi].y);_t=Ut.x>=Le.x&&di.x<=Ve.x&&Ut.y>=Le.y&&di.y<=Ve.y?[ft]:di.x<Le.x||Ut.x>Ve.x||di.y<Le.y||Ut.y>Ve.y?[]:a.ao([ft],Le.x,Le.y,Ve.x,Ve.y)}for(const Ut of _t){He.reset(Ut,.25*ze);let di=0;di=He.length<=.5*ze?1:Math.ceil(He.paddedLength/et)+1;for(let Wi=0;Wi<di;Wi++){const oi=Wi/Math.max(di-1,1),Xi=He.lerp(oi),bi=Xi.x+Zi,wi=Xi.y+Zi;ne.push(bi,wi,ze,0);const Ei=bi-ze,Wn=wi-ze,Ti=bi+ze,Oi=wi+ze;if(ye=ye&&this.isOffscreen(Ei,Wn,Ti,Oi),ve=ve||this.isInsideGrid(Ei,Wn,Ti,Oi),e!=="always"&&this.grid.hitTestCircle(bi,wi,ze,e,z)&&(me=!0,!P))return{circles:[],offscreen:!1,collisionDetected:me}}}}return{circles:!P&&me||!ve||re<this.perspectiveRatioCutoff?[]:ne,offscreen:ye,collisionDetected:me}}projectPathToScreenSpace(e,i){const s=function(c,d){const g=a.H();return a.an(g,d.pitchedLabelPlaneMatrix),c.map(b=>{const P=Oe(b.x,b.y,g,d.getElevation),C=d.transform.projectTileCoordinates(P.point.x,P.point.y,d.unwrappedTileID,d.getElevation);return C.point.x=(.5*C.point.x+.5)*d.width,C.point.y=(.5*-C.point.y+.5)*d.height,C})}(e,i);return function(c){let d=0,g=0,b=0,P=0;for(let C=0;C<c.length;C++)c[C].isOccluded?(b=C+1,P=0):(P++,P>g&&(g=P,d=b));return c.slice(d,d+g)}(s)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[];let s=1/0,c=1/0,d=-1/0,g=-1/0;for(const z of e){const R=new a.P(z.x+Zi,z.y+Zi);s=Math.min(s,R.x),c=Math.min(c,R.y),d=Math.max(d,R.x),g=Math.max(g,R.y),i.push(R)}const b=this.grid.query(s,c,d,g).concat(this.ignoredGrid.query(s,c,d,g)),P={},C={};for(const z of b){const R=z.key;if(P[R.bucketInstanceId]===void 0&&(P[R.bucketInstanceId]={}),P[R.bucketInstanceId][R.featureIndex])continue;const B=[new a.P(z.x1,z.y1),new a.P(z.x2,z.y1),new a.P(z.x2,z.y2),new a.P(z.x1,z.y2)];a.ap(i,B)&&(P[R.bucketInstanceId][R.featureIndex]=!0,C[R.bucketInstanceId]===void 0&&(C[R.bucketInstanceId]=[]),C[R.bucketInstanceId].push(R.featureIndex))}return C}insertCollisionBox(e,i,s,c,d,g){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:g,overlapMode:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,i,s,c,d,g){const b=s?this.ignoredGrid:this.grid,P={bucketInstanceId:c,featureIndex:d,collisionGroupID:g,overlapMode:i};for(let C=0;C<e.length;C+=4)b.insertCircle(P,e[C],e[C+1],e[C+2])}projectAndGetPerspectiveRatio(e,i,s,c,d){if(d){let g;c?(g=[e,i,c(e,i),1],a.al(g,g,d)):(g=[e,i,0,1],xn(g,g,d));const b=g[3];return{x:(g[0]/b+1)/2*this.transform.width+Zi,y:(-g[1]/b+1)/2*this.transform.height+Zi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b*.5,isOccluded:!1,signedDistanceFromCamera:b}}{const g=this.transform.projectTileCoordinates(e,i,s,c);return{x:(g.point.x+1)/2*this.transform.width+Zi,y:(1-g.point.y)/2*this.transform.height+Zi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5,isOccluded:g.isOccluded,signedDistanceFromCamera:g.signedDistanceFromCamera}}}getPerspectiveRatio(e,i,s,c){const d=this.transform.projectTileCoordinates(e,i,s,c);return .5+this.transform.cameraToCenterDistance/d.signedDistanceFromCamera*.5}isOffscreen(e,i,s,c){return s<Zi||e>=this.screenRightBoundary||c<Zi||i>this.screenBottomBoundary}isInsideGrid(e,i,s,c){return s>=0&&e<this.gridRightBoundary&&c>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const e=a.aq([]);return a.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,i,s,c,d,g,b,P,C,z,R){let B=1,V=0,Z=0,ne=1;const ie=e.anchorPointX+b[0],re=e.anchorPointY+b[1];if(g&&!d){const ft=this.projectAndGetPerspectiveRatio(ie+1,re,c,C,R),et=ft.x-P.x,_t=Math.atan((ft.y-P.y)/et)+(et<0?Math.PI:0),Ut=Math.sin(_t),di=Math.cos(_t);B=di,V=Ut,Z=-Ut,ne=di}else if(!g&&d){const ft=Ne(this.transform);B=ft.vecEast[0],V=ft.vecEast[1],Z=ft.vecSouth[0],ne=ft.vecSouth[1]}let se=P.x,ue=P.y,he=i;d&&(se=ie,ue=re,he=Math.pow(2,-(this.transform.zoom-s.overscaledZ)),he*=this.transform.getPitchedTextCorrection(ie,re,c),z||(he*=a.ab(.5+P.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),z&&(se+=B*z.x*he+Z*z.y*he,ue+=V*z.x*he+ne*z.y*he);const me=e.x1*he,ve=e.x2*he,ye=(me+ve)/2,ze=e.y1*he,Le=e.y2*he,Ve=(ze+Le)/2,He=[{offsetX:me,offsetY:ze},{offsetX:ye,offsetY:ze},{offsetX:ve,offsetY:ze},{offsetX:ve,offsetY:Ve},{offsetX:ve,offsetY:Le},{offsetX:ye,offsetY:Le},{offsetX:me,offsetY:Le},{offsetX:me,offsetY:Ve}];let je=[];for(const{offsetX:ft,offsetY:et}of He)je.push(new a.P(se+B*ft+Z*et,ue+V*ft+ne*et));let We=!1;if(d){const ft=je.map(et=>this.projectAndGetPerspectiveRatio(et.x,et.y,c,C,R));We=ft.some(et=>!et.isOccluded),je=ft.map(et=>new a.P(et.x,et.y))}else We=!0;return{box:a.ar(je),allPointsOccluded:!We}}}class qi{constructor(e,i,s,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?i:-i))):c&&s?1:0,this.placed=s}isHidden(){return this.opacity===0&&!this.placed}}class Ha{constructor(e,i,s,c,d){this.text=new qi(e?e.text:null,i,s,d),this.icon=new qi(e?e.icon:null,i,c,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ga{constructor(e,i,s){this.text=e,this.icon=i,this.skipFade=s}}class Gc{constructor(e,i,s,c,d){this.bucketInstanceId=e,this.featureIndex=i,this.sourceLayerIndex=s,this.bucketIndex=c,this.tileID=d}}class Ro{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const i=++this.maxGroupID;this.collisionGroups[e]={ID:i,predicate:s=>s.collisionGroupID===i}}return this.collisionGroups[e]}}function js(p,e,i,s,c){const{horizontalAlign:d,verticalAlign:g}=a.ay(p);return new a.P(-(d-.5)*e+s[0]*c,-(g-.5)*i+s[1]*c)}class Wa{constructor(e,i,s,c,d){this.transform=e.clone(),this.terrain=i,this.collisionIndex=new Vr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Ro(c),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const i=this.terrain;return i?(s,c)=>i.getElevation(e,s,c):null}getBucketParts(e,i,s,c){const d=s.getBucket(i),g=s.latestFeatureIndex;if(!d||!g||i.id!==d.layerIds[0])return;const b=s.collisionBoxArray,P=d.layers[0].layout,C=d.layers[0].paint,z=Math.pow(2,this.transform.zoom-s.tileID.overscaledZ),R=s.tileSize/a.X,B=s.tileID.toUnwrapped(),V=P.get("text-rotation-alignment")==="map",Z=a.at(s,1,this.transform.zoom),ne=a.au(this.collisionIndex.transform,s,C.get("text-translate"),C.get("text-translate-anchor")),ie=a.au(this.collisionIndex.transform,s,C.get("icon-translate"),C.get("icon-translate-anchor")),re=De(V,this.transform,Z);this.retainedQueryData[d.bucketInstanceId]=new Gc(d.bucketInstanceId,g,d.sourceLayerIndex,d.index,s.tileID);const se={bucket:d,layout:P,translationText:ne,translationIcon:ie,unwrappedTileID:B,pitchedLabelPlaneMatrix:re,scale:z,textPixelRatio:R,holdingForFade:s.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:a.ah(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(c)for(const ue of d.sortKeyRanges){const{sortKey:he,symbolInstanceStart:me,symbolInstanceEnd:ve}=ue;e.push({sortKey:he,symbolInstanceStart:me,symbolInstanceEnd:ve,parameters:se})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:se})}attemptAnchorPlacement(e,i,s,c,d,g,b,P,C,z,R,B,V,Z,ne,ie,re,se,ue,he){const me=a.av[e.textAnchor],ve=[e.textOffset0,e.textOffset1],ye=js(me,s,c,ve,d),ze=this.collisionIndex.placeCollisionBox(i,B,P,C,z,b,g,ie,R.predicate,ue,ye,he);if((!se||this.collisionIndex.placeCollisionBox(se,B,P,C,z,b,g,re,R.predicate,ue,ye,he).placeable)&&ze.placeable){let Le;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(Le=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:ve,width:s,height:c,anchor:me,textBoxScale:d,prevAnchor:Le},this.markUsedJustification(Z,me,V,ne),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,ne,V),this.placedOrientations[V.crossTileID]=ne),{shift:ye,placedGlyphBoxes:ze}}}placeLayerBucketPart(e,i,s){const{bucket:c,layout:d,translationText:g,translationIcon:b,unwrappedTileID:P,pitchedLabelPlaneMatrix:C,textPixelRatio:z,holdingForFade:R,collisionBoxArray:B,partiallyEvaluatedTextSize:V,collisionGroup:Z}=e.parameters,ne=d.get("text-optional"),ie=d.get("icon-optional"),re=a.aw(d,"text-overlap","text-allow-overlap"),se=re==="always",ue=a.aw(d,"icon-overlap","icon-allow-overlap"),he=ue==="always",me=d.get("text-rotation-alignment")==="map",ve=d.get("text-pitch-alignment")==="map",ye=d.get("icon-text-fit")!=="none",ze=d.get("symbol-z-order")==="viewport-y",Le=se&&(he||!c.hasIconData()||ie),Ve=he&&(se||!c.hasTextData()||ne);!c.collisionArrays&&B&&c.deserializeCollisionBoxes(B);const He=this.retainedQueryData[c.bucketInstanceId].tileID,je=this._getTerrainElevationFunc(He),We=this.transform.getFastPathSimpleProjectionMatrix(He),ft=(et,_t,Ut)=>{var di,Wi;if(i[et.crossTileID])return;if(R)return void(this.placements[et.crossTileID]=new ga(!1,!1,!1));let oi=!1,Xi=!1,bi=!0,wi=null,Ei={box:null,placeable:!1,offscreen:null,occluded:!1},Wn={box:null,placeable:!1,offscreen:null},Ti=null,Oi=null,er=null,qo=0,Hr=0,kr=0;_t.textFeatureIndex?qo=_t.textFeatureIndex:et.useRuntimeCollisionCircles&&(qo=et.featureIndex),_t.verticalTextFeatureIndex&&(Hr=_t.verticalTextFeatureIndex);const So=_t.textBox;if(So){const Tn=ki=>{let ji=a.ai.horizontal;if(c.allowVerticalPlacement&&!ki&&this.prevPlacement){const Wr=this.prevPlacement.placedOrientations[et.crossTileID];Wr&&(this.placedOrientations[et.crossTileID]=Wr,ji=Wr,this.markUsedOrientation(c,ji,et))}return ji},lo=(ki,ji)=>{if(c.allowVerticalPlacement&&et.numVerticalGlyphVertices>0&&_t.verticalTextBox){for(const Wr of c.writingModes)if(Wr===a.ai.vertical?(Ei=ji(),Wn=Ei):Ei=ki(),Ei&&Ei.placeable)break}else Ei=ki()},jn=et.textAnchorOffsetStartIndex,zr=et.textAnchorOffsetEndIndex;if(zr===jn){const ki=(ji,Wr)=>{const on=this.collisionIndex.placeCollisionBox(ji,re,z,He,P,ve,me,g,Z.predicate,je,void 0,We);return on&&on.placeable&&(this.markUsedOrientation(c,Wr,et),this.placedOrientations[et.crossTileID]=Wr),on};lo(()=>ki(So,a.ai.horizontal),()=>{const ji=_t.verticalTextBox;return c.allowVerticalPlacement&&et.numVerticalGlyphVertices>0&&ji?ki(ji,a.ai.vertical):{box:null,offscreen:null}}),Tn(Ei&&Ei.placeable)}else{let ki=a.av[(Wi=(di=this.prevPlacement)===null||di===void 0?void 0:di.variableOffsets[et.crossTileID])===null||Wi===void 0?void 0:Wi.anchor];const ji=(on,op,yu)=>{const vc=on.x2-on.x1,mh=on.y2-on.y1,As=et.textBoxScale,Es=ye&&ue==="never"?op:null;let Sn=null,Po=re==="never"?1:2,xc="never";ki&&Po++;for(let vu=0;vu<Po;vu++){for(let ja=jn;ja<zr;ja++){const ks=c.textAnchorOffsets.get(ja);if(ki&&ks.textAnchor!==ki)continue;const bc=this.attemptAnchorPlacement(ks,on,vc,mh,As,me,ve,z,He,P,Z,xc,et,c,yu,g,b,Es,je);if(bc&&(Sn=bc.placedGlyphBoxes,Sn&&Sn.placeable))return oi=!0,wi=bc.shift,Sn}ki?ki=null:xc=re}return s&&!Sn&&(Sn={box:this.collisionIndex.placeCollisionBox(So,"always",z,He,P,ve,me,g,Z.predicate,je,void 0,We).box,offscreen:!1,placeable:!1,occluded:!1}),Sn};lo(()=>ji(So,_t.iconBox,a.ai.horizontal),()=>{const on=_t.verticalTextBox;return c.allowVerticalPlacement&&(!Ei||!Ei.placeable)&&et.numVerticalGlyphVertices>0&&on?ji(on,_t.verticalIconBox,a.ai.vertical):{box:null,occluded:!0,offscreen:null}}),Ei&&(oi=Ei.placeable,bi=Ei.offscreen);const Wr=Tn(Ei&&Ei.placeable);if(!oi&&this.prevPlacement){const on=this.prevPlacement.variableOffsets[et.crossTileID];on&&(this.variableOffsets[et.crossTileID]=on,this.markUsedJustification(c,on.anchor,et,Wr))}}}if(Ti=Ei,oi=Ti&&Ti.placeable,bi=Ti&&Ti.offscreen,et.useRuntimeCollisionCircles){const Tn=c.text.placedSymbolArray.get(et.centerJustifiedTextSymbolIndex),lo=a.aj(c.textSizeData,V,Tn),jn=d.get("text-padding");Oi=this.collisionIndex.placeCollisionCircles(re,Tn,c.lineVertexArray,c.glyphOffsetArray,lo,P,C,s,ve,Z.predicate,et.collisionCircleDiameter,jn,g,je),Oi.circles.length&&Oi.collisionDetected&&!s&&a.w("Collisions detected, but collision boxes are not shown"),oi=se||Oi.circles.length>0&&!Oi.collisionDetected,bi=bi&&Oi.offscreen}if(_t.iconFeatureIndex&&(kr=_t.iconFeatureIndex),_t.iconBox){const Tn=lo=>this.collisionIndex.placeCollisionBox(lo,ue,z,He,P,ve,me,b,Z.predicate,je,ye&&wi?wi:void 0,We);Wn&&Wn.placeable&&_t.verticalIconBox?(er=Tn(_t.verticalIconBox),Xi=er.placeable):(er=Tn(_t.iconBox),Xi=er.placeable),bi=bi&&er.offscreen}const Oa=ne||et.numHorizontalGlyphVertices===0&&et.numVerticalGlyphVertices===0,ca=ie||et.numIconVertices===0;Oa||ca?ca?Oa||(Xi=Xi&&oi):oi=Xi&&oi:Xi=oi=Xi&&oi;const Is=Xi&&er.placeable;if(oi&&Ti.placeable&&this.collisionIndex.insertCollisionBox(Ti.box,re,d.get("text-ignore-placement"),c.bucketInstanceId,Wn&&Wn.placeable&&Hr?Hr:qo,Z.ID),Is&&this.collisionIndex.insertCollisionBox(er.box,ue,d.get("icon-ignore-placement"),c.bucketInstanceId,kr,Z.ID),Oi&&oi&&this.collisionIndex.insertCollisionCircles(Oi.circles,re,d.get("text-ignore-placement"),c.bucketInstanceId,qo,Z.ID),s&&this.storeCollisionData(c.bucketInstanceId,Ut,_t,Ti,er,Oi),et.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[et.crossTileID]=new ga((oi||Le)&&!(Ti!=null&&Ti.occluded),(Xi||Ve)&&!(er!=null&&er.occluded),bi||c.justReloaded),i[et.crossTileID]=!0};if(ze){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const et=c.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let _t=et.length-1;_t>=0;--_t){const Ut=et[_t];ft(c.symbolInstances.get(Ut),c.collisionArrays[Ut],Ut)}}else for(let et=e.symbolInstanceStart;et<e.symbolInstanceEnd;et++)ft(c.symbolInstances.get(et),c.collisionArrays[et],et);c.justReloaded=!1}storeCollisionData(e,i,s,c,d,g){if(s.textBox||s.iconBox){let b,P;this.collisionBoxArrays.has(e)?b=this.collisionBoxArrays.get(e):(b=new Map,this.collisionBoxArrays.set(e,b)),b.has(i)?P=b.get(i):(P={text:null,icon:null},b.set(i,P)),s.textBox&&(P.text=c.box),s.iconBox&&(P.icon=d.box)}if(g){let b=this.collisionCircleArrays[e];b===void 0&&(b=this.collisionCircleArrays[e]=[]);for(let P=0;P<g.circles.length;P+=4)b.push(g.circles[P+0]-Zi),b.push(g.circles[P+1]-Zi),b.push(g.circles[P+2]),b.push(g.collisionDetected?1:0)}}markUsedJustification(e,i,s,c){let d;d=c===a.ai.vertical?s.verticalPlacedTextSymbolIndex:{left:s.leftJustifiedTextSymbolIndex,center:s.centerJustifiedTextSymbolIndex,right:s.rightJustifiedTextSymbolIndex}[a.ax(i)];const g=[s.leftJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.rightJustifiedTextSymbolIndex,s.verticalPlacedTextSymbolIndex];for(const b of g)b>=0&&(e.text.placedSymbolArray.get(b).crossTileID=d>=0&&b!==d?0:s.crossTileID)}markUsedOrientation(e,i,s){const c=i===a.ai.horizontal||i===a.ai.horizontalOnly?i:0,d=i===a.ai.vertical?i:0,g=[s.leftJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.rightJustifiedTextSymbolIndex];for(const b of g)e.text.placedSymbolArray.get(b).placedOrientation=c;s.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(s.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let s=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const c=i?i.symbolFadeChange(e):1,d=i?i.opacities:{},g=i?i.variableOffsets:{},b=i?i.placedOrientations:{};for(const P in this.placements){const C=this.placements[P],z=d[P];z?(this.opacities[P]=new Ha(z,c,C.text,C.icon),s=s||C.text!==z.text.placed||C.icon!==z.icon.placed):(this.opacities[P]=new Ha(null,c,C.text,C.icon,C.skipFade),s=s||C.text||C.icon)}for(const P in d){const C=d[P];if(!this.opacities[P]){const z=new Ha(C,c,!1,!1);z.isHidden()||(this.opacities[P]=z,s=s||C.text.placed||C.icon.placed)}}for(const P in g)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=g[P]);for(const P in b)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=b[P]);if(i&&i.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");s?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:e)}updateLayerOpacities(e,i){const s={};for(const c of i){const d=c.getBucket(e);d&&c.latestFeatureIndex&&e.id===d.layerIds[0]&&this.updateBucketOpacities(d,c.tileID,s,c.collisionBoxArray)}}updateBucketOpacities(e,i,s,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const d=e.layers[0],g=d.layout,b=new Ha(null,0,!1,!1,!0),P=g.get("text-allow-overlap"),C=g.get("icon-allow-overlap"),z=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=g.get("text-rotation-alignment")==="map",B=g.get("text-pitch-alignment")==="map",V=g.get("icon-text-fit")!=="none",Z=new Ha(null,0,P&&(C||!e.hasIconData()||g.get("icon-optional")),C&&(P||!e.hasTextData()||g.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);const ne=(re,se,ue)=>{for(let he=0;he<se/4;he++)re.opacityVertexArray.emplaceBack(ue);re.hasVisibleVertices=re.hasVisibleVertices||ue!==Ns},ie=this.collisionBoxArrays.get(e.bucketInstanceId);for(let re=0;re<e.symbolInstances.length;re++){const se=e.symbolInstances.get(re),{numHorizontalGlyphVertices:ue,numVerticalGlyphVertices:he,crossTileID:me}=se;let ve=this.opacities[me];s[me]?ve=b:ve||(ve=Z,this.opacities[me]=ve),s[me]=!0;const ye=se.numIconVertices>0,ze=this.placedOrientations[se.crossTileID],Le=ze===a.ai.vertical,Ve=ze===a.ai.horizontal||ze===a.ai.horizontalOnly;if(ue>0||he>0){const je=Hc(ve.text);ne(e.text,ue,Le?Ns:je),ne(e.text,he,Ve?Ns:je);const We=ve.text.isHidden();[se.rightJustifiedTextSymbolIndex,se.centerJustifiedTextSymbolIndex,se.leftJustifiedTextSymbolIndex].forEach(_t=>{_t>=0&&(e.text.placedSymbolArray.get(_t).hidden=We||Le?1:0)}),se.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(se.verticalPlacedTextSymbolIndex).hidden=We||Ve?1:0);const ft=this.variableOffsets[se.crossTileID];ft&&this.markUsedJustification(e,ft.anchor,se,ze);const et=this.placedOrientations[se.crossTileID];et&&(this.markUsedJustification(e,"left",se,et),this.markUsedOrientation(e,et,se))}if(ye){const je=Hc(ve.icon),We=!(V&&se.verticalPlacedIconSymbolIndex&&Le);se.placedIconSymbolIndex>=0&&(ne(e.icon,se.numIconVertices,We?je:Ns),e.icon.placedSymbolArray.get(se.placedIconSymbolIndex).hidden=ve.icon.isHidden()),se.verticalPlacedIconSymbolIndex>=0&&(ne(e.icon,se.numVerticalIconVertices,We?Ns:je),e.icon.placedSymbolArray.get(se.verticalPlacedIconSymbolIndex).hidden=ve.icon.isHidden())}const He=ie&&ie.has(re)?ie.get(re):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const je=e.collisionArrays[re];if(je){let We=new a.P(0,0);if(je.textBox||je.verticalTextBox){let ft=!0;if(z){const et=this.variableOffsets[me];et?(We=js(et.anchor,et.width,et.height,et.textOffset,et.textBoxScale),R&&We._rotate(B?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ft=!1}if(je.textBox||je.verticalTextBox){let et;je.textBox&&(et=Le),je.verticalTextBox&&(et=Ve),Zc(e.textCollisionBox.collisionVertexArray,ve.text.placed,!ft||et,He.text,We.x,We.y)}}if(je.iconBox||je.verticalIconBox){const ft=!!(!Ve&&je.verticalIconBox);let et;je.iconBox&&(et=ft),je.verticalIconBox&&(et=!ft),Zc(e.iconCollisionBox.collisionVertexArray,ve.icon.placed,et,He.icon,V?We.x:0,V?We.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,i){const s=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*s>e}setStale(){this.stale=!0}}function Zc(p,e,i,s,c,d){s&&s.length!==0||(s=[0,0,0,0]);const g=s[0]-Zi,b=s[1]-Zi,P=s[2]-Zi,C=s[3]-Zi;p.emplaceBack(e?1:0,i?1:0,c||0,d||0,g,b),p.emplaceBack(e?1:0,i?1:0,c||0,d||0,P,b),p.emplaceBack(e?1:0,i?1:0,c||0,d||0,P,C),p.emplaceBack(e?1:0,i?1:0,c||0,d||0,g,C)}const Nu=Math.pow(2,25),_a=Math.pow(2,24),qc=Math.pow(2,17),$u=Math.pow(2,16),Vu=Math.pow(2,9),Qh=Math.pow(2,8),Uu=Math.pow(2,1);function Hc(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const e=p.placed?1:0,i=Math.floor(127*p.opacity);return i*Nu+e*_a+i*qc+e*$u+i*Vu+e*Qh+i*Uu+e}const Ns=0;class Ll{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,i,s,c,d){const g=this._bucketParts;for(;this._currentTileIndex<e.length;)if(i.getBucketParts(g,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,g.sort((b,P)=>b.sortKey-P.sortKey));this._currentPartIndex<g.length;)if(i.placeLayerBucketPart(g[this._currentPartIndex],this._seenCrossTileIDs,s),this._currentPartIndex++,d())return!0;return!1}}class Wc{constructor(e,i,s,c,d,g,b,P){this.placement=new Wa(e,i,g,b,P),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(e,i,s){const c=ge.now(),d=()=>!this._forceFullPlacement&&ge.now()-c>2;for(;this._currentPlacementIndex>=0;){const g=i[e[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(g.type==="symbol"&&(!g.minzoom||g.minzoom<=b)&&(!g.maxzoom||g.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new Ll(g)),this._inProgressLayer.continuePlacement(s[g.source],this.placement,this._showCollisionBoxes,g,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ys=512/a.X/2;class Xa{constructor(e,i,s){this.tileID=e,this.bucketInstanceId=s,this._symbolsByKey={};const c=new Map;for(let d=0;d<i.length;d++){const g=i.get(d),b=g.key,P=c.get(b);P?P.push(g):c.set(b,[g])}for(const[d,g]of c){const b={positions:g.map(P=>({x:Math.floor(P.anchorX*ys),y:Math.floor(P.anchorY*ys)})),crossTileIDs:g.map(P=>P.crossTileID)};if(b.positions.length>128){const P=new a.az(b.positions.length,16,Uint16Array);for(const{x:C,y:z}of b.positions)P.add(C,z);P.finish(),delete b.positions,b.index=P}this._symbolsByKey[d]=b}}getScaledCoordinates(e,i){const{x:s,y:c,z:d}=this.tileID.canonical,{x:g,y:b,z:P}=i.canonical,C=ys/Math.pow(2,P-d),z=(b*a.X+e.anchorY)*C,R=c*a.X*ys;return{x:Math.floor((g*a.X+e.anchorX)*C-s*a.X*ys),y:Math.floor(z-R)}}findMatches(e,i,s){const c=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z);for(let d=0;d<e.length;d++){const g=e.get(d);if(g.crossTileID)continue;const b=this._symbolsByKey[g.key];if(!b)continue;const P=this.getScaledCoordinates(g,i);if(b.index){const C=b.index.range(P.x-c,P.y-c,P.x+c,P.y+c).sort();for(const z of C){const R=b.crossTileIDs[z];if(!s[R]){s[R]=!0,g.crossTileID=R;break}}}else if(b.positions)for(let C=0;C<b.positions.length;C++){const z=b.positions[C],R=b.crossTileIDs[C];if(Math.abs(z.x-P.x)<=c&&Math.abs(z.y-P.y)<=c&&!s[R]){s[R]=!0,g.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Bl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const i=Math.round((e-this.lng)/360);if(i!==0)for(const s in this.indexes){const c=this.indexes[s],d={};for(const g in c){const b=c[g];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+i),d[b.tileID.key]=b}this.indexes[s]=d}this.lng=e}addBucket(e,i,s){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let d=0;d<i.symbolInstances.length;d++)i.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const c=this.usedCrossTileIDs[e.overscaledZ];for(const d in this.indexes){const g=this.indexes[d];if(Number(d)>e.overscaledZ)for(const b in g){const P=g[b];P.tileID.isChildOf(e)&&P.findMatches(i.symbolInstances,e,c)}else{const b=g[e.scaledTo(Number(d)).key];b&&b.findMatches(i.symbolInstances,e,c)}}for(let d=0;d<i.symbolInstances.length;d++){const g=i.symbolInstances.get(d);g.crossTileID||(g.crossTileID=s.generate(),c[g.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Xa(e,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(e,i){for(const s of i.getCrossTileIDsLists())for(const c of s)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let i=!1;for(const s in this.indexes){const c=this.indexes[s];for(const d in c)e[c[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(s,c[d]),delete c[d],i=!0)}return i}}class Lo{constructor(){this.layerIndexes={},this.crossTileIDs=new Bl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,i,s){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new Xc);let d=!1;const g={};c.handleWrapJump(s);for(const b of i){const P=b.getBucket(e);P&&e.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(b.tileID,P,this.crossTileIDs)&&(d=!0),g[P.bucketInstanceId]=!0)}return c.removeStaleBuckets(g)&&(d=!0),d}pruneUnusedLayers(e){const i={};e.forEach(s=>{i[s]=!0});for(const s in this.layerIndexes)i[s]||delete this.layerIndexes[s]}}var Fl="void main() {fragColor=vec4(1.0);}";const Bo={prelude:Xt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Xt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Xt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Xt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Xt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Xt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Xt(Fl,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Xt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Xt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Xt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Xt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Xt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Xt(Fl,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Xt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Xt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Xt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Xt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Xt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Xt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Xt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Xt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Xt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Xt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Xt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Xt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Xt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Xt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Xt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Xt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Xt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Xt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Xt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Xt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Xt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Xt(p,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,s=e.match(/in ([\w]+) ([\w]+)/g),c=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=d?d.concat(c):c,b={};return{fragmentSource:p=p.replace(i,(P,C,z,R,B)=>(b[B]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${B}
in ${z} ${R} ${B};
#else
uniform ${z} ${R} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${z} ${R} ${B} = u_${B};
#endif
`)),vertexSource:e=e.replace(i,(P,C,z,R,B)=>{const V=R==="float"?"vec2":"vec4",Z=B.match(/color/)?"color":V;return b[B]?C==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${z} ${V} a_${B};
out ${z} ${R} ${B};
#else
uniform ${z} ${R} u_${B};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${z} ${R} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${Z}(a_${B}, u_${B}_t);
#else
    ${z} ${R} ${B} = u_${B};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${z} ${V} a_${B};
#else
uniform ${z} ${R} u_${B};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${z} ${R} ${B} = a_${B};
#else
    ${z} ${R} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${z} ${R} ${B} = unpack_mix_${Z}(a_${B}, u_${B}_t);
#else
    ${z} ${R} ${B} = u_${B};
#endif
`}),staticAttributes:s,staticUniforms:g}}class _o{constructor(e,i,s){this.vertexBuffer=e,this.indexBuffer=i,this.segments=s}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Kt=a.aA([{name:"a_pos",type:"Int16",components:2}]);const Ol="#define PROJECTION_MERCATOR",Kc="mercator";class $s{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Kc}get shaderDefine(){return Ol}get shaderPreludeCode(){return Bo.projectionMercator}get vertexShaderPreludeCode(){return Bo.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aB.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,i,s,c,d){if(this._cachedMesh)return this._cachedMesh;const g=new a.aC;g.emplaceBack(0,0),g.emplaceBack(a.X,0),g.emplaceBack(0,a.X),g.emplaceBack(a.X,a.X);const b=e.createVertexBuffer(g,Kt.members),P=a.aD.simpleSegment(0,0,4,2),C=new a.aE;C.emplaceBack(1,0,2),C.emplaceBack(1,2,3);const z=e.createIndexBuffer(C);return this._cachedMesh=new _o(b,z,P),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}function tn(p,e){const i=a.ab(e.lat,-85.051129,a.aF);return new a.P(a.O(e.lng)*p,a.Q(i)*p)}function nn(p,e){return new a.Y(e.x/p,e.y/p).toLngLat()}function Hi(p){return p.cameraToCenterDistance*Math.min(.85*Math.tan(a.aa(90-p.pitch)),Math.tan(a.aa(89.25-p.pitch)))}function jl(p,e){const i=p.canonical,s=e/a.aG(i.z),c=i.x+Math.pow(2,i.z)*p.wrap,d=a.aq(new Float64Array(16));return a.J(d,d,[c*s,i.y*s,0]),a.K(d,d,[s/a.X,s/a.X,1]),d}function ur(p,e,i,s,c){const d=a.Y.fromLngLat(p,e),g=c*a.aH(1,p.lat),b=g*Math.cos(a.aa(i)),P=Math.sqrt(g*g-b*b),C=P*Math.sin(a.aa(-s)),z=P*Math.cos(a.aa(-s));return new a.Y(d.x+C,d.y+z,d.z+b)}class Jn{constructor(e=0,i=0,s=0,c=0){if(isNaN(e)||e<0||isNaN(i)||i<0||isNaN(s)||s<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=i,this.left=s,this.right=c}interpolate(e,i,s){return i.top!=null&&e.top!=null&&(this.top=a.y.number(e.top,i.top,s)),i.bottom!=null&&e.bottom!=null&&(this.bottom=a.y.number(e.bottom,i.bottom,s)),i.left!=null&&e.left!=null&&(this.left=a.y.number(e.left,i.left,s)),i.right!=null&&e.right!=null&&(this.right=a.y.number(e.right,i.right,s)),this}getCenter(e,i){const s=a.ab((this.left+e-this.right)/2,0,e),c=a.ab((this.top+i-this.bottom)/2,0,i);return new a.P(s,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Jn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Qn(p,e){if(!p.renderWorldCopies||p.lngRange)return;const i=e.lng-p.center.lng;e.lng+=i>180?-360:i<-180?360:0}function Nl(p){return Math.max(0,Math.floor(p))}class vs{constructor(e,i,s,c,d,g){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=g===void 0||!!g,this._minZoom=i||0,this._maxZoom=s||22,this._minPitch=c??0,this._maxPitch=d??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.N(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Nl(this._zoom),this._scale=a.aG(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Jn,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,i,s){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Nl(this._zoom),this._scale=a.aG(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Jn(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!s&&e.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const i=a.aI(e,-180,180)*Math.PI/180;var s,c,d,g,b,P,C,z,R;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=Y(),s=this._rotationMatrix,d=-this._bearingInRadians,g=(c=this._rotationMatrix)[0],b=c[1],P=c[2],C=c[3],z=Math.sin(d),R=Math.cos(d),s[0]=g*R+P*z,s[1]=b*R+C*z,s[2]=g*-z+P*R,s[3]=b*-z+C*R)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const i=a.ab(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const i=e/180*Math.PI;this._rollInRadians!==i&&(this._unmodified=!1,this._rollInRadians=i,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.aJ(this._fovInRadians)}setFov(e){e=a.ab(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=a.aa(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const i=this.getConstrained(this._center,e).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=a.aG(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,i){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=i,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,i,s){this._unmodified=!1,this._edgeInsets.interpolate(e,i,s),this._constrain(),this._calcMatrices()}resize(e,i,s=!0){this._width=e,this._height=i,s&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new mi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,a.aF])}getConstrained(e,i){return this._callbacks.getConstrained(e,i)}getCameraQueryGeometry(e,i){if(i.length===1)return[i[0],e];{let s=e.x,c=e.y,d=e.x,g=e.y;for(const b of i)s=Math.min(s,b.x),c=Math.min(c,b.y),d=Math.max(d,b.x),g=Math.max(g,b.y);return[new a.P(s,c),new a.P(d,c),new a.P(d,g),new a.P(s,g),new a.P(s,c)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:i,zoom:s}=this.getConstrained(this.center,this.zoom);this.setCenter(i),this.setZoom(s),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=a.aq(new Float64Array(16));a.K(e,e,[this._width/2,-this._height/2,1]),a.J(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=a.aq(new Float64Array(16)),a.K(e,e,[1,-1,1]),a.J(e,e,[-1,-1,0]),a.K(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,i,s,c){const d=s!==void 0?s:this.bearing,g=c=c!==void 0?c:this.pitch,b=a.Y.fromLngLat(e,i),P=-Math.cos(a.aa(g)),C=Math.sin(a.aa(g)),z=C*Math.sin(a.aa(d)),R=-C*Math.cos(a.aa(d));let B=this.elevation;const V=i-B;let Z;P*V>=0||Math.abs(P)<.1?(Z=1e4,B=i+Z*P):Z=-V/P;let ne,ie,re=a.aK(1,b.y),se=0;do{if(se+=1,se>10)break;ie=Z/re,ne=new a.Y(b.x+z*ie,b.y+R*ie),re=1/ne.meterInMercatorCoordinateUnits()}while(Math.abs(Z-ie*re)>1e-12);return{center:ne.toLngLat(),elevation:B,zoom:a.a8(this.height/2/Math.tan(this.fovInRadians/2)/ie/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const i=a.aH(1,this.center.lat)*this.worldSize,s=this.cameraToCenterDistance/i,c=a.Y.fromLngLat(this.center,this.elevation),d=ur(this.center,this.elevation,this.pitch,this.bearing,s);this._elevation=e;const g=this.calculateCenterFromCameraLngLatAlt(d.toLngLat(),a.aK(d.z,c.y),this.bearing,this.pitch);this._elevation=g.elevation,this._center=g.center,this.setZoom(g.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=a.aH(1,this.center.lat)*this.worldSize;return ur(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const i=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/i,e.canonical.y/i,1/i/a.X,1/i/a.X]}}class $i{constructor(e,i){this.min=e,this.max=i,this.center=a.aL([],a.aM([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=a.aN(this.min),c=a.aN(this.max);for(let d=0;d<i.length;d++)s[d]=i[d]?this.min[d]:this.center[d],c[d]=i[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new $i(s,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let i=!0;for(let s=0;s<e.planes.length;s++){const c=this.intersectsPlane(e.planes[s]);if(c===0)return 0;c===1&&(i=!1)}return i?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let i=e[3],s=e[3];for(let c=0;c<3;c++)e[c]>0?(i+=e[c]*this.min[c],s+=e[c]*this.max[c]):(s+=e[c]*this.min[c],i+=e[c]*this.max[c]);return i>=0?2:s<0?0:1}}class Ka{distanceToTile2d(e,i,s,c){const d=c.distanceX([e,i]),g=c.distanceY([e,i]);return Math.hypot(d,g)}getWrap(e,i,s){return s}getTileAABB(e,i,s,c){var d,g;let b=s,P=s;if(c.terrain){const z=new a.S(e.z,i,e.z,e.x,e.y),R=c.terrain.getMinMaxElevation(z);b=(d=R.minElevation)!==null&&d!==void 0?d:s,P=(g=R.maxElevation)!==null&&g!==void 0?g:s}const C=1<<e.z;return new $i([i+e.x/C,e.y/C,b],[i+(e.x+1)/C,(e.y+1)/C,P])}allowVariableZoom(e,i){const s=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,c=a.ab(78.5-s/2,0,60);return!!i.terrain||e.pitch>c||e.padding.top>=.1}allowWorldCopies(){return!0}recalculateCache(){}}class Fo{constructor(e,i,s){this.points=e,this.planes=i,this.aabb=s}static fromInvProjectionMatrix(e,i=1,s=0){const c=Math.pow(2,s),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const z=1/(C=a.al([],C,e))[3]/i*c;return a.aO(C,C,[z,z,1/C[3],z])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const z=a.aP([],d[C[0]],d[C[1]]),R=a.aP([],d[C[2]],d[C[1]]),B=a.aQ([],a.aR([],z,R)),V=-a.aS(B,d[C[1]]);return B.concat(V)}),b=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],P=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const C of d)for(let z=0;z<3;z++)b[z]=Math.min(b[z],C[z]),P[z]=Math.max(P[z],C[z]);return new Fo(d,g,new $i(b,P))}}class Oo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,s){return this._helper.interpolatePadding(e,i,s)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,s=!0){this._helper.resize(e,i,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,i){}constructor(e,i,s,c,d){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new vs({calcMatrices:()=>{this._calcMatrices()},getConstrained:(g,b)=>this.getConstrained(g,b)},e,i,s,c,d),this._coveringTilesDetailsProvider=new Ka}clone(){const e=new Oo;return e.apply(this),e}apply(e,i,s){this._helper.apply(e,i,s)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const i=[new a.aT(0,e)];if(this._helper._renderWorldCopies){const s=this.screenPointToMercatorCoordinate(new a.P(0,0)),c=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),d=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),g=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),b=Math.floor(Math.min(s.x,c.x,d.x,g.x)),P=Math.floor(Math.max(s.x,c.x,d.x,g.x)),C=1;for(let z=b-C;z<=P+C;z++)z!==0&&i.push(new a.aT(z,e))}return i}getCameraFrustum(){return Fo.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const i=this.screenPointToLocation(this.centerPoint,e),s=e?e.getElevationForLngLatZoom(i,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(s)}setLocationAtPoint(e,i){const s=a.aH(this.elevation,this.center.lat),c=this.screenPointToMercatorCoordinateAtZ(i,s),d=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,s),g=a.Y.fromLngLat(e),b=new a.Y(g.x-(c.x-d.x),g.y-(c.y-d.y));this.setCenter(b==null?void 0:b.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,i){return i?this.coordinatePoint(a.Y.fromLngLat(e),i.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(a.Y.fromLngLat(e))}screenPointToLocation(e,i){var s;return(s=this.screenPointToMercatorCoordinate(e,i))===null||s===void 0?void 0:s.toLngLat()}screenPointToMercatorCoordinate(e,i){if(i){const s=i.pointCoordinate(e);if(s!=null)return s}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,i){const s=i||0,c=[e.x,e.y,0,1],d=[e.x,e.y,1,1];a.al(c,c,this._pixelMatrixInverse),a.al(d,d,this._pixelMatrixInverse);const g=c[3],b=d[3],P=c[1]/g,C=d[1]/b,z=c[2]/g,R=d[2]/b,B=z===R?0:(s-z)/(R-z);return new a.Y(a.y.number(c[0]/g,d[0]/b,B)/this.worldSize,a.y.number(P,C,B)/this.worldSize,s)}coordinatePoint(e,i=0,s=this._pixelMatrix){const c=[e.x*this.worldSize,e.y*this.worldSize,i,1];return a.al(c,c,s),new a.P(c[0]/c[3],c[1]/c[3])}getBounds(){const e=Math.max(0,this._helper._height/2-Hi(this));return new mi().extend(this.screenPointToLocation(new a.P(0,e))).extend(this.screenPointToLocation(new a.P(this._helper._width,e))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(e,i){return i?i.pointCoordinate(e)!=null:e.y>this.height/2-Hi(this)}calculatePosMatrix(e,i=!1,s){var c;const d=(c=e.key)!==null&&c!==void 0?c:a.aU(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),g=i?this._alignedPosMatrixCache:this._posMatrixCache;if(g.has(d)){const C=g.get(d);return s?C.f32:C.f64}const b=jl(e,this.worldSize);a.L(b,i?this._alignedProjMatrix:this._viewProjMatrix,b);const P={f64:b,f32:new Float32Array(b)};return g.set(d,P),s?P.f32:P.f64}calculateFogMatrix(e){const i=e.key,s=this._fogMatrixCacheF32;if(s.has(i))return s.get(i);const c=jl(e,this.worldSize);return a.L(c,this._fogMatrix,c),s.set(i,new Float32Array(c)),s.get(i)}getConstrained(e,i){i=a.ab(+i,this.minZoom,this.maxZoom);const s={center:new a.N(e.lng,e.lat),zoom:i};let c=this._helper._lngRange;this._helper._renderWorldCopies||c!==null||(c=[-179.9999999999,180-1e-10]);const d=this.tileSize*a.aG(s.zoom);let g=0,b=d,P=0,C=d,z=0,R=0;const{x:B,y:V}=this.size;if(this._helper._latRange){const ue=this._helper._latRange;g=a.Q(ue[1])*d,b=a.Q(ue[0])*d,b-g<V&&(z=V/(b-g))}c&&(P=a.aI(a.O(c[0])*d,0,d),C=a.aI(a.O(c[1])*d,0,d),C<P&&(C+=d),C-P<B&&(R=B/(C-P)));const{x:Z,y:ne}=tn(d,e);let ie,re;const se=Math.max(R||0,z||0);if(se){const ue=new a.P(R?(C+P)/2:Z,z?(b+g)/2:ne);return s.center=nn(d,ue).wrap(),s.zoom+=a.a8(se),s}if(this._helper._latRange){const ue=V/2;ne-ue<g&&(re=g+ue),ne+ue>b&&(re=b-ue)}if(c){const ue=(P+C)/2;let he=Z;this._helper._renderWorldCopies&&(he=a.aI(Z,ue-d/2,ue+d/2));const me=B/2;he-me<P&&(ie=P+me),he+me>C&&(ie=C-me)}if(ie!==void 0||re!==void 0){const ue=new a.P(ie??Z,re??ne);s.center=nn(d,ue).wrap()}return s}calculateCenterFromCameraLngLatAlt(e,i,s,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,s,c)}_calculateNearFarZIfNeeded(e,i,s){if(!this._helper.autoCalculateNearFarZ)return;const c=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),d=e-c*this._helper._pixelPerMeter/Math.cos(i),g=c<0?d:e,b=Math.PI/2+this.pitchInRadians,P=a.aa(this.fov)*(Math.abs(Math.cos(a.aa(this.roll)))*this.height+Math.abs(Math.sin(a.aa(this.roll)))*this.width)/this.height*(.5+s.y/this.height),C=Math.sin(P)*g/Math.sin(a.ab(Math.PI-b-P,.01,Math.PI-.01)),z=Hi(this),R=Math.atan(z/this._helper.cameraToCenterDistance),B=a.aa(.75),V=R>B?2*R*(.5+s.y/(2*z)):B,Z=Math.sin(V)*g/Math.sin(a.ab(Math.PI-b-V,.01,Math.PI-.01)),ne=Math.min(C,Z);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*ne+g),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,i=tn(this.worldSize,this.center),s=i.x,c=i.y;this._helper._pixelPerMeter=a.aH(1,this.center.lat)*this.worldSize;const d=a.aa(Math.min(this.pitch,89.25)),g=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(d));let b;this._calculateNearFarZIfNeeded(g,d,e),b=new Float64Array(16),a.aV(b,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.an(this._invProjMatrix,b),b[8]=2*-e.x/this._helper._width,b[9]=2*e.y/this._helper._height,this._projectionMatrix=a.aW(b),a.K(b,b,[1,-1,1]),a.J(b,b,[0,0,-this._helper.cameraToCenterDistance]),a.aX(b,b,-this.rollInRadians),a.aY(b,b,this.pitchInRadians),a.aX(b,b,-this.bearingInRadians),a.J(b,b,[-s,-c,0]),this._mercatorMatrix=a.K([],b,[this.worldSize,this.worldSize,this.worldSize]),a.K(b,b,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,b),a.J(b,b,[0,0,-this.elevation]),this._viewProjMatrix=b,this._invViewProjMatrix=a.an([],b);const P=[0,0,-1,1];a.al(P,P,this._invViewProjMatrix),this._cameraPosition=[P[0]/P[3],P[1]/P[3],P[2]/P[3]],this._fogMatrix=new Float64Array(16),a.aV(this._fogMatrix,this.fovInRadians,this.width/this.height,g,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,a.K(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.J(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.aX(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.aY(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.aX(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.J(this._fogMatrix,this._fogMatrix,[-s,-c,0]),a.K(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.J(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,b);const C=this._helper._width%2/2,z=this._helper._height%2/2,R=Math.cos(this.bearingInRadians),B=Math.sin(-this.bearingInRadians),V=s-Math.round(s)+R*C+B*z,Z=c-Math.round(c)+R*z+B*C,ne=new Float64Array(b);if(a.J(ne,ne,[V>.5?V-1:V,Z>.5?Z-1:Z,0]),this._alignedProjMatrix=ne,b=a.an(new Float64Array(16),this._pixelMatrix),!b)throw new Error("failed to invert matrix");this._pixelMatrixInverse=b,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new a.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return a.al(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=a.aH(1,this.center.lat)*this.worldSize;return ur(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,i){const s=a.Y.fromLngLat(e),c=[s.x*this.worldSize,s.y*this.worldSize,i,1];return a.al(c,c,this._viewProjMatrix),c[2]/c[3]}getProjectionData(e){const{overscaledTileID:i,aligned:s,applyTerrainMatrix:c}=e,d=this._helper.getMercatorTileCoordinates(i),g=i?this.calculatePosMatrix(i,s,!0):null;let b;return b=i&&i.terrainRttPosMatrix32f&&c?i.terrainRttPosMatrix32f:g||a.aZ(),{mainMatrix:b,tileMercatorCoords:d,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:b}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,i,s){return 1}transformLightDirection(e){return a.aN(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,i,s,c){const d=this.calculatePosMatrix(s);let g;c?(g=[e,i,c(e,i),1],a.al(g,g,d)):(g=[e,i,0,1],xn(g,g,d));const b=g[3];return{point:new a.P(g[0]/b,g[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}populateCache(e){for(const i of e)this.calculatePosMatrix(i)}getMatrixForModel(e,i){const s=a.Y.fromLngLat(e,i),c=s.meterInMercatorCoordinateUnits(),d=a.a_();return a.J(d,d,[s.x,s.y,s.z]),a.aX(d,d,Math.PI),a.aY(d,d,Math.PI/2),a.K(d,d,[-c,c,c]),d}getProjectionDataForCustomLayer(e=!0){const i=new a.S(0,0,0,0,0),s=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:e}),c=jl(i,this.worldSize);a.L(c,this._viewProjMatrix,c),s.tileMercatorCoords=[0,0,1,1];const d=[a.X,a.X,this.worldSize/this._helper.pixelsPerMeter],g=a.a$();return a.K(g,c,d),s.fallbackMatrix=g,s.mainMatrix=g,s}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function eo(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Yc(p){if(p.useSlerp)if(p.k<1){const e=a.b0(p.startEulerAngles.roll,p.startEulerAngles.pitch,p.startEulerAngles.bearing),i=a.b0(p.endEulerAngles.roll,p.endEulerAngles.pitch,p.endEulerAngles.bearing),s=new Float64Array(4);a.b1(s,e,i,p.k);const c=a.b2(s);p.tr.setRoll(c.roll),p.tr.setPitch(c.pitch),p.tr.setBearing(c.bearing)}else p.tr.setRoll(p.endEulerAngles.roll),p.tr.setPitch(p.endEulerAngles.pitch),p.tr.setBearing(p.endEulerAngles.bearing);else p.tr.setRoll(a.y.number(p.startEulerAngles.roll,p.endEulerAngles.roll,p.k)),p.tr.setPitch(a.y.number(p.startEulerAngles.pitch,p.endEulerAngles.pitch,p.k)),p.tr.setBearing(a.y.number(p.startEulerAngles.bearing,p.endEulerAngles.bearing,p.k))}function Qo(p,e,i,s,c){const d=c.padding,g=tn(c.worldSize,i.getNorthWest()),b=tn(c.worldSize,i.getNorthEast()),P=tn(c.worldSize,i.getSouthEast()),C=tn(c.worldSize,i.getSouthWest()),z=a.aa(-s),R=g.rotate(z),B=b.rotate(z),V=P.rotate(z),Z=C.rotate(z),ne=new a.P(Math.max(R.x,B.x,Z.x,V.x),Math.max(R.y,B.y,Z.y,V.y)),ie=new a.P(Math.min(R.x,B.x,Z.x,V.x),Math.min(R.y,B.y,Z.y,V.y)),re=ne.sub(ie),se=(c.width-(d.left+d.right+e.left+e.right))/re.x,ue=(c.height-(d.top+d.bottom+e.top+e.bottom))/re.y;if(ue<0||se<0)return void eo();const he=Math.min(a.a8(c.scale*Math.min(se,ue)),p.maxZoom),me=a.P.convert(p.offset),ve=new a.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(a.aa(s)),ye=me.add(ve).mult(c.scale/a.aG(he));return{center:nn(c.worldSize,g.add(P).div(2).sub(ye)),zoom:he,bearing:s}}class $l{get useGlobeControls(){return!1}handlePanInertia(e,i){return{easingOffset:e,easingCenter:i.center}}handleMapControlsRollPitchBearingZoom(e,i){e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta),e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta)}handleMapControlsPan(e,i,s){e.around.distSqr(i.centerPoint)<.01||i.setLocationAtPoint(s,e.around)}cameraForBoxAndBearing(e,i,s,c,d){return Qo(e,i,s,c,d)}handleJumpToCenterZoom(e,i){e.zoom!==(i.zoom!==void 0?+i.zoom:e.zoom)&&e.setZoom(+i.zoom),i.center!==void 0&&e.setCenter(a.N.convert(i.center))}handleEaseTo(e,i){const s=e.zoom,c=e.padding,d={roll:e.roll,pitch:e.pitch,bearing:e.bearing},g={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},b=i.zoom!==void 0,P=!e.isPaddingEqual(i.padding);let C=!1;const z=b?+i.zoom:e.zoom;let R=e.centerPoint.add(i.offsetAsPoint);const B=e.screenPointToLocation(R),{center:V,zoom:Z}=e.getConstrained(a.N.convert(i.center||B),z??s);Qn(e,V);const ne=tn(e.worldSize,B),ie=tn(e.worldSize,V).sub(ne),re=a.aG(Z-s);return C=Z!==s,{easeFunc:se=>{if(C&&e.setZoom(a.y.number(s,Z,se)),a.b3(d,g)||Yc({startEulerAngles:d,endEulerAngles:g,tr:e,k:se,useSlerp:d.roll!=g.roll}),P&&(e.interpolatePadding(c,i.padding,se),R=e.centerPoint.add(i.offsetAsPoint)),i.around)e.setLocationAtPoint(i.around,i.aroundPoint);else{const ue=a.aG(e.zoom-s),he=Z>s?Math.min(2,re):Math.max(.5,re),me=Math.pow(he,1-se),ve=nn(e.worldSize,ne.add(ie.mult(se*me)).mult(ue));e.setLocationAtPoint(e.renderWorldCopies?ve.wrap():ve,R)}},isZooming:C,elevationCenter:V}}handleFlyTo(e,i){const s=i.zoom!==void 0,c=e.zoom,d=e.getConstrained(a.N.convert(i.center||i.locationAtOffset),s?+i.zoom:c),g=d.center,b=d.zoom;Qn(e,g);const P=tn(e.worldSize,i.locationAtOffset),C=tn(e.worldSize,g).sub(P),z=C.mag(),R=a.aG(b-c);let B;if(i.minZoom!==void 0){const V=Math.min(+i.minZoom,c,b),Z=e.getConstrained(g,V).zoom;B=a.aG(Z-c)}return{easeFunc:(V,Z,ne,ie)=>{e.setZoom(V===1?b:c+a.a8(Z));const re=V===1?g:nn(e.worldSize,P.add(C.mult(ne)).mult(Z));e.setLocationAtPoint(e.renderWorldCopies?re.wrap():re,ie)},scaleOfZoom:R,targetCenter:g,scaleOfMinZoom:B,pixelPathLength:z}}}class Li{constructor(e,i,s){this.blendFunction=e,this.blendColor=i,this.mask=s}}Li.Replace=[1,0],Li.disabled=new Li(Li.Replace,a.b4.transparent,[!1,!1,!1,!1]),Li.unblended=new Li(Li.Replace,a.b4.transparent,[!0,!0,!0,!0]),Li.alphaBlended=new Li([1,771],a.b4.transparent,[!0,!0,!0,!0]);const ya=2305;class li{constructor(e,i,s){this.enable=e,this.mode=i,this.frontFace=s}}li.disabled=new li(!1,1029,ya),li.backCCW=new li(!0,1029,ya),li.frontCCW=new li(!0,1028,ya);class Ht{constructor(e,i,s){this.func=e,this.mask=i,this.range=s}}Ht.ReadOnly=!1,Ht.ReadWrite=!0,Ht.disabled=new Ht(519,Ht.ReadOnly,[0,1]);const Ya=7680;class hi{constructor(e,i,s,c,d,g){this.test=e,this.ref=i,this.mask=s,this.fail=c,this.depthFail=d,this.pass=g}}hi.disabled=new hi({func:519,mask:0},0,0,Ya,Ya,Ya);const Mi=new WeakMap;function pi(p){var e;if(Mi.has(p))return Mi.get(p);{const i=(e=p.getParameter(p.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Mi.set(p,i),i}}class Ja{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const i=e.context,s=i.gl;this._texFormat=s.RGBA,this._texType=s.UNSIGNED_BYTE;const c=new a.aC;c.emplaceBack(-1,-1),c.emplaceBack(2,-1),c.emplaceBack(-1,2);const d=new a.aE;d.emplaceBack(0,1,2),this._fullscreenTriangle=new _o(i.createVertexBuffer(c,Kt.members),i.createIndexBuffer(d),a.aD.simpleSegment(0,0,c.length,d.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(s.TEXTURE1);const g=s.createTexture();s.bindTexture(s.TEXTURE_2D,g),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texImage2D(s.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(g),pi(s)&&(this._pbo=s.createBuffer(),s.bindBuffer(s.PIXEL_PACK_BUFFER,this._pbo),s.bufferData(s.PIXEL_PACK_BUFFER,4,s.STREAM_READ),s.bindBuffer(s.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,i){const s=this._updateCount;return this._readbackQueue?s>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():s>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,i),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,i=e.gl;e.activeTexture.set(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,i){const s=this._cachedRenderContext.context,c=s.gl;if(this._bindFramebuffer(),s.viewport.set([0,0,this._texWidth,this._texHeight]),s.clear({color:a.b4.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(s,c.TRIANGLES,Ht.disabled,hi.disabled,Li.unblended,li.disabled,((d,g)=>({u_input:d,u_output_expected:g}))(e,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&pi(c)){c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.readBuffer(c.COLOR_ATTACHMENT0),c.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null);const d=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0);c.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:d}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&pi(e)){const i=e.clientWaitSync(this._readbackQueue.sync,0,0);if(i===e.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Ja._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let i=0;return i+=e[0]/256,i+=e[1]/65536,i+=e[2]/16777216,e[3]<127&&(i=-i),i/128}}const Qa=a.X/128;function el(p,e){const i=p.granularity!==void 0?Math.max(p.granularity,1):1,s=i+(p.generateBorders?2:0),c=i+(p.extendToNorthPole||p.generateBorders?1:0)+(p.extendToSouthPole||p.generateBorders?1:0),d=s+1,g=c+1,b=p.generateBorders?-1:0,P=p.generateBorders||p.extendToNorthPole?-1:0,C=i+(p.generateBorders?1:0),z=i+(p.generateBorders||p.extendToSouthPole?1:0),R=d*g,B=s*c*6,V=d*g>65536;if(V&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Z=V||e==="32bit",ne=new Int16Array(2*R);let ie=0;for(let ue=P;ue<=z;ue++)for(let he=b;he<=C;he++){let me=he/i*a.X;he===-1&&(me=-64),he===i+1&&(me=a.X+Qa);let ve=ue/i*a.X;ue===-1&&(ve=p.extendToNorthPole?a.b6:-64),ue===i+1&&(ve=p.extendToSouthPole?a.b7:a.X+Qa),ne[ie++]=me,ne[ie++]=ve}const re=Z?new Uint32Array(B):new Uint16Array(B);let se=0;for(let ue=0;ue<c;ue++)for(let he=0;he<s;he++){const me=he+1+ue*d,ve=he+(ue+1)*d,ye=he+1+(ue+1)*d;re[se++]=he+ue*d,re[se++]=ve,re[se++]=me,re[se++]=me,re[se++]=ve,re[se++]=ye}return{vertices:ne.buffer.slice(0),indices:re.buffer.slice(0),uses32bitIndices:Z}}const Vs=new a.aB({fill:new a.b8(128,2),line:new a.b8(512,0),tile:new a.b8(128,32),stencil:new a.b8(128,1),circle:3});class Gu{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Bo.projectionGlobe}get vertexShaderPreludeCode(){return Bo.projectionMercator.vertexSource}get subdivisionGranularity(){return Vs}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Ja(e));const i=a.Q(this._errorQueryLatitudeDegrees),s=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,c=this._errorMeasurement.updateErrorLoop(i,s),d=ge.now();c!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=c,this._errorMeasurementLastChangeTime=d);const g=Math.min(Math.max((d-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.b9(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.ba(g))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,i,s,c,d){const g=(d==="stencil"?Vs.stencil:Vs.tile).getGranularityForZoomLevel(i.z);return this._getMesh(e,{granularity:g,generateBorders:s,extendToNorthPole:i.y===0&&c,extendToSouthPole:i.y===(1<<i.z)-1&&c})}_getMesh(e,i){const s=this._getMeshKey(i);if(s in this._tileMeshCache)return this._tileMeshCache[s];const c=function(d,g){const b=el(g,"16bit"),P=a.aC.deserialize({arrayBuffer:b.vertices,length:b.vertices.byteLength/2/2}),C=a.aE.deserialize({arrayBuffer:b.indices,length:b.indices.byteLength/2/3});return new _o(d.createVertexBuffer(P,Kt.members),d.createIndexBuffer(C),a.aD.simpleSegment(0,0,P.length,C.length))}(e,i);return this._tileMeshCache[s]=c,c}recalculate(e){}hasTransition(){const e=ge.now();let i=!1;return i=i||(e-this._errorMeasurementLastChangeTime)/1e3<.7,i=i||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,i}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Jc=new a.q({type:new a.D(a.v.projection.type)});class Vl extends a.E{constructor(e){super(),this._transitionable=new a.T(Jc),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.z(0)),this._mercatorProjection=new $s,this._verticalPerspectiveProjection=new Gu}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof a.bb){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,i,s,c,d){return this.currentProjection.getMeshFromTileID(e,i,s,c,d)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Zu(p){const e=to(p.worldSize,p.center.lat);return 2*Math.PI*e}function bn(p,e,i,s,c){const d=1/(1<<c),g=e/a.X*d+s*d,b=a.bd((p/a.X*d+i*d)*Math.PI*2+Math.PI,2*Math.PI),P=2*Math.atan(Math.exp(Math.PI-g*Math.PI*2))-.5*Math.PI,C=Math.cos(P),z=new Float64Array(3);return z[0]=Math.sin(b)*C,z[1]=Math.sin(P),z[2]=Math.cos(b)*C,z}function Ci(p){return function(e,i){const s=Math.cos(i),c=new Float64Array(3);return c[0]=Math.sin(e)*s,c[1]=Math.sin(i),c[2]=Math.cos(e)*s,c}(p.lng*Math.PI/180,p.lat*Math.PI/180)}function to(p,e){return p/(2*Math.PI)/Math.cos(e*Math.PI/180)}function io(p){const e=Math.asin(p[1])/Math.PI*180,i=Math.sqrt(p[0]*p[0]+p[2]*p[2]);if(i>1e-6){const s=p[0]/i,c=Math.acos(p[2]/i),d=(s>0?c:-c)/Math.PI*180;return new a.N(a.aI(d,-180,180),e)}return new a.N(0,e)}function es(p){return Math.cos(p*Math.PI/180)}function Ii(p,e){const i=es(p),s=es(e);return a.a8(s/i)}function Ul(p,e){const i=p.rotate(e.bearingInRadians),s=e.zoom+Ii(e.center.lat,0),c=a.b9(1/es(e.center.lat),1/es(Math.min(Math.abs(e.center.lat),60)),a.bc(s,7,3,0,1)),d=360/Zu({worldSize:e.worldSize,center:{lat:e.center.lat}});return new a.N(e.center.lng-i.x*d*c,a.ab(e.center.lat+i.y*d,-85.051129,a.aF))}function ts(p){const e=.5*p,i=Math.sin(e),s=Math.cos(e);return Math.log(i+s)-Math.log(s-i)}function Qc(p,e,i,s){const c=p.lat+i*s;if(Math.abs(i)>1){const d=(Math.sign(p.lat+i)!==Math.sign(p.lat)?-Math.abs(p.lat):Math.abs(p.lat))*Math.PI/180,g=Math.abs(p.lat+i)*Math.PI/180,b=ts(d+s*(g-d)),P=ts(d),C=ts(g);return new a.N(p.lng+e*((b-P)/(C-P)),c)}return new a.N(p.lng+e*s,c)}class qu{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=e}recalculateCache(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(e,i,s,c){const d=`${e.z}_${e.x}_${e.y}`,g=this._cache.get(d);if(g)return g;const b=this._cachePrevious.get(d);if(b)return this._cache.set(d,b),b;const P=this._aabbFactory(e,i,s,c);return this._cache.set(d,P),this._hadAnyChanges=!0,P}}function tl(p,e,i){const s=p-e;return s<0?-s:Math.max(0,s-i)}function Gl(p,e,i,s,c){const d=p-i;let g;return g=d<0?Math.min(-d,1+d-c):d>1?Math.min(Math.max(d-c,0),1-d):0,Math.max(g,tl(e,s,c))}class Ur{constructor(){this._aabbCache=new qu(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(e,i,s,c){const d=1<<s.z,g=1/d,b=s.x/d,P=s.y/d;let C=2;return C=Math.min(C,Gl(e,i,b,P,g)),C=Math.min(C,Gl(e,i,b+.5,-P-g,g)),C=Math.min(C,Gl(e,i,b+.5,2-P-g,g)),C}getWrap(e,i,s){const c=1<<i.z,d=1/c,g=i.x/c,b=tl(e.x,g,d),P=tl(e.x,g-1,d),C=tl(e.x,g+1,d),z=Math.min(b,P,C);return z===C?1:z===P?-1:0}allowVariableZoom(e,i){return En(e,i)>4}allowWorldCopies(){return!1}getTileAABB(e,i,s,c){return this._aabbCache.getTileAABB(e,i,s,c)}_computeTileAABB(e,i,s,c){if(e.z<=0)return new $i([-1,-1,-1],[1,1,1]);if(e.z===1)return new $i([e.x===0?-1:0,e.y===0?0:-1,-1],[e.x===0?0:1,e.y===0?1:0,1]);{const d=[bn(0,0,e.x,e.y,e.z),bn(a.X,0,e.x,e.y,e.z),bn(a.X,a.X,e.x,e.y,e.z),bn(0,a.X,e.x,e.y,e.z)],g=[1,1,1],b=[-1,-1,-1];for(const P of d)for(let C=0;C<3;C++)g[C]=Math.min(g[C],P[C]),b[C]=Math.max(b[C],P[C]);if(e.y===0||e.y===(1<<e.z)-1){const P=[0,e.y===0?1:-1,0];for(let C=0;C<3;C++)g[C]=Math.min(g[C],P[C]),b[C]=Math.max(b[C],P[C])}return new $i(g,b)}}}class Zl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,s){return this._helper.interpolatePadding(e,i,s)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i){this._helper.resize(e,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=a.be(),this._projectionMatrix=a.a_(),this._globeViewProjMatrix32f=a.aZ(),this._globeViewProjMatrixNoCorrection=a.a_(),this._globeViewProjMatrixNoCorrectionInverted=a.a_(),this._globeProjMatrixInverted=a.a_(),this._cameraPosition=a.bf(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new vs({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._coveringTilesDetailsProvider=new Ur}clone(){const e=new Zl;return e.apply(this),e}apply(e,i){this._globeLatitudeErrorCorrectionRadians=i||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=a.bf();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:i,applyGlobeMatrix:s}=e,c=this._helper.getMercatorTileCoordinates(i);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:c,clippingPlane:this._cachedClippingPlane,projectionTransition:s?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const i=this.pitchInRadians,s=this.cameraToCenterDistance/e,c=Math.sin(i)*s,d=Math.cos(i)*s+1,g=1/Math.sqrt(c*c+d*d)*1;let b=-c,P=d;const C=Math.sqrt(b*b+P*P);b/=C,P/=C;const z=[0,b,P];return a.bg(z,z,[0,0,0],-this.bearingInRadians),a.bh(z,z,[0,0,0],-1*this.center.lat*Math.PI/180),a.bi(z,z,[0,0,0],this.center.lng*Math.PI/180),a.aL(z,z,.25),[...z,.25*-g]}isLocationOccluded(e){return!this.isSurfacePointVisible(Ci(e))}transformLightDirection(e){const i=this._helper._center.lng*Math.PI/180,s=this._helper._center.lat*Math.PI/180,c=Math.cos(s),d=[Math.sin(i)*c,Math.sin(s),Math.cos(i)*c],g=[d[2],0,-d[0]],b=[0,0,0];a.aR(b,g,d),a.aQ(g,g),a.aQ(b,b);const P=[0,0,0];return a.aQ(P,[g[0]*e[0]+b[0]*e[1]+d[0]*e[2],g[1]*e[0]+b[1]*e[1]+d[1]*e[2],g[2]*e[0]+b[2]*e[1]+d[2]*e[2]]),P}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,i,s){const c=function(b,P,C){const z=1/(1<<C.z);return new a.Y(b/a.X*z+C.x*z,P/a.X*z+C.y*z)}(e,i,s.canonical),d=(g=c.y,[a.bd(c.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-g*Math.PI*2))-.5*Math.PI]);var g;return this.getCircleRadiusCorrection()/Math.cos(d[1])}projectTileCoordinates(e,i,s,c){const d=s.canonical,g=bn(e,i,d.x,d.y,d.z),b=1+(c?c(e,i):0)/a.bo,P=[g[0]*b,g[1]*b,g[2]*b,1];a.al(P,P,this._globeViewProjMatrixNoCorrection);const C=this._cachedClippingPlane,z=C[0]*g[0]+C[1]*g[1]+C[2]*g[2]+C[3]<0;return{point:new a.P(P[0]/P[3],P[1]/P[3]),signedDistanceFromCamera:P[3],isOccluded:z}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=to(this.worldSize,this.center.lat),i=a.a$(),s=a.a$();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),a.aV(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const c=this.centerOffset;i[8]=2*-c.x/this._helper._width,i[9]=2*c.y/this._helper._height,this._projectionMatrix=a.aW(i),this._globeProjMatrixInverted=a.a$(),a.an(this._globeProjMatrixInverted,i),a.J(i,i,[0,0,-this.cameraToCenterDistance]),a.aX(i,i,this.rollInRadians),a.aY(i,i,-this.pitchInRadians),a.aX(i,i,this.bearingInRadians),a.J(i,i,[0,0,-e]);const d=a.bf();d[0]=e,d[1]=e,d[2]=e,a.aY(s,i,this.center.lat*Math.PI/180),a.bj(s,s,-this.center.lng*Math.PI/180),a.K(s,s,d),this._globeViewProjMatrixNoCorrection=s,a.aY(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.bj(i,i,-this.center.lng*Math.PI/180),a.K(i,i,d),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=a.a$(),a.an(this._globeViewProjMatrixNoCorrectionInverted,s);const g=a.bf();this._cameraPosition=a.bf(),this._cameraPosition[2]=this.cameraToCenterDistance/e,a.bg(this._cameraPosition,this._cameraPosition,g,-this.rollInRadians),a.bh(this._cameraPosition,this._cameraPosition,g,this.pitchInRadians),a.bg(this._cameraPosition,this._cameraPosition,g,-this.bearingInRadians),a.aM(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bh(this._cameraPosition,this._cameraPosition,g,-this.center.lat*Math.PI/180),a.bi(this._cameraPosition,this._cameraPosition,g,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const b=a.aW(this._globeViewProjMatrixNoCorrectionInverted);a.K(b,b,[1,1,-1]),this._cachedFrustum=Fo.fromInvProjectionMatrix(b)}calculateFogMatrix(e){a.w("calculateFogMatrix is not supported on globe projection.");const i=a.a$();return a.aq(i),i}getVisibleUnwrappedCoordinates(e){return[new a.aT(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){if(!this._globeViewProjMatrixNoCorrection)return 1;const s=Ci(e);a.aL(s,s,1+i/a.bo);const c=a.be();return a.al(c,[s[0],s[1],s[2],1],this._globeViewProjMatrixNoCorrection),c[2]/c[3]}populateCache(e){}getBounds(){const e=.5*this.width,i=.5*this.height,s=[new a.P(0,0),new a.P(e,0),new a.P(this.width,0),new a.P(this.width,i),new a.P(this.width,this.height),new a.P(e,this.height),new a.P(0,this.height),new a.P(0,i)],c=[];for(const R of s)c.push(this.unprojectScreenPoint(R));let d=0,g=0,b=0,P=0;const C=this.center;for(const R of c){const B=a.bk(C.lng,R.lng),V=a.bk(C.lat,R.lat);B<g&&(g=B),B>d&&(d=B),V<P&&(P=V),V>b&&(b=V)}const z=[C.lng+g,C.lat+P,C.lng+d,C.lat+b];return this.isSurfacePointOnScreen([0,1,0])&&(z[3]=90,z[0]=-180,z[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(z[1]=-90,z[0]=-180,z[2]=180),new mi(z)}getConstrained(e,i){const s=a.ab(e.lat,-85.051129,a.aF),c=a.ab(+i,this.minZoom+Ii(0,s),this.maxZoom);return{center:new a.N(e.lng,s),zoom:c}}calculateCenterFromCameraLngLatAlt(e,i,s,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,s,c)}setLocationAtPoint(e,i){const s=Ci(this.unprojectScreenPoint(i)),c=Ci(e),d=a.bf();a.bl(d);const g=a.bf();a.bi(g,s,d,-this.center.lng*Math.PI/180),a.bh(g,g,d,this.center.lat*Math.PI/180);const b=c[0]*c[0]+c[2]*c[2],P=g[0]*g[0];if(b<P)return;const C=Math.sqrt(b-P),z=-C,R=a.bm(c[0],c[2],g[0],C),B=a.bm(c[0],c[2],g[0],z),V=a.bf();a.bi(V,c,d,-R);const Z=a.bm(V[1],V[2],g[1],g[2]),ne=a.bf();a.bi(ne,c,d,-B);const ie=a.bm(ne[1],ne[2],g[1],g[2]),re=.5*Math.PI,se=Z>=-re&&Z<=re,ue=ie>=-re&&ie<=re;let he,me;if(se&&ue){const Le=this.center.lng*Math.PI/180,Ve=this.center.lat*Math.PI/180;a.bp(R,Le)+a.bp(Z,Ve)<a.bp(B,Le)+a.bp(ie,Ve)?(he=R,me=Z):(he=B,me=ie)}else if(se)he=R,me=Z;else{if(!ue)return;he=B,me=ie}const ve=he/Math.PI*180,ye=me/Math.PI*180,ze=this.center.lat;this.setCenter(new a.N(ve,a.ab(ye,-90,90))),this.setZoom(this.zoom+Ii(ze,this.center.lat))}locationToScreenPoint(e,i){const s=Ci(e);if(i){const c=i.getElevationForLngLatZoom(e,this._helper._tileZoom);a.aL(s,s,1+c/a.bo)}return this._projectSurfacePointToScreen(s)}_projectSurfacePointToScreen(e){const i=a.be();return a.al(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new a.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,i){if(i){const s=i.pointCoordinate(e);if(s)return s}return a.Y.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,i){var s;return(s=this.screenPointToMercatorCoordinate(e,i))===null||s===void 0?void 0:s.toLngLat()}isPointOnMapSurface(e,i){const s=this._cameraPosition,c=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(s,c)}getRayDirectionFromPixel(e){const i=a.be();i[0]=e.x/this.width*2-1,i[1]=-1*(e.y/this.height*2-1),i[2]=1,i[3]=1,a.al(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];const s=a.bf();s[0]=i[0]-this._cameraPosition[0],s[1]=i[1]-this._cameraPosition[1],s[2]=i[2]-this._cameraPosition[2];const c=a.bf();return a.aQ(c,s),c}isSurfacePointVisible(e){const i=this._cachedClippingPlane;return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const i=a.be();return a.al(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(e,i){const s=a.aS(e,i),c=a.bf(),d=a.bf();a.aL(d,i,s),a.aP(c,e,d);const g=1-a.aS(c,c);if(g<0)return null;const b=a.aS(e,e)-1,P=-s+(s<0?1:-1)*Math.sqrt(g),C=b/P,z=P;return{tMin:Math.min(C,z),tMax:Math.max(C,z)}}unprojectScreenPoint(e){const i=this._cameraPosition,s=this.getRayDirectionFromPixel(e),c=this.rayPlanetIntersection(i,s);if(c){const C=a.bf();a.aM(C,i,[s[0]*c.tMin,s[1]*c.tMin,s[2]*c.tMin]);const z=a.bf();return a.aQ(z,C),io(z)}const d=this._cachedClippingPlane[0]*s[0]+this._cachedClippingPlane[1]*s[1]+this._cachedClippingPlane[2]*s[2],g=-a.bn(this._cachedClippingPlane,i)/d,b=a.bf();if(g>0)a.aM(b,i,[s[0]*g,s[1]*g,s[2]*g]);else{const C=a.bf();a.aM(C,i,[2*s[0],2*s[1],2*s[2]]);const z=a.bn(this._cachedClippingPlane,C);a.aP(b,C,[this._cachedClippingPlane[0]*z,this._cachedClippingPlane[1]*z,this._cachedClippingPlane[2]*z])}const P=a.bf();return a.aQ(P,b),io(P)}getMatrixForModel(e,i){const s=a.N.convert(e),c=1/a.bo,d=a.a_();return a.bj(d,d,s.lng/180*Math.PI),a.aY(d,d,-s.lat/180*Math.PI),a.J(d,d,[0,0,1+i/a.bo]),a.aY(d,d,.5*Math.PI),a.K(d,d,[c,c,c]),d}getProjectionDataForCustomLayer(e=!0){const i=this.getProjectionData({overscaledTileID:new a.S(0,0,0,0,0),applyGlobeMatrix:e});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(e){}}class qn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,s){return this._helper.interpolatePadding(e,i,s)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,s=!0){this._helper.resize(e,i,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,i){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=i,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new vs({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._globeness=1,this._mercatorTransform=new Oo,this._verticalPerspectiveTransform=new Zl}clone(){const e=new qn;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const i=this._mercatorTransform.getProjectionData(e),s=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?s.mainMatrix:i.mainMatrix,clippingPlane:s.clippingPlane,tileMercatorCoords:s.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:i.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return a.b9(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.b9(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,i,s){const c=this._mercatorTransform.getPitchedTextCorrection(e,i,s),d=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,i,s);return a.b9(c,d,this._globeness)}projectTileCoordinates(e,i,s,c){return this.currentTransform.projectTileCoordinates(e,i,s,c)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){return this.currentTransform.lngLatToCameraDepth(e,i)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,i){return this.currentTransform.getConstrained(e,i)}calculateCenterFromCameraLngLatAlt(e,i,s,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,s,c)}setLocationAtPoint(e,i){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,i),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,i),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,i){return this.currentTransform.locationToScreenPoint(e,i)}screenPointToMercatorCoordinate(e,i){return this.currentTransform.screenPointToMercatorCoordinate(e,i)}screenPointToLocation(e,i){return this.currentTransform.screenPointToLocation(e,i)}isPointOnMapSurface(e,i){return this.currentTransform.isPointOnMapSurface(e,i)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,i){return this.currentTransform.getMatrixForModel(e,i)}getProjectionDataForCustomLayer(e=!0){const i=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return i;const s=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return s.fallbackMatrix=i.mainMatrix,s}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Gr{get useGlobeControls(){return!0}handlePanInertia(e,i){const s=Ul(e,i);return Math.abs(s.lng-i.center.lng)>180&&(s.lng=i.center.lng+179.5*Math.sign(s.lng-i.center.lng)),{easingCenter:s,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,i){const s=e.around,c=i.screenPointToLocation(s);e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta);const d=i.zoom;e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta);const g=i.zoom-d;if(g===0)return;const b=a.bk(i.center.lng,c.lng),P=b/(Math.abs(b/180)+1),C=a.bk(i.center.lat,c.lat),z=i.getRayDirectionFromPixel(s),R=i.cameraPosition,B=-1*a.aS(R,z),V=a.bf();a.aM(V,R,[z[0]*B,z[1]*B,z[2]*B]);const Z=a.bq(V)-1,ne=Math.exp(.5*-Math.max(Z-.3,0)),ie=to(i.worldSize,i.center.lat)/Math.min(i.width,i.height),re=a.bc(ie,.9,.5,1,.25),se=(1-a.aG(-g))*Math.min(ne,re),ue=i.center.lat,he=i.zoom,me=new a.N(i.center.lng+P*se,a.ab(i.center.lat+C*se,-85.051129,a.aF));i.setLocationAtPoint(c,s);const ve=i.center,ye=a.bc(Math.abs(b),45,85,0,1),ze=a.bc(ie,.75,.35,0,1),Le=Math.pow(Math.max(ye,ze),.25),Ve=a.bk(ve.lng,me.lng),He=a.bk(ve.lat,me.lat);i.setCenter(new a.N(ve.lng+Ve*Le,ve.lat+He*Le).wrap()),i.setZoom(he+Ii(ue,i.center.lat))}handleMapControlsPan(e,i,s){if(!e.panDelta)return;const c=i.center.lat,d=i.zoom;i.setCenter(Ul(e.panDelta,i).wrap()),i.setZoom(d+Ii(c,i.center.lat))}cameraForBoxAndBearing(e,i,s,c,d){const g=Qo(e,i,s,c,d),b=i.left/d.width*2-1,P=(d.width-i.right)/d.width*2-1,C=i.top/d.height*-2+1,z=(d.height-i.bottom)/d.height*-2+1,R=a.bk(s.getWest(),s.getEast())<0,B=R?s.getEast():s.getWest(),V=R?s.getWest():s.getEast(),Z=Math.max(s.getNorth(),s.getSouth()),ne=Math.min(s.getNorth(),s.getSouth()),ie=B+.5*a.bk(B,V),re=Z+.5*a.bk(Z,ne),se=d.clone();se.setCenter(g.center),se.setBearing(g.bearing),se.setPitch(0),se.setRoll(0),se.setZoom(g.zoom);const ue=se.modelViewProjectionMatrix,he=[Ci(s.getNorthWest()),Ci(s.getNorthEast()),Ci(s.getSouthWest()),Ci(s.getSouthEast()),Ci(new a.N(V,re)),Ci(new a.N(B,re)),Ci(new a.N(ie,Z)),Ci(new a.N(ie,ne))],me=Ci(g.center);let ve=Number.POSITIVE_INFINITY;for(const ye of he)b<0&&(ve=Gr.getLesserNonNegativeNonNull(ve,Gr.solveVectorScale(ye,me,ue,"x",b))),P>0&&(ve=Gr.getLesserNonNegativeNonNull(ve,Gr.solveVectorScale(ye,me,ue,"x",P))),C>0&&(ve=Gr.getLesserNonNegativeNonNull(ve,Gr.solveVectorScale(ye,me,ue,"y",C))),z<0&&(ve=Gr.getLesserNonNegativeNonNull(ve,Gr.solveVectorScale(ye,me,ue,"y",z)));if(Number.isFinite(ve)&&ve!==0)return g.zoom=se.zoom+a.a8(ve),g;eo()}handleJumpToCenterZoom(e,i){const s=e.center.lat,c=e.getConstrained(i.center?a.N.convert(i.center):e.center,e.zoom).center;e.setCenter(c.wrap());const d=i.zoom!==void 0?+i.zoom:e.zoom+Ii(s,c.lat);e.zoom!==d&&e.setZoom(d)}handleEaseTo(e,i){const s=e.zoom,c=e.center,d=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},b={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},P=i.zoom!==void 0,C=!e.isPaddingEqual(i.padding);let z=!1;const R=i.center?a.N.convert(i.center):c,B=e.getConstrained(R,s).center;Qn(e,B);const V=e.clone();V.setCenter(B),V.setZoom(P?+i.zoom:s+Ii(c.lat,R.lat)),V.setBearing(i.bearing);const Z=new a.P(a.ab(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),a.ab(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));V.setLocationAtPoint(B,Z);const ne=(i.offset&&i.offsetAsPoint.mag())>0?V.center:B,ie=P?+i.zoom:s+Ii(c.lat,ne.lat),re=s+Ii(c.lat,0),se=ie+Ii(ne.lat,0),ue=a.bk(c.lng,ne.lng),he=a.bk(c.lat,ne.lat),me=a.aG(se-re);return z=ie!==s,{easeFunc:ve=>{if(a.b3(g,b)||Yc({startEulerAngles:g,endEulerAngles:b,tr:e,k:ve,useSlerp:g.roll!=b.roll}),C&&e.interpolatePadding(d,i.padding,ve),i.around)a.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(i.around,i.aroundPoint);else{const ye=se>re?Math.min(2,me):Math.max(.5,me),ze=Math.pow(ye,1-ve),Le=Qc(c,ue,he,ve*ze);e.setCenter(Le.wrap())}if(z){const ye=a.y.number(re,se,ve)+Ii(0,e.center.lat);e.setZoom(ye)}},isZooming:z,elevationCenter:ne}}handleFlyTo(e,i){const s=i.zoom!==void 0,c=e.center,d=e.zoom,g=!e.isPaddingEqual(i.padding),b=e.getConstrained(a.N.convert(i.center||i.locationAtOffset),d).center,P=s?+i.zoom:e.zoom+Ii(e.center.lat,b.lat),C=e.clone();C.setCenter(b),g&&C.setPadding(i.padding),C.setZoom(P),C.setBearing(i.bearing);const z=new a.P(a.ab(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),a.ab(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));C.setLocationAtPoint(b,z);const R=C.center;Qn(e,R);const B=function(ue,he,me){const ve=Ci(he),ye=Ci(me),ze=a.aS(ve,ye),Le=Math.acos(ze),Ve=Zu(ue);return Le/(2*Math.PI)*Ve}(e,c,R),V=d+Ii(c.lat,0),Z=P+Ii(R.lat,0),ne=a.aG(Z-V);let ie;if(typeof i.minZoom=="number"){const ue=+i.minZoom+Ii(R.lat,0),he=Math.min(ue,V,Z)+Ii(0,R.lat),me=e.getConstrained(R,he).zoom+Ii(R.lat,0);ie=a.aG(me-V)}const re=a.bk(c.lng,R.lng),se=a.bk(c.lat,R.lat);return{easeFunc:(ue,he,me,ve)=>{const ye=Qc(c,re,se,me),ze=ue===1?R:ye;e.setCenter(ze.wrap());const Le=V+a.a8(he);e.setZoom(ue===1?P:Le+Ii(0,ze.lat))},scaleOfZoom:ne,targetCenter:R,scaleOfMinZoom:ie,pixelPathLength:B}}static solveVectorScale(e,i,s,c,d){const g=c==="x"?[s[0],s[4],s[8],s[12]]:[s[1],s[5],s[9],s[13]],b=[s[3],s[7],s[11],s[15]],P=e[0]*g[0]+e[1]*g[1]+e[2]*g[2],C=e[0]*b[0]+e[1]*b[1]+e[2]*b[2],z=i[0]*g[0]+i[1]*g[1]+i[2]*g[2],R=i[0]*b[0]+i[1]*b[1]+i[2]*b[2];return z+d*C===P+d*R||b[3]*(P-z)+g[3]*(R-C)+P*R==z*C?null:(z+g[3]-d*R-d*b[3])/(z-P-d*R+d*C)}static getLesserNonNegativeNonNull(e,i){return i!==null&&i>=0&&i<e?i:e}}class va{constructor(e){this._globe=e,this._mercatorCameraHelper=new $l,this._verticalPerspectiveCameraHelper=new Gr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,i){return this.currentHelper.handlePanInertia(e,i)}handleMapControlsRollPitchBearingZoom(e,i){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,i)}handleMapControlsPan(e,i,s){this.currentHelper.handleMapControlsPan(e,i,s)}cameraForBoxAndBearing(e,i,s,c,d){return this.currentHelper.cameraForBoxAndBearing(e,i,s,c,d)}handleJumpToCenterZoom(e,i){this.currentHelper.handleJumpToCenterZoom(e,i)}handleEaseTo(e,i){return this.currentHelper.handleEaseTo(e,i)}handleFlyTo(e,i){return this.currentHelper.handleFlyTo(e,i)}}const Zr=(p,e)=>a.t(p,e&&e.filter(i=>i.identifier!=="source.canvas")),xa=a.br();class Ir extends a.E{constructor(e,i={}){super(),this._rtlPluginLoaded=()=>{for(const s in this.sourceCaches){const c=this.sourceCaches[s].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[s].reload()}},this.map=e,this.dispatcher=new fr(Tr(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(s,c)=>this.getGlyphs(s,c)),this.dispatcher.registerMessageHandler("GI",(s,c)=>this.getImages(s,c)),this.imageManager=new Bi,this.imageManager.setEventedParent(this),this.glyphManager=new Pt(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new Yi(256,512),this.crossTileSymbolIndex=new Lo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.bs,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.bt()),en().on(Bn,this._rtlPluginLoaded),this.on("data",s=>{if(s.dataType!=="source"||s.sourceDataType!=="metadata")return;const c=this.sourceCaches[s.sourceId];if(!c)return;const d=c.getSource();if(d&&d.vectorLayerIds)for(const g in this._layers){const b=this._layers[g];b.source===d.id&&this._validateLayer(b)}})}loadURL(e,i={},s){this.fire(new a.k("dataloading",{dataType:"style"})),i.validate=typeof i.validate!="boolean"||i.validate;const c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const d=this._loadStyleRequest;a.h(c,this._loadStyleRequest).then(g=>{this._loadStyleRequest=null,this._load(g.data,i,s)}).catch(g=>{this._loadStyleRequest=null,g&&!d.signal.aborted&&this.fire(new a.j(g))})}loadJSON(e,i={},s){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ge.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,i.validate=i.validate!==!1,this._load(e,i,s)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(xa,{validate:!1})}_load(e,i,s){var c,d;const g=i.transformStyle?i.transformStyle(s,e):e;if(!i.validate||!Zr(this,a.u(g))){this._loaded=!0,this.stylesheet=g;for(const b in g.sources)this.addSource(b,g.sources[b],{validate:!1});g.sprite?this._loadSprite(g.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(g.glyphs),this._createLayers(),this.light=new gi(this.stylesheet.light),this._setProjectionInternal(((c=this.stylesheet.projection)===null||c===void 0?void 0:c.type)||"mercator"),this.sky=new cn(this.stylesheet.sky),this.map.setTerrain((d=this.stylesheet.terrain)!==null&&d!==void 0?d:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const e=a.bu(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(i=>i.id),this._layers={},this._serializedLayers=null;for(const i of e){const s=a.bv(i);s.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=s}}_loadSprite(e,i=!1,s=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(d,g,b,P){return a._(this,void 0,void 0,function*(){const C=Xe(d),z=b>1?"@2x":"",R={},B={};for(const{id:V,url:Z}of C){const ne=g.transformRequest(ct(Z,z,".json"),"SpriteJSON");R[V]=a.h(ne,P);const ie=g.transformRequest(ct(Z,z,".png"),"SpriteImage");B[V]=nt.getImage(ie,P)}return yield Promise.all([...Object.values(R),...Object.values(B)]),function(V,Z){return a._(this,void 0,void 0,function*(){const ne={};for(const ie in V){ne[ie]={};const re=ge.getImageCanvasContext((yield Z[ie]).data),se=(yield V[ie]).data;for(const ue in se){const{width:he,height:me,x:ve,y:ye,sdf:ze,pixelRatio:Le,stretchX:Ve,stretchY:He,content:je,textFitWidth:We,textFitHeight:ft}=se[ue];ne[ie][ue]={data:null,pixelRatio:Le,sdf:ze,stretchX:Ve,stretchY:He,content:je,textFitWidth:We,textFitHeight:ft,spriteData:{width:he,height:me,x:ve,y:ye,context:re}}}}return ne})}(R,B)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(d=>{if(this._spriteRequest=null,d)for(const g in d){this._spritesImagesIds[g]=[];const b=this._spritesImagesIds[g]?this._spritesImagesIds[g].filter(P=>!(P in d)):[];for(const P of b)this.imageManager.removeImage(P),this._changedImages[P]=!0;for(const P in d[g]){const C=g==="default"?P:`${g}:${P}`;this._spritesImagesIds[g].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,d[g][P],!1):this.imageManager.addImage(C,d[g][P]),i&&(this._changedImages[C]=!0)}}}).catch(d=>{this._spriteRequest=null,c=d,this.fire(new a.j(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),s&&s(c)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const s=e.sourceLayer;if(!s)return;const c=i.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(s)===-1)&&this.fire(new a.j(new Error(`Source layer "${s}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,i=!1){const s=this._serializedAllLayers();if(!e||e.length===0)return Object.values(i?a.bw(s):s);const c=[];for(const d of e)if(s[d]){const g=i?a.bw(s[d]):s[d];c.push(g)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const i=Object.keys(this._layers);for(const s of i){const c=this._layers[s];c.type!=="custom"&&(e[s]=c.serialize())}return e}hasTransitions(){var e,i,s;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((i=this.sky)===null||i===void 0)&&i.hasTransition()||!((s=this.projection)===null||s===void 0)&&s.hasTransition())return!0;for(const c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(i){const c=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(c.length||d.length)&&this._updateWorkerLayers(c,d);for(const g in this._updatedSources){const b=this._updatedSources[g];if(b==="reload")this._reloadSource(g);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(g)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const g in this._updatedPaintProps)this._layers[g].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const s={};for(const c in this.sourceCaches){const d=this.sourceCaches[c];s[c]=d.used,d.used=!1}for(const c of this._order){const d=this._layers[c];d.recalculate(e,this._availableImages),!d.isHidden(e.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const c in s){const d=this.sourceCaches[c];!!s[c]!=!!d.used&&d.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,i&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,i){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:i})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){var s;this._checkLoaded();const c=this.serialize();if(e=i.transformStyle?i.transformStyle(c,e):e,((s=i.validate)===null||s===void 0||s)&&Zr(this,a.u(e)))return!1;(e=a.bw(e)).layers=a.bu(e.layers);const d=a.bx(c,e),g=this._getOperationsToPerform(d);if(g.unimplemented.length>0)throw new Error(`Unimplemented: ${g.unimplemented.join(", ")}.`);if(g.operations.length===0)return!1;for(const b of g.operations)b();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const i=[],s=[];for(const c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":i.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":i.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":i.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":i.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":i.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":i.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":i.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":i.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":i.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":i.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":i.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":i.push(()=>this.setSprite.apply(this,c.args));break;case"setTerrain":i.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setSky":i.push(()=>this.setSky.apply(this,c.args));break;case"setProjection":this.setProjection.apply(this,c.args);break;case"setTransition":i.push(()=>{});break;default:s.push(c.command)}return{operations:i,unimplemented:s}}addImage(e,i){if(this.getImage(e))return this.fire(new a.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(e,i){this.imageManager.updateImage(e,i)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new a.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,s={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(a.u.source,`sources.${e}`,i,null,s))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const c=this.sourceCaches[e]=new U(e,i,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e})),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const s in this._layers)if(this._layers[s].source===e)return this.fire(new a.j(new Error(`Source "${e}" cannot be removed while layer "${s}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,i){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const s=this.sourceCaches[e].getSource();if(s.type!=="geojson")throw new Error(`geojsonSource.type is ${s.type}, which is !== 'geojson`);s.setData(i),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,i,s={}){this._checkLoaded();const c=e.id;if(this.getLayer(c))return void this.fire(new a.j(new Error(`Layer "${c}" already exists on this map.`)));let d;if(e.type==="custom"){if(Zr(this,a.by(e)))return;d=a.bv(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=a.bw(e),e=a.e(e,{source:c})),this._validate(a.u.layer,`layers.${c}`,e,{arrayIndex:-1},s))return;d=a.bv(e),this._validateLayer(d),d.setEventedParent(this,{layer:{id:c}})}const g=i?this._order.indexOf(i):this._order.length;if(i&&g===-1)this.fire(new a.j(new Error(`Cannot add layer "${c}" before non-existing layer "${i}".`)));else{if(this._order.splice(g,0,c),this._layerOrderChanged=!0,this._layers[c]=d,this._removedLayers[c]&&d.source&&d.type!=="custom"){const b=this._removedLayers[c];delete this._removedLayers[c],b.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new a.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const s=this._order.indexOf(e);this._order.splice(s,1);const c=i?this._order.indexOf(i):this._order.length;i&&c===-1?this.fire(new a.j(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const s=this._order.indexOf(e);this._order.splice(s,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,i,s){this._checkLoaded();const c=this.getLayer(e);c?c.minzoom===i&&c.maxzoom===s||(i!=null&&(c.minzoom=i),s!=null&&(c.maxzoom=s),this._updateLayer(c)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,s={}){this._checkLoaded();const c=this.getLayer(e);if(c){if(!a.bz(c.filter,i))return i==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(a.u.filter,`layers.${c.id}.filter`,i,null,s)||(c.filter=a.bw(i),this._updateLayer(c)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return a.bw(this.getLayer(e).filter)}setLayoutProperty(e,i,s,c={}){this._checkLoaded();const d=this.getLayer(e);d?a.bz(d.getLayoutProperty(i),s)||(d.setLayoutProperty(i,s,c),this._updateLayer(d)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const s=this.getLayer(e);if(s)return s.getLayoutProperty(i);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,s,c={}){this._checkLoaded();const d=this.getLayer(e);d?a.bz(d.getPaintProperty(i),s)||(d.setPaintProperty(i,s,c)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,i){return this.getLayer(e).getPaintProperty(i)}setFeatureState(e,i){this._checkLoaded();const s=e.source,c=e.sourceLayer,d=this.sourceCaches[s];if(d===void 0)return void this.fire(new a.j(new Error(`The source '${s}' does not exist in the map's style.`)));const g=d.getSource().type;g==="geojson"&&c?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):g!=="vector"||c?(e.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),d.setFeatureState(c,e.id,i)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const s=e.source,c=this.sourceCaches[s];if(c===void 0)return void this.fire(new a.j(new Error(`The source '${s}' does not exist in the map's style.`)));const d=c.getSource().type,g=d==="vector"?e.sourceLayer:void 0;d!=="vector"||g?i&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(g,e.id,i):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,s=e.sourceLayer,c=this.sourceCaches[i];if(c!==void 0)return c.getSource().type!=="vector"||s?(e.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(s,e.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=a.bA(this.sourceCaches,d=>d.serialize()),i=this._serializeByIds(this._order,!0),s=this.map.getTerrain()||void 0,c=this.stylesheet;return a.bB({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,projection:c.projection,sources:e,layers:i,terrain:s},d=>d!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const i=g=>this._layers[g].type==="fill-extrusion",s={},c=[];for(let g=this._order.length-1;g>=0;g--){const b=this._order[g];if(i(b)){s[b]=g;for(const P of e){const C=P[b];if(C)for(const z of C)c.push(z)}}}c.sort((g,b)=>b.intersectionZ-g.intersectionZ);const d=[];for(let g=this._order.length-1;g>=0;g--){const b=this._order[g];if(i(b))for(let P=c.length-1;P>=0;P--){const C=c[P].feature;if(s[C.layer.id]<g)break;d.push(C),c.pop()}else for(const P of e){const C=P[b];if(C)for(const z of C)d.push(z.feature)}}return d}queryRenderedFeatures(e,i,s){i&&i.filter&&this._validate(a.u.filter,"queryRenderedFeatures.filter",i.filter,null,i);const c={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new a.j(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const C of i.layers){const z=this._layers[C];if(!z)return this.fire(new a.j(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];c[z.source]=!0}}const d=[];i.availableImages=this._availableImages;const g=this._serializedAllLayers(),b=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,P=Object.assign(Object.assign({},i),{layers:b});for(const C in this.sourceCaches)i.layers&&!c[C]||d.push(gr(this.sourceCaches[C],this._layers,g,e,P,s));return this.placement&&d.push(function(C,z,R,B,V,Z,ne){const ie={},re=Z.queryRenderedSymbols(B),se=[];for(const ue of Object.keys(re).map(Number))se.push(ne[ue]);se.sort(Ji);for(const ue of se){const he=ue.featureIndex.lookupSymbolFeatures(re[ue.bucketInstanceId],z,ue.bucketIndex,ue.sourceLayerIndex,V.filter,V.layers,V.availableImages,C);for(const me in he){const ve=ie[me]=ie[me]||[],ye=he[me];ye.sort((ze,Le)=>{const Ve=ue.featureSortOrder;if(Ve){const He=Ve.indexOf(ze.featureIndex);return Ve.indexOf(Le.featureIndex)-He}return Le.featureIndex-ze.featureIndex});for(const ze of ye)ve.push(ze)}}return function(ue,he,me){for(const ve in ue)for(const ye of ue[ve])Ni(ye,me[he[ve].source]);return ue}(ie,C,R)}(this._layers,g,this.sourceCaches,e,P,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(e,i){i&&i.filter&&this._validate(a.u.filter,"querySourceFeatures.filter",i.filter,null,i);const s=this.sourceCaches[e];return s?function(c,d){const g=c.getRenderableIds().map(C=>c.getTileByID(C)),b=[],P={};for(let C=0;C<g.length;C++){const z=g[C],R=z.tileID.canonical.key;P[R]||(P[R]=!0,z.querySourceFeatures(b,d))}return b}(s,i):[]}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const s=this.light.getLight();let c=!1;for(const g in e)if(!a.bz(e[g],s[g])){c=!0;break}if(!c)return;const d={now:ge.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(d)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,i={}){this._checkLoaded();const s=this.getSky();let c=!1;if(!e&&!s)return;if(e&&!s)c=!0;else if(!e&&s)c=!0;else for(const g in e)if(!a.bz(e[g],s[g])){c=!0;break}if(!c)return;const d={now:ge.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,i),this.sky.updateTransitions(d)}_setProjectionInternal(e){const i=function(s){if(Array.isArray(s)){const c=new Vl({type:s});return{projection:c,transform:new qn,cameraHelper:new va(c)}}switch(s){case"mercator":return{projection:new $s,transform:new Oo,cameraHelper:new $l};case"globe":{const c=new Vl({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:c,transform:new qn,cameraHelper:new va(c)}}case"vertical-perspective":return{projection:new Gu,transform:new Zl,cameraHelper:new Gr};default:return a.w(`Unknown projection name: ${s}. Falling back to mercator projection.`),{projection:new $s,transform:new Oo,cameraHelper:new $l}}}(e);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(const s in this.sourceCaches)this.sourceCaches[s].reload()}_validate(e,i,s,c,d={}){return(!d||d.validate!==!1)&&Zr(this,e.call(a.u,a.e({key:i,style:this.serialize(),value:s,styleSpec:a.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),en().off(Bn,this._rtlPluginLoaded);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this.sourceCaches){const s=this.sourceCaches[i];s.setEventedParent(null),s.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const i in this.sourceCaches)this.sourceCaches[i].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,i,s,c,d=!1){let g=!1,b=!1;const P={};for(const C of this._order){const z=this._layers[C];if(z.type!=="symbol")continue;if(!P[z.source]){const B=this.sourceCaches[z.source];P[z.source]=B.getRenderableIds(!0).map(V=>B.getTileByID(V)).sort((V,Z)=>Z.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(Z.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(z,P[z.source],e.center.lng);g=g||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||s===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ge.now(),e.zoom))&&(this.pauseablePlacement=new Wc(e,this.map.terrain,this._order,d,i,s,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ge.now()),b=!0),g&&this.pauseablePlacement.placement.setStale()),b||g)for(const C of this._order){const z=this._layers[C];z.type==="symbol"&&this.placement.updateLayerOpacities(z,P[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ge.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,i){return a._(this,void 0,void 0,function*(){const s=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[i.source];return c&&c.setDependencies(i.tileID.key,i.type,i.icons),s})}getGlyphs(e,i){return a._(this,void 0,void 0,function*(){const s=yield this.glyphManager.getGlyphs(i.stacks),c=this.sourceCaches[i.source];return c&&c.setDependencies(i.tileID.key,i.type,[""]),s})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(a.u.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,s={},c){this._checkLoaded();const d=[{id:e,url:i}],g=[...Xe(this.stylesheet.sprite),...d];this._validate(a.u.sprite,"sprite",g,null,s)||(this.stylesheet.sprite=g,this._loadSprite(d,!0,c))}removeSprite(e){this._checkLoaded();const i=Xe(this.stylesheet.sprite);if(i.find(s=>s.id===e)){if(this._spritesImagesIds[e])for(const s of this._spritesImagesIds[e])this.imageManager.removeImage(s),this._changedImages[s]=!0;i.splice(i.findIndex(s=>s.id===e),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Xe(this.stylesheet.sprite)}setSprite(e,i={},s){this._checkLoaded(),e&&this._validate(a.u.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,s):(this._unloadSprite(),s&&s(null)))}}var rn=a.aA([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class jo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,i,s,c,d,g,b,P,C){this.context=e;let z=this.boundPaintVertexBuffers.length!==c.length;for(let R=0;!z&&R<c.length;R++)this.boundPaintVertexBuffers[R]!==c[R]&&(z=!0);!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==s||z||this.boundIndexBuffer!==d||this.boundVertexOffset!==g||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==P||this.boundDynamicVertexBuffer3!==C?this.freshBind(i,s,c,d,g,b,P,C):(e.bindVertexArray.set(this.vao),b&&b.bind(),d&&d.dynamicDraw&&d.bind(),P&&P.bind(),C&&C.bind())}freshBind(e,i,s,c,d,g,b,P){const C=e.numAttributes,z=this.context,R=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=s,this.boundIndexBuffer=c,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=g,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=P,i.enableAttributes(R,e);for(const B of s)B.enableAttributes(R,e);g&&g.enableAttributes(R,e),b&&b.enableAttributes(R,e),P&&P.enableAttributes(R,e),i.bind(),i.setVertexAttribPointers(R,e,d);for(const B of s)B.bind(),B.setVertexAttribPointers(R,e,d);g&&(g.bind(),g.setVertexAttribPointers(R,e,d)),c&&c.bind(),b&&(b.bind(),b.setVertexAttribPointers(R,e,d)),P&&(P.bind(),P.setVertexAttribPointers(R,e,d)),z.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Us=(p,e,i,s,c)=>({u_texture:0,u_ele_delta:p,u_fog_matrix:e,u_fog_color:i?i.properties.get("fog-color"):a.b4.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:c?0:i?i.calculateFogBlendOpacity(s):0,u_horizon_color:i?i.properties.get("horizon-color"):a.b4.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:c?1:0}),il={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ba(p){const e=[];for(let i=0;i<p.length;i++){if(p[i]===null)continue;const s=p[i].split(" ");e.push(s.pop())}return e}class ql{constructor(e,i,s,c,d,g,b,P){const C=e.gl;this.program=C.createProgram();const z=ba(i.staticAttributes),R=s?s.getBinderAttributes():[],B=z.concat(R),V=Bo.prelude.staticUniforms?ba(Bo.prelude.staticUniforms):[],Z=b.staticUniforms?ba(b.staticUniforms):[],ne=i.staticUniforms?ba(i.staticUniforms):[],ie=s?s.getBinderUniforms():[],re=V.concat(Z).concat(ne).concat(ie),se=[];for(const Le of re)se.indexOf(Le)<0&&se.push(Le);const ue=s?s.defines():[];pi(C)&&ue.unshift("#version 300 es"),d&&ue.push("#define OVERDRAW_INSPECTOR;"),g&&ue.push("#define TERRAIN3D;"),P&&ue.push(P);let he=ue.concat(Bo.prelude.fragmentSource,b.fragmentSource,i.fragmentSource).join(`
`),me=ue.concat(Bo.prelude.vertexSource,b.vertexSource,i.vertexSource).join(`
`);pi(C)||(he=function(Le){return Le.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(he),me=function(Le){return Le.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(me));const ve=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(ve,he),C.compileShader(ve),!C.getShaderParameter(ve,C.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${C.getShaderInfoLog(ve)}`);C.attachShader(this.program,ve);const ye=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(ye,me),C.compileShader(ye),!C.getShaderParameter(ye,C.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${C.getShaderInfoLog(ye)}`);C.attachShader(this.program,ye),this.attributes={};const ze={};this.numAttributes=B.length;for(let Le=0;Le<this.numAttributes;Le++)B[Le]&&(C.bindAttribLocation(this.program,Le,B[Le]),this.attributes[B[Le]]=Le);if(C.linkProgram(this.program),!C.getProgramParameter(this.program,C.LINK_STATUS))throw new Error(`Program failed to link: ${C.getProgramInfoLog(this.program)}`);C.deleteShader(ye),C.deleteShader(ve);for(let Le=0;Le<se.length;Le++){const Ve=se[Le];if(Ve&&!ze[Ve]){const He=C.getUniformLocation(this.program,Ve);He&&(ze[Ve]=He)}}this.fixedUniforms=c(e,ze),this.terrainUniforms=((Le,Ve)=>({u_depth:new a.bC(Le,Ve.u_depth),u_terrain:new a.bC(Le,Ve.u_terrain),u_terrain_dim:new a.b5(Le,Ve.u_terrain_dim),u_terrain_matrix:new a.bD(Le,Ve.u_terrain_matrix),u_terrain_unpack:new a.bE(Le,Ve.u_terrain_unpack),u_terrain_exaggeration:new a.b5(Le,Ve.u_terrain_exaggeration)}))(e,ze),this.projectionUniforms=((Le,Ve)=>({u_projection_matrix:new a.bD(Le,Ve.u_projection_matrix),u_projection_tile_mercator_coords:new a.bE(Le,Ve.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.bE(Le,Ve.u_projection_clipping_plane),u_projection_transition:new a.b5(Le,Ve.u_projection_transition),u_projection_fallback_matrix:new a.bD(Le,Ve.u_projection_fallback_matrix)}))(e,ze),this.binderUniforms=s?s.getUniforms(e,ze):[]}draw(e,i,s,c,d,g,b,P,C,z,R,B,V,Z,ne,ie,re,se,ue){const he=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(s),e.setStencilMode(c),e.setColorMode(d),e.setCullFace(g),P){e.activeTexture.set(he.TEXTURE2),he.bindTexture(he.TEXTURE_2D,P.depthTexture),e.activeTexture.set(he.TEXTURE3),he.bindTexture(he.TEXTURE_2D,P.texture);for(const ve in this.terrainUniforms)this.terrainUniforms[ve].set(P[ve])}if(C)for(const ve in C)this.projectionUniforms[il[ve]].set(C[ve]);if(b)for(const ve in this.fixedUniforms)this.fixedUniforms[ve].set(b[ve]);ie&&ie.setUniforms(e,this.binderUniforms,Z,{zoom:ne});let me=0;switch(i){case he.LINES:me=2;break;case he.TRIANGLES:me=3;break;case he.LINE_STRIP:me=1}for(const ve of V.get()){const ye=ve.vaos||(ve.vaos={});(ye[z]||(ye[z]=new jo)).bind(e,this,R,ie?ie.getPaintVertexBuffers():[],B,ve.vertexOffset,re,se,ue),he.drawElements(i,ve.primitiveLength*me,he.UNSIGNED_SHORT,ve.primitiveOffset*me*2)}}}function Hu(p,e,i){const s=1/a.at(i,1,e.transform.tileZoom),c=Math.pow(2,i.tileID.overscaledZ),d=i.tileSize*Math.pow(2,e.transform.tileZoom)/c,g=d*(i.tileID.canonical.x+i.tileID.wrap*c),b=d*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[s,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[g>>16,b>>16],u_pixel_coord_lower:[65535&g,65535&b]}}const Gs=(p,e,i,s)=>{const c=p.style.light,d=c.properties.get("position"),g=[d.x,d.y,d.z],b=a.bI();c.properties.get("anchor")==="viewport"&&a.bJ(b,p.transform.bearingInRadians),a.bK(g,g,b);const P=p.transform.transformLightDirection(g),C=c.properties.get("color");return{u_lightpos:g,u_lightpos_globe:P,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+e,u_opacity:i,u_fill_translate:s}},Wu=(p,e,i,s,c,d,g)=>a.e(Gs(p,e,i,s),Hu(d,p,g),{u_height_factor:-Math.pow(2,c.overscaledZ)/g.tileSize/8}),wa=(p,e,i,s)=>a.e(Hu(e,p,i),{u_fill_translate:s}),Ta=(p,e)=>({u_world:p,u_fill_translate:e}),Xu=(p,e,i,s,c)=>a.e(wa(p,e,i,c),{u_world:s}),Hl=(p,e,i,s,c)=>{const d=p.transform;let g,b,P=0;if(i.paint.get("circle-pitch-alignment")==="map"){const C=a.at(e,1,d.zoom);g=!0,b=[C,C],P=C/(a.X*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*c}else g=!1,b=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(i.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+g,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:b,u_globe_extrude_scale:P,u_translate:s}},eu=p=>({u_pixel_extrude_scale:[1/p.width,1/p.height]}),Wl=p=>({u_viewport_size:[p.width,p.height]}),nl=(p,e=1)=>({u_color:p,u_overlay:0,u_overlay_scale:e}),Xl=(p,e,i,s)=>{const c=a.at(p,1,e)/(a.X*Math.pow(2,p.tileID.overscaledZ))*2*Math.PI*s;return{u_extrude_scale:a.at(p,1,e),u_intensity:i,u_globe_extrude_scale:c}},xs=(p,e,i,s)=>{const c=a.H();a.bL(c,0,p.width,p.height,0,0,1);const d=p.context.gl;return{u_matrix:c,u_world:[d.drawingBufferWidth,d.drawingBufferHeight],u_image:i,u_color_ramp:s,u_opacity:e.paint.get("heatmap-opacity")}},Kl=(p,e,i)=>{const s=i.paint.get("hillshade-shadow-color"),c=i.paint.get("hillshade-highlight-color"),d=i.paint.get("hillshade-accent-color");let g=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);return i.paint.get("hillshade-illumination-anchor")==="viewport"&&(g+=p.transform.bearingInRadians),{u_image:0,u_latrange:rl(0,e.tileID),u_light:[i.paint.get("hillshade-exaggeration"),g],u_shadow:s,u_highlight:c,u_accent:d}},Yl=(p,e)=>{const i=e.stride,s=a.H();return a.bL(s,0,a.X,-8192,0,0,1),a.J(s,s,[0,-8192,0]),{u_matrix:s,u_image:1,u_dimension:[i,i],u_zoom:p.overscaledZ,u_unpack:e.getUnpackVector()}};function rl(p,e){const i=Math.pow(2,e.canonical.z),s=e.canonical.y;return[new a.Y(0,s/i).toLngLat().lat,new a.Y(0,(s+1)/i).toLngLat().lat]}const Jl=(p,e,i,s)=>{const c=p.transform;return{u_translation:ec(p,e,i),u_ratio:s/a.at(e,1,c.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},hr=(p,e,i,s,c)=>a.e(Jl(p,e,i,s),{u_image:0,u_image_height:c}),tu=(p,e,i,s,c)=>{const d=p.transform,g=Ql(e,d);return{u_translation:ec(p,e,i),u_texsize:e.imageAtlasTexture.size,u_ratio:s/a.at(e,1,d.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[g,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},ol=(p,e,i,s,c,d)=>{const g=p.lineAtlas,b=Ql(e,p.transform),P=i.layout.get("line-cap")==="round",C=g.getDash(c.from,P),z=g.getDash(c.to,P),R=C.width*d.fromScale,B=z.width*d.toScale;return a.e(Jl(p,e,i,s),{u_patternscale_a:[b/R,-C.height/2],u_patternscale_b:[b/B,-z.height/2],u_sdfgamma:g.width/(256*Math.min(R,B)*p.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:z.y,u_mix:d.t})};function Ql(p,e){return 1/a.at(p,1,e.tileZoom)}function ec(p,e,i){return a.au(p.transform,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Ku=(p,e,i,s,c)=>{return{u_tl_parent:p,u_scale_parent:e,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*s.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:s.paint.get("raster-brightness-min"),u_brightness_high:s.paint.get("raster-brightness-max"),u_saturation_factor:(g=s.paint.get("raster-saturation"),g>0?1-1/(1.001-g):-g),u_contrast_factor:(d=s.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:iu(s.paint.get("raster-hue-rotate")),u_coords_top:[c[0].x,c[0].y,c[1].x,c[1].y],u_coords_bottom:[c[3].x,c[3].y,c[2].x,c[2].y]};var d,g};function iu(p){p*=Math.PI/180;const e=Math.sin(p),i=Math.cos(p);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const nu=(p,e,i,s,c,d,g,b,P,C,z,R,B)=>{const V=g.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:V.width/V.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_label_plane_matrix:b,u_coord_matrix:P,u_is_text:+z,u_pitch_with_map:+s,u_is_along_line:c,u_is_variable_anchor:d,u_texsize:R,u_texture:0,u_translation:C,u_pitched_scale:B}},sl=(p,e,i,s,c,d,g,b,P,C,z,R,B,V)=>{const Z=g.transform;return a.e(nu(p,e,i,s,c,d,g,b,P,C,z,R,V),{u_gamma_scale:s?Math.cos(Z.pitch*Math.PI/180)*Z.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:1})},is=(p,e,i,s,c,d,g,b,P,C,z,R,B)=>a.e(sl(p,e,i,s,c,d,g,b,P,C,!0,z,0,B),{u_texsize_icon:R,u_texture_icon:1}),bs=(p,e)=>({u_opacity:p,u_color:e}),ru=(p,e,i,s,c)=>a.e(function(d,g,b,P){const C=b.imageManager.getPattern(d.from.toString()),z=b.imageManager.getPattern(d.to.toString()),{width:R,height:B}=b.imageManager.getPixelSize(),V=Math.pow(2,P.tileID.overscaledZ),Z=P.tileSize*Math.pow(2,b.transform.tileZoom)/V,ne=Z*(P.tileID.canonical.x+P.tileID.wrap*V),ie=Z*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[R,B],u_mix:g.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:g.fromScale,u_scale_b:g.toScale,u_tile_units_to_pixels:1/a.at(P,1,b.transform.tileZoom),u_pixel_coord_upper:[ne>>16,ie>>16],u_pixel_coord_lower:[65535&ne,65535&ie]}}(i,c,e,s),{u_opacity:p}),tc=(p,e)=>{},ic={fillExtrusion:(p,e)=>({u_lightpos:new a.bG(p,e.u_lightpos),u_lightpos_globe:new a.bG(p,e.u_lightpos_globe),u_lightintensity:new a.b5(p,e.u_lightintensity),u_lightcolor:new a.bG(p,e.u_lightcolor),u_vertical_gradient:new a.b5(p,e.u_vertical_gradient),u_opacity:new a.b5(p,e.u_opacity),u_fill_translate:new a.bH(p,e.u_fill_translate)}),fillExtrusionPattern:(p,e)=>({u_lightpos:new a.bG(p,e.u_lightpos),u_lightpos_globe:new a.bG(p,e.u_lightpos_globe),u_lightintensity:new a.b5(p,e.u_lightintensity),u_lightcolor:new a.bG(p,e.u_lightcolor),u_vertical_gradient:new a.b5(p,e.u_vertical_gradient),u_height_factor:new a.b5(p,e.u_height_factor),u_opacity:new a.b5(p,e.u_opacity),u_fill_translate:new a.bH(p,e.u_fill_translate),u_image:new a.bC(p,e.u_image),u_texsize:new a.bH(p,e.u_texsize),u_pixel_coord_upper:new a.bH(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bH(p,e.u_pixel_coord_lower),u_scale:new a.bG(p,e.u_scale),u_fade:new a.b5(p,e.u_fade)}),fill:(p,e)=>({u_fill_translate:new a.bH(p,e.u_fill_translate)}),fillPattern:(p,e)=>({u_image:new a.bC(p,e.u_image),u_texsize:new a.bH(p,e.u_texsize),u_pixel_coord_upper:new a.bH(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bH(p,e.u_pixel_coord_lower),u_scale:new a.bG(p,e.u_scale),u_fade:new a.b5(p,e.u_fade),u_fill_translate:new a.bH(p,e.u_fill_translate)}),fillOutline:(p,e)=>({u_world:new a.bH(p,e.u_world),u_fill_translate:new a.bH(p,e.u_fill_translate)}),fillOutlinePattern:(p,e)=>({u_world:new a.bH(p,e.u_world),u_image:new a.bC(p,e.u_image),u_texsize:new a.bH(p,e.u_texsize),u_pixel_coord_upper:new a.bH(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bH(p,e.u_pixel_coord_lower),u_scale:new a.bG(p,e.u_scale),u_fade:new a.b5(p,e.u_fade),u_fill_translate:new a.bH(p,e.u_fill_translate)}),circle:(p,e)=>({u_camera_to_center_distance:new a.b5(p,e.u_camera_to_center_distance),u_scale_with_map:new a.bC(p,e.u_scale_with_map),u_pitch_with_map:new a.bC(p,e.u_pitch_with_map),u_extrude_scale:new a.bH(p,e.u_extrude_scale),u_device_pixel_ratio:new a.b5(p,e.u_device_pixel_ratio),u_globe_extrude_scale:new a.b5(p,e.u_globe_extrude_scale),u_translate:new a.bH(p,e.u_translate)}),collisionBox:(p,e)=>({u_pixel_extrude_scale:new a.bH(p,e.u_pixel_extrude_scale)}),collisionCircle:(p,e)=>({u_viewport_size:new a.bH(p,e.u_viewport_size)}),debug:(p,e)=>({u_color:new a.bF(p,e.u_color),u_overlay:new a.bC(p,e.u_overlay),u_overlay_scale:new a.b5(p,e.u_overlay_scale)}),depth:tc,clippingMask:tc,heatmap:(p,e)=>({u_extrude_scale:new a.b5(p,e.u_extrude_scale),u_intensity:new a.b5(p,e.u_intensity),u_globe_extrude_scale:new a.b5(p,e.u_globe_extrude_scale)}),heatmapTexture:(p,e)=>({u_matrix:new a.bD(p,e.u_matrix),u_world:new a.bH(p,e.u_world),u_image:new a.bC(p,e.u_image),u_color_ramp:new a.bC(p,e.u_color_ramp),u_opacity:new a.b5(p,e.u_opacity)}),hillshade:(p,e)=>({u_image:new a.bC(p,e.u_image),u_latrange:new a.bH(p,e.u_latrange),u_light:new a.bH(p,e.u_light),u_shadow:new a.bF(p,e.u_shadow),u_highlight:new a.bF(p,e.u_highlight),u_accent:new a.bF(p,e.u_accent)}),hillshadePrepare:(p,e)=>({u_matrix:new a.bD(p,e.u_matrix),u_image:new a.bC(p,e.u_image),u_dimension:new a.bH(p,e.u_dimension),u_zoom:new a.b5(p,e.u_zoom),u_unpack:new a.bE(p,e.u_unpack)}),line:(p,e)=>({u_translation:new a.bH(p,e.u_translation),u_ratio:new a.b5(p,e.u_ratio),u_device_pixel_ratio:new a.b5(p,e.u_device_pixel_ratio),u_units_to_pixels:new a.bH(p,e.u_units_to_pixels)}),lineGradient:(p,e)=>({u_translation:new a.bH(p,e.u_translation),u_ratio:new a.b5(p,e.u_ratio),u_device_pixel_ratio:new a.b5(p,e.u_device_pixel_ratio),u_units_to_pixels:new a.bH(p,e.u_units_to_pixels),u_image:new a.bC(p,e.u_image),u_image_height:new a.b5(p,e.u_image_height)}),linePattern:(p,e)=>({u_translation:new a.bH(p,e.u_translation),u_texsize:new a.bH(p,e.u_texsize),u_ratio:new a.b5(p,e.u_ratio),u_device_pixel_ratio:new a.b5(p,e.u_device_pixel_ratio),u_image:new a.bC(p,e.u_image),u_units_to_pixels:new a.bH(p,e.u_units_to_pixels),u_scale:new a.bG(p,e.u_scale),u_fade:new a.b5(p,e.u_fade)}),lineSDF:(p,e)=>({u_translation:new a.bH(p,e.u_translation),u_ratio:new a.b5(p,e.u_ratio),u_device_pixel_ratio:new a.b5(p,e.u_device_pixel_ratio),u_units_to_pixels:new a.bH(p,e.u_units_to_pixels),u_patternscale_a:new a.bH(p,e.u_patternscale_a),u_patternscale_b:new a.bH(p,e.u_patternscale_b),u_sdfgamma:new a.b5(p,e.u_sdfgamma),u_image:new a.bC(p,e.u_image),u_tex_y_a:new a.b5(p,e.u_tex_y_a),u_tex_y_b:new a.b5(p,e.u_tex_y_b),u_mix:new a.b5(p,e.u_mix)}),raster:(p,e)=>({u_tl_parent:new a.bH(p,e.u_tl_parent),u_scale_parent:new a.b5(p,e.u_scale_parent),u_buffer_scale:new a.b5(p,e.u_buffer_scale),u_fade_t:new a.b5(p,e.u_fade_t),u_opacity:new a.b5(p,e.u_opacity),u_image0:new a.bC(p,e.u_image0),u_image1:new a.bC(p,e.u_image1),u_brightness_low:new a.b5(p,e.u_brightness_low),u_brightness_high:new a.b5(p,e.u_brightness_high),u_saturation_factor:new a.b5(p,e.u_saturation_factor),u_contrast_factor:new a.b5(p,e.u_contrast_factor),u_spin_weights:new a.bG(p,e.u_spin_weights),u_coords_top:new a.bE(p,e.u_coords_top),u_coords_bottom:new a.bE(p,e.u_coords_bottom)}),symbolIcon:(p,e)=>({u_is_size_zoom_constant:new a.bC(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bC(p,e.u_is_size_feature_constant),u_size_t:new a.b5(p,e.u_size_t),u_size:new a.b5(p,e.u_size),u_camera_to_center_distance:new a.b5(p,e.u_camera_to_center_distance),u_pitch:new a.b5(p,e.u_pitch),u_rotate_symbol:new a.bC(p,e.u_rotate_symbol),u_aspect_ratio:new a.b5(p,e.u_aspect_ratio),u_fade_change:new a.b5(p,e.u_fade_change),u_label_plane_matrix:new a.bD(p,e.u_label_plane_matrix),u_coord_matrix:new a.bD(p,e.u_coord_matrix),u_is_text:new a.bC(p,e.u_is_text),u_pitch_with_map:new a.bC(p,e.u_pitch_with_map),u_is_along_line:new a.bC(p,e.u_is_along_line),u_is_variable_anchor:new a.bC(p,e.u_is_variable_anchor),u_texsize:new a.bH(p,e.u_texsize),u_texture:new a.bC(p,e.u_texture),u_translation:new a.bH(p,e.u_translation),u_pitched_scale:new a.b5(p,e.u_pitched_scale)}),symbolSDF:(p,e)=>({u_is_size_zoom_constant:new a.bC(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bC(p,e.u_is_size_feature_constant),u_size_t:new a.b5(p,e.u_size_t),u_size:new a.b5(p,e.u_size),u_camera_to_center_distance:new a.b5(p,e.u_camera_to_center_distance),u_pitch:new a.b5(p,e.u_pitch),u_rotate_symbol:new a.bC(p,e.u_rotate_symbol),u_aspect_ratio:new a.b5(p,e.u_aspect_ratio),u_fade_change:new a.b5(p,e.u_fade_change),u_label_plane_matrix:new a.bD(p,e.u_label_plane_matrix),u_coord_matrix:new a.bD(p,e.u_coord_matrix),u_is_text:new a.bC(p,e.u_is_text),u_pitch_with_map:new a.bC(p,e.u_pitch_with_map),u_is_along_line:new a.bC(p,e.u_is_along_line),u_is_variable_anchor:new a.bC(p,e.u_is_variable_anchor),u_texsize:new a.bH(p,e.u_texsize),u_texture:new a.bC(p,e.u_texture),u_gamma_scale:new a.b5(p,e.u_gamma_scale),u_device_pixel_ratio:new a.b5(p,e.u_device_pixel_ratio),u_is_halo:new a.bC(p,e.u_is_halo),u_translation:new a.bH(p,e.u_translation),u_pitched_scale:new a.b5(p,e.u_pitched_scale)}),symbolTextAndIcon:(p,e)=>({u_is_size_zoom_constant:new a.bC(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bC(p,e.u_is_size_feature_constant),u_size_t:new a.b5(p,e.u_size_t),u_size:new a.b5(p,e.u_size),u_camera_to_center_distance:new a.b5(p,e.u_camera_to_center_distance),u_pitch:new a.b5(p,e.u_pitch),u_rotate_symbol:new a.bC(p,e.u_rotate_symbol),u_aspect_ratio:new a.b5(p,e.u_aspect_ratio),u_fade_change:new a.b5(p,e.u_fade_change),u_label_plane_matrix:new a.bD(p,e.u_label_plane_matrix),u_coord_matrix:new a.bD(p,e.u_coord_matrix),u_is_text:new a.bC(p,e.u_is_text),u_pitch_with_map:new a.bC(p,e.u_pitch_with_map),u_is_along_line:new a.bC(p,e.u_is_along_line),u_is_variable_anchor:new a.bC(p,e.u_is_variable_anchor),u_texsize:new a.bH(p,e.u_texsize),u_texsize_icon:new a.bH(p,e.u_texsize_icon),u_texture:new a.bC(p,e.u_texture),u_texture_icon:new a.bC(p,e.u_texture_icon),u_gamma_scale:new a.b5(p,e.u_gamma_scale),u_device_pixel_ratio:new a.b5(p,e.u_device_pixel_ratio),u_is_halo:new a.bC(p,e.u_is_halo),u_translation:new a.bH(p,e.u_translation),u_pitched_scale:new a.b5(p,e.u_pitched_scale)}),background:(p,e)=>({u_opacity:new a.b5(p,e.u_opacity),u_color:new a.bF(p,e.u_color)}),backgroundPattern:(p,e)=>({u_opacity:new a.b5(p,e.u_opacity),u_image:new a.bC(p,e.u_image),u_pattern_tl_a:new a.bH(p,e.u_pattern_tl_a),u_pattern_br_a:new a.bH(p,e.u_pattern_br_a),u_pattern_tl_b:new a.bH(p,e.u_pattern_tl_b),u_pattern_br_b:new a.bH(p,e.u_pattern_br_b),u_texsize:new a.bH(p,e.u_texsize),u_mix:new a.b5(p,e.u_mix),u_pattern_size_a:new a.bH(p,e.u_pattern_size_a),u_pattern_size_b:new a.bH(p,e.u_pattern_size_b),u_scale_a:new a.b5(p,e.u_scale_a),u_scale_b:new a.b5(p,e.u_scale_b),u_pixel_coord_upper:new a.bH(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bH(p,e.u_pixel_coord_lower),u_tile_units_to_pixels:new a.b5(p,e.u_tile_units_to_pixels)}),terrain:(p,e)=>({u_texture:new a.bC(p,e.u_texture),u_ele_delta:new a.b5(p,e.u_ele_delta),u_fog_matrix:new a.bD(p,e.u_fog_matrix),u_fog_color:new a.bF(p,e.u_fog_color),u_fog_ground_blend:new a.b5(p,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.b5(p,e.u_fog_ground_blend_opacity),u_horizon_color:new a.bF(p,e.u_horizon_color),u_horizon_fog_blend:new a.b5(p,e.u_horizon_fog_blend),u_is_globe_mode:new a.b5(p,e.u_is_globe_mode)}),terrainDepth:(p,e)=>({u_ele_delta:new a.b5(p,e.u_ele_delta)}),terrainCoords:(p,e)=>({u_texture:new a.bC(p,e.u_texture),u_terrain_coords_id:new a.b5(p,e.u_terrain_coords_id),u_ele_delta:new a.b5(p,e.u_ele_delta)}),projectionErrorMeasurement:(p,e)=>({u_input:new a.b5(p,e.u_input),u_output_expected:new a.b5(p,e.u_output_expected)}),atmosphere:(p,e)=>({u_sun_pos:new a.bG(p,e.u_sun_pos),u_atmosphere_blend:new a.b5(p,e.u_atmosphere_blend),u_globe_position:new a.bG(p,e.u_globe_position),u_globe_radius:new a.b5(p,e.u_globe_radius),u_inv_proj_matrix:new a.bD(p,e.u_inv_proj_matrix)}),sky:(p,e)=>({u_sky_color:new a.bF(p,e.u_sky_color),u_horizon_color:new a.bF(p,e.u_horizon_color),u_horizon:new a.bH(p,e.u_horizon),u_horizon_normal:new a.bH(p,e.u_horizon_normal),u_sky_horizon_blend:new a.b5(p,e.u_sky_horizon_blend),u_sky_blend:new a.b5(p,e.u_sky_blend)})};class nc{constructor(e,i,s){this.context=e;const c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!s,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const i=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ar={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Sa{constructor(e,i,s,c){this.length=i.length,this.attributes=s,this.itemSize=i.bytesPerElement,this.dynamicDraw=c,this.context=e;const d=e.gl;this.buffer=d.createBuffer(),e.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,i){for(let s=0;s<this.attributes.length;s++){const c=i.attributes[this.attributes[s].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,i,s){for(let c=0;c<this.attributes.length;c++){const d=this.attributes[c],g=i.attributes[d.name];g!==void 0&&e.vertexAttribPointer(g,d.components,e[Ar[d.type]],!1,this.itemSize,d.offset+this.itemSize*(s||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ep extends vi{getDefault(){return a.b4.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class tp extends vi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Pa extends vi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class no extends vi{getDefault(){return[!0,!0,!0,!0]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Yu extends vi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Ju extends vi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class rc extends vi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const i=this.current;(e.func!==i.func||e.ref!==i.ref||e.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class oc extends vi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class sc extends vi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=e,this.dirty=!1}}class ou extends vi{getDefault(){return[0,1]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ro extends vi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=e,this.dirty=!1}}class Ce extends vi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ze extends vi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.BLEND):i.disable(i.BLEND),this.current=e,this.dirty=!1}}class $e extends vi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class At extends vi{getDefault(){return a.b4.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Vt extends vi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ci extends vi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=e,this.dirty=!1}}class dn extends vi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ai extends vi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Zs extends vi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class ac extends vi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class qr extends vi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ns extends vi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Ma extends vi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class qs extends vi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Ca extends vi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ai extends vi{getDefault(){return null}set(e){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class xi extends vi{getDefault(){return null}set(e){var i;if(e===this.current&&!this.dirty)return;const s=this.gl;pi(s)?s.bindVertexArray(e):(i=s.getExtension("OES_vertex_array_object"))===null||i===void 0||i.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class ip extends vi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class su extends vi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class ws extends vi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class au extends vi{constructor(e,i){super(e),this.context=e,this.parent=i}getDefault(){return null}}class np extends au{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Qu extends au{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class lc extends au{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const yo="Framebuffer is not complete";class Hs{constructor(e,i,s,c,d){this.context=e,this.width=i,this.height=s;const g=e.gl,b=this.framebuffer=g.createFramebuffer();if(this.colorAttachment=new np(e,b),c)this.depthAttachment=d?new lc(e,b):new Qu(e,b);else if(d)throw new Error("Stencil cannot be set without depth");if(g.checkFramebufferStatus(g.FRAMEBUFFER)!==g.FRAMEBUFFER_COMPLETE)throw new Error(yo)}destroy(){const e=this.context.gl,i=this.colorAttachment.get();if(i&&e.deleteTexture(i),this.depthAttachment){const s=this.depthAttachment.get();s&&e.deleteRenderbuffer(s)}e.deleteFramebuffer(this.framebuffer)}}class al{constructor(e){var i,s;if(this.gl=e,this.clearColor=new ep(this),this.clearDepth=new tp(this),this.clearStencil=new Pa(this),this.colorMask=new no(this),this.depthMask=new Yu(this),this.stencilMask=new Ju(this),this.stencilFunc=new rc(this),this.stencilOp=new oc(this),this.stencilTest=new sc(this),this.depthRange=new ou(this),this.depthTest=new ro(this),this.depthFunc=new Ce(this),this.blend=new Ze(this),this.blendFunc=new $e(this),this.blendColor=new At(this),this.blendEquation=new Vt(this),this.cullFace=new ci(this),this.cullFaceSide=new dn(this),this.frontFace=new Ai(this),this.program=new Zs(this),this.activeTexture=new ac(this),this.viewport=new qr(this),this.bindFramebuffer=new ns(this),this.bindRenderbuffer=new Ma(this),this.bindTexture=new qs(this),this.bindVertexBuffer=new Ca(this),this.bindElementBuffer=new ai(this),this.bindVertexArray=new xi(this),this.pixelStoreUnpack=new ip(this),this.pixelStoreUnpackPremultiplyAlpha=new su(this),this.pixelStoreUnpackFlipY=new ws(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),pi(e)){this.HALF_FLOAT=e.HALF_FLOAT;const c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(i=e.RGBA16F)!==null&&i!==void 0?i:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(s=e.RGB16F)!==null&&s!==void 0?s:c==null?void 0:c.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i){return new nc(this,e,i)}createVertexBuffer(e,i,s){return new Sa(this,e,i,s)}createRenderbuffer(e,i,s){const c=this.gl,d=c.createRenderbuffer();return this.bindRenderbuffer.set(d),c.renderbufferStorage(c.RENDERBUFFER,e,i,s),this.bindRenderbuffer.set(null),d}createFramebuffer(e,i,s,c){return new Hs(this,e,i,s,c)}clear({color:e,depth:i,stencil:s}){const c=this.gl;let d=0;e&&(d|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(d|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),s!==void 0&&(d|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(s),this.stencilMask.set(255)),c.clear(d)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){a.bz(e.blendFunction,Li.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return pi(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var i;return pi(this.gl)?this.gl.deleteVertexArray(e):(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let rs;function ll(p,e,i,s,c){const d=p.context,g=p.transform,b=d.gl,P=p.useProgram("collisionBox"),C=[];let z=0,R=0;for(let re=0;re<s.length;re++){const se=s[re],ue=e.getTile(se).getBucket(i);if(!ue)continue;const he=c?ue.textCollisionBox:ue.iconCollisionBox,me=ue.collisionCircleArray;me.length>0&&(C.push({circleArray:me,circleOffset:R,coord:se}),z+=me.length/4,R=z),he&&P.draw(d,b.LINES,Ht.disabled,hi.disabled,p.colorModeForRenderPass(),li.disabled,eu(p.transform),p.style.map.terrain&&p.style.map.terrain.getTerrainData(se),g.getProjectionData({overscaledTileID:se,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,null,p.transform.zoom,null,null,he.collisionVertexBuffer)}if(!c||!C.length)return;const B=p.useProgram("collisionCircle"),V=new a.bM;V.resize(4*z),V._trim();let Z=0;for(const re of C)for(let se=0;se<re.circleArray.length/4;se++){const ue=4*se,he=re.circleArray[ue+0],me=re.circleArray[ue+1],ve=re.circleArray[ue+2],ye=re.circleArray[ue+3];V.emplace(Z++,he,me,ve,ye,0),V.emplace(Z++,he,me,ve,ye,1),V.emplace(Z++,he,me,ve,ye,2),V.emplace(Z++,he,me,ve,ye,3)}(!rs||rs.length<2*z)&&(rs=function(re){const se=2*re,ue=new a.bO;ue.resize(se),ue._trim();for(let he=0;he<se;he++){const me=6*he;ue.uint16[me+0]=4*he+0,ue.uint16[me+1]=4*he+1,ue.uint16[me+2]=4*he+2,ue.uint16[me+3]=4*he+2,ue.uint16[me+4]=4*he+3,ue.uint16[me+5]=4*he+0}return ue}(z));const ne=d.createIndexBuffer(rs,!0),ie=d.createVertexBuffer(V,a.bN.members,!0);for(const re of C){const se=Wl(p.transform);B.draw(d,b.TRIANGLES,Ht.disabled,hi.disabled,p.colorModeForRenderPass(),li.disabled,se,p.style.map.terrain&&p.style.map.terrain.getTerrainData(re.coord),null,i.id,ie,ne,a.aD.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,p.transform.zoom,null,null,null)}ie.destroy(),ne.destroy()}const lu=a.aq(new Float32Array(16));function Ws(p,e,i,s,c,d){const{horizontalAlign:g,verticalAlign:b}=a.ay(p);return new a.P((-(g-.5)*e/c+s[0])*d,(-(b-.5)*i/c+s[1])*d)}function cl(p,e,i,s,c,d){const g=e.tileAnchorPoint.add(new a.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let b=s.mult(d);i||(b=b.rotate(-c));const P=g.add(b);return Oe(P.x,P.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(i){const b=Mt(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(p),P=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return p.add(s.rotate(P))}return p.add(s)}function Xs(p,e,i,s,c,d,g,b,P,C,z,R){const B=p.text.placedSymbolArray,V=p.text.dynamicLayoutVertexArray,Z=p.icon.dynamicLayoutVertexArray,ne={};V.clear();for(let ie=0;ie<B.length;ie++){const re=B.get(ie),se=re.hidden||!re.crossTileID||p.allowVerticalPlacement&&!re.placedOrientation?null:s[re.crossTileID];if(se){const ue=new a.P(re.anchorX,re.anchorY),he={getElevation:R,width:c.width,height:c.height,pitchedLabelPlaneMatrix:d,lineVertexArray:null,pitchWithMap:i,transform:c,projectionCache:null,tileAnchorPoint:ue,translation:C,unwrappedTileID:z},me=i?ui(ue.x,ue.y,he):Mt(ue.x,ue.y,he),ve=Me(c.cameraToCenterDistance,me.signedDistanceFromCamera);let ye=a.aj(p.textSizeData,b,re)*ve/a.as;i&&(ye*=p.tilePixelRatio/g);const{width:ze,height:Le,anchor:Ve,textOffset:He,textBoxScale:je}=se,We=Ws(Ve,ze,Le,He,je,ye),ft=c.getPitchedTextCorrection(ue.x+C[0],ue.y+C[1],z),et=cl(me.point,he,e,We,-c.bearingInRadians,ft),_t=p.allowVerticalPlacement&&re.placedOrientation===a.ai.vertical?Math.PI/2:0;for(let Ut=0;Ut<re.numGlyphs;Ut++)a.ak(V,et,_t);P&&re.associatedIconIndex>=0&&(ne[re.associatedIconIndex]={shiftedAnchor:et,angle:_t})}else Fn(re.numGlyphs,V)}if(P){Z.clear();const ie=p.icon.placedSymbolArray;for(let re=0;re<ie.length;re++){const se=ie.get(re);if(se.hidden)Fn(se.numGlyphs,Z);else{const ue=ne[re];if(ue)for(let he=0;he<se.numGlyphs;he++)a.ak(Z,ue.shiftedAnchor,ue.angle);else Fn(se.numGlyphs,Z)}}p.icon.dynamicLayoutVertexBuffer.updateData(Z)}p.text.dynamicLayoutVertexBuffer.updateData(V)}function Ks(p,e,i){return i.iconsInText&&e?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Ys(p,e,i,s,c,d,g,b,P,C,z,R,B){const V=p.context,Z=V.gl,ne=p.transform,ie=b==="map",re=P==="map",se=b!=="viewport"&&i.layout.get("symbol-placement")!=="point",ue=ie&&!re&&!se,he=!i.layout.get("symbol-sort-key").isConstant();let me=!1;const ve=p.getDepthModeForSublayer(0,Ht.ReadOnly),ye=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ze=[],Le=ne.getCircleRadiusCorrection();for(const Ve of s){const He=e.getTile(Ve),je=He.getBucket(i);if(!je)continue;const We=c?je.text:je.icon;if(!We||!We.segments.get().length||!We.hasVisibleVertices)continue;const ft=We.programConfigurations.get(i.id),et=c||je.sdfIcons,_t=c?je.textSizeData:je.iconSizeData,Ut=re||ne.pitch!==0,di=p.useProgram(Ks(et,c,je),ft),Wi=a.ah(_t,ne.zoom),oi=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Ve);let Xi,bi,wi,Ei,Wn=[0,0],Ti=null;if(c)bi=He.glyphAtlasTexture,wi=Z.LINEAR,Xi=He.glyphAtlasTexture.size,je.iconsInText&&(Wn=He.imageAtlasTexture.size,Ti=He.imageAtlasTexture,Ei=Ut||p.options.rotating||p.options.zooming||_t.kind==="composite"||_t.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const ki=i.layout.get("icon-size").constantOr(0)!==1||je.iconsNeedLinear;bi=He.imageAtlasTexture,wi=et||p.options.rotating||p.options.zooming||ki||Ut?Z.LINEAR:Z.NEAREST,Xi=He.imageAtlasTexture.size}const Oi=a.at(He,1,p.transform.zoom),er=De(ie,p.transform,Oi),qo=a.H();a.an(qo,er);const Hr=Te(re,ie,p.transform,Oi),kr=a.au(ne,He,d,g),So=ne.getProjectionData({overscaledTileID:Ve,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),Oa=ye&&je.hasTextData(),ca=i.layout.get("icon-text-fit")!=="none"&&Oa&&je.hasIconData();if(se){const ki=p.style.map.terrain?(Wr,on)=>p.style.map.terrain.getElevation(Ve,Wr,on):null,ji=i.layout.get("text-rotation-alignment")==="map";pt(je,p,c,er,qo,re,C,ji,Ve.toUnwrapped(),ne.width,ne.height,kr,ki)}const Is=c&&ye||ca,Tn=se||Is?lu:re?er:p.transform.clipSpaceToPixelsMatrix,lo=et&&i.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let jn;jn=et?je.iconsInText?is(_t.kind,Wi,ue,re,se,Is,p,Tn,Hr,kr,Xi,Wn,Le):sl(_t.kind,Wi,ue,re,se,Is,p,Tn,Hr,kr,c,Xi,0,Le):nu(_t.kind,Wi,ue,re,se,Is,p,Tn,Hr,kr,c,Xi,Le);const zr={program:di,buffers:We,uniformValues:jn,projectionData:So,atlasTexture:bi,atlasTextureIcon:Ti,atlasInterpolation:wi,atlasInterpolationIcon:Ei,isSDF:et,hasHalo:lo};if(he&&je.canOverlap){me=!0;const ki=We.segments.get();for(const ji of ki)ze.push({segments:new a.aD([ji]),sortKey:ji.sortKey,state:zr,terrainData:oi})}else ze.push({segments:We.segments,sortKey:0,state:zr,terrainData:oi})}me&&ze.sort((Ve,He)=>Ve.sortKey-He.sortKey);for(const Ve of ze){const He=Ve.state;if(V.activeTexture.set(Z.TEXTURE0),He.atlasTexture.bind(He.atlasInterpolation,Z.CLAMP_TO_EDGE),He.atlasTextureIcon&&(V.activeTexture.set(Z.TEXTURE1),He.atlasTextureIcon&&He.atlasTextureIcon.bind(He.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),He.isSDF){const je=He.uniformValues;He.hasHalo&&(je.u_is_halo=1,eh(He.buffers,Ve.segments,i,p,He.program,ve,z,R,je,He.projectionData,Ve.terrainData)),je.u_is_halo=0}eh(He.buffers,Ve.segments,i,p,He.program,ve,z,R,He.uniformValues,He.projectionData,Ve.terrainData)}}function eh(p,e,i,s,c,d,g,b,P,C,z){const R=s.context;c.draw(R,R.gl.TRIANGLES,d,g,b,li.backCCW,P,z,C,i.id,p.layoutVertexBuffer,p.indexBuffer,e,i.paint,s.transform.zoom,p.programConfigurations.get(i.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function th(p,e,i,s,c){const d=p.context,g=d.gl,b=hi.disabled,P=new Li([g.ONE,g.ONE],a.b4.transparent,[!0,!0,!0,!0]),C=e.getBucket(i);if(!C)return;const z=s.key;let R=i.heatmapFbos.get(z);R||(R=Js(d,e.tileSize,e.tileSize),i.heatmapFbos.set(z,R)),d.bindFramebuffer.set(R.framebuffer),d.viewport.set([0,0,e.tileSize,e.tileSize]),d.clear({color:a.b4.transparent});const B=C.programConfigurations.get(i.id),V=p.useProgram("heatmap",B,!c),Z=p.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ne=p.style.map.terrain.getTerrainData(s);V.draw(d,g.TRIANGLES,Ht.disabled,b,P,li.disabled,Xl(e,p.transform.zoom,i.paint.get("heatmap-intensity"),1),ne,Z,i.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,i.paint,p.transform.zoom,B)}function cc(p,e,i,s,c){const d=p.context,g=d.gl,b=p.transform;d.setColorMode(p.colorModeForRenderPass());const P=Ia(d,e),C=i.key,z=e.heatmapFbos.get(C);if(!z)return;d.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,z.colorAttachment.get()),d.activeTexture.set(g.TEXTURE1),P.bind(g.LINEAR,g.CLAMP_TO_EDGE);const R=b.getProjectionData({overscaledTileID:i,applyTerrainMatrix:c,applyGlobeMatrix:!s});p.useProgram("heatmapTexture").draw(d,g.TRIANGLES,Ht.disabled,hi.disabled,p.colorModeForRenderPass(),li.disabled,xs(p,e,0,1),null,R,e.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments,e.paint,b.zoom),z.destroy(),e.heatmapFbos.delete(C)}function Js(p,e,i){var s,c;const d=p.gl,g=d.createTexture();d.bindTexture(d.TEXTURE_2D,g),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);const b=(s=p.HALF_FLOAT)!==null&&s!==void 0?s:d.UNSIGNED_BYTE,P=(c=p.RGBA16F)!==null&&c!==void 0?c:d.RGBA;d.texImage2D(d.TEXTURE_2D,0,P,e,i,0,d.RGBA,b,null);const C=p.createFramebuffer(e,i,!1,!1);return C.colorAttachment.set(g),C}function Ia(p,e){return e.colorRampTexture||(e.colorRampTexture=new Tt(p,e.colorRamp,p.gl.RGBA)),e.colorRampTexture}function ul(p,e,i,s,c){if(!i||!s||!s.imageAtlas)return;const d=s.imageAtlas.patternPositions;let g=d[i.to.toString()],b=d[i.from.toString()];if(!g&&b&&(g=b),!b&&g&&(b=g),!g||!b){const P=c.getPaintProperty(e);g=d[P],b=d[P]}g&&b&&p.setConstantPatternPositions(g,b)}function hl(p,e,i,s,c,d,g,b){const P=p.context.gl,C="fill-pattern",z=i.paint.get(C),R=z&&z.constantOr(1),B=i.getCrossfadeParameters();let V,Z,ne,ie,re;const se=p.transform,ue=i.paint.get("fill-translate"),he=i.paint.get("fill-translate-anchor");g?(Z=R&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=P.LINES):(Z=R?"fillPattern":"fill",V=P.TRIANGLES);const me=z.constantOr(null);for(const ve of s){const ye=e.getTile(ve);if(R&&!ye.patternsLoaded())continue;const ze=ye.getBucket(i);if(!ze)continue;const Le=ze.programConfigurations.get(i.id),Ve=p.useProgram(Z,Le),He=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ve);R&&(p.context.activeTexture.set(P.TEXTURE0),ye.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Le.updatePaintBuffers(B)),ul(Le,C,me,ye,i);const je=se.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!b,applyTerrainMatrix:!0}),We=a.au(se,ye,ue,he);if(g){ie=ze.indexBuffer2,re=ze.segments2;const et=[P.drawingBufferWidth,P.drawingBufferHeight];ne=Z==="fillOutlinePattern"&&R?Xu(p,B,ye,et,We):Ta(et,We)}else ie=ze.indexBuffer,re=ze.segments,ne=R?wa(p,B,ye,We):{u_fill_translate:We};let ft;if(p.renderPass==="translucent"&&b){const[et]=p.getStencilConfigForOverlapAndUpdateStencilID(s);ft=et[ve.overscaledZ]}else ft=p.stencilModeForClipping(ve);Ve.draw(p.context,V,c,ft,d,li.backCCW,ne,He,je,i.id,ze.layoutVertexBuffer,ie,re,i.paint,p.transform.zoom,Le)}}function Aa(p,e,i,s,c,d,g,b){const P=p.context,C=P.gl,z="fill-extrusion-pattern",R=i.paint.get(z),B=R.constantOr(1),V=i.getCrossfadeParameters(),Z=i.paint.get("fill-extrusion-opacity"),ne=R.constantOr(null),ie=p.transform;for(const re of s){const se=e.getTile(re),ue=se.getBucket(i);if(!ue)continue;const he=p.style.map.terrain&&p.style.map.terrain.getTerrainData(re),me=ue.programConfigurations.get(i.id),ve=p.useProgram(B?"fillExtrusionPattern":"fillExtrusion",me);B&&(p.context.activeTexture.set(C.TEXTURE0),se.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),me.updatePaintBuffers(V));const ye=ie.getProjectionData({overscaledTileID:re,applyGlobeMatrix:!b,applyTerrainMatrix:!0});ul(me,z,ne,se,i);const ze=a.au(ie,se,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Le=i.paint.get("fill-extrusion-vertical-gradient"),Ve=B?Wu(p,Le,Z,ze,re,V,se):Gs(p,Le,Z,ze);ve.draw(P,P.gl.TRIANGLES,c,d,g,li.backCCW,Ve,he,ye,i.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,i.paint,p.transform.zoom,me,p.style.map.terrain&&ue.centroidVertexBuffer)}}function cu(p,e,i,s,c,d,g,b,P){var C;const z=p.style.projection,R=p.context,B=p.transform,V=R.gl,Z=p.useProgram("hillshade"),ne=!p.options.moving;for(const ie of s){const re=e.getTile(ie),se=re.fbo;if(!se)continue;const ue=z.getMeshFromTileID(R,ie.canonical,b,!0,"raster"),he=(C=p.style.map.terrain)===null||C===void 0?void 0:C.getTerrainData(ie);R.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,se.colorAttachment.get());const me=B.getProjectionData({overscaledTileID:ie,aligned:ne,applyGlobeMatrix:!P,applyTerrainMatrix:!0});Z.draw(R,V.TRIANGLES,d,c[ie.overscaledZ],g,li.backCCW,Kl(p,re,i),he,me,i.id,ue.vertexBuffer,ue.indexBuffer,ue.segments)}}const uc=[new a.P(0,0),new a.P(a.X,0),new a.P(a.X,a.X),new a.P(0,a.X)];function Yt(p,e,i,s,c,d,g,b,P=!1,C=!1){const z=s[s.length-1].overscaledZ,R=p.context,B=R.gl,V=p.useProgram("raster"),Z=p.transform,ne=p.style.projection,ie=p.colorModeForRenderPass(),re=!p.options.moving;for(const se of s){const ue=p.getDepthModeForSublayer(se.overscaledZ-z,i.paint.get("raster-opacity")===1?Ht.ReadWrite:Ht.ReadOnly,B.LESS),he=e.getTile(se);he.registerFadeDuration(i.paint.get("raster-fade-duration"));const me=e.findLoadedParent(se,0),ve=e.findLoadedSibling(se),ye=fn(he,me||ve||null,e,i,p.transform,p.style.map.terrain);let ze,Le;const Ve=i.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;R.activeTexture.set(B.TEXTURE0),he.texture.bind(Ve,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),R.activeTexture.set(B.TEXTURE1),me?(me.texture.bind(Ve,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),ze=Math.pow(2,me.tileID.overscaledZ-he.tileID.overscaledZ),Le=[he.tileID.canonical.x*ze%1,he.tileID.canonical.y*ze%1]):he.texture.bind(Ve,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),he.texture.useMipmap&&R.extTextureFilterAnisotropic&&p.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const He=p.style.map.terrain&&p.style.map.terrain.getTerrainData(se),je=Z.getProjectionData({overscaledTileID:se,aligned:re,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),We=Ku(Le||[0,0],ze||1,ye,i,b),ft=ne.getMeshFromTileID(R,se.canonical,d,g,"raster");V.draw(R,B.TRIANGLES,ue,c?c[se.overscaledZ]:hi.disabled,ie,P?li.frontCCW:li.backCCW,We,He,je,i.id,ft.vertexBuffer,ft.indexBuffer,ft.segments)}}function fn(p,e,i,s,c,d){const g=s.paint.get("raster-fade-duration");if(!d&&g>0){const b=ge.now(),P=(b-p.timeAdded)/g,C=e?(b-e.timeAdded)/g:-1,z=i.getSource(),R=En(c,{tileSize:z.tileSize,roundZoom:z.roundZoom}),B=!e||Math.abs(e.tileID.overscaledZ-R)>Math.abs(p.tileID.overscaledZ-R),V=B&&p.refreshedUponExpiration?1:a.ab(B?P:1-C,0,1);return p.refreshedUponExpiration&&P>=1&&(p.refreshedUponExpiration=!1),e?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}const oo=new a.b4(1,0,0,1),uu=new a.b4(0,1,0,1),hc=new a.b4(0,0,1,1),ih=new a.b4(1,0,1,1),Ts=new a.b4(0,1,1,1);function No(p,e,i,s){$o(p,0,e+i/2,p.transform.width,i,s)}function Ea(p,e,i,s){$o(p,e-i/2,0,i,p.transform.height,s)}function $o(p,e,i,s,c,d){const g=p.context,b=g.gl;b.enable(b.SCISSOR_TEST),b.scissor(e*p.pixelRatio,i*p.pixelRatio,s*p.pixelRatio,c*p.pixelRatio),g.clear({color:d}),b.disable(b.SCISSOR_TEST)}function ka(p,e,i){const s=p.context,c=s.gl,d=p.useProgram("debug"),g=Ht.disabled,b=hi.disabled,P=p.colorModeForRenderPass(),C="$debug",z=p.style.map.terrain&&p.style.map.terrain.getTerrainData(i);s.activeTexture.set(c.TEXTURE0);const R=e.getTileByID(i.key).latestRawTileData,B=Math.floor((R&&R.byteLength||0)/1024),V=e.getTile(i).tileSize,Z=512/Math.min(V,512)*(i.overscaledZ/p.transform.zoom)*.5;let ne=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(ne+=` => ${i.overscaledZ}`),function(re,se){re.initDebugOverlayCanvas();const ue=re.debugOverlayCanvas,he=re.context.gl,me=re.debugOverlayCanvas.getContext("2d");me.clearRect(0,0,ue.width,ue.height),me.shadowColor="white",me.shadowBlur=2,me.lineWidth=1.5,me.strokeStyle="white",me.textBaseline="top",me.font="bold 36px Open Sans, sans-serif",me.fillText(se,5,5),me.strokeText(se,5,5),re.debugOverlayTexture.update(ue),re.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)}(p,`${ne} ${B}kB`);const ie=p.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});d.draw(s,c.TRIANGLES,g,b,Li.alphaBlended,li.disabled,nl(a.b4.transparent,Z),null,ie,C,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),d.draw(s,c.LINE_STRIP,g,b,P,li.disabled,nl(a.b4.red),z,ie,C,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function Qs(p,e,i,s){const{isRenderingGlobe:c}=s,d=p.context,g=d.gl,b=p.transform,P=p.colorModeForRenderPass(),C=p.getDepthModeFor3D(),z=p.useProgram("terrain");d.bindFramebuffer.set(null),d.viewport.set([0,0,p.width,p.height]);for(const R of i){const B=e.getTerrainMesh(R.tileID),V=p.renderToTexture.getTexture(R),Z=e.getTerrainData(R.tileID);d.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,V.texture);const ne=e.getMeshFrameDelta(b.zoom),ie=b.calculateFogMatrix(R.tileID.toUnwrapped()),re=Us(ne,ie,p.style.sky,b.pitch,c),se=b.getProjectionData({overscaledTileID:R.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});z.draw(d,g.TRIANGLES,C,hi.disabled,P,li.backCCW,re,Z,se,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}}function za(p,e){if(!e.mesh){const i=new a.aC;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);const s=new a.aE;s.emplaceBack(0,1,2),s.emplaceBack(0,2,3),e.mesh=new _o(p.createVertexBuffer(i,Kt.members),p.createIndexBuffer(s),a.aD.simpleSegment(0,0,i.length,s.length))}return e.mesh}class ea{constructor(e,i){this.context=new al(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.aq(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=U.maxUnderzooming+U.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Lo}resize(e,i,s){if(this.width=Math.floor(e*s),this.height=Math.floor(i*s),this.pixelRatio=s,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const e=this.context,i=new a.aC;i.emplaceBack(0,0),i.emplaceBack(a.X,0),i.emplaceBack(0,a.X),i.emplaceBack(a.X,a.X),this.tileExtentBuffer=e.createVertexBuffer(i,Kt.members),this.tileExtentSegments=a.aD.simpleSegment(0,0,4,2);const s=new a.aC;s.emplaceBack(0,0),s.emplaceBack(a.X,0),s.emplaceBack(0,a.X),s.emplaceBack(a.X,a.X),this.debugBuffer=e.createVertexBuffer(s,Kt.members),this.debugSegments=a.aD.simpleSegment(0,0,4,5);const c=new a.bT;c.emplaceBack(0,0,0,0),c.emplaceBack(a.X,0,a.X,0),c.emplaceBack(0,a.X,0,a.X),c.emplaceBack(a.X,a.X,a.X,a.X),this.rasterBoundsBuffer=e.createVertexBuffer(c,rn.members),this.rasterBoundsSegments=a.aD.simpleSegment(0,0,4,2);const d=new a.aC;d.emplaceBack(0,0),d.emplaceBack(a.X,0),d.emplaceBack(0,a.X),d.emplaceBack(a.X,a.X),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(d,Kt.members),this.rasterBoundsSegmentsPosOnly=a.aD.simpleSegment(0,0,4,5);const g=new a.aC;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(g,Kt.members),this.viewportSegments=a.aD.simpleSegment(0,0,4,2);const b=new a.bU;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(b);const P=new a.aE;P.emplaceBack(1,0,2),P.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(P);const C=this.context.gl;this.stencilClearMode=new hi({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.tileExtentMesh=new _o(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const s=a.H();a.bL(s,0,this.width,this.height,0,0,1),a.K(s,s,[i.drawingBufferWidth,i.drawingBufferHeight,0]);const c={mainMatrix:s,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:s};this.useProgram("clippingMask",null,!0).draw(e,i.TRIANGLES,Ht.disabled,this.stencilClearMode,Li.disabled,li.disabled,null,null,c,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,i,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!i||!i.length)return;this.currentStencilSource=e.source,this.nextStencilID+i.length>256&&this.clearStencil();const c=this.context;c.setColorMode(Li.disabled),c.setDepthMode(Ht.disabled);const d={};for(const g of i)d[g.key]=this.nextStencilID++;this._renderTileMasks(d,i,s,!0),this._renderTileMasks(d,i,s,!1),this._tileClippingMaskIDs=d}_renderTileMasks(e,i,s,c){const d=this.context,g=d.gl,b=this.style.projection,P=this.transform,C=this.useProgram("clippingMask");for(const z of i){const R=e[z.key],B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),V=b.getMeshFromTileID(this.context,z.canonical,c,!0,"stencil"),Z=P.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!0,applyTerrainMatrix:!0});C.draw(d,g.TRIANGLES,Ht.disabled,new hi({func:g.ALWAYS,mask:0},R,255,g.KEEP,g.KEEP,g.REPLACE),Li.disabled,s?li.disabled:li.backCCW,null,B,Z,"$clipping",V.vertexBuffer,V.indexBuffer,V.segments)}}_renderTilesDepthBuffer(){const e=this.context,i=e.gl,s=this.style.projection,c=this.transform,d=this.useProgram("depth"),g=this.getDepthModeFor3D(),b=Q(c,{tileSize:c.tileSize});for(const P of b){const C=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P),z=s.getMeshFromTileID(this.context,P.canonical,!0,!0,"raster"),R=c.getProjectionData({overscaledTileID:P,applyGlobeMatrix:!0,applyTerrainMatrix:!0});d.draw(e,i.TRIANGLES,g,hi.disabled,Li.disabled,li.backCCW,null,C,R,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new hi({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){const i=this.context.gl;return new hi({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const i=this.context.gl,s=e.sort((g,b)=>b.overscaledZ-g.overscaledZ),c=s[s.length-1].overscaledZ,d=s[0].overscaledZ-c+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const g={};for(let b=0;b<d;b++)g[b+c]=new hi({func:i.GEQUAL,mask:255},b+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=d,[g,s]}return[{[c]:hi.disabled},s]}stencilConfigForOverlapTwoPass(e){const i=this.context.gl,s=e.sort((g,b)=>b.overscaledZ-g.overscaledZ),c=s[s.length-1].overscaledZ,d=s[0].overscaledZ-c+1;if(this.clearStencil(),d>1){const g={},b={};for(let P=0;P<d;P++)g[P+c]=new hi({func:i.GREATER,mask:255},d+1+P,255,i.KEEP,i.KEEP,i.REPLACE),b[P+c]=new hi({func:i.GREATER,mask:255},1+P,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID=2*d+1,[g,b,s]}return this.nextStencilID=3,[{[c]:new hi({func:i.GREATER,mask:255},2,255,i.KEEP,i.KEEP,i.REPLACE)},{[c]:new hi({func:i.GREATER,mask:255},1,255,i.KEEP,i.KEEP,i.REPLACE)},s]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Li([e.CONSTANT_COLOR,e.ONE],new a.b4(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Li.unblended:Li.alphaBlended}getDepthModeForSublayer(e,i,s){if(!this.opaquePassEnabledForLayer())return Ht.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Ht(s||this.context.gl.LEQUAL,i,[c,c])}getDepthModeFor3D(){return new Ht(this.context.gl.LEQUAL,Ht.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){var s,c;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(ge.now()),this.imageManager.beginFrame();const d=this.style._order,g=this.style.sourceCaches,b={},P={},C={},z={isRenderingToTexture:!1,isRenderingGlobe:((s=e.projection)===null||s===void 0?void 0:s.transitionState)>0};for(const B in g){const V=g[B];V.used&&V.prepare(this.context),b[B]=V.getVisibleCoordinates(!1),P[B]=b[B].slice().reverse(),C[B]=V.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<d.length;B++)if(this.style._layers[d[B]].is3D()){this.opaquePassCutoff=B;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const B of d){const V=this.style._layers[B];if(!V.hasOffscreenPass()||V.isHidden(this.transform.zoom))continue;const Z=P[V.source];(V.type==="custom"||Z.length)&&this.renderLayer(this,g[V.source],V,Z,z)}if((c=this.style.projection)===null||c===void 0||c.updateGPUdependent({context:this.context,useProgram:B=>this.useProgram(B)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?a.b4.black:a.b4.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(B,V){const Z=B.context,ne=Z.gl,ie=((ve,ye,ze)=>{const Le=Math.cos(ye.rollInRadians),Ve=Math.sin(ye.rollInRadians),He=Hi(ye),je=ye.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ve.properties.get("sky-color"),u_horizon_color:ve.properties.get("horizon-color"),u_horizon:[(ye.width/2-He*Ve)*ze,(ye.height/2+He*Le)*ze],u_horizon_normal:[-Ve,Le],u_sky_horizon_blend:ve.properties.get("sky-horizon-blend")*ye.height/2*ze,u_sky_blend:je}})(V,B.style.map.transform,B.pixelRatio),re=new Ht(ne.LEQUAL,Ht.ReadWrite,[0,1]),se=hi.disabled,ue=B.colorModeForRenderPass(),he=B.useProgram("sky"),me=za(Z,V);he.draw(Z,ne.TRIANGLES,re,se,ue,li.disabled,ie,null,void 0,"sky",me.vertexBuffer,me.indexBuffer,me.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[d[this.currentLayer]],V=g[B.source],Z=b[B.source];this._renderTileClippingMasks(B,Z,!1),this.renderLayer(this,V,B,Z,z)}this.renderPass="translucent";let R=!1;for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const B=this.style._layers[d[this.currentLayer]],V=g[B.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(B,z))continue;this.opaquePassEnabledForLayer()||R||(R=!0,z.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Z=(B.type==="symbol"?C:P)[B.source];this._renderTileClippingMasks(B,b[B.source],!1),this.renderLayer(this,V,B,Z,z)}if(z.isRenderingGlobe&&function(B,V,Z){const ne=B.context,ie=ne.gl,re=B.useProgram("atmosphere"),se=new Ht(ie.LEQUAL,Ht.ReadOnly,[0,1]),ue=B.transform,he=function(je,We){const ft=je.properties.get("position"),et=[-ft.x,-ft.y,-ft.z],_t=a.aq(new Float64Array(16));return je.properties.get("anchor")==="map"&&(a.aX(_t,_t,We.rollInRadians),a.aY(_t,_t,-We.pitchInRadians),a.aX(_t,_t,We.bearingInRadians),a.aY(_t,_t,We.center.lat*Math.PI/180),a.bj(_t,_t,-We.center.lng*Math.PI/180)),a.bS(et,et,_t),et}(Z,B.transform),me=ue.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ve=V.properties.get("atmosphere-blend")*me.projectionTransition;if(ve===0)return;const ye=to(ue.worldSize,ue.center.lat),ze=ue.inverseProjectionMatrix,Le=new Float64Array(4);Le[3]=1,a.al(Le,Le,ue.modelViewProjectionMatrix),Le[0]/=Le[3],Le[1]/=Le[3],Le[2]/=Le[3],Le[3]=1,a.al(Le,Le,ze),Le[0]/=Le[3],Le[1]/=Le[3],Le[2]/=Le[3],Le[3]=1;const Ve=((je,We,ft,et,_t)=>({u_sun_pos:je,u_atmosphere_blend:We,u_globe_position:ft,u_globe_radius:et,u_inv_proj_matrix:_t}))(he,ve,[Le[0],Le[1],Le[2]],ye,ze),He=za(ne,V);re.draw(ne,ie.TRIANGLES,se,hi.disabled,Li.alphaBlended,li.disabled,Ve,null,null,"atmosphere",He.vertexBuffer,He.indexBuffer,He.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const B=function(V,Z){let ne=null;const ie=Object.values(V._layers).flatMap(he=>he.source&&!he.isHidden(Z)?[V.sourceCaches[he.source]]:[]),re=ie.filter(he=>he.getSource().type==="vector"),se=ie.filter(he=>he.getSource().type!=="vector"),ue=he=>{(!ne||ne.getSource().maxzoom<he.getSource().maxzoom)&&(ne=he)};return re.forEach(he=>ue(he)),ne||se.forEach(he=>ue(he)),ne}(this.style,this.transform.zoom);B&&function(V,Z,ne){for(let ie=0;ie<ne.length;ie++)ka(V,Z,ne[ie])}(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const V=B.transform.padding;No(B,B.transform.height-(V.top||0),3,oo),No(B,V.bottom||0,3,uu),Ea(B,V.left||0,3,hc),Ea(B,B.transform.width-(V.right||0),3,ih);const Z=B.transform.centerPoint;(function(ne,ie,re,se){$o(ne,ie-1,re-10,2,20,se),$o(ne,ie-10,re-1,20,2,se)})(B,Z.x,B.transform.height-Z.y,Ts)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,s=this.transform.modelViewProjectionMatrix;let c=this.terrainFacilitator.dirty;c||(c=e?!a.bV(i,s):!a.bW(i,s)),c||(c=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),c&&(a.bX(i,s),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(d,g){const b=d.context,P=b.gl,C=d.transform,z=Li.unblended,R=new Ht(P.LEQUAL,Ht.ReadWrite,[0,1]),B=g.sourceCache.getRenderableTiles(),V=d.useProgram("terrainDepth");b.bindFramebuffer.set(g.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),b.clear({color:a.b4.transparent,depth:1});for(const Z of B){const ne=g.getTerrainMesh(Z.tileID),ie=g.getTerrainData(Z.tileID),re=C.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),se={u_ele_delta:g.getMeshFrameDelta(C.zoom)};V.draw(b,P.TRIANGLES,R,hi.disabled,z,li.backCCW,se,ie,re,"terrain",ne.vertexBuffer,ne.indexBuffer,ne.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain),function(d,g){const b=d.context,P=b.gl,C=d.transform,z=Li.unblended,R=new Ht(P.LEQUAL,Ht.ReadWrite,[0,1]),B=g.getCoordsTexture(),V=g.sourceCache.getRenderableTiles(),Z=d.useProgram("terrainCoords");b.bindFramebuffer.set(g.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),b.clear({color:a.b4.transparent,depth:1}),g.coordsIndex=[];for(const ne of V){const ie=g.getTerrainMesh(ne.tileID),re=g.getTerrainData(ne.tileID);b.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,B.texture);const se={u_terrain_coords_id:(255-g.coordsIndex.length)/255,u_texture:0,u_ele_delta:g.getMeshFrameDelta(C.zoom)},ue=C.getProjectionData({overscaledTileID:ne.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Z.draw(b,P.TRIANGLES,R,hi.disabled,z,li.backCCW,se,re,ue,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments),g.coordsIndex.push(ne.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain))}renderLayer(e,i,s,c,d){s.isHidden(this.transform.zoom)||(s.type==="background"||s.type==="custom"||(c||[]).length)&&(this.id=s.id,a.bY(s)?function(g,b,P,C,z,R){if(g.renderPass!=="translucent")return;const{isRenderingToTexture:B}=R,V=hi.disabled,Z=g.colorModeForRenderPass();(P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ne,ie,re,se,ue,he,me,ve,ye){const ze=ie.transform,Le=ie.style.map.terrain,Ve=ue==="map",He=he==="map";for(const je of ne){const We=se.getTile(je),ft=We.getBucket(re);if(!ft||!ft.text||!ft.text.segments.get().length)continue;const et=a.ah(ft.textSizeData,ze.zoom),_t=a.at(We,1,ie.transform.zoom),Ut=De(Ve,ie.transform,_t),di=re.layout.get("icon-text-fit")!=="none"&&ft.hasIconData();{const Wi=Math.pow(2,ze.zoom-We.tileID.overscaledZ),oi=Le?(Xi,bi)=>Le.getElevation(je,Xi,bi):null;Xs(ft,Ve,He,ye,ze,Ut,Wi,et,di,a.au(ze,We,me,ve),je.toUnwrapped(),oi)}}}(C,g,P,b,P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),z),P.paint.get("icon-opacity").constantOr(1)!==0&&Ys(g,b,P,C,!1,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),P.layout.get("icon-rotation-alignment"),P.layout.get("icon-pitch-alignment"),P.layout.get("icon-keep-upright"),V,Z,B),P.paint.get("text-opacity").constantOr(1)!==0&&Ys(g,b,P,C,!0,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.layout.get("text-keep-upright"),V,Z,B),b.map.showCollisionBoxes&&(ll(g,b,P,C,!0),ll(g,b,P,C,!1))}(e,i,s,c,this.style.placement.variableOffsets,d):a.bZ(s)?function(g,b,P,C,z){if(g.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,B=P.paint.get("circle-opacity"),V=P.paint.get("circle-stroke-width"),Z=P.paint.get("circle-stroke-opacity"),ne=!P.layout.get("circle-sort-key").isConstant();if(B.constantOr(1)===0&&(V.constantOr(1)===0||Z.constantOr(1)===0))return;const ie=g.context,re=ie.gl,se=g.transform,ue=g.getDepthModeForSublayer(0,Ht.ReadOnly),he=hi.disabled,me=g.colorModeForRenderPass(),ve=[],ye=se.getCircleRadiusCorrection();for(let ze=0;ze<C.length;ze++){const Le=C[ze],Ve=b.getTile(Le),He=Ve.getBucket(P);if(!He)continue;const je=P.paint.get("circle-translate"),We=P.paint.get("circle-translate-anchor"),ft=a.au(se,Ve,je,We),et=He.programConfigurations.get(P.id),_t=g.useProgram("circle",et),Ut=He.layoutVertexBuffer,di=He.indexBuffer,Wi=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Le),oi={programConfiguration:et,program:_t,layoutVertexBuffer:Ut,indexBuffer:di,uniformValues:Hl(g,Ve,P,ft,ye),terrainData:Wi,projectionData:se.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!R,applyTerrainMatrix:!0})};if(ne){const Xi=He.segments.get();for(const bi of Xi)ve.push({segments:new a.aD([bi]),sortKey:bi.sortKey,state:oi})}else ve.push({segments:He.segments,sortKey:0,state:oi})}ne&&ve.sort((ze,Le)=>ze.sortKey-Le.sortKey);for(const ze of ve){const{programConfiguration:Le,program:Ve,layoutVertexBuffer:He,indexBuffer:je,uniformValues:We,terrainData:ft,projectionData:et}=ze.state;Ve.draw(ie,re.TRIANGLES,ue,he,me,li.backCCW,We,ft,et,P.id,He,je,ze.segments,P.paint,g.transform.zoom,Le)}}(e,i,s,c,d):a.b_(s)?function(g,b,P,C,z){if(P.paint.get("heatmap-opacity")===0)return;const R=g.context,{isRenderingToTexture:B,isRenderingGlobe:V}=z;if(g.style.map.terrain){for(const Z of C){const ne=b.getTile(Z);b.hasRenderableParent(Z)||(g.renderPass==="offscreen"?th(g,ne,P,Z,V):g.renderPass==="translucent"&&cc(g,P,Z,B,V))}R.viewport.set([0,0,g.width,g.height])}else g.renderPass==="offscreen"?function(Z,ne,ie,re){const se=Z.context,ue=se.gl,he=Z.transform,me=hi.disabled,ve=new Li([ue.ONE,ue.ONE],a.b4.transparent,[!0,!0,!0,!0]);(function(ye,ze,Le){const Ve=ye.gl;ye.activeTexture.set(Ve.TEXTURE1),ye.viewport.set([0,0,ze.width/4,ze.height/4]);let He=Le.heatmapFbos.get(a.bP);He?(Ve.bindTexture(Ve.TEXTURE_2D,He.colorAttachment.get()),ye.bindFramebuffer.set(He.framebuffer)):(He=Js(ye,ze.width/4,ze.height/4),Le.heatmapFbos.set(a.bP,He))})(se,Z,ie),se.clear({color:a.b4.transparent});for(let ye=0;ye<re.length;ye++){const ze=re[ye];if(ne.hasRenderableParent(ze))continue;const Le=ne.getTile(ze),Ve=Le.getBucket(ie);if(!Ve)continue;const He=Ve.programConfigurations.get(ie.id),je=Z.useProgram("heatmap",He),We=he.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ft=he.getCircleRadiusCorrection();je.draw(se,ue.TRIANGLES,Ht.disabled,me,ve,li.backCCW,Xl(Le,he.zoom,ie.paint.get("heatmap-intensity"),ft),null,We,ie.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,ie.paint,he.zoom,He)}se.viewport.set([0,0,Z.width,Z.height])}(g,b,P,C):g.renderPass==="translucent"&&function(Z,ne){const ie=Z.context,re=ie.gl;ie.setColorMode(Z.colorModeForRenderPass());const se=ne.heatmapFbos.get(a.bP);se&&(ie.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_2D,se.colorAttachment.get()),ie.activeTexture.set(re.TEXTURE1),Ia(ie,ne).bind(re.LINEAR,re.CLAMP_TO_EDGE),Z.useProgram("heatmapTexture").draw(ie,re.TRIANGLES,Ht.disabled,hi.disabled,Z.colorModeForRenderPass(),li.disabled,xs(Z,ne,0,1),null,null,ne.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments,ne.paint,Z.transform.zoom))}(g,P)}(e,i,s,c,d):a.b$(s)?function(g,b,P,C,z){if(g.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,B=P.paint.get("line-opacity"),V=P.paint.get("line-width");if(B.constantOr(1)===0||V.constantOr(1)===0)return;const Z=g.getDepthModeForSublayer(0,Ht.ReadOnly),ne=g.colorModeForRenderPass(),ie=P.paint.get("line-dasharray"),re=P.paint.get("line-pattern"),se=re.constantOr(1),ue=P.paint.get("line-gradient"),he=P.getCrossfadeParameters(),me=se?"linePattern":ie?"lineSDF":ue?"lineGradient":"line",ve=g.context,ye=ve.gl,ze=g.transform;let Le=!0;for(const Ve of C){const He=b.getTile(Ve);if(se&&!He.patternsLoaded())continue;const je=He.getBucket(P);if(!je)continue;const We=je.programConfigurations.get(P.id),ft=g.context.program.get(),et=g.useProgram(me,We),_t=Le||et.program!==ft,Ut=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ve),di=re.constantOr(null);if(di&&He.imageAtlas){const wi=He.imageAtlas,Ei=wi.patternPositions[di.to.toString()],Wn=wi.patternPositions[di.from.toString()];Ei&&Wn&&We.setConstantPatternPositions(Ei,Wn)}const Wi=ze.getProjectionData({overscaledTileID:Ve,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),oi=ze.getPixelScale(),Xi=se?tu(g,He,P,oi,he):ie?ol(g,He,P,oi,ie,he):ue?hr(g,He,P,oi,je.lineClipsArray.length):Jl(g,He,P,oi);if(se)ve.activeTexture.set(ye.TEXTURE0),He.imageAtlasTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),We.updatePaintBuffers(he);else if(ie&&(_t||g.lineAtlas.dirty))ve.activeTexture.set(ye.TEXTURE0),g.lineAtlas.bind(ve);else if(ue){const wi=je.gradients[P.id];let Ei=wi.texture;if(P.gradientVersion!==wi.version){let Wn=256;if(P.stepInterpolant){const Ti=b.getSource().maxzoom,Oi=Ve.canonical.z===Ti?Math.ceil(1<<g.transform.maxZoom-Ve.canonical.z):1;Wn=a.ab(a.bQ(je.maxLineLength/a.X*1024*Oi),256,ve.maxTextureSize)}wi.gradient=a.bR({expression:P.gradientExpression(),evaluationKey:"lineProgress",resolution:Wn,image:wi.gradient||void 0,clips:je.lineClipsArray}),wi.texture?wi.texture.update(wi.gradient):wi.texture=new Tt(ve,wi.gradient,ye.RGBA),wi.version=P.gradientVersion,Ei=wi.texture}ve.activeTexture.set(ye.TEXTURE0),Ei.bind(P.stepInterpolant?ye.NEAREST:ye.LINEAR,ye.CLAMP_TO_EDGE)}let bi;if(R){const[wi]=g.getStencilConfigForOverlapAndUpdateStencilID(C);bi=wi[Ve.overscaledZ]}else bi=g.stencilModeForClipping(Ve);et.draw(ve,ye.TRIANGLES,Z,bi,ne,li.disabled,Xi,Ut,Wi,P.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,P.paint,g.transform.zoom,We,je.layoutVertexBuffer2),Le=!1}}(e,i,s,c,d):a.c0(s)?function(g,b,P,C,z){const R=P.paint.get("fill-color"),B=P.paint.get("fill-opacity");if(B.constantOr(1)===0)return;const{isRenderingToTexture:V}=z,Z=g.colorModeForRenderPass(),ne=P.paint.get("fill-pattern"),ie=g.opaquePassEnabledForLayer()&&!ne.constantOr(1)&&R.constantOr(a.b4.transparent).a===1&&B.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===ie){const re=g.getDepthModeForSublayer(1,g.renderPass==="opaque"?Ht.ReadWrite:Ht.ReadOnly);hl(g,b,P,C,re,Z,!1,V)}if(g.renderPass==="translucent"&&P.paint.get("fill-antialias")){const re=g.getDepthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,Ht.ReadOnly);hl(g,b,P,C,re,Z,!0,V)}}(e,i,s,c,d):a.c1(s)?function(g,b,P,C,z){const R=P.paint.get("fill-extrusion-opacity");if(R===0)return;const{isRenderingToTexture:B}=z;if(g.renderPass==="translucent"){const V=new Ht(g.context.gl.LEQUAL,Ht.ReadWrite,g.depthRangeFor3D);if(R!==1||P.paint.get("fill-extrusion-pattern").constantOr(1))Aa(g,b,P,C,V,hi.disabled,Li.disabled,B),Aa(g,b,P,C,V,g.stencilModeFor3D(),g.colorModeForRenderPass(),B);else{const Z=g.colorModeForRenderPass();Aa(g,b,P,C,V,hi.disabled,Z,B)}}}(e,i,s,c,d):a.c2(s)?function(g,b,P,C,z){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,B=g.context,V=g.style.projection.useSubdivision,Z=g.getDepthModeForSublayer(0,Ht.ReadOnly),ne=g.colorModeForRenderPass();if(g.renderPass==="offscreen")(function(ie,re,se,ue,he,me,ve){const ye=ie.context,ze=ye.gl;for(const Le of se){const Ve=re.getTile(Le),He=Ve.dem;if(!He||!He.data||!Ve.needsHillshadePrepare)continue;const je=He.dim,We=He.stride,ft=He.getPixels();if(ye.activeTexture.set(ze.TEXTURE1),ye.pixelStoreUnpackPremultiplyAlpha.set(!1),Ve.demTexture=Ve.demTexture||ie.getTileTexture(We),Ve.demTexture){const _t=Ve.demTexture;_t.update(ft,{premultiply:!1}),_t.bind(ze.NEAREST,ze.CLAMP_TO_EDGE)}else Ve.demTexture=new Tt(ye,ft,ze.RGBA,{premultiply:!1}),Ve.demTexture.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);ye.activeTexture.set(ze.TEXTURE0);let et=Ve.fbo;if(!et){const _t=new Tt(ye,{width:je,height:je,data:null},ze.RGBA);_t.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),et=Ve.fbo=ye.createFramebuffer(je,je,!0,!1),et.colorAttachment.set(_t.texture)}ye.bindFramebuffer.set(et.framebuffer),ye.viewport.set([0,0,je,je]),ie.useProgram("hillshadePrepare").draw(ye,ze.TRIANGLES,he,me,ve,li.disabled,Yl(Ve.tileID,He),null,null,ue.id,ie.rasterBoundsBuffer,ie.quadTriangleIndexBuffer,ie.rasterBoundsSegments),Ve.needsHillshadePrepare=!1}})(g,b,C,P,Z,hi.disabled,ne),B.viewport.set([0,0,g.width,g.height]);else if(g.renderPass==="translucent")if(V){const[ie,re,se]=g.stencilConfigForOverlapTwoPass(C);cu(g,b,P,se,ie,Z,ne,!1,R),cu(g,b,P,se,re,Z,ne,!0,R)}else{const[ie,re]=g.getStencilConfigForOverlapAndUpdateStencilID(C);cu(g,b,P,re,ie,Z,ne,!1,R)}}(e,i,s,c,d):a.c3(s)?function(g,b,P,C,z){if(g.renderPass!=="translucent"||P.paint.get("raster-opacity")===0||!C.length)return;const{isRenderingToTexture:R}=z,B=b.getSource(),V=g.style.projection.useSubdivision;if(B instanceof yn)Yt(g,b,P,C,null,!1,!1,B.tileCoords,B.flippedWindingOrder,R);else if(V){const[Z,ne,ie]=g.stencilConfigForOverlapTwoPass(C);Yt(g,b,P,ie,Z,!1,!0,uc,!1,R),Yt(g,b,P,ie,ne,!0,!0,uc,!1,R)}else{const[Z,ne]=g.getStencilConfigForOverlapAndUpdateStencilID(C);Yt(g,b,P,ne,Z,!1,!0,uc,!1,R)}}(e,i,s,c,d):a.c4(s)?function(g,b,P,C,z){const R=P.paint.get("background-color"),B=P.paint.get("background-opacity");if(B===0)return;const{isRenderingToTexture:V}=z,Z=g.context,ne=Z.gl,ie=g.style.projection,re=g.transform,se=re.tileSize,ue=P.paint.get("background-pattern");if(g.isPatternMissing(ue))return;const he=!ue&&R.a===1&&B===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==he)return;const me=hi.disabled,ve=g.getDepthModeForSublayer(0,he==="opaque"?Ht.ReadWrite:Ht.ReadOnly),ye=g.colorModeForRenderPass(),ze=g.useProgram(ue?"backgroundPattern":"background"),Le=C||Q(re,{tileSize:se,terrain:g.style.map.terrain});ue&&(Z.activeTexture.set(ne.TEXTURE0),g.imageManager.bind(g.context));const Ve=P.getCrossfadeParameters();for(const He of Le){const je=re.getProjectionData({overscaledTileID:He,applyGlobeMatrix:!V,applyTerrainMatrix:!0}),We=ue?ru(B,g,ue,{tileID:He,tileSize:se},Ve):bs(B,R),ft=g.style.map.terrain&&g.style.map.terrain.getTerrainData(He),et=ie.getMeshFromTileID(Z,He.canonical,!1,!0,"raster");ze.draw(Z,ne.TRIANGLES,ve,me,ye,li.backCCW,We,ft,je,P.id,et.vertexBuffer,et.indexBuffer,et.segments)}}(e,0,s,c,d):a.c5(s)&&function(g,b,P,C){const{isRenderingGlobe:z}=C,R=g.context,B=P.implementation,V=g.style.projection,Z=g.transform,ne=Z.getProjectionDataForCustomLayer(z),ie={farZ:Z.farZ,nearZ:Z.nearZ,fov:Z.fov*Math.PI/180,modelViewProjectionMatrix:Z.modelViewProjectionMatrix,projectionMatrix:Z.projectionMatrix,shaderData:{variantName:V.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${V.shaderPreludeCode.vertexSource}`,define:V.shaderDefine},defaultProjectionData:ne},re=B.renderingMode?B.renderingMode:"2d";if(g.renderPass==="offscreen"){const se=B.prerender;se&&(g.setCustomLayerDefaults(),R.setColorMode(g.colorModeForRenderPass()),se.call(B,R.gl,ie),R.setDirty(),g.setBaseState())}else if(g.renderPass==="translucent"){g.setCustomLayerDefaults(),R.setColorMode(g.colorModeForRenderPass()),R.setStencilMode(hi.disabled);const se=re==="3d"?g.getDepthModeFor3D():g.getDepthModeForSublayer(0,Ht.ReadOnly);R.setDepthMode(se),B.render(R.gl,ie),R.setDirty(),g.setBaseState(),R.bindFramebuffer.set(null)}}(e,0,s,d))}saveTileTexture(e){const i=this._tileTextures[e.size[0]];i?i.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const i=this._tileTextures[e];return i&&i.length>0?i.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const i=this.imageManager.getPattern(e.from.toString()),s=this.imageManager.getPattern(e.to.toString());return!i||!s}useProgram(e,i,s=!1){this.cache=this.cache||{};const c=!!this.style.map.terrain,d=this.style.projection,g=e+(i?i.cacheKey:"")+`/${s?Kc:d.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(c?"/terrain":"");return this.cache[g]||(this.cache[g]=new ql(this.context,Bo[e],i,ic[e],this._showOverdrawInspector,c,s?Bo.projectionMercator:d.shaderPreludeCode,s?Ol:d.shaderDefine)),this.cache[g]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Tt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:i}=this.context.gl;return this.width!==e||this.height!==i}}function Ss(p,e){let i,s=!1,c=null,d=null;const g=()=>{c=null,s&&(p.apply(d,i),c=setTimeout(g,e),s=!1)};return(...b)=>(s=!0,d=this,i=b,c||g(),c)}class hu{constructor(e){this._getCurrentHash=()=>{const i=window.location.hash.replace("#","");if(this._hashName){let s;return i.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(s=c)}),(s&&s[1]||"").split("/")}return i.split("/")},this._onHashChange=()=>{const i=this._getCurrentHash();if(!this._isValidHash(i))return!1;const s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:s,pitch:+(i[4]||0)}),!0},this._updateHashUnthrottled=()=>{const i=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,i)},this._removeHash=()=>{const i=this._getCurrentHash();if(i.length===0)return;const s=i.join("/");let c=s;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${s}`);let d=window.location.hash.replace(c,"");d.startsWith("#&")?d=d.slice(0,1)+d.slice(2):d==="#"&&(d="");let g=window.location.href.replace(/(#.+)?$/,d);g=g.replace("&&","&"),window.history.replaceState(window.history.state,null,g)},this._updateHash=Ss(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const i=this._map.getCenter(),s=Math.round(100*this._map.getZoom())/100,c=Math.ceil((s*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,c),g=Math.round(i.lng*d)/d,b=Math.round(i.lat*d)/d,P=this._map.getBearing(),C=this._map.getPitch();let z="";if(z+=e?`/${g}/${b}/${s}`:`${s}/${b}/${g}`,(P||C)&&(z+="/"+Math.round(10*P)/10),C&&(z+=`/${Math.round(C)}`),this._hashName){const R=this._hashName;let B=!1;const V=window.location.hash.slice(1).split("&").map(Z=>{const ne=Z.split("=")[0];return ne===R?(B=!0,`${ne}=${z}`):Z}).filter(Z=>Z);return B||V.push(`${R}=${z}`),`#${V.join("&")}`}return`#${z}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new a.N(+e[2],+e[1])}catch{return!1}const i=+e[0],s=+(e[3]||0),c=+(e[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&s>=0&&s<=180&&c>=this._map.getMinPitch()&&c<=this._map.getMaxPitch()}}const Da={linearity:.3,easing:a.c6(0,0,.3,1)},nh=a.e({deceleration:2500,maxSpeed:1400},Da),rh=a.e({deceleration:20,maxSpeed:1400},Da),pl=a.e({deceleration:1e3,maxSpeed:360},Da),Ra=a.e({deceleration:1e3,maxSpeed:90},Da),pu=a.e({deceleration:1e3,maxSpeed:360},Da);class X{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ge.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=ge.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)i.zoom+=d.zoomDelta||0,i.bearing+=d.bearingDelta||0,i.pitch+=d.pitchDelta||0,i.roll+=d.rollDelta||0,d.panDelta&&i.pan._add(d.panDelta),d.around&&(i.around=d.around),d.pinchAround&&(i.pinchAround=d.pinchAround);const s=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(i.pan.mag()){const d=Hn(i.pan.mag(),s,a.e({},nh,e||{})),g=i.pan.mult(d.amount/i.pan.mag()),b=this._map.cameraHelper.handlePanInertia(g,this._map.transform);c.center=b.easingCenter,c.offset=b.easingOffset,vo(c,d)}if(i.zoom){const d=Hn(i.zoom,s,rh);c.zoom=this._map.transform.zoom+d.amount,vo(c,d)}if(i.bearing){const d=Hn(i.bearing,s,pl);c.bearing=this._map.transform.bearing+a.ab(d.amount,-179,179),vo(c,d)}if(i.pitch){const d=Hn(i.pitch,s,Ra);c.pitch=this._map.transform.pitch+d.amount,vo(c,d)}if(i.roll){const d=Hn(i.roll,s,pu);c.roll=this._map.transform.roll+a.ab(d.amount,-179,179),vo(c,d)}if(c.zoom||c.bearing){const d=i.pinchAround===void 0?i.around:i.pinchAround;c.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),a.e(c,{noMoveStart:!0})}}function vo(p,e){(!p.duration||p.duration<e.duration)&&(p.duration=e.duration,p.easing=e.easing)}function Hn(p,e,i){const{maxSpeed:s,linearity:c,deceleration:d}=i,g=a.ab(p*c/(e/1e3),-s,s),b=Math.abs(g)/(d*c);return{easing:i.easing,duration:1e3*b,amount:g*(b/2)}}class _i extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,s,c={}){const d=te.mousePos(i.getCanvas(),s),g=i.unproject(d);super(e,a.e({point:d,lngLat:g,originalEvent:s},c)),this._defaultPrevented=!1,this.target=i}}class ti extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,s){const c=e==="touchend"?s.changedTouches:s.touches,d=te.touchPos(i.getCanvasContainer(),c),g=d.map(P=>i.unproject(P)),b=d.reduce((P,C,z,R)=>P.add(C.div(R.length)),new a.P(0,0));super(e,{points:d,point:b,lngLats:g,lngLat:i.unproject(b),originalEvent:s}),this._defaultPrevented=!1}}class xo extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,s){super(e,{originalEvent:s}),this._defaultPrevented=!1}}class La{constructor(e,i){this._map=e,this._clickTolerance=i.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new xo(e.type,this._map,e))}mousedown(e,i){return this._mousedownPos=i,this._firePreventable(new _i(e.type,this._map,e))}mouseup(e){this._map.fire(new _i(e.type,this._map,e))}click(e,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||this._map.fire(new _i(e.type,this._map,e))}dblclick(e){return this._firePreventable(new _i(e.type,this._map,e))}mouseover(e){this._map.fire(new _i(e.type,this._map,e))}mouseout(e){this._map.fire(new _i(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ti(e.type,this._map,e))}touchmove(e){this._map.fire(new ti(e.type,this._map,e))}touchend(e){this._map.fire(new ti(e.type,this._map,e))}touchcancel(e){this._map.fire(new ti(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class rp{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new _i(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _i("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new _i(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bo{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(a.P.convert(e),this._map.terrain)}}class oh{constructor(e,i){this._map=e,this._tr=new bo(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,i){this.isEnabled()&&e.shiftKey&&e.button===0&&(te.disableDrag(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(e,i){if(!this._active)return;const s=i;if(this._lastPos.equals(s)||!this._box&&s.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=s,this._box||(this._box=te.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const d=Math.min(c.x,s.x),g=Math.max(c.x,s.x),b=Math.min(c.y,s.y),P=Math.max(c.y,s.y);te.setTransform(this._box,`translate(${d}px,${b}px)`),this._box.style.width=g-d+"px",this._box.style.height=P-b+"px"}mouseupWindow(e,i){if(!this._active||e.button!==0)return;const s=this._startPos,c=i;if(this.reset(),te.suppressClick(),s.x!==c.x||s.y!==c.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:e})),{cameraAnimation:d=>d.fitScreenCoordinates(s,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(te.remove(this._box),this._box=null),te.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new a.k(e,{originalEvent:i}))}}function du(p,e){if(p.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${e.length}`);const i={};for(let s=0;s<p.length;s++)i[p[s].identifier]=e[s];return i}class sh{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,s){(this.centroid||s.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),s.length===this.numTouches&&(this.centroid=function(c){const d=new a.P(0,0);for(const g of c)d._add(g);return d.div(c.length)}(i),this.touches=du(s,i)))}touchmove(e,i,s){if(this.aborted||!this.centroid)return;const c=du(s,i);for(const d in this.touches){const g=c[d];(!g||g.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(e,i,s){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),s.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class ta{constructor(e){this.singleTap=new sh(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,i,s){this.singleTap.touchstart(e,i,s)}touchmove(e,i,s){this.singleTap.touchmove(e,i,s)}touchend(e,i,s){const c=this.singleTap.touchend(e,i,s);if(c){const d=e.timeStamp-this.lastTime<500,g=!this.lastTap||this.lastTap.dist(c)<30;if(d&&g||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class os{constructor(e){this._tr=new bo(e),this._zoomIn=new ta({numTouches:1,numTaps:2}),this._zoomOut=new ta({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,i,s){this._zoomIn.touchstart(e,i,s),this._zoomOut.touchstart(e,i,s)}touchmove(e,i,s){this._zoomIn.touchmove(e,i,s),this._zoomOut.touchmove(e,i,s)}touchend(e,i,s){const c=this._zoomIn.touchend(e,i,s),d=this._zoomOut.touchend(e,i,s),g=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:g.zoom+1,around:g.unproject(c)},{originalEvent:e})}):d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:g.zoom-1,around:g.unproject(d)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xt{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const i=this._moveFunction(...e);if(i.bearingDelta||i.pitchDelta||i.rollDelta||i.around||i.panDelta)return this._active=!0,i}dragStart(e,i){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(i)?i[0]:i,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,i){if(!this.isEnabled())return;const s=this._lastPoint;if(!s)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const c=Array.isArray(i)?i[0]:i;return!this._moved&&c.dist(s)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(s,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&te.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ah={0:1,2:2};class ia{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const i=te.mouseButton(e);this._eventButton=i}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(i,s){const c=ah[s];return i.buttons===void 0||(i.buttons&c)!==c}(e,this._eventButton)}isValidEndEvent(e){return te.mouseButton(e)===this._eventButton}}class lh{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class dl{constructor(e=new ia({checkCorrectEvent:()=>!0}),i=new lh){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=i}_executeRelevantHandler(e,i,s){return e instanceof MouseEvent?i(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?s(e):void 0}startMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.startMove(i),i=>this.oneFingerTouchMoveStateManager.startMove(i))}endMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.endMove(i),i=>this.oneFingerTouchMoveStateManager.endMove(i))}isValidStartEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidStartEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidStartEvent(i))}isValidMoveEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidMoveEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(i))}isValidEndEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidEndEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidEndEvent(i))}}const Ps=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=e=>{e.preventDefault()}};class Vo{constructor(e,i){this._clickTolerance=e.clickTolerance||1,this._map=i,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,i,s){return this._calculateTransform(e,i,s)}touchmove(e,i,s){if(this._active){if(!this._shouldBePrevented(s.length))return e.preventDefault(),this._calculateTransform(e,i,s);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,i,s){this._calculateTransform(e,i,s),this._active&&this._shouldBePrevented(s.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,s){s.length>0&&(this._active=!0);const c=du(s,i),d=new a.P(0,0),g=new a.P(0,0);let b=0;for(const C in c){const z=c[C],R=this._touches[C];R&&(d._add(z),g._add(z.sub(R)),b++,c[C]=z)}if(this._touches=c,this._shouldBePrevented(b)||!g.mag())return;const P=g.div(b);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(b),panDelta:P}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ri{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,i,s){this._firstTwoTouches||s.length<2||(this._firstTwoTouches=[s[0].identifier,s[1].identifier],this._start([i[0],i[1]]))}touchmove(e,i,s){if(!this._firstTwoTouches)return;e.preventDefault();const[c,d]=this._firstTwoTouches,g=Ba(s,i,c),b=Ba(s,i,d);if(!g||!b)return;const P=this._aroundCenter?null:g.add(b).div(2);return this._move([g,b],P,e)}touchend(e,i,s){if(!this._firstTwoTouches)return;const[c,d]=this._firstTwoTouches,g=Ba(s,i,c),b=Ba(s,i,d);g&&b||(this._active&&te.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ba(p,e,i){for(let s=0;s<p.length;s++)if(p[s].identifier===i)return e[s]}function ch(p,e){return Math.log(p/e)/Math.LN2}class pc extends ri{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,i){const s=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ch(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ch(this._distance,s),pinchAround:i}}}function uh(p,e){return 180*p.angleWith(e)/Math.PI}class Ms extends ri{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,i,s){const c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:uh(this._vector,c),pinchAround:i}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const i=25/(Math.PI*this._minDiameter)*360,s=uh(e,this._startVector);return Math.abs(s)<i}}function dc(p){return Math.abs(p.y)>Math.abs(p.x)}class fc extends ri{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,i,s){super.touchstart(e,i,s),this._currentTouchCount=s.length}_start(e){this._lastPoints=e,dc(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,i,s){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=e[0].sub(this._lastPoints[0]),d=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,d,s.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(e,i,s){if(this._valid!==void 0)return this._valid;const c=e.mag()>=2,d=i.mag()>=2;if(!c&&!d)return;if(!c||!d)return this._firstMove===void 0&&(this._firstMove=s),s-this._firstMove<100&&void 0;const g=e.y>0==i.y>0;return dc(e)&&dc(i)&&g}}const so={panStep:100,bearingStep:15,pitchStep:10};class hh{constructor(e){this._tr=new bo(e);const i=so;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let i=0,s=0,c=0,d=0,g=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?s=-1:(e.preventDefault(),d=-1);break;case 39:e.shiftKey?s=1:(e.preventDefault(),d=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),g=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),g=1);break;default:return}return this._rotationDisabled&&(s=0,c=0),{cameraAnimation:b=>{const P=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:ph,zoom:i?Math.round(P.zoom)+i*(e.shiftKey?2:1):P.zoom,bearing:P.bearing+s*this._bearingStep,pitch:P.pitch+c*this._pitchStep,offset:[-d*this._panStep,-g*this._panStep],center:P.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ph(p){return p*(2-p)}const dh=4.000244140625;class fh{constructor(e,i){this._onTimeout=s=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)},this._map=e,this._tr=new bo(e),this._triggerRenderFrame=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const s=ge.now(),c=s-(this._lastWheelEventTime||0);this._lastWheelEventTime=s,i!==0&&i%dh==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=te.mousePos(this._map.getCanvas(),e),s=this._tr;this._aroundPoint=this._aroundCenter?s.transform.locationToScreenPoint(a.N.convert(s.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const b=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=b),typeof this._targetZoom=="number"&&(this._targetZoom+=b)}if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>dh?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&P!==0&&(P=1/P);const C=typeof this._targetZoom!="number"?e.scale:a.aG(this._targetZoom);this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,a.a8(C*P))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,s=this._startZoom,c=this._easing;let d,g=!1;if(this._type==="wheel"&&s&&c){const b=ge.now()-this._lastWheelEventTime,P=Math.min((b+5)/200,1),C=c(P);d=a.y.number(s,i,C),P<1?this._frameId||(this._frameId=!0):g=!0}else d=i,g=!0;return this._active=!0,g&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=d,{noInertia:!0,needsRenderFrame:!g,zoomDelta:d-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=a.c8;if(this._prevEase){const s=this._prevEase,c=(ge.now()-s.start)/s.duration,d=s.easing(c+.01)-s.easing(c),g=.27/Math.sqrt(d*d+1e-4)*.01,b=Math.sqrt(.0729-g*g);i=a.c6(g,b,.25,1)}return this._prevEase={start:ge.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ss{constructor(e,i){this._clickZoom=e,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vi{constructor(e){this._tr=new bo(e),this.reset()}reset(){this._active=!1}dblclick(e,i){return e.preventDefault(),{cameraAnimation:s=>{s.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fl{constructor(){this._tap=new ta({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,i,s){if(!this._swipePoint)if(this._tapTime){const c=i[0],d=e.timeStamp-this._tapTime<500,g=this._tapPoint.dist(c)<30;d&&g?s.length>0&&(this._swipePoint=c,this._swipeTouch=s[0].identifier):this.reset()}else this._tap.touchstart(e,i,s)}touchmove(e,i,s){if(this._tapTime){if(this._swipePoint){if(s[0].identifier!==this._swipeTouch)return;const c=i[0],d=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(e,i,s)}touchend(e,i,s){if(this._tapTime)this._swipePoint&&s.length===0&&this.reset();else{const c=this._tap.touchend(e,i,s);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mc{constructor(e,i,s){this._el=e,this._mousePan=i,this._touchPan=s}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fu{constructor(e,i,s,c){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=i,this._mousePitch=s,this._mouseRoll=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class ml{constructor(e,i,s,c){this._el=e,this._touchZoom=i,this._touchRotate=s,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class na{constructor(e,i){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=i,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=te.create("div","maplibregl-cooperative-gesture-screen",e);let i=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(i=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const s=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=i,this._container.appendChild(c);const d=document.createElement("div");d.className="maplibregl-mobile-message",d.textContent=s,this._container.appendChild(d),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(te.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,i){this._enabled&&(this._map.fire(new a.k("cooperativegestureprevented",{gestureType:e,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ra=p=>p.zoom||p.drag||p.roll||p.pitch||p.rotate;class Uo extends a.k{}function oa(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta||p.rollDelta}class Et{constructor(e,i){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,d)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const g=c.type==="renderFrame"?void 0:c,b={needsRenderFrame:!1},P={},C={},z=c.touches,R=z?this._getMapTouches(z):void 0,B=R?te.touchPos(this._map.getCanvas(),R):te.mousePos(this._map.getCanvas(),c);for(const{handlerName:ne,handler:ie,allowed:re}of this._handlers){if(!ie.isEnabled())continue;let se;this._blockedByActive(C,re,ne)?ie.reset():ie[d||c.type]&&(se=ie[d||c.type](c,B,R),this.mergeHandlerResult(b,P,se,ne,g),se&&se.needsRenderFrame&&this._triggerRenderFrame()),(se||ie.isActive())&&(C[ne]=ie)}const V={};for(const ne in this._previousActiveHandlers)C[ne]||(V[ne]=g);this._previousActiveHandlers=C,(Object.keys(V).length||oa(b))&&(this._changes.push([b,P,V]),this._triggerRenderFrame()),(Object.keys(C).length||oa(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=b;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new X(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);const s=this._el;this._listeners=[[s,"touchstart",{passive:!0}],[s,"touchmove",{passive:!1}],[s,"touchend",void 0],[s,"touchcancel",void 0],[s,"mousedown",void 0],[s,"mousemove",void 0],[s,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[s,"mouseover",void 0],[s,"mouseout",void 0],[s,"dblclick",void 0],[s,"click",void 0],[s,"keydown",{capture:!1}],[s,"keyup",void 0],[s,"wheel",{passive:!1}],[s,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,d,g]of this._listeners)te.addEventListener(c,d,c===document?this.handleWindowEvent:this.handleEvent,g)}destroy(){for(const[e,i,s]of this._listeners)te.removeEventListener(e,i,e===document?this.handleWindowEvent:this.handleEvent,s)}_addDefaultHandlers(e){const i=this._map,s=i.getCanvasContainer();this._add("mapEvent",new La(i,e));const c=i.boxZoom=new oh(i,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();const d=i.cooperativeGestures=new na(i,e.cooperativeGestures);this._add("cooperativeGestures",d),e.cooperativeGestures&&d.enable();const g=new os(i),b=new Vi(i);i.doubleClickZoom=new ss(b,g),this._add("tapZoom",g),this._add("clickZoom",b),e.interactive&&e.doubleClickZoom&&i.doubleClickZoom.enable();const P=new fl;this._add("tapDragZoom",P);const C=i.touchPitch=new fc(i);this._add("touchPitch",C),e.interactive&&e.touchPitch&&i.touchPitch.enable(e.touchPitch);const z=()=>i.project(i.getCenter()),R=function({enable:he,clickTolerance:me,aroundCenter:ve=!0,minPixelCenterThreshold:ye=100,rotateDegreesPerPixelMoved:ze=.8},Le){const Ve=new ia({checkCorrectEvent:He=>te.mouseButton(He)===0&&He.ctrlKey||te.mouseButton(He)===2&&!He.ctrlKey});return new xt({clickTolerance:me,move:(He,je)=>{const We=Le();if(ve&&Math.abs(We.y-He.y)>ye)return{bearingDelta:a.c7(new a.P(He.x,je.y),je,We)};let ft=(je.x-He.x)*ze;return ve&&je.y<We.y&&(ft=-ft),{bearingDelta:ft}},moveStateManager:Ve,enable:he,assignEvents:Ps})}(e,z),B=function({enable:he,clickTolerance:me,pitchDegreesPerPixelMoved:ve=-.5}){const ye=new ia({checkCorrectEvent:ze=>te.mouseButton(ze)===0&&ze.ctrlKey||te.mouseButton(ze)===2});return new xt({clickTolerance:me,move:(ze,Le)=>({pitchDelta:(Le.y-ze.y)*ve}),moveStateManager:ye,enable:he,assignEvents:Ps})}(e),V=function({enable:he,clickTolerance:me,rollDegreesPerPixelMoved:ve=.3},ye){const ze=new ia({checkCorrectEvent:Le=>te.mouseButton(Le)===2&&Le.ctrlKey});return new xt({clickTolerance:me,move:(Le,Ve)=>{const He=ye();let je=(Ve.x-Le.x)*ve;return Ve.y<He.y&&(je=-je),{rollDelta:je}},moveStateManager:ze,enable:he,assignEvents:Ps})}(e,z);i.dragRotate=new fu(e,R,B,V),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",B,["mouseRotate","mouseRoll"]),this._add("mouseRoll",V,["mousePitch"]),e.interactive&&e.dragRotate&&i.dragRotate.enable();const Z=function({enable:he,clickTolerance:me}){const ve=new ia({checkCorrectEvent:ye=>te.mouseButton(ye)===0&&!ye.ctrlKey});return new xt({clickTolerance:me,move:(ye,ze)=>({around:ze,panDelta:ze.sub(ye)}),activateOnStart:!0,moveStateManager:ve,enable:he,assignEvents:Ps})}(e),ne=new Vo(e,i);i.dragPan=new mc(s,Z,ne),this._add("mousePan",Z),this._add("touchPan",ne,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&i.dragPan.enable(e.dragPan);const ie=new Ms,re=new pc;i.touchZoomRotate=new ml(s,re,ie,P),this._add("touchRotate",ie,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&i.touchZoomRotate.enable(e.touchZoomRotate);const se=i.scrollZoom=new fh(i,()=>this._triggerRenderFrame());this._add("scrollZoom",se,["mousePan"]),e.interactive&&e.scrollZoom&&i.scrollZoom.enable(e.scrollZoom);const ue=i.keyboard=new hh(i);this._add("keyboard",ue),e.interactive&&e.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new rp(i))}_add(e,i,s){this._handlers.push({handlerName:e,handler:i,allowed:s}),this._handlersById[e]=i}stop(e){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ra(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,i,s){for(const c in e)if(c!==s&&(!i||i.indexOf(c)<0))return!0;return!1}_getMapTouches(e){const i=[];for(const s of e)this._el.contains(s.target)&&i.push(s);return i}mergeHandlerResult(e,i,s,c,d){if(!s)return;a.e(e,s);const g={handlerName:c,originalEvent:s.originalEvent||d};s.zoomDelta!==void 0&&(i.zoom=g),s.panDelta!==void 0&&(i.drag=g),s.rollDelta!==void 0&&(i.roll=g),s.pitchDelta!==void 0&&(i.pitch=g),s.bearingDelta!==void 0&&(i.rotate=g)}_applyChanges(){const e={},i={},s={};for(const[c,d,g]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new a.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.rollDelta&&(e.rollDelta=(e.rollDelta||0)+c.rollDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),a.e(i,d),a.e(s,g);this._updateMapTransform(e,i,s),this._changes=[]}_updateMapTransform(e,i,s){const c=this._map,d=c._getTransformForUpdate(),g=c.terrain;if(!(oa(e)||g&&this._terrainMovement))return this._fireEvents(i,s,!0);c._stop(!0);let{panDelta:b,zoomDelta:P,bearingDelta:C,pitchDelta:z,rollDelta:R,around:B,pinchAround:V}=e;V!==void 0&&(B=V),B=B||c.transform.centerPoint,g&&!d.isPointOnMapSurface(B)&&(B=d.centerPoint);const Z={panDelta:b,zoomDelta:P,rollDelta:R,pitchDelta:z,bearingDelta:C,around:B};this._map.cameraHelper.useGlobeControls&&!d.isPointOnMapSurface(B)&&(B=d.centerPoint);const ne=B.distSqr(d.centerPoint)<.01?d.center:d.screenPointToLocation(b?B.sub(b):B);g?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Z,d),this._terrainMovement||!i.drag&&!i.zoom?i.drag&&this._terrainMovement?d.setCenter(d.screenPointToLocation(d.centerPoint.sub(b))):this._map.cameraHelper.handleMapControlsPan(Z,d,ne):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(Z,d,ne))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Z,d),this._map.cameraHelper.handleMapControlsPan(Z,d,ne)),c._applyUpdatedTransform(d),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,s,!0)}_fireEvents(e,i,s){const c=ra(this._eventsInProgress),d=ra(e),g={};for(const R in e){const{originalEvent:B}=e[R];this._eventsInProgress[R]||(g[`${R}start`]=B),this._eventsInProgress[R]=e[R]}!c&&d&&this._fireEvent("movestart",d.originalEvent);for(const R in g)this._fireEvent(R,g[R]);d&&this._fireEvent("move",d.originalEvent);for(const R in e){const{originalEvent:B}=e[R];this._fireEvent(R,B)}const b={};let P;for(const R in this._eventsInProgress){const{handlerName:B,originalEvent:V}=this._eventsInProgress[R];this._handlersById[B].isActive()||(delete this._eventsInProgress[R],P=i[B]||V,b[`${R}end`]=P)}for(const R in b)this._fireEvent(R,b[R]);const C=ra(this._eventsInProgress),z=(c||d)&&!C;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const R=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&R.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(R)}if(s&&z){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;!R||!R.essential&&ge.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:P})),B(this._map.getBearing())&&this._map.resetNorth()):(B(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:P})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new a.k(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Uo("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class kt extends a.E{constructor(e,i,s){super(),this._renderFrameCallback=()=>{const c=Math.min((ge.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.cameraHelper=i,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,i){e.apply(this.transform),this.transform=e,this.cameraHelper=i}getCenter(){return new a.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,i){return this.jumpTo({center:e},i)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,i){return this.jumpTo({elevation:e},i),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,i,s){return e=a.P.convert(e).mult(-1),this.panTo(this.transform.center,a.e({offset:e},i),s)}panTo(e,i,s){return this.easeTo(a.e({center:e},i),s)}getZoom(){return this.transform.zoom}setZoom(e,i){return this.jumpTo({zoom:e},i),this}zoomTo(e,i,s){return this.easeTo(a.e({zoom:e},i),s)}zoomIn(e,i){return this.zoomTo(this.getZoom()+1,e,i),this}zoomOut(e,i){return this.zoomTo(this.getZoom()-1,e,i),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,i){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new a.k("movestart",i)).fire(new a.k("move",i)).fire(new a.k("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(e,i){return this.jumpTo({bearing:e},i),this}getPadding(){return this.transform.padding}setPadding(e,i){return this.jumpTo({padding:e},i),this}rotateTo(e,i,s){return this.easeTo(a.e({bearing:e},i),s)}resetNorth(e,i){return this.rotateTo(0,a.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},e),i),this}snapToNorth(e,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,i):this}getPitch(){return this.transform.pitch}setPitch(e,i){return this.jumpTo({pitch:e},i),this}getRoll(){return this.transform.roll}setRoll(e,i){return this.jumpTo({roll:e},i),this}cameraForBounds(e,i){e=mi.convert(e).adjustAntiMeridian();const s=i&&i.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),s,i)}_cameraForBoxAndBearing(e,i,s,c){const d={top:0,bottom:0,right:0,left:0};if(typeof(c=a.e({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const C=c.padding;c.padding={top:C,bottom:C,right:C,left:C}}const g=a.e(d,c.padding);c.padding=g;const b=this.transform,P=new mi(e,i);return this.cameraHelper.cameraForBoxAndBearing(c,g,P,s,b)}fitBounds(e,i,s){return this._fitInternal(this.cameraForBounds(e,i),i,s)}fitScreenCoordinates(e,i,s,c,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(e)),this.transform.screenPointToLocation(a.P.convert(i)),s,c),c,d)}_fitInternal(e,i,s){return e?(delete(i=a.e(e,i)).padding,i.linear?this.easeTo(i,s):this.flyTo(i,s)):this}jumpTo(e,i){this.stop();const s=this._getTransformForUpdate();let c=!1,d=!1,g=!1;const b=s.zoom;this.cameraHelper.handleJumpToCenterZoom(s,e);const P=s.zoom!==b;return"elevation"in e&&s.elevation!==+e.elevation&&s.setElevation(+e.elevation),"bearing"in e&&s.bearing!==+e.bearing&&(c=!0,s.setBearing(+e.bearing)),"pitch"in e&&s.pitch!==+e.pitch&&(d=!0,s.setPitch(+e.pitch)),"roll"in e&&s.roll!==+e.roll&&(g=!0,s.setRoll(+e.roll)),e.padding==null||s.isPaddingEqual(e.padding)||s.setPadding(e.padding),this._applyUpdatedTransform(s),this.fire(new a.k("movestart",i)).fire(new a.k("move",i)),P&&this.fire(new a.k("zoomstart",i)).fire(new a.k("zoom",i)).fire(new a.k("zoomend",i)),c&&this.fire(new a.k("rotatestart",i)).fire(new a.k("rotate",i)).fire(new a.k("rotateend",i)),d&&this.fire(new a.k("pitchstart",i)).fire(new a.k("pitch",i)).fire(new a.k("pitchend",i)),g&&this.fire(new a.k("rollstart",i)).fire(new a.k("roll",i)).fire(new a.k("rollend",i)),this.fire(new a.k("moveend",i))}calculateCameraOptionsFromTo(e,i,s,c=0){const d=a.Y.fromLngLat(e,i),g=a.Y.fromLngLat(s,c),b=g.x-d.x,P=g.y-d.y,C=g.z-d.z,z=Math.hypot(b,P,C);if(z===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(b,P),B=a.a8(this.transform.cameraToCenterDistance/z/this.transform.tileSize),V=180*Math.atan2(b,-P)/Math.PI;let Z=180*Math.acos(R/z)/Math.PI;return Z=C<0?90-Z:90+Z,{center:g.toLngLat(),elevation:c,zoom:B,pitch:Z,bearing:V}}calculateCameraOptionsFromCameraLngLatAltRotation(e,i,s,c,d){const g=this.transform.calculateCenterFromCameraLngLatAlt(e,i,s,c);return{center:g.center,elevation:g.elevation,zoom:g.zoom,bearing:s,pitch:c,roll:d}}easeTo(e,i){this._stop(!1,e.easeId),((e=a.e({offset:[0,0],duration:500,easing:a.c8},e)).animate===!1||!e.essential&&ge.prefersReducedMotion)&&(e.duration=0);const s=this._getTransformForUpdate(),c=this.getBearing(),d=s.pitch,g=s.roll,b="bearing"in e?this._normalizeBearing(e.bearing,c):c,P="pitch"in e?+e.pitch:d,C="roll"in e?this._normalizeBearing(e.roll,g):g,z="padding"in e?e.padding:s.padding,R=a.P.convert(e.offset);let B,V;e.around&&(B=a.N.convert(e.around),V=s.locationToScreenPoint(B));const Z={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ne=this.cameraHelper.handleEaseTo(s,{bearing:b,pitch:P,roll:C,padding:z,around:B,aroundPoint:V,offsetAsPoint:R,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||c!==b,this._pitching=this._pitching||P!==d,this._rolling=this._rolling||C!==g,this._padding=!s.isPaddingEqual(z),this._zooming=this._zooming||ne.isZooming,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,Z),this.terrain&&this._prepareElevation(ne.elevationCenter),this._ease(ie=>{ne.easeFunc(ie),this.terrain&&!e.freezeElevation&&this._updateElevation(ie),this._applyUpdatedTransform(s),this._fireMoveEvents(i)},ie=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i,ie)},e),this}_prepareEase(e,i,s={}){this._moving=!0,i||s.moving||this.fire(new a.k("movestart",e)),this._zooming&&!s.zooming&&this.fire(new a.k("zoomstart",e)),this._rotating&&!s.rotating&&this.fire(new a.k("rotatestart",e)),this._pitching&&!s.pitching&&this.fire(new a.k("pitchstart",e)),this._rolling&&!s.rolling&&this.fire(new a.k("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const s=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(s-(i-(s*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.setElevation(a.y.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const i=e.getCameraLngLat(),s=e.getCameraAltitude(),c=this.terrain?this.terrain.getElevationForLngLatZoom(i,e.zoom):0;if(s<c){const d=this.calculateCameraOptionsFromTo(i,c,e.center,e.elevation);return{pitch:d.pitch,zoom:d.zoom}}return{}}_applyUpdatedTransform(e){const i=[];if(i.push(c=>this._elevateCameraIfInsideTerrain(c)),this.transformCameraUpdate&&i.push(c=>this.transformCameraUpdate(c)),!i.length)return;const s=e.clone();for(const c of i){const d=s.clone(),{center:g,zoom:b,roll:P,pitch:C,bearing:z,elevation:R}=c(d);g&&d.setCenter(g),R!==void 0&&d.setElevation(R),b!==void 0&&d.setZoom(b),P!==void 0&&d.setRoll(P),C!==void 0&&d.setPitch(C),z!==void 0&&d.setBearing(z),s.apply(d)}this.transform.apply(s)}_fireMoveEvents(e){this.fire(new a.k("move",e)),this._zooming&&this.fire(new a.k("zoom",e)),this._rotating&&this.fire(new a.k("rotate",e)),this._pitching&&this.fire(new a.k("pitch",e)),this._rolling&&this.fire(new a.k("roll",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const s=this._zooming,c=this._rotating,d=this._pitching,g=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,s&&this.fire(new a.k("zoomend",e)),c&&this.fire(new a.k("rotateend",e)),d&&this.fire(new a.k("pitchend",e)),g&&this.fire(new a.k("rollend",e)),this.fire(new a.k("moveend",e))}flyTo(e,i){if(!e.essential&&ge.prefersReducedMotion){const je=a.M(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(je,i)}this.stop(),e=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.c8},e);const s=this._getTransformForUpdate(),c=s.bearing,d=s.pitch,g=s.roll,b=s.padding,P="bearing"in e?this._normalizeBearing(e.bearing,c):c,C="pitch"in e?+e.pitch:d,z="roll"in e?this._normalizeBearing(e.roll,g):g,R="padding"in e?e.padding:s.padding,B=a.P.convert(e.offset);let V=s.centerPoint.add(B);const Z=s.screenPointToLocation(V),ne=this.cameraHelper.handleFlyTo(s,{bearing:P,pitch:C,roll:z,padding:R,locationAtOffset:Z,offsetAsPoint:B,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let ie=e.curve;const re=Math.max(s.width,s.height),se=re/ne.scaleOfZoom,ue=ne.pixelPathLength;typeof ne.scaleOfMinZoom=="number"&&(ie=Math.sqrt(re/ne.scaleOfMinZoom/ue*2));const he=ie*ie;function me(je){const We=(se*se-re*re+(je?-1:1)*he*he*ue*ue)/(2*(je?se:re)*he*ue);return Math.log(Math.sqrt(We*We+1)-We)}function ve(je){return(Math.exp(je)-Math.exp(-je))/2}function ye(je){return(Math.exp(je)+Math.exp(-je))/2}const ze=me(!1);let Le=function(je){return ye(ze)/ye(ze+ie*je)},Ve=function(je){return re*((ye(ze)*(ve(We=ze+ie*je)/ye(We))-ve(ze))/he)/ue;var We},He=(me(!0)-ze)/ie;if(Math.abs(ue)<2e-6||!isFinite(He)){if(Math.abs(re-se)<1e-6)return this.easeTo(e,i);const je=se<re?-1:1;He=Math.abs(Math.log(se/re))/ie,Ve=()=>0,Le=We=>Math.exp(je*ie*We)}return e.duration="duration"in e?+e.duration:1e3*He/("screenSpeed"in e?+e.screenSpeed/ie:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=c!==P,this._pitching=C!==d,this._rolling=z!==g,this._padding=!s.isPaddingEqual(R),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(ne.targetCenter),this._ease(je=>{const We=je*He,ft=1/Le(We),et=Ve(We);this._rotating&&s.setBearing(a.y.number(c,P,je)),this._pitching&&s.setPitch(a.y.number(d,C,je)),this._rolling&&s.setRoll(a.y.number(g,z,je)),this._padding&&(s.interpolatePadding(b,R,je),V=s.centerPoint.add(B)),ne.easeFunc(je,ft,et,V),this.terrain&&!e.freezeElevation&&this._updateElevation(je),this._applyUpdatedTransform(s),this._fireMoveEvents(i)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,i){var s;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,i)}return e||(s=this.handlers)===null||s===void 0||s.stop(!1),this}_ease(e,i,s){s.animate===!1||s.duration===0?(e(1),i()):(this._easeStart=ge.now(),this._easeOptions=s,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=a.aI(e,-180,180);const s=Math.abs(e-i);return Math.abs(e-360-i)<s&&(e-=360),Math.abs(e+360-i)<s&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(a.N.convert(e),this.transform.tileZoom):null}}const sa={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Go{constructor(e=sa){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=i=>{!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"&&i.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=te.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=te.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=te.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){te.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._sanitizedAttributionHTML=void 0}_setElementTitle(e,i){const s=this._map._getUIString(`AttributionControl.${i}`);e.title=s,e.setAttribute("aria-label",s)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const i=this._map.style.sourceCaches;for(const c in i){const d=i[c];if(d.used||d.usedForTerrain){const g=d.getSource();g.attribution&&e.indexOf(g.attribution)<0&&e.push(g.attribution)}}e=e.filter(c=>String(c).trim()),e.sort((c,d)=>c.length-d.length),e=e.filter((c,d)=>{for(let g=d+1;g<e.length;g++)if(e[g].indexOf(c)>=0)return!1;return!0});const s=e.join(" | ");s!==this._sanitizedAttributionHTML&&(this._sanitizedAttributionHTML=te.sanitize(s),e.length?(this._innerContainer.innerHTML=this._sanitizedAttributionHTML,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class _r{constructor(e={}){this._updateCompact=()=>{const i=this._container.children;if(i.length){const s=i[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&s.classList.add("maplibregl-compact"):s.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=te.create("div","maplibregl-ctrl");const i=te.create("a","maplibregl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://maplibre.org/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){te.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Er{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const i=++this._id;return this._queue.push({callback:e,id:i,cancelled:!1}),i}remove(e){const i=this._currentlyRunning,s=i?this._queue.concat(i):this._queue;for(const c of s)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const i=this._currentlyRunning=this._queue;this._queue=[];for(const s of i)if(!s.cancelled&&(s.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var mu=a.aA([{name:"a_pos3d",type:"Int16",components:3}]);class wo extends a.E{constructor(e){super(),this._lastTilesetChange=ge.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const s={};for(const c of Q(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))s[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.terrainRttPosMatrix32f=new Float64Array(16),a.bL(c.terrainRttPosMatrix32f,0,a.X,a.X,0,0,1),this._tiles[c.key]=new Mr(c,this.tileSize),this._lastTilesetChange=ge.now());for(const c in this._tiles)s[c]||delete this._tiles[c]}freeRtt(e){for(const i in this._tiles){const s=this._tiles[i];(!e||s.tileID.equals(e)||s.tileID.isChildOf(e)||e.isChildOf(s.tileID))&&(s.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const i={};for(const s of this._renderableTilesKeys){const c=this._tiles[s].tileID,d=e.clone(),g=a.a$();if(c.canonical.equals(e.canonical))a.bL(g,0,a.X,a.X,0,0,1);else if(c.canonical.isChildOf(e.canonical)){const b=c.canonical.z-e.canonical.z,P=c.canonical.x-(c.canonical.x>>b<<b),C=c.canonical.y-(c.canonical.y>>b<<b),z=a.X>>b;a.bL(g,0,z,z,0,0,1),a.J(g,g,[-P*z,-C*z,0])}else{if(!e.canonical.isChildOf(c.canonical))continue;{const b=e.canonical.z-c.canonical.z,P=e.canonical.x-(e.canonical.x>>b<<b),C=e.canonical.y-(e.canonical.y>>b<<b),z=a.X>>b;a.bL(g,0,a.X,a.X,0,0,1),a.J(g,g,[P*z,C*z,0]),a.K(g,g,[1/2**b,1/2**b,0])}}d.terrainRttPosMatrix32f=new Float32Array(g),i[s]=d}return i}getSourceTile(e,i){const s=this.sourceCache._source;let c=e.overscaledZ-this.deltaZoom;if(c>s.maxzoom&&(c=s.maxzoom),c<s.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!d||!d.dem)&&i)for(;c>=s.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(e.scaledTo(c--).key);return d}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}}class gl{constructor(e,i,s){this._meshCache={},this.painter=e,this.sourceCache=new wo(i),this.options=s,this.exaggeration=typeof s.exaggeration=="number"?s.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,s,c=a.X){var d;if(!(i>=0&&i<c&&s>=0&&s<c))return 0;const g=this.getTerrainData(e),b=(d=g.tile)===null||d===void 0?void 0:d.dem;if(!b)return 0;const P=a.c9([],[i/c*a.X,s/c*a.X],g.u_terrain_matrix),C=[P[0]*b.dim,P[1]*b.dim],z=Math.floor(C[0]),R=Math.floor(C[1]),B=C[0]-z,V=C[1]-R;return b.get(z,R)*(1-B)*(1-V)+b.get(z+1,R)*B*(1-V)+b.get(z,R+1)*(1-B)*V+b.get(z+1,R+1)*B*V}getElevationForLngLatZoom(e,i){if(!a.ca(i,e.wrap()))return 0;const{tileID:s,mercatorX:c,mercatorY:d}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(s,c%a.X,d%a.X,a.X)}getElevation(e,i,s,c=a.X){return this.getDEMElevation(e,i,s,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const c=this.painter.context,d=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Tt(c,d,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Tt(c,new a.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.aq([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const c=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new Tt(c,i.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),i.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const s=i&&i+i.tileID.key+e.key;if(s&&!this._demMatrixCache[s]){const c=this.sourceCache.sourceCache._source.maxzoom;let d=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?d=e.canonical.z-c:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const g=e.canonical.x-(e.canonical.x>>d<<d),b=e.canonical.y-(e.canonical.y>>d<<d),P=a.cb(new Float64Array(16),[1/(a.X<<d),1/(a.X<<d),0]);a.J(P,P,[g*a.X,b*a.X,0]),this._demMatrixCache[e.key]={matrix:P,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:s?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(e){const i=this.painter,s=i.width/devicePixelRatio,c=i.height/devicePixelRatio;return!this._fbo||this._fbo.width===s&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Tt(i.context,{width:s,height:c,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Tt(i.context,{width:s,height:c,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=i.context.createFramebuffer(s,c,!0,!1),this._fbo.depthAttachment.set(i.context.createRenderbuffer(i.context.gl.DEPTH_COMPONENT16,s,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,g=0;d<this._coordsTextureSize;d++)for(let b=0;b<this._coordsTextureSize;b++,g+=4)i[g+0]=255&b,i[g+1]=255&d,i[g+2]=b>>8<<4|d>>8,i[g+3]=0;const s=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),c=new Tt(e,s,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),s=this.painter.context,c=s.gl,d=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),g=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);s.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(d,b-g-1,1,1,c.RGBA,c.UNSIGNED_BYTE,i),s.bindFramebuffer.set(null);const P=i[0]+(i[2]>>4<<8),C=i[1]+((15&i[2])<<8),z=this.coordsIndex[255-i[3]],R=z&&this.sourceCache.getTileByID(z);if(!R)return null;const B=this._coordsTextureSize,V=(1<<R.tileID.canonical.z)*B;return new a.Y((R.tileID.canonical.x*B+P)/V+R.tileID.wrap,(R.tileID.canonical.y*B+C)/V,this.getElevation(R.tileID,P,C,B))}depthAtPoint(e){const i=new Uint8Array(4),s=this.painter.context,c=s.gl;return s.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,i),s.bindFramebuffer.set(null),(i[0]/16777216+i[1]/65536+i[2]/256+i[3])/256}getTerrainMesh(e){var i;const s=((i=this.painter.style.projection)===null||i===void 0?void 0:i.transitionState)>0,c=s&&e.canonical.y===0,d=s&&e.canonical.y===(1<<e.canonical.z)-1,g=`m_${c?"n":""}_${d?"s":""}`;if(this._meshCache[g])return this._meshCache[g];const b=this.painter.context,P=new a.cc,C=new a.aE,z=this.meshSize,R=a.X/z,B=z*z;for(let ye=0;ye<=z;ye++)for(let ze=0;ze<=z;ze++)P.emplaceBack(ze*R,ye*R,0);for(let ye=0;ye<B;ye+=z+1)for(let ze=0;ze<z;ze++)C.emplaceBack(ze+ye,z+ze+ye+1,z+ze+ye+2),C.emplaceBack(ze+ye,z+ze+ye+2,ze+ye+1);const V=P.length,Z=V+(z+1),ne=(z+1)*z,ie=c?a.b6:0,re=c?0:1,se=d?a.b7:a.X,ue=d?0:1;for(let ye=0;ye<=z;ye++)P.emplaceBack(ye*R,ie,re);for(let ye=0;ye<=z;ye++)P.emplaceBack(ye*R,se,ue);for(let ye=0;ye<z;ye++)C.emplaceBack(ne+ye,Z+ye,Z+ye+1),C.emplaceBack(ne+ye,Z+ye+1,ne+ye+1),C.emplaceBack(0+ye,V+ye+1,V+ye),C.emplaceBack(0+ye,0+ye+1,V+ye+1);const he=P.length,me=he+2*(z+1);for(const ye of[0,1])for(let ze=0;ze<=z;ze++)for(const Le of[0,1])P.emplaceBack(ye*a.X,ze*R,Le);for(let ye=0;ye<2*z;ye+=2)C.emplaceBack(he+ye,he+ye+1,he+ye+3),C.emplaceBack(he+ye,he+ye+3,he+ye+2),C.emplaceBack(me+ye,me+ye+3,me+ye+1),C.emplaceBack(me+ye,me+ye+2,me+ye+3);const ve=new _o(b.createVertexBuffer(P,mu.members),b.createIndexBuffer(C),a.aD.simpleSegment(0,0,P.length,C.length));return this._meshCache[g]=ve,ve}getMeshFrameDelta(e){return 2*Math.PI*a.bo/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,i){var s;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,i);return(s=this.getMinMaxElevation(c).minElevation)!==null&&s!==void 0?s:0}getMinMaxElevation(e){const i=this.getTerrainData(e).tile,s={minElevation:null,maxElevation:null};return i&&i.dem&&(s.minElevation=i.dem.min*this.exaggeration,s.maxElevation=i.dem.max*this.exaggeration),s}_getOverscaledTileIDFromLngLatZoom(e,i){const s=a.Y.fromLngLat(e.wrap()),c=(1<<i)*a.X,d=s.x*c,g=s.y*c,b=Math.floor(d/a.X),P=Math.floor(g/a.X);return{tileID:new a.S(i,0,i,b,P),mercatorX:d,mercatorY:g}}}class ao{constructor(e,i,s){this._context=e,this._size=i,this._tileSize=s,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const i=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),s=new Tt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return s.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),i.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),i.colorAttachment.set(s.texture),{id:e,fbo:i,texture:s,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(i=>e.id!==i),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const i of this._recentlyUsed)if(!this._objects[i].inUse)return this._objects[i];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Di={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class wn{constructor(e,i){this.painter=e,this.terrain=i,this.pool=new ao(e.context,30,i.sourceCache.tileSize*i.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,i){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(s=>!e._layers[s].isHidden(i)),this._coordsAscending={};for(const s in e.sourceCaches){this._coordsAscending[s]={};const c=e.sourceCaches[s].getVisibleCoordinates();for(const d of c){const g=this.terrain.sourceCache.getTerrainCoords(d);for(const b in g)this._coordsAscending[s][b]||(this._coordsAscending[s][b]=[]),this._coordsAscending[s][b].push(g[b])}}this._coordsAscendingStr={};for(const s of e._order){const c=e._layers[s],d=c.source;if(Di[c.type]&&!this._coordsAscendingStr[d]){this._coordsAscendingStr[d]={};for(const g in this._coordsAscending[d])this._coordsAscendingStr[d][g]=this._coordsAscending[d][g].map(b=>b.key).sort().join()}}for(const s of this._renderableTiles)for(const c in this._coordsAscendingStr){const d=this._coordsAscendingStr[c][s.tileID.key];d&&d!==s.rttCoords[c]&&(s.rtt=[])}}renderLayer(e,i){if(e.isHidden(this.painter.transform.zoom))return!1;const s=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),c=e.type,d=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Di[c]&&(this._prevType&&Di[this._prevType]||this._stacks.push([]),this._prevType=c,this._stacks[this._stacks.length-1].push(e.id),!g))return!0;if(Di[this._prevType]||Di[c]&&g){this._prevType=c;const b=this._stacks.length-1,P=this._stacks[b]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(Qs(this.painter,this.terrain,this._rttTiles,s),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[b]){const R=this.pool.getObjectForId(C.rtt[b].id);if(R.stamp===C.rtt[b].stamp){this.pool.useObject(R);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),C.rtt[b]={id:z.id,stamp:z.stamp},d.context.bindFramebuffer.set(z.fbo.framebuffer),d.context.clear({color:a.b4.transparent,stencil:0}),d.currentStencilSource=void 0;for(let R=0;R<P.length;R++){const B=d.style._layers[P[R]],V=B.source?this._coordsAscending[B.source][C.tileID.key]:[C.tileID];d.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),d._renderTileClippingMasks(B,V,!0),d.renderLayer(d,d.style.sourceCaches[B.source],B,V,s),B.source&&(C.rttCoords[B.source]=this._coordsAscendingStr[B.source][C.tileID.key])}}return Qs(this.painter,this.terrain,this._rttTiles,s),this._rttTiles=[],this.pool.freeAllObjects(),Di[c]}return!1}}const _l={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},yl=q,Fa={hash:!1,interactive:!0,bearingSnap:7,attributionControl:sa,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},On={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class vl{constructor(e,i,s=!1){this.mousedown=d=>{this.startMove(d,te.mousePos(this.element,d)),te.addEventListener(window,"mousemove",this.mousemove),te.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=d=>{this.move(d,te.mousePos(this.element,d))},this.mouseup=d=>{this._rotatePitchHanlder.dragEnd(d),this.offTemp()},this.touchstart=d=>{d.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=te.touchPos(this.element,d.targetTouches)[0],this.startMove(d,this._startPos),te.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),te.addEventListener(window,"touchend",this.touchend))},this.touchmove=d=>{d.targetTouches.length!==1?this.reset():(this._lastPos=te.touchPos(this.element,d.targetTouches)[0],this.move(d,this._lastPos))},this.touchend=d=>{d.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;const c=new dl;this._rotatePitchHanlder=new xt({clickTolerance:3,move:(d,g)=>{const b=i.getBoundingClientRect(),P=new a.P((b.bottom-b.top)/2,(b.right-b.left)/2);return{bearingDelta:a.c7(new a.P(d.x,g.y),g,P),pitchDelta:s?-.5*(g.y-d.y):void 0}},moveStateManager:c,enable:!0,assignEvents:()=>{}}),this.map=e,te.addEventListener(i,"mousedown",this.mousedown),te.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),te.addEventListener(i,"touchcancel",this.reset)}startMove(e,i){this._rotatePitchHanlder.dragStart(e,i),te.disableDrag()}move(e,i){const s=this.map,{bearingDelta:c,pitchDelta:d}=this._rotatePitchHanlder.dragMove(e,i)||{};c&&s.setBearing(s.getBearing()+c),d&&s.setPitch(s.getPitch()+d)}off(){const e=this.element;te.removeEventListener(e,"mousedown",this.mousedown),te.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),te.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),te.removeEventListener(window,"touchend",this.touchend),te.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){te.enableDrag(),te.removeEventListener(window,"mousemove",this.mousemove),te.removeEventListener(window,"mouseup",this.mouseup),te.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),te.removeEventListener(window,"touchend",this.touchend)}}let Zo;function yr(p,e,i){const s=new a.N(p.lng,p.lat);if(p=new a.N(p.lng,p.lat),e){const c=new a.N(p.lng-360,p.lat),d=new a.N(p.lng+360,p.lat),g=i.locationToScreenPoint(p).distSqr(e);i.locationToScreenPoint(c).distSqr(e)<g?p=c:i.locationToScreenPoint(d).distSqr(e)<g&&(p=d)}for(;Math.abs(p.lng-i.center.lng)>180;){const c=i.locationToScreenPoint(p);if(c.x>=0&&c.y>=0&&c.x<=i.width&&c.y<=i.height)break;p.lng>i.center.lng?p.lng-=360:p.lng+=360}return p.lng!==s.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(p))?p:s}const aa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function la(p,e,i){const s=p.classList;for(const c in aa)s.remove(`maplibregl-${i}-anchor-${c}`);s.add(`maplibregl-${i}-anchor-${e}`)}class To extends a.E{constructor(e){if(super(),this._onKeyPress=i=>{const s=i.code,c=i.charCode||i.keyCode;s!=="Space"&&s!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=i=>{const s=i.originalEvent.target,c=this._element;this._popup&&(s===c||c.contains(s))&&this.togglePopup()},this._update=i=>{var s;if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((i==null?void 0:i.type)==="terrain"||(i==null?void 0:i.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?yr(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||i&&i.type!=="moveend"||(this._pos=this._pos.round()),te.setTransform(this._element,`${aa[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${d}`),ge.frameAsync(new AbortController).then(()=>{this._updateOpacity(i&&i.type==="moveend")}).catch(()=>{})},this._onMove=i=>{if(!this._isDragging){const s=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=i=>{this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=a.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=te.create("div");const i=te.createNS("http://www.w3.org/2000/svg","svg"),s=41,c=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${s}px`),i.setAttributeNS(null,"width",`${c}px`),i.setAttributeNS(null,"viewBox",`0 0 ${c} ${s}`);const d=te.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const g=te.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"fill-rule","nonzero");const b=te.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of P){const se=te.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",re.rx),se.setAttributeNS(null,"ry",re.ry),b.appendChild(se)}const C=te.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const z=te.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(z);const R=te.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const B=te.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(B);const V=te.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(6.0, 7.0)"),V.setAttributeNS(null,"fill","#FFFFFF");const Z=te.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ne=te.createNS("http://www.w3.org/2000/svg","circle");ne.setAttributeNS(null,"fill","#000000"),ne.setAttributeNS(null,"opacity","0.25"),ne.setAttributeNS(null,"cx","5.5"),ne.setAttributeNS(null,"cy","5.5"),ne.setAttributeNS(null,"r","5.4999962");const ie=te.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#FFFFFF"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962"),Z.appendChild(ne),Z.appendChild(ie),g.appendChild(b),g.appendChild(C),g.appendChild(R),g.appendChild(V),g.appendChild(Z),i.appendChild(g),i.setAttributeNS(null,"height",s*this._scale+"px"),i.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(i),this._offset=a.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",i=>{i.preventDefault()}),this._element.addEventListener("mousedown",i=>{i.preventDefault()}),la(this._element,this._anchor,"marker"),e&&e.className)for(const i of e.className.split(" "))this._element.classList.add(i);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),te.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=a.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const c=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var i,s;if(!(!((i=this._map)===null||i===void 0)&&i.terrain)){const R=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==R&&(this._element.style.opacity=R))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const c=this._map,d=c.terrain.depthAtPoint(this._pos),g=c.terrain.getElevationForLngLatZoom(this._lngLat,c.transform.tileZoom);if(c.transform.lngLatToCameraDepth(this._lngLat,g)-d<.006)return void(this._element.style.opacity=this._opacity);const b=-this._offset.y/c.transform.pixelsPerMeter,P=Math.sin(c.getPitch()*Math.PI/180)*b,C=c.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),z=c.transform.lngLatToCameraDepth(this._lngLat,g+P)-C>.006;!((s=this._popup)===null||s===void 0)&&s.isOpen()&&z&&this._popup.remove(),this._element.style.opacity=z?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=a.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,i){return e===void 0&&i===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),i!==void 0&&(this._opacityWhenCovered=i),this._map&&this._updateOpacity(!0),this}}const gc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let kn=0,as=!1;const gu={maxWidth:100,unit:"metric"};function _c(p,e,i){const s=i&&i.maxWidth||100,c=p._container.clientHeight/2,d=p._container.clientWidth/2,g=p.unproject([d-s/2,c]),b=p.unproject([d+s/2,c]),P=Math.round(p.project(b).x-p.project(g).x),C=Math.min(s,P,p._container.clientWidth),z=g.distanceTo(b);if(i&&i.unit==="imperial"){const R=3.2808*z;R>5280?Cs(e,C,R/5280,p._getUIString("ScaleControl.Miles")):Cs(e,C,R,p._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?Cs(e,C,z/1852,p._getUIString("ScaleControl.NauticalMiles")):z>=1e3?Cs(e,C,z/1e3,p._getUIString("ScaleControl.Kilometers")):Cs(e,C,z,p._getUIString("ScaleControl.Meters"))}function Cs(p,e,i,s){const c=function(d){const g=Math.pow(10,`${Math.floor(d)}`.length-1);let b=d/g;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(P){const C=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*C)/C}(b),g*b}(i);p.style.width=e*(c/i)+"px",p.innerHTML=`${c}&nbsp;${s}`}const xl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},_u=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ls(p){if(p){if(typeof p=="number"){const e=Math.round(Math.abs(p)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,p),"top-left":new a.P(e,e),"top-right":new a.P(-e,e),bottom:new a.P(0,-p),"bottom-left":new a.P(e,-e),"bottom-right":new a.P(-e,-e),left:new a.P(p,0),right:new a.P(-p,0)}}if(p instanceof a.P||Array.isArray(p)){const e=a.P.convert(p);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:a.P.convert(p.center||[0,0]),top:a.P.convert(p.top||[0,0]),"top-left":a.P.convert(p["top-left"]||[0,0]),"top-right":a.P.convert(p["top-right"]||[0,0]),bottom:a.P.convert(p.bottom||[0,0]),"bottom-left":a.P.convert(p["bottom-left"]||[0,0]),"bottom-right":a.P.convert(p["bottom-right"]||[0,0]),left:a.P.convert(p.left||[0,0]),right:a.P.convert(p.right||[0,0])}}return ls(new a.P(0,0))}const yc=q;T.AJAXError=a.cg,T.Event=a.k,T.Evented=a.E,T.LngLat=a.N,T.MercatorCoordinate=a.Y,T.Point=a.P,T.addProtocol=a.ch,T.config=a.a,T.removeProtocol=a.ci,T.AttributionControl=Go,T.BoxZoomHandler=oh,T.CanvasSource=vn,T.CooperativeGesturesHandler=na,T.DoubleClickZoomHandler=ss,T.DragPanHandler=mc,T.DragRotateHandler=fu,T.EdgeInsets=Jn,T.FullscreenControl=class extends a.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var e;let i=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=i==null?void 0:i.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)i=i.shadowRoot.fullscreenElement;i===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){te.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=te.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);te.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},T.GeoJSONSource=ar,T.GeolocateControl=class extends a.E{constructor(p){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new a.N(e.coords.longitude,e.coords.latitude),s=e.coords.accuracy,c=this._map.getBearing(),d=a.e({bearing:c},this.options.fitBoundsOptions),g=mi.fromLngLat(i,s);this._map.fitBounds(g,d,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new a.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&as)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=te.create("button","maplibregl-ctrl-geolocate",this._container),te.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=te.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new To({element:this._dotElement}),this._circleElement=te.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new To({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")),this.fire(new a.k("userlocationlostfocus")))})}},this.options=a.e({},gc,p)}onAdd(p){return this._map=p,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(e=!1){if(Zo!==void 0&&!e)return Zo;if(window.navigator.permissions===void 0)return Zo=!!window.navigator.geolocation,Zo;try{Zo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Zo=!!window.navigator.geolocation}return Zo})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),te.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,kn=0,as=!1}_isOutOfMapMaxBounds(p){const e=this._map.getMaxBounds(),i=p.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),e=p.getSouthEast(),i=p.getNorthEast(),s=e.distanceTo(i),c=Math.ceil(this._accuracy/(s/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":kn--,as=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart")),this.fire(new a.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),kn++,kn>1?(p={maximumAge:6e5,timeout:0},as=!0):(p=this.options.positionOptions,as=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},T.GlobeControl=class{constructor(){this._toggleProjection=()=>{var p;const e=(p=this._map.getProjection())===null||p===void 0?void 0:p.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var p;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((p=this._map.getProjection())===null||p===void 0?void 0:p.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(p){return this._map=p,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=te.create("button","maplibregl-ctrl-globe",this._container),te.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){te.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},T.Hash=hu,T.ImageSource=yn,T.KeyboardHandler=hh,T.LngLatBounds=mi,T.LogoControl=_r,T.Map=class extends kt{constructor(p){var e,i;a.cd.mark(a.ce.create);const s=Object.assign(Object.assign(Object.assign({},Fa),p),{canvasContextAttributes:Object.assign(Object.assign({},Fa.canvasContextAttributes),p.canvasContextAttributes)});if(s.minZoom!=null&&s.maxZoom!=null&&s.minZoom>s.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(s.minPitch!=null&&s.maxPitch!=null&&s.minPitch>s.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(s.minPitch!=null&&s.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(s.maxPitch!=null&&s.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const c=new Oo,d=new $l;if(s.minZoom!==void 0&&c.setMinZoom(s.minZoom),s.maxZoom!==void 0&&c.setMaxZoom(s.maxZoom),s.minPitch!==void 0&&c.setMinPitch(s.minPitch),s.maxPitch!==void 0&&c.setMaxPitch(s.maxPitch),s.renderWorldCopies!==void 0&&c.setRenderWorldCopies(s.renderWorldCopies),super(c,d,{bearingSnap:s.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Er,this._controls=[],this._mapId=a.a1(),this._contextLost=b=>{b.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:b}))},this._contextRestored=b=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:b}))},this._onMapScroll=b=>{if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=s.interactive,this._maxTileCacheSize=s.maxTileCacheSize,this._maxTileCacheZoomLevels=s.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},s.canvasContextAttributes),this._trackResize=s.trackResize===!0,this._bearingSnap=s.bearingSnap,this._centerClampedToGround=s.centerClampedToGround,this._refreshExpiredTiles=s.refreshExpiredTiles===!0,this._fadeDuration=s.fadeDuration,this._crossSourceCollisions=s.crossSourceCollisions===!0,this._collectResourceTiming=s.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},_l),s.locale),this._clickTolerance=s.clickTolerance,this._overridePixelRatio=s.pixelRatio,this._maxCanvasSize=s.maxCanvasSize,this.transformCameraUpdate=s.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=s.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=nt.addThrottleControl(()=>this.isMoving()),this._requestManager=new ht(s.transformRequest),typeof s.container=="string"){if(this._container=document.getElementById(s.container),!this._container)throw new Error(`Container '${s.container}' not found.`)}else{if(!(s.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=s.container}if(s.maxBounds&&this.setMaxBounds(s.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let b=!1;const P=Ss(C=>{this._trackResize&&!this._removed&&(this.resize(C),this.redraw())},50);this._resizeObserver=new ResizeObserver(C=>{b?P(C):b=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Et(this,s),this._hash=s.hash&&new hu(typeof s.hash=="string"&&s.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:s.center,elevation:s.elevation,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch,roll:s.roll}),s.bounds&&(this.resize(),this.fitBounds(s.bounds,a.e({},s.fitBoundsOptions,{duration:0}))));const g=typeof s.style=="string"||((i=(e=s.style)===null||e===void 0?void 0:e.projection)===null||i===void 0?void 0:i.type)!=="globe";this.resize(null,g),this._localIdeographFontFamily=s.localIdeographFontFamily,this._validateStyle=s.validateStyle,s.style&&this.setStyle(s.style,{localIdeographFontFamily:s.localIdeographFontFamily}),s.attributionControl&&this.addControl(new Go(typeof s.attributionControl=="boolean"?void 0:s.attributionControl)),s.maplibreLogo&&this.addControl(new _r,s.logoPosition),this.on("style.load",()=>{if(g||this._resizeTransform(),this.transform.unmodified){const b=a.M(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(b)}}),this.on("data",b=>{this._update(b.dataType==="style"),this.fire(new a.k(`${b.dataType}data`,b))}),this.on("dataloading",b=>{this.fire(new a.k(`${b.dataType}dataloading`,b))}),this.on("dataabort",b=>{this.fire(new a.k("sourcedataabort",b))})}_getMapId(){return this._mapId}addControl(p,e){if(e===void 0&&(e=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=p.onAdd(this);this._controls.push(p);const s=this._controlPositions[e];return e.indexOf("bottom")!==-1?s.insertBefore(i,s.firstChild):s.appendChild(i),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(p);return e>-1&&this._controls.splice(e,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,e,i,s){return s==null&&this.terrain&&(s=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,e,i,s)}resize(p,e=!0){const[i,s]=this._containerDimensions(),c=this._getClampedPixelRatio(i,s);if(this._resizeCanvas(i,s,c),this.painter.resize(i,s,c),this.painter.overLimit()){const g=this.painter.context.gl;this._maxCanvasSize=[g.drawingBufferWidth,g.drawingBufferHeight];const b=this._getClampedPixelRatio(i,s);this._resizeCanvas(i,s,b),this.painter.resize(i,s,b)}this._resizeTransform(e);const d=!this._moving;return d&&(this.stop(),this.fire(new a.k("movestart",p)).fire(new a.k("move",p))),this.fire(new a.k("resize",p)),d&&this.fire(new a.k("moveend",p)),this}_resizeTransform(p=!0){var e;const[i,s]=this._containerDimensions();this.transform.resize(i,s,p),(e=this._requestedCameraState)===null||e===void 0||e.resize(i,s,p)}_getClampedPixelRatio(p,e){const{0:i,1:s}=this._maxCanvasSize,c=this.getPixelRatio(),d=p*c,g=e*c;return Math.min(d>i?i/d:1,g>s?s/g:1)*c}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(mi.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.setMinZoom(p),this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.setMaxZoom(p),this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.setMinPitch(p),this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(p>=this.transform.minPitch)return this.transform.setMaxPitch(p),this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.setRenderWorldCopies(p),this._update()}project(p){return this.transform.locationToScreenPoint(a.N.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.screenPointToLocation(a.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,e,i){if(p==="mouseenter"||p==="mouseover"){let s=!1;return{layers:e,listener:i,delegates:{mousemove:d=>{const g=e.filter(P=>this.getLayer(P)),b=g.length!==0?this.queryRenderedFeatures(d.point,{layers:g}):[];b.length?s||(s=!0,i.call(this,new _i(p,this,d.originalEvent,{features:b}))):s=!1},mouseout:()=>{s=!1}}}}if(p==="mouseleave"||p==="mouseout"){let s=!1;return{layers:e,listener:i,delegates:{mousemove:g=>{const b=e.filter(P=>this.getLayer(P));(b.length!==0?this.queryRenderedFeatures(g.point,{layers:b}):[]).length?s=!0:s&&(s=!1,i.call(this,new _i(p,this,g.originalEvent)))},mouseout:g=>{s&&(s=!1,i.call(this,new _i(p,this,g.originalEvent)))}}}}{const s=c=>{const d=e.filter(b=>this.getLayer(b)),g=d.length!==0?this.queryRenderedFeatures(c.point,{layers:d}):[];g.length&&(c.features=g,i.call(this,c),delete c.features)};return{layers:e,listener:i,delegates:{[p]:s}}}}_saveDelegatedListener(p,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(e)}_removeDelegatedListener(p,e,i){if(!this._delegatedListeners||!this._delegatedListeners[p])return;const s=this._delegatedListeners[p];for(let c=0;c<s.length;c++){const d=s[c];if(d.listener===i&&d.layers.length===e.length&&d.layers.every(g=>e.includes(g))){for(const g in d.delegates)this.off(g,d.delegates[g]);return void s.splice(c,1)}}}on(p,e,i){if(i===void 0)return super.on(p,e);const s=typeof e=="string"?[e]:e,c=this._createDelegatedListener(p,s,i);this._saveDelegatedListener(p,c);for(const d in c.delegates)this.on(d,c.delegates[d]);return{unsubscribe:()=>{this._removeDelegatedListener(p,s,i)}}}once(p,e,i){if(i===void 0)return super.once(p,e);const s=typeof e=="string"?[e]:e,c=this._createDelegatedListener(p,s,i);for(const d in c.delegates){const g=c.delegates[d];c.delegates[d]=(...b)=>{this._removeDelegatedListener(p,s,i),g(...b)}}this._saveDelegatedListener(p,c);for(const d in c.delegates)this.once(d,c.delegates[d]);return this}off(p,e,i){return i===void 0?super.off(p,e):(this._removeDelegatedListener(p,typeof e=="string"?[e]:e,i),this)}queryRenderedFeatures(p,e){if(!this.style)return[];let i;const s=p instanceof a.P||Array.isArray(p),c=s?p:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(s?{}:p)||{},c instanceof a.P||typeof c[0]=="number")i=[a.P.convert(c)];else{const d=a.P.convert(c[0]),g=a.P.convert(c[1]);i=[d,new a.P(g.x,d.y),g,new a.P(d.x,g.y),d]}return this.style.queryRenderedFeatures(i,e,this.transform)}querySourceFeatures(p,e){return this.style.querySourceFeatures(p,e)}setStyle(p,e){return(e=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(p,e))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const e=this._locale[p];if(e==null)throw new Error(`Missing UI string '${p}'`);return e}_updateStyle(p,e){var i,s;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,e));const c=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new Ir(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,e,c):this.style.loadJSON(p,e,c),this):((s=(i=this.style)===null||i===void 0?void 0:i.projection)===null||s===void 0||s.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ir(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,e){if(typeof p=="string"){const i=this._requestManager.transformRequest(p,"Style");a.h(i,new AbortController).then(s=>{this._updateDiff(s.data,e)}).catch(s=>{s&&this.fire(new a.j(s))})}else typeof p=="object"&&this._updateDiff(p,e)}_updateDiff(p,e){try{this.style.setState(p,e)&&this._update(!0)}catch(i){a.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(p,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(p,e){return this._lazyInitEmptyStyle(),this.style.addSource(p,e),this._update(!0)}isSourceLoaded(p){const e=this.style&&this.style.sourceCaches[p];if(e!==void 0)return e.loaded();this.fire(new a.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const e=this.style.sourceCaches[p.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&e.reload();for(const i in this.style._layers){const s=this.style._layers[i];s.type==="hillshade"&&s.source===p.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new gl(this.painter,e,p),this.painter.renderToTexture=new wn(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=i=>{i.dataType==="style"?this.terrain.sourceCache.freeRtt():i.dataType==="source"&&i.tile&&(i.sourceId!==p.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),this.terrain.sourceCache.freeRtt(i.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.k("terrain",{terrain:p})),this}getTerrain(){var p,e;return(e=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const e in p){const i=p[e]._tiles;for(const s in i){const c=i[s];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,e,i={}){const{pixelRatio:s=1,sdf:c=!1,stretchX:d,stretchY:g,content:b,textFitWidth:P,textFitHeight:C}=i;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||a.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:R,data:B}=e,V=e;return this.style.addImage(p,{data:new a.R({width:z,height:R},new Uint8Array(B)),pixelRatio:s,stretchX:d,stretchY:g,content:b,textFitWidth:P,textFitHeight:C,sdf:c,version:0,userImage:V}),V.onAdd&&V.onAdd(this,p),this}}{const{width:z,height:R,data:B}=ge.getImageData(e);this.style.addImage(p,{data:new a.R({width:z,height:R},B),pixelRatio:s,stretchX:d,stretchY:g,content:b,textFitWidth:P,textFitHeight:C,sdf:c,version:0})}}updateImage(p,e){const i=this.style.getImage(p);if(!i)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const s=e instanceof HTMLImageElement||a.b(e)?ge.getImageData(e):e,{width:c,height:d,data:g}=s;if(c===void 0||d===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==i.data.width||d!==i.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(e instanceof HTMLImageElement||a.b(e));return i.data.replace(g,b),this.style.updateImage(p,i),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return nt.getImage(this._requestManager.transformRequest(p,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,e){return this._lazyInitEmptyStyle(),this.style.addLayer(p,e),this._update(!0)}moveLayer(p,e){return this.style.moveLayer(p,e),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,e,i){return this.style.setLayerZoomRange(p,e,i),this._update(!0)}setFilter(p,e,i={}){return this.style.setFilter(p,e,i),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,e,i,s={}){return this.style.setPaintProperty(p,e,i,s),this._update(!0)}getPaintProperty(p,e){return this.style.getPaintProperty(p,e)}setLayoutProperty(p,e,i,s={}){return this.style.setLayoutProperty(p,e,i,s),this._update(!0)}getLayoutProperty(p,e){return this.style.getLayoutProperty(p,e)}setGlyphs(p,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,e,i,s=>{s||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,e,i=>{i||this._update(!0)}),this}setLight(p,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(p,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(p,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(p,e){return this.style.setFeatureState(p,e),this._update()}removeFeatureState(p,e){return this.style.removeFeatureState(p,e),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,e=0;return this._container&&(p=this._container.clientWidth||400,e=this._container.clientHeight||300),[p,e]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const e=this._canvasContainer=te.create("div","maplibregl-canvas-container",p);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=te.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),s=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],s);const c=this._controlContainer=te.create("div","maplibregl-control-container",p),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{d[g]=te.create("div",`maplibregl-ctrl-${g} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,e,i){this._canvas.width=Math.floor(i*p),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const p=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",s=>{e={requestedAttributes:p},s&&(e.statusMessage=s.statusMessage,e.type=s.type)},{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,p):this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p),!i){const s="Failed to initialize WebGL";throw e?(e.message=s,new Error(JSON.stringify(e))):new Error(s)}this.painter=new ea(i,this.transform),we.testSupport(i)}migrateProjection(p,e){super.migrateProjection(p,e),this.painter.transform=p,this.fire(new a.k("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){var e,i,s,c,d;const g=this._idleTriggered?this._fadeDuration:0,b=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let P=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,B=ge.now();this.style.zoomHistory.update(R,B);const V=new a.z(R,{now:B,fadeDuration:g,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Z=V.crossFadingFactor();Z===1&&Z===this._crossFadingFactor||(P=!0,this._crossFadingFactor=Z),this.style.update(V)}const C=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0!==b;(s=this.style.projection)===null||s===void 0||s.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((c=this.style.projection)===null||c===void 0?void 0:c.transitionState,(d=this.style.projection)===null||d===void 0?void 0:d.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||C)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,g,this._crossSourceCollisions,C),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cd.mark(a.ce.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||P)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const z=this._sourcesDirty||this._styleDirty||this._placementDirty;return z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,a.cd.mark(a.ce.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),nt.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),te.remove(this._canvasContainer),te.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cd.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ge.frame(this._frameRequest,p=>{a.cd.frame(p),this._frameRequest=null;try{this._render(p)}catch(e){if(!a.cf(e)&&!function(i){return i.message===yo}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return yl}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(p){return this._lazyInitEmptyStyle(),this.style.setProjection(p),this._update(!0)}},T.MapMouseEvent=_i,T.MapTouchEvent=ti,T.MapWheelEvent=xo,T.Marker=To,T.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const e=this._map.getZoom(),i=e===this._map.getMaxZoom(),s=e===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,i)=>{const s=this._map._getUIString(`NavigationControl.${i}`);e.title=s,e.setAttribute("aria-label",s)},this.options=a.e({},On,p),this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),te.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),te.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=te.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new vl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){te.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,e){const i=te.create("button",p,this._container);return i.type="button",i.addEventListener("click",e),i}},T.Popup=class extends a.E{constructor(p){super(),this.remove=()=>(this._content&&te.remove(this._content),this._container&&(te.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var i;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=te.create("div","maplibregl-popup",this._map.getContainer()),this._tip=te.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?yr(this._lngLat,this._flatPos,this._map.transform):(i=this._lngLat)===null||i===void 0?void 0:i.wrap(),this._trackPointer&&!e)return;const s=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor;const d=ls(this.options.offset);if(!c){const b=this._container.offsetWidth,P=this._container.offsetHeight;let C;C=s.y+d.bottom.y<P?["top"]:s.y>this._map.transform.height-P?["bottom"]:[],s.x<b/2?C.push("left"):s.x>this._map.transform.width-b/2&&C.push("right"),c=C.length===0?"bottom":C.join("-")}let g=s.add(d[c]);this.options.subpixelPositioning||(g=g.round()),te.setTransform(this._container,`${aa[c]} translate(${g.x}px,${g.y}px)`),la(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(xl),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=a.N.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const e=document.createDocumentFragment(),i=document.createElement("body");let s;for(i.innerHTML=p;s=i.firstChild,s;)e.appendChild(s);return this.setDOMContent(e)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=te.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._container&&this._container.classList.add(p),this}removeClassName(p){return this._container&&this._container.classList.remove(p),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=te.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(_u);p&&p.focus()}},T.RasterDEMTileSource=Nr,T.RasterTileSource=Qi,T.ScaleControl=class{constructor(p){this._onMove=()=>{_c(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,_c(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},gu),p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){te.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},T.ScrollZoomHandler=fh,T.Style=Ir,T.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=te.create("button","maplibregl-ctrl-terrain",this._container),te.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){te.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},T.TwoFingersTouchPitchHandler=fc,T.TwoFingersTouchRotateHandler=Ms,T.TwoFingersTouchZoomHandler=pc,T.TwoFingersTouchZoomRotateHandler=ml,T.VectorTileSource=Yn,T.VideoSource=An,T.addSourceType=(p,e)=>a._(void 0,void 0,void 0,function*(){if(Jo(p))throw new Error(`A source type called "${p}" already exists.`);((i,s)=>{lr[i]=s})(p,e)}),T.clearPrewarmedResources=function(){const p=pn;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(ni),pn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},T.createTileMesh=el,T.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},T.getRTLTextPluginStatus=function(){return en().getRTLTextPluginStatus()},T.getVersion=function(){return yc},T.getWorkerCount=function(){return br.workerCount},T.getWorkerUrl=function(){return a.a.WORKER_URL},T.importScriptInWorkers=function(p){return mr().broadcast("IS",p)},T.prewarm=function(){Tr().acquire(ni)},T.setMaxParallelImageRequests=function(p){a.a.MAX_PARALLEL_IMAGE_REQUESTS=p},T.setRTLTextPlugin=function(p,e){return en().setRTLTextPlugin(p,e)},T.setWorkerCount=function(p){br.workerCount=p},T.setWorkerUrl=function(p){a.a.WORKER_URL=p}});var D=v;return D})})(Jg);var e_=Jg.exports;const ln=dy(e_);const Yo="/maplibre-gl-directions/assets/style-7d708b4d.json";var fy=Object.defineProperty,my=(S,y,v)=>y in S?fy(S,y,{enumerable:!0,configurable:!0,writable:!0,value:v}):S[y]=v,qt=(S,y,v)=>(my(S,typeof y!="symbol"?y+"":y,v),v);class gy{constructor(y){qt(this,"map"),qt(this,"listeners",{}),qt(this,"oneTimeListeners",{}),this.map=y}fire(y){var v,k;y.target=this.map;const F=y.type;(v=this.listeners[F])==null||v.forEach(D=>D(y)),(k=this.oneTimeListeners[F])==null||k.forEach(D=>{var T,a;D(y);const q=(T=this.oneTimeListeners[F])==null?void 0:T.indexOf(D);q!==void 0&&~q&&((a=this.oneTimeListeners[F])==null||a.splice(q,1))})}on(y,v){this.listeners[y]=this.listeners[y]??[],this.listeners[y].push(v)}off(y,v){var k,F;const D=(k=this.listeners[y])==null?void 0:k.indexOf(v);D!==void 0&&~D&&((F=this.listeners[y])==null||F.splice(D,1))}once(y,v){this.oneTimeListeners[y]=this.oneTimeListeners[y]??[],this.oneTimeListeners[y].push(v)}}class Fu{constructor(y,v,k){qt(this,"type"),qt(this,"target"),qt(this,"originalEvent"),qt(this,"data"),this.type=y,this.originalEvent=v,this.data=k}}class bg{constructor(y,v,k){qt(this,"type"),qt(this,"target"),qt(this,"originalEvent"),qt(this,"data"),this.type=y,this.originalEvent=v,this.data=k}}const _y={api:"https://router.project-osrm.org/route/v1",profile:"driving",requestOptions:{},requestTimeout:null,makePostRequest:!1,sourceName:"maplibre-gl-directions",pointsScalingFactor:1,linesScalingFactor:1,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint","maplibre-gl-directions-waypoint-casing"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint","maplibre-gl-directions-snappoint-casing"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline","maplibre-gl-directions-routeline-casing"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline","maplibre-gl-directions-alt-routeline-casing"],dragThreshold:10,refreshOnMove:!1,bearings:!1},Fr={snapline:"#34343f",altRouteline:"#9e91be",routelineFoot:"#3665ff",routelineBike:"#63c4ff",routeline:"#7b51f8",congestionLow:"#42c74c",congestionHigh:"#d72359",hoverpoint:"#30a856",snappoint:"#cb3373",snappointHighlight:"#e50d3f",waypointFoot:"#3665ff",waypointFootHighlight:"#0942ff",waypointBike:"#63c4ff",waypointBikeHighlight:"#0bb8ff",waypoint:"#7b51f8",waypointHighlight:"#6d26d7"},wg=["case",["==",["get","profile",["get","arriveSnappointProperties"]],"foot"],Fr.routelineFoot,["==",["get","profile",["get","arriveSnappointProperties"]],"bike"],Fr.routelineBike,["interpolate-hcl",["linear"],["get","congestion"],0,Fr.routeline,1,Fr.congestionLow,100,Fr.congestionHigh]],Tg=["case",["==",["get","profile"],"foot"],["case",["boolean",["get","highlight"],!1],Fr.waypointFootHighlight,Fr.waypointFoot],["==",["get","profile"],"bike"],["case",["boolean",["get","highlight"],!1],Fr.waypointBikeHighlight,Fr.waypointBike],["case",["boolean",["get","highlight"],!1],Fr.waypointHighlight,Fr.waypoint]],Sg=["case",["boolean",["get","highlight"],!1],Fr.snappointHighlight,Fr.snappoint];function $f(S=1,y=1,v="maplibre-gl-directions"){const k=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],14*S,12*S],5,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],14*S,12*S],18,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],33*S,28*S]],F=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],9*S,7*S],5,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],9*S,7*S],18,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],21*S,16*S]],D=["interpolate",["exponential",1.5],["zoom"],0,3*y,5,3*y,18,10*y],T=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],10*y,7*y],5,["case",["boolean",["get","highlight"],!1],10*y,7*y],18,["case",["boolean",["get","highlight"],!1],32*y,23*y]];return[{id:`${v}-snapline`,type:"line",source:v,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":Fr.snapline,"line-opacity":.65,"line-width":3},filter:["==",["get","type"],"SNAPLINE"]},{id:`${v}-alt-routeline-casing`,type:"line",source:v,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":Fr.altRouteline,"line-opacity":.55,"line-width":T},filter:["==",["get","route"],"ALT"]},{id:`${v}-alt-routeline`,type:"line",source:v,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":Fr.altRouteline,"line-opacity":.85,"line-width":D},filter:["==",["get","route"],"ALT"]},{id:`${v}-routeline-casing`,type:"line",source:v,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":wg,"line-opacity":.55,"line-width":T},filter:["==",["get","route"],"SELECTED"]},{id:`${v}-routeline`,type:"line",source:v,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":wg,"line-opacity":.85,"line-width":D},filter:["==",["get","route"],"SELECTED"]},{id:`${v}-hoverpoint-casing`,type:"circle",source:v,paint:{"circle-radius":k,"circle-color":Fr.hoverpoint,"circle-opacity":.65},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${v}-hoverpoint`,type:"circle",source:v,paint:{"circle-radius":F,"circle-color":Fr.hoverpoint},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${v}-snappoint-casing`,type:"circle",source:v,paint:{"circle-radius":k,"circle-color":Sg,"circle-opacity":.65},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${v}-snappoint`,type:"circle",source:v,paint:{"circle-radius":F,"circle-color":Sg},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${v}-waypoint-casing`,type:"circle",source:v,paint:{"circle-radius":k,"circle-color":Tg,"circle-opacity":.65},filter:["==",["get","type"],"WAYPOINT"]},{id:`${v}-waypoint`,type:"circle",source:v,paint:{"circle-radius":F,"circle-color":Tg},filter:["==",["get","type"],"WAYPOINT"]}]}const yy="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let t_=(S=21)=>{let y="",v=crypto.getRandomValues(new Uint8Array(S|=0));for(;S--;)y+=yy[v[S]&63];return y};function Pg(S){return S&1?~(S>>1):S>>1}function Mg(S,y=5){const v=Math.pow(10,y);let k=0,F=0,D=0;const T=[];let a=0,q=0,Y=null,fe,de;for(;k<S.length;){Y=null,a=0,q=0;do Y=S.charCodeAt(k++)-63,q|=(Y&31)<<a,a+=5;while(Y>=32);fe=Pg(q),a=q=0;do Y=S.charCodeAt(k++)-63,q|=(Y&31)<<a,a+=5;while(Y>=32);de=Pg(q),F+=fe,D+=de,T.push([D/v,F/v])}return T}function vy(S,y){return S.geometries==="geojson"?y.coordinates:S.geometries==="polyline6"?Mg(y,6):Mg(y,5)}function xy(S,y,v){var k,F,D,T;if((k=S.annotations)!=null&&k.includes("congestion_numeric"))return((F=y==null?void 0:y.congestion_numeric)==null?void 0:F[v])??0;if((D=S.annotations)!=null&&D.includes("congestion"))switch(((T=y==null?void 0:y.congestion)==null?void 0:T[v])??""){case"unknown":return 0;case"low":return 1;case"moderate":return 34;case"heavy":return 77;case"severe":return 100;default:return 0}else return 0}function by(S,y,v){return!S.geometries||S.geometries==="polyline"?Math.abs(y[0]-v[0])<=1e-5&&Math.abs(y[1]-v[1])<=1e-5:y[0]===v[0]&&y[1]===v[1]}function Cg(S){return S.map(y=>[y.geometry.coordinates[0],y.geometry.coordinates[1]])}function Ig(S){return S.map(y=>{var v,k,F;return Array.isArray((v=y.properties)==null?void 0:v.bearing)?[(k=y.properties)==null?void 0:k.bearing[0],(F=y.properties)==null?void 0:F.bearing[1]]:void 0})}function i_(S){const y=$f(S==null?void 0:S.pointsScalingFactor,S==null?void 0:S.linesScalingFactor,S==null?void 0:S.sourceName);return Object.assign({},_y,{layers:y},S)}function n_(S,y,v){const k=S.makePostRequest?"post":"get";let F,D;if(k==="get")F=`${S.api}/${S.profile}/${y.join(";")}`,D=new URLSearchParams(S.requestOptions);else{F=`${S.api}/${S.profile}${S.requestOptions.access_token?`?access_token=${S.requestOptions.access_token}`:""}`;const T=new FormData;Object.entries(S.requestOptions).forEach(([a,q])=>{a!=="access_token"&&T.set(a,q)}),T.set("coordinates",y.join(";")),D=new URLSearchParams(T)}return S.bearings&&v&&D.set("bearings",v.map(T=>T?`${T[0]},${T[1]}`:"").join(";")),{method:k,url:F,payload:D}}function r_(S,y,v){return{type:"Feature",geometry:{type:"Point",coordinates:S},properties:{type:y,id:t_(),...v??{}}}}function o_(S,y,v,k,F=!1){if(S.length!==y.length)return[];const D=S.map((T,a)=>({type:"Feature",geometry:{type:"LineString",coordinates:[[T[0],T[1]],[y[a][0],y[a][1]]]},properties:{type:"SNAPLINE"}}));return~k&&v!==void 0&&F&&(D.push({type:"Feature",geometry:{type:"LineString",coordinates:[[v[0],v[1]],[y[k][0],y[k][1]]]},properties:{type:"SNAPLINE"}}),D.push({type:"Feature",geometry:{type:"LineString",coordinates:[[v[0],v[1]],[y[k+1][0],y[k+1][1]]]},properties:{type:"SNAPLINE"}})),D}function s_(S,y,v,k){return y.map((F,D)=>{const T=vy(S,F.geometry),a=k.map(te=>te.geometry.coordinates);let q=0;const Y=a.map((te,we)=>{const it=T.slice(q).findIndex(vt=>by(S,vt,te)),Ke=we===a.length-1;if(it!==-1)q+=it;else if(Ke)return T.length-1;return q}).slice(1);let fe=0;const de=Y.map(te=>T.slice(fe,fe=te+1)),ge=[];return de.forEach((te,we)=>{const it=t_();te.forEach((Ke,vt)=>{var Rt,gt,nt;const ht=ge[ge.length-1],Xe=xy(S,(Rt=F.legs[we])==null?void 0:Rt.annotation,vt);if(we===((gt=ht==null?void 0:ht.properties)==null?void 0:gt.legIndex)&&((nt=ht.properties)==null?void 0:nt.congestion)===Xe)ht.geometry.coordinates.push(Ke);else{const ct=k[we].properties??{},Tt=k[we+1].properties??{},$t={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{id:it,routeIndex:D,route:D===v?"SELECTED":"ALT",legIndex:we,congestion:Xe,departSnappointProperties:ct,arriveSnappointProperties:Tt}};ht&&$t.geometry.coordinates.push(ht.geometry.coordinates[ht.geometry.coordinates.length-1]),$t.geometry.coordinates.push(Ke),ge.push($t)}})}),ge})}const wy=Object.freeze(Object.defineProperty({__proto__:null,buildConfiguration:i_,buildPoint:r_,buildRequest:n_,buildRoutelines:s_,buildSnaplines:o_},Symbol.toStringTag,{value:"Module"}));class Ao extends gy{constructor(y,v){super(y),qt(this,"configuration"),qt(this,"_interactive",!1),qt(this,"_hoverable",!1),qt(this,"buildRequest",n_),qt(this,"buildPoint",r_),qt(this,"buildSnaplines",o_),qt(this,"buildRoutelines",s_),qt(this,"onMoveHandler"),qt(this,"onDragDownHandler"),qt(this,"onDragMoveHandler"),qt(this,"onDragUpHandler"),qt(this,"onClickHandler"),qt(this,"liveRefreshHandler"),qt(this,"profiles",[]),qt(this,"_waypoints",[]),qt(this,"snappoints",[]),qt(this,"routelines",[]),qt(this,"selectedRouteIndex",0),qt(this,"hoverpoint"),qt(this,"highlightedWaypoints",[]),qt(this,"highlightedSnappoints",[]),qt(this,"dragDownPosition",{x:0,y:0}),qt(this,"waypointBeingDragged"),qt(this,"waypointBeingDraggedInitialCoordinates"),qt(this,"departSnappointIndex",-1),qt(this,"currentMousePosition",{x:0,y:0}),qt(this,"refreshOnMoveIsRefreshing",!1),qt(this,"noMouseMovementTimer"),qt(this,"lastRequestMousePosition",{x:0,y:0}),qt(this,"allowRouteSwitch",!1),qt(this,"abortController"),this.map=y,this.configuration=i_(v),this.onMoveHandler=this.onMove.bind(this),this.onDragDownHandler=this.onDragDown.bind(this),this.onDragMoveHandler=this.onDragMove.bind(this),this.onDragUpHandler=this.onDragUp.bind(this),this.onClickHandler=this.onClick.bind(this),this.liveRefreshHandler=this.liveRefresh.bind(this),this.init()}get waypointsCoordinates(){return Cg(this._waypoints)}get snappointsCoordinates(){return this.snappoints.map(y=>[y.geometry.coordinates[0],y.geometry.coordinates[1]])}get snaplines(){var y,v,k;return this.buildSnaplines(this.waypointsCoordinates,this.snappointsCoordinates,(y=this.hoverpoint)==null?void 0:y.geometry.coordinates,this.departSnappointIndex,(k=(v=this.hoverpoint)==null?void 0:v.properties)==null?void 0:k.showSnaplines)}init(){this.map.addSource(this.configuration.sourceName,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.configuration.layers.forEach(y=>{this.map.addLayer(y)})}async fetch({method:y,url:v,payload:k}){var F,D;const T=await(y==="get"?await fetch(`${v}?${k}`,{signal:(F=this.abortController)==null?void 0:F.signal}):await fetch(`${v}`,{signal:(D=this.abortController)==null?void 0:D.signal,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:k})).json();if(T.code!=="Ok")throw new Error(T.message??"An unexpected error occurred.");return T}async fetchDirections(y){var v;if((v=this.abortController)==null||v.abort(),this._waypoints.length>=2){this.fire(new bg("fetchroutesstart",y)),this.abortController=new AbortController;let k;this.configuration.requestTimeout!==null&&(k=setTimeout(()=>{var fe;return(fe=this.abortController)==null?void 0:fe.abort()},this.configuration.requestTimeout)),this.profiles.length||(this.profiles=[this.configuration.profile]);const F=[],D=[];this.profiles.reduce((fe,de,ge)=>{const te=ge===this.profiles.length-1,we=ge>0?this.profiles[ge-1]:void 0,it=de===we,Ke=te?this._waypoints.length:it?fe+1:fe+2;return it?D[D.length-1].push(...this._waypoints.slice(fe,Ke)):(D.push(this._waypoints.slice(fe,Ke)),F.push(de)),Ke},0);const T=F.map((fe,de)=>this.buildRequest({...this.configuration,profile:fe},Cg(D[de]),this.configuration.bearings?Ig(D[de]):void 0));let a;try{a=await Promise.all(T.map(async fe=>{let de;try{de=await this.fetch(fe)}finally{this.fire(new bg("fetchroutesend",y,de))}return de}))}finally{clearTimeout(k)}const q=a.flatMap((fe,de)=>{const ge=F[de],te=fe.waypoints.map((it,Ke)=>this.buildPoint(it.location,"SNAPPOINT",{profile:ge,waypointProperties:D[de][Ke].properties??{}})),we=this.buildRoutelines(this.configuration.requestOptions,fe.routes,this.selectedRouteIndex,te);return{snappoints:te,routelines:we}}),Y=a.flatMap(fe=>fe.routes);this.snappoints=q.flatMap(fe=>fe.snappoints),this.routelines=q.flatMap(fe=>fe.routelines),Y.length<=this.selectedRouteIndex&&(this.selectedRouteIndex=0)}else this.snappoints=[],this.routelines=[];this.draw(!1)}draw(y=!0){const v=[...this._waypoints,...this.snappoints,...this.snaplines,...this.routelines.reduce((F,D)=>y?F.concat(...D):F.concat(...D.map(T=>(T.properties&&(T.properties.route=T.properties.routeIndex===this.selectedRouteIndex?"SELECTED":"ALT"),T))),[])];this.hoverpoint&&v.push(this.hoverpoint);const k={type:"FeatureCollection",features:v};this.map.getSource(this.configuration.sourceName)&&this.map.getSource(this.configuration.sourceName).setData(k)}deHighlight(){this.highlightedWaypoints.forEach(y=>{y!=null&&y.properties&&(y.properties.highlight=!1)}),this.highlightedSnappoints.forEach(y=>{y!=null&&y.properties&&(y.properties.highlight=!1)}),this.routelines.forEach(y=>{y.forEach(v=>{v.properties&&(v.properties.highlight=!1)})})}onMove(y){var v,k,F,D;const T=this.map.queryRenderedFeatures(y.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveRoutelineLayers,...this.configuration.sensitiveAltRoutelineLayers]})[0];if(this.deHighlight(),this.configuration.sensitiveWaypointLayers.includes((T==null?void 0:T.layer.id)??"")){this.map.getCanvas().style.cursor="pointer",this.interactive&&this.map.dragPan.disable();const a=this._waypoints.find(Y=>{var fe,de;return((fe=Y.properties)==null?void 0:fe.id)===((de=T==null?void 0:T.properties)==null?void 0:de.id)}),q=a&&this.snappoints.find(Y=>{var fe,de,ge;return((de=(fe=Y.properties)==null?void 0:fe.waypointProperties)==null?void 0:de.id)===((ge=a.properties)==null?void 0:ge.id)});a&&(this.highlightedWaypoints=[a]),q&&(this.highlightedSnappoints=[q]),(v=this.highlightedWaypoints[0])!=null&&v.properties&&(this.highlightedWaypoints[0].properties.highlight=!0),(k=this.highlightedSnappoints[0])!=null&&k.properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else if(this.configuration.sensitiveSnappointLayers.includes((T==null?void 0:T.layer.id)??"")){this.map.getCanvas().style.cursor="pointer";const a=this.snappoints.findIndex(q=>{var Y,fe;return((Y=q.properties)==null?void 0:Y.id)===((fe=T==null?void 0:T.properties)==null?void 0:fe.id)});this.highlightedSnappoints=[this.snappoints[a]],this.highlightedWaypoints=[this._waypoints[a]],this.highlightedSnappoints[0].properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.highlightedWaypoints[0].properties&&(this.highlightedWaypoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else this.configuration.sensitiveRoutelineLayers.includes((T==null?void 0:T.layer.id)??"")?(this.map.getCanvas().style.cursor="pointer",this.interactive&&(this.map.dragPan.disable(),this.hoverpoint?this.hoverpoint.geometry.coordinates=[y.lngLat.lng,y.lngLat.lat]:this.hoverpoint=this.buildPoint([y.lngLat.lng,y.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse(((F=T==null?void 0:T.properties)==null?void 0:F.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse(((D=T==null?void 0:T.properties)==null?void 0:D.arriveSnappointProperties)??"{}")}})),this.routelines.forEach(a=>{a.forEach(q=>{var Y,fe;q.properties&&((Y=q.properties)==null?void 0:Y.id)===((fe=T==null?void 0:T.properties)==null?void 0:fe.id)&&(q.properties.highlight=!0)})})):this.configuration.sensitiveAltRoutelineLayers.includes((T==null?void 0:T.layer.id)??"")?(this.map.getCanvas().style.cursor="pointer",this.routelines.forEach(a=>{a.forEach(q=>{var Y,fe;q.properties&&((Y=q.properties)==null?void 0:Y.id)===((fe=T==null?void 0:T.properties)==null?void 0:fe.id)&&(q.properties.highlight=!0)})}),this.hoverpoint&&(this.hoverpoint=void 0)):(this.map.dragPan.enable(),this.map.getCanvas().style.cursor="",this.hoverpoint=void 0);this.draw()}onDragDown(y){var v,k,F,D,T,a;if(y.type==="touchstart"&&y.originalEvent.touches.length!==1||y.type==="mousedown"&&y.originalEvent.which!==1)return;const q=this.map.queryRenderedFeatures(y.point);if(q.length&&q[0].source===this.configuration.sourceName){const Y=q.filter(fe=>this.configuration.sensitiveWaypointLayers.includes((fe==null?void 0:fe.layer.id)??"")||this.configuration.sensitiveSnappointLayers.includes((fe==null?void 0:fe.layer.id)??"")||this.configuration.sensitiveRoutelineLayers.includes((fe==null?void 0:fe.layer.id)??""))[0];if(this.dragDownPosition=y.point,this.currentMousePosition=y.point,this.configuration.sensitiveWaypointLayers.includes((Y==null?void 0:Y.layer.id)??""))this.waypointBeingDragged=this._waypoints.find(fe=>{var de,ge;return((de=fe.properties)==null?void 0:de.id)===((ge=Y==null?void 0:Y.properties)==null?void 0:ge.id)}),this.waypointBeingDraggedInitialCoordinates=(v=this.waypointBeingDragged)==null?void 0:v.geometry.coordinates;else if(this.configuration.sensitiveRoutelineLayers.includes((Y==null?void 0:Y.layer.id)??"")){if(this.departSnappointIndex=JSON.parse((k=Y==null?void 0:Y.properties)==null?void 0:k.legIndex),this.hoverpoint)if(this.configuration.refreshOnMove){const fe=this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0;this._addWaypoint([y.lngLat.lng,y.lngLat.lat],fe,y),this.waypointBeingDragged=fe?this._waypoints[fe]:void 0,this.hoverpoint=void 0}else this.hoverpoint.geometry.coordinates=[y.lngLat.lng,y.lngLat.lat];else this.hoverpoint=this.buildPoint([y.lngLat.lng,y.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse(((F=Y==null?void 0:Y.properties)==null?void 0:F.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse(((D=Y==null?void 0:Y.properties)==null?void 0:D.arriveSnappointProperties)??"{}")}});(T=this.hoverpoint)!=null&&T.properties&&(this.hoverpoint.properties.showSnaplines=!0),~this.departSnappointIndex&&(a=this.snappoints[this.departSnappointIndex])!=null&&a.properties&&(this.snappoints[this.departSnappointIndex].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex]),this.snappoints[this.departSnappointIndex+1].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex+1]))}this.map.off("touchstart",this.onMoveHandler),this.map.off("mousemove",this.onMoveHandler),y.type==="touchstart"?(this.map.on("touchmove",this.onDragMoveHandler),this.map.on("touchend",this.onDragUpHandler)):y.type==="mousedown"&&(this.map.on("mousemove",this.onDragMoveHandler),this.map.on("mouseup",this.onDragUpHandler)),this.draw()}}onDragMove(y){if(this.configuration.refreshOnMove&&(clearTimeout(this.noMouseMovementTimer),this.noMouseMovementTimer=setTimeout(this.liveRefreshHandler,300,y)),y.type==="touchmove"&&y.originalEvent.touches.length!==1)return y.originalEvent.preventDefault();y.type==="mousemove"&&y.originalEvent.which!==1||(this.waypointBeingDragged?this.waypointBeingDragged.geometry.coordinates=[y.lngLat.lng,y.lngLat.lat]:this.hoverpoint&&(this.hoverpoint.geometry.coordinates=[y.lngLat.lng,y.lngLat.lat]),this.currentMousePosition=y.point,this.draw(),this.configuration.refreshOnMove&&!this.refreshOnMoveIsRefreshing&&this.liveRefreshHandler(y))}onDragUp(y){var v,k,F;if(this.configuration.refreshOnMove&&clearTimeout(this.noMouseMovementTimer),!(y.type==="mouseup"&&y.originalEvent.which!==1)){if((v=this.hoverpoint)!=null&&v.properties&&(this.hoverpoint.properties.showSnaplines=!1),Math.abs(y.point.x-((k=this.dragDownPosition)==null?void 0:k.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(y.point.y-((F=this.dragDownPosition)==null?void 0:F.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0))if(this.waypointBeingDragged){this.waypointBeingDragged.geometry.coordinates=[y.lngLat.lng,y.lngLat.lat];const D=new Fu("movewaypoint",y,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(D),this.fetchDirections(D).catch(T=>{T instanceof DOMException&&T.name=="AbortError"||this.waypointBeingDragged&&this.waypointBeingDraggedInitialCoordinates&&(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates)}),this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0}else this.hoverpoint&&(this._addWaypoint([y.lngLat.lng,y.lngLat.lat],this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0,y),this.hoverpoint=void 0);else this.waypointBeingDragged&&this.waypointBeingDraggedInitialCoordinates?(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates,this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0):this.hoverpoint&&(this.hoverpoint=void 0);this.deHighlight(),y.type==="touchend"?(this.map.off("touchmove",this.onDragMoveHandler),this.map.off("touchend",this.onDragUpHandler)):y.type==="mouseup"&&(this.map.off("mousemove",this.onDragMoveHandler),this.map.off("mouseup",this.onDragUpHandler)),this.map.on("touchstart",this.onMoveHandler),this.map.on("mousemove",this.onMoveHandler),this.map.dragPan.enable(),this.draw(),this.map.once("idle",()=>{this.onMove(y)})}}async liveRefresh(y){var v,k,F,D;if(Math.abs(((v=this.lastRequestMousePosition)==null?void 0:v.x)-((k=this.currentMousePosition)==null?void 0:k.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(((F=this.lastRequestMousePosition)==null?void 0:F.y)-((D=this.currentMousePosition)==null?void 0:D.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)){if(this.refreshOnMoveIsRefreshing=!0,this.lastRequestMousePosition=this.currentMousePosition,this.waypointBeingDragged){const T=new Fu("movewaypoint",y,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(T);try{await this.fetchDirections(T)}catch{}}this.refreshOnMoveIsRefreshing=!1}}onClick(y){const v=this.map.queryRenderedFeatures(y.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveAltRoutelineLayers,...this.configuration.sensitiveRoutelineLayers]})[0];if(this.interactive&&this.configuration.sensitiveWaypointLayers.includes((v==null?void 0:v.layer.id)??"")){const k=this._waypoints.findIndex(F=>{var D,T;return((D=F.properties)==null?void 0:D.id)===((T=v==null?void 0:v.properties)==null?void 0:T.id)});~k&&this._removeWaypoint(k,y)}else if(this.interactive&&this.configuration.sensitiveSnappointLayers.includes((v==null?void 0:v.layer.id)??"")){const k=this.snappoints.findIndex(F=>{var D,T;return((D=F.properties)==null?void 0:D.id)===((T=v==null?void 0:v.properties)==null?void 0:T.id)});~k&&this._removeWaypoint(k,y)}else(this.interactive||this.allowRouteSwitch)&&this.configuration.sensitiveAltRoutelineLayers.includes((v==null?void 0:v.layer.id)??"")?this.selectedRouteIndex=this.routelines.findIndex(k=>!!k.find(F=>{var D,T;return((D=F.properties)==null?void 0:D.id)===((T=v==null?void 0:v.properties)==null?void 0:T.id)})):this.interactive&&!this.configuration.sensitiveRoutelineLayers.includes((v==null?void 0:v.layer.id)??"")&&this._addWaypoint([y.lngLat.lng,y.lngLat.lat],void 0,y);this.draw(!1),this.map.once("idle",()=>{this.onMove(y)})}assignWaypointsCategories(){this._waypoints.forEach((y,v)=>{const k=v===0?"ORIGIN":v===this._waypoints.length-1?"DESTINATION":void 0;y.properties&&(y.properties.index=v,y.properties.category=k)})}async _addWaypoint(y,v,k){var F;(F=this.abortController)==null||F.abort(),v=v??this._waypoints.length,this._waypoints.splice(v,0,this.buildPoint(y,"WAYPOINT",this.configuration.bearings?{bearing:void 0}:void 0)),this.assignWaypointsCategories();const D=new Fu("addwaypoint",k,{index:v});this.fire(D),this.draw();try{await this.fetchDirections(D)}catch{}}async _removeWaypoint(y,v){var k;(k=this.abortController)==null||k.abort(),this._waypoints.splice(y,1),this.snappoints.splice(y,1),this.assignWaypointsCategories();const F=new Fu("removewaypoint",v,{index:y});this.fire(F),this.draw();try{await this.fetchDirections(F)}catch{}}get interactive(){return this._interactive}set interactive(y){this._interactive=y,y?(this.map.on("touchstart",this.onMoveHandler),this.map.on("touchstart",this.onDragDownHandler),this.map.on("mousedown",this.onDragDownHandler),this.map.on("click",this.onClickHandler),this.hoverable||(this.map.on("mousemove",this.onMoveHandler),this.map.on("click",this.onClickHandler))):(this.map.off("touchstart",this.onMoveHandler),this.map.off("touchstart",this.onDragDownHandler),this.map.off("mousedown",this.onDragDownHandler),this.hoverable||(this.map.off("mousemove",this.onMoveHandler),this.map.off("click",this.onClickHandler)),this.map.dragPan.enable())}get hoverable(){return this._hoverable}set hoverable(y){this._hoverable=y,y&&!this.interactive?(this.map.on("mousemove",this.onMoveHandler),this.map.on("click",this.onClickHandler)):this.interactive||(this.map.off("mousemove",this.onMoveHandler),this.map.off("click",this.onClickHandler))}get waypoints(){return this.waypointsCoordinates}set waypoints(y){this.setWaypoints(y)}get waypointsBearings(){return this.configuration.bearings?Ig(this._waypoints):(console.warn("The `waypointsBearings` getter was referred to, but the `bearings` configuration option is not enabled!"),[])}set waypointsBearings(y){if(!this.configuration.bearings){console.warn("The `waypointsBearings` setter was referred to, but the `bearings` configuration option is not enabled!");return}this._waypoints.forEach((k,F)=>{(k.properties||(k.properties={})).bearing=y[F]});const v=new Fu("rotatewaypoints",void 0);this.fire(v),this.draw();try{this.fetchDirections(v)}catch{}}async setWaypoints(y,v=[]){var k;(k=this.abortController)==null||k.abort(),this.profiles=v.slice(0,y.length-1),this.profiles.length===0&&this.profiles.push(this.configuration.profile),this._waypoints=this.profiles.flatMap((D,T)=>{const a=T===this.profiles.length-1,q=T>0?this.profiles[T-1]:void 0,Y=D===q?T+1:T,fe=a?y.length:T+2;return y.slice(Y,fe).map((de,ge)=>this.buildPoint(de,"WAYPOINT",{profile:D,...this.configuration.bearings?{bearing:this.waypointsBearings[ge]}:void 0}))}),this.assignWaypointsCategories();const F=new Fu("setwaypoints",void 0);this.fire(F),this.draw();try{await this.fetchDirections(F)}catch{}}async addWaypoint(y,v){await this._addWaypoint(y,v)}async removeWaypoint(y){await this._removeWaypoint(y)}clear(){this.setWaypoints([]),this.routelines=[]}destroy(){var y;(y=this.abortController)==null||y.abort(),this.clear(),this.hoverable=!1,this.interactive=!1,this.configuration.layers.forEach(v=>{this.map.removeLayer(v.id)}),this.map.removeSource(this.configuration.sourceName)}}function ju(){}function a_(S){return S()}function Ag(){return Object.create(null)}function cd(S){S.forEach(a_)}function l_(S){return typeof S=="function"}function c_(S,y){return S!=S?y==y:S!==y||S&&typeof S=="object"||typeof S=="function"}function Ty(S){return Object.keys(S).length===0}function gn(S,y){S.appendChild(y)}function Uc(S,y,v){S.insertBefore(y,v||null)}function Rl(S){S.parentNode&&S.parentNode.removeChild(S)}function Sy(S,y){for(let v=0;v<S.length;v+=1)S[v]&&S[v].d(y)}function Fs(S){return document.createElement(S)}function ma(S){return document.createElementNS("http://www.w3.org/2000/svg",S)}function zf(S){return document.createTextNode(S)}function Vc(){return zf(" ")}function Py(){return zf("")}function Cf(S,y,v,k){return S.addEventListener(y,v,k),()=>S.removeEventListener(y,v,k)}function bt(S,y,v){v==null?S.removeAttribute(y):S.getAttribute(y)!==v&&S.setAttribute(y,v)}function Df(S){return S===""?null:+S}function My(S){return Array.from(S.childNodes)}function Cy(S,y){y=""+y,S.data!==y&&(S.data=y)}function Rf(S,y){S.value=y??""}function Bu(S,y,v,k){v==null?S.style.removeProperty(y):S.style.setProperty(y,v,k?"important":"")}let ld;function nd(S){ld=S}function Iy(){if(!ld)throw new Error("Function called outside component initialization");return ld}function Ay(S){Iy().$$.on_destroy.push(S)}const Kh=[],Xm=[];let Jh=[];const Eg=[],Ey=Promise.resolve();let Km=!1;function ky(){Km||(Km=!0,Ey.then(u_))}function Ym(S){Jh.push(S)}const qm=new Set;let Hh=0;function u_(){if(Hh!==0)return;const S=ld;do{try{for(;Hh<Kh.length;){const y=Kh[Hh];Hh++,nd(y),zy(y.$$)}}catch(y){throw Kh.length=0,Hh=0,y}for(nd(null),Kh.length=0,Hh=0;Xm.length;)Xm.pop()();for(let y=0;y<Jh.length;y+=1){const v=Jh[y];qm.has(v)||(qm.add(v),v())}Jh.length=0}while(Kh.length);for(;Eg.length;)Eg.pop()();Km=!1,qm.clear(),nd(S)}function zy(S){if(S.fragment!==null){S.update(),cd(S.before_update);const y=S.dirty;S.dirty=[-1],S.fragment&&S.fragment.p(S.ctx,y),S.after_update.forEach(Ym)}}function Dy(S){const y=[],v=[];Jh.forEach(k=>S.indexOf(k)===-1?y.push(k):v.push(k)),v.forEach(k=>k()),Jh=y}const Ry=new Set;function Ly(S,y){S&&S.i&&(Ry.delete(S),S.i(y))}function kg(S){return(S==null?void 0:S.length)!==void 0?S:Array.from(S)}function By(S,y,v){const{fragment:k,after_update:F}=S.$$;k&&k.m(y,v),Ym(()=>{const D=S.$$.on_mount.map(a_).filter(l_);S.$$.on_destroy?S.$$.on_destroy.push(...D):cd(D),S.$$.on_mount=[]}),F.forEach(Ym)}function Fy(S,y){const v=S.$$;v.fragment!==null&&(Dy(v.after_update),cd(v.on_destroy),v.fragment&&v.fragment.d(y),v.on_destroy=v.fragment=null,v.ctx=[])}function Oy(S,y){S.$$.dirty[0]===-1&&(Kh.push(S),ky(),S.$$.dirty.fill(0)),S.$$.dirty[y/31|0]|=1<<y%31}function h_(S,y,v,k,F,D,T=null,a=[-1]){const q=ld;nd(S);const Y=S.$$={fragment:null,ctx:[],props:D,update:ju,not_equal:F,bound:Ag(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(y.context||(q?q.$$.context:[])),callbacks:Ag(),dirty:a,skip_bound:!1,root:y.target||q.$$.root};T&&T(Y.root);let fe=!1;if(Y.ctx=v?v(S,y.props||{},(de,ge,...te)=>{const we=te.length?te[0]:ge;return Y.ctx&&F(Y.ctx[de],Y.ctx[de]=we)&&(!Y.skip_bound&&Y.bound[de]&&Y.bound[de](we),fe&&Oy(S,de)),ge}):[],Y.update(),fe=!0,cd(Y.before_update),Y.fragment=k?k(Y.ctx):!1,y.target){if(y.hydrate){const de=My(y.target);Y.fragment&&Y.fragment.l(de),de.forEach(Rl)}else Y.fragment&&Y.fragment.c();y.intro&&Ly(S.$$.fragment),By(S,y.target,y.anchor),u_()}nd(q)}class p_{constructor(){qt(this,"$$"),qt(this,"$$set")}$destroy(){Fy(this,1),this.$destroy=ju}$on(y,v){if(!l_(v))return ju;const k=this.$$.callbacks[y]||(this.$$.callbacks[y]=[]);return k.push(v),()=>{const F=k.indexOf(v);F!==-1&&k.splice(F,1)}}$set(y){this.$$set&&!Ty(y)&&(this.$$.skip_bound=!0,this.$$set(y),this.$$.skip_bound=!1)}}const jy="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(jy);function zg(S){let y,v,k,F,D,T,a,q,Y,fe,de,ge,te,we,it,Ke;return{c(){y=ma("svg"),v=ma("circle"),F=ma("path"),T=ma("g"),a=ma("path"),Y=ma("path"),de=ma("path"),te=ma("animateTransform"),bt(v,"cx","64.13"),bt(v,"cy","64.13"),bt(v,"r","27.63"),bt(v,"fill",k=S[0].fill),bt(F,"d","M64.13 18.5A45.63 45.63 0 1 1 18.5 64.13 45.63 45.63 0 0 1 64.13 18.5zm0 7.85a37.78 37.78 0 1 1-37.78 37.78 37.78 37.78 0 0 1 37.78-37.78z"),bt(F,"fill-rule","evenodd"),bt(F,"fill",D=S[0].fill),bt(a,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),bt(a,"fill",q=S[0].fill),bt(Y,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),bt(Y,"fill",fe=S[0].fill),bt(Y,"transform","rotate(120 64 64)"),bt(de,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),bt(de,"fill",ge=S[0].fill),bt(de,"transform","rotate(240 64 64)"),bt(te,"attributeName","transform"),bt(te,"type","rotate"),bt(te,"from","0 64 64"),bt(te,"to","120 64 64"),bt(te,"dur","360ms"),bt(te,"repeatCount","indefinite"),bt(y,"xmlns","http://www.w3.org/2000/svg"),bt(y,"width",we=S[0].size),bt(y,"height",it=S[0].size),bt(y,"viewBox","0 0 128 128"),bt(y,"xml:space","preserve"),bt(y,"class",Ke=S[0].class)},m(vt,Rt){Uc(vt,y,Rt),gn(y,v),gn(y,F),gn(y,T),gn(T,a),gn(T,Y),gn(T,de),gn(T,te)},p(vt,Rt){Rt&1&&k!==(k=vt[0].fill)&&bt(v,"fill",k),Rt&1&&D!==(D=vt[0].fill)&&bt(F,"fill",D),Rt&1&&q!==(q=vt[0].fill)&&bt(a,"fill",q),Rt&1&&fe!==(fe=vt[0].fill)&&bt(Y,"fill",fe),Rt&1&&ge!==(ge=vt[0].fill)&&bt(de,"fill",ge),Rt&1&&we!==(we=vt[0].size)&&bt(y,"width",we),Rt&1&&it!==(it=vt[0].size)&&bt(y,"height",it),Rt&1&&Ke!==(Ke=vt[0].class)&&bt(y,"class",Ke)},d(vt){vt&&Rl(y)}}}function Ny(S){let y,v=S[1]&&zg(S);return{c(){v&&v.c(),y=Py()},m(k,F){v&&v.m(k,F),Uc(k,y,F)},p(k,[F]){k[1]?v?v.p(k,F):(v=zg(k),v.c(),v.m(y.parentNode,y)):v&&(v.d(1),v=null)},i:ju,o:ju,d(k){k&&Rl(y),v&&v.d(k)}}}function $y(S,y,v){let{directions:k}=y,{configuration:F}=y,D;return k.on("fetchroutesstart",()=>{v(1,D=!0)}),k.on("fetchroutesend",()=>{v(1,D=!1)}),S.$$set=T=>{"directions"in T&&v(2,k=T.directions),"configuration"in T&&v(0,F=T.configuration)},[F,D,k]}class Vy extends p_{constructor(y){super(),h_(this,y,$y,Ny,c_,{directions:2,configuration:0})}}const Uy={fill:"#6d26d7",size:"24px",class:""};class Gy{constructor(y,v){qt(this,"controlElement"),qt(this,"directions"),qt(this,"configuration"),this.directions=y,this.configuration=Object.assign({},Uy,v)}onAdd(){return this.controlElement=document.createElement("div"),new Vy({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}function Dg(S,y,v){const k=S.slice();return k[16]=y[v],k[17]=y,k[18]=v,k}function Zy(S){let y,v,k,F,D,T,a,q,Y;function fe(){S[11].call(y,S[17],S[18])}return{c(){y=Fs("input"),T=Vc(),a=Fs("span"),a.textContent="°",bt(y,"type","number"),y.disabled=v=!S[16].enabled,bt(y,"min",k=S[0].degreesMin),bt(y,"max",F=S[0].degreesMax),bt(y,"step",D=S[0].degreesStep),bt(y,"class","maplibre-gl-directions-bearings-control__input"),bt(a,"class","maplibre-gl-directions-bearings-control__text")},m(de,ge){Uc(de,y,ge),Rf(y,S[16].degrees),Uc(de,T,ge),Uc(de,a,ge),q||(Y=Cf(y,"input",fe),q=!0)},p(de,ge){S=de,ge&2&&v!==(v=!S[16].enabled)&&(y.disabled=v),ge&1&&k!==(k=S[0].degreesMin)&&bt(y,"min",k),ge&1&&F!==(F=S[0].degreesMax)&&bt(y,"max",F),ge&1&&D!==(D=S[0].degreesStep)&&bt(y,"step",D),ge&2&&Df(y.value)!==S[16].degrees&&Rf(y,S[16].degrees)},d(de){de&&(Rl(y),Rl(T),Rl(a)),q=!1,Y()}}}function qy(S){let y,v=S[0].fixedDegrees+"",k,F;return{c(){y=Fs("span"),k=zf(v),F=zf("°"),bt(y,"class","maplibre-gl-directions-bearings-control__text")},m(D,T){Uc(D,y,T),gn(y,k),gn(y,F)},p(D,T){T&1&&v!==(v=D[0].fixedDegrees+"")&&Cy(k,v)},d(D){D&&Rl(y)}}}function Rg(S){let y,v,k,F,D,T,a,q,Y,fe,de,ge=S[18],te,we,it,Ke,vt,Rt,gt,nt,ht,Xe,ct,Tt,$t,Bi,Jt;function Ot(){S[7].call(F,S[17],S[18])}const Ft=()=>S[8](T,ge),Pt=()=>S[8](null,ge);function Wt(...Yi){return S[9](S[18],...Yi)}function jt(){S[10].call(we,S[17],S[18])}function gi(Yi,ni){return Yi[0].fixedDegrees?qy:Zy}let Pi=gi(S),cn=Pi(S);return{c(){y=Fs("div"),v=Fs("span"),v.textContent=`${S[18]+1}.`,k=Vc(),F=Fs("input"),D=Vc(),T=Fs("div"),a=ma("svg"),q=ma("circle"),de=ma("circle"),te=Vc(),we=Fs("input"),gt=Vc(),nt=Fs("span"),nt.textContent="°",ht=Vc(),Xe=Fs("span"),Xe.textContent="±",ct=Vc(),cn.c(),Tt=Vc(),bt(v,"class","maplibre-gl-directions-bearings-control__number text-slate-800"),bt(F,"type","checkbox"),bt(F,"class","maplibre-gl-directions-bearings-control__checkbox"),bt(q,"r","5"),bt(q,"cx","10"),bt(q,"cy","10"),bt(q,"fill","transparent"),bt(q,"stroke","rgba(109, 38, 215, 0.65)"),bt(q,"stroke-width","10"),bt(q,"stroke-dasharray",Y=S[16].degrees/3.6*31.42/100+" 31.42"),bt(q,"transform",fe="rotate("+(-90-S[16].degrees/2+S[16].angle-S[3])+")"),Bu(q,"transform-origin","10px 10px"),bt(de,"r","6"),bt(de,"cx","10"),bt(de,"cy","10"),bt(de,"fill","rgb(109, 38, 215)"),bt(a,"height","20"),bt(a,"width","20"),bt(a,"viewBox","0 0 20 20"),bt(a,"class","maplibre-gl-directions-bearings-control__waypoint-image"),Bu(a,"width",S[0].imageSize+"px"),Bu(a,"height",S[0].imageSize+"px"),Bu(a,"opacity",S[16].enabled?1:.25),bt(T,"role","spinbutton"),bt(T,"tabindex","0"),bt(we,"type","number"),we.disabled=it=!S[16].enabled,bt(we,"min",Ke=S[0].angleMin),bt(we,"max",vt=S[0].angleMax),bt(we,"step",Rt=S[0].angleStep),bt(we,"class","maplibre-gl-directions-bearings-control__input"),bt(nt,"class","maplibre-gl-directions-bearings-control__text"),bt(Xe,"class","maplibre-gl-directions-bearings-control__text"),bt(y,"class",$t="maplibre-gl-directions-bearings-control__list-item "+(S[16].enabled?"maplibre-gl-directions-bearings-control__list-item--enabled":"maplibre-gl-directions-bearings-control__list-item--disabled")+" flex items-center gap-2 text-slate-800"+(S[16].enabled?"":"/50"))},m(Yi,ni){Uc(Yi,y,ni),gn(y,v),gn(y,k),gn(y,F),F.checked=S[16].enabled,gn(y,D),gn(y,T),gn(T,a),gn(a,q),gn(a,de),Ft(),gn(y,te),gn(y,we),Rf(we,S[16].angle),gn(y,gt),gn(y,nt),gn(y,ht),gn(y,Xe),gn(y,ct),cn.m(y,null),gn(y,Tt),Bi||(Jt=[Cf(F,"change",Ot),Cf(T,"mousedown",Wt),Cf(we,"input",jt)],Bi=!0)},p(Yi,ni){S=Yi,ni&2&&(F.checked=S[16].enabled),ni&2&&Y!==(Y=S[16].degrees/3.6*31.42/100+" 31.42")&&bt(q,"stroke-dasharray",Y),ni&10&&fe!==(fe="rotate("+(-90-S[16].degrees/2+S[16].angle-S[3])+")")&&bt(q,"transform",fe),ni&1&&Bu(a,"width",S[0].imageSize+"px"),ni&1&&Bu(a,"height",S[0].imageSize+"px"),ni&2&&Bu(a,"opacity",S[16].enabled?1:.25),ge!==S[18]&&(Pt(),ge=S[18],Ft()),ni&2&&it!==(it=!S[16].enabled)&&(we.disabled=it),ni&1&&Ke!==(Ke=S[0].angleMin)&&bt(we,"min",Ke),ni&1&&vt!==(vt=S[0].angleMax)&&bt(we,"max",vt),ni&1&&Rt!==(Rt=S[0].angleStep)&&bt(we,"step",Rt),ni&2&&Df(we.value)!==S[16].angle&&Rf(we,S[16].angle),Pi===(Pi=gi(S))&&cn?cn.p(S,ni):(cn.d(1),cn=Pi(S),cn&&(cn.c(),cn.m(y,Tt))),ni&2&&$t!==($t="maplibre-gl-directions-bearings-control__list-item "+(S[16].enabled?"maplibre-gl-directions-bearings-control__list-item--enabled":"maplibre-gl-directions-bearings-control__list-item--disabled")+" flex items-center gap-2 text-slate-800"+(S[16].enabled?"":"/50"))&&bt(y,"class",$t)},d(Yi){Yi&&Rl(y),Pt(),cn.d(),Bi=!1,cd(Jt)}}}function Hy(S){let y,v,k,F=kg(S[1]),D=[];for(let T=0;T<F.length;T+=1)D[T]=Rg(Dg(S,F,T));return{c(){y=Fs("div"),v=Fs("div");for(let T=0;T<D.length;T+=1)D[T].c();bt(v,"class","maplibre-gl-directions-bearings-control__list flex flex-col max-h-96 overflow-y-auto"),bt(y,"class",k="maplibre-gl-directions-bearings-control maplibregl-ctrl maplibregl-ctrl-group p-4 "+(S[1].length?"block":"hidden")+" bg-white text-base rounded")},m(T,a){Uc(T,y,a),gn(y,v);for(let q=0;q<D.length;q+=1)D[q]&&D[q].m(v,null)},p(T,[a]){if(a&31){F=kg(T[1]);let q;for(q=0;q<F.length;q+=1){const Y=Dg(T,F,q);D[q]?D[q].p(Y,a):(D[q]=Rg(Y),D[q].c(),D[q].m(v,null))}for(;q<D.length;q+=1)D[q].d(1);D.length=F.length}a&2&&k!==(k="maplibre-gl-directions-bearings-control maplibregl-ctrl maplibregl-ctrl-group p-4 "+(T[1].length?"block":"hidden")+" bg-white text-base rounded")&&bt(y,"class",k)},i:ju,o:ju,d(T){T&&Rl(y),Sy(D,T)}}}function Wy(S,y,v){let{directions:k}=y,{configuration:F}=y;k.configuration.bearings||console.warn("The Bearings Control is used, but the `bearings` configuration option is not enabled!");let D=[];k.on("addwaypoint",T),k.on("removewaypoint",T),k.on("movewaypoint",T),k.on("setwaypoints",T);function T(){v(1,D=k.waypointsBearings.map((gt,nt)=>D[nt]?D[nt]:{enabled:F.defaultEnabled||!!gt,angle:gt?gt[0]:F.angleDefault,degrees:gt?gt[1]:F.fixedDegrees?F.fixedDegrees:F.degreesDefault}))}T();let a;const q=[];let Y=-1;function fe(gt,nt){var ht;(ht=D[nt])!=null&&ht.enabled&&(Y=nt,document.addEventListener("mouseup",de),document.addEventListener("mousemove",ge))}function de(){Y=-1,document.removeEventListener("mouseup",de),document.removeEventListener("mousemove",ge)}function ge(gt){const nt=q[Y];if(nt){const ht=nt.getBoundingClientRect().x+F.imageSize/2,Xe=nt.getBoundingClientRect().y+F.imageSize/2,ct=gt.pageX,Tt=gt.pageY,$t=Math.atan2(ct-ht,Tt-Xe)*(180/Math.PI)*-1+90;v(1,D[Y].angle=90+$t+te|0,D)}}Ay(()=>{document.removeEventListener("mouseup",de),document.removeEventListener("mousemove",ge)});let te=0;F.respectMapBearing&&k.map.on("rotate",()=>v(3,te=k.map.getBearing()));function we(gt,nt){gt[nt].enabled=this.checked,v(1,D)}function it(gt,nt){Xm[gt?"unshift":"push"](()=>{q[nt]=gt,v(2,q)})}const Ke=(gt,nt)=>fe(nt,gt);function vt(gt,nt){gt[nt].angle=Df(this.value),v(1,D)}function Rt(gt,nt){gt[nt].degrees=Df(this.value),v(1,D)}return S.$$set=gt=>{"directions"in gt&&v(5,k=gt.directions),"configuration"in gt&&v(0,F=gt.configuration)},S.$$.update=()=>{S.$$.dirty&67&&(a&&clearTimeout(a),v(6,a=setTimeout(()=>{v(5,k.waypointsBearings=D.map(gt=>gt.enabled?[gt.angle,gt.degrees]:void 0),k)},F.debounceTimeout)))},[F,D,q,te,fe,k,a,we,it,Ke,vt,Rt]}let Xy=class extends p_{constructor(S){super(),h_(this,S,Wy,Hy,c_,{directions:5,configuration:0})}};const Ky={defaultEnabled:!1,debounceTimeout:150,angleDefault:0,angleMin:0,angleMax:359,angleStep:1,fixedDegrees:0,degreesDefault:45,degreesMin:15,degreesMax:360,degreesStep:15,respectMapBearing:!1,imageSize:50};class Yy{constructor(y,v){qt(this,"controlElement"),qt(this,"directions"),qt(this,"configuration"),this.directions=y,this.configuration=Object.assign({},Ky,v)}onAdd(){return this.controlElement=document.createElement("div"),new Xy({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}function Lg(S){let y,v;return{c(){y=Ie("p"),v=_n(S[6]),lt(y,"class","text-red-500")},m(k,F){Ee(k,y,F),Ye(y,v)},p(k,F){F&64&&Qm(v,k[6])},d(k){k&&Ae(y)}}}function Jy(S){let y,v,k,F,D,T,a,q,Y,fe,de,ge,te,we,it,Ke,vt,Rt,gt,nt,ht,Xe,ct,Tt,$t,Bi,Jt,Ot,Ft=S[6]&&Lg(S);return{c(){Ft&&Ft.c(),y=mt(),v=Ie("label"),k=Ie("input"),D=mt(),T=Ie("strong"),T.textContent="Interactivity enabled",a=mt(),q=Ie("label"),Y=Ie("input"),de=mt(),ge=Ie("strong"),ge.textContent="Hover enabled",te=mt(),we=Ie("label"),it=Ie("input"),vt=mt(),Rt=Ie("strong"),Rt.textContent="Route switch",gt=mt(),nt=Ie("label"),ht=Ie("input"),ct=mt(),Tt=Ie("strong"),Tt.textContent="Update route while dragging",$t=mt(),Bi=Ie("ul"),Bi.innerHTML=`<li>Click somewhere on the map to add a waypoint</li> <li>Click a waypoint to remove it and its related snappoint</li> <li>Click a snappoint to remove it and its related waypoint</li> <li>Drag a waypoint somewhere to move it</li> <li>Drag a routeline somewhere to add a waypoint in-between the 2 nearest ones</li> <li>Click an alternative routeline to select it<br/> <small><strong>Note</strong>, there&#39;s usually no alternative routelines in the server response if there are more than
        2 waypoints</small></li>`,lt(k,"type","checkbox"),k.disabled=F=!S[0],lt(v,"class","flex items-center gap-3"),lt(Y,"type","checkbox"),Y.disabled=fe=!S[0],lt(q,"class","flex items-center gap-3"),lt(it,"type","checkbox"),it.disabled=Ke=!S[0]||!S[2],lt(we,"class","flex items-center gap-3 ml-5"),lt(ht,"type","checkbox"),ht.disabled=Xe=!S[0],lt(nt,"class","flex items-center gap-3")},m(Pt,Wt){Ft&&Ft.m(Pt,Wt),Ee(Pt,y,Wt),Ee(Pt,v,Wt),Ye(v,k),k.checked=S[1],Ye(v,D),Ye(v,T),Ee(Pt,a,Wt),Ee(Pt,q,Wt),Ye(q,Y),Y.checked=S[2],Ye(q,de),Ye(q,ge),Ee(Pt,te,Wt),Ee(Pt,we,Wt),Ye(we,it),it.checked=S[3],Ye(we,vt),Ye(we,Rt),Ee(Pt,gt,Wt),Ee(Pt,nt,Wt),Ye(nt,ht),ht.checked=S[5],Ye(nt,ct),Ye(nt,Tt),Ee(Pt,$t,Wt),Ee(Pt,Bi,Wt),Jt||(Ot=[Ri(k,"change",S[9]),Ri(Y,"change",S[10]),Ri(it,"change",S[11]),Ri(ht,"change",S[12]),Ri(ht,"click",S[8])],Jt=!0)},p(Pt,Wt){Pt[6]?Ft?Ft.p(Pt,Wt):(Ft=Lg(Pt),Ft.c(),Ft.m(y.parentNode,y)):Ft&&(Ft.d(1),Ft=null),Wt&1&&F!==(F=!Pt[0])&&(k.disabled=F),Wt&2&&(k.checked=Pt[1]),Wt&1&&fe!==(fe=!Pt[0])&&(Y.disabled=fe),Wt&4&&(Y.checked=Pt[2]),Wt&5&&Ke!==(Ke=!Pt[0]||!Pt[2])&&(it.disabled=Ke),Wt&8&&(it.checked=Pt[3]),Wt&1&&Xe!==(Xe=!Pt[0])&&(ht.disabled=Xe),Wt&32&&(ht.checked=Pt[5])},d(Pt){Pt&&(Ae(y),Ae(v),Ae(a),Ae(q),Ae(te),Ae(we),Ae(gt),Ae(nt),Ae($t),Ae(Bi)),Ft&&Ft.d(Pt),Jt=!1,Os(Ot)}}}function Qy(S){let y;return{c(){y=Ie("span"),y.textContent=`${S[7].name}`,lt(y,"slot","title")},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function e0(S){let y,v,k,F;return y=new zo({props:{$$slots:{title:[Qy],default:[Jy]},$$scope:{ctx:S}}}),{c(){dr(y.$$.fragment),v=mt(),k=Ie("div"),lt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(D,T){or(y,D,T),Ee(D,v,T),Ee(D,k,T),S[13](k),F=!0},p(D,[T]){const a={};T&65647&&(a.$$scope={dirty:T,ctx:D}),y.$set(a)},i(D){F||(Cn(y.$$.fragment,D),F=!0)},o(D){Ln(y.$$.fragment,D),F=!1},d(D){D&&(Ae(v),Ae(k)),sr(y,D),S[13](null)}}}function t0(S,y,v){let k;Eo(S,ko,gt=>v(15,k=gt));const F=Jr.find(gt=>gt.path===k);let D,T,a,q=!0,Y=!1,fe=!1,de=!1;function ge(){a&&a.destroy(),v(0,a=new Ao(T,{requestOptions:{alternatives:"true"},refreshOnMove:!de}))}Ko(()=>{T=new ln.Map({container:D,style:Yo,center:[-74.1197632,40.6974034],zoom:11,attributionControl:!1}),T.addControl(new ln.AttributionControl({customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"})),T.on("load",()=>{v(0,a=new Ao(T,{requestOptions:{alternatives:"true"}}))})});let te;function we(){q=this.checked,v(1,q)}function it(){Y=this.checked,v(2,Y)}function Ke(){fe=this.checked,v(3,fe)}function vt(){de=this.checked,v(5,de)}function Rt(gt){go[gt?"unshift":"push"](()=>{D=gt,v(4,D)})}return S.$$.update=()=>{S.$$.dirty&15&&a&&(a.hoverable!==Y&&v(0,a.hoverable=Y,a),a.interactive!==q&&v(0,a.interactive=q,a),a.allowRouteSwitch!==fe&&v(0,a.allowRouteSwitch=fe,a),a.on("fetchroutesend",gt=>{gt.data&&gt.data.code!=="Ok"?v(6,te=`${gt.data.code}: ${gt.data.message??"no details available."}`):v(6,te="")}))},[a,q,Y,fe,D,de,te,F,ge,we,it,Ke,vt,Rt]}class i0 extends jr{constructor(y){super(),Or(this,y,t0,e0,xr,{})}}const n0=Object.freeze(Object.defineProperty({__proto__:null,default:i0},Symbol.toStringTag,{value:"Module"}));function r0(S){let y,v,k,F,D,T,a,q,Y,fe,de,ge,te,we,it,Ke,vt,Rt,gt,nt,ht,Xe,ct,Tt,$t,Bi,Jt,Ot,Ft,Pt,Wt,jt,gi,Pi,cn,Yi,ni,br,wr,pn,Fi,Tr,fr,mr,In,gr,Ji,Ni,Zn,mi,Sr,Yn,Qi,Nr,ar,yn,An,vn,lr,Jo,Bn,$r,Pr,en,Mr,Cr,cr,Qr,Do,En,Q,U,H,W,ae,_e,Pe,De,Te,Ne,Oe,Me,be,pt,dt;return{c(){y=Ie("p"),y.innerHTML=`The <a href="http://project-osrm.org/docs/v5.24.0/api/#requests" target="_blank" rel="noreferrer">bearings</a> support
    allows to control in which direction the route would be continued from a given waypoint.`,v=mt(),k=Ie("p"),k.innerHTML=`In order to enable support for this API option on the plugin level, pass the <code>bearings: true</code> option to
    the plugin&#39;s configuration object. When this is done, each request would contain the <code>bearings</code> field. The
    problem with that is that the values for the waypoints&#39; bearings are not populated correctly since we need some way to
    assign these bearings values to our waypoints.`,F=mt(),D=Ie("p"),D.innerHTML="Luckily, that&#39;s possible to achieve using the built-in <strong>Bearings Control</strong>.",T=mt(),a=Ie("label"),q=Ie("input"),fe=mt(),de=Ie("strong"),de.textContent="Default Enabled",ge=mt(),te=Ie("label"),we=Ie("span"),we.innerHTML="<strong>Debounce timeout</strong>",it=mt(),Ke=Ie("input"),Rt=mt(),gt=Ie("label"),nt=Ie("span"),nt.innerHTML="<strong>Default angle</strong>",ht=mt(),Xe=Ie("input"),Tt=mt(),$t=Ie("label"),Bi=Ie("span"),Bi.innerHTML="<strong>Minimal allowed angle</strong>",Jt=mt(),Ot=Ie("input"),Pt=mt(),Wt=Ie("label"),jt=Ie("span"),jt.innerHTML="<strong>Maximal allowed angle</strong>",gi=mt(),Pi=Ie("input"),Yi=mt(),ni=Ie("label"),br=Ie("span"),br.innerHTML="<strong>Angle step</strong>",wr=mt(),pn=Ie("input"),Tr=mt(),fr=Ie("label"),mr=Ie("span"),mr.innerHTML="<strong>Fixed degrees</strong>",In=mt(),gr=Ie("input"),Ni=mt(),Zn=Ie("label"),mi=Ie("span"),mi.innerHTML="<strong>Degrees default</strong>",Sr=mt(),Yn=Ie("input"),Nr=mt(),ar=Ie("label"),yn=Ie("span"),yn.innerHTML="<strong>Minimal allowed degrees</strong>",An=mt(),vn=Ie("input"),Jo=mt(),Bn=Ie("label"),$r=Ie("span"),$r.innerHTML="<strong>Maximal allowed degrees</strong>",Pr=mt(),en=Ie("input"),Cr=mt(),cr=Ie("label"),Qr=Ie("span"),Qr.innerHTML="<strong>Degrees step</strong>",Do=mt(),En=Ie("input"),U=mt(),H=Ie("label"),W=Ie("input"),_e=mt(),Pe=Ie("strong"),Pe.textContent="Respect Map's Bearing",De=mt(),Te=Ie("label"),Ne=Ie("span"),Ne.innerHTML="<strong>Image size</strong>",Oe=mt(),Me=Ie("input"),lt(q,"type","checkbox"),q.disabled=Y=!S[0],lt(a,"class","flex items-center gap-3"),lt(Ke,"type","number"),Ke.disabled=vt=!S[0],lt(te,"class","flex flex-col gap-2"),lt(Xe,"type","number"),Xe.disabled=ct=!S[0],lt(gt,"class","flex flex-col gap-2"),lt(Ot,"type","number"),Ot.disabled=Ft=!S[0],lt($t,"class","flex flex-col gap-2"),lt(Pi,"type","number"),Pi.disabled=cn=!S[0],lt(Wt,"class","flex flex-col gap-2"),lt(pn,"type","number"),pn.disabled=Fi=!S[0],lt(ni,"class","flex flex-col gap-2"),lt(gr,"type","number"),gr.disabled=Ji=!S[0],lt(fr,"class","flex flex-col gap-2"),lt(Yn,"type","number"),Yn.disabled=Qi=!S[0]||!!S[1].fixedDegrees,lt(Zn,"class","flex flex-col gap-2"),lt(vn,"type","number"),vn.disabled=lr=!S[0]||!!S[1].fixedDegrees,lt(ar,"class","flex flex-col gap-2"),lt(en,"type","number"),en.disabled=Mr=!S[0]||!!S[1].fixedDegrees,lt(Bn,"class","flex flex-col gap-2"),lt(En,"type","number"),En.disabled=Q=!S[0]||!!S[1].fixedDegrees,lt(cr,"class","flex flex-col gap-2"),lt(W,"type","checkbox"),W.disabled=ae=!S[0],lt(H,"class","flex items-center gap-3"),lt(Me,"type","number"),Me.disabled=be=!S[0],lt(Te,"class","flex flex-col gap-2")},m(qe,rt){Ee(qe,y,rt),Ee(qe,v,rt),Ee(qe,k,rt),Ee(qe,F,rt),Ee(qe,D,rt),Ee(qe,T,rt),Ee(qe,a,rt),Ye(a,q),q.checked=S[1].defaultEnabled,Ye(a,fe),Ye(a,de),Ee(qe,ge,rt),Ee(qe,te,rt),Ye(te,we),Ye(te,it),Ye(te,Ke),Gi(Ke,S[1].debounceTimeout),Ee(qe,Rt,rt),Ee(qe,gt,rt),Ye(gt,nt),Ye(gt,ht),Ye(gt,Xe),Gi(Xe,S[1].angleDefault),Ee(qe,Tt,rt),Ee(qe,$t,rt),Ye($t,Bi),Ye($t,Jt),Ye($t,Ot),Gi(Ot,S[1].angleMin),Ee(qe,Pt,rt),Ee(qe,Wt,rt),Ye(Wt,jt),Ye(Wt,gi),Ye(Wt,Pi),Gi(Pi,S[1].angleMax),Ee(qe,Yi,rt),Ee(qe,ni,rt),Ye(ni,br),Ye(ni,wr),Ye(ni,pn),Gi(pn,S[1].angleStep),Ee(qe,Tr,rt),Ee(qe,fr,rt),Ye(fr,mr),Ye(fr,In),Ye(fr,gr),Gi(gr,S[1].fixedDegrees),Ee(qe,Ni,rt),Ee(qe,Zn,rt),Ye(Zn,mi),Ye(Zn,Sr),Ye(Zn,Yn),Gi(Yn,S[1].degreesDefault),Ee(qe,Nr,rt),Ee(qe,ar,rt),Ye(ar,yn),Ye(ar,An),Ye(ar,vn),Gi(vn,S[1].degreesMin),Ee(qe,Jo,rt),Ee(qe,Bn,rt),Ye(Bn,$r),Ye(Bn,Pr),Ye(Bn,en),Gi(en,S[1].degreesMax),Ee(qe,Cr,rt),Ee(qe,cr,rt),Ye(cr,Qr),Ye(cr,Do),Ye(cr,En),Gi(En,S[1].degreesStep),Ee(qe,U,rt),Ee(qe,H,rt),Ye(H,W),W.checked=S[1].respectMapBearing,Ye(H,_e),Ye(H,Pe),Ee(qe,De,rt),Ee(qe,Te,rt),Ye(Te,Ne),Ye(Te,Oe),Ye(Te,Me),Gi(Me,S[1].imageSize),pt||(dt=[Ri(q,"change",S[6]),Ri(Ke,"input",S[7]),Ri(Xe,"input",S[8]),Ri(Ot,"input",S[9]),Ri(Pi,"input",S[10]),Ri(pn,"input",S[11]),Ri(gr,"input",S[12]),Ri(Yn,"input",S[13]),Ri(vn,"input",S[14]),Ri(en,"input",S[15]),Ri(En,"input",S[16]),Ri(W,"change",S[17]),Ri(Me,"input",S[18])],pt=!0)},p(qe,rt){rt&1&&Y!==(Y=!qe[0])&&(q.disabled=Y),rt&2&&(q.checked=qe[1].defaultEnabled),rt&1&&vt!==(vt=!qe[0])&&(Ke.disabled=vt),rt&2&&Rn(Ke.value)!==qe[1].debounceTimeout&&Gi(Ke,qe[1].debounceTimeout),rt&1&&ct!==(ct=!qe[0])&&(Xe.disabled=ct),rt&2&&Rn(Xe.value)!==qe[1].angleDefault&&Gi(Xe,qe[1].angleDefault),rt&1&&Ft!==(Ft=!qe[0])&&(Ot.disabled=Ft),rt&2&&Rn(Ot.value)!==qe[1].angleMin&&Gi(Ot,qe[1].angleMin),rt&1&&cn!==(cn=!qe[0])&&(Pi.disabled=cn),rt&2&&Rn(Pi.value)!==qe[1].angleMax&&Gi(Pi,qe[1].angleMax),rt&1&&Fi!==(Fi=!qe[0])&&(pn.disabled=Fi),rt&2&&Rn(pn.value)!==qe[1].angleStep&&Gi(pn,qe[1].angleStep),rt&1&&Ji!==(Ji=!qe[0])&&(gr.disabled=Ji),rt&2&&Rn(gr.value)!==qe[1].fixedDegrees&&Gi(gr,qe[1].fixedDegrees),rt&3&&Qi!==(Qi=!qe[0]||!!qe[1].fixedDegrees)&&(Yn.disabled=Qi),rt&2&&Rn(Yn.value)!==qe[1].degreesDefault&&Gi(Yn,qe[1].degreesDefault),rt&3&&lr!==(lr=!qe[0]||!!qe[1].fixedDegrees)&&(vn.disabled=lr),rt&2&&Rn(vn.value)!==qe[1].degreesMin&&Gi(vn,qe[1].degreesMin),rt&3&&Mr!==(Mr=!qe[0]||!!qe[1].fixedDegrees)&&(en.disabled=Mr),rt&2&&Rn(en.value)!==qe[1].degreesMax&&Gi(en,qe[1].degreesMax),rt&3&&Q!==(Q=!qe[0]||!!qe[1].fixedDegrees)&&(En.disabled=Q),rt&2&&Rn(En.value)!==qe[1].degreesStep&&Gi(En,qe[1].degreesStep),rt&1&&ae!==(ae=!qe[0])&&(W.disabled=ae),rt&2&&(W.checked=qe[1].respectMapBearing),rt&1&&be!==(be=!qe[0])&&(Me.disabled=be),rt&2&&Rn(Me.value)!==qe[1].imageSize&&Gi(Me,qe[1].imageSize)},d(qe){qe&&(Ae(y),Ae(v),Ae(k),Ae(F),Ae(D),Ae(T),Ae(a),Ae(ge),Ae(te),Ae(Rt),Ae(gt),Ae(Tt),Ae($t),Ae(Pt),Ae(Wt),Ae(Yi),Ae(ni),Ae(Tr),Ae(fr),Ae(Ni),Ae(Zn),Ae(Nr),Ae(ar),Ae(Jo),Ae(Bn),Ae(Cr),Ae(cr),Ae(U),Ae(H),Ae(De),Ae(Te)),pt=!1,Os(dt)}}}function o0(S){let y;return{c(){y=Ie("span"),y.textContent=`${S[3].name}`,lt(y,"slot","title")},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function s0(S){let y,v,k,F;return y=new zo({props:{$$slots:{title:[o0],default:[r0]},$$scope:{ctx:S}}}),{c(){dr(y.$$.fragment),v=mt(),k=Ie("div"),lt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(D,T){or(y,D,T),Ee(D,v,T),Ee(D,k,T),S[19](k),F=!0},p(D,[T]){const a={};T&2097155&&(a.$$scope={dirty:T,ctx:D}),y.$set(a)},i(D){F||(Cn(y.$$.fragment,D),F=!0)},o(D){Ln(y.$$.fragment,D),F=!1},d(D){D&&(Ae(v),Ae(k)),sr(y,D),S[19](null)}}}function a0(S,y,v){let k;Eo(S,ko,Tt=>v(20,k=Tt));const F=Jr.find(Tt=>Tt.path===k);let D,T,a;Ko(()=>{v(4,T=new ln.Map({container:D,style:Yo,center:[-74.1197632,40.6974034],zoom:11,attributionControl:!1})),T.addControl(new ln.AttributionControl({customAttribution:"<a href='http://project-osrm.org/' target='_blank' rel='noreferrer'>&copy; OSRM</a>"})),T.on("load",()=>{v(0,a=new Ao(T,{bearings:!0})),v(0,a.interactive=!0,a),T.addControl(new e_.NavigationControl({}))})});let q,Y={defaultEnabled:!1,debounceTimeout:150,angleDefault:0,angleMin:0,angleMax:359,angleStep:1,fixedDegrees:0,degreesDefault:45,degreesMin:15,degreesMax:360,degreesStep:15,respectMapBearing:!1,imageSize:50};function fe(){Y.defaultEnabled=this.checked,v(1,Y)}function de(){Y.debounceTimeout=Rn(this.value),v(1,Y)}function ge(){Y.angleDefault=Rn(this.value),v(1,Y)}function te(){Y.angleMin=Rn(this.value),v(1,Y)}function we(){Y.angleMax=Rn(this.value),v(1,Y)}function it(){Y.angleStep=Rn(this.value),v(1,Y)}function Ke(){Y.fixedDegrees=Rn(this.value),v(1,Y)}function vt(){Y.degreesDefault=Rn(this.value),v(1,Y)}function Rt(){Y.degreesMin=Rn(this.value),v(1,Y)}function gt(){Y.degreesMax=Rn(this.value),v(1,Y)}function nt(){Y.degreesStep=Rn(this.value),v(1,Y)}function ht(){Y.respectMapBearing=this.checked,v(1,Y)}function Xe(){Y.imageSize=Rn(this.value),v(1,Y)}function ct(Tt){go[Tt?"unshift":"push"](()=>{D=Tt,v(2,D)})}return S.$$.update=()=>{S.$$.dirty&51&&T&&a&&(q&&T.hasControl(q)&&T.removeControl(q),T.addControl(v(5,q=new Yy(a,Y)),"top-left"))},[a,Y,D,F,T,q,fe,de,ge,te,we,it,Ke,vt,Rt,gt,nt,ht,Xe,ct]}class l0 extends jr{constructor(y){super(),Or(this,y,a0,s0,xr,{})}}const c0=Object.freeze(Object.defineProperty({__proto__:null,default:l0},Symbol.toStringTag,{value:"Module"})),u0=[{id:"maplibre-gl-directions-snapline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[2,2],"line-color":"#ffffff","line-opacity":.65,"line-width":2},filter:["==",["get","type"],"SNAPLINE"]},{id:"maplibre-gl-directions-alt-routeline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-pattern":"routeline","line-width":12,"line-opacity":.5},filter:["==",["get","route"],"ALT"]},{id:"maplibre-gl-directions-routeline",type:"line",source:"maplibre-gl-directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-pattern":"routeline","line-width":12},filter:["==",["get","route"],"SELECTED"]},{id:"maplibre-gl-directions-hoverpoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-hoverpoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"HOVERPOINT"]},{id:"maplibre-gl-directions-snappoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-snappoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"SNAPPOINT"]},{id:"maplibre-gl-directions-waypoint",type:"symbol",source:"maplibre-gl-directions",layout:{"icon-image":"balloon-waypoint","icon-anchor":"bottom","icon-ignore-placement":!0,"icon-overlap":"always"},filter:["==",["get","type"],"WAYPOINT"]}],h0="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJpSURBVEiJlZRLSFQBFIa/c2dyGMXHNKUrq0WLgsxt214L20gG0gxGhIIktIk2IS3bRFG4ahFBYQPlY8pQNxkFUbSQigyEiBKLIk3vOODUPO5pMV4fM/fOnTmbuffc8//ff+5jBI8abF9qEb/0iHIU2LPW/obyzEDvnI5vnymlF7cLE20aSAQTNxXtBQyXsZwKt7cZDRc7hyRdNmCiTQNm0JwEDtu92maoa84fr8xDcn6L5Lnf19DmBPE7AZarE7dE8+Y1jXCgWwntLZj5DB/vCqu/ATiSy5k3gAueGwy2L7UYPnkPGMEdcKhfCdQ5xYB0QnhzFVJ/AMghVmt0JPxp80zRvRW/9Nj9/VF3c4CqemVfRO1Tn2J0F84UAyyOAQTqYOdBd3O7GluhqnZNqxz3BCDsAqhuAnF9xzaNG1DTtH662xuA+gGsjLe5XVZ2TQk+T4AgPwGS35XsX2/zbAqSP2wtvzwBCh/yqYS5KW/A3NSWbd95AkDG7aMvY8LijPuDWJzJz6yHU8Y8ARk14kAW8vd2egBmh2B1YWNmdQFmH8L0gGDlNqSk5WlRXKdksQ5zHPREYd8fzP9mU44LxaOjoQ7PDQBQvebUzqZczRHDuu7UdwRE46GXwCtnK6c8TEWGw6/LBuQTcaVcf8Mw+t0uugIiw6EXqD7yche4Fxmpf1sxAEAsvQQkS7gv+3yZy6U8SgIiT8LzSPF/vF1qaV/nUGPR17s1QxkVO2nGEI0UtO9HR0NnvbQlN7Drn2ofMLcp1VcrZbluVjHg3OOQKYaeATJAGsPq6poMr5SjragenFo6H+sweyvR/Ac3+sqU/+vBXgAAAABJRU5ErkJggg==",p0="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJwSURBVEiJlZTNSxRxGMc/v98KZmm67qJQ2At0Ksy/obeDXSy7ZBS5KEiCHaJLSMcuUSSeOmi7BkW16taKeDCjMIJOFRgUHSzMjExdc2O3fZmnwzrr6s7s7D6Xmeft+3me+c2MwsGWW9obVZnqRDgG7FsPf0V4LuiB2tDgTKF+ZZeQ5p7y1YroHYEuQNuUpVFyt0b/vaKCwUTRAGnuKY9URCeAI9lgwy5o2J25n5uHuR+5LS9qXNFmK0iZFWB1+1ofojLidV6k4ywc2L+56Mss6t4j+PUb4GgkXXkb6HHcYLmlvVG51HtA461Fei/DziqrOVCrUbjRB0srAGlDGU2ekaGPuTV5z1aVqU4zLudO2YoDSHUl0tZiui6N7thak394BseBjPDhg7biWWs6BFU71omccAYo9gBQ7wVl+5LlKGiorzO9vY4AMQ8+mXIWNy2VrXU5AhSyACDfFyD+z1k8Fof5BdP76QgA/QFApVIwNe0MmJrO2VbeOQIUMp69D0+iZj7bi898QoUnN3zRYUeAlnQIyIyUSkH/AATHYHFpo2hxCR6HUf2DkE6b0aRKxMfyB7awSKtvXOBkXqJiW+Yai1u1hdyj/lbHDQBEuGkVJxa3E8fQ3LKKWwLcIf8r4LWlkuVEasoz7H9TNCCTkevFymstvbYydgn3cOClCE+K0B+qHvG/LRkAIAZXgTXbAqVWki6uFdIoCPA888+h8v/xGwMY3XXBQN7Xu2mGQknTIqd9D0XRtiV83z3qv+jUW3AD00SkG/iWE5k1YgnbzUoGuJ8GIqLlApAEEoZW5z0TD/4U01uSLZ/xXYq0+rpK6fkPouPQTszwGH0AAAAASUVORK5CYII=",d0="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAKQSURBVEiJlZRLSFRRGMd/586rVHQySDMqXRRESJuQ1BTsiS1atK5NGpIgodQiIghqleWYbVr0wDZpG6nUICym0UZ0kQXZTlSMHDUczee87mkxXlPn3rl3vtU5//N9/9/5zj3nCkyi3F9fiKBaSk4C+WvymIQeu4w99Za2/EhWL4wWKrvrXItZNg9C1ACKQVpMIp4EszIbhg/fCVsGVHbXuRZ22N8LSYWmFWzLocCVC8BoKMDo6tTGkk+zWVmVehC7HmDRbW/WzHc7s7mWd55D2/duyvm5MkHL7zdMhoMAJ7Ln5x8CdaYdlPvrCyV8A5RdDjeN+Zdx29P19sFcdIkbY8+YjswDxFSVI1+Oe4Y35iSeraBa06/knjU0B3Db06nKOaNNbYpC1dacBICUnNKKj2YcMDTXoijjIJm2tHgt8rQpANgHkOfIRjG+ZP8NhMIe504ABGK/FYAdIELM1FyLiIxqQ5sVwCTA2OoUK6ru1d4Uy2qI8fCMNg1YAIjv8V3F6AwOmgI6ZweJqGsdCIbMAULt0obtMz6GFkcMzb8ujdD+p3d9LqV4awpwKpEOIArxLu7+auPFdA+B+IMCIBAO8nzqA/cm2ojK9W8VIeZ8l7BfvZ2V9dd3ITm3VU9TXED83HWMOnwlngumHQAgua8nL6shXfM1xAM9VRfQW+L5jJR9Bk568dFX0uS3DACQCrctmksp1FtGi4aAvuJmr4TXFuxb+4ofDaQMAFDs4jqwkCQlaHM4bib1SLboK2qaECLxH78eklpvUWPC67UMAPAVe1pBvNqqC+TL3lJPm1m9KQDAFlJrgfEN0mhIiRl3lirAW9E8p6hcAiJAWCAuDhx7/NdKbUpR1t9wtdzfUJNKzT8AkN+WDptOYQAAAABJRU5ErkJggg==",f0="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAACmAAAApgHdff84AAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAN9JREFUSIlj/P//PwMtARNNTWdgYGB0ic61oKUFLP8Z/h+nqQURFj9paT4Di4HsH9paULGam6YW0DwVjVpAELAwMDAwaKsqMthbGMEFn714zbBh9yGGSD83BkF+Xrj49gOQLOPpYAkXe//xM8PyTbsYAlztGKQkROHiB0+cY7h6+z7EAlZWFgYeLk64JAcHOwMDAwMDNycHijgLMzMDAwMDitivX7/hepDFWVlZGBgYGBgYnaNzaFraDf1IHvoWsDQFfqOtBY/e0dYTLHMOctDWAkYGRkvCysgHjEO+VQEA4IsuY5Zs3DIAAAAASUVORK5CYII=";function m0(S){let y,v,k,F,D,T,a,q,Y,fe;return{c(){y=Ie("p"),v=_n(`It's completely up to you how to style the Directions' features shown on the map. You can either use the default
    styles provided by the plugin (see other examples), easily modify the default features' dimensions (see the
    `),k=Ie("a"),k.textContent="Touch-Friendly Features example",F=_n(`) or
    `),D=Ie("strong"),D.textContent="define your custom features' styles from scratch",T=_n("."),a=mt(),q=Ie("p"),q.textContent="This example demonstrates the last option.",lt(k,"href","/examples/touch-friendly-features")},m(de,ge){Ee(de,y,ge),Ye(y,v),Ye(y,k),Ye(y,F),Ye(y,D),Ye(y,T),Ee(de,a,ge),Ee(de,q,ge),Y||(fe=Ff(Nf.call(null,k)),Y=!0)},p:zi,d(de){de&&(Ae(y),Ae(a),Ae(q)),Y=!1,fe()}}}function g0(S){let y;return{c(){y=Ie("span"),y.textContent=`${S[1].name}`,lt(y,"slot","title")},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function _0(S){let y,v,k,F;return y=new zo({props:{$$slots:{title:[g0],default:[m0]},$$scope:{ctx:S}}}),{c(){dr(y.$$.fragment),v=mt(),k=Ie("div"),lt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(D,T){or(y,D,T),Ee(D,v,T),Ee(D,k,T),S[2](k),F=!0},p(D,[T]){const a={};T&32&&(a.$$scope={dirty:T,ctx:D}),y.$set(a)},i(D){F||(Cn(y.$$.fragment,D),F=!0)},o(D){Ln(y.$$.fragment,D),F=!1},d(D){D&&(Ae(v),Ae(k)),sr(y,D),S[2](null)}}}function y0(S,y,v){let k;Eo(S,ko,q=>v(4,k=q));const F=Jr.find(q=>q.path===k);let D,T;Ko(()=>{const q=new ln.Map({container:D,style:Yo,center:[-74.1197632,40.6974034],zoom:11,fadeDuration:0,attributionControl:!1});q.addControl(new ln.AttributionControl({customAttribution:`<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a> | Icons made by <a href="https://www.flaticon.com/authors/vectors-market" title="Vectors Market">Vectors Market</a> and by <a href="https://www.flaticon.com/authors/dinosoftlabs" title="DinosoftLabs">DinosoftLabs</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>`})),q.on("load",()=>{q.loadImage(h0).then(Y=>{Y&&q.addImage("balloon-waypoint",Y.data)}),q.loadImage(p0).then(Y=>{Y&&q.addImage("balloon-snappoint",Y.data)}),q.loadImage(d0).then(Y=>{Y&&q.addImage("balloon-hoverpoint",Y.data)}),q.loadImage(f0).then(Y=>{Y&&q.addImage("routeline",Y.data)}),T=new Ao(q,{requestOptions:{alternatives:"true"},layers:u0,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline"]}),T.interactive=!0})});function a(q){go[q?"unshift":"push"](()=>{D=q,v(0,D)})}return[D,F,a]}class v0 extends jr{constructor(y){super(),Or(this,y,y0,_0,xr,{})}}const x0=Object.freeze(Object.defineProperty({__proto__:null,default:v0},Symbol.toStringTag,{value:"Module"}));class b0 extends Ao{constructor(v,k){super(v,k);td(this,"originalBuildRoutelines",wy.buildRoutelines);td(this,"buildRoutelines",(v,k,F,D)=>{const T=this.originalBuildRoutelines(v,k,F,D);return T[0].forEach((a,q)=>{a.properties&&(a.properties.distance=k[0].legs[q].distance)}),T})}}const mo="distance-measurement-maplibre-gl-directions",w0={sourceName:mo,layers:[{id:`${mo}-snapline`,type:"line",source:mo,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":"#34343f","line-width":2},filter:["==",["get","type"],"SNAPLINE"]},{id:`${mo}-routeline`,type:"line",source:mo,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#212121","line-opacity":.85,"line-width":3},filter:["==",["get","route"],"SELECTED"]},{id:`${mo}-routeline-distance`,type:"symbol",source:mo,layout:{"symbol-placement":"line-center","text-field":"{distance}m","text-size":16,"text-ignore-placement":!0,"text-allow-overlap":!0,"text-overlap":"always"},paint:{"text-color":"#212121","text-halo-color":"#ffffff","text-halo-width":1},filter:["==",["get","route"],"SELECTED"]},{id:`${mo}-hoverpoint`,type:"circle",source:mo,paint:{"circle-radius":9,"circle-color":"#212121"},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${mo}-snappoint`,type:"circle",source:mo,paint:{"circle-radius":["case",["boolean",["get","highlight"],!1],9,7],"circle-color":["case",["boolean",["get","highlight"],!1],"#313131","#494949"]},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${mo}-waypoint`,type:"circle",source:mo,paint:{"circle-radius":["case",["boolean",["get","highlight"],!1],9,7],"circle-color":["case",["boolean",["get","highlight"],!1],"#212121","#2c2c2c"]},filter:["==",["get","type"],"WAYPOINT"]}],sensitiveSnappointLayers:[`${mo}-snappoint`],sensitiveWaypointLayers:[`${mo}-waypoint`],sensitiveRoutelineLayers:[`${mo}-routeline`],sensitiveAltRoutelineLayers:[]};function T0(S){let y;return{c(){y=Ie("em"),y.textContent="unknown"},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function S0(S){let y,v,k;return{c(){y=Ie("strong"),v=_n(S[1]),k=_n("m")},m(F,D){Ee(F,y,D),Ye(y,v),Ye(y,k)},p(F,D){D&2&&Qm(v,F[1])},d(F){F&&Ae(y)}}}function P0(S){let y,v,k,F,D,T,a,q,Y,fe;function de(we,it){return we[1]?S0:T0}let ge=de(S),te=ge(S);return{c(){y=Ie("p"),v=_n(`Total Route Distance:
    `),te.c(),k=mt(),F=Ie("small"),F.innerHTML="<strong>Note</strong> that you might want to zoom in and out the map to toggle the distance-annotations visibility",D=mt(),T=Ie("p"),T.textContent=`This is an example of how one could use the plugin's extensibility interfaces to create a distance measurement tool
    out of it.`,a=mt(),q=Ie("p"),q.innerHTML=`Here we create a subclass of the <code>MapLibreGlDirections</code> main super class and augment the original
    <code>buildRoutelines</code>
    method to write each route leg&#39;s distance into a respective feature&#39;s <code>properties</code> object. These saved distances
    are then used by an additional &quot;symbol&quot; layer that displays them along the respective route&#39;s lines on the map.`,Y=mt(),fe=Ie("p"),fe.textContent=`The total distance comes from the response's specific field and is updated each time there's the "fetchroutesend" or
    the "removewaypoint" event fired.`},m(we,it){Ee(we,y,it),Ye(y,v),te.m(y,null),Ee(we,k,it),Ee(we,F,it),Ee(we,D,it),Ee(we,T,it),Ee(we,a,it),Ee(we,q,it),Ee(we,Y,it),Ee(we,fe,it)},p(we,it){ge===(ge=de(we))&&te?te.p(we,it):(te.d(1),te=ge(we),te&&(te.c(),te.m(y,null)))},d(we){we&&(Ae(y),Ae(k),Ae(F),Ae(D),Ae(T),Ae(a),Ae(q),Ae(Y),Ae(fe)),te.d()}}}function M0(S){let y;return{c(){y=Ie("span"),y.textContent=`${S[2].name}`,lt(y,"slot","title")},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function C0(S){let y,v,k,F;return y=new zo({props:{$$slots:{title:[M0],default:[P0]},$$scope:{ctx:S}}}),{c(){dr(y.$$.fragment),v=mt(),k=Ie("div"),lt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(D,T){or(y,D,T),Ee(D,v,T),Ee(D,k,T),S[3](k),F=!0},p(D,[T]){const a={};T&66&&(a.$$scope={dirty:T,ctx:D}),y.$set(a)},i(D){F||(Cn(y.$$.fragment,D),F=!0)},o(D){Ln(y.$$.fragment,D),F=!1},d(D){D&&(Ae(v),Ae(k)),sr(y,D),S[3](null)}}}function I0(S,y,v){let k;Eo(S,ko,Y=>v(5,k=Y));const F=Jr.find(Y=>Y.path===k);let D,T,a=0;Ko(()=>{const Y=new ln.Map({container:D,style:Yo,center:[-74.1197632,40.6974034],zoom:11,attributionControl:!1});Y.addControl(new ln.AttributionControl({customAttribution:"<a href='http://project-osrm.org/' target='_blank' rel='noreferrer'>&copy; OSRM</a>"})),Y.on("load",()=>{T=new b0(Y,w0),T.on("fetchroutesend",fe=>{var de;v(1,a=(de=fe.data)==null?void 0:de.routes[0].distance)}),T.on("removewaypoint",()=>{T.waypoints.length<2&&v(1,a=0)}),T.interactive=!0})});function q(Y){go[Y?"unshift":"push"](()=>{D=Y,v(0,D)})}return[D,a,F,q]}class A0 extends jr{constructor(y){super(),Or(this,y,I0,C0,xr,{})}}const E0=Object.freeze(Object.defineProperty({__proto__:null,default:A0},Symbol.toStringTag,{value:"Module"}));class k0 extends Ao{constructor(y,v){super(y,v)}get waypointsFeatures(){return this._waypoints}setWaypointsFeatures(y){this._waypoints=y,this.assignWaypointsCategories();const v=new Fu("setwaypoints",void 0);this.fire(v),this.draw()}get snappointsFeatures(){return this.snappoints}setSnappointsFeatures(y){this.snappoints=y,this.draw()}get routelinesFeatures(){return this.routelines}setRoutelinesFeatures(y){this.routelines=y,this.draw()}}function z0(S){let y,v,k,F,D,T,a,q,Y,fe,de,ge,te,we,it,Ke,vt,Rt,gt,nt,ht;return{c(){y=Ie("button"),v=_n("Load the saved Route"),F=mt(),D=Ie("button"),T=_n("Save the Route"),q=mt(),Y=Ie("button"),fe=_n("Clear"),ge=mt(),te=Ie("small"),te.innerHTML=`This example uses the <code>localStorage</code> to save routes, but you are obviously not restricted to it. There might
    instead be a file or a serverside-database or whatever else`,we=mt(),it=Ie("p"),it.textContent=`If you want to save/load the route, the obvious way to do so would be to save the list of waypoints whenever the
    route is updated and to make a new routing-request with the saved waypoints' coordinates whenever you need to load
    it.`,Ke=mt(),vt=Ie("p"),vt.textContent=`But what if the underlying roads networks changes for some reason? You'll get a different route for the same set of
    waypoints. Moreover, if there are some severe construction works going on, you run into a risk of not getting any
    routes whatsoever.`,Rt=mt(),gt=Ie("p"),gt.textContent=`Sometimes it's actually a good idea to save the route as a list of GeoJSON Features and be able to load these saved
    features whenever there's a need. This example shows how that could be done.`,y.disabled=k=!S[1]||S[2],D.disabled=a=!S[1],Y.disabled=de=!S[1]},m(Xe,ct){Ee(Xe,y,ct),Ye(y,v),Ee(Xe,F,ct),Ee(Xe,D,ct),Ye(D,T),Ee(Xe,q,ct),Ee(Xe,Y,ct),Ye(Y,fe),Ee(Xe,ge,ct),Ee(Xe,te,ct),Ee(Xe,we,ct),Ee(Xe,it,ct),Ee(Xe,Ke,ct),Ee(Xe,vt,ct),Ee(Xe,Rt,ct),Ee(Xe,gt,ct),nt||(ht=[Ri(y,"click",S[4]),Ri(D,"click",S[5]),Ri(Y,"click",S[6])],nt=!0)},p(Xe,ct){ct&6&&k!==(k=!Xe[1]||Xe[2])&&(y.disabled=k),ct&2&&a!==(a=!Xe[1])&&(D.disabled=a),ct&2&&de!==(de=!Xe[1])&&(Y.disabled=de)},d(Xe){Xe&&(Ae(y),Ae(F),Ae(D),Ae(q),Ae(Y),Ae(ge),Ae(te),Ae(we),Ae(it),Ae(Ke),Ae(vt),Ae(Rt),Ae(gt)),nt=!1,Os(ht)}}}function D0(S){let y;return{c(){y=Ie("span"),y.textContent=`${S[3].name}`,lt(y,"slot","title")},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function R0(S){let y,v,k,F;return y=new zo({props:{$$slots:{title:[D0],default:[z0]},$$scope:{ctx:S}}}),{c(){dr(y.$$.fragment),v=mt(),k=Ie("div"),lt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(D,T){or(y,D,T),Ee(D,v,T),Ee(D,k,T),S[7](k),F=!0},p(D,[T]){const a={};T&518&&(a.$$scope={dirty:T,ctx:D}),y.$set(a)},i(D){F||(Cn(y.$$.fragment,D),F=!0)},o(D){Ln(y.$$.fragment,D),F=!1},d(D){D&&(Ae(v),Ae(k)),sr(y,D),S[7](null)}}}function Bg(){return localStorage.getItem("saved-waypoints-features")&&localStorage.getItem("saved-snappoints-features")&&localStorage.getItem("saved-routelines-features")}function L0(S,y,v){let k;Eo(S,ko,ge=>v(8,k=ge));const F=Jr.find(ge=>ge.path===k);let D,T;Ko(()=>{const ge=new ln.Map({container:D,style:Yo,center:[-74.1197632,40.6974034],zoom:11,attributionControl:!1});ge.addControl(new ln.AttributionControl({customAttribution:"<a href='http://project-osrm.org/' target='_blank' rel='noreferrer'>&copy; OSRM</a>"})),ge.on("load",()=>{v(1,T=new k0(ge)),v(1,T.interactive=!0,T)})});let a=!Bg();function q(){T.setWaypointsFeatures(JSON.parse(localStorage.getItem("saved-waypoints-features")||"")),T.setSnappointsFeatures(JSON.parse(localStorage.getItem("saved-snappoints-features")||"")),T.setRoutelinesFeatures(JSON.parse(localStorage.getItem("saved-routelines-features")||""))}function Y(){localStorage.setItem("saved-waypoints-features",JSON.stringify(T.waypointsFeatures)),localStorage.setItem("saved-snappoints-features",JSON.stringify(T.snappointsFeatures)),localStorage.setItem("saved-routelines-features",JSON.stringify(T.routelinesFeatures)),v(2,a=!Bg())}const fe=()=>T.clear();function de(ge){go[ge?"unshift":"push"](()=>{D=ge,v(0,D)})}return[D,T,a,F,q,Y,fe,de]}class B0 extends jr{constructor(y){super(),Or(this,y,L0,R0,xr,{})}}const F0=Object.freeze(Object.defineProperty({__proto__:null,default:B0},Symbol.toStringTag,{value:"Module"}));var Lf={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Lf.exports;(function(S,y){(function(){var v,k="4.17.21",F=200,D="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",T="Expected a function",a="Invalid `variable` option passed into `_.template`",q="__lodash_hash_undefined__",Y=500,fe="__lodash_placeholder__",de=1,ge=2,te=4,we=1,it=2,Ke=1,vt=2,Rt=4,gt=8,nt=16,ht=32,Xe=64,ct=128,Tt=256,$t=512,Bi=30,Jt="...",Ot=800,Ft=16,Pt=1,Wt=2,jt=3,gi=1/0,Pi=9007199254740991,cn=17976931348623157e292,Yi=0/0,ni=4294967295,br=ni-1,wr=ni>>>1,pn=[["ary",ct],["bind",Ke],["bindKey",vt],["curry",gt],["curryRight",nt],["flip",$t],["partial",ht],["partialRight",Xe],["rearg",Tt]],Fi="[object Arguments]",Tr="[object Array]",fr="[object AsyncFunction]",mr="[object Boolean]",In="[object Date]",gr="[object DOMException]",Ji="[object Error]",Ni="[object Function]",Zn="[object GeneratorFunction]",mi="[object Map]",Sr="[object Number]",Yn="[object Null]",Qi="[object Object]",Nr="[object Promise]",ar="[object Proxy]",yn="[object RegExp]",An="[object Set]",vn="[object String]",lr="[object Symbol]",Jo="[object Undefined]",Bn="[object WeakMap]",$r="[object WeakSet]",Pr="[object ArrayBuffer]",en="[object DataView]",Mr="[object Float32Array]",Cr="[object Float64Array]",cr="[object Int8Array]",Qr="[object Int16Array]",Do="[object Int32Array]",En="[object Uint8Array]",Q="[object Uint8ClampedArray]",U="[object Uint16Array]",H="[object Uint32Array]",W=/\b__p \+= '';/g,ae=/\b(__p \+=) '' \+/g,_e=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Pe=/&(?:amp|lt|gt|quot|#39);/g,De=/[&<>"']/g,Te=RegExp(Pe.source),Ne=RegExp(De.source),Oe=/<%-([\s\S]+?)%>/g,Me=/<%([\s\S]+?)%>/g,be=/<%=([\s\S]+?)%>/g,pt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,dt=/^\w*$/,qe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,rt=/[\\^$.*+?()[\]{}|]/g,Ge=RegExp(rt.source),yt=/^\s+/,Mt=/\s/,Qt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ui=/\{\n\/\* \[wrapped with (.+)\] \*/,Lt=/,? & /,wt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,un=/[()=,{}\[\]\/\s]/,_s=/\\(\\)?/g,Fn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,xn=/\w*$/,Zi=/^[-+]0x[0-9a-f]+$/i,Vr=/^0b[01]+$/i,qi=/^\[object .+?Constructor\]$/,Ha=/^0o[0-7]+$/i,ga=/^(?:0|[1-9]\d*)$/,Gc=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ro=/($^)/,js=/['\n\r\u2028\u2029\\]/g,Wa="\\ud800-\\udfff",Zc="\\u0300-\\u036f",Nu="\\ufe20-\\ufe2f",_a="\\u20d0-\\u20ff",qc=Zc+Nu+_a,$u="\\u2700-\\u27bf",Vu="a-z\\xdf-\\xf6\\xf8-\\xff",Qh="\\xac\\xb1\\xd7\\xf7",Uu="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Hc="\\u2000-\\u206f",Ns=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ll="A-Z\\xc0-\\xd6\\xd8-\\xde",Wc="\\ufe0e\\ufe0f",ys=Qh+Uu+Hc+Ns,Xa="['’]",Bl="["+Wa+"]",Xc="["+ys+"]",Lo="["+qc+"]",Fl="\\d+",Bo="["+$u+"]",Xt="["+Vu+"]",_o="[^"+Wa+ys+Fl+$u+Vu+Ll+"]",Kt="\\ud83c[\\udffb-\\udfff]",Ol="(?:"+Lo+"|"+Kt+")",Kc="[^"+Wa+"]",$s="(?:\\ud83c[\\udde6-\\uddff]){2}",tn="[\\ud800-\\udbff][\\udc00-\\udfff]",nn="["+Ll+"]",Hi="\\u200d",jl="(?:"+Xt+"|"+_o+")",ur="(?:"+nn+"|"+_o+")",Jn="(?:"+Xa+"(?:d|ll|m|re|s|t|ve))?",Qn="(?:"+Xa+"(?:D|LL|M|RE|S|T|VE))?",Nl=Ol+"?",vs="["+Wc+"]?",$i="(?:"+Hi+"(?:"+[Kc,$s,tn].join("|")+")"+vs+Nl+")*",Ka="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Fo="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Oo=vs+Nl+$i,eo="(?:"+[Bo,$s,tn].join("|")+")"+Oo,Yc="(?:"+[Kc+Lo+"?",Lo,$s,tn,Bl].join("|")+")",Qo=RegExp(Xa,"g"),$l=RegExp(Lo,"g"),Li=RegExp(Kt+"(?="+Kt+")|"+Yc+Oo,"g"),ya=RegExp([nn+"?"+Xt+"+"+Jn+"(?="+[Xc,nn,"$"].join("|")+")",ur+"+"+Qn+"(?="+[Xc,nn+jl,"$"].join("|")+")",nn+"?"+jl+"+"+Jn,nn+"+"+Qn,Fo,Ka,Fl,eo].join("|"),"g"),li=RegExp("["+Hi+Wa+qc+Wc+"]"),Ht=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ya=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],hi=-1,Mi={};Mi[Mr]=Mi[Cr]=Mi[cr]=Mi[Qr]=Mi[Do]=Mi[En]=Mi[Q]=Mi[U]=Mi[H]=!0,Mi[Fi]=Mi[Tr]=Mi[Pr]=Mi[mr]=Mi[en]=Mi[In]=Mi[Ji]=Mi[Ni]=Mi[mi]=Mi[Sr]=Mi[Qi]=Mi[yn]=Mi[An]=Mi[vn]=Mi[Bn]=!1;var pi={};pi[Fi]=pi[Tr]=pi[Pr]=pi[en]=pi[mr]=pi[In]=pi[Mr]=pi[Cr]=pi[cr]=pi[Qr]=pi[Do]=pi[mi]=pi[Sr]=pi[Qi]=pi[yn]=pi[An]=pi[vn]=pi[lr]=pi[En]=pi[Q]=pi[U]=pi[H]=!0,pi[Ji]=pi[Ni]=pi[Bn]=!1;var Ja={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Qa={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},el={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Vs={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Gu=parseFloat,Jc=parseInt,Vl=typeof Xh=="object"&&Xh&&Xh.Object===Object&&Xh,Zu=typeof self=="object"&&self&&self.Object===Object&&self,bn=Vl||Zu||Function("return this")(),Ci=y&&!y.nodeType&&y,to=Ci&&!0&&S&&!S.nodeType&&S,io=to&&to.exports===Ci,es=io&&Vl.process,Ii=function(){try{var Ce=to&&to.require&&to.require("util").types;return Ce||es&&es.binding&&es.binding("util")}catch{}}(),Ul=Ii&&Ii.isArrayBuffer,ts=Ii&&Ii.isDate,Qc=Ii&&Ii.isMap,qu=Ii&&Ii.isRegExp,tl=Ii&&Ii.isSet,Gl=Ii&&Ii.isTypedArray;function Ur(Ce,Ze,$e){switch($e.length){case 0:return Ce.call(Ze);case 1:return Ce.call(Ze,$e[0]);case 2:return Ce.call(Ze,$e[0],$e[1]);case 3:return Ce.call(Ze,$e[0],$e[1],$e[2])}return Ce.apply(Ze,$e)}function Zl(Ce,Ze,$e,At){for(var Vt=-1,ci=Ce==null?0:Ce.length;++Vt<ci;){var dn=Ce[Vt];Ze(At,dn,$e(dn),Ce)}return At}function qn(Ce,Ze){for(var $e=-1,At=Ce==null?0:Ce.length;++$e<At&&Ze(Ce[$e],$e,Ce)!==!1;);return Ce}function Gr(Ce,Ze){for(var $e=Ce==null?0:Ce.length;$e--&&Ze(Ce[$e],$e,Ce)!==!1;);return Ce}function va(Ce,Ze){for(var $e=-1,At=Ce==null?0:Ce.length;++$e<At;)if(!Ze(Ce[$e],$e,Ce))return!1;return!0}function Zr(Ce,Ze){for(var $e=-1,At=Ce==null?0:Ce.length,Vt=0,ci=[];++$e<At;){var dn=Ce[$e];Ze(dn,$e,Ce)&&(ci[Vt++]=dn)}return ci}function xa(Ce,Ze){var $e=Ce==null?0:Ce.length;return!!$e&&Ta(Ce,Ze,0)>-1}function Ir(Ce,Ze,$e){for(var At=-1,Vt=Ce==null?0:Ce.length;++At<Vt;)if($e(Ze,Ce[At]))return!0;return!1}function rn(Ce,Ze){for(var $e=-1,At=Ce==null?0:Ce.length,Vt=Array(At);++$e<At;)Vt[$e]=Ze(Ce[$e],$e,Ce);return Vt}function jo(Ce,Ze){for(var $e=-1,At=Ze.length,Vt=Ce.length;++$e<At;)Ce[Vt+$e]=Ze[$e];return Ce}function Us(Ce,Ze,$e,At){var Vt=-1,ci=Ce==null?0:Ce.length;for(At&&ci&&($e=Ce[++Vt]);++Vt<ci;)$e=Ze($e,Ce[Vt],Vt,Ce);return $e}function il(Ce,Ze,$e,At){var Vt=Ce==null?0:Ce.length;for(At&&Vt&&($e=Ce[--Vt]);Vt--;)$e=Ze($e,Ce[Vt],Vt,Ce);return $e}function ba(Ce,Ze){for(var $e=-1,At=Ce==null?0:Ce.length;++$e<At;)if(Ze(Ce[$e],$e,Ce))return!0;return!1}var ql=Wl("length");function Hu(Ce){return Ce.split("")}function Gs(Ce){return Ce.match(wt)||[]}function Wu(Ce,Ze,$e){var At;return $e(Ce,function(Vt,ci,dn){if(Ze(Vt,ci,dn))return At=ci,!1}),At}function wa(Ce,Ze,$e,At){for(var Vt=Ce.length,ci=$e+(At?1:-1);At?ci--:++ci<Vt;)if(Ze(Ce[ci],ci,Ce))return ci;return-1}function Ta(Ce,Ze,$e){return Ze===Ze?ep(Ce,Ze,$e):wa(Ce,Hl,$e)}function Xu(Ce,Ze,$e,At){for(var Vt=$e-1,ci=Ce.length;++Vt<ci;)if(At(Ce[Vt],Ze))return Vt;return-1}function Hl(Ce){return Ce!==Ce}function eu(Ce,Ze){var $e=Ce==null?0:Ce.length;return $e?Kl(Ce,Ze)/$e:Yi}function Wl(Ce){return function(Ze){return Ze==null?v:Ze[Ce]}}function nl(Ce){return function(Ze){return Ce==null?v:Ce[Ze]}}function Xl(Ce,Ze,$e,At,Vt){return Vt(Ce,function(ci,dn,Ai){$e=At?(At=!1,ci):Ze($e,ci,dn,Ai)}),$e}function xs(Ce,Ze){var $e=Ce.length;for(Ce.sort(Ze);$e--;)Ce[$e]=Ce[$e].value;return Ce}function Kl(Ce,Ze){for(var $e,At=-1,Vt=Ce.length;++At<Vt;){var ci=Ze(Ce[At]);ci!==v&&($e=$e===v?ci:$e+ci)}return $e}function Yl(Ce,Ze){for(var $e=-1,At=Array(Ce);++$e<Ce;)At[$e]=Ze($e);return At}function rl(Ce,Ze){return rn(Ze,function($e){return[$e,Ce[$e]]})}function Jl(Ce){return Ce&&Ce.slice(0,Yu(Ce)+1).replace(yt,"")}function hr(Ce){return function(Ze){return Ce(Ze)}}function tu(Ce,Ze){return rn(Ze,function($e){return Ce[$e]})}function ol(Ce,Ze){return Ce.has(Ze)}function Ql(Ce,Ze){for(var $e=-1,At=Ce.length;++$e<At&&Ta(Ze,Ce[$e],0)>-1;);return $e}function ec(Ce,Ze){for(var $e=Ce.length;$e--&&Ta(Ze,Ce[$e],0)>-1;);return $e}function Ku(Ce,Ze){for(var $e=Ce.length,At=0;$e--;)Ce[$e]===Ze&&++At;return At}var iu=nl(Ja),nu=nl(Qa);function sl(Ce){return"\\"+Vs[Ce]}function is(Ce,Ze){return Ce==null?v:Ce[Ze]}function bs(Ce){return li.test(Ce)}function ru(Ce){return Ht.test(Ce)}function tc(Ce){for(var Ze,$e=[];!(Ze=Ce.next()).done;)$e.push(Ze.value);return $e}function ic(Ce){var Ze=-1,$e=Array(Ce.size);return Ce.forEach(function(At,Vt){$e[++Ze]=[Vt,At]}),$e}function nc(Ce,Ze){return function($e){return Ce(Ze($e))}}function Ar(Ce,Ze){for(var $e=-1,At=Ce.length,Vt=0,ci=[];++$e<At;){var dn=Ce[$e];(dn===Ze||dn===fe)&&(Ce[$e]=fe,ci[Vt++]=$e)}return ci}function Sa(Ce){var Ze=-1,$e=Array(Ce.size);return Ce.forEach(function(At){$e[++Ze]=At}),$e}function vi(Ce){var Ze=-1,$e=Array(Ce.size);return Ce.forEach(function(At){$e[++Ze]=[At,At]}),$e}function ep(Ce,Ze,$e){for(var At=$e-1,Vt=Ce.length;++At<Vt;)if(Ce[At]===Ze)return At;return-1}function tp(Ce,Ze,$e){for(var At=$e+1;At--;)if(Ce[At]===Ze)return At;return At}function Pa(Ce){return bs(Ce)?rc(Ce):ql(Ce)}function no(Ce){return bs(Ce)?oc(Ce):Hu(Ce)}function Yu(Ce){for(var Ze=Ce.length;Ze--&&Mt.test(Ce.charAt(Ze)););return Ze}var Ju=nl(el);function rc(Ce){for(var Ze=Li.lastIndex=0;Li.test(Ce);)++Ze;return Ze}function oc(Ce){return Ce.match(Li)||[]}function sc(Ce){return Ce.match(ya)||[]}var ou=function Ce(Ze){Ze=Ze==null?bn:ro.defaults(bn.Object(),Ze,ro.pick(bn,Ya));var $e=Ze.Array,At=Ze.Date,Vt=Ze.Error,ci=Ze.Function,dn=Ze.Math,Ai=Ze.Object,Zs=Ze.RegExp,ac=Ze.String,qr=Ze.TypeError,ns=$e.prototype,Ma=ci.prototype,qs=Ai.prototype,Ca=Ze["__core-js_shared__"],ai=Ma.toString,xi=qs.hasOwnProperty,ip=0,su=function(){var l=/[^.]+$/.exec(Ca&&Ca.keys&&Ca.keys.IE_PROTO||"");return l?"Symbol(src)_1."+l:""}(),ws=qs.toString,au=ai.call(Ai),np=bn._,Qu=Zs("^"+ai.call(xi).replace(rt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),lc=io?Ze.Buffer:v,yo=Ze.Symbol,Hs=Ze.Uint8Array,al=lc?lc.allocUnsafe:v,rs=nc(Ai.getPrototypeOf,Ai),ll=Ai.create,lu=qs.propertyIsEnumerable,Ws=ns.splice,cl=yo?yo.isConcatSpreadable:v,Xs=yo?yo.iterator:v,Ks=yo?yo.toStringTag:v,Ys=function(){try{var l=Sl(Ai,"defineProperty");return l({},"",{}),l}catch{}}(),eh=Ze.clearTimeout!==bn.clearTimeout&&Ze.clearTimeout,th=At&&At.now!==bn.Date.now&&At.now,cc=Ze.setTimeout!==bn.setTimeout&&Ze.setTimeout,Js=dn.ceil,Ia=dn.floor,ul=Ai.getOwnPropertySymbols,hl=lc?lc.isBuffer:v,Aa=Ze.isFinite,cu=ns.join,uc=nc(Ai.keys,Ai),Yt=dn.max,fn=dn.min,oo=At.now,uu=Ze.parseInt,hc=dn.random,ih=ns.reverse,Ts=Sl(Ze,"DataView"),No=Sl(Ze,"Map"),Ea=Sl(Ze,"Promise"),$o=Sl(Ze,"Set"),ka=Sl(Ze,"WeakMap"),Qs=Sl(Ai,"create"),za=ka&&new ka,ea={},Ss=Il(Ts),hu=Il(No),Da=Il(Ea),nh=Il($o),rh=Il(ka),pl=yo?yo.prototype:v,Ra=pl?pl.valueOf:v,pu=pl?pl.toString:v;function X(l){if(Ki(l)&&!ei(l)&&!(l instanceof ti)){if(l instanceof _i)return l;if(xi.call(l,"__wrapped__"))return vp(l)}return new _i(l)}var vo=function(){function l(){}return function(h){if(!Mn(h))return{};if(ll)return ll(h);l.prototype=h;var x=new l;return l.prototype=v,x}}();function Hn(){}function _i(l,h){this.__wrapped__=l,this.__actions__=[],this.__chain__=!!h,this.__index__=0,this.__values__=v}X.templateSettings={escape:Oe,evaluate:Me,interpolate:be,variable:"",imports:{_:X}},X.prototype=Hn.prototype,X.prototype.constructor=X,_i.prototype=vo(Hn.prototype),_i.prototype.constructor=_i;function ti(l){this.__wrapped__=l,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ni,this.__views__=[]}function xo(){var l=new ti(this.__wrapped__);return l.__actions__=Sn(this.__actions__),l.__dir__=this.__dir__,l.__filtered__=this.__filtered__,l.__iteratees__=Sn(this.__iteratees__),l.__takeCount__=this.__takeCount__,l.__views__=Sn(this.__views__),l}function La(){if(this.__filtered__){var l=new ti(this);l.__dir__=-1,l.__filtered__=!0}else l=this.clone(),l.__dir__*=-1;return l}function rp(){var l=this.__wrapped__.value(),h=this.__dir__,x=ei(l),A=h<0,$=x?l.length:0,ee=qf(0,$,this.__views__),pe=ee.start,Se=ee.end,ke=Se-pe,ot=A?Se:pe-1,st=this.__iteratees__,ut=st.length,Ct=0,Bt=fn(ke,this.__takeCount__);if(!x||!A&&$==ke&&Bt==ke)return kr(l,this.__actions__);var Gt=[];e:for(;ke--&&Ct<Bt;){ot+=h;for(var fi=-1,Zt=l[ot];++fi<ut;){var yi=st[fi],Si=yi.iteratee,ms=yi.type,Io=Si(Zt);if(ms==Wt)Zt=Io;else if(!Io){if(ms==Pt)continue e;break e}}Gt[Ct++]=Zt}return Gt}ti.prototype=vo(Hn.prototype),ti.prototype.constructor=ti;function bo(l){var h=-1,x=l==null?0:l.length;for(this.clear();++h<x;){var A=l[h];this.set(A[0],A[1])}}function oh(){this.__data__=Qs?Qs(null):{},this.size=0}function du(l){var h=this.has(l)&&delete this.__data__[l];return this.size-=h?1:0,h}function sh(l){var h=this.__data__;if(Qs){var x=h[l];return x===q?v:x}return xi.call(h,l)?h[l]:v}function ta(l){var h=this.__data__;return Qs?h[l]!==v:xi.call(h,l)}function os(l,h){var x=this.__data__;return this.size+=this.has(l)?0:1,x[l]=Qs&&h===v?q:h,this}bo.prototype.clear=oh,bo.prototype.delete=du,bo.prototype.get=sh,bo.prototype.has=ta,bo.prototype.set=os;function xt(l){var h=-1,x=l==null?0:l.length;for(this.clear();++h<x;){var A=l[h];this.set(A[0],A[1])}}function ah(){this.__data__=[],this.size=0}function ia(l){var h=this.__data__,x=ra(h,l);if(x<0)return!1;var A=h.length-1;return x==A?h.pop():Ws.call(h,x,1),--this.size,!0}function lh(l){var h=this.__data__,x=ra(h,l);return x<0?v:h[x][1]}function dl(l){return ra(this.__data__,l)>-1}function Ps(l,h){var x=this.__data__,A=ra(x,l);return A<0?(++this.size,x.push([l,h])):x[A][1]=h,this}xt.prototype.clear=ah,xt.prototype.delete=ia,xt.prototype.get=lh,xt.prototype.has=dl,xt.prototype.set=Ps;function Vo(l){var h=-1,x=l==null?0:l.length;for(this.clear();++h<x;){var A=l[h];this.set(A[0],A[1])}}function ri(){this.size=0,this.__data__={hash:new bo,map:new(No||xt),string:new bo}}function Ba(l){var h=zs(this,l).delete(l);return this.size-=h?1:0,h}function ch(l){return zs(this,l).get(l)}function pc(l){return zs(this,l).has(l)}function uh(l,h){var x=zs(this,l),A=x.size;return x.set(l,h),this.size+=x.size==A?0:1,this}Vo.prototype.clear=ri,Vo.prototype.delete=Ba,Vo.prototype.get=ch,Vo.prototype.has=pc,Vo.prototype.set=uh;function Ms(l){var h=-1,x=l==null?0:l.length;for(this.__data__=new Vo;++h<x;)this.add(l[h])}function dc(l){return this.__data__.set(l,q),this}function fc(l){return this.__data__.has(l)}Ms.prototype.add=Ms.prototype.push=dc,Ms.prototype.has=fc;function so(l){var h=this.__data__=new xt(l);this.size=h.size}function hh(){this.__data__=new xt,this.size=0}function ph(l){var h=this.__data__,x=h.delete(l);return this.size=h.size,x}function dh(l){return this.__data__.get(l)}function fh(l){return this.__data__.has(l)}function ss(l,h){var x=this.__data__;if(x instanceof xt){var A=x.__data__;if(!No||A.length<F-1)return A.push([l,h]),this.size=++x.size,this;x=this.__data__=new Vo(A)}return x.set(l,h),this.size=x.size,this}so.prototype.clear=hh,so.prototype.delete=ph,so.prototype.get=dh,so.prototype.has=fh,so.prototype.set=ss;function Vi(l,h){var x=ei(l),A=!x&&ho(l),$=!x&&!A&&Za(l),ee=!x&&!A&&!$&&Ls(l),pe=x||A||$||ee,Se=pe?Yl(l.length,ac):[],ke=Se.length;for(var ot in l)(h||xi.call(l,ot))&&!(pe&&(ot=="length"||$&&(ot=="offset"||ot=="parent")||ee&&(ot=="buffer"||ot=="byteLength"||ot=="byteOffset")||uo(ot,ke)))&&Se.push(ot);return Se}function fl(l){var h=l.length;return h?l[Ve(0,h-1)]:v}function mc(l,h){return Ch(Sn(l),Go(h,0,l.length))}function fu(l){return Ch(Sn(l))}function ml(l,h,x){(x!==v&&!Wo(l[h],x)||x===v&&!(h in l))&&kt(l,h,x)}function na(l,h,x){var A=l[h];(!(xi.call(l,h)&&Wo(A,x))||x===v&&!(h in l))&&kt(l,h,x)}function ra(l,h){for(var x=l.length;x--;)if(Wo(l[x][0],h))return x;return-1}function Uo(l,h,x,A){return ao(l,function($,ee,pe){h(A,$,x($),pe)}),A}function oa(l,h){return l&&Po(h,Be(h),l)}function Et(l,h){return l&&Po(h,Qe(h),l)}function kt(l,h,x){h=="__proto__"&&Ys?Ys(l,h,{configurable:!0,enumerable:!0,value:x,writable:!0}):l[h]=x}function sa(l,h){for(var x=-1,A=h.length,$=$e(A),ee=l==null;++x<A;)$[x]=ee?v:O(l,h[x]);return $}function Go(l,h,x){return l===l&&(x!==v&&(l=l<=x?l:x),h!==v&&(l=l>=h?l:h)),l}function _r(l,h,x,A,$,ee){var pe,Se=h&de,ke=h&ge,ot=h&te;if(x&&(pe=$?x(l,A,$,ee):x(l)),pe!==v)return pe;if(!Mn(l))return l;var st=ei(l);if(st){if(pe=Wf(l),!Se)return Sn(l,pe)}else{var ut=Dr(l),Ct=ut==Ni||ut==Zn;if(Za(l))return ki(l,Se);if(ut==Qi||ut==Fi||Ct&&!$){if(pe=ke||Ct?{}:mp(l),!Se)return ke?vu(l,Et(pe,l)):xc(l,oa(pe,l))}else{if(!pi[ut])return $?l:{};pe=Tu(l,ut,Se)}}ee||(ee=new so);var Bt=ee.get(l);if(Bt)return Bt;ee.set(l,pe),$h(l)?l.forEach(function(Zt){pe.add(_r(Zt,h,x,Zt,l,ee))}):tr(l)&&l.forEach(function(Zt,yi){pe.set(yi,_r(Zt,h,x,yi,l,ee))});var Gt=ot?ke?pp:hp:ke?Qe:Be,fi=st?v:Gt(l);return qn(fi||l,function(Zt,yi){fi&&(yi=Zt,Zt=l[yi]),na(pe,yi,_r(Zt,h,x,yi,l,ee))}),pe}function Er(l){var h=Be(l);return function(x){return mu(x,l,h)}}function mu(l,h,x){var A=x.length;if(l==null)return!A;for(l=Ai(l);A--;){var $=x[A],ee=h[$],pe=l[$];if(pe===v&&!($ in l)||!ee(pe))return!1}return!0}function wo(l,h,x){if(typeof l!="function")throw new qr(T);return Cl(function(){l.apply(v,x)},h)}function gl(l,h,x,A){var $=-1,ee=xa,pe=!0,Se=l.length,ke=[],ot=h.length;if(!Se)return ke;x&&(h=rn(h,hr(x))),A?(ee=Ir,pe=!1):h.length>=F&&(ee=ol,pe=!1,h=new Ms(h));e:for(;++$<Se;){var st=l[$],ut=x==null?st:x(st);if(st=A||st!==0?st:0,pe&&ut===ut){for(var Ct=ot;Ct--;)if(h[Ct]===ut)continue e;ke.push(st)}else ee(h,ut,A)||ke.push(st)}return ke}var ao=bc(yr),Di=bc(aa,!0);function wn(l,h){var x=!0;return ao(l,function(A,$,ee){return x=!!h(A,$,ee),x}),x}function _l(l,h,x){for(var A=-1,$=l.length;++A<$;){var ee=l[A],pe=h(ee);if(pe!=null&&(Se===v?pe===pe&&!po(pe):x(pe,Se)))var Se=pe,ke=ee}return ke}function yl(l,h,x,A){var $=l.length;for(x=ii(x),x<0&&(x=-x>$?0:$+x),A=A===v||A>$?$:ii(A),A<0&&(A+=$),A=x>A?0:gf(A);x<A;)l[x++]=h;return l}function Fa(l,h){var x=[];return ao(l,function(A,$,ee){h(A,$,ee)&&x.push(A)}),x}function On(l,h,x,A,$){var ee=-1,pe=l.length;for(x||(x=Pn),$||($=[]);++ee<pe;){var Se=l[ee];h>0&&x(Se)?h>1?On(Se,h-1,x,A,$):jo($,Se):A||($[$.length]=Se)}return $}var vl=gh(),Zo=gh(!0);function yr(l,h){return l&&vl(l,h,Be)}function aa(l,h){return l&&Zo(l,h,Be)}function la(l,h){return Zr(h,function(x){return Xo(l[x])})}function To(l,h){h=Tn(h,l);for(var x=0,A=h.length;l!=null&&x<A;)l=l[Ds(h[x++])];return x&&x==A?l:v}function gc(l,h,x){var A=h(l);return ei(l)?A:jo(A,x(l))}function kn(l){return l==null?l===v?Jo:Yn:Ks&&Ks in Ai(l)?Zf(l):Kf(l)}function as(l,h){return l>h}function gu(l,h){return l!=null&&xi.call(l,h)}function _c(l,h){return l!=null&&h in Ai(l)}function Cs(l,h,x){return l>=fn(h,x)&&l<Yt(h,x)}function xl(l,h,x){for(var A=x?Ir:xa,$=l[0].length,ee=l.length,pe=ee,Se=$e(ee),ke=1/0,ot=[];pe--;){var st=l[pe];pe&&h&&(st=rn(st,hr(h))),ke=fn(st.length,ke),Se[pe]=!x&&(h||$>=120&&st.length>=120)?new Ms(pe&&st):v}st=l[0];var ut=-1,Ct=Se[0];e:for(;++ut<$&&ot.length<ke;){var Bt=st[ut],Gt=h?h(Bt):Bt;if(Bt=x||Bt!==0?Bt:0,!(Ct?ol(Ct,Gt):A(ot,Gt,x))){for(pe=ee;--pe;){var fi=Se[pe];if(!(fi?ol(fi,Gt):A(l[pe],Gt,x)))continue e}Ct&&Ct.push(Gt),ot.push(Bt)}}return ot}function _u(l,h,x,A){return yr(l,function($,ee,pe){h(A,x($),ee,pe)}),A}function ls(l,h,x){h=Tn(h,l),l=$a(l,h);var A=l==null?l:l[Ds(Ho(h))];return A==null?v:Ur(A,l,x)}function yc(l){return Ki(l)&&kn(l)==Fi}function p(l){return Ki(l)&&kn(l)==Pr}function e(l){return Ki(l)&&kn(l)==In}function i(l,h,x,A,$){return l===h?!0:l==null||h==null||!Ki(l)&&!Ki(h)?l!==l&&h!==h:s(l,h,x,A,i,$)}function s(l,h,x,A,$,ee){var pe=ei(l),Se=ei(h),ke=pe?Tr:Dr(l),ot=Se?Tr:Dr(h);ke=ke==Fi?Qi:ke,ot=ot==Fi?Qi:ot;var st=ke==Qi,ut=ot==Qi,Ct=ke==ot;if(Ct&&Za(l)){if(!Za(h))return!1;pe=!0,st=!1}if(Ct&&!st)return ee||(ee=new so),pe||Ls(l)?xh(l,h,x,A,$,ee):Gf(l,h,ke,x,A,$,ee);if(!(x&we)){var Bt=st&&xi.call(l,"__wrapped__"),Gt=ut&&xi.call(h,"__wrapped__");if(Bt||Gt){var fi=Bt?l.value():l,Zt=Gt?h.value():h;return ee||(ee=new so),$(fi,Zt,x,A,ee)}}return Ct?(ee||(ee=new so),pd(l,h,x,A,$,ee)):!1}function c(l){return Ki(l)&&Dr(l)==mi}function d(l,h,x,A){var $=x.length,ee=$,pe=!A;if(l==null)return!ee;for(l=Ai(l);$--;){var Se=x[$];if(pe&&Se[2]?Se[1]!==l[Se[0]]:!(Se[0]in l))return!1}for(;++$<ee;){Se=x[$];var ke=Se[0],ot=l[ke],st=Se[1];if(pe&&Se[2]){if(ot===v&&!(ke in l))return!1}else{var ut=new so;if(A)var Ct=A(ot,st,ke,l,h,ut);if(!(Ct===v?i(st,ot,we|it,A,ut):Ct))return!1}}return!0}function g(l){if(!Mn(l)||fd(l))return!1;var h=Xo(l)?Qu:qi;return h.test(Il(l))}function b(l){return Ki(l)&&kn(l)==yn}function P(l){return Ki(l)&&Dr(l)==An}function C(l){return Ki(l)&&Nh(l.length)&&!!Mi[kn(l)]}function z(l){return typeof l=="function"?l:l==null?an:typeof l=="object"?ei(l)?ie(l[0],l[1]):ne(l):rg(l)}function R(l){if(!ha(l))return uc(l);var h=[];for(var x in Ai(l))xi.call(l,x)&&x!="constructor"&&h.push(x);return h}function B(l){if(!Mn(l))return Su(l);var h=ha(l),x=[];for(var A in l)A=="constructor"&&(h||!xi.call(l,A))||x.push(A);return x}function V(l,h){return l<h}function Z(l,h){var x=-1,A=Kr(l)?$e(l.length):[];return ao(l,function($,ee,pe){A[++x]=h($,ee,pe)}),A}function ne(l){var h=Tl(l);return h.length==1&&h[0][2]?Ml(h[0][0],h[0][1]):function(x){return x===l||d(x,l,h)}}function ie(l,h){return Cc(l)&&Th(h)?Ml(Ds(l),h):function(x){var A=O(x,l);return A===v&&A===h?ce(x,l):i(h,A,we|it)}}function re(l,h,x,A,$){l!==h&&vl(h,function(ee,pe){if($||($=new so),Mn(ee))se(l,h,pe,x,re,A,$);else{var Se=A?A(Ph(l,pe),ee,pe+"",l,h,$):v;Se===v&&(Se=ee),ml(l,pe,Se)}},Qe)}function se(l,h,x,A,$,ee,pe){var Se=Ph(l,x),ke=Ph(h,x),ot=pe.get(ke);if(ot){ml(l,x,ot);return}var st=ee?ee(Se,ke,x+"",l,h,pe):v,ut=st===v;if(ut){var Ct=ei(ke),Bt=!Ct&&Za(ke),Gt=!Ct&&!Bt&&Ls(ke);st=ke,Ct||Bt||Gt?ei(Se)?st=Se:zn(Se)?st=Sn(Se):Bt?(ut=!1,st=ki(ke,!0)):Gt?(ut=!1,st=yu(ke,!0)):st=[]:Lc(ke)||ho(ke)?(st=Se,ho(Se)?st=t(Se):(!Mn(Se)||Xo(Se))&&(st=mp(ke))):ut=!1}ut&&(pe.set(ke,st),$(st,ke,A,ee,pe),pe.delete(ke)),ml(l,x,st)}function ue(l,h){var x=l.length;if(x)return h+=h<0?x:0,uo(h,x)?l[h]:v}function he(l,h,x){h.length?h=rn(h,function(ee){return ei(ee)?function(pe){return To(pe,ee.length===1?ee[0]:ee)}:ee}):h=[an];var A=-1;h=rn(h,hr(Nt()));var $=Z(l,function(ee,pe,Se){var ke=rn(h,function(ot){return ot(ee)});return{criteria:ke,index:++A,value:ee}});return xs($,function(ee,pe){return mh(ee,pe,x)})}function me(l,h){return ve(l,h,function(x,A){return ce(l,A)})}function ve(l,h,x){for(var A=-1,$=h.length,ee={};++A<$;){var pe=h[A],Se=To(l,pe);x(Se,pe)&&_t(ee,Tn(pe,l),Se)}return ee}function ye(l){return function(h){return To(h,l)}}function ze(l,h,x,A){var $=A?Xu:Ta,ee=-1,pe=h.length,Se=l;for(l===h&&(h=Sn(h)),x&&(Se=rn(l,hr(x)));++ee<pe;)for(var ke=0,ot=h[ee],st=x?x(ot):ot;(ke=$(Se,st,ke,A))>-1;)Se!==l&&Ws.call(Se,ke,1),Ws.call(l,ke,1);return l}function Le(l,h){for(var x=l?h.length:0,A=x-1;x--;){var $=h[x];if(x==A||$!==ee){var ee=$;uo($)?Ws.call(l,$,1):er(l,$)}}return l}function Ve(l,h){return l+Ia(hc()*(h-l+1))}function He(l,h,x,A){for(var $=-1,ee=Yt(Js((h-l)/(x||1)),0),pe=$e(ee);ee--;)pe[A?ee:++$]=l,l+=x;return pe}function je(l,h){var x="";if(!l||h<1||h>Pi)return x;do h%2&&(x+=l),h=Ia(h/2),h&&(l+=l);while(h);return x}function We(l,h){return Mh(gp(l,h,an),l+"")}function ft(l){return fl(mn(l))}function et(l,h){var x=mn(l);return Ch(x,Go(h,0,x.length))}function _t(l,h,x,A){if(!Mn(l))return l;h=Tn(h,l);for(var $=-1,ee=h.length,pe=ee-1,Se=l;Se!=null&&++$<ee;){var ke=Ds(h[$]),ot=x;if(ke==="__proto__"||ke==="constructor"||ke==="prototype")return l;if($!=pe){var st=Se[ke];ot=A?A(st,ke,Se):v,ot===v&&(ot=Mn(st)?st:uo(h[$+1])?[]:{})}na(Se,ke,ot),Se=Se[ke]}return l}var Ut=za?function(l,h){return za.set(l,h),l}:an,di=Ys?function(l,h){return Ys(l,"toString",{configurable:!0,enumerable:!1,value:ed(h),writable:!0})}:an;function Wi(l){return Ch(mn(l))}function oi(l,h,x){var A=-1,$=l.length;h<0&&(h=-h>$?0:$+h),x=x>$?$:x,x<0&&(x+=$),$=h>x?0:x-h>>>0,h>>>=0;for(var ee=$e($);++A<$;)ee[A]=l[A+h];return ee}function Xi(l,h){var x;return ao(l,function(A,$,ee){return x=h(A,$,ee),!x}),!!x}function bi(l,h,x){var A=0,$=l==null?A:l.length;if(typeof h=="number"&&h===h&&$<=wr){for(;A<$;){var ee=A+$>>>1,pe=l[ee];pe!==null&&!po(pe)&&(x?pe<=h:pe<h)?A=ee+1:$=ee}return $}return wi(l,h,an,x)}function wi(l,h,x,A){var $=0,ee=l==null?0:l.length;if(ee===0)return 0;h=x(h);for(var pe=h!==h,Se=h===null,ke=po(h),ot=h===v;$<ee;){var st=Ia(($+ee)/2),ut=x(l[st]),Ct=ut!==v,Bt=ut===null,Gt=ut===ut,fi=po(ut);if(pe)var Zt=A||Gt;else ot?Zt=Gt&&(A||Ct):Se?Zt=Gt&&Ct&&(A||!Bt):ke?Zt=Gt&&Ct&&!Bt&&(A||!fi):Bt||fi?Zt=!1:Zt=A?ut<=h:ut<h;Zt?$=st+1:ee=st}return fn(ee,br)}function Ei(l,h){for(var x=-1,A=l.length,$=0,ee=[];++x<A;){var pe=l[x],Se=h?h(pe):pe;if(!x||!Wo(Se,ke)){var ke=Se;ee[$++]=pe===0?0:pe}}return ee}function Wn(l){return typeof l=="number"?l:po(l)?Yi:+l}function Ti(l){if(typeof l=="string")return l;if(ei(l))return rn(l,Ti)+"";if(po(l))return pu?pu.call(l):"";var h=l+"";return h=="0"&&1/l==-gi?"-0":h}function Oi(l,h,x){var A=-1,$=xa,ee=l.length,pe=!0,Se=[],ke=Se;if(x)pe=!1,$=Ir;else if(ee>=F){var ot=h?null:cp(l);if(ot)return Sa(ot);pe=!1,$=ol,ke=new Ms}else ke=h?[]:Se;e:for(;++A<ee;){var st=l[A],ut=h?h(st):st;if(st=x||st!==0?st:0,pe&&ut===ut){for(var Ct=ke.length;Ct--;)if(ke[Ct]===ut)continue e;h&&ke.push(ut),Se.push(st)}else $(ke,ut,x)||(ke!==Se&&ke.push(ut),Se.push(st))}return Se}function er(l,h){return h=Tn(h,l),l=$a(l,h),l==null||delete l[Ds(Ho(h))]}function qo(l,h,x,A){return _t(l,h,x(To(l,h)),A)}function Hr(l,h,x,A){for(var $=l.length,ee=A?$:-1;(A?ee--:++ee<$)&&h(l[ee],ee,l););return x?oi(l,A?0:ee,A?ee+1:$):oi(l,A?ee+1:0,A?$:ee)}function kr(l,h){var x=l;return x instanceof ti&&(x=x.value()),Us(h,function(A,$){return $.func.apply($.thisArg,jo([A],$.args))},x)}function So(l,h,x){var A=l.length;if(A<2)return A?Oi(l[0]):[];for(var $=-1,ee=$e(A);++$<A;)for(var pe=l[$],Se=-1;++Se<A;)Se!=$&&(ee[$]=gl(ee[$]||pe,l[Se],h,x));return Oi(On(ee,1),h,x)}function Oa(l,h,x){for(var A=-1,$=l.length,ee=h.length,pe={};++A<$;){var Se=A<ee?h[A]:v;x(pe,l[A],Se)}return pe}function ca(l){return zn(l)?l:[]}function Is(l){return typeof l=="function"?l:an}function Tn(l,h){return ei(l)?l:Cc(l,h)?[l]:_d(o(l))}var lo=We;function jn(l,h,x){var A=l.length;return x=x===v?A:x,!h&&x>=A?l:oi(l,h,x)}var zr=eh||function(l){return bn.clearTimeout(l)};function ki(l,h){if(h)return l.slice();var x=l.length,A=al?al(x):new l.constructor(x);return l.copy(A),A}function ji(l){var h=new l.constructor(l.byteLength);return new Hs(h).set(new Hs(l)),h}function Wr(l,h){var x=h?ji(l.buffer):l.buffer;return new l.constructor(x,l.byteOffset,l.byteLength)}function on(l){var h=new l.constructor(l.source,xn.exec(l));return h.lastIndex=l.lastIndex,h}function op(l){return Ra?Ai(Ra.call(l)):{}}function yu(l,h){var x=h?ji(l.buffer):l.buffer;return new l.constructor(x,l.byteOffset,l.length)}function vc(l,h){if(l!==h){var x=l!==v,A=l===null,$=l===l,ee=po(l),pe=h!==v,Se=h===null,ke=h===h,ot=po(h);if(!Se&&!ot&&!ee&&l>h||ee&&pe&&ke&&!Se&&!ot||A&&pe&&ke||!x&&ke||!$)return 1;if(!A&&!ee&&!ot&&l<h||ot&&x&&$&&!A&&!ee||Se&&x&&$||!pe&&$||!ke)return-1}return 0}function mh(l,h,x){for(var A=-1,$=l.criteria,ee=h.criteria,pe=$.length,Se=x.length;++A<pe;){var ke=vc($[A],ee[A]);if(ke){if(A>=Se)return ke;var ot=x[A];return ke*(ot=="desc"?-1:1)}}return l.index-h.index}function As(l,h,x,A){for(var $=-1,ee=l.length,pe=x.length,Se=-1,ke=h.length,ot=Yt(ee-pe,0),st=$e(ke+ot),ut=!A;++Se<ke;)st[Se]=h[Se];for(;++$<pe;)(ut||$<ee)&&(st[x[$]]=l[$]);for(;ot--;)st[Se++]=l[$++];return st}function Es(l,h,x,A){for(var $=-1,ee=l.length,pe=-1,Se=x.length,ke=-1,ot=h.length,st=Yt(ee-Se,0),ut=$e(st+ot),Ct=!A;++$<st;)ut[$]=l[$];for(var Bt=$;++ke<ot;)ut[Bt+ke]=h[ke];for(;++pe<Se;)(Ct||$<ee)&&(ut[Bt+x[pe]]=l[$++]);return ut}function Sn(l,h){var x=-1,A=l.length;for(h||(h=$e(A));++x<A;)h[x]=l[x];return h}function Po(l,h,x,A){var $=!x;x||(x={});for(var ee=-1,pe=h.length;++ee<pe;){var Se=h[ee],ke=A?A(x[Se],l[Se],Se,x,l):v;ke===v&&(ke=l[Se]),$?kt(x,Se,ke):na(x,Se,ke)}return x}function xc(l,h){return Po(l,fp(l),h)}function vu(l,h){return Po(l,dd(l),h)}function ja(l,h){return function(x,A){var $=ei(x)?Zl:Uo,ee=h?h():{};return $(x,l,Nt(A,2),ee)}}function ks(l){return We(function(h,x){var A=-1,$=x.length,ee=$>1?x[$-1]:v,pe=$>2?x[2]:v;for(ee=l.length>3&&typeof ee=="function"?($--,ee):v,pe&&Rr(x[0],x[1],pe)&&(ee=$<3?v:ee,$=1),h=Ai(h);++A<$;){var Se=x[A];Se&&l(h,Se,A,ee)}return h})}function bc(l,h){return function(x,A){if(x==null)return x;if(!Kr(x))return l(x,A);for(var $=x.length,ee=h?$:-1,pe=Ai(x);(h?ee--:++ee<$)&&A(pe[ee],ee,pe)!==!1;);return x}}function gh(l){return function(h,x,A){for(var $=-1,ee=Ai(h),pe=A(h),Se=pe.length;Se--;){var ke=pe[l?Se:++$];if(x(ee[ke],ke,ee)===!1)break}return h}}function Vf(l,h,x){var A=h&Ke,$=wc(l);function ee(){var pe=this&&this!==bn&&this instanceof ee?$:l;return pe.apply(A?x:this,arguments)}return ee}function _h(l){return function(h){h=o(h);var x=bs(h)?no(h):v,A=x?x[0]:h.charAt(0),$=x?jn(x,1).join(""):h.slice(1);return A[l]()+$}}function bl(l){return function(h){return Us(Tf(Gn(h).replace(Qo,"")),l,"")}}function wc(l){return function(){var h=arguments;switch(h.length){case 0:return new l;case 1:return new l(h[0]);case 2:return new l(h[0],h[1]);case 3:return new l(h[0],h[1],h[2]);case 4:return new l(h[0],h[1],h[2],h[3]);case 5:return new l(h[0],h[1],h[2],h[3],h[4]);case 6:return new l(h[0],h[1],h[2],h[3],h[4],h[5]);case 7:return new l(h[0],h[1],h[2],h[3],h[4],h[5],h[6])}var x=vo(l.prototype),A=l.apply(x,h);return Mn(A)?A:x}}function Tc(l,h,x){var A=wc(l);function $(){for(var ee=arguments.length,pe=$e(ee),Se=ee,ke=Na($);Se--;)pe[Se]=arguments[Se];var ot=ee<3&&pe[0]!==ke&&pe[ee-1]!==ke?[]:Ar(pe,ke);if(ee-=ot.length,ee<x)return ap(l,h,wl,$.placeholder,v,pe,ot,v,v,x-ee);var st=this&&this!==bn&&this instanceof $?A:l;return Ur(st,this,pe)}return $}function ud(l){return function(h,x,A){var $=Ai(h);if(!Kr(h)){var ee=Nt(x,3);h=Be(h),x=function(Se){return ee($[Se],Se,$)}}var pe=l(h,x,A);return pe>-1?$[ee?h[pe]:pe]:v}}function Sc(l){return ua(function(h){var x=h.length,A=x,$=_i.prototype.thru;for(l&&h.reverse();A--;){var ee=h[A];if(typeof ee!="function")throw new qr(T);if($&&!pe&&Mc(ee)=="wrapper")var pe=new _i([],!0)}for(A=pe?A:x;++A<x;){ee=h[A];var Se=Mc(ee),ke=Se=="wrapper"?dp(ee):v;ke&&Pl(ke[0])&&ke[1]==(ct|gt|ht|Tt)&&!ke[4].length&&ke[9]==1?pe=pe[Mc(ke[0])].apply(pe,ke[3]):pe=ee.length==1&&Pl(ee)?pe[Se]():pe.thru(ee)}return function(){var ot=arguments,st=ot[0];if(pe&&ot.length==1&&ei(st))return pe.plant(st).value();for(var ut=0,Ct=x?h[ut].apply(this,ot):st;++ut<x;)Ct=h[ut].call(this,Ct);return Ct}})}function wl(l,h,x,A,$,ee,pe,Se,ke,ot){var st=h&ct,ut=h&Ke,Ct=h&vt,Bt=h&(gt|nt),Gt=h&$t,fi=Ct?v:wc(l);function Zt(){for(var yi=arguments.length,Si=$e(yi),ms=yi;ms--;)Si[ms]=arguments[ms];if(Bt)var Io=Na(Zt),gs=Ku(Si,Io);if(A&&(Si=As(Si,A,$,Bt)),ee&&(Si=Es(Si,ee,pe,Bt)),yi-=gs,Bt&&yi<ot){var rr=Ar(Si,Io);return ap(l,h,wl,Zt.placeholder,x,Si,rr,Se,ke,ot-yi)}var fa=ut?x:this,Dl=Ct?fa[l]:l;return yi=Si.length,Se?Si=Yf(Si,Se):Gt&&yi>1&&Si.reverse(),st&&ke<yi&&(Si.length=ke),this&&this!==bn&&this instanceof Zt&&(Dl=fi||wc(Dl)),Dl.apply(fa,Si)}return Zt}function xu(l,h){return function(x,A){return _u(x,l,h(A),{})}}function bu(l,h){return function(x,A){var $;if(x===v&&A===v)return h;if(x!==v&&($=x),A!==v){if($===v)return A;typeof x=="string"||typeof A=="string"?(x=Ti(x),A=Ti(A)):(x=Wn(x),A=Wn(A)),$=l(x,A)}return $}}function yh(l){return ua(function(h){return h=rn(h,hr(Nt())),We(function(x){var A=this;return l(h,function($){return Ur($,A,x)})})})}function vh(l,h){h=h===v?" ":Ti(h);var x=h.length;if(x<2)return x?je(h,l):h;var A=je(h,Js(l/Pa(h)));return bs(h)?jn(no(A),0,l).join(""):A.slice(0,l)}function Uf(l,h,x,A){var $=h&Ke,ee=wc(l);function pe(){for(var Se=-1,ke=arguments.length,ot=-1,st=A.length,ut=$e(st+ke),Ct=this&&this!==bn&&this instanceof pe?ee:l;++ot<st;)ut[ot]=A[ot];for(;ke--;)ut[ot++]=arguments[++Se];return Ur(Ct,$?x:this,ut)}return pe}function sp(l){return function(h,x,A){return A&&typeof A!="number"&&Rr(h,x,A)&&(x=A=v),h=us(h),x===v?(x=h,h=0):x=us(x),A=A===v?h<x?1:-1:us(A),He(h,x,A,l)}}function wu(l){return function(h,x){return typeof h=="string"&&typeof x=="string"||(h=n(h),x=n(x)),l(h,x)}}function ap(l,h,x,A,$,ee,pe,Se,ke,ot){var st=h&gt,ut=st?pe:v,Ct=st?v:pe,Bt=st?ee:v,Gt=st?v:ee;h|=st?ht:Xe,h&=~(st?Xe:ht),h&Rt||(h&=~(Ke|vt));var fi=[l,h,$,Bt,ut,Gt,Ct,Se,ke,ot],Zt=x.apply(v,fi);return Pl(l)&&Ac(Zt,fi),Zt.placeholder=A,_p(Zt,l,h)}function lp(l){var h=dn[l];return function(x,A){if(x=n(x),A=A==null?0:fn(ii(A),292),A&&Aa(x)){var $=(o(x)+"e").split("e"),ee=h($[0]+"e"+(+$[1]+A));return $=(o(ee)+"e").split("e"),+($[0]+"e"+(+$[1]-A))}return h(x)}}var cp=$o&&1/Sa(new $o([,-0]))[1]==gi?function(l){return new $o(l)}:Vm;function up(l){return function(h){var x=Dr(h);return x==mi?ic(h):x==An?vi(h):rl(h,l(h))}}function cs(l,h,x,A,$,ee,pe,Se){var ke=h&vt;if(!ke&&typeof l!="function")throw new qr(T);var ot=A?A.length:0;if(ot||(h&=~(ht|Xe),A=$=v),pe=pe===v?pe:Yt(ii(pe),0),Se=Se===v?Se:ii(Se),ot-=$?$.length:0,h&Xe){var st=A,ut=$;A=$=v}var Ct=ke?v:dp(l),Bt=[l,h,x,A,$,st,ut,ee,pe,Se];if(Ct&&Ic(Bt,Ct),l=Bt[0],h=Bt[1],x=Bt[2],A=Bt[3],$=Bt[4],Se=Bt[9]=Bt[9]===v?ke?0:l.length:Yt(Bt[9]-ot,0),!Se&&h&(gt|nt)&&(h&=~(gt|nt)),!h||h==Ke)var Gt=Vf(l,h,x);else h==gt||h==nt?Gt=Tc(l,h,Se):(h==ht||h==(Ke|ht))&&!$.length?Gt=Uf(l,h,x,A):Gt=wl.apply(v,Bt);var fi=Ct?Ut:Ac;return _p(fi(Gt,Bt),l,h)}function Pc(l,h,x,A){return l===v||Wo(l,qs[x])&&!xi.call(A,x)?h:l}function co(l,h,x,A,$,ee){return Mn(l)&&Mn(h)&&(ee.set(h,l),re(l,h,v,co,ee),ee.delete(h)),l}function hd(l){return Lc(l)?v:l}function xh(l,h,x,A,$,ee){var pe=x&we,Se=l.length,ke=h.length;if(Se!=ke&&!(pe&&ke>Se))return!1;var ot=ee.get(l),st=ee.get(h);if(ot&&st)return ot==h&&st==l;var ut=-1,Ct=!0,Bt=x&it?new Ms:v;for(ee.set(l,h),ee.set(h,l);++ut<Se;){var Gt=l[ut],fi=h[ut];if(A)var Zt=pe?A(fi,Gt,ut,h,l,ee):A(Gt,fi,ut,l,h,ee);if(Zt!==v){if(Zt)continue;Ct=!1;break}if(Bt){if(!ba(h,function(yi,Si){if(!ol(Bt,Si)&&(Gt===yi||$(Gt,yi,x,A,ee)))return Bt.push(Si)})){Ct=!1;break}}else if(!(Gt===fi||$(Gt,fi,x,A,ee))){Ct=!1;break}}return ee.delete(l),ee.delete(h),Ct}function Gf(l,h,x,A,$,ee,pe){switch(x){case en:if(l.byteLength!=h.byteLength||l.byteOffset!=h.byteOffset)return!1;l=l.buffer,h=h.buffer;case Pr:return!(l.byteLength!=h.byteLength||!ee(new Hs(l),new Hs(h)));case mr:case In:case Sr:return Wo(+l,+h);case Ji:return l.name==h.name&&l.message==h.message;case yn:case vn:return l==h+"";case mi:var Se=ic;case An:var ke=A&we;if(Se||(Se=Sa),l.size!=h.size&&!ke)return!1;var ot=pe.get(l);if(ot)return ot==h;A|=it,pe.set(l,h);var st=xh(Se(l),Se(h),A,$,ee,pe);return pe.delete(l),st;case lr:if(Ra)return Ra.call(l)==Ra.call(h)}return!1}function pd(l,h,x,A,$,ee){var pe=x&we,Se=hp(l),ke=Se.length,ot=hp(h),st=ot.length;if(ke!=st&&!pe)return!1;for(var ut=ke;ut--;){var Ct=Se[ut];if(!(pe?Ct in h:xi.call(h,Ct)))return!1}var Bt=ee.get(l),Gt=ee.get(h);if(Bt&&Gt)return Bt==h&&Gt==l;var fi=!0;ee.set(l,h),ee.set(h,l);for(var Zt=pe;++ut<ke;){Ct=Se[ut];var yi=l[Ct],Si=h[Ct];if(A)var ms=pe?A(Si,yi,Ct,h,l,ee):A(yi,Si,Ct,l,h,ee);if(!(ms===v?yi===Si||$(yi,Si,x,A,ee):ms)){fi=!1;break}Zt||(Zt=Ct=="constructor")}if(fi&&!Zt){var Io=l.constructor,gs=h.constructor;Io!=gs&&"constructor"in l&&"constructor"in h&&!(typeof Io=="function"&&Io instanceof Io&&typeof gs=="function"&&gs instanceof gs)&&(fi=!1)}return ee.delete(l),ee.delete(h),fi}function ua(l){return Mh(gp(l,v,Eh),l+"")}function hp(l){return gc(l,Be,fp)}function pp(l){return gc(l,Qe,dd)}var dp=za?function(l){return za.get(l)}:Vm;function Mc(l){for(var h=l.name+"",x=ea[h],A=xi.call(ea,h)?x.length:0;A--;){var $=x[A],ee=$.func;if(ee==null||ee==l)return $.name}return h}function Na(l){var h=xi.call(X,"placeholder")?X:l;return h.placeholder}function Nt(){var l=X.iteratee||da;return l=l===da?z:l,arguments.length?l(arguments[0],arguments[1]):l}function zs(l,h){var x=l.__data__;return wh(h)?x[typeof h=="string"?"string":"hash"]:x.map}function Tl(l){for(var h=Be(l),x=h.length;x--;){var A=h[x],$=l[A];h[x]=[A,$,Th($)]}return h}function Sl(l,h){var x=is(l,h);return g(x)?x:v}function Zf(l){var h=xi.call(l,Ks),x=l[Ks];try{l[Ks]=v;var A=!0}catch{}var $=ws.call(l);return A&&(h?l[Ks]=x:delete l[Ks]),$}var fp=ul?function(l){return l==null?[]:(l=Ai(l),Zr(ul(l),function(h){return lu.call(l,h)}))}:Um,dd=ul?function(l){for(var h=[];l;)jo(h,fp(l)),l=rs(l);return h}:Um,Dr=kn;(Ts&&Dr(new Ts(new ArrayBuffer(1)))!=en||No&&Dr(new No)!=mi||Ea&&Dr(Ea.resolve())!=Nr||$o&&Dr(new $o)!=An||ka&&Dr(new ka)!=Bn)&&(Dr=function(l){var h=kn(l),x=h==Qi?l.constructor:v,A=x?Il(x):"";if(A)switch(A){case Ss:return en;case hu:return mi;case Da:return Nr;case nh:return An;case rh:return Bn}return h});function qf(l,h,x){for(var A=-1,$=x.length;++A<$;){var ee=x[A],pe=ee.size;switch(ee.type){case"drop":l+=pe;break;case"dropRight":h-=pe;break;case"take":h=fn(h,l+pe);break;case"takeRight":l=Yt(l,h-pe);break}}return{start:l,end:h}}function Hf(l){var h=l.match(ui);return h?h[1].split(Lt):[]}function bh(l,h,x){h=Tn(h,l);for(var A=-1,$=h.length,ee=!1;++A<$;){var pe=Ds(h[A]);if(!(ee=l!=null&&x(l,pe)))break;l=l[pe]}return ee||++A!=$?ee:($=l==null?0:l.length,!!$&&Nh($)&&uo(pe,$)&&(ei(l)||ho(l)))}function Wf(l){var h=l.length,x=new l.constructor(h);return h&&typeof l[0]=="string"&&xi.call(l,"index")&&(x.index=l.index,x.input=l.input),x}function mp(l){return typeof l.constructor=="function"&&!ha(l)?vo(rs(l)):{}}function Tu(l,h,x){var A=l.constructor;switch(h){case Pr:return ji(l);case mr:case In:return new A(+l);case en:return Wr(l,x);case Mr:case Cr:case cr:case Qr:case Do:case En:case Q:case U:case H:return yu(l,x);case mi:return new A;case Sr:case vn:return new A(l);case yn:return on(l);case An:return new A;case lr:return op(l)}}function Xf(l,h){var x=h.length;if(!x)return l;var A=x-1;return h[A]=(x>1?"& ":"")+h[A],h=h.join(x>2?", ":" "),l.replace(Qt,`{
/* [wrapped with `+h+`] */
`)}function Pn(l){return ei(l)||ho(l)||!!(cl&&l&&l[cl])}function uo(l,h){var x=typeof l;return h=h??Pi,!!h&&(x=="number"||x!="symbol"&&ga.test(l))&&l>-1&&l%1==0&&l<h}function Rr(l,h,x){if(!Mn(x))return!1;var A=typeof h;return(A=="number"?Kr(x)&&uo(h,x.length):A=="string"&&h in x)?Wo(x[h],l):!1}function Cc(l,h){if(ei(l))return!1;var x=typeof l;return x=="number"||x=="symbol"||x=="boolean"||l==null||po(l)?!0:dt.test(l)||!pt.test(l)||h!=null&&l in Ai(h)}function wh(l){var h=typeof l;return h=="string"||h=="number"||h=="symbol"||h=="boolean"?l!=="__proto__":l===null}function Pl(l){var h=Mc(l),x=X[h];if(typeof x!="function"||!(h in ti.prototype))return!1;if(l===x)return!0;var A=dp(x);return!!A&&l===A[0]}function fd(l){return!!su&&su in l}var md=Ca?Xo:Gm;function ha(l){var h=l&&l.constructor,x=typeof h=="function"&&h.prototype||qs;return l===x}function Th(l){return l===l&&!Mn(l)}function Ml(l,h){return function(x){return x==null?!1:x[l]===h&&(h!==v||l in Ai(x))}}function Sh(l){var h=ku(l,function(A){return x.size===Y&&x.clear(),A}),x=h.cache;return h}function Ic(l,h){var x=l[1],A=h[1],$=x|A,ee=$<(Ke|vt|ct),pe=A==ct&&x==gt||A==ct&&x==Tt&&l[7].length<=h[8]||A==(ct|Tt)&&h[7].length<=h[8]&&x==gt;if(!(ee||pe))return l;A&Ke&&(l[2]=h[2],$|=x&Ke?0:Rt);var Se=h[3];if(Se){var ke=l[3];l[3]=ke?As(ke,Se,h[4]):Se,l[4]=ke?Ar(l[3],fe):h[4]}return Se=h[5],Se&&(ke=l[5],l[5]=ke?Es(ke,Se,h[6]):Se,l[6]=ke?Ar(l[5],fe):h[6]),Se=h[7],Se&&(l[7]=Se),A&ct&&(l[8]=l[8]==null?h[8]:fn(l[8],h[8])),l[9]==null&&(l[9]=h[9]),l[0]=h[0],l[1]=$,l}function Su(l){var h=[];if(l!=null)for(var x in Ai(l))h.push(x);return h}function Kf(l){return ws.call(l)}function gp(l,h,x){return h=Yt(h===v?l.length-1:h,0),function(){for(var A=arguments,$=-1,ee=Yt(A.length-h,0),pe=$e(ee);++$<ee;)pe[$]=A[h+$];$=-1;for(var Se=$e(h+1);++$<h;)Se[$]=A[$];return Se[h]=x(pe),Ur(l,this,Se)}}function $a(l,h){return h.length<2?l:To(l,oi(h,0,-1))}function Yf(l,h){for(var x=l.length,A=fn(h.length,x),$=Sn(l);A--;){var ee=h[A];l[A]=uo(ee,x)?$[ee]:v}return l}function Ph(l,h){if(!(h==="constructor"&&typeof l[h]=="function")&&h!="__proto__")return l[h]}var Ac=gd(Ut),Cl=cc||function(l,h){return bn.setTimeout(l,h)},Mh=gd(di);function _p(l,h,x){var A=h+"";return Mh(l,Xf(A,yp(Hf(A),x)))}function gd(l){var h=0,x=0;return function(){var A=oo(),$=Ft-(A-x);if(x=A,$>0){if(++h>=Ot)return arguments[0]}else h=0;return l.apply(v,arguments)}}function Ch(l,h){var x=-1,A=l.length,$=A-1;for(h=h===v?A:h;++x<h;){var ee=Ve(x,$),pe=l[ee];l[ee]=l[x],l[x]=pe}return l.length=h,l}var _d=Sh(function(l){var h=[];return l.charCodeAt(0)===46&&h.push(""),l.replace(qe,function(x,A,$,ee){h.push($?ee.replace(_s,"$1"):A||x)}),h});function Ds(l){if(typeof l=="string"||po(l))return l;var h=l+"";return h=="0"&&1/l==-gi?"-0":h}function Il(l){if(l!=null){try{return ai.call(l)}catch{}try{return l+""}catch{}}return""}function yp(l,h){return qn(pn,function(x){var A="_."+x[0];h&x[1]&&!xa(l,A)&&l.push(A)}),l.sort()}function vp(l){if(l instanceof ti)return l.clone();var h=new _i(l.__wrapped__,l.__chain__);return h.__actions__=Sn(l.__actions__),h.__index__=l.__index__,h.__values__=l.__values__,h}function xp(l,h,x){(x?Rr(l,h,x):h===v)?h=1:h=Yt(ii(h),0);var A=l==null?0:l.length;if(!A||h<1)return[];for(var $=0,ee=0,pe=$e(Js(A/h));$<A;)pe[ee++]=oi(l,$,$+=h);return pe}function yd(l){for(var h=-1,x=l==null?0:l.length,A=0,$=[];++h<x;){var ee=l[h];ee&&($[A++]=ee)}return $}function bp(){var l=arguments.length;if(!l)return[];for(var h=$e(l-1),x=arguments[0],A=l;A--;)h[A-1]=arguments[A];return jo(ei(x)?Sn(x):[x],On(h,1))}var vd=We(function(l,h){return zn(l)?gl(l,On(h,1,zn,!0)):[]}),xd=We(function(l,h){var x=Ho(h);return zn(x)&&(x=v),zn(l)?gl(l,On(h,1,zn,!0),Nt(x,2)):[]}),Ih=We(function(l,h){var x=Ho(h);return zn(x)&&(x=v),zn(l)?gl(l,On(h,1,zn,!0),v,x):[]});function bd(l,h,x){var A=l==null?0:l.length;return A?(h=x||h===v?1:ii(h),oi(l,h<0?0:h,A)):[]}function wd(l,h,x){var A=l==null?0:l.length;return A?(h=x||h===v?1:ii(h),h=A-h,oi(l,0,h<0?0:h)):[]}function Td(l,h){return l&&l.length?Hr(l,Nt(h,3),!0,!0):[]}function Pu(l,h){return l&&l.length?Hr(l,Nt(h,3),!0):[]}function Jf(l,h,x,A){var $=l==null?0:l.length;return $?(x&&typeof x!="number"&&Rr(l,h,x)&&(x=0,A=$),yl(l,h,x,A)):[]}function Ah(l,h,x){var A=l==null?0:l.length;if(!A)return-1;var $=x==null?0:ii(x);return $<0&&($=Yt(A+$,0)),wa(l,Nt(h,3),$)}function Ec(l,h,x){var A=l==null?0:l.length;if(!A)return-1;var $=A-1;return x!==v&&($=ii(x),$=x<0?Yt(A+$,0):fn($,A-1)),wa(l,Nt(h,3),$,!0)}function Eh(l){var h=l==null?0:l.length;return h?On(l,1):[]}function Qf(l){var h=l==null?0:l.length;return h?On(l,gi):[]}function em(l,h){var x=l==null?0:l.length;return x?(h=h===v?1:ii(h),On(l,h)):[]}function Sd(l){for(var h=-1,x=l==null?0:l.length,A={};++h<x;){var $=l[h];A[$[0]]=$[1]}return A}function wp(l){return l&&l.length?l[0]:v}function tm(l,h,x){var A=l==null?0:l.length;if(!A)return-1;var $=x==null?0:ii(x);return $<0&&($=Yt(A+$,0)),Ta(l,h,$)}function im(l){var h=l==null?0:l.length;return h?oi(l,0,-1):[]}var Mu=We(function(l){var h=rn(l,ca);return h.length&&h[0]===l[0]?xl(h):[]}),Pd=We(function(l){var h=Ho(l),x=rn(l,ca);return h===Ho(x)?h=v:x.pop(),x.length&&x[0]===l[0]?xl(x,Nt(h,2)):[]}),nm=We(function(l){var h=Ho(l),x=rn(l,ca);return h=typeof h=="function"?h:v,h&&x.pop(),x.length&&x[0]===l[0]?xl(x,v,h):[]});function rm(l,h){return l==null?"":cu.call(l,h)}function Ho(l){var h=l==null?0:l.length;return h?l[h-1]:v}function om(l,h,x){var A=l==null?0:l.length;if(!A)return-1;var $=A;return x!==v&&($=ii(x),$=$<0?Yt(A+$,0):fn($,A-1)),h===h?tp(l,h,$):wa(l,Hl,$,!0)}function sm(l,h){return l&&l.length?ue(l,ii(h)):v}var am=We(Tp);function Tp(l,h){return l&&l.length&&h&&h.length?ze(l,h):l}function Sp(l,h,x){return l&&l.length&&h&&h.length?ze(l,h,Nt(x,2)):l}function Md(l,h,x){return l&&l.length&&h&&h.length?ze(l,h,v,x):l}var Cd=ua(function(l,h){var x=l==null?0:l.length,A=sa(l,h);return Le(l,rn(h,function($){return uo($,x)?+$:$}).sort(vc)),A});function Id(l,h){var x=[];if(!(l&&l.length))return x;var A=-1,$=[],ee=l.length;for(h=Nt(h,3);++A<ee;){var pe=l[A];h(pe,A,l)&&(x.push(pe),$.push(A))}return Le(l,$),x}function Pp(l){return l==null?l:ih.call(l)}function kh(l,h,x){var A=l==null?0:l.length;return A?(x&&typeof x!="number"&&Rr(l,h,x)?(h=0,x=A):(h=h==null?0:ii(h),x=x===v?A:ii(x)),oi(l,h,x)):[]}function lm(l,h){return bi(l,h)}function Ad(l,h,x){return wi(l,h,Nt(x,2))}function cm(l,h){var x=l==null?0:l.length;if(x){var A=bi(l,h);if(A<x&&Wo(l[A],h))return A}return-1}function um(l,h){return bi(l,h,!0)}function hm(l,h,x){return wi(l,h,Nt(x,2),!0)}function Ed(l,h){var x=l==null?0:l.length;if(x){var A=bi(l,h,!0)-1;if(Wo(l[A],h))return A}return-1}function pm(l){return l&&l.length?Ei(l):[]}function dm(l,h){return l&&l.length?Ei(l,Nt(h,2)):[]}function Cu(l){var h=l==null?0:l.length;return h?oi(l,1,h):[]}function kd(l,h,x){return l&&l.length?(h=x||h===v?1:ii(h),oi(l,0,h<0?0:h)):[]}function Mp(l,h,x){var A=l==null?0:l.length;return A?(h=x||h===v?1:ii(h),h=A-h,oi(l,h<0?0:h,A)):[]}function zd(l,h){return l&&l.length?Hr(l,Nt(h,3),!1,!0):[]}function Nn(l,h){return l&&l.length?Hr(l,Nt(h,3)):[]}var Cp=We(function(l){return Oi(On(l,1,zn,!0))}),fm=We(function(l){var h=Ho(l);return zn(h)&&(h=v),Oi(On(l,1,zn,!0),Nt(h,2))}),Dd=We(function(l){var h=Ho(l);return h=typeof h=="function"?h:v,Oi(On(l,1,zn,!0),v,h)});function Ip(l){return l&&l.length?Oi(l):[]}function Ap(l,h){return l&&l.length?Oi(l,Nt(h,2)):[]}function mm(l,h){return h=typeof h=="function"?h:v,l&&l.length?Oi(l,v,h):[]}function Ep(l){if(!(l&&l.length))return[];var h=0;return l=Zr(l,function(x){if(zn(x))return h=Yt(x.length,h),!0}),Yl(h,function(x){return rn(l,Wl(x))})}function Rd(l,h){if(!(l&&l.length))return[];var x=Ep(l);return h==null?x:rn(x,function(A){return Ur(h,v,A)})}var gm=We(function(l,h){return zn(l)?gl(l,h):[]}),Ld=We(function(l){return So(Zr(l,zn))}),Xr=We(function(l){var h=Ho(l);return zn(h)&&(h=v),So(Zr(l,zn),Nt(h,2))}),kp=We(function(l){var h=Ho(l);return h=typeof h=="function"?h:v,So(Zr(l,zn),v,h)}),Bd=We(Ep);function Va(l,h){return Oa(l||[],h||[],na)}function zh(l,h){return Oa(l||[],h||[],_t)}var Iu=We(function(l){var h=l.length,x=h>1?l[h-1]:v;return x=typeof x=="function"?(l.pop(),x):v,Rd(l,x)});function Al(l){var h=X(l);return h.__chain__=!0,h}function Dh(l,h){return h(l),l}function El(l,h){return h(l)}var _m=ua(function(l){var h=l.length,x=h?l[0]:0,A=this.__wrapped__,$=function(ee){return sa(ee,l)};return h>1||this.__actions__.length||!(A instanceof ti)||!uo(x)?this.thru($):(A=A.slice(x,+x+(h?1:0)),A.__actions__.push({func:El,args:[$],thisArg:v}),new _i(A,this.__chain__).thru(function(ee){return h&&!ee.length&&ee.push(v),ee}))});function ym(){return Al(this)}function Fd(){return new _i(this.value(),this.__chain__)}function Od(){this.__values__===v&&(this.__values__=Uh(this.value()));var l=this.__index__>=this.__values__.length,h=l?v:this.__values__[this.__index__++];return{done:l,value:h}}function vm(){return this}function jd(l){for(var h,x=this;x instanceof Hn;){var A=vp(x);A.__index__=0,A.__values__=v,h?$.__wrapped__=A:h=A;var $=A;x=x.__wrapped__}return $.__wrapped__=l,h}function Nd(){var l=this.__wrapped__;if(l instanceof ti){var h=l;return this.__actions__.length&&(h=new ti(this)),h=h.reverse(),h.__actions__.push({func:El,args:[Pp],thisArg:v}),new _i(h,this.__chain__)}return this.thru(Pp)}function zp(){return kr(this.__wrapped__,this.__actions__)}var Dp=ja(function(l,h,x){xi.call(l,x)?++l[x]:kt(l,x,1)});function xm(l,h,x){var A=ei(l)?va:wn;return x&&Rr(l,h,x)&&(h=v),A(l,Nt(h,3))}function $d(l,h){var x=ei(l)?Zr:Fa;return x(l,Nt(h,3))}var bm=ud(Ah),wm=ud(Ec);function Tm(l,h){return On(kc(l,h),1)}function Sm(l,h){return On(kc(l,h),gi)}function Pm(l,h,x){return x=x===v?1:ii(x),On(kc(l,h),x)}function Rp(l,h){var x=ei(l)?qn:ao;return x(l,Nt(h,3))}function Lp(l,h){var x=ei(l)?Gr:Di;return x(l,Nt(h,3))}var Au=ja(function(l,h,x){xi.call(l,x)?l[x].push(h):kt(l,x,[h])});function Rs(l,h,x,A){l=Kr(l)?l:mn(l),x=x&&!A?ii(x):0;var $=l.length;return x<0&&(x=Yt($+x,0)),Bc(l)?x<=$&&l.indexOf(h,x)>-1:!!$&&Ta(l,h,x)>-1}var Ua=We(function(l,h,x){var A=-1,$=typeof h=="function",ee=Kr(l)?$e(l.length):[];return ao(l,function(pe){ee[++A]=$?Ur(h,pe,x):ls(pe,h,x)}),ee}),Vd=ja(function(l,h,x){kt(l,x,h)});function kc(l,h){var x=ei(l)?rn:Z;return x(l,Nt(h,3))}function Mm(l,h,x,A){return l==null?[]:(ei(h)||(h=h==null?[]:[h]),x=A?v:x,ei(x)||(x=x==null?[]:[x]),he(l,h,x))}var Cm=ja(function(l,h,x){l[x?0:1].push(h)},function(){return[[],[]]});function Rh(l,h,x){var A=ei(l)?Us:Xl,$=arguments.length<3;return A(l,Nt(h,4),x,$,ao)}function Bp(l,h,x){var A=ei(l)?il:Xl,$=arguments.length<3;return A(l,Nt(h,4),x,$,Di)}function Im(l,h){var x=ei(l)?Zr:Fa;return x(l,zu(Nt(h,3)))}function Fp(l){var h=ei(l)?fl:ft;return h(l)}function Op(l,h,x){(x?Rr(l,h,x):h===v)?h=1:h=ii(h);var A=ei(l)?mc:et;return A(l,h)}function zc(l){var h=ei(l)?fu:Wi;return h(l)}function Ud(l){if(l==null)return 0;if(Kr(l))return Bc(l)?Pa(l):l.length;var h=Dr(l);return h==mi||h==An?l.size:R(l).length}function Gd(l,h,x){var A=ei(l)?ba:Xi;return x&&Rr(l,h,x)&&(h=v),A(l,Nt(h,3))}var jp=We(function(l,h){if(l==null)return[];var x=h.length;return x>1&&Rr(l,h[0],h[1])?h=[]:x>2&&Rr(h[0],h[1],h[2])&&(h=[h[0]]),he(l,On(h,1),[])}),Eu=th||function(){return bn.Date.now()};function Lh(l,h){if(typeof h!="function")throw new qr(T);return l=ii(l),function(){if(--l<1)return h.apply(this,arguments)}}function Np(l,h,x){return h=x?v:h,h=l&&h==null?l.length:h,cs(l,ct,v,v,v,v,h)}function Zd(l,h){var x;if(typeof h!="function")throw new qr(T);return l=ii(l),function(){return--l>0&&(x=h.apply(this,arguments)),l<=1&&(h=v),x}}var $p=We(function(l,h,x){var A=Ke;if(x.length){var $=Ar(x,Na($p));A|=ht}return cs(l,A,h,x,$)}),Vp=We(function(l,h,x){var A=Ke|vt;if(x.length){var $=Ar(x,Na(Vp));A|=ht}return cs(h,A,l,x,$)});function qd(l,h,x){h=x?v:h;var A=cs(l,gt,v,v,v,v,v,h);return A.placeholder=qd.placeholder,A}function Hd(l,h,x){h=x?v:h;var A=cs(l,nt,v,v,v,v,v,h);return A.placeholder=Hd.placeholder,A}function Wd(l,h,x){var A,$,ee,pe,Se,ke,ot=0,st=!1,ut=!1,Ct=!0;if(typeof l!="function")throw new qr(T);h=n(h)||0,Mn(x)&&(st=!!x.leading,ut="maxWait"in x,ee=ut?Yt(n(x.maxWait)||0,h):ee,Ct="trailing"in x?!!x.trailing:Ct);function Bt(rr){var fa=A,Dl=$;return A=$=v,ot=rr,pe=l.apply(Dl,fa),pe}function Gt(rr){return ot=rr,Se=Cl(yi,h),st?Bt(rr):pe}function fi(rr){var fa=rr-ke,Dl=rr-ot,og=h-fa;return ut?fn(og,ee-Dl):og}function Zt(rr){var fa=rr-ke,Dl=rr-ot;return ke===v||fa>=h||fa<0||ut&&Dl>=ee}function yi(){var rr=Eu();if(Zt(rr))return Si(rr);Se=Cl(yi,fi(rr))}function Si(rr){return Se=v,Ct&&A?Bt(rr):(A=$=v,pe)}function ms(){Se!==v&&zr(Se),ot=0,A=ke=$=Se=v}function Io(){return Se===v?pe:Si(Eu())}function gs(){var rr=Eu(),fa=Zt(rr);if(A=arguments,$=this,ke=rr,fa){if(Se===v)return Gt(ke);if(ut)return zr(Se),Se=Cl(yi,h),Bt(ke)}return Se===v&&(Se=Cl(yi,h)),pe}return gs.cancel=ms,gs.flush=Io,gs}var Am=We(function(l,h){return wo(l,1,h)}),Up=We(function(l,h,x){return wo(l,n(h)||0,x)});function Ga(l){return cs(l,$t)}function ku(l,h){if(typeof l!="function"||h!=null&&typeof h!="function")throw new qr(T);var x=function(){var A=arguments,$=h?h.apply(this,A):A[0],ee=x.cache;if(ee.has($))return ee.get($);var pe=l.apply(this,A);return x.cache=ee.set($,pe)||ee,pe};return x.cache=new(ku.Cache||Vo),x}ku.Cache=Vo;function zu(l){if(typeof l!="function")throw new qr(T);return function(){var h=arguments;switch(h.length){case 0:return!l.call(this);case 1:return!l.call(this,h[0]);case 2:return!l.call(this,h[0],h[1]);case 3:return!l.call(this,h[0],h[1],h[2])}return!l.apply(this,h)}}function Xd(l){return Zd(2,l)}var Kd=lo(function(l,h){h=h.length==1&&ei(h[0])?rn(h[0],hr(Nt())):rn(On(h,1),hr(Nt()));var x=h.length;return We(function(A){for(var $=-1,ee=fn(A.length,x);++$<ee;)A[$]=h[$].call(this,A[$]);return Ur(l,this,A)})}),Bh=We(function(l,h){var x=Ar(h,Na(Bh));return cs(l,ht,v,h,x)}),Fh=We(function(l,h){var x=Ar(h,Na(Fh));return cs(l,Xe,v,h,x)}),Yd=ua(function(l,h){return cs(l,Tt,v,v,v,h)});function Du(l,h){if(typeof l!="function")throw new qr(T);return h=h===v?h:ii(h),We(l,h)}function Jd(l,h){if(typeof l!="function")throw new qr(T);return h=h==null?0:Yt(ii(h),0),We(function(x){var A=x[h],$=jn(x,0,h);return A&&jo($,A),Ur(l,this,$)})}function Gp(l,h,x){var A=!0,$=!0;if(typeof l!="function")throw new qr(T);return Mn(x)&&(A="leading"in x?!!x.leading:A,$="trailing"in x?!!x.trailing:$),Wd(l,h,{leading:A,maxWait:h,trailing:$})}function Qd(l){return Np(l,1)}function Mo(l,h){return Bh(Is(h),l)}function Dc(){if(!arguments.length)return[];var l=arguments[0];return ei(l)?l:[l]}function ef(l){return _r(l,te)}function tf(l,h){return h=typeof h=="function"?h:v,_r(l,te,h)}function nf(l){return _r(l,de|te)}function rf(l,h){return h=typeof h=="function"?h:v,_r(l,de|te,h)}function of(l,h){return h==null||mu(l,h,Be(h))}function Wo(l,h){return l===h||l!==l&&h!==h}var Em=wu(as),sf=wu(function(l,h){return l>=h}),ho=yc(function(){return arguments}())?yc:function(l){return Ki(l)&&xi.call(l,"callee")&&!lu.call(l,"callee")},ei=$e.isArray,af=Ul?hr(Ul):p;function Kr(l){return l!=null&&Nh(l.length)&&!Xo(l)}function zn(l){return Ki(l)&&Kr(l)}function km(l){return l===!0||l===!1||Ki(l)&&kn(l)==mr}var Za=hl||Gm,lf=ts?hr(ts):e;function Ru(l){return Ki(l)&&l.nodeType===1&&!Lc(l)}function cf(l){if(l==null)return!0;if(Kr(l)&&(ei(l)||typeof l=="string"||typeof l.splice=="function"||Za(l)||Ls(l)||ho(l)))return!l.length;var h=Dr(l);if(h==mi||h==An)return!l.size;if(ha(l))return!R(l).length;for(var x in l)if(xi.call(l,x))return!1;return!0}function Oh(l,h){return i(l,h)}function uf(l,h,x){x=typeof x=="function"?x:v;var A=x?x(l,h):v;return A===v?i(l,h,v,x):!!A}function Rc(l){if(!Ki(l))return!1;var h=kn(l);return h==Ji||h==gr||typeof l.message=="string"&&typeof l.name=="string"&&!Lc(l)}function jh(l){return typeof l=="number"&&Aa(l)}function Xo(l){if(!Mn(l))return!1;var h=kn(l);return h==Ni||h==Zn||h==fr||h==ar}function hf(l){return typeof l=="number"&&l==ii(l)}function Nh(l){return typeof l=="number"&&l>-1&&l%1==0&&l<=Pi}function Mn(l){var h=typeof l;return l!=null&&(h=="object"||h=="function")}function Ki(l){return l!=null&&typeof l=="object"}var tr=Qc?hr(Qc):c;function qa(l,h){return l===h||d(l,h,Tl(h))}function Zp(l,h,x){return x=typeof x=="function"?x:v,d(l,h,Tl(h),x)}function pf(l){return Hp(l)&&l!=+l}function df(l){if(md(l))throw new Vt(D);return g(l)}function qp(l){return l===null}function zm(l){return l==null}function Hp(l){return typeof l=="number"||Ki(l)&&kn(l)==Sr}function Lc(l){if(!Ki(l)||kn(l)!=Qi)return!1;var h=rs(l);if(h===null)return!0;var x=xi.call(h,"constructor")&&h.constructor;return typeof x=="function"&&x instanceof x&&ai.call(x)==au}var Wp=qu?hr(qu):b;function ff(l){return hf(l)&&l>=-Pi&&l<=Pi}var $h=tl?hr(tl):P;function Bc(l){return typeof l=="string"||!ei(l)&&Ki(l)&&kn(l)==vn}function po(l){return typeof l=="symbol"||Ki(l)&&kn(l)==lr}var Ls=Gl?hr(Gl):C;function Xp(l){return l===v}function mf(l){return Ki(l)&&Dr(l)==Bn}function Kp(l){return Ki(l)&&kn(l)==$r}var Vh=wu(V),Lu=wu(function(l,h){return l<=h});function Uh(l){if(!l)return[];if(Kr(l))return Bc(l)?no(l):Sn(l);if(Xs&&l[Xs])return tc(l[Xs]());var h=Dr(l),x=h==mi?ic:h==An?Sa:mn;return x(l)}function us(l){if(!l)return l===0?l:0;if(l=n(l),l===gi||l===-gi){var h=l<0?-1:1;return h*cn}return l===l?l:0}function ii(l){var h=us(l),x=h%1;return h===h?x?h-x:h:0}function gf(l){return l?Go(ii(l),0,ni):0}function n(l){if(typeof l=="number")return l;if(po(l))return Yi;if(Mn(l)){var h=typeof l.valueOf=="function"?l.valueOf():l;l=Mn(h)?h+"":h}if(typeof l!="string")return l===0?l:+l;l=Jl(l);var x=Vr.test(l);return x||Ha.test(l)?Jc(l.slice(2),x?2:8):Zi.test(l)?Yi:+l}function t(l){return Po(l,Qe(l))}function r(l){return l?Go(ii(l),-Pi,Pi):l===0?l:0}function o(l){return l==null?"":Ti(l)}var u=ks(function(l,h){if(ha(h)||Kr(h)){Po(h,Be(h),l);return}for(var x in h)xi.call(h,x)&&na(l,x,h[x])}),f=ks(function(l,h){Po(h,Qe(h),l)}),m=ks(function(l,h,x,A){Po(h,Qe(h),l,A)}),_=ks(function(l,h,x,A){Po(h,Be(h),l,A)}),w=ua(sa);function M(l,h){var x=vo(l);return h==null?x:oa(x,h)}var I=We(function(l,h){l=Ai(l);var x=-1,A=h.length,$=A>2?h[2]:v;for($&&Rr(h[0],h[1],$)&&(A=1);++x<A;)for(var ee=h[x],pe=Qe(ee),Se=-1,ke=pe.length;++Se<ke;){var ot=pe[Se],st=l[ot];(st===v||Wo(st,qs[ot])&&!xi.call(l,ot))&&(l[ot]=ee[ot])}return l}),E=We(function(l){return l.push(v,co),Ur(St,v,l)});function L(l,h){return Wu(l,Nt(h,3),yr)}function j(l,h){return Wu(l,Nt(h,3),aa)}function N(l,h){return l==null?l:vl(l,Nt(h,3),Qe)}function G(l,h){return l==null?l:Zo(l,Nt(h,3),Qe)}function J(l,h){return l&&yr(l,Nt(h,3))}function oe(l,h){return l&&aa(l,Nt(h,3))}function xe(l){return l==null?[]:la(l,Be(l))}function le(l){return l==null?[]:la(l,Qe(l))}function O(l,h,x){var A=l==null?v:To(l,h);return A===v?x:A}function K(l,h){return l!=null&&bh(l,h,gu)}function ce(l,h){return l!=null&&bh(l,h,_c)}var Re=xu(function(l,h,x){h!=null&&typeof h.toString!="function"&&(h=ws.call(h)),l[h]=x},ed(an)),Je=xu(function(l,h,x){h!=null&&typeof h.toString!="function"&&(h=ws.call(h)),xi.call(l,h)?l[h].push(x):l[h]=[x]},Nt),Fe=We(ls);function Be(l){return Kr(l)?Vi(l):R(l)}function Qe(l){return Kr(l)?Vi(l,!0):B(l)}function tt(l,h){var x={};return h=Nt(h,3),yr(l,function(A,$,ee){kt(x,h(A,$,ee),A)}),x}function at(l,h){var x={};return h=Nt(h,3),yr(l,function(A,$,ee){kt(x,$,h(A,$,ee))}),x}var Ue=ks(function(l,h,x){re(l,h,x)}),St=ks(function(l,h,x,A){re(l,h,x,A)}),Dt=ua(function(l,h){var x={};if(l==null)return x;var A=!1;h=rn(h,function(ee){return ee=Tn(ee,l),A||(A=ee.length>1),ee}),Po(l,pp(l),x),A&&(x=_r(x,de|ge|te,hd));for(var $=h.length;$--;)er(x,h[$]);return x});function zt(l,h){return si(l,zu(Nt(h)))}var It=ua(function(l,h){return l==null?{}:me(l,h)});function si(l,h){if(l==null)return{};var x=rn(pp(l),function(A){return[A]});return h=Nt(h),ve(l,x,function(A,$){return h(A,$[0])})}function hn(l,h,x){h=Tn(h,l);var A=-1,$=h.length;for($||($=1,l=v);++A<$;){var ee=l==null?v:l[Ds(h[A])];ee===v&&(A=$,ee=x),l=Xo(ee)?ee.call(l):ee}return l}function $n(l,h,x){return l==null?l:_t(l,h,x)}function pr(l,h,x,A){return A=typeof A=="function"?A:v,l==null?l:_t(l,h,x,A)}var fo=up(Be),Lr=up(Qe);function ir(l,h,x){var A=ei(l),$=A||Za(l)||Ls(l);if(h=Nt(h,4),x==null){var ee=l&&l.constructor;$?x=A?new ee:[]:Mn(l)?x=Xo(ee)?vo(rs(l)):{}:x={}}return($?qn:yr)(l,function(pe,Se,ke){return h(x,pe,Se,ke)}),x}function sn(l,h){return l==null?!0:er(l,h)}function Xn(l,h,x){return l==null?l:qo(l,h,Is(x))}function nr(l,h,x,A){return A=typeof A=="function"?A:v,l==null?l:qo(l,h,Is(x),A)}function mn(l){return l==null?[]:tu(l,Be(l))}function Br(l){return l==null?[]:tu(l,Qe(l))}function Co(l,h,x){return x===v&&(x=h,h=v),x!==v&&(x=n(x),x=x===x?x:0),h!==v&&(h=n(h),h=h===h?h:0),Go(n(l),h,x)}function Kn(l,h,x){return h=us(h),x===v?(x=h,h=0):x=us(x),l=n(l),Cs(l,h,x)}function Yr(l,h,x){if(x&&typeof x!="boolean"&&Rr(l,h,x)&&(h=x=v),x===v&&(typeof h=="boolean"?(x=h,h=v):typeof l=="boolean"&&(x=l,l=v)),l===v&&h===v?(l=0,h=1):(l=us(l),h===v?(h=l,l=0):h=us(h)),l>h){var A=l;l=h,h=A}if(x||l%1||h%1){var $=hc();return fn(l+$*(h-l+Gu("1e-"+(($+"").length-1))),h)}return Ve(l,h)}var Vn=bl(function(l,h,x){return h=h.toLowerCase(),l+(x?Un(h):h)});function Un(l){return Qp(o(l).toLowerCase())}function Gn(l){return l=o(l),l&&l.replace(Gc,iu).replace($l,"")}function Dn(l,h,x){l=o(l),h=Ti(h);var A=l.length;x=x===v?A:Go(ii(x),0,A);var $=x;return x-=h.length,x>=0&&l.slice(x,$)==h}function Ui(l){return l=o(l),l&&Ne.test(l)?l.replace(De,nu):l}function hs(l){return l=o(l),l&&Ge.test(l)?l.replace(rt,"\\$&"):l}var Fc=bl(function(l,h,x){return l+(x?"-":"")+h.toLowerCase()}),ps=bl(function(l,h,x){return l+(x?" ":"")+h.toLowerCase()}),Dm=_h("toLowerCase");function Oc(l,h,x){l=o(l),h=ii(h);var A=h?Pa(l):0;if(!h||A>=h)return l;var $=(h-A)/2;return vh(Ia($),x)+l+vh(Js($),x)}function kl(l,h,x){l=o(l),h=ii(h);var A=h?Pa(l):0;return h&&A<h?l+vh(h-A,x):l}function jc(l,h,x){l=o(l),h=ii(h);var A=h?Pa(l):0;return h&&A<h?vh(h-A,x)+l:l}function Nc(l,h,x){return x||h==null?h=0:h&&(h=+h),uu(o(l).replace(yt,""),h||0)}function $c(l,h,x){return(x?Rr(l,h,x):h===v)?h=1:h=ii(h),je(o(l),h)}function _f(){var l=arguments,h=o(l[0]);return l.length<3?h:h.replace(l[1],l[2])}var yf=bl(function(l,h,x){return l+(x?"_":"")+h.toLowerCase()});function vf(l,h,x){return x&&typeof x!="number"&&Rr(l,h,x)&&(h=x=v),x=x===v?ni:x>>>0,x?(l=o(l),l&&(typeof h=="string"||h!=null&&!Wp(h))&&(h=Ti(h),!h&&bs(l))?jn(no(l),0,x):l.split(h,x)):[]}var xf=bl(function(l,h,x){return l+(x?" ":"")+Qp(h)});function Yp(l,h,x){return l=o(l),x=x==null?0:Go(ii(x),0,l.length),h=Ti(h),l.slice(x,x+h.length)==h}function Jp(l,h,x){var A=X.templateSettings;x&&Rr(l,h,x)&&(h=v),l=o(l),h=m({},h,A,Pc);var $=m({},h.imports,A.imports,Pc),ee=Be($),pe=tu($,ee),Se,ke,ot=0,st=h.interpolate||Ro,ut="__p += '",Ct=Zs((h.escape||Ro).source+"|"+st.source+"|"+(st===be?Fn:Ro).source+"|"+(h.evaluate||Ro).source+"|$","g"),Bt="//# sourceURL="+(xi.call(h,"sourceURL")?(h.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++hi+"]")+`
`;l.replace(Ct,function(Zt,yi,Si,ms,Io,gs){return Si||(Si=ms),ut+=l.slice(ot,gs).replace(js,sl),yi&&(Se=!0,ut+=`' +
__e(`+yi+`) +
'`),Io&&(ke=!0,ut+=`';
`+Io+`;
__p += '`),Si&&(ut+=`' +
((__t = (`+Si+`)) == null ? '' : __t) +
'`),ot=gs+Zt.length,Zt}),ut+=`';
`;var Gt=xi.call(h,"variable")&&h.variable;if(!Gt)ut=`with (obj) {
`+ut+`
}
`;else if(un.test(Gt))throw new Vt(a);ut=(ke?ut.replace(W,""):ut).replace(ae,"$1").replace(_e,"$1;"),ut="function("+(Gt||"obj")+`) {
`+(Gt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Se?", __e = _.escape":"")+(ke?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ut+`return __p
}`;var fi=Sf(function(){return ci(ee,Bt+"return "+ut).apply(v,pe)});if(fi.source=ut,Rc(fi))throw fi;return fi}function pa(l){return o(l).toLowerCase()}function bf(l){return o(l).toUpperCase()}function wf(l,h,x){if(l=o(l),l&&(x||h===v))return Jl(l);if(!l||!(h=Ti(h)))return l;var A=no(l),$=no(h),ee=Ql(A,$),pe=ec(A,$)+1;return jn(A,ee,pe).join("")}function Rm(l,h,x){if(l=o(l),l&&(x||h===v))return l.slice(0,Yu(l)+1);if(!l||!(h=Ti(h)))return l;var A=no(l),$=ec(A,no(h))+1;return jn(A,0,$).join("")}function Lm(l,h,x){if(l=o(l),l&&(x||h===v))return l.replace(yt,"");if(!l||!(h=Ti(h)))return l;var A=no(l),$=Ql(A,no(h));return jn(A,$).join("")}function Bm(l,h){var x=Bi,A=Jt;if(Mn(h)){var $="separator"in h?h.separator:$;x="length"in h?ii(h.length):x,A="omission"in h?Ti(h.omission):A}l=o(l);var ee=l.length;if(bs(l)){var pe=no(l);ee=pe.length}if(x>=ee)return l;var Se=x-Pa(A);if(Se<1)return A;var ke=pe?jn(pe,0,Se).join(""):l.slice(0,Se);if($===v)return ke+A;if(pe&&(Se+=ke.length-Se),Wp($)){if(l.slice(Se).search($)){var ot,st=ke;for($.global||($=Zs($.source,o(xn.exec($))+"g")),$.lastIndex=0;ot=$.exec(st);)var ut=ot.index;ke=ke.slice(0,ut===v?Se:ut)}}else if(l.indexOf(Ti($),Se)!=Se){var Ct=ke.lastIndexOf($);Ct>-1&&(ke=ke.slice(0,Ct))}return ke+A}function Fm(l){return l=o(l),l&&Te.test(l)?l.replace(Pe,Ju):l}var Om=bl(function(l,h,x){return l+(x?" ":"")+h.toUpperCase()}),Qp=_h("toUpperCase");function Tf(l,h,x){return l=o(l),h=x?v:h,h===v?ru(l)?sc(l):Gs(l):l.match(h)||[]}var Sf=We(function(l,h){try{return Ur(l,v,h)}catch(x){return Rc(x)?x:new Vt(x)}}),ds=ua(function(l,h){return qn(h,function(x){x=Ds(x),kt(l,x,$p(l[x],l))}),l});function Gh(l){var h=l==null?0:l.length,x=Nt();return l=h?rn(l,function(A){if(typeof A[1]!="function")throw new qr(T);return[x(A[0]),A[1]]}):[],We(function(A){for(var $=-1;++$<h;){var ee=l[$];if(Ur(ee[0],this,A))return Ur(ee[1],this,A)}})}function Pf(l){return Er(_r(l,de))}function ed(l){return function(){return l}}function jm(l,h){return l==null||l!==l?h:l}var Nm=Sc(),vr=Sc(!0);function an(l){return l}function da(l){return z(typeof l=="function"?l:_r(l,de))}function fs(l){return ne(_r(l,de))}function zl(l,h){return ie(l,_r(h,de))}var Bs=We(function(l,h){return function(x){return ls(x,l,h)}}),d_=We(function(l,h){return function(x){return ls(l,x,h)}});function $m(l,h,x){var A=Be(h),$=la(h,A);x==null&&!(Mn(h)&&($.length||!A.length))&&(x=h,h=l,l=this,$=la(h,Be(h)));var ee=!(Mn(x)&&"chain"in x)||!!x.chain,pe=Xo(l);return qn($,function(Se){var ke=h[Se];l[Se]=ke,pe&&(l.prototype[Se]=function(){var ot=this.__chain__;if(ee||ot){var st=l(this.__wrapped__),ut=st.__actions__=Sn(this.__actions__);return ut.push({func:ke,args:arguments,thisArg:l}),st.__chain__=ot,st}return ke.apply(l,jo([this.value()],arguments))})}),l}function f_(){return bn._===this&&(bn._=np),this}function Vm(){}function m_(l){return l=ii(l),We(function(h){return ue(h,l)})}var g_=yh(rn),__=yh(va),y_=yh(ba);function rg(l){return Cc(l)?Wl(Ds(l)):ye(l)}function v_(l){return function(h){return l==null?v:To(l,h)}}var x_=sp(),b_=sp(!0);function Um(){return[]}function Gm(){return!1}function w_(){return{}}function T_(){return""}function S_(){return!0}function P_(l,h){if(l=ii(l),l<1||l>Pi)return[];var x=ni,A=fn(l,ni);h=Nt(h),l-=ni;for(var $=Yl(A,h);++x<l;)h(x);return $}function M_(l){return ei(l)?rn(l,Ds):po(l)?[l]:Sn(_d(o(l)))}function C_(l){var h=++ip;return o(l)+h}var I_=bu(function(l,h){return l+h},0),A_=lp("ceil"),E_=bu(function(l,h){return l/h},1),k_=lp("floor");function z_(l){return l&&l.length?_l(l,an,as):v}function D_(l,h){return l&&l.length?_l(l,Nt(h,2),as):v}function R_(l){return eu(l,an)}function L_(l,h){return eu(l,Nt(h,2))}function B_(l){return l&&l.length?_l(l,an,V):v}function F_(l,h){return l&&l.length?_l(l,Nt(h,2),V):v}var O_=bu(function(l,h){return l*h},1),j_=lp("round"),N_=bu(function(l,h){return l-h},0);function $_(l){return l&&l.length?Kl(l,an):0}function V_(l,h){return l&&l.length?Kl(l,Nt(h,2)):0}return X.after=Lh,X.ary=Np,X.assign=u,X.assignIn=f,X.assignInWith=m,X.assignWith=_,X.at=w,X.before=Zd,X.bind=$p,X.bindAll=ds,X.bindKey=Vp,X.castArray=Dc,X.chain=Al,X.chunk=xp,X.compact=yd,X.concat=bp,X.cond=Gh,X.conforms=Pf,X.constant=ed,X.countBy=Dp,X.create=M,X.curry=qd,X.curryRight=Hd,X.debounce=Wd,X.defaults=I,X.defaultsDeep=E,X.defer=Am,X.delay=Up,X.difference=vd,X.differenceBy=xd,X.differenceWith=Ih,X.drop=bd,X.dropRight=wd,X.dropRightWhile=Td,X.dropWhile=Pu,X.fill=Jf,X.filter=$d,X.flatMap=Tm,X.flatMapDeep=Sm,X.flatMapDepth=Pm,X.flatten=Eh,X.flattenDeep=Qf,X.flattenDepth=em,X.flip=Ga,X.flow=Nm,X.flowRight=vr,X.fromPairs=Sd,X.functions=xe,X.functionsIn=le,X.groupBy=Au,X.initial=im,X.intersection=Mu,X.intersectionBy=Pd,X.intersectionWith=nm,X.invert=Re,X.invertBy=Je,X.invokeMap=Ua,X.iteratee=da,X.keyBy=Vd,X.keys=Be,X.keysIn=Qe,X.map=kc,X.mapKeys=tt,X.mapValues=at,X.matches=fs,X.matchesProperty=zl,X.memoize=ku,X.merge=Ue,X.mergeWith=St,X.method=Bs,X.methodOf=d_,X.mixin=$m,X.negate=zu,X.nthArg=m_,X.omit=Dt,X.omitBy=zt,X.once=Xd,X.orderBy=Mm,X.over=g_,X.overArgs=Kd,X.overEvery=__,X.overSome=y_,X.partial=Bh,X.partialRight=Fh,X.partition=Cm,X.pick=It,X.pickBy=si,X.property=rg,X.propertyOf=v_,X.pull=am,X.pullAll=Tp,X.pullAllBy=Sp,X.pullAllWith=Md,X.pullAt=Cd,X.range=x_,X.rangeRight=b_,X.rearg=Yd,X.reject=Im,X.remove=Id,X.rest=Du,X.reverse=Pp,X.sampleSize=Op,X.set=$n,X.setWith=pr,X.shuffle=zc,X.slice=kh,X.sortBy=jp,X.sortedUniq=pm,X.sortedUniqBy=dm,X.split=vf,X.spread=Jd,X.tail=Cu,X.take=kd,X.takeRight=Mp,X.takeRightWhile=zd,X.takeWhile=Nn,X.tap=Dh,X.throttle=Gp,X.thru=El,X.toArray=Uh,X.toPairs=fo,X.toPairsIn=Lr,X.toPath=M_,X.toPlainObject=t,X.transform=ir,X.unary=Qd,X.union=Cp,X.unionBy=fm,X.unionWith=Dd,X.uniq=Ip,X.uniqBy=Ap,X.uniqWith=mm,X.unset=sn,X.unzip=Ep,X.unzipWith=Rd,X.update=Xn,X.updateWith=nr,X.values=mn,X.valuesIn=Br,X.without=gm,X.words=Tf,X.wrap=Mo,X.xor=Ld,X.xorBy=Xr,X.xorWith=kp,X.zip=Bd,X.zipObject=Va,X.zipObjectDeep=zh,X.zipWith=Iu,X.entries=fo,X.entriesIn=Lr,X.extend=f,X.extendWith=m,$m(X,X),X.add=I_,X.attempt=Sf,X.camelCase=Vn,X.capitalize=Un,X.ceil=A_,X.clamp=Co,X.clone=ef,X.cloneDeep=nf,X.cloneDeepWith=rf,X.cloneWith=tf,X.conformsTo=of,X.deburr=Gn,X.defaultTo=jm,X.divide=E_,X.endsWith=Dn,X.eq=Wo,X.escape=Ui,X.escapeRegExp=hs,X.every=xm,X.find=bm,X.findIndex=Ah,X.findKey=L,X.findLast=wm,X.findLastIndex=Ec,X.findLastKey=j,X.floor=k_,X.forEach=Rp,X.forEachRight=Lp,X.forIn=N,X.forInRight=G,X.forOwn=J,X.forOwnRight=oe,X.get=O,X.gt=Em,X.gte=sf,X.has=K,X.hasIn=ce,X.head=wp,X.identity=an,X.includes=Rs,X.indexOf=tm,X.inRange=Kn,X.invoke=Fe,X.isArguments=ho,X.isArray=ei,X.isArrayBuffer=af,X.isArrayLike=Kr,X.isArrayLikeObject=zn,X.isBoolean=km,X.isBuffer=Za,X.isDate=lf,X.isElement=Ru,X.isEmpty=cf,X.isEqual=Oh,X.isEqualWith=uf,X.isError=Rc,X.isFinite=jh,X.isFunction=Xo,X.isInteger=hf,X.isLength=Nh,X.isMap=tr,X.isMatch=qa,X.isMatchWith=Zp,X.isNaN=pf,X.isNative=df,X.isNil=zm,X.isNull=qp,X.isNumber=Hp,X.isObject=Mn,X.isObjectLike=Ki,X.isPlainObject=Lc,X.isRegExp=Wp,X.isSafeInteger=ff,X.isSet=$h,X.isString=Bc,X.isSymbol=po,X.isTypedArray=Ls,X.isUndefined=Xp,X.isWeakMap=mf,X.isWeakSet=Kp,X.join=rm,X.kebabCase=Fc,X.last=Ho,X.lastIndexOf=om,X.lowerCase=ps,X.lowerFirst=Dm,X.lt=Vh,X.lte=Lu,X.max=z_,X.maxBy=D_,X.mean=R_,X.meanBy=L_,X.min=B_,X.minBy=F_,X.stubArray=Um,X.stubFalse=Gm,X.stubObject=w_,X.stubString=T_,X.stubTrue=S_,X.multiply=O_,X.nth=sm,X.noConflict=f_,X.noop=Vm,X.now=Eu,X.pad=Oc,X.padEnd=kl,X.padStart=jc,X.parseInt=Nc,X.random=Yr,X.reduce=Rh,X.reduceRight=Bp,X.repeat=$c,X.replace=_f,X.result=hn,X.round=j_,X.runInContext=Ce,X.sample=Fp,X.size=Ud,X.snakeCase=yf,X.some=Gd,X.sortedIndex=lm,X.sortedIndexBy=Ad,X.sortedIndexOf=cm,X.sortedLastIndex=um,X.sortedLastIndexBy=hm,X.sortedLastIndexOf=Ed,X.startCase=xf,X.startsWith=Yp,X.subtract=N_,X.sum=$_,X.sumBy=V_,X.template=Jp,X.times=P_,X.toFinite=us,X.toInteger=ii,X.toLength=gf,X.toLower=pa,X.toNumber=n,X.toSafeInteger=r,X.toString=o,X.toUpper=bf,X.trim=wf,X.trimEnd=Rm,X.trimStart=Lm,X.truncate=Bm,X.unescape=Fm,X.uniqueId=C_,X.upperCase=Om,X.upperFirst=Qp,X.each=Rp,X.eachRight=Lp,X.first=wp,$m(X,function(){var l={};return yr(X,function(h,x){xi.call(X.prototype,x)||(l[x]=h)}),l}(),{chain:!1}),X.VERSION=k,qn(["bind","bindKey","curry","curryRight","partial","partialRight"],function(l){X[l].placeholder=X}),qn(["drop","take"],function(l,h){ti.prototype[l]=function(x){x=x===v?1:Yt(ii(x),0);var A=this.__filtered__&&!h?new ti(this):this.clone();return A.__filtered__?A.__takeCount__=fn(x,A.__takeCount__):A.__views__.push({size:fn(x,ni),type:l+(A.__dir__<0?"Right":"")}),A},ti.prototype[l+"Right"]=function(x){return this.reverse()[l](x).reverse()}}),qn(["filter","map","takeWhile"],function(l,h){var x=h+1,A=x==Pt||x==jt;ti.prototype[l]=function($){var ee=this.clone();return ee.__iteratees__.push({iteratee:Nt($,3),type:x}),ee.__filtered__=ee.__filtered__||A,ee}}),qn(["head","last"],function(l,h){var x="take"+(h?"Right":"");ti.prototype[l]=function(){return this[x](1).value()[0]}}),qn(["initial","tail"],function(l,h){var x="drop"+(h?"":"Right");ti.prototype[l]=function(){return this.__filtered__?new ti(this):this[x](1)}}),ti.prototype.compact=function(){return this.filter(an)},ti.prototype.find=function(l){return this.filter(l).head()},ti.prototype.findLast=function(l){return this.reverse().find(l)},ti.prototype.invokeMap=We(function(l,h){return typeof l=="function"?new ti(this):this.map(function(x){return ls(x,l,h)})}),ti.prototype.reject=function(l){return this.filter(zu(Nt(l)))},ti.prototype.slice=function(l,h){l=ii(l);var x=this;return x.__filtered__&&(l>0||h<0)?new ti(x):(l<0?x=x.takeRight(-l):l&&(x=x.drop(l)),h!==v&&(h=ii(h),x=h<0?x.dropRight(-h):x.take(h-l)),x)},ti.prototype.takeRightWhile=function(l){return this.reverse().takeWhile(l).reverse()},ti.prototype.toArray=function(){return this.take(ni)},yr(ti.prototype,function(l,h){var x=/^(?:filter|find|map|reject)|While$/.test(h),A=/^(?:head|last)$/.test(h),$=X[A?"take"+(h=="last"?"Right":""):h],ee=A||/^find/.test(h);$&&(X.prototype[h]=function(){var pe=this.__wrapped__,Se=A?[1]:arguments,ke=pe instanceof ti,ot=Se[0],st=ke||ei(pe),ut=function(yi){var Si=$.apply(X,jo([yi],Se));return A&&Ct?Si[0]:Si};st&&x&&typeof ot=="function"&&ot.length!=1&&(ke=st=!1);var Ct=this.__chain__,Bt=!!this.__actions__.length,Gt=ee&&!Ct,fi=ke&&!Bt;if(!ee&&st){pe=fi?pe:new ti(this);var Zt=l.apply(pe,Se);return Zt.__actions__.push({func:El,args:[ut],thisArg:v}),new _i(Zt,Ct)}return Gt&&fi?l.apply(this,Se):(Zt=this.thru(ut),Gt?A?Zt.value()[0]:Zt.value():Zt)})}),qn(["pop","push","shift","sort","splice","unshift"],function(l){var h=ns[l],x=/^(?:push|sort|unshift)$/.test(l)?"tap":"thru",A=/^(?:pop|shift)$/.test(l);X.prototype[l]=function(){var $=arguments;if(A&&!this.__chain__){var ee=this.value();return h.apply(ei(ee)?ee:[],$)}return this[x](function(pe){return h.apply(ei(pe)?pe:[],$)})}}),yr(ti.prototype,function(l,h){var x=X[h];if(x){var A=x.name+"";xi.call(ea,A)||(ea[A]=[]),ea[A].push({name:h,func:x})}}),ea[wl(v,vt).name]=[{name:"wrapper",func:v}],ti.prototype.clone=xo,ti.prototype.reverse=La,ti.prototype.value=rp,X.prototype.at=_m,X.prototype.chain=ym,X.prototype.commit=Fd,X.prototype.next=Od,X.prototype.plant=jd,X.prototype.reverse=Nd,X.prototype.toJSON=X.prototype.valueOf=X.prototype.value=zp,X.prototype.first=X.prototype.head,Xs&&(X.prototype[Xs]=vm),X},ro=ou();to?((to.exports=ro)._=ro,Ci._=ro):bn._=ro}).call(Xh)})(Lf,Lf.exports);var O0=Lf.exports;const Hm={snapline:"#34343f",altRouteline:"#9e91be",routelineFoot:"#3665ff",routelineBike:"#63c4ff",routeline:"#7b51f8",congestionLow:"#42c74c",congestionHigh:"#d72359",hoverpoint:"#30a856",snappoint:"#cb3373",snappointHighlight:"#e50d3f",waypointFoot:"#3665ff",waypointFootHighlight:"#0942ff",waypointBike:"#63c4ff",waypointBikeHighlight:"#0bb8ff",waypoint:"#7b51f8",waypointHighlight:"#6d26d7"};function Fg(S,y,v){const k=S.slice();return k[13]=y[v],k}function Og(S){let y,v=S[13]+"";return{c(){y=Ie("li"),hg(y,"--marker-color",S[4][S[13]]),lt(y,"class","color-marker svelte-ti4f1")},m(k,F){Ee(k,y,F),y.innerHTML=v},p(k,F){F&4&&v!==(v=k[13]+"")&&(y.innerHTML=v),F&4&&hg(y,"--marker-color",k[4][k[13]])},d(k){k&&Ae(y)}}}function j0(S){let y,v,k,F,D,T,a,q,Y,fe,de,ge,te,we,it,Ke,vt,Rt,gt,nt,ht,Xe,ct,Tt,$t,Bi=ad(S[2]),Jt=[];for(let Ot=0;Ot<Bi.length;Ot+=1)Jt[Ot]=Og(Fg(S,Bi,Ot));return{c(){y=Ie("p"),v=_n(`This example showcases routing with multiple profiles. Segments corresponding to different profiles are displayed in
    different colors. Plugin provides default styles for typical `),k=Ie("a"),k.textContent="OSRM profiles",F=_n(`: car, bike, foot. Styles can be changed per profile via general style customization approach (consult the
    `),D=Ie("a"),D.textContent="Restyling example",T=_n(`). In case different profiles are used you can similarly
    style map features corresponding to each profile by targeting profile property of a feature (see
    `),a=Ie("a"),a.textContent="default styles",q=_n(")."),Y=mt(),fe=Ie("small"),fe.innerHTML="<strong>Note</strong> that interactivity is not supported for multiple profiles",de=mt(),ge=Ie("p"),ge.textContent="Used profiles:",te=mt(),we=Ie("ul");for(let Ot=0;Ot<Jt.length;Ot+=1)Jt[Ot].c();it=mt(),Ke=Ie("div"),vt=Ie("button"),Rt=_n("Shuffle Profiles"),nt=mt(),ht=Ie("button"),Xe=_n("Reset"),lt(k,"href","https://project-osrm.org/docs/v5.5.1/api/#general-options"),lt(k,"target","_blank"),lt(D,"href","/examples/restyling"),lt(a,"href","https://github.com/maplibre/maplibre-gl-directions/blob/main/src/directions/layers.ts"),lt(a,"target","_blank"),vt.disabled=gt=!S[1],ht.disabled=ct=!S[1],lt(Ke,"class","flex gap-2 justify-center")},m(Ot,Ft){Ee(Ot,y,Ft),Ye(y,v),Ye(y,k),Ye(y,F),Ye(y,D),Ye(y,T),Ye(y,a),Ye(y,q),Ee(Ot,Y,Ft),Ee(Ot,fe,Ft),Ee(Ot,de,Ft),Ee(Ot,ge,Ft),Ee(Ot,te,Ft),Ee(Ot,we,Ft);for(let Pt=0;Pt<Jt.length;Pt+=1)Jt[Pt]&&Jt[Pt].m(we,null);Ee(Ot,it,Ft),Ee(Ot,Ke,Ft),Ye(Ke,vt),Ye(vt,Rt),Ye(Ke,nt),Ye(Ke,ht),Ye(ht,Xe),Tt||($t=[Ff(Nf.call(null,D)),Ri(vt,"click",S[6]),Ri(ht,"click",S[5])],Tt=!0)},p(Ot,Ft){if(Ft&20){Bi=ad(Ot[2]);let Pt;for(Pt=0;Pt<Bi.length;Pt+=1){const Wt=Fg(Ot,Bi,Pt);Jt[Pt]?Jt[Pt].p(Wt,Ft):(Jt[Pt]=Og(Wt),Jt[Pt].c(),Jt[Pt].m(we,null))}for(;Pt<Jt.length;Pt+=1)Jt[Pt].d(1);Jt.length=Bi.length}Ft&2&&gt!==(gt=!Ot[1])&&(vt.disabled=gt),Ft&2&&ct!==(ct=!Ot[1])&&(ht.disabled=ct)},d(Ot){Ot&&(Ae(y),Ae(Y),Ae(fe),Ae(de),Ae(ge),Ae(te),Ae(we),Ae(it),Ae(Ke)),Jm(Jt,Ot),Tt=!1,Os($t)}}}function N0(S){let y;return{c(){y=Ie("span"),y.textContent=`${S[3].name}`,lt(y,"slot","title")},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function $0(S){let y,v,k,F;return y=new zo({props:{$$slots:{title:[N0],default:[j0]},$$scope:{ctx:S}}}),{c(){dr(y.$$.fragment),v=mt(),k=Ie("div"),lt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(D,T){or(y,D,T),Ee(D,v,T),Ee(D,k,T),S[8](k),F=!0},p(D,[T]){const a={};T&65542&&(a.$$scope={dirty:T,ctx:D}),y.$set(a)},i(D){F||(Cn(y.$$.fragment,D),F=!0)},o(D){Ln(y.$$.fragment,D),F=!1},d(D){D&&(Ae(v),Ae(k)),sr(y,D),S[8](null)}}}function V0(S,y,v){let k,F;Eo(S,ko,Ke=>v(10,F=Ke));const D=Jr.find(Ke=>Ke.path===F);let T,a,q;Ko(()=>{const Ke=new ln.Map({container:T,style:Yo,center:[-74.1197632,40.6974034],zoom:11,attributionControl:!1});Ke.addControl(new ln.AttributionControl({customAttribution:"<a href='http://project-osrm.org/' target='_blank' rel='noreferrer'>&copy; OSRM</a>"})),Ke.on("load",()=>{a=Ke,v(1,q=new Ao(a,{requestOptions:{alternatives:"true"}})),te()})});const Y=[[-74.21349031181673,40.704951524836275],[-74.19666749687558,40.738517300855904],[-74.16611177177786,40.76634583723629],[-74.07169801445302,40.719004374548206],[-73.99170381279369,40.725509319065594],[-73.98071748466812,40.762445342516145]],fe={car:Hm.routeline,bike:Hm.routelineBike,foot:Hm.routelineFoot},de=["car","bike","car","car","foot"];let ge=de;function te(){v(7,ge=de),q==null||q.setWaypoints(Y,de)}function we(){v(7,ge=O0.shuffle(ge)),q==null||q.setWaypoints(Y,ge)}function it(Ke){go[Ke?"unshift":"push"](()=>{T=Ke,v(0,T)})}return S.$$.update=()=>{S.$$.dirty&128&&v(2,k=ge.reduce((Ke,vt)=>(Ke[Ke.length-1]!==vt&&Ke.push(vt),Ke),[]))},[T,q,k,D,fe,te,we,ge,it]}class U0 extends jr{constructor(y){super(),Or(this,y,V0,$0,xr,{})}}const G0=Object.freeze(Object.defineProperty({__proto__:null,default:U0},Symbol.toStringTag,{value:"Module"}));function Z0(S){let y,v,k,F,D,T,a,q,Y,fe,de,ge,te,we,it,Ke,vt,Rt,gt,nt,ht,Xe,ct,Tt,$t,Bi,Jt,Ot,Ft,Pt,Wt;return{c(){y=Ie("small"),y.innerHTML="<strong>Note</strong> that interactivity is disabled for this example",v=mt(),k=Ie("div"),F=Ie("p"),F.textContent="Set waypoints to a predefined set",D=mt(),T=Ie("button"),a=_n("Set Waypoints"),Y=mt(),fe=Ie("div"),de=Ie("p"),de.textContent="Add a random waypoint at some random index",ge=mt(),te=Ie("button"),we=_n("Add Waypoint"),Ke=mt(),vt=Ie("div"),Rt=Ie("p"),Rt.textContent="Delete a random waypoint",gt=mt(),nt=Ie("button"),ht=_n("Delete Waypoint"),ct=mt(),Tt=Ie("div"),$t=Ie("p"),$t.textContent="Clear the map from all the stuff added by the plugin",Bi=mt(),Jt=Ie("button"),Ot=_n("Clear"),T.disabled=q=!S[1],lt(T,"class","self-center"),lt(k,"class","flex flex-col gap-2"),te.disabled=it=!S[1],lt(te,"class","self-center"),lt(fe,"class","flex flex-col gap-2"),nt.disabled=Xe=!S[1],lt(nt,"class","self-center"),lt(vt,"class","flex flex-col gap-2"),Jt.disabled=Ft=!S[1],lt(Jt,"class","self-center"),lt(Tt,"class","flex flex-col gap-2")},m(jt,gi){Ee(jt,y,gi),Ee(jt,v,gi),Ee(jt,k,gi),Ye(k,F),Ye(k,D),Ye(k,T),Ye(T,a),Ee(jt,Y,gi),Ee(jt,fe,gi),Ye(fe,de),Ye(fe,ge),Ye(fe,te),Ye(te,we),Ee(jt,Ke,gi),Ee(jt,vt,gi),Ye(vt,Rt),Ye(vt,gt),Ye(vt,nt),Ye(nt,ht),Ee(jt,ct,gi),Ee(jt,Tt,gi),Ye(Tt,$t),Ye(Tt,Bi),Ye(Tt,Jt),Ye(Jt,Ot),Pt||(Wt=[Ri(T,"click",S[3]),Ri(te,"click",S[4]),Ri(nt,"click",S[5]),Ri(Jt,"click",S[6])],Pt=!0)},p(jt,gi){gi&2&&q!==(q=!jt[1])&&(T.disabled=q),gi&2&&it!==(it=!jt[1])&&(te.disabled=it),gi&2&&Xe!==(Xe=!jt[1])&&(nt.disabled=Xe),gi&2&&Ft!==(Ft=!jt[1])&&(Jt.disabled=Ft)},d(jt){jt&&(Ae(y),Ae(v),Ae(k),Ae(Y),Ae(fe),Ae(Ke),Ae(vt),Ae(ct),Ae(Tt)),Pt=!1,Os(Wt)}}}function q0(S){let y;return{c(){y=Ie("span"),y.textContent=`${S[2].name}`,lt(y,"slot","title")},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function H0(S){let y,v,k,F;return y=new zo({props:{$$slots:{title:[q0],default:[Z0]},$$scope:{ctx:S}}}),{c(){dr(y.$$.fragment),v=mt(),k=Ie("div"),lt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(D,T){or(y,D,T),Ee(D,v,T),Ee(D,k,T),S[7](k),F=!0},p(D,[T]){const a={};T&1026&&(a.$$scope={dirty:T,ctx:D}),y.$set(a)},i(D){F||(Cn(y.$$.fragment,D),F=!0)},o(D){Ln(y.$$.fragment,D),F=!1},d(D){D&&(Ae(v),Ae(k)),sr(y,D),S[7](null)}}}function W0(S,y,v){let k;Eo(S,ko,te=>v(9,k=te));const F=Jr.find(te=>te.path===k);let D,T,a;Ko(()=>{const te=new ln.Map({container:D,style:Yo,center:[-74.1197632,40.6974034],zoom:11,attributionControl:!1});te.addControl(new ln.AttributionControl({customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"})),te.on("load",()=>{T=te,v(1,a=new Ao(T,{requestOptions:{alternatives:"true"}}))})});function q(){a==null||a.setWaypoints([[-74.21349031181673,40.704951524836275],[-74.19666749687558,40.738517300855904],[-74.16611177177786,40.76634583723629],[-74.07169801445302,40.719004374548206],[-73.99170381279369,40.725509319065594],[-73.98071748466812,40.762445342516145]])}function Y(){const te=T==null?void 0:T.getBounds(),we=T==null?void 0:T.getCenter();if(te&&we){const it=te.getEast()-te.getWest(),Ke=te.getSouth()-te.getNorth();a==null||a.addWaypoint([we.lng-it/2+it*Math.random(),we.lat-Ke/2+Ke*Math.random()],(a==null?void 0:a.waypoints.length)*Math.random()|0)}}function fe(){a==null||a.removeWaypoint((a==null?void 0:a.waypoints.length)*Math.random()|0)}function de(){a==null||a.clear()}function ge(te){go[te?"unshift":"push"](()=>{D=te,v(0,D)})}return[D,a,F,q,Y,fe,de,ge]}class X0 extends jr{constructor(y){super(),Or(this,y,W0,H0,xr,{})}}const K0=Object.freeze(Object.defineProperty({__proto__:null,default:X0},Symbol.toStringTag,{value:"Module"}));function Y0(S){let y,v,k,F,D,T,a,q,Y,fe,de,ge,te,we,it,Ke,vt,Rt,gt,nt,ht;return{c(){y=Ie("label"),v=Ie("span"),v.innerHTML="<strong>Congestions</strong>",k=mt(),F=Ie("select"),D=Ie("option"),D.textContent="Stringy",T=Ie("option"),T.textContent="Numeric",q=mt(),Y=Ie("p"),Y.textContent="This example makes POST requests to the official Mapbox Directions API with the following options:",fe=mt(),de=Ie("ul"),ge=Ie("li"),te=Ie("strong"),we=_n("annotations="),it=_n(S[1]),Ke=mt(),vt=Ie("li"),vt.textContent="overview=full",Rt=mt(),gt=Ie("li"),gt.textContent="alternatives=true",D.__value="congestion",Gi(D,D.__value),T.__value="congestion_numeric",Gi(T,T.__value),F.disabled=a=!S[0],S[1]===void 0&&sd(()=>S[5].call(F)),lt(y,"class","flex flex-col gap-2")},m(Xe,ct){Ee(Xe,y,ct),Ye(y,v),Ye(y,k),Ye(y,F),Ye(F,D),Ye(F,T),If(F,S[1],!0),Ee(Xe,q,ct),Ee(Xe,Y,ct),Ee(Xe,fe,ct),Ee(Xe,de,ct),Ye(de,ge),Ye(ge,te),Ye(te,we),Ye(te,it),Ye(de,Ke),Ye(de,vt),Ye(de,Rt),Ye(de,gt),nt||(ht=Ri(F,"change",S[5]),nt=!0)},p(Xe,ct){ct&1&&a!==(a=!Xe[0])&&(F.disabled=a),ct&2&&If(F,Xe[1]),ct&2&&Qm(it,Xe[1])},d(Xe){Xe&&(Ae(y),Ae(q),Ae(Y),Ae(fe),Ae(de)),nt=!1,ht()}}}function J0(S){let y;return{c(){y=Ie("span"),y.textContent=`${S[3].name}`,lt(y,"slot","title")},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function Q0(S){let y,v,k,F;return y=new zo({props:{$$slots:{title:[J0],default:[Y0]},$$scope:{ctx:S}}}),{c(){dr(y.$$.fragment),v=mt(),k=Ie("div"),lt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(D,T){or(y,D,T),Ee(D,v,T),Ee(D,k,T),S[6](k),F=!0},p(D,[T]){const a={};T&259&&(a.$$scope={dirty:T,ctx:D}),y.$set(a)},i(D){F||(Cn(y.$$.fragment,D),F=!0)},o(D){Ln(y.$$.fragment,D),F=!1},d(D){D&&(Ae(v),Ae(k)),sr(y,D),S[6](null)}}}function ev(S,y,v){let k;Eo(S,ko,de=>v(7,k=de));const F=Jr.find(de=>de.path===k);let D,T,a,q="congestion";Ko(()=>{const de=new ln.Map({container:D,style:Yo,center:[-74.1197632,40.6974034],zoom:11,attributionControl:!1});de.addControl(new ln.AttributionControl({customAttribution:"<a href='//docs.mapbox.com/help/getting-started/directions/' target='_blank'>&copy; Mapbox Directions</a>"})),de.on("load",()=>{v(4,T=de)})});function Y(){q=Zg(this),v(1,q)}function fe(de){go[de?"unshift":"push"](()=>{D=de,v(2,D)})}return S.$$.update=()=>{S.$$.dirty&19&&T&&(a&&a.destroy(),v(0,a=new Ao(T,{api:"https://api.mapbox.com/directions/v5",profile:"mapbox/driving-traffic",makePostRequest:!0,requestOptions:{access_token:"pk.eyJ1Ijoic21lbGx5c2hvdmVsIiwiYSI6ImNsMW80eXQ4aTEwN3czcG8zMXM2NzJ2ODIifQ.oWHUIUiEj2SS4_hue3qv2g",alternatives:"true",annotations:q,overview:"full"}})),v(0,a.interactive=!0,a))},[a,q,D,F,T,Y,fe]}class tv extends jr{constructor(y){super(),Or(this,y,ev,Q0,xr,{})}}const iv=Object.freeze(Object.defineProperty({__proto__:null,default:tv},Symbol.toStringTag,{value:"Module"}));function nv(S){let y,v,k;return{c(){y=Ie("p"),y.textContent=`In this example the default layers used by the plugin are augmented with an additional "symbol" layer which is only
    rendered for the ORIGIN and DESTINATION waypoints.`,v=mt(),k=Ie("p"),k.innerHTML=`<strong>Note</strong> how you don&#39;t need to re-define all the layers from scratch thanks to the exported
    <code>layersFactory</code> function that returns all the default layers allowing for their augmentation and modification`},m(F,D){Ee(F,y,D),Ee(F,v,D),Ee(F,k,D)},p:zi,d(F){F&&(Ae(y),Ae(v),Ae(k))}}}function rv(S){let y;return{c(){y=Ie("span"),y.textContent=`${S[1].name}`,lt(y,"slot","title")},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function ov(S){let y,v,k,F;return y=new zo({props:{$$slots:{title:[rv],default:[nv]},$$scope:{ctx:S}}}),{c(){dr(y.$$.fragment),v=mt(),k=Ie("div"),lt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(D,T){or(y,D,T),Ee(D,v,T),Ee(D,k,T),S[2](k),F=!0},p(D,[T]){const a={};T&32&&(a.$$scope={dirty:T,ctx:D}),y.$set(a)},i(D){F||(Cn(y.$$.fragment,D),F=!0)},o(D){Ln(y.$$.fragment,D),F=!1},d(D){D&&(Ae(v),Ae(k)),sr(y,D),S[2](null)}}}function sv(S,y,v){let k;Eo(S,ko,q=>v(4,k=q));const F=Jr.find(q=>q.path===k);let D,T;Ko(()=>{const q=new ln.Map({container:D,style:Yo,center:[-74.1197632,40.6974034],zoom:11,fadeDuration:0,attributionControl:!1});q.addControl(new ln.AttributionControl({customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"}));const Y=$f();Y.push({id:"maplibre-gl-directions-waypoint-label",type:"symbol",source:"maplibre-gl-directions",layout:{"text-field":["case",["==",["get","category"],"ORIGIN"],"A",["==",["get","category"],"DESTINATION"],"B",""]},paint:{"text-color":"#ffffff","text-opacity":.7},filter:["all",["==",["geometry-type"],"Point"],["==",["get","type"],"WAYPOINT"],["in",["get","category"],["literal",["ORIGIN","DESTINATION"]]]]}),q.on("load",()=>{T=new Ao(q,{requestOptions:{alternatives:"true"},layers:Y}),T.interactive=!0})});function a(q){go[q?"unshift":"push"](()=>{D=q,v(0,D)})}return[D,F,a]}class av extends jr{constructor(y){super(),Or(this,y,sv,ov,xr,{})}}const lv=Object.freeze(Object.defineProperty({__proto__:null,default:av},Symbol.toStringTag,{value:"Module"})),cv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAKRJREFUOE+lkkEOAVEQRF9tJBwCZxhHEFYOIXMWNuIynIOFI7B3hpKeDBFh0ub/ddfrX10lCp8K9aQAtsexSNLtc2EWsANqYC7p8g7JAobAEZgBS0mnJyQFiGHbXyFpwC+IbE+BDTBIJhI/WQH3sBSACbDtCahKLCwkndMA2yPg0CbRiJtuZHy34oixAl7ifwB7YF1SpDh0VPnaq8pdNlM36AI8AK1AOkjqIJazAAAAAElFTkSuQmCC";function uv(S){let y,v,k,F,D;return{c(){y=Ie("p"),y.textContent="Another example that demonstrates the ease of extending the original styles provided by the plugin.",v=mt(),k=Ie("p"),k.textContent='This time a "symbol" layer is added that shows the direction the selected route goes in.',F=mt(),D=Ie("small"),D.innerHTML=`<strong>Note</strong> that you have to manually load and add the images you intend to use for the custom layers you
    add`},m(T,a){Ee(T,y,a),Ee(T,v,a),Ee(T,k,a),Ee(T,F,a),Ee(T,D,a)},p:zi,d(T){T&&(Ae(y),Ae(v),Ae(k),Ae(F),Ae(D))}}}function hv(S){let y;return{c(){y=Ie("span"),y.textContent=`${S[1].name}`,lt(y,"slot","title")},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function pv(S){let y,v,k,F;return y=new zo({props:{$$slots:{title:[hv],default:[uv]},$$scope:{ctx:S}}}),{c(){dr(y.$$.fragment),v=mt(),k=Ie("div"),lt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(D,T){or(y,D,T),Ee(D,v,T),Ee(D,k,T),S[2](k),F=!0},p(D,[T]){const a={};T&32&&(a.$$scope={dirty:T,ctx:D}),y.$set(a)},i(D){F||(Cn(y.$$.fragment,D),F=!0)},o(D){Ln(y.$$.fragment,D),F=!1},d(D){D&&(Ae(v),Ae(k)),sr(y,D),S[2](null)}}}function dv(S,y,v){let k;Eo(S,ko,q=>v(4,k=q));const F=Jr.find(q=>q.path===k);let D,T;Ko(()=>{const q=new ln.Map({container:D,style:Yo,center:[-74.1197632,40.6974034],zoom:11,attributionControl:!1});q.addControl(new ln.AttributionControl({customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"})),q.loadImage(cv).then(fe=>{fe&&q.addImage("direction-arrow",fe.data)});const Y=$f();Y.push({id:"maplibre-gl-directions-routeline-direction-arrow",type:"symbol",source:"maplibre-gl-directions",layout:{"symbol-placement":"line-center","icon-image":"direction-arrow","icon-size":["interpolate",["exponential",1.5],["zoom"],12,.85,18,1.4]},paint:{"icon-opacity":.5},filter:["==",["get","route"],"SELECTED"]}),q.on("load",()=>{T=new Ao(q,{requestOptions:{alternatives:"true"},layers:Y}),T.interactive=!0})});function a(q){go[q?"unshift":"push"](()=>{D=q,v(0,D)})}return[D,F,a]}class fv extends jr{constructor(y){super(),Or(this,y,dv,pv,xr,{})}}const mv=Object.freeze(Object.defineProperty({__proto__:null,default:fv},Symbol.toStringTag,{value:"Module"}));function gv(S){let y,v,k,F,D,T,a,q,Y,fe,de,ge,te;return{c(){y=Ie("label"),v=Ie("input"),F=mt(),D=Ie("strong"),D.textContent="Simulate a Touch-Enabled Device",T=mt(),a=Ie("p"),a.textContent=`Sometimes it's pretty hard to aim exactly at the selected route line to add a waypoint by dragging it when using the
    plugin on a touch device.`,q=mt(),Y=Ie("p"),Y.innerHTML=`The example shows how one could use the <code>layersFactory</code>&#39;s input parameters to handle that case by
    increasing the points by 1.5 and the lines by 2 times when the map is used on a touch-enabled device.`,fe=mt(),de=Ie("small"),de.innerHTML=`<strong>Note</strong> that you can either load the page on a touch-enabled device or toggle the checkbox above: both
    options apply the same effect`,lt(v,"type","checkbox"),v.disabled=k=!S[0],lt(y,"class","flex items-center gap-3")},m(we,it){Ee(we,y,it),Ye(y,v),v.checked=S[1],Ye(y,F),Ye(y,D),Ee(we,T,it),Ee(we,a,it),Ee(we,q,it),Ee(we,Y,it),Ee(we,fe,it),Ee(we,de,it),ge||(te=Ri(v,"change",S[5]),ge=!0)},p(we,it){it&1&&k!==(k=!we[0])&&(v.disabled=k),it&2&&(v.checked=we[1])},d(we){we&&(Ae(y),Ae(T),Ae(a),Ae(q),Ae(Y),Ae(fe),Ae(de)),ge=!1,te()}}}function _v(S){let y;return{c(){y=Ie("span"),y.textContent=`${S[3].name}`,lt(y,"slot","title")},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function yv(S){let y,v,k,F;return y=new zo({props:{$$slots:{title:[_v],default:[gv]},$$scope:{ctx:S}}}),{c(){dr(y.$$.fragment),v=mt(),k=Ie("div"),lt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(D,T){or(y,D,T),Ee(D,v,T),Ee(D,k,T),S[6](k),F=!0},p(D,[T]){const a={};T&259&&(a.$$scope={dirty:T,ctx:D}),y.$set(a)},i(D){F||(Cn(y.$$.fragment,D),F=!0)},o(D){Ln(y.$$.fragment,D),F=!1},d(D){D&&(Ae(v),Ae(k)),sr(y,D),S[6](null)}}}function vv(S,y,v){let k;Eo(S,ko,de=>v(7,k=de));const F=Jr.find(de=>de.path===k);let D,T,a,q="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;Ko(()=>{const de=new ln.Map({container:D,style:Yo,center:[-74.1197632,40.6974034],zoom:11,attributionControl:!1});de.addControl(new ln.AttributionControl({customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"})),de.on("load",()=>{v(4,T=de)})});function Y(){q=this.checked,v(1,q)}function fe(de){go[de?"unshift":"push"](()=>{D=de,v(2,D)})}return S.$$.update=()=>{if(S.$$.dirty&19&&T){a&&a.destroy();const de=$f(q?1.5:1,q?2:1);v(0,a=new Ao(T,{requestOptions:{alternatives:"true"},layers:de})),v(0,a.interactive=!0,a)}},[a,q,D,F,T,Y,fe]}class xv extends jr{constructor(y){super(),Or(this,y,vv,yv,xr,{})}}const bv=Object.freeze(Object.defineProperty({__proto__:null,default:xv},Symbol.toStringTag,{value:"Module"}));function jg(S,y,v){const k=S.slice();return k[7]=y[v],k}function Ng(S){let y,v=S[7]+"";return{c(){y=Ie("li")},m(k,F){Ee(k,y,F),y.innerHTML=v},p(k,F){F&2&&v!==(v=k[7]+"")&&(y.innerHTML=v)},d(k){k&&Ae(y)}}}function $g(S){let y,v,k;return{c(){y=Ie("button"),y.textContent="Clear"},m(F,D){Ee(F,y,D),v||(k=Ri(y,"click",S[3]),v=!0)},p:zi,d(F){F&&Ae(y),v=!1,k()}}}function wv(S){let y,v,k,F,D,T=ad(S[1]),a=[];for(let Y=0;Y<T.length;Y+=1)a[Y]=Ng(jg(S,T,Y));let q=S[1].length&&$g(S);return{c(){y=Ie("p"),y.textContent=`This example listens for all the available events and logs them below. Interact with the map to see the emitted
    events.`,v=mt(),k=Ie("ol");for(let Y=0;Y<a.length;Y+=1)a[Y].c();F=mt(),q&&q.c(),D=Of()},m(Y,fe){Ee(Y,y,fe),Ee(Y,v,fe),Ee(Y,k,fe);for(let de=0;de<a.length;de+=1)a[de]&&a[de].m(k,null);Ee(Y,F,fe),q&&q.m(Y,fe),Ee(Y,D,fe)},p(Y,fe){if(fe&2){T=ad(Y[1]);let de;for(de=0;de<T.length;de+=1){const ge=jg(Y,T,de);a[de]?a[de].p(ge,fe):(a[de]=Ng(ge),a[de].c(),a[de].m(k,null))}for(;de<a.length;de+=1)a[de].d(1);a.length=T.length}Y[1].length?q?q.p(Y,fe):(q=$g(Y),q.c(),q.m(D.parentNode,D)):q&&(q.d(1),q=null)},d(Y){Y&&(Ae(y),Ae(v),Ae(k),Ae(F),Ae(D)),Jm(a,Y),q&&q.d(Y)}}}function Tv(S){let y;return{c(){y=Ie("span"),y.textContent=`${S[2].name}`,lt(y,"slot","title")},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function Sv(S){let y,v,k,F;return y=new zo({props:{$$slots:{title:[Tv],default:[wv]},$$scope:{ctx:S}}}),{c(){dr(y.$$.fragment),v=mt(),k=Ie("div"),lt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(D,T){or(y,D,T),Ee(D,v,T),Ee(D,k,T),S[4](k),F=!0},p(D,[T]){const a={};T&1026&&(a.$$scope={dirty:T,ctx:D}),y.$set(a)},i(D){F||(Cn(y.$$.fragment,D),F=!0)},o(D){Ln(y.$$.fragment,D),F=!1},d(D){D&&(Ae(v),Ae(k)),sr(y,D),S[4](null)}}}function Pv(S,y,v){let k;Eo(S,ko,fe=>v(6,k=fe));const F=Jr.find(fe=>fe.path===k);let D,T,a=[];Ko(()=>{const fe=new ln.Map({container:D,style:Yo,center:[-74.1197632,40.6974034],zoom:11,attributionControl:!1});fe.addControl(new ln.AttributionControl({customAttribution:"<a href='http://project-osrm.org/' target='_blank'>&copy; OSRM</a>"})),fe.on("load",()=>{T=new Ao(fe,{requestOptions:{alternatives:"true"}}),T.interactive=!0,T.on("addwaypoint",de=>{var ge,te;a.push(`<strong>${de.type}</strong>: waypoint added at index <strong>${(ge=de.data)==null?void 0:ge.index}</strong>. Original event - <strong>${(te=de.originalEvent)==null?void 0:te.type}</strong>`),v(1,a)}),T.on("removewaypoint",de=>{var ge,te;a.push(`<strong>${de.type}</strong>: waypoint removed at index <strong>${(ge=de.data)==null?void 0:ge.index}</strong>. Original event - <strong>${(te=de.originalEvent)==null?void 0:te.type}</strong>`),v(1,a)}),T.on("movewaypoint",de=>{var ge,te,we,it;a.push(`<strong>${de.type}</strong>: waypoint at index <strong>${(ge=de.data)==null?void 0:ge.index}</strong> moved from coordinates ${(we=(te=de.data)==null?void 0:te.initialCoordinates)==null?void 0:we.map(Ke=>Ke.toFixed(5)).join(", ")}. Original event - <strong>${(it=de.originalEvent)==null?void 0:it.type}</strong>`),v(1,a)}),T.on("fetchroutesstart",de=>{a.push(`<strong>${de.type}</strong>: routing request started. Original event - <strong>${de.originalEvent.type}</strong>`),v(1,a)}),T.on("fetchroutesend",de=>{var ge;a.push(`<strong>${de.type}</strong>: routing request finished with code <strong>${(ge=de.data)==null?void 0:ge.code}</strong>. Original event - <strong>${de.originalEvent.type}</strong>`),v(1,a)})})});const q=()=>v(1,a=[]);function Y(fe){go[fe?"unshift":"push"](()=>{D=fe,v(0,D)})}return[D,a,F,q,Y]}class Mv extends jr{constructor(y){super(),Or(this,y,Pv,Sv,xr,{})}}const Cv=Object.freeze(Object.defineProperty({__proto__:null,default:Mv},Symbol.toStringTag,{value:"Module"}));function Iv(S){let y,v,k,F,D,T,a,q,Y,fe,de,ge,te,we,it;return{c(){y=Ie("button"),v=_n("Abort Manually"),F=mt(),D=Ie("p"),D.innerHTML=`Instead of aborting routing-requests manually, you can set the <code>requestTimeout</code> configuration option to a
    number of ms that a routing-request is allowed to take before getting automatically aborted.`,T=mt(),a=Ie("label"),q=Ie("span"),q.innerHTML="<strong>Request Timeout</strong>",Y=mt(),fe=Ie("input"),ge=mt(),te=Ie("small"),te.innerHTML=`<strong>Note</strong> that you may need to manually
    <a href="https://www.browserstack.com/guide/how-to-perform-network-throttling-in-chrome" target="_blank" rel="noreferrer">enable network throttling</a> for the setting above to take effect`,y.disabled=k=!S[0],lt(fe,"type","number"),fe.disabled=de=!S[0],lt(a,"class","flex flex-col gap-2")},m(Ke,vt){Ee(Ke,y,vt),Ye(y,v),Ee(Ke,F,vt),Ee(Ke,D,vt),Ee(Ke,T,vt),Ee(Ke,a,vt),Ye(a,q),Ye(a,Y),Ye(a,fe),Gi(fe,S[1]),Ee(Ke,ge,vt),Ee(Ke,te,vt),we||(it=[Ri(y,"click",S[4]),Ri(fe,"input",S[6])],we=!0)},p(Ke,vt){vt&1&&k!==(k=!Ke[0])&&(y.disabled=k),vt&1&&de!==(de=!Ke[0])&&(fe.disabled=de),vt&2&&Rn(fe.value)!==Ke[1]&&Gi(fe,Ke[1])},d(Ke){Ke&&(Ae(y),Ae(F),Ae(D),Ae(T),Ae(a),Ae(ge),Ae(te)),we=!1,Os(it)}}}function Av(S){let y;return{c(){y=Ie("span"),y.textContent=`${S[3].name}`,lt(y,"slot","title")},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function Ev(S){let y,v,k,F;return y=new zo({props:{$$slots:{title:[Av],default:[Iv]},$$scope:{ctx:S}}}),{c(){dr(y.$$.fragment),v=mt(),k=Ie("div"),lt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(D,T){or(y,D,T),Ee(D,v,T),Ee(D,k,T),S[7](k),F=!0},p(D,[T]){const a={};T&515&&(a.$$scope={dirty:T,ctx:D}),y.$set(a)},i(D){F||(Cn(y.$$.fragment,D),F=!0)},o(D){Ln(y.$$.fragment,D),F=!1},d(D){D&&(Ae(v),Ae(k)),sr(y,D),S[7](null)}}}function kv(S,y,v){let k;Eo(S,ko,ge=>v(8,k=ge));const F=Jr.find(ge=>ge.path===k);let D,T,a,q=1e3;Ko(()=>{const ge=new ln.Map({container:D,style:Yo,center:[-74.1197632,40.6974034],zoom:11,attributionControl:!1});ge.addControl(new ln.AttributionControl({customAttribution:"<a href='http://project-osrm.org/' target='_blank' rel='noreferrer'>&copy; OSRM</a>"})),ge.on("load",()=>{v(5,T=ge)})});function Y(){var ge;(ge=a==null?void 0:a.abortController)==null||ge.abort()}function fe(){q=Rn(this.value),v(1,q)}function de(ge){go[ge?"unshift":"push"](()=>{D=ge,v(2,D)})}return S.$$.update=()=>{S.$$.dirty&35&&T&&(a&&a.destroy(),v(0,a=new Ao(T,{requestOptions:{alternatives:"true"},requestTimeout:q})),v(0,a.interactive=!0,a))},[a,q,D,F,Y,T,fe,de]}class zv extends jr{constructor(y){super(),Or(this,y,kv,Ev,xr,{})}}const Dv=Object.freeze(Object.defineProperty({__proto__:null,default:zv},Symbol.toStringTag,{value:"Module"}));function Rv(S){let y,v,k,F,D,T,a,q,Y,fe,de,ge,te;return{c(){y=Ie("label"),v=Ie("span"),v.innerHTML="<strong>Position</strong>",k=mt(),F=Ie("select"),D=Ie("option"),D.textContent="Top-Left",T=Ie("option"),T.textContent="Top-Right",a=Ie("option"),a.textContent="Bottom-Left",q=Ie("option"),q.textContent="Bottom-Right",fe=mt(),de=Ie("p"),de.innerHTML=`The <code>LoadingIndicatorControl</code> adds a simple spinning loader-icon which automatically appears whenever there&#39;s
    an ongoing routing-request.`,D.__value="top-left",Gi(D,D.__value),T.__value="top-right",Gi(T,T.__value),a.__value="bottom-left",Gi(a,a.__value),q.__value="bottom-right",Gi(q,q.__value),F.disabled=Y=!S[0],S[1]===void 0&&sd(()=>S[6].call(F)),lt(y,"class","flex flex-col gap-2")},m(we,it){Ee(we,y,it),Ye(y,v),Ye(y,k),Ye(y,F),Ye(F,D),Ye(F,T),Ye(F,a),Ye(F,q),If(F,S[1],!0),Ee(we,fe,it),Ee(we,de,it),ge||(te=Ri(F,"change",S[6]),ge=!0)},p(we,it){it&1&&Y!==(Y=!we[0])&&(F.disabled=Y),it&2&&If(F,we[1])},d(we){we&&(Ae(y),Ae(fe),Ae(de)),ge=!1,te()}}}function Lv(S){let y;return{c(){y=Ie("span"),y.textContent=`${S[3].name}`,lt(y,"slot","title")},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function Bv(S){let y,v,k,F;return y=new zo({props:{$$slots:{title:[Lv],default:[Rv]},$$scope:{ctx:S}}}),{c(){dr(y.$$.fragment),v=mt(),k=Ie("div"),lt(k,"class","basis-full lg:basis-2/3 shadow-xl")},m(D,T){or(y,D,T),Ee(D,v,T),Ee(D,k,T),S[7](k),F=!0},p(D,[T]){const a={};T&515&&(a.$$scope={dirty:T,ctx:D}),y.$set(a)},i(D){F||(Cn(y.$$.fragment,D),F=!0)},o(D){Ln(y.$$.fragment,D),F=!1},d(D){D&&(Ae(v),Ae(k)),sr(y,D),S[7](null)}}}function Fv(S,y,v){let k;Eo(S,ko,ge=>v(8,k=ge));const F=Jr.find(ge=>ge.path===k);let D,T,a;Ko(()=>{v(4,T=new ln.Map({container:D,style:Yo,center:[-74.1197632,40.6974034],zoom:11,attributionControl:!1})),T.addControl(new ln.AttributionControl({customAttribution:"<a href='http://project-osrm.org/' target='_blank' rel='noreferrer'>&copy; OSRM</a>"})),T.on("load",()=>{v(0,a=new Ao(T,{requestOptions:{alternatives:"true"}})),v(0,a.interactive=!0,a)})});let q,Y="top-right";function fe(){Y=Zg(this),v(1,Y)}function de(ge){go[ge?"unshift":"push"](()=>{D=ge,v(2,D)})}return S.$$.update=()=>{S.$$.dirty&51&&T&&a&&(q&&T.hasControl(q)&&T.removeControl(q),T.addControl(v(5,q=new Gy(a,{class:"m-2"})),Y))},[a,Y,D,F,T,q,fe,de]}class Ov extends jr{constructor(y){super(),Or(this,y,Fv,Bv,xr,{})}}const jv=Object.freeze(Object.defineProperty({__proto__:null,default:Ov},Symbol.toStringTag,{value:"Module"}));function Nv(S,y,v){const k=S.slice();return k[0]=y[v],k}function $v(S){let y,v,k,F,D;return{c(){y=Ie("li"),v=Ie("a"),v.textContent=`${S[0].name}`,k=mt(),lt(v,"href",S[0].path),lt(v,"class","svelte-1jo4v3w"),lt(y,"class","svelte-1jo4v3w")},m(T,a){Ee(T,y,a),Ye(y,v),Ye(y,k),F||(D=Ff(Nf.call(null,v)),F=!0)},p:zi,d(T){T&&Ae(y),F=!1,D()}}}function Vv(S){let y,v=ad(Jr.sort(Zv)),k=[];for(let F=0;F<v.length;F+=1)k[F]=$v(Nv(S,v,F));return{c(){y=Ie("ul");for(let F=0;F<k.length;F+=1)k[F].c();lt(y,"class","svelte-1jo4v3w")},m(F,D){Ee(F,y,D);for(let T=0;T<k.length;T+=1)k[T]&&k[T].m(y,null)},p:zi,d(F){F&&Ae(y),Jm(k,F)}}}function Uv(S){let y;return{c(){y=Ie("span"),y.textContent="Examples",lt(y,"slot","title"),lt(y,"class","svelte-1jo4v3w")},m(v,k){Ee(v,y,k)},p:zi,d(v){v&&Ae(y)}}}function Gv(S){let y,v,k,F;return y=new zo({props:{noHeader:!0,$$slots:{title:[Uv],default:[Vv]},$$scope:{ctx:S}}}),{c(){dr(y.$$.fragment),v=mt(),k=Ie("div"),k.innerHTML='<div class="p-5 lg:p-10 h-full flex flex-col gap-5 lg:gap-10 justify-start lg:justify-center items-center flex-col bg-inherit overflow-x-hidden overflow-y-auto svelte-1jo4v3w"><h1 class="text-center max-w-3xl svelte-1jo4v3w">Please, choose an example at the sidebar on the left</h1> <span class="text-slate-500 svelte-1jo4v3w">or navigate to</span> <div class="flex flex-col gap-2.5 lg:gap-5 justify-center items-center svelte-1jo4v3w"><a href="https://github.com/maplibre/maplibre-gl-directions" target="_blank" rel="noreferrer" class="svelte-1jo4v3w">GitHub</a> <a href="/maplibre-gl-directions//api" target="_blank" rel="noreferrer" class="svelte-1jo4v3w">API</a></div></div>',lt(k,"class","basis-full lg:basis-2/3 overflow-hidden rounded-3xl shadow-xl svelte-1jo4v3w")},m(D,T){or(y,D,T),Ee(D,v,T),Ee(D,k,T),F=!0},p(D,[T]){const a={};T&8&&(a.$$scope={dirty:T,ctx:D}),y.$set(a)},i(D){F||(Cn(y.$$.fragment,D),F=!0)},o(D){Ln(y.$$.fragment,D),F=!1},d(D){D&&(Ae(v),Ae(k)),sr(y,D)}}}const Zv=(S,y)=>S.index-y.index;class qv extends jr{constructor(y){super(),Or(this,y,null,Gv,xr,{})}}const Jr=Object.entries(Object.assign({"./examples/1 User Interaction.svelte":n0,"./examples/10 Bearings Support and Control.svelte":c0,"./examples/11 Restyling.svelte":x0,"./examples/12 Distance Measurement.svelte":E0,"./examples/13 Load and Save.svelte":F0,"./examples/14 Multiple profiles.svelte":G0,"./examples/2 Programmatical Control.svelte":K0,"./examples/3 Mapbox Directions API and Congestions.svelte":iv,"./examples/4 Origin and Destination.svelte":lv,"./examples/5 Show Routes' Directions.svelte":mv,"./examples/6 Touch-Friendly Features.svelte":bv,"./examples/7 Events.svelte":Cv,"./examples/8 Aborting Requests.svelte":Dv,"./examples/9 Loading Indicator Control.svelte":jv})).map(([S,y])=>{const v=S.match(/\/(\d+)\s([^/]+)\./),k=parseInt(v[1]),F=v[2];return{path:"/examples/"+F.toLowerCase().replaceAll(/\s/g,"-"),index:k,name:F,component:y,sourceUrl:`https://github.com/maplibre/maplibre-gl-directions/tree/main/demo/src/${S}`}}),ng={};Jr.forEach(S=>{ng[S.path]=S.component.default});ng["*"]=qv;function Hv(S){let y,v,k;return v=new cy({props:{routes:ng}}),{c(){y=Ie("main"),dr(v.$$.fragment),lt(y,"class","p-5 lg:p-10 flex flex-col lg:flex-row landscape:flex-row w-full gap-5 lg:gap-10")},m(F,D){Ee(F,y,D),or(v,y,null),k=!0},p:zi,i(F){k||(Cn(v.$$.fragment,F),k=!0)},o(F){Ln(v.$$.fragment,F),k=!1},d(F){F&&Ae(y),sr(v)}}}class Wv extends jr{constructor(y){super(),Or(this,y,null,Hv,xr,{})}}new Wv({target:document.getElementById("app")});
